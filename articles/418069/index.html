<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Solving color Japanese crosswords at the speed of light</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Japanese crosswords (also nonograms) are logical puzzles in which a pixel image is encrypted. Solve crossword need with the help of numbers located to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Solving color Japanese crosswords at the speed of light</h1><div class="post__text post__text-html js-mediator-article"><p>  Japanese crosswords (also nonograms) are logical puzzles in which a pixel image is encrypted.  Solve crossword need with the help of numbers located to the left of the rows and above the columns. </p><br><p>  The size of the crossword puzzles can reach up to 150x150.  The player with the help of special logical techniques calculates the color of each cell.  The solution can take as little as a couple of minutes on beginner crossword puzzles, as well as dozens of hours on complex puzzles. </p><br><p>  A good algorithm can solve the problem much faster.  The text describes how to use the most appropriate algorithms (which generally lead to a solution), as well as their optimization and the use of C ++ features (which reduce the operating time by several dozen times) to write a solution that works almost instantly. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w1/tw/-c/w1tw-caq1d9vswcrqfapdufcbfk.gif"></div><a name="habracut"></a><br><p>  <em>In the mobile version of Habr, formulas in the text may not be shown (not in all mobile browsers) - use the full version or another mobile browser if you notice problems with formulas</em> </p><br><h2 id="pravila-igry">  Rules of the game </h2><br><p>  Initially, the crossword canvas is white.  For vanilla black and white crossword puzzles, you need to restore the location of black cells. </p><br><p>  In black-and-white crossword puzzles, the number of numbers for each row (to the left of the canvas) or for each column (above the canvas) indicates how many groups of black cells are in the corresponding row or column, and the numbers themselves - how many fused cells each of these groups contains.  Set of numbers <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mo" id="MJXp-Span-2" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font></span><span class="MJXp-mn" id="MJXp-Span-3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 </font></font></span><span class="MJXp-mo" id="MJXp-Span-4" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span><span class="MJXp-mn" id="MJXp-Span-5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 </font></font></span><span class="MJXp-mo" id="MJXp-Span-6" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span><span class="MJXp-mn" id="MJXp-Span-7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 </font></font></span><span class="MJXp-mo" id="MJXp-Span-8" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.849ex" height="2.66ex" viewBox="0 -832 2948.8 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-33" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-2C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-32" x="1224" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-2C" x="1724" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-35" x="2169" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-5D" x="2670" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-1"> [3, 2, 5] </script>  means that in a certain row there are three consecutive groups of <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-9"><span class="MJXp-mn" id="MJXp-Span-10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="1.937ex" viewBox="0 -728.2 500.5 834" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-33" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> 3 </script>  , <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-11"><span class="MJXp-mn" id="MJXp-Span-12"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="1.937ex" viewBox="0 -728.2 500.5 834" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-32" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-3"> 2 </script>  and <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-13"><span class="MJXp-mn" id="MJXp-Span-14"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">five</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="1.937ex" viewBox="0 -728.2 500.5 834" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-35" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-4"> 5 </script>  black cells in a row.  Groups can be arranged in a row as horrible, without disturbing the relative order (numbers specify their length, and the position must be guessed), but they must be separated by at least one white cell. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bl/w9/zt/blw9ztswh2gvpy0lfqr76ei_xcq.png"></div><br><p>  <em>Correct example</em> </p><br><p>  In color crosswords, each group still has its own color - any, except white, is a background color.  Neighboring groups of <em>different</em> colors can stand close together, but for neighboring groups of the <em>same</em> colors, the separation of at least one white cell is necessary. </p><br><h2 id="chto-ne-yavlyaetsya-yaponskim-krossvordom">  What is not a Japanese crossword </h2><br><p>  Each pixel image can be encrypted in the form of a crossword puzzle.  But it can be impossible to restore it back - the resulting puzzle can either have more than one solution, or have one solution, but cannot be solved in a logical way.  Then the remaining cells in the process of the game have to guess the shaman technology using <s>quantum computers</s> . </p><br><p>  Such crosswords are not a crossword puzzle, but graphomania.  It is believed that the correct crossword is such that in a logical way you can come to a single solution. </p><br><p>  The "logical path" is the ability to restore each cell one by one, considering the row / column separately, or their intersection.  If this is not possible, the number of considered answers can be very much, much more than a person can calculate. </p><br><img src="https://habrastorage.org/webt/qs/nu/2m/qsnu2mmr0lutke0xzprtow8jv-i.png"><br><p>  <em>Incorrect nonogram is the only solution, but it‚Äôs impossible to solve normally.</em>  <em>Orange marked "unsolvable" cells.</em>  <em>Taken from Wikipedia.</em> </p><br><p>  This limitation is explained in the following way: in the most general case, the Japanese crossword puzzle is an NP-complete task.  However, guessing does not become an NP-complete task, if there is an algorithm, at each moment of time unambiguously indicating which cells to open further.  All crossword puzzles used by humans (except for the method of <del>  Monte Carlo </del>  trial and error) are based precisely on this. </p><br><p>  In the most Orthodox crossword puzzles, the width and height are divided by 5, there are no rows that can be counted instantly (such where either the colored cells fill all the spots or none at all), and the number of additional colors is limited.  These requirements are not mandatory. </p><br><p>  The simplest is the wrong crossword puzzle: </p><br><pre><code class="bash hljs">|1 1| --+---+ 1| | 1| | --+---+</code> </pre> <br><p>  Often, coded pixel art that uses "chess order" to simulate a gradient is not solved.  It will be better to understand if you type in the search for "pixelart gradient".  The gradient is just like this 2x2 file crossword puzzle. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/oz/mm/sj/ozmmsj7dzmqdn0dwgmspwymmohy.gif"></div><br><h2 id="vozmozhnye-varianty-resheniy">  Possible solutions </h2><br><p>  We have the size of the crossword puzzle, the description of the colors and all the rows and columns.  How can you collect from this picture: </p><br><h4 id="polnyy-perebor">  Brute force </h4><br><p>  For each cell, we iterate over all possible states and check for satisfactory.  The complexity of this solution for black and white crossword <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-15"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-16"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O </font></font></span><span class="MJXp-mo" id="MJXp-Span-17" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-18"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N </font></font></span><span class="MJXp-mo" id="MJXp-Span-19" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚àó </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mo" id="MJXp-Span-21" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚àó </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-22"><span class="MJXp-mrow" id="MJXp-Span-23" style="margin-right: 0.05em;"><span class="MJXp-mn" id="MJXp-Span-24"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 </font></font></span></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-25" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-26"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N </font></font></span><span class="MJXp-mo" id="MJXp-Span-27"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚àó </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-28"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M</font></font></span></span></span><span class="MJXp-mo" id="MJXp-Span-29" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.881ex" height="2.901ex" viewBox="0 -935.7 7698.6 1249" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4F" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-28" x="763" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4E" x="1153" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-2217" x="2263" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4D" x="2986" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-2217" x="4260" y="0"></use><g transform="translate(4982,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-32" x="0" y="0"></use><g transform="translate(500,393)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-2217" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4D" x="1389" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-29" x="7309" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-5"> O (N * M * {2} ^ {N * M}) </script>  for color <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-30"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-31"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O </font></font></span><span class="MJXp-mo" id="MJXp-Span-32" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-33"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N </font></font></span><span class="MJXp-mo" id="MJXp-Span-34" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚àó </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-35"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mo" id="MJXp-Span-36" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚àó </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-37"><span class="MJXp-mrow" id="MJXp-Span-38" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-40"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-41"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-42"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-43"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-45" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-46"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N </font></font></span><span class="MJXp-mo" id="MJXp-Span-47"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚àó </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M</font></font></span></span></span><span class="MJXp-mo" id="MJXp-Span-49" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="22.813ex" height="3.021ex" viewBox="0 -987.6 9822.1 1300.8" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4F" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-28" x="763" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4E" x="1153" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-2217" x="2263" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4D" x="2986" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-2217" x="4260" y="0"></use><g transform="translate(4982,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-63" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-6F" x="433" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-6C" x="919" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-6F" x="1217" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-72" x="1703" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-73" x="2154" y="0"></use><g transform="translate(2624,422)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-2217" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4D" x="1389" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-29" x="9432" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-6"> O (N * M * {colors} ^ {N * M}) </script>  .  By analogy with the <a href="https://ru.wikipedia.org/wiki/Bogosort">clown sorting,</a> this solution can also be called clown.  It is suitable for size 5x5. </p><br><h4 id="backtracking">  Backtracking </h4><br><p>  All possible methods of arranging horizontal groups of cells are sorted out.  We put a group of cells in a row, check that it does not break the description of groups of columns.  If it breaks - we put further on 1 cell, we check again.  Set - go to the next group.  If the group cannot be put in any way - we roll back the two groups, rearrange the previous group, and so on, until we put the last group successfully. </p><br><h4 id="otdelno-dlya-kazhdogo-ryada">  Separately for each row </h4><br><p>  This solution is much better and truly true.  We can analyze each row and each column separately.  Each row will try to reveal the maximum information. </p><br><p>  The algorithm for each cell in the row learns more information - it may turn out that it is impossible to paint the cell in some color, the groups will not converge.  The row cannot be fully opened at once, but the information obtained ‚Äúwill help‚Äù several columns to open up better, and when we begin to analyze them, they again will ‚Äúhelp‚Äù the rows, and this will take several iterations until all the cells have one possible color. </p><br><h2 id="istinno-vernoe-reshenie">  Truly the right decision </h2><br><h4 id="odna-stroka-dva-cveta">  One line, two colors </h4><br><p>  Effective guessing of a black-and-white one-line player, for which some cells have already been guessed, is a very tough task.  She met in places like: </p><br><ul><li>  <em>The quarter-finals of ACM ICPC 2006</em> - <a href="http://acm.timus.ru/problem.aspx%3Fspace%3D1%26num%3D1508%26locale%3Dru">you can try to solve the problem yourself</a> .  The time limit is 1 second, the number of groups is limited to 400, and the row length is also 400. It has a very high level of complexity compared to other tasks. </li><li>  <em>International Olympiad in Informatics 2016</em> - <a href="http://ioinformatics.org/locations/ioi16/contest/day2/paint/paint-RUS.pdf">condition</a> , <a href="https://contest.yandex.ru/contest/2647/problems/D/">pass the task</a> .  Time limit 2 seconds, limiting the number of groups to 100, the length of the row 200'000.  Such constraints are overkills, but solving the problem with ACM constraints is 80/100 points in this task.  Here, too, the level did not disappoint, schoolchildren from around the world with a cruel level of IQ are trained for several years to solve different tin, then go to this Olympiad (only 4 people from the country have to go), decide 2 rounds of 5 hours <del>  and in the case of epic win (bronze in different years for 138-240 points out of 600) entering Oxford, then offers from clear companies to the search department, a long and happy life embracing with dakimama. </del></li></ul><br><p>  A monochrome one-liner can also be solved in different ways, and for <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-50"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-51"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O </font></font></span><span class="MJXp-mo" id="MJXp-Span-52" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-53"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N </font></font></span><span class="MJXp-mo" id="MJXp-Span-54" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚àó </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-55"><span class="MJXp-mn" id="MJXp-Span-56" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-57" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-58" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.695ex" height="2.901ex" viewBox="0 -935.7 4604.7 1249" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4F" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-28" x="763" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4E" x="1153" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-2217" x="2263" y="0"></use><g transform="translate(2986,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-32" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4E" x="707" y="557"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-29" x="4215" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-7"> O (N * 2 ^ N) </script>  (enumeration of all variants, check for correctness, selection of cells that have the same color in all variants), and still somehow less stupid. </p><br><p>  The basic idea is to use an analogue backtracking, but without unnecessary calculations.  If we have somehow put several groups and are now in a certain cell, then it is required to find out whether it is possible to put the remaining groups, starting with the current cell. </p><br><div class="spoiler">  <b class="spoiler_title">Pseudocode</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EpicWin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(group, cell)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cell &gt;= last_cell: <span class="hljs-comment"><span class="hljs-comment">#   return group == group_size win = False #        if group &lt; group_size #    and CanInsertBlack(cell, len[group]) #    and CanInsertWhite(cell + len[group], 1) #    and EpicWin(group + 1, cell + len[group] + 1): #    win = True can_place_black[cell .. (cell + len[group] - 1)] = True can_place_white[cell + len[group]] = True; #         if CanInsertWhite(cell, 1) and EpicWin(group, cell + 1): win = True can_place_white[cell] = True return win EpicWin(0, 0)</span></span></code> </pre> </div></div><br><p>  This approach is called <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B8%25D0%25BD%25D0%25B0%25D0%25BC%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">dynamic programming</a> .  The pseudocode is simplified, and there even the memorization of the calculated values ‚Äã‚Äãis not performed. </p><br><p>  The functions <code>CanInsertBlack/CanInsertWhite</code> are needed to check whether it is theoretically possible to put the group of the desired size in the right place.  All they have to do is to check that there is no ‚Äú100% white‚Äù cell in the specified cell range (for the first function) or ‚Äú100% black‚Äù (for the second).  So they can work for <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O </font></font></span><span class="MJXp-mo" id="MJXp-Span-61" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-mn" id="MJXp-Span-62"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span><span class="MJXp-mo" id="MJXp-Span-63" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.745ex" height="2.66ex" viewBox="0 -832 2043 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4F" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-28" x="763" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-31" x="1153" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-29" x="1653" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-8"> O (1) </script>  , this can be done using partial sums: </p><br><div class="spoiler">  <b class="spoiler_title">CanInsertBlack</b> <div class="spoiler_text"><pre> <code class="python hljs">white_counter = [ <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, ..., <span class="hljs-number"><span class="hljs-number">0</span></span> ] <span class="hljs-comment"><span class="hljs-comment">#   n def PrecalcWhite(): for i in range(0, (n-1)): if is_anyway_white[i]: # 1,  i-  100%  white_counter[i]++ if i &gt; 0: white_counter[i] += white_counter[i - 1] def CanInsertBlack(cell, len): #     [cell, cell + len - 1] ans = white_counter[cell + len - 1] if cell &gt; 0: ans -= white_counter[cell - 1] #  ans -     cell  (cell + len - 1) return ans == 0</span></span></code> </pre> </div></div><br><p>  The same witchcraft with partial sums is waiting for a string like </p><br><pre> <code class="python hljs">can_place_black[cell .. (cell + len[group] - <span class="hljs-number"><span class="hljs-number">1</span></span>)] = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre> <br><p>  Here, instead of <code>= True</code> , you can increase the number by 1. And if we need to make many additions on a segment in a certain array <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-64"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-65"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-66"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-67"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-68"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-69"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.712ex" height="1.817ex" viewBox="0 -520.7 2459.5 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-61" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-72" x="529" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-72" x="981" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-61" x="1432" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-79" x="1962" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-9"> array </script>  and, moreover, we don‚Äôt use this array before various additions (they say about this that this task is ‚Äúsolved offline‚Äù), instead of a cycle: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#     for i in range(L, R + 1): array[i]++</span></span></code> </pre> <br><p>  You can do this: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#     array[L]++ array[R + 1]-- #    for i in range(1, n): array[i] += array[i - 1]</span></span></code> </pre> <br><p>  Thus, the whole algorithm works for <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-70"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-71"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O </font></font></span><span class="MJXp-mo" id="MJXp-Span-72" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-73"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k </font></font></span><span class="MJXp-mo" id="MJXp-Span-74" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚àó </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-75"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span><span class="MJXp-mo" id="MJXp-Span-76" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.383ex" height="2.66ex" viewBox="0 -832 3609.4 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4F" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-28" x="763" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-6B" x="1153" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-2217" x="1896" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-6E" x="2619" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-29" x="3219" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-10"> O (k * n) </script>  where <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-77"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-78"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.211ex" height="2.057ex" viewBox="0 -780.1 521.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-6B" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-11"> k </script>  - the number of groups of black cells, <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-79"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-80"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.395ex" height="1.455ex" viewBox="0 -520.7 600.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-6E" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-12"> n </script>  - string length.  And we go to the ACM ICPC semifinal or get the internum bronze.  <a href="">ACM solution (Java)</a> .  <a href="">IOI solution (C ++)</a> . </p><br><h4 id="odna-stroka-mnogo-cvetov">  One row, many colors </h4><br><p>  When switching to multi-color nonograms, which are still not clear how to solve, we will know the terrible truth - it turns out that every column has a magical effect on all the columns!  This is clearer through an example: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6m/ve/_d/6mve_d8spu5wyqai1osmtppdgr8.png"></div><br><p>  <em>Source - <a href="http://www.nonograms.ru/methods">Methods for solving Japanese crosswords</a></em> </p><br><p>  While the two-color nonograms normally did without it, they did not need to look back at orthogonal friends. <br>  The picture shows that in the left-hand example the three rightmost cells are empty because the configuration will break if we paint these cells in <del>  those colors in which to dye yourself </del>  non-white color. </p><br><p>  But this joke is mathematically resolvable - each cell should be given a number, where <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-81"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-82"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.802ex" height="1.937ex" viewBox="0 -728.2 345.5 834" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-69" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-13"> i </script>  th bit will mean whether you can give this cell <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-83"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-84"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.802ex" height="1.937ex" viewBox="0 -728.2 345.5 834" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-69" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-14"> i </script>  th color  Initially, all cells have a value of <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-85"><span class="MJXp-msubsup" id="MJXp-Span-86"><span class="MJXp-mn" id="MJXp-Span-87" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-88" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-89"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-90"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-91"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-92"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-93"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-94"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></span></span></span><span class="MJXp-mo" id="MJXp-Span-95" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font></span><span class="MJXp-mn" id="MJXp-Span-96"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.707ex" height="2.66ex" viewBox="0 -987.6 4179.4 1145.2" role="img" focusable="false" style="vertical-align: -0.366ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-32" x="0" y="0"></use><g transform="translate(500,393)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-6F" x="433" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-6C" x="919" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-6F" x="1217" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-72" x="1703" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-73" x="2154" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-2212" x="2678" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-31" x="3678" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-15"> 2 ^ {colors} - 1 </script>  .  The solution dynamics will not change very much. </p><br><p>  It will be possible to observe the following effect: in the same left-hand example, according to the row version, the rightmost cell can have either blue or white color. <br>  According to the column version, this cell is either green or white. <br>  According to the common sense version, this cell will have only white color.  And then we continue to calculate the answer. </p><br><p>  If we assume the zero bit is "white", the first is "blue", the second is "green", then the line calculated the state for the last cell <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-97"><span class="MJXp-mn" id="MJXp-Span-98"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">011</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.487ex" height="1.937ex" viewBox="0 -728.2 1501.5 834" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-31" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-31" x="1001" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-16"> 011 </script>  and column <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-99"><span class="MJXp-mn" id="MJXp-Span-100"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">101</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.487ex" height="1.937ex" viewBox="0 -728.2 1501.5 834" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-31" x="1001" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-17"> 101 </script>  .  So, in fact, this cell has a state <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-101"><span class="noError" id="MJXp-Span-102" style="display: inline-block;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">011 \ &amp; 101 = 001</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><span class="noError" style="display: inline-block;">011&nbsp;\&nbsp;&amp;&nbsp;101&nbsp;=&nbsp;001</span></span><script type="math/tex" id="MathJax-Element-18"> 011 \ & 101 = 001 </script></p><br><div class="spoiler">  <b class="spoiler_title">Pseudocode</b> <div class="spoiler_text"><pre> <code class="python hljs">source = [...] <span class="hljs-comment"><span class="hljs-comment">#   result = [0, 0, ..., 0] #   len = [...] #    clrs = [...] #    def CanInsertColor(color, cell, len): for i in range(cell, cell + len): if (source[i] &amp; (1 &lt;&lt; color)) == 0: #     color    return False; return True def PlaceColor(color, cell, len): for i in range(cell, cell + len): result[i] |= (1 &lt;&lt; color) #   color  OR def EpicWinExtended(group, cell): if cell &gt;= last_cell: #   return group == group_size win = False #        if group &lt; group_size #    and CanInsertColor(clrs[group], cell, len[group]) #    and SequenceCheck() #       ,  #         and EpicWin(group + 1, cell + len[group]): #    win = True PlaceColor(clrs[group], cell, len[group]) PlaceColor(0, cell + len[group], 1) #   -    #         #   -  0 if CanInsertWhite(0, cell, 1) and EpicWinExtended(group, cell + 1): win = True PlaceColor(0, cell, 1) return win</span></span></code> </pre> </div></div><br><h4 id="mnogo-strok-mnogo-cvetov">  Many rows, many colors </h4><br><p>  Constantly doing the update of the states of all rows and columns, described in the last paragraph, until there is a single cell with more than one bit.  In each iteration, after updating all rows and columns, we update the states of all cells in them through mutual AND. </p><br><h2 id="pervye-rezultaty">  First results </h2><br><p>  Suppose we wrote the code not as woodpeckers, that is, we don‚Äôt copy objects anywhere by mistake instead of passing by reference, we don‚Äôt invent bicycles anywhere in the algorithm, use <code>__builtin_popcount</code> and <code>__builtin_ctz</code> ( <a href="https://gcc.gnu.org/onlinedocs/gcc/Other-Builtins.html">gcc features</a> ) for bit operations, everything is neat and clean. </p><br><p>  Let's look at the time of the program, which reads the puzzle from the file and solves it completely.  It is worth assessing the merits of a machine on which all this stuff was written and tested: </p><br><div class="spoiler">  <b class="spoiler_title">My 1932 Harley Davidson Model B Classic Motorcycle engine specification</b> <div class="spoiler_text"><pre> <code class="bash hljs">RAM - 4GB  - AMD E1-2500,  1400MHz  L1 - 128KiB, 1GHz  L2 - 1MiB, 1GHz  - 2,  - 2   ¬´ SoC   ¬ª   2013    28 </code> </pre> </div></div><br><p>  It is clear that such a supercomputer was chosen, because optimizations on it have a greater effect than on a flying shaitan-machine. </p><br><p>  So, after running our algorithm on the most difficult crossword (according to nonograms.ru), we get a not very good result - from <strong>47</strong> to <strong>60</strong> seconds (this includes reading from the file and the solution).  It should be noted that the "complexity" on the site is well calculated - the same crossword in all versions of the program was also the hardest, the other most difficult crosswords in the opinion of the archive were kept in the top in time. </p><br><div class="spoiler">  <b class="spoiler_title">Color Crossword ‚Ññ9596, the greatest difficulty</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ar/7n/rx/ar7nrxtbzch1wk8bsihz0puldt8.png"></div></div></div><br><p>  For quick testing, the benchmark functionality was made.  To obtain data for him, I sparsil <strong>4683</strong> color crosswords (out of <strong>10906</strong> ) and <strong>1406</strong> black-and-whites (out of <strong>8293</strong> ) with nonograms.ru (this is one of the largest nonogram archives on the Internet) and saved them in a format understandable to the program.  We can assume that these crosswords are a random sample, so the benchmark would show adequate average values.  Also, the numbers of the pair of dozens of the most "difficult" crosswords (also the largest in size and number of colors) are written into the script for handles. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ox/xt/nd/oxxtnd1jdlth72q0zqnj3ic1kew.png"></div><br><h2 id="optimizaciya">  Optimization </h2><br><p>  Here are possible techniques for optimization that were made (1) at the time of writing the entire algorithm, (2) for shrinking the operation time from half a minute to fractions of a second, (3) those optimizations that may be useful further. </p><br><h4 id="vo-vremya-napisaniya-algoritma">  At the time of writing the algorithm </h4><br><ul><li>  Special functions for bit operations, in our case <code>__builtin_popcount</code> for counting the units in the binary notation, and <code>__builtin_ctz</code> for the number of zeros before the first youngest unit.  Such functions may not appear in some compilers.  For Windows, suitable analogs are: </li></ul><br><div class="spoiler">  <b class="spoiler_title">Windows popcount</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> _MSC_VER # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;intrin.h&gt; # define __builtin_popcount __popcnt #endif</span></span></span></span></code> </pre> </div></div><br><ul><li>  Array organization - the smaller size is at the beginning.  For example, it is better to use the array [2] [3] [500] [1024] than [1024] [500] [3] [2]. </li><li>  The most important thing is the general adequacy of the code and the avoidance of unnecessary worries for calculations. </li></ul><br><h4 id="chto-umenshaet-vremya-raboty">  What reduces the work time </h4><br><ul><li>  -O2 flag when compiling. </li><li>  In order not to re-throw a completely solved row / column into the algorithm, you can in the separate std :: vector / array start the flags for each row, mark them with a complete decision, and stop them from going further if there is nothing to decide. </li><li>  The specificity of a multi-repetition problem solving for dynamics suggests that a special array that contains flags marking the already ‚Äúcomputed‚Äù pieces of the problem should be reset every time with a new solution.  In our case, this is a two-dimensional array / vector, where the first dimension is the number of groups, the second is the current cell (see the EpicWin pseudocode from above, where this array is not, but the idea is clear).  Instead of zeroing, you can do this ‚Äî let us have a ‚Äútimer‚Äù variable, and the array consists of numbers that show the last ‚Äútime‚Äù when this piece was recalculated last.  When starting a new task, the "timer" is incremented by 1. Instead of checking the Boolean flag, check the equality of the array element and the "timer".  This is effective especially in cases where not all possible states are covered by the algorithm (which means that resetting the array, "have we already considered this" takes a healthy chunk of time). </li><li>  Replacing simple operations of the same type (assignment cycles, etc.) with analogues in STL or more adequate things.  Sometimes it works faster than a bike. </li><li>  <code>std::vector&lt;bool&gt;</code> in C ++ compresses all Boolean values ‚Äã‚Äãto individual bits in numbers, which works on access a little slower than if it were a normal value at an address.  If the program is very, very often refers to such values, then replacing the bool with an integer type can well affect performance. </li><li>  The remaining weaknesses can be searched through profilers and edit them.  I myself use Valgrind, its performance analysis is convenient to look through kCachegrind.  Profilers are built into many IDEs. </li></ul><br><p>  These edits were enough to get such data on the benchmark: </p><br><div class="spoiler">  <b class="spoiler_title">Colored nonograms</b> <div class="spoiler_text"><pre> <code class="bash hljs">izaron@izaron:~/nonograms/build$ ./nonograms_solver -x ../../nonogram/source2/ -e [2018-08-04 22:57:40.432] [Nonograms] [info] Starting a benchmark... [2018-08-04 22:58:03.820] [Nonograms] [info] Average time: 0.00497556, Median time: 0.00302781, Max time: 0.215925 [2018-08-04 22:58:03.820] [Nonograms] [info] Top 10 heaviest nonograms: [2018-08-04 22:58:03.820] [Nonograms] [info] 0.215925 seconds, file 9596 [2018-08-04 22:58:03.820] [Nonograms] [info] 0.164579 seconds, file 4462 [2018-08-04 22:58:03.820] [Nonograms] [info] 0.105828 seconds, file 15831 [2018-08-04 22:58:03.820] [Nonograms] [info] 0.08827 seconds, file 18353 [2018-08-04 22:58:03.820] [Nonograms] [info] 0.0874717 seconds, file 10590 [2018-08-04 22:58:03.820] [Nonograms] [info] 0.0831248 seconds, file 4649 [2018-08-04 22:58:03.820] [Nonograms] [info] 0.0782811 seconds, file 11922 [2018-08-04 22:58:03.820] [Nonograms] [info] 0.0734325 seconds, file 4655 [2018-08-04 22:58:03.820] [Nonograms] [info] 0.071352 seconds, file 10828 [2018-08-04 22:58:03.820] [Nonograms] [info] 0.0708263 seconds, file 11824</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Black and white nonograms</b> <div class="spoiler_text"><pre> <code class="bash hljs">izaron@izaron:~/nonograms/build$ ./nonograms_solver -x ../../nonogram/<span class="hljs-built_in"><span class="hljs-built_in">source</span></span>/ -e -b [2018-08-04 22:59:56.308] [Nonograms] [info] Starting a benchmark... [2018-08-04 23:00:09.781] [Nonograms] [info] Average time: 0.0095679, Median time: 0.00239274, Max time: 0.607341 [2018-08-04 23:00:09.781] [Nonograms] [info] Top 10 heaviest nonograms: [2018-08-04 23:00:09.781] [Nonograms] [info] 0.607341 seconds, file 5126 [2018-08-04 23:00:09.781] [Nonograms] [info] 0.458932 seconds, file 19510 [2018-08-04 23:00:09.781] [Nonograms] [info] 0.452245 seconds, file 5114 [2018-08-04 23:00:09.781] [Nonograms] [info] 0.19975 seconds, file 18627 [2018-08-04 23:00:09.781] [Nonograms] [info] 0.163028 seconds, file 5876 [2018-08-04 23:00:09.781] [Nonograms] [info] 0.161675 seconds, file 17403 [2018-08-04 23:00:09.781] [Nonograms] [info] 0.153693 seconds, file 12771 [2018-08-04 23:00:09.781] [Nonograms] [info] 0.146731 seconds, file 5178 [2018-08-04 23:00:09.781] [Nonograms] [info] 0.142732 seconds, file 18244 [2018-08-04 23:00:09.781] [Nonograms] [info] 0.136131 seconds, file 19385</code> </pre> </div></div><br><p>  You can see that, on average, black and white crosswords are "more difficult" than color.  This confirms the observations of game lovers, who also believe that the "color" are solved on average easier. </p><br><p>  Thus, without radical revisions (such as rewriting the entire code to C or assembly inserts with fastcall and lowering the frame pointer) can be achieved by high performance, we note, on a very modest computer.  The Pareto principle can be applied to optimizations - it turns out that small optimization influences strongly because this piece of code is critical and is called very often. </p><br><h4 id="dalneyshaya-optimizaciya">  Further optimization </h4><br><p>  The following methods can greatly improve program performance.  Some of them work not in all cases, but under certain conditions. </p><br><ul><li>  Rewriting code in C-style and other year 1972.  Replace ifstream with sishny analog, vectors with arrays, learn all the compiler options and fight for each processor clock. </li><li>  Parallelization.  For example, in the code there is a piece where the rows are sequentially updated, then the columns: </li></ul><br><div class="spoiler">  <b class="spoiler_title">bool Puzzle :: UpdateState (...)</b> <div class="spoiler_text"><pre> <code class="cpp hljs"> ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!UpdateGroupsState(solver, dead_rows, row_groups, row_masks)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!UpdateGroupsState(solver, dead_cols, col_groups, col_masks)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>;</code> </pre> </div></div><br><p>  These functions are independent of each other and they do not have shared memory except for the variable solver (OneLineSolver type), so you can create two "solver" objects (only one is obvious here - solver) and run two threads in the same function.  The effect is the same: in color crosswords, the ‚Äúhardest‚Äù is solved twice as fast, in black and white the same one third faster, and the average time has increased, due to the relatively high costs of creating streams. </p><br><p>  But in general, I would not advise doing it right in the current program and using it calmly - first, creating threads is a costly operation, you should not constantly create threads for microsecond tasks, and second, with some combination of program arguments, threads can access simultaneously - external memory, for example, when creating image solutions - this should be taken into account and secured. </p><br><p>  If the task were serious and I would have a lot of data and multi-core machines, I would go even further - you can start several constant streams, each will have its own OneLineSolver object, and another thread-safe structure that drives the distribution of work and upon request it gives a reference to the next row / column for the solution.  Flows after solving the next task turn to the structure again to solve something else.  In principle, some nonogram problem can be solved without completing the previous one, for example, when this structure deals with the mutual AND of all cells, and then some flows are free and do nothing.  Another parallelization can be done on the GPU through CUDA - there are many options. </p><br><ul><li>  Using classic data structures.  Please note - when I showed pseudocode solutions for colored nonograms, the functions CanInsertColor and PlaceColor do not work for <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-103"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-104">O</span><span class="MJXp-mo" id="MJXp-Span-105" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-106">1</span><span class="MJXp-mo" id="MJXp-Span-107" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.745ex" height="2.66ex" viewBox="0 -832 2043 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4F" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-28" x="763" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-31" x="1153" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-29" x="1653" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-19"> O (1) </script>  , unlike black and white nonograms.  It looks like this in the program: </li></ul><br><div class="spoiler">  <b class="spoiler_title">CanPlaceColor and SetPlaceColor</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> OneLineSolver::CanPlaceColor(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;&amp; cells, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> color, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lbound, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rbound) { <span class="hljs-comment"><span class="hljs-comment">// Went out of the border if (rbound &gt;= cells.size()) { return false; } // We can paint a block of cells with a certain color if and only if it is // possible for all cells to have this color (that means, if every cell // from the block has color-th bit set to 1) int mask = 1 &lt;&lt; color; for (int i = lbound; i &lt;= rbound; ++i) { if (!(cells[i] &amp; mask)) { return false; } } return true; } void OneLineSolver::SetPlaceColor(int color, int lbound, int rbound) { // Every cell from the block now can have this color for (int i = lbound; i &lt;= rbound; ++i) { result_cells_[i] |= (1 &lt;&lt; color); } }</span></span></code> </pre> </div></div><br><p>  That is, it works for the line, for <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-108"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-109">O</span><span class="MJXp-mo" id="MJXp-Span-110" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-111">N</span><span class="MJXp-mo" id="MJXp-Span-112" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.646ex" height="2.66ex" viewBox="0 -832 2431 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4F" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-28" x="763" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4E" x="1153" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-29" x="2041" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-20"> O (N) </script>  (Later there will be an explanation of the meaning of such a code). </p><br><p>  Let's see how you can get the best difficulty.  Take <code>CanPlaceColor</code> .  This function checks that among all the numbers of the vector in the segment <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-113"><span class="MJXp-mo" id="MJXp-Span-114" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-115">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-116">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-117">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-118">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-119">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-120">d</span><span class="MJXp-mo" id="MJXp-Span-121" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-122">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-123">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-124">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-125">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-126">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127">d</span><span class="MJXp-mo" id="MJXp-Span-128" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.2ex" height="2.66ex" viewBox="0 -832 6975.2 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-6C" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-62" x="577" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-6F" x="1006" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-75" x="1492" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-6E" x="2064" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-64" x="2665" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-2C" x="3188" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-72" x="3633" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-62" x="4085" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-6F" x="4514" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-75" x="5000" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-6E" x="5572" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-64" x="6173" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-5D" x="6696" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-21"> [lbound, rbound] </script>  bit number <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-129"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-130">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-131">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-132">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-133">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-134">r</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.004ex" height="2.057ex" viewBox="0 -780.1 2154.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-63" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-6F" x="433" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-6C" x="919" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-6F" x="1217" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-72" x="1703" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-22"> color </script>  set to 1. Equivalent to this you can take <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-135"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-136">A</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-137">N</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-138">D</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-23-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.731ex" height="2.057ex" viewBox="0 -780.1 2467.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-41" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4E" x="750" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-44" x="1639" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-23"> AND </script>  <strong>of all</strong> numbers of this segment and check bit number <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-139"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-140">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-141">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-142">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-143">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-144">r</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-24-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.004ex" height="2.057ex" viewBox="0 -780.1 2154.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-63" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-6F" x="433" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-6C" x="919" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-6F" x="1217" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-72" x="1703" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-24"> color </script>  .  Using the fact that the operation <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-145"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-146">A</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-147">N</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-148">D</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-25-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.731ex" height="2.057ex" viewBox="0 -780.1 2467.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-41" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4E" x="750" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-44" x="1639" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-25"> AND </script>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25BC%25D0%25BC%25D1%2583%25D1%2582%25D0%25B0%25D1%2582%25D0%25B8%25D0%25B2%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25BE%25D0%25BF%25D0%25B5%25D1%2580%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F">commutative</a> , as well as the sum, minimum / maximum, product, or operation <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-149"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-150">X</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-151">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-152">R</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-26-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.517ex" height="2.057ex" viewBox="0 -780.1 2375.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-58" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4F" x="852" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-52" x="1616" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-26"> XOR </script>  for quick counting <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-153"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-154">A</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-155">N</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-156">D</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-27-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.731ex" height="2.057ex" viewBox="0 -780.1 2467.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-41" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4E" x="750" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-44" x="1639" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-27"> AND </script>  of the entire segment, you can use almost any data structure that works with commutative operations on the segment.  It: </p><br><ol><li>  SQRT decomposition.  Pre-count <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-157"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-158">O</span><span class="MJXp-mo" id="MJXp-Span-159" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mtext" id="MJXp-Span-160">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-161">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-162">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-163">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-164">t</span><span class="MJXp-mrow" id="MJXp-Span-165"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-166">N</span></span><span class="MJXp-mo" id="MJXp-Span-167" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-28-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.275ex" height="2.66ex" viewBox="0 -832 4424 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4F" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-28" x="763" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-73" x="1403" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-71" x="1872" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-72" x="2333" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-74" x="2784" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMATHI-4E" x="3146" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/418069/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiXUXfyapUeQUQSXoXFtUA87Oh6Xg#MJMAIN-29" x="4034" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-28"> O (\ sqrt {N}) </script>  , request <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-168"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-169">O</span><span class="MJXp-mo" id="MJXp-Span-170" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msqrt" id="MJXp-Span-171"><span class="MJXp-surd"><span style="font-size: 134%; margin-top: 0.104em;">‚àö</span></span><span class="MJXp-root"><span class="MJXp-rule" style="border-top: 0.08em solid;"></span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-172">N</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-173" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-29-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-29">O(\sqrt{N})</script>  . <a href="https://habr.com/post/138946/">  </a> . </li><li>  .  <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-174"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-175">O</span><span class="MJXp-mo" id="MJXp-Span-176" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-177">N</span><span class="MJXp-mi" id="MJXp-Span-178">log</span><span class="MJXp-mo" id="MJXp-Span-179" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-180"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-181">N</span></span><span class="MJXp-mo" id="MJXp-Span-182" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-30-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-30">O(N\log{N})</script> ,  <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-183"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-184">O</span><span class="MJXp-mo" id="MJXp-Span-185" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi" id="MJXp-Span-186">log</span><span class="MJXp-mo" id="MJXp-Span-187" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-188"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-189">N</span></span><span class="MJXp-mo" id="MJXp-Span-190" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-31-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-31">O(\log{N})</script>  .    . </li><li>   (Sparse Table).  <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-191"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-192">O</span><span class="MJXp-mo" id="MJXp-Span-193" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-194">N</span><span class="MJXp-mi" id="MJXp-Span-195">log</span><span class="MJXp-mo" id="MJXp-Span-196" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-197"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-198">N</span></span><span class="MJXp-mo" id="MJXp-Span-199" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-32-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-32">O(N\log{N})</script> ,  <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-200"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-201">O</span><span class="MJXp-mo" id="MJXp-Span-202" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-203">1</span><span class="MJXp-mo" id="MJXp-Span-204" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-33-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-33"> O (1) </script>  . <a href="http://neerc.ifmo.ru/wiki/index.php%3Ftitle%3D%25D0%25A0%25D0%25B5%25D1%2588%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5_RMQ_%25D1%2581_%25D0%25BF%25D0%25BE%25D0%25BC%25D0%25BE%25D1%2589%25D1%258C%25D1%258E_%25D1%2580%25D0%25B0%25D0%25B7%25D1%2580%25D0%25B5%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25BE%25D0%25B9_%25D1%2582%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25B8%25D1%2586%25D1%258B"></a> . </li></ol><br><p>  ,      -   ( <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-205"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-206">O</span><span class="MJXp-mo" id="MJXp-Span-207" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-208">N</span><span class="MJXp-mo" id="MJXp-Span-209" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-34-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-34">O(N)</script> ,  <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-210"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-211">O</span><span class="MJXp-mo" id="MJXp-Span-212" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-213">1</span><span class="MJXp-mo" id="MJXp-Span-214" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-35-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-35"> O (1) </script> )  ,    <a href="http://neerc.ifmo.ru/wiki/index.php%3Ftitle%3D%25D0%2590%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC_%25D0%25A4%25D0%25B0%25D1%2580%25D0%25B0%25D0%25BA%25D0%25B0-%25D0%259A%25D0%25BE%25D0%25BB%25D1%2582%25D0%25BE%25D0%25BD%25D0%25B0_%25D0%25B8_%25D0%2591%25D0%25B5%25D0%25BD%25D0%25B4%25D0%25B5%25D1%2580%25D0%25B0"></a> ,  ,       <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-215"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-216">œÜ</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-36-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-36">\varphi</script> ,  <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-217"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-218">œÜ</span><span class="MJXp-mo" id="MJXp-Span-219" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-220">Œ±</span><span class="MJXp-mo" id="MJXp-Span-221" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-222">Œ≤</span><span class="MJXp-mo" id="MJXp-Span-223" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-224" style="margin-left: 0.333em; margin-right: 0.333em;">‚àà</span><span class="MJXp-mo" id="MJXp-Span-225" style="margin-left: 0em; margin-right: 0em;">{</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-226">Œ±</span><span class="MJXp-mo" id="MJXp-Span-227" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-228">Œ≤</span><span class="MJXp-mo" id="MJXp-Span-229" style="margin-left: 0em; margin-right: 0em;">}</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-37-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-37">\varphi(\alpha, \beta) \in \{\alpha, \beta\}</script> ,      ‚Äî    (,   ...) </p><br><p>   <code>SetPlaceColor</code> .       .      SQRT-       (  " ").         - <a href="http://neerc.ifmo.ru/wiki/index.php%3Ftitle%3D%25D0%2594%25D0%25B5%25D0%25BA%25D0%25B0%25D1%2580%25D1%2582%25D0%25BE%25D0%25B2%25D0%25BE_%25D0%25B4%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B2%25D0%25BE_%25D0%25BF%25D0%25BE_%25D0%25BD%25D0%25B5%25D1%258F%25D0%25B2%25D0%25BD%25D0%25BE%25D0%25BC%25D1%2583_%25D0%25BA%25D0%25BB%25D1%258E%25D1%2587%25D1%2583">    </a>      . </p><br><p>       -  ‚Äî     . </p><br><p> ,   ‚Äî <em></em>        ,    ?     : </p><br><ol><li>        .   <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-230"><span class="MJXp-mi" id="MJXp-Span-231">log</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-38-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-38">\log</script>    ,  ,    ‚Äî         (   magic number  ,     ). ,   <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-232"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-233">N</span><span class="MJXp-mo" id="MJXp-Span-234" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-235"><span class="MJXp-mn" id="MJXp-Span-236" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-237" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-238">5</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-39-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-39">N=10^{5}</script> ,     <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-239"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-240">O</span><span class="MJXp-mo" id="MJXp-Span-241" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-242"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-243" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-244" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-245" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-40-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-40">O(N^2)</script>    10 ,    <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-246"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-247">O</span><span class="MJXp-mo" id="MJXp-Span-248" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-249">N</span><span class="MJXp-mi" id="MJXp-Span-250">log</span><span class="MJXp-mo" id="MJXp-Span-251" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-252"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-253">N</span></span><span class="MJXp-mo" id="MJXp-Span-254" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-41-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-41">O(N\log{N})</script>   0.150 ,        <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-255"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-256">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-42-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-42">N</script> ,     .  ,            ( ): <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-257"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-258">O</span><span class="MJXp-mo" id="MJXp-Span-259" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-260">N</span><span class="MJXp-msqrt" id="MJXp-Span-261"><span class="MJXp-surd"><span style="font-size: 134%; margin-top: 0.104em;">‚àö</span></span><span class="MJXp-root"><span class="MJXp-rule" style="border-top: 0.08em solid;"></span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-262">N</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-263" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-43-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-43">O(N\sqrt{N})</script> versus <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-264"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-265">O</span><span class="MJXp-mo" id="MJXp-Span-266" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-267">N</span><span class="MJXp-msubsup" id="MJXp-Span-268"><span class="MJXp-mi" id="MJXp-Span-269" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-270" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-271" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-272"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-273">N</span></span><span class="MJXp-mo" id="MJXp-Span-274" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-44-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-44">O(N\log^2{N})</script>  .    <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-275"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-276">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-45-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-45">N</script> ( )   ‚Äî    15-30. </li><li>     ,         . </li></ol><br><p>     ‚Äî                  ,      -   ‚Äî   <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-277"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-278">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-46-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-46">N</script>      ,    .     ,        ~25%  ~11%  ,          .     -      ,  ,        ,          . </p><br><p>        ‚Äî      ,        .     . </p><br><ul><li>  .   ,            ,   - .       :   ,        ,        ""  ? ,      ,    !       .      ,       . </li><li>    (,     1337    1000x1000)   .        <a href="https://en.cppreference.com/w/cpp/utility/bitset">std::bitset</a> ,   ‚Äî    ,   . </li></ul><br><p>  ,    . ""          .      ,         C++ ( <a href="https://habr.com/post/144736/">rope</a> ,       ), <a href="http://codeforces.com/blog/entry/11080">   </a>  <a href="http://codeforces.com/topic/61081/"> hashtable</a> ,   3-6    /   4-10   /,  unordered_map.         ,   boost. </p><br><h2 id="rofl-omitting-format-language"> ROFL Omitting Format Language </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rc/vp/jm/rcvpjmbinhow4aakwya-xgt3rm4.png"></div><br><p>         ,           ,       ,       -. </p><br><p> ROFL ‚Äî  ,   "GNU's Not Unix". ,    ,       ,  ,   ,    .    Omitting   ‚Äî          (, ,     :          ‚Äî   ). </p><br><p> ,       <a href="https://matroska.org/technical/specs/index.html">Matroska</a> ‚Äî    4  [52][4F][46][4C],         ,   ,  ,   3 ,      ‚Äî ,    . </p><br><p>  ,  MIT,    ‚Äî   ,  . </p><br><h2 id="ishodniki">  Sources </h2><br><p>     <a href="https://github.com/Izaron/Nonograms">GitHub</a> .      ,    ,     (,         ).    <a href="https://github.com/ImageMagick/ImageMagick">Magick++</a>  <a href="https://github.com/Taywee/args">args</a> . </p><br><p>         <a href="https://github.com/Izaron/Nonograms/tree/master/puzzles"></a> ,    (    ).    nonograms.ru      ,    ,             . </p><br><p>      nonograms.ru  .. <a href="https://habr.com/users/kyberprizrak/" class="user_link">KyberPrizrak</a> ,   ,          ,       !         nonograms.ru,  <a href="https://gist.github.com/Izaron/518f6b8659d1385ce7047ae477881e8e"></a> . </p><br><p> <a href="https://github.com/Izaron/Nonograms"></a> . </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/es/zg/il/eszgil8btd-jjgaszlinfz2oodm.png"></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/418069/">https://habr.com/ru/post/418069/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../418057/index.html">‚ÄúLearn, learn and learn again‚Äù: this fall top conferences for mobile developers</a></li>
<li><a href="../418059/index.html">OpenSource APM Pinpoint</a></li>
<li><a href="../418063/index.html">The Intel Core i7-8086K (Part 4)</a></li>
<li><a href="../418065/index.html">News conference MBLT DEV 2018: Android-track</a></li>
<li><a href="../418067/index.html">How to quickly prototype apps with a CSS grid and CSS variables</a></li>
<li><a href="../418071/index.html">IT industry for the people: TechTrain Festival in St. Petersburg</a></li>
<li><a href="../418075/index.html">TOP 5 things that can be printed on a 3D printer [video]</a></li>
<li><a href="../418077/index.html">Accidents "do not watch the clock": a statistical justification for the mode of technical support 24/7</a></li>
<li><a href="../418079/index.html">The most popular programming languages ‚Äã‚Äã- 2018</a></li>
<li><a href="../418081/index.html">Organization of safe testing in production. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>