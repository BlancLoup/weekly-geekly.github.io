<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Measuring Qt performance</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I decided to continue the cycle of articles about the Aurora OS (until recently called Sailfish). During the time that I work with this OS, I have acc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Measuring Qt performance</h1><div class="post__text post__text-html js-mediator-article">  I decided to continue the cycle of articles about the Aurora OS (until recently called Sailfish).  During the time that I work with this OS, I have accumulated various observations related to the performance of applications on Qt and the system as a whole, because various devices are hung, like a Christmas tree, I notice all the little things at startup.  I think that this can be interesting and useful to colleagues who also work with Qt (or will work soon).  Suggest that you can test more. <br><br><img src="https://habrastorage.org/webt/rw/uu/ze/rwuuzedwibb0ocithqms-janr-u.jpeg"><br><a name="habracut"></a><br>  I program in Qt and often discuss with colleagues, iOS developers, the similarities, differences, and benefits of approaches.  At some point we decided to move from words to deeds and take measurements.  We could not find an Android programmer who is ready to participate in our entertainment, so a comparison involving figures and tables will be only for Swift and C ++. <br><br>  I want to remind you that Qt / C ++ does not impose its own memory management mechanism, and the user solves this issue within the capabilities available in C ++, while Swift uses reference counting, and in Java, the garbage collector.  Thus, the programmer has the opportunity to interact with memory more efficiently.  In order to send an http request or read data from a database, Qt relies on its own strength, rather than using the ready-made frameworks provided by the OS.  Exceptions are interaction with the keyboard, drawing the application's start window, displaying notifications and other things. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Test 1. </h2><br>  First of all, we decided to write a simple algorithm (the sieve of Eratosthenes), run it on large numbers and compare the computation time.  Launched on iPhone 7. <br><br>  <b>Swift program:</b> <br><br><pre><code class="swift hljs">swift <span class="hljs-comment"><span class="hljs-comment">// // ViewController.swift // Eratosthenes // // Created by Dmitry Shadrin on 22/11/2018. // Copyright 2018 Digital Design. All rights reserved. // import UIKit class ViewController: UIViewController { @IBOutlet weak var digitTextField: UITextField! @IBOutlet weak var timeLabel: UILabel! @IBAction func startAction(_ sender: UIButton) { guard let text = digitTextField.text, let number = Int(text) else { return } prime(n: number) } func prime(n: Int) { let startTime = DispatchTime.now() let _ = PrimeSequence(upTo: n) .reduce(into: [], { $0.append($1) }) //      let endTime = DispatchTime.now() let time = (endTime.uptimeNanoseconds - startTime.uptimeNanoseconds) timeLabel.text = "\(time)" } } public struct PrimeSequence: Sequence { private let iterator: AnyIterator&lt;Int&gt; public init(upTo limit: Int) { self.iterator = AnyIterator(EratosthenesIterator(upTo: limit)) } public func makeIterator() -&gt; AnyIterator&lt;Int&gt; { return iterator } } private struct EratosthenesIterator: IteratorProtocol { let n: Int var composite: [Bool] var current = 2 init(upTo n: Int) { self.n = n self.composite = [Bool](repeating: false, count: n + 1) } mutating func next() -&gt; Int? { while current &lt;= self.n { if !composite[current] { let prime = current for multiple in stride(from: current * current, through: self.n, by: current) { composite[multiple] = true } current += 1 return prime } current += 1 } return nil } }</span></span></code> </pre> <br><br>  I will not dwell on the code in detail; linear Eratosthenes are not obvious for understanding, especially if one of the languages ‚Äã‚Äãis not familiar to you.  Here is a link with the description: <a href="https://e-maxx.ru/algo/prime_sieve_linear">https://e-maxx.ru/algo/prime_sieve_linear</a> , who is interested, can check for honesty.  By the way, the swift version turned out to be slightly more optimized in the details (you can search for them), which didn‚Äôt stop the plus version from winning in performance. <br><br>  <b>Qt program:</b> <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"eratosthenes.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;time.h&gt; #include &lt;QVector&gt; #include &lt;QDebug&gt; #include &lt;vector&gt; #include &lt;cmath&gt; Eratosthenes::Eratosthenes(QObject *parent) { time = 0; } void Eratosthenes::qtFunction(int n) { clock_t start, end; start = clock(); std::vector&lt;int&gt; lp = std::vector&lt;int&gt;(n + 1, 0); std::vector&lt;int&gt; pr; //       pr.reserve(std::sqrt(n) / 2); for (int i = 2; i &lt;= n; ++i) { if (lp[i] == 0) { lp[i] = i; pr.emplace_back(i); } for (int j = 0; j &lt; pr.size() &amp;&amp; pr[j] &lt;= lp[i] &amp;&amp; i * pr[j] &lt;= n; ++j) { lp[i * pr[j]] = pr[j]; } } end = clock(); time = (end - start) / (double)CLOCKS_PER_SEC; pTimeChanged(); qDebug() &lt;&lt; "  " &lt;&lt; pr.size() &lt;&lt; "" &lt;&lt; time; }</span></span></span></span></code> </pre> <br>  Run the program.  Applications have a field for entering the number n, a start button and a field with the total time: <br><br><img src="https://habrastorage.org/webt/tf/q_/ck/tfq_ckywno1xmgpvylnfwwti12e.jpeg"><img src="https://habrastorage.org/webt/je/si/ta/jesita9gyvvdgv1nrtx-zcrhuu8.jpeg"><br>  <i>Swift - on the left, Qt - on the right.</i> <br><br>  <b>Result.</b>  I will give a table of measurements for different n and at different points in time: <br><img src="https://habrastorage.org/webt/w2/ck/cd/w2ckcddlg_p18aeq8lon2cagqpq.jpeg"><br>  As you can see, an application in C ++ is ~ 1.5 times faster than native with identical algorithms. <br><br><h2>  Test 2. </h2><br>  Naturally, computing in the context of mobile applications is an important thing, but far from the only one.  Therefore, we drew a ListView consisting of 1000 elements, each of which contains text and a picture, in order to see more about the drawing speed of graphic elements.  Below, in the videos, you can see the result: <br><br>  Qt: <br><iframe width="560" height="315" src="https://www.youtube.com/embed/aC5tDt9xs7M" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Swift: <br><iframe width="560" height="315" src="https://www.youtube.com/embed/7Lgp7waMvsw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Visually, the difference is not noticeable. <br><br><h2>  Test 3. </h2><br>  In the Sailfish OS, we have the Linux kernel and the graphical native shell on Qt, and this in itself gives rise to thoughts about the good performance of this OS.  I often notice that the Inoi R7 wins in terms of the speed of execution of some tasks, although the Samsung Galaxy S8 is also close by.  For example, Samsung Galaxy S8 sends, accepts, processes, packs into a database, etc.  10K http requests in about 3-4 minutes, and Inoi R7 does the same for about 5-6 minutes.  Given the difference in iron performance, the result is impressive. <br><br>  For a more honest test of the OS performance, I decided to look at the speed of the response of the wheelbarrow. <br><br><h4>  Test.cpp: </h4><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"mypainter.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QPainter&gt; MyPainter::MyPainter(QQuickItem *parent) : QQuickPaintedItem(parent) { } void MyPainter::paint(QPainter *painter) { QPen pen; pen.setWidth(10); pen.setColor(Qt::red); painter-&gt;setPen(pen); painter-&gt;drawPolyline(pol); } void MyPainter::xyCanged(int x, int y) { pol.append(QPoint(x, y)); update(); }</span></span></span></span></code> </pre><br><h4>  Test.qml: </h4><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> QtQuick <span class="hljs-number"><span class="hljs-number">2.9</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> QtQuick.Window <span class="hljs-number"><span class="hljs-number">2.2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Painter <span class="hljs-number"><span class="hljs-number">1.0</span></span> Window { visible: <span class="hljs-literal"><span class="hljs-literal">true</span></span> Painter { id: painter anchors.fill: parent MouseArea { anchors.fill: parent onPressed: { painter.xyCanged(mouseX, mouseY) } onMouseXChanged: { painter.xyCanged(mouseX, mouseY) } onMouseYChanged: { painter.xyCanged(mouseX, mouseY) } } } }</code> </pre><br>  Simple and straightforward.  I don‚Äôt have a phone that supports Sailfish and Android for my personal use, so I had to look for the phone with my colleagues as close as possible to Inoi r7, but on Android.  What suddenly turned out to be very difficult, considering that I am sitting in a mobile development office. <br><br>  <i><b>Sony Xperia Z5 compact:</b></i> <i><br></i>  <i>The processor - Qualcomm Snapdragon 810 MSM8994, 2000 MHz</i> <i><br></i>  <i>The number of processor cores - 8</i> <i><br></i>  <i>Video Processor - Adreno 430</i> <i><br></i>  <i>The amount of internal memory - 32 GB</i> <i><br></i>  <i>The amount of RAM - 2 GB</i> <br><br>  <i><b>Inoi R7:</b></i> <i><br></i>  <i>Processor - Qualcomm Snapdragon 212 MSM8909AA, 1200 MHz</i> <i><br></i>  <i>The number of processor cores - 4</i> <i><br></i>  <i>Video Processor - Adreno 304</i> <i><br></i>  <i>The amount of internal memory - 16 GB</i> <i><br></i>  <i>The amount of RAM - 2 GB</i> <br><br>  Sony still turned out to be more powerful, but for the odds equation we turn on the power saving mode on it, it still does not lead to complete equality of power of the devices.  On the video you can see that on Android the line is not as smooth as on Sailfish. <br><br>  On the left - Sony, on the right - Inoi: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/bmYRRemNb5M" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  I do not argue, this is not a very serious indicator, you need to compare not only the capabilities of a pure language, but also different libraries, native and cross-platform, compare their performance and usability, because there are very few applications that use only ListView and Eratosthenes sieve.  Although all these little things together look very convincing to me. <br><br><h4>  Minuses </h4><br>  Of course, everything is not so rosy with Qt, as I try to paint here, there are downsides.  For example, by working with TextInput on Android, you can torture perfectionists who are particularly sensitive to crutches, because on each Qt device it manages to put absolutely unique poles into the wheels when interacting with the keyboard.  On one phone, the picture goes up, on the other - it stands still, but EnterKey does not work, on the third one only capital letters are entered, and not to be persuaded to switch to lower case.  You can continue indefinitely.  And all this also slows down!  (Grunts are relevant only for Android, such problems do not arise on Sailfish, everything works fine).  In addition, Qt is difficult to achieve native appearance of the application. <br><br><h3>  Conclusion </h3><br>  The main conclusion that can be made: Qt, being a cross-platform tool, is not inferior in performance to native development tools.  It is perfect for programs in which, in addition to the GUI, there is still a lot of mathematics, and especially for corporate applications, where there are many nuances and few employees, so that for each OS not to create a standalone version.  Corporate users are more important features than native UI.  For Aurora, Qt is a native tool for developing applications, which probably gives some performance boost. <br><br>  It would be interesting to test the Aurora on a powerful hardware, like my Galaxy S8. </div><p>Source: <a href="https://habr.com/ru/post/457622/">https://habr.com/ru/post/457622/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../457608/index.html">How to visualize data in a compelling story</a></li>
<li><a href="../457614/index.html">Secrets of finding a job abroad from a practicing headhunter</a></li>
<li><a href="../457616/index.html">My ‚ÄúWow, I didn't know that!‚Äù Moments with Jest</a></li>
<li><a href="../457618/index.html">Being a contemporary full-developer</a></li>
<li><a href="../45762/index.html">The golden era of Linux?</a></li>
<li><a href="../457624/index.html">As we broke an old shack and built a skyscraper in its place</a></li>
<li><a href="../457626/index.html">Auditing user access levels using Power BI using the example of CMS Bitrix (BEADS)</a></li>
<li><a href="../457628/index.html">Effective management of programs and projects using the P2M methodology</a></li>
<li><a href="../45763/index.html">Developer ammunition. Latest news.</a></li>
<li><a href="../457630/index.html">Experience in developing the requirements for a professional data scientist</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>