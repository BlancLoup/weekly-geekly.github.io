<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to wind a rating on Habr√© and leave unnoticed</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One Friday evening I sat at my home computer with a cup of black tea, wrote an article and thought about life. The work went on, but by that time the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to wind a rating on Habr√© and leave unnoticed</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/web/44c/19b/14f/44c19b14ffdb4e4d89ab781c7f6fd386.png"></p><br><p>  One Friday evening I sat at my home computer with a cup of black tea, wrote an article and thought about life.  The work went on, but by that time the head was beginning to slow down noticeably.  And when it was already completely dark outside the window, I decided to send the article to rest until tomorrow, and go to sleep myself.  But instead of keeping everything in a draft, as it should be, the sleepy brain on autopilot for some reason published it ... </p><a name="habracut"></a><br><p>  I understood this not immediately, but only a few minutes later, having come up last to update my profile.  The feeling was as if I hadn't turned off the gas in the kitchen and everyone was about to die.  I prayed that it could be returned to drafts or at least deleted.  By the way, the latter, as it turned out, cannot be done anymore if the material got into a general review.  Subsequently spoke on this score with those support, but I was recommended to just accept the failure) </p><br><p>  I won't torture - the article eventually returned to the nest successfully - but some kind Samaritan has already managed to put a plus on her.  But what is most interesting, despite the fact that the article was no longer on the site, the rating received for it remained in my profile. </p><br><p>  This could not but suggest the idea to reproduce the situation on an industrial scale. </p><br><p><img src="https://habrastorage.org/web/124/0aa/5d9/1240aa5d95f4418bbb5b7d0567d1ec96.png"></p><br><p>  Then I just had one invitee, which I decided to share with a friend and at the same time check the theory.  Of course, clicking on one article at a time is boring and, all the more, it is not fitting for a self-respecting developer.  Moreover, it is not too safe, because there is a risk of just getting caught. </p><br><p>  We will automate. </p><br><h2 id="podslushivaem-habrahabr">  We overhear Habrahabr </h2><br><p>  We need to get the following methods: creating an article, publishing, voting and hiding an article in drafts. <br>  We will not go through the authorization process, because it is complicated, with a bunch of redirects, and it is enough to just pull out the cookie and pretend <del>  rags </del>  by the browser. </p><br><p>  We will use <a href="https://www.charlesproxy.com/">Charles</a> for Mac as a web proxy.  Extremely convenient thing.  If you are a developer, then I recommend having it in your gentleman's set.  It also allows you to listen to traffic from any device at hand, for example, if you are debugging a mobile application. </p><br><p>  Within one session, we successfully obtain all the methods we need. </p><br><p><img src="https://habrastorage.org/web/8d3/a51/46e/8d3a5146e0144f04ad47a00ffdb1bee9.png"></p><br><p>  As it turned out, the same request is responsible for creating, publishing and deleting articles, but with different parameters.  You can create a post as a draft or immediately publish it.  And it is here that your post in the sandbox, translation or travel publication will be registered.  Maybe this will provide an opportunity to circumvent the requirements for publication in the sandbox, but did not check.  Most likely, the server will simply deploy home with some funny error. </p><br><h2 id="proveryaem-na-praktike">  We check in practice </h2><br><p>  Already almost celebrating a victory, I make a request to create a post: </p><br><pre><code class="ruby hljs">params = { <span class="hljs-symbol"><span class="hljs-symbol">:id</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:post_type</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'simple'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:flow</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:hubs</span></span> =&gt; [<span class="hljs-number"><span class="hljs-number">20742</span></span>], <span class="hljs-symbol"><span class="hljs-symbol">:title</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'test1'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:text</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'test1'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:tags_string</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'test1'</span></span> } response = HTTParty.post(<span class="hljs-string"><span class="hljs-string">'https://habrahabr.ru/json/topic/?action=save'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">headers:</span></span> headers, <span class="hljs-symbol"><span class="hljs-symbol">body:</span></span> params) <span class="hljs-comment"><span class="hljs-comment">#  id     params[:id] = JSON.parse(response.body)['redirect'].split('/')[2]</span></span></code> </pre> <br><p>  <em>Flow</em> equal to 5 and <em>Hubs</em> equal to 20742 are not random numbers, but quite deliberately selected the least popular stream 'Miscellaneous' and the hub 'Reading Room' to reduce the chance of being caught in a scam. </p><br><p>  Nevertheless, Habr for some reason refuses us: </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"system_errors"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"  "</span></span> ] }</code> </pre> <br><p>  Strange.  After all, all parameters are correct, post_type is set and exactly matches the required one, and all fields are in place.  We check the request from the proxy - it works.  And from the code - an error. </p><br><p>  As it turned out after a fun debugging, if the <em>Referer</em> header is missing, then any request to the API drops.  Usability at altitude.  And one more funny case: no matter what value is specified in the draft field, the publication will still be created by a draft: </p><br><p><img src="https://habrastorage.org/web/e23/631/5a7/e236315a70c94bf7a2e14d027387e4aa.png"></p><br><p>  Even if it is 0 or even abracadabra. </p><br><p>  But if there is no field at all, then the article is already published in the general stream. </p><br><p>  Well, created a post, you can vote.  Everything is also pretty simple and started the first time: </p><br><pre> <code class="ruby hljs">vote_headers = { <span class="hljs-string"><span class="hljs-string">'Cookie'</span></span> =&gt; HTTP::Cookie.cookie_value(vote_jar.cookies(habr_uri)), <span class="hljs-string"><span class="hljs-string">'User-Agent'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Mozilla/5.0'</span></span>, <span class="hljs-string"><span class="hljs-string">'Referer'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'https://habrahabr.ru/top/'</span></span>, <span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'application/x-www-form-urlencoded'</span></span>, <span class="hljs-string"><span class="hljs-string">'Accept'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'application/json'</span></span> } vote_body = { <span class="hljs-comment"><span class="hljs-comment">#   ? 'ti' =&gt; params[:id], 'tt' =&gt; 2, 'v' =&gt; 1 } uri = URI.parse('https://habrahabr.ru/json/vote/') http = Net::HTTP.new(uri.host, uri.port) http.use_ssl = true request = Net::HTTP::Post.new(uri.path, vote_headers) request.body = URI.encode_www_form(vote_body) #    puts http.request(request).body</span></span></code> </pre> <br><p>  The request through HTTParty desperately refused to work with the vote, I had to cut it through net / http.  Arguments, of course, are not the most spoken in the API, but in general everything is clear: publication id and two magic parameters.  Elementary. </p><br><h2 id="avtomatiziruem">  Automating </h2><br><p>  Now all together.  We get our cookies through a proxy, first for one account from which we will post, and then for the second from which we will vote. </p><br><p>  We start requests consistently one after another and everything, it seems, well.  And then I realized that in order to change accounts I had to explicitly log out on the site.  But at the same time my session still continued to work from the code.  That is, my cookies no one thought to reset on the back end.  Habr, somehow it is not good to do this with your users.  Not security. </p><br><p>  Leave everything as it is, and run the procedure in a loop.  We twist without any delay, but on the second iteration we come across a funny mistake with Easter eggs: </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"system_errors"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"   !"</span></span> ] }</code> </pre> <br><p>  Someone who is older remembers that there used to be such a program ‚ÄúUnderstand me‚Äù, where children chained each other to explain words.  And if the two did it the same way, the presenter would say: ‚ÄúRepeat on such and such a player!‚Äù.  <a href="https://www.youtube.com/watch%3Fv%3DJRklNoCSL90">Link</a> to the recording of the game.  It seems to me that it says a lot about the age of those who developed Habr. </p><br><p>  Gradually increase the delay, and the method of busting find out that the timeout for the creation of posts is 30 seconds.  Run the cycle and go to drink <del>  favorite ketchup </del>  tea. </p><br><p>  Let's not be impudent, let's stop at 30 points, having exhausted all Habr's drafts: </p><br><p><img src="https://habrastorage.org/web/93e/f2f/213/93ef2f21384249ec9ad7d06fc7f3de95.png"></p><br><p>  122 place, not bad.  It remains a bit before the first hundred.  And here are the test posts themselves: </p><br><p><img src="https://habrastorage.org/web/eaa/41f/d52/eaa41fd52e034affbbba6af645fe5d49.png"><br>  As you can see, there is no mention of your activity on the site, no one has seen the posts except yourself, but the rating is also present. </p><br><h1 id="zaklyuchenie">  Conclusion </h1><br><p>  In this uncomplicated way, you can quietly wind up a rating to your friend. </p><br><p>  Perhaps Habra should put a limit on several publications per day so that this feature is not abused.  And I would still do a session reset at logout. </p><br><p>  Thanks for attention. </p><br><p>  <strong>PS</strong> Do not ban me, please.  Ban it - <a href="https://habrahabr.ru/users/sp1nfox/" class="user_link">sp1nfox</a> , this is his rating wind up. </p><br><p>  <strong>UPD:</strong> Bana was avoided, and the hole was patched by entering a limit on the number of posts per day.  Thanks to the team Habr and <a href="https://habrahabr.ru/users/boomburum/" class="user_link">Boomburum</a> for efficiency! <br>  <strong>UPD2:</strong> Limit 3 posts per day. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/332296/">https://habr.com/ru/post/332296/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../332214/index.html">IBM Watson and cybersecurity: how a cognitive system protects valuable data</a></li>
<li><a href="../332260/index.html">Work with VPC using the package ansible-selvpc-modules</a></li>
<li><a href="../332264/index.html">Conducting a retrospective of the method of six hats</a></li>
<li><a href="../332292/index.html">Translation of Redmine plug-ins from TelegramCLI to Webogram</a></li>
<li><a href="../332294/index.html">The complete guide to moving from HTTP to HTTPS</a></li>
<li><a href="../332298/index.html">LibGDX + Scene2d (we program on Kotlin). Part 1</a></li>
<li><a href="../332300/index.html">Golem: decentralization of the new level</a></li>
<li><a href="../332302/index.html">Laws and projects that will change the face of Russian IT. Part III. Final?</a></li>
<li><a href="../332304/index.html">What kind of involvement does your product need and how to measure it more accurately</a></li>
<li><a href="../332382/index.html">How to use variables in the preprocessor LESS and SASS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>