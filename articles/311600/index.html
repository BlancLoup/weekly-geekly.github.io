<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Power Query: how to stop being afraid of functional programming and start working in the advanced query editor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago I came across an article on Habr√© on how to use Power BI and how to carry out with it a simple plan-factual analysis . The author has ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Power Query: how to stop being afraid of functional programming and start working in the advanced query editor</h1><div class="post__text post__text-html js-mediator-article">  Not so long ago I came across an article on Habr√© on how to use Power BI and how to carry out with it a <a href="https://habrahabr.ru/post/262655/">simple plan-factual analysis</a> .  The author has a huge respect for work - the material is really useful.  More than enough for a beginner.  However, as far as I understand, for many, working with PQ / PBI ends with clicking on the buttons in the interface. <br><br>  In principle, this is sufficient for most users to solve simple tasks.  Moreover, this is the majority that is called, in everyday life - non-programmers are informed.  And, as practice has shown, not everyone knows that PQ has an advanced query editing mode.  Meanwhile, the fear (unwillingness / inability) to dig deeper makes it impossible to fully utilize all the pledged PQ / PBI functionality.  I will note at least the fact that not all the buttons for which there are functions are present in the interface.  I think I‚Äôm not much mistaken if I say that there are probably two times more functions than buttons. <br><br>  If you feel that to solve the existing problems you lack the functionality provided in the interface and / or there is time to satisfy academic interest, welcome to the category ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/30a/c60/841/30ac60841b4a4e2b8ca747af1a00c356"><br><a name="habracut"></a><br><h3>  Preamble </h3><br>  Leafing through the article, I stumbled upon a fragment where the author proposes to create a table of correspondence between the month of the year and its ordinal number, referring to the fact that <i>"the language" M "does not allow at the current moment to convert the names of the months into dates</i> . <i>"</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/121/b2a/2b4/121b2a2b43f3466cb9adbe53e771542c"></div><br>  In principle, the problem is elementary.  But looking at the request with which it was implemented, I realized that I could not just walk past. <br><br><pre><code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Source={<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>}, #<span class="hljs-string"><span class="hljs-string">"Converted to Table"</span></span> = Table.FromList(Source, Splitter.SplitByNothing(), <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, ExtraValues.<span class="hljs-keyword"><span class="hljs-keyword">Error</span></span>), #<span class="hljs-string"><span class="hljs-string">"Added Index"</span></span> = Table.AddIndexColumn(#<span class="hljs-string"><span class="hljs-string">"Converted to Table"</span></span>, <span class="hljs-string"><span class="hljs-string">"Index"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), #<span class="hljs-string"><span class="hljs-string">"Added to Column"</span></span> = Table.TransformColumns(#<span class="hljs-string"><span class="hljs-string">"Added Index"</span></span>, {{<span class="hljs-string"><span class="hljs-string">"Index"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> List.Sum({_, <span class="hljs-number"><span class="hljs-number">1</span></span>})}}), #<span class="hljs-string"><span class="hljs-string">"Renamed Columns"</span></span> = Table.RenameColumns(#<span class="hljs-string"><span class="hljs-string">"Added to Column"</span></span>,{{<span class="hljs-string"><span class="hljs-string">"Column1"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>}}) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> #<span class="hljs-string"><span class="hljs-string">"Renamed Columns"</span></span></code> </pre> <br>  What does the author do if you translate the code into Russian <br><br><ol><li>  Manually creates a list of month names. </li><li>  Converts a list to a table. </li><li>  Adds a column with an index, starting from zero, in increments of one </li><li>  Transforms the "Index" column by adding one to each cell. </li><li>  Renames the default column name "Column1" to "Month" </li></ol><br>  It became interesting to me, but how else could a similar problem be solved by setting the following guidelines: <br><br><ul><li>  minimum of lines of code due to the use of the pledged functionality (for example, not to rename a column, but to set immediately, not to increment a column, but to start from one, etc.) </li><li>  refusal of manual input (you can easily be sealed by typing manually) </li><li>  use month names based on locale </li></ul><br>  As a result, the interest simply resulted in a whole collection of code fragments and a desire to share this with others. <br><br><h3>  Criticism </h3><br>  <b>Disclaimer</b>  Immediately make a reservation, I have no complaints about the author and his approaches to composing scripts (it is possible that the scripts were written in haste).  The purpose of this article is to show beginners different approaches when writing scripts. <br><br>  <b>Remark</b>  If you want to understand more deeply how this or that function works at one of the stages, remove the brackets with the parameters - and you will see the documentation for it with a description of what it accepts and what gives <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b9b/86f/221/b9b86f2219344693afa37cb92a2fcf7b"></div><br>  So, what immediately embarrassed me: <br><br>  <u>The list of months is typed manually</u> <br>  First, as mentioned above, typing the text, you can easily make mistakes, and secondly, all these quotes / commas ... Well, they are just confusion.  Therefore, instead of creating a list, listing months, I would suggest using a plain text string with a natural separator.  Those.  comma <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">Text</span></span>.Split(", , , , , , , , , , , ", ", ")</code> </pre><br>  Here, it seems, everything is clear - the <b>Text.Split</b> function converts a string into a list, breaking it with the separator "," <br><br>  <u>You can start an index from any number, including one (if you read the documentation)</u> <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Table</span></span>.AddIndexColumn(tbl, "Index", <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre><br>  Moreover, in the <b>Table.AddIndexColumn</b> function <b>, the</b> last argument can be given a step other than one.  Accordingly, it is possible to number the cells and so - 15,20,25,30 ... <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Table</span></span>.AddIndexColumn(tbl, "Index", <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>)</code> </pre><br>  From this, in fact, it all started ... <br><br><h3>  What criticism has grown </h3><br>  Further I will give examples of code with comments with gradually increasing complexity.  To begin with, how can you list a list of months. <br><br>  The simplest is direct enumeration using the syntax of the M language: <br><br><pre> <code class="hljs objectivec">months_list={<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>}</code> </pre><br>  A little more complicated - breaking the line into parts by separator: <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">Text</span></span>.Split(", , , , , , , , , , , ", ", ")</code> </pre> <br>  Using the date list generation function: <br><br><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> gen = List.Dates(#<span class="hljs-built_in"><span class="hljs-built_in">date</span></span>(<span class="hljs-number"><span class="hljs-number">2016</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-number"><span class="hljs-number">12</span></span>, #duration(<span class="hljs-number"><span class="hljs-number">32</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>)), month_name = List.Transform(gen, <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">MonthName</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> month_name</code> </pre><br>  Here, in the first step, the <b>List.Dates</b> function generates a list of dates, taking the starting date as the first argument, the number of elements as the second, and the incrementing step as the third.  In this case, adding 32 days to a month, we are guaranteed to get into the next month with every step.  Of course, if the calendar were 13 months old or more, such a method would not be possible.  But for training purposes it will come down. <br><br><img src="https://habrastorage.org/files/509/dd8/bd0/509dd8bd0b784f7f898c73334a37f1fc"><br><br>  The second step is to convert the list of dates into a list of month names.  After reviewing the documentation, we find that the <b>Date.MonthName</b> function is responsible for converting the date to the month.  What it does is take the date as the first argument and give the name of the month as a string.  And if we pass the third item and the optional argument <i>culture</i> ("ru-RU", "en-US", "uk-UA", "ar-LY"), we get the name of the month, taking into account the locale.  Ok, then, respectively, we need to apply this function to each element of the list. <br><br>  Those.  get the list {Date.MonthName (Date1), Date.MonthName (Date2), ..., Date.MonthName (DateN)}.  Well, or like this {Date.MonthName (Date1, ‚Äúru-RU‚Äù), Date.MonthName (Date2, ‚Äúru-RU‚Äù), ..., Date.MonthName (DateN, ‚Äúru-RU‚Äù)} <br><br>  Now we need a tool that converts lists.  The <b>List.Transform</b> function is responsible for the conversion of lists.  What it does is it takes the input list as the first argument and applies a function to each element, which is passed as the second argument. <br><br>  Ok, we say, and send the second argument to Date.MonthName.  The following is an explanation of what is happening - the List.Transform function takes each element of the array and feeds it to the Date.MonthName function, passing each Date as an argument <b>implicitly</b> . <br><br>  Well, what if we want to get the names of the months based on the locale?  Say, "uk-UA".  How do we set this parameter?  As we remember, List.Transform takes the second argument _function_ (and only the function), and we cannot explicitly pass to this function neither the first argument, nor the second.  Accordingly, we need a function that takes, as in the documentation, one parameter.  And let's create it!  Let's just call it ‚Äúfn‚Äù, do everything we need in it, and give it to the List.Transform.  In javascript, this is called ‚Äúclosure‚Äù: <br><br><pre> <code class="hljs javascript">fn = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">)=&gt;</span></span><span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.MonthName(x, <span class="hljs-string"><span class="hljs-string">"uk-UA"</span></span>),</code> </pre><br>  Then our code will look like this: <br><br><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> gen = List.Dates(#<span class="hljs-built_in"><span class="hljs-built_in">date</span></span>(<span class="hljs-number"><span class="hljs-number">2016</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-number"><span class="hljs-number">12</span></span>, #duration(<span class="hljs-number"><span class="hljs-number">32</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>)), fn = (x)=&gt;<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">MonthName</span></span>(x, <span class="hljs-string"><span class="hljs-string">"uk-UA"</span></span>), month_name = List.Transform(gen, fn) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> month_name</code> </pre><br>  In general, it is not necessary to specify a function name.  You can enter an unnamed function directly in brackets: <br><br><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> gen = List.Dates(#<span class="hljs-built_in"><span class="hljs-built_in">date</span></span>(<span class="hljs-number"><span class="hljs-number">2016</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-number"><span class="hljs-number">12</span></span>, #duration(<span class="hljs-number"><span class="hljs-number">32</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>)), month_name = List.Transform(gen, (x)=&gt;<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">MonthName</span></span>(x, <span class="hljs-string"><span class="hljs-string">"uk-UA"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> month_name</code> </pre><br>  We also remember that in the initial list the months were written with a small letter.  Let's do it all in the same function: <br><br><pre> <code class="hljs pgsql">let gen = List.Dates(#<span class="hljs-type"><span class="hljs-type">date</span></span>(<span class="hljs-number"><span class="hljs-number">2016</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-number"><span class="hljs-number">12</span></span>, #duration(<span class="hljs-number"><span class="hljs-number">32</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>)), month_name = List.<span class="hljs-keyword"><span class="hljs-keyword">Transform</span></span>(gen, (x)=&gt;<span class="hljs-type"><span class="hljs-type">Text</span></span>.Lower(<span class="hljs-type"><span class="hljs-type">Date</span></span>.MonthName(x, "uk-UA"))) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> month_name</code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/files/de7/fa2/3d6/de7fa23d642f4016bc263253fa43110b"></div><br>  And now let's try to create a list of months in a slightly different way - using the <b>List.Generate</b> function.  The documentation states the following: <br><br><img src="https://habrastorage.org/files/514/063/43e/51406343e28b445b80491f7d139bd52a"><br><br>  Those.  all three arguments are functions.  Fine!  Then the task is reduced to just one line: <br><br><pre> <code class="hljs vbscript">List.Generate(()=&gt;#<span class="hljs-built_in"><span class="hljs-built_in">date</span></span>(<span class="hljs-number"><span class="hljs-number">2016</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>), (x)=&gt;x&lt;#<span class="hljs-built_in"><span class="hljs-built_in">date</span></span>(<span class="hljs-number"><span class="hljs-number">2017</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>), (x)=&gt;<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.AddMonths(x,<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">MonthName</span></span>)</code> </pre><br>  Well, let it be a few, for clarity: <br><br><pre> <code class="hljs vbscript">List.Generate( ()=&gt;#<span class="hljs-built_in"><span class="hljs-built_in">date</span></span>(<span class="hljs-number"><span class="hljs-number">2016</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>), (x)=&gt;x&lt;#<span class="hljs-built_in"><span class="hljs-built_in">date</span></span>(<span class="hljs-number"><span class="hljs-number">2017</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>), (x)=&gt;<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.AddMonths(x,<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">MonthName</span></span> )</code> </pre><br>  What's going on here.  Calculates the initialization function of the start value given by the first argument.  This is the date "January 1, 2016".  Further, the function defined by the second argument is calculated, to which the value (x) calculated in the previous step is implicitly passed.  This second function performs a simple task ‚Äî it returns true / false, which means whether it is possible to continue the calculations further.  In our case, ‚ÄúJanuary 1, 2016‚Äù &lt;‚ÄúJanuary 1, 2017‚Äù, i.e.  true, i.e.  can continue.  In this case, the value of the previous step is sent to the third function, which simply adds the month to the calculated value.  We get "February 1, 2016".  Further, this value is sent to the second function, where "February 1, 2016" is compared with "January 1, 2017", and the function still returns true, then another month is added, etc.  This happens until a month is added to ‚ÄúDecember 1, 2016‚Äù, and the calculated value becomes ‚ÄúJanuary 1, 2017‚Äù.  When this value is once again sent to the test, we get false, because  "January 1, 2017" _ equal to "January 1, 2017", but not _ smaller_. <br><br>  After calculating the accumulated intermediate values, the last function, Date.MonthName, will be applied to each of the list elements.  Just as it was described above for the List.Transform function <br><br>  But what if, like last time, we want the months to be generated based on the locale, and the text starts with a small letter?  Then we create our custom function and do everything we need in it: <br><br><pre> <code class="hljs pgsql">List.Generate( ()=&gt;#<span class="hljs-type"><span class="hljs-type">date</span></span>(<span class="hljs-number"><span class="hljs-number">2016</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>), (x)=&gt;x&lt;#<span class="hljs-type"><span class="hljs-type">date</span></span>(<span class="hljs-number"><span class="hljs-number">2017</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>), (x)=&gt;<span class="hljs-type"><span class="hljs-type">Date</span></span>.AddMonths(x,<span class="hljs-number"><span class="hljs-number">1</span></span>), (x)=&gt;<span class="hljs-type"><span class="hljs-type">Text</span></span>.Lower(<span class="hljs-type"><span class="hljs-type">Date</span></span>.MonthName(x, "en-US")) )</code> </pre><br>  What is good about this method of generation is that it does not matter to us how many months in a year.  Yes, even if at least 2976, as in Pluto.  We set the first day of the first month of one year and the first day of the first month of the next year.  Plus the addition of the month to the date and strict inequality. <br><br>  And what if we know exactly how many months of the year.  Then we can, having an array of numbers from 1 to 12, generate an array of months according to their number: <br><br><pre> <code class="hljs pgsql">List.<span class="hljs-keyword"><span class="hljs-keyword">Transform</span></span>({<span class="hljs-number"><span class="hljs-number">1.</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>}, (x)=&gt;<span class="hljs-type"><span class="hljs-type">Text</span></span>.Lower(<span class="hljs-type"><span class="hljs-type">Date</span></span>.MonthName(#<span class="hljs-type"><span class="hljs-type">date</span></span>(<span class="hljs-number"><span class="hljs-number">2016</span></span>,x,<span class="hljs-number"><span class="hljs-number">1</span></span>), "ar-LY")))</code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/files/0c4/d8d/89c/0c4d8d89ccf04b8e8224450ae3e62dfa"></div><br>  This is already known to us List.Transform, in which the first argument is an array of numbers, and the second is the number-to-month conversion function.  Everything is pretty primitive, which should also be clear. <br><br>  The <b>List.TransformMany</b> function is much more interesting.  In principle, everything is the same as in List.Transform, but, unlike List.Transform, another argument is added to List.TransformMany - this is a function to which two arguments are implicitly sent - _ original and _ calculated , which allows us to use both the month number and its calculated name in one pass.  We only need to concatenate them in one line: <br><br><pre> <code class="hljs pgsql">List.TransformMany({<span class="hljs-number"><span class="hljs-number">1.</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>}, (x)=&gt;{#<span class="hljs-type"><span class="hljs-type">date</span></span>(<span class="hljs-number"><span class="hljs-number">2016</span></span>,x,<span class="hljs-number"><span class="hljs-number">1</span></span>)}, (x,y)=&gt;Number.ToText(x)&amp;" - "&amp;<span class="hljs-type"><span class="hljs-type">Text</span></span>.Lower(<span class="hljs-type"><span class="hljs-type">Date</span></span>.MonthName(y)))</code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/files/734/5cf/ba4/7345cfba4cb74673b5e4217b26943328"></div><br>  I will show you how to use this to form a table a little later. <br><br><h3>  Go to the tables </h3><br>  Everything is simple here - Text.Split, Table.AddIndexColumn is used with the start from one and <b>Table.FromList</b> with the simultaneous naming of the column (no need to rename the default "Custom1"). <br><br><pre> <code class="hljs pgsql">let src=<span class="hljs-type"><span class="hljs-type">Text</span></span>.Split("|||||||||||","|"), convert = <span class="hljs-keyword"><span class="hljs-keyword">Table</span></span>.FromList(src, Splitter.SplitByNothing(), {""}), add_index = <span class="hljs-keyword"><span class="hljs-keyword">Table</span></span>.AddIndexColumn(convert, "Index", <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> add_index</code> </pre><br>  <b>Table.FromList</b> + <b>List.Positions</b> <br>  Here is an atypical use of the Table.FromList function.  The second argument is a function that returns the array of cells to the construction sites.  The sequence is as follows - an array of strings is created src, an array of pos indices is created for it, then the array of indices is converted into a table using a custom function.  This custom function iterates over an array of indices and refers to an array of strings at the selected index. <br><br>  I will explain it more simply - for example, let's say element No. 0 from the ‚Äúpos‚Äù list and is passed to the function, where from 0 the array {src {0}, 0 + 1} is formed, i.e.  {"January", 1}.  Next, the Table.FromList function decomposes them into two columns by ‚ÄúMonth‚Äù and ‚ÄúIndex‚Äù <br><br><pre> <code class="hljs coffeescript">let src=Text.Split(<span class="hljs-string"><span class="hljs-string">"|||||||||||"</span></span>,<span class="hljs-string"><span class="hljs-string">"|"</span></span>), pos = List.Positions(src), <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     t = Table.FromList(pos, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">=&gt;</span></span>{src{x},x+<span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-string"><span class="hljs-string">""</span></span>,<span class="hljs-string"><span class="hljs-string">"Index"</span></span>}) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> t</code> </pre><br>  If you use only with the interface, then in the Table.FromList the fake function Splitter.SplitByNothing () is passed by default, which is essentially a stub for working with Table.FromList <br><br>  We merge two parallel lists into one using the <b>Table.FromColumns</b> function.  Here we form two parallel lists - a list of months and a list of its indices.  If you try to visualize this process, then it ‚Äúlooks like‚Äù this in the same way as zipping on clothes;) Before zipping, we transform the list of indexes, adding a unit to each element: <br><br><pre> <code class="hljs pgsql">let src=<span class="hljs-type"><span class="hljs-type">Text</span></span>.Split("|||||||||||","|"), pos = List.Positions(src), <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span> = List.<span class="hljs-keyword"><span class="hljs-keyword">Transform</span></span>(pos, (x)=&gt;x+<span class="hljs-number"><span class="hljs-number">1</span></span>), t = <span class="hljs-keyword"><span class="hljs-keyword">Table</span></span>.FromColumns({src, <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>},{"","Index"}) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> t</code> </pre><br>  The promised example with List.TransformMany I will paint in detail.  Suppose we have a list of numbers from 1 to 12: <br><br><img src="https://habrastorage.org/files/6b9/b11/63f/6b9b1163f1434df5a816b06104c8fe9e"><br><br>  And also there is a number-per-month conversion function: <br><br><pre> <code class="hljs pgsql">fn = (x)=&gt;<span class="hljs-type"><span class="hljs-type">Text</span></span>.Lower(<span class="hljs-type"><span class="hljs-type">Date</span></span>.MonthName(#<span class="hljs-type"><span class="hljs-type">date</span></span>(<span class="hljs-number"><span class="hljs-number">2016</span></span>,x,<span class="hljs-number"><span class="hljs-number">1</span></span>),"en-US"))}</code> </pre><br>  The only thing to take care of is that the function returns not just a value, but a value that is an element of the array: <br><br><pre> <code class="hljs pgsql">fn = (x)=&gt;{<span class="hljs-type"><span class="hljs-type">Text</span></span>.Lower(<span class="hljs-type"><span class="hljs-type">Date</span></span>.MonthName(#<span class="hljs-type"><span class="hljs-type">date</span></span>(<span class="hljs-number"><span class="hljs-number">2016</span></span>,x,<span class="hljs-number"><span class="hljs-number">1</span></span>),"en-US"))}</code> </pre><br>  We will also create a final function, which at each stage, using the starting and calculated values, creates a list of the starting and calculated ones.  Type of this - {"march", "3"}: <br><br><pre> <code class="hljs coffeescript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">final</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(start_element, calculated_element)</span></span></span><span class="hljs-function">=&gt;</span></span>{start_element, calculated_element},</code> </pre><br>  Now we will transfer to the List.TransformMany function the transformation function of each element and the final function as arguments, and assign them to our array from 1 to 12: <br><br><img src="https://habrastorage.org/files/496/f5c/db6/496f5cdb607f4e9d8b894f95d111c43a"><br><br>  Then create a table from the resulting array of arrays <br><br><pre> <code class="hljs pgsql">: let start_list = {<span class="hljs-number"><span class="hljs-number">1.</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>}, fn = (x)=&gt;{<span class="hljs-type"><span class="hljs-type">Text</span></span>.Lower(<span class="hljs-type"><span class="hljs-type">Date</span></span>.MonthName(#<span class="hljs-type"><span class="hljs-type">date</span></span>(<span class="hljs-number"><span class="hljs-number">2016</span></span>,x,<span class="hljs-number"><span class="hljs-number">1</span></span>),"en-US"))}, final = (start_element, calculated_element)=&gt;{start_element, calculated_element}, <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span> = List.TransformMany(start_list, fn, final), t = #<span class="hljs-keyword"><span class="hljs-keyword">table</span></span>({"Index", ""}, <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> t</code> </pre> <br>  As a result, we obtain the following table: <br><br><img src="https://habrastorage.org/files/9a5/f93/a79/9a5f93a7939c473380128c532f798004"><br>  Further we can form the final table as we want.  For example, multiply the number of the month by 100, add text to the name of the month and add a column with the name of the day of the week on the first day of this month: <br><br><pre> <code class="hljs pgsql">let start_list = {<span class="hljs-number"><span class="hljs-number">1.</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>}, fn = (x)=&gt;{<span class="hljs-type"><span class="hljs-type">Date</span></span>.MonthName(#<span class="hljs-type"><span class="hljs-type">date</span></span>(<span class="hljs-number"><span class="hljs-number">2016</span></span>,x,<span class="hljs-number"><span class="hljs-number">1</span></span>),"en-US")}, final = (x,y)=&gt;{ x*<span class="hljs-number"><span class="hljs-number">100</span></span>, y&amp;" has "&amp;Number.ToText(<span class="hljs-type"><span class="hljs-type">Date</span></span>.DaysInMonth(#<span class="hljs-type"><span class="hljs-type">date</span></span>(<span class="hljs-number"><span class="hljs-number">2016</span></span>,x,<span class="hljs-number"><span class="hljs-number">1</span></span>)))&amp;" days", "First day of "&amp;y&amp;" is "&amp;<span class="hljs-type"><span class="hljs-type">Date</span></span>.DayOfWeekName(#<span class="hljs-type"><span class="hljs-type">date</span></span>(<span class="hljs-number"><span class="hljs-number">2016</span></span>,x,<span class="hljs-number"><span class="hljs-number">1</span></span>), "en-US") }, <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span> = List.TransformMany(start_list, fn, final), t = #<span class="hljs-keyword"><span class="hljs-keyword">table</span></span>({"Index", "Month", "FirstDayOfWeek"}, <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> t</code> </pre><br><img src="https://habrastorage.org/files/d56/5d5/6be/d565d56be5484b16adaa5d6ee3b35ed6"><br><br>  And for those who prefer asceticism and Zen to perversions, I propose a solution to the original problem with the same technique in one line: <br><br><pre> <code class="hljs lisp">#table({<span class="hljs-string"><span class="hljs-string">""</span></span>,<span class="hljs-string"><span class="hljs-string">"Index"</span></span>},List.TransformMany({<span class="hljs-number"><span class="hljs-number">1</span></span>..<span class="hljs-number"><span class="hljs-number">12</span></span>},(<span class="hljs-name"><span class="hljs-name">x</span></span>)=&gt;{Text.Lower(<span class="hljs-name"><span class="hljs-name">Date</span></span>.MonthName(<span class="hljs-name"><span class="hljs-name">#date</span></span>(<span class="hljs-number"><span class="hljs-number">2016</span></span>,x,<span class="hljs-number"><span class="hljs-number">1</span></span>)))},(<span class="hljs-name"><span class="hljs-name">x</span></span>,y)=&gt;{y,x}))</code> </pre><br>  Well and, perhaps, the last way to create the original table - the <b>List.Accumulate</b> method.  Here is what help writes on this topic: <br><br><img src="https://habrastorage.org/files/72d/863/a6d/72d863a6db6c49878811322631c59131"><br><br>  I will add a couple of examples from myself.  It is possible to accumulate a summary value from text values.  For example, how to merge all the elements of a list into one line, separating them with a full stop, converting the lines to uppercase: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> fn_accum = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">accum,x</span></span></span><span class="hljs-function">)=&gt;</span></span> accum &amp; Text.Upper(x)&amp;<span class="hljs-string"><span class="hljs-string">"."</span></span>, result = List.Accumulate({<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>}, <span class="hljs-string"><span class="hljs-string">""</span></span>, fn_accum) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> result</code> </pre><br>  JANUARY FEBRUARY MARCH APRIL. <br><br>  Here, two parameters are implicitly passed to the fn_accum functions - the result accumulated at this step and the current value from the list.  In addition to numbers and text, you can also use lists and tables: <br><br><pre> <code class="hljs coffeescript">List.Accumulate({<span class="hljs-number"><span class="hljs-number">1.</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>}, {}, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(accum,x)</span></span></span><span class="hljs-function">=&gt;</span></span> accum &amp; {Date.MonthName(<span class="hljs-comment"><span class="hljs-comment">#date(2016,x,1))})</span></span></code> </pre><br>  In this example, an empty array is taken and the month numbers converted to a text string are pasted to it.  By analogy - for tables: <br><br><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> lst = {<span class="hljs-number"><span class="hljs-number">1.</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span>}, start_table = #table({},{}), fn= (accum,x)=&gt;accum &amp; #table({<span class="hljs-string"><span class="hljs-string">""</span></span>,<span class="hljs-string"><span class="hljs-string">"Index"</span></span>},{{Text.Lower(<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">MonthName</span></span>(#<span class="hljs-built_in"><span class="hljs-built_in">date</span></span>(<span class="hljs-number"><span class="hljs-number">2016</span></span>,x,<span class="hljs-number"><span class="hljs-number">1</span></span>))),x}}), result=List.Accumulate(lst, start_table, fn) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> result</code> </pre><br>  Here we set the initially empty table and ‚Äúpaste‚Äù to it the rows calculated at each iteration. <br><br>  I hope to clarify some of the subtleties of working with the code directly, I did better than confuse it.  In fact, M is a very beautiful and concise language.  And if you have this way and that, and in every way you have to turn the data in your daily work, it makes sense to study it a little deeper. </div><p>Source: <a href="https://habr.com/ru/post/311600/">https://habr.com/ru/post/311600/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../311590/index.html">Dependency Injection with Scala validation using language tools</a></li>
<li><a href="../311592/index.html">Chat bots, and how will Microsoft help us with this?</a></li>
<li><a href="../311594/index.html">Keeping up with the times: Using JWT in ASP.NET Core</a></li>
<li><a href="../311596/index.html">Why traditional anti-money theft protection in RBS systems is vulnerable</a></li>
<li><a href="../311598/index.html">How to check causality without experiment?</a></li>
<li><a href="../311602/index.html">GoTech 2016 participants: facts and figures</a></li>
<li><a href="../311604/index.html">Creating a programming language. Part 0</a></li>
<li><a href="../311608/index.html">What VPS hosting really is and how to choose a reliable VPS provider</a></li>
<li><a href="../311612/index.html">Digest about clouds, network technologies and service development</a></li>
<li><a href="../311614/index.html">Linux Piter # 2 is close</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>