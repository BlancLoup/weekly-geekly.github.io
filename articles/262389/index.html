<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Accelerate angular.js or how not to shoot yourself in the foot</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day to all. The release of Angular.js 2.0 is approaching, but the performance problems of the first version still remain. This article is devoted...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Accelerate angular.js or how not to shoot yourself in the foot</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/098/144/3c3/0981443c3a79431ba897d10187aa9f2d.jpg"><br><br>  Good day to all.  The release of Angular.js 2.0 is approaching, but the performance problems of the first version still remain.  This article is devoted to the optimization of Angular.js applications and will be useful both for beginners and those who are already using this framework, but have not yet encountered problems with its performance. <br><a name="habracut"></a><br><h3>  Little simple theory </h3><br>  As you know, Angular.js is a declarative front-end framework providing convenient data binning.  Of course, let's not forget about the testability, maintainability and conditional readability of Angular.js applications, but, in the context of this article, this is not important. <br><br>  So, one of the features of this framework is convenient data binning "right out of the box."  However, due to what it works?  If simplified, the data binding in Angular.js is held by <b>scope</b> , <b>digest</b> , and <b>watcher</b> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Scope</b> (or $ scope) is an object containing data and / or methods that need to be displayed or used on the page, as well as a number of technical properties, such as its identifier, link to the parent scope, and so on. <br><br>  <b>A watcher</b> is an object that stores the value of the expression specified by us and a callback function that needs to be called if this expression changes.  The watcher array is in $ scope. $$ watchers. <br><br>  <b>Digest</b> - alternately bypassing all watcher s and calling the calbek functions of those whose value has changed.  If the digest results in at least one value being changed, the digest will be launched again.  Therefore, often the digest is run two or more times.  If the digest is launched more than 10 times, Angular will throw an exception. <br><br>  Watchers are stored in a scope and you can see them by going through $ scope. $$ watchers.  Basically they are created automatically, but they can be created manually.  Directives use either the scope of the controller, or create their own.  Accordingly, watcher s directives should be sought in their scope. <br><br>  Obviously, the more watchers, the longer the digest cycle lasts.  And since the javascript language is single-threaded, then with a significant digest duration, the application will start to slow down.  Moreover, the digest is not just a traversal of the array, but also a call to the callbacks for those expressions whose value has changed.  It is believed that angular ensures trouble-free operation as long as the page contains up to about two thousand watchers.  And, although this figure sounds quite impressive, you can reach it quickly enough. <br><br><div class="spoiler">  <b class="spoiler_title">funny numbers</b> <div class="spoiler_text">  Yesterday my new record was set - I saw 65,000 votcherov on one page.  And, as it seems to me, this was not the limit. </div></div><br>  For example, this little piece of markup on ten lines will create <b>eighty</b> watchers, plus <b>ten</b> separate scope. <br><br><pre><code class="javascript hljs">&lt;table&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data-ng-repeat</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"cartoon in model.cartoons"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data-ng-class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"{even: $even, dd:$odd}"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data-ng-hide</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"cartoon.isDeleted"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{{cartoon.no}}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{{cartoon.name}}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{{cartoon.description}}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{{cartoon.releaseDate}}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{{cartoon.mark}}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;<span class="hljs-regexp"><span class="hljs-regexp">/table&gt;</span></span></code> </pre> <br><h3>  And now to practice </h3><br>  The first performance problem lies in the plane of the number of watchers.  And in order to solve it, we must clearly understand that by creating any expression of binding, we are creating a watcher.  Ng-bind, ng-model, nd-class, ng-if, ng-hide, and so on ‚Äî they all create an observer object.  And, if, alone, they do not pose a threat, their use together with ng-repeat, as seen in the example above, can very quickly assemble an army of little killers of our application.  And the biggest danger is the fully dynamic tables.  It is they who are able to produce watcher-s on a scale worthy of Mr. Isiro Honda. <br><br>  Therefore, the first (and sometimes the last) step in optimizing the number of watchers lies in analyzing the variability of the data that is displayed on the page.  In other words, it is worthwhile to monitor only those data that must change.  Very often there is a situation where the data just need to display the user.  For example, you need to display a list of all possible purchases, or display static text, which neither the user nor the server will not affect.  Therefore, in angular 1.3, a special syntax for one-time data binding has appeared, which looks like this: <br><br><blockquote>  data-ng-bind = ":: model.name" </blockquote>  or so <br><blockquote>  data-ng-repeat = "model in :: models" </blockquote><br>  This expression means that as soon as the data is calculated and displayed on the page, the <b>watcher responsible for this expression will be deleted</b> .  By combining a one-time binding with ng-repeat, you can get significant savings for watcher in our application.  The truth is there is one nuance.  <b>If there is no data involved in the binding expression (for example, the server sent null instead of the product name), then the watcher will not be deleted.</b>  It will "wait" for the data, and only then be deleted. <br><br>  The second step is to share responsibility.  In other words - not everything should be Angular.  In the example above, the ng-class directive was used to set the CSS classes for even and non-even lines.  Replacing it with the CSS tr: nth-child (even) rule, we will get rid of extra watchers, besides we will get a performance gain (extremely small) in speed.  The situation is similar with events such as ng-mouseover and ng-mouseleave (their use causes other performance problems - which is discussed below).  Often their processing can be assigned to its directive, plus jquery.  Speaking of jQuery and directives.  Sometimes, a table or list should be redrawn only in one or two cases.  In this case, it will be much more efficient to use your directive with one or two manually created watchers.  If any functionality does not cause the model to be redrawn, this is the first sign that it can be made not in the Angular style.  This is not always necessary, but the decision must be made consciously. <br><br>  I will give a simplified example.  Let us have two lists of products - available, and those that are selected by the user.  Obviously, the first list we will have, firstly, is large, and, secondly, static, since after it is loaded, neither the user nor the server will change it.  So here we can use the ‚Äúone-time‚Äù ng-repeat.  But the second list is dynamic and constantly changing by the user.  Therefore, we should not use one-time data binding here.  Although, if we do not need actual data every second, but only at the moment when the ‚Äúbuy‚Äù button is pressed, then here too we can make static by placing the responsibility for collecting the final data on the directive.  Do you need to spend resources on such optimization - see the current situation and the size of the lists. <br><br>  And finally, the third step is to properly hide the unused markup.  Out of the box, Angular.js provides ng-show / ng-hide that hide or show the parts of the page we need.  However, the associated watchers do not disappear anywhere and participate in the digest, as before.  But the use of ng-if completely cuts out elements from the Dom-tree together with the corresponding watchers.  True, deleting elements from Dom is also not the fastest procedure, so using ng-if is worth those parts of the markup that will not be hidden / shown too often, where ‚Äútoo‚Äù depends on the particular application. <br><br>  So, with multiple watchers, we sorted it out a bit.  But a long digest is not the only stone that our application may stumble upon. <br><br>  The second, albeit smaller, performance problem is that the digest is called too often. <br><br>  Usually, problems with a digest arise when the number of watchers approaches a critical, but starting the digest too often can also create problems.  As you know, a digest is not only traversing an array of watchers, but also performing callbacks for changed expressions.  In addition, often the digest is run several times in a row, further slowing performance.  Ng-model will start a digest after each letter entered.  For example, entering this fifty-five letter word <a href="http://forum.xumuk.ru/index.php%3Fshowtopic%3D116276">Tetrahydropyranylcyclopentyl tetrahydropyridopyridine</a> will trigger a digest at least one hundred and ten times.  As soon as the user enters the first letter, a digest will be launched.  Since during its execution it will be found that these models have changed, the digest will be executed again.  By the way, the digest will be called not only on the scope of the controller, but also on the other scope of the page.  Therefore, the ng-model can become quite a serious problem. <br><br>  A simple solution would be to add a debounce parameter that defers the call to the digest for a specified time.  The situation is similar with ng-mouseenter, ng-mouseover and so on.  They may launch a digest too often, which will lead to a drop in application performance. <br><br>  Therefore, special attention should be paid to areas with which the user can (albeit implicitly) invoke a digest in the application, such as input, areas of guidance, and so on.  And if you need to call the digest manually, try to do it when the maximum number of changes is made, so that the digest picks up all of them in one pass. <br><br>  And finally, the third problem is not very obvious features of the framework.  Below is a list of interesting, in my opinion, moments that can also improve the performance of the application. <br><br><ul><li>  If possible, use ng-bind instead of {{}}.  The string binding expression is about twice as slow as compared to ng-bind.  In addition, using ng-bind eliminates the need to use ng-cloak. </li><li>  Avoid using complex functions in binding expressions.  The functions specified in the expression bindings are run each time a digest is started.  And, since the digest is often run repeatedly, the execution of these functions can significantly slow down the rendering of the page. </li><li>  Use filters only if you cannot do without them.  If the functions specified in the binding expression are executed once per digest, then the filter function is executed twice per digest, for each expression.  It is best to filter the data in the controller or service. </li><li>  If possible, use $ scope. $ Digest () instead of $ scope. $ Apply ().  The fact is that the first function will start the digest only within the scope on which it was called, and the second - in all scope, starting with the rootScope.  Obviously, the first digest will go faster.  By the way, $ timeout at the end will call $ rootScope. $ Apply (). </li><li>  Remember about the possibility of deferred calling a digest on the user's input when setting the debounce parameter: data-ng-model-options = "{debounce: 150}" </li><li>  Try to avoid using ng-mouse-over and similar directives.  The call of this event will trigger a digest, and the nature of such events is such that they can be triggered many times in a short period of time. </li><li>  When creating your watchers, do not forget to save the function of their removal and call it as soon as the watchers are no longer needed.  Also, avoid setting the objectEquality flag to true.  This causes a deep copying and comparison of the new and old values ‚Äã‚Äãto determine if the callback function should be called. </li><li>  You should not keep references to Dom elements in scope.  It contains links to parent and child elements, i.e.  in fact, the whole house element.  And, it means that the digest will run through the whole Dom tree, checking which of the objects has changed.  Needless to say, how expensive it is. </li><li>  Use the track by parameter in the ng-repeat directive.  Firstly it is faster, and secondly it will prevent <i>duplicates</i> from an error <i>in a repeater</i> that is <i>not allowed</i> , which occurs when we try to output the same objects in the list. </li></ul><br>  This article is over.  More details can be read on the links below: <br><br><div class="spoiler">  <b class="spoiler_title">Read more</b> <div class="spoiler_text">  <a href="http://ng-perf.com/2014/10/30/tip-4-ng-bind-is-faster-than-expression-bind-and-one-time-bind/">AngularJS Performance Tips</a> <br>  <a href="http://thenittygritty.co/angularjs-pitfalls-using-scopes">AngularJS: 6 Common Pitfalls Using Scopes</a> <br>  <a href="https://www.binpress.com/tutorial/speeding-up-angular-js-with-simple-optimizations/135">Speeding up AngularJS apps with simple optimizations</a> <a href="https://www.binpress.com/tutorial/speeding-up-angular-js-with-simple-optimizations/135"><br></a>  <a href="http://www.slideshare.net/dragosrusu/angularjs-overcoming-performance-issues-limits">AngularJS - Overcoming performance issues.</a> </div></div><br>  Thank you for your attention, I hope your time has been well spent. </div><p>Source: <a href="https://habr.com/ru/post/262389/">https://habr.com/ru/post/262389/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262375/index.html">The digest of interesting materials for Mobile Developer # 111 (July 6-12)</a></li>
<li><a href="../262377/index.html">Is floating-point normalization needed?</a></li>
<li><a href="../262381/index.html">AOP or how to write your bike for analytics</a></li>
<li><a href="../262383/index.html">Manage ReSharper settings in the team</a></li>
<li><a href="../262387/index.html">Databene Benerator - Benefit from it.</a></li>
<li><a href="../262393/index.html">Video Switch for TV</a></li>
<li><a href="../262395/index.html">Working environment for "lazy" web developers (Vagrant + Scotchbox)</a></li>
<li><a href="../262397/index.html">Your cloud hosting in 5 minutes. Part 2: Service Discovery</a></li>
<li><a href="../262401/index.html">PHP Digest number 66 - interesting news, materials and tools (June 28 - July 12, 2015)</a></li>
<li><a href="../262403/index.html">40+ useful tools for the developer of applications for Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>