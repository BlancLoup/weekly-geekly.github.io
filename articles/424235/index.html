<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to use STATSPACK instead of AWR in Oracle Standard Edition</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! I present to your attention the translation of the article "How to use statspack instead of awr in oracle standard edition" . 

 How to use ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to use STATSPACK instead of AWR in Oracle Standard Edition</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  I present to your attention the translation of the article <a href="http://logic.edchen.org/how-to-use-statspack-instead-of-awr-in-oracle-standard-edition/">"How to use statspack instead of awr in oracle standard edition"</a> . <br><br>  How to use STATSPACK instead of AWR in Oracle Standard Edition. <br><br><h4>  Problem with reports </h4><br>  I collected performance data in an unfamiliar database. <a name="habracut"></a>  After I run the AWR report, run the command 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="bash hljs">@?/Rdbms/admin/awrrpt.sql</code> </pre> <br><br>  Got an error: <br><pre> <code class="hljs sql">WARNING (-20023) ORA-20023: Missing <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> stat: <span class="hljs-keyword"><span class="hljs-keyword">parse</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> elapsed <span class="hljs-keyword"><span class="hljs-keyword">WARNING</span></span> (<span class="hljs-number"><span class="hljs-number">-20023</span></span>) ORA<span class="hljs-number"><span class="hljs-number">-20023</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Missing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> stat: DB CPU <span class="hljs-keyword"><span class="hljs-keyword">WARNING</span></span> (<span class="hljs-number"><span class="hljs-number">-20016</span></span>) ORA<span class="hljs-number"><span class="hljs-number">-20016</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Missing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> SGASTAT: free <span class="hljs-keyword"><span class="hljs-keyword">memory</span></span> ...</code> </pre> <br>  Is there a chance that the diagnostic package is disabled? <br><br>  Let's see the parameter CONTROL_MANAGEMENT_PACK_ACCESS. <br><br><pre> <code class="bash hljs">SQL&gt; show parameter control_management_pack_access NAME TYPE ------------------------------------ ---------------------- VALUE ------------------------------ control_management_pack_access string NONE</code> </pre> <br>  I am a little careful about the value of NONE.  Since Oracle Enterprise Edition includes a diagnostic package license, but Standart Edition does not, I did not have the right to use it.  See version information. <br><br><pre> <code class="bash hljs">.SQL&gt; select * from v<span class="hljs-variable"><span class="hljs-variable">$version</span></span>; BANNER -------------------------------------------------------------------------------- Oracle Database 11g Release 11.1.0.6.0 - 64bit Production PL/SQL Release 11.1.0.6.0 - Production CORE 11.1.0.6.0 Production TNS <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> 64-bit Windows: Version 11.1.0.6.0 - Production NLSRTL Version 11.1.0.6.0 - Production</code> </pre><br>  As we can see, "Enterprise Edition" is not displayed in the console.  This is definitely the Standart Edition.  Well, at least I know that I have no right to use it. <br><br>  When I looked again at the &lt;ORACLE_HOME&gt; / rdbms / admin directory, I found that STATSPACK is still there, which is the original performance data collection tool for older databases and is very similar to AWR in functions.  Best of all, we can use STATSPACK as a replacement for AWR in the Standard Edition without limitations. <br><br><h4>  Installing STATSPACK </h4><br>  Creating a STATSPACK with a scheduled task requires at least two steps. <br><br>  1) Run the spcreate.sql script <br>  I suggest you go to the &lt;ORACLE_HOME&gt; / rdbms / admin directory as your current working directory, because all the logs at runtime will remain in this directory. <br><br>  Run the script: <br><br><pre> <code class="bash hljs">SQL&gt; @spcreate.sql;</code> </pre> <br>  Let's see what we have in this script: <br><br><pre> <code class="bash hljs">@@spcusr connect perfstat/&amp;&amp;perfstat_password @@spctab @@spcpkg</code> </pre><br>  It requires 3 basic SQL scripts to run. <br>  spcusr.sql <br><br><ul><li>  It will create a user named PERFSTAT, the default tablespace will be SYSAUX, and the temporary tablespace will be TEMP. </li><li>  Both table spaces can be configured, but before running this script, you must make sure that table spaces exist in your database. </li><li>  You need to remember the password if you want to execute some of the subroutines later. Spctab.sql </li></ul><br>  In the spctab.sql table, 71 STATSPACK tables will be created. <br><br><pre> <code class="hljs perl">STATS$DATABASE_INSTANCE STATS$LEVEL_DESCRIPTION STATS$SNAPSHOT STATS$DB_CACHE_ADVICE STATS$FILESTATXS STATS$TEMPSTATXS STATS$LATCH STATS$LATCH_CHILDREN STATS$LATCH_PARENT STATS$LATCH_MISSES_SUMMARY STATS$LIBRARYCACHE STATS$BUFFER_POOL_STATISTICS STATS$ROLLSTAT STATS$ROWCACHE_SUMMARY STATS$SGA STATS$SGASTAT STATS$SYSSTAT STATS$SESSTAT STATS$SYSTEM_EVENT STATS$SESSION_EVENT STATS$WAITSTAT STATS$ENQUEUE_STATISTICS STATS$SQL_SUMMARY STATS$SQLTEXT STATS$SQL_STATISTICS STATS$RESOURCE_LIMIT STATS$DLM_MISC STATS$CR_BLOCK_SERVER STATS$CURRENT_BLOCK_SERVER STATS$INSTANCE_CACHE_TRANSFER STATS$UNDOSTAT STATS$SQL_PLAN_USAGE STATS$SQL_PLAN STATS$SEG_STAT STATS$SEG_STAT_OBJ STATS$PGASTAT STATS$PARAMETER STATS$INSTANCE_RECOVERY STATS$STATSPACK_PARAMETER STATS$SHARED_POOL_ADVICE STATS$SQL_WORKAREA_HISTOGRAM STATS$PGA_TARGET_ADVICE STATS$JAVA_POOL_ADVICE STATS$THREAD STATS$FILE_HISTOGRAM STATS$EVENT_HISTOGRAM STATS$TIME_MODEL_STATNAME STATS$SYS_TIME_MODEL STATS$SESS_TIME_MODEL STATS$STREAMS_CAPTURE STATS$STREAMS_APPLY_SUM STATS$PROPAGATION_SENDER STATS$PROPAGATION_RECEIVER STATS$BUFFERED_QUEUES STATS$BUFFERED_SUBSCRIBERS STATS$RULE_SET STATS$OSSTATNAME STATS$OSSTAT STATS$PROCESS_ROLLUP STATS$PROCESS_MEMORY_ROLLUP STATS$SGA_TARGET_ADVICE STATS$STREAMS_POOL_ADVICE STATS$MUTEX_SLEEP STATS$DYNAMIC_REMASTER_STATS STATS$IOSTAT_FUNCTION_NAME STATS$IOSTAT_FUNCTION STATS$MEMORY_TARGET_ADVICE STATS$MEMORY_DYNAMIC_COMPS STATS$MEMORY_RESIZE_OPS STATS$INTERCONNECT_PINGS STATS$IDLE_EVENT</code> </pre><br>  spcpkg.sql <br><br>  It will create the required STATSPACK stored procedures for PERFSTAT. <br><br>  2. Run the script spauto.sql <br>  This script will send the task at a specified interval (1 hour). <br><br><pre> <code class="bash hljs">SQL&gt; @spauto.sql;</code> </pre><br>  In which he presents such work: <br><br><pre> <code class="bash hljs">SQL&gt; begin 2 select instance_number into :instno from v<span class="hljs-variable"><span class="hljs-variable">$instance</span></span>; 3 dbms_job.submit(:jobno, <span class="hljs-string"><span class="hljs-string">'statspack.snap;'</span></span>, trunc(sysdate+1/24,<span class="hljs-string"><span class="hljs-string">'HH'</span></span>), <span class="hljs-string"><span class="hljs-string">'trunc(SYSDATE+1/24,'</span></span><span class="hljs-string"><span class="hljs-string">'HH'</span></span><span class="hljs-string"><span class="hljs-string">')'</span></span>, TRUE, :instno); 4 commit; 5 end; 6 /</code> </pre><br>  And then show the next run time. <br><br><pre> <code class="bash hljs">SQL&gt; select job, next_date, next_sec 2 from user_jobs 3 <span class="hljs-built_in"><span class="hljs-built_in">where</span></span> job = :jobno;</code> </pre> <br><h4>  More considerations </h4><br>  For deeper statistics, you need to change the snapshot level to 7 instead of the default level 5. <br><br><pre> <code class="bash hljs">SQL&gt; <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> statspack.snap(i_snap_level =&gt; 7, i_modify_parameter =&gt; <span class="hljs-string"><span class="hljs-string">'true'</span></span>);</code> </pre> <br>  This command will change the binding level to 7 and simultaneously take a snapshot. </div><p>Source: <a href="https://habr.com/ru/post/424235/">https://habr.com/ru/post/424235/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../424223/index.html">Disposable customers. Segmentation for repeat purchases</a></li>
<li><a href="../424227/index.html">Evenly distribute points over a sphere in pytorch and tensorflow</a></li>
<li><a href="../424229/index.html">Kubernetes in production: services</a></li>
<li><a href="../424231/index.html">How to make money on hosters</a></li>
<li><a href="../424233/index.html">Computer taught to determine dementia with an accuracy of 93%</a></li>
<li><a href="../424237/index.html">Charge your brains directly! Rantime, compilers and performance on Joker 2018</a></li>
<li><a href="../424239/index.html">IBM's Autumn Seminars - Containers, Computer Vision, Digital Transformation</a></li>
<li><a href="../424241/index.html">Print your world</a></li>
<li><a href="../424243/index.html">5 easy ways to improve communication with customers</a></li>
<li><a href="../424245/index.html">Write a Telegram client - easy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>