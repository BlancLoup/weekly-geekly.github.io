<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Anonymous port scanning with hping3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For implementation, you need a confident knowledge of TCP / IP and the desire to understand. As a result, we will be able to scan a remote machine to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Anonymous port scanning with hping3</h1><div class="post__text post__text-html js-mediator-article">  For implementation, you need a confident knowledge of TCP / IP and the desire to understand.  As a result, we will be able to scan a remote machine to open ports from another address using the following scheme (picture from the nmap manual): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f1b/c0c/064/f1bc0c0647104cd588d04278b85fecdf.png" alt="image"><br><a name="habracut"></a><br><h5>  Theoretical introduction </h5><br>  As you can <a href="http://ru.wikipedia.org/wiki/IP-%25D0%25BF%25D0%25B0%25D0%25BA%25D0%25B5%25D1%2582">see on Wikipedia</a> , each IP packet being sent is assigned its number (albeit fragmented packets have one number), stored in a special 16-bit field.  When the field overflows, the score starts from zero.  By making 2 measurements of network packet numbers, you can judge the network activity of the monitored computer. <br>  The TCP connection is established according to the ‚Äútriple handshake‚Äù scheme.  The client sends a packet with the SYN flag set to the server, signaling a proposal to create a connection.  If the server manages to create a socket for the connection, it will respond to the client with a package with a counter-proposal SYN and an ACK confirmation request (where, in turn, the client confirms his desire to create a TCP connection with an ACK flag).  If the server refuses to connect, it sends the client a failure in the form of a packet with the RST flag, which the client sadly rejects.  Based on this difference, we will build a scan of open ports on behalf of others. <br><br><h5>  Practice </h5><br>  As the respected <a href="https://habrahabr.ru/users/vanaf/" class="user_link">vanaf noted</a> , the method will work if the scanned and scanning hosts are on the same subnet, or if different scan and fake hosts are to be on the same subnet. <br>  To implement, we will use one of the main tools of a computer security <a href="http://hping.org/">specialist hping3</a> .  The scheme involves 3 cars, conventionally called the attacking, target and fake, on whose behalf we will conduct the scan.  In the role of a front machine, you must choose one that generates the minimum amount of traffic (ideally it does not generate at all).  In order to find out this intimate detail of a dummy machine, we will communicate with it and watch the changes in package numbers.  Ideally, the number of the package for each of our communication with it should increase by one, which means that during this period of time it did not lead any more communications.  To do this, run hping as follows: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>root@Atom:~# hping3 -r 192.168.2.140 <br> HPING 192.168.2.140 (eth0 192.168.2.140): NO FLAGS are set, 40 headers + 0 data bytes <br> len=46 ip=192.168.2.140 ttl=128 id=25378 sport=0 flags=RA seq=0 win=0 rtt=0.2 ms <br> len=46 ip=192.168.2.140 ttl=128 id=+1 sport=0 flags=RA seq=1 win=0 rtt=0.3 ms <br> len=46 ip=192.168.2.140 ttl=128 id=+1 sport=0 flags=RA seq=2 win=0 rtt=0.2 ms <br> len=46 ip=192.168.2.140 ttl=128 id=+1 sport=0 flags=RA seq=3 win=0 rtt=0.2 ms <br> len=46 ip=192.168.2.140 ttl=128 id=+1 sport=0 flags=RA seq=4 win=0 rtt=0.2 ms <br> ^C <br> --- 192.168.2.140 hping statistic --- <br> 5 packets transmitted, 5 packets received, 0% packet loss <br> round-trip min/avg/max = 0.2/0.2/0.3 ms <br></code> <br><br>  The -r switch tells hping3 to show the increment of the package number.  As we see, with each of our communications, it grows by 1, that is, it is free from unnecessary communication.  Put this process on an infinite "ping" to monitor the change in the package id. <br>  Next, we need to send a request to the target machine to establish a TCP connection, and the proposal is composed in a specific way: in the source field of the packet we set the address of the dummy machine, to which the answers will go.  If the specified port on the target machine is closed, then it will send a dummy machine (RST) to the dummy machine, which the dummy machine will ignore.  If the port is open.  then the target machine will send a counter offer to establish a connection (SYN + ACK), to which the dummy machine will be forced to refuse, i.e. the flag packet (RST).  It is here that we find that our previously resting car had said something to someone at the very moment when we sent a proposal to connect on its behalf.  To avoid accidents, the experiment is repeated. <br>  You can send a connection request on behalf of someone else as follows: <br><br> <code>root@Atom:~# hping3 -c 1 -S -a 192.168.2.140 192.168.2.1 -p 5222 <br> HPING 192.168.2.1 (eth0 192.168.2.1): S set, 40 headers + 0 data bytes <br> <br> --- 192.168.2.1 hping statistic --- <br> 1 packets transmitted, 0 packets received, 100% packet loss <br></code> <br>  Where: <i>-c 1</i> means sending only one packet; <br>  <i>-S</i> set the SYN flag <br>  <i>-a 192.168.2.140</i> as the source of the package set the address 192.168.2.140 (the address of the dummy machine in our case) <br>  <i>192.168.2.1</i> address of the target machine <br>  <i>-p 5222</i> target TCP port <br><br>  We did not receive a reply to the package because it was left to the dummy machine, probably to force it to refuse, which we will find. <br>  In case the port is open, we will see the following picture: <br><br> <code>len=46 ip=192.168.2.140 ttl=128 id=+1 sport=0 flags=RA seq=4 win=0 rtt=0.2 ms <br> len=46 ip=192.168.2.140 ttl=128 id=+1 sport=0 flags=RA seq=5 win=0 rtt=0.2 ms <br> len=46 ip=192.168.2.140 ttl=128 id=+2 sport=0 flags=RA seq=6 win=0 rtt=0.2 ms <br> len=46 ip=192.168.2.140 ttl=128 id=+1 sport=0 flags=RA seq=7 win=0 rtt=0.2 ms <br> len=46 ip=192.168.2.140 ttl=128 id=+1 sport=0 flags=RA seq=8 win=0 rtt=0.2 ms</code> <br> <br>  Do you see on the 3rd line that the dummy machine managed to communicate with someone else at that very moment?  Most likely this is a rejection (RST) of the reciprocity offer (SYN + ACK), so the dummy machine didn‚Äôt actually send a SYN.  To be sure, the experiment is repeated. <br>  For convenience, you can use the -i keys for the task of the time interval and -p ++ increasing the port by 1 with each packet. <br><br><h5>  Conclusion </h5><br>  The same method can also be used to ban an unsuspecting bogus machine if an intrusion detection system is on the target. <br>  This is just one of the many impressive applications of hping3.  They can ping when icmp is disabled (it sends a packet via TCP by default to the zero port).  It can also be used to transfer files even through strictly configured firewalls (even though through ping), to work as a traceroute not only on the basis of icmp, but also on UDP and TCP, helps to determine the remote OS, it can be a very specific trojan and much more.  I highly recommend to get to know him better.  He has a good how-to;) <br>  If you like, accept thanks. <br><br>  UPD: <br>  Thanks to <a href="https://habrahabr.ru/users/jcmvbkbc/" class="user_link">jcmvbkbc</a> for the information that a similar trick can be done with nmap: <a href="http://nmap.org/book/idlescan.html">nmap.org/book/idlescan.html</a> </div><p>Source: <a href="https://habr.com/ru/post/106752/">https://habr.com/ru/post/106752/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../106744/index.html">Excellent Java MVC framework - Play Framework</a></li>
<li><a href="../106746/index.html">Laser show controlled via LPT</a></li>
<li><a href="../106747/index.html">RIW 2010: four interviews and quotes</a></li>
<li><a href="../106749/index.html">Chromium 9 and password synchronization</a></li>
<li><a href="../106751/index.html">What was the name of Doctor Watson?</a></li>
<li><a href="../106754/index.html">NASA is going to transfer its computing power to the "cloud"</a></li>
<li><a href="../106755/index.html">Accommodation in St. Petersburg for habracheloveka</a></li>
<li><a href="../106756/index.html">30 kopecks for Mikhalkov</a></li>
<li><a href="../106759/index.html">Payment system in Russian or is it worth to trust your money Z-payment</a></li>
<li><a href="../106762/index.html">Using MEF (Managed Extensibility Framework) for developing Asp.Net WebForms applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>