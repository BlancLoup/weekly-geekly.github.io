<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MVIDroid: review of the new MVI library (Model-View-Intent)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! In this article I want to talk about the new library, which introduces the MVI design pattern in Android. This library is called MVIDroid, writ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MVIDroid: review of the new MVI library (Model-View-Intent)</h1><div class="post__text post__text-html js-mediator-article"><p>  Hello!  In this article I want to talk about the new library, which introduces the MVI design pattern in Android.  This library is called MVIDroid, written 100% in the Kotlin language, lightweight and uses RxJava 2.x.  I am the author of the library personally, its source code is available on GitHub, and you can connect it via JitPack (link to the repository at the end of the article).  This article consists of two parts: a general description of the library and an example of its use. </p><a name="habracut"></a><br><h2 id="mvi">  MVI </h2><br><p>  And so, as a preface, let me remind you what MVI is.  Model - View - Intent or, if in Russian, Model - View - Intention.  This is a design pattern in which the Model is the active component, which takes Inputs and Inputs the State.  View (View), in turn, takes View Models (View Model) and produces those very Intentions.  The state is transformed into a View Model using a transformer function (View Model Mapper).  Schematically, the MVI pattern can be represented as follows: </p><br><p><img src="https://habrastorage.org/webt/w_/6v/ji/w_6vjijlycjkq6rsgxw4kfaypo8.png" alt="MVI"></p><br><p>  The MVIDroid View does not produce Intentions directly.  Instead, it produces View Events (UI Events), which are then converted into Intentions using a transformer function. </p><br><p><img src="https://habrastorage.org/webt/yp/jd/lo/ypjdlog31trwmbtph67bs8mxfbg.png" alt="View"></p><br><h2 id="osnovnye-komponenty-mvidroid">  Main components of MVIDroid </h2><br><h3 id="model">  Model </h3><br><p>  Let's start with the model.  In the library, the concept of Model is slightly expanded; here it produces not only States but also Labels.  Tags are used to communicate the models between themselves.  The labels of some Models can be transformed into the Intentions of other Models with the help of transforming functions.  Schematically, the Model can be represented as follows: </p><br><p><img src="https://habrastorage.org/webt/fa/3q/j_/fa3qj_inzs_yxk6i7iuy7q_7hdg.png" alt="Model"></p><br><p>  In MVIDroid, the Model is represented by the MviStore interface (the name Store is borrowed from Redux): </p><br><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MviStore</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">State : Any, in Intent : Any, Label : Any</span></span></span><span class="hljs-class">&gt; : </span><span class="hljs-type"></span></span><span class="hljs-class"><span class="hljs-type"></span></span>(Intent) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>, Disposable { <span class="hljs-meta"><span class="hljs-meta">@get:MainThread</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> state: State <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> states: Observable&lt;State&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> labels: Observable&lt;Label&gt; <span class="hljs-meta"><span class="hljs-meta">@MainThread</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(intent: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Intent</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-meta"><span class="hljs-meta">@MainThread</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-meta"><span class="hljs-meta">@MainThread</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isDisposed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> }</code> </pre> <br><p>  And so what we have: </p><br><ul><li>  The interface has three Generic parameters: State - the State type, Intent - the Intent type and Label - the Labels type. </li><li>  It contains three fields: state - the current state of the Model, states - Observable States and labels - Observable Labels.  The last two fields provide an opportunity to subscribe to changes in State and Tags, respectively. </li><li>  Consumer (Consumer) Intentions </li><li>  It is Disposable, which makes it possible to destroy the Model and stop all processes occurring in it. </li></ul><br><p>  Note that all Model methods must be run on the main thread.  The same is true for any other component.  You can perform background tasks, of course, using standard RxJava tools. </p><br><h3 id="komponent">  Component </h3><br><p>  A component in MVIDroid is a group of Models united by a common goal.  For example, you can select in the Component all Models for any screen.  In other words, the Component is a facade for the Models enclosed in it and allows to hide implementation details (Models, transforming functions and their links).  Let's look at the Component scheme: </p><br><p><img src="https://habrastorage.org/webt/9y/ob/zn/9yobznchrofvrcepe8nqylgc4iq.png" alt="Component"></p><br><p>  As can be seen from the diagram, the component performs the important function of transforming and forwarding events. </p><br><p>  The full list of Component functions is as follows: </p><br><ul><li>  Associates the incoming View Events and Tags with each Model using the provided transforming functions. </li><li>  Displays outgoing Model Tags outside </li><li>  Destroys all Models and breaks all ties when Component is destroyed. </li></ul><br><p>  The component also has its own interface: </p><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MviComponent</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">in UiEvent : Any, out States : Any</span></span></span><span class="hljs-class">&gt; : </span><span class="hljs-type"></span></span><span class="hljs-class"><span class="hljs-type"></span></span>(UiEvent) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>, Disposable { <span class="hljs-meta"><span class="hljs-meta">@get:MainThread</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> states: States <span class="hljs-meta"><span class="hljs-meta">@MainThread</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">UiEvent</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-meta"><span class="hljs-meta">@MainThread</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-meta"><span class="hljs-meta">@MainThread</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isDisposed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> }</code> </pre> <br><p>  Consider the component interface in more detail: </p><br><ul><li>  Contains two Generic parameters: UiEvent - the Type of Events for the View and States - the type of the States of the Models </li><li>  Contains the states field giving access to the Model States group (for example, as an interface or data class) </li><li>  Consumer (Consumer) Event Viewer </li><li>  Is Disposable, which makes it possible to destroy the Component and all its Models. </li></ul><br><h3 id="predstavlenie-view">  View </h3><br><p>  As you can guess, the view is needed to display data.  The data for each View is grouped into a View Model and is usually represented as a data class (Kotlin).  Consider the Presentation interface: </p><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MviView</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ViewModel : Any, UiEvent : Any</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> uiEvents: Observable&lt;UiEvent&gt; <span class="hljs-meta"><span class="hljs-meta">@MainThread</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subscribe</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(models: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Observable</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ViewModel</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span>: Disposable }</code> </pre> <br><p>  Here everything is somewhat simpler.  Two Generic parameters: ViewModel is the Type of the View Model and UiEvent is the Type of the View Events.  One uiEvents field is Observable Event View, enabling clients to subscribe to these same events.  And one method of subscribe (), giving the opportunity to subscribe to the View Model. </p><br><h2 id="primer-ispolzovaniya">  Usage example </h2><br><p>  Now is the time to try something in practice.  I propose to do something very simple.  Something that does not require much effort to understand, and at the same time will give an idea of ‚Äã‚Äãhow to use all this and in which direction to move on.  Let it be a UUID generator: by pressing a button we will generate a UUID and display it on the screen. </p><br><h3 id="predstavlenie">  Representation </h3><br><p>  To begin with we will describe Model of Representation </p><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewModel</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> text: String)</code> </pre> <br><p>  And Presentation Events: </p><br><pre> <code class="hljs scala"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UiEvent</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnGenerateClick</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">UiEvent</span></span>() }</code> </pre> <br><p>  Now we are implementing the View itself; for this we need inheritance from the abstract class MviAbstractView: </p><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">View</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">activity</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Activity</span></span></span><span class="hljs-class">) : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MviAbstractView</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ViewModel</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UiEvent</span></span></span><span class="hljs-class">&gt;() { private val textView = activity.findViewById&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TextView</span></span></span><span class="hljs-class">&gt;(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">R</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">text</span></span></span><span class="hljs-class">) init { activity.findViewById&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Button</span></span></span><span class="hljs-class">&gt;(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">R</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">button</span></span></span><span class="hljs-class">).setOnClickListener { dispatch(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UiEvent</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OnGenerateClick</span></span></span><span class="hljs-class">) } } override fun subscribe(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">models</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Observable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ViewModel</span></span></span><span class="hljs-class">&gt;): </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Disposable</span></span></span><span class="hljs-class"> = models.map(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ViewModel</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">text</span></span></span><span class="hljs-class">).distinctUntilChanged().subscribe { textView.text = it } }</span></span></code> </pre> <br><p>  Everything is very simple: we subscribe to changes in UUID and update TextView when we receive a new UUID, and on pressing the button we send the OnGenerateClick event. </p><br><h3 id="model-1">  Model </h3><br><p>  The model will consist of two parts: the interface and the implementation. </p><br><p>  Interface: </p><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UuidStore</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MviStore</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">State, Intent, Nothing</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">State</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> uuid: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Intent</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> Generate : Intent() } }</code> </pre> <br><p>  Everything is simple here: our interface extends the MviStore interface, indicating the types of State (State) and Intentions (Intent).  Type of Labels - Nothing, since our Model does not produce them.  The interface also contains classes of states and intentions. </p><br><p>  In order to implement the Model, you need to understand how it works.  Inputs to the Model are Intentions (Intent), which are converted into Actions (Action) using the special function IntentToAction.  Actions come to the input to the Executor, which executes them and produces Results (Result) and Labels.  The results are then transferred to a Reducer, which converts the current State to a new one. </p><br><p>  All four make models: </p><br><ul><li>  IntentToAction - a function that converts Intentions into Actions </li><li>  MviExecutor - executes Actions and produces Results and Labels </li><li>  MviReducer - converts pairs (State, Result) into new States </li><li>  MviBootstrapper is a special component that allows you to initialize the Model.  Gives all the same Actions that also go to the Executor.  You can perform a one-time Action, or you can subscribe to a data source and perform Actions on certain events.  Bootstrapper starts automatically when creating a Model. </li></ul><br><p>  To create the Model itself, it is necessary to use a special Factory of Models.  It is represented by the MviStoreFactory interface and its implementation of MviDefaultStoreFactory.  The factory takes the constituent Models and delivers a ready-to-use Model. </p><br><p>  The factory of our Model will look as follows: </p><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UuidStoreFactory</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> factory: MviStoreFactory) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(factory: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">MviStoreFactory</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: UuidStore = <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : UuidStore, MviStore&lt;State, Intent, <span class="hljs-built_in"><span class="hljs-built_in">Nothing</span></span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> factory.create( initialState = State(), bootstrapper = Bootstrapper, intentToAction = { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (it) { Intent.Generate -&gt; Action.Generate } }, executor = Executor(), reducer = Reducer ) { } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> Generate : Action() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Result</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Uuid</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> uuid: String) : Result() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> Bootstrapper : MviBootstrapper&lt;Action&gt; { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bootstrap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dispatch: (</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Action</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>): Disposable? { dispatch(Action.Generate) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Executor</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MviExecutor</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">State, Action, Result, Nothing</span></span></span><span class="hljs-class">&gt;</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Action</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Disposable? { dispatch(Result.Uuid(UUID.randomUUID().toString())) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> Reducer : MviReducer&lt;State, Result&gt; { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> State.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reduce</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(result: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Result</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: State = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (result) { <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Result.Uuid -&gt; copy(uuid = result.uuid) } } }</code> </pre> <br><p>  This example shows all four components of the Model.  First, create a factory method, then Actions and Results, followed by the Artist and at the very end of the Reducer. </p><br><h3 id="komponent-1">  Component </h3><br><p>  The states of the Component (the States group) are described by the data class: </p><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> class </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">States</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">uuidStates</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Observable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UuidStore</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">State</span></span></span><span class="hljs-class">&gt;)</span></span></code> </pre> <br><p>  When adding new Models to the Component, their States should also be added to the group. </p><br><p>  And, actually, the implementation itself: </p><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span></span>(uuidStore: UuidStore) : MviAbstractComponent&lt;UiEvent, States&gt;( stores = listOf( MviStoreBundle( store = uuidStore, uiEventTransformer = UuidStoreUiEventTransformer ) ) ) { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> states: States = States(uuidStore.states) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> UuidStoreUiEventTransformer : (UiEvent) -&gt; UuidStore.Intent? { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">UiEvent</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: UuidStore.Intent? = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (event) { UiEvent.OnGenerateClick -&gt; UuidStore.Intent.Generate } } }</code> </pre> <br><p>  We inherited the abstract class MviAbstractComponent, specified the States and Event types of the View, passed our Model to the super class, and implemented the states field.  In addition, we have created a transforming function that will convert the Events of the View into the Intentions of our Model. </p><br><h3 id="mapping-modeli-predstavleniya">  Mapping Models Representations </h3><br><p>  We have a State and Model of Presentation, it is time to convert one into the other.  To do this, we implement the MviViewModelMapper interface: </p><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">object</span></span> ViewModelMapper : MviViewModelMapper&lt;States, ViewModel&gt; { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">map</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(states: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">States</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Observable&lt;ViewModel&gt; = states.uuidStates.map { ViewModel(text = it.uuid ?: <span class="hljs-string"><span class="hljs-string">"None"</span></span>) } }</code> </pre> <br><h3 id="svyaz-binding">  Communication (Binding) </h3><br><p>  The availability of the Component and View alone is not enough.  For everything to start working, they need to be connected.  It's time to create an Activity: </p><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UuidActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppCompatActivity</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState) setContentView(R.layout.activity_uuid) bind( Component(UuidStoreFactory(MviDefaultStoreFactory).create()), View(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) using ViewModelMapper ) } }</code> </pre> <br><p>  We used the bind () method, which accepts a Component and an array of Views with mappers of their Models.  This method is an extension method over LifecycleOwner (which is Activity and Fragment) and uses DefaultLifecycleObserver from the Arch package, which requires Java 8 source compatibility.  If for any reason you cannot use Java 8, then the second bind () method is suitable for you, which is not an extension method and returns MviLifecyleObserver.  In this case, you have to call the life cycle methods yourself. </p><br><h2 id="ssylki">  Links </h2><br><p>  The source code of the library, as well as detailed instructions for connecting and using it, can be found on <a href="https://github.com/arkivanov/MVIDroid">GitHub</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/417763/">https://habr.com/ru/post/417763/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../417753/index.html">Compression of large arrays of prime numbers</a></li>
<li><a href="../417755/index.html">Study: 80% of ICO 2017 found to be fraudulent</a></li>
<li><a href="../417757/index.html">Creating a bot to participate in the AI ‚Äã‚Äãmini cup. GPU Experience</a></li>
<li><a href="../417759/index.html">Be my rubber duck</a></li>
<li><a href="../417761/index.html">GitLab moves from Azure to the Google Cloud Platform. Moving news and maintenance dates</a></li>
<li><a href="../417767/index.html">Text analysis using convolutional neural networks</a></li>
<li><a href="../417769/index.html">User Memory Design: How to Design Ages</a></li>
<li><a href="../417771/index.html">ICANN plan: the corporation proposed a new model for managing root DNS servers</a></li>
<li><a href="../417773/index.html">Homemade OpenPnP Component Installer</a></li>
<li><a href="../417775/index.html">The mechanism of commissions in Bitcoin and why be friends with miners</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>