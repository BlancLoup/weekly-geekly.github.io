<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Web application - well, almost without a back-end: Flask, Redis, API via JSONP, JSFiddle.net</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is the so-called ‚Äúproof-of-concept‚Äù of creating a front-end application that works with the API via JSONP, that is, as they say, ‚Äúcross-o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Web application - well, almost without a back-end: Flask, Redis, API via JSONP, JSFiddle.net</h1><div class="post__text post__text-html js-mediator-article">  This article is the so-called ‚Äúproof-of-concept‚Äù of creating a front-end application that works with the API via JSONP, that is, as they say, ‚Äúcross-origin‚Äù.  Also described is the organization of data in Redis. <br><br>  For example, you can easily place on <a href="http://jsfiddle.net/">jsfiddle.net a</a> certain application, the back-end of which will be located on another domain. <br><br>  Agree that a full-fledged working end product (requiring the presence of a server for centralizing data exchange) that is inside JSFiddle looks funny! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/646/520/169/6465201691bd4249a894a93d9ff097f6.png"><br><br>  The purpose of the article is to share its current experience from two sides: <br><ul><li>  JSONP + Long Polling Implementation </li><li>  Working with wonderful redis </li></ul><br><br>  Something like doing guys from <a href="https://backendless.com/">BackendLess</a> . <br><a name="habracut"></a><br><br><h4>  What do we have </h4><br>  So, we have: <br><ul><li>  Some kind of own server with Python 2.x on board </li><li>  Browser and access to <a href="http://jsfiddle.net/">JSFiddle.net</a> </li><li>  The desire to build an API-over-JSONP </li></ul><br><br><h4>  What i used </h4><br><br><h5>  Jsonp </h5><br>  I think the reader does not need an explanation of what it is.  And about the implementation - everything is done by one decorator: <br><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jsonp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fn)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> callback = request.args.get(<span class="hljs-string"><span class="hljs-string">'callback'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> callback: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> BadRequest(<span class="hljs-string"><span class="hljs-string">'Missing callback argument.'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'{callback}({data});'</span></span>.format( callback=callback, data=dumps(fn(*args, **kwargs)) ) wrapper.__name__ = fn.__name__ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> wrapper</code> </pre> <br><br><h5>  Redis </h5><br>  There is such a wonderful thing - Redis.  As the developers say about it, <br><blockquote>  BSD licensed, advanced key-value cache and store.  It can often be the strings, hashes, lists, sets, sorted sets, bitmaps and hyperloglogs. </blockquote><br>  Or in a nutshell: <br><blockquote>  Redis is a powerful system for storing and caching data in a key-value format. </blockquote><br><br><h5>  A little about Redis </h5><br>  <i>If you are not familiar with Redis, I advise you to read about it at the office.</i>  <i>site, because not all the details of working with it will be described below.</i> <br>  Actually, Redis itself works as a separate daemon, and from the Python script we access it through a fairly simple module connector of the same name. <br>  We can create a key and assign it to: <br><ul><li>  Scalar value (actually a <i>string</i> ) </li><li>  List </li><li>  Array </li><li>  Lots of </li><li>  Set up </li></ul><br>  But!  We cannot make an array of arrays, for example.  Therefore, in this case, you will have to make a key with a list of indexes and a key for each index.  Also, due to the lack of sampling by values ‚Äã‚Äã(a la WHERE in SQL), sometimes you have to make lists with reverse mapping, for example, to search for a user ID by nickname and to search for a user nickname by its ID. <br>  <b>Roughly speaking:</b> what is a table in SQL will be a <b>list of indices</b> and a <b>set of arrays</b> in Redis.  It is also customary to separate parts of the key with a colon. <br><br>  <b>Example in SQL:</b> 1 table - with fields user_id, user_name, user_email and 5 records. <br>  <b>The analogy in Redis:</b> 1 list and 5 arrays - a list of <b>users</b> with data [1, 2, 3, 4, 5] and 5 arrays with names (keys) of the form <b>user: X</b> with data {id: X, name: Y, email: Z}, as well as several arrays with a reverse link, for example, nicknames with values ‚Äã‚Äã{andrew: 1, john: 2, mike: 3, ...} <br><br><h5>  Why redis? </h5><br><ul><li>  In Redis, you do not need to specify data structures: just put them there. </li><li>  We can do <b>CRUD</b> ( <i>Create-Read-Update-Delete</i> ) with data located in the Redis base, and also use the built-in locking mechanism - by the way, it greatly simplifies the implementation of the <b>long polling</b> mechanism. </li><li>  No JOIN or WHERE Redis is not able, and should not - it only stores primitives, maximum lists or associative arrays from primitives.  But this is not a minus, but an additional discretion and incentive for expanding thinking, different from the SQL and NoSQL-DBMS patterns. </li></ul><br><br><h5>  The structure of the key-value storage system <s>database</s> </h5><br>  Here is the data in our Redis at the moment when Andrew wrote the message and John wrote the message, but the first was read by everyone except the shirt, and the second - only by John himself.  But for a few moments, all <b>user: X: messages will be</b> cleared, because  A poling timeout will occur and the data will go to the clients.  Those.  <b>user: X: messages</b> - this is such a container for the not yet received messages of a certain user. <br><img src="https://habrastorage.org/files/3b6/17a/1d3/3b617a1d3fed4577b66ff42787941f61.png"><br><br><h4>  Long polling </h4><br>  With Redis you can easily implement <b>long polling</b> .  The approximate algorithm is as follows: <br><ul><li>  We request in Redis (with the <a href="http://redis.io/commands/LLEN">LLEN</a> command) whether there is a message for the client right now in the list of messages, if there is, return messages and clean the list with <a href="http://redis.io/commands/DEL">DEL</a> </li><li>  If there are no messages, we request them again, but this time by the BLPOP <a href="http://redis.io/commands/BLPOP">team</a> , which will block the active stream until the data appears or the timeout expires.  By unlocking, we return the result from Redis to the client, in which there will be either a message just received, or nothing. </li></ul><br><br><h4>  "Fighting team, go ahead!" </h4><br>  Front end for testing: <a href="http://jsfiddle.net/andunai/kcdtzdww/">jsfiddle.net/andunai/kcdtzdww</a> <br>  <a href="https://bitbucket.org/AndrewDunai/nobackend-chat-dirty">Back</a> -end source code: <a href="https://bitbucket.org/AndrewDunai/nobackend-chat-dirty">bitbucket.org/AndrewDunai/nobackend-chat-dirty</a> <br>  Fullscreen version: <a href="http://jsfiddle.net/andunai/kcdtzdww/embedded/result/">jsfiddle.net/andunai/kcdtzdww/embedded/result</a> <br><br><h4>  Post Scriptum </h4><br><br>  I am very pleased that you have read this far.  I, as always, welcome any comments and suggestions. <br>  I hope, habraeffekt not much touches my little VPS. <br>  Thanks for attention! <br><br>  <b>UPDATE: the repository is now public, accidentally made it private when created.</b> </div><p>Source: <a href="https://habr.com/ru/post/240787/">https://habr.com/ru/post/240787/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../240775/index.html">Working with a COM port in a web project</a></li>
<li><a href="../240779/index.html">Create your own dojo widgets</a></li>
<li><a href="../240781/index.html">KodiCMS architecture</a></li>
<li><a href="../240783/index.html">Finger Trees (Part 1. Introduction)</a></li>
<li><a href="../240785/index.html">Simple Rest Api framework based on Phalcon</a></li>
<li><a href="../240789/index.html">CleverStyle CMS module architecture</a></li>
<li><a href="../240791/index.html">Russian translation Apple iPhone Developer Program License Agreement + Schedule 2 v19</a></li>
<li><a href="../240793/index.html">Multiboot, UEFI, NTFS or almost a recipe for happiness</a></li>
<li><a href="../240795/index.html">Evaluation of the competitiveness of search queries for variations in search results</a></li>
<li><a href="../240799/index.html">The story of one bug in the machine for video poker</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>