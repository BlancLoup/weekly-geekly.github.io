<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Raise our Vertcoin P2Pool * node with merged thru and flops</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I woke up in the morning, compared the statistics of accruals of honestly inked coins in the pool office with those of a calculator, and finally convi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Raise our Vertcoin P2Pool * node with merged thru and flops</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/a21/497/9a8/a214979a8bcafae7240cc4e0b425e84e.jpg" align="right"><br><br>  I woke up in the morning, compared the statistics of accruals of honestly inked coins in the pool office with those of a calculator, and finally convinced that the pool is undercharging? <br>  Tired of not paying commissions? <br>  Or decided to support the decentralization of the network and leave a large pool? <br>  Or maybe he just wanted to ‚Äúraise‚Äù something of his own? <br><br>  No matter what the reason, the other is important - there is a caustic, blinding desire to change something in my head, and to stop mining ‚Äúthrough my uncle‚Äù. <br>  And between her and you there is one simple, but at the same time very reasonable question - ‚ÄúHow?‚Äù. <br>  The answer is the same simple - "Easy!". 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><h2>  What is so good about P2Pool and how is it eaten? </h2><br>  First of all, it‚Äôs open source, with all the transparency that comes from it.  In any case, you can always independently check the points of interest. <br>  Secondly, mining on p2pule is equivalent to mining mining from a financial point of view, of course, for a certain period of time. <br>  Thirdly, it contributes to the decentralization of the network. <br>  And if in the first paragraph there are no questions, then the last two require a basic understanding of what n2pool is. <br><br>  Speaking very roughly and briefly, this is a set of nodes (nodes) working in a coordinated and at the same time independent.  At each node, the admin has the right to set his own parameters, both commissions and block generation, which will be valid only for miners on this node.  At the same time, the block found on one node is distributed to all participants of the pool, in proportion to their contribution to the common cause.  All this is fixed and accounted for through its own balls of reduced complexity and the blockchain p2pula (sharechain).  Such a <s>military-political</s> alliance of independent nodes acting as a united front.  About P2Pool, <a href="https://en.bitcoin.it/wiki/P2Pool">gently and in detail</a> . <br><br>  Let's return to our points.  When the commission is zero (the node is our own, why should we set commissions to ourselves, and then receive them ourselves?) We get the number of coins from the block that was generated by the genereted transaction directly proportional to our contribution.  Moreover, in addition to the base value of the coins in the block, the commissions included in the block are also distributed.  Everything is like with solo mining, only in smaller quantities, but much more often. <br><br>  Speaking of the cornerstone of decentralization, about which, by the way, such liners as <a href="http://www.cryptocoinsnews.com/news/bitcoin-mining-pool-ghash-io-ddos-ed-response-51-attack/2014/06/15">Bitcoin</a> and <a href="http://www.cryptocoinsnews.com/news/warning-litecoin-miners-need-leave-coinotron/2014/05/20">Litecoin</a> and ‚Äúattack 51 percent‚Äù have already struck the bottoms, when one pool can alone decide which transactions to process and which not, it can be expressed in a fairly wide range - starting from panicky hysterical, and ending pofigistically neutral.  But the fact that this is ‚Äúnot good‚Äù is clear to everyone.  And let it be without excesses so far and large pools advocate preventing a ‚Äú51 percent attack‚Äù, there is cause for alarm - Uncle Adya also talked a lot and believed him, too, until it was too late.  If, however, P2Pool takes 51% of the network hashrate, or even 70% doesn‚Äôt make a difference, it doesn‚Äôt significantly affect the selectivity of transaction processing - do not forget that P2Pool consists of independent nodes, each of which sets the rules for itself only and criteria for transactions to be processed. <br><br>  In this example, you will use a server with Debian 7 installed on it, and Vertcoin cryptocurrency ( <a href="https://vertcoin.org/">site</a> , <a href="https://bitcointalk.org/index.php%3Ftopic%3D404364.0">forum</a> , <a href="http://www.reddit.com/r/vertcoin/">reddit</a> ).  Why choose vertcoin?  By the fact that this fork not only took the best from its predecessors, Bitcoin and Lightcoin, but also added a lot of its own - Stealth Payments, protection from specialized mining equipment, i.e.  ASICs, due to the algorithm changing over time (or, to be precise, the parameter of the hash function changes), <s>and also the helicopter will increase in price many, many, many times, and all current miners will become millionaires</s> .  In other matters, enough about the helicopter - the article is not about him, and everything written has a place to be for the vast majority of the rest of the cryptocurrencies, of course with some peculiarities and corresponding adaptation of actions to specifically taken cryptocurrency and the OS. <br><br><br><h2>  Laying the foundation: binaries and scripts </h2><br>  And so, we proceed. <br>  The first step is to update the existing software. <br><pre><code class="bash hljs">apt-get update apt-get dist-upgrade</code> </pre> <br>  Further, there are two options: <a href="https://github.com/vertcoin/vertcoin/releases">download a</a> ready-made executable file of the wallet, or compile it yourself on the server.  If we decide to download a ready-made binary, you can immediately move on to the next item.  Below will be considered the second option, as more general and universal. <br>  We upload the necessary packages to the server to build the binary and <i>git</i> (the current list can always be found <a href="">in the documentation</a> ): <br><pre> <code class="bash hljs">apt-get install build-essential libssl-dev libdb-dev libdb++-dev libboost-dev libminiupnpc-dev libboost-all-dev apt-get install git</code> </pre><br>  Merge the source from the githaba repository and collect the binary in the maximum "configuration" and security: <br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/vertcoin/vertcoin <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/vertcoin/src make -f makefile.unix USE_UPNP=1 USE_IPV6=1 -e PIE=1</code> </pre><br>  More information about the parameters can be found there on the documentation page. <br>  If the server has a multi-core processor (which is recommended at the extreme), you can also add the <i>-jN</i> parameter, where <i>N</i> is the number of cores.  This will allow to collect in the specified number of threads and significantly reduce the compilation time.  For example, for a dual-core system, the line will look like this: <br><pre> <code class="bash hljs">make -j2 -f makefile.unix USE_UPNP=1 USE_IPV6=1 -e PIE=1</code> </pre><br>  If everything went well, then we get a <i>vertcoind</i> binary at the output. <br><br>  Now let's do the p2pool script, copy and install it: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~ apt-get install python-zope.interface python-twisted python-twisted-web git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/donSchoe/p2pool-n <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/p2pool-n/py_modules/vertcoin_scrypt python setup.py install</code> </pre><br>  Now you can create a configuration file for the wallet and enter the necessary data into it <br><pre> <code class="bash hljs">nano ~/.vertcoin/vertcoin.conf</code> </pre><br><pre> <code class="bash hljs">server=1 gen=0 rpcport=5899 rpcallowip=127.0.0.1 rpcuser=user rpcpassword=password</code> </pre><br>  After that, launch the wallet client in one window and the p2pool script in another <br><pre> <code class="bash hljs">~/vertcoin/src/vertcoind --server</code> </pre><br><pre> <code class="bash hljs">python ~/p2pool-n/run_p2pool.py --net vertcoin</code> </pre><br>  And in principle, at the very least, the node will begin to work, you can target your farm on it, and start promoting your creation on all resources.  But we will <s>not</s> do this <s>for the time being</s> for one simple reason - ‚ÄúWhere are the promised flops?‚Äù. <br><br><h2>  We create for our purposes an individual user. </h2><br>  A thing at least logical in principle, but far from obvious, at least for a person who hasn‚Äôt been very concerned with server administration before.  Create a home directory for a new user, and transfer previously obtained components to the ‚Äúcorrect‚Äù places. <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /home mkdir vtc mv /root/vertcoin/src/vertcoind /usr/bin/ mv /root/p2pool-n /home/vtc/</code> </pre><br>  To add a new user to the system, I used the <i>adduser</i> command.  First, we will create a new group for the user (in the example, its name is <i>vtc</i> ), then we will create a new user (we will not be fancy with imagination, and we will call the user also - <i>vtc</i> ) and add it to this group.  The full list of commands can be viewed by running the <i>adduser</i> utility with the <i>--help</i> parameter. <br><pre> <code class="bash hljs">addgroup --gid 1000 vtc adduser --home /home/vtc --shell /bin/<span class="hljs-literal"><span class="hljs-literal">false</span></span> --no-create-home --uid 1000 --gid 1000 vtc adduser vtc vtc</code> </pre><br>  I will add a few comments on the above, in the following lines: <br><ol><li>  Create a group with the name <i>vtc</i> and identifier 1000. </li><li>  We already create a user with the name <i>vtc</i> , identifier 1000, specify the path to its home directory and the fact that we do not need to create it (we created it a step earlier), as well as we indicate which program will respond to the shell access when trying to SSH connection under this by user.  As a program, a simple binary is chosen, which in any case returns a logical ‚Äúlie‚Äù - in other words, it will not work to connect via SSH under this account.  Made it for security purposes.  Among the questions asked in the process of adding a user, only the password is worth answering.  The rest can be clicked enter. </li><li>  Add a user with the name <i>vtc</i> to the group called <i>vtc</i> . </li></ol><br>  You can check the correctness of the performed manipulations by looking at the contents of the <i>passwd</i> and <i>group</i> system files, which are located in the <i>/ etc</i> folder.  This is done by the following commands through the standard <i>nano</i> editor (or any other): <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /etc nano passwd ... nano group</code> </pre><br>  You can also make cosmetic edits, for example, change the access program via SSH, or delete annoying commas in the user description (which, in theory, should share the first name / surname / company name / etc, if this information was entered). <br>  At the end we indicate the owner of our directory <i>/ home / vtc</i> - it is obvious that they will be our new <i>vtc</i> user.  The <i>-R</i> flag indicates that this is also the case for all subdirectories and files. <br><pre> <code class="bash hljs">chown -R vtc:vtc /home/vtc/</code> </pre><br>  Also, installing a client on an FTP server, for example, <i><a href="https://security.appspot.com/vsftpd.html">vsFTPd</a></i> (easily put in a package via <i>apt-get</i> , is a bit tacky, but pretty good in terms of security - and when it comes to cryptocurrency, security is never excessive), you can connect to the server under the user <i>vtc</i> . <br><br>  Now you can proceed to setting up a helicopter client.  Create a hidden <i>.vertcoin</i> directory and in it a <i>vertcoin.conf</i> configuration <i>file</i> with the following parameters: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /home/vtc mkdir .vertcoin nano .vertcoin/vertcoin.conf</code> </pre><br><pre> <code class="bash hljs">server=1 gen=0 rpcport=5899 rpcallowip=127.0.0.1 rpcuser=vertcoin rpcpassword=vtcRPCpass mintxfee=0.0005 minrelaytxfee=0.0005</code> </pre><br><ul><li>  <i>server</i> - indicates that this node will be "server".  We understand something like that on an intuitive level. </li><li>  <i>gen</i> - disables automatic mining of coins on the processor, due to its extreme inefficiency. </li><li>  <i>rpcport / allowip / user / password</i> - sets the values ‚Äã‚Äãfor communication and receiving / sending commands to the wallet.  Changing the first two parameters is not recommended.  Set the name / password at its discretion, the latter - the longer and nontrivial, the better.  Recommended length - from 20 characters. </li><li>  The last two parameters are related to commissions - the minimum value of commissions from the transaction, which is necessary for its inclusion in the block generated by the node and the minimum value at which the node will transmit information about the commission further along the network.  We want to earn more - we increase the value.  We want to support the network - set zero. </li></ul><br>  Save and close the editor.  After that, we change the permissions of the created file to ‚Äúread-only for the owner‚Äù (if you are paranoid, this does not mean that no one wants to steal your coins), and again we update the owner of the <i>/ home / vtc directory</i> : <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> .vertcoin chmod 0400 vertcoin.conf chown -R vtc:vtc /home/vtc/</code> </pre><br>  Now log in with our user and run the wallet.  The <i>-s switch</i> indicates which shell to use (remember we specified the <i>false</i> binary as the shell for the user? A simple login under the <i>vtc</i> user <i>will</i> simply end the session) <br><pre> <code class="bash hljs">su -s /bin/bash vtc vertcoind -daemon</code> </pre><br>  In response, should receive a phrase that the server started.  You can <i>get</i> current information with the <i>getinfo</i> command: <br><pre> <code class="bash hljs">vertcoind getinfo ... { <span class="hljs-string"><span class="hljs-string">"version"</span></span> : 80701, <span class="hljs-string"><span class="hljs-string">"protocolversion"</span></span> : 70002, <span class="hljs-string"><span class="hljs-string">"walletversion"</span></span> : 60000, <span class="hljs-string"><span class="hljs-string">"balance"</span></span> : 0.00000000, <span class="hljs-string"><span class="hljs-string">"blocks"</span></span> : 4941, <span class="hljs-string"><span class="hljs-string">"timeoffset"</span></span> : 0, <span class="hljs-string"><span class="hljs-string">"connections"</span></span> : 8, <span class="hljs-string"><span class="hljs-string">"proxy"</span></span> : <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"difficulty"</span></span> : 0.00238789, <span class="hljs-string"><span class="hljs-string">"testnet"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"keypoololdest"</span></span> : 1405374049, <span class="hljs-string"><span class="hljs-string">"keypoolsize"</span></span> : 101, <span class="hljs-string"><span class="hljs-string">"paytxfee"</span></span> : 0.00000000, <span class="hljs-string"><span class="hljs-string">"mininput"</span></span> : 0.00001000, <span class="hljs-string"><span class="hljs-string">"errors"</span></span> : <span class="hljs-string"><span class="hljs-string">""</span></span> }</code> </pre><br>  In principle, most fields do not need a description.  The maximum on which you can stop the attention, it <i>blocks</i> .  Now the client downloads the entire history of transactions from the network, and accordingly, the blocks, which may take more than one hour - at the time of writing this line there were 121578 blocks in the system.  When the client receives the last current block (you can easily look at any block explorer for this currency, or when the constant load on the server's CPU drops), our client will become a full member of the network. <br>  If after a few minutes the number of connections will be zero, this may mean that the client could not find other nodes on his own, at least in a reasonable time.  In this case, you can either just wait for his ‚Äúinsight‚Äù, or manually add active nodes to the configuration file (the list of working nodes is often published in the first message of the coin topic on the forums, along with the rest of the general information) via the <i>addnode</i> command: <br><pre> <code class="bash hljs">addnode=ip_address_or_domain_name</code> </pre><br>  Logging out from under <i>vtc</i> user, leaving the client to quietly do his uneasy business. <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br><br><h2>  Merged mining: introduction </h2><br>  Let's start creating the basis for <a href="https://en.bitcoin.it/wiki/Merged_mining_specification">merged mining</a> .  Speaking briefly, this allows you to parallelly mine several currencies, using when trying to create blocks for two or more currencies, the same data - mine and we get one main currency, and to them a bonus and more.  Of course, you can independently mine merged currencies as the main ones, but from a financial point of view it is unpromising. <br>  Far and not all currencies are possible to mine in this way - there is a main currency and there is a merged currency that can be mine together with the main one.  This ratio is not symmetrical.  Of course, a merged currency never leaves the shadow of its elder brother, therefore the expediency of their future is in question. <br><br>  In this example, the main currency is a helicopter, merged currencies to it are Monocle ( <a href="https://mon.vertcoin.org/">site</a> and <a href="https://bitcointalk.org/index.php%3Ftopic%3D585817.0">forum</a> ) and Parallaxcoin ( <a href="https://bitcointalk.org/index.php%3Ftopic%3D583660.0%3Ball">forum</a> ). <br>  A few words about them: <br><ul><li>  Monocles - a coin from the developers of the helicopter.  Conceived as a testing ground for testing innovations, before introducing them on the vert. </li><li>  Parallaxes - <s>shit</s> fork, which can be parallelly mined simultaneously with several other coins, <s>including other shitty coins</s> .  Recently, I have banished a little more than completely, and is of purely academic value. </li></ul><br>  Also, an example of joint mining is a pair of bitcoin and namecoin (the latter can be mined along with BTC).  Litecoin also has its own merged currency. <br><br>  For each of the coins, I will not describe the above steps for assembling and setting up again, but simply give the procedure: <br><ol><li>  Download source from GitHub - <a href="https://github.com/vertcoin/monocle">monocles</a> / <a href="https://github.com/parallaxcoin/parallaxcoin">parallax</a> . </li><li>  We collect binaries. </li><li>  We transfer them to the ‚Äúright‚Äù place - <i>/ usr / bin /</i> in this case. </li><li>  We create service directories and configuration files for both coins - <i>.monocle &amp; monocle.conf</i> and <i>parallaxcoin &amp; parallaxcoin.conf</i> respectively, all in the same directory <i>/ home / vtc</i> .  Below is an example of the contents of these files.  We set permissions for configuration files and once again update the owner of the contents of the directory <i>/ home / vtc /</i> , for the sake of new files and directories. </li><li>  We go under our user, and run wallets to synchronize with the network. </li></ol><br>  <i>monocle.conf</i> <br><pre> <code class="bash hljs">server=1 gen=0 rpcport=6888 rpcallowip=127.0.0.1 rpcuser=monocle rpcpassword=monRPCpass mintxfee=0.01 minrelaytxfee=0.01</code> </pre><br>  * Commission of 0.01 coins is mandatory and minimally possible for mono glue.  Without it, the transaction simply will not be perceived by the rest of the network. <br>  <i>parallaxcoin.conf</i> <br><pre> <code class="bash hljs">server=1 gen=0 rpcallowip=127.0.0.1 rpcport=7817 rpcuser=parallaxcoin rpcpassword=plxRPCpass mintxfee=0.0005 minrelaytxfee=0.0005</code> </pre><br>  Soon, one more <s>shit</s> fork - <a href="https://bitcointalk.org/index.php%3Ftopic%3D687265.0">Umbrella</a> should start, and to be exact - as many as four: forks of bitcoin and lightcon start today, and vert and dark - on 1 August.  If this does happen, then in addition to the current set of coins for the node, you can add the merged mining of ‚Äúumbrellas‚Äù. <br><br><h2>  Improving the performance of the node </h2><br>  In the peer-to-peer network, which formally is any cryptocurrency, there are no main and any regulators as such.  According to this ‚Äúright‚Äù there will be one who shouts about his ‚Äúrightness‚Äù ‚Äúearlier‚Äù and ‚Äúlouder‚Äù.  Yes, yes, we are talking about precisely those cases when two nodes find the same block at the same time - who earlier and faster managed to inform everyone of this, he won.  The loser is left with nothing (and to be completely correct, with <a href="https://en.bitcoin.it/wiki/Block_chain">orphan</a> ).  Such a battle for the time where every millisecond in the account.  Therefore, we will teach our site to report its own successes quickly and to the maximum number of other nodes, thereby increasing the weight of our node in the network. <br><br><h4>  "Speed" </h4><br>  one).  One of the criteria that affects the speed of assembly and further transfer of the unit over the network is its size.  The standard maximum block size that a node can generate is 250000 bytes.  In order to speed up the above processes, we will reduce its size by half.  In theory, this of course can lower our profits, due to not including more transactions in the block (and therefore commissions for them), but personally my opinion is that the gain from the increase in speed will be greater.  This is done by adding the following line to the client configuration file of all our three coins (the one that is <i>* .conf</i> ) <br><pre> <code class="bash hljs">blockmaxsize=125000</code> </pre><br>  2).  Another important parameter affecting speed is the distribution of processes between the cores.  This will be discussed below in part about setting up daemons. <br><br><h4>  "Volume" </h4><br>  one).  We will increase the maximum number of possible connections for our client, thereby allowing him to report on the found blocks to a greater number of other nodes.  To do this, we supplement the configuration files of our clients with the line: <br><pre> <code class="bash hljs">maxconnections=500</code> </pre><br>  2).  Removing firewall restrictions ( <i>iptables</i> is often used).  I‚Äôll say right away that on Debian OS under OpenVZ this feature is missing for one simple reason - there are no limitations in principle, at least according to the statement of my host <s>and some people on the forums</s> .  Therefore, this part will be somewhat abstract, without clear instructions on what and how to do. <br>  We need to set the following rules for the firewall: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  8     /24 -A INPUT -p tcp --syn --dport PORT -m connlimit --connlimit-above 8 --connlimit-mask 24 -j REJECT --reject-with tcp-reset #      IP -A INPUT -p tcp --syn --dport PORT -m connlimit --connlimit-above 2 -j REJECT --reject-with tcp-reset #  TCP        -A INPUT -m state --state NEW -m tcp -p tcp --dport PORT -j ACCEPT</span></span></code> </pre><br>  These rules should be set for all ports through which our node will work - both for ports that are used by cryptocurrency clients and the p2pool script.  See who is listening to what port through the command <br><pre> <code class="bash hljs">netstat -tunap</code> </pre><br>  These rules should automatically be loaded and unloaded when the system starts / shuts down.  This is done in two ways - incorrect (through manual loading of the rules, for which ‚Äúanother sysadmin who came to your place will be a very long time for you‚Äù (c)) and correct (through the <i>iptables-persistent</i> daemon).  Normal how-to can be viewed <a href="http://webhamster.ru/mytetrashare/index/mtb0/1393570578sq33dpfahy">here</a> . <br>  Add: in order to increase these limits, the connlimit module must be included in the kernel.  If this module is not included, there are no restrictions, and therefore the problem itself.  by <a href="https://forum.btcsec.com/index.php%3F/user/9309-poiuty/">poiuty</a> <br><br><h2>  Configuring Daemons </h2><br>  Let us proceed to the key point of all our research - the correct startup of clients and the p2pool script with merged mining at the start of the system.  This will be done in standard ways - through the creation and configuration of daemons.  To do this, the system has a special directory where all the ‚Äúcontrol scripts‚Äù - <i>/etc/init.d/</i> .  In this directory is a template - <i>skeleton</i> , in the image and likeness of which we will make our scripts.  Go to this directory and copy the template: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /etc/init.d/ cp skeleton vertcoind</code> </pre><br>  Open the file for editing and make changes: <br><pre> <code class="bash hljs">nano vertcoind</code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#! /bin/sh ### BEGIN INIT INFO # Provides: vertcoind # Required-Start: $remote_fs $syslog # Required-Stop: $remote_fs $syslog # Default-Start: 2 3 4 5 # Default-Stop: 0 1 6 # Short-Description: Auto init Vertcoind # Description: Auto init Vertcoind via booting system ### END INIT INFO # Author: vk &lt;technical@storage.co.ua&gt; # # Please remove the "Author" lines above and replace them # with your own name if you copy and modify this script. # Do NOT "set -e" # PATH should only include /usr/* if it runs after the mountnfs.sh script PATH=/sbin:/usr/sbin:/bin:/usr/bin DESC="Vertcoin daemon" NAME=vertcoind DAEMON=/usr/bin/$NAME DAEMON_ARGS="-daemon" DAEMON_LOADER="/usr/bin/taskset 0x1 "$DAEMON PIDFILE=/var/run/$NAME.pid SCRIPTNAME=/etc/init.d/$NAME CHUID=vtc:vtc ... do_start() { # Return # 0 if daemon has been started # 1 if daemon was already running # 2 if daemon could not be started start-stop-daemon --start --quiet --pidfile $PIDFILE --exec $DAEMON_LOADER --test &gt; /dev/null \ || return 1 start-stop-daemon --start --quiet --chuid $CHUID --pidfile $PIDFILE --exec $DAEMON_LOADER -- \ $DAEMON_ARGS \ || return 2</span></span></code> </pre><br>  And now, what we actually did: <br><ol><li>  <i>Provides</i> - we set the name </li><li>  <i>Short-Description / Description</i> - a description of what this file is doing, in case of a case, we will suddenly ‚Äúforget‚Äù for ourselves or third parties will understand all this </li><li>  <i>DESC = "Vertcoin daemon"</i> - service description </li><li>  <i>NAME = vertcoind</i> - set the name of the executable file </li><li>  <i>DAEMON = / usr / bin / $ NAME</i> - and its full name (do you remember we copied them to this directory before?) </li><li>  <i>DAEMON_ARGS = "- daemon"</i> - set launch arguments: the wallet should start in the daemon background </li><li>  <i>DAEMON_LOADER = "/ usr / bin / taskset 0x1" $ DAEMON</i> - as already mentioned, it is strongly recommended to distribute between the cores the processes of the clients themselves and the p2pool script, in order to increase the speed of the node as a whole.  In this case, we use the <i><a href="http://linuxcommand.org/man_pages/taskset1.html">taskset</a></i> utility <i><a href="http://linuxcommand.org/man_pages/taskset1.html">to</a></i> indicate that the client will run exclusively on the first kernel.  I have a dual-core server, so it was decided to push all three clients to one core (the first), and the p2pool script to another (the second). <br>  In the case when you have only a single-core server, then this line can be eliminated by removing the part related to the <i>taskset</i> , leaving only <i>$ DAEMON</i> . <br>  In the case when you have a server with more than two cores, the task becomes a bit more complicated, and for proper configuration you will still need to learn how the <i>taskset</i> utility <i>works</i> .  Attention!  The basic idea is not to evenly spread the load between the cores, but to differentiate between the cores the execution of clients and the p2pool script, and, if possible, give more resources to the main currency.  So, for example, in the case of any three-core exotic, we should hang a helicopter client on the first core, on the second p2pool script, and on the third - everything else. </li><li>  <i>CHUID = vtc: vtc</i> - set the user and group, on behalf of which the executable file will start. </li><li>  <i>start-stop-daemon --start_blah_blah</i> - make the appropriate changes to the command to start the daemon. </li></ol><br><br>  We save and close the file, grant it execution rights and copy it as a preset for two other clients and the p2pool script: <br><pre> <code class="bash hljs">chmod 0755 vertcoind cp vertcoind monocled cp vertcoind parallaxcoind cp vertcoind p2pool_vtc</code> </pre><br><br>  Correct the contents of the <i>monocled</i> and <i>parallaxcoind</i> files.  They are in principle similar to <i>vertcoind</i> , except that they are related to other executable files (points 1-4 above) - we change the <i>vertcoind</i> to <i>monocled</i> and <i>parallaxcoind,</i> respectively.  In monocles, also in paragraph 6, we add the value of the minimum commission, which is a feature of this particular coin, so the line takes the following form: <br><pre> <code class="bash hljs">DAEMON_ARGS=<span class="hljs-string"><span class="hljs-string">"-daemon -paytxfee=0.01"</span></span></code> </pre><br><br>  Separately dwell on the file <i>p2pool_vtc</i> .  Below is its final view in places other than <i>vertcoind</i> : <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#! /bin/sh ### BEGIN INIT INFO # Provides: p2pool_vtc # Required-Start: $all # Required-Stop: $remote_fs $syslog # Default-Start: 2 3 4 5 # Default-Stop: 0 1 6 # Short-Description: Auto init Vertcoin P2Pool # Description: Auto init Vertcoind P2Pool via booting system ### END INIT INFO # Author: vk &lt;technical@storage.co.ua&gt; # # Please remove the "Author" lines above and replace them # with your own name if you copy and modify this script. # Do NOT "set -e" # PATH should only include /usr/* if it runs after the mountnfs.sh script PATH=/sbin:/usr/sbin:/bin:/usr/bin DESC="P2Pool VTC daemon" NAME=python DAEMON=/usr/bin/$NAME DAEMON_ARGS="/home/vtc/p2pool-n/run_p2pool.py --net vertcoin -a your_wallet_name --merged http://monocle:monRPCpass@127.0.0.1:6888 --merged http://parallaxcoin:plxRPCpass@127.0.0.1:7817 --give-author 0 --max-conns 100 --outgoing-conns 10" DAEMON_LOADER="/usr/bin/taskset 0x2 "$DAEMON PIDFILE=/var/run/$NAME.pid SCRIPTNAME=/etc/init.d/$NAME CHUID=vtc:vtc</span></span></code> </pre><br><br>  Regarding the changes themselves: <br><ol><li>  <i>Provides</i> - again the name </li><li> <i>Required-Start: $all</i> ‚Äî    p2pool-          (  )  ,           ,        (     ). </li><li> <i>Short-Description/Description/DESC</i> ‚Äî    </li><li> <i>NAME=python</i> ‚Äî   p2pool    ,    ,   ,        . </li><li> <i>DAEMON_ARGS=blah-blah-blah</i> ‚Äî              p2pool-( <i>/home/vtc/p2pool-n/run_p2pool.py</i> )     .   : <br><ul><li> a). <i>--net vertcoin</i> ‚Äî        p2pool.      p2pool  .    ,   -     ,  - ‚Äî          . </li><li> b). <i>-a your_wallet_name</i> ‚Äî    ,     .   ,        ,    ,    .     ,          ,    .      ‚Äî <blockquote> Big fat wallets on a public server are not a good idea </blockquote></li><li> c). <i>--merged blah_blah</i> ‚Äî     merged ,    .  : <i>--merged <a href="http://rpcuser/">rpcuser</a> :rpcpassword@ip_address_or_domain:rpcport</i> .        .      .    ,      ‚Äî    (    ,   ,      )         .           ,     .        ¬´¬ª (   ),      . </li><li> d). <i>DAEMON_LOADER="/usr/bin/taskset 0x2 "$DAEMON</i> ‚Äî    p2pool-      .       ‚Äî . . </li><li> e). <i>--give-author 0</i> ‚Äî       .   . </li><li> d). <i>max-conns &amp; outgoing-conns</i> ‚Äî     ,           /    . </li></ul></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now that almost everything is ready, we can control our demons manually through convenient commands, without any user login procedure and prescription of arguments. The first command will give us a possible list of actions, the second will launch the p2pool script (of course, provided that our nodes have already been synchronized with the network, downloading the whole block history, and are working):</font></font><br><pre> <code class="bash hljs">/etc/init.d/p2pool_vtc /etc/init.d/p2pool_vtc start</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The last command will ‚Äúrevive‚Äù our node, and it will start synchronization with the p2pool network. </font><font style="vertical-align: inherit;">Soon the statistics of our node will become available, in this case mine, on which this manual was written - </font></font><a href="http://91.234.32.241:9171/static/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://91.234.32.241:9171/static/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Noda is created ‚Äúsolely for example‚Äù, so you should not break it trying to get hundreds of bitcoins</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As a final touch, we update the startup list on the server so that our daemons automatically start when the server is started, and restart the server in order to check the success of our actions:</font></font><br><pre> <code class="bash hljs">update-rc.d vertcoind defaults update-rc.d monocled defaults update-rc.d parallaxcoind defaults update-rc.d p2pool_vtc defaults reboot</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> After reboot everything started? </font></font> That's good! <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Instead of the conclusion or "finish files" </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First of all, let's make the statistics of our node more human-fit. For this we will use a third-party frond-end, for example </font></font><a href="https://github.com/johndoe75/p2pool-node-status"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><a href="https://github.com/blixnood/P2PoolExtendedFrontEnd"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . For one, it will be possible to remove all the garbage, if you have not done this before:</font></font><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/hardcpp/P2PoolExtendedFrontEnd rm -rf /home/vtc/p2pool-n/web-static/ mv -f P2PoolExtendedFrontEnd /home/vtc/p2pool-n/web-static chown -R vtc:vtc /home/vtc/ rm -rf monocle rm -rf parallaxcoin rm -rf vertcoin</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is also possible through the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">htop</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> task manager </font><font style="vertical-align: inherit;">to make sure that all our four daemons successfully started under the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vtc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> user </font><font style="vertical-align: inherit;">, and also work on different processor cores (this is recognized using the same </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">taskset</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utility </font><font style="vertical-align: inherit;">and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pid of</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> running processes). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can also increase the priority of these processes ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nice</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), setting it equal to "-10": select the desired process and press F7. I failed to implement this automatically through the same daemon startup files, so at this point you will need to do it with ‚Äúhandles‚Äù after each server reboot. Increasing the priority also has a positive effect on the speed of the node.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Another bottleneck is the lack of verification during operation, has any of our processes been self-terminated, in other words, ‚Äúhas a node dropped?‚Äù. For good, there should be some kind of script that would check the availability of various processes according to the crown, and in the case of the absence of these, would reboot the server. But since my farm is behind my back, I learned about the fall (of which, probably, for four months there were just a couple of pieces) I knew immediately after the disappearance of noise in the room. If you want to automate everything to such an extent that you could forget about the node for a couple of months, then you should think about it. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Targeting a farm to a node is very simple: </font><font style="vertical-align: inherit;">Of course, you can add your own parameters, but optimizing and adjusting the miner is not the topic of this topic.</font></font><br> <i><code>-o stratum+tcp://your_ip_or_node_domain:9171 -u wallet_name -p any_password -Q 0 -s 1 -E 1</code></i> <br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The values ‚Äã‚Äãof the parameters </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are recommended for p2pool-a, and contribute to a more ‚Äúquick‚Äù exchange of tasks between the node and the farm:</font></font><br><ul><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-Q | --queue</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - the length of the queue of the requested jobs. </font><font style="vertical-align: inherit;">The default is 1. The recommended value is 0.</font></font></li><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-s | --scan-time</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><i><font style="vertical-align: inherit;">time</font></i><font style="vertical-align: inherit;"> limit for scanning the current job. </font><font style="vertical-align: inherit;">The default is 60. The recommended value is 1.</font></font></li><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-E | --expiry</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - the upper limit of time, which is allowed after receiving the work, for consideration of its "late" (stale). </font><font style="vertical-align: inherit;">The default value is 120. The recommended value is 1.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The last paragraph wants to enlighten the fate of the inked merged currencies. They are mined in the "solo" mode by the client on our node. Accordingly, the blocks of coins are charged on him. How quickly our node will find the blocks and receive rewards for them, depends entirely on its total hashrate. In order to get coins to your wallet (for example, the one that is installed on the working PC / laptop, and from which you can easily manage them using the graphical interface), we need to log in with our </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vtc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> user </font><font style="vertical-align: inherit;">, check for a positive balance on the wallets (found , or not), and then transfer them to the miners of the node, in proportion to their hashrate (for example, mono glue):</font></font><br><pre> <code class="bash hljs">su -s /bin/bash vtc monocled getinfo monocled sendmany blah-blah-blah</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The syntax of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sendmany command</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , as well as a list of all other parameters and commands, can be viewed by running the client / p2pool script with the key - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">help / -h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , respectively. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This material was written by a person who had no previous system administration experience. </font><font style="vertical-align: inherit;">In case bearded system administrators start to burn their eyes in writing: the best way to prove one‚Äôs case is to point out errors in the comments. </font><font style="vertical-align: inherit;">Constructive criticism is always welcome. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Used, but not mentioned literature:</font></font><br>  one). <a href="http://www.reddit.com/r/vertcoin/comments/1z25fl/p2pool_node_creation_guide_for_linux/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The topic on the reddite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which in its time raised its first node.</font></font><br>  2). <a href="https://bitcointalk.org/index.php%3Ftopic%3D153232.0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A wonderful topic on Bitcointalk</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , about fine-tuning p2pool from the guru of this craft. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3). </font></font><a href="https://litecoin.org/downloads/HOWTO-SUPERNODE.txt"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guide to creating supernody</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for lightcoin.</font></font><br><br>  Thanks to everybody, you're free. </div><p>Source: <a href="https://habr.com/ru/post/229643/">https://habr.com/ru/post/229643/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229631/index.html">Signerbox - authentication via DSTU 4145</a></li>
<li><a href="../229633/index.html">Windows "Threshold": Microsoft's plan to conquer users of Windows 7</a></li>
<li><a href="../229635/index.html">Box Overview leaves from Habr: postmortem</a></li>
<li><a href="../229637/index.html">Attempt to create a useful application for Pebble</a></li>
<li><a href="../229639/index.html">Rosetta Flash - SWF encoding for calling from JSONP</a></li>
<li><a href="../229645/index.html">LG G Watch: a complete review of iFixit (and 9 out of 10 on the repair scale)</a></li>
<li><a href="../229647/index.html">Baby Monitor from Android smartphone</a></li>
<li><a href="../229649/index.html">Useful materials for mobile developer # 61 (July 7-13)</a></li>
<li><a href="../229651/index.html">We collect a modern system unit cheaper than 150 euros</a></li>
<li><a href="../229653/index.html">First look at Themosis, a framework for WordPress developers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>