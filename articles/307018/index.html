<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Sprute.js. Another isomorphic JavaScript framework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Picture to attract attention 

 Sprute.js is a new isomorphic JS framework. With its design and implementation, the emphasis was primarily on the ease...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Sprute.js. Another isomorphic JavaScript framework</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/9ab/723/0aa/9ab7230aac434603998d1c4580fc0382.jpg" alt="image"><br>  <i>Picture to attract attention</i> <br><br>  <a href="https://github.com/one-more/sprute">Sprute.js</a> is a new isomorphic JS framework.  With its design and implementation, the emphasis was primarily on the ease of development and the preservation of the framework itself as simple and compact as possible.  First of all, it concerns isomorphism. <br><br><h4>  Why another framework? </h4><br>  In existing frameworks, I am not satisfied with the approach to the implementation of isomorphism - my goal was to realize isomorphism in such a way that it did not define the architecture and did not have to build the architecture around isomorphism, but to make it as transparent as possible - so that I could write the server code as I used to , and he also worked on the client.  My approach can be called server side first. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Please do not kick much for the scarcity of the text - a detailed statement of my thoughts has always been my weak point. <br><a name="habracut"></a><br><h4>  Approach to isomorphism </h4><br>  To implement isomorphism, I decided to "emulate" node.js in the browser - isomorphic code is written on the server and works the same way on the client.  To do this, I had to port the node.js require to the browser and emulate the file system.  I also partially ported the node.js modules process, fs, events. <br><br><h4>  Architecture </h4><br>  All code is divided into 3 categories - server, client, isomorphic and divided into directories back, front, common.  In the back and front directories are the base classes that are specific to the respective environment, 90% of the code is in the common directory.  The functionality of the framework, such as a server, a template engine, a socket connection, is implemented as components ‚Äî essentially modules.  This allows you to encapsulate code with a certain area of ‚Äã‚Äãresponsibility;  also allows you to write isomorphic wrappers for such things as a socket connection, creating a single api on the client and server and allowing you to change the implementation of the component in the future. <br><br>  Sample component: <br><br><pre><code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { init() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>; app.clientSide(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./lib/client'</span></span>) }); app.serverSide(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./lib/server'</span></span>) }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.init() } };</code> </pre> <br><br><h4>  Statics </h4><br>  Styles, scripts that implement the interactivity of the interface, etc., are collected in themes - a directory with files and a configuration object.  This allows you to separate the interface logic from the rest of the logic;  it also allows you to set a separate topic for each page ‚Äî conveniently when redesigning the site or creating various admins, etc. <br><br><h4>  Work with data </h4><br>  Work with data is implemented using the data mapper pattern.  The logic of saving / selecting data is in the mapper, the business logic ‚Äî for example, whether the user has a certain privilege ‚Äî in the model, the logic of working with a set ‚Äî is in the collection.  The isomorphism of the mapper is implemented as follows - the request is serialized into the object and transmitted to the server, where the request object is transmitted to the same mapper;  the result is returned to the client.  At the moment, the mapper is implemented using the knex library for building queries and retrieving data. <br><h4>  Mapper example </h4><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BaseMapper = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(app.get(<span class="hljs-string"><span class="hljs-string">'commonPath'</span></span>)+<span class="hljs-string"><span class="hljs-string">'/mappers/knex-mapper'</span></span>); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CoolModel</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CoolMapper</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseMapper</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> connections; app.serverSide(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { connections = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(process.cwd()+<span class="hljs-string"><span class="hljs-string">'/configuration/connections'</span></span>) }); app.clientSide(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { connections = {}; }); <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>({ <span class="hljs-attr"><span class="hljs-attr">client</span></span>: <span class="hljs-string"><span class="hljs-string">'mysql'</span></span>, <span class="hljs-attr"><span class="hljs-attr">connection</span></span>: connections.mysql }) } get tableName() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'cool'</span></span> } get model() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CoolModel } beforeCreateTable(table) { table.comment(<span class="hljs-string"><span class="hljs-string">'very cool table'</span></span>) } addColumns(table) { table.increments(<span class="hljs-string"><span class="hljs-string">'id'</span></span>).primary(); table.string(<span class="hljs-string"><span class="hljs-string">'field1'</span></span>); table.integer(<span class="hljs-string"><span class="hljs-string">'field2'</span></span>); table.string(<span class="hljs-string"><span class="hljs-string">'field3'</span></span>) } get validator() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._validator) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> vE = app.get(<span class="hljs-string"><span class="hljs-string">'validationEngine'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._validator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> vE({ <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-string"><span class="hljs-string">'integer'</span></span>, <span class="hljs-attr"><span class="hljs-attr">field1</span></span>: <span class="hljs-string"><span class="hljs-string">'not_empty'</span></span>, <span class="hljs-attr"><span class="hljs-attr">field2</span></span>: <span class="hljs-string"><span class="hljs-string">'integer'</span></span>, <span class="hljs-attr"><span class="hljs-attr">field3</span></span>: <span class="hljs-string"><span class="hljs-string">'not_empty'</span></span> }) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._validator } validateModel(model) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.validator.validate(model) } } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mapper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CoolMapper(); mapper.find().limit(<span class="hljs-number"><span class="hljs-number">10</span></span>).offset(<span class="hljs-number"><span class="hljs-number">5</span></span>).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">collection</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">/* code here */</span></span> }); mapper.findOne().where({<span class="hljs-attr"><span class="hljs-attr">id</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>}).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">model</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">/* code here */</span></span> })</code> </pre><br><br><h4>  How it works </h4><br>  The entry point is the App class.  When the class is initialized, the components are initialized - the framework is complete.  Then the server component takes over the work, then the routers are registered.  A further scheme of work consists in processing requests by routers. <br><br>  Example router: <br><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BaseRouter = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(app.get(<span class="hljs-string"><span class="hljs-string">'classPath'</span></span>)+<span class="hljs-string"><span class="hljs-string">'/routers/base'</span></span>), process = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'process'</span></span>), theme = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(process.cwd()+<span class="hljs-string"><span class="hljs-string">'/configuration/theme-light'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseRouter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(params, DomDocument) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(params); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.DomDocument = DomDocument || <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(app.get(<span class="hljs-string"><span class="hljs-string">'classPath'</span></span>)+<span class="hljs-string"><span class="hljs-string">'/classes/dom-document'</span></span>) } index(req, res) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> view = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../views/main-page'</span></span>))(theme), DomDocument = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.DomDocument(theme); view.render().then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">html</span></span></span><span class="hljs-function"> =&gt;</span></span> { DomDocument.setBlock(<span class="hljs-string"><span class="hljs-string">'main'</span></span>, html); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadPage(DomDocument, res) }) } };</code> </pre><br><br><h4>  Current status </h4><br>  Currently there is one site running on it - <a href="http://bel31stroy.ru/">bel31stroy.ru</a> and another one is in development.  The framework itself is periodically updated.  Pull requests and bug reports are welcome. <br><br>  Github: <a href="https://github.com/one-more/sprute">github.com/one-more/sprute</a> </div><p>Source: <a href="https://habr.com/ru/post/307018/">https://habr.com/ru/post/307018/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307008/index.html">BILLmanager. Now with the help of shell scripts you can sell anything</a></li>
<li><a href="../307010/index.html">Proof 2 Cases BTF</a></li>
<li><a href="../307012/index.html">Rating of programming languages ‚Äã‚Äãin 2016</a></li>
<li><a href="../307014/index.html">As one admin zoo tamed</a></li>
<li><a href="../307016/index.html">Fairy Tales Ransomwhere: Cerber on the rise</a></li>
<li><a href="../307020/index.html">Squid + Dansguardian + c-icap + ClamAV based on CentOS 7</a></li>
<li><a href="../307022/index.html">Cheburashka and torrents (fairy tale)</a></li>
<li><a href="../307024/index.html">Deep Learning - what to do, whom to beat</a></li>
<li><a href="../307026/index.html">Work with Facebook API from UWP applications</a></li>
<li><a href="../307028/index.html">Budget "data center" at Nutanix CE</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>