<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to create a world, hide the corpse and scour the Persian. Stacks of sandwiched keys. Virtual FMS and Federal Drug Control Service (or who resolves 228 and "powders the nose")</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Single video demo : 
 Example 1 - You are a big mushroom, and pills everywhere (like at an acid party) 
 Example 2 - Man drives a truck 
 Example 3 - ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to create a world, hide the corpse and scour the Persian. Stacks of sandwiched keys. Virtual FMS and Federal Drug Control Service (or who resolves 228 and "powders the nose")</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/61c/b69/924/61cb699247bfd3983fbc3a85bb79b05f.jpg"><br><br>  <b>Single <a href="http://www.youtube.com/watch%3Fv%3D6swW1zwF3EY">video</a> demo</b> : <br>  <a href="http://bakhirev.biz/StalinGrad/demo/21.html">Example 1</a> - You are a big mushroom, and pills everywhere (like at an acid party) <br>  <a href="http://bakhirev.biz/StalinGrad/demo/22.html">Example 2</a> - Man drives a truck <br>  <a href="http://bakhirev.biz/StalinGrad/demo/23.html">Example 3</a> - Throwing defective bricks into a well <br>  <a href="http://bakhirev.biz/StalinGrad/demo/24.html">Example 4</a> - Battle of Robots (PvP) <br><br>  <b>Duplicate server:</b> <a href="http://6.encom16.z8.ru/public/demo/21.html">1</a> , <a href="http://6.encom16.z8.ru/public/demo/22.html">2</a> , <a href="http://6.encom16.z8.ru/public/demo/23.html">3</a> , <a href="http://6.encom16.z8.ru/public/demo/24.html">4</a> <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Hi Habra!  This is the third article about the game engine StalinGrad.  In previous articles, you and I have already been raping DHTML and have a bit taken apart the architecture.  This article will be in two parts - practice and theory.  If you are not a web developer, you can immediately browse to the theory (perhaps it will be interesting for you or write some advice). <br><br>  <b>What considered in past articles:</b> <br>  <a href="http://habrahabr.ru/post/196530/">Launch before production</a> <br>  <a href="http://habrahabr.ru/post/196530/">JS -&gt; EXE -&gt; CHM -&gt; APK</a> <br>  <a href="http://habrahabr.ru/post/197796/">About architecture</a> <br>  <a href="http://habrahabr.ru/post/197796/">Analysis of weapons</a> <br>  <a href="http://habrahabr.ru/post/197796/">Parsing camera</a> <br><br><h1>  We write the first game </h1><br>  An example of creating a game: <br><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TV"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> S = StalinGrad, <span class="hljs-comment"><span class="hljs-comment">//  ,    Russia = S.world(), //   ORT = S.camera(Russia, "TV"), //   Vova = S.people("robot1"); //   S.map(Russia, "Moscow"); //     S.module.controller(Vova); //     ORT.bind(Vova); //     Russia.add(Vova); //    </span></span></code> </pre> <br>  A demo of what happens can be seen <a href="http://bakhirev.biz/StalinGrad/demo/25.html">here</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6c5/55c/f74/6c555cf74f10d637e797f1dd46f99d6c.jpg"><br><br>  Expect more?  But the next 10 thousand letters, we will disassemble what is written here.  You can see the code for the demo examples in this and past articles.  Scripts almost everywhere fit in less than 20 lines.  Perhaps some of you will ask why the title of the article is not such: ‚Äú- How to write a game in JavaScript in a minute?‚Äù.  Because we all (well, or 95%) are well aware that this is just a demo.  In order for the game to go into production, you also need to connect a bunch of modules, a game interface, menus, missions, videos between levels, screensavers, messages, think through the plot, think over and draw level maps, create a bunch of bots, discuss everything with different managers and designers, get reprimanded from the customer, fix 100 magic bugs, write a bunch of "pasta code" for all sorts of "whistles and fakes."  And on the day of release, the customer will ask for another small edit and remake of the half-project (moreover, only with crutches, since there‚Äôs no other way).  We can say that StalinGrad is not for those who write the game on HTML5 in 20 minutes, but for those who scoffs at JavaScript for several days / weeks / months. <br><br>  We have dealt with the general logic of the work in the last article, and in this article let's look carefully at each line and API. <br><br><h2>  How to create a world </h2><br><br><pre> <code class="javascript hljs">StalinGrad.world();</code> </pre> <br>  Each world has a set of standard parameters, for example: length, altitude, time of day, gravity, air friction force, etc.  Here, as well as when creating objects, you can set your parameters in the following way: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> temp = StalinGrad.world({ <span class="hljs-attr"><span class="hljs-attr">frictionOfTheAir</span></span>: <span class="hljs-number"><span class="hljs-number">0.01</span></span>, <span class="hljs-comment"><span class="hljs-comment">//   gravitation: 88.2, //  jiffy: 0.05, //  ""  .  meter: 10, //  ""  .  max: { x: 3300, //   y: 400, //   speed: { x: 20, //     X y: 20 //     Y } }, respawn: { //   ,      x: 0, //       ‚Äî       y: 0 } ...  .. });</span></span></code> </pre> <br>  Every object in the world has its own API.  The most important functions in it: add () and remove (), to add objects to the world and remove them, respectively. <br><br><h2>  How to create an object </h2><br><br>  The general scheme of creating objects: <br><br><pre> <code class="javascript hljs">StalinGrad._(<span class="hljs-string"><span class="hljs-string">"_"</span></span>);</code> </pre> <br>  For example characters: <br><br><pre> <code class="javascript hljs">StalinGrad.people(<span class="hljs-string"><span class="hljs-string">"nyancat"</span></span>); StalinGrad.people(<span class="hljs-string"><span class="hljs-string">"ninja"</span></span>); StalinGrad.people(<span class="hljs-string"><span class="hljs-string">"mushroom"</span></span>);</code> </pre> <br>  Or something different: <br><br><pre> <code class="javascript hljs">StalinGrad.block(<span class="hljs-string"><span class="hljs-string">"brick"</span></span>); StalinGrad.material(<span class="hljs-string"><span class="hljs-string">"floor"</span></span>); StalinGrad.weapon(<span class="hljs-string"><span class="hljs-string">"portal"</span></span>);</code> </pre> <br>  With this creation, each object receives the coordinates x = 0 and y = 0. Therefore, when creating the object, it is desirable to indicate the coordinates in which it will be located.  If you do not do this and start adding an object to the world, it will generate an error in the console: ‚ÄúI cannot add an object.  This place is already taken by another object. ‚Äù  Therefore, write this: <br><br><pre> <code class="javascript hljs">StalinGrad._(x, y, <span class="hljs-string"><span class="hljs-string">"_"</span></span>);</code> </pre> <br>  For example: <br><br><pre> <code class="javascript hljs">StalinGrad.block(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">25</span></span>, <span class="hljs-string"><span class="hljs-string">"brick"</span></span>); StalinGrad.material(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-string"><span class="hljs-string">"floor"</span></span>);</code> </pre> <br>  The standard width / height of most objects is 25 by 25. Why should the initial coordinates be set at the time the object is created, and not later?  Because objects have start and end coordinates.  If you specify the initial x and y when creating the object, the final x and y will be obtained automatically (x max = x min + length).  If you decide to set them later, you will consider the maximum coordinates yourself.  For example: <br><br><pre> <code class="javascript hljs">vav cat = StalinGrad.people(<span class="hljs-string"><span class="hljs-string">"nyancat"</span></span>); cat.x.min = <span class="hljs-number"><span class="hljs-number">50</span></span>; cat.x.max = cat.x.min + cat.width;</code> </pre> <br>  And even better - do not climb into the coordinates at all, because  Most likely, your problem can be solved through the API. <br><br>  If for some reason you need to change even more initial properties of the object, you can use the following syntax: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> temp = StalinGrad.block({ <span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-comment"><span class="hljs-comment">//    X y: 25, //    Y type: "brick", //  width: 400, //  height: 200 //  ...  .. });</span></span></code> </pre> <br>  Information on all available types you can see in this <a href="http://bakhirev.biz/StalinGrad/index.html">table</a> . <br><br> <a href="http://bakhirev.biz/StalinGrad/index.html"><img src="https://habrastorage.org/getpro/habr/post_images/d50/372/549/d503725495644871a32c0774d427e603.jpg"></a> <br><br>  On the Internet, the Cocos2D game engine has become widely known.  I also liked it very much, so I decided to import its base into StalinGrad.  Unfortunately, after refactoring the code, the essence of the coconut has changed a lot (only the name remains).  You can get it with the following command: <br><br><pre> <code class="javascript hljs">StalinGrad.grugs(<span class="hljs-string"><span class="hljs-string">"cocos"</span></span>);</code> </pre> <br>  And add it to the world, for example, like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cc = StalinGrad.grugs(<span class="hljs-string"><span class="hljs-string">"cocos"</span></span>); Russia = StalinGrad.world(); Russia.add(cc);</code> </pre> <br>  And what is characteristic, the coconut is also here in 2D.  Detailed information about the remaining objects of the class drugs you can see in the catalog. <br><br>  Many of you probably have the following API question: ‚Äú- Why are the various functions in the API not separated by their type by additional words?‚Äù For example, it is more logical to do the following schemes: <br><br><pre> <code class="javascript hljs">StalinGrad.object.people(<span class="hljs-string"><span class="hljs-string">"nyancat"</span></span>); StalinGrad.object.grugs(<span class="hljs-string"><span class="hljs-string">"cocos"</span></span>);</code> </pre> <br>  Then it becomes immediately clear that people and grugs are methods for working with objects.  But it is obvious for experienced ones, but for juniors it is the opposite.  In addition, we need to memorize an additional word in the design, which can be reduced.  Perfectly reveal the essence of jQuery and Backbone.  In jQuery, many methods are so intuitive that you can guess their presence without even reading the documentation.  But backbone without documentation is not at all obvious. <br><br><h2>  How to cheat Persian </h2><br>  We analyze the work with the personal belongings of the character.  Honestly, I did not come up with an adequate API, so at the moment the scheme is this: <br><pre> <code class="javascript hljs">.bag.___API();</code> </pre> <br>  Imagine a man with a backpack and look at the API: <br><pre> <code class="javascript hljs">left(cat); <span class="hljs-comment"><span class="hljs-comment">//      right(cat); //      show(cat); //   (,   ) hide(cat); //   ( ,     ‚Äî  ) set(cat, index); //     ...  get(cat); //      add(cat, id); //    id ...   (    ) remove(cat, index); //     ...  </span></span></code> </pre> <br>  For example: <br><pre> <code class="javascript hljs">cat.bag.left(cat);</code> </pre> <br>  The API is crooked and I don't like it.  So I will rewrite in perspective.  Character has to prokidykivat every time, because  because of the nesting, I cannot get from the prototype a link to the original object from which the call chain began.  If you have ideas on how to implement the backpack API in a more appropriate way, write in the comments. <br><br><h2>  How to create a camera </h2><br><br>  The moment has come to create a camera and see the world: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NTV = StalinGrad.camera(<span class="hljs-string"><span class="hljs-string">"id_div_"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//     DIV    var RTVi = StalinGrad.camera(_, "id_div_"); //          DIV</span></span></code> </pre> <br>  As always, when creating an object, you can specify additional settings: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> MTV = StalinGrad.camera({ <span class="hljs-attr"><span class="hljs-attr">world</span></span>: Russia, <span class="hljs-comment"><span class="hljs-comment">// ,    maxRendering: { //   x: 400 y: 300 }, screenResolution: { //   x: 400 y: 300 } x: 0, //    y: 0 //   Y });</span></span></code> </pre> <br>  Also, each camera has an API, like a joystick: left (), right (), up (), etc.  See the documentation in the previous section.  For example: <br><br><pre> <code class="javascript hljs">RTVi.left(); <span class="hljs-comment"><span class="hljs-comment">//    RTVi.resize(); //     </span></span></code> </pre> <br>  Well, the most important for us is the bind () method, which is necessary to bind the camera to the character.  For example: <br><br><pre> <code class="javascript hljs">ORT.bind(Vova);</code> </pre> <br>  Tying the camera to the character, by the way, is possible, including, and only on one axis.  For example: <br><br><pre> <code class="javascript hljs">ORT.bind({ <span class="hljs-attr"><span class="hljs-attr">object</span></span>: Vova, <span class="hljs-comment"><span class="hljs-comment">// ,     type: "x", // ,    correction: { //   x: 2, y: 3 } });</span></span></code> </pre> <br>  You, probably, have already asked yourself the question: ‚ÄúWhat else for the proportions of coordinates ?!‚Äù The fact is that if the character is ideally located in the center of the frame, it looks strange.  Therefore, a small offset is specified.  In this example, the character will be shifted to the left of the beginning of the frame along X on a half-screen, and below from the beginning of the frame by one third.  You can change the settings and make sure that the position in the center cuts the eyes (correction x = 2, y = 2). <br><br>  <a href="http://bakhirev.biz/StalinGrad/demo/27.html">Demo</a> with downed settings <br><br><img src="https://habrastorage.org/getpro/habr/post_images/01b/ea0/7d4/01bea07d48ff2438029c79dc8c80783b.jpg"><br><br><h2>  How to create a joystick </h2><br><br>  As I wrote in the last article, in order to control the character, we need a joystick.  Let's create it: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> joystick = StalinGrad.controller(Vova);</code> </pre> <br>  Any joystick has a standard API: left (), right (), attack (), use (), turn (), up (), down ().  It is through this API that you should control the character, but do not meddle into the coordinates;) <br><br>  But we will not control the character from the code?  Therefore, we do not really need a joystick.  And we need a controller module.  We will cast a character into it.  The module itself will create a joystick for the character and tie the joystick to the keyboard. <br><br><pre> <code class="javascript hljs">StalinGrad.module.controller(Vova);</code> </pre> <br><h1>  Object Registry </h1><br>  Any factory, from those that were considered above, before returning the object to you will add it to the unified register of game objects.  This is necessary in order to remove direct links to each other between objects.  We have already dealt with this topic in the previous article.  Refer to each other - bad.  This creates problems with scalability, with the removal of objects, with attempts to stop memory leaks, etc.  In addition, when nested objects are completely impossible to convert them to a string via JSON.stringify.  Therefore, the character‚Äôs things are only IDs of things, passengers inside vehicles are only passenger IDs, etc.  Convert everything to a string for save / load functions.  But about them another time. <br><br>  The registry of objects is like FMS, only virtual.  You can refer to it like this: <br><br><pre> <code class="javascript hljs">StalinGrad.registry.get(<span class="hljs-string"><span class="hljs-string">"id_"</span></span>);</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/1cd/df1/fa8/1cddf1fa8e79702e24925bf72980f180.png"><br><br>  Through it, all third-party modules work that do not have the right to keep a link to the instance in themselves, because  this can create unexpected problems in the form of a memory leak, etc. <br><br><h1>  How does the controller module work </h1><br>  In almost any game we make, we have a main character, which is controlled by a player.  Management in all games is standard, so time after time we have to solve the same task - to tie the joystick to the keyboard.  To get rid of this, the code is moved to the module, and the module is used in 99% of cases, therefore it is included in the engine core.  As for the control itself, it is: AWSD or arrows, E - to use, Enter - to shoot, e - to switch the mode (for example, the mode of a gravitational gun).  In addition, a bunch of duplicate buttons is attached so that the player can immediately take over and begin to control, regardless of where he points with his finger.  Misunderstanding of management was a frequent problem of old games on JavaScript (and new ones too).  You sit, watch the demo, poke all the buttons on the keyboard, and the character stands still.  And the game seems to be good, but it's impossible to play.  What did I follow when choosing buttons?  Here is the situation: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/621/c91/8cc/621c918ccf2001396af40a875fe646c8.jpg"><br><br>  You can try, it's funny.  And, of course, there are obvious bugs that need to be resolved.  For example: <br><br>  <b>‚ÄúWe push to the left, then we clamp upward.</b>  <b>Let go up (the button to the left is still clamped) and ... everything, the character no longer runs to the left "</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a01/475/28b/a0147528b119d242c2a8d6adc4b8df59.jpg"><br><br>  The same problem with the combination left + right - right.  Many, of course, will advise to better deal with keypress, but no, it does not work in JavaScript or it does not work the way it feels good. <br><br>  The way out of the situation was suggested by the algorithm of the old snake, in which key sticking was used: by pressing a key, information about the direction was simply recorded in a variable followed by a timer.  In fact, an intermediary appeared between the game and the keyboard in the form of a variable that remembers the last direction.  And what to do in our case?  And if we want two players to play a game at the same time?  And what if it is necessary that one person could manage at once a whole army of bots?  Then we start thinking ... <br><br><img src="https://habrastorage.org/getpro/habr/post_images/efa/237/a4d/efa237a4dd0b1133757601ed69bbdc17.png"><br><br>  At the entrance we have a joystick with configs (or without them, then it will receive default configs).  Create a keyboard map and mark the buttons, which will follow.  Next, create a stack of events and an array of joysticks.  If any button was clamped, the module looks at who signed it, and puts the event information in the right stacks.  Parallel to this, by timer, checking stacks is triggered.  A special function bypasses all stacks, looks at what the latest events are recorded in them.  Next, for each stack, an array of joysticks is moved (which are listed as this stack).  And for each joystick, the event belonging to it is distributed.  If a player releases the keyboard button, the module removes it from all the stacks that subscribed to it.  So, when the timer comes to the stacks, it will take the previous event, which worked on the last button.  Try to hold several buttons at the same time in the demo. <br><br>  On the one hand, the scheme is complex, and on the other, it gives excellent prospects for scalability.  We can set configs and list the list of buttons we want to subscribe to.  So you can make a game for two or more players. <br><br>  Some demos: <br><ul><li>  <a href="http://bakhirev.biz/StalinGrad/demo/24.html">Two player game</a> </li><li>  Manage a <a href="http://bakhirev.biz/StalinGrad/demo/26.html">pack of characters</a> (PL `s and KL`y appreciate, especially if they are in several windows farm locks) </li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/8f2/061/4f3/8f20614f317da7c6d10620a9fc17e49e.jpg"><br><br><h1>  Registry of substances </h1><br>  Examples of substances in GTA, Stalker and Fallout showed that the game with them can become more interesting.  There was a task to add substances to the engine.  Initially, everything was simple - you use the drug and the camera adds an extra class to the display.  Trip is created by means of CSS3 (rotation, transformation, etc.).  But the scheme was completely inoperative in older browsers. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/14c/33a/14e/14c33a14ebffcb8aa21a93ee9c735db7.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/1e2/ac5/b27/1e2ac5b27b2dc34518446ece077b1a68.jpg"><br><br>  Then it was decided to leave CSS3 and write effects using other methods and means.  I divided the effects of all the trips into two types: filter overlay on the display and control reverse.  To put a filter on the image, created an additional div (transparent screen of the trip) with a z-index higher than all other objects.  The trip screen takes a class with background-image, and there is a transparent png picture with effects like an instagram  ªa.  Then, the transparency screen at the trip screen changes from 0 to 1, depending on whether the character is tripped or not.  In addition, this screen has another function - the function of the protective screen for devices with a touchscreen.  If the owner of the touchscreen stubbornly clicks on the picture, he may have a suggestion from the system to save the picture.  If there is a transparent div on top of this image, there will be no messages. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9b8/f01/6ea/9b8f016ea62235942c674acff97fb754.jpg"><br><br>  The task with the reverse control was not so obvious.  In addition, for each trip, it was necessary to create a timer, then to turn off the action of the trip and make the screen of the trips again transparent.  When scaling (creating heaps of worlds, characters, and simultaneous trips), such a scheme turned out to be completely ineffective.  Not only was a bunch of timers created, so the connections between the character / camera / joystick objects were amplified, which was contrary to the logic of modularity.  There was only one way out - to write an additional kernel module, which will resolve everything related to triples (we have our own Federal Drug Control Service with a timer and database). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/746/86c/e84/74686ce84daa8738e05b4cb7e967beda.png"><br><br>  <b>Let us analyze the module circuit:</b> <br><br>  There are n-th number of worlds with m characters in them.  If someone takes a substance somewhere, then information about it is sent to the registry of substances.  There she is recorded in the database, and all the cameras that were watching the character are sent a command to add a trip.  There is only one timer in the registry, which once per second bypasses all entries and minus the time spent in the registry.  If the record time is zero, it is removed from the registry, and all cameras that were associated with this record are sent a message saying that you need to disable the trip.  In addition, the register of substances can report whether a character is listed in it or not, and if it is, then in what condition it is at the moment.  Joystick objects, for example, use this API to find out information about their client.  If the joystick sees that the client is strongly undershot and undershot, it turns on the reverse control or imposes other effects. <br><br><h1>  How to hide a corpse </h1><br>  With how to kill a character everything seems to be clear, but what to do with his corpse is completely unclear.  The first thing that comes to mind is to immediately remove the carcass from the world.  But this is not scalable logic.  And what if we make a game about zombies and around some corpses?  Or do we have an immortal, sort of Duncan MacLeod, who cannot die?  Or we are writing a game about Chuck Norris, and Chuck Norris should not die, even if his life is zero.  Therefore, you can not remove the carcass.  On the other hand, they usually remove it and make it beautiful. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/323/f1c/3b3/323f1c3b3605b55ddb08acba7c3192e9.jpg"><br><br>  But we cannot know in advance what kind of death animation the developer wants to implement. <br><br>  Then, perhaps, the output will be just to leave everything as it is.  Suppose that each developer writes a cycle that timer will check the lives of the characters.  If the character has smoked, the developer himself will be able to come up with an action with the corpse.  But with such a logic of reasoning, it turns out that all the developers will again and again write the same search function for the blind men of the sky.  Then you can include it in the engine and get rid of code duplication. <br><br>  Ladies and Gentlemen, we meet - "function of death": <br><br><pre> <code class="javascript hljs">world.dead();</code> </pre> <br>  The function is called every time when someone suddenly "glues flippers" in our instance of the world.  As an argument, the function expects a callback function to be called.  The object that ‚Äúplayed in the box‚Äù will be passed to the callback function.  For example: <br><br><pre> <code class="javascript hljs">world.dead(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">man</span></span></span><span class="hljs-function">) </span></span>{ alert(<span class="hljs-string"><span class="hljs-string">"  ID "</span></span> + man.id + <span class="hljs-string"><span class="hljs-string">"  "</span></span>); });</code> </pre> <br>  Just in case, I‚Äôll clarify that the world is a world in which we will follow death. <br><br>  But we got a little distracted.  The question ‚ÄúHow to hide a corpse?‚Äù Is not yet resolved and there are several options. <br><br>  <b>Classic option</b> <br><br>  The character who gave the oak flies up.  A good option, but if our level consists of concrete floors (for example, the main character runs through the building), the carcass will not be able to pass through the ceiling.  Let me remind you that no one has yet canceled the calculation of collisions and physics, and for the corpse all forces continue to be considered.  Then you can change the type of object to "scenery."  The scenery in our nat.  calculations are not involved and can be arranged as you like.  But you must first remove the object from the world, because  it is listed in objects that can move.  And then add it to the world again, already as a decoration.  There is also an option with a flashing object. <br><br>  <b>Flashing option</b> <br><br>  If someone is killed, he stops, flashes and disappears altogether.  For this effect, we must take an array of sprites and replace each even element with a transparent picture.  Well, of course, a timer is added on top of everything, which at the end of the animation removes the dead character from the world.  The old game "Worms" in a hurry to offer us a third option. <br><br>  <b>Tombstone version</b> <br><br>  We memorize the coordinates of the corpse, remove it from the world, and in its place create the object "gravestone". <br><br>  ,   .       ,      ,     .          ,     : <br><br><pre> <code class="javascript hljs">StalinGrad.module.controller.remove();</code> </pre> <br>       ,    .  For example: <br><br><pre> <code class="javascript hljs">StalinGrad.module.controller.remove(man);</code> </pre> <br>        <a href="http://bakhirev.biz/StalinGrad/demo/28.html"></a>  <a href="http://bakhirev.biz/StalinGrad/demo/29.html"></a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/34b/5a8/9af/34b5a89aff73286b0ce1fd96c96a25b9.jpg"><br><br><h1>  Questions and answers </h1><br>     ,     . <br><br>  <a href="http://habrahabr.ru/users/guyfawkes">guyfawkes</a> : <br><br> <b>¬´‚Äî        ?¬ª</b> <br><br>  Nowhere.    open source   HTML5    github`.     ‚Äî  ,      ,     ,   ¬´   ¬ª.   ‚Äî ,    ‚Äî ,    ‚Äî       .   ,     ‚Äî  . <br><br><ul><li>   ,   web      ,      . </li><li>   ,       .          ,    . </li><li>     ,      ,    ¬´ ¬ª      .         . </li></ul><br><br>  Since  ,  ,    ,  -       ,  : <br><br><pre> <code class="javascript hljs">StalinGrad.brain = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ }</code> </pre> <br>         : <br><br><pre> <code class="javascript hljs">StalinGrad.module.YouModule = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ }</code> </pre> <br>  StalinGrad ‚Äî  ,  .    ‚Äî  -     (   <a href="https://github.com/bebraw/jswiki/wiki/Game-Engines"></a>  <a href="http://html5gamedevelopment.ru/"></a> ). -     .      canvas`  WebGL` ;) <br><br>  <a href="http://habrahabr.ru/users/s1im">s1im</a>    : <br><br> <b>¬´‚Äî        src  ,        ,    background - div-   background-position¬ª</b> <br><br>     ,      ( ,      <a href="http://habrahabr.ru/users/s1im">s1im</a>  ,     ). <br><br>  ,     : <br><br><pre> <code class="javascript hljs"> left: [ <span class="hljs-string"><span class="hljs-string">"partizan_left_1.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"partizan_left_2.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"partizan_left_3.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"partizan_left_4.png"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">right</span></span>: [ <span class="hljs-string"><span class="hljs-string">"partizan_right_1.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"partizan_right_2.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"partizan_right_3.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"partizan_right_4.png"</span></span> ]</code> </pre> <br>    ,    .       .        .         ,      : <br><br><pre> <code class="javascript hljs"> image: <span class="hljs-string"><span class="hljs-string">"partizan_left_1.png"</span></span> left: [ [ <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span> ], [ <span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">80</span></span> ], [ <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-number"><span class="hljs-number">120</span></span> ], [ <span class="hljs-number"><span class="hljs-number">120</span></span>, <span class="hljs-number"><span class="hljs-number">160</span></span> ] ], <span class="hljs-attr"><span class="hljs-attr">right</span></span>: [ [ <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span> ], [ <span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">80</span></span> ], [ <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-number"><span class="hljs-number">120</span></span> ], [ <span class="hljs-number"><span class="hljs-number">120</span></span>, <span class="hljs-number"><span class="hljs-number">160</span></span> ] ]</code> </pre> <br><br><ul><li>       </li><li>   ,    ,    </li><li>        (,  ) ‚Äî   .       Paint`  ,   .      (    40px). </li></ul><br><br>          ,          (     ).       .    : <br><br><pre> <code class="javascript hljs"> left: [ [ <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">34</span></span> ], [ <span class="hljs-number"><span class="hljs-number">34</span></span>, <span class="hljs-number"><span class="hljs-number">56</span></span> ], [ <span class="hljs-number"><span class="hljs-number">56</span></span>, <span class="hljs-number"><span class="hljs-number">89</span></span> ], [ <span class="hljs-number"><span class="hljs-number">89</span></span>, <span class="hljs-number"><span class="hljs-number">112</span></span> ] ],</code> </pre> <br>  ,    . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d8/0ed/49d/6d80ed49d7d2a6e706dd28de000ae4e7.jpg"><br><br>      background-size,     background-size  .        ¬´ ¬ª,   ,        ,     .     .   CSS  : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/abd/2c1/aea/abd2c1aeaef27424f25bc472954a3a7e.jpg"><br><br><ul><li>      .    ?         (    ‚Äî  ).       ‚Äî   . </li><li>     CSS  JS.  div`    <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"something"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"background-position: 50px 50px;"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>      ,    JS,     ‚Äî    CSS.      JS , ..  - .  ,    ,  ,    ,  -       JavaScript.      CSS   . </li></ul><br><br>    ,           404`  .   ,      ,    s1im (    ).          ,      .  ,       ,  ,        .        . <br><br>   ,  ,  ,       -  jQuery,       JavaScript -  ?         ? <br><br> <b> <a href="http://habrahabr.ru/users/VoVanJinn">VoVanJinn</a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I wanted to find out, ‚Äúhow to make a cat to crap with a rainbow‚Äù.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Answer: ‚Äú- Nothing‚Äù. I think this is a task for a one-time game that is solved with crutches, since to be like a rainbow to objects is not natural.</font></font> Since       ,     ,       . ,         ,      .     ,      .   ,     ‚Äî  .     ‚Äî       (     ,      ). <br><br> <b>¬´‚Äî Canvas    !?¬ª</b> <br><br> <b> </b>  <a href="http://habrahabr.ru/users/SerafimArts">SerafimArts</a>  <a href="http://habrahabr.ru/users/jetman">jetman</a> ,     LG Smart TV 2012    FPS Canvas`. : LG Smart TV 2012 (Netcast 3.0,  LM640T): 0-1 FPS,         . <br><br><h1>  At last </h1><br>   ,   .   ,   CSS    .  ,   : <br> <a href="">  1- </a> <br> <a href="http://rghost.ru/49971655">  2- </a> <br> <a href="">  3- </a> <br><br>        (  ,            ). <br><br>    .             .  ,      ‚Äî   ,      .          ‚Äì     . <br><br> <b> :</b>  ,       ,     ,   .   ,      ,  -         ,   API   .       ‚Äî   (,       ,    -   ). <br><br>      ‚Äî   ,  ,      .    ‚Äî     .    ,     Y (  ,      ,    ‚Äî            ).       ‚Äî     .      (    , ..      ,      ) <br><br> <b> </b> <a href="http://bakhirev.biz/StalinGrad/"></a> . </div><p>Source: <a href="https://habr.com/ru/post/201098/">https://habr.com/ru/post/201098/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../201080/index.html">Dell and Red Cross create a unique social media monitoring system.</a></li>
<li><a href="../201084/index.html">PrettyTasks - personal task manager for everyone</a></li>
<li><a href="../201086/index.html">Anti-piracy manifesto on the concept of a new social contract of copyright in the digital age</a></li>
<li><a href="../201090/index.html">Concept application Booking.com for iOS 7</a></li>
<li><a href="../201096/index.html">RabbitMQ tutorial 4 - Routing</a></li>
<li><a href="../201100/index.html">The basis of AI is human language</a></li>
<li><a href="../201102/index.html">GimBall - a flying robot that bounces off walls like a ball</a></li>
<li><a href="../201104/index.html">Data Center risks: we built, built and finally built ... Or actions on the construction site</a></li>
<li><a href="../201106/index.html">Megaphone has disabled sending sms with an alphabetic addressee</a></li>
<li><a href="../201108/index.html">Web performance: how Swish.com got 40% faster</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>