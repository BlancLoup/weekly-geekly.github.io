<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Another Tetris on JS (~ 30 "conditional" lines)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Inspired by the latest posts on Habr√© on the subject of writing minimalistic games in 30 lines, I also decided to try "insert my 5 kopecks", more prec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Another Tetris on JS (~ 30 "conditional" lines)</h1><div class="post__text post__text-html js-mediator-article">  Inspired by the latest posts on Habr√© on the subject of writing minimalistic games in 30 lines, I also decided to try "insert my 5 kopecks", more precisely, 30 lines of js-code.  The most suitable candidate seemed to me to be Tetris, moreover, it was always interesting to understand and implement its algorithm, but all hands did not reach. <br><br><img align="right" src="https://habrastorage.org/getpro/habr/post_images/c2b/221/59f/c2b22159fbcf518b7e74ede8ef4eb370.png"><br><br>  So, by the end of a sleepless night, another regular Tetris clone appeared in the world.  With a slight stretch, he squeezes into the given frames (30 lines), but these lines are still longer than I personally would like.  Those who want to try out in action and see the code can do it <a href="http://jsfiddle.net/headcutter/xkK43/">here</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Implementation features: <br><ul><li>  Control keyboard arrows </li><li>  Increase difficulty level every 5 lines </li><li>  Progressive scoring based on the number of rows filled at a time and the level of difficulty </li><li>  ‚ÄúHonest‚Äù clockwise rotation of blocks </li><li>  "Rebound" block when turning from obstacles </li><li>  Multicolored blocks </li><li>  Generation of a marking of a game field js-code </li></ul><br><a name="habracut"></a><br>  The game field is built on the basis of the table, and the blocks are drawn by changing the background color of a particular cell.  DOM manipulations are performed at the expense of the Table object, which is included in DOM 0, and provides the ability to access rows and cells directly through the rows and cells collections, respectively.  Thus, there is no need to search for items by their ID or classes.  In view of the fact that the internal representation of the playing field is stored as a two-dimensional array of numbers (values ‚Äã‚Äãdetermine the color of the cell), we have a direct correspondence of the data and their representations - and there, and there each specific cell can be accessed by its <b>x</b> and <b>y</b> .  Initially, the playing field is empty - the arrays are filled with zeros, and the cells have no background. <br><br>  Generation of html fields initially took more than a dozen lines, since it was implemented as a loop of the 2nd nesting and a pack of document.createElement calls, etc.  Closer to the final implementation of the basic algorithm of the game, it became very noticeable.  Of course, you could immediately insert the table in html, but it was somehow not sporty, and just lazy, because it was decided to abandon the functions provided by the DOM to create new elements, in favor of the good old innerHTML and gluing the table from lines.  For concatenating and repeating strings, the <b>Array.join</b> method is <b>used</b> and the fact that initialization of an array constructor by an integer results in an array filled with the specified number of <b>undefined</b> -s.  Similarly, a two-dimensional array is generated for the internal field representation. <br><br>  Descriptions of all types of blocks, and 7 pieces in classical Tetris, are stored as arrays of points containing offsets relative to the ‚Äúcenter‚Äù of the block itself - rotation occurs around this point, and the rotation algorithm itself was derived mostly empirically after an hour or two breaking the head on this.  Perhaps some of the readers will justify and explain more scientifically the results obtained, but for now briefly the basic idea: there are 4 positions of the block, obtained by turning it 90 degrees at each step, and the coordinates of its constituent points are transformed as follows: <br><br><ol><li>  (x, y) </li><li>  (-y, x) </li><li>  (-x, -y) </li><li>  (y, -x) </li></ol><br><br>  In fact, only 3 figures can be rotated in all 4 directions, the rest - only 2, and the cube cannot be rotated at all.  Rather, the algorithm is able to crank them, but it just does not look very nice, because part of the turns for specific figures is limited and their descriptions are ordered in the appropriate way (‚Äúcube‚Äù, ‚Äústick‚Äù, 2 zigzags ...). <br><br>  In order to make the code more compact, bitwise ANDs were actively used, since they allow to implement parity / oddness checking in a very concise form (checking the state of the low-order bit), as well as checking the 2nd and 3rd bits in some expressions.  For example, this is used in the keystroke handler and the block rotation algorithm. <br><br>  This ‚Äúreincarnation‚Äù of Tetris was built in a collective way, rooted in my childhood, partially borrowing something from the very first variant for me on ‚ÄúPC-01 Lviv‚Äù of the early 90s, the Chinese Brick Game and Dendy of the mid-90s of the past, and possibly a few more recent sediments of J2ME and Windows Mobile, the beginning of this century.  Other possible matches are completely random, and the author is not responsible for them. </div><p>Source: <a href="https://habr.com/ru/post/202860/">https://habr.com/ru/post/202860/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../202848/index.html">Havok holds a competition for mobile game developers.</a></li>
<li><a href="../202852/index.html">JS color eyedropper, 399 characters (not strings)</a></li>
<li><a href="../202854/index.html">Overview of expansion boards of the communication platform Aastra A400 (A470)</a></li>
<li><a href="../202856/index.html">Managerial tools: 16 concepts for each day</a></li>
<li><a href="../202858/index.html">Create a galaxy in 30 lines.</a></li>
<li><a href="../202864/index.html">Minimize apps to dock for lazy using AppleScript</a></li>
<li><a href="../202866/index.html">Meet Dependency Injection with the Dagger example</a></li>
<li><a href="../202868/index.html">Testing: a clear career choice</a></li>
<li><a href="../202870/index.html">Automate subtitle uploading from * .mkv files</a></li>
<li><a href="../202874/index.html">Tiny Tron on JS (30 lines of code)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>