<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Modest - development of an open-source HTML rendering engine on the ‚Äúbare‚Äù C</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! My name is Alexander Borisov and I am developing Modest - an open HTML-rendering engine on the ‚Äúbare‚Äù C without using external dependencies (he...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Modest - development of an open-source HTML rendering engine on the ‚Äúbare‚Äù C</h1><div class="post__text post__text-html js-mediator-article">  Hello!  My name is Alexander Borisov and I am developing <b>Modest</b> - an open HTML-rendering engine on the ‚Äúbare‚Äù C without using external dependencies (hereinafter the engine).  I just want to clarify what it means ‚Äúwithout external dependencies‚Äù - all code is written from scratch, the code is not borrowed anywhere. <br><img src="https://habrastorage.org/files/ea2/fb5/687/ea2fb5687aea466c9f1b3d1b00794a57.png"><br>  A lot of time has passed since my <a href="https://habrahabr.ru/post/279409/">last publication</a> .  During this time, much has changed and I want to share with you the achievements in development. <br><a name="habracut"></a><br><h2>  About the project </h2><br>  The main idea of ‚Äã‚Äãthe project is its simplicity, which means: <br><br>  - Ability to compile / install on any device where there is C <br>  - Work speed <br>  - The minimum possible resource consumption <br><br>  One of the end products of this development is a truly fast, easy, full-featured browser. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Everything in order </h2><br>  <b>Ability to compile / install on any device where there is C</b> <br><br>  The idea is not only to be able to compile / install on any piece of hardware, because C is almost everywhere, but also to be able to connect the engine to another programming language revealing the full range of API engine for this language.  Simply put, having the ability to easily make a binding for your programming language. <br><br>  What will the strapping in other languages ‚Äã‚Äãgive us? <br><br>  A simple and understandable API engine will allow us to directly work with HTML Tree, CSS, Render Tree / Layers (tree of drawing / layers) through our favorite programming language, without using JavaScript. <br><br>  In practice, this will mean the following: <br><br><ol><li>  High speed access, create, change elements / layers. </li><li>  Easy creation of interfaces, games, applications through a familiar programming language using all the features of HTML / DOM Events / CSS. </li></ol><br><div class="spoiler">  <b class="spoiler_title">Moreover, I went ahead and tested the following</b> <div class="spoiler_text">  At once I will make a reservation that this is just an experiment, why it may not be so clear in life, but it can be done. <br><br><ol><li>  Take a ready-made harness for Perl and change it </li><li>  Add Perl type to script script processing: &lt;script type = "Per"&gt; </li><li>  Parse html in Perl </li><li>  When the parser encounters a script tag of the Perl type, it executes this code in the current interpreter. </li></ol><br><br>  The Perl script is as follows: <br><pre><code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> utf8; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> strict; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> warnings; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> HTML::MyHTML::Fun; <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $html = <span class="hljs-keyword"><span class="hljs-keyword">q</span></span>~ &lt;div&gt; &lt;span&gt;text&lt;<span class="hljs-regexp"><span class="hljs-regexp">/span&gt; &lt;/div</span></span>&gt; &lt;script type=<span class="hljs-string"><span class="hljs-string">"Perl"</span></span>&gt; <span class="hljs-comment"><span class="hljs-comment"># $MyHTML_TREE global var my $nodes = $MyHTML_TREE-&gt;get_elements_by_tag_name("span"); foreach my $node (@$nodes) { $node-&gt;delete($MyHTML_TREE); } &lt;/script&gt; &lt;span&gt;footer&lt;/span&gt; ~; # parse HTML my $myhtml = HTML::MyHTML-&gt;new(MyHTML_OPTIONS_DEFAULT, 1); my $tree = $myhtml-&gt;new_tree(); $myhtml-&gt;parse($tree, MyHTML_ENCODING_UTF_8, $html);</span></span></code> </pre> <br>  Result of processing: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Perl"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">-text</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">: ... </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">-text</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">: footer</span></span></code> </pre><br></div></div><br>  <b>Work speed</b> <br><br>  Nobody likes to wait, and I especially.  One of the key points of development is to ensure fast processing of one or another part of HTML / CSS / Render.  For example, the average processing time of a typical page html is 0.001 sec., That is, 1ms, which is 1000 pages per second.  Parsing the bootstrap CSS file and its selectors costs about 1.5 ms.  At the moment we have the fastest full-fledged parser HTML and CSS.  And this is not the limit. <br><br>  <b>Minimum possible resource consumption</b> <br><br>  If, with the speed of work, everything is more or less clear, then with the consumption of resources everything is much more complicated.  Specifications usually "advise / require" all stored in memory.  More precisely not so, all the arguments go as if everything is at hand, everything is created. <br><br>  What is it manifested in? <br><br>  Take, for example, the <a href="https://drafts.csswg.org/css-syntax/">CSS syntax</a> specification.  She tells us that we need to create tokens for each character / sequence of characters and arrange them into groups, create groups of tokens.  To put it bluntly, we must create tokens for each character not included in the general tokenization rules (delim-token), as well as for each: ";", ":", "(", ")", "," and others , the full list of rules can be seen <a href="https://drafts.csswg.org/css-syntax/">here</a> . <br><br>  Agree that to create a token for each comma or semicolon is quite a wasteful exercise.  At the same time, it is worth noting that in the rules of tokenization of symbols there are conditions like these: having the current symbol, see that the following H are equal to X, otherwise create Y. <br><br>  Later, when all the tokens are created they need to be <a href="https://drafts.csswg.org/css-syntax/">parsed</a> .  That is, select groups from the sequence of created tokens.  And it is these groups that use CSS modules, <a href="https://drafts.csswg.org/">which are not small</a> . <br><br>  That's where the fun begins.  We have to fully comply with the specification, but do so in order not to create tokens for each other.  Not a little reading the specifications and wondering how not to create "extra" tokens and save memory, the following conditions have been formed: <br><br>  1) CSS parsing should support chunks, i.e. stream parsing.  This specification does not require, but it is important for further development. <br><br>  It is because of this condition that we do not know when the data stream will end, for us it is infinite.  That is, at any time we are guaranteed to have only the current and all previous characters, but we have no idea what's next, and accordingly we can‚Äôt look at the condition ‚Äúif the A symbol has arrived, then see if there is a further opening bracket‚Äù. <br><br>  2) We do not create all tokens, we create only one, which will continue to be overwritten in the future.  At any given time, we have only one token, the current token.  Accordingly, we can not see the previous or next token, they are not.  At first, this seemed to be a problem, since the specification doesn‚Äôt have enough conditions like ‚Äúif token X arrives, then look at the following three tokens, and if they are not H then Y‚Äù. <br><br>  All of the above is implemented in MyCSS.  Already, MyCSS successfully parses selectors and some CSS properties while consuming minimal amounts of memory.  Accordingly, if we do not constantly go for the "pieces" of memory, then our speed will increase significantly. <br><br>  And in the appendix to all of the above, the MyCSS parser retained clarity, flexibility, ease in further developing modules to it. <br><br>  By the way, in MyHTML everything is implemented exactly the opposite.  There is an emphasis on creating tokens and further work with them.  This clearly shows that in such a matter as writing an HTML renderer you cannot use the ‚Äúsilver bullet‚Äù.  Everywhere need an individual approach.  Well, of course, all this can not be created without a full understanding of the specifications and what is required in the specification. <br><br><h2>  Current project structure </h2><br>  Currently the following parts of the project are implemented: <br><br><ol><li>  MyHTML - HTML parser </li><li>  MyCSS - CSS parser (Selectors, Values, Namespace, Property) </li><li>  MyFONT - parser for .otf and .fft files.  Getting metrics for glyphs: width, height, baseline, x-height and others.  It is worth noting that here we are talking about the size of characters, as in browsers.  <a href="">See an example</a> . </li></ol><br><h2>  About selectors </h2><br>  I see no point in writing a separate article on selectors, but I want to boast.  Already, you can use selectors to find nodes in the tree: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> &gt; <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:nth-child(2n+1)</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:not(</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:has(a))</span></span></code> </pre><br>  or list of comma comma <br><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.header</span></span>, <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:nth-child(2n+2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">of</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:not(</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[id]</span></span>)) &gt;&gt; <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:not(</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:has(</span></span>&gt; <span class="hljs-selector-attr"><span class="hljs-selector-attr">[class ~= "bukabyaka" i]</span></span>))</code> </pre><br>  They work pretty fast.  Above, the first, given selector on a typical article, a habr works for 0.00015 sec., That is, for 0.15ms, and finds 247 elements.  This time includes parsing CSS, parsing and creating selectors, searching the tree.  You can create a selector in advance and reuse it, which will reduce the work time. <br><br>  Currently, all selectors from the specification of the quadruple version ( <a href="https://drafts.csswg.org/selectors/">Selectors 4</a> ) are supported except: <br><br><ol><li>  All pseudo-elements </li><li>  : dir,: lang,: scope, "Time-dimensional Pseudo-classes",: drop </li><li>  : nth-column,: nth-last-column </li></ol><br>  The first and second will be developed / added as the engine is developed.  The third hands did not reach, but, of course, they will also be implemented in the near future. <br><br><h2>  Future of the project </h2><br>  It (the future) seems very bright.  I am engaged in the project during working hours.  My employer allowed me to spend all the work time on the project, of course, if you are asked to do something, you have to be distracted. <br><br>  Now, I started to create a rendering tree (Render Tree, Layers).  That is, in the near future, it will be possible to receive calculated metrics for HTML nodes, such as width, height, font-size, border-color, and others. <br><br>  There are a lot of ideas, and there is even more ‚Äúgasoline‚Äù in me!  Thanks for attention! <br><br>  <strong>PS:</strong> If someone has a desire to help / participate in the project, you can safely write to the <a href="">post office</a> . <br><br>  References: <br><br>  " <a href="https://github.com/lexborisov/Modest">Modest</a> <br>  ¬ª <a href="https://github.com/lexborisov/Modest/tree/master/examples">Modest Examples</a> <br>  ¬ª <a href="https://github.com/lexborisov/myhtml/tree/master/examples">MyHTML Examples</a> <br>  ¬ª <a href="https://github.com/lexborisov/mycss/tree/master/examples">MyCSS Examples</a> <br>  ¬ªMyHTML Binding for Perl </div><p>Source: <a href="https://habr.com/ru/post/309756/">https://habr.com/ru/post/309756/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../309746/index.html">ESP32: Getting to know, writing and launching the first firmware</a></li>
<li><a href="../309748/index.html">A cool online business idea. How to make money on someone else's name, someone else's site, and even without a product</a></li>
<li><a href="../309750/index.html">Open platform for developers of open source projects</a></li>
<li><a href="../309752/index.html">Refactoring sequential checks in Mockito using fluent interfaces</a></li>
<li><a href="../309754/index.html">Email Marketing: Recipe for Correct Plain-Text Letters</a></li>
<li><a href="../309758/index.html">Shared Folders in OpenVZ 7.0</a></li>
<li><a href="../309760/index.html">How does the Center for the operational management of the MTS mobile network. Answers to your questions</a></li>
<li><a href="../309762/index.html">Home word splitting algorithm (with pictures)</a></li>
<li><a href="../309764/index.html">Susan Wojitsky: From CS50 Student to CEO Youtube</a></li>
<li><a href="../309768/index.html">Terabytes and tebibytes, traffic rating, the consequences of not understanding the difference and how to save on a video online project</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>