<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Fresh impressions of the BlackBerry 10 NDK</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For the last two weeks, I‚Äôve been digging into BlackBerry 10 NDK again, as one of my clients asked for help. I offered to adapt my ‚Äúintroduction to Qt...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Fresh impressions of the BlackBerry 10 NDK</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/6fe/544/255/6fe5442552e31c7775488417cba3188a.png" alt="image"><br><br>  For the last two weeks, I‚Äôve been digging into BlackBerry 10 NDK again, as one of my clients asked for help.  I offered to adapt my ‚Äúintroduction to Qt‚Äù course to the BlackBerry platform, and also recommended following the tips from my <a href="http://www.youtube.com/watch%3Fv%3D-ViNlh6RqvQ">series of BB10 and Cascades training videos</a> published on YouTube earlier this year.  Now I want to share with you my fresh impressions of the BlackBerry 10 NDK.  By the way, I already wrote about my <i>first</i> <a href="http://meetingcpp.com/index.php/br/items/a-closer-look-at-blackberry-10-cascades-sdk.html">experiments with BB10 NDK</a> this spring. <br><br>  <i>Attention.</i>  <i>This is a free translation of Jans Weller‚Äôs <a href="http://meetingcpp.com/index.php/br/items/revisiting-blackberry-10-ndk.html">note</a> .</i>  <i>The translation was made to create a general picture of the current state of the world [BB10 + Qt].</i>  <i>Enjoy reading.</i> <br><a name="habracut"></a><br><h5>  <font color="#1e6aaf">Applications and C ++</font> </h5><br>  Before you begin, a brief introduction about applications and C ++.  People migrating from other languages, like Java or .NET, often do not understand the need to write applications in C ++.  Especially moving from languages ‚Äã‚Äãforcibly linked to OOP and Garbage Collector - it‚Äôs not easy for them to understand all the concepts used in C ++.  In my opinion, in fact, there are many reasons to use C ++ for developing applications, especially in conjunction with such a powerful Qt framework.  One of the reasons is performance, since C ++ is really closer to hardware, your application will eat a minimum of battery power.  Not to mention the fact that there is a ceiling on the growth of device performance in the future, mentioned this <i>.</i> <a href="https://habrahabr.ru/users/webmascon/" class="user_link">Gert</a> Sutter in his note <a href="http://www.gotw.ca/publications/concurrency-ddj.htm">‚Äúfree rations ended‚Äù</a>  The Qt Framework is now available for both Android and iOS, so C ++ and Qt / QML have become a really powerful combination for building mobile apps. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  <font color="#1e6aaf">NDK and Cascades</font> </h5><br>  Therefore, when you develop applications for BlackBerry 10, you need to start with <a href="http://developer.blackberry.com/native/">BlackBerry NDK</a> .  I didn‚Äôt have enough time to play with the freshly hung version 1.2, but at first glance IDE became noticeably better and more stable.  But 1.2 has not yet received the ‚Äúgolden‚Äù status (fixing the API, it <a href="http://developer.blackberry.com/native/downloads/releasenotes/">has already received</a> - <i>approx. Translator</i> ), so I recommend writing under 1.1, unless you need something from 1.2.  The BlackBerry NDK comes with the Cascades Framework, the API of which you will use when developing an application for BB10.  Cascades is made on top of Qt and uses QML, while Qt5 has QtQuick 2, because BlackBerry has its own implementation of QML running in a UI stream.  So QML created under QtQuick1 or 2 will not work under Cascades.  And Qt5 is not fully supported by Cascades - the current version is based on Qt 4.8. <br><br>  Since 2010, I have been interested in mobile development in Qt and QML, MeeGo used to be busy, and now I'm with BlackBerry.  QML in BB10 is slightly different, it uses special elements, for example: Container, Pages and Controls, while in QtQuick1 / 2 it offers quite basic elements like Item or Rectangle.  So for QML and its API, BlackBerry has its own little world.  In the meantime, Qt5 applications can be built and run on the BB10, although this will not be accompanied by the degree of integration that Cascades offers. <br><br><h5>  <font color="#1e6aaf">QML and C ++</font> </h5><br>  Judging by the documentation and discussions, the basic approach comes down to using QML for most tasks and bridges in C ++ only when necessary.  For example, when writing models in C ++ and declaring class methods using <code>Q_PROPERTY</code> to access their QML.  Then most of the work happens on the QML side.  QML has some verification methods and error checks, for example console.assert, but since QML is translated in JavaScript and does not have a strong typing, therefore, it cannot verify the type conformity.  A typo in the variable name will lead to the fact that QML may not notice this error, and calculate this variable as declared new.  A simple example: <br><br><pre> <code class="cpp hljs">Container { layout: DockLayout { } Label{ text:ListItemData.titel } }</code> </pre><br>  This element is simple to display in the <code>ListView</code> container. Through <code>ListItemData</code> we get access to the data to be displayed.  I made a small mistake here, in fact, the element is called the <code>title</code> , and <code>titel</code> is in German.  Moreover, the German did not immediately notice.  And QML will not notice the more.  You can insert any word here, QML does not check for this kind of error, not at compile time or at run time.  Nothing will be displayed, perhaps you are lucky to find a warning in the console.  By the way, if you configure the IDE correctly, the message should appear exactly, even when debugging on the device. <br><br>  How to deal with it?  Cascades hides a C ++ framework built on Qt, so at least in C ++ we have a chance to detect this and record the error.  Unfortunately, this cannot be detected at compile time, but I am working in this direction.  So <code>Q_ASSERT</code> does the checking while the application is running.  For all elements of Cascades involved in QML, there is a class in C ++ that instantiates dynamically for each element during the execution of the application.  The Cascades API allows you to search for objects of these classes and provides a way to control certain things.  <code>ListView</code> also has a class that supplies items for a <code>ListView</code> from C ++: <code>ListItemProvider</code> .  This class has its own interface: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> bb::cascades::<span class="hljs-function"><span class="hljs-function">VisualNode* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bb::cascades::ListView* listview,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QString&amp; type)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bb::cascades::ListView* listview,bb::cascades::VisualNode* node,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QString&amp; type,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QVariantList&amp; indexPath, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QVariant&amp; data)</span></span></span></span>;</code> </pre><br>  Its implementation of these virtual methods allows you to create elements for display in the ListView and also fill them with actual values.  BlackBerry provides examples of implementation.  Unfortunately, these examples do not use QML, but are written entirely in C ++.  But I personally like to use QML for UI.  And still such OOP-style, as in the example from BlackBerry, implies inheritance from <code>ListItemProvider</code> for each individual <code>ListView</code> , and I would like to solve this problem once and for all, so I have my own generic <code>ListItemProvider</code> .  Since all checks occur while the application is running, C ++ templates are not an option, let's take a look at the following implementation.  Before I go to crateItem, a brief install on addType, an auxiliary method for declaring handlers for each type: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ListViewItemProvider::addType(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QString&amp; type, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QString&amp; qmlasset, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> listitem_callback&amp; callback) { bb::cascades::QmlDocument* doc = bb::cascades::QmlDocument::create(qmlasset); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!doc-&gt;hasErrors()) { doc-&gt;setParent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); type_map.insert(type,doc); callback_map.insert(type,callback); }<span class="hljs-comment"><span class="hljs-comment">//TODO add additional error checking &amp; handling }</span></span></code> </pre><br>  This method adds different handlers for different types.  Types are defined in QML using <code>QString</code> objects, so <code>QMap&lt;QString, QmlDocument*&gt;</code> will be sufficient to store the supported types.  This method converts a qml-resource (for example, <code>file:///partial.qml</code> - <i>approx. Translator</i> ) into a <code>QmlDocument</code> using <code>QmlDocument::create</code> .  By the way, <code>QmlDocument::create</code> does not actually return a <code>QmlDocument*</code> , as written in the example above.  It returns a reference to the utility class <code>Builder</code> to create a <code>QmlDocument</code> 's, then it looks like it produces an implicit conversion to <code>QmlDocument*</code> .  In principle, there is nothing interesting here, let's go further, the <code>createItem</code> method: <br><br><pre> <code class="cpp hljs">bb::cascades::VisualNode* ListViewItemProvider::createItem(bb::cascades::ListView* listview,<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QString&amp; type) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(type_map.find(type)!=type_map.end()) { bb::cascades::Container* node = type_map[type]-&gt;createRootObject&lt;bb::cascades::Container&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> node; } Q_ASSERT_X(<span class="hljs-literal"><span class="hljs-literal">false</span></span>,__FUNCTION__,type +<span class="hljs-string"><span class="hljs-string">" TYPE not handled"</span></span>); bb::cascades::Container* con = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bb::cascades::Container(<span class="hljs-number"><span class="hljs-number">0</span></span>); bb::cascades::Label* label = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bb::cascades::Label(con); label-&gt;setText(<span class="hljs-string"><span class="hljs-string">"ERROR"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> con; }</code> </pre><br>  This code first checks the type registration, and then creates an object through the <code>QmlDocument::createRootObject</code> , which returns a pointer to the created object.  This is a template, so we need to know in advance the type of object to create.  So far I have decided for myself that for all UI elements I will use the <code>Container</code> as the root object.  Perhaps the <code>VisualNode*</code> type, which is the return value of the <code>createItem</code> method, is also suitable here.  The most interesting thing here is error handling, how should we do this?  Here <code>Q_ASSERT_X</code> comes to the <code>Q_ASSERT_X</code> and notifies you of an error.  But in the case of assembly without debugging, it will not tell anything, and nevertheless the method should return some value.  About 0 does not say anything in the documentation, so there is no reason to think that this is the correct return value for this method.  But the documentation clearly states that the returned pointer will belong to the <code>ListView</code> Even if we return 0 (fortunately, the BB10 developers provided for it), this will hide the error from the tester.  So I decided to return a small <code>Container</code> with a <code>Label</code> with an error text.  Maybe I could formulate the message better, but in this version the tester will notice this error more likely.  Alternatively, an exception could be thrown, but after that, control is transferred back to the Cascades API and Qt, and this is not the best option, since Qt and Cascades do not use exceptions, although they are supported in BB10. <br><br>  The last thing to implement is the <code>updateItem</code> method.  And again it does not work out easier, because we are writing generic code.  In the end, the loaded QML file must be loaded with the correct values, which was also one of the reasons why I decided to <s>write a bicycle to</s> implement a generalized approach.  But there is an option to borrow the implementation for this directly from our class - we registered callbacks and create objects of the necessary types, now it remains to simply call the corresponding callback in the <code>updateItem</code> method: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(callback_map.find(type)!=callback_map.end()) { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> USE_BOOST (*callback_map[type])(node,indexPath,data); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> callback_map[type](node,indexPath,data); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> }</span></span></code> </pre><br>  Up to this point, I could not use / hide the USE_BOOST <code>USE_BOOST</code> , but for such a callback, the C ++ programmer must first consider <code>boost::function</code> .  And since BlackBerry claims that <a href="http://ru.wikipedia.org/wiki/Boost">boost is</a> supported, I certainly use it.  And here it turns out that it is not so easy, at least my toolbar falls with an error in <code>boost/type_traits/detail/cv_trait_impl.hpp</code> .  I know that boost is being used by many, so this is most likely an error due to the settings of my system or the Linux distribution.  The error seems to come from the preprocessor, on the GCC version 4.6.3, the error text says about the mismatch of the brackets.  I preferred to patch my version of boost on the local machine and reported this to the boost community and to the BlackBerry.  If you use boost under BB10, then you better use <a href="https://github.com/blackberry/Boost">the boost version from GitHub's BlackBerry</a> .  Since not everyone needs a boost, I also made a version without it, just in case the boost breaks again. <br><br>  And last but not least, the implementation of callback'a: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ApplicationUI::callbackMyListItem(bb::cascades::VisualNode* node,<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QVariantList&amp; indexPath, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QVariant&amp; data) { bb::cascades::ImageView* image = node-&gt;findChild&lt;bb::cascades::ImageView*&gt;(<span class="hljs-string"><span class="hljs-string">"imageview"</span></span>); Q_ASSERT(image); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(image) { QString name_image = <span class="hljs-string"><span class="hljs-string">"image"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//this must be correct! QVariantMap map = data.toMap(); bool hasdata = map.contains(name_image); Q_ASSERT(hasdata); if(hasdata) image-&gt;setImageSource(map[name_image].toUrl()); } }</span></span></code> </pre><br>  In this case, the path to the image is set.  A pointer to a <code>VisualNode</code> inherited from a <code>QObject</code> , so the child objects can be obtained via <code>findChild</code> , which returns 0 if nothing is found.  Therefore it is appropriate to use <code>Q_ASSERT</code> here to test this case.  Then there is a search for data in <code>QVariantMap</code> .  Since, in any case, we need some image, we check the presence of an element in the QVariantMap container.  If not, then <code>Q_ASSERT</code> comes to the rescue again.  This callback is simply registered with <code>boost::bind</code> . <br><br>  The search for values ‚Äã‚Äãcan also be implemented through the model, but the BB10 does not support regular models from Qt, instead BlackBerry implemented its model classes.  In general, this is good, but I personally prefer models from Qt, the more it would allow to use them when porting Qt applications for Android, iOS, PC / Mac or even Jolla.  <a href="http://www.kdab.com/">KDAB</a> - one of our "gold" sponsors - has published a solution that eliminates this misunderstanding and makes Qt-models <a href="http://www.kdab.com/using-qabstractitemmodel-with-cascades-on-bb10/">suitable for use in Cascades</a> . <br><br><h5>  <font color="#1e6aaf">IDE</font> </h5><br>  Now, a few words about IDE.  As I said earlier, IDE has improved with the release of version 1.2.  The environment is improving, but in some cases it still remains far from perfect.  The QML editor is still not good enough, but now it does not drop the entire IDE when it is dropped.  An alternative could be Qt Creator, in which QML support has also improved.  At the moment, I think Momentics IDE (based on Elipse - <i>approx. Translator</i> ) from BlackBerry is better than QtCreator, if we are talking about the development under Cascades.  First of all, there is no integration with Cascades at all in QtCreator, therefore QML autocompletion will not work, because the NDK does not have the necessary file for this.  For the same reason, the visual QML editor will not work.  Qt, of course, is slightly better supported in QtCreator, but in version 1.2 of the NDK there are indeed many improvements in this direction.  The project templates offered by QtCreator are not as good as in Momentics, for example, they lack integration of the localization code.  I like the fact that templates in Momentics include QTranslator in <code>main.cpp</code> .  Momentics and QtCreator can create a working application for my DevAlpha device, so development under BB10 in QtCreator is possible, but there is room to grow. <br><br>  I downloaded the <a href="">ListViewItemProvider</a> source codes if you need ... <br><br><h5>  <font color="#1e6aaf">Popular comments (1 pcs)</font> </h5><br>  - Who wants to visit the morgue? </div><p>Source: <a href="https://habr.com/ru/post/192064/">https://habr.com/ru/post/192064/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../192048/index.html">iPhone, meet Haskell</a></li>
<li><a href="../192052/index.html">Russian privileges for calculating machines from 1880 to 1895</a></li>
<li><a href="../192054/index.html">Getting root access in Mac OS X without a password</a></li>
<li><a href="../192056/index.html">October 27-29, 2013: Samsung Developer Conference</a></li>
<li><a href="../192062/index.html">Notes iOS developer: Sharing experience, part 1</a></li>
<li><a href="../192066/index.html">Imagination will release server MIPS processors by the end of 2014</a></li>
<li><a href="../192068/index.html">Major update HabraDesigner</a></li>
<li><a href="../192070/index.html">[Post] Friday - dictionary with Lettered.Me</a></li>
<li><a href="../192076/index.html">Learning Tarantool + Lua</a></li>
<li><a href="../192078/index.html">Computer History Museum</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>