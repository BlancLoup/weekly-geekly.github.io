<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Centralized configuration management: Puppet + Foreman. Part II</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the second part of a series of articles about the Puppet + Foreman bundle, it will cover the following: 

 * Creating host groups 
 * Adding a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">🔎</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">📜</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">⬆️</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">⬇️</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Centralized configuration management: Puppet + Foreman. Part II</h1><div class="post__text post__text-html js-mediator-article">  This is the second <a href="http://habrahabr.ru/post/267617/">part</a> of a series of articles about the Puppet + Foreman bundle, it will cover the following: <br><br>  * Creating host groups <br>  * Adding a host to a group <br>  * Apply manifests per host group <br>  * Auto-signing certificates <br>  * Automatic distribution of hosts in groups <br><a name="habracut"></a><br><br>  To create a group of hosts, go to Foreman and select “Settings” - “Groups of nodes” - “New groups of nodes” in the menu, we will have a page with settings of a new group.  Here you can choose the parent of the group (that is, it turns out you can make group attachments), the name (in our case, Bobrovka), the environment, the certification authority and the master server, choose our Puppet server. <br><img src="https://habrastorage.org/files/c78/6b3/ff6/c786b3ff663b451a9e7fce7d7595738b.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If we want to immediately add the manifests that will be applied to the group - go to the "Puppet Classes" tab - here everything is the same with the manifest applied to a single client, only the manifest will be applied to all the hosts included in the group.  We confirm the changes. <br><img src="https://habrastorage.org/files/952/019/253/9520192539be4bfe8c18abdc4d7f089a.png"><br><br>  Now if we go to “Setup” - Groups of nodes "- we will see a list of our groups. <br><img src="https://habrastorage.org/files/2a0/eeb/911/2a0eeb91181744e89e15d4b7f550d210.png"><br><br>  In order to add an existing host to a specific group - go to “Nodes” - “All nodes”, click on the name of the node we need (detailed information about the node opens) and click the “Change” button and in the “Group” field select the group we need .  We confirm the changes. <br><img src="https://habrastorage.org/files/663/3a4/b1f/6633a4b1f8b8408cbc76e5255a30ade6.png"><br><br>  After we have added the hosts we need to the group, we can add manifests for them (if you did not do this when creating the group).  To add a manifest to an existing group, go to “Settings” - “Groups of nodes” - click on the name of the group we need and repeat the procedure described 3 paragraphs back. <br><br>  So - we have a working server with a bunch of Puppet + Foreman, but if we want to add a new host to Puppet, we have to sign certificates every time (it strains me) in the web interface or in the console.  In order for certificates to be signed automatically, you can use the option of automatically signing certificates based on the client's name.  To do this, go to the menu "Infrastructure" - "Smart Proxies" click on "Certificates" and in the upper right click "Records autosign" - create a new record.  In the field where the name is written - we write * and save. <br><img src="https://habrastorage.org/files/986/9da/687/9869da68786947279a71de956a625597.png"><br><br>  As a result, we will have to sign all client certificates without exceptions, which is not very good (but for the beginning it will do).  To sign not all certificates, for example, only certificates from web servers, you need to change the entry to web - * (this will work if you have all web servers named like www-1.domain.name, www-n.domain.name). <br><br>  For automatic distribution of newly created hosts into groups, you can use the foreman_default_hostgroup plugin.  This plugin allows you to distribute hosts into groups based on facts. <br>  To install the plugin you need to run the command <b>apt-get install ruby-foreman-default-hostgroup</b> <br>  If the plugin is installed - it will be displayed in the “Administrator” - “About the program” menu in the “Modules” tab (perhaps you need to restart Foreman) <br><img src="https://habrastorage.org/files/1b3/5e4/9e1/1b35e49e1012407d810fc6954025ed59.png"><br><br>  After installation, you need to edit the file in the /usr/share/foreman/config/settings.plugins.d/default_hostgroup.yaml directory <br><br><div class="spoiler">  <b class="spoiler_title">default_hostgroup.yaml</b> <div class="spoiler_text">  -: default_hostgroup: <br>  : facts_map: <br>  "Bobrovka": <br>  Ipaddress: 10.10. * <br>  "Losovka": <br>  “Ipaddress”: “10.110.0. *” <br>  "Medvedka": <br>  “Ipaddress”: “10.210.0. *” <br>  "Default": <br>  "Hostname": ". *" <br></div></div><br>  If you use my config from the plugin, then you will have to sort by groups based on the client's IP address.  In this example - if the client has an IP of 10.10.55.12 - he will be in the “Bobrovka” group, if he has the address 10.210.138.7 - he will be in the “Medvedka” group, if the client’s IP address does not fall under any of the conditions - he falls into the group "Default".  The plugin reads the config from top to bottom, so the “Default” group is at the very bottom, since absolutely all IP addresses fall under its criteria. <br><br>  This concludes the second part of my publication. <br>  The result of our work is a working Puppet + Foreman with the ability to automatically sign certificates and distribute hosts into groups based on facts. <br><br>  Resources used: <br>  <a href="https://docs.puppetlabs.com/puppet/latest/reference/config_file_autosign.html">docs.puppetlabs.com/puppet/latest/reference/config_file_autosign.html</a> <br>  <a href="https://github.com/GregSutcliffe/foreman_default_hostgroup">github.com/GregSutcliffe/foreman_default_hostgroup</a> </div><p>Source: <a href="https://habr.com/ru/post/267713/">https://habr.com/ru/post/267713/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267703/index.html">Putting gnome-screenshot from source to change the format of the screenshot file name</a></li>
<li><a href="../267705/index.html">Violet M-125</a></li>
<li><a href="../267707/index.html">Game client download tracking system</a></li>
<li><a href="../267709/index.html">Oracle hardware and software systems - open topic</a></li>
<li><a href="../267711/index.html">The benefits of iron, or familiarity with GPS / GLONASS trackers</a></li>
<li><a href="../267715/index.html">Why Vue?</a></li>
<li><a href="../267717/index.html">Unicorns ... Unicorns everywhere</a></li>
<li><a href="../267719/index.html">Algorithms in the real world</a></li>
<li><a href="../267721/index.html">Apache vs Nginx: a practical look</a></li>
<li><a href="../267723/index.html">Bots in the city of Innopolis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>