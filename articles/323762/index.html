<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Internet of Things in archeology</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to introduce you to Stas Pavlov , our IoT expert, who has selected several interesting technological stories that have appeared in the framewor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Internet of Things in archeology</h1><div class="post__text post__text-html js-mediator-article">  I want to introduce you to <a href="https://habrahabr.ru/users/stasus/">Stas Pavlov</a> , our IoT expert, who has selected several interesting technological stories that have appeared in the framework of Microsoft Technical Case Studies.  All the results of work on it can be found on <a href="https://aka.ms/habr_323762_3">GitHub</a> .  Stas was interested in this material because IoT technologies were used in an unusual place - to monitor the state of the ancient <a href="https://aka.ms/habr_323762_2">mitreum</a> in Rome.  Inside you will find some history of ancient Rome and a lot of Internet of things. <br><br><img src="https://habrastorage.org/files/3a5/6c6/ec1/3a56c6ec1811439eb081b416e8ea3fea.jpg"><br><a name="habracut"></a><br><h2>  Cycle of Microsoft Technical Case Studies </h2><br>  1. <a href="https://habrahabr.ru/company/microsoft/blog/323200/">Power BI Embedded, IoT and machine learning for processing brain thermograms</a> . <br>  2. <a href="https://habrahabr.ru/company/microsoft/blog/322172/">As in Canada, looking for missing children</a> . <br>  3. <a href="https://habrahabr.ru/company/microsoft/blog/323762/">Internet of things in archeology</a> . <br>  4. Loading ... <br><br><h2>  Introduction </h2><br>  This project refers to the study of an important archaeological monument of Rome - Mitreum, located under the stands of the Great Circus.  The work was carried out in conjunction with <a href="https://aka.ms/habr_323762_1">the Technical University of Milan (PoliMi)</a> - the University of Science and Technology, which graduates engineers, architects and industrial designers.  In addition to the university, the city department of cultural heritage (Sovrintendenza Capitolina) and the University of Trieste also participated in the work. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We collected the readings of sensors installed inside the mitreum to remotely monitor the carbon dioxide concentration, vibration level, temperature and humidity. <br><br>  Mithrum has been preserved in good condition to this day.  It was first discovered in the 1930s during the restoration of the Rome Opera House.  The building dates from the II century BC.  e.  She probably rebuilt many times.  In the III century BC.  e.  its lower floor was set aside under the sanctuary - mitreum. <br><br><img src="https://habrastorage.org/files/ac5/a93/2e4/ac5a932e4c1f49f3bc2b0209ac4d9b5f.jpg"><br>  <i>Mitreum in the Great Circus (Rome)</i> <br><br>  The following IoT devices and technologies were used in the project: <br><br><ul><li>  Special sensors installed in the mitreum: accelerometer (on the device), thermometer (MCP9700A), hygrometer (808H5V5), carbon dioxide sensor (TGS4161), soil thermometer (PT1000) and photoresistor (VT43N2). </li><li>  Libelium Waspmotes as a computational module for sensors. </li><li>  Raspberry Pi 2 running Raspbian OS with Mono software and a C # console application as a field gateway. </li><li>  802.15.4 for low speed wireless networks for sensor and gateway communications. </li><li>  Azure IoT Hub for receiving data: one message every 30 minutes. </li><li>  Azure Stream Analytics for data transfer to the database and Power BI. </li><li>  SQL Azure database for data storage. </li><li>  Power BI Embedded. </li><li>  Publicly accessible data visualization in Azure App Service. </li></ul><br><h2>  Formulation of the problem </h2><br>  The main task of this project is remote monitoring of the current state of mitreum with the help of special sensors installed inside this architectural monument.  Among them are accelerometers, carbon dioxide sensors, temperature and humidity.  The data is transmitted to the field gateway, and then to the cloud infrastructure for the purpose of publishing it in visual form on a regular web page. <br><br><img src="https://habrastorage.org/files/625/cd9/d7e/625cd9d7e08f4a5f819d2c1ccc285ecc.png"><br>  <i>Visualization of data on the website</i> <br><br>  For PoliMi, the monitoring of mitreum was the first project on the way to creating a reference system for collecting data from archaeological sites.  In the future, it will use different types of sensors, gateways and a single cloud architecture built for this project, so this project used IoT technologies potentially useful for the following developments. <br><br>  The main goals of this project are: <br><br><ul><li>  Find a scalable solution that can be applied at different archaeological sites. </li><li>  Integrate cloud infrastructure with gateways and sensors installed locally.  Solve interoperability issues that have arisen in this project. </li><li>  Find a solution so that any user can see the monitoring data from anywhere. </li></ul><br><h2>  Sensors and Gateway </h2><br>  First of all, we held several Skype meetings to more accurately define the tasks and understand the current state of the project.  When we started creating cloud architecture, the PoliMi staff had already chosen the sensors and installed them in the mitreum. <br><br><img src="https://habrastorage.org/files/4dd/a07/e42/4dda07e42fa64a8d90e6723c650735b7.png"><br>  <i>The location of the sensors in the mitreum</i> <br><br>  At regular intervals (depending on the selected frequency in milliseconds), the sensors send small data sets to the field gateway, where they are processed locally.  As can be seen from the table below, the size of each message is quite small, so every 30 minutes the data is grouped into a single file in the .txt format containing all the sensor readings.  The C # console application processes the resulting file, after which the structured data is sent to the Azure IoT Hub. <br><br><img src="https://habrastorage.org/files/79e/8e8/659/79e8e8659421438fa2cd4bbb60d2ea25.png"><br>  <i>Characteristics of sensors in mitreum</i> <br><br>  Based on this data, we were able to calculate the monthly cost of the entire cloud infrastructure prior to its deployment, using the Azure price calculator.  This initiative, highly appreciated by the client, allowed to continue work on the project.  Of course, other advantages also played a role: easy deployment, scaling and transfer of the solution, project support by highly qualified Microsoft employees. <br><br><img src="https://habrastorage.org/files/e13/6e6/2d0/e136e62d0c2a4d5cb0d119c87ff231a3.png"><br>  <i>Cost calculation</i> <br><br><h2>  Difficulties in project development </h2><br>  One of the most serious tasks in this project was the data analysis.  It was necessary to separate the readings of all the sensors collected in a text file in order to create the correct message to be sent to the IoT Hub.  In solving this problem, we were very helped by the specialists of the PoliMi University.  Having clearly understood and defined the message structure, we were able to visualize the data correctly. <br><br>  Another major challenge was the integration of cloud infrastructure with sensors and a gateway. <br>  We worked together with the client, using various forms of communication: several conferences in Skype, personal meetings, remote development and discussion.  In total, we spent about 10 full working days on all stages of the project, including design, development and testing.  During this time we organized the implementation of the system and created a comprehensive solution. <br><br><img src="https://habrastorage.org/files/718/9c4/662/7189c46629f644e6949362d6d2dff029.jpg"><br>  <i>Full-time meeting with Kostab and Luka</i> <br><br><h2>  Solution and its stages </h2><br>  As described above, four kinds of sensors send data to the field gateway at the frequency indicated on the solution diagram below. <br><br>  The network gateway connects to the Azure IoT Hub and sends approximately 1 KB of data every 30 minutes.  We chose MQTT as the protocol, since it is widely distributed and convenient for use with the models of the nodes of this project. <br><br>  Azure Stream Analytics processes the data stream and sends the measurement results to the appropriate SQL database table. <br><br>  The web application publishes Power BI reports so that end users (PoliMi specialists) get visualized data. <br><br><img src="https://habrastorage.org/files/2a8/4d4/2ea/2a84d42eae4041908ede34d35b5e3433.png"><br>  <i>Project Architecture</i> <br><br><h2>  Data for analysis </h2><br>  10 <a href="https://aka.ms/habr_323762_4">Libelium Waspmote</a> sensors were used for data collection.  Their type was chosen by archaeologists and staff responsible for the restoration of the object.  Libelium sensor models for the Waspmote computing device were used, including: <br><br><ul><li>  Accelerometer </li><li>  <a href="https://aka.ms/habr_323762_5">Thermometer</a> </li><li>  <a href="https://aka.ms/habr_323762_6">Hygrometer</a> </li><li>  <a href="https://aka.ms/habr_323762_7">Carbon dioxide sensor</a> </li><li>  <a href="https://aka.ms/habr_323762_8">Photoresistor</a> (VT43N2) </li><li>  Soil Thermometer (PT1000) </li></ul><br>  The readings are transmitted to the device Raspbery Pi 2, running under the operating system Raspbian and acting as a field gateway. <br><br>  The choice of OS was determined by the preferences of the client, who had extensive experience with the Raspbian OS and almost did not use Windows 10 IoT Basic and other operating systems.  The device processes the data received from the sensors.  For example, for values ‚Äã‚Äãcollected from nodes 3 and 4 (accelerometers), a fast Fourier transform (FFT) is performed, which is added to the message sent to the cloud. <br><br>  A Python application running on the gateway generates a text file with all the data collected every 30 minutes.  The choice of Python programming language was for Kostab Dolui the best way to minimize efforts and simplify the replication of the solution on various platforms in the future.  This file will be used to send data to the IoT Hub.  The image below is a sample .txt file with raw data that will be parsed by the C # console application on the field gateway. <br><br><img src="https://habrastorage.org/files/75e/958/7da/75e9587da9ea419c9a4eb095e82ddc70.png"><br>  <i>Raw file text file</i> <br><br><h2>  Preliminary processing </h2><br>  To send the required data, you need to convert a text file in a console application running on the field gateway.  At this stage, there was a question about the choice of the development language of the console application.  IoT Hub SDK is available for both Python and C #.  Having discussed both options with the client, we decided to develop an application in C #, because we knew the language better.  We then installed the Mono software on the Raspberry Pi device to run the application. <br><br>  This application creates a JSON array of measurements ready for sending to IoT Hub containing the readings of all sensors extracted from a text file.  During the final testing, we used a very large file in the .txt format and found some problems with the size of the messages sent to the IoT Hub. <br><br><blockquote>  If the size of the text file is more than 256 KB, then it should be divided into small files.  This requirement arose due to the IoT Hub restrictions on the maximum size of the data packet transmitted from the device to the cloud. </blockquote><br><img src="https://habrastorage.org/files/35c/470/49a/35c47049afcb489b8e959dbcea1366dd.jpg"><br>  <i>Text parsing scheme</i> <br><br>  Creating a means of parsing the indications of nodes 3 and 4 was complicated by the nature of the data being sent.  They had to send the following information to the field gateway: time stamp, node ID, battery charge level, coordinates, packet number and a set of 20 numbers that are part of the FFT.  Data transmission from a single sensor for specific coordinates consists of seven packets with time stamps within 70 milliseconds.  We had to identify these packets and create one row in the table, including all the FFT values ‚Äã‚Äãof the seven packets (represented as a JSON array and stored together as a string). <br><br><h2>  Telemetry transmission </h2><br>  As mentioned earlier, due to the connection features, first of all we had to process a text file containing sensor readings.  Real-time monitoring was not the goal of this project, so the resulting model functions with a slight delay.  In the end, we decided not to abandon the text file created by the field gateway, because it can be useful to the client as a log file.  We also continued to use the developed parser. <br><br>  The Raspberry Pi works as an opaque field gateway, so we registered the C # console application as a unique device for IoT Hub.  This means that no matter how many sensors we connect to it, the gateway will perform all the necessary manipulations, aggregate the data and create a message to send to the IoT Hub.  In addition, this approach will allow re-use of the developed architecture for other archaeological objects and create a scalable and easily portable solution. <br><br><h2>  Security </h2><br>  Azure IoT Hub allows you to register each device with a name and a symmetric key.  This means that each device gets its own connection string. <br><br>  If it is hacked, the corresponding device can be turned off by stopping the exchange of data with it using the control panel on the Azure portal. <br><br>  IoT Hub provides a ready-made effective solution for the protection of transmitted data.  Before the start of the project, no security requirements were presented, but this feature was widely accepted by the client. <br><br><h2>  Storing Telemetry with Stream Analytics </h2><br>  The data transferred to Azure IoT Hub, are subject to storage and visualization.  After discussion with the client, we decided to create a database with four different tables, one for each type of sensor.  We chose a SQL database, as it is possible to directly request data from it in PowerBI Embedded. <br><br>  Azure Stream Analytics is then configured with one incoming stream and four outgoing data streams, as can be seen in the screenshot below. <br><br><img src="https://habrastorage.org/files/9e8/840/d99/9e8840d9909d4afab54b7e8b293ef361.png"><br>  <i>Azure Stream Analytics</i> <br><br>  The query consists of four operators that send telemetry data to the corresponding SQL database table.  For example: <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">SELECT </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dateadd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s, ts, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'1970-01-01'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> as ts, id, bat, ax, ay, az, te, hu, lt INTO [accsample] FROM [IoTHub] WHERE id</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span> OR id=<span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br>  As you can see, the <code>dateadd</code> function <code>dateadd</code> used to convert time from a UNIX format to a readable form.  The rest of the expression reads the data from the stream and saves it in the output mapping table <code>accsample</code> . <br><br><h2>  Data visualization </h2><br>  The final stage of the project is visualization.  To simplify data analysis, we decided to embed a Power BI report into an ASP.NET web application.  Due to this, we managed to realize two important goals of this project: to display data on diagrams that the client can easily personalize, and, most importantly, open public access to sensor readings. <br><br>  Charts, graphs and data filters, available in a web application, were created in close cooperation with the client, so that the result corresponded to the expectations: various tabs for various sensors, filters, and so on. <br><br>  Another example of specific requirements: filtering data by timestamp for each device. <br><br><img src="https://habrastorage.org/files/543/d22/fac/543d22fac81d4287b540279c4ce294af.png"><br>  <i>Data Visualization with PowerBI Embedded</i> <br><br><h2>  Conclusion </h2><br>  We were able to develop a comprehensive solution for the Internet of Things to receive data from an important archaeological site and remotely track its condition.  Of course, this is of great importance for scientists.  Now they will have access to the right information from anywhere. <br><br>  In addition, the implemented architecture can be easily scaled and transported.  Experts from the Technical University of Milan wanted to figure out how to use these technologies and adapt the solution to other projects.  Working together has allowed us to achieve these goals. <br><br>  Data visualization is very simple and straightforward.  Researchers can use it to obtain information about the state of an archaeological site. <br><br><h2>  Perspectives </h2><br>  A comprehensive solution for remote monitoring of the mitreum in the Great Circus has been successfully implemented.  The project team has acquired all the skills necessary to create it.  Over the next few months, researchers will test and evaluate the effectiveness of the system in order to understand how to improve it, given the specific needs that they face. <br><br>  Moreover, the PoliMi team has gained skills with the Azure platform and can easily recreate a similar architecture for various remote monitoring projects related to other archaeological sites. <br><br>  We remind you that you can try Microsoft Azure for free <a href="https://azure.microsoft.com/ru-ru/free/%3Fwt.mc_id%3DAID570629_QSG_BLOG_139069">here</a> . <br><br><h2>  Additional resources </h2><br>  <a href="https://aka.ms/habr_323762_9">GitHub repository for C # console application running on the field gateway</a> <br>  <a href="https://aka.ms/habr_323762_10">Information about mitreum in the Great Circus on Sovrintendenza Capitolina</a> <br><br><h2>  Business.IoT: discovering the Internet of Things </h2><br>  On March 30, 2017, <a href="https://aka.ms/habr_322600_18">Microsoft will host the online conference ‚ÄúBusiness.IoT: Discovering the Internet of Things‚Äù</a> .  The program will have two parallel tracks (business and technology) with best practices and recommendations from leading experts in the field of Internet of things, machine learning and predictive analytics. <br><br>  Among the speakers will be: Mikhail Chernomordikov (Microsoft), Sergey Osipov (MAYKOR-GMCS), Dmitry Bergelson (GuaranaCam), Anna Kulashova (Microsoft), Dmitry Marchenko (Microsoft), Andrei Meluzov (KORUS Consulting) and Vasily Yesipov ( KPMG). <br><br>  To participate, you must register <a href="https://aka.ms/habr_322600_19">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/323762/">https://habr.com/ru/post/323762/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323750/index.html">PHP Digest number 104 - interesting news, materials and tools (March 1 - 12, 2017)</a></li>
<li><a href="../323752/index.html">Holographic displays: then and now</a></li>
<li><a href="../323754/index.html">3CX technical support responds: Plug and Play auto-tuning of IP phones does not work</a></li>
<li><a href="../323756/index.html">How to get the maximum discount when buying IT equipment</a></li>
<li><a href="../323760/index.html">Invisible friends of your github repository</a></li>
<li><a href="../323764/index.html">Via MVP to VIPER. Part One: MVP</a></li>
<li><a href="../323766/index.html">7 strategies to help you get rid of procrastination</a></li>
<li><a href="../323768/index.html">How IT professionals work. Pavel Klepinin, IT Director, NIPIGAZ Center</a></li>
<li><a href="../323770/index.html">Fast factorial calculation - PrimeSwing</a></li>
<li><a href="../323772/index.html">Do you still have a chance to achieve success</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>