<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dynamic Java Proxy: What is it and how to use it?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 Well, before the New Year and the start of the tenth Java Developer Stream, it ‚Äôs just a bit of a joke. So we have one open lesson left, whi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dynamic Java Proxy: What is it and how to use it?</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br><br>  Well, before the New Year and the start of the tenth <a href="https://otus.pw/T3Uw/">Java Developer</a> Stream, it <a href="https://otus.pw/T3Uw/">‚Äôs</a> just a bit of a joke.  So we have one open lesson left, which we are preparing for publication and today's article, from which you will learn about Java dynamic proxy: what it is, when and how to use it in code. <br><br>  <b>What is a proxy?</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A proxy is a design pattern.  We create and use it to add and modify the functionality of existing classes.  In this case, the proxy object is used instead of the original one.  Usually it uses the same method as the original, and in Java, proxy classes extend the source.  A proxy can call the method of the original object, as it has a handle to the original. <br><br>  Thus, proxy classes conveniently implement many things: <br><br><ul><li>  start and stop logging; </li><li>  additional argument checking; </li><li>  imitation of the behavior of the original class; </li><li>  implementation of deferred initialization of costly resources; </li></ul><br><img src="https://habrastorage.org/webt/7r/rf/cp/7rrfcp2c9ieqq2maxjwsrfekhh0.png"><a name="habracut"></a><br><br>  All this happens without changing the original class code.  The full list is not limited to the examples above, they are only a small part of it. <br><br>  In practice, the proxy class does not directly implement the functionality.  Following the principle of sole responsibility, the proxy class directly performs only proxying, and the behavior change is implemented in handlers.  When calling a proxy object instead of the original one, the proxy itself decides whether to call the original method or some handlers.  The handler can perform both his own task and refer to the original method. <br><br>  Although the proxy pattern is not only used to create a proxy object and class in a runtime environment, in Java it is a particularly interesting topic.  In this article, I focus on such proxies. <br><br>  This is a complex topic that requires the use of a reflection class, or manipulation of bytecode, or compilation of Java code generated dynamically.  And maybe all at once.  To prevent the new class from being available as a bytecode at runtime, you will need the generated bytecode and class loader to load the bytecode.  To create bytecode, use <a href="https://github.com/cglib/cglib">cglib</a> , <a href="http://bytebuddy.net/">bytebuddy</a> or the built-in Java compiler. <br><br>  The importance of separation of responsibilities, in our case, becomes clear, we need only think about the proxy classes and the handlers they call.  The proxy class is generated at runtime, but the handlers it calls can be added to regular source code and compiled with the rest of the program. <br><br>  How to use it in our code? <br><br>  The simplest is to use <code>java.lang.reflect.Proxy</code> , which is part of the JDK.  This class can create a proxy class or directly its instance.  Using a proxy embedded in Java is very simple.  All you need to do is implement <code>java.lang.InvocationHandler</code> so that a proxy object can call it.  The <code>InvocationHandler</code> interface is extremely simple and contains only one method: <code>invoke()</code> .  When it is called, the arguments contain the proxied original object, the method called (as a reflection of the <code>Method</code> object), and an array of objects of the original arguments.  The code snippet below demonstrates the use of: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> proxy; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.lang.reflect.InvocationHandler; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.lang.reflect.InvocationTargetException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.lang.reflect.Method; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.lang.reflect.Proxy; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JdkProxyDemo</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">If</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalMethod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String s)</span></span></span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Original</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">If</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalMethod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String s)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(s); } } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Handler</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InvocationHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> If original; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(If original)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.original = original; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object proxy, Method method, Object[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IllegalAccessException, IllegalArgumentException, InvocationTargetException </span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">"BEFORE"</span></span>); method.invoke(original, args); System.out.println(<span class="hljs-string"><span class="hljs-string">"AFTER"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span></span>{ Original original = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Original(); Handler handler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Handler(original); If f = (If) Proxy.newProxyInstance(If.class.getClassLoader(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Class[] { If.class }, handler); f.originalMethod(<span class="hljs-string"><span class="hljs-string">"Hallo"</span></span>); } }</code> </pre> <br>  To call the original method of the original object, the handler needs access to it.  What is not provided by the Java proxy implementation.  You will need to pass the argument to the instance instance in the code yourself.  (Note the object (usually called proxy) that is passed as an argument to the handler being called. This is a proxy object that generates a reflection of Java dynamically, and not the object that we want to proxy.) So you can use as separate handler objects for each source class, and a common object that knows how to call the original object, if there is any method for this at all. <br><br>  In a special case, you can create a call handler and proxy interface without the original object.  Moreover, the class for implementing the interface in the source code is not required.  It is implemented by a dynamically created proxy class. <br><br>  If the proxied class does not implement the interface, you should consider using some other proxy implementation. <br><br>  THE END <br><br>  We are waiting for your comments and questions.  As always, or here, or you can go to <a href="https://otus.pw/pdVD/">Vitaly</a> on <a href="https://otus.pw/IXdl/">the open day</a> . </div><p>Source: <a href="https://habr.com/ru/post/434214/">https://habr.com/ru/post/434214/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../434204/index.html">OneWeb offers Russia a share in the project in exchange for frequencies</a></li>
<li><a href="../434206/index.html">Distributor ok.ru/music</a></li>
<li><a href="../434208/index.html">How Go saved our ‚ÄúBlack Friday‚Äù</a></li>
<li><a href="../434210/index.html">Analysis of the quiz contest on Android from the HeadHunter booth at Mobius 2018 Moscow</a></li>
<li><a href="../434212/index.html">Tesla Tower. What happens in and near the skyscraper when lightning strikes?</a></li>
<li><a href="../434216/index.html">Brute-force attacks using Kali Linux</a></li>
<li><a href="../434218/index.html">Simple Java bot-clicker on the example of the game World of Warcraft 3.3.5a</a></li>
<li><a href="../434220/index.html">Logging into Aeronet: running a standalone quadrocopter in a virtual environment</a></li>
<li><a href="../434222/index.html">Amazon ground station for rent - receiving and processing data from satellites</a></li>
<li><a href="../434224/index.html">Digital events in Moscow from December 24 to 30</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>