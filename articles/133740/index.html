<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Teamviewer, powershell and tsiska</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Then they gave me a task to cover access to the outside network via Teamviewer software. The background of the question is a bit sad - historically, i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Teamviewer, powershell and tsiska</h1><div class="post__text post__text-html js-mediator-article">  Then they gave me a task to cover access to the outside network via Teamviewer software.  The background of the question is a bit sad - historically, in this way the programmer-contractor remotely connected to the server with 1C databases.  Yes, everything is wrong and difficult, and attempts to change something both technically and organizationally, stumbled upon the counteraction of accounting.  But it's not about that, but about blocking this Teamviewer itself. <br><br>  First of all I, of course, got into the search.  I found a couple of dozens of topics with a discussion of this issue, looked at how people block this software with varying success.  The problem is that there are too many servers to which it connects, it is easy to miss something, and in the comments to the lists of found ranges people often complained that this solution does not work for them. <br><br><img src="http://img259.imageshack.us/img259/55/powershellandteamviewer.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Well, we put two computers side by side, we install Teamviewer programmers on them - to see it live right away, it turns out or not. <br><a name="habracut"></a><br>  Blocking port tcp 5938, judging by the comments, has long ceased to work, since the release of the previous version.  Just in case, I made, of course, the rule to block incoming and outgoing ports on this port, as well as on the tcp 9997 found somewhere. There was no instant effect, but the counter on the tsiska recorded responses.  Well, let it be. <br><br>  Then I began to wool all the ranges found by my comrades.  Somewhere on the fifth read topic and the fourth added ten ranges a reliable lock was fixed, after several attempts the software reports about the impossibility of connecting.  Hooray!  The primary goal is achieved, but I want more.  Eighty, ninety, or even ninety-five percent is insufficient reliability. <br><br>  I decided to tackle this problem deeper.  For a start, I wanted to understand how you can create a more complete list of Teamviewer hosts.  In principle, the comrades on the forums expressed the idea that you need to block servers of the type serverN.teamviewer.com, where N is a number.  But, firstly, I have not figured out how to make _tritable_ blocking by host name using tsisk, and secondly, blocking ‚Äúbare‚Äù IP in any case will be very useful as an additional protection. <br><br>  There was a simple idea - to loop through all the names and to resolve them to IP.  I'm a big fan of the command line, so I first looked for approaches to solving a problem using a batch file.  I figured it out - yes, in principle, you can parse the output of nslookup, but somehow it will be clumsy.  And what if through Powershell? <br><br><br>  Googling, quickly found a suitable .Net class.  After a bit of experimentation, I realized that this scheme works great - I especially liked that if the name resolves to several IPs, they are all neatly placed in an array.  Each aypishnik is added to an array of results, which is then sorted and cleaned of duplicates with a single Sort command, and dropped into a text file.  At the end of a small stroke for convenience - a text file opens in Notepad, so as not to search for it on the disk.  Yes, Powershell is a very convenient and powerful tool. <br><br>  Script text (Powershell v2): <br><br><pre><code class="hljs mel">###  --  Teamviewer. ,   ,    . ##  $result_ips = <span class="hljs-string"><span class="hljs-string">"C:\!scripts\teamviewer\result_tv_IPs.txt"</span></span> $result_addresses = <span class="hljs-string"><span class="hljs-string">"C:\!scripts\teamviewer\result_tv_addresses.txt"</span></span> del $result_ips del $result_addresses $servers=@() ##  serverN.teamviewer.com - <span class="hljs-number"><span class="hljs-number">101</span></span><span class="hljs-number"><span class="hljs-number">-11500</span></span>, <span class="hljs-number"><span class="hljs-number">646</span></span>  [<span class="hljs-number"><span class="hljs-number">2011</span></span><span class="hljs-number"><span class="hljs-number">-11</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i=<span class="hljs-number"><span class="hljs-number">1</span></span>; $i -le <span class="hljs-number"><span class="hljs-number">11500</span></span>; $i++) { echo $i; $cur_server=<span class="hljs-string"><span class="hljs-string">"server"</span></span> + $i + <span class="hljs-string"><span class="hljs-string">".teamviewer.com"</span></span> echo $cur_server [System.Net.Dns]::GetHostAddresses($cur_server)|% { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($? -eq $true) {echo $cur_server |out-<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> -append $result_addresses}; $servers+=$_.IPAddressToString } } # masterN.teamviewer.com - <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span> [<span class="hljs-number"><span class="hljs-number">2011</span></span><span class="hljs-number"><span class="hljs-number">-11</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i=<span class="hljs-number"><span class="hljs-number">0</span></span>; $i -le <span class="hljs-number"><span class="hljs-number">20</span></span>; $i++) { echo $i; $cur_server=<span class="hljs-string"><span class="hljs-string">"master"</span></span> + $i + <span class="hljs-string"><span class="hljs-string">".teamviewer.com"</span></span> echo $cur_server [System.Net.Dns]::GetHostAddresses($cur_server)|% { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($? -eq $true) {echo $cur_server |out-<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> -append $result_addresses}; $servers+=$_.IPAddressToString } } # pingN.dyngate.com - <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-number"><span class="hljs-number">-3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i=<span class="hljs-number"><span class="hljs-number">0</span></span>; $i -le <span class="hljs-number"><span class="hljs-number">10</span></span>; $i++) { echo $i; $cur_server=<span class="hljs-string"><span class="hljs-string">"ping"</span></span> + $i + <span class="hljs-string"><span class="hljs-string">".dyngate.com"</span></span> echo $cur_server [System.Net.Dns]::GetHostAddresses($cur_server)|% { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($? -eq $true) {echo $cur_server |out-<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> -append $result_addresses}; $servers+=$_.IPAddressToString } } #     $servers | <span class="hljs-keyword"><span class="hljs-keyword">sort</span></span>-object -unique | out-<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> $result_ips notepad.exe $result_ips start-sleep -milliseconds <span class="hljs-number"><span class="hljs-number">800</span></span> # ,   notepad.exe $result_addresses</code> </pre> <br><br>  Some moments on this script: <br><br>  - The string $ servers = @ () initiates an array; without this, Powershell is confused in types. <br>  - [System.Net.Dns] :: GetHostAddresses () is a .NET class that receives IP addresses by name. <br>  - IPAddressToString - a method that converts the result to a regular string. <br><br><br>  As an intermediate result: Powershell is terribly convenient for such specific admin tasks. <br><br>  (How the resulting subnets, about two hundred in number, fell into a tsiska - a subject for a separate topic, and even so it turns out many letters. I plan to refine this process) <br><br>  Results - six and a half hundreds of received addresses, reliable solution of the problem and +5 to the ‚Äúadministration‚Äù skill :-) <br><br><br>  At first, there may be a desire to block these ranges with a large margin.  However, I quickly stumbled upon the fact that one of the moskva.fm servers, 85.17.138.68, got into the thus closed 85.17. *. * Range - it is much safer to make the rules of a more particular type, per subnet / 24 (85.17.136. * and 85.17.87. *).  Alternatively, you can block individual IPs in the list, but this is less reliable from the point of view of the original task of blocking Teamviewer - I think the emergence of its new servers ‚Äúside by side‚Äù with the existing ones is much more likely than in new ranges. </div><p>Source: <a href="https://habr.com/ru/post/133740/">https://habr.com/ru/post/133740/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../133735/index.html">In the latest update of Xperia smartphones appeared support for WebGL</a></li>
<li><a href="../133736/index.html">Attention, discounts!</a></li>
<li><a href="../133737/index.html">Instant bonus from QIWI Wallet and MasterCard</a></li>
<li><a href="../133738/index.html">History Library Junktale.com</a></li>
<li><a href="../133739/index.html">Writing Anime Wallpaper Downloader on MacRuby</a></li>
<li><a href="../133741/index.html">Photo Frame</a></li>
<li><a href="../133742/index.html">Causes of failures and failures of startups in Russia</a></li>
<li><a href="../133743/index.html">Panasonic GX1 - nothing is forgotten!</a></li>
<li><a href="../133745/index.html">Convenient application for the implementation of subdomains in Django - django-hosts</a></li>
<li><a href="../133746/index.html">Amazon Online Store Warehouse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>