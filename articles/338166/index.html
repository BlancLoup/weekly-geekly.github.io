<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Use PowerShell for IT security. Part III: Budget Classification</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last time, with a few lines of PowerShell code, I launched a completely new software category ‚Äî analyzing file access. My 15 minutes of fame was almos...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Use PowerShell for IT security. Part III: Budget Classification</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/71f/17e/c4b/71f17ec4bf704cfa8964b00f2668d2c4.jpg"><br><br>  Last time, with a few lines of PowerShell code, I launched a completely new software category ‚Äî analyzing file access.  My 15 minutes of fame was almost over, but I was able to point out that PowerShell provides practical options for monitoring file access events.  In this post, I‚Äôll finish work on the file access analysis tool and move on to PowerShell data classification. <a name="habracut"></a><br><br>  <b>Event-Based Analytics</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I want to remind you that in my analysis script, I used the Register-WmiEvent cmdlet to view file access events in a specific folder.  I also created a mythical reference value for the intensity of events to compare current data with it.  (For those who are thoroughly interested in this, there is a whole area of ‚Äã‚Äãmeans for measuring such indicators - visits to websites, calls to a call center, a flow of people from coffee machines, and this guy started studying it first.) <br><br>  When the number of file accesses exceeds the standard indicators, I ran a program-generated event that is called by another part of the code and displays the file access analysis information panel. <br><br>  This launch is performed by the New-Event cmdlet, which allows you to send an event along with other information to the recipient.  There is a WMI-Event cmdlet to read event data.  In the role of the receiving party, there may even be another script, since both event cmdlets use the same SourceIdentifier identifier - in our case, this is Bursts. <br>  These are all basic ideas regarding the operating system: in fact, PowerShell provides a simple messaging system.  And quite successfully, after all, we use just the signaling command language. <br><br>  Anyway, the following is the amazing full code. <br><br><pre><code class="hljs mel"><span class="hljs-number"><span class="hljs-number">1.</span></span> $cur = Get-Date <span class="hljs-number"><span class="hljs-number">2.</span></span> $Global:Count=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3.</span></span> $Global:baseline = @{<span class="hljs-string"><span class="hljs-string">"Monday"</span></span> = @(<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>); <span class="hljs-string"><span class="hljs-string">"Tuesday"</span></span> = @(<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>);<span class="hljs-string"><span class="hljs-string">"Wednesday"</span></span> = @(<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>);<span class="hljs-string"><span class="hljs-string">"Thursday"</span></span> = @(<span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-string"><span class="hljs-string">"Friday"</span></span> = @(<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>); <span class="hljs-string"><span class="hljs-string">"Saturday"</span></span>=@(<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-string"><span class="hljs-string">"Sunday"</span></span>= @(<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>)} <span class="hljs-number"><span class="hljs-number">4.</span></span> $Global:cnts = @(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">5.</span></span> $Global:burst = $false <span class="hljs-number"><span class="hljs-number">6.</span></span> $Global:evarray = New-Object System.Collections.ArrayList <span class="hljs-number"><span class="hljs-number">7.</span></span> <span class="hljs-number"><span class="hljs-number">8.</span></span> $action = { <span class="hljs-number"><span class="hljs-number">9.</span></span> $Global:Count++ <span class="hljs-number"><span class="hljs-number">10.</span></span> $d=(Get-Date).DayofWeek <span class="hljs-number"><span class="hljs-number">11.</span></span> $i= [math]::<span class="hljs-keyword"><span class="hljs-keyword">floor</span></span>((Get-Date).Hour/<span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-number"><span class="hljs-number">12.</span></span> <span class="hljs-number"><span class="hljs-number">13.</span></span> $Global:cnts[$i]++ <span class="hljs-number"><span class="hljs-number">14.</span></span> <span class="hljs-number"><span class="hljs-number">15.</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">event</span></span> auditing! <span class="hljs-number"><span class="hljs-number">16.</span></span> <span class="hljs-number"><span class="hljs-number">17.</span></span> $rawtime = $EventArgs.NewEvent.TargetInstance.LastAccessed.Substring(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">12</span></span>) <span class="hljs-number"><span class="hljs-number">18.</span></span> $filename = $EventArgs.NewEvent.TargetInstance.Name <span class="hljs-number"><span class="hljs-number">19.</span></span> $etime= [datetime]::ParseExact($rawtime,<span class="hljs-string"><span class="hljs-string">"yyyyMMddHHmm"</span></span>,$null) <span class="hljs-number"><span class="hljs-number">20.</span></span> <span class="hljs-number"><span class="hljs-number">21.</span></span> $msg=<span class="hljs-string"><span class="hljs-string">"$($etime)): Access of file $($filename)"</span></span> <span class="hljs-number"><span class="hljs-number">22.</span></span> $msg|Out-File C:\Users\bob\Documents\events.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> -Append <span class="hljs-number"><span class="hljs-number">23.</span></span> <span class="hljs-number"><span class="hljs-number">24.</span></span> <span class="hljs-number"><span class="hljs-number">25.</span></span> $Global:evarray.Add(@($filename,$etime)) <span class="hljs-number"><span class="hljs-number">26.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!$Global:burst) { <span class="hljs-number"><span class="hljs-number">27.</span></span> $Global:start=$etime <span class="hljs-number"><span class="hljs-number">28.</span></span> $Global:burst=$true <span class="hljs-number"><span class="hljs-number">29.</span></span> } <span class="hljs-number"><span class="hljs-number">30.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-number"><span class="hljs-number">31.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($Global:start.AddMinutes(<span class="hljs-number"><span class="hljs-number">15</span></span>) -gt $etime ) { <span class="hljs-number"><span class="hljs-number">32.</span></span> $Global:Count++ <span class="hljs-number"><span class="hljs-number">33.</span></span> #File behavior analytics <span class="hljs-number"><span class="hljs-number">34.</span></span> $sfactor=<span class="hljs-number"><span class="hljs-number">2</span></span>*[math]::<span class="hljs-keyword"><span class="hljs-keyword">sqrt</span></span>( $Global:baseline[<span class="hljs-string"><span class="hljs-string">"$($d)"</span></span>][$i]) <span class="hljs-number"><span class="hljs-number">35.</span></span> <span class="hljs-number"><span class="hljs-number">36.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($Global:Count -gt $Global:baseline[<span class="hljs-string"><span class="hljs-string">"$($d)"</span></span>][$i] + <span class="hljs-number"><span class="hljs-number">2</span></span>*$sfactor) { <span class="hljs-number"><span class="hljs-number">37.</span></span> <span class="hljs-number"><span class="hljs-number">38.</span></span> <span class="hljs-number"><span class="hljs-number">39.</span></span> <span class="hljs-string"><span class="hljs-string">"$($etime): Burst of $($Global:Count) accesses"</span></span>| Out-File C:\Users\bob\Documents\events.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> -Append <span class="hljs-number"><span class="hljs-number">40.</span></span> $Global:Count=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">41.</span></span> $Global:burst =$false <span class="hljs-number"><span class="hljs-number">42.</span></span> New-Event -SourceIdentifier Bursts -MessageData <span class="hljs-string"><span class="hljs-string">"We're in Trouble"</span></span> -EventArguments $Global:evarray <span class="hljs-number"><span class="hljs-number">43.</span></span> $Global:evarray= [System.Collections.ArrayList] @(); <span class="hljs-number"><span class="hljs-number">44.</span></span> } <span class="hljs-number"><span class="hljs-number">45.</span></span> } <span class="hljs-number"><span class="hljs-number">46.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $Global:burst =$false; $Global:Count=<span class="hljs-number"><span class="hljs-number">0</span></span>; $Global:evarray= [System.Collections.ArrayList] @();} <span class="hljs-number"><span class="hljs-number">47.</span></span> } <span class="hljs-number"><span class="hljs-number">48.</span></span> } <span class="hljs-number"><span class="hljs-number">49.</span></span> <span class="hljs-number"><span class="hljs-number">50.</span></span> Register-WmiEvent -Query <span class="hljs-string"><span class="hljs-string">"SELECT * FROM __InstanceModificationEvent WITHIN 5 WHERE TargetInstance ISA 'CIM_DataFile' and TargetInstance.Path = '\\Users\\bob\\' and targetInstance.Drive = 'C:' and (targetInstance.Extension = 'txt' or targetInstance.Extension = 'doc' or targetInstance.Extension = 'rtf') and targetInstance.LastAccessed &gt; '$($cur)' "</span></span> -sourceIdentifier <span class="hljs-string"><span class="hljs-string">"Accessor"</span></span> -Action $action <span class="hljs-number"><span class="hljs-number">51.</span></span> <span class="hljs-number"><span class="hljs-number">52.</span></span> <span class="hljs-number"><span class="hljs-number">53.</span></span> #Dashboard <span class="hljs-number"><span class="hljs-number">54.</span></span> While ($true) { <span class="hljs-number"><span class="hljs-number">55.</span></span> $args=Wait-Event -SourceIdentifier Bursts # wait on Burst <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> <span class="hljs-number"><span class="hljs-number">56.</span></span> Remove-Event -SourceIdentifier Bursts #remove <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> <span class="hljs-number"><span class="hljs-number">57.</span></span> <span class="hljs-number"><span class="hljs-number">58.</span></span> $outarray=@() <span class="hljs-number"><span class="hljs-number">59.</span></span> foreach ($result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $args.SourceArgs) { <span class="hljs-number"><span class="hljs-number">60.</span></span> $obj = New-Object System.Object <span class="hljs-number"><span class="hljs-number">61.</span></span> $obj | Add-Member -type NoteProperty -Name File -Value $result[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-number"><span class="hljs-number">62.</span></span> $obj | Add-Member -type NoteProperty -Name Time -Value $result[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-number"><span class="hljs-number">63.</span></span> $outarray += $obj <span class="hljs-number"><span class="hljs-number">64.</span></span> } <span class="hljs-number"><span class="hljs-number">65.</span></span> <span class="hljs-number"><span class="hljs-number">66.</span></span> <span class="hljs-number"><span class="hljs-number">67.</span></span> $outarray|Out-GridView -Title <span class="hljs-string"><span class="hljs-string">"FAA Dashboard: Burst Data"</span></span> <span class="hljs-number"><span class="hljs-number">68.</span></span> }</code> </pre> <br>  Please do not hit your laptop while watching. <br><br>  I understand that I continue to show separate views of the tables and there are more suitable ways of processing graphics.  With PowerShell, you have access to the entire .NET Framework, so you can create objects ‚Äî lists, charts, and so on ‚Äî to access them and then update them if necessary.  For now I will leave it for you as a homework. <br><br>  <b>Classification plays a very important role in data security.</b> <br><br>  Let's postpone monitoring of file events and look at the topic of data classification in PowerShell. <br><br>  At <a href="https://www.varonis.com/ru">Varonis,</a> for objective reasons, we use the principle of ‚Äúawareness of your data.‚Äù  To develop a useful data protection program, one of the first steps should be to examine where the critical or confidential data are located - credit card numbers, customer addresses, confidential legal documents, proprietary code. <br><br>  The goal, of course, is to protect the valuable digital data of the company, but first they should determine their composition.  By the way, this is not just a good idea, many laws and regulations on data protection (for example, HIPAA), as well as industry standards (PCI DSS) require the identification of assets in actual risk assessment. <br><br>  PowerShell has a lot of potential for data classification applications.  Can PS directly access and read files?  Yes.  Can it perform a pattern matching for text?  Yes.  Can he do it efficiently on a large scale?  Yes. <br><br>  No, the PowerShell classification script that I received in the end will not replace the Varonis Data Classification Framework.  But for the scenario that I meant - the IT administrator who needs to monitor the folder with confidential data - my PowerShell test script does not just show a satisfactory result, it can be evaluated, say, 4 with a plus! <br><br>  <b>WQL and CIM_DataFile</b> <br><br>  Let's go back to the WQL language, which I mentioned in the first note about event monitoring. <br>  Just as I used this query language to search for event files in a directory, I can modify this script to get a list of all the files from a given directory.  As before, I use the CIM_DataFile class, but this time my query affects the folder itself, not the events associated with it. <br><br><pre> <code class="hljs sql">1. $Get-WmiObject -Query "<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">From</span></span> CIM_DataFile <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Path</span></span> = <span class="hljs-string"><span class="hljs-string">'\\Users\\bob\\'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> Drive = <span class="hljs-string"><span class="hljs-string">'C:'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (Extension = <span class="hljs-string"><span class="hljs-string">'txt'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> Extension = <span class="hljs-string"><span class="hljs-string">'doc'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> Extension = <span class="hljs-string"><span class="hljs-string">'rtf'</span></span>)<span class="hljs-string"><span class="hljs-string">"</span></span></code> </pre> <br>  Excellent!  This line of code will produce an array with the names of the paths to the files. <br><br>  To read the contents of each of the files in a variable in PowerShell, the Get-Content cmdlet is provided.  Thank you Microsoft. <br><br>  I need another component for my script - pattern matching.  Not surprisingly, PowerShell has a standard expression module.  For my purposes this is redundant, but I definitely save time. <br><br>  When talking to security experts, they often told me that companies should explicitly mark documents or presentations with production or confidential information accordingly - for example, the word "secret" or "confidential".  This is a recommendation and obviously helps in the data classification process. <br><br>  In my script, I created a PowerShell hash table with possible labeling texts and the corresponding regular expression to match.  For documents that are not explicitly marked in this way, I also added special project names - in my case, snowflake - which are also checked.  And to drop, I added a regular expression for social security numbers. <br><br>  The block of code that I used to read and match the sample is below.  The file name for reading and checking is passed as a parameter. <br><br><pre> <code class="hljs mel"><span class="hljs-number"><span class="hljs-number">1.</span></span> $Action = { <span class="hljs-number"><span class="hljs-number">2.</span></span> <span class="hljs-number"><span class="hljs-number">3.</span></span> Param ( <span class="hljs-number"><span class="hljs-number">4.</span></span> <span class="hljs-number"><span class="hljs-number">5.</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>] $Name <span class="hljs-number"><span class="hljs-number">6.</span></span> <span class="hljs-number"><span class="hljs-number">7.</span></span> ) <span class="hljs-number"><span class="hljs-number">8.</span></span> <span class="hljs-number"><span class="hljs-number">9.</span></span> $classify =@{<span class="hljs-string"><span class="hljs-string">"Top Secret"</span></span>=[regex]<span class="hljs-string"><span class="hljs-string">'[tT]op [sS]ecret'</span></span>; <span class="hljs-string"><span class="hljs-string">"Sensitive"</span></span>=[regex]<span class="hljs-string"><span class="hljs-string">'([Cc]onfidential)|([sS]nowflake)'</span></span>; <span class="hljs-string"><span class="hljs-string">"Numbers"</span></span>=[regex]<span class="hljs-string"><span class="hljs-string">'[0-9]{3}-[0-9]{2}-[0-9]{3}'</span></span> } <span class="hljs-number"><span class="hljs-number">10.</span></span> <span class="hljs-number"><span class="hljs-number">11.</span></span> <span class="hljs-number"><span class="hljs-number">12.</span></span> $data = Get-Content $Name <span class="hljs-number"><span class="hljs-number">13.</span></span> <span class="hljs-number"><span class="hljs-number">14.</span></span> $cnts= @() <span class="hljs-number"><span class="hljs-number">15.</span></span> <span class="hljs-number"><span class="hljs-number">16.</span></span> foreach ($key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $classify.Keys) { <span class="hljs-number"><span class="hljs-number">17.</span></span> <span class="hljs-number"><span class="hljs-number">18.</span></span> $m=$classify[$key].matches($data) <span class="hljs-number"><span class="hljs-number">19.</span></span> <span class="hljs-number"><span class="hljs-number">20.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($m.Count -gt <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-number"><span class="hljs-number">21.</span></span> <span class="hljs-number"><span class="hljs-number">22.</span></span> $cnts+= @($key,$m.Count) <span class="hljs-number"><span class="hljs-number">23.</span></span> } <span class="hljs-number"><span class="hljs-number">24.</span></span> } <span class="hljs-number"><span class="hljs-number">25.</span></span> <span class="hljs-number"><span class="hljs-number">26.</span></span> $cnts <span class="hljs-number"><span class="hljs-number">27.</span></span> }</code> </pre> <br>  <b>Excellent multithreading support</b> <br><br>  I can simplify my project by taking the code presented above, adding connecting elements and running the result through the Out-GridView cmdlet. <br><br>  There is a thought that I want to convey.  Even in the same folder in the corporate file system there can be hundreds and even thousands of files. <br><br>  Do you really want to wait for the script to consistently read each file? <br>  Of course not! <br><br>  Applications where I / O is performed for a large number of files, as in the case of classification, are well suited for multi-threaded processing ‚Äî you can run multiple actions on files in parallel, thereby significantly reducing the time to get the result. <br><br>  PowerShell has a practically usable (albeit awkward) background processing system known as Jobs.  But there is also a striking and elegant feature with multithreading support - Runspaces. <br><br>  After some manipulations and borrowing code from several pioneers in using Runspaces, I was really impressed. <br><br>  Runspaces allows you to handle all the intricate mechanics of synchronization and parallelism.  This is not something that can be quickly understood, and even the bloggers Scripting Guys, working with Microsoft, are still only versed in this multi-threaded system. <br><br>  Anyway, I boldly continued to move forward and used Runspaces to read files in parallel.  The following is a part of the code for running streams: for each file in the directory I created a stream that runs the above script block that returns the matching patterns in an array. <br><br><pre> <code class="hljs mel"><span class="hljs-number"><span class="hljs-number">1.</span></span> $RunspacePool = [RunspaceFactory]::CreateRunspacePool(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-number"><span class="hljs-number">2.</span></span> <span class="hljs-number"><span class="hljs-number">3.</span></span> $RunspacePool.Open() <span class="hljs-number"><span class="hljs-number">4.</span></span> <span class="hljs-number"><span class="hljs-number">5.</span></span> $Tasks = @() <span class="hljs-number"><span class="hljs-number">6.</span></span> <span class="hljs-number"><span class="hljs-number">7.</span></span> <span class="hljs-number"><span class="hljs-number">8.</span></span> foreach ($item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $list) { <span class="hljs-number"><span class="hljs-number">9.</span></span> <span class="hljs-number"><span class="hljs-number">10.</span></span> $Task = [powershell]::Create().AddScript($Action).AddArgument($item.Name) <span class="hljs-number"><span class="hljs-number">11.</span></span> <span class="hljs-number"><span class="hljs-number">12.</span></span> $Task.RunspacePool = $RunspacePool <span class="hljs-number"><span class="hljs-number">13.</span></span> <span class="hljs-number"><span class="hljs-number">14.</span></span> $status= $Task.BeginInvoke() <span class="hljs-number"><span class="hljs-number">15.</span></span> <span class="hljs-number"><span class="hljs-number">16.</span></span> $Tasks += @($status,$Task,$item.Name) <span class="hljs-number"><span class="hljs-number">17.</span></span> }</code> </pre> <br>  Let's take a deep breath - we've covered a lot of stuff. <br><br>  In the next post I will present the full script and discuss some (unpleasant) details.  In the meantime, after assigning a mark to some files, I created the following output using Out-GridView. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/54c/de7/c43/54cde7c43ebb458d95f0512b41251ea1.jpg"></div><br>  Classification of the contents of almost nothing! <br><br>  At the same time, you should think about how to connect two scripts with each other: a script monitoring the activity of files and a classification script, which is presented in this note. <br>  Still, the classification script should transmit data about what should be monitored in the file activity script, and the activity script can, in theory, inform the classification script when a new file is created so that it can be classified - in other words, implement a data addition system. <br><br>  Sounds like I‚Äôm suggesting, I‚Äôm not afraid of the word, a PowerShell-based security control platform.  We will begin work on doing this next time. </div><p>Source: <a href="https://habr.com/ru/post/338166/">https://habr.com/ru/post/338166/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338154/index.html">How to launch a patent process in an IT company</a></li>
<li><a href="../338156/index.html">Another HighLoadCup solution on Go</a></li>
<li><a href="../338158/index.html">kubernetes, playground, microservices and a bit of magic</a></li>
<li><a href="../338160/index.html">3CX technical support responds: how to replace or update the SSL certificate on the server</a></li>
<li><a href="../338164/index.html">Do not touch the logs with your hands! How to reduce the time for analysis using autotests</a></li>
<li><a href="../338168/index.html">Do-it-yourself Windows server file backup</a></li>
<li><a href="../338170/index.html">Timing attack on Node.js - when time works against you</a></li>
<li><a href="../338172/index.html">Work with smart contracts through Ethereum RPC API</a></li>
<li><a href="../338174/index.html">Infographics: all 42 spacecraft buried on other planets in the solar system</a></li>
<li><a href="../338176/index.html">Create a GTK video player using Haskell</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>