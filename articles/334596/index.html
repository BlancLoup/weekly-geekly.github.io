<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ZFS is the best file system (yet)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ZFS should be awesome, but it pisses me off a bit that it seems to be stuck in the past - even before it was recognized as the coolest and best file s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ZFS is the best file system (yet)</h1><div class="post__text post__text-html js-mediator-article">  ZFS should be awesome, but it pisses me off a bit that it seems to be stuck in the past - even before it was recognized as the coolest and best file system.  It is inflexible, it lacks modern integration with flash memory and is not directly supported by most operating systems.  But I store all my valuable data on ZFS, since it is this one that provides the best level of protection for the SOHO (small office / home office) environment.  And that's why. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/0e7/b64/3ff/0e7b643fffb04476af579587cda1f5cb.png" alt="image"></div>  <font color="gray">The first storage system directive: do not return incorrect data!</font> <br><a name="habracut"></a><br><h2>  ZFS revolution.  Around 2006 </h2><br>  In <a href="http://blog.fosketts.net/2016/08/25/freenas-first-impressions/">my articles on FreeNAS,</a> I insistently repeated that ‚ÄúZFS is the best file system,‚Äù but if you look at my social media posts, it will become clear that I really don‚Äôt really like it.  I came to the conclusion that such a contradiction requires an explanation and a context, so we will risk disturbing ZFS fans and do it. <br><br>  When ZFS first appeared in 2005, it was absolutely timely, but it is still stuck there.  ZFS developers did a lot of the right things by combining the best functions of a volume manager with the zettabyte-size file system on Solaris 10: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  ZFS has achieved a level of scalability that every modern file system should have, with virtually no restrictions on the amount of data and metadata and file size. </li><li>  ZFS checks the checksums of all data and metadata for damage detection; it is an absolutely necessary feature for long-term large-scale data storage. </li><li>  When ZFS detects an error, it can automatically recover data from mirrors, parity blocks, or alternative storage locations. </li><li>  Mirroring and RAID-Z are built into the system, due to which numerous drives are organically combined into one logical volume. </li><li>  ZFS has robust features for preparing snapshots and mirrors, including the ability to incrementally update data on other volumes. </li><li>  Data can be compressed on the fly, deduplication is also supported. </li></ul><br>  When ZFS appeared, <a href="http://blog.fosketts.net/2008/02/27/zfs-super-file-system/">it was a revolutionary system</a> , compared to the old volume dispatchers and file systems.  And Sun opened most of the ZFS source code, allowing it to be ported to other operating systems.  As the industry's favorite toy, ZFS quickly appeared on Linux and FreeBSD, and even Apple began to introduce it as part of the next-generation file system on Mac OS X!  The future seemed so bright! <br><br><blockquote>  Checksums for user data are needed, otherwise you <i>will inevitably</i> lose data: ‚Äú <a href="http://blog.fosketts.net/2014/12/19/big-disk-drives-require-data-integrity-checking/">Why do data integrity checks be required on large disks</a> ‚Äù and ‚Äú <a href="http://blog.fosketts.net/2014/12/12/prime-directive-storage-lose-data/">First storage system directive: do not lose data</a> ‚Äù </blockquote><br><h2>  From 2007 to 2010: ZFS went downhill </h2><br>  But something terrible happened to ZFS on the way to its triumph: lawsuits, problems with licenses and FUD - a tactic of psychological manipulation from ill-wishers. <br><br>  The first clouds appeared in 2007, when NetApp filed a lawsuit against Sun on the grounds that ZFS infringed their WAFL patents.  Sun responded with a counterclaim the same year - and legal litigation dragged on.  Although there was definitely no NetApp code in ZFS, the copy mechanism when writing to snapshots was similar to WAFL, and some of us in the industry were concerned that the NetApp lawsuit would affect the availability of ZFS open source.  These risks were enough for Apple to <a href="http://dtrace.org/blogs/ahl/2016/06/15/apple_and_zfs/">abandon ZFS support</a> on Mac OS X 10.6 ‚ÄúSnow Leopard‚Äù right before the release of this OS. <br><br><blockquote>  Here's a great blog about ZFS and Apple from Adam Leventhal, who worked on this project in the company: <a href="http://dtrace.org/blogs/ahl/2016/06/15/apple_and_zfs/">ZFS: Apple's New Filesystem That Wasn't</a> </blockquote><br>  Then Sun went through difficult times, and Oracle took the opportunity to buy the company.  This sowed new doubts about the future of ZFS, since Oracle is known as not a big fan of widespread public support for free projects.  And the CDDL license that Oracle has applied to the ZFS code is <a href="https://sfconservancy.org/blog/2016/feb/25/zfs-and-linux/">recognized as incompatible</a> with GPLv2, which is used in Linux, which makes it impossible to use ZFS in the world's most popular OS for servers. <br><br>  Although the OpenSolaris project continued after Oracle was acquired, ZFS was included in FreeBSD, but this was largely outside the corporate sector.  Of course, NexentaStor and <a href="http://blog.fosketts.net/2008/09/15/greenbytes-embraces-extends-zfs/">GreenBytes</a> helped promote ZFS in the corporate sector, but the lack of support for Sun servers by Oracle also began to influence the situation. <br><br><h2>  What are the problems with ZFS now? </h2><br>  OpenZFS is almost the same as the file system that was ten years ago. <br><br>  Many people remain skeptical of deduplication, which requires a lot of expensive memory.  And I really mean expensive: almost every ZFS FAQ definitely requires only ECC memory and at least 8 GB.  In my own experience with FreeNAS, for an active small server with ZFS, 32 GB is suitable, and it costs $ 200-300, even at today's prices. <br><br>  And ZFS didn‚Äôt really adapt to flash memory, which is now used everywhere.  Although the flash can be used for ZIL and L2ARC caches, this is a dubious advantage for systems with enough RAM, and ZFS does not have the real hybrid data storage feature.  It is ridiculous that several gigabytes of SLC flash memory are commonly mentioned in the ZFS documentation when there are already 3D NAND multi-terabyte drives on the market.  And no one talks about NVMe, although this is the standard for high-end PCs. <br><br>  And there is another question of flexibility, more precisely, its absence.  If you created a ZFS volume, it is almost fixed for life.  There are only three ways to expand the storage pool: <br><br><ul><li>  Replace absolutely all disks in the pool with larger capacity disks (which is cool, but expensive). </li><li>  Create a disk sequence with a different set of disks (which can lead to unbalanced performance, redundancy, and a bunch of other potentially silly errors). </li><li> Build a new pool and transfer datasets there with the <code>zfs send</code> command (this is what I do, although there are some tricks here). </li></ul><br>  In addition to the third method, you can not reduce the pool ZFS.  Worse, you cannot change the type of data protection without rebuilding the entire pool, including adding second and third parity disks.  FreeNAS is spending a fair amount of time in good faith trying to dissuade newbies from using RAID-Z1 <a href="https://habr.com/ru/post/334596/"><sup>[1]</sup></a> <a name="1_1"></a>  , and complains if they still choose such a scheme. <br><br>  All this may seem small, insignificant cavils, but in aggregate they subjectively send ZFS to the Middle Ages, after using Drobo, Synology, or modern cloud storage systems.  With ZFS, you need to ‚Äúbuy disks, lots of memory, create a RAID array, and never touch it again,‚Äù which is not entirely consistent with modern storage utilization <a href="https://habr.com/ru/post/334596/"><sup>[2]</sup></a> <a name="2_2"></a>  . <br><br><h2>  What options? </h2><br>  Probably, I presented ZFS not quite in a favorable light.  It was once revolutionary, but is now beginning to show limitations and fall out of the context of the modern world with flash data storage.  So are there alternatives? <br><br>  Linux has some decent volume dispatchers and file systems, and most use LVM or MD and ext4.  Btrfs was very pleased with the file system specialists, which combines the functions of a volume manager and a ZFS-style file system, but with additional flexibility beyond what ReiserFS has splashed on.  And Btrfs really could have become ‚ÄúZFS for Linux‚Äù, but not so long ago the development stumbled after last year‚Äôs terrible bug with data loss from RAID 5 and 6 raids, and almost nothing is heard about them.  But I still think that in five years I will recommend Linux users to use Btrfs, especially with its powerful potential for use in containers <a href="https://habr.com/ru/post/334596/"><sup>[3]</sup></a> <a name="3_3"></a>  . <br><br>  For Windows, Microsoft also rolls out its own new-generation ReFS file system using B + trees (similar to Btrfs), with crazy scaling and resilience and data protection <a href="https://habr.com/ru/post/334596/"><sup>[4]</sup></a> <a name="4_4"></a>  .  Combined with Storage Spaces, Microsoft will have a next-generation viable storage system for Windows Server, which can even use SSD and 3D-XPoint as a level or cache. <br><br>  And there is Apple, which is rumored to change the storage system several times before <a href="http://blog.fosketts.net/2016/06/13/macos-sierra-includes-new-apple-file-system-apfs/">settling on APFS</a> , which was released this year at macOS High Sierra.  APFS is in many ways similar to Btrfs and ReFS, although implemented in a completely different way, with greater user orientation.  Yielding in some areas (user data is not checked by checksum and compression is not supported), APFS is the exact system needed for iOS and macOS.  And APFS is the last nail in the coffin of the ‚ÄúZFS on Mac OS X‚Äù idea. <br><br>  Each of the three main operating systems now has a new generation file system (and volume manager).  Linux has Btrfs, Windows has ReFS and Storage Spaces, and macOS has APFS.  FreeBSD seems to have maintained its commitment to ZFS, but this is a small part of the market.  And each enterprise-level system has already progressed far beyond what ZFS and enterprise-level ZFS systems from Sun, Nexenta, and iXsystems can do. <br><br>  But ZFS is still far superior to old file systems for the home user.  Due to the lack of integrity checks, redundancy, and recovery from NTFS errors (Windows), HFS + (macOS), and ext3 / 4 (Linux), they are absolutely not suitable for long-term data storage.  And even ReFS and APFS, due to lack of integrity checking, are <a href="http://blog.fosketts.net/2014/12/19/big-disk-drives-require-data-integrity-checking/">not suitable</a> where data loss is unacceptable. <br><br><h2>  Author position: use ZFS (for now) </h2><br>  It's sad to admit, but for 2017, ZFS is the best file system for long-term large-scale data storage.  Although it is sometimes difficult to work with it (except for FreeBSD, Solaris, and specialized devices), reliability and reliability make ZFS the only reliable tool for storing data outside of corporate storage systems.  After all, <a href="http://blog.fosketts.net/2014/12/12/prime-directive-storage-lose-data/">reliable data storage is the only thing that a file system really needs to do</a> .  All my important data goes straight to ZFS, from photos to music, from movies to office files.  Not long before, I trust anything other than ZFS! <br><br><h4>  Footnotes </h4><br><a name="1"></a>  1. For modern large drives, RAID-Z2 and RAID-Z3 with more redundancy are preferable.  <a href="https://habr.com/ru/post/334596/">‚Üë</a> <br><a name="2"></a>  2. Strange, although multiple pools and removable disks work fine on ZFS, almost no one talks about this use case.  We are always talking about a single pool called ‚Äútank‚Äù, which includes all the disks in the system.  <a href="https://habr.com/ru/post/334596/">‚Üë</a> <br><a name="3"></a>  3. One thing that Btrfs truly lacks is support for flash, and especially hybrid storage systems.  But personally, I would prefer that they first implement support for RAID-6.  <a href="https://habr.com/ru/post/334596/">‚Üë</a> <br><a name="4"></a>  4. Although checksums for data in ReFS are still disabled by default.  <a href="https://habr.com/ru/post/334596/">‚Üë</a> </div><p>Source: <a href="https://habr.com/ru/post/334596/">https://habr.com/ru/post/334596/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334586/index.html">Microservices and Actor Model</a></li>
<li><a href="../334588/index.html">Comprehensive online marketing guide. Day 67. Retargeting and what it is eaten with.</a></li>
<li><a href="../334590/index.html">How to refactor 2 500 000 lines of code and not go crazy</a></li>
<li><a href="../334592/index.html">In a section: the news aggregator on Android with backend. Assembly system</a></li>
<li><a href="../334594/index.html">‚ÄúBad advice‚Äù: How to lose a customer or the 7 best farewell phrases</a></li>
<li><a href="../334598/index.html">Features of migration from RISC to x86 in Russia: now we are kept by the old banking software of the DOS and Netware times</a></li>
<li><a href="../334604/index.html">Hack Sleep. Repeat</a></li>
<li><a href="../334608/index.html">In the second quarter, a 40% increase in the number of attacked devices was recorded.</a></li>
<li><a href="../334610/index.html">When will there be enough IP addresses for everyone?</a></li>
<li><a href="../334612/index.html">Translation of Hans Buvald‚Äôs article ‚ÄúBasic Test Design Principles‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>