<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Development Quick Look plugin for OS X</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quick Look is an application in OS X that creates thumbnails (icons) and previews (a window with a description / content of the file by pressing the s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Development Quick Look plugin for OS X</h1><div class="post__text post__text-html js-mediator-article"> Quick Look is an application in OS X that creates thumbnails (icons) and previews (a window with a description / content of the file by pressing the space bar in the Finder).  It supports a number of standard files, for non-supported QL plugins can be installed - icon generators and / or previews.  They have the format <code>.qlgenerator</code> , placed in <code>~/Library/QuickLook</code> and <code>/Library/QuickLook</code> . <br><br>  I write apps for iOS, sometimes for OSX.  I encountered third-party QuickLook generators when I saw the plugin for the first <code>.mobileprovision</code> - <a href="https://github.com/chockenberry/Provisioning">Provisioning</a> . <br>  <code>.mobileprovision/.provisionprofile</code> is a profile containing certificates approved for device installation, some parameters for deploying iOS &amp; OSX applications. <br><br>  This is how the folder with profiles looks without any plugins for Quick Look: <br><img src="https://habrastorage.org/getpro/habr/post_images/e6b/c27/954/e6bc27954e16155b9446e6cac70d6650.png"><br>  Selecting a profile directly is necessary, for example, when using it in a script to automatically deploy an application via TestFlight.  To understand for which application which profile to take is absolutely impossible. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First, I began to use open-source <a href="https://github.com/chockenberry/Provisioning">Provisioning</a> , then closed, but more beautiful and detailed <a href="http://ipaql.com/">ipaql</a> .  The need to write an open solution arose after the author <a href="http://ipaql.com/">ipaql</a> added compatibility with OS X Mavericks only six months after the system was released, and the display of the icons has not been fixed yet. <br><br>  That's what I got - <a href="https://github.com/ealeksandrov/ProvisionQL">ProvisionQL</a> . <br>  Supported file types for creating icons and previews: <br><ul><li>  <code>.ipa</code> - iOS packaged application (from both Xcode and AppStore) </li><li>  <code>.app</code> - iOS application bundle </li><li>  <code>.mobileprovision</code> - iOS provisioning profile </li><li>  <code>.provisionprofile</code> - OSX provisioning profile </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/0f6/f4f/73b/0f6f4f73b390b67960df8688bb72347c.png"><br><br>  Under the cut, I will talk about the main steps in creating Quick Look plugins. <br><a name="habracut"></a><br><h4>  Project Setup </h4><br>  In Xcode, we create a new project: File&gt; New&gt; Project ... OS X&gt; System plug-in&gt; Quick Look Plug-in.  In the basic template, let's go right away edit Info.plist: <br><img src="https://habrastorage.org/getpro/habr/post_images/9c9/2b3/651/9c92b365174c0f9314c4d05c09035527.png"><br>  Expand CFBundleDocumentTypes and add the desired file types to the LSItemContentTypes array.  To generate icons in lists and tables, I changed QLThumbnailMinimumSize from 17 to 16. Pay attention to QLPreviewHeight and QLPreviewWidth - they are used only when the generator generates a preview for too long.  In the case of ipa, I need to extract several files from a zip archive, which is quite long (from 0.06 to 0.12 s) - in my case the system uses values ‚Äã‚Äãfrom plist.  If your generator quickly gives preview - the system will cancel the window by the image or HTML that you give. <br><br>  Next, if you prefer obj-c and Foundation classes, feel free to rename <code>GenerateThumbnailForURL.c  GeneratePreviewForURL.c</code> in <code>GenerateThumbnailForURL.m  GeneratePreviewForURL.m</code> and add to their headings: <br><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Cocoa/Cocoa.h&gt;</span></span></span></span></code> </pre><br><br>  Since  I need to generate both icons (GenerateThumbnailForURL) and a preview window (GeneratePreviewForURL) - I highlighted the common include / import and functions in Shared.h / m.  I quote my Shared.h: <br><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;CoreFoundation/CoreFoundation.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;CoreServices/CoreServices.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QuickLook/QuickLook.h&gt;</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Cocoa/Cocoa.h&gt;</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Security/Security.h&gt;</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;NSBezierPath+IOS7RoundedRect.h&gt;</span></span></span><span class="hljs-meta"> static NSString * const kPluginBundleId = @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"com.FerretSyndicate.ProvisionQL"</span></span></span><span class="hljs-meta">; static NSString * const kDataType_ipa = @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"com.apple.itunes.ipa"</span></span></span><span class="hljs-meta">; static NSString * const kDataType_app = @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"com.apple.application-bundle"</span></span></span><span class="hljs-meta">; static NSString * const kDataType_ios_provision = @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"com.apple.mobileprovision"</span></span></span><span class="hljs-meta">; static NSString * const kDataType_ios_provision_old = @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"com.apple.iphone.mobileprovision"</span></span></span><span class="hljs-meta">; static NSString * const kDataType_osx_provision = @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"com.apple.provisionprofile"</span></span></span><span class="hljs-meta">; #define SIGNED_CODE 0 NSImage *roundCorners(NSImage *image); NSImage *imageFromApp(NSURL *URL, NSString *dataType, NSString *fileName); NSString *mainIconNameForApp(NSDictionary *appPropertyList); int expirationStatus(NSDate *date, NSCalendar *calendar);</span></span></code> </pre><br>  The final structure of the ProvisionQL project: <br><img src="https://habrastorage.org/getpro/habr/post_images/79d/321/f4c/79d321f4ce77bc5ed2052f44e53ecfd4.png"><br><br>  NSBezierPath + IOS7RoundedRect is a function for cutting iOS7 icons rounded out from the square. <br>  Install.sh - script for automatic installation of the generator when building a project: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh PRODUCT="${PRODUCT_NAME}.qlgenerator" QL_PATH=~/Library/QuickLook/ rm -rf "$QL_PATH/$PRODUCT" test -d "$QL_PATH" || mkdir -p "$QL_PATH" &amp;&amp; cp -R "$BUILT_PRODUCTS_DIR/$PRODUCT" "$QL_PATH" qlmanage -r echo "$PRODUCT installed in $QL_PATH"</span></span></code> </pre><br>  To execute it, go to the Target settings, in the menu select Editor&gt; Add Build Phase&gt; Add Run Script Build Phase and enter the path to the script in the project folder: <br><img src="https://habrastorage.org/getpro/habr/post_images/d25/0ac/83d/d250ac83d06df5facc66fe4eabc5435a.png"><br><br>  You may also need to debug the plugin.  Since  it is not an executable file itself - you need to go to the project schema settings - Edit Scheme ...&gt; Run&gt; Info&gt; Executable&gt; Other&gt; click Cmd + Shft + G&gt; / usr / bin /&gt; Go&gt; qlmanage: <br><img src="https://habrastorage.org/getpro/habr/post_images/f9d/ed0/4bb/f9ded04bb92c43b4fb9d546746a7b88b.png"><br><br>  Then in the Arguments tab, specify the <code>-t</code> flag (for debugging icons) or <code>-p</code> (for debugging previews) in the launch arguments and then the full path to the test file (in my case, I test the icon drawing on .ipa): <br><img src="https://habrastorage.org/getpro/habr/post_images/e73/e5e/876/e73e5e876689ef366e8e5d71ad4d7933.png"><br><br><h4>  Icon generation </h4><br>  In this example, I will show how to display a pre-prepared icon ( <a href="">defaultIcon.png</a> ).  ProvisionQL implements the selection of an icon from the ipa file, as well as displaying the number of devices and the status of the action (expired or not) for the provision. <br><br>  Here is the ready <code>GenerateThumbnailForURL.m</code> : <br><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Shared.h"</span></span></span><span class="hljs-meta"> OSStatus GenerateThumbnailForURL(void *thisInterface, QLThumbnailRequestRef thumbnail, CFURLRef url, CFStringRef contentTypeUTI, CFDictionaryRef options, CGSize maxSize); void CancelThumbnailGeneration(void *thisInterface, QLThumbnailRequestRef thumbnail); /* ----------------------------------------------------------------------------- Generate a thumbnail for file This function's job is to create thumbnail for designated file as fast as possible ----------------------------------------------------------------------------- */ OSStatus GenerateThumbnailForURL(void *thisInterface, QLThumbnailRequestRef thumbnail, CFURLRef url, CFStringRef contentTypeUTI, CFDictionaryRef options, CGSize maxSize) { @autoreleasepool { NSString *dataType = (__bridge NSString *)contentTypeUTI; NSImage *appIcon; if([dataType isEqualToString:kDataType_app] || [dataType isEqualToString:kDataType_ipa]) { NSURL *iconURL = [[NSBundle bundleWithIdentifier:kPluginBundleId] URLForResource:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"defaultIcon"</span></span></span><span class="hljs-meta"> withExtension:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"png"</span></span></span><span class="hljs-meta">]; appIcon = [[NSImage alloc] initWithContentsOfURL:iconURL]; } else { return noErr; } if (QLThumbnailRequestIsCancelled(thumbnail)) { return noErr; } NSSize canvasSize = appIcon.size; NSRect renderRect = NSMakeRect(0.0, 0.0, appIcon.size.width, appIcon.size.height); CGContextRef _context = QLThumbnailRequestCreateContext(thumbnail, canvasSize, false, NULL); if (_context) { NSGraphicsContext* _graphicsContext = [NSGraphicsContext graphicsContextWithGraphicsPort:(void *)_context flipped:NO]; [NSGraphicsContext setCurrentContext:_graphicsContext]; [appIcon drawInRect:renderRect]; //draw anything you want here QLThumbnailRequestFlushContext(thumbnail, _context); CFRelease(_context); } } return noErr; } void CancelThumbnailGeneration(void *thisInterface, QLThumbnailRequestRef thumbnail) { // Implement only if supported }</span></span></code> </pre><br>  Attention should be paid to a couple of points: <br><ul><li>  <code>NSImage imageNamed:</code> cannot be used <code>NSImage imageNamed:</code> - this method will search for a resource in the qlmanage bundle (executable file), and not of our plugin </li><li>  check <code>QLThumbnailRequestIsCancelled(thumbnail)</code> before operations that may take considerable time </li></ul><br><br><h4>  Generate a preview </h4><br>  In the example, consider how to fill out and display HTML as a preview. <br>  You must first prepare the template template.html (there you can also include styles for design): <br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>App info<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> Name: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span>__CFBundleDisplayName__<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> Version: __CFBundleShortVersionString__ (__CFBundleVersion__)<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> BundleId: __CFBundleIdentifier__<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  All that is allocated <code>__KEY__</code> will be filled from the generator. <br><br>  Here is the final <code>GeneratePreviewForURL.m</code> : <br><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Shared.h"</span></span></span><span class="hljs-meta"> OSStatus GeneratePreviewForURL(void *thisInterface, QLPreviewRequestRef preview, CFURLRef url, CFStringRef contentTypeUTI, CFDictionaryRef options); void CancelPreviewGeneration(void *thisInterface, QLPreviewRequestRef preview); /* ----------------------------------------------------------------------------- Generate a preview for file This function's job is to create preview for designated file ----------------------------------------------------------------------------- */ OSStatus GeneratePreviewForURL(void *thisInterface, QLPreviewRequestRef preview, CFURLRef url, CFStringRef contentTypeUTI, CFDictionaryRef options) { @autoreleasepool { NSURL *URL = (__bridge NSURL *)url; NSString *dataType = (__bridge NSString *)contentTypeUTI; NSData *appPlist = nil; if([dataType isEqualToString:kDataType_app]) { // get the embedded plist for the iOS app appPlist = [NSData dataWithContentsOfURL:[URL URLByAppendingPathComponent:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Info.plist"</span></span></span><span class="hljs-meta">]]; } else if([dataType isEqualToString:kDataType_ipa]) { // get the embedded plist from an app archive using: unzip -p </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;URL&gt;</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;files to unzip&gt;</span></span></span><span class="hljs-meta"> (piped to standart output) NSTask *unzipTask = [NSTask new]; [unzipTask setLaunchPath:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/usr/bin/unzip"</span></span></span><span class="hljs-meta">]; [unzipTask setStandardOutput:[NSPipe pipe]]; [unzipTask setArguments:@[@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"-p"</span></span></span><span class="hljs-meta">, [URL path], @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Payload/*.app/Info.plist"</span></span></span><span class="hljs-meta">]]; [unzipTask launch]; [unzipTask waitUntilExit]; appPlist = [[[unzipTask standardOutput] fileHandleForReading] readDataToEndOfFile]; } else { return noErr; } if(QLPreviewRequestIsCancelled(preview)) { return noErr; } NSMutableDictionary *synthesizedInfo = [NSMutableDictionary dictionary]; NSURL *htmlURL = [[NSBundle bundleWithIdentifier:kPluginBundleId] URLForResource:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"template"</span></span></span><span class="hljs-meta"> withExtension:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"html"</span></span></span><span class="hljs-meta">]; NSMutableString *html = [NSMutableString stringWithContentsOfURL:htmlURL encoding:NSUTF8StringEncoding error:NULL]; NSDictionary *appPropertyList = [NSPropertyListSerialization propertyListWithData:appPlist options:0 format:NULL error:NULL]; [synthesizedInfo setObject:[appPropertyList objectForKey:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"CFBundleDisplayName"</span></span></span><span class="hljs-meta">] forKey:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"CFBundleDisplayName"</span></span></span><span class="hljs-meta">]; [synthesizedInfo setObject:[appPropertyList objectForKey:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"CFBundleIdentifier"</span></span></span><span class="hljs-meta">] forKey:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"CFBundleIdentifier"</span></span></span><span class="hljs-meta">]; [synthesizedInfo setObject:[appPropertyList objectForKey:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"CFBundleShortVersionString"</span></span></span><span class="hljs-meta">] forKey:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"CFBundleShortVersionString"</span></span></span><span class="hljs-meta">]; [synthesizedInfo setObject:[appPropertyList objectForKey:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"CFBundleVersion"</span></span></span><span class="hljs-meta">] forKey:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"CFBundleVersion"</span></span></span><span class="hljs-meta">]; for (NSString *key in [synthesizedInfo allKeys]) { NSString *replacementValue = [synthesizedInfo objectForKey:key]; NSString *replacementToken = [NSString stringWithFormat:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"__%@__"</span></span></span><span class="hljs-meta">, key]; [html replaceOccurrencesOfString:replacementToken withString:replacementValue options:0 range:NSMakeRange(0, [html length])]; } NSDictionary *properties = @{ // properties for the HTML data (__bridge NSString *)kQLPreviewPropertyTextEncodingNameKey : @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"UTF-8"</span></span></span><span class="hljs-meta">, (__bridge NSString *)kQLPreviewPropertyMIMETypeKey : @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"text/html"</span></span></span><span class="hljs-meta"> }; QLPreviewRequestSetDataRepresentation(preview, (__bridge CFDataRef)[html dataUsingEncoding:NSUTF8StringEncoding], kUTTypeHTML, (__bridge CFDictionaryRef)properties); } return noErr; } void CancelPreviewGeneration(void *thisInterface, QLPreviewRequestRef preview) { // Implement only if supported }</span></span></code> </pre><br><br>  As you can see, first we open Info.plist (or extract it from the archive), then save some data from it in <code>synthesizedInfo</code> .  All keys from <code>synthesizedInfo</code> set accordingly in the line loaded from <code>template.html</code> .  The resulting string is given qlmanage along with parameters describing the returned data type as HTML. <br><br><h4>  Conclusion </h4><br>  In this tutorial, you can quickly create a plugin to quickly view and generate icons for your proprietary format, or for any common format that is not standardly defined by the system. <br><br>  As for <a href="https://github.com/ealeksandrov/ProvisionQL">ProvisionQL</a> , I will be glad to get any suggestions and pull requests to improve the functionality of the plug-in task. </div><p>Source: <a href="https://habr.com/ru/post/208552/">https://habr.com/ru/post/208552/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../208530/index.html">Escene ES290 IP Phone Review</a></li>
<li><a href="../208532/index.html">Writing Dissolve Shader</a></li>
<li><a href="../208540/index.html">Perfect smartphone</a></li>
<li><a href="../208542/index.html">Chef for 21 days. Part one. Introduction</a></li>
<li><a href="../208544/index.html">NSA switches to cooling its data center with sewage following the example of Google</a></li>
<li><a href="../208554/index.html">Aviate launcher goes under Yahoo wing</a></li>
<li><a href="../208556/index.html">An example of using standalone actions in Yii2</a></li>
<li><a href="../208558/index.html">Solving Media Identity Problem in DevOps Methodology</a></li>
<li><a href="../208560/index.html">Traffic light on PLC - 30 blocks</a></li>
<li><a href="../208562/index.html">Organizing the storage of personal files locally and in the clouds</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>