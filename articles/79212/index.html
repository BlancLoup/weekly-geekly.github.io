<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Execute batch commands in SharePoint</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The SharePoint object model provides many features that allow you to perform the same operation in different ways. Each of the methods has its advanta...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Execute batch commands in SharePoint</h1><div class="post__text post__text-html js-mediator-article">  The SharePoint object model provides many features that allow you to perform the same operation in different ways.  Each of the methods has its advantages: one is easier to use, the other has better performance.  One of such operations is the operation of batch insertion (editing, deleting) data in lists and libraries of SharePoint documents. <br><br>  The most elementary way to add data to lists is to use the methods of the <strong>SPListItemCollection</strong> class.  This method is useful if you need to add one or more records.  If you need to process a large data array with optimal performance, we recommend using the <strong>ProcessBatchData</strong> method of the class <strong>SPWeb</strong> . <br><br>  This method allows you to perform a batch of commands at once.  For this purpose, a <strong>CAML</strong> request is sent to it as a parameter, which contains the necessary operations. <br><a name="habracut"></a><br>  The following example uses the SPWeb class's ProcessBatchData method to add 100 entries to the list: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">string</font> listId = <font color="#A31515">"C3715A5A-879B-4573-AED4-35E9DCD4E5F7"</font> ; <br> <font color="#0000ff">string</font> batchCommandFormat = <font color="#A31515">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;ows:Batch OnError=\"Continue\"&gt;{0}&lt;/ows:Batch&gt;"</font> ; <br> <font color="#0000ff">string</font> batchMethodFormat = <font color="#A31515">"&lt;Method ID=\"SaveItem_{0}\"&gt;"</font> + <br> <font color="#A31515">"&lt;SetList Scope=\"Request\"&gt;{1}&lt;/SetList&gt;"</font> + <br> <font color="#A31515">"&lt;SetVar Name=\"Cmd\"&gt;Save&lt;/SetVar&gt;"</font> + <br> <font color="#A31515">"&lt;SetVar Name=\"ID\"&gt;New&lt;/SetVar&gt;"</font> + <br> <font color="#A31515">"&lt;SetVar Name=\"urn:schemas-microsoft-com:office:office#Title\"&gt;{2}&lt;/SetVar&gt;"</font> + <br> <font color="#A31515">"&lt;/Method&gt;"</font> ; <br> <br> <font color="#2B91AF">StringBuilder</font> methodsBuilder = <font color="#0000ff">new</font> <font color="#2B91AF">StringBuilder</font> (); <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; 20; i++) <br> { <br> methodsBuilder.AppendFormat(batchMethodFormat, i, listId, <font color="#A31515">"Item title "</font> + i); <br> } <br> <br> <font color="#0000ff">string</font> batchResult = web.ProcessBatchData( <font color="#2B91AF">String</font> .Format(batchCommandFormat, methodsBuilder)); <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  The main element of the CAML request is the <strong>&lt;Method&gt;</strong> element.  The content of this element describes the very logic of the operation.  In particular, using the <strong>&lt;SetList&gt; element, it is</strong> specified for which list the operation will be performed. <br><br>  The <strong>&lt;SetVar&gt;</strong> element is used to set command parameters.  So, with the help of it the type of the executed command and the field values ‚Äã‚Äãare set.  At the same time, when setting the values ‚Äã‚Äãof the fields, the name of the fields must begin with the prefix <strong>urn: schemas-microsoft-com: office: office #</strong> (with some exceptions).  In the case of inserting data for the <strong>ID</strong> field, you must specify the value <strong>New</strong> , which instructs SharePoint to generate the element <strong>ID</strong> automatically. <br><br>  <strong>How much faster?</strong> <br><br>  According to the measurements of <a href="http://blog.dynatrace.com/2009/01/20/sharepoint-using-batch-updates-to-speed-up-performance/">Andreas Grabner</a> and <a href="http://www.entwicklungsgedanken.de/2008/01/10/incredible-performance-increase-with-very-large-lists-via-quickview-method/">Eric Bartels,</a> using the ProcessBatchData method gives an almost twofold advantage in execution speed.  Moreover, such superiority is noticeable both on a large number of records (more than 200,000 records), and on relatively small amounts of data - 100 records. <br><br>  <i>However, when using ProcessBatchData, remember to use StringBuilder to generate CAML commands.</i> <br><br>  <strong>Examples of using</strong> <br><br>  The following are examples of batch CAML requests for working with records in lists and SharePoint document libraries: <br><ul><li>  <strong>Adding an entry to the list</strong> <br><blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Method</font> <font color="#ff0000">ID</font> <font color="#0000ff">="CreateItem"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SetList</font> <font color="#ff0000">Scope</font> <font color="#0000ff">="Request"</font> <font color="#0000ff">&gt;</font> C3715A5A-879B-4573-AED4-35E9DCD4E5F7 <font color="#0000ff">&lt;/</font> <font color="#800000">SetList</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SetVar</font> <font color="#ff0000">Name</font> <font color="#0000ff">="Cmd"</font> <font color="#0000ff">&gt;</font> Save <font color="#0000ff">&lt;/</font> <font color="#800000">SetVar</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SetVar</font> <font color="#ff0000">Name</font> <font color="#0000ff">="ID"</font> <font color="#0000ff">&gt;</font> New <font color="#0000ff">&lt;/</font> <font color="#800000">SetVar</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SetVar</font> <font color="#ff0000">Name</font> <font color="#0000ff">="urn:schemas-microsoft-com:office:office#Title"</font> <font color="#0000ff">&gt;</font> New item title <font color="#0000ff">&lt;/</font> <font color="#800000">SetVar</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">Method</font> <font color="#0000ff">&gt;</font> <br></font></code> </blockquote></li><li>  <strong>Creating a new folder</strong> <blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Method</font> <font color="#ff0000">ID</font> <font color="#0000ff">="CreateFolder"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SetList</font> <font color="#ff0000">Scope</font> <font color="#0000ff">="Request"</font> <font color="#0000ff">&gt;</font> C3715A5A-879B-4573-AED4-35E9DCD4E5F7 <font color="#0000ff">&lt;/</font> <font color="#800000">SetList</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SetVar</font> <font color="#ff0000">Name</font> <font color="#0000ff">="Cmd"</font> <font color="#0000ff">&gt;</font> Save <font color="#0000ff">&lt;/</font> <font color="#800000">SetVar</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SetVar</font> <font color="#ff0000">Name</font> <font color="#0000ff">="ID"</font> <font color="#0000ff">&gt;</font> New <font color="#0000ff">&lt;/</font> <font color="#800000">SetVar</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SetVar</font> <font color="#ff0000">Name</font> <font color="#0000ff">="Type"</font> <font color="#0000ff">&gt;</font> 1 <font color="#0000ff">&lt;/</font> <font color="#800000">SetVar</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SetVar</font> <font color="#ff0000">Name</font> <font color="#0000ff">="urn:schemas-microsoft-com:office:office#Title"</font> <font color="#0000ff">&gt;</font> New folder title <font color="#0000ff">&lt;/</font> <font color="#800000">SetVar</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SetVar</font> <font color="#ff0000">Name</font> <font color="#0000ff">="owsfileref"</font> <font color="#0000ff">&gt;</font> /lists/test/folder 1 <font color="#0000ff">&lt;/</font> <font color="#800000">SetVar</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">Method</font> <font color="#0000ff">&gt;</font> <br></font></code> </blockquote></li><li>  <strong>Deleting an entry (entry or folder)</strong> <blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Method</font> <font color="#ff0000">ID</font> <font color="#0000ff">="DeleteItem"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SetList</font> <font color="#ff0000">Scope</font> <font color="#0000ff">="Request"</font> <font color="#0000ff">&gt;</font> C3715A5A-879B-4573-AED4-35E9DCD4E5F7 <font color="#0000ff">&lt;/</font> <font color="#800000">SetList</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SetVar</font> <font color="#ff0000">Name</font> <font color="#0000ff">="Cmd"</font> <font color="#0000ff">&gt;</font> Delete <font color="#0000ff">&lt;/</font> <font color="#800000">SetVar</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SetVar</font> <font color="#ff0000">Name</font> <font color="#0000ff">="ID"</font> <font color="#0000ff">&gt;</font> 50016 <font color="#0000ff">&lt;/</font> <font color="#800000">SetVar</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">Method</font> <font color="#0000ff">&gt;</font> <br></font></code> </blockquote><br>  To delete a file in the document library, you must additionally specify the relative path to the file in the parameter <strong>owsfileref</strong> : <br><blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">SetVar</font> <font color="#ff0000">Name</font> <font color="#0000ff">="owsfileref"</font> <font color="#0000ff">&gt;</font> doclib/file.xls <font color="#0000ff">&lt;/</font> <font color="#800000">SetVar</font> <font color="#0000ff">&gt;</font></font> <br></code> </blockquote></li><li>  <strong>Change record fields</strong> <blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Method</font> <font color="#ff0000">ID</font> <font color="#0000ff">="UpdateItem"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SetList</font> <font color="#ff0000">Scope</font> <font color="#0000ff">="Request"</font> <font color="#0000ff">&gt;</font> C3715A5A-879B-4573-AED4-35E9DCD4E5F7 <font color="#0000ff">&lt;/</font> <font color="#800000">SetList</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SetVar</font> <font color="#ff0000">Name</font> <font color="#0000ff">="Cmd"</font> <font color="#0000ff">&gt;</font> Save <font color="#0000ff">&lt;/</font> <font color="#800000">SetVar</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SetVar</font> <font color="#ff0000">Name</font> <font color="#0000ff">="ID"</font> <font color="#0000ff">&gt;</font> 50023 <font color="#0000ff">&lt;/</font> <font color="#800000">SetVar</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SetVar</font> <font color="#ff0000">Name</font> <font color="#0000ff">="urn:schemas-microsoft-com:office:office#Title"</font> <font color="#0000ff">&gt;</font> Updated title <font color="#0000ff">&lt;/</font> <font color="#800000">SetVar</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">Method</font> <font color="#0000ff">&gt;</font> <br></font></code> </blockquote></li><li>  <strong>Rename a file or folder</strong> <blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Method</font> <font color="#ff0000">ID</font> <font color="#0000ff">="RenameItem"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SetList</font> <font color="#ff0000">Scope</font> <font color="#0000ff">="Request"</font> <font color="#0000ff">&gt;</font> 0e8bdba7-4486-4fa0-9a44-f80cd31f538a <font color="#0000ff">&lt;/</font> <font color="#800000">SetList</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SetVar</font> <font color="#ff0000">Name</font> <font color="#0000ff">="Cmd"</font> <font color="#0000ff">&gt;</font> Save <font color="#0000ff">&lt;/</font> <font color="#800000">SetVar</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SetVar</font> <font color="#ff0000">Name</font> <font color="#0000ff">="ID"</font> <font color="#0000ff">&gt;</font> 6 <font color="#0000ff">&lt;/</font> <font color="#800000">SetVar</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SetVar</font> <font color="#ff0000">Name</font> <font color="#0000ff">="owsfileref"</font> <font color="#0000ff">&gt;</font> /doclib/file.xls <font color="#0000ff">&lt;/</font> <font color="#800000">SetVar</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SetVar</font> <font color="#ff0000">Name</font> <font color="#0000ff">="owsnewfileref"</font> <font color="#0000ff">&gt;</font> file_new <font color="#0000ff">&lt;/</font> <font color="#800000">SetVar</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">Method</font> <font color="#0000ff">&gt;</font> <br></font></code> </blockquote><br>  In the <strong>owsnewfileref</strong> parameter <strong>, the</strong> extension and file path should not be specified.  The same CAML is used to rename folders ‚Äî in this case, the owsfileref parameter specifies the relative path to the folder to be renamed, and the new folder name in the owsnewfileref parameter. <br></li></ul>  <strong>Related Links</strong> <br><br>  <a href="http://msdn.microsoft.com/ru-ru/library/ms462365.aspx">CAML structure</a> <br>  <a href="http://msdn.microsoft.com/ru-ru/library/ms480784.aspx">WSS RPC methods</a> </div><p>Source: <a href="https://habr.com/ru/post/79212/">https://habr.com/ru/post/79212/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../79205/index.html">Having told about the product on Habrahabr and having given the link to Wikipedia, it is possible to provoke removal of article about it in Wikipedia</a></li>
<li><a href="../79206/index.html">Ronny CMS, introduction</a></li>
<li><a href="../79207/index.html">Big Evernote iPhone Update: Offline Notebooks and More</a></li>
<li><a href="../79210/index.html">Elements of the semantic web</a></li>
<li><a href="../79211/index.html">Rejector.ru - update</a></li>
<li><a href="../79217/index.html">byfly lowered the price for unlimited internet</a></li>
<li><a href="../79218/index.html">pkaÃ∂vlÃ∂inÃ∂yÃ∂ DHL, speak?</a></li>
<li><a href="../79219/index.html">Secret experiences of Wasserman-2 or Again advertising</a></li>
<li><a href="../79220/index.html">Application for reading habr offline</a></li>
<li><a href="../79222/index.html">Your dream computer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>