<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automatic generation of microcontroller software code based on event-oriented model</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Task setting : 
 Creating a complex automated system based on the controller to control various peripherals (electronic locks, motors, LED strips and ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automatic generation of microcontroller software code based on event-oriented model</h1><div class="post__text post__text-html js-mediator-article">  <b>Task setting</b> : <br>  Creating a complex automated system based on the controller to control various peripherals (electronic locks, motors, LED strips and other electronics). <br><br>  Creating this system was required for a <b>quest</b> room like <a href="http://geektimes.ru/post/264776/"><b>this</b></a> , but in the city of <b>Khabarovsk</b> . <br>  Our quest is in a different <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B5%25D1%2582%25D1%2582%25D0%25B8%25D0%25BD%25D0%25B3">setting</a> , but in general has approximately the same set of actuators: relays, locks, tapes, reed switches, etc. <br><br>  <b>Basic system requirements:</b> <br><ul><li>  <b>Reliability</b> - when developing complex systems, there is a high probability to make difficult errors, the more the code, the greater the chance to miss the error and the more time it takes to debug, it is necessary to minimize the probability of incorrect operation. </li><li>  <b>Flexibility</b> - the ability to change the logic of work with minimal time costs </li><li>  <b>Functionality</b> - control of any equipment and connection of any sensors. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/f8b/de4/970/f8bde49705cb630ec0ee5b53086aa5b4.png" alt="image"><br><a name="habracut"></a><br>  Our quest required a rather complicated scenario, in particular: <br><ul><li>  <b>The nonlinearity of the storyline -</b> players can find several different ways to solve puzzles, </li><li>  <b>Connectedness</b> - some events should occur only after the completion of a number of other game events </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/7fb/19e/5c9/7fb19e5c9035168b2e75c1bcab51dcee.gif" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The solution to all the problems was found largely due to the article on the <a href="http://habrahabr.ru/post/266829">‚ÄúParadigm of situation-oriented programming‚Äù</a> , applying this approach I get out of the box: <br><ul><li>  <b>Flexibility</b> - it's enough to build an event architecture. </li><li>  <b>Reliability</b> - because  all events are of the same type they can be implemented in a similar way, using simple code whose reliability can be guaranteed </li><li>  <b>Functionality</b> - events trigger actions that can be implemented in any way. </li></ul><br>  Thus, the system architecture can be built on the basis of 3 types of basic structures: <br><ul><li>  <b>Event</b> </li><li>  <b>Trigger</b> </li><li>  <b>Act</b> </li></ul><br>  With this architecture, you can also notice that if you specify the state saving condition (activated / not activated) in <b>the</b> <b>trigger</b> code <b>template,</b> you get the opportunity to use the <b>trigger state</b> as an <b>event</b> as a bonus, so you can build an arbitrarily complex system of event interconnections and nonlinearity of the algorithm . <br><br>  Due to the allocation of <b>actions</b> into a separate functional unit, we can, even at the development stage, test the program code of each action separately, debugging such code is much easier than when debugging the entire project.  Triggers will already be referenced to the debugged code. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b6e/2ee/abd/b6e2eeabd72b92fcb068805eb99fc583.png" alt="image"><br><br>  <b>Triggers</b> as a trigger condition can use any combination of events or trigger states (and \ or \ not). <br><br>  Events can be any (state of ports, messages in serial and so on), in the current implementation, the state of ports was sufficient, so while only this option is left, the functionality extensions will not take much time. <br>  When creating the system, it was decided to use equipment available on the local market, only Arduino boards turned out to be such, given the problems with delivery of mail from other regions, the fact that there are spare parts on the market matters. <br><br>  The application is configured to generate a sketch code for this platform, but if desired, adaptation for any other programming language will take only a couple of minutes. <br>  Thus, the templates for the Arduino sketch will look as simple as: <br><div class="spoiler">  <b class="spoiler_title">Main program code</b> <div class="spoiler_text"><pre><code class="cpp hljs">@<span class="hljs-function"><span class="hljs-function">init </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ @runonce } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ @loopcode } @triggers @sensors @actions</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Action code template</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//@description void @name() { bool debug=true; //@id @code //@id if (debug) { Serial.println("DoAction @name"); } }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Trigger Code Template</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//@description bool @nameActivated=false; bool @name(){ if (@nameActivated){ return true; }else { if (@event){ @nameActivated=true; Serial.println("@name Activated"); @nameDoAction(); return true; } return false; } return false; } void @nameDoAction(){ @nameActivated=true; //****************************************** @actions //****************************************** }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Sensor Code Template</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//@description bool @name() { int @namePin=@pinNumber; pinMode(@namePin, INPUT_PULLUP); int sensorVal = digitalRead(@namePin); if (sensorVal == @trueval) {return true;}else{return false;} }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Sample Initialization Template</b> <div class="spoiler_text">  In this template, you can connect libraries and declare variables and functions global for the whole project. <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;etherShield.h&gt; #include &lt;ETHER_28J60.h&gt; #include &lt;EEPROM.h&gt; static uint8_t mac[6] = {0x54, 0x55, 0x58, 0x10, 0x10, 0x24}; static uint8_t ip[4] = {192, 168, 137, 15}; static uint16_t port = 80; ETHER_28J60 ethernet; bool started=false;</span></span></span></span></code> </pre><br></div></div><br>  Based on the template data, all script parameters can be set in the application window. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b02/6ef/18b/b026ef18b59ed803e65cb8b7d08b187f.png" alt="image"><br><br>  After exporting the firmware, we can get a similar code: <br><div class="spoiler">  <b class="spoiler_title">A lot of letters of the sketch</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/be3/5d9/039/be35d90398d01538821c9e299c037b85.png" alt="image"><br>  <a href="http://neurowareblog.blogspot.ru/2015/10/blog-post_31.html">Sketch code sample</a> <br></div></div><br><br>  The advantage of this approach is that all the action blocks at the time of exporting the firmware are already debugged at the development stage, all the trigger blocks, sensors and action code wrappers are debugged and the code is compiled without errors and will work correctly <b>right away</b> , <b>without a debugging step</b> . <br><br>  In practice, when developing a quest room, you had to change the script many times, thanks to the application, you <b>did not need</b> to <b>change the firmware code</b> , it is <b>enough to change the parameters of the triggers in the program interface</b> . <br><br>  Photos from the quest do not attach yet, if I can, I can attach the desire.  At the moment, the equipment with the firmware created by this scheme has already completed more than 50 game cycles without a single failure. <br>  The source code of the application is <a href="https://github.com/vpuhoff/PROGen-Arduino-Sketch-Generator/">open and available to everyone</a> . <br><br>  A test application with typical template settings can be found on <a href="">github</a> . <br><br>  I hope this article will help those who decide to create a system to automate various processes, be it a smart home, a security system, or anything else. </div><p>Source: <a href="https://habr.com/ru/post/269897/">https://habr.com/ru/post/269897/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269885/index.html">Pony is a killer ...?</a></li>
<li><a href="../269887/index.html">Code Generation in Go</a></li>
<li><a href="../269889/index.html">PostgreSQL Evangelist Memo: Replicants vs. Replication</a></li>
<li><a href="../269893/index.html">Pure architecture in a go app. Part 1</a></li>
<li><a href="../269895/index.html">How I did the web version of KeePass</a></li>
<li><a href="../269899/index.html">Lua 5.3 Reference Guide</a></li>
<li><a href="../269901/index.html">Pitfalls Entity Framework and Performance</a></li>
<li><a href="../269903/index.html">Create a REST service on Rust. Part 5: Handlers, Refactoring, and Macros</a></li>
<li><a href="../269905/index.html">How we lost and again found millions without testing A / B</a></li>
<li><a href="../269907/index.html">Unpacked types of unions in Scala based on the Curry-Howard isomorphism</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>