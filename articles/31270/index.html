<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a simple MVC system in PHP 5</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 
 In this tutorial, you will learn how to build a simple MVC (Model-View-Controller, Model-Display-Controller) MVC architecture system using ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a simple MVC system in PHP 5</h1><div class="post__text post__text-html js-mediator-article"><h2>  Foreword </h2><br>  In this tutorial, you will learn how to build a simple MVC (Model-View-Controller, Model-Display-Controller) MVC architecture system using PHP 5.1 using SPL (Standard PHP Library, PHP Standard Library) features. <br><br><a name="habracut"></a><br><br><br><h2>  Introduction </h2><br>  Welcome to the first comprehensive guide for PHP 5 in <a href="http://www.phpit.net/">PHPit</a> .  You will need PHP 5.1 with SPL installed, since we will use some of the latest features of PHP 5. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this tutorial, I'm going to show you how to build a simple MVC system (MVC architecture is the most common design pattern for large web applications).  I will take you through all the steps from the beginning to the end of creating a full-fledged MVC system. <br><br><br><h2>  Single entry point </h2><br>  One of the important things in MVC is one entry point to the application instead of a heap of PHP files that do something like the following: <br><br><blockquote>  <font color="#000000"><font color="#0000BB">&lt;? php</font></font> <font color="#000000"><font color="#0000BB"><br></font></font>  <font color="#000000"><font color="#007700">include (</font> <font color="#DD0000">'global.php'</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Here is the page code</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#0000BB">?&gt;</font></font> <font color="#000000"><br></font> <br></blockquote><br><br>  We will have one file that processes all requests.  This means that we will not have to worry about connecting global.php every time we need to create a new page.  This ‚Äúone entry point‚Äù will be called index.php and at the moment will be like this: <br><br><blockquote>  <font color="#000000"><font color="#0000BB">&lt;? php</font></font> <font color="#000000"><font color="#0000BB"><br><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Do something here</font></font> <font color="#000000"><font color="#FF8000"><br><br><br></font></font>  <font color="#000000"><font color="#0000BB">?&gt;</font></font> <font color="#000000"><br></font> <br></blockquote><br><br>  As you can see, this script is not doing anything yet, but wait a minute. <br><br>  To send all requests to the main page, we will use mod_rewrite and install the RewriteRule directive in .htaccess.  Paste the following code into the .htaccess file and save it in the same directory as index.php: <br><br><blockquote><pre> RewriteEngine on <font></font>
<font></font>
 RewriteCond% {REQUEST_FILENAME}! -F
 RewriteCond% {REQUEST_FILENAME}! -D<font></font>
<font></font>
 RewriteRule ^ (. *) $ Index.php? Route = $ 1 [L, QSA]
</pre></blockquote><br><br>  First we check if the requested file exists using the RewriteCond directive, and if not, redirect the request to index.php.  Such a check for the existence of a file is necessary, since otherwise index.php will try to process all requests to the site, including requests for images.  And this is exactly what we don‚Äôt need. <br><br>  If you are unable to use .htaccess or mod_rewrite, then you will have to manually address all requests to index.php.  In other words, all links should be of the form ‚Äúindex.php? Route = [here-going request]‚Äù.  For example, ‚Äúindex.php? Route = chat / index‚Äù. <br><br>  Now that all requests go through a single entry point, we can start writing the index.php script.  The first thing we have to do is initialize the system.  Create an includes directory, and in it the startup.php file (we will have it an initialization file).  Paste the following code into index.php: <br><br><blockquote>  <font color="#000000"><font color="#0000BB">&lt;? php</font></font> <font color="#000000"><font color="#0000BB"><br><br></font></font>  <font color="#000000"><font color="#0000BB">error_reporting</font> <font color="#007700">(</font> <font color="#0000BB">E_ALL</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">if (</font> <font color="#0000BB">version_compare</font> <font color="#007700">(</font> <font color="#0000BB">phpversion</font> <font color="#007700">(),</font> <font color="#DD0000">'5.1.0'</font> <font color="#007700">,</font> <font color="#DD0000">'&lt;'</font> <font color="#007700">) ==</font> <font color="#0000BB">true</font> <font color="#007700">) {die (</font> <font color="#DD0000">'PHP5.1 Only'</font> <font color="#007700">);</font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Constants:</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#0000BB">define</font> <font color="#007700">(</font> <font color="#DD0000">'DIRSEP'</font> <font color="#007700">,</font> <font color="#0000BB">DIRECTORY_SEPARATOR</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Find the path to the site files</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ site_path</font> <font color="#007700">=</font> <font color="#0000BB">realpath</font> <font color="#007700">(</font> <font color="#0000BB">dirname</font> <font color="#007700">(</font> <font color="#0000BB">__FILE__</font> <font color="#007700">).</font> <font color="#0000BB">DIRSEP</font> <font color="#007700">.</font> <font color="#DD0000">'..'</font> <font color="#007700">.</font> <font color="#0000BB">DIRSEP</font> <font color="#007700">).</font></font>  <font color="#000000"><font color="#0000BB">DIRSEP</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">define</font> <font color="#007700">(</font> <font color="#DD0000">'site_path'</font> <font color="#007700">,</font> <font color="#0000BB">$ site_path</font> <font color="#007700">);</font></font> <font color="#000000"><br></font> <br><br>  In this example, we declare some constant, find out where the system files are, and also check that the PHP version is, well, at least, 5.1. <br><br>  The next thing to do is the Registry object (log, registry) to store global values.  It will be transferred to individual objects of the system and used to access global values, without needing to designate variables as ‚Äúglobal‚Äù or access $ GLOBALS array.  Read the article <a href="http://www.phpit.net/article/using-globals-php/">‚ÄúUsing global values ‚Äã‚Äãin PHP‚Äù</a> for more detailed information about the registry object. <br><br>  Add the following code to the startup.php file after the code in the previous example: <br><br><blockquote>  <font color="#0000BB">$ registry</font> <font color="#007700">= new</font> <font color="#0000BB">Registry</font> <font color="#007700">;</font> <br></blockquote><br><br>  If you try to start the system now, you can see the following error: <br><br><blockquote><code>Fatal error: Class 'Registry' not found in g:\Projects\PHPit\content\simple mvc php5\demo\includes\startup.php on line 12 <br></code> </blockquote><br><br>  This, of course, is not a big surprise for us, because we have not written the Registry class itself yet.  The file with the class could simply be connected using the include () function ( <em>Note. Lane: by the way, include () is not such a function, but still an expression of the language, a control structure, if you look at the <a href="http://ru2.php.net/manual/ru/function.include.php">mana</a></em> ), but let's use one of the new features in PHP 5: __autoload (). <br><br>  The magic function __autoload () is used to dynamically load classes.  When PHP detects a non-existent class, it first calls the __autoload () function and then throws an error.  We can use this opportunity to load classes on the fly. <br><br>  Paste this code <strong>before the</strong> code from the previous example: <br><br><blockquote>  <font color="#FF8000">// Load classes on the fly</font> <font color="#FF8000"><br><br></font>  <font color="#007700">function</font> <font color="#0000BB">__autoload</font> <font color="#007700">(</font> <font color="#0000BB">$ class_name</font> <font color="#007700">) {</font> <font color="#007700"><br><br></font>  <font color="#0000BB">$ filename</font> <font color="#007700">=</font> <font color="#0000BB">strtolower</font> <font color="#007700">(</font> <font color="#0000BB">$ class_name</font> <font color="#007700">).</font>  <font color="#DD0000">'.php'</font> <font color="#007700">;</font> <font color="#007700"><br><br></font>  <font color="#0000BB">$ file</font> <font color="#007700">=</font> <font color="#0000BB">site_path</font> <font color="#007700">.</font>  <font color="#DD0000">'classes'</font> <font color="#007700">.</font>  <font color="#0000BB">DIRSEP</font> <font color="#007700">.</font>  <font color="#0000BB">$ filename</font> <font color="#007700">;</font> <font color="#007700"><br><br><br></font>  <font color="#007700">if (</font> <font color="#0000BB">file_exists</font> <font color="#007700">(</font> <font color="#0000BB">$ file</font> <font color="#007700">) ==</font> <font color="#0000BB">false</font> <font color="#007700">) {</font> <font color="#007700"><br><br></font>  <font color="#007700">return</font> <font color="#0000BB">false</font> <font color="#007700">;</font> <font color="#007700"><br><br></font>  <font color="#007700">}</font> <font color="#007700"><br><br><br></font>  <font color="#007700">include (</font> <font color="#0000BB">$ file</font> <font color="#007700">);</font> <font color="#007700"><br><br></font>  <font color="#007700">}</font> <br></blockquote><br><br>  Our __autoload () function takes the class name passed as an argument to it and checks if there is a file with a similar name in the class directory.  If the file does not exist, the function simply returns false and a fatal error pops up.  But if the file exists, it will be loaded.  Those.  the required class will appear, and there will be no error. <br><br>  We have not yet created the Registry class itself, so the error will still appear.  Let's do it. <br><br><br><h2>  Creating a Registry Class </h2><br>  The Registry class is used to transfer global values ‚Äã‚Äãbetween individual objects.  This is actually a fairly simple class in which you need to implement several small methods. <br><br>  First, create a classes directory and a registry.php file in it.  Paste the following code into registry.php: <br><br><blockquote>  <font color="#000000"><font color="#0000BB">&lt;? php</font></font> <font color="#000000"><font color="#0000BB"><br><br><br></font></font>  <font color="#000000"><font color="#007700">Class</font> <font color="#0000BB">Registry</font> <font color="#007700">{</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">private $ vars</font> <font color="#007700">= array ();</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#0000BB">?&gt;</font></font> <font color="#000000"><br></font> <br></blockquote><br><br>  Now we have the ‚Äúskeleton‚Äù of the Registry class and we need to load it with methods.  Write 2 methods: set () to set values ‚Äã‚Äãand get () to get values.  You can also write a remove () method to remove values.  Add these methods to the Registry class: <br><br><blockquote>  <font color="#000000"><font color="#007700">function</font> <font color="#0000BB">set</font> <font color="#007700">(</font> <font color="#0000BB">$ key</font> <font color="#007700">,</font> <font color="#0000BB">$ var</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">if (isset (</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">vars</font> <font color="#007700">[</font> <font color="#0000BB">$ key</font> <font color="#007700">]) ==</font> <font color="#0000BB">true</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">throw</font> <font color="#007700">new</font> <font color="#0000BB">Exception</font> <font color="#007700">(</font> <font color="#DD0000">'Unable to set var `'</font> <font color="#007700">.</font> <font color="#0000BB">$ key</font> <font color="#007700">.</font> <font color="#DD0000">'`. Already set.'</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">vars</font> <font color="#007700">[</font> <font color="#0000BB">$ key</font> <font color="#007700">] =</font> <font color="#0000BB">$ var</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">return</font> <font color="#0000BB">true</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#007700">function</font> <font color="#0000BB">get</font> <font color="#007700">(</font> <font color="#0000BB">$ key</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">if (isset (</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">vars</font> <font color="#007700">[</font> <font color="#0000BB">$ key</font> <font color="#007700">]) ==</font> <font color="#0000BB">false</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">return</font> <font color="#0000BB">null</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#007700">return</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">vars</font> <font color="#007700">[</font> <font color="#0000BB">$ key</font> <font color="#007700">];</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#007700">function</font> <font color="#0000BB">remove</font> <font color="#007700">(</font> <font color="#0000BB">$ var</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">unset (</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">vars</font> <font color="#007700">[</font> <font color="#0000BB">$ key</font> <font color="#007700">]);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#0000BB">?&gt;</font></font> <font color="#000000"><br></font> <br></blockquote><br><br>  These methods are simple; they set, get, and remove elements from the $ vars array, which is an attribute of a class.  In the set () method, we at the same time check whether a value with the specified key already exists, and, if it exists, we generate an exception.  This is to avoid accidentally overwriting values. <br><br>  Now we have a full Registry class, but we will not stop there.  We use one of the features of the library SPL: ArrayAccess.  SPL (abbreviated from Standard PHP Library, Standard PHP Library) is a collection of interfaces and classes designed to solve common problems.  One of the SPL interfaces, ArrayAccess, can be used to provide access to an object as if it were a regular array.  Let's look at this example: <br><br><blockquote>  <font color="#000000"><font color="#0000BB">&lt;? php</font></font> <font color="#000000"><font color="#0000BB"><br><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ registry</font> <font color="#007700">= new</font> <font color="#0000BB">Registry</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Set some value</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ registry</font> <font color="#007700">-&gt;</font> <font color="#0000BB">set</font> <font color="#007700">(</font> <font color="#DD0000">'name'</font> <font color="#007700">,</font> <font color="#DD0000">'Dennis Pallett'</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Get the value using get ()</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#007700">echo</font> <font color="#0000BB">$ registry</font> <font color="#007700">-&gt;</font> <font color="#0000BB">get</font> <font color="#007700">(</font> <font color="#DD0000">'name'</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Get the value using access as an array</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#007700">echo</font> <font color="#0000BB">$ registry</font> <font color="#007700">[</font> <font color="#DD0000">'name'</font> <font color="#007700">]</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#0000BB">?&gt;</font></font> <font color="#000000"><br></font> <br></blockquote><br><br>  The trick is that $ registry becomes like an array, although in reality it is an object.  Of course, ArrayAccess does not give any special advantages, but it allows you to reduce the amount of code, since you do not have to write "-&gt; get ()" every time.  To use this interface, you need to fix the first line of the class ("Class Registry") as follows: <br><br><blockquote>  <font color="#000000"><font color="#007700">Class</font> <font color="#0000BB">Registry <font color="#007700">Implements</font> ArrayAccess</font> <font color="#007700">{</font></font> <font color="#000000"><br></font> <br></blockquote><br><br>  The keyword ‚ÄúImplements‚Äù tells the interpreter that we are implementing this class of interface, which is actually ArrayAccess. <br><br>  The class that implements the ArrayAccess interface should have the following methods: <br><br><blockquote>  <font color="#000000"><font color="#007700">function</font> <font color="#0000BB">offsetExists</font> <font color="#007700">(</font> <font color="#0000BB">$ offset</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">return isset (</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">vars</font> <font color="#007700">[</font> <font color="#0000BB">$ offset</font> <font color="#007700">]);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#007700">function</font> <font color="#0000BB">offsetGet</font> <font color="#007700">(</font> <font color="#0000BB">$ offset</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">return</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">get</font> <font color="#007700">(</font> <font color="#0000BB">$ offset</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#007700">function</font> <font color="#0000BB">offsetSet</font> <font color="#007700">(</font> <font color="#0000BB">$ offset</font> <font color="#007700">,</font> <font color="#0000BB">$ value</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">set</font> <font color="#007700">(</font> <font color="#0000BB">$ offset</font> <font color="#007700">,</font> <font color="#0000BB">$ value</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#007700">function</font> <font color="#0000BB">offsetUnset</font> <font color="#007700">(</font> <font color="#0000BB">$ offset</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">unset (</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">vars</font> <font color="#007700">[</font> <font color="#0000BB">$ offset</font> <font color="#007700">]);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><br></font> <br></blockquote><br><br>  These methods should be self-explanatory.  Further information can be found in the <a href="http://www.php.net/~helly/php/ext/spl/">SPL</a> documentation. <br><br>  Now, having implemented the ArrayAccess interface, we can access the object as a regular array.  This is clearly demonstrated, both in the previous example and in this: <br><br><blockquote>  <font color="#000000"><font color="#0000BB">&lt;? php</font></font> <font color="#000000"><font color="#0000BB"><br><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ registry</font> <font color="#007700">= new</font> <font color="#0000BB">Registry</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Set some value</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ registry</font> <font color="#007700">[</font> <font color="#DD0000">'name'</font> <font color="#007700">] =</font> <font color="#DD0000">'Dennis Pallett'</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Get the value using get ()</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#007700">echo</font> <font color="#0000BB">$ registry</font> <font color="#007700">-&gt;</font> <font color="#0000BB">get</font> <font color="#007700">(</font> <font color="#DD0000">'name'</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Get the value using access as an array</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#007700">echo</font> <font color="#0000BB">$ registry</font> <font color="#007700">[</font> <font color="#DD0000">'name'</font> <font color="#007700">]</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#0000BB">?&gt;</font></font> <font color="#000000"><br></font> <br></blockquote><br><br>  The Registry class is now complete, and if you try to start the system, everything should work (although nothing will be output yet).  We are done with the initialization file, and we can proceed to the next step of writing our MVC system: implementing database access, which is called ‚ÄúModel‚Äù in the MVC architecture. <br><br><br><br><h2>  Model </h2><br>  An ‚ÄúM‚Äù or model is part of the MVC system, which is responsible for querying the database (or another external source) and providing information to the controller.  It would be possible to load the required model depending on the request, but I prefer to slightly erase the boundaries between the model and the controller in this particular place, i.e.  the controller works with the database directly through the library of interaction with the database, rather than through a separate model.  Maybe you want to do it differently, it's a matter of taste. <br><br>  We need to write the code necessary to establish the connection with the database and place it in index.php.  There are many great libraries for working with databases (including my own, <a href="http://phpscripts.pallettgroup.com/autocrud">AutoCRUD</a> ), but in PHP 5 there is already such a library - PDO.  Therefore, there is no need to use any other. <br><br>  Paste the following code into the index.php file (after connecting the initialization file): <br><br><blockquote>  <font color="#000000"><font color="#FF8000"># Connecting to DB</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ db</font> <font color="#007700">= new</font> <font color="#0000BB">PDO</font> <font color="#007700">(</font> <font color="#DD0000">'mysql: host = localhost; dbname = demo'</font> <font color="#007700">,</font> <font color="#DD0000">'[user]'</font> <font color="#007700">,</font> <font color="#DD0000">'[password]'</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ registry</font> <font color="#007700">-&gt;</font> <font color="#0000BB">set</font> <font color="#007700">(</font> <font color="#DD0000">'db'</font> <font color="#007700">,</font> <font color="#0000BB">$ db</font> <font color="#007700">);</font></font> <font color="#000000"><br></font> <br></blockquote><br><br>  In this example, we first create a new instance of the PDO library and connect to our MySQL database.  Then we make the $ db variable globally accessible using our Registry class. <br><br>  The model component of our system is ready, so let's move on to writing a controller. <br><br>  Writing a controller also means writing the Router class responsible for loading the desired controller depending on the request (remember, the $ route variable is passed to the index.php URL). <br><br><br><br><h2>  Class router </h2><br>  The Router class will parse the request, and then load the required controller.  Create a "skeleton" class: <br><br><blockquote>  <font color="#000000"><font color="#0000BB">&lt;? php</font></font> <font color="#000000"><font color="#0000BB"><br><br><br></font></font>  <font color="#000000"><font color="#007700">Class</font> <font color="#0000BB">Router</font> <font color="#007700">{</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">private $ registry</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">private $ path</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">private $ args</font> <font color="#007700">= array ();</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#007700">function</font> <font color="#0000BB">__construct</font> <font color="#007700">(</font> <font color="#0000BB">$ registry</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">registry</font> <font color="#007700">=</font> <font color="#0000BB">$ registry</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#0000BB">?&gt;</font></font> <font color="#000000"><br></font> <br></blockquote><br><br>  Then add the following lines to index.php: <br><br><blockquote>  <font color="#000000"><font color="#FF8000"># Download router</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ router</font> <font color="#007700">= new</font> <font color="#0000BB">Router</font> <font color="#007700">(</font> <font color="#0000BB">$ registry</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ registry</font> <font color="#007700">-&gt;</font> <font color="#0000BB">set</font> <font color="#007700">(</font> <font color="#DD0000">'router'</font> <font color="#007700">,</font> <font color="#0000BB">$ router</font> <font color="#007700">);</font></font> <font color="#000000"><br></font> <br></blockquote><br><br>  We have added the Router class to our MVC system, but it is not doing anything yet, so let's add the methods necessary for our work to it. <br><br>  The first thing we write is the setPath () method to set the directory where all our controllers will be located.  The method is as follows and should be added to the Router class: <br><br><blockquote>  <font color="#000000"><font color="#007700">function</font> <font color="#0000BB">setPath</font> <font color="#007700">(</font> <font color="#0000BB">$ path</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ path</font> <font color="#007700">=</font> <font color="#0000BB">trim</font> <font color="#007700">(</font> <font color="#0000BB">$ path</font> <font color="#007700">,</font> <font color="#DD0000">'/ \\'</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ path</font> <font color="#007700">. =</font> <font color="#0000BB">DIRSEP</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#007700">if (</font> <font color="#0000BB">is_dir</font> <font color="#007700">(</font> <font color="#0000BB">$ path</font> <font color="#007700">) ==</font> <font color="#0000BB">false</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">throw</font> <font color="#007700">new</font> <font color="#0000BB">Exception</font> <font color="#007700">(</font> <font color="#DD0000">'Invalid controller path: `'</font> <font color="#007700">.</font> <font color="#0000BB">$ path</font> <font color="#007700">.</font> <font color="#DD0000">'`'</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">path</font> <font color="#007700">=</font> <font color="#0000BB">$ path</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><br></font> <br></blockquote><br><br>  Then add the following lines to index.php: <br><br><blockquote>  <font color="#000000"><font color="#0000BB">$ router</font> <font color="#007700">-&gt;</font> <font color="#0000BB">setPath</font> <font color="#007700">(</font> <font color="#0000BB">site_path</font> <font color="#007700">.</font> <font color="#DD0000">'controllers'</font> <font color="#007700">);</font></font> <font color="#000000"><br></font> <br></blockquote><br><br>  Now that we have set the path to our controllers, we will write the method responsible for loading the controller.  This method will be called delegate (), it will analyze the request.  The first piece of this method is: <br><br><blockquote>  <font color="#000000"><font color="#007700">function</font> <font color="#0000BB">delegate</font> <font color="#007700">() {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Analyze the path</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">getController</font> <font color="#007700">(</font> <font color="#0000BB">$ file</font> <font color="#007700">,</font> <font color="#0000BB">$ controller</font> <font color="#007700">,</font> <font color="#0000BB">$ action</font> <font color="#007700">,</font> <font color="#0000BB">$ args</font> <font color="#007700">);</font></font> <font color="#000000"><br></font> <br></blockquote><br><br>  As you can see, it uses another method, getController (), to get the name of the controller and several other variables.  This method looks like this: <br><br><blockquote>  <font color="#000000"><font color="#0000BB">private</font> <font color="#007700">function</font> <font color="#0000BB">getController</font> <font color="#007700">(&amp;</font> <font color="#0000BB">$ file</font> <font color="#007700">, &amp;</font> <font color="#0000BB">$ controller</font> <font color="#007700">, &amp;</font> <font color="#0000BB">$ action</font> <font color="#007700">, &amp;</font> <font color="#0000BB">$ args</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ route</font> <font color="#007700">= (empty (</font> <font color="#0000BB">$ _GET</font> <font color="#007700">[</font> <font color="#DD0000">'route'</font> <font color="#007700">]))?</font></font>  <font color="#000000"><font color="#DD0000">''</font> <font color="#007700">:</font> <font color="#0000BB">$ _GET</font> <font color="#007700">[</font> <font color="#DD0000">'route'</font> <font color="#007700">];</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#007700">if (empty (</font> <font color="#0000BB">$ route</font> <font color="#007700">)) {</font> <font color="#0000BB">$ route</font> <font color="#007700">=</font> <font color="#DD0000">'index'</font> <font color="#007700">;</font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Get the separate parts</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ route</font> <font color="#007700">=</font> <font color="#0000BB">trim</font> <font color="#007700">(</font> <font color="#0000BB">$ route</font> <font color="#007700">,</font> <font color="#DD0000">'/ \\'</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ parts</font> <font color="#007700">=</font> <font color="#0000BB">explode</font> <font color="#007700">(</font> <font color="#DD0000">'/'</font> <font color="#007700">,</font> <font color="#0000BB">$ route</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Find the right controller</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ cmd_path</font> <font color="#007700">=</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">path</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">foreach (</font> <font color="#0000BB">$ parts</font> <font color="#007700">as</font> <font color="#0000BB">$ part</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ fullpath</font> <font color="#007700">=</font> <font color="#0000BB">$ cmd_path</font> <font color="#007700">.</font></font>  <font color="#000000"><font color="#0000BB">$ part</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Is there a folder with this path?</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#007700">if (</font> <font color="#0000BB">is_dir</font> <font color="#007700">(</font> <font color="#0000BB">$ fullpath</font> <font color="#007700">)) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ cmd_path</font> <font color="#007700">. =</font> <font color="#0000BB">$ part</font> <font color="#007700">.</font></font>  <font color="#000000"><font color="#0000BB">DIRSEP</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">array_shift</font> <font color="#007700">(</font> <font color="#0000BB">$ parts</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">continue;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Find the file</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#007700">if (</font> <font color="#0000BB">is_file</font> <font color="#007700">(</font> <font color="#0000BB">$ fullpath</font> <font color="#007700">.</font> <font color="#DD0000">'.php'</font> <font color="#007700">)) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ controller</font> <font color="#007700">=</font> <font color="#0000BB">$ part</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">array_shift</font> <font color="#007700">(</font> <font color="#0000BB">$ parts</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">break;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#007700">if (empty (</font> <font color="#0000BB">$ controller</font> <font color="#007700">)) {</font> <font color="#0000BB">$ controller</font> <font color="#007700">=</font> <font color="#DD0000">'index'</font> <font color="#007700">;</font></font>  <font color="#000000"><font color="#007700">};</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Get the action</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ action</font> <font color="#007700">=</font> <font color="#0000BB">array_shift</font> <font color="#007700">(</font> <font color="#0000BB">$ parts</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">if (empty (</font> <font color="#0000BB">$ action</font> <font color="#007700">)) {</font> <font color="#0000BB">$ action</font> <font color="#007700">=</font> <font color="#DD0000">'index'</font> <font color="#007700">;</font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ file</font> <font color="#007700">=</font> <font color="#0000BB">$ cmd_path</font> <font color="#007700">.</font></font>  <font color="#000000"><font color="#0000BB">$ controller</font> <font color="#007700">.</font></font>  <font color="#000000"><font color="#DD0000">'.php'</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ args</font> <font color="#007700">=</font> <font color="#0000BB">$ parts</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><br></font> <br></blockquote><br><br>  Let's run through this method.  First, it takes the value of the $ route variable from the request, then splits it into pieces using the explode () function.  For example, the query ‚Äúmembers / view‚Äù is converted to the following array: array ('members', 'view'). <br><br>  Then, using the foreach loop, it passes through each part and checks whether this part is a directory.  If so, he attributes it to the path to the file and checks the next part.  This allows you to put controllers in subdirectories and, thus, get a hierarchy of controllers.  If the current part of the request is not a directory, but is a file, it is stored in the $ controller variable, and we exit the loop, because we have found the controller that we need. <br><br>  After the loop, we check the variable with the name of the controller.  If it is empty, then we use the ‚Äúindex‚Äù controller, which will be our default controller.  Then the method determines the action to be performed.  A controller is a class that consists of several methods.  The action points to a specific method.  If no action is specified, we will use ‚Äúindex‚Äù - the default action. <br><br>  And finally, we get the full path to the controller file, combining three variables: the path, the name of the controller, and the extension "php". <br><br>  Now that we have analyzed the request, it's time to call the delegate () method to load the controller and execute the action.  The complete delegate () method looks like this: <br><br><blockquote>  <font color="#000000"><font color="#007700">function</font> <font color="#0000BB">delegate</font> <font color="#007700">() {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Analyze the path</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">getController</font> <font color="#007700">(</font> <font color="#0000BB">$ file</font> <font color="#007700">,</font> <font color="#0000BB">$ controller</font> <font color="#007700">,</font> <font color="#0000BB">$ action</font> <font color="#007700">,</font> <font color="#0000BB">$ args</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Is the file available?</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#007700">if (</font> <font color="#0000BB">is_readable</font> <font color="#007700">(</font> <font color="#0000BB">$ file</font> <font color="#007700">) ==</font> <font color="#0000BB">false</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">die (</font> <font color="#DD0000">'404 Not Found'</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Connect the file</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#007700">include (</font> <font color="#0000BB">$ file</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Create a controller instance</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ class</font> <font color="#007700">=</font> <font color="#DD0000">'Controller_'</font> <font color="#007700">.</font></font>  <font color="#000000"><font color="#0000BB">$ controller</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ controller</font> <font color="#007700">= new</font> <font color="#0000BB">$ class</font> <font color="#007700">(</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">registry</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Is the action available?</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#007700">if (</font> <font color="#0000BB">is_callable</font> <font color="#007700">(array (</font> <font color="#0000BB">$ controller</font> <font color="#007700">,</font> <font color="#0000BB">$ action</font> <font color="#007700">)) ==</font> <font color="#0000BB">false</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">die (</font> <font color="#DD0000">'404 Not Found'</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#FF8000">// perform the action</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ controller</font> <font color="#007700">-&gt;</font> <font color="#0000BB">$ action</font> <font color="#007700">();</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><br></font> <br></blockquote><br><br>  After analyzing the request using the getController () method, we check whether the file actually exists and, if not, return a simple error message. <br><br>  After that we connect the file with the controller and create an instance of its class, which should be called ‚ÄúController_ [name]‚Äù.  A little later we will talk about controllers in more detail. <br><br>  Then we check if there is a specified action (i.e. a method) and if it is possible to access it (use the <a href="http://php.net/is_callable">is_callable ()</a> function for this).  Finally, we perform the actual action itself, on which the role of the Router class ends. <br><br>  Having written the delegate () method completely, we will add the following line to the index.php file: <br><br><blockquote>  <font color="#000000"><font color="#0000BB">$ router</font> <font color="#007700">-&gt;</font> <font color="#0000BB">delegate</font> <font color="#007700">();</font></font> <font color="#000000"><br></font> <br></blockquote><br><br>  If we try to start the system now, we will see the following error (of course, if there are no controllers directory yet): <br><br><blockquote> <code>Fatal error: Uncaught exception 'Exception' with message 'Invalid controller path: `g:\Projects\PHPit\content\simple mvc php5\demo\controllers\`' in g:\Projects\PHPit\content\simple mvc php5\demo\classes\router.php:18 Stack trace: #0 g:\Projects\PHPit\content\simple mvc php5\demo\index.php(13): Router-&gt;setPath('g:\Projects\PHP...') #1 {main} thrown in g:\Projects\PHPit\content\simple mvc php5\demo\classes\router.php on line 18 <br></code> </blockquote><br><br>  Or we will see the error ‚Äú404 Not Found‚Äù, as there is not a single controller yet.  But this is what we are going to do now. <br><br><br><br><h2>  Controller </h2><br>  The controllers in our MVC system will be fairly simple and take quite a bit of time.  First, make sure that the controllers directory exists.  Create a file controller_base.php in the classes directory and paste the following code into it: <br><br><blockquote>  <font color="#000000"><font color="#0000BB">&lt;? php</font></font> <font color="#000000"><font color="#0000BB"><br><br><br></font></font>  <font color="#000000"><font color="#0000BB">Abstract</font> <font color="#007700">Class</font> <font color="#0000BB">Controller_Base</font> <font color="#007700">{</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">protected $ registry</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#007700">function</font> <font color="#0000BB">__construct</font> <font color="#007700">(</font> <font color="#0000BB">$ registry</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">registry</font> <font color="#007700">=</font> <font color="#0000BB">$ registry</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#0000BB">abstract</font> <font color="#007700">function</font> <font color="#0000BB">index</font> <font color="#007700">();</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#0000BB">?&gt;</font></font> <font color="#000000"><br></font> <br></blockquote><br><br>  This abstract class will be the parent class for all of our controllers.  It will do only two things: save a local copy of the Registry class and, using the abstract index () method, force all child controllers to implement this method. <br><br>  Let's write our first controller.  Create an index.php file in the controllers directory and paste the following code into it: <br><br><blockquote>  <font color="#000000"><font color="#0000BB">&lt;? php</font></font> <font color="#000000"><font color="#0000BB"><br><br><br></font></font>  <font color="#000000"><font color="#007700">Class</font> <font color="#0000BB">Controller_Index</font> <font color="#007700">Extends</font> <font color="#0000BB">Controller_Base</font> <font color="#007700">{</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#007700">function</font> <font color="#0000BB">index</font> <font color="#007700">() {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">echo</font> <font color="#DD0000">'Hello from my MVC system'</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#0000BB">?&gt;</font></font> <font color="#000000"><br></font> <br></blockquote><br><br>  We have just created our first controller and, if we try to start the system, we can see the following: <br><img src="https://habrastorage.org/getpro/habr/olpictures/446/9b8/906/4469b890651c12afc60efe2e4427f1f4.jpg" width="450" height="156" hspace="10" vspace="10"><br><br>  <a href="">(Full size, 1024x357, 115 KB)</a> <br><br><br>  This means that the Router class performed its work and launched the required action from the required controller.  Let's write another controller that will match the query "members / view".  Create a file members.php in the controller directory and paste the following code into it: <br><br><blockquote>  <font color="#000000"><font color="#0000BB">&lt;? php</font></font> <font color="#000000"><font color="#0000BB"><br><br><br></font></font>  <font color="#000000"><font color="#007700">Class</font> <font color="#0000BB">Controller_Members</font> <font color="#007700">Extends</font> <font color="#0000BB">Controller_Base</font> <font color="#007700">{</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#007700">function</font> <font color="#0000BB">index</font> <font color="#007700">() {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">echo</font> <font color="#DD0000">'Default index of the members `controllers'</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#007700">function</font> <font color="#0000BB">view</font> <font color="#007700">() {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">echo</font> <font color="#DD0000">'You are viewing the members / view request'</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#0000BB">?&gt;</font></font> <font color="#000000"><br></font> <br></blockquote><br><br>  Now we‚Äôll go to our MVC system at the request of "members / view" or "index.php? Route = members / view".  We should see the following result: <br><br><img src="https://habrastorage.org/getpro/habr/olpictures/547/716/842/547716842739fe0c5bc49a94f8da2a8a.jpg" width="450" height="133" hspace="10" vspace="10"><br><br>  <a href="">(Full size, 1024x320, 117 KB)</a> <br><br><br>  Only by writing a new controller and adding a method to it, we were able to create a new page, and nothing had to be changed in the system itself.  In addition, our controllers do not need to include the global.php file or do something like that. <br><br>  Now that we have controllers, only one thing remains: "V" or "View" ("Display"). <br><br><br><br><h2>  Display </h2><br>  As is the case with models, there are several different options for creating a View component in an MVC system.  We could teach the Router class to automatically load another file, named something like this: ‚Äúview_ {name} .php‚Äù.  But in order to make the manual more understandable, we will write the Template class, which will deal with the output of templates. <br><br>  First, create a file template.php in the classes directory and paste the following code into it: <br><br><blockquote>  <font color="#000000"><font color="#0000BB">&lt;? php</font></font> <font color="#000000"><font color="#0000BB"><br><br><br></font></font>  <font color="#000000"><font color="#007700">Class</font> <font color="#0000BB">Template</font> <font color="#007700">{</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">private $ registry</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">private $ vars</font> <font color="#007700">= array ();</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#007700">function</font> <font color="#0000BB">__construct</font> <font color="#007700">(</font> <font color="#0000BB">$ registry</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">registry</font> <font color="#007700">=</font> <font color="#0000BB">$ registry</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#0000BB">?&gt;</font></font> <font color="#000000"><br></font> <br></blockquote><br><br>  Now we have the main structure of our Template class.  The next step is to add this code to the index.php file right before the lines associated with the Router class: <br><br><blockquote>  <font color="#000000"><font color="#FF8000"># Create a template object</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ template</font> <font color="#007700">= new</font> <font color="#0000BB">Template</font> <font color="#007700">(</font> <font color="#0000BB">$ registry</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ registry</font> <font color="#007700">-&gt;</font> <font color="#0000BB">set</font> <font color="#007700">(</font> <font color="#DD0000">'template'</font> <font color="#007700">,</font> <font color="#0000BB">$ template</font> <font color="#007700">);</font></font> <font color="#000000"><br></font> <br></blockquote><br><br>  Since we will need to use values ‚Äã‚Äãfrom models and controllers, we will write the set () method to set the variables available in the templates.  Let's look at an example: <br><br><blockquote>  <font color="#000000"><font color="#007700">function</font> <font color="#0000BB">set</font> <font color="#007700">(</font> <font color="#0000BB">$ varname</font> <font color="#007700">,</font> <font color="#0000BB">$ value</font> <font color="#007700">,</font> <font color="#0000BB">$ overwrite</font> <font color="#007700">=</font> <font color="#0000BB">false</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">if (isset (</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">vars</font> <font color="#007700">[</font> <font color="#0000BB">$ varname</font> <font color="#007700">]) ==</font> <font color="#0000BB">true</font> <font color="#007700">AND</font> <font color="#0000BB">$ overwrite</font> <font color="#007700">==</font> <font color="#0000BB">false</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">trigger_error</font> <font color="#007700">(</font> <font color="#DD0000">'Unable to set var `'</font> <font color="#007700">.</font> <font color="#0000BB">$ varname</font> <font color="#007700">.</font> <font color="#DD0000">'`. Already set, and not allowed.'</font> <font color="#007700">,</font> <font color="#0000BB">E_USER_NOTICE</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">return</font> <font color="#0000BB">false</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">vars</font> <font color="#007700">[</font> <font color="#0000BB">$ varname</font> <font color="#007700">] =</font> <font color="#0000BB">$ value</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">return</font> <font color="#0000BB">true</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br><br></font></font>  <font color="#000000"><font color="#007700">function</font> <font color="#0000BB">remove</font> <font color="#007700">(</font> <font color="#0000BB">$ varname</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">unset (</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">vars</font> <font color="#007700">[</font> <font color="#0000BB">$ varname</font> <font color="#007700">]);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">return</font> <font color="#0000BB">true</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><br></font> <br><br>  The set () and remove () methods are fairly simple and are used, respectively, to set and remove variables. <br><br>  Let's write the show () method that will display the templates.  The easiest way is to create a separate templates directory where to store all template files, and use include () to output the template.  Of course, your own show () method can be completely different and load templates from the database or do something else.  Look at kuso </blockquote></blockquote></div><p>Source: <a href="https://habr.com/ru/post/31270/">https://habr.com/ru/post/31270/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../312684/index.html">As we came up with and made our first game on Android. Part 1: Game Mechanics</a></li>
<li><a href="../312686/index.html">Reverse Engineering "Kazakov", part three: thimbles in the LAN</a></li>
<li><a href="../312694/index.html">Women and murder: is there a relationship here? [part 2 of 2]</a></li>
<li><a href="../312696/index.html">Let's write a small but very useful plugin for Wordpress 4.6. *?</a></li>
<li><a href="../312698/index.html">IoT security issues: the researcher discovered serious vulnerabilities in MatrixSSL</a></li>
<li><a href="../312700/index.html">Security Week 41: patch week, 12-year-old vulnerability in sshd returns, StrongPity APT</a></li>
<li><a href="../312702/index.html">Councils of Western consulting companies. Part 1, theoretical</a></li>
<li><a href="../312704/index.html">Adding Bootstrap 4 Classes to the WordPress Menu</a></li>
<li><a href="../312706/index.html">RailsClub 2016: Interview with Zach Briggs</a></li>
<li><a href="../312708/index.html">From AudioBrain to AudioBrain.Language or intermediate freelancing as it is</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>