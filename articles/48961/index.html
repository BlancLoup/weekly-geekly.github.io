<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Let's beat Ruby together! Drop six</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today, we will create our first full-fledged application on Ruby, along the way learning new methods of the String and File classes and regular expres...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Let's beat Ruby together! Drop six</h1><div class="post__text post__text-html js-mediator-article"> Today, we will create our first full-fledged application on Ruby, along the way learning new methods of the <code>String</code> and <code>File</code> classes and regular expressions. <br><br><h4>  Our application: Text Analyzer </h4><br>  The program itself is simple: it will read a text file, analyze it using some patterns, read the statistics and display the result.  Ruby is great for analyzing documents and texts using regular expressions and the <code>scan</code> and <code>split</code> methods.  In this application, we will focus on simple and fast programming and will not organize an object-oriented structure. <br><a name="habracut"></a><br><br><h4>  Main features </h4><br>  Here is a list of features that we need to implement: <br><ul><li>  character count </li><li>  counting characters without spaces </li><li>  line counting </li><li>  word counting </li><li>  paragraph counting </li><li>  average words in a sentence </li><li>  average number of sentences per paragraph </li></ul><br><h4>  Implementation </h4><br>  At the beginning of the development of a new program, it is useful to provide key steps.  Let's select the main steps: <br><ul><li>  Download the file containing the text we want to analyze. </li><li>  Since we load the file by lines, we will immediately count their number for the necessary statistics. </li><li>  Paste all the text into one line and measure its length to count the characters. </li><li>  Temporarily remove all spaces and calculate the length of the new line without them. </li><li>  Split the line by spaces to find out the number of words. </li><li>  Break a line by punctuation marks to count the number of sentences </li><li>  Sort by line breaks to find out the number of paragraphs. </li><li>  Calculate to find averages for statistics. </li></ul><br>  Create a new, empty source file and save it as <code>analyzer.rb</code> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Looking for some text </h4><br>  Before you start writing code, you need to find a piece of text for tests.  In our example, we will use the first part of the <em>Oliver Twist</em> story, which you can download <a href="http://www.rubyinside.com/book/oliver.txt">here</a> .  Save the file as <code>text.txt</code> in the same place as <code>analyzer.rb</code> <br><br><h4>  File loading and row counting </h4><br>  It's time for coding!  The first step is to download the file.  Ruby provides a sufficient list of methods for file manipulations in the <code>File</code> class.  Here is the code that will open our <code>text.txt</code> : <br><br> <code>File.open("text.txt").each { |line| puts line }</code> <br> <br>  Enter the code in <code>analyzer.rb</code> and run the program.  As a result, you will see text strings running around the screen. <br><br>  You request the <code>File</code> class to open <code>text.txt</code> , and then, as is the case with arrays, call the <code>each</code> method directly on the file, forcing each line to be passed one by one to the internal block, where <code>puts</code> sends them to the screen.  Edit the code to look like this: <br><br> <code>line_count = 0 <br> File.open("text.txt").each { |line| line_count += 1 } <br> puts line_count</code> <br> <br>  You define the <code>line_count</code> variable to store the line count in it, then open the file and iterate over the lines, increasing the <code>line_count</code> by <code>1</code> each time.  At the end, you display the result on the screen (about 127 in our example).  We have the first piece for statistics! <br><br>  You have counted the lines, but we still cannot calculate the words, sentences, paragraphs.  It is easy to fix.  Let's change the code a bit and add the <code>text</code> variable to collect all the lines into it on the fly: <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">text</span></span>=<span class="hljs-string"><span class="hljs-string">''</span></span> line_count = <span class="hljs-number"><span class="hljs-number">0</span></span> File.<span class="hljs-keyword"><span class="hljs-keyword">open</span></span>("text.txt").<span class="hljs-keyword"><span class="hljs-keyword">each</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> |<span class="hljs-type"><span class="hljs-type">line</span></span>| line_count += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-type"><span class="hljs-type">text</span></span> &lt;&lt; <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> puts "#{line_count} lines"</code> </pre> <br><br>  Unlike the previous code, this represents the <code>text</code> variable and adds each line to it.  When the iteration is over, all our text is in the text. <br><br>  It would seem that the code is as concise and simple as possible, however, there are also other methods in <code>File</code> that can be used in our case.  For example, we can rewrite our code like this: <br><br> <code>lines = File.readlines("text.txt") <br> line_count = lines.size <br> text = lines.join <br> <br> puts "#{line_count} lines"</code> <br> <br>  Much easier!  The <code>readlines</code> method reads the entire file into an <em>array</em> , line by line. <br><br><h4>  Counting characters </h4><br>  Since we have collected the entire file in <code>text</code> , we can use the <code>length</code> method that is applicable to strings, which returns the size (number of characters) in the string, and, accordingly, in all of our text.  We will add the code: <br><br> <code>total_characters = text.length <br> puts "#{total_characters} characters"</code> <br> <br>  Another element of statistics that we need is the counting of characters without spaces.  To do this, we use the method of replacing characters.  Here is an example: <br><br> <code>puts "foobar".sub('bar', 'foo') #foofoo</code> <br> <br>  The <code>sub</code> method found the character set passed in the first parameter and replaced them with the characters from the second.  However, the <code>sub</code> finds and modifies only one, the first occurrence of characters, the <code>gsub</code> method performs all possible replacements at once. <br><br><h4>  Regular expressions </h4><br>  What about replacing more complex patterns?  For this, <strong>regular expressions</strong> are used.  Entire books have been written on this topic, so we will limit ourselves to a brief overview of this powerful text tool.  In Ruby, regular expressions are created by enclosing a pattern between slashes (/ pattern /).  And in Ruby, of course, these are also objects.  For example, you can specify the following pattern to select lines containing <em>Perl</em> text or <em>Python</em> text: <code>/Perl|Python/</code> .  In slashes we have our pattern consisting of two words we need, separated by a straight line (pipe, pipe, |).  This symbol means "either that which is on the left, or that which is on the right."  You can also use parentheses, as in numerical expressions: <code>/P(erl|ython)/</code> . <br><br>  In the patterns, you can implement the repetition: <code>/ab+c/</code> (this is not addition, we consider as <code>a</code> , then <code>b+</code> , then <code></code> ).  Such a pattern corresponds to a string containing the occurrence of <em>a</em> , then one or more <em>b</em> , and finally <em>c</em> .  Replace the plus with an asterisk, now / ab * c / matches a string containing <em>a</em> , zero or more <em>b</em> and <em>c</em> .  <code>+</code> and <code>*</code> are the so-called <strong>quantifiers</strong> , whose purpose, I think, is clear <br><br>  We can also select strings containing certain characters.  The simplest example is patterns of classes of characters, for example, \ s means whitespace (these are spaces, tabs, line breaks, etc.), all numbers fall under \ d, and others. Here is a summary taken from the Ruby textbook on Wikibooks : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/edd/87a/290/edd87a290a92c9085793ca63e226064c.png"><br><br><h4>  We continue to read characters </h4><br>  So, now we know how to remove all unnecessary characters from a string: <br><br> <code>total_characters_nospaces = text.gsub(/\s+/, '').length <br> puts "#{total_characters_nospaces} characters excluding spaces"</code> <br> <br>  Add this code to the end of our file and proceed to the counting of words. <br><br><h4>  Count the words </h4><br>  To count the number of words, there are two approaches: <br><ol><li>  Calculate the number of groups of continuous characters using the <code>scan</code> method </li><li>  Split the text into whitespace characters and count the resulting fragments using <code>split</code> and <code>size</code> . </li></ol><br>  Let's go on the second path.  By default (without parameters) <code>split</code> will <code>split</code> string into whitespace and put the fragments into an array.  We only need to know the length of the array.  We add the code: <br><br> <code>word_count = text.split.length <br> puts "#{word_count} words"</code> <br> <br><h4>  We count sentences and paragraphs. </h4><br>  If we understand how the counting of symbols was implemented, then there will be no difficulties with sentences and paragraphs.  The only difference in the pattern by which we break the text.  For a sentence, this is a period, question and exclamation marks, for paragraphs - double line break.  Here is the code: <br><br> <code>paragraph_count = text.split(/\n\n/).length <br> puts "#{paragraph_count} paragraphs" <br> sentence_count = text.split(/\.|\?|!/).length <br> puts "#{sentence_count} sentences"</code> <br> <br>  I think the code is clear.  The only difficulty can make a pattern for proposals.  However, he only looks scary.  We can not just put characters <code>.</code>  and <code>?</code>  - we ‚Äúshield‚Äù them with a slash. <br><br><h4>  Counting Other Values </h4><br>  We already have the number of words, paragraphs and sentences in the word_count variables, <br>  paragraph_count and sentence_count respectively, therefore only arithmetic works further: <br><br> <code>puts "#{sentence_count / paragraph_count} sentences per paragraph (average)" <br> puts "#{word_count / sentence_count} words per sentence (average)"</code> <br> <br><h4>  Source </h4><br>  We supplemented the source code step by step, so the logic and the output on the screen we mixed.  Let's put everything in its place.  Further, only cosmetic changes: <br><br> <code>lines = File.readlines("text.txt") <br> line_count = lines.size <br> text = lines.join <br> word_count = text.split.length <br> character_count = text.length <br> character_count_nospaces = text.gsub(/\s+/, '').length <br> paragraph_count = text.split(/\n\n/).length <br> sentence_count = text.split(/\.|\?|!/).length <br> <br> puts "#{line_count} lines" <br> puts "#{character_count} characters" <br> puts "#{character_count_nospaces} characters excluding spaces" <br> puts "#{word_count} words" <br> puts "#{paragraph_count} paragraphs" <br> puts "#{sentence_count} sentences" <br> puts "#{sentence_count / paragraph_count} sentences per paragraph (average)" <br> puts "#{word_count / sentence_count} words per sentence (average)"</code> <br> <br>  If everything nakodnoe above you understand - my congratulations!  So we knowingly "dripped";) <br><br><h4>  Epilogue </h4><br>  Another big drop.  Written more for very beginner programmers, for those who know other PLs is a good opportunity to compare Ruby‚Äôs abilities.  I suggest that from time to time, I often continue to do similar issues with the analysis of ready-made solutions.  Thanks for the example to Peter Cooper!  Waiting for feedback and comments!  We are waiting for the next drop;) <br><br></div><p>Source: <a href="https://habr.com/ru/post/48961/">https://habr.com/ru/post/48961/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../48953/index.html">Federal Online Exam - bugs and features</a></li>
<li><a href="../48954/index.html">Working with the clipboard in Linux: theory and practice</a></li>
<li><a href="../48955/index.html">Subtleties of routing in the Zend Framework</a></li>
<li><a href="../48956/index.html">InTV.ru: painless video viewing</a></li>
<li><a href="../48960/index.html">Run VMware Player as Windows Service</a></li>
<li><a href="../48963/index.html">Ribbon? It's simple! or working with cascading style sheets (CSS) in Qt</a></li>
<li><a href="../48968/index.html">IE8: the most complete description of innovations for the programmer (and not only)</a></li>
<li><a href="../48970/index.html">Search for menu functions in the program</a></li>
<li><a href="../48971/index.html">Is it easy to be young?</a></li>
<li><a href="../48972/index.html">How to make a full-featured server from a cheap and simple router.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>