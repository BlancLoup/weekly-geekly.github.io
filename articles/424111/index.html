<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Smart Contracts Waves. First experience</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In April 2018, the Waves team unveiled their non-turing-complete smart contracts. 

 A little later, when the Hackathon Waves was announced, I decided...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Smart Contracts Waves. First experience</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/ip/ma/mp/ipmampafkwgxtl86xk0emyupu9u.png" alt="image"><br><br>  In April 2018, the Waves team unveiled their non-turing-complete smart contracts. <br><br>  A little later, when the Hackathon Waves was announced, I decided it was time to dive into the new technology.  Under the cut you will find detailed information about the smart contract that won third place on the hackathon. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The article will be useful for developers to implement their own smart contracts and get acquainted with the technology. <br><a name="habracut"></a><br><h4>  Idea </h4><br>  The idea of ‚Äã‚Äãthe project is to automatically distribute the salaries of software developers using Github, in proportion to the work performed.  The main task that the smart contract solves is that it saves us from having to trust the money-distributing program, allows even the user without programming skills to check the allocation of funds before transferring money <br><br><h4>  Technology stack </h4><br>  Html and JavaScript (Node.js Waves <a href="https://github.com/wavesplatform/waves-api">library</a> ), open <a href="https://github.com/Lipnevich/smart-rewarding">source</a> on GitHub and <a href="https://smart-rewarding.firebaseapp.com/">demonstration of the project</a> on Firebase Hosting <br><br><h4>  Process </h4><br><ol><li>  The user chooses the GitHub repository and determines the total amount of salaries. </li><li>  The user makes a payment in 0.01 Waves (approximately $ 0.02) to save data in the blockchain and create a smart contract </li><li>  The user checks the accuracy of the data and then transfers the amount of salaries to the address of the smart contract </li><li>  Salaries are distributed among developers </li></ol><br><h4>  Development </h4><br>  The best entry point for a novice developer is a <a href="http://demo.wavesplatform.com/example/console/">demo console</a> containing an example and a console for testing code.  During development, it is better to use a <a href="https://testnet.wavesexplorer.com/">test blockchain</a> , where you can get 10 free test waves with <a href="https://testnet.wavesexplorer.com/faucet">one click</a> .  And although Google still does not find many examples because of the new technology, smart contracts are well <a href="https://docs.wavesplatform.com/en/technical-details/waves-contracts-language-description.html">documented</a> and contain all the necessary information. <br><br>  The NodeJs library (1.4.0) already works well in browsers (except for creating Alias), but, unfortunately, it is NOT yet compatible with Google Functions or React Native (the Waves developers <a href="https://github.com/wavesplatform/waves-api/issues/69">promise to</a> fix it soon). <br><br><h4>  Smart contract </h4><br>  A smart contract is created for one account and checks every action with this account (except for incoming money transfers): <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> signature = base58<span class="hljs-string"><span class="hljs-string">'${currentWallet.keyPair.publicKey}'</span></span>; match tx { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> tx:<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TransferTransaction</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> employerAddress = addressFromPublicKey(tx.senderPk); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dateKey = toBase58String(addressFromRecipient(tx.recipient).bytes); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> salary = extract(getLong(employerAddress, dateKey)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((salary == tx.amount) &amp;&amp; sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">0</span></span>], signature)) then <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre> <br><h4>  Line by line smart contract parsing </h4><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> signature = base58<span class="hljs-string"><span class="hljs-string">'${currentWallet.keyPair.publicKey}'</span></span>;</code> </pre><br>  Here we save the public key of the wallet (your JavaScript must contain the currentWallet variable created using the Waves.Seed.create () command), so that only the smart wallet contract account (Smart Rewarding Project in our case) can transfer funds. <br><br><pre> <code class="javascript hljs">match tx { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> tx:<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TransferTransaction</span></span></span><span class="hljs-function"> =&gt;</span></span> {some validations} <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre> <br>  This is the basic construction of any smart contract. Waves tells us that this contract prohibits any activity except transferring funds (TransferTransaction).  Thus, after creating a contract, it is impossible to change data about developers (DataTransaction) or to change the smart contract itself (SetScript). <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> employerAddress = addressFromPublicKey(tx.senderPk);</code> </pre><br>  Here, the built-in <a href="https://docs.wavesplatform.com/en/technical-details/waves-contracts-language-description/standard-library.html">library's</a> base addressFromPublicKey method is used to get the address of the request creator from its public key. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dateKey = toBase58String(addressFromRecipient(tx.recipient).bytes);</code> </pre><br>  The base method addressFromRecipient gets the address of the recipient of funds <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> salary = extract(getLong(employerAddress, dateKey));</code> </pre><br>  The base getLong method gives us the data stored in the blockchain at the address of the request creator, which is the sum of the developer‚Äôs salary.  The contract can access data stored on the Waves blockchain (and can NOT access data located on any website or a third-party server). <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((salary == tx.amount) &amp;&amp; sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">0</span></span>], signature)) then <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br>  Here is the verification of the amount and signature.  True means that the transaction will be allowed, and false means that the transaction will be denied.  Thus, for any transfer of money from this account, it is checked that money will be sent only to the developer‚Äôs wallet and to the amount already stored in the block chain in the format of an easily readable pair of keys (address as key and amount as value), which allows credibility of the program, check all data yourself for 5-10 seconds before the transfer of salaries. <br><br>  Online demonstration of the project on a test blockchain, available <a href="https://smart-rewarding.firebaseapp.com/">here.</a> <br>  <a href="https://github.com/Lipnevich/smart-rewarding">Here</a> you can see the project code. <br><br>  I hope that the article was informative and will be useful to you for writing your first smart contract. </div><p>Source: <a href="https://habr.com/ru/post/424111/">https://habr.com/ru/post/424111/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../424099/index.html">Determine the ripeness of watermelon with the help of Keras: a full cycle, from idea to program on Google Play</a></li>
<li><a href="../424103/index.html">Silicon Valley "unforgivable" refers to its employees since the 1970s</a></li>
<li><a href="../424105/index.html">NASA knows how to make Mars green again.</a></li>
<li><a href="../424107/index.html">Already a year, as in the WD My Cloud's home network storage, gaping hole</a></li>
<li><a href="../424109/index.html">VSCE # 2: a podcast about media entrepreneurs</a></li>
<li><a href="../424113/index.html">Design process, research and job search</a></li>
<li><a href="../424115/index.html">Applications or what is missing load balancers</a></li>
<li><a href="../424119/index.html">Was there Scrum *?</a></li>
<li><a href="../424121/index.html">Creating a trigger function in pgModeler</a></li>
<li><a href="../424129/index.html">Development for Android. A bit about fast work with lists</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>