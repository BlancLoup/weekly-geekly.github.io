<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we did the cloud automation system of the restaurant business</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! The first entry in the corporate blog does not pretend to any encyclopedic significance, so please do not judge strictly, it‚Äôs just an acqua...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we did the cloud automation system of the restaurant business</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  The first entry in the corporate blog does not pretend to any encyclopedic significance, so please do not judge strictly, it‚Äôs just an acquaintance with the company and the product being developed. <br><br>  And this story is about how we developed an automation system for restaurants. <br><br> <a href="http://habrahabr.ru/company/quickresto/blog/257389/"><img src="https://habrastorage.org/files/a47/6cb/552/a476cb5529c749648904894d5c5e1748.jpg"></a> <br><a name="habracut"></a><br><h3>  <font color="#c8262d">How did it all start?</font> </h3><br>  Our small development company, all coming from a large software development company for banks and processing centers, receives an order for a mobile application for a delivery service.  One of the TK points was the integration of this application with the automation system used by the customer institution.  In carrying out the work, we became seriously interested first in the system with which we had to interact, then in automating such a business in general.  Perturbations on the themes ‚ÄúWhy do they all do this?  This is inconvenient! ‚Äù,‚Äú They all use sensor monoblocks, why not tablets? ‚Äù,‚Äú Who taught them to design interfaces ‚Äùdid not subside for hours.  And then someone said, "And let's make our own, with blackjack tablets and beautiful (comfortable), we can."  It was a wonderful year 2013, the month of March ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, we decided on the concept, the key feature of the new system should be the ease of deployment, management, the ability to start work with minimal investment of manpower and resources and continue to receive benefits from this system as the business expands.  It would be just great if the owner of the restaurant business could afford automation in a few clicks.  But how to achieve this?  What should be the architectural solutions that provide a similar level of ease of deployment and operation? <br><br>  Ok google, we have an ipad from which a compact and convenient terminal would come out.  We drew the first prototype of the interface, assembled the application: <br><br><img src="https://habrastorage.org/files/37b/162/e4d/37b162e4df974028861051c197d6c8cc.png"><br><br>  And it started ... <br><br><h3>  <font color="#c8262d">Where does iPad have a COM port?</font> </h3><br>  We undoubtedly live in a great country.  In a country where government agencies use technology the day before yesterday, and this has to be reckoned with.  We will not go into the requirements of the tax service for small business, but if someone suddenly does not know, technically it looks like this: you must use a device that keeps records of all your sales and stores them on its carrier, which you must pass to the Federal Tax Service every year .  And everything would be fine, but this device works mainly on the COM port, and innovations in the form of a BT connection increase the response time at times.  So how to make the iPad work with a special kind of thermal printers, which in Russia is proudly called Fiscal Registrars? <br><br>  We again returned to the idea that if we had a regular computer at our disposal, we could connect peripheral devices to it.  If necessary, we could even develop drivers for unsupported devices and thus ensure their operation.  But there is no separate computer, and connecting something to the iPad via lightning port is almost impossible, at least because of Apple certification.  The ideal solution would be some kind of "box" that does not require maintenance and provides us with an interface to peripheral devices.  Of course, we could have developed our own device based on some kind of microcontroller, but our company didn‚Äôt have an electronics specialist to undertake this task.  In addition, the development of such a device on its own would significantly increase the availability of the entire system.  We went in search of a ready-made solution, on the basis of which we could build our system. <br><br>  And this solution was found in the form of the beloved Raspberry Pi.  "Raspberry" is inexpensive, compact, consumes little energy, allows you to connect devices via USB ports (which can be converted to COM with low blood) Thus the problem of connecting peripherals at the level of "iron" disappears.  Also a significant advantage was the fact that the "raspberry" works under Linux, that is, developing software stuffing for this platform is much easier than, for example, for microcontrollers.  The procedure for updating the software for Raspberry is simple and clear - pulled out the SD card with the old version, inserted the media with the new version.  If necessary, it can even be performed by a non-specialist, which means that it is more than our initial idea of ‚Äã‚Äãa system that does not require special services and an individual specialist who will be responsible for this. <br><br>  Is this not happiness for technical support services?  Technically, if necessary, such a device can be accessed remotely, for example, via SSH, in order to fix a problem.  This also requires restaurant staff to take actions at the level of ‚Äúconnect the device to the network, press certain buttons and wait for our specialists to deal with the problem‚Äù. <br><br>  After analyzing all this, we added <b>QRBox</b> to our system - this name was given to Raspberry Pi as a final product.  It interacts with the rest of the terminals in the peer-to-peer network through CouchDB, receiving and transmitting information for and from peripheral devices.  We even tried to print our case, the result is still far from perfect: <br><br><img src="https://habrastorage.org/files/d50/d0b/e85/d50d0be850f54ce5a00fdc3237f9935a.jpg"><br><br>  For example, to print a check, the terminal places a document describing the check in CouchDB.  QRBox receives this document, forms a data packet for the fiscal registrar, makes sure that the check is printed, makes the appropriate note in CouchDB for the terminal. <br><br>  <b>Bottom line:</b> there is a solution that can be called a prototype.  The terminal prints checks, and sends / receives data via wi-fi to the local machine.  Go to the back-office. <br><br><h3>  <font color="#c8262d">Do you need a server?</font> </h3><br>  Of course, one of the most costly to deploy and maintain components of the automation system is a server that provides management of all other devices.  You need to purchase a server, you need to install an OS on it, the necessary services, configure the network, ensure uninterrupted power supply, cooling, backup;  you need to make sure that the hard disk space does not end, so that the hard disks themselves are replaced in time when there is a threat of a breakdown or at the actual breakdown - and many more and much more.  This requires not only financial investments, but also human resources.  We need a system administrator who will take on this job, the system administrator needs to pay, he can get sick at the most inopportune moment, he can quit, maybe ... <br><br>  And what if you do without a server?  Of course, it is impossible to completely do without it, but what if having your own server in every restaurant chain or even in every restaurant becomes unnecessary?  What if the server is located somewhere far away, in a well-equipped server room, under the vigilant supervision of qualified specialists?  What if the server is, in the latest fashion, in the "cloud", the road to the clouds is becoming wider and more accessible, why not? <br><br>  At first, this idea seemed strange.  After all, everyone understands that the work of cloud services depends entirely on the quality of communication with them.  The Internet connection will disappear at any of the possible sites from the ‚Äúcloud‚Äù to the end user - and the restaurant will ‚Äústand up‚Äù.  Require our customers to provide online reservation?  Not always and not everywhere is possible, and even more so for relatively little money.  And if the provision of an Internet channel requires significant investments - all the savings from eliminating the local server are lost. <br><br>  But then the thought was developed.  Is it necessary to constantly communicate with the server?  Can't the terminals have their own memory, which will store data on operations performed in the last few hours or even days, periodically uploading data to a central server?  And here we realized that we were on the verge of a solution - a peer-to-peer peer-to-peer network between terminals!  Indeed, why do we need a central server if all the necessary data is on the terminals themselves, which can exchange them among themselves? <br><br>  According to the results of the analysis, it became clear that the solution is possible and quite workable.  The same CouchDB was selected as the storage system, which supports replication between nodes in the master-out-of-the-box master mode.  Implementations of this database exist for many platforms, including Linux, iOS, Android, and even Windows, which opened up the possibility for us to port a terminal application to any of these platforms.  The result was a solution that allows you to do without a dedicated server, and put all the tasks on the terminals and the cloud service. <br><br><img src="https://habrastorage.org/files/be6/ab2/68a/be6ab268a02f4665b3f3b3348cef3c16.png"><br><br>  You can see the general scheme of the resulting solution in the diagram.  The main data repository is the PostgreSQL database, in which the data gets through the server application.  The server application that is necessary for the smooth operation of the sales points of the data is downloaded to CouchDB, from where they are replicated to the terminal databases of specific sales points.  If the replication mechanism fails, for example, as a result of a communication failure, this will not lead to fatal consequences ‚Äî replication will be restored after the causes of the failure have been eliminated, that is, communication between databases is restored.  In this case, the terminals in their work do not even notice the lack of communication with the central server - the local database is functioning and can even be updated with new data coming from other terminals that form the peering network. <br><br>  But, of course, the system administrator needs his own workplace, with which he could manipulate the data of the entire system as a whole.  View statistics, change global settings, register new terminals, change prices and much, much more.  Such a workplace is implemented as a web application that interacts with the main server application through the REST API. <br><br>  When developing a web application, the latest achievements of the industry in building responsive web applications were used, in particular, the kendo UI components and the AngularJS framework were chosen as the basis.  The use of off-the-shelf components has greatly reduced the time to develop the user interface, allowing us to focus on providing clear, convenient and universal ways to manage data.  As a result, the administrator has the ability to both obtain detailed data on individual objects of the system, as well as to observe the overall picture using reports and providing aggregated data. <br><br><h3>  <font color="#c8262d">What's next?</font> </h3><br>  The product is released, it is gaining momentum, and it seems that even not only we like it :) <br><br><img src="https://habrastorage.org/files/151/12b/ff4/15112bff43914cf98a877f75fe5b2b25.png"><br><br><img src="https://habrastorage.org/files/3a1/e74/609/3a1e746096f14aa696a8250bcf852262.png"><br><br>  Gradually we increase functionality and we rule pop-up bugs.  Watching the emergence of competitors.  Weekday startup word.  But today, perhaps, everything will be described in more detail about our product and its development in the following posts.  In the meantime, we were glad to meet you and would be happy to answer your questions in the comments. <br><br>  <b>PS</b> For those who want to see the back office without registering <s>and SMS</s> , there is a filled demo layer: <a href="https://test.quickresto.ru/">test.quickresto.ru</a> (login: test password: test) </div><p>Source: <a href="https://habr.com/ru/post/257389/">https://habr.com/ru/post/257389/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../257375/index.html">‚ÄúLaundry, why are you calling me?‚Äù - we released a new 2GIS Dialer</a></li>
<li><a href="../257377/index.html">How 3CX Phone System Solves Security Issues in VoIP (Part 1)</a></li>
<li><a href="../257379/index.html">Promoting your indie game: the most important nuances that nobody knows about</a></li>
<li><a href="../257383/index.html">Navigation Drawer + Fragments: Finish the Google Guide</a></li>
<li><a href="../257387/index.html">Reverse Engineering TL431, an extremely common chip, which you have not heard</a></li>
<li><a href="../257393/index.html">Offline data handling in a mobile application using Couchbase Lite</a></li>
<li><a href="../257397/index.html">Layout of responsive emails: a detailed guide (part 2)</a></li>
<li><a href="../257401/index.html">We get acquainted with Fabric.js. Part 4</a></li>
<li><a href="../257403/index.html">The first 6 lectures of the online school Android developers</a></li>
<li><a href="../257405/index.html">Recognizing users' physical activity with examples on R</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>