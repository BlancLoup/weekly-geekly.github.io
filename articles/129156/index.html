<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we developed the integration of an online store with 1C: Enterprise and why it became a mass</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="How to ensure the current catalog of products and their availability on the website and process customer orders in accordance with internal business p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we developed the integration of an online store with 1C: Enterprise and why it became a mass</h1><div class="post__text post__text-html js-mediator-article">  How to ensure the current catalog of products and their availability on the website and process customer orders in accordance with internal business processes?  Many online store owners face this challenge. <br><br>  Integrating a single online store with the accounting system of the enterprise as a whole is easy.  Implementing a ready-made integration in the boxed delivery of a CMS system and making it simple and understandable for mass use, universal for various tasks is a difficult and interesting task.  This topic is about our experience in developing the integration of an online store with the popular 1C: Enterprise account system. <br><br><img src="https://habrastorage.org/storage1/55ec91a5/c650199f/08e55a21/5987f99c.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Under the cut, we will tell you how tasks were set, architecture and technical solutions were chosen, what happened as a result, how it is configured and works. <br><a name="habracut"></a><br>  So, very often an online store is created in addition to the already existing channels: stores, retail outlets, dealer sales, and so on.  And, as a rule, all channels are united by a single trading and accounting system of the enterprise or an ERP system in which the main business processes of the company are carried out: <br><ul><li>  commodity nomenclature management; </li><li>  sales, purchases; </li><li>  finance, reporting, analytics, etc. </li></ul>  In this case, there is an urgent need for the online store to be integrated into a single accounting system of the enterprise or the ERP system. <br><br>  The first and most important thing in the development of integration is to realize its goals and tasks to be solved.  And from this already plan what, how and where to transfer.  When integrating a site with an ERP system, it is usually necessary to automate the solution of three main tasks: <br><ul><li>  ensuring uploading to the product catalog site (which is maintained in ERP) and supporting its relevance </li><li>  transfer of the order with the necessary information from the site to ERP </li><li>  informing customers about the progress of their orders, which are processed in ERP. </li></ul>  Everything is reasonable and simple, but, you see, many of us have witnessed how the site lives its own life, and the accounting system of its own.  When ordering a product from an online store, after the manager‚Äôs call, it was found that the product is not in stock, the price does not correspond to reality, the new exchange rate or the website published the goods in the wrong configuration or with a different color picture. <br><br>  Of course, the result for such a store here is only one possible: a frustrated and dissatisfied customer who is unlikely to want to return, despite the efforts of your managers. <br><br><img src="https://habrastorage.org/storage1/ccd59000/f082653d/580b97b3/008ed7f4.png"><br><br>  It was back in 2007.  Given the growing popularity of online stores and the growing demand for solving integration tasks, it became clear that we, as CMS system developers, had to offer our customers a <b>reliable and ready-made solution</b> for such integration: easy to set up and use. <br><br>  The first solution is with which accounting system to build such a ready integration?  At that time, and today, the most popular solution in Russia is the <a href="http://v8.1c.ru/">1C: Enterprise</a> platform, most customers want to integrate their website with 1C.  In terms of solving the problems of a trading company, the <a href="http://v8.1c.ru/trade/">1C: Trade management</a> configuration is in the greatest demand.  It was decided to integrate it with her. <br><br><img src="https://habrastorage.org/storage1/3842b148/4d208db4/08f43955/44ed35ea.png"><br><br>  Of course, everything written here also applies to solving the problem of integrating other ERP and CMS systems and sites.  Approaches and ideas are important, because approaches and ideas are universal, and the code can always be adapted. <br><br>  The task found specifics and we (in collaboration with 1C specialists) began work.  To begin with, it was necessary to decide what the interaction architecture would be.  In general, there are two boundary approaches: <br><ol><li>  Directly referring the site to 1C </li><li>  Regular data exchange between 1C and the site </li></ol><h5>  Consider the first approach - referring directly to the 1C system </h5><br>  When using it, the site, if necessary, requests from 1C or gives data. <br><br>  It should be noted that the display of the catalog on the Internet and online ordering can be done without CMS at all, 1C has such functionality as web extensions, and not so long ago the 8.2 platform and the ‚Äúmanaged application‚Äù technology, which make it possible to easily render 1C functionality browser.  But, this is a typical example of the first approach, which has the following advantages and disadvantages for our tasks. <br><br>  The advantages are obvious: <br><ul><li>  Full relevance of the catalog on the site in real-time mode </li><li>  Instant appearance of the new order in 1C </li><li>  Quickly inform the customer about the results of order processing </li></ul>  As an interface between the site and 1C, <a href="http://ru.wikipedia.org/wiki/%25C2%25E5%25E1-%25F1%25EB%25F3%25E6%25E1%25E0">web-service</a> technology is usually used (it is cross-platform and is the de facto standard for system integration). <br><br>  Then a <a href="http://www.v8.1c.ru/overview/webservices.htm">web service</a> with a set of methods is <a href="http://www.v8.1c.ru/overview/webservices.htm">published in 1C</a> , the site ‚Äúknocks‚Äù there from time to time: it takes or sends data.  It seems everything is beautiful.  BUT ...  Unfortunately, such a correct and adaptable approach has not been widely adopted.  And in our opinion, this is why: <br><br><h6>  1) Difficulty in setting up for mass use. </h6><br>  In order to publish a web service, you need to deploy a web server, register the load of the extension module, publish the web service itself.  Someone will say: what kind of complexity, what nonsense and will be generally right.  1C even has the function of automatically publishing a web service in an installed web server.  BUT ... life is life, it is difficult and incomprehensible to the mass consumer, to the non-programmer.  And when problems begin, the web service does not work, is not visible from the outside, the alias is not registered, the user is not logged on, rights are not enough, etc.  - people precipitate.  In addition, if the enterprise is large enough, then the need to attract IT professionals is obvious. <br><br><h6>  2) Dependence of the site on the work of 1C </h6><br>  The internal accounting system may not work for various reasons: software is being updated, equipment is being replaced, backup is being restored, and so on.  During these periods, your site will not be able to work correctly, as it is entirely tied to 1C.  Of course, you can take these situations into account and implement some protection on the site, which would take into account the fact that the base is not working, but this is extra code, extra logic, which complicates the web system. <br><br><h6>  3) Dependence of 1C on the work site </h6><br>  A popular online store can have very high traffic, high peak loads, a lot of orders per unit of time.  If the catalog of goods, prices and availability constantly creep into 1C, then it will be trite slowly!  Web services are a convenient, technological, but far from fast way of sharing.  And it even provided that the server 1C will work on decent equipment.  A high peak load from the site can generally paralyze the operation of the database.  Of course, the product catalog can be cached and requested from time to time, but, firstly, the first advantage of the approach is lost (permanent realtime), and secondly, the last one remains, but in our opinion, the most significant problem: the psychological ... <br><br><h6>  4) Potential threat from the site </h6><br>  Recall that 1C is the main accounting system of the enterprise, where all life is stored.  1: Trade management is usually integrated with accounting, personnel, etc.  There are complex configurations where everything is in one bottle.  Typically, the issue of security of this system is put at the forefront, and, often, is solved very simply: cutting off the cable ‚Äúwith the Internet‚Äù from the server in principle (physically, scientifically).  Now we will put ourselves in the place of the manager, who is informed that now the site will constantly crawl in 1C for the data: record, receive, update.  And even though we all know that the site climbs not directly into 1C, but through web services, which have a certain limited set of rights, it is psychologically difficult to accept.  How?  A site that can hack and infect a virus HAS ACCESS TO OUR 1C?  Well, right now, run away ...!? <br><br><img src="https://habrastorage.org/storage1/d921904f/837d8d29/74acdf46/51cf72aa.png"><br><br>  Therefore, we used the second approach. <br><br><h5>  Synchronization of data between 1C and the site on a schedule </h5><br>  In this concept, the site and 1C work independently, each has its own database, but during the established periods the necessary information is synchronized. <br><br>  Given the above psychological point, the <b>site has no access to 1C</b> !  Then, in order for everything to work, 1C should periodically access the site itself, giving or collecting information. <br><br>  The advantages compared with the first approach are obvious: <br><ul><li>  The site works independently, with its own data, does not depend on the availability of data in 1C </li><li>  1C does not accept requests from the site, does not experience additional loads </li><li>  In case of violation of the site security, 1C security is not violated. </li></ul>  The current architecture has only one drawback compared with the first approach: the delay in updating data.  If, for example, besides the site you are still trading at retail, then the goods that are still on the site in stock may already be out of stock.  The probability of a collision, of course, is inversely proportional to the update interval.  For small update intervals (a few minutes) and the average store it is very small <br><br>  But, first, we accepted the assumption, which was later proved by life: for mass e-commerce, this flaw is NOT CRITICAL.  The probability of such a situation is small and decreases with a decrease in the interval of exchange, and besides the mass of online stores generally do not trade on real balances, hiding the presence from visitors.  And if such a situation did occur, in most cases the goods can be found quite quickly. <br><br>  And secondly?  And secondly, some technological solutions were used so that a relatively short update delay interval could be made without consequences. <br><br>  Once again, we solved the problem of creating an integration that would be out of the box ready in the maximum number of cases.  Of course, there are shops for which it is critically important, but after all, many people also don‚Äôt have cars in stock and you want tuning ?!  ) And tuning already we allow ... <br><br><h6>  Speaking of transport ... </h6><br>  And what about web services, you ask?  After all, if not on the side of 1C, then now on the side of the site they will have to publish?  And on web services, we thought well, scored.  And instead of them they decided to implement the exchange according to the good old HTTP protocol using the file exchange according to the <a href="http://v8.1c.ru/edi/edi_stnd/90/92.htm">CommerceML</a> standard. <br><br>  Exchange via HTTP means that 1C accesses a script on the site and sends data files to it using the POST method.  This is good because there is no need to customize anything further.  Port 80 is open in most firewalls, because  through it, the whole office uses the Internet and 1C very often just as well on the Internet and looks.  The script on the site is included in the boxed delivery of CMS, and it also does not need to be published anywhere else. <br><br>  A CommerceML is good because it is an open standard based on XML, which is specifically designed for the exchange of commercial information: catalog classifier, groups and properties of goods, goods, orders.  Data transfer is possible between different systems, including between the site and back office.  This standard at the time of the start of work already existed and developed.  At present, version <a href="">2.05</a> is already available, where several pleasant innovations have appeared.  And, of course, we were very pleased that such a standard was already supported at that time in 1C: Enterprise. <br><br>  Examples of CommerceML files: a <a href="">file with information about products</a> , a <a href="">file with price offers</a> , a file with information about orders <a href="">from the site</a> , and <a href="">to the site</a> . <br><br>  The result is the following architecture of our integration: <br><br><img src="https://habrastorage.org/storage1/d5f4d333/2eb095e8/a8dd4430/2e8c8263.png"><br><br>  The structure of 1C: Enterprise includes a special module for exchange with the site, in which data exchange parameters are configured.  From the corporate network, the remote site (located on some hosting site) is accessed via HTTP.  The arrows leading to the site reflect the direction of requests, the initiator of which is always 1C. <br><br><h6>  1C exchange protocol with the site </h6><br>  The protocol is completely open, it can be modified and modified.  Information about the protocol is published both in the <a href="http://dev.1c-bitrix.ru/api_help/sale/catalog_protocol.php">documentation for 1C-Bitrix</a> , and <a href="http://v8.1c.ru/edi/edi_stnd/131/">on the 1C website</a> . <br><br>  So, as everything said above in words looks technically: <br><br> <code>1  http-   http-  : <br> http://&lt;&gt;/bitrix/admin/1c_exchange.php?type=catalog&amp;mode=checkauth <br>     (  "\n"): <br> 1.  "success"; <br> 2.  Cookie; <br> 3.  Cookie. <br> : <br>          1    Cookie,    "checkauth".</code> <br> <br>  The next stage 1C requests some parameters from the site in order to continue the exchange: <br><br> <code>http://&lt;&gt;/bitrix/admin/1c_exchange.php?type=&lt;&gt;&amp;mode=init (: catalog  sale,       ) <br> <br>      : <br> 1. zip=yes/no,      zip-. <br> 2. file_limit=&lt;&gt;,  &lt;&gt; -           .    ,       .</code> <br> <br>  When the connection is established and the parameters are defined, the main CommerceML file exchange begins.  Depending on the exchange mode 1C: <br><br>  a) transmits the site data on the commodity nomenclature <br><br> <code>http://&lt;&gt;/bitrix/admin/1c_exchange.php?type=catalog&amp;mode=file&amp;filename=&lt; &gt; <br> 1C        CommerceML 2,         POST.        "success".</code> <br> <br>  b) requests customer orders from the site <br><br> <code>http://&lt;&gt;/bitrix/admin/1c_exchange.php?type=sale&amp;mode=query <br> <br>      CML 2.         1   : <br> http://&lt;&gt;/bitrix/admin/1c_exchange.php?type=sale&amp;mode=success</code> <br> <br>  c) reports the results of processing previously received orders to the site. <br><br> <code>http://&lt;&gt;/bitrix/admin/1c_exchange.php?type=sale&amp;mode=file&amp;filename=&lt; &gt; <br>     ,      POST.      1-  "success".         .</code> <br> <br>  If an error occurred during any request, then the response of the 1C-Bitrix system will look like: the first line contains the word ‚Äúfailure‚Äù, and the following will describe the error that occurred during the processing of the request.  If an unhandled error occurs at the core level of the product or the sql query, then the html-code from the site will be returned. <br><br>  This is such a simple but reliable exchange procedure, which, I repeat, is based on three pillars: <br><ul><li>  HTTP communication </li><li>  The initiator of the exchange is always 1C </li><li>  Open format and exchange protocol </li></ul>  By the way, after some time, the protocol was also supported by the developers of other CMS, and today it is essentially a de facto standard for the interaction of 1C with sites.  This is very important, since initially such a task was set: not to monopolize, not to close the exchange, but to provide opportunities for further refinement, improvement of the exchange and its adaptation to specific implementations.  This means that the goal of choosing the optimal architecture, in our opinion, has been achieved. <br><br>  To the topic did not work out very long, that's all for today. <br><br>  In the second part of the article we will tell: <br><ul><li>  How the data transfer between 1C and the site was optimized </li><li>  How large amounts of data are transferred and overcome with typical hoster limitations </li><li>  What interface settings integration for specific tasks in both 1C and the site </li><li>  As an opportunity to refine the exchange and do non-standard things </li></ul><br>  To be continued‚Ä¶ <br><br>  <i>Sincerely, Business Development Manager</i> <i><br></i>  <i>Artem Ryabinkov</i> </div><p>Source: <a href="https://habr.com/ru/post/129156/">https://habr.com/ru/post/129156/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../129148/index.html">Workshop on the design of applications for Windows Phone</a></li>
<li><a href="../129149/index.html">The history of the startup Cybergame.TV</a></li>
<li><a href="../129150/index.html">SMPP Protocol Issues</a></li>
<li><a href="../129154/index.html">Facebook cookies are valid even after leaving the site.</a></li>
<li><a href="../129155/index.html">IDCEE 2011 - Investor Day Central and Eastern Europe 2011</a></li>
<li><a href="../129157/index.html">Creation of modules for PHPShop.CMS Free - Tips (Part 2)</a></li>
<li><a href="../129158/index.html">TechCrunch Founder Launches New Blog</a></li>
<li><a href="../129159/index.html">Microsoft is going to patent a modular smartphone</a></li>
<li><a href="../129160/index.html">On-line broadcast of Fadi Bishar‚Äôs lecture</a></li>
<li><a href="../129162/index.html">Predicting revolutions by analyzing open sources</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>