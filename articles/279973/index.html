<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We are friends with Scala and Android using Macroid</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Since at work I am writing on the good old Enterprise Java, I am periodically tempted to try something new and interesting. It so happened that at one...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We are friends with Scala and Android using Macroid</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/170/6db/4b5/1706db4b52424bda85b598999465ca31.png" alt="image" align="left">  Since at work I am writing on the good old Enterprise Java, I am periodically tempted to try something new and interesting.  It so happened that at one moment Scala turned out to be this new and interesting.  Then one day, looking through reports from Scala Days, I came across a report by Nick Stanchenko about a library called Macroid, which he wrote.  In this article I will try to write a small application to demonstrate its capabilities and talk about the main features of this library.  Application code is entirely available on <a href="https://github.com/cheshirrrr/macroid-for-habr">Github</a> . <br><br>  If you wanted to know how this library helps to make friends with Scala and Android, welcome under cat. <br><a name="habracut"></a><br clear="left"><h3>  What is Macroid? </h3><br>  Macroid is a DSL on Scala macros for working with the Android interface.  It gets rid of traditional XML markup problems, such as: <br><br><ul><li>  Lack of namespace, since all markup files are in the same directory; </li><li>  Excess files in the project due to the fact that each model must have its own file, as well as due to duplication of models for different screen sizes and other things; </li><li>  Even with the markup in the XML file, you still need the code (to assign the same event handlers). </li></ul><br>  Macroid allows you to describe the markup on Scala and do it where it is convenient.  And: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Abstractions are added that allow you to pull out duplicate pieces of the interface code and reuse them. </li><li>  Macroid distinguishes AppContext and ActivityContext, stores them separately from each other and passes in the form of implicit values.  The ActivityContext is stored as a weak link, thus avoiding memory leak problems. </li><li>  Thanks to the UI Action, which wraps any actions with the interface, thread safety is improved, and it is also possible to combine these actions and send them to the UI stream for execution at once. </li></ul><br>  And of course, all the advantages of Scala are also here: pattern matching, higher order functions, traits, case classes, automatic type inference, and so on. <br><br><h3>  Proceed to the application </h3><br>  First of all, we need to set up the environment for development for Android.  The procedure is described in detail on <a href="http://developer.android.com/intl/ru/training/basics/firstapp/index.html">developer.android.com</a> , so there is not much point in citing it. <br><br>  Once the environment is set up, create an SBT project and add the android-sdk-plugin. <br><br><div class="spoiler">  <b class="spoiler_title">build.sbt:</b> <div class="spoiler_text"><pre><code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.<span class="hljs-type"><span class="hljs-type">Keys</span></span>._ <span class="hljs-comment"><span class="hljs-comment">//  Android android.Plugin.androidBuild platformTarget in Android := "android-23" packagingOptions in Android := PackagingOptions( Seq.empty[String], Seq("reference.conf"), Seq.empty[String]) name := "macroid-for-habr" scalaVersion := "2.11.7" javacOptions ++= Seq("-target", "1.7", "-source", "1.7") //         Android:run run &lt;&lt;= run in Android resolvers ++= Seq( Resolver.sonatypeRepo("releases"), "jcenter" at "http://jcenter.bintray.com" ) //  linter scalacOptions in (Compile, compile) ++= (dependencyClasspath in Compile).value.files.map("-P:wartremover:cp:" + _.toURI.toURL) ++ Seq("-P:wartremover:traverser:macroid.warts.CheckUi") libraryDependencies ++= Seq( aar("org.macroid" %% "macroid" % "2.0.0-M4"), "com.android.support" % "support-v4" % "23.1.1", compilerPlugin("org.brianmckenna" %% "wartremover" % "0.11") ) //  proguard         proguardScala in Android := true</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">plugin.sbt:</b> <div class="spoiler_text"><pre> <code class="scala hljs">addSbtPlugin(<span class="hljs-string"><span class="hljs-string">"com.hanhuy.sbt"</span></span> % <span class="hljs-string"><span class="hljs-string">"android-sdk-plugin"</span></span> % <span class="hljs-string"><span class="hljs-string">"1.5.13"</span></span>)</code> </pre><br></div></div><br>  Add a simple AndroidManifest.xml: <br><br><div class="spoiler">  <b class="spoiler_title">AndroidManifest.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tutorial.macroidforhabr"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:versionCode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:versionName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-sdk</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:minSdkVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"9"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:targetSdkVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"23"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Macroid for Habr"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/android:star_big_on"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Macroid for Habr"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".MainActivity"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.MAIN"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.category.LAUNCHER"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  It remains only to create the class MainActivity and connect the trait with contexts: <br><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Activity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Contexts</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Activity</span></span></span><span class="hljs-class">]</span></span></code> </pre><br>  The resulting project is available on the <a href="https://github.com/cheshirrrr/macroid-for-habr/tree/Step1">Step1</a> tag. <br><br><h3>  Let's start with the basics </h3><br>  The interface in Macroid is folded using the ‚ÄúBrick‚Äù.  A brick is an interface brick representing a markup or a separate widget.  The markup is referred to as ‚Äúlayout‚Äù or simply ‚Äúl‚Äù, and widgets are referred to as ‚Äúwidget‚Äù or ‚Äúw‚Äù.  For example, a simple LinearLayout with a text field and a button will look like this: <br><br><pre> <code class="scala hljs">l[<span class="hljs-type"><span class="hljs-type">LinearLayout</span></span>]( w[<span class="hljs-type"><span class="hljs-type">TextView</span></span>], w[<span class="hljs-type"><span class="hljs-type">Button</span></span>] )</code> </pre><br>  Nothing prevents us from assigning such pieces of markup to variables and linking them together when and where required: <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> view = l[<span class="hljs-type"><span class="hljs-type">LinearLayout</span></span>]( w[<span class="hljs-type"><span class="hljs-type">TextView</span></span>], w[<span class="hljs-type"><span class="hljs-type">Button</span></span>] )</code> </pre><br>  Of course, the widgets need to be set up, set some properties and values ‚Äã‚Äãfor them, otherwise there is no point in them. <br>  This helps the thing called Tweak.  For brevity, tweaks are denoted by the operator &lt;~.  For example, you can set the text to the field and button: <br><br><pre> <code class="scala hljs">w[<span class="hljs-type"><span class="hljs-type">TextView</span></span>] &lt;~ text(<span class="hljs-string"><span class="hljs-string">" "</span></span>), w[<span class="hljs-type"><span class="hljs-type">Button</span></span>] &lt;~ text(<span class="hljs-string"><span class="hljs-string">" "</span></span>)</code> </pre><br>  You can also prescribe for accuracy that our widget must be vertical, with the help of vertical tweaks: <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> view = l[<span class="hljs-type"><span class="hljs-type">LinearLayout</span></span>]( w[<span class="hljs-type"><span class="hljs-type">TextView</span></span>] &lt;~ text(<span class="hljs-string"><span class="hljs-string">" "</span></span>), w[<span class="hljs-type"><span class="hljs-type">Button</span></span>] &lt;~ text(<span class="hljs-string"><span class="hljs-string">" "</span></span>) ) &lt;~ vertical</code> </pre><br>  Finally, what a button without onClickListener.  For example, you can change the text in the field by pressing the button: <br><br><pre> <code class="scala hljs">w[<span class="hljs-type"><span class="hljs-type">Button</span></span>] &lt;~ text(<span class="hljs-string"><span class="hljs-string">" "</span></span>) &lt;~ <span class="hljs-type"><span class="hljs-type">On</span></span>.click(changeText)</code> </pre><br>  The special macro On, will try to deduce the name Listener from what is written after the dot, and find it in the widget to which it is applied.  In our case, he will try to find onClickListener from the Button widget and write the changeText function in it. <br><br>  In order to change the text, you will need to somehow pass the field widget to the changeText function.  With this we can use the slot method, which wraps the widget in Option, which allows you to safely bind the result to a variable and use it in code. <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> textView = slot[<span class="hljs-type"><span class="hljs-type">TextView</span></span>]</code> </pre><br>  A specific widget is attached to the slot with the help of tweak wire: <br><br><pre> <code class="scala hljs">w[<span class="hljs-type"><span class="hljs-type">TextView</span></span>] &lt;~ wire(textView)</code> </pre><br>  Now you can return to writing the method changeText: <br><br><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">changeText</span></span></span><span class="hljs-function"> </span></span>: <span class="hljs-type"><span class="hljs-type">Ui</span></span>[<span class="hljs-type"><span class="hljs-type">Any</span></span>] = { textView &lt;~ text(<span class="hljs-string"><span class="hljs-string">" "</span></span>) }</code> </pre><br>  The method consists of one tweak and returns the same Ui Action, which is an action that will be executed in the UI stream. <br><br>  In order for the resulting markup to be applied to the MainActivity, call setContentView (getUi (view)) in the onCreate method.  The getUi (view) method will execute the UI code in the current thread and return the resulting View to us, which we will set in the ContentView of our Activity. <br><br>  The resulting code is available on the <a href="https://github.com/cheshirrrr/macroid-for-habr/tree/Step2">Step2</a> tag. <br><br><h3>  Change different parts at the same time </h3><br>  Within one Ui action, you can connect several tweaks acting on different widgets.  In this case, tweaks will be launched sequentially one after the other. <br><br>  And what if you need to run several interface changes at the same time?  An alternative to tweaks, called Snail, will help here and is denoted by the operator &lt;~~.  Snail works on the ‚Äúshot and forget‚Äù principle.  For example, you can run a fade animation for a text field: <br><br><pre> <code class="scala hljs">textView &lt;~~ fadeOut(<span class="hljs-number"><span class="hljs-number">500</span></span>)</code> </pre><br>  To sequentially merge several Snails into one, apply the operator ++.  This is what Snail can look like for flashing any View: <br><br><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flashElement</span></span></span><span class="hljs-function"> </span></span>: <span class="hljs-type"><span class="hljs-type">Snail</span></span>[<span class="hljs-type"><span class="hljs-type">View</span></span>] = { fadeOut(<span class="hljs-number"><span class="hljs-number">500</span></span>) ++ fadeIn(<span class="hljs-number"><span class="hljs-number">500</span></span>) ++ fadeOut(<span class="hljs-number"><span class="hljs-number">500</span></span>) ++ fadeIn(<span class="hljs-number"><span class="hljs-number">500</span></span>) }</code> </pre><br>  With tweaks, you can perform similar actions using the + operator. <br><br>  Add a small nested piece of linear markup with another text field and assign it to the slot: <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> layout = slot[<span class="hljs-type"><span class="hljs-type">LinearLayout</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> view = l[<span class="hljs-type"><span class="hljs-type">LinearLayout</span></span>]( w[<span class="hljs-type"><span class="hljs-type">TextView</span></span>] &lt;~ text(<span class="hljs-string"><span class="hljs-string">" "</span></span>) &lt;~ wire(textView), w[<span class="hljs-type"><span class="hljs-type">Button</span></span>] &lt;~ text(<span class="hljs-string"><span class="hljs-string">" "</span></span>) &lt;~ <span class="hljs-type"><span class="hljs-type">On</span></span>.click(changeText), l[<span class="hljs-type"><span class="hljs-type">LinearLayout</span></span>]( w[<span class="hljs-type"><span class="hljs-type">TextView</span></span>] &lt;~ text(<span class="hljs-string"><span class="hljs-string">" "</span></span>) ) &lt;~ wire(layout) ) &lt;~ vertical</code> </pre><br>  Now let's give our button more influence on the environment: <br><br><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">changeText</span></span></span><span class="hljs-function"> </span></span>: <span class="hljs-type"><span class="hljs-type">Ui</span></span>[<span class="hljs-type"><span class="hljs-type">Any</span></span>] = { (textView &lt;~ text(<span class="hljs-string"><span class="hljs-string">"?"</span></span>)) ~ (layout &lt;~~ flashElement) ~~ (textView &lt;~ text(<span class="hljs-string"><span class="hljs-string">"  "</span></span>)) }</code> </pre><br>  Now, by pressing the button in the first field, the text will change and at the same time our new piece of markup will flash, and after the end of the animation, the text will change again.  This is achieved with the help of two operators ~ and ~~.  The first statement starts both actions at the same time, and the second one, starts the next action only after the end of the previous one. <br><br>  The resulting code is available on the <a href="https://github.com/cheshirrrr/macroid-for-habr/tree/Step3">Step3</a> tag. <br><br><h3>  Lists, lists, lists </h3><br>  Surely when writing an application, we will need to display some list.  Let's see how Macroid is managed with this. <br>  If you want to create a simple list, we can use Listable.  The Listable [A, W &lt;: View] trait indicates exactly how an object of type A should be displayed using the W widget, and this is done in two simple steps: <br><br><ol><li>  Create Empty View </li><li>  Fill it with data </li></ol><br>  Add the basicListable method, which will create an empty TextView, fill it with text using tweak text () and return us an object of type Listable [String, TextView]: <br><br><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">basicListable</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> appCtx: <span class="hljs-type"><span class="hljs-type">AppContext</span></span>): <span class="hljs-type"><span class="hljs-type">Listable</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>, <span class="hljs-type"><span class="hljs-type">TextView</span></span>] = { <span class="hljs-type"><span class="hljs-type">Listable</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>].tw { w[<span class="hljs-type"><span class="hljs-type">TextView</span></span>] } { text(_) } }</code> </pre><br>  It remains only to add a ListView to our markup, apply the Listable.listAdapterTweak tweak to it and pass a simple list of strings to this tweak: <br><br><pre> <code class="scala hljs">w[<span class="hljs-type"><span class="hljs-type">ListView</span></span>] &lt;~ basicListable.listAdapterTweak(contactList)</code> </pre><br>  The resulting code is available on the <a href="https://github.com/cheshirrrr/macroid-for-habr/tree/Step4">Step4</a> tag. <br><br><h3>  Fragments </h3><br>  If we want to use fragments in our application, then here Macroid has something to offer.  First, we need to redo our Activity in FragmentActivity: <br><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FragmentActivity</span></span></span></span></code> </pre><br>  Create a snippet and put there everything related to the ListView: <br><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ListableFragment</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Fragment</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Contexts</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Fragment</span></span></span><span class="hljs-class">]</span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">basicListable</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> appCtx: <span class="hljs-type"><span class="hljs-type">AppContext</span></span>): <span class="hljs-type"><span class="hljs-type">Listable</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>, <span class="hljs-type"><span class="hljs-type">TextView</span></span>] = { <span class="hljs-type"><span class="hljs-type">Listable</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>].tw { w[<span class="hljs-type"><span class="hljs-type">TextView</span></span>] } { text(_) } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateView</span></span></span></span>(inflater: <span class="hljs-type"><span class="hljs-type">LayoutInflater</span></span>, container: <span class="hljs-type"><span class="hljs-type">ViewGroup</span></span>, savedInstanceState: <span class="hljs-type"><span class="hljs-type">Bundle</span></span>): <span class="hljs-type"><span class="hljs-type">View</span></span> = getUi { l[<span class="hljs-type"><span class="hljs-type">LinearLayout</span></span>]( w[<span class="hljs-type"><span class="hljs-type">ListView</span></span>] &lt;~ basicListable.listAdapterTweak(contactList) &lt;~ matchWidth ) }</code> </pre><br>  At the same time, let's tidy up a bit in the code and put the contact list into a separate Contacts treyte, and flashElement tweak into the Tweaks treyt. <br><br>  The fragment is inserted into the markup using a ‚Äúfragment‚Äù or ‚Äúf‚Äù and wrapped in FrameLayout using the framed method. <br><br>  The fragment needs Id and Tag, and for their creation it is proposed to use the IdGeneration treit and the IdGen and TagGen classes.  It is enough to register the desired tag and id after the point in Tag and Id and pass them to the framed method: <br><br><pre> <code class="scala hljs">f[<span class="hljs-type"><span class="hljs-type">ListableFragment</span></span>].framed(<span class="hljs-type"><span class="hljs-type">Id</span></span>.contactList, <span class="hljs-type"><span class="hljs-type">Tag</span></span>.contactList)</code> </pre><br>  The resulting code is available on the <a href="https://github.com/cheshirrrr/macroid-for-habr/tree/Step5">Step5</a> tag. <br><br><h3>  And again lists </h3><br>  On Android, when scrolling through a list with items consisting of a bunch of widgets, you may encounter performance problems due to the fact that the adapter often uses id search (findViewById ()).  As a means of dealing with this problem, the View Holder template is proposed. <br><br>  In Macroid, there is a SlottedListable trait that embodies this template, and for lists with complex elements, the author of the library advises to use it.  To use this trait, you need to override one type and two methods. <br><br>  Create a class ContactListable inside which we redefine: <br><br><ol><li>  class Slots, which is thus the View Holder and contains slots for all necessary View </li><li>  the makeSlots method in which the markup is created </li><li>  the fillSlots method in which the markup is filled with the values ‚Äã‚Äãpassed </li></ol><br>  Create a case class Contact (name: String, phone: String, photo: Int), which is a minimalistic contact with the name, phone and photo. <br><br>  Create a method fullContactList, which will return us a list of three contacts. <br><br>  In order for the contact list to look more like a real one, let's take photos in the form of a RoundedBitmapDrawable with the help of a tweak: <br><br><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">roundedDrawable</span></span></span></span>(id: <span class="hljs-type"><span class="hljs-type">Int</span></span>)(<span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> appCtx: <span class="hljs-type"><span class="hljs-type">AppContext</span></span>) = <span class="hljs-type"><span class="hljs-type">Tweak</span></span>[<span class="hljs-type"><span class="hljs-type">ImageView</span></span>]({ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> res = appCtx.app.getResources <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rounded = <span class="hljs-type"><span class="hljs-type">RoundedBitmapDrawableFactory</span></span>.create(res,<span class="hljs-type"><span class="hljs-type">BitmapFactory</span></span>.decodeResource(res, id)) rounded.setCornerRadius(<span class="hljs-type"><span class="hljs-type">Math</span></span>.min(rounded.getMinimumWidth(),rounded.getMinimumHeight)) _.setImageDrawable(rounded) })</code> </pre><br>  And also add a couple of tweaks for all sorts of visual improvements like ImageView.ScaleType.CENTER_INSIDE, reducing the image to the desired size. <br><br>  It remains only to create a fragment SlottedListableFragment, which will show this list of contacts. <br><br>  Two contact lists on one screen are a bit too much, so I suggest replacing the old ListableFragment with a new and shiny SlottedListableFragment.  To do this, we will write a new tweak, replacing one fragment, using the FragmentApi trait, kindly provided by Macroid: <br><br><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">replaceListableWithSlotted</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-type"><span class="hljs-type">Ui</span></span> { activityManager(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).beginTransaction().replace(<span class="hljs-type"><span class="hljs-type">Id</span></span>.contactList,<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">SlottedListableFragment</span></span>,<span class="hljs-type"><span class="hljs-type">Tag</span></span>.slottedList).commit() }</code> </pre><br>  And then add this tweak to the end of our long-suffering changeText method, which will now be called changeTextAndShowFragment. <br><br>  The resulting code is available on the <a href="https://github.com/cheshirrrr/macroid-for-habr/tree/Step6">Step6</a> tag. <br><br><h3>  What is Scala without Akka </h3><br>  Speaking of Scala, you can not ignore the actors and the library Akka. <br><br>  Macroid suggests using actors to transfer messages between fragments and provides the AkkaFragment trait for this.  For each AkkaFragment, an actor is created.  Actors live while the Activity lives, while the fragments live in their normal life cycle.  Thus, actors can join the interface controlled by them and be separated from it. <br><br>  First you need to add dependencies macroid-aka and akka-actor to build.sbt.  And also write the rules for Proguard in it: <br><br><div class="spoiler">  <b class="spoiler_title">proguard</b> <div class="spoiler_text"><pre> <code class="scala hljs">proguardOptions in <span class="hljs-type"><span class="hljs-type">Android</span></span> ++= <span class="hljs-type"><span class="hljs-type">Seq</span></span>( <span class="hljs-string"><span class="hljs-string">"-keep class akka.actor.Actor$class { *; }"</span></span>, <span class="hljs-string"><span class="hljs-string">"-keep class akka.actor.LightArrayRevolverScheduler { *; }"</span></span>, <span class="hljs-string"><span class="hljs-string">"-keep class akka.actor.LocalActorRefProvider { *; }"</span></span>, <span class="hljs-string"><span class="hljs-string">"-keep class akka.actor.CreatorFunctionConsumer { *; }"</span></span>, <span class="hljs-string"><span class="hljs-string">"-keep class akka.actor.TypedCreatorFunctionConsumer { *; }"</span></span>, <span class="hljs-string"><span class="hljs-string">"-keep class akka.dispatch.BoundedDequeBasedMessageQueueSemantics { *; }"</span></span>, <span class="hljs-string"><span class="hljs-string">"-keep class akka.dispatch.UnboundedMessageQueueSemantics { *; }"</span></span>, <span class="hljs-string"><span class="hljs-string">"-keep class akka.dispatch.UnboundedDequeBasedMessageQueueSemantics { *; }"</span></span>, <span class="hljs-string"><span class="hljs-string">"-keep class akka.dispatch.DequeBasedMessageQueueSemantics { *; }"</span></span>, <span class="hljs-string"><span class="hljs-string">"-keep class akka.dispatch.MultipleConsumerSemantics { *; }"</span></span>, <span class="hljs-string"><span class="hljs-string">"-keep class akka.actor.LocalActorRefProvider$Guardian { *; }"</span></span>, <span class="hljs-string"><span class="hljs-string">"-keep class akka.actor.LocalActorRefProvider$SystemGuardian { *; }"</span></span>, <span class="hljs-string"><span class="hljs-string">"-keep class akka.dispatch.UnboundedMailbox { *; }"</span></span>, <span class="hljs-string"><span class="hljs-string">"-keep class akka.actor.DefaultSupervisorStrategy { *; }"</span></span>, <span class="hljs-string"><span class="hljs-string">"-keep class macroid.akka.AkkaAndroidLogger { *; }"</span></span>, <span class="hljs-string"><span class="hljs-string">"-keep class akka.event.Logging$LogExt { *; }"</span></span> )</code> </pre><br></div></div><br>  Let's create a simple fragment with one button, the color of the text in which can be changed by calling the receiveColor method.  The name of the actor will be passed to this fragment using arguments: <br><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TweakerFragment</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AkkaFragment</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Contexts</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AkkaFragment</span></span></span><span class="hljs-class">]</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> actorName = getArguments.getString(<span class="hljs-string"><span class="hljs-string">"name"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> actor = <span class="hljs-type"><span class="hljs-type">Some</span></span>(actorSystem.actorSelection(<span class="hljs-string"><span class="hljs-string">s"/user/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$actorName</span></span></span><span class="hljs-string">"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> button = slot[<span class="hljs-type"><span class="hljs-type">Button</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">receiveColor</span></span></span></span>(textColor: <span class="hljs-type"><span class="hljs-type">Int</span></span>) = button &lt;~ color(textColor) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tweak</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-type"><span class="hljs-type">Ui</span></span>(actor.foreach(_ ! <span class="hljs-type"><span class="hljs-type">TweakerActor</span></span>.<span class="hljs-type"><span class="hljs-type">TweakHim</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateView</span></span></span></span>(inflater: <span class="hljs-type"><span class="hljs-type">LayoutInflater</span></span>, container: <span class="hljs-type"><span class="hljs-type">ViewGroup</span></span>, savedInstanceState: <span class="hljs-type"><span class="hljs-type">Bundle</span></span>) = getUi { l[<span class="hljs-type"><span class="hljs-type">FrameLayout</span></span>]( w[<span class="hljs-type"><span class="hljs-type">Button</span></span>] &lt;~ wire(button) &lt;~ text(<span class="hljs-string"><span class="hljs-string">"TweakHim"</span></span>) &lt;~ <span class="hljs-type"><span class="hljs-type">On</span></span>.click(tweak) ) } }</code> </pre><br>  Create an actor that will manage this fragment: <br><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TweakerActor</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">var tweakTarget:</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Option</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">ActorRef</span></span></span></span><span class="hljs-class"><span class="hljs-params">]</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FragmentActor</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TweakerFragment</span></span></span><span class="hljs-class">]</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-type"><span class="hljs-type">TweakerActor</span></span>._ <span class="hljs-comment"><span class="hljs-comment">// receiveUi  /  .         def receive = receiveUi andThen { case TweakHim =&gt; tweakTarget.foreach(_ ! TweakYou) case TweakYou =&gt; val chosenColor = randomColor tweakTarget = Some(sender) //withUi        withUi(f =&gt; f.receiveColor(chosenColor)) case SetTweaked(target) =&gt; tweakTarget = Some(target) //      /     case AttachUi(_) =&gt; case DetachUi =&gt; } def randomColor: Int = { val random = new Random() val red = random.nextInt(255) val green = random.nextInt(255) val blue = random.nextInt(255) Color.rgb(red, green, blue) } }</span></span></code> </pre><br>  Add an AkkaActivity treit to the MainActivity.  Add variables for a pair of identical actors and the system: <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> actorSystemName = <span class="hljs-string"><span class="hljs-string">"tutorialsystem"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tweakerOne = actorSystem.actorOf(<span class="hljs-type"><span class="hljs-type">TweakerActor</span></span>.props(<span class="hljs-type"><span class="hljs-type">None</span></span>), <span class="hljs-string"><span class="hljs-string">"tweakerOne"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tweakerTwo = actorSystem.actorOf(<span class="hljs-type"><span class="hljs-type">TweakerActor</span></span>.props(<span class="hljs-type"><span class="hljs-type">Some</span></span>(tweakerOne)), <span class="hljs-string"><span class="hljs-string">"tweakerTwo"</span></span>)</code> </pre><br>  We initialize the actors in the onCreate method and add fragments for the actors to the markup: <br><br><pre> <code class="scala hljs">l[<span class="hljs-type"><span class="hljs-type">LinearLayout</span></span>]( f[<span class="hljs-type"><span class="hljs-type">TweakerFragment</span></span>].pass(<span class="hljs-string"><span class="hljs-string">"name"</span></span> -&gt; <span class="hljs-string"><span class="hljs-string">"tweakerOne"</span></span>).framed(<span class="hljs-type"><span class="hljs-type">Id</span></span>.tweakerOne, <span class="hljs-type"><span class="hljs-type">Tag</span></span>.tweakerOne), f[<span class="hljs-type"><span class="hljs-type">TweakerFragment</span></span>].pass(<span class="hljs-string"><span class="hljs-string">"name"</span></span> -&gt; <span class="hljs-string"><span class="hljs-string">"tweakerTwo"</span></span>).framed(<span class="hljs-type"><span class="hljs-type">Id</span></span>.tweakerTwo, <span class="hljs-type"><span class="hljs-type">Tag</span></span>.tweakerTwo) ) &lt;~ horizontal</code> </pre><br>  In the onStart method, we pass the message to the first actor, and in onDestroy we write the system shutdown: <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onStart</span></span></span></span>() = { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onStart() tweakerOne ! <span class="hljs-type"><span class="hljs-type">TweakerActor</span></span>.<span class="hljs-type"><span class="hljs-type">SetTweaked</span></span>(tweakerTwo) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDestroy</span></span></span></span>() = { actorSystem.shutdown() }</code> </pre><br>  As a result, we get two fragments with buttons that can command each other to change the text color. <br><br>  The resulting code is available on the <a href="https://github.com/cheshirrrr/macroid-for-habr/tree/Step7">Step7</a> tag. <br><br><h3>  Conclusion </h3><br>  On this I finish my article.  Of course, some features of Macroid were left behind the scenes, but I hope that I managed to awaken the desire to try this library on a tooth or at least look at it.  The library is currently being developed by guys from the 47 Degrees team and is available on <a href="https://github.com/47deg/macroid">Github</a> . <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/279973/">https://habr.com/ru/post/279973/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../279963/index.html">How Big Data is Used to Analyze the Stock Market</a></li>
<li><a href="../279965/index.html">Java: improving the quality of the code (preconditions, IDEA QAPlug, GitHub Codacy integration)</a></li>
<li><a href="../279967/index.html">A detailed review of Affinity Designer (Mac OS). Part 2</a></li>
<li><a href="../279969/index.html">Open ports for NAT with NAT-PMP and UPnP IGD</a></li>
<li><a href="../279971/index.html">The absence of the program bug bounty played a cruel joke with Apple</a></li>
<li><a href="../279975/index.html">A look into the future: on the road to digital communism</a></li>
<li><a href="../279977/index.html">Development of service for downloading albums</a></li>
<li><a href="../279979/index.html">Five steps to optimize the performance of the application for Android</a></li>
<li><a href="../279983/index.html">IBM will help eliminate the effects of cyber attacks</a></li>
<li><a href="../279985/index.html">Preparing ASP.NET Core: more about working with a modular framework</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>