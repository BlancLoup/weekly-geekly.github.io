<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Win32 / Theola steals data from online banking systems using Google Chrome browser plugin</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Win32 / Theola is a malicious component of the Win32 / Mebroot.FX bootkit family (known since 2007). Malware Theola includes special browser plugins t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Win32 / Theola steals data from online banking systems using Google Chrome browser plugin</h1><div class="post__text post__text-html js-mediator-article">  <b>Win32 / Theola</b> is a malicious component of the <a href="http://www.virusradar.com/en/Win32_Mebroot/detail">Win32 / Mebroot.FX bootkit family</a> (known since 2007).  Malware Theola includes special browser plugins that Mebroot installs for online banking fraudulent transactions.  In this post we will talk about the analysis that <a href="https://twitter.com/matrosov">Alexander Matrosov</a> conducted for these malicious browser plugins, and answer the question: how is the money being stolen while working with the online banking system on an infected machine. <br><br><a name="habracut"></a>  We have seen an increase in the number of cases of detection of these plug-ins since the end of January 2013. The countries in which Theola is most common are the Netherlands, Norway, Italy, Denmark and the Czech Republic.  Statistics ESET Virus Radar shows the regions in which the prevalence of Theola infections is obvious, statistics for the week at the time of the study. <br><br><img src="https://habrastorage.org/storage2/2e4/2e9/7cb/2e42e97cbc85213e66e224c5d935bde3.png"><br>  Fig.  Regions most active Win32 / Theola. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Returning to <b>Win32 / Mebroot.FX</b> , we want to remind you that this bootkit uses typical methods of infecting the MBR, using a malicious int13 handler used to gain access to the sectors of the hard disk.  Malicious components in this case are loaded in the following order: <br><br><img src="https://habrastorage.org/storage2/7da/4fa/8ae/7da4fa8ae1a87e6374e4f553d8e611e9.png"><br><br>  <b>Chrome plugin</b> <br><br>  ESET detects a malicious plugin for Google Chrome as <b>Win32 / Theola.F</b> .  This plugin is based on the NPAPI interface ( <a href="http://developer.chrome.com/extensions/npapi.html">Netscape Plugin Application Programming Interface</a> ) and has its own module packaged using the CRX format ( <a href="http://developer.chrome.com/extensions/crx.html">CRX Package Format</a> ).  The CRX container contains the following manifest file: <br><br><img src="https://habrastorage.org/storage2/112/abc/9c6/112abc9c6b28d8fc0f546f58d19ddf70.png"><br><br>  The most interesting line in the manifest file is ‚Äúpermissions‚Äù [permissions].  With the help of it describes the actions allowed for execution for this plugin.  This set of access rights is sufficient to allow fraudsters to perform malicious operations.  Win32 / Theola is loaded into the Google Chrome browser as shown below: <br><br><img src="https://habrastorage.org/storage2/c74/5b6/965/c745b6965e01ac80bce4ac28f92ef7c1.png"><br><br>  After deobfuscation, we will see that the first JavaScript method loads its own module as a default browser plugin. <br><br><img src="https://habrastorage.org/storage2/61e/623/d5b/61e623d5b106a1df6cad54dfca40bf2d.png"><br><br>  This JavaScript module modifies a special POST method for all web forms on a loaded web page.  Also, this module makes visible the fields for entering a password, using the ability to record video to capture an image from the desktop and then send it to the attacker's server;  Obviously, this is a very original method of stealing passwords. <br><br><img src="https://habrastorage.org/storage2/f85/ce7/9f4/f85ce79f441110afc80e1045e696bbdf.png"><br><br>  The plugin loaded into the browser looks on the extension panel as follows: <br><br><img src="https://habrastorage.org/storage2/bb1/e0b/934/bb1e0b934edd00f27ae9027491aa4466.png"><br><br>  The <i>NP_GetEntryPoints ()</i> function initiates the process of loading the plug-in and receives pointers to other functions necessary for the plug-in to work in the browser.  The decompiled <i>NP_GetEntryPoints ()</i> code is shown below. <br><br><img src="https://habrastorage.org/storage2/31f/bbc/2c3/31fbbc2c3cc8be2099039d0275e2d6c4.png"><br><br>  The screenshot below shows the restored virtual methods table (vtable), which shows the main functionality of the Win32 / Theola malicious code;  it also has video recording functions that are based on the x264 open source library for recording MPEG video. <br><br><img src="https://habrastorage.org/storage2/6e5/b25/f4f/6e5b25f4fb8b973c9dbdd616a853d7d5.png"><br><br>  When the plugin is already running, the <i>addListners ()</i> function loads the javascript code to track web activity on the infected machine. <br><br><img src="https://habrastorage.org/storage2/7d0/0ab/1bb/7d00ab1bb8302f516c3f1ce1b684e47b.png"><br><br>  The JavaScript code for working with URLs is presented below. <br><br><img src="https://habrastorage.org/storage2/d9e/1be/01a/d9e1be01a685b3caae8dc5a2909f9f41.png"><br><br>  The <i>beforeNavigate</i> () method. <br><br><img src="https://habrastorage.org/storage2/dda/083/f09/dda083f090a05dfb1d38912d33e611c3.png"><br><br>  If the malicious code detects activity on the online banking webpage, it sends all sensitive information (passwords, credit card numbers, etc.) over a special named channel.  The name of this channel is generated by the following algorithm: <br><br><img src="https://habrastorage.org/storage2/925/48f/17e/92548f17e241f4af3e3da5d6944b711d.png"><br><br>  The interaction of the plug-in with the kernel mode module and other user-mode modules is implemented using special named pipe handlers.  Each such handler is responsible for executing a certain type of event. <br><br>  <b>Conclusion</b> <br><br>  Google Chrome browser is one of the most popular in the world, and its popularity among the authors of malicious code is also increasing.  Win32 / Theola implements its malicious module as a plugin to the Chrome browser.  In fact, this method is quite an effective method for complicating detection, because the plugin uses only documented APIs to manage web activity.  These documented APIs are an adequate way to work with sensitive data that is entered into web forms.  A large number of banking malware uses user-mode API intercepts to gain control over network traffic, but unlike them, Win32 / Theola uses legitimate and documented methods that are also effective, but make it possible to bypass the scan from an antivirus program much better. </div><p>Source: <a href="https://habr.com/ru/post/172917/">https://habr.com/ru/post/172917/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../172899/index.html">Once again about inventory management</a></li>
<li><a href="../172903/index.html">Meeting with members of the Virt2real team</a></li>
<li><a href="../172905/index.html">Podcast number 297. News start-up industry and Internet business: March 11 - 15</a></li>
<li><a href="../172907/index.html">JDeveloper 11g Working with Bounded Task Flows, Regions and Routers in Russian</a></li>
<li><a href="../172911/index.html">Claw drone</a></li>
<li><a href="../172921/index.html">Philips Design Line TV - ‚ÄúTV Wall‚Äù is getting closer</a></li>
<li><a href="../172923/index.html">Cryptobike, or USB server keys</a></li>
<li><a href="../172927/index.html">What we should build a PBX!</a></li>
<li><a href="../172929/index.html">Are you studying in the last years of school and are interested in engineering topics? We can come to visit you!</a></li>
<li><a href="../172931/index.html">A small educational program on intellectual property rights</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>