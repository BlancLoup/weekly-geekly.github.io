<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Python, under the pirate flag</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Yo-ho-ho, habrovchane! 

 While the IT community enthusiastically watches cryptocurrencies and their prey, I decided to remember what was lined up lon...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Python, under the pirate flag</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/ct/4r/ni/ct4rnipserplpffz-clqt3ivanu.jpeg" alt="image" align="left" height="300">  Yo-ho-ho, habrovchane! <br><br>  While the IT community enthusiastically watches cryptocurrencies and their prey, I decided to remember what was lined up long before the crypt and everything connected with it became mainstream.  Speech of course about gaming gold in MMO games. <br><br>  Python 3.6 and the advice of fellow programmers helped me implement the idea.  Although the article will be based on an example in a specific game, the goal is not to tell the hack story anymore, but to praise the <b>python</b> and show it to those who have not yet mastered <b>what a non-programmer can do with it and why it is so cool</b> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  Immediately worth some remarks: <br><br><ul><li>  If you are holy and strongly, sharply, strongly against any game in the games - you can safely close the article. </li><li>  If you are a "trump" programmer and are ready to spit saliva to prove that the python is bullshit and newbies need to be immediately dipped into manual memory management, the baby‚Äôs yaks into holy water - you can safely close the article. </li><li>  If you are a mega-qualified programmer with no prejudices, the choice is yours, but most likely my bydlokod will cut your eyes and you do spit at all. </li><li>  Beginners and fans of interesting problems - welcome aboard. </li></ul><br><h3>  Salt task </h3><br>  There is a game GuildWars2, it runs the Christmas event (mini game), which is very similar to the guitar hero with only a bell. <br><br><img src="https://habrastorage.org/webt/i8/1j/3u/i81j3ujpwc34i3gis4ngs6qi-yw.jpeg" alt="image"><br><br>  The meaning of the game is to timely press the buttons-notes 1-2-3-4 and 6-7-8-9, depending on which circle along which path comes to the center, where the character stands.  If it is very interesting, then you can watch the video on YouTube by typing guild wars 2 choir bell. <br><br>  For the full passage, albeit with inaccuracies, they give the maximum amount of valuable gifts that can be sold to the market at a price of about 5.5 silver per piece.  I calculated that for the day of uninterrupted passage of this event, you can make ~ 3,300 gifts, and this is more than 180 pure gold, the price of which is 2 rubles per unit.  on the black market.  Penny in absolute terms, but very good compared to the same crypto mining, eh?  Especially when you consider that for this we do not need an expensive video card or a paid account. <br><br>  In general, my brooks of the ideological botovod combo and I decided to automate this action, if only from sports interest. <br><br><h3>  Step 0. Analyzing </h3><br>  For automation, we need only 2 things: recognize the pixels and press the buttons. <br>  <i>Here it is required to make a small digression and say that I am not being a programmer at all, I tried to build on c ++, #, PHP, delphi and even an assembler in masm32.</i>  <i>The choice of python at this stage was almost random.</i>  <i>I just thought, ‚ÄúWhy not try to heap on python?</i>  <i>Suddenly it will be more convenient?</i>  <i>It was not a deliberate choice, then I did not even realize how cool the python was.</i> <br><br>  It was necessary to understand how to cling to the colors of the pixels and I began to look for a simple pipette that would show the color under the mouse pointer and its rgb value.  From the game I recorded videos for analysis on the bandits, so Photoshop and image editors did not fit.  Do not really cut the video into screenshots.  I needed something simple, working in real time and showing the coordinates.  Unfortunately, Google did not find a suitable recycle for me and I decided to concoct it myself.  Here's what happened: <br><br><div class="spoiler">  <b class="spoiler_title">Pipette code hid under spoiler</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> graphics <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> *<span class="hljs-comment"><span class="hljs-comment">#       ( ) import pyautogui #      (   ) import time #  . ( ) def main():#    win = GraphWin("pipetka", 200, 200, autoflush=True)#    200200     x, y = pyautogui.position()#  x, y   r, g, b = pyautogui.pixel(x, y)#   r, g, b  ColorDot = Circle(Point(100, 100), 25)#  ,   ColorDot.setFill(color_rgb(r, g, b))#        ColorDot.draw(win)#    win RGBtext = Entry(Point(win.getWidth()/2, 25), 10)#  RGB  RGBtext.draw(win)#    win RGBstring = Entry(Point(win.getWidth()/2, 45), 10)#    web  RGBstring.draw(win)#    win Coordstring = Entry(Point(win.getWidth() / 2, 185), 10)#    Coordstring.draw(win)#    win while True: #    time.sleep(0.1)#   0.1 ,       x, y = pyautogui.position()#  x, y   r, g, b = pyautogui.pixel(x, y)#   r, g, b  ColorDot.setFill(color_rgb(r, g, b))#  RGBtext.setText(pyautogui.pixel(x, y))# RGB RGBstring.setText(color_rgb(r, g, b))# web  Coordstring.setText(str(x)+" "+ str(y) )#  win.flush()#      #   . main()#  .</span></span></code> </pre> <br></div></div><br><img src="https://habrastorage.org/webt/dq/ow/3x/dqow3xbna4rlscpen0t6mqtffua.jpeg" alt="image"><br><br>  Tulsa in action.  I was digging with her and with regret found that my initial idea of ‚Äã‚Äãcapturing pixels was already in the middle, a failure: <br><br>  1) there is not enough time to determine the color and click <br><br>  2) the colors of the circles are very heterogeneous. <br><br>  3) minor deviations in the positioning of the camera strongly interfere <br><br>  However, picking on a little bit more, I had the idea to capture not the pixels of the desired color but the brightness changes in the right places.  experiments with a pipette showed that the circles are much higher on the R, G or B scale (depending on color) than the background of the playing field.  <b>In the end, I chose 8 points where the circles are in the largest size.</b> <br><br><img src="https://habrastorage.org/webt/qi/ac/pm/qiacpmewx9rjc22yjo9ee3rbl0u.jpeg" alt="image"><br><br><h3>  Step 1. Code recognition circle </h3><br><div class="spoiler">  <b class="spoiler_title">Analyzer code</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time<span class="hljs-comment"><span class="hljs-comment">#   (  ) import pyautogui#  (   ) import winsound#  ,  ,    (  ) import keyboard#     (   ) def analyzer(): etalon = [pyautogui.pixel(355, 288), pyautogui.pixel(460, 200), pyautogui.pixel(600, 130),\ pyautogui.pixel(735, 112), pyautogui.pixel(875, 109), pyautogui.pixel(1000, 145), \ pyautogui.pixel(1139, 203), pyautogui.pixel(1260, 290) ]#   trigger = [0,0,0,0,0,0,0,0]# ,   while True: change = [pyautogui.pixel(355, 288), pyautogui.pixel(460, 200), pyautogui.pixel(600, 130),\ pyautogui.pixel(735, 112), pyautogui.pixel(875, 109), pyautogui.pixel(1000, 145), \ pyautogui.pixel(1139, 203), pyautogui.pixel(1260, 290) ] #   change     for nomer in range(0,8): if change[nomer][0] &gt; etalon[nomer][0]+50 or change[nomer][1] &gt; etalon[nomer][1]+50 or change[nomer][2] &gt; etalon[nomer][2]+50: if trigger[nomer] == 0: #     R,G  B    +50     trigger[nomer] = 1#   else: if trigger[nomer] == 1: #      trigger[nomer] = 0 #   print("push " +str(nomer) + time.strftime(' %X')) #   . keyboard.wait(combination="home")#     "Home" winsound.Beep(1000, 100) #    analyzer()#  </span></span></code> </pre> <br></div></div><br>  Parsing algorithm: <br><br><ol><li>  Put the background color of the playing field into the etalon array, with which the colors of the array will be compared later. <br><br><pre> <code class="python hljs">keyboard.wait(combination=<span class="hljs-string"><span class="hljs-string">"home"</span></span>)</code> </pre> <br>  just needed to pick up the reference colors at the moment when the game is already deployed and the camera is centered </li><li>  Initialize the trigger <b>trigger</b> array.  We need it, because the python works out many times while the circle runs to the center.  Kruglyash big and the point at which we take readings is small.  That is, in order that the same round we do not register twice or more. </li><li>  We start an infinite loop in which we constantly pick up the meaning of the colors in the <b>change</b> array and compare the colors of each of the collected points with the reference colors <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> nomer <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> change[nomer][<span class="hljs-number"><span class="hljs-number">0</span></span>] &gt; etalon[nomer][<span class="hljs-number"><span class="hljs-number">0</span></span>]+<span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> change[nomer][<span class="hljs-number"><span class="hljs-number">1</span></span>] &gt; etalon[nomer][<span class="hljs-number"><span class="hljs-number">1</span></span>]+<span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> change[nomer][<span class="hljs-number"><span class="hljs-number">2</span></span>] &gt; etalon[nomer][<span class="hljs-number"><span class="hljs-number">2</span></span>]+<span class="hljs-number"><span class="hljs-number">50</span></span>:</code> </pre> </li><li>  If in the previous IF, we found out that the color of the point with the number <b>nomer is</b> brighter at least 50 units for any of the RGB values, then we check whether the trigger for this point is lit and if not, we light <br><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> trigger[nomer] == <span class="hljs-number"><span class="hljs-number">0</span></span>: trigger[nomer] = <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> </li><li>  If the color in the constantly updated <b>change</b> corresponds to the reference color, then there are two options.  Either everything is quiet and the circle is not there yet, or the circle has just moved further from the point being checked, which is a signal for pressing the button.  We are determined as a result of the state of the trigger.  If the trigger was lit, then the roundabout left.  Zero the trigger and conditionally press the button. <br><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> trigger[nomer] == <span class="hljs-number"><span class="hljs-number">1</span></span>: trigger[nomer] = <span class="hljs-number"><span class="hljs-number">0</span></span> print(<span class="hljs-string"><span class="hljs-string">"push "</span></span> +str(nomer) + time.strftime(<span class="hljs-string"><span class="hljs-string">' %X'</span></span>))</code> </pre> </li></ol><br><h3>  Step 2. Run and test </h3><br>  It is difficult to track the correctness of work and debug in the game, so I recorded the game window on bandits again and tested it. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/oq/bf/oi/oqbfoiex0ogzwzcnmpj-u10eojs.jpeg" alt="image"></div><br><br>  On the left - what gave the output of python, on the right - what I recorded, watching the video in slow motion.  As you can see there are errors in the form of extra clicks 6 and 0 - these are damn snowflakes that can not be removed.  The thing is that for the initial goal, the continuous collection of gifts, we do not need a 100% score, the game forgives the player quite a lot of mistakes.  If this were not the case, then simply it would be necessary to introduce an additional check on the white color. <br><br><h3>  Step 3. Code the buttons through the streams. </h3><br>  There is actually nothing abstruse.  We get the point number and after 2 seconds press the button.  Why after 2 seconds?  Because kruglyash from the moment when we spotted it reaches the middle in about 2 seconds.  A little trick here is that you need to press the buttons independently of each other.  We cannot pause the execution of the program by applying the classic <b>sleep ()</b> .  everything will get lost and in general kruglyashi fly fast enough.  You can organize a queue or use threads, which I think is a more elegant solution (unless of course python and many threads do not slow down on your PC). <br><br>  Add to code <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> threading <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Timer</code> </pre> <br>  and the delayed click handler itself <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delaypress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(keynum)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> keynum &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>: keynum +=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: keynum +=<span class="hljs-number"><span class="hljs-number">2</span></span> t = Timer(<span class="hljs-number"><span class="hljs-number">2</span></span>, keyboard.send, args=[str(keynum)]) t.start()</code> </pre> <br>  If a 0-1-2-3 point number arrives at the input, press the point number + 1 after 2 seconds, or 4-5-6-7, then press the number + 2 after 2 seconds (since button 5 is not activated) in the mini game) <br><br><div class="spoiler">  <b><b class="spoiler_title">Final code view:</b></b> <div class="spoiler_text"><pre> <b><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time<span class="hljs-comment"><span class="hljs-comment">#   (  ) import pyautogui#  (   ) import winsound#  ,  ,    (  ) import keyboard#     (   ) from threading import Timer#     (  ) def delaypress(keynum): if keynum &lt; 4: keynum +=1 else: keynum +=2 t = Timer(2, keyboard.send, args=[str(keynum)]) t.start() def analyzer(): etalon = [pyautogui.pixel(355, 288), pyautogui.pixel(460, 200), pyautogui.pixel(600, 130),\ pyautogui.pixel(735, 112), pyautogui.pixel(875, 109), pyautogui.pixel(1000, 145), \ pyautogui.pixel(1139, 203), pyautogui.pixel(1260, 290) ]#   trigger = [0,0,0,0,0,0,0,0]# ,   while True: change = [pyautogui.pixel(355, 288), pyautogui.pixel(460, 200), pyautogui.pixel(600, 130),\ pyautogui.pixel(735, 112), pyautogui.pixel(875, 109), pyautogui.pixel(1000, 145), \ pyautogui.pixel(1139, 203), pyautogui.pixel(1260, 290) ] #   change     for nomer in range(0,8): if change[nomer][0] &gt; etalon[nomer][0]+50 or change[nomer][1] &gt; etalon[nomer][1]+50 or change[nomer][2] &gt; etalon[nomer][2]+50: if trigger[nomer] == 0: #     R,G  B    +50     trigger[nomer] = 1#   else: if trigger[nomer] == 1: #      trigger[nomer] = 0 #   #print("push " +str(nomer) + time.strftime(' %X'))#     delaypress(nomer) #   . keyboard.wait(combination="home")#     "Home" winsound.Beep(1000, 100) #    analyzer()#  </span></span></code></b> </pre> <b><br></b> </div></div><br><h3>  Step 4. Row profit </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gm/6v/8q/gm6v8qzfozacn2fwaovrd_np_4y.jpeg" alt="image"></div><br><h3>  Conclusion and links </h3><br>  And now, as promised, I praise the python (hopefully reasonably enough). <br><br><ul><li>  Python is great for people with basic programming and googling knowledge to solve interesting problems. </li><li>  Real user friendly language.  Personally, according to my feelings, the syntax is less than three times and there is no idiotic amount of errors, as in other languages, even when writing small programs. </li><li>  Great ecosystem.  If you know how to formulate a Google question, you are more likely to find either a ready-made solution or a tool to do what you want. </li><li>  No dancing with endless recompilations.  On modern PCs, small programs are of course compiled quickly, but still it is annoying if you study and have to rebuild the project dozens of times. </li><li>  Documentation.  By simplicity, clarity and conciseness, the closest analogue was seen only in PHP. </li><li>  The python traced the features of Linux philosophy.  Even the installation of new modules is easy and pleasant and will not cause you difficulties if you have mastered some kind of apt or yum </li><li>  Python is convenient for creating all sorts of hacks and automation in games, especially those that require frequent modification.  If the article goes well, I‚Äôll tell you how easy it is to write to the memory of someone else‚Äôs process on a python, make a zoom / speed hack and control all this disgrace from the keyboard. </li></ul><br>  <a href="http://pyautogui.readthedocs.io/en/latest/cheatsheet.html">Pyautogui documentation</a> <br>  <a href="https://anh.cs.luc.edu/python/hands-on/3.1/handsonHtml/graphics.html">Graphics documentation</a> <br>  <a href="https://pypi.python.org/pypi/keyboard/">Keyboard module documentation</a> <br><br>  If there are interesting ideas for hacks on a python - write in a personal. </div><p>Source: <a href="https://habr.com/ru/post/346146/">https://habr.com/ru/post/346146/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346136/index.html">L√ñVE Development</a></li>
<li><a href="../346138/index.html">Game Design Techniques: Mixing</a></li>
<li><a href="../346140/index.html">Results of the development of computer vision in one year</a></li>
<li><a href="../346142/index.html">Hot reboot of components in React</a></li>
<li><a href="../346144/index.html">Mobile devices from the inside. Memory markup, file structure description and markup memory</a></li>
<li><a href="../346148/index.html">Configure Azure Application Insights for diagnosing software with microservice architecture</a></li>
<li><a href="../346152/index.html">The head of Intel suspected of selling the company's shares at $ 24 million due to the vulnerability of processors</a></li>
<li><a href="../346154/index.html">Simplify ReactJS Components with RxJs</a></li>
<li><a href="../346160/index.html">Open Source Cisco Cybersecurity Projects</a></li>
<li><a href="../346162/index.html">Do observers affect usability testing results?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>