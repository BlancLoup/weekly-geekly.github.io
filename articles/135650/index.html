<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>All the most fashionable</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Having read on the Internet about new, simple, fast and scalable technologies, I wanted to try them all. Suddenly they will be better than the already...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>All the most fashionable</h1><div class="post__text post__text-html js-mediator-article">  Having read on the Internet about new, simple, fast and scalable technologies, I wanted to try them all.  Suddenly they will be better than the already familiar postgresql + django + json-rpc bundles. <br><br><h4>  Project idea </h4><br>  Since there was no idea, but there was a free domain <a href="http://uglyrater.org/">uglyrater.org</a> - I had to do a rating. <br>  The essence is simple: there is a list of users who can be placed + and -.  New users are added to the rating at the page of VKontakte. <br><br><a name="habracut"></a><br>  Caution!  The article contains many subjective assessments based on personal experience! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Implementation </h4><br><br><img src="https://habrastorage.org/storage2/3e9/8a7/4c9/3e98a74c97c5a830d472f551da3ca99e.png"><br><br>  The architecture had to be intentionally complicated, otherwise everything interesting would not have been possible to try.  Plus, the operation of obtaining user data on vk api is still quite long, and the idea of ‚Äã‚Äãparallelizing it is not so bad.  For this you need MQ, the choice fell on <a href="http://www.rabbitmq.com/">RabbitMQ</a> .  You may say AMQP ‚Äúsucks‚Äù, <a href="http://www.zeromq.org/">√òMQ</a> ‚Äúour everything‚Äù, but with zeromq I have already gained enough, and in this context I‚Äôm not interested in it. <br>  RabbitMQ was used through <a href="https://github.com/pika/pika">pika</a> .  It took a minimum of code to initialize and send / receive messages, it can be viewed in <a href="https://github.com/nvbn/uglyrater/blob/master/vk_fetcher/vk_fetcher/worker.py">the worker</a> and its <a href="https://github.com/nvbn/uglyrater/blob/master/vk_fetcher/tests.py">tests</a> .  After writing, a small comparison with the already used <a href="http://www.zeroc.com/">ZerocIce</a> and √òMQ to meet this or a similar task appeared: <br><table><tbody><tr><th></th><th>  RabbitMQ </th><th>  √òMQ </th><th>  ZerocIce </th></tr><tr><td>  pros </td><td>  small amount of code; <br>  simplicity of work; </td><td>  speed; <br>  forwarding native objects; <br>  does not require his demon; </td><td>  the ability to work with remote functions and objects; <br>  the absence of the socket itself; <br>  signals / slots; </td></tr><tr><td>  Minuses </td><td>  a daemon launch is required; </td><td>  requires writing a router; <br>  a lot of code; </td><td>  requires writing a slice; <br>  requires the launch of the demon (icebox); <br>  complexity; </td></tr></tbody></table><br>  And it so happened that for the current task RabbitMQ and √òMQ fit equally well, and ZerocIce is like a cannon on a sparrow. <br><br>  Now the received and processed data must be stored somewhere.  Now nosql is fashionable, so <a href="http://www.mongodb.org/">mongodb</a> was chosen.  For this task, there is no difference regarding postgresql with orm, everything is quick and convenient. <br><br>  It is the turn of the web server.  Now the fashion for asynchrony and push from the server to the client has <a href="https://github.com/MrJoes/tornadio2">gone</a> , so <a href="http://www.tornadoweb.org/">tornado</a> and <a href="https://github.com/MrJoes/tornadio2">tornadio2 were chosen</a> , especially since <a href="http://habrahabr.ru/blogs/python/133350/">they recently wrote</a> about it on a habr.  Then the problem immediately got out; it was impossible to get cookies from tornadio2.  Therefore, I had to shake a crutch out of sending an id with a ‚Äúsecret‚Äù from a client through socketio, which made the implementation a little more difficult.  After all this, a small comparison with django + json-rpc was obtained: <br><table><tbody><tr><th></th><th>  tornado + tornadio2 </th><th>  django + json-rpc </th></tr><tr><td>  pros </td><td>  push from server; <br>  lightness; <br>  speed; </td><td>  simplicity; <br>  standardized protocol; </td></tr><tr><td>  Minuses </td><td>  complexity; <br>  "Curve" work with cookies; </td><td>  monstrosity; <br>  periodic queries for push simulation; </td></tr></tbody></table><br>  It's all ambiguous, but because of the push option with tornado still better. <br><br>  For the client side, nothing special was thought out, so they simply used the <a href="http://coffeescript.org/">coffee script</a> , <a href="http://haml-lang.com/">haml</a> and <a href="http://sass-lang.com/">sass</a> , which saved a lot of code. <br><br><h4>  Depla </h4><br>  Without thinking for a long time, I decided to deploy everything on the server through nginx using the standard scheme: <br><br><img src="https://habrastorage.org/storage2/43a/e22/d8f/43ae22d8fae714e951211b700d407eeb.png"><br><br>  But it was not there.  It turned out that nginx does not support web sockets and there were 3 solutions to the problem: <br><ol><li>  Set unstable nginx. <br>  For ubuntu, there is <a href="https://launchpad.net/~nginx/%2Barchive/development">ppa</a> , I put it out of it, but http authorization fell off, the problem did not work out.  And since the server also contains a mercurial repository with this authorization, the option quickly disappeared. </li><li>  Collect nginx with <a href="https://github.com/yaoweibin/nginx_tcp_proxy_module">tcp proxy</a> . <br>  Finding a <a href="http://www.letseehere.com/reverse-proxy-web-sockets">simple instruction</a> , everything turned out to collect.  All the old projects started.  But here either I was mistaken somewhere, or what, but the websockets didn‚Äôt work as normal.  Option disappears. </li><li>  Use HAProxy. <br>  Here we have a scheme with an overhead projector, which is easier to show with a picture: <br><br><img src="https://habrastorage.org/storage2/e5c/a41/cbe/e5ca41cbe41760b956e2c6ad82d8e64d.png"><br><br>  With it, everything started and worked well. </li></ol><br><h4>  Total </h4><br>  This, of course, everything is cool, convenient and fast, but there are still a lot of jambs.  The main joint with the deployment, but the final solution is not so bad. <br><br>  <a href="https://github.com/nvbn/uglyrater">github with code.</a> <br>  <a href="http://uglyrater.org/">In running form.</a> </div><p>Source: <a href="https://habr.com/ru/post/135650/">https://habr.com/ru/post/135650/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135641/index.html">MSP430 Developer Kit from Texas Instruments</a></li>
<li><a href="../135643/index.html">The new law requires Wi-Fi in all restaurants of the capital of Malaysia</a></li>
<li><a href="../135645/index.html">Why is coworking in Thailand covered</a></li>
<li><a href="../135646/index.html">Interview with Dries Bytaertom: About Drupal 8, Open Source, Business and India</a></li>
<li><a href="../135648/index.html">HowTo: continuous integration of the project on Django using TeamCity</a></li>
<li><a href="../135651/index.html">Hibernate-Extender or Hibernate, Spring and OSGi</a></li>
<li><a href="../135652/index.html">Which KPIs can be measured if the project schedule and budget is not very important?</a></li>
<li><a href="../135653/index.html">Literature for the winter - the new Windows Phone Training Kit</a></li>
<li><a href="../135654/index.html">We emulate PEAR DB when working with MySQL</a></li>
<li><a href="../135655/index.html">Microsoft will allow to run Linux in Windows Azure</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>