<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Liscript - we realize TCO</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In my last article, Writing a Lisp Interpreter in Java, I briefly and abstractly told about what I wrote a couple of Lisp-like interpreters that I cal...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Liscript - we realize TCO</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/58f/f34/a49/58ff34a4919a4b6c9ea37656be866cda.png"><br><br>  In my last article, <a href="https://habrahabr.ru/post/281859/">Writing a Lisp Interpreter in Java,</a> I briefly and abstractly told about what I wrote a couple of Lisp-like interpreters that I called Liscript - in Haskell and in Java.  There is nothing particularly unique and outstanding in this, but for me it was a pleasant, interesting and informative pastime.  Among other features, I mentioned the implementation of TCO (tail call optimization) - the optimization of the tail function calls by the interpreter.  This question aroused the interest of individual community members, and a proposal was made to disclose it in more detail in a separate article, which I tried to do.  I ask those interested under the cat. <br><a name="habracut"></a><br>  At first, I still allow myself to briefly outline some of the basics, because I will further refer to them to complete the picture. <br><br><h4>  Eval without Apple - like Miklouho without Maclay </h4><br>  The simplest interpreter of expressions in languages ‚Äã‚Äãof a Lisp family can be implemented as a pair of functions (pseudocode): 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="java hljs">eval (expr, env) <span class="hljs-comment"><span class="hljs-comment">// expr - , env -  if typeof(expr) = Atom //   -  return lookup(expr, env) //       elseif typeof(expr) = List //   -  evalexpr = mapeval(expr, env) //     //   eval //     return apply(evalexpr, env) //    else return expr //    apply (expr, env) // expr - , env -  op = head(expr) //  -    args = tail(expr) //  -   case op of .................. //    .................. //      .................. //    .................. //      ... //     Function f: //   -  newenv = subenv(args, f.clojure) //   -   return eval(f.body, newenv) //    //    </span></span></code> </pre> <br>  In the code above, much is simplified, for example, we don‚Äôt need and even misinterpret the entire list if the type of its operation is a conditional expression, but these are details.  It was possible and not to allocate the apply to a separate function by implementing the case on operations directly in the body of eval, it does not matter.  It is interesting that in these functions there are no cycles and destructive assignment and change of variable values, therefore in this form the interpreter can be used in any programming language that supports function calls, recursion and has (or has the ability to create) several data types, such as a simply-connected list, tree of dictionaries for the environment, and types of works (structures / classes with fields).  Also, if we leave aside user interaction (I / O) in the computation process, then these functions are ‚Äúpure‚Äù in terms of functional programming.  But even if it is possible to make internal I / O in the middle of a computation, then this variant of the interpreter is directly implemented even in a pure functional language, for example Haskell, or in any imperative language with sufficient minimum capabilities.  But in the latter case there may be a limitation - the calculation function actively uses recursion, and with a small stack depth it will overflow.  The situation is all the more aggravated if the implementation language does not support tailing call optimization - TCO. <br><br><h4>  Problem </h4><br>  I faced the problem of stack overflow when I implemented the interpreter in the Java language.  Each calculation was launched in my separate thread, and by default the stack size for one thread is very small.  I saw the following solutions: <br><br><ul><li>  increase in the size of the thread stack, is set via a special key when the program starts.  Does not solve the problem completely - the maximum stack size is also limited, but does not require any costs. </li><li>  implementation of a different interpreter structure, for example, on a register machine (see SICP).  I have not tried it, but I think it will solve the problem of tail recursion only. </li><li>  sequential computation in multiple threads.  When implementing, I encountered the difficulty of writing a reliably working version. </li><li>  transfer calculations from stack to pile - springboards, etc.  The naive implementation of the iterative conversion of the entire AST was very slow, but did not master the optimal one. </li></ul><br>  Most likely there are good and reliable solutions to this problem, but ultimately I settled on a compromise - implemented in the above simple version of the TCO interpreter, and together with the possibility of increasing the size of the flow stack, this allows in many cases to avoid overflow.  This interpreter was conceived as a toy, pet project, so this compromise solution suits me so far.  But I do not exclude the possibility that in the future I will come up with a better solution. <br><br><h4>  Decision </h4><br>  The key to the solution is, when it is possible, not to call the eval function again and again recursively, plunging deeper into the stack, but to organize an explicit loop inside it in which to perform the necessary calculations.  To do this, you can proceed as follows - divide the calculation of the result of applying the function to the arguments into 2 options - let's call them conditionally ‚Äústrict‚Äù and ‚Äúlazy‚Äù.  With a strict calculation, the function will still return the final result of the calculations, and with a lazy one, some intermediate object that will contain the function itself (along with its body and its own environment, which is part of its attributes), and a list of the calculated values ‚Äã‚Äãof the arguments with whom she should be called.  Let's call this object FuncCall, below is the code of the function classes and FuncCall (the latter does not contain JavaDocs because it is an internal private class, but its essence is trivial and understandable without explanation): <br><br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/**   Liscript -  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Func</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/**      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ConsList pars; <span class="hljs-comment"><span class="hljs-comment">/**   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Object body; <span class="hljs-comment"><span class="hljs-comment">/** ,     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Env clojure; <span class="hljs-comment"><span class="hljs-comment">/**  * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> p      * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> b   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> c ,     */</span></span> Func(ConsList p, Object b, Env c) { pars = p; body = b; clojure = c; } <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment">    */</span></span> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> showVal(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FuncCall</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Func f; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HashMap&lt;String, Object&gt; args; FuncCall(Func _f, HashMap&lt;String, Object&gt; _a) { f = _f; args = _a; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"FUNCALL: "</span></span> + args.toString(); } }</code> </pre><br>  To complete the picture under the spoiler, the Env class code implements a hierarchical environment with the methods: <br><br><div class="spoiler">  <b class="spoiler_title">Env class</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** *    -  :   - ,    *  .       . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Env</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/**     -   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HashMap&lt;String, Object&gt; map; <span class="hljs-comment"><span class="hljs-comment">/**     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Env parent; <span class="hljs-comment"><span class="hljs-comment">/**     . * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> m   - * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> p   */</span></span> Env (HashMap&lt;String, Object&gt; m, Env p) { map = m; parent = p; } <span class="hljs-comment"><span class="hljs-comment">/**   .        * . */</span></span> Env () { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;String, Object&gt;(), <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-comment"><span class="hljs-comment">/**          ,  *     . * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> var - * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> value - */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setVar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Object value)</span></span></span><span class="hljs-function"> </span></span>{ Env env = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (env != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (env.map.containsKey(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>)) {env.map.put(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>, value); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;} env = env.parent; } } <span class="hljs-comment"><span class="hljs-comment">/**          ,  *     .    -      * . * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> var - * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> - */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getVar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ Env env = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (env != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (env.map.containsKey(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> env.map.get(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>); env = env.parent; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/**        * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> var - * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> value - */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">defVar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Object value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.map.put(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>, value); } <span class="hljs-comment"><span class="hljs-comment">/**  ,             *  . * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> var - * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> / */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isBounded</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ Env env = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (env != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (env.map.containsKey(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; env = env.parent; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } }</code> </pre><br></div></div><br>  The logic of the work was the following: in the code text, the programmer explicitly marks (in my case with the help of an additional special form) tail function calls.  When calculating such calls, the lazy FuncCall is returned, and right there in the cycle it is calculated, while the return type is all the same FuncCall, and as soon as we get a different type in the calculation, we return it as a result.  In my implementation, new objects are created in the loop each time, but the garbage collector built into Java takes care of them.  But we implemented an iterative imperative loop inside the recursive function of computing, and our stack stopped growing with tail calls.  Everything worked, the only inconvenience was that the text of the code required to explicitly specify tail calls.  Without this, calculations were performed as usual, with a dip in the stack.  I wanted the interpreter to determine the tail calls itself, and calculate them in a loop.  This was implemented through the optional parameter of the eval function - the strict boolean flag of strict / lazy evaluation of functions.  The logic of operation is the following: for any value of the flag, when calculating a function, first a FuncCall object is created with this function and calculated values ‚Äã‚Äãof the arguments.  But with strict calculation, this object is immediately calculated in a loop, but with a lazy calculation, while the type of the result is FuncCall.  With a lazy calculation, the created FuncCall is immediately returned as a result.  Nowhere else does the value of this flag determine the logic of operation, but it was necessary to choose in which nested calls it should be calculated strictly and in which with the flag value transmitted in the input parameter (to preserve the severity / laziness of the external calculation).  But it turned out to be not difficult - when choosing always a strict calculation, in addition to calculating the last element of the list, the result of the conditional expression (the conditions themselves are strictly calculated) and the runtime macros - these 3 cases are calculated with the incoming flag value, in all examples the interpreter correctly determined tail calls, and optimized them, including cross-recursions.  In the code, it looks much more concise than a verbal description: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (op <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Func) { Func f = (Func)op; <span class="hljs-comment"><span class="hljs-comment">//       FuncCall FuncCall fcall = new FuncCall(f, getMapArgsVals(d, io, env, f.pars, ls, true)); if (strict) { v = fcall; while (v instanceof FuncCall) { FuncCall fc = (FuncCall) v; v = eval(d, false, io, new Env(fc.args, fc.f.clojure), fc.f.body); } return v; } else return fcall;</span></span></code> </pre><br>  An example of work in the interpreter (the functions foldl and foldr are defined in the standard library, here their definitions are duplicated for clarity): <br><br><pre> <code class="lisp hljs">def a (<span class="hljs-name"><span class="hljs-name">list-from-to</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span>) =&gt; OK def b (<span class="hljs-name"><span class="hljs-name">list-from-to</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">100000</span></span>) =&gt; OK defn foldl (<span class="hljs-name"><span class="hljs-name">fal</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">null</span></span>? l) a (<span class="hljs-name"><span class="hljs-name">foldl</span></span> f (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> l) a) (<span class="hljs-name"><span class="hljs-name">cdr</span></span> l)) ) =&gt; OK defn foldr (<span class="hljs-name"><span class="hljs-name">fal</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">null</span></span>? l) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> l) (<span class="hljs-name"><span class="hljs-name">foldr</span></span> fa (<span class="hljs-name"><span class="hljs-name">cdr</span></span> l))) ) =&gt; OK foldl + <span class="hljs-number"><span class="hljs-number">0</span></span> a =&gt; <span class="hljs-number"><span class="hljs-number">5050</span></span> foldr + <span class="hljs-number"><span class="hljs-number">0</span></span> a =&gt; <span class="hljs-number"><span class="hljs-number">5050</span></span> foldl + <span class="hljs-number"><span class="hljs-number">0.0</span></span> b =&gt; <span class="hljs-number"><span class="hljs-number">5.00005E9</span></span> foldr + <span class="hljs-number"><span class="hljs-number">0.0</span></span> b =&gt; java.lang.StackOverflowError</code> </pre><br>  Among the special forms of the language is the tray service command, which prints a call stack with an indication of the calculation step and the recursive call nesting level, then you can see "in a section" which calls are received with different options: <br><br><div class="spoiler">  <b class="spoiler_title">Factorial (implementation with battery) - without TCO</b> <div class="spoiler_text"><pre> <code class="lisp hljs">defn f (<span class="hljs-name"><span class="hljs-name">na</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na))) =&gt; OK tray (<span class="hljs-name"><span class="hljs-name">f</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">f</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üê f <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üí (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">na</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na)))) <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na))) <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na)) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê f <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">na</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na)))) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">*</span></span> na) <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê a <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na))) <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">6</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">6</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na)) <span class="hljs-number"><span class="hljs-number">6</span></span> ‚Üê f <span class="hljs-number"><span class="hljs-number">6</span></span> ‚Üí (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">na</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na)))) <span class="hljs-number"><span class="hljs-number">6</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">7</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">7</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">*</span></span> na) <span class="hljs-number"><span class="hljs-number">7</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">7</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> ‚Üê a <span class="hljs-number"><span class="hljs-number">7</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na))) <span class="hljs-number"><span class="hljs-number">7</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">8</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">8</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">7</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na)) <span class="hljs-number"><span class="hljs-number">8</span></span> ‚Üê f <span class="hljs-number"><span class="hljs-number">8</span></span> ‚Üí (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">na</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na)))) <span class="hljs-number"><span class="hljs-number">8</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">9</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">9</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">*</span></span> na) <span class="hljs-number"><span class="hljs-number">9</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">9</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> ‚Üê a <span class="hljs-number"><span class="hljs-number">9</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na))) <span class="hljs-number"><span class="hljs-number">9</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">10</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">10</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">9</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na)) <span class="hljs-number"><span class="hljs-number">10</span></span> ‚Üê f <span class="hljs-number"><span class="hljs-number">10</span></span> ‚Üí (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">na</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na)))) <span class="hljs-number"><span class="hljs-number">10</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">11</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">11</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">*</span></span> na) <span class="hljs-number"><span class="hljs-number">11</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">11</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> ‚Üê a <span class="hljs-number"><span class="hljs-number">11</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">120</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na))) <span class="hljs-number"><span class="hljs-number">11</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">12</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">12</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> ‚Üí true <span class="hljs-number"><span class="hljs-number">11</span></span> ‚Üê a <span class="hljs-number"><span class="hljs-number">11</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">120</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">120</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">120</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">120</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">120</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">120</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">120</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">120</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">120</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">120</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">120</span></span> <span class="hljs-number"><span class="hljs-number">120</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Parity check (cross recursion) - no TCO</b> <div class="spoiler_text"><pre> <code class="lisp hljs">defn is-even (<span class="hljs-name"><span class="hljs-name">n</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) true (<span class="hljs-name"><span class="hljs-name">is-odd</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)) ) =&gt; OK defn is-odd (<span class="hljs-name"><span class="hljs-name">n</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) false (<span class="hljs-name"><span class="hljs-name">is-even</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)) ) =&gt; OK tray (<span class="hljs-name"><span class="hljs-name">is-even</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">is-even</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üê is-even <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üí (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">n</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) true (<span class="hljs-name"><span class="hljs-name">is-odd</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)))) <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) true (<span class="hljs-name"><span class="hljs-name">is-odd</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>))) <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">is-odd</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê is-odd <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">n</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) false (<span class="hljs-name"><span class="hljs-name">is-even</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)))) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) false (<span class="hljs-name"><span class="hljs-name">is-even</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>))) <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">6</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">6</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">is-even</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-number"><span class="hljs-number">6</span></span> ‚Üê is-even <span class="hljs-number"><span class="hljs-number">6</span></span> ‚Üí (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">n</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) true (<span class="hljs-name"><span class="hljs-name">is-odd</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)))) <span class="hljs-number"><span class="hljs-number">6</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">7</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">7</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) true (<span class="hljs-name"><span class="hljs-name">is-odd</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>))) <span class="hljs-number"><span class="hljs-number">7</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">8</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">8</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">7</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">is-odd</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-number"><span class="hljs-number">8</span></span> ‚Üê is-odd <span class="hljs-number"><span class="hljs-number">8</span></span> ‚Üí (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">n</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) false (<span class="hljs-name"><span class="hljs-name">is-even</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)))) <span class="hljs-number"><span class="hljs-number">8</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">9</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">9</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) false (<span class="hljs-name"><span class="hljs-name">is-even</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>))) <span class="hljs-number"><span class="hljs-number">9</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">10</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">10</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">9</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">is-even</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-number"><span class="hljs-number">10</span></span> ‚Üê is-even <span class="hljs-number"><span class="hljs-number">10</span></span> ‚Üí (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">n</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) true (<span class="hljs-name"><span class="hljs-name">is-odd</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)))) <span class="hljs-number"><span class="hljs-number">10</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">11</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">11</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) true (<span class="hljs-name"><span class="hljs-name">is-odd</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>))) <span class="hljs-number"><span class="hljs-number">11</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">12</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">12</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">11</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">is-odd</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-number"><span class="hljs-number">12</span></span> ‚Üê is-odd <span class="hljs-number"><span class="hljs-number">12</span></span> ‚Üí (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">n</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) false (<span class="hljs-name"><span class="hljs-name">is-even</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)))) <span class="hljs-number"><span class="hljs-number">12</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">13</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">13</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) false (<span class="hljs-name"><span class="hljs-name">is-even</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>))) <span class="hljs-number"><span class="hljs-number">13</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">14</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">14</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> ‚Üí true <span class="hljs-number"><span class="hljs-number">12</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">11</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">10</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">9</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">8</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">7</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">6</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">1</span></span> ‚Üí false false</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Factorial (implementation with battery) - with TCO</b> <div class="spoiler_text"><pre> <code class="lisp hljs">defn f (<span class="hljs-name"><span class="hljs-name">na</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na))) =&gt; OK tray (<span class="hljs-name"><span class="hljs-name">f</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">f</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üê f <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üí (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">na</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na)))) <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na))) <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na)) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê f <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">na</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na)))) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">*</span></span> na) <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê a <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí FUNCALL: {a=5, n=4} <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üí FUNCALL: {a=5, n=4} <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na))) <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na)) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê f <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">na</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na)))) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">*</span></span> na) <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê a <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí FUNCALL: {a=20, n=3} <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üí FUNCALL: {a=20, n=3} <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na))) <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na)) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê f <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">na</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na)))) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">*</span></span> na) <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê a <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí FUNCALL: {a=60, n=2} <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üí FUNCALL: {a=60, n=2} <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na))) <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na)) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê f <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">na</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na)))) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">*</span></span> na) <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê a <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">120</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí FUNCALL: {a=120, n=1} <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üí FUNCALL: {a=120, n=1} <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) a (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">*</span></span> na))) <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> n <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí true <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê a <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">120</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">120</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">120</span></span> <span class="hljs-number"><span class="hljs-number">120</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Parity check (cross recursion) - with TCO</b> <div class="spoiler_text"><pre> <code class="lisp hljs">defn is-even (<span class="hljs-name"><span class="hljs-name">n</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) true (<span class="hljs-name"><span class="hljs-name">is-odd</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)) ) =&gt; OK defn is-odd (<span class="hljs-name"><span class="hljs-name">n</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) false (<span class="hljs-name"><span class="hljs-name">is-even</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)) ) =&gt; OK tray (<span class="hljs-name"><span class="hljs-name">is-even</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">is-even</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üê is-even <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üí (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">n</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) true (<span class="hljs-name"><span class="hljs-name">is-odd</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)))) <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) true (<span class="hljs-name"><span class="hljs-name">is-odd</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>))) <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">is-odd</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê is-odd <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">n</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) false (<span class="hljs-name"><span class="hljs-name">is-even</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)))) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí FUNCALL: {n=4} <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üí FUNCALL: {n=4} <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) false (<span class="hljs-name"><span class="hljs-name">is-even</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>))) <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">is-even</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê is-even <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">n</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) true (<span class="hljs-name"><span class="hljs-name">is-odd</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)))) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí FUNCALL: {n=3} <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üí FUNCALL: {n=3} <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) true (<span class="hljs-name"><span class="hljs-name">is-odd</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>))) <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">is-odd</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê is-odd <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">n</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) false (<span class="hljs-name"><span class="hljs-name">is-even</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)))) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí FUNCALL: {n=2} <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üí FUNCALL: {n=2} <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) false (<span class="hljs-name"><span class="hljs-name">is-even</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>))) <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">is-even</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê is-even <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">n</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) true (<span class="hljs-name"><span class="hljs-name">is-odd</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)))) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí FUNCALL: {n=1} <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üí FUNCALL: {n=1} <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) true (<span class="hljs-name"><span class="hljs-name">is-odd</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>))) <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">is-odd</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê is-odd <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">n</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) false (<span class="hljs-name"><span class="hljs-name">is-even</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>)))) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">5</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí FUNCALL: {n=0} <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üí FUNCALL: {n=0} <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">cond</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) false (<span class="hljs-name"><span class="hljs-name">is-even</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> n <span class="hljs-number"><span class="hljs-number">1</span></span>))) <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üê (<span class="hljs-name"><span class="hljs-name">=</span></span> n <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üê n <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Üí <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Üí true <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Üí false <span class="hljs-number"><span class="hljs-number">1</span></span> ‚Üí false false</code> </pre><br></div></div><br>  The source code of the interpreter is still available in <a href="https://github.com/Ivana-/Liscript-GUI-Java-Swing">my repository on Github</a> . </div><p>Source: <a href="https://habr.com/ru/post/282093/">https://habr.com/ru/post/282093/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../282079/index.html">Low FPS while scrolling the page. Problem solving background-attachment: fixed</a></li>
<li><a href="../282081/index.html">Mathematical model of perception (Part 1)</a></li>
<li><a href="../282085/index.html">Long archival data storage, or How to see my great-grandmother's selfie?</a></li>
<li><a href="../282087/index.html">Investigate the "Inspector" Roskomnadzor</a></li>
<li><a href="../282089/index.html">The Basics of Developing 3D Games in Intel XDK at BabylonJS</a></li>
<li><a href="../282099/index.html">Django development for Windows using Docker-machine</a></li>
<li><a href="../282103/index.html">Rake, emulator, animator (upd@21.06)</a></li>
<li><a href="../282105/index.html">Rudolf Svoren - a man of legend (the author of the book "Electronics step by step"). Part 2</a></li>
<li><a href="../282107/index.html">As I looked all ...</a></li>
<li><a href="../282111/index.html">ONLYOFFICE 8.8.0: mail and calendar integration, the right to review and other updates</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>