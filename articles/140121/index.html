<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>.Net Localized "relative time" messages</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, 

 On the current project, the customer received requirements that information about past events should be shown to the client as ‚Äúrelative to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>.Net Localized "relative time" messages</h1><div class="post__text post__text-html js-mediator-article">  Hello, <br><br>  On the current project, the customer received requirements that information about past events should be shown to the client as ‚Äúrelative to time‚Äù (Message like: ‚ÄúThe event occurred N minutes \ minutes \ minutes ago‚Äù).  We received message templates for various options, as well as requirements for appearance, one of which was that messages should be localized. <br><br>  ‚ÄúWhat is difficult here?‚Äù, We thought, and went to Google, in search of a ready-made solution.  Unfortunately, Google portrayed himself as a partisan, offered several options for off-the-shelf solutions for building this type of message for the English language, but none of them supported localization. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      ‚ÄúThere is nothing to do, it is necessary to <s>support the Russian car industry to</s> reinvent your bicycle,‚Äù we decided.  And that's what came out of it ... <br><a name="habracut"></a><br><br>  Localization in our application is implemented through resource files.  It was decided that all necessary information for localization will also be stored in them.  The main problem was the definition of the rules by which it is necessary to take one or another word meaning from the resources.  In our case, these were the words ‚ÄúDay‚Äù, ‚ÄúHour‚Äù, ‚ÄúMinute‚Äù, with the corresponding numeral form. <br><br>  After talking to Google again, we found a wonderful <a href="http://unicode.org/repos/cldr-tmp/trunk/diff/supplemental/language_plural_rules.html">site</a> that describes and standardizes the rules for constructing single and multiple word forms for most languages.  This was the starting point for writing code. <br><br>  On the website above, various types of education of word forms are divided into categories, the most popular of them are: <br>  - one <br>  - few <br>  - many <br>  - other <br>  For each category of each language, examples are given, as well as the rules for belonging to a particular group. <br><br>  For easier understanding, I will give an example for the English language: <br><table><tbody><tr><th>  Language Name </th><th>  Code </th><th>  Category </th><th>  Examples </th><th>  Rules </th></tr><tr><td rowspan="2">  English </td><td rowspan="2">  en <br></td><td>  one </td><td>  one </td><td rowspan="2">  one ‚Üí n is 1; <br><br>  other ‚Üí <br>  <i>everything else</i> <br></td></tr><tr><td>  other </td><td>  0, 2-999; <br><br>  1.2, 2.07 ... <br></td></tr></tbody></table><br><br>  In a nutshell, I will tell you how we decided to do this: <br>  For each of the languages ‚Äã‚Äãthat we support, a class is created, with the method of rendering the category to which the word belongs, according to the number of objects.  Possible categories of words in the form of {NameObject}. {Category} are added to the resource file of this language.  A farbrik class is created, which returns the implementation of the above class, depending on the language for which it is necessary to calculate the form of the word.  A wrapper class is created to localize the form of the word, one of the methods of which takes as part of the parameter the object's resource key ({ObjectName}) and the number of these objects, and returns a string from the corresponding resource file of the required category. <br><br>  Well, from words to deeds!  It's time to program ... <br>  The first step was to create an enum containing the categories that we need to work: <br><pre><code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PluralCategories</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-type"><span class="hljs-type">One</span></span>, <span class="hljs-type"><span class="hljs-type">Few</span></span>, <span class="hljs-type"><span class="hljs-type">Many</span></span>, <span class="hljs-type"><span class="hljs-type">Other</span></span> }</code> </pre> <br>  Further, the interface for future classes of calculating the category: <br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ITimeFormatter</span></span> { <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Returns category for plural form </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="count"&gt;</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;returns&gt;</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><span class="hljs-comment"> PluralCategories GetPluralCategoryByCount(int count); }</span></span></code> </pre><br>  Factory class: <br><pre> <code class="hljs pgsql"> /// &lt;<span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>&gt; /// <span class="hljs-keyword"><span class="hljs-keyword">Default</span></span> fabric <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> TimeFormatters /// &lt;/<span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>&gt; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TimeFormatterFabric { /// &lt;<span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>&gt; /// <span class="hljs-keyword"><span class="hljs-keyword">Returns</span></span> TimeFormatter <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> corresponding culture /// &lt;/<span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>&gt; /// &lt;param <span class="hljs-type"><span class="hljs-type">name</span></span>="cultureInfo"&gt;&lt;/param&gt; /// &lt;<span class="hljs-keyword"><span class="hljs-keyword">returns</span></span>&gt;&lt;/<span class="hljs-keyword"><span class="hljs-keyword">returns</span></span>&gt; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> ITimeFormatter GetTimeFormatter(CultureInfo cultureInfo) { ITimeFormatter result; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cultureInfo.Name.StartsWith("en", StringComparison.InvariantCultureIgnoreCase)) { result = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> EnglishTimeFormatter(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cultureInfo.Name.StartsWith("ru", StringComparison.InvariantCultureIgnoreCase)) { result = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> RussianTimeFormatter(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { result = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> EnglishTimeFormatter(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } }</code> </pre><br><br>  Wrap class: <br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TimeFormatter { private readonly ILocalizationService _localizationService; private readonly ITimeFormatter _timeFormatter; /// &lt;<span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>&gt; /// Defaults constructor. /// &lt;/<span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>&gt; /// &lt;param <span class="hljs-type"><span class="hljs-type">name</span></span>="localizationService"&gt;&lt;/param&gt; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> TimeFormatter(ILocalizationService localizationService) { _localizationService = localizationService; _timeFormatter = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> TimeFormatterFabric().GetTimeFormatter(localizationService.CurrentUiCulture); } /// &lt;<span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>&gt; /// <span class="hljs-keyword"><span class="hljs-keyword">Returns</span></span> localized string <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> count <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> items. /// &lt;/<span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>&gt; /// &lt;param <span class="hljs-type"><span class="hljs-type">name</span></span>="rootResourceKey"&gt;&lt;/param&gt; /// &lt;param <span class="hljs-type"><span class="hljs-type">name</span></span>="count"&gt;&lt;/param&gt; /// &lt;<span class="hljs-keyword"><span class="hljs-keyword">returns</span></span>&gt;&lt;/<span class="hljs-keyword"><span class="hljs-keyword">returns</span></span>&gt; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string Localize(string rootResourceKey, <span class="hljs-type"><span class="hljs-type">int</span></span> count) { var resourceKey = string.Format("{0}.{1}", rootResourceKey, _timeFormatter.GetPluralCategoryByCount(count).ToString()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _localizationService.Localize(resourceKey); } }</code> </pre><br>  The grade category for the English language is: <br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> EnglishTimeFormatter : ITimeFormatter { /// &lt;<span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>&gt; /// <span class="hljs-keyword"><span class="hljs-keyword">Return</span></span> plural category <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> count <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> English <span class="hljs-keyword"><span class="hljs-keyword">language</span></span> rules /// &lt;/<span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>&gt; /// &lt;param <span class="hljs-type"><span class="hljs-type">name</span></span>="count"&gt;&lt;/param&gt; /// &lt;<span class="hljs-keyword"><span class="hljs-keyword">returns</span></span>&gt;&lt;/<span class="hljs-keyword"><span class="hljs-keyword">returns</span></span>&gt; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> PluralCategories GetPluralCategoryByCount(<span class="hljs-type"><span class="hljs-type">int</span></span> count) { PluralCategories result = PluralCategories.Other; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count == <span class="hljs-number"><span class="hljs-number">1</span></span>) { result = PluralCategories.One; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } }</code> </pre><br><br>  For English, the following values ‚Äã‚Äãhave been added to the resource file: <br><br>  DateTime.Days.One day <br>  DateTime.Days.Other days <br><br>  DateTime.Hours.One hour <br>  DateTime.Hours.Other hours <br><br>  DateTime.Minutes.One minute <br>  DateTime.Minutes.Other minutes <br><br>  Well, a small example of use: <br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToTimeLeftString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> DateTime dateTime</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _localizationService = DependencyResolver.Current.GetService&lt;ILocalizationService&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> timeFormatter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TimeFormatter(_localizationService); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentTime = DateTime.UtcNow; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> timeLeft = currentTime - dateTime; result.AppendFormat(<span class="hljs-string"><span class="hljs-string">"{0} {1} {2} {3} {4}"</span></span>, timeLeft.Days, timeFormatter.Localize(<span class="hljs-string"><span class="hljs-string">"DateTime.Days"</span></span>, timeLeft.Days), _localizationService.Localize(<span class="hljs-string"><span class="hljs-string">"Common.Ago"</span></span>), _localizationService.Localize(<span class="hljs-string"><span class="hljs-string">"Common.At"</span></span>), _localizationService.ConverUtcDateTimeToUsersTimeZone(dateTime).ToShortTimeString()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result.ToString(); }</code> </pre><br>  That's all, thank you for your attention, I hope the article will be useful to someone. </div><p>Source: <a href="https://habr.com/ru/post/140121/">https://habr.com/ru/post/140121/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140111/index.html">Video review of the Samsung Galaxy Note</a></li>
<li><a href="../140114/index.html">What is wrong with the DateTime structure?</a></li>
<li><a href="../140115/index.html">Cambridge has developed technology to remove toner from paper</a></li>
<li><a href="../140117/index.html">Why does the phone consume charge faster than the manufacturers say</a></li>
<li><a href="../140120/index.html">Experience disassembling a laptop Acer Aspire 5750G</a></li>
<li><a href="../140122/index.html">FreeBSD print server</a></li>
<li><a href="../140123/index.html">Writing a site on GWT: Part 1</a></li>
<li><a href="../140125/index.html">Skype now with a video call sometimes shows ads instead of the image of the interlocutor</a></li>
<li><a href="../140126/index.html">MTS fell in St. Petersburg and Pushkin</a></li>
<li><a href="../140127/index.html">The issue of phone numbers in the LTE network is being resolved.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>