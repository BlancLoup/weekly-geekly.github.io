<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simulating iridissension: shader CD-ROM</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This tutorial is about iridissention . In this tutorial, we explore the very nature of light in order to understand and recreate the behavior of the m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simulating iridissension: shader CD-ROM</h1><div class="post__text post__text-html js-mediator-article"> This tutorial is about <strong>iridissention</strong> .  In this tutorial, we explore the very nature of light in order to understand and recreate the behavior of the material that creates color reflections.  Tutorial is designed for game developers at Unity, but the techniques described in it can be easily implemented in other languages, including Unreal and WebGL. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e70/136/461/e701364617cb7dc077f6980df3c5e0a5.png"></div><br>  The tutorial will consist of the following parts: <br><br><ul><li>  Part 1. The nature of light </li><li>  Part 2. Improve the rainbow - 1 </li><li>  Part 3. Improve the rainbow - 2 </li><li>  Part 4. Understanding the diffraction grating </li><li>  Part 5. Math of a diffraction grating </li><li>  Part 6. CD-ROM shader: diffraction grating - 1 </li><li>  Part 7. CD-ROM shader: diffraction grating - 2 </li></ul><a name="habracut"></a><br><h4>  Introduction </h4><br>  <strong>Iridiscence</strong> is an optical phenomenon in which objects change colors as the lighting angle or angle of view changes.  It is because of this effect that the bubbles have such a wide palette of colors. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/007/584/886/007584886377707ec26f6eb4c71ae07d.jpg"></div><br>  Iridiscence is also seen in a pool of spilled gasoline, on the surface of a CD-ROM, and even on fresh meat.  Many insects and animals use iridiscension to create flowers without the presence of appropriate pigments. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eae/52d/462/eae52d462577ecf4f418a4dd446b96b3.jpg"></div><br>  This happens because the iridiscence occurs due to the interaction of light and microscopic structures that are located on the surfaces of all these objects.  Both the CD-ROM tracks and the scales of the outer skeleton of an insect (see images below) have the same order of magnitude of the wavelength of light with which they interact.  In fact, iridissension was the first phenomenon that allowed to reveal the true wave nature of light.  We will not be able to explain and reproduce iridissension without first understanding what the light is, how it works and how it is perceived by the human eye. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/169/42c/218/16942c218c65ecd113f4f413660ea6d1.png"></div><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/57f/d82/402/57fd824029c6342b982de8315ccc0330.jpg"></div><br><h4>  Nature of light </h4><br>  Like many subatomic particles, light simultaneously exhibits the properties of particles and waves.  Quite often, light is modeled as the first or second.  For most applications, light can be thought of as being made up of trillions of individual particles called <strong>photons</strong> .  For example, most shaders believe that photons behave like tiny billiard balls and are reflected from objects at the angle at which they collided with it (see diagram below). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c5e/bbf/320/c5ebbf32045fdeafd48e45a9593a25e0.png"></div><br>  But light can also be modeled as a wave.  Physicists are familiar with this concept, but it is not always known to developers.  So let's spend some time trying to figure out what it means for light to exist as a wave. <br><br>  We all know the ocean waves.  Each point on the surface of the ocean has a height.  The higher it is from the average value, the higher the wave.  If you disturb the surface of the water, the waves begin to spread across the ocean until their energy dissipates. <br><br>  Light is a wave, but instead of measuring it as a height on the surface of the water, it is defined as the energy that the <strong>electromagnetic field has</strong> at the desired point.  In accordance with this model, light is a disturbance of an electromagnetic field propagating through space.  We can imagine a light bulb, either creating a wave, or emitting into the surrounding space a multitude of photons. <br><br>  The amount of <strong>energy</strong> transferred by the photon determines the color of the light.  Low energy photons are perceived as red;  high energy photons are perceived as purple.  Waves have a property similar to particle energy: <strong>wavelength</strong> .  For an intuitive understanding, we can say that this is the distance between the two peaks of the wave. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/74d/003/56d/74d00356d1120bcab49b67bdc2f3ad0e.jpg"></div><br>  Light always moves at the same speed (approximately 299,792,458 meters per second), that is, electromagnetic waves propagate at the same speed.  Although their speed is constant, the wavelength can be different.  High energy photons are short wavelengths.  It is the wavelength of light that ultimately determines its color. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/611/ea4/66e/611ea466e6a16e4ad189416b53ba3b47.png"></div><br>  As you can see in the diagram above, a human eye can perceive photons with a wavelength in the range of approximately 700 nanometers to 400 nanometers.  A nanometer is a billionth of a meter. <br><br><div class="spoiler">  <b class="spoiler_title">How small is the nanometer?</b> <div class="spoiler_text">  When you try to deal with the smallest scale in which Nature works, it is difficult to imagine the sizes discussed.  The average person is about 1.6 meters tall.  The thickness of a human hair is about 50 <strong>micrometers</strong> (50 microns).  A micrometer is a millionth part of a meter (1 micron = 0.000001 meters = <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-msubsup" id="MJXp-Span-2"><span class="MJXp-mn" id="MJXp-Span-3" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10 </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-4" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font></span><span class="MJXp-mn" id="MJXp-Span-6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.658ex" height="2.486ex" viewBox="0 -950 2005.4 1070.5" role="img" focusable="false" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30" x="500" y="0"></use><g transform="translate(1001,393)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2212" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-36" x="778" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-1"> 10 ^ {- 6} </script>  meters).  <strong>A nanometer</strong> is one thousandth of a micrometer (1 nm = 0.000000001 meter = <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-7"><span class="MJXp-msubsup" id="MJXp-Span-8"><span class="MJXp-mn" id="MJXp-Span-9" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10 </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-10" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-11"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font></span><span class="MJXp-mn" id="MJXp-Span-12"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9</font></font></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.658ex" height="2.486ex" viewBox="0 -950 2005.4 1070.5" role="img" focusable="false" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30" x="500" y="0"></use><g transform="translate(1001,393)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2212" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-39" x="778" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-2"> 10 ^ {- 9} </script>  meters).  That is, the wavelength of visible light is about one hundredth of the thickness of a human hair. </div></div><br><h5>  What's next? </h5><br>  After this brief introduction in the rest of the tutorial, we will focus on understanding iridissention and its implementation in Unity. <br><br><ul><li>  <strong>Improve the rainbow.</strong>  As stated above, different wavelengths of light are perceived by the human eye as different colors.  In the next two parts we will deal with how to connect these wavelengths with RGB colors.  This step is necessary to recreate iridiscent reflections with a high degree of accuracy.  In these parts, I will also present a new approach that will be both physically accurate and efficient in terms of computation. </li><li>  <strong>Diffraction grating.</strong>  In parts 4 and 5 of this tutorial, we will look at the <strong>diffraction grating</strong> .  This is the technical name for one of the effects that causes materials to exhibit iridiscent reflections.  Despite its "technicality", the derived equation governing this optical phenomenon will be very simple.  If you are not interested in the mathematics of a diffraction grating, then you can skip part 5. </li><li>  <strong>Shader cd rom</strong>  The core of this tutorial is a CD-ROM shader implementation.  In it, the knowledge collected in the previous parts will be used to implement the diffraction grating in Unity.  It is an extension of the Unity 5 Standard Surface Shader;  which makes this effect both physically correct and photorealistic.  With a little effort, you can change it to fit other types of iridiscent reflections based on a diffraction grating. </li></ul><br><h4>  Summarize </h4><br>  From this part we started the tutorial on iridissention.  In the remainder of this article, we explore ways to simulate and implement iridiscent reflections on various materials, from bubbles to CD-ROMs, and from spilled gasoline to insects. <br><br><h2>  Part 2. Let's improve the rainbow - 1. </h2><br>  Our journey into the world of photorealism requires us to understand not only how light works, but also how we perceive colors.  How many colors are there in the rainbow?  Why is pink not included in them?  Here are just some of the questions that we will address in this part. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/19e/bcd/f77/19ebcdf77603071d895745c1d33f1b81.png"></div><br><h4>  Introduction </h4><br>  In this part, we will introduce the most popular techniques used in computer graphics to recreate the colors of the rainbow.  Although this may seem a useless exercise, it actually has a very practical use.  Each color of the rainbow corresponds to a specific wavelength of light.  Such a correspondence will allow us to simulate physically valid reflections. <br><br>  In the next part, ‚ÄúLet's improve the rainbow - 2‚Äù, we will introduce a new approach that is very well optimized for shaders and at the same time creates the best results at the moment (see below). <br><br>  Comparison of WebGL versions of all the techniques discussed in this tutorial can be found in <a href="https://www.shadertoy.com/view/ls2Bz1" rel="noopener">Shadertoy</a> . <br><br><h4>  Color perception </h4><br>  <strong>The retina</strong> is the part of the eye that recognizes light.  There are <strong>cone cells</strong> in it that can transmit signals to the brain when they recognize certain wavelengths of light.  Light is a wave in an electromagnetic field, so cones operate on the same principles that allow us to recognize radio waves.  <em>De facto</em> cones are tiny antennas.  If you studied electronics, you should know that the length of the antenna is related to the wavelength it captures.  That is why in the human eye there are three different types of cones: short, medium and long.  Each type specializes in recognizing a specific wavelength range. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/afb/097/ea6/afb097ea6581ace4f490ac83c404cd64.png"></div><br>  The graph above shows how each type of cones responds to different wavelengths.  When one of these types of cones is activated, the brain interprets its signal as color.  Despite the fact that such is often said, short, medium and long cones do not correspond to certain colors.  More specifically, each type responds differently to different color ranges. <br><br>  It would be wrong to assume that short, medium, and long cones recognize blue, green, and red.  Despite this, many textbooks (and even shaders!) Make such an assumption to create a relatively acceptable approximation of this rather complex phenomenon. <br><br><h4>  Spectral color </h4><br>  If we want to recreate the physical phenomena that make iridiception possible, then we need to rethink how to store and process colors in a computer.  When we create a light source in Unity (or any other game engine), we can set its color as a mixture of three main components: red, green and blue.  Although a combination of red, green, and blue can really create all the visible colors, at the most fundamental level, the light works differently. <br><br>  The light source can be modeled as a constant photon flux.  Photons carrying different amounts of energy are perceived by our eye as different colors.  However, the "white photon" does not exist.  This is the sum of the set of photons, each of which has a different wavelength, which gives the light a white color. <br><br>  To move on, we need to talk about the "building blocks" of light themselves.  When we talk about "wavelengths", then it is worth thinking about specific colors of the rainbow.  In this part we will show the various approaches that implement this relationship.  As a result, we want to get a function that for a given color returns the perceived color: <br><br><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-function">fixed3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">spectralColor</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> wavelength</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br>  In the rest of the post, we will express the wavelengths in nanometers (billionths of a meter).  The human eye can perceive light in the range from 400 nm to 700 nm.  Wavelengths outside this range exist, but are not perceived as colors. <br><br><div class="spoiler">  <b class="spoiler_title">Why is there no optimal solution?</b> <div class="spoiler_text">  <a href="http://www.efg2.com/Lab/ScienceAndEngineering/Spectra.htm">Earl F. Glynn</a> answered this question best of all: <br><blockquote>  ‚ÄúThere is no unique match between wavelength and RGB values.  Color is an amazing combination of physics and human perception. ‚Äù </blockquote><br>  The search for the <em>final correct</em> correspondence of wavelengths and colors is inevitably doomed to failure.  The nature of light is objective, but our perception is not.  Cones that perceive certain wavelengths of the visible spectrum have significant variations in different people.  Even assuming that all cones work in the same way and constantly for all people, their distribution and number in the retina are mostly random.  No two retinas are the same, even in one person. <br><br>  Finally, color perception depends on how the brain perceives these inputs.  As a result, various optical illusions and neuroadaptations arise that make color perception a unique and truly personal experience. </div></div><br><h4>  Spectral map </h4><br>  The figure below shows how the human eye perceives waves from 400 nanometers (blue) to 700 nanometers (red) in length. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/34e/0bf/929/34e0bf9290857494724cfe9aecf62082.png"></div><br>  It is easy to see that the distribution of colors in the visible spectrum is very non-linear.  If we plot the corresponding R, G, and B components of the perceived color on the graph for each wavelength, we end up with something like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f8c/f1c/e5d/f8cf1ce5d9fef042c9640f7880daca73.png"></div><br>  There is no simple function that can fully describe this curve.  The simplest and least costly implementation approach would be to use this texture in a shader as a means of binding wavelengths to colors. <br><br>  The first thing to do is to provide the shader with access to the new texture.  We can do this by adding a texture property to the <code>Properties</code> block of the new shader. <br><br><pre> <code class="hljs erlang-repl">//  Properties { ... _SpectralTex(<span class="hljs-string"><span class="hljs-string">"Spectral Map (RGB)"</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} ... } //   SubShader { ... CGPROGRAM ... sampler2D _SpectralTex; ... ENDCG ... }</code> </pre> <br>  Our <code>spectralColor</code> function simply converts wavelengths in the [400,700] interval to UV coordinates in the [0,1] interval: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">fixed3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">spectral_tex</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> wavelength</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//  : [400, 700] // u: [0, 1] fixed u = (wavelength -400.0) / 300.0; return tex2D(_SpectralTex, fixed2(u, 0.5)); }</span></span></code> </pre> <br>  In our particular case, we do not need to forcibly limit the wavelengths to intervals [400, 700].  If the spectral texture is imported with <strong>Repeat: Clamp</strong> , all values ‚Äã‚Äãoutside this range will automatically be black. <br><br><div class="spoiler">  <b class="spoiler_title">Looping textures</b> <div class="spoiler_text">  Below we will see that in order to reproduce the effects of iridiscence we need to sample a few colors from the rainbow.  In some devices, the shader may not support texture sampling in a loop.  This is the most important reason why using textures may not be the best approach, especially on mobile platforms. </div></div><br><h4>  JET color scheme </h4><br>  Texture sampling may seem like a good idea.  However, it can slow down the shader significantly.  We will see how critical this is in the part about iridissention on CD-ROM, where each pixel will require several texture samples. <br><br>  There are several functions that approximate the color distribution of the light spectrum.  Probably one of the easiest is the JET color scheme.  This default color scheme is used in MATLAB, and it was originally derived by the National Center for Supercomputer Applications for better visualization of fluid jet simulations in astrophysics. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5da/fe3/017/5dafe3017eb6ec0d6a1999cac3b5c143.png"></div><br>  The JET color scheme is a combination of three different curves: blue, green and red.  This is clearly seen when dividing the color: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9f7/384/7c5/9f73847c50f6e77f5d1a5c3664cf6ca8.png"></div><br>  We can easily implement the JET color scheme by writing the equation of the lines that make up the above scheme. <br><br><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/   MATLAB Jet fixed3 spectral_jet(float w) { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ w: [400, 700] /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ x: [0, 1] fixed x = saturate((w - 400.0)/</span></span><span class="hljs-number"><span class="hljs-number">300.0</span></span>); fixed3 c; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">25</span></span>) c = fixed3(<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4.0</span></span> * x, <span class="hljs-number"><span class="hljs-number">1.0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span>) c = fixed3(<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span> + <span class="hljs-number"><span class="hljs-number">4.0</span></span> * (<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">25</span></span> - x)); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">75</span></span>) c = fixed3(<span class="hljs-number"><span class="hljs-number">4.0</span></span> * (x - <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span>), <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> c = fixed3(<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span> + <span class="hljs-number"><span class="hljs-number">4.0</span></span> * (<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">75</span></span> - x), <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     [<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> saturate(c); }</code> </pre> <br>  The R, G, and B values ‚Äã‚Äãof the resulting color are limited to the [0,1] interval using the Cg <code>saturate</code> function.  If HDR ( <a href="https://docs.unity3d.com/Manual/HDR.html" rel="noopener">High Dynamic Range Rendering</a> ) is selected for the camera, this is necessary to avoid having colors with components greater than one. <br><br>  It is worth noting that if you want to strictly adhere to the color scheme JET, then the values ‚Äã‚Äãoutside the visible range will not be black. <br><br><h4>  Bruton Color Scheme </h4><br>  Another approach to the conversion of wavelengths into visible colors is the scheme proposed by Dan Bruton in the article " <a href="http://www.physics.sfasu.edu/astro/color/spectra.html" rel="noopener">Approximate RGB values ‚Äã‚Äãfor Visible Wavelengths</a> ".  Similar to what happens in the JET color scheme, Bruton begins with an approximate distribution of perceived colors. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8ac/7e6/ee7/8ac7e6ee7798d21bf0b65ebe5fec230d.png"></div><br>  However, its approach better approximates the activity of long cones, which leads to a stronger shade of violet in the lower part of the visible spectrum: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/06b/a86/121/06ba86121e1d1fe5dcd779bda8eb4f36.png"></div><br>  This approach translates into the following code: <br><br><pre> <code class="hljs pgsql">//   fixed3 spectral_bruton (<span class="hljs-type"><span class="hljs-type">float</span></span> w) { fixed3 c; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (w &gt;= <span class="hljs-number"><span class="hljs-number">380</span></span> &amp;&amp; w &lt; <span class="hljs-number"><span class="hljs-number">440</span></span>) c = fixed3 ( -(w - <span class="hljs-number"><span class="hljs-number">440.</span></span>) / (<span class="hljs-number"><span class="hljs-number">440.</span></span> - <span class="hljs-number"><span class="hljs-number">380.</span></span>), <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (w &gt;= <span class="hljs-number"><span class="hljs-number">440</span></span> &amp;&amp; w &lt; <span class="hljs-number"><span class="hljs-number">490</span></span>) c = fixed3 ( <span class="hljs-number"><span class="hljs-number">0.0</span></span>, (w - <span class="hljs-number"><span class="hljs-number">440.</span></span>) / (<span class="hljs-number"><span class="hljs-number">490.</span></span> - <span class="hljs-number"><span class="hljs-number">440.</span></span>), <span class="hljs-number"><span class="hljs-number">1.0</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (w &gt;= <span class="hljs-number"><span class="hljs-number">490</span></span> &amp;&amp; w &lt; <span class="hljs-number"><span class="hljs-number">510</span></span>) c = fixed3 ( <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>, -(w - <span class="hljs-number"><span class="hljs-number">510.</span></span>) / (<span class="hljs-number"><span class="hljs-number">510.</span></span> - <span class="hljs-number"><span class="hljs-number">490.</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (w &gt;= <span class="hljs-number"><span class="hljs-number">510</span></span> &amp;&amp; w &lt; <span class="hljs-number"><span class="hljs-number">580</span></span>) c = fixed3 ( (w - <span class="hljs-number"><span class="hljs-number">510.</span></span>) / (<span class="hljs-number"><span class="hljs-number">580.</span></span> - <span class="hljs-number"><span class="hljs-number">510.</span></span>), <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (w &gt;= <span class="hljs-number"><span class="hljs-number">580</span></span> &amp;&amp; w &lt; <span class="hljs-number"><span class="hljs-number">645</span></span>) c = fixed3 ( <span class="hljs-number"><span class="hljs-number">1.0</span></span>, -(w - <span class="hljs-number"><span class="hljs-number">645.</span></span>) / (<span class="hljs-number"><span class="hljs-number">645.</span></span> - <span class="hljs-number"><span class="hljs-number">580.</span></span>), <span class="hljs-number"><span class="hljs-number">0.0</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (w &gt;= <span class="hljs-number"><span class="hljs-number">645</span></span> &amp;&amp; w &lt;= <span class="hljs-number"><span class="hljs-number">780</span></span>) c = fixed3 ( <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> c = fixed3 ( <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> saturate(c); }</code> </pre> <br><h4>  Color scheme bump </h4><br>  JET and Bruton color schemes use discontinuous functions.  Therefore, they create quite sharp color variations.  Moreover, outside the visible range they do not become black.  In the book ‚ÄúGPU Gems‚Äù, this problem is solved by replacing the sharp lines of the previous color schemes with much smoother <em>curves (bumps)</em> .  Each bend is an ordinary parabola of the form. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-13"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-14"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font></span><span class="MJXp-mo" id="MJXp-Span-15" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><span class="MJXp-mn" id="MJXp-Span-16"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span><span class="MJXp-mo" id="MJXp-Span-17" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-18"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-19" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-20" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.641ex" height="2.78ex" viewBox="0 -935.7 4581.4 1197.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-79" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="775" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-31" x="1831" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2212" x="2554" y="0"></use><g transform="translate(3555,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-32" x="809" y="513"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-3"> y = 1-x ^ 2 </script>  .  More specifically <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-21"><span class="noError" id="MJXp-Span-22" style="display: inline-block;">bump&nbsp;\&nbsp;left&nbsp;(x&nbsp;\&nbsp;right)&nbsp;=&nbsp;\&nbsp;left&nbsp;\&nbsp;{\&nbsp;begin&nbsp;{matrix}&nbsp;0&nbsp;&amp;&nbsp;\&nbsp;left&nbsp;|&nbsp;x&nbsp;\&nbsp;right&nbsp;|&gt;&nbsp;1&nbsp;\\&nbsp;1-x&nbsp;^&nbsp;2&nbsp;&amp;&nbsp;\&nbsp;mathit&nbsp;{otherwise}&nbsp;\&nbsp;end&nbsp;{matrix}&nbsp;\&nbsp;right&nbsp;.</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed"><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><span class="noError" style="display: inline-block;">bump&nbsp;\&nbsp;left&nbsp;(x&nbsp;\&nbsp;right)&nbsp;=&nbsp;\&nbsp;left&nbsp;\&nbsp;{\&nbsp;begin&nbsp;{matrix}&nbsp;0&nbsp;&amp;&nbsp;\&nbsp;left&nbsp;|&nbsp;x&nbsp;\&nbsp;right&nbsp;|&gt;&nbsp;1&nbsp;\\&nbsp;1-x&nbsp;^&nbsp;2&nbsp;&amp;&nbsp;\&nbsp;mathit&nbsp;{otherwise}&nbsp;\&nbsp;end&nbsp;{matrix}&nbsp;\&nbsp;right&nbsp;.</span></span></div><script type="math/tex;mode=display" id="MathJax-Element-4"> bump \ left (x \ right) = \ left \ {\ begin {matrix} 0 & \ left | x \ right |> 1 \\ 1-x ^ 2 & \ mathit {otherwise} \ end {matrix} \ right . </script></p><br>  The author of the scheme of Randyma Fernando uses for all components the colors of the parabola, arranged as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d6/8d6/b27/2d68d6b278d6541659c7dc90b1b66ecf.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ab0/57b/66c/ab057b66cb3ccb541762668348bb0e28.png"></div><br>  We can write the following code: <br><br><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/ GPU Gems inline fixed3 bump3 (fixed3 x) { float3 y = 1 - x * x; y = max(y, 0); return y; } fixed3 spectral_gems (float w) { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ w: [400, 700] /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ x: [0, 1] fixed x = saturate((w - 400.0)/</span></span><span class="hljs-number"><span class="hljs-number">300.0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bump3 ( fixed3 ( <span class="hljs-number"><span class="hljs-number">4</span></span> * (x - <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">75</span></span>), <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Red <span class="hljs-number"><span class="hljs-number">4</span></span> * (x - <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span>), <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Green <span class="hljs-number"><span class="hljs-number">4</span></span> * (x - <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">25</span></span>) /<span class="hljs-regexp"><span class="hljs-regexp">/ Blue ) ); }</span></span></code> </pre> <br>  An additional advantage of this color scheme is that it does not use texture samples and branching, which makes it one of the best decisions if you prefer speed rather than quality.  At the end of this tutorial, I will show a revised version of this color scheme, which provides greater speed, while maintaining high clarity of colors. <br><br><h4>  Spektre color scheme </h4><br>  One of the most accurate color schemes is the one created by the user Stack Overflow <a href="https://stackoverflow.com/users/2521214/spektre" rel="noopener">Spektre</a> .  He explains his methodology in the post <a href="https://stackoverflow.com/questions/3407942/rgb-values-of-visible-spectrum" rel="noopener">RGB values ‚Äã‚Äãof visible spectrum</a> , where he samples the blue, green and red components of the real data from the solar spectrum.  Then he fills in individual intervals with simple functions.  The result is shown in the following diagram: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a57/f0a/a48/a57f0aa484970d61fa55aeacbcc02fa3.png"></div><br>  What gives us: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/acc/bbf/868/accbbf8687e89128990c284270e18ff9.png"></div><br>  Here is the code: <br><br><pre> <code class="hljs pgsql">// Spektre fixed3 spectral_spektre (<span class="hljs-type"><span class="hljs-type">float</span></span> l) { <span class="hljs-type"><span class="hljs-type">float</span></span> r=<span class="hljs-number"><span class="hljs-number">0.0</span></span>,g=<span class="hljs-number"><span class="hljs-number">0.0</span></span>,b=<span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((l&gt;=<span class="hljs-number"><span class="hljs-number">400.0</span></span>)&amp;&amp;(l&lt;<span class="hljs-number"><span class="hljs-number">410.0</span></span>)) { <span class="hljs-type"><span class="hljs-type">float</span></span> t=(l<span class="hljs-number"><span class="hljs-number">-400.0</span></span>)/(<span class="hljs-number"><span class="hljs-number">410.0</span></span><span class="hljs-number"><span class="hljs-number">-400.0</span></span>); r= +(<span class="hljs-number"><span class="hljs-number">0.33</span></span>*t)-(<span class="hljs-number"><span class="hljs-number">0.20</span></span>*t*t); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((l&gt;=<span class="hljs-number"><span class="hljs-number">410.0</span></span>)&amp;&amp;(l&lt;<span class="hljs-number"><span class="hljs-number">475.0</span></span>)) { <span class="hljs-type"><span class="hljs-type">float</span></span> t=(l<span class="hljs-number"><span class="hljs-number">-410.0</span></span>)/(<span class="hljs-number"><span class="hljs-number">475.0</span></span><span class="hljs-number"><span class="hljs-number">-410.0</span></span>); r=<span class="hljs-number"><span class="hljs-number">0.14</span></span> -(<span class="hljs-number"><span class="hljs-number">0.13</span></span>*t*t); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((l&gt;=<span class="hljs-number"><span class="hljs-number">545.0</span></span>)&amp;&amp;(l&lt;<span class="hljs-number"><span class="hljs-number">595.0</span></span>)) { <span class="hljs-type"><span class="hljs-type">float</span></span> t=(l<span class="hljs-number"><span class="hljs-number">-545.0</span></span>)/(<span class="hljs-number"><span class="hljs-number">595.0</span></span><span class="hljs-number"><span class="hljs-number">-545.0</span></span>); r= +(<span class="hljs-number"><span class="hljs-number">1.98</span></span>*t)-( t*t); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((l&gt;=<span class="hljs-number"><span class="hljs-number">595.0</span></span>)&amp;&amp;(l&lt;<span class="hljs-number"><span class="hljs-number">650.0</span></span>)) { <span class="hljs-type"><span class="hljs-type">float</span></span> t=(l<span class="hljs-number"><span class="hljs-number">-595.0</span></span>)/(<span class="hljs-number"><span class="hljs-number">650.0</span></span><span class="hljs-number"><span class="hljs-number">-595.0</span></span>); r=<span class="hljs-number"><span class="hljs-number">0.98</span></span>+(<span class="hljs-number"><span class="hljs-number">0.06</span></span>*t)-(<span class="hljs-number"><span class="hljs-number">0.40</span></span>*t*t); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((l&gt;=<span class="hljs-number"><span class="hljs-number">650.0</span></span>)&amp;&amp;(l&lt;<span class="hljs-number"><span class="hljs-number">700.0</span></span>)) { <span class="hljs-type"><span class="hljs-type">float</span></span> t=(l<span class="hljs-number"><span class="hljs-number">-650.0</span></span>)/(<span class="hljs-number"><span class="hljs-number">700.0</span></span><span class="hljs-number"><span class="hljs-number">-650.0</span></span>); r=<span class="hljs-number"><span class="hljs-number">0.65</span></span>-(<span class="hljs-number"><span class="hljs-number">0.84</span></span>*t)+(<span class="hljs-number"><span class="hljs-number">0.20</span></span>*t*t); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((l&gt;=<span class="hljs-number"><span class="hljs-number">415.0</span></span>)&amp;&amp;(l&lt;<span class="hljs-number"><span class="hljs-number">475.0</span></span>)) { <span class="hljs-type"><span class="hljs-type">float</span></span> t=(l<span class="hljs-number"><span class="hljs-number">-415.0</span></span>)/(<span class="hljs-number"><span class="hljs-number">475.0</span></span><span class="hljs-number"><span class="hljs-number">-415.0</span></span>); g= +(<span class="hljs-number"><span class="hljs-number">0.80</span></span>*t*t); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((l&gt;=<span class="hljs-number"><span class="hljs-number">475.0</span></span>)&amp;&amp;(l&lt;<span class="hljs-number"><span class="hljs-number">590.0</span></span>)) { <span class="hljs-type"><span class="hljs-type">float</span></span> t=(l<span class="hljs-number"><span class="hljs-number">-475.0</span></span>)/(<span class="hljs-number"><span class="hljs-number">590.0</span></span><span class="hljs-number"><span class="hljs-number">-475.0</span></span>); g=<span class="hljs-number"><span class="hljs-number">0.8</span></span> +(<span class="hljs-number"><span class="hljs-number">0.76</span></span>*t)-(<span class="hljs-number"><span class="hljs-number">0.80</span></span>*t*t); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((l&gt;=<span class="hljs-number"><span class="hljs-number">585.0</span></span>)&amp;&amp;(l&lt;<span class="hljs-number"><span class="hljs-number">639.0</span></span>)) { <span class="hljs-type"><span class="hljs-type">float</span></span> t=(l<span class="hljs-number"><span class="hljs-number">-585.0</span></span>)/(<span class="hljs-number"><span class="hljs-number">639.0</span></span><span class="hljs-number"><span class="hljs-number">-585.0</span></span>); g=<span class="hljs-number"><span class="hljs-number">0.82</span></span>-(<span class="hljs-number"><span class="hljs-number">0.80</span></span>*t) ; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((l&gt;=<span class="hljs-number"><span class="hljs-number">400.0</span></span>)&amp;&amp;(l&lt;<span class="hljs-number"><span class="hljs-number">475.0</span></span>)) { <span class="hljs-type"><span class="hljs-type">float</span></span> t=(l<span class="hljs-number"><span class="hljs-number">-400.0</span></span>)/(<span class="hljs-number"><span class="hljs-number">475.0</span></span><span class="hljs-number"><span class="hljs-number">-400.0</span></span>); b= +(<span class="hljs-number"><span class="hljs-number">2.20</span></span>*t)-(<span class="hljs-number"><span class="hljs-number">1.50</span></span>*t*t); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((l&gt;=<span class="hljs-number"><span class="hljs-number">475.0</span></span>)&amp;&amp;(l&lt;<span class="hljs-number"><span class="hljs-number">560.0</span></span>)) { <span class="hljs-type"><span class="hljs-type">float</span></span> t=(l<span class="hljs-number"><span class="hljs-number">-475.0</span></span>)/(<span class="hljs-number"><span class="hljs-number">560.0</span></span><span class="hljs-number"><span class="hljs-number">-475.0</span></span>); b=<span class="hljs-number"><span class="hljs-number">0.7</span></span> -( t)+(<span class="hljs-number"><span class="hljs-number">0.30</span></span>*t*t); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fixed3(r,g,b); }</code> </pre> <br><h4>  Conclusion </h4><br>  In this part, we looked at some of the most common techniques for generating rainbow-like patterns in a shader.  In the next part, I will introduce you to a new approach to solving this problem. <br><br><table><tbody><tr><td>  <strong>Title</strong> </td><td>  <strong>Gradient</strong> </td></tr><tr><td>  JET </td><td><img src="https://habrastorage.org/getpro/habr/post_images/5da/fe3/017/5dafe3017eb6ec0d6a1999cac3b5c143.png"></td></tr><tr><td>  Bruton </td><td><img src="https://habrastorage.org/getpro/habr/post_images/06b/a86/121/06ba86121e1d1fe5dcd779bda8eb4f36.png"></td></tr><tr><td>  GPU Gems </td><td><img src="https://habrastorage.org/getpro/habr/post_images/2d6/8d6/b27/2d68d6b278d6541659c7dc90b1b66ecf.png"></td></tr><tr><td>  Spektre </td><td><img src="https://habrastorage.org/getpro/habr/post_images/acc/bbf/868/accbbf8687e89128990c284270e18ff9.png"></td></tr><tr><td>  Zucconi </td><td><img src="https://habrastorage.org/getpro/habr/post_images/97a/a8e/d04/97aa8ed04d6f928c15ad1cdf1b3af925.png"></td></tr><tr><td>  Zucconi6 </td><td><img src="https://habrastorage.org/getpro/habr/post_images/19e/bcd/f77/19ebcdf77603071d895745c1d33f1b81.png"></td></tr><tr><td>  Visible spectrum </td><td><img src="https://habrastorage.org/getpro/habr/post_images/34e/0bf/929/34e0bf9290857494724cfe9aecf62082.png"></td></tr></tbody></table><br><h2>  Part 3. Improve the rainbow - 2. </h2><br><h4>  Introduction </h4><br>  In the previous section, we analyzed four different ways of converting the wavelengths of the visible range of the electromagnetic spectrum (400-700 nanometers) into their corresponding colors. <br><br>  In three of these solutions (JET, Bruton and Spektre), <em>if</em> constructions are actively used.  For C #, this is standard practice, but in a shader, branching is a bad approach.  The only approach that does not use branching is considered in the book GPU Gems.  However, it does not provide an optimal approximation of the colors of the visible spectrum. <br><br><table><tbody><tr><td>  <strong>Title</strong> </td><td>  <strong>Gradient</strong> </td></tr><tr><td>  GPU Gems </td><td><img src="https://habrastorage.org/getpro/habr/post_images/2d6/8d6/b27/2d68d6b278d6541659c7dc90b1b66ecf.png"></td></tr><tr><td>  Visible spectrum </td><td><img src="https://habrastorage.org/getpro/habr/post_images/34e/0bf/929/34e0bf9290857494724cfe9aecf62082.png"></td></tr></tbody></table><br>  In this part, I will discuss the optimized version of the color scheme described in the book GPU Gems. <br><br><h4>  Color scheme "Bump" </h4><br>  The original color scheme outlined in the book GPU Gems uses three parabolas (called the author <em>bumps</em> ) to recreate the distribution of the R, G, and B components of the rainbow colors. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ab0/57b/66c/ab057b66cb3ccb541762668348bb0e28.png"></div><br>  Each bump is described by the following equation: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-23"><span class="noError" id="MJXp-Span-24" style="display: inline-block;">bump&nbsp;\&nbsp;left&nbsp;(x&nbsp;\&nbsp;right)&nbsp;=&nbsp;\&nbsp;left&nbsp;\&nbsp;{\&nbsp;begin&nbsp;{matrix}&nbsp;0&nbsp;&amp;&nbsp;\&nbsp;left&nbsp;|&nbsp;x&nbsp;\&nbsp;right&nbsp;|&gt;&nbsp;1&nbsp;\\&nbsp;1-x&nbsp;^&nbsp;2&nbsp;&amp;&nbsp;\&nbsp;mathit&nbsp;{otherwise}&nbsp;\&nbsp;end&nbsp;{matrix}&nbsp;\&nbsp;right&nbsp;.</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed"><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><span class="noError" style="display: inline-block;">bump&nbsp;\&nbsp;left&nbsp;(x&nbsp;\&nbsp;right)&nbsp;=&nbsp;\&nbsp;left&nbsp;\&nbsp;{\&nbsp;begin&nbsp;{matrix}&nbsp;0&nbsp;&amp;&nbsp;\&nbsp;left&nbsp;|&nbsp;x&nbsp;\&nbsp;right&nbsp;|&gt;&nbsp;1&nbsp;\\&nbsp;1-x&nbsp;^&nbsp;2&nbsp;&amp;&nbsp;\&nbsp;mathit&nbsp;{otherwise}&nbsp;\&nbsp;end&nbsp;{matrix}&nbsp;\&nbsp;right&nbsp;.</span></span></div><script type="math/tex;mode=display" id="MathJax-Element-5"> bump \ left (x \ right) = \ left \ {\ begin {matrix} 0 & \ left | x \ right |> 1 \\ 1-x ^ 2 & \ mathit {otherwise} \ end {matrix} \ right . </script></p><br>  Each wavelength <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-25"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-26">w</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.664ex" height="1.455ex" viewBox="0 -520.7 716.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-77" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-6"> w </script>  in the range [400, 700] is matched with the normalized value <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-27"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-28">x</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.455ex" viewBox="0 -520.7 572.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-78" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-7"> x </script>  in the interval [0,1].  Then the components R, G and B of the visible spectrum are set as follows: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-29"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-30">R</span><span class="MJXp-mtext" id="MJXp-Span-31">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-32">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-33">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-34">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-35">t</span><span class="MJXp-mo" id="MJXp-Span-36" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-37">x</span><span class="MJXp-mtext" id="MJXp-Span-38">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-40">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-41">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-42">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-43">t</span><span class="MJXp-mo" id="MJXp-Span-44" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-45" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-46">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-47">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-49">p</span><span class="MJXp-mtext" id="MJXp-Span-50">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-51">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-53">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-54">t</span><span class="MJXp-mo" id="MJXp-Span-55" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-56">4</span><span class="MJXp-mtext" id="MJXp-Span-57">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-58">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-59">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-61">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-62">x</span><span class="MJXp-mo" id="MJXp-Span-63" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mn" id="MJXp-Span-64">0.75</span><span class="MJXp-mtext" id="MJXp-Span-65">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-66">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-67">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-68">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-69">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-70">t</span><span class="MJXp-mo" id="MJXp-Span-71" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="49.989ex" height="2.66ex" viewBox="0 -832 21523 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-52" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6C" x="1009" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-65" x="1308" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-66" x="1774" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-74" x="2325" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-28" x="2686" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-78" x="3076" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-72" x="3898" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-69" x="4350" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-67" x="4695" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-68" x="5176" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-74" x="5752" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-29" x="6114" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="6781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-62" x="7837" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-75" x="8267" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6D" x="8839" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-70" x="9718" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6C" x="10471" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-65" x="10770" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-66" x="11236" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-74" x="11787" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-28" x="12148" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-34" x="12538" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-63" x="13288" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-64" x="13722" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6F" x="14245" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-74" x="14731" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-78" x="15092" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2212" x="15887" y="0"></use><g transform="translate(16888,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-37" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-35" x="1279" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-72" x="18918" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-69" x="19369" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-67" x="19715" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-68" x="20195" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-74" x="20772" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-29" x="21133" y="0"></use></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-8"> R \ left (x \ right) = bump \ left (4 \ cdot x - 0.75 \ right) </script></p><br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-72"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-73">G</span><span class="MJXp-mtext" id="MJXp-Span-74">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-75">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-76">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-77">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-78">t</span><span class="MJXp-mo" id="MJXp-Span-79" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-80">x</span><span class="MJXp-mtext" id="MJXp-Span-81">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-82">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-83">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-84">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-85">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-86">t</span><span class="MJXp-mo" id="MJXp-Span-87" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-88" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-89">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-90">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-91">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-92">p</span><span class="MJXp-mtext" id="MJXp-Span-93">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-94">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-95">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-96">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-97">t</span><span class="MJXp-mo" id="MJXp-Span-98" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-99">4</span><span class="MJXp-mtext" id="MJXp-Span-100">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-101">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-102">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-103">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-104">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-105">x</span><span class="MJXp-mo" id="MJXp-Span-106" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mn" id="MJXp-Span-107">0.5</span><span class="MJXp-mtext" id="MJXp-Span-108">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-109">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-110">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-111">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-112">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-113">t</span><span class="MJXp-mo" id="MJXp-Span-114" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="48.889ex" height="2.66ex" viewBox="0 -832 21049.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-47" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6C" x="1036" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-65" x="1335" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-66" x="1801" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-74" x="2352" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-28" x="2713" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-78" x="3103" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-72" x="3925" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-69" x="4377" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-67" x="4722" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-68" x="5203" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-74" x="5779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-29" x="6141" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="6808" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-62" x="7864" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-75" x="8294" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6D" x="8866" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-70" x="9745" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6C" x="10498" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-65" x="10797" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-66" x="11263" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-74" x="11814" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-28" x="12175" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-34" x="12565" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-63" x="13315" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-64" x="13749" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6F" x="14272" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-74" x="14758" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-78" x="15119" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2212" x="15914" y="0"></use><g transform="translate(16915,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-35" x="779" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-72" x="18444" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-69" x="18896" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-67" x="19241" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-68" x="19722" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-74" x="20298" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-29" x="20660" y="0"></use></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-9"> G \ left (x \ right) = bump \ left (4 \ cdot x - 0.5 \ right) </script></p><br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-115"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-116">B</span><span class="MJXp-mtext" id="MJXp-Span-117">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-118">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-119">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-120">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-121">t</span><span class="MJXp-mo" id="MJXp-Span-122" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-123">x</span><span class="MJXp-mtext" id="MJXp-Span-124">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-125">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-126">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-128">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-129">t</span><span class="MJXp-mo" id="MJXp-Span-130" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-131" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-132">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-133">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-134">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-135">p</span><span class="MJXp-mtext" id="MJXp-Span-136">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-137">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-138">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-139">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-140">t</span><span class="MJXp-mo" id="MJXp-Span-141" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-142">4</span><span class="MJXp-mtext" id="MJXp-Span-143">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-144">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-145">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-146">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-147">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-148">x</span><span class="MJXp-mo" id="MJXp-Span-149" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mn" id="MJXp-Span-150">0.25</span><span class="MJXp-mtext" id="MJXp-Span-151">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-152">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-153">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-154">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-155">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-156">t</span><span class="MJXp-mo" id="MJXp-Span-157" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="49.989ex" height="2.66ex" viewBox="0 -832 21523 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-42" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6C" x="1009" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-65" x="1308" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-66" x="1774" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-74" x="2325" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-28" x="2686" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-78" x="3076" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-72" x="3898" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-69" x="4350" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-67" x="4695" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-68" x="5176" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-74" x="5752" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-29" x="6114" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="6781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-62" x="7837" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-75" x="8267" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6D" x="8839" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-70" x="9718" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6C" x="10471" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-65" x="10770" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-66" x="11236" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-74" x="11787" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-28" x="12148" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-34" x="12538" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-63" x="13288" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-64" x="13722" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6F" x="14245" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-74" x="14731" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-78" x="15092" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2212" x="15887" y="0"></use><g transform="translate(16888,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-32" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-35" x="1279" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-72" x="18918" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-69" x="19369" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-67" x="19715" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-68" x="20195" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-74" x="20772" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-29" x="21133" y="0"></use></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-10"> B \ left (x \ right) = bump \ left (4 \ cdot x - 0.25 \ right) </script></p><br>  All numerical values ‚Äã‚Äãare selected by the author experimentally.  However, you can see how badly they match the true color distribution. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f8c/f1c/e5d/f8cf1ce5d9fef042c9640f7880daca73.png"></div><br><h4>  Quality optimization </h4><br>  In the first solution, which I arrived at, exactly the same equations were used as in the GPU Gems color scheme.  However, I optimized all the numerical values, so that the end color range corresponds as far as possible to the true colors from the visible spectrum. <br><br>  The result is the following solution: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/120/352/db3/120352db3c1841f1f078b44d6129c345.png"></div><br>  And leads to a much more realistic result: <br><br><table><tbody><tr><td>  <strong>Title</strong> </td><td>  <strong>Gradient</strong> </td></tr><tr><td>  GPU Gems </td><td><img src="https://habrastorage.org/getpro/habr/post_images/2d6/8d6/b27/2d68d6b278d6541659c7dc90b1b66ecf.png"></td></tr><tr><td>  Zucconi </td><td><img src="https://habrastorage.org/getpro/habr/post_images/97a/a8e/d04/97aa8ed04d6f928c15ad1cdf1b3af925.png"></td></tr><tr><td>  Visible spectrum </td><td><img src="https://habrastorage.org/getpro/habr/post_images/34e/0bf/929/34e0bf9290857494724cfe9aecf62082.png"></td></tr></tbody></table><br>  Like the original solution, the new approach does not contain branching.  Therefore, it is ideal for shaders.  The code is as follows: <br><br><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/     GPU Gems /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    inline fixed3 bump3y (fixed3 x, fixed3 yoffset) { float3 y = 1 - x * x; y = saturate(y-yoffset); return y; } fixed3 spectral_zucconi (float w) { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ w: [400, 700] /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ x: [0, 1] fixed x = saturate((w - 400.0)/</span></span> <span class="hljs-number"><span class="hljs-number">300.0</span></span>); const float3 cs = float3(<span class="hljs-number"><span class="hljs-number">3.54541723</span></span>, <span class="hljs-number"><span class="hljs-number">2.86670055</span></span>, <span class="hljs-number"><span class="hljs-number">2.29421995</span></span>); const float3 xs = float3(<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">69548916</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">49416934</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">28269708</span></span>); const float3 ys = float3(<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">02320775</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">15936245</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">53520021</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bump3y ( cs * (x - xs), ys); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Tell us more about your decision!</b> <div class="spoiler_text">  To find the optimization algorithm, I used the Python <a href="http://scikit-learn.org/stable/" rel="noopener">scikit</a> library. <br><br>  Here are the parameters needed to recreate my results: <br><br><ul><li>  Algorithm: L-BFGS-B </li><li>  Tolerance: <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-158"><span class="MJXp-mn" id="MJXp-Span-159"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span><font style="vertical-align: inherit;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-161"><font style="vertical-align: inherit;">c </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-162"><font style="vertical-align: inherit;">d </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-163"><font style="vertical-align: inherit;">o </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-164"><font style="vertical-align: inherit;">t </font></span><span class="MJXp-msubsup" id="MJXp-Span-165"><span class="MJXp-mn" id="MJXp-Span-166" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">10 </font></span></span><span class="MJXp-msubsup" id="MJXp-Span-165"><span class="MJXp-mrow MJXp-script" id="MJXp-Span-167" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-168"><font style="vertical-align: inherit;">- </font></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-165"><span class="MJXp-mrow MJXp-script" id="MJXp-Span-167" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-169"><font style="vertical-align: inherit;">8</font></span></span></span></font><span class="MJXp-mtext" id="MJXp-Span-160">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-161"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-162"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-163"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-164"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-165"><span class="MJXp-mn" id="MJXp-Span-166" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-167" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-168"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mn" id="MJXp-Span-169"><font style="vertical-align: inherit;"></font></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.591ex" height="2.486ex" viewBox="0 -950 4559.9 1070.5" role="img" focusable="false" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-31" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-63" x="750" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-64" x="1184" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6F" x="1707" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-74" x="2193" y="0"></use><g transform="translate(2554,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30" x="500" y="0"></use><g transform="translate(1001,393)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2212" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-38" x="778" y="0"></use></g></g></g></svg></span><script type="math/tex" id="MathJax-Element-11"> 1 \ cdot 10 ^ {- 8} </script></li><li>  Iterations: <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-170"><span class="MJXp-mn" id="MJXp-Span-171"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span><font style="vertical-align: inherit;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-173"><font style="vertical-align: inherit;">c </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-174"><font style="vertical-align: inherit;">d </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-175"><font style="vertical-align: inherit;">o </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-176"><font style="vertical-align: inherit;">t </font></span><span class="MJXp-msubsup" id="MJXp-Span-177"><span class="MJXp-mn" id="MJXp-Span-178" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">10 </font></span></span><span class="MJXp-msubsup" id="MJXp-Span-177"><span class="MJXp-mrow MJXp-script" id="MJXp-Span-179" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-180"><font style="vertical-align: inherit;">8</font></span></span></span></font><span class="MJXp-mtext" id="MJXp-Span-172">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-173"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-174"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-175"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-176"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-177"><span class="MJXp-mn" id="MJXp-Span-178" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-179" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-180"><font style="vertical-align: inherit;"></font></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.312ex" height="2.486ex" viewBox="0 -950 4009.4 1070.5" role="img" focusable="false" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-31" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-63" x="750" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-64" x="1184" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6F" x="1707" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-74" x="2193" y="0"></use><g transform="translate(2554,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30" x="500" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-38" x="1415" y="557"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-12"> 1 \ cdot 10 ^ {8} </script></li><li>  Weighted MSE: <br><ul><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-181"><span class="MJXp-msubsup" id="MJXp-Span-182"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-183" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-184" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-185" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font></span><span class="MJXp-mn" id="MJXp-Span-186"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.3</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.744ex" height="2.349ex" viewBox="0 -772.3 4195.1 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-57" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-52" x="1335" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="1859" y="0"></use><g transform="translate(2915,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-33" x="779" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-13"> W_R = 0.3 </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-187"><span class="MJXp-msubsup" id="MJXp-Span-188"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-189" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-190" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">G</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-191" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font></span><span class="MJXp-mn" id="MJXp-Span-192"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.59</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.95ex" height="2.349ex" viewBox="0 -772.3 4714.7 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-57" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-47" x="1335" y="-219"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="1878" y="0"></use><g transform="translate(2934,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-35" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-39" x="1279" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-14"> W_G = 0.59 </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-193"><span class="MJXp-msubsup" id="MJXp-Span-194"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-195" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-196" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-197" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font></span><span class="MJXp-mn" id="MJXp-Span-198"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.11</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.906ex" height="2.349ex" viewBox="0 -772.3 4695.6 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-57" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-42" x="1335" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="1859" y="0"></use><g transform="translate(2915,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-31" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-31" x="1279" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-15"> W_B = 0.11 </script></li></ul></li><li>  Fitting <br><ul><li>  Image: <a href="" rel="noopener">Linear Visible Spectrum</a> </li><li>  Wavelength range: from <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-199"><span class="MJXp-mn" id="MJXp-Span-200"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">400</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.487ex" height="2.074ex" viewBox="0 -772.3 1501.5 892.8" role="img" focusable="false" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-34"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30" x="1001" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-16"> 400 </script>  to <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-201"><span class="MJXp-mn" id="MJXp-Span-202"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">700</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.487ex" height="2.074ex" viewBox="0 -772.3 1501.5 892.8" role="img" focusable="false" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-37"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30" x="1001" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-17"> 700 </script></li><li>  Range resized to: <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-203"><span class="MJXp-mn" id="MJXp-Span-204"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1024</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.65ex" height="2.074ex" viewBox="0 -772.3 2002 892.8" role="img" focusable="false" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-32" x="1001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-34" x="1501" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-18"> 1024 </script>  pixels </li></ul></li><li>  Initial solution: <br><ul><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-205"><span class="MJXp-msubsup" id="MJXp-Span-206"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-207" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-208" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-209" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font></span><span class="MJXp-mn" id="MJXp-Span-210"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.402ex" height="2.349ex" viewBox="0 -772.3 3187.1 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-52" x="1011" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="1630" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-34" x="2686" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-19"> C_R = 4 </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-211"><span class="MJXp-msubsup" id="MJXp-Span-212"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-213" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-214" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">G</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-215" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font></span><span class="MJXp-mn" id="MJXp-Span-216"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.447ex" height="2.349ex" viewBox="0 -772.3 3206.2 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-47" x="1011" y="-219"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="1649" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-34" x="2705" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-20"> C_G = 4 </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-217"><span class="MJXp-msubsup" id="MJXp-Span-218"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-219" style="margin-right: 0.05em;">C</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-220" style="vertical-align: -0.4em;">B</span></span><span class="MJXp-mo" id="MJXp-Span-221" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-222">4</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.402ex" height="2.349ex" viewBox="0 -772.3 3187.1 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-42" x="1011" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="1630" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-34" x="2686" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-21"> C_B = 4 </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-223"><span class="MJXp-msubsup" id="MJXp-Span-224"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-225" style="margin-right: 0.05em;">X</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-226" style="vertical-align: -0.4em;">R</span></span><span class="MJXp-mo" id="MJXp-Span-227" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-228">0.75</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.637ex" height="2.349ex" viewBox="0 -772.3 4579.6 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-58" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-52" x="1171" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="1743" y="0"></use><g transform="translate(2799,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-37" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-35" x="1279" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-22"> X_R = 0.75 </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-229"><span class="MJXp-msubsup" id="MJXp-Span-230"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-231" style="margin-right: 0.05em;">X</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-232" style="vertical-align: -0.4em;">G</span></span><span class="MJXp-mo" id="MJXp-Span-233" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-234">0.5</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-23-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.518ex" height="2.349ex" viewBox="0 -772.3 4098.2 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-58" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-47" x="1171" y="-219"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="1762" y="0"></use><g transform="translate(2818,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-35" x="779" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-23"> X_G = 0.5 </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-235"><span class="MJXp-msubsup" id="MJXp-Span-236"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-237" style="margin-right: 0.05em;">X</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-238" style="vertical-align: -0.4em;">B</span></span><span class="MJXp-mo" id="MJXp-Span-239" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-240">0.25</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-24-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.637ex" height="2.349ex" viewBox="0 -772.3 4579.6 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-58" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-42" x="1171" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="1743" y="0"></use><g transform="translate(2799,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-32" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-35" x="1279" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-24"> X_B = 0.25 </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-241"><span class="MJXp-msubsup" id="MJXp-Span-242"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-243" style="margin-right: 0.05em;">Y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-244" style="vertical-align: -0.4em;">R</span></span><span class="MJXp-mo" id="MJXp-Span-245" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-246">0</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-25-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.091ex" height="2.349ex" viewBox="0 -772.3 3053.1 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-59" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-52" x="822" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="1496" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30" x="2552" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-25"> Y_R = 0 </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-247"><span class="MJXp-msubsup" id="MJXp-Span-248"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-249" style="margin-right: 0.05em;">Y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-250" style="vertical-align: -0.4em;">G</span></span><span class="MJXp-mo" id="MJXp-Span-251" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-252">0</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-26-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.135ex" height="2.349ex" viewBox="0 -772.3 3072.2 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-59" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-47" x="822" y="-219"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="1515" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30" x="2571" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-26"> Y_G = 0 </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-253"><span class="MJXp-msubsup" id="MJXp-Span-254"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-255" style="margin-right: 0.05em;">Y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-256" style="vertical-align: -0.4em;">B</span></span><span class="MJXp-mo" id="MJXp-Span-257" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-258">0</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-27-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.091ex" height="2.349ex" viewBox="0 -772.3 3053.1 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-59" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-42" x="822" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="1496" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30" x="2552" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-27"> Y_B = 0 </script></li></ul></li><li>  The final solution: <br><ul><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-259"><span class="MJXp-msubsup" id="MJXp-Span-260"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-261" style="margin-right: 0.05em;">C</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-262" style="vertical-align: -0.4em;">R</span></span><span class="MJXp-mo" id="MJXp-Span-263" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-264">3.54541723</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-28-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.349ex" height="2.349ex" viewBox="0 -772.3 7469.6 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-52" x="1011" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="1630" y="0"></use><g transform="translate(2686,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-33"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-35" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-34" x="1279" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-35" x="1780" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-34" x="2280" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-31" x="2781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-37" x="3281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-32" x="3782" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-33" x="4282" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-28"> C_R = 3.54541723 </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-265"><span class="MJXp-msubsup" id="MJXp-Span-266"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-267" style="margin-right: 0.05em;">C</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-268" style="vertical-align: -0.4em;">G</span></span><span class="MJXp-mo" id="MJXp-Span-269" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-270">2.86670055</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-29-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.393ex" height="2.349ex" viewBox="0 -772.3 7488.7 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-47" x="1011" y="-219"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="1649" y="0"></use><g transform="translate(2705,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-38" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-36" x="1279" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-36" x="1780" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-37" x="2280" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30" x="2781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30" x="3281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-35" x="3782" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-35" x="4282" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-29"> C_G = 2.86670055 </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-271"><span class="MJXp-msubsup" id="MJXp-Span-272"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-273" style="margin-right: 0.05em;">C</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-274" style="vertical-align: -0.4em;">B</span></span><span class="MJXp-mo" id="MJXp-Span-275" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-276">2.29421995</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-30-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.349ex" height="2.349ex" viewBox="0 -772.3 7469.6 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-42" x="1011" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="1630" y="0"></use><g transform="translate(2686,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-32" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-39" x="1279" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-34" x="1780" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-32" x="2280" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-31" x="2781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-39" x="3281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-39" x="3782" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-35" x="4282" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-30"> C_B = 2.29421995 </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-277"><span class="MJXp-msubsup" id="MJXp-Span-278"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-279" style="margin-right: 0.05em;">X</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-280" style="vertical-align: -0.4em;">R</span></span><span class="MJXp-mo" id="MJXp-Span-281" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-282">0.69548916</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-31-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.611ex" height="2.349ex" viewBox="0 -772.3 7582.6 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-58" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-52" x="1171" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="1743" y="0"></use><g transform="translate(2799,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-36" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-39" x="1279" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-35" x="1780" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-34" x="2280" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-38" x="2781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-39" x="3281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-31" x="3782" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-36" x="4282" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-31"> X_R = 0.69548916 </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-283"><span class="MJXp-msubsup" id="MJXp-Span-284"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-285" style="margin-right: 0.05em;">X</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-286" style="vertical-align: -0.4em;">G</span></span><span class="MJXp-mo" id="MJXp-Span-287" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-288">0.49416934</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-32-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.656ex" height="2.349ex" viewBox="0 -772.3 7601.7 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-58" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-47" x="1171" y="-219"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="1762" y="0"></use><g transform="translate(2818,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-34" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-39" x="1279" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-34" x="1780" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-31" x="2280" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-36" x="2781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-39" x="3281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-33" x="3782" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-34" x="4282" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-32"> X_G = 0.49416934 </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-289"><span class="MJXp-msubsup" id="MJXp-Span-290"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-291" style="margin-right: 0.05em;">X</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-292" style="vertical-align: -0.4em;">B</span></span><span class="MJXp-mo" id="MJXp-Span-293" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-294">0.28269708</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-33-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.611ex" height="2.349ex" viewBox="0 -772.3 7582.6 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-58" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-42" x="1171" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="1743" y="0"></use><g transform="translate(2799,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-32" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-38" x="1279" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-32" x="1780" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-36" x="2280" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-39" x="2781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-37" x="3281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30" x="3782" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-38" x="4282" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-33"> X_B = 0.28269708 </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-295"><span class="MJXp-msubsup" id="MJXp-Span-296"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-297" style="margin-right: 0.05em;">Y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-298" style="vertical-align: -0.4em;">R</span></span><span class="MJXp-mo" id="MJXp-Span-299" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-300">0.02320775</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-34-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.038ex" height="2.349ex" viewBox="0 -772.3 7335.6 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-59" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-52" x="822" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="1496" y="0"></use><g transform="translate(2552,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-32" x="1279" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-33" x="1780" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-32" x="2280" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30" x="2781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-37" x="3281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-37" x="3782" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-35" x="4282" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-34"> Y_R = 0.02320775 </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-301"><span class="MJXp-msubsup" id="MJXp-Span-302"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-303" style="margin-right: 0.05em;">Y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-304" style="vertical-align: -0.4em;">G</span></span><span class="MJXp-mo" id="MJXp-Span-305" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-306">0.15936245</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-35-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.082ex" height="2.349ex" viewBox="0 -772.3 7354.7 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-59" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-47" x="822" y="-219"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="1515" y="0"></use><g transform="translate(2571,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-31" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-35" x="1279" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-39" x="1780" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-33" x="2280" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-36" x="2781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-32" x="3281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-34" x="3782" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-35" x="4282" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-35"> Y_G = 0.15936245 </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-307"><span class="MJXp-msubsup" id="MJXp-Span-308"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-309" style="margin-right: 0.05em;">Y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-310" style="vertical-align: -0.4em;">B</span></span><span class="MJXp-mo" id="MJXp-Span-311" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-312">0.53520021</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-36-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.038ex" height="2.349ex" viewBox="0 -772.3 7335.6 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-59" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-42" x="822" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="1496" y="0"></use><g transform="translate(2552,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-35" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-33" x="1279" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-35" x="1780" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-32" x="2280" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30" x="2781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30" x="3281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-32" x="3782" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-31" x="4282" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-36"> Y_B = 0.53520021 </script></li></ul></li></ul></div></div><br><h4>  Improve the rainbow </h4><br>  If we take a closer look at the distribution of colors in the visible spectrum, we note that the parabolas actually cannot repeat the curves of the colors R, G, and B. It will be slightly better to use six parabolas instead of three.  Tying two bumps to each main component, we will get a much more correct approximation.  The difference is very noticeable in the violet part of the spectrum. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d8/421/cf2/1d8421cf247fe536560f7a49c54cecce.png"></div><br>  The difference is clearly visible in the violet and orange parts of the spectrum: <br><br><table><tbody><tr><td>  <strong>Title</strong> </td><td>  <strong>Gradient</strong> </td></tr><tr><td>  Zucconi </td><td><img src="https://habrastorage.org/getpro/habr/post_images/97a/a8e/d04/97aa8ed04d6f928c15ad1cdf1b3af925.png"></td></tr><tr><td>  Zucconi6 </td><td><img src="https://habrastorage.org/getpro/habr/post_images/19e/bcd/f77/19ebcdf77603071d895745c1d33f1b81.png"></td></tr><tr><td>  Visible spectrum </td><td><img src="https://habrastorage.org/getpro/habr/post_images/34e/0bf/929/34e0bf9290857494724cfe9aecf62082.png"></td></tr></tbody></table><br>  Here is the code: <br><br><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/     GPU Gems /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    fixed3 spectral_zucconi6 (float w) { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ w: [400, 700] /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ x: [0, 1] fixed x = saturate((w - 400.0)/</span></span> <span class="hljs-number"><span class="hljs-number">300.0</span></span>); const float3 c1 = float3(<span class="hljs-number"><span class="hljs-number">3.54585104</span></span>, <span class="hljs-number"><span class="hljs-number">2.93225262</span></span>, <span class="hljs-number"><span class="hljs-number">2.41593945</span></span>); const float3 x1 = float3(<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">69549072</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">49228336</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">27699880</span></span>); const float3 y1 = float3(<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0231263</span></span>9, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">15225084</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">52607955</span></span>); const float3 c2 = float3(<span class="hljs-number"><span class="hljs-number">3.90307140</span></span>, <span class="hljs-number"><span class="hljs-number">3.21182957</span></span>, <span class="hljs-number"><span class="hljs-number">3.96587128</span></span>); const float3 x2 = float3(<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">11748627</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">86755042</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">66077860</span></span>); const float3 y2 = float3(<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">84897130</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">88445281</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">73949448</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bump3y(c1 * (x - x1), y1) + bump3y(c2 * (x - x2), y2) ; }</code> </pre> <br>  There is no doubt that <code>spectral_zucconi6</code> provides a better approximation of colors without using branching.  If speed is important to you, then you can use a simplified version of the algorithm - <code>spectral_zucconi</code> . <br><br><h4>  Summarize </h4><br>  In this part, we looked at the new approach to generating shader-like rainbow patterns. <br><br><table><tbody><tr><td>  <strong>Title</strong> </td><td>  <strong>Gradient</strong> </td></tr><tr><td>  JET </td><td><img src="https://habrastorage.org/getpro/habr/post_images/5da/fe3/017/5dafe3017eb6ec0d6a1999cac3b5c143.png"></td></tr><tr><td>  Bruton </td><td><img src="https://habrastorage.org/getpro/habr/post_images/06b/a86/121/06ba86121e1d1fe5dcd779bda8eb4f36.png"></td></tr><tr><td>  GPU Gems </td><td><img src="https://habrastorage.org/getpro/habr/post_images/2d6/8d6/b27/2d68d6b278d6541659c7dc90b1b66ecf.png"></td></tr><tr><td>  Spektre </td><td><img src="https://habrastorage.org/getpro/habr/post_images/acc/bbf/868/accbbf8687e89128990c284270e18ff9.png"></td></tr><tr><td>  Zucconi </td><td><img src="https://habrastorage.org/getpro/habr/post_images/97a/a8e/d04/97aa8ed04d6f928c15ad1cdf1b3af925.png"></td></tr><tr><td>  Zucconi6 </td><td><img src="https://habrastorage.org/getpro/habr/post_images/19e/bcd/f77/19ebcdf77603071d895745c1d33f1b81.png"></td></tr><tr><td>  Visible spectrum </td><td><img src="https://habrastorage.org/getpro/habr/post_images/34e/0bf/929/34e0bf9290857494724cfe9aecf62082.png"></td></tr></tbody></table><br><h2>  Part 4. Understanding the diffraction grating </h2><br>  In the first part of the tutorial we met the dual nature of light, which manifests the properties of waves and particles.  In this part we will see why both these two aspects are necessary for the emergence of iridissention. <br><br><h4>  Reflections: light and mirrors </h4><br>  In scientific literature, a <strong>ray of light</strong> is often mentioned as a way of indicating the path traveled by photons in space and interacting with objects.  In most <strong>shading models,</strong> light is perceived as being created from homogeneous particles, which behave like perfect billiard balls.  In the general case, when a beam of light collides with a surface, it is reflected from it at the same deflection angle.  Such surfaces behave like perfect mirrors, completely reflecting the light. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c5e/bbf/320/c5ebbf32045fdeafd48e45a9593a25e0.png"></div><br>  Objects rendered in this technique resemble mirrors.  Moreover, if the light falls from the direction <strong>L</strong> , then the observer can see it only when looking from the direction <strong>R.</strong>  This type of reflection is also called <strong>specular</strong> , which means "mirror-like." <br><br>  In the real world, most objects reflect light in a different way, called <strong>diffuse</strong> .  When a beam of light falls on a scattering surface, it is more or less evenly scattered in all directions.  This gives objects a uniform diffuse color pattern. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/551/509/2af/5515092afd288cf78fbeedaf6d0dff91.png"></div><br>  In most modern engines (like Unity and Unreal), these two behaviors are modeled using different sets of equations.  In my previous tutorial, <a href="https://www.alanzucconi.com/%3Fp%3D1964" rel="noopener">Physically Based Rendering and Lighting Models,</a> I explained the <strong>Lambert</strong> and <strong>Blinna-Phong</strong> <strong>reflectivity</strong> models, which are used for diffuse and specular reflections, respectively. <br><br>  Despite the fact that they look different, the diffuse reflection can be explained through the mirror.  No surface is completely flat.  A rough surface can be modeled as made from tiny mirrors, each of which is fully characterized by specular reflectivity.  The presence of such <strong>micrograins</strong> leads to scattering of rays in all directions. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad5/a67/a71/ad5a67a71253490dd91aa23446cd4c63.png"></div><br>  The multidirectionality of such microfaces is often modeled by physically accurate shaders using properties such as <strong>Smoothness (smoothness)</strong> or <strong>Roughness (roughness)</strong> .  You can read more about this on the Unity help page explaining the <a href="https://docs.unity3d.com/Manual/StandardShaderMaterialParameterSmoothness.html" rel="noopener">Smoothness</a> feature of the standard engine shader. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/064/ec2/b96/064ec2b965717396ee4f89b5560155bf.png"></div><br><div class="spoiler">  <b class="spoiler_title">What about reflectivity?</b> <div class="spoiler_text">  In this section, we said that the diffuse (diffuse) reflection can be fully explained by considering the specular reflection on the surface consisting of multidirectional microfaces.  However, this is not entirely true.  If the surface shows only a mirror image, this means that with full polishing it will look black.  White marble can be considered a good counterexample: no polishing can make it black.  Even if we manage to achieve a perfectly smooth surface, white marble will still exhibit a white diffuse reflection component. <br><br>  And in fact, something else is responsible for this effect.  The diffuse surface component also arises from a secondary source: <strong>refraction</strong> .  Light can penetrate the surface of an object, reflect inside it and exit at a different angle (see the figure above).  This means that a percentage of the total incident light will be re-emitted from the surface of the material at any arbitrary point and at any angle.  This behavior is often called <strong>subsurface scattering,</strong> and calculations for its simulation are often very costly. <br><br>  Read more about these effects (and their simulations) in the <a href="https://www.marmoset.co/posts/basic-theory-of-physically-based-rendering/" rel="noopener">Basic Theory of Physically Based Rendering</a> article by Marmoset. </div></div><br><h4>  Light as a wave </h4><br>  It is very convenient to simulate the rays of light as if they are composed of particles.  However, this does not allow us to recreate the behavior, which shows a lot of materials, including iridissentsiyu.  Some phenomena can only be fully understood if one accepts the fact that light behaves like a wave in certain conditions. <br><br>  Most shaders work with light as particles.  The result of this tremendous simplification is what undergoes an <strong>additive composition</strong> .  If two beams reach the observer, then their brightness simply adds up.  The more rays the surface emits, the brighter it will be. <br><br>  In the real world, it is not.  If two beams of light reach the observer, then the final color depends on how their waves interact with each other.  The animation below shows how two simple sinusoidal waves can <strong>amplify</strong> or <strong>dampen</strong> each other, depending on their <strong>phase</strong> . <br><br><div class="spoiler">  <b class="spoiler_title">Animation</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fc1/122/8f5/fc11228f5f65364691a609b957d6a12f.gif"></div></div></div><br>  When two waves <strong>coincide in phase</strong> , their peaks and valleys ideally coincide: in this case, the final wave is amplified.  In the opposite case, they can literally destroy each other.  This means that if two beams of light fall on the observer in the correct configuration, he will not receive any light. <br><br>  Wave interaction may seem like a strange principle.  However, we all experienced it in everyday life.  The popularizer of science, Derek Muller, explains this well in his video of <a href="https://www.youtube.com/watch%3Fv%3DIuv6hY6zsd0" rel="noopener">The Original Double Slit Experiment</a> , where he demonstrates the <strong>amplifying</strong> and <strong>damping interference</strong> of water waves. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Iuv6hY6zsd0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  But how is this related to light and iridissention?  The reason for iridissention is the interaction of light waves of different lengths.  Some materials can only reflect photons in the right direction, enhancing certain colors and destroying others.  As a result of this interaction, we can observe a rainbow. <br><br><h4>  Diffraction </h4><br>  In the first section of this part, we studied one of the types of interaction of light and matter: reflection.  Reflection occurs when light is modeled as a particle.  However, if we treat it as a wave, a new set of behaviors will arise.  One of them is called <strong>diffraction</strong> .  If all the incident light reaches the surface at one angle, then this is called a <strong>plane wave</strong> .  For example, <em>directional lighting sources</em> in Unity create flat waves.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> When a plane wave passes through a slot, it is refracted, as shown in the following animation: </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Animation</font></font></b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0fb/b44/e24/0fbb44e24e4ebb7cd35c336eb39f54f3.gif"></div></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the light passes through two different slits, then two new wave fronts are generated. </font><font style="vertical-align: inherit;">And as we said above, these new light waves can interact with each other. </font><font style="vertical-align: inherit;">The animation below shows how the light behaves when there are two such slots. </font><font style="vertical-align: inherit;">You can see that they actually interact, both amplifying and quenching the rays.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Animation</font></font></b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f2d/8c0/85e/f2d8c085ec9e8da4fd9098a6e42901a6.gif"></div></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Now we have all the necessary basics to discuss the causes of iridissention. </font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Diffraction grating </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When a plane wave passes through a slit or is reflected into an unevenness, it refracts, creating a new spherical wave front. This means that the light is scattered in all directions, just as it does with diffuse reflection. If the surface of the material is uneven, then the resulting flat waves are scattered randomly and at the microscopic level, there is no interference pattern. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, some materials have surface patterns that are replicable on a scale comparable to the wavelength of the incident light. When this happens, the repeatability of the pattern leads to a repetitive and non-random interaction of the fronts of the diffracted waves. The resulting interaction creates a repeating pattern of interference that can be seen at the macroscopic level.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The above effect is called a </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diffraction grating</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Some wavelengths are greatly enhanced, while others are destroyed. </font><font style="vertical-align: inherit;">Since different wavelengths correspond to different colors, the diffraction grating causes the reflections of some colors to become more pronounced. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This mechanism ensures the occurrence of iridissencia on surfaces with a repeating pattern. </font><font style="vertical-align: inherit;">They are often found in nature: the external skeletons of insects and the feathers of birds contain microscopic scales aligned in repetitive patterns. </font><font style="vertical-align: inherit;">In the picture below you can see an enlarged image of a peacock feather.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e91/2df/21f/e912df21f359c95efb9a6fcc4d26b569.jpg"></div><br><h4>  Summarize </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the next part of the tutorial, I will show you how to mathematically simulate a specific type of iridissention. </font><font style="vertical-align: inherit;">After deriving the equations, they are easy to implement in a shader.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Part 5. Mathematics of the diffraction grating. </font></font></h2><br><h4>  Introduction </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the previous section, we explained why iridissencia occurs in some materials. </font><font style="vertical-align: inherit;">Now we have everything we need to start modeling this phenomenon mathematically. </font><font style="vertical-align: inherit;">Let's start with the fact that we present a material in which there are discontinuities that repeat through known distances</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-313"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-314">d</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-37-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.216ex" height="2.057ex" viewBox="0 -780.1 523.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-64" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-37"> d </script>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In order to derive equations, we denote the angle between the incident rays of light and the surface normal as </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-315"><span class="MJXp-msubsup" id="MJXp-Span-316"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-317" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-318" style="vertical-align: -0.4em;">L</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-38-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.442ex" height="2.298ex" viewBox="0 -780.1 1051.4 989.6" role="img" focusable="false" style="vertical-align: -0.487ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-4C" x="663" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-38">\theta_L</script>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Let's also imagine that the observer is positioned in such a way that he receives all the reflected rays with an angle </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-319"><span class="MJXp-msubsup" id="MJXp-Span-320"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-321" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-322" style="vertical-align: -0.4em;">L</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-39-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.442ex" height="2.298ex" viewBox="0 -780.1 1051.4 989.6" role="img" focusable="false" style="vertical-align: -0.487ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-4C" x="663" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-39">\theta_L</script>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Each inhomogeneity scatters light in all directions, so there will always be rays of light falling on the observer, regardless of </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-323"><span class="MJXp-msubsup" id="MJXp-Span-324"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-325" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-326" style="vertical-align: -0.4em;">L</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-40-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.442ex" height="2.298ex" viewBox="0 -780.1 1051.4 989.6" role="img" focusable="false" style="vertical-align: -0.487ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-4C" x="663" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-40">\theta_L</script>  . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/959/269/7aa/9592697aa9e569e07e63be2f753b08ac.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Since the discontinuities repeat regularly in increments </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-327"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-328">d</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-41-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.216ex" height="2.057ex" viewBox="0 -780.1 523.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-64" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-41"> d </script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nanometers, the scatter pattern itself repeats every </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-329"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-330">d</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-42-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.216ex" height="2.057ex" viewBox="0 -780.1 523.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-64" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-42"> d </script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nanometers. </font><font style="vertical-align: inherit;">It means that there is </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">at least one</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ray of light coming to the observer from each slot.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Derivation of equations </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The two beams of light shown in the diagram above pass a different distance before reaching the observer. </font><font style="vertical-align: inherit;">If they start to move, coinciding in phase, then having reached the observer, they may not coincide. To understand how these two beams interact (amplifying or quenching each other), we need to calculate how far they do not coincide in phase when they reach the observer. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">These two beams will be exactly the same in phase until the first one hits the surface. </font><font style="vertical-align: inherit;">The second beam travels an extra distance.</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-331"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-332">x</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-43-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.455ex" viewBox="0 -520.7 572.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-78" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-43"> x </script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(highlighted in green), after which it also falls to the surface. </font><font style="vertical-align: inherit;">Using simple trigonometry, we can show that the length of the green segment</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-333"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-334">x</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-44-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.455ex" viewBox="0 -520.7 572.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-78" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-44"> x </script>  equals <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-335"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-336">d</span><span class="MJXp-mo" id="MJXp-Span-337" style="margin-left: 0.267em; margin-right: 0.267em;">‚ãÖ</span><span class="MJXp-mi" id="MJXp-Span-338">sin</span><span class="MJXp-mo" id="MJXp-Span-339" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-340"><span class="MJXp-msubsup" id="MJXp-Span-341"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-342" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-343" style="vertical-align: -0.4em;">L</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-45-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.58ex" height="2.298ex" viewBox="0 -780.1 3694 989.6" role="img" focusable="false" style="vertical-align: -0.487ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-64" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-22C5" x="745" y="0"></use><g transform="translate(1246,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-73"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-69" x="394" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-6E" x="673" y="0"></use></g><g transform="translate(2642,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-4C" x="663" y="-213"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-45">d \cdot \sin{\theta_L}</script>  . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/871/cd1/b67/871cd1b67c243819b4efaec88c35530e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Using a similar construction, we can calculate the extra distance </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-344"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-345">y</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-46-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.155ex" height="1.817ex" viewBox="0 -520.7 497.5 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-79" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-46"> y </script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which passes the first ray until the second one hits the surface. </font><font style="vertical-align: inherit;">In this case, we see that</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-346"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-347">y</span><span class="MJXp-mo" id="MJXp-Span-348" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-349">d</span><span class="MJXp-mo" id="MJXp-Span-350" style="margin-left: 0.267em; margin-right: 0.267em;">‚ãÖ</span><span class="MJXp-mi" id="MJXp-Span-351">sin</span><span class="MJXp-mo" id="MJXp-Span-352" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-353"><span class="MJXp-msubsup" id="MJXp-Span-354"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-355" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-356" style="vertical-align: -0.4em;">V</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-47-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.978ex" height="2.419ex" viewBox="0 -780.1 5587.8 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-79" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="775" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-64" x="1831" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-22C5" x="2577" y="0"></use><g transform="translate(3078,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-73"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-69" x="394" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-6E" x="673" y="0"></use></g><g transform="translate(4474,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-56" x="663" y="-213"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-47">y=d \cdot \sin{\theta_V}</script>  . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5c3/4fa/d0b/5c34fad0b0fd7f07db1491e84cff27e0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> These two segments </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-357"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-358">x</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-48-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.455ex" viewBox="0 -520.7 572.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-78" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-48"> x </script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Critical to determining whether the two beams are in phase when they are received by an observer. </font><font style="vertical-align: inherit;">Their difference measures the difference of the lengths of these two rays. </font><font style="vertical-align: inherit;">If it is zero, then we know for sure that the two beams coincide in phase, because they essentially covered the same distance. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, two beams may coincide in phase not only in this case. </font><font style="vertical-align: inherit;">If the difference in length is an integer multiple of the wavelength</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-359"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-360">w</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-49-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.664ex" height="1.455ex" viewBox="0 -520.7 716.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-77" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-49"> w </script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, they will still be in phase. </font><font style="vertical-align: inherit;">From a mathematical point of view, two rays coincide in phase if they satisfy the following condition:</font></font><br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-361"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-362">d</span><span class="MJXp-mi" id="MJXp-Span-363">sin</span><span class="MJXp-mo" id="MJXp-Span-364" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-365"><span class="MJXp-msubsup" id="MJXp-Span-366"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-367" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-368" style="vertical-align: -0.4em;">L</span></span></span><span class="MJXp-mo" id="MJXp-Span-369" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-370">d</span><span class="MJXp-mi" id="MJXp-Span-371">sin</span><span class="MJXp-mo" id="MJXp-Span-372" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-373"><span class="MJXp-msubsup" id="MJXp-Span-374"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-375" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-376" style="vertical-align: -0.4em;">V</span></span></span><span class="MJXp-mo" id="MJXp-Span-377" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-378">n</span><span class="MJXp-mo" id="MJXp-Span-379" style="margin-left: 0.267em; margin-right: 0.267em;">‚ãÖ</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-380">w</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-50-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="25.397ex" height="2.419ex" viewBox="0 -780.1 10934.6 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-64" x="0" y="0"></use><g transform="translate(690,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-73"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-69" x="394" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-6E" x="673" y="0"></use></g><g transform="translate(2086,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-4C" x="663" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2212" x="3359" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-64" x="4360" y="0"></use><g transform="translate(5050,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-73"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-69" x="394" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-6E" x="673" y="0"></use></g><g transform="translate(6447,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-56" x="663" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="7838" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6E" x="8894" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-22C5" x="9717" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-77" x="10218" y="0"></use></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-50">d \sin{\theta_L} - d \sin{ \theta_V } = n \cdot w</script></p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-381"><span class="MJXp-mi" id="MJXp-Span-382">sin</span><span class="MJXp-mo" id="MJXp-Span-383" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-384"><span class="MJXp-msubsup" id="MJXp-Span-385"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-386" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-387" style="vertical-align: -0.4em;">L</span></span></span><span class="MJXp-mo" id="MJXp-Span-388" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mi" id="MJXp-Span-389">sin</span><span class="MJXp-mo" id="MJXp-Span-390" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-391"><span class="MJXp-msubsup" id="MJXp-Span-392"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-393" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-394" style="vertical-align: -0.4em;">V</span></span></span><span class="MJXp-mo" id="MJXp-Span-395" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mfrac" id="MJXp-Span-396" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-397">n</span><span class="MJXp-mo" id="MJXp-Span-398" style="margin-left: 0.267em; margin-right: 0.267em;">‚ãÖ</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-399">w</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-400">d</span></span></span></span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-51-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="23.027ex" height="4.588ex" viewBox="0 -1195.1 9914.3 1975.2" role="img" focusable="false" style="vertical-align: -1.812ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-73"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-69" x="394" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-6E" x="673" y="0"></use><g transform="translate(1396,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-4C" x="663" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2212" x="2669" y="0"></use><g transform="translate(3670,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-73"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-69" x="394" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-6E" x="673" y="0"></use></g><g transform="translate(5066,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-56" x="663" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="6458" y="0"></use><g transform="translate(7236,0)"><g transform="translate(397,0)"><rect stroke="none" width="2159" height="60" x="0" y="220"></rect><g transform="translate(60,676)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-22C5" x="822" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-77" x="1323" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-64" x="818" y="-686"></use></g></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-51">\sin{\theta_L} -  \sin{ \theta_V } = \frac{n \cdot w}{d}</script></p><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Visualization </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's take a minute to figure out the meaning of this equation. </font><font style="vertical-align: inherit;">If the light falls at an angle</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-401"><span class="MJXp-msubsup" id="MJXp-Span-402"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-403" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-404" style="vertical-align: -0.4em;">L</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-52-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.442ex" height="2.298ex" viewBox="0 -780.1 1051.4 989.6" role="img" focusable="false" style="vertical-align: -0.487ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-4C" x="663" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-52">\theta_L</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> what the observer will see when looking at the material at an angle </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-405"><span class="MJXp-msubsup" id="MJXp-Span-406"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-407" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-408" style="vertical-align: -0.4em;">V</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-53-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.586ex" height="2.419ex" viewBox="0 -780.1 1113.6 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-56" x="663" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-53">\theta_V</script>  ?<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> All wavelengths </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-409"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-410">w</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-54-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.664ex" height="1.455ex" viewBox="0 -520.7 716.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-77" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-54"> w </script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> that are integer multiples </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-411"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-412">d</span><span class="MJXp-mrow" id="MJXp-Span-413"><span class="MJXp-mo" id="MJXp-Span-414" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.244em;"><span class="MJXp-right MJXp-scale7" style="font-size: 1.978em; margin-left: -0.05em;">(</span></span><span class="MJXp-mi" id="MJXp-Span-415">sin</span><span class="MJXp-mo" id="MJXp-Span-416" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-417"><span class="MJXp-msubsup" id="MJXp-Span-418"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-419" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-420" style="vertical-align: -0.4em;">L</span></span></span><span class="MJXp-mo" id="MJXp-Span-421" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mi" id="MJXp-Span-422">sin</span><span class="MJXp-mo" id="MJXp-Span-423" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-424"><span class="MJXp-msubsup" id="MJXp-Span-425"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-426" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-427" style="vertical-align: -0.4em;">V</span></span></span><span class="MJXp-mo" id="MJXp-Span-428" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.244em;"><span class="MJXp-right MJXp-scale7" style="font-size: 1.978em; margin-left: -0.05em;">)</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-55-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.767ex" height="2.66ex" viewBox="0 -832 7649.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-64" x="0" y="0"></use><g transform="translate(690,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-28" x="0" y="0"></use><g transform="translate(389,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-73"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-69" x="394" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-6E" x="673" y="0"></use><g transform="translate(1396,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-4C" x="663" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2212" x="2669" y="0"></use><g transform="translate(3670,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-73"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-69" x="394" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-6E" x="673" y="0"></use></g><g transform="translate(5066,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-56" x="663" y="-213"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-29" x="6569" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-55">d \left( \sin{\theta_L} - \sin{ \theta_V } \right)</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, will interact with the gain, and will manifest themselves strongly in the final reflection. </font><font style="vertical-align: inherit;">Therefore, it is these colors that the viewer will see. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This effect is visualized by the following diagram, taken from a very interesting discussion of the </font></font><a href="https://blenderartists.org/forum/showthread.php%3F340095-A-complex-approach-Iridescence-in-cycles/page2" rel="noopener"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A complex approach: Iridescence in cycles</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ad/336/ea8/1ad336ea8b071da88eb32410974c4dc5.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The white beam follows the path traveled by the photons for specular reflection. </font><font style="vertical-align: inherit;">An observer looking at the material from different angles will see a cyclical rainbow pattern. </font><font style="vertical-align: inherit;">Each color corresponds to its own wavelength, and the order determines the corresponding integer.</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-429"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-430">n</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-56-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.395ex" height="1.455ex" viewBox="0 -520.7 600.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6E" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-56"> n </script>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As you can see, the diffraction grating equation is satisfied even with negative values </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-431"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-432">n</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-57-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.395ex" height="1.455ex" viewBox="0 -520.7 600.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6E" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-57"> n </script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> because magnitude </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-433"><span class="MJXp-mi" id="MJXp-Span-434">sin</span><span class="MJXp-mo" id="MJXp-Span-435" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-436"><span class="MJXp-msubsup" id="MJXp-Span-437"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-438" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-439" style="vertical-align: -0.4em;">L</span></span></span><span class="MJXp-mo" id="MJXp-Span-440" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mi" id="MJXp-Span-441">sin</span><span class="MJXp-mo" id="MJXp-Span-442" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-443"><span class="MJXp-msubsup" id="MJXp-Span-444"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-445" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-446" style="vertical-align: -0.4em;">V</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-58-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="14.354ex" height="2.419ex" viewBox="0 -780.1 6180.3 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-73"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-69" x="394" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-6E" x="673" y="0"></use><g transform="translate(1396,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-4C" x="663" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2212" x="2669" y="0"></use><g transform="translate(3670,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-73"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-69" x="394" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-6E" x="673" y="0"></use></g><g transform="translate(5066,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-56" x="663" y="-213"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-58">\sin{\theta_L} - \sin{ \theta_V }</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">may be negative. </font><font style="vertical-align: inherit;">From a computational point of view, it makes sense to simplify the search space by limiting it to only positive values.</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-447"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-448">n</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-59-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.395ex" height="1.455ex" viewBox="0 -520.7 600.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6E" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-59"> n </script>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The new equation, which we will use, has the form: </font></font><br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-449"><span class="MJXp-mrow" id="MJXp-Span-450"><span class="MJXp-mo" id="MJXp-Span-451" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.244em;"><span class="MJXp-right MJXp-scale7" style="font-size: 1.978em; margin-left: -0.013em;">|</span></span><span class="MJXp-mi" id="MJXp-Span-452">sin</span><span class="MJXp-mo" id="MJXp-Span-453" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-454"><span class="MJXp-msubsup" id="MJXp-Span-455"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-456" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-457" style="vertical-align: -0.4em;">L</span></span></span><span class="MJXp-mo" id="MJXp-Span-458" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mi" id="MJXp-Span-459">sin</span><span class="MJXp-mo" id="MJXp-Span-460" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-461"><span class="MJXp-msubsup" id="MJXp-Span-462"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-463" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-464" style="vertical-align: -0.4em;">V</span></span></span><span class="MJXp-mo" id="MJXp-Span-465" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.244em;"><span class="MJXp-right MJXp-scale7" style="font-size: 1.978em; margin-left: -0.013em;">|</span></span></span><span class="MJXp-mo" id="MJXp-Span-466" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mfrac" id="MJXp-Span-467" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-468">n</span><span class="MJXp-mo" id="MJXp-Span-469" style="margin-left: 0.267em; margin-right: 0.267em;">‚ãÖ</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-470">w</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-471">d</span></span></span></span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-60-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="24.321ex" height="4.588ex" viewBox="0 -1195.1 10471.3 1975.2" role="img" focusable="false" style="vertical-align: -1.812ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-7C" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-73"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-69" x="394" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-6E" x="673" y="0"></use><g transform="translate(1396,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-4C" x="663" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2212" x="2669" y="0"></use><g transform="translate(3670,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-73"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-69" x="394" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-6E" x="673" y="0"></use></g><g transform="translate(5066,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-56" x="663" y="-213"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-7C" x="6458" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="7015" y="0"></use><g transform="translate(7793,0)"><g transform="translate(397,0)"><rect stroke="none" width="2159" height="60" x="0" y="220"></rect><g transform="translate(60,676)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-22C5" x="822" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-77" x="1323" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-64" x="818" y="-686"></use></g></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-60">\left | \sin{\theta_L} -  \sin{ \theta_V } \right |= \frac{n \cdot w}{d}</script></p><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Part 6. CD-ROM shader: diffraction grating - 1 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In this part we will look at the creation of a shader that recreates the rainbow reflections visible on the surface of a CD-ROM or DVD. </font></font><br><br><h4>  Introduction </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the previous section, we derived equations describing the very nature of the iridiscent reflections exhibited by some surfaces. Iridiscence occurs in materials on whose surfaces there is a repeating pattern, the size of which is comparable to the wavelength of the light reflected by it. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The optical effects that we want to recreate ultimately depend on three factors: the angle between the light source and the surface normal ( </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">direction of light</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), the viewing angle of the observer ( </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">direction</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), and the distance between the repetitive gaps.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/959/269/7aa/9592697aa9e569e07e63be2f753b08ac.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We want the shader to add iridiscent reflections on top of the usual effects that standard material normally creates. </font><font style="vertical-align: inherit;">Therefore, we will expand </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the lighting function of the </font></font></strong> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">standard surface shader (Standard Surface shader)</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">If you are not familiar with this procedure, then it is worth exploring my tutorial on </font></font><a href="https://www.alanzucconi.com/%3Fp%3D1964" rel="noopener"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Physically Based Rendering and Lighting Models</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Creating a surface shader </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first step is to create a new shader. </font><font style="vertical-align: inherit;">Since we want to expand the capabilities of a shader that already supports physically accurate lighting, we start with the </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Standard Surface Shader</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d7b/2c1/1dd/d7b2c11dd24a7e395d55974dd6f4abcf.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The newly created CD-ROM shader will require a new property: distance </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-472"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-473">d</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-61-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.216ex" height="2.057ex" viewBox="0 -780.1 523.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-64" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-61"> d </script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">used in the diffraction grating equation. </font><font style="vertical-align: inherit;">Let's add it to the block </font></font><code>Properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which should look like this:</font></font><br><br><pre> <code class="hljs pgsql">Properties { _Color ("Color", Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) _MainTex ("Albedo (RGB)", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} _Glossiness ("Smoothness", Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.5</span></span> _Metallic ("Metallic", Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.0</span></span> _Distance ("Grating distance", Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">10000</span></span>)) = <span class="hljs-number"><span class="hljs-number">1600</span></span> // nm }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So we will create a new slider in Material Inspector. </font><font style="vertical-align: inherit;">However, the property </font></font><code>_Distance</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">still needs to be associated with a variable in the section </font></font><code>CGPROGRAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> _Distance;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Now we are ready to go. </font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Changing the lighting function </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first thing we need to do is replace the lighting function of the CD-ROM shader with our own. </font><font style="vertical-align: inherit;">We can do this by changing the directive </font></font><code>#pragma</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here:</font></font><br><br><pre> <code class="hljs cs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> surface surf Standard fullforwardshadows</span></span></code> </pre> <br>  on: <br><br><pre> <code class="hljs cs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> surface surf Diffraction fullforwardshadows</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This will force Unity to delegate the calculation of the lighting function called </font></font><code>LightingDiffraction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. It is important to understand that we want </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to expand the</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> functionality of this surface shader, and not </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">override it</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Therefore, our new lighting function will begin with calling the standard Unity PBR lighting function:</font></font><br><br><pre> <code class="hljs cpp"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"UnityPBSLighting.cginc"</span></span></span><span class="hljs-meta"> inline fixed4 LightingDiffraction(SurfaceOutputStandard s, fixed3 viewDir, UnityGI gi) { </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//   fixed4 pbr = LightingStandard(s, viewDir, gi); // &lt;    &gt; return pbr; }</span></span></span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As you can see from the above code snippet, the new function </font></font><code>LightingDiffraction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simply calls </font></font><code>LightingStandard</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and returns its value. </font><font style="vertical-align: inherit;">If we compile the shader now, we will not see any difference in the way materials are rendered. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, before moving on, we need to create an additional function to handle </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">global illumination</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Since we do not need to change this behavior, our new global illumination function will simply be a proxy function of the standard Unity PBR function:</font></font><br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">void</span></span> <span class="hljs-type"><span class="hljs-type">LightingDiffraction_GI</span></span>(<span class="hljs-type"><span class="hljs-type">SurfaceOutputStandard</span></span> s, <span class="hljs-type"><span class="hljs-type">UnityGIInput</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">, inout </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UnityGI</span></span></span><span class="hljs-class"> gi) { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LightingStandard_GI</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">s</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gi</span></span></span><span class="hljs-class">); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is also worth noting that since we use directly </font></font><code>LightingStandard</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>LightingDiffraction_GI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, then we need to include it in our shader </font></font><code>UnityPBSLighting.cginc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The implementation of the diffraction grating </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This will be the foundation of our shader. </font><font style="vertical-align: inherit;">We are finally ready to implement the diffraction grating equations derived in the previous section. </font><font style="vertical-align: inherit;">In it, we came to the conclusion that the observer sees the iridiscent reflection, which is the sum of all wavelengths</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-474"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-475">w</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-62-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.664ex" height="1.455ex" viewBox="0 -520.7 716.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-77" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-62"> w </script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">satisfying </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the lattice equation</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-476"><span class="MJXp-mrow" id="MJXp-Span-477"><span class="MJXp-mo" id="MJXp-Span-478" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.244em;"><span class="MJXp-right MJXp-scale7" style="font-size: 1.978em; margin-left: -0.013em;">|</span></span><span class="MJXp-mi" id="MJXp-Span-479">sin</span><span class="MJXp-mo" id="MJXp-Span-480" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-481"><span class="MJXp-msubsup" id="MJXp-Span-482"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-483" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-484" style="vertical-align: -0.4em;">L</span></span></span><span class="MJXp-mo" id="MJXp-Span-485" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mi" id="MJXp-Span-486">sin</span><span class="MJXp-mo" id="MJXp-Span-487" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-488"><span class="MJXp-msubsup" id="MJXp-Span-489"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-490" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-491" style="vertical-align: -0.4em;">V</span></span></span><span class="MJXp-mo" id="MJXp-Span-492" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.244em;"><span class="MJXp-right MJXp-scale7" style="font-size: 1.978em; margin-left: -0.013em;">|</span></span></span><span class="MJXp-mo" id="MJXp-Span-493" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mfrac" id="MJXp-Span-494" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-495">n</span><span class="MJXp-mo" id="MJXp-Span-496" style="margin-left: 0.267em; margin-right: 0.267em;">‚ãÖ</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-497">w</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-498">d</span></span></span></span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-63-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="24.321ex" height="4.588ex" viewBox="0 -1195.1 10471.3 1975.2" role="img" focusable="false" style="vertical-align: -1.812ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-7C" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-73"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-69" x="394" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-6E" x="673" y="0"></use><g transform="translate(1396,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-4C" x="663" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-2212" x="2669" y="0"></use><g transform="translate(3670,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-73"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-69" x="394" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-6E" x="673" y="0"></use></g><g transform="translate(5066,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-56" x="663" y="-213"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-7C" x="6458" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-3D" x="7015" y="0"></use><g transform="translate(7793,0)"><g transform="translate(397,0)"><rect stroke="none" width="2159" height="60" x="0" y="220"></rect><g transform="translate(60,676)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-22C5" x="822" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-77" x="1323" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-64" x="818" y="-686"></use></g></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-63">\left | \sin{\theta_L} -  \sin{ \theta_V } \right |= \frac{n \cdot w}{d}</script></p><br>  Where <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-499"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-500">n</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-64-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.395ex" height="1.455ex" viewBox="0 -520.7 600.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6E" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-64"> n </script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - integer greater than </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-501"><span class="MJXp-mn" id="MJXp-Span-502">0</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-65-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="1.937ex" viewBox="0 -728.2 500.5 834" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-30" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-65"> 0 </script>  . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> For each pixel value </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-503"><span class="MJXp-msubsup" id="MJXp-Span-504"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-505" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-506" style="vertical-align: -0.4em;">L</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-66-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.442ex" height="2.298ex" viewBox="0 -780.1 1051.4 989.6" role="img" focusable="false" style="vertical-align: -0.487ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-4C" x="663" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-66">\theta_L</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(determined by the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">direction of the light</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ),</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-507"><span class="MJXp-msubsup" id="MJXp-Span-508"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-509" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-510" style="vertical-align: -0.4em;">V</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-67-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.586ex" height="2.419ex" viewBox="0 -780.1 1113.6 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-56" x="663" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-67">\theta_V</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(determined by the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">direction of the review</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) and</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-511"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-512">d</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-68-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.216ex" height="2.057ex" viewBox="0 -780.1 523.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-64" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-68"> d </script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">distance between gaps</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) are known. </font><font style="vertical-align: inherit;">Unknown variables are</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-513"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-514">w</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-69-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.664ex" height="1.455ex" viewBox="0 -520.7 716.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-77" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-69"> w </script>  and <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-515"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-516">n</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-70-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.395ex" height="1.455ex" viewBox="0 -520.7 600.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6E" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-70"> n </script>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The easiest way to cycle through the values </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-517"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-518">n</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-71-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.395ex" height="1.455ex" viewBox="0 -520.7 600.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6E" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-71"> n </script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to see which wavelengths satisfy the lattice equation. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When we know which wavelengths contribute to the final iridiscent reflection, we will calculate the corresponding colors and add them. </font><font style="vertical-align: inherit;">In the ‚ÄúImprove the Rainbow‚Äù section, we considered several ways to convert the visible spectrum's wavelengths into colors. </font><font style="vertical-align: inherit;">In this tutorial we will use </font></font><code>spectral_zucconi6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">it because it provides the best approximation with the least computational cost. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's consider the following possible implementation:</font></font><br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> fixed4 LightingDiffraction(SurfaceOutputStandard s, fixed3 viewDir, UnityGI gi) { //   fixed4 pbr = LightingStandard(s, viewDir, gi); //    fixed3 color = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> n = <span class="hljs-number"><span class="hljs-number">1</span></span>; n &lt;= <span class="hljs-number"><span class="hljs-number">8</span></span>; n++) { <span class="hljs-type"><span class="hljs-type">float</span></span> wavelength = abs(sin_thetaL - sin_thetaV) * d / n; color += spectral_zucconi6(wavelength); } color = saturate(color); //       pbr.rgb += color; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> pbr; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In this code snippet we use the values </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-519"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-520">n</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-72-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.395ex" height="1.455ex" viewBox="0 -520.7 600.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-6E" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-72"> n </script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">up to 8. For better results, larger values ‚Äã‚Äãcan be taken, however, this is already enough to take into account a significant part of the iridiscent reflection. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We have the last thing - to calculate </font></font><code>sin_thetaL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>sin_thetaV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">To do this, we need to introduce another concept: the </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tangent vector</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In the next section, we will learn how to calculate it.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Part 7. CD-ROM shader: diffraction grating - 2 </font></font></h2><br><h4>  Introduction </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the previous part of the tutorial, we created the first approximation of iridiscent reflections appearing on the surface of a CD-ROM. </font><font style="vertical-align: inherit;">It is important to remember that this shader is physically correct. </font><font style="vertical-align: inherit;">In order to properly simulate the reflection we need, we must make sure that all the CD-ROM tracks are arranged in a circle. </font><font style="vertical-align: inherit;">So we will create a radial reflection.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Slot orientation </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The lattice equation we derived has a big limitation: it assumes that all the slots are in the same direction. </font><font style="vertical-align: inherit;">This is often true for the external skeletons of insects, but the tracks on the surface of a CD-ROM are arranged in a circle. </font><font style="vertical-align: inherit;">If we implement the solution literally, we get a rather flimsy reflection (the right side of the image).</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/34c/d11/292/34cd112927b3cb30511f4915dcc3e292.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To solve this problem, we need to consider the local orientation of the slots on the CD-ROM. </font><font style="vertical-align: inherit;">Using the normal vector does not help, because all the slots have the same normal direction, perpendicular to the disk surface. </font><font style="vertical-align: inherit;">The local orientation of the slit can be determined using the tangent vector (left side of the upper image).</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7bb/255/245/7bb25524508b2a9636fc931262516eb2.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In the diagram above, the direction is normal. </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-521"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-522">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-73-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.064ex" height="2.057ex" viewBox="0 -780.1 888.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-4E" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-73"> N </script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> shown in blue, and the direction of the tangent </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-523"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-524">T</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-74-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.636ex" height="2.057ex" viewBox="0 -780.1 704.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-54" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-74"> T </script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- red. </font><font style="vertical-align: inherit;">The angles of the light source and the observer, formed with the direction of the normal</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-525"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-526">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-75-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.064ex" height="2.057ex" viewBox="0 -780.1 888.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-4E" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-75"> N </script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are called </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-527"><span class="MJXp-msubsup" id="MJXp-Span-528"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-529" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-530" style="vertical-align: -0.4em;">L</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-76-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.442ex" height="2.298ex" viewBox="0 -780.1 1051.4 989.6" role="img" focusable="false" style="vertical-align: -0.487ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-4C" x="663" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-76">\theta_L</script>  and <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-531"><span class="MJXp-msubsup" id="MJXp-Span-532"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-533" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-534" style="vertical-align: -0.4em;">V</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-77-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.586ex" height="2.419ex" viewBox="0 -780.1 1113.6 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-56" x="663" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-77">\theta_V</script>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Similar angles are relative </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-535"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-536">T</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-78-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.636ex" height="2.057ex" viewBox="0 -780.1 704.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-54" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-78"> T </script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - this </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-537"><span class="MJXp-msubsup" id="MJXp-Span-538"><span class="MJXp-mi" id="MJXp-Span-539" style="margin-right: 0.05em;">Œò</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-540" style="vertical-align: -0.4em;">L</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-79-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.16ex" height="2.298ex" viewBox="0 -780.1 1360.4 989.6" role="img" focusable="false" style="vertical-align: -0.487ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-398" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-4C" x="1100" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-79">\Theta_L</script>  and <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-541"><span class="MJXp-msubsup" id="MJXp-Span-542"><span class="MJXp-mi" id="MJXp-Span-543" style="margin-right: 0.05em;">Œò</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-544" style="vertical-align: -0.4em;">V</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-80-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.304ex" height="2.419ex" viewBox="0 -780.1 1422.6 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMAIN-398" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-56" x="1100" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-80">\Theta_V</script>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As stated above, when used in calculations </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-545"><span class="MJXp-msubsup" id="MJXp-Span-546"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-547" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-548" style="vertical-align: -0.4em;">L</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-81-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.442ex" height="2.298ex" viewBox="0 -780.1 1051.4 989.6" role="img" focusable="false" style="vertical-align: -0.487ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-4C" x="663" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-81">\theta_L</script>  and <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-549"><span class="MJXp-msubsup" id="MJXp-Span-550"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-551" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-552" style="vertical-align: -0.4em;">V</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-82-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.586ex" height="2.419ex" viewBox="0 -780.1 1113.6 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346852/&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhcxkcogNqgm4rF3yLqSUE4rPx07g#MJMATHI-56" x="663" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-82">\theta_V</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> we get a ‚Äúflat‚Äù reflection, because all the slots have the same </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-553"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-554">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-83-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-83"> N </script>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We need to find a way to use </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-555"><span class="MJXp-msubsup" id="MJXp-Span-556"><span class="MJXp-mi" id="MJXp-Span-557" style="margin-right: 0.05em;">Œò</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-558" style="vertical-align: -0.4em;">L</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-84-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-84">\Theta_L</script>  and <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-559"><span class="MJXp-msubsup" id="MJXp-Span-560"><span class="MJXp-mi" id="MJXp-Span-561" style="margin-right: 0.05em;">Œò</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-562" style="vertical-align: -0.4em;">V</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-85-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-85">\Theta_V</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, because they correctly correspond to local directions. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">While we know that:</font></font><br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-563"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-564">N</span><span class="MJXp-mo" id="MJXp-Span-565" style="margin-left: 0.267em; margin-right: 0.267em;">‚ãÖ</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-566">L</span><span class="MJXp-mo" id="MJXp-Span-567" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi" id="MJXp-Span-568">cos</span><span class="MJXp-mo" id="MJXp-Span-569" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-570"><span class="MJXp-msubsup" id="MJXp-Span-571"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-572" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-573" style="vertical-align: -0.4em;">L</span></span></span><span class="MJXp-mspace" id="MJXp-Span-574" style="width: 0.278em; height: 0em;"></span><span class="MJXp-mspace" id="MJXp-Span-575" style="width: 0.278em; height: 0em;"></span><span class="MJXp-mspace" id="MJXp-Span-576" style="width: 0.278em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-577">N</span><span class="MJXp-mo" id="MJXp-Span-578" style="margin-left: 0.267em; margin-right: 0.267em;">‚ãÖ</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-579">V</span><span class="MJXp-mo" id="MJXp-Span-580" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi" id="MJXp-Span-581">cos</span><span class="MJXp-mo" id="MJXp-Span-582" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-583"><span class="MJXp-msubsup" id="MJXp-Span-584"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-585" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-586" style="vertical-align: -0.4em;">V</span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-86-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-86">N \cdot L = \cos{\theta_L}\; \; \; N \cdot V = \cos{\theta_V}</script></p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-587"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-588">T</span><span class="MJXp-mo" id="MJXp-Span-589" style="margin-left: 0.267em; margin-right: 0.267em;">‚ãÖ</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-590">L</span><span class="MJXp-mo" id="MJXp-Span-591" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi" id="MJXp-Span-592">cos</span><span class="MJXp-mo" id="MJXp-Span-593" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-594"><span class="MJXp-msubsup" id="MJXp-Span-595"><span class="MJXp-mi" id="MJXp-Span-596" style="margin-right: 0.05em;">Œò</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-597" style="vertical-align: -0.4em;">L</span></span></span><span class="MJXp-mspace" id="MJXp-Span-598" style="width: 0.278em; height: 0em;"></span><span class="MJXp-mspace" id="MJXp-Span-599" style="width: 0.278em; height: 0em;"></span><span class="MJXp-mspace" id="MJXp-Span-600" style="width: 0.278em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-601">T</span><span class="MJXp-mo" id="MJXp-Span-602" style="margin-left: 0.267em; margin-right: 0.267em;">‚ãÖ</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-603">V</span><span class="MJXp-mo" id="MJXp-Span-604" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi" id="MJXp-Span-605">cos</span><span class="MJXp-mo" id="MJXp-Span-606" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-607"><span class="MJXp-msubsup" id="MJXp-Span-608"><span class="MJXp-mi" id="MJXp-Span-609" style="margin-right: 0.05em;">Œò</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-610" style="vertical-align: -0.4em;">V</span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-87-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-87">T \cdot L = \cos{\Theta_L}\; \; \;  T \cdot V = \cos{\Theta_V}</script></p><br>  Insofar as <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-611"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-612">T</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-88-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-88"> T </script>  and <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-613"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-614">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-89-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-89"> N </script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> perpendicular, they have the following property: </font></font><br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-615"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-616">T</span><span class="MJXp-mo" id="MJXp-Span-617" style="margin-left: 0.267em; margin-right: 0.267em;">‚ãÖ</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-618">L</span><span class="MJXp-mo" id="MJXp-Span-619" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi" id="MJXp-Span-620">cos</span><span class="MJXp-mo" id="MJXp-Span-621" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-622"><span class="MJXp-msubsup" id="MJXp-Span-623"><span class="MJXp-mi" id="MJXp-Span-624" style="margin-right: 0.05em;">Œò</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-625" style="vertical-align: -0.4em;">L</span></span></span><span class="MJXp-mo" id="MJXp-Span-626" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi" id="MJXp-Span-627">sin</span><span class="MJXp-mo" id="MJXp-Span-628" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-629"><span class="MJXp-msubsup" id="MJXp-Span-630"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-631" style="margin-right: 0.05em;">Œ∏</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-632" style="vertical-align: -0.4em;">L</span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-90-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-90">T \cdot L = \cos{\Theta_L} = \sin{\theta_L}</script></p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-633"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-634"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font></span><span class="MJXp-mo" id="MJXp-Span-635" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ãÖ </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-636"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V </font></font></span><span class="MJXp-mo" id="MJXp-Span-637" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><span class="MJXp-mi" id="MJXp-Span-638"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cos </font></font></span><font style="vertical-align: inherit;"><span class="MJXp-mrow" id="MJXp-Span-640"><span class="MJXp-msubsup" id="MJXp-Span-641"><span class="MJXp-mi" id="MJXp-Span-642" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">Œò </font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-640"><span class="MJXp-msubsup" id="MJXp-Span-641"><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-643" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;">V</font></span></span></span><span class="MJXp-mo" id="MJXp-Span-644" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"> = </font></span><span class="MJXp-mi" id="MJXp-Span-645"><font style="vertical-align: inherit;">sin </font></span><span class="MJXp-mrow" id="MJXp-Span-647"><span class="MJXp-msubsup" id="MJXp-Span-648"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-649" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">Œ∏ </font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-647"><span class="MJXp-msubsup" id="MJXp-Span-648"><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-650" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;">V</font></span></span></span></font><span class="MJXp-mo" id="MJXp-Span-639" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-640"><span class="MJXp-msubsup" id="MJXp-Span-641"><span class="MJXp-mi" id="MJXp-Span-642" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-643" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span></span><span class="MJXp-mo" id="MJXp-Span-644" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi" id="MJXp-Span-645"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mo" id="MJXp-Span-646" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-647"><span class="MJXp-msubsup" id="MJXp-Span-648"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-649" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-650" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-91-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-91">T \cdot V = \cos{\Theta_V} = \sin{\theta_V}</script></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is also very convenient because Cg provides a native implementation of the scalar product. </font><font style="vertical-align: inherit;">We only need to calculate</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-651"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-652"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-92-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-92"> T </script>  . <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Where does cosine come from?</font></font></b> <div class="spoiler_text">       :    1.       <strong> </strong> .  ,     ‚Äî  <strong> </strong> . <br><br>  ,         .    ,           .     . </div></div><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tangent vector calculation </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> To finish our shader, we need to calculate the tangent vector </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-653"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-654"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-93-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-93"> T </script>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usually it is indicated directly in the vertices of the mesh. However, considering how simple the CD-ROM surface is, we can calculate it on our own. It is worth considering that the approach shown in this tutorial is quite simple and will work only if the surface of the CD-ROM mesh has the correct UV scanning.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/698/0c4/610/6980c4610a95bda636b7ea4b75299017.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The diagram above shows how the directions of the tangents are calculated. </font><font style="vertical-align: inherit;">It is assumed that the surface of the disk is UV-unfolded as a quadrilateral with coordinates in the range from (0,0) to (1,1). </font><font style="vertical-align: inherit;">Knowing this, we reassign the coordinates of each point on the surface of the CD-ROM in the interval from (-1, -1) to (+ 1, + 1). </font><font style="vertical-align: inherit;">Taking this principle as a basis, we find that the new coordinate of the point also corresponds to the direction outward from the center (green arrow). </font><font style="vertical-align: inherit;">We can rotate this direction 90 degrees to find a vector that is tangent to the concentric tracks of the CD-ROM (shown in red).</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a7/a69/d81/5a7a69d81ca344fbbe10a22cd5370b59.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">These operations need to be performed as a </font></font><code>surf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shader, because UV coordinates are not available in the lighting function </font></font><code>LightingDiffraction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="hljs pgsql">// <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex: [ <span class="hljs-number"><span class="hljs-number">0</span></span>, +<span class="hljs-number"><span class="hljs-number">1</span></span>] // uv: [<span class="hljs-number"><span class="hljs-number">-1</span></span>, +<span class="hljs-number"><span class="hljs-number">1</span></span>] fixed2 uv = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex * <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; fixed2 uv_orthogonal = normalize(uv); fixed3 uv_tangent = fixed3(-uv_orthogonal.y, <span class="hljs-number"><span class="hljs-number">0</span></span>, uv_orthogonal.x);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It remains for us to only convert the computed tangent from </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the object space</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to the </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">world space</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">The transformation takes into account the position, rotation and scale of the object.</font></font><br><br><pre> <code class="hljs lisp">worldTangent = normalize( <span class="hljs-name"><span class="hljs-name">mul</span></span>(<span class="hljs-name"><span class="hljs-name">unity_ObjectToWorld</span></span>, float4(<span class="hljs-name"><span class="hljs-name">uv_tangent</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)) )<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How to transfer the direction of the tangent to the lighting function?</font></font></b> <div class="spoiler_text">       <code>LightingDiffraction</code> .      worldTangent,      <code>surf</code> .     ,        ,    . <br><br>     ,   :       .         .         <code>worldTangent</code> ,    <code>surf</code>    <code>LightingDiffraction</code> . </div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How to switch between coordinate spaces?</font></font></b> <div class="spoiler_text">   .      .                . <br><br>        ,      . ,   ,    ,   ,  <code>unity_ObjectToWorld</code> .      Unity,      <code>_Object2World</code> . </div></div><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We put everything together </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Now we have everything necessary to calculate the effect of color on iridiscent reflection: </font></font><br><br><pre> <code class="hljs bash">inline fixed4 LightingDiffraction(SurfaceOutputStandard s, fixed3 viewDir, UnityGI gi) { //   fixed4 pbr = LightingStandard(s, viewDir, gi); // ---    --- float3 L = gi.light.dir; float3 V = viewDir; float3 T = worldTangent; <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> d = _Distance; <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> cos_ThetaL = dot(L, T); <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> cos_ThetaV = dot(V, T); <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> u = abs(cos_ThetaL - cos_ThetaV); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (u == 0) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> pbr; //   fixed3 color = 0; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int n = 1; n &lt;= 8; n++) { <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> wavelength = u * d / n; color += spectral_zucconi6(wavelength); } color = saturate(color); //      pbr.rgb += color; <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> pbr; }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How does this relate to rainbow?</font></font></b> <div class="spoiler_text">  <code>wavelength</code> ,    for,    ,      . <br><br>       ( 400  700 )      .  ,        . <br><br>  ¬´ ¬ª  ,         . ,    ,  <code>spectral_zucconi6</code> .     ,      <a href="https://developer.nvidia.com/sites/all/modules/custom/gpugems/books/GPUGems/gpugems_ch08.html" rel="noopener">GPU Gems</a> . </div></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f82/3ef/134/f823ef13493d3ac5aaa77fccfb090563.gif"></div></div><p>Source: <a href="https://habr.com/ru/post/346852/">https://habr.com/ru/post/346852/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346838/index.html">10 most popular sites for the competition programmers at the beginning of 2018</a></li>
<li><a href="../346840/index.html">Seminar "Ecosystems for business. Application Performance in the Cloud, January 25, St. Petersburg</a></li>
<li><a href="../346844/index.html">blk-mq and I / O schedulers</a></li>
<li><a href="../346848/index.html">How to cache AVURLAsset data downloaded by AVPLayer</a></li>
<li><a href="../346850/index.html">More about validation in ASP.NET</a></li>
<li><a href="../346862/index.html">IPsec vs TLS / SRTP for VoIP Security</a></li>
<li><a href="../346864/index.html">Connect Fanvil phones to 3CX via L2TP tunnel on Mikrotik</a></li>
<li><a href="../346868/index.html">One-cloud - OS-level data center in Odnoklassniki</a></li>
<li><a href="../346870/index.html">How to replace the restaurant director with a robot?</a></li>
<li><a href="../346872/index.html">Things that cause mistrust and alienate your customers from the site</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>