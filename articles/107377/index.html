<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installing Gentoo on VDS with Virtuozzo Virtualization</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A little over a year ago, I started renting VDS from one company that uses Parallels Virtuozzo Containers with a very limited set of operating systems...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installing Gentoo on VDS with Virtuozzo Virtualization</h1><div class="post__text post__text-html js-mediator-article"><img src="http://www.gentoo.org/images/szbence-badge3.png"><img src="http://www.parallels.com/r/img/parallels-logo.gif"><br><br>  A little over a year ago, I started renting VDS from one company that uses <a href="http://www.parallels.com/de/products/pvc45/">Parallels Virtuozzo Containers</a> with a very limited set of operating systems (Debian, Fedora, Ubuntu, Suse, CentOS) for virtualization.  From the entire list to the soul does not lie very much, but still chose Debian, which I had to endure until recently.  This moment is finding <a href="http://log.onthebrink.de/2008/04/gentoo-on-1-vserver.html">the Gentoo installation methodology on VDS with this type of virtualization</a> . <a name="habracut"></a><br><br><h4>  So let's get started </h4><br>  The first thing that would not hurt to do is to make a back-up of existing data, if they are of any value.  This is done in the VZPP panel at your <a href="https://xn--__-6kcbbjcgfkdcb6jxajcgh9k/">server_address</a> 4643 /.  Further, in the same panel, we transfer VDS to recovery mode and after successful transfer we go via SSH to your VDS.  The old file system in recovery mode is in / repair.  First, copy the mtab file from there: <br><pre><code class="bash hljs">cp /repair/etc/mtab /root/mtab.old</code> </pre> <br>  If the old filesystem contains any data that needs to be transferred to the new system with Gentoo, we do: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /repair mkdir old <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> *; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> old != <span class="hljs-variable"><span class="hljs-variable">$i</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> mv <span class="hljs-variable"><span class="hljs-variable">$i</span></span> old/; <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br>  If there is no important data, then we just erase everything: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /repair rm -rf *</code> </pre> <br>  If suddenly / repair is available only for reading (I had OK, but the source mentions what happens and this), then before transferring / deleting we do: <br><pre> <code class="bash hljs">mount -o remount,rw /repair</code> </pre> <br>  Now everything is ready for downloading Gentoo: <br><pre> <code class="bash hljs">wget http://mirror.yandex.ru/gentoo-distfiles/releases/x86/current-stage3/stage3-i686-20101019.tar.bz2 wget http://mirror.yandex.ru/gentoo-distfiles/snapshots/portage-latest.tar.bz2 tar xvjpf stage3-*.tar.bz2 tar xvjf portage-*.tar.bz2 -C /repair/usr rm stage3-*.tar.bz2 portage-*.tar.bz2</code> </pre> <br>  Copy the DNS settings and return the mtab in place: <br><pre> <code class="bash hljs">cp /etc/resolv.conf /repair/etc/ cp /root/mtab.old /repair/etc/mtab</code> </pre> <br>  Everything is ready for chroot in Gentoo: <br><pre> <code class="bash hljs">mount -t proc proc /repair/proc/ mount -o <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span> /dev /repair/dev chroot /repair</code> </pre> <br>  Immediately change the root password: <br><pre> <code class="bash hljs">passwd</code> </pre> <br>  The new password will be valid not only for VDS, but also for the control panel.  I also copied my SSH key from the old file system.  The download will use baselayout + openrc, which you need to unmask and install (the baselayout will pull openrc itself): <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"sys-apps/baselayout ~x86"</span></span> &gt;&gt; /etc/portage/package.keywords <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"sys-apps/openrc ~x86"</span></span> &gt;&gt; /etc/portage/package.keywords emerge baselayout</code> </pre> <br>  Now configure the network: <br><pre> <code class="bash hljs">emerge iproute2 <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /etc/init.d rm net.eth0 ln -s net.lo net.venet0 rc-update add net.venet0 default</code> </pre> <br>  Also add the network configuration in /etc/conf.d/net: <br><pre> <code class="bash hljs">config_venet0=(<span class="hljs-string"><span class="hljs-string">"87.118.xz/24"</span></span> <span class="hljs-string"><span class="hljs-string">"87.118.yz/24"</span></span>) routes_venet0=(<span class="hljs-string"><span class="hljs-string">"191.255.255.0/24 scope link"</span></span> <span class="hljs-string"><span class="hljs-string">"default via 191.255.255.1"</span></span>)</code> </pre> <br>  And add sshd to autorun: <br><pre> <code class="bash hljs">rc-update add sshd default</code> </pre> <br>  According to my personal observations, the normal launch of VDS also requires the presence of the file / etc / network / interfaces (I previously had Debian, it is possible that the file name will differ for other distributions).  Virtuozzo apparently tries to write the current network configuration to it, and if it is impossible to start VDS, it ends with an error.  So that: <br><pre> <code class="bash hljs">mkdir /etc/network touch /etc/network/interfaces</code> </pre> <br>  Now you can finally try to reboot ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Source: <a href="http://log.onthebrink.de/2008/04/gentoo-on-1-vserver.html">http://log.onthebrink.de/2008/04/gentoo-on-1-vserver.html</a> </div><p>Source: <a href="https://habr.com/ru/post/107377/">https://habr.com/ru/post/107377/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../107366/index.html">In North Korea, released handheld</a></li>
<li><a href="../107369/index.html">Blitz review of professional monoblock 3D video camera Panasonic AG-3DA1</a></li>
<li><a href="../107371/index.html">Gyazo Pro - paid version</a></li>
<li><a href="../107372/index.html">Advanced shapes - multi select with autocomplete</a></li>
<li><a href="../107375/index.html">Skype buys GroupMe for $ 85 million</a></li>
<li><a href="../107378/index.html">Comparison of processor speeds for dedicated servers</a></li>
<li><a href="../107379/index.html">Now there will be ... iWear</a></li>
<li><a href="../107380/index.html">How to start work on a startup?</a></li>
<li><a href="../107383/index.html">Video from HighLoad ++ in Mail.Ru: what are you doing?</a></li>
<li><a href="../107386/index.html">The helicopter flew 12 hours on remote charging</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>