<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Take care of revision: code analysis automation techniques</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A code review is not some kind of formal measure, but an invaluable opportunity for novice programmers to quickly delve into the specifics of the proj...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Take care of revision: code analysis automation techniques</h1><div class="post__text post__text-html js-mediator-article">  A code review is not some kind of formal measure, but an invaluable opportunity for novice programmers to quickly delve into the specifics of the project.  But this stage is connected with the risks of hemorrhage in the eyes due to the amount of materials that the reviewers have to view and think over. <br><br>  In this article, we will tell you how to remove from reviewers such trivial, but important things as checking for compliance with the accepted style of writing code, compliance with agreements that are specific only for a specific project.  As an example, we will take the code of Android applications, but the technique can be used for any Java code. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gw/hi/sv/gwhisvxmgqtb3l9yjelymldhkva.jpeg" width="600"></div><a name="habracut"></a><br>  As the project grows, many agreements on the implementation of individual modules, instructions on the use of libraries, their own frameworks are accumulated.  Let us give examples of such agreements: <br><br><ul><li>  Resource management. <br></li></ul><br>  Open resource after use must be closed.  Otherwise, we get a leak of resources and related problems.  Many static analysis tools can do this checking for known resources.  Frequent resources are sockets, database connections, memory areas.  But you can add a check for your specific resources. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  The order of the function call in the method. <br></li></ul><br>  For example, in all methods where there is access to the database, before accessing it, you must call a specific audit function with the necessary parameters. <br><br><ul><li>  Agreement on the implementation of the heirs of abstract classes. <br></li></ul><br>  We know that both hashCode () and equals () in successor classes should always be overridden.  You may have similar agreements in your project.  Another example from this category is checking that the variables you expect are used in the overridden method.  This can be used to verify that the method is being used as intended. <br><br>  In fairness, we add that verification is another level of control of agreements.  Ideally, the application architecture should be such that it is difficult to break, but this is a topic for another article. <br><br>  We will check that the Android application uses one logger, ru.project.Logger, and also does not use the android.util.Log class.  This is necessary so that in the release application it was possible in one place to turn off the output to the log of security-sensitive information. <br><br><h2>  What will we check </h2><br>  The bad news is that popular <a href="http://findbugs.sourceforge.net/">FindBugs has</a> not developed since 2015.  Good - there is a <a href="https://spotbugs.github.io/">SpotBugs</a> : " <br><br>  How does he work?  The analyzer is sent to the input directory or selected file with bytecode.  Bytecode analysis uses the <a href="https://commons.apache.org/proper/commons-bcel/">Apache BCEL</a> library.  Direct checks are implemented in the successors of the Detector class.  A detector is a visitor that ‚Äúenters‚Äù classes, methods, and method code.  There are many heirs to this interface in the FindBugs code. <br><br><h2>  Setting up the environment for developing the FindBugs plugin </h2><br>  1. We extort the spotbugs code. <br>  <i><a href="">git clone</a></i> <br><br>  2. We collect the project <br>  <i>./gradlew distZip</i> <br><br>  3. Unpacking the distribution kit in the /spotbugs-4.0.0-SNAPSHOT directory <br>  To develop a plugin, we use the intellij idea community edition. <br><br>  4. Create a new java (gradle) application project. <br><br>  5. We adjusted dependences.  Copy the spotbugs.jar file to the project / libs directory. <br><br><pre><code class="java hljs">build.gradle  dependencies {   <span class="hljs-function"><span class="hljs-function">compile </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fileTree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dir: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'libs'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, include: [</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'*.jar'</span></span></span></span><span class="hljs-function"><span class="hljs-params">])</span></span></span><span class="hljs-function">   compile 'org.apache.bcel:bcel:6.1' }</span></span></code> </pre> <br><h2>  What is the plugin </h2><br>  <b>Findbugs.xml</b> file - plugin description <br><br><pre> <code class="java hljs">&lt;FindbugsPlugin xmlns:xsi=<span class="hljs-string"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span> xsi:noNamespaceSchemaLocation=<span class="hljs-string"><span class="hljs-string">"https://findbugs.googlecode.com/svn-history/r13379/trunk/findbugs/etc/findbugsplugin.xsd"</span></span>              pluginid=<span class="hljs-string"><span class="hljs-string">"ru.sberbank.android.log.plugin"</span></span>              provider=<span class="hljs-string"><span class="hljs-string">"Find Android.Util.Log class"</span></span>              defaultenabled=<span class="hljs-string"><span class="hljs-string">"true"</span></span>              website=<span class="hljs-string"><span class="hljs-string">"https://find-sec-bugs.github.io"</span></span>&gt;  &lt;Detector <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"ru.sbt.detector.AndroidLogCallDetector"</span></span>/&gt;  &lt;BugPattern type=<span class="hljs-string"><span class="hljs-string">"ANDROID_LOG_CALL_DETECTED"</span></span> abbrev=<span class="hljs-string"><span class="hljs-string">"ANDR_LOG"</span></span> category=<span class="hljs-string"><span class="hljs-string">"CORRECTNESS"</span></span>/&gt; &lt;/FindbugsPlugin&gt;</code> </pre> <br>  Files <b>Messages.xml</b> - found bug message template <br><br><pre> <code class="java hljs">&lt;MessageCollection&gt;  &lt;Detector <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"ru.sbt.detector.AndroidLogCallDetector"</span></span>&gt;      &lt;Details&gt;ANDROID_LOG_CALL_DETECTED alala.&lt;/Details&gt;  &lt;/Detector&gt;  &lt;BugPattern type=<span class="hljs-string"><span class="hljs-string">"ANDROID_LOG_CALL_DETECTED"</span></span>&gt;      &lt;ShortDescription&gt;android.util.Log usage detected !&lt;/ShortDescription&gt;      &lt;LongDescription&gt;android.util.Log usage detected !&lt;/LongDescription&gt;      &lt;Details&gt;          &lt;![CDATA[      &lt;p&gt; Please not use android.util.Log ! Use <span class="hljs-string"><span class="hljs-string">'ru.sberbank.mobile.core.log.Logger'</span></span> instead.    ]]&gt;      &lt;/Details&gt;  &lt;/BugPattern&gt;  &lt;BugCode abbrev=<span class="hljs-string"><span class="hljs-string">"ANDR_LOG"</span></span>&gt;android.util.Log usage detected !&lt;/BugCode&gt; &lt;/MessageCollection&gt;</code> </pre> <br><h2>  Custom Detector Code </h2><br>  Recall that the detector works with bytecode.  To understand the detector's work, let us present a part of the bytecode of the onCreate () Activity method, where Lod.d is called (‚Äúaaa‚Äù, ‚Äúbbb‚Äù); <br><br><pre> <code class="java hljs">javap -c LoginActivity.class Compiled from <span class="hljs-string"><span class="hljs-string">"LoginActivity.java"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ru</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sbrf</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">testandroidapp</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">android</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">support</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">v7</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">android</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoaderManager</span></span></span><span class="hljs-class">$</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoaderCallbacks</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">android</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">database</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cursor</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ru.sbrf.testandroidapp.LoginActivity(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(android.os.Bundle)</span></span></span></span>;   Code:      <span class="hljs-number"><span class="hljs-number">0</span></span>: aload_0      <span class="hljs-number"><span class="hljs-number">1</span></span>: aload_1      <span class="hljs-number"><span class="hljs-number">2</span></span>: invokespecial #<span class="hljs-number"><span class="hljs-number">10</span></span>                 <span class="hljs-comment"><span class="hljs-comment">// Method android/support/v7/app/AppCompatActivity.onCreate:(Landroid/os/Bundle;)V      5: ldc           #11                 // String aaa      7: ldc           #12                 // String bbb 9: invokestatic  #13                 // Method    android/util/Log.d:(Ljava/lang/String;Ljava/lang/String;)I     12: pop     13: aload_0     14: ldc           #15                 // int 2130968603     16: invokevirtual #16                 // Method setContentView:(I)V</span></span></code> </pre> <br>  Line 9 will search for our detector.  This is a static method call in the android.util.Log class. <br><br><h3>  Detector code </h3><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AndroidLogCallDetector</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BytecodeScanningDetector</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StatelessDetector</span></span></span><span class="hljs-class"> </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String BUG_TYPE = <span class="hljs-string"><span class="hljs-string">"ANDROID_LOG_CALL_DETECTED"</span></span>;  <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String ANDROID_UTIL_LOG = <span class="hljs-string"><span class="hljs-string">"android/util/Log"</span></span>;  <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String ALLOWED_LOGER_CLASS = <span class="hljs-string"><span class="hljs-string">"ru.sberbank.mobile.core.log.Logger"</span></span>;  <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> BugReporter bugReporter;  <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String clsName;  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AndroidLogCallDetector</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BugReporter bugReporter)</span></span></span><span class="hljs-function"> </span></span>{      <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bugReporter = bugReporter;  }  <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visitClassContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ClassContext classContext)</span></span></span><span class="hljs-function"> </span></span>{      JavaClass cls = classContext.getJavaClass();      clsName = cls.getClassName();      <span class="hljs-comment"><span class="hljs-comment">//skip allowed logger class      if (!ALLOWED_LOGER_CLASS.equals(clsName)) {          super.visitClassContext(classContext);      }  }  @Override  public void sawOpcode(int seen) {      if (seen == Const.INVOKESTATIC &amp;&amp; ANDROID_UTIL_LOG.equals(getClassConstantOperand())) {      BugInstance bug = new BugInstance(this, BUG_TYPE, NORMAL_PRIORITY).addClassAndMethod(this)                  .addSourceLine(this);          bugReporter.reportBug(bug);      }  } }</span></span></code> </pre><br>  We assemble the plugin: <br><br><pre> <code class="java hljs"> ./gradlew jar</code> </pre> <br><h2>  Testing </h2><br>  Copy the file of the plugin detector-1.0-SNAPSHOT.jar in /spotbugs-4.0.0-SNAPSHOT/plugin.  Run ui interface spotbugs /spotbugs-4.0.0-SNAPSHOT/bin/spotbugs.  Select the bytecode directory of the test android project for verification.  / TestAndroidApp / app / build / intermediates / classes / debug <br><br><img src="https://habrastorage.org/getpro/habr/post_images/65a/436/034/65a4360343a2bb162d2017bcfcb234ae.png"><br><br>  As you can see, there were all calls to the android.util.Log class.  Now our custom detector can be used in the CI system.  He will inform the developer about the bugs found. <br><br><h2>  Code Style Check </h2><br>  Now we will free the reviewer from checking the code for compliance with the code-style.  For this we will use the <a href="http://checkstyle.sourceforge.net/">Checkstyle plugin</a> .  To him, by the way, is attached a list of all the checks that have already been implemented, <a href="http://checkstyle.sourceforge.net/checks.html">is here</a> . <br><br>  Plugin is configured using the <b>checkstyle.xml</b> configuration file.  It indicates the necessary checks and their parameters.  We give examples of the file for the following checks: <br><br><ul><li>  java doc for public methods <br></li><li>  class order (fields, methods) <br></li><li>  variable modifier order <br></li><li>  presence of magic numbers <br></li><li>  binding {} in if <br></li><li>  default branch switch <br></li><li>  hashcode and equals pair and covariance <br></li></ul><br><br><pre> <code class="java hljs">&lt;i&gt;&lt;?&lt;/i&gt;xml version=<span class="hljs-string"><span class="hljs-string">"1.0"</span></span>&lt;i&gt;?&gt;&lt;/i&gt; &lt;!DOCTYPE <span class="hljs-keyword"><span class="hljs-keyword">module</span></span> PUBLIC  <span class="hljs-string"><span class="hljs-string">"Check Configuration"</span></span>  <span class="hljs-string"><span class="hljs-string">"http://checkstyle.sourceforge.net/dtds/configuration_1_3.dtd"</span></span>&lt;i&gt;&gt;&lt;/i&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">module</span></span> name=<span class="hljs-string"><span class="hljs-string">"Checker"</span></span>&gt;  &lt;property name=<span class="hljs-string"><span class="hljs-string">"charset"</span></span> value=<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span> /&gt;  &lt;property name=<span class="hljs-string"><span class="hljs-string">"severity"</span></span> value=<span class="hljs-string"><span class="hljs-string">"warning"</span></span> /&gt;  &lt;<span class="hljs-keyword"><span class="hljs-keyword">module</span></span> name=<span class="hljs-string"><span class="hljs-string">"TreeWalker"</span></span>&gt;      &lt;<span class="hljs-keyword"><span class="hljs-keyword">module</span></span> name=<span class="hljs-string"><span class="hljs-string">"EqualsHashCode"</span></span> /&gt;      &lt;<span class="hljs-keyword"><span class="hljs-keyword">module</span></span> name=<span class="hljs-string"><span class="hljs-string">"CovariantEquals"</span></span> /&gt;      &lt;<span class="hljs-keyword"><span class="hljs-keyword">module</span></span> name=<span class="hljs-string"><span class="hljs-string">"MagicNumber"</span></span> /&gt;      &lt;<span class="hljs-keyword"><span class="hljs-keyword">module</span></span> name=<span class="hljs-string"><span class="hljs-string">"DeclarationOrder"</span></span> /&gt;      &lt;<span class="hljs-keyword"><span class="hljs-keyword">module</span></span> name=<span class="hljs-string"><span class="hljs-string">"JavadocMethod"</span></span>&gt;          &lt;property name=<span class="hljs-string"><span class="hljs-string">"scope"</span></span> value=<span class="hljs-string"><span class="hljs-string">"public"</span></span> /&gt;          &lt;property name=<span class="hljs-string"><span class="hljs-string">"allowMissingParamTags"</span></span> value=<span class="hljs-string"><span class="hljs-string">"true"</span></span> /&gt;          &lt;property name=<span class="hljs-string"><span class="hljs-string">"allowMissingThrowsTags"</span></span> value=<span class="hljs-string"><span class="hljs-string">"true"</span></span> /&gt;          &lt;property name=<span class="hljs-string"><span class="hljs-string">"allowMissingReturnTag"</span></span> value=<span class="hljs-string"><span class="hljs-string">"true"</span></span> /&gt;          &lt;property name=<span class="hljs-string"><span class="hljs-string">"allowThrowsTagsForSubclasses"</span></span> value=<span class="hljs-string"><span class="hljs-string">"true"</span></span> /&gt;      &lt;/<span class="hljs-keyword"><span class="hljs-keyword">module</span></span>&gt;      &lt;<span class="hljs-keyword"><span class="hljs-keyword">module</span></span> name=<span class="hljs-string"><span class="hljs-string">"LineLength"</span></span>&gt;          &lt;property name=<span class="hljs-string"><span class="hljs-string">"max"</span></span> value=<span class="hljs-string"><span class="hljs-string">"160"</span></span> /&gt;          &lt;property name=<span class="hljs-string"><span class="hljs-string">"ignorePattern"</span></span>              value=<span class="hljs-string"><span class="hljs-string">"^package.*|^import.*|a href|href|http://|https://|ftp://"</span></span> /&gt;      &lt;/<span class="hljs-keyword"><span class="hljs-keyword">module</span></span>&gt;      &lt;<span class="hljs-keyword"><span class="hljs-keyword">module</span></span> name=<span class="hljs-string"><span class="hljs-string">"EmptyBlock"</span></span>&gt;          &lt;property name=<span class="hljs-string"><span class="hljs-string">"option"</span></span> value=<span class="hljs-string"><span class="hljs-string">"TEXT"</span></span> /&gt;          &lt;property name=<span class="hljs-string"><span class="hljs-string">"tokens"</span></span>              value=<span class="hljs-string"><span class="hljs-string">"LITERAL_TRY, LITERAL_FINALLY, LITERAL_IF, LITERAL_ELSE, LITERAL_SWITCH"</span></span> /&gt;      &lt;/<span class="hljs-keyword"><span class="hljs-keyword">module</span></span>&gt;      &lt;<span class="hljs-keyword"><span class="hljs-keyword">module</span></span> name=<span class="hljs-string"><span class="hljs-string">"NeedBraces"</span></span> /&gt;      &lt;<span class="hljs-keyword"><span class="hljs-keyword">module</span></span> name=<span class="hljs-string"><span class="hljs-string">"MissingSwitchDefault"</span></span> /&gt;      &lt;<span class="hljs-keyword"><span class="hljs-keyword">module</span></span> name=<span class="hljs-string"><span class="hljs-string">"ModifierOrder"</span></span> /&gt;      &lt;<span class="hljs-keyword"><span class="hljs-keyword">module</span></span> name=<span class="hljs-string"><span class="hljs-string">"OverloadMethodsDeclarationOrder"</span></span> /&gt;  &lt;/<span class="hljs-keyword"><span class="hljs-keyword">module</span></span>&gt; &lt;/<span class="hljs-keyword"><span class="hljs-keyword">module</span></span>&gt;</code> </pre><br>  A set of ready-made rules and the ability to configure them allow you to check almost any requirements.  But if you need to create your own special rule, this can also be done <a href="http://checkstyle.sourceforge.net/writingchecks.html">according to the instructions</a> . <br><br>  Note that Checkstyle works with the source code of the project, the analysis of which was done using <a href="http://www.antlr.org/">ANTLR</a> .  To implement the verification, you must implement the visitor, which is traversed through the syntax tree of the source code.  In this article we will not consider the creation of a custom code-style check. <br><br><h2>  Add checkstyle plugin to android application </h2><br>  Add lines to build.gradle <br><br><pre> <code class="java hljs">apply plugin: <span class="hljs-string"><span class="hljs-string">'checkstyle'</span></span> <span class="hljs-function"><span class="hljs-function">task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkstyle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: Checkstyle)</span></span></span><span class="hljs-function"> </span></span>{  <span class="hljs-function"><span class="hljs-function">configFile </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">file</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"$project.rootDir/app/checkstyle.xml"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">  source 'src/main/java'  include '**</span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">/*.java'  exclude '**/</span></span></span><span class="hljs-function">gen</span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">/**'  exclude '**/</span></span></span><span class="hljs-function">R.java'  exclude '**/BuildConfig.java'  classpath </span></span>= files() } tasks.withType(Checkstyle) {  reports {      xml.enabled <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>      html.enabled <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>  } }</code> </pre><br>  Run the check <b>./gradlew checkstyle.</b> <br>  The report will be in the <b>/build/reports/checkstyle/checkstyle.html</b> directory.  Here is an example report. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c87/d91/e0c/c87d91e0c887e6d354004e7edcd68ca1.png"><br><br>  But the code that was checked <br><br><pre> <code class="java hljs"><span class="hljs-number"><span class="hljs-number">20</span></span>     <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-number"><span class="hljs-number">21</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) Log.&lt;i&gt;i&lt;/i&gt;(<span class="hljs-string"><span class="hljs-string">"a"</span></span>,<span class="hljs-string"><span class="hljs-string">"b"</span></span>); <span class="hljs-number"><span class="hljs-number">22</span></span>      <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">43.2</span></span>*<span class="hljs-number"><span class="hljs-number">15.0</span></span>; <span class="hljs-number"><span class="hljs-number">23</span></span>    }</code> </pre> <br>  So, we have freed revisers from the routine work - checking the code-style and checking the project agreements.  Now developers will have more time for creativity, and the code will become better.  We hope the material was useful, we will be happy to answer your questions in the comments. </div><p>Source: <a href="https://habr.com/ru/post/342634/">https://habr.com/ru/post/342634/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../342620/index.html">Hello Logify, or monitor errors on installed applications</a></li>
<li><a href="../342624/index.html">About PVS-Studio on the eve of the open conference of the ISP RAS. V.P. Ivannikova</a></li>
<li><a href="../342626/index.html">Results hackathon HR-hack</a></li>
<li><a href="../342628/index.html">Tutu.ru: How to spend the IT Day on their own and inexpensively</a></li>
<li><a href="../342632/index.html">Optimize the speed of rendering web pages</a></li>
<li><a href="../342636/index.html">From Kotlin to whip: how did Mobius 2017 Moscow go</a></li>
<li><a href="../342638/index.html">How we created a new type of tariff "Turn on"</a></li>
<li><a href="../342640/index.html">Configuring Minio and Nginx for the RoR application</a></li>
<li><a href="../342644/index.html">Gorgeous assholes in the making</a></li>
<li><a href="../342654/index.html">Self-oscillations and resonance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>