<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Meet Dependency Injection with the Dagger example</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article we will try to deal with Dependency Injection in Android (and not only) using the example of the increasingly popular open source libr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Meet Dependency Injection with the Dagger example</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/918/5e7/be2/9185e7be2da8686fd9431260d20a5e9e.png" align="left" alt="http://radiant--eclipse.deviantart.com/"><br>  In this article we will try to deal with Dependency Injection in Android (and not only) using the example of the increasingly popular open source library <a href="http://square.github.io/dagger/">Dagger</a> <br>  So what is Dependency Injection?  According to Wikipedia, this is a design pattern that allows you to dynamically describe dependencies in code, dividing business logic into smaller blocks.  This is convenient, first of all, by the fact that later these same blocks can be replaced by test ones, thereby limiting the testing area. <br><br>  Despite the sophisticated definition, the principle is quite simple and trivial.  I am sure that most of the programmers somehow implemented this pattern, even sometimes without realizing it. <br><br>  Consider a simplified (before pseudocode) version of the Twitter client. <br><a name="habracut"></a><br>  In theory, the dependency diagram looks like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/a7f/bf2/ba3/a7fbf2ba3cfebb1b28a8cdc7b13b5418.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's take a look at how this looks in code: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tweeter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tweet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String tweet)</span></span></span><span class="hljs-function"> </span></span>{ TwitterApi api = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TwitterApi(); api.postTweet(<span class="hljs-string"><span class="hljs-string">"Test User"</span></span>, tweet); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TwitterApi</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postTweet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String user, String tweet)</span></span></span><span class="hljs-function"> </span></span>{ HttpClient client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OkHttpClient(); HttpUrlConnection connection = client.open(<span class="hljs-string"><span class="hljs-string">"...."</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* post tweet */</span></span> } }</code> </pre> <br><br>  As you can see, the set of interfaces is quite simple, so we will use it like this: <br><br><pre> <code class="java hljs">Tweeter tweeter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Tweeter(); tweeter.tweet(<span class="hljs-string"><span class="hljs-string">"Hello world!"</span></span>);</code> </pre><br><br>  As long as everything goes well, tweets fly away - everyone is happy.  Now there is a need to test it all.  Immediately, we note that it would be nice to be able to replace the Http client with the test one in order to return some test result and not break into the network every time.  In this case, we need to remove the obligation to create the Http client from the TwitterApi class and download this duty to the higher classes.  Our code is slightly transformed: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tweeter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TwitterApi api; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tweeter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpClient httpClient)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.api = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TwitterApi(httpClient); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tweet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String tweet)</span></span></span><span class="hljs-function"> </span></span>{ api.postTweet(<span class="hljs-string"><span class="hljs-string">"Test User"</span></span>, tweet); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TwitterApi</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> HttpClient client; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TwitterApi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpClient client)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.client = client; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postTweet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String user, String tweet)</span></span></span><span class="hljs-function"> </span></span>{ HttpUrlConnection connection = client.open(<span class="hljs-string"><span class="hljs-string">"...."</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* post tweet */</span></span> } }</code> </pre><br><br>  Now we see that, if necessary, to test our code, we can easily ‚Äúsubstitute‚Äù the test Http client, which will return test results: <br><pre> <code class="java hljs">Tweeter tweeter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Tweeter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MockHttpClient); tweeter.tweet(<span class="hljs-string"><span class="hljs-string">"Hello world!"</span></span>);</code> </pre><br><br>  It would seem, what could be easier?  In fact, now we have ‚Äúmanually‚Äù implemented the Dependency Injection pattern.  But there is one "but."  Imagine a situation that we have a class Timeline, which can download the last n messages.  This class also uses TwitterApi: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7fe/854/27c/7fe85427ce5ef84bdc3637ecbc0d39b7.png"><br><br><pre> <code class="java hljs">Timeline timeline = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Timeline(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OkHttpClient(), <span class="hljs-string"><span class="hljs-string">"Test User"</span></span>); timeline.loadMore(<span class="hljs-number"><span class="hljs-number">20</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(Tweet tweet: timeline.get()) { System.out.println(tweet); }</code> </pre><br><br>  Our class looks like this: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Timeline</span></span></span><span class="hljs-class"> </span></span>{ String user; TweeterApi api; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Timeline</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpClient httpClient, String user)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.user = user; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.api = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TweeterApi(httpClient); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadMore</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span></span>{<span class="hljs-comment"><span class="hljs-comment">/*.....*/</span></span>} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Tweet&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{<span class="hljs-comment"><span class="hljs-comment">/*.......*/</span></span>} }</code> </pre><br><br>  It seems that everything is nothing - we used the same approach as with the Tweeter class - provided an opportunity to specify the Http client when creating the object, which allows us to test this module without depending on the network.  But!  Have you noticed how much code we have duplicated and how do we have to ‚Äúdrag‚Äù the Http client right from the application‚Äôs head?  Of course, you can add default constructors that will create a real Http client, and use the custom constructor only when testing, but this does not solve the problem, but only masks it. <br><br>  Let's look at how we can improve the situation. <br><br><h4>  Dagger </h4><br><br>  Dagger is an open source Dependency Injection library from the developers of okhttp, retrofit, picasso, and many other great libraries known to many Android developers. <br><br>  The main advantages of Dagger (compared to the same Guice): <br><ul><li>  Static analysis of all dependencies </li><li>  Identifying configuration errors at compile time (not only at runtime) </li><li>  Absence of reflection, which significantly speeds up the configuration process. </li><li>  A rather small memory load. </li></ul><br><br>  In Dagger, the dependency configuration process is divided into 3 large blocks: <br><ul><li>  initialization of the graph of zavizimosti (ObjectGraph) </li><li>  dependency query ( <code>@Inject</code> ) </li><li>  dependency satisfaction ( <code>@Module</code> / <code>@Provides</code> ) </li></ul><br><br><h5>  Request dependencies </h5><br><br>  To ask Dagger to initialize one of the fields, all you need to do is add the <code>@Inject</code> annotation: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> HttpClient client;</code> </pre><br><br>  ... and make sure that this class is added to the dependency graph (more on that later) <br><br><h5>  Dependency satisfaction (provide dependency) </h5><br><br>  To tell Dagger what client instance you need to create, you need to create a ‚Äúmodule‚Äù - annotated class <code>@Module</code> : <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Module</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NetworkModule</span></span></span></span>{...}</code> </pre><br><br>  This class is responsible for ‚Äúsatisfying‚Äù some of the dependencies requested by the application.  In this class, you need to create a so-called "provider" - a method that returns the HttpClient instance (annotated <code>@Provide</code> ): <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Module</span></span>(injects=TwitterApi.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NetworkModule</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-meta"><span class="hljs-meta">@Singleton</span></span> <span class="hljs-function"><span class="hljs-function">HttpClient </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">provideHttpClient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OkHttpClient(); } }</code> </pre><br><br>  So we told Dagger to create an OkHttpClient for anyone who asked for HttpClient using <code>@Inject</code> annotation <br><br>  It is worth mentioning that in order for compile-time validation to work, you must specify all the classes (in the injects parameter) that request this dependency.  In our case, HttpClient is only needed for TwitterApi class. <br>  The <code>@Singleton</code> tells Dagger to create only 1 client instance and cache it. <br><br><h5>  Creating a graph </h5><br><br>  We now turn to the creation of the graph.  For this, I created a class <code>Injector</code> , which initializes the graph with one (or more) module.  In the context of Android applications, it is most convenient to do this when creating an application (inherit from Application and overload <code>onCreate()</code> ).  In this example, I created a TweeterApp class that contains the other components (Tweeter and Timeline) <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Injector</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> ObjectGraph graph; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object... modules)</span></span></span><span class="hljs-function"> </span></span>{ graph = ObjectGraph.create(modules); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object target)</span></span></span><span class="hljs-function"> </span></span>{ graph.inject(target); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TweeterApp</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String... args)</span></span></span><span class="hljs-function"> </span></span>{ Injector.init(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NetworkModule()); Tweeter tweeter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Tweeter(); tweeter.tweet(<span class="hljs-string"><span class="hljs-string">"Hello world"</span></span>); Timeline timeline = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Timeline(<span class="hljs-string"><span class="hljs-string">"Test User"</span></span>); timeline.loadMore(<span class="hljs-number"><span class="hljs-number">20</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(Tweet tweet: timeline.get()) { System.out.println(tweet); } } }</code> </pre><br><br>  Now back to the dependency query: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TwitterApi</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> HttpClient client; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TwitterApi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     Injector.inject(this); //   ""  client  Dagger' } public void postTweet(String user, String tweet) { HttpUrlConnection connection = client.open("...."); /* post tweet */ } }</span></span></code> </pre><br><br>  Notice <code>Injector.inject(Object)</code> .  This is necessary in order to add a class to the dependency graph.  Those.  if we have at least one <code>@Inject</code> in the class - we need to add this class to the graph.  As a result, in our graph there should be all classes that request dependencies (each of these classes should make <code>ObjectGraph.inject()</code> ) + modules that satisfy these dependencies (usually added at the stage of graph initialization). <br><br>  Now back to our original task - to test everything.  We need to somehow be able to replace HttStack.  The module NetworkModule is responsible for satisfying this dependency (hmm - just now noticed how interesting it sounds): <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-meta"><span class="hljs-meta">@Singleton</span></span> <span class="hljs-function"><span class="hljs-function">HttpClient </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">provideHttpClient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OkHttpClient(); }</code> </pre><br><br>  One option is to add some configuration file that will dictate which environment to use: <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-meta"><span class="hljs-meta">@Singleton</span></span> <span class="hljs-function"><span class="hljs-function">HttpClient </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">provideHttpClient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Config.isDebugMode()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MockHttpClient(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OkHttpClient(); }</code> </pre><br><br>  But there is an even more elegant option.  In Dagger, you can create modules that override functions that provide dependencies.  To do this, add the parameter <code>overrides=true</code> to the module: <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Module</span></span>(overrides=<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, injects=TwitterApi.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MockNetworkModule</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-meta"><span class="hljs-meta">@Singleton</span></span> <span class="hljs-function"><span class="hljs-function">HttpClient </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">provideHttpClient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MockHttpClient(); } }</code> </pre><br><br>  All that remains to be done is to add this module to the graph during the initialization stage: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TweeterApp</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String... args)</span></span></span><span class="hljs-function"> </span></span>{ Injector.init(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NetworkModule(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MockNetworkModule()); Tweeter tweeter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Tweeter(); tweeter.tweet(<span class="hljs-string"><span class="hljs-string">"Hello world"</span></span>); Timeline timeline = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Timeline(<span class="hljs-string"><span class="hljs-string">"Test User"</span></span>); timeline.loadMore(<span class="hljs-number"><span class="hljs-number">20</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(Tweet tweet: timeline.get()) { System.out.println(tweet); } } }</code> </pre><br><br>  Now all our requests will go through the test Http client. <br><br>  This is not all the features of Dagger'a - I described only one of the possible scenarios for using this library.  In any case, a thoughtful reading of the documentation is indispensable. <br><br><div class="spoiler">  <b class="spoiler_title">This is what happened in the end (the same as above, but collected in a heap)</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//Entry point   public class TweeterApp { public static void main(String... args) { Injector.init(new NetworkModule()); Tweeter tweeter = new Tweeter(); tweeter.tweet("Hello world"); Timeline timeline = new Timeline("Test User"); timeline.loadMore(20); for(Tweet tweet: timeline.get()) { System.out.println(tweet); } } } //  public class Injector { public static ObjectGraph graph; public static void init(Object... modules) { graph = ObjectGraph.create(modules); } public static void inject(Object target) { graph.inject(target); } } //, Tweeter (   HttpClient  ) public class Tweeter { private TwitterApi api; public Tweeter() { this.api = new TwitterApi(); } public void tweet(String tweet) { api.postTweet("Test User", tweet); } } //TwitterApi,   HttpClient  Dagger'a public class TwitterApi { @Inject private HttpClient client; public TwitterApi() { //     Injector.inject(this); //   ""  client  Dagger' } public void postTweet(String user, String tweet) { HttpUrlConnection connection = client.open("...."); /* post tweet */ } } //,   HttpClient ,     ( ""   'injects' ) @Module(injects=TwitterApi.class) public class NetworkModule { @Provides @Singleton HttpClient provideHttpClient() { return new OkHttpClient(); } }</span></span></code> </pre><br></div></div><br><br><h5>  <b>List of useful materials on the topic:</b> </h5><br><ul><li>  <a href="http://en.wikipedia.org/wiki/Dependency_injection">General description of Dependency Injection</a> </li><li>  <a href="http://square.github.io/dagger/">Official site of the project</a> </li><li>  <a href="http://www.youtube.com/watch%3Fv%3D3mGf6b6JF00">Google Hangout video with library developers</a> </li><li>  <a href="">My little example of using the library on github</a> </li><li>  <a href="https://speakerdeck.com/jakewharton/android-apps-with-dagger">Slides from Jake Wharton presentation at the Devoxx conference</a> (he promised to post the video later) </li></ul></div><p>Source: <a href="https://habr.com/ru/post/202866/">https://habr.com/ru/post/202866/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../202854/index.html">Overview of expansion boards of the communication platform Aastra A400 (A470)</a></li>
<li><a href="../202856/index.html">Managerial tools: 16 concepts for each day</a></li>
<li><a href="../202858/index.html">Create a galaxy in 30 lines.</a></li>
<li><a href="../202860/index.html">Another Tetris on JS (~ 30 "conditional" lines)</a></li>
<li><a href="../202864/index.html">Minimize apps to dock for lazy using AppleScript</a></li>
<li><a href="../202868/index.html">Testing: a clear career choice</a></li>
<li><a href="../202870/index.html">Automate subtitle uploading from * .mkv files</a></li>
<li><a href="../202874/index.html">Tiny Tron on JS (30 lines of code)</a></li>
<li><a href="../202876/index.html">Upgrading Nexus 4 to Android 4.4 on Linux</a></li>
<li><a href="../202878/index.html">What do bad security managers do?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>