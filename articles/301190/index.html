<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We control the computer from an Android device</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Start 
 It all started with the fact that the general calls me to him and says: ‚ÄúYou see the phone? I want a button there, I click on it, and the cine...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We control the computer from an Android device</h1><div class="post__text post__text-html js-mediator-article"><h3>  Start </h3><br>  It all started with the fact that the general calls me to him and says: ‚ÄúYou see the phone?  I want a button there, I click on it, and the cinema turns on in my laptop.  I press another - the music is playing. ‚ÄùAnd I also said a lot of things, I don‚Äôt remember.  ‚ÄúThe task is clear?  Do it! ‚ÄùI really don't know why he had such a need.  Either the stars did not stand at that angle, or a dream dreamed up.  In short, you will not understand these rich ... Well, okay. <br><br>  At first it was useful to rummage through Google in search of a suitable program, and then I thought - what the hell?  I will write myself.  Moreover, the task did not seem complicated, and the ‚Äúcall of the code‚Äù had already made itself felt (a sort of professional it-breaking).  So I decided to connect Windows and Android on my own. <br><a name="habracut"></a><br>  What he asked for, I did in a couple of days.  But here I do not want to fence a lot of code, checks and exception handling, etc.  The article is rather intended for the smallest, as a basis, based on which you can build something more ambitious.  In no case do I claim to originality, obviously someone wrote something like this, I just offer my version.  In general, everyone who is interested is dedicated. <br><br><h3>  What we have </h3><br>  It means so.  On the one hand, we have an Android phone on board, on the other hand, Windows with installed programs, and we need to launch some of these programs by issuing a command from the phone. <br>  We will connect the phone and the computer through a local network, here there are no options (well, do not send sms).  Thus, we will write two programs.  The first is a server running on a computer, the task of this program is to open and listen to the port.  If something useful falls on this port, then perform the action we have specified.  The second program is a client running on the phone, its task is to process the user's actions, connect to the server and transfer information. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Little about sockets </h3><br>  The theme of socket programming is already hackneyed, and there is nothing much to say.  But still in a nutshell, for those who do not like to follow links. <br><br>  A socket is a software interface that allows communication between two processes using the tcp / ip protocol.  The socket is associated with two aspects: ip-address and port.  Where the ip-address is the address of the host (computer) on the network, the IP protocol works with it.  Port is the identifier of the application to which the connection is addressed, TCP works here.  The port can be both TCP and UDP, in this article I will only use TCP.  Since the ip-address is unique both on the Internet and on the local network, it uniquely identifies the sender's address and the address of the recipient.  The port is unique within the operating system, it defines the application with which we want to interact.  Ports can be standard, for example, 80 is assigned to HTTP, or 3389 - RDP.  You can use any unused port, but the standard is better not to touch.  Very well and with examples about sockets written <a href="http://professorweb.ru/my/csharp/web/level3/3_1.php">here</a> . <br><br><h3>  Server.  Getting bullied </h3><br>  Run Aimp, Windows Media Player, etc.  even from the phone it is not interesting, and on the basis of this article you can easily implement all this by modifying the code a little.  Let's get better at it.  We'll twist-twirl the monitor screen as we like or display unexpected messages (a kind of unidirectional atsky messenger), and the worst thing is to turn off the computer!  True, for this they can wear a pitchfork.  Well, okay, let them first get caught. <br><br>  So let's get started.  In Visual Studio, we create a new Windows Form application with the name, say, FunnyJoke.  Open the Program.cs file and delete all the code in the body of the Main function.  This code initializes the main form of the application, our server does not need any windows, it should sit quietly peacefully and wait for commands. <br><br>  In the Program class, we define the following variables: <br><br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//  static int port = 10000; //  static IPAddress ipAddress = IPAddress.Parse("0.0.0.0"); //   const byte codeMsg = 1; //   const byte codeRotate = 2; //   const byte codePoff = 3;</span></span></code> </pre> <br>  I took port 10000, it is our server that will listen to it, instead of an ip address I set 0.0.0.0, which means that all available network interfaces will be processed.  This is not entirely correct, but it will come down for a start.  Further I defined three constants which set the codes of commands coming from the client.  At the beginning of the project, do not forget to connect: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Net; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Net.Sockets;</code> </pre><br>  Now, instead of the remote code, we insert the following into the Main function: <br><br><div class="spoiler">  <b class="spoiler_title">Main</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     IPEndPoint ipEndPoint = new IPEndPoint(ipAddress, port); //    Socket socket = new Socket(ipAddress.AddressFamily, SocketType.Stream, ProtocolType.Tcp); try { //      socket.Bind(ipEndPoint); //    "" socket.Listen(1); while (true) { //  .       Socket Socket handler = socket.Accept(); // ,    . byte[] recBytes = new byte[1024]; int nBytes = handler.Receive(recBytes); switch (recBytes[0]) //     { case codeMsg: //  nBytes = handler.Receive(recBytes); //    if (nBytes != 0) { //       String msg = Encoding.UTF8.GetString(recBytes, 0, nBytes); MessageBox.Show(msg, " !"); } break; case codeRotate: //   RotateScreen(); break; case codePoff: //  System.Diagnostics.Process p = new System.Diagnostics.Process(); p.StartInfo.FileName = "shutdown.exe"; p.StartInfo.Arguments = "-s -t 00"; p.Start(); socket.Close(); break; } //   handler.Shutdown(SocketShutdown.Both); handler.Close(); } } catch (Exception ex) { } }</span></span></code> </pre><br></div></div><br>  The example is well commented.  But still I will explain.  First, create a local endpoint and associate it with our ip address and port.  Then, we define the main socket, connect it to the end point, and put it into listening mode.  After that we enter an infinite loop, and starting with the line: <br><br><pre> <code class="cs hljs">Socket handler = socket.Accept();</code> </pre><br>  our server goes to the waiting state of the connection.  With a successful connection, a new instance of Socket will be created, through which we will communicate with our client.  After the connection is established, we start reading the data: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nBytes = handler.Receive(recBytes</code> </pre><br>  Client commands are encoded with a single-byte code (described at the beginning of the program), the server decrypts the command code and starts to execute it, then goes back to standby mode.  The exception is <b>codeMsg</b> , since  after it is expected a set of bytes containing the message string.  Therefore, having received this command, the server again reads data from the socket: <br><br><pre> <code class="cs hljs"> nBytes = handler.Receive(recBytes); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nBytes != <span class="hljs-number"><span class="hljs-number">0</span></span>) { String msg = Encoding.UTF8.GetString(recBytes, <span class="hljs-number"><span class="hljs-number">0</span></span>, nBytes); MessageBox.Show(msg, <span class="hljs-string"><span class="hljs-string">" !"</span></span>); }</code> </pre><br>  The string coming from the client has the UTF-8 character encoding, so before showing it to the unfortunate user, you must bring it to a standard form. <br><br>  To simplify the program, and not to create unnecessary dialogues, I used the standard class MessageBox, but this approach has one drawback.  MessageBox creates a modal window that blocks the flow of the entire application.  In other words, while the message window is open, our server does nothing.  Minus of course, but you have to pay for simplicity. <br><br>  I will not paint the procedure for changing the orientation of the screen, I executed its code as recommended by Microsoft <a href="https://msdn.microsoft.com/en-us/library/ms812499.aspx">right here</a> .  How to rotate the screen using .NET I did not find.  This is easy to implement for mobile platforms, but for an ordinary PC, it was an unsolvable problem.  But, the good old WINAPI came to the rescue and ruined everything. <br>  Turn off the computer using standard Windows tools by calling the shutdown command with the appropriate flags. <br><br>  With the server, perhaps, everything.  I will attach the source code of the project at the end of the article. <br><br><h3>  Customer </h3><br>  The client will write in Android Studio, because I like this IDE more than Eclipse.  Lovers of the latter, I think it will not be difficult to remake the project.  For debugging, I used VirtualBox with the Android virtual machine installed, because my native emulator is terribly slow, and my life is not enough to debug something with it.  Well, and periodically checked on a "live" phone.  So, create a project with the name FunnyJoke, set the minimum API version that your phone is able to pull off (I have 16) and select Empty Activity.  Everything else is the default.  Make markup submission.  With the design, I didn‚Äôt really pervert, who needs to let him draw beautiful buttons, place them according to Shuya's hair dryer, etc.  I made it simple: two EditText fields, the first to enter the ip address of the computer being monitored, the second for the text of the message, and the button that will make the desktop rotate.  But the completion button I made a big and threatening red.  This is not to accidentally click. <br><br><div class="spoiler">  <b class="spoiler_title">activity_main.xml:</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:weightSum</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20dp"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"horizontal"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20dp"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"IP address:"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/textView"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EditText</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/edIPaddress"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:digits</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0123456789."</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"horizontal"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"top"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EditText</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/etMsg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center_vertical"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_weight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Send Msg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_weight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/btnSMsg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center_vertical"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:onClick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"onClick"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Rotate Screen"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/btnRotate"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_weight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center_horizontal"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:onClick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"onClick"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ImageButton</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/btnPowerOff"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/button_img"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@null"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:onClick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"onClick"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  Here you should pay attention to the <b>edIPaddress</b> field, there is filtering on input of only numbers and.  (dot), since the field is intended to enter the ip address.  I must say that this is the only check for the correctness of the entered data, everything else remains on the user's conscience.  I also want to say about the <b>btnPowerOff</b> button <b>,</b> its state is monitored by the selector, and depending on whether it is pressed or not, the image is changed (otherwise, it is not clear if the button is pressed, the button will look like a static picture).  Here is the button_img.xml selector code: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">selector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:state_pressed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:drawable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/poweroffs"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:drawable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/poweroff"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">selector</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Accordingly, the resources should have two pictures, one for the pressed state, the other for the usual one.  You‚Äôll get this screen: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/030/ac6/baa/030ac6baa62ccc2c9a88a72ff42e5f29.png" alt="image"><br><br>  With this markup finish.  Go to the file MainActivity.java.  First of all, just as in the server, we define the command codes and some variables: <br><br><pre> <code class="java hljs">String serIpAddress; <span class="hljs-comment"><span class="hljs-comment">//   int port = 10000; //  String msg; //  final byte codeMsg = 1; //   final byte codeRotate = 2; //   final byte codePoff = 3; //   byte codeCommand;</span></span></code> </pre><br>  Next, go to the button click handler.  Note that the handler is one, and which button was pressed is determined by the identifier.  First of all, we get a string from the <b>edIPaddress</b> field, if the field is not filled, then we output a message about the need to enter an ip address, and do nothing else. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     ip  EditText etIPaddress = (EditText)findViewById(R.id.edIPaddress); serIpAddress = etIPaddress.getText().toString(); //    ,      if (serIpAddress.isEmpty()){ Toast msgToast = Toast.makeText(this, " ip ", Toast.LENGTH_SHORT); msgToast.show(); return; } . . . . }</span></span></code> </pre><br>  In Android, it is not recommended to create long-playing processes in the main thread, this is due to the fact that a program may ‚Äúhang‚Äù and the user or the system can simply close the application without waiting for an answer.  Such long-playing processes include work with the network.  In this case, it is necessary to create an additional stream in which to execute the ‚Äúlong‚Äù code.  In java, there is a standard class <b>Thread</b> , which allows you to control threads but, we will not use it, because  in Android, there is a special class <b>AsyncTask</b> .  Details can be read <a href="http://developer.android.com/reference/android/os/AsyncTask.html">here</a> or <a href="http://startandroid.ru/ru/uroki/vse-uroki-spiskom/149-urok-86-asynctask-znakomstvo-neslozhnyj-primer.html">here.</a> <br>  We create a class that will be engaged in sending a message, its parent is doing <b>AsyncTask</b> , and override the <b>doInBackground</b> method in the body of which the main code will be located: <br><br><div class="spoiler">  <b class="spoiler_title">SenderThread</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SenderThread</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AsyncTask</span></span></span><span class="hljs-class"> &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> Void </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doInBackground</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Void... params)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">// ip   InetAddress ipAddress = InetAddress.getByName(serIpAddress); //   Socket socket = new Socket(ipAddress, port); //   / OutputStream outputStream = socket.getOutputStream(); DataOutputStream out = new DataOutputStream(outputStream); switch (codeCommand) { //        case codeMsg: //  out.write(codeMsg); //    UTF-8 byte[] outMsg = msg.getBytes("UTF8"); out.write(outMsg); break; case codeRotate: //   out.write(codeRotate); break; case codePoff: //  out.write(codePoff); break; } } catch (Exception ex) { ex.printStackTrace(); } return null; } }</span></span></code> </pre><br></div></div><br>  First, create an instance of the class <b>InetAddress</b> , which will contain the server ip.  Then we create a socket, associate it with a remote address and port, and request the standard input / output stream (or rather, only the output, because our client does not receive anything).  And finally, depending on the value of the <b>codeCommand</b> variable, we send a message to the server. <br><br>  Now, let's go back to our button click handler, create an instance of the <b>SenderThread</b> class, then, depending on which button was clicked, initialize the <b>codeCommand</b> variable, according to which our thread will determine what we want from it.  Finally, activate it by calling the <b>execute ()</b> method. <br><br><pre> <code class="java hljs">. . . SenderThread sender = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SenderThread(); <span class="hljs-comment"><span class="hljs-comment">//      switch (v.getId()) // id  { case R.id.btnSMsg: //   if (!msg.isEmpty()) { codeCommand = codeMsg; sender.execute(); } else { //    ,     Toast msgToast = Toast.makeText(this, " ", Toast.LENGTH_SHORT); msgToast.show(); } break; case R.id.btnRotate: //  codeCommand = codeRotate; sender.execute(); break; case R.id.btnPowerOff: //  codeCommand = codePoff; sender.execute(); break; } }</span></span></code> </pre><br>  Let's slightly fix the application manifest, give permission to use the network and wi-fi, without this, nothing will work: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.INTERNET"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.ACCESS_NETWORK_STATE"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.ACCESS_WIFI_STATE"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  Everything!  You can collect and check.  Here is the result: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/99e/69b/a8c/99e69ba8c983ad94a158e414bb13efe2.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d45/926/a5c/d45926a5c793a61893accc40c25f16a4.png" alt="image"><br><br><h3>  Links </h3><br><ul><li>  <a href="http://professorweb.ru/my/csharp/web/level3/3_1.php">.NET sockets</a> </li><li>  <a href="http_web/article02.html">Java</a>  <a href="http_web/article02.html">HTTP protocol and work with WEB</a> </li><li>  <a href="http://startandroid.ru/ru/uroki/vse-uroki-spiskom/149-urok-86-asynctask-znakomstvo-neslozhnyj-primer.html">AsyncTask.</a>  <a href="http://startandroid.ru/ru/uroki/vse-uroki-spiskom/149-urok-86-asynctask-znakomstvo-neslozhnyj-primer.html">Acquaintance, simple example</a> </li><li>  <a href="http://developer.android.com/reference/android/os/AsyncTask.html">AsyncTask</a> </li><li>  <a href="https://msdn.microsoft.com/en-us/library/ms812499.aspx">Changing Screen Orientation Programmatically</a> </li><li>  <a href="http://my-files.ru/zvr87f">Server source code</a> </li><li>  <a href="http://my-files.ru/fab7h0">Client source code</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/301190/">https://habr.com/ru/post/301190/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../301178/index.html">Exploration and engineering: 3D-models of buildings, junctions and quarries by photo</a></li>
<li><a href="../301180/index.html">Digest of recent advances in cryptography. Zero release</a></li>
<li><a href="../301182/index.html">[St. Petersburg, Announcement] Meeting with Andrey Pangin - Everything you wanted to know about stack-traces and hip dumps</a></li>
<li><a href="../301186/index.html">Magento 2: cookies, registry, session</a></li>
<li><a href="../301188/index.html">10 types of insane customers</a></li>
<li><a href="../301192/index.html">[Terraform + SaltStack] Cooking PrestoDB Cluster in a Pressure Cooker (Part # 1)</a></li>
<li><a href="../301194/index.html">How to create eye-catching images if you are not a designer</a></li>
<li><a href="../301196/index.html">Criminals infecting ATMs with a virus caught hot</a></li>
<li><a href="../301198/index.html">LinkedIn recommends users change passwords.</a></li>
<li><a href="../301200/index.html">How I did a web store template in Sketch.app for Themeforest. Part 2: we lay out the goods</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>