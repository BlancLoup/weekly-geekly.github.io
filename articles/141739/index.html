<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to promote the "Social Network Ark", if this is a fantastic trilogy</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Three books with fiction and a site for reading is a project that has been going on for 2 years now. 
 And damn it, I like it. Now I will tell you how...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to promote the "Social Network Ark", if this is a fantastic trilogy</h1><div class="post__text post__text-html js-mediator-article">  Three books with fiction and a site for reading is a project that has been going on for 2 years now. <br>  And damn it, I like it.  Now I will tell you how I made a site for reading my works. <br><br>  Everyone should have a hobby that is not related to his professional activities.  For the soul, for recreation, for self-realization, the development of their skills and the change of activity (which is the best rest).  Through numerous experiments, I chose writing. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/339/e8f/d01/339e8fd01363ca1759820e2948afd364.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Having published the first book, I received quite a lot of good reviews.  In this regard, I have a need to invent a convenient way to self-publish. <br><br><a name="habracut"></a><br><br><h1>  Why not a paper book? </h1><br>  At first there was a thought - send your book to 200 publishing houses in the country and wait for a response.  After receiving the answer, it will be necessary to bring the book to mind for 6 months, with the help of editors and then another 6 months to wait for 2000 paper copies.  Which without advertising (and it does not give for beginner writers) will be sold for a year.  After thinking about this option and considering that I was not used to getting money for my hobby, I chose the option of promotion on the Internet.  The Internet audience at the moment is more than a book-reading audience that is not connected to the network and goes to bookstores.  You do not think, I am not against paper books, but as a method of promotion for a novice writer, a paper book is a very difficult and long way.  (Recall how Lukyanenko started with free texts on the network, in .txt files.) <br><br><h1>  What should be the site to read? </h1><br>  To make the book available to anyone within two clicks, I created a website where you can read my books and download for free in all of the favorite formats for electronic readers. <br><br>  It would seem that difficult in this site?  But on the way of this fascinating quest, I was waiting for a few surprises. <br><br>  Thinking up what my site will be like, I tried to transform into my own reader and take into account all my wishes: <br><br>  <b>Wishes of the modern reader to the site with books:</b> <br>  1) I want to be able to download a book in any format with a table of contents, for any reader (PDF, fb2, epub, mobi). <br>  2) I want to be able to comment on the chapters in the book and share my impressions. <br>  3) I want to be able to give my friends a short link or put Like on any social network if I like the book (for example, dictate the website address " <a href="http://990990.ru/">990990.ru</a> " by phone). <br>  4) When I'm at work, I can't get the reader, so I want access to reading on the site.  The same item is valid if I do not have a reading room. <br>  5) When reading on the site, I want the site to remember the reading position where I ended up.  So that I can open the book at home and finish reading.  And also, I hate registering.  I want to log in through any of my social network. <br>  6) I don‚Äôt want to see advertising and other distractions while reading.  I want to be able to choose a background for reading. <br>  7) I do not want to use the scroll to read such weighty volumes <br>  8) Interrupting the reading, I do not want to then look for a place where I stopped the last time. <br>  9) I want to learn about new books and chapters of unfinished books of the author, if I like his books. <br>  10) Books should be interesting and written in easy language and preferably with the letters "e". <br><br>  Considering that I also write books, after the site is ready, I took into account the requirements of the writer: <br><br>  <b>Requirements of a modern writer for his site:</b> <br>  1) It will be great if I can write directly on the site.  I want to have a beautiful, convenient, minimalistic editor that does not distract me in Fullscreen mode.  I want to have access here at any time, including from the iPad. <br>  2) The site in two clicks should accept texts from my favorite program for writers <a href="http://www.literatureandlatte.com/scrivener.php">Scrvener</a> . <br>  3) The editor should count the number of words in the chapter being created so that the chapters do not turn out to be very long and you can set a daily rate for yourself. <br>  4) Publication of a new chapter, should be carried out in one click. <br>  5) I want to know feedback from my readers. <br>  6) I want to see the geographical position of my readers and statistics of downloads and scrolling of the book. <br>  7) I want the appearance of the reading room, to have to read and not distract my readers from the plot. <br>  8) I want to have a short link to distribute to my friends (for example, <a href="http://990990.ru/">990990.ru</a> or <a href="http://wezel.ru/">wezel.ru</a> ) <br><br><h1>  Take care of the wheel or why a book with paging, <br>  wins long text with scrolling: </h1><br>  Let it be selfish, but I chose the form of reading, which is convenient for me, when ahead, more than 2400 pages are waiting for me.  I am a bright representative of the SMS generation, who likes to read, but which is distracting everything around.  After the call of a friend, I should be able to quickly return my eyes to the line where they were before they were distracted. <br>  I don‚Äôt like scrolling, because a long ‚Äúfootwoman‚Äù of a text can accidentally go to the very beginning and, then, it‚Äôs easier to start reading again than to look for a place where I‚Äôve stopped.  And reading is such a ritual act that does not tolerate any distractions. <br>  It was possible to make a pagination ‚Äúpagination‚Äù with page numbers at the bottom, but then, the reader will have to study this interface and understand the logic of rewinding.  Getting into the small numbers downstairs is also not so easy when you empathize with the main characters, it is 3:00 in the morning and it‚Äôs time to sleep, but you want to finish reading. <br>  Therefore, for other unconscious reasons, it was decided to be confused with the pagination output, so that everything was like a real book. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3b7/a35/eee/3b7a35eee02557c9d0e87e1a3d721db9.png" alt="Table of contents of three books"><br><br>  In such a book, you need to make a table of contents with page numbers.  For those who like to read the end and spoil their impression, this function is very good.  Here you can switch between three works.  At the end of the chapter, a small yellow leaflet shows the number of user comments on this chapter.  You can click into it and add what has hurt you by reading. <br><br>  White links, ordinary readers are not visible, with their help, I can open a chapter for editing or start writing a new chapter. <br><br><h1>  The page numbers are the hardest. </h1><br>  A book without page numbers is like a walk through a dark basement, when you do not know where the beginning and when the end is.  Table of contents without page numbers is just a set of links. <br>  The problem is one, how to break a long book into pages and still have the opportunity to update chapters (and the chapter may increase and decrease).  Bookmate.com - solved this question by indicating the page number inside the chapter.  Through numbering throughout the book is not.  This is not our method.  We have our own work and we have time to prepare a book for reading, by recalculating page numbers. <br><br><h1>  A simple algorithm that comes up with a long time: </h1><br>  How to break a long text into pages, I will try to describe in simple words, then I will give the script. <br>  1. We take the source text of the book and insert ‚Äúsoft hyphens‚Äù there.  We do this with the help of three lines of code (and the work of <a href="http://quittance.ru/hyphenator.php">Sergey Kurakin</a> ): <br><pre><code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'hypher.php'</span></span>; $hy_ru = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> phpHypher(<span class="hljs-string"><span class="hljs-string">'hyph_ru_RU.conf'</span></span>); $text = $hy_ru-&gt;hyphenate($text,<span class="hljs-string"><span class="hljs-string">'UTF-8'</span></span>);</code> </pre> <br>  Without hyphenation, our text will look very sparse and non-compact.  In the plugin settings, I set the hyphenation for only very long words, so the text looks neat and the hyphenation does not ‚Äúpart‚Äù.  This code adds "&amp; shy;" symbols inside the text.  - which allow the browser to transfer words in these places. <br><br>  2. We break a long book into chapters and enter in table 1_book: <br><img src="https://habrastorage.org/getpro/habr/post_images/feb/881/019/feb8810194bbad2b2cc56bb4b1b37b9f.png" alt="1_book table"><br>  num are chapter numbers.  book is the number of the book, while there are three of them.  title - title of the chapter <br><br>  3. By using a ‚Äúlong-thinking‚Äù script (I will describe the work just below), a simple table 1_books_p is created - in which the page number is indicated and from which symbol to which, cut the text of this chapter: <br><img src="https://habrastorage.org/getpro/habr/post_images/a68/f77/4e0/a68f774e0698623d52d7ba0cfc2326ad.png" alt="1_book_p table"><br><br>  So we create a table in which everything is calculated in advance.  The user does not need to wait (and waste server resources) to calculate the pagination of the book.  Everything is counted to us.  This script is run only by the ‚Äúwriter‚Äù after he has changed the chapter.  If the chapter is corrected by one, then you can only recalculate the numbering of this modified chapter, and the numbering of the following pages can be reduced or increased by the difference between what was and what has become.  The work of the script rendering pages of one chapter takes 1 second. <br><br>  Here is the script itself: <br><pre> <code class="hljs bash">&lt;? include <span class="hljs-string"><span class="hljs-string">'hypher_.php'</span></span>; include <span class="hljs-string"><span class="hljs-string">'pass_of_db.php'</span></span>; <span class="hljs-variable"><span class="hljs-variable">$hy_ru</span></span> = new phpHypher(<span class="hljs-string"><span class="hljs-string">'hyph_ru_RU.conf'</span></span>); <span class="hljs-variable"><span class="hljs-variable">$book</span></span> = intval(<span class="hljs-variable"><span class="hljs-variable">$HTTP_GET_VARS</span></span>[<span class="hljs-string"><span class="hljs-string">'book'</span></span>]); <span class="hljs-variable"><span class="hljs-variable">$glava</span></span> = intval(<span class="hljs-variable"><span class="hljs-variable">$HTTP_GET_VARS</span></span>[<span class="hljs-string"><span class="hljs-string">'glava'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">$glava</span></span> == <span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-variable"><span class="hljs-variable">$glava</span></span>=0; <span class="hljs-variable"><span class="hljs-variable">$db</span></span> = mysql_connect (<span class="hljs-variable"><span class="hljs-variable">$config</span></span>[mysql_host], <span class="hljs-variable"><span class="hljs-variable">$config</span></span>[mysql_user], <span class="hljs-variable"><span class="hljs-variable">$config</span></span>[mysql_password]); mysql_query(<span class="hljs-string"><span class="hljs-string">"SET NAMES utf8"</span></span>); mysql_select_db(<span class="hljs-variable"><span class="hljs-variable">$config</span></span>[base_name],<span class="hljs-variable"><span class="hljs-variable">$db</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-variable"><span class="hljs-variable">$db</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"   SQL :("</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>();} <span class="hljs-variable"><span class="hljs-variable">$sqlnews2</span></span>=<span class="hljs-string"><span class="hljs-string">"SELECT * FROM `1_books` WHERE book=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$book</span></span></span><span class="hljs-string"> AND num=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$glava</span></span></span><span class="hljs-string">"</span></span>; <span class="hljs-variable"><span class="hljs-variable">$result2</span></span> = mysql_query(<span class="hljs-variable"><span class="hljs-variable">$sqlnews2</span></span>); @<span class="hljs-variable"><span class="hljs-variable">$sql2</span></span> = mysql_fetch_array(<span class="hljs-variable"><span class="hljs-variable">$result2</span></span>); <span class="hljs-variable"><span class="hljs-variable">$text</span></span>=<span class="hljs-variable"><span class="hljs-variable">$sql2</span></span>[<span class="hljs-string"><span class="hljs-string">'text'</span></span>]; //    <span class="hljs-variable"><span class="hljs-variable">$text</span></span> = str_replace(<span class="hljs-string"><span class="hljs-string">"\r"</span></span>,<span class="hljs-string"><span class="hljs-string">'&lt;/p&gt;&lt;p&gt;'</span></span>,<span class="hljs-variable"><span class="hljs-variable">$text</span></span>); //  ,  <span class="hljs-string"><span class="hljs-string">" "</span></span>    ?&gt; &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>&gt; &lt;title&gt; &lt;/title&gt; &lt;script src=<span class="hljs-string"><span class="hljs-string">"../src/js/jquery.js"</span></span>&gt;&lt;/script&gt; &lt;script src=<span class="hljs-string"><span class="hljs-string">"../src/js/cookie.js"</span></span>&gt;&lt;/script&gt; &lt;link rel=<span class="hljs-string"><span class="hljs-string">"stylesheet"</span></span> href=<span class="hljs-string"><span class="hljs-string">"css/style.css"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=<span class="hljs-string"><span class="hljs-string">"text/css"</span></span> media=<span class="hljs-string"><span class="hljs-string">"screen"</span></span>/&gt; &lt;script <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jsDoFirst</span></span></span></span>() { //   $.ajaxSetup({async: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}); var maxgl; $(<span class="hljs-string"><span class="hljs-string">'#load2'</span></span>).load(<span class="hljs-string"><span class="hljs-string">"getinfo.php?book=&lt;? echo </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$book</span></span></span><span class="hljs-string">; ?&gt;&amp;page=2"</span></span>,<span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span></span>() { maxgl = parseFloat( $(<span class="hljs-string"><span class="hljs-string">'.maxglav'</span></span>).html() ); num=1; gl=&lt;? <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$glava</span></span>; ?&gt;; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gl==0) { gl_start = 0; gl_finish = maxgl; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $(<span class="hljs-string"><span class="hljs-string">'#load2'</span></span>).load(<span class="hljs-string"><span class="hljs-string">"getinfo.php?book=&lt;? echo </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$book</span></span></span><span class="hljs-string">; ?&gt;&amp;glava="</span></span>+(gl-1)+<span class="hljs-string"><span class="hljs-string">"&amp;lastpage=1"</span></span>); num = parseFloat( $(<span class="hljs-string"><span class="hljs-string">'.lastpage'</span></span>).html() ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!num) num=0; num = num+1; gl_start=gl; gl_finish=gl; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(glava=gl_start;glava&lt;=gl_finish;glava++) { lnk = <span class="hljs-string"><span class="hljs-string">"getinfo.php?book=&lt;? echo </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$book</span></span></span><span class="hljs-string">; ?&gt;&amp;p="</span></span>+glava+<span class="hljs-string"><span class="hljs-string">"&amp;start=0&amp;limit=1200000&amp;num=1&amp;final=5"</span></span>; $.getJSON( lnk ,<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(text) { i=0; first=0; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(j=0;j&lt;=20000;j++) { first=i; step=800; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((text.length-1-first)&lt;=0) step=0; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i=first;i&lt;=text.length-1;i+=2) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(j==0) pref=<span class="hljs-string"><span class="hljs-string">"&lt;h1&gt;&lt;/h1&gt;"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> pref=<span class="hljs-string"><span class="hljs-string">""</span></span>; $(<span class="hljs-string"><span class="hljs-string">'#b-load2'</span></span>).html(pref+<span class="hljs-string"><span class="hljs-string">'&lt;p&gt;'</span></span>+text.substr(first,i-first)); h = $(<span class="hljs-string"><span class="hljs-string">'#b-load2'</span></span>).height(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(h&gt;=590) { i=i-1; newtext = text.substr(first,i-first); vv=razvedka(text,first,i); i=vv+first; newtext = text.substr(first,vv); next=first+vv; $(<span class="hljs-string"><span class="hljs-string">'#load2'</span></span>).html($(<span class="hljs-string"><span class="hljs-string">'#load2'</span></span>).html()+<span class="hljs-string"><span class="hljs-string">'&lt;font size=-2em&gt;start='</span></span>+first+<span class="hljs-string"><span class="hljs-string">' to='</span></span>+next+<span class="hljs-string"><span class="hljs-string">' num='</span></span>+num+<span class="hljs-string"><span class="hljs-string">'&lt;/font&gt;'</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;hr&gt;'</span></span>+newtext); lnk = <span class="hljs-string"><span class="hljs-string">"getinfo.php?writepage="</span></span>+num+<span class="hljs-string"><span class="hljs-string">"&amp;start="</span></span>+first+<span class="hljs-string"><span class="hljs-string">"&amp;to="</span></span>+next+<span class="hljs-string"><span class="hljs-string">"&amp;book=&lt;? echo </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$book</span></span></span><span class="hljs-string">; ?&gt;&amp;glava="</span></span>+glava; $(<span class="hljs-string"><span class="hljs-string">'#load3'</span></span>).load(lnk); console.log(lnk); num=num+1; flag=1; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (flag==0) { next=text.length+1; lnk = <span class="hljs-string"><span class="hljs-string">"getinfo.php?writepage="</span></span>+num+<span class="hljs-string"><span class="hljs-string">"&amp;start="</span></span>+first+<span class="hljs-string"><span class="hljs-string">"&amp;to="</span></span>+next+<span class="hljs-string"><span class="hljs-string">"&amp;book=&lt;? echo </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$book</span></span></span><span class="hljs-string">; ?&gt;&amp;glava="</span></span>+glava; $(<span class="hljs-string"><span class="hljs-string">'#load3'</span></span>).load(lnk); num=num+1; console.log(<span class="hljs-string"><span class="hljs-string">'fin='</span></span>+lnk); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; } flag=0; } }); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gl!=0) { lnk=<span class="hljs-string"><span class="hljs-string">"getinfo.php?book=&lt;? echo </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$book</span></span></span><span class="hljs-string">; ?&gt;&amp;glava="</span></span>+gl+<span class="hljs-string"><span class="hljs-string">"&amp;getback=1"</span></span>; $(<span class="hljs-string"><span class="hljs-string">'#load2'</span></span>).load(lnk); self.close(); } }); } <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> razvedka(text,first,i) { /*     :     ,  &lt;/p&gt;  &lt;/p&gt;,   &lt;/p&gt;    ( .   &lt;p&gt;)    ,          &lt;p2&gt;.    ,      ,           . */ newtext = text.substr(first,i-first); space=newtext.lastIndexOf(<span class="hljs-string"><span class="hljs-string">" "</span></span>); addspace=1; parag=newtext.lastIndexOf(<span class="hljs-string"><span class="hljs-string">"&lt;/p&gt;"</span></span>); addparag=4; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((space-parag)&lt;5) {vv=parag; add=addparag; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {vv=space; add=addspace; } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> vv+add; } &lt;/script&gt; &lt;script <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>&gt; $(document).ready(jsDoFirst); &lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;div class=<span class="hljs-string"><span class="hljs-string">"book_wrapper"</span></span>&gt; &lt;div class=<span class="hljs-string"><span class="hljs-string">"animate2"</span></span>&gt; &lt;div id=<span class="hljs-string"><span class="hljs-string">"b-load2"</span></span> style=<span class="hljs-string"><span class="hljs-string">"width:365px;padding-top:20px"</span></span>&gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;div id=<span class="hljs-string"><span class="hljs-string">"load2"</span></span> style=<span class="hljs-string"><span class="hljs-string">"background-color:white"</span></span>&gt;&lt;/div&gt; &lt;div id=<span class="hljs-string"><span class="hljs-string">"load3"</span></span>&gt;&lt;/div&gt; &lt;/body&gt; &lt;/html&gt;</code> </pre><br><br>  I am not proud of my PHP and Javascript coding style, so please do not beat them with a stick.  The essence of my description relates more to the algorithm for determining the starting and ending point of breaking the chapter, so that the text is enough to fit onto the page and smoothly continue the previous text. <br><br>  The essence of the script, which is higher in the fact that it takes 800 characters from the chapter and displays it in a div, which exactly repeats the page of the book on the site itself.  If the height of this div does not exceed 590 pixels, 2 characters are added to the text and its new height is measured.  As soon as we increased the text so much that it began to crawl out of 590 pixels, we stop and, using the Razvedka function, look for the closest space or character of the end of a paragraph.  So we find a place where we will break this chapter.  ‚ÄúGetinfo.php? Writepage‚Äù - writes the calculated values ‚Äã‚Äãto the base for ‚Äú1_books_p‚Äù. <br><br>  It turns out that all calculations of page numbers occur on my computer in my browser.  I could not do it on the server.  To predict how many characters need to be placed on the page so that it is displayed correctly - you need to know the width of characters, make hyphens, take into account the indentation between paragraphs.  The algorithm is not comprehensible for my amateur brain. <br><br><h1>  How to make page turning animation: </h1><br>  At first, I thought that I would spend several days on this part of the project, but, miraculously, I managed to implement everything in 30 minutes.  It turned out that flipping is an animation of two sides of one sheet.  One div should be reduced in width to zero, and the other increased to the width of the sheet.  Still surprised by the simplicity of the solution.  For this, I love jQuery. <br><pre> <code class="hljs smalltalk">function rotate() { ease = <span class="hljs-string"><span class="hljs-string">'easeInQuad'</span></span>; //easing -   tim = <span class="hljs-number"><span class="hljs-number">700</span></span>; maxpages=parseFloat(<span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.maxpages'</span></span>).html()); //  ,     <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.animate3'</span></span>).show(); //  div    <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.animate3'</span></span>).css(<span class="hljs-comment"><span class="hljs-comment">"left"</span></span>,<span class="hljs-number"><span class="hljs-number">105</span></span>).css(<span class="hljs-comment"><span class="hljs-comment">"width"</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); //         <span class="hljs-number"><span class="hljs-number">413</span></span>  <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.animate3'</span></span>).stop().animate({<span class="hljs-comment"><span class="hljs-comment">"left"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"523"</span></span>,<span class="hljs-comment"><span class="hljs-comment">"width"</span></span>:<span class="hljs-comment"><span class="hljs-comment">"413"</span></span>},tim,ease, function() { <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.b-load4'</span></span>).html(<span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.b-load3'</span></span>).html()); // ,        <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.num4'</span></span>).html(<span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.num3'</span></span>).html()); <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.animate3'</span></span>).css(<span class="hljs-comment"><span class="hljs-comment">"left"</span></span>,<span class="hljs-number"><span class="hljs-number">105</span></span>).css(<span class="hljs-comment"><span class="hljs-comment">"width"</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>).hide(); <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.animate3'</span></span>).css(<span class="hljs-comment"><span class="hljs-comment">"-webkit-box-shadow"</span></span>,<span class="hljs-comment"><span class="hljs-comment">""</span></span>); if ( <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.b-load3 #end'</span></span>).html() != null ) //    ,   { update_comment(); <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.clip_right'</span></span>).fadeIn(<span class="hljs-number"><span class="hljs-number">600</span></span>); <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.comments_right'</span></span>).fadeIn(<span class="hljs-number"><span class="hljs-number">600</span></span>); } else { <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.clip_right'</span></span>).fadeOut(<span class="hljs-number"><span class="hljs-number">50</span></span>); <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.comments_right'</span></span>).fadeOut(<span class="hljs-number"><span class="hljs-number">50</span></span>); } if ( <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.b-load2 #end'</span></span>).html() != null ) { update_comment(); <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.clip_left'</span></span>).fadeIn(<span class="hljs-number"><span class="hljs-number">600</span></span>); <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.comments_left'</span></span>).fadeIn(<span class="hljs-number"><span class="hljs-number">600</span></span>); } else { <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.clip_left'</span></span>).fadeOut(<span class="hljs-number"><span class="hljs-number">50</span></span>); <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.comments_left'</span></span>).fadeOut(<span class="hljs-number"><span class="hljs-number">50</span></span>); } afterrotate(); }); <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.animate1'</span></span>).css(<span class="hljs-comment"><span class="hljs-comment">"width"</span></span>,<span class="hljs-number"><span class="hljs-number">413</span></span>).show(); //     (    <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.b-load1'</span></span>).show(); <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.animate1'</span></span>).stop().animate({<span class="hljs-comment"><span class="hljs-comment">"width"</span></span>:<span class="hljs-comment"><span class="hljs-comment">"0"</span></span>},tim,ease, function() { <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.b-load1'</span></span>).html(<span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.b-load2'</span></span>).html()) <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.num1'</span></span>).html(<span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.num2'</span></span>).html()) <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.animate1'</span></span>).show(); <span class="hljs-string"><span class="hljs-string">$(</span></span><span class="hljs-string"><span class="hljs-string">'.animate1'</span></span>).css(<span class="hljs-comment"><span class="hljs-comment">"width"</span></span>,<span class="hljs-number"><span class="hljs-number">413</span></span>); }); }</code> </pre><br><br>  The whole animation consists in the simultaneous movement of two divs, one of which is the old page and the other one is new.  It looks beautiful, but it‚Äôs hard to understand if you don‚Äôt know how to read the code.  I will not tell you how to bind paging per click on the page or pressing the arrow keys.  This you can see in the script on the site itself. <br><br><h1>  How to log in to the site in one second: </h1><br>  Authorization for such a site is needed for one simple but necessary thing.  The reader does not have to remember which page he opened last time.  You can‚Äôt hang a bookmark on the monitor, but there are three books and you need to remember the position in each of them.  I used a great Loginza.ru authorization service. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/377/a71/be3/377a71be347437872b29b78a08fa154c.png" alt="Login with Loginza"><br><br>  The desired button in the middle.  Who wants to click and try, as easy to log in with: vkontakte, odnoklassniki, mail, gmail, facebook and so on ... <br>  The Like buttons from Yandex for all social networks are also located here.  Counter LIKE'ov ("link to the book placed 22 readers") works by intercepting clicks using javascript. <br><br>  You can also select a background for reading by clicking on the "change background" button.  Here you can choose one of three books and even click on the link " <a href="http://wezel.ru/%3Fp%3Ddownload">download book</a> ". <br><br><h1>  Count everyone who downloaded PDF, epub, mobi, fb2: </h1><br>  I do not need to monetize this project, so the download of files is free. <br>  The page looks like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8c3/ee4/ba5/8c3ee4ba5acacf209a382cf92c868598.png" alt="Download the book Ark social network"><br><br>  It would seem nothing complicated.  But how to make a counter to download, if the links should look fair, like this: " <a href="">wezel.ru/book/download/kovcheg-1.fb2</a> "? <br><br>  Even from my experience with w3bsit3-dns.com, I remember how often links pull to my website and links like: ‚Äúdownload.php? File = kovcheg-1.fb2‚Äù they really don't like. <br><br>  This is solved by a simple mod_rewrite: <br><pre> <code class="hljs pgsql">RewriteEngine <span class="hljs-keyword"><span class="hljs-keyword">On</span></span> RewriteRule kovcheg<span class="hljs-number"><span class="hljs-number">-1.</span></span>(.+..+)$ getfile.php?<span class="hljs-type"><span class="hljs-type">name</span></span>=kovcheg<span class="hljs-number"><span class="hljs-number">-1</span></span>&amp;ext=<span class="hljs-meta"><span class="hljs-meta">$1</span></span> RewriteRule kovcheg<span class="hljs-number"><span class="hljs-number">-2.</span></span>(.+..+)$ getfile.php?<span class="hljs-type"><span class="hljs-type">name</span></span>=kovcheg<span class="hljs-number"><span class="hljs-number">-2</span></span>&amp;ext=<span class="hljs-meta"><span class="hljs-meta">$1</span></span> RewriteRule kovcheg<span class="hljs-number"><span class="hljs-number">-3.</span></span>(.+..+)$ getfile.php?<span class="hljs-type"><span class="hljs-type">name</span></span>=kovcheg<span class="hljs-number"><span class="hljs-number">-3</span></span>&amp;ext=<span class="hljs-meta"><span class="hljs-meta">$1</span></span></code> </pre><br><br>  At the same time, the getfile.php script is here: <br><pre> <code class="hljs xml"><span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?</span></span></span><span class="php"> header(</span><span class="hljs-string"><span class="php"><span class="hljs-string">"Content-type: application/x-gzip"</span></span></span><span class="php">); $name = $HTTP_GET_VARS[</span><span class="hljs-string"><span class="php"><span class="hljs-string">'name'</span></span></span><span class="php">]; $ext = $HTTP_GET_VARS[</span><span class="hljs-string"><span class="php"><span class="hljs-string">'ext'</span></span></span><span class="php">]; $filename = $name.</span><span class="hljs-string"><span class="php"><span class="hljs-string">'.'</span></span></span><span class="php">.$ext; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">if</span></span></span><span class="php"> (!stristr($filename,</span><span class="hljs-string"><span class="php"><span class="hljs-string">'kovcheg'</span></span></span><span class="php">)) </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">exit</span></span></span><span class="php">; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">if</span></span></span><span class="php"> (stristr($filename,</span><span class="hljs-string"><span class="php"><span class="hljs-string">'..'</span></span></span><span class="php">)) </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">exit</span></span></span><span class="php">; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">include</span></span></span><span class="php"> </span><span class="hljs-string"><span class="php"><span class="hljs-string">"../pass_of_db.php"</span></span></span><span class="php">; $db = mysql_connect ($config[mysql_host], $config[mysql_user], $config[mysql_password]); mysql_query(</span><span class="hljs-string"><span class="php"><span class="hljs-string">"SET NAMES utf8"</span></span></span><span class="php">); mysql_select_db($config[base_name],$db); </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">if</span></span></span><span class="php"> (!$db) { </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">echo</span></span></span><span class="php"> </span><span class="hljs-string"><span class="php"><span class="hljs-string">"   SQL :("</span></span></span><span class="php">; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">exit</span></span></span><span class="php">();} $sqlnews2=</span><span class="hljs-string"><span class="php"><span class="hljs-string">"INSERT `1_books_log` (`id`, `identity`, `book`, `page`, `date`, `file`) VALUES (NULL, '"</span></span></span><span class="php">.$_SERVER[</span><span class="hljs-string"><span class="php"><span class="hljs-string">'REMOTE_ADDR'</span></span></span><span class="php">].</span><span class="hljs-string"><span class="php"><span class="hljs-string">' : '</span></span></span><span class="php">.$HTTP_COOKIE_VARS[</span><span class="hljs-string"><span class="php"><span class="hljs-string">'identity'</span></span></span><span class="php">].</span><span class="hljs-string"><span class="php"><span class="hljs-string">"', '-2', '0', NOW(),'"</span></span></span><span class="php">.$filename.</span><span class="hljs-string"><span class="php"><span class="hljs-string">"')"</span></span></span><span class="php">; $result2 = mysql_query($sqlnews2); $fd = fopen ($filename, </span><span class="hljs-string"><span class="php"><span class="hljs-string">"r"</span></span></span><span class="php">); $code = fread ($fd, filesize($filename)); fclose ($fd); </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">switch</span></span></span><span class="php"> ($ext) { </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">case</span></span></span><span class="php"> </span><span class="hljs-string"><span class="php"><span class="hljs-string">'fb2'</span></span></span><span class="php"> : </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">echo</span></span></span><span class="php"> $code; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">break</span></span></span><span class="php">; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">case</span></span></span><span class="php"> </span><span class="hljs-string"><span class="php"><span class="hljs-string">'epub'</span></span></span><span class="php"> : </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">echo</span></span></span><span class="php"> $code; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">break</span></span></span><span class="php">; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">case</span></span></span><span class="php"> </span><span class="hljs-string"><span class="php"><span class="hljs-string">'pdf'</span></span></span><span class="php"> : </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">echo</span></span></span><span class="php"> $code; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">break</span></span></span><span class="php">; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">case</span></span></span><span class="php"> </span><span class="hljs-string"><span class="php"><span class="hljs-string">'mobi'</span></span></span><span class="php"> : </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">echo</span></span></span><span class="php"> $code; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">break</span></span></span><span class="php">; } </span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br><br>  So you can collect statistics for readers who download files, even if the link is on another site. <br><br><h1>  What does my workplace look like? </h1><br>  I write books here: <br><img src="https://habrastorage.org/getpro/habr/post_images/69c/dec/1a6/69cdec1a62372fea525a90161e4208c9.png" alt="Edit the book social network Ark"><br>  Nothing superfluous and when you press F11, you can begin to build crystal locks of the plot in your head.  Nothing distracts.  Chrome checks the literacy of the text during input, and the corrector hired by me, after I finish writing each book.  I have a big trouble with commas, so without a corrector it would be more difficult. <br>  In the title of the browser tab, I count the number of words in the edited chapter, this provides an approximately equal number of words in the chapter (approximately 2000). <br><br><h1>  At the end of the story, comments always go: </h1><br><br><img src="https://habrastorage.org/getpro/habr/post_images/264/373/5f3/2643735f36573a970f3ff7d83273e5e9.png" alt="Comments on the book Ark social network"><br><br>  Comments are what distinguishes the Internet from TV, radio, books, music and movies. <br>  To make a modern book without comments, my hand would not have risen.  The design is familiar to most Internet users, which makes it easier for others to read and write.  You can plyusovat and minusovat comments.  He wrote the scripts himself, nothing complicated about it. <br><br><h1>  What is your book about?  - you ask </h1><br>  Three books and they are different. <br>  <b>1 book:</b> This is a fantastic trilogy about how the main character enters Moscow of the future.  1500 years have passed and the 36th century has come.  Describes with all the details of their gadgets, politics, nature, psychology.  Will the ‚ÄúArk social network‚Äù be able to save humanity?  The beginning may seem boring to someone, so the impatient can start with chapter 18.  At the end of the book, many have a break of patterns and thoughtfulness for several weeks. <br><br>  <b>2 book:</b> Tells about America of our time.  The nature of various human addictions and the methods of their use are described.  You look at the world device that surrounds us from an unexpected angle.  In the story, we come to a new theory of world conspiracy. <br><br>  <b>Book 3:</b> The protagonist and 200,000 people fall on another planet.  She is inhabited by unusual white angels who have dreams that they do not remember.  The main question of the novel, how two civilizations get along with each other. <br><br>  Better than me, <a href="http://www.wezel.ru/%3Fp%3Dcomment">readers</a> will tell about the book. <br><br>  <a href="http://wezel.ru/book/">Enjoy your reading</a> . </div><p>Source: <a href="https://habr.com/ru/post/141739/">https://habr.com/ru/post/141739/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../141731/index.html">Automatic BusyIndicator for asynchronous operations and not only</a></li>
<li><a href="../141732/index.html">Wikipedia switches from Google Maps to OpenStreetMap</a></li>
<li><a href="../141733/index.html">Website development on the portal WebProfessionals.ru with 70% discount</a></li>
<li><a href="../141737/index.html">Startup for adults</a></li>
<li><a href="../141738/index.html">Total BANAN, or wonders of spoofing poppy addresses in Win7</a></li>
<li><a href="../141740/index.html">Modder has equipped a controller for SNES wireless module</a></li>
<li><a href="../141741/index.html">‚ÄúRunet today‚Äù, April 9, 2012. Experts of the issue: Alexey Belyaev, Evgeny Etin</a></li>
<li><a href="../141742/index.html">Startup WebcamTelecom. A look at the communications of the future</a></li>
<li><a href="../141743/index.html">Creating a state machine for parsing an HTTP request</a></li>
<li><a href="../141744/index.html">Cross-platform multithreaded applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>