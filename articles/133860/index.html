<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>bash script with support for long (gnu-style) options</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At first glance, the trivial task appeared: to write a script with various options at startup. Suppose you need to handle only two options: name and d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>bash script with support for long (gnu-style) options</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/b42bc883/724f8b52/a9976b34/d355475e.png" align="left">  At first glance, the trivial task appeared: to write a script with various options at startup.  Suppose you need to handle only two options: name and dir.  And the task is really trivial, provided that our options are short.  But if there is a burning desire to use long options, then write it is gone: getopts, which was planned to be used initially, is not suitable for bash at all. <br><a name="habracut"></a><br>  Although in ksh everything works with a bang: <br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/ksh while getopts "f(file):s(server):" flag do echo "$flag" $OPTIND $OPTARG done</span></span></code> </pre> <br>  But we have a bash, so sadly sigh and try to get out of this situation. <br>  On the one hand, the parse-independent parsing is attractive, but too boring and uninteresting: every time you need to think about handling errors, exceptions and many other things.  And I don‚Äôt want to reinvent the wheel every time I write such a script. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash while true; do case "$1" in -n | --name ) echo NAME="$2"; shift 2;; -d | --dir ) echo DIR="$2"; shift 2;; esac done</span></span></code> </pre> <br>  You can try using getopts with a small hack to support long names: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash while getopts ":n:d:-:" OPTION; do case "$OPTION" in -) case "$OPTARG" in name) echo LONG_NAME="${!OPTIND}";; dir) echo LONG_DIR="${!OPTIND}" ;; esac;; n) echo SHORT_NAME="$OPTARG" ;; d) echo SHORT_DIR="$OPTARG" ;; esac done</span></span></code> </pre> <br>  But to call such a decision a worker, the language does not turn: at the same time only one long option is supported (the first one specified in the parameters), the second one will be ignored. <br><br>  We complain that getopts_long has not yet been stuck in bash, but Google suggests that you can do it yourself: download the <a href="http://stchaz.free.fr/getopts_long">getopts_long</a> function and include it in our script: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash . getopts_long while getopts_long :d:n::vh opt \ name required_argument \ dir required_argument \ help 0 "" "$@" do case "$opt" in n|name) echo NAME="$OPTLARG";; d|dir) echo DIR="$OPTLARG";; help 0 "" "$@" esac done</span></span></code> </pre> <br>  It would seem that this is happiness, but an even more elegant solution was found: a more advanced <a href="http://code.google.com/p/shflags/">shflags</a> library, which, in addition to parsing options, can also check values.  Strings, logical variables, integers, non-integers are distinguished (in fact, they are strings, because the shell does not have the concept of non-integers, but there is a check for correctness of the format. This is determined by specifying variables via DEFINE_string | _boolean | _float | _integer and even independently calls variables for options according to the long option name, also supports a bunch of different shells (sh, bash, dash, ksh, zsh). Beauty and only. You can find more information about the buns in the library itself. There you can find detailed help information. : <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash . ./shflags DEFINE_string 'name' 'world' 'comment for name' 'n' DEFINE_string 'dir' 'dir' 'comment for dir' 'd' FLAGS "$@" || exit 1 eval set -- "${FLAGS_ARGV}" echo "Name is ${FLAGS_name} and dir is ${FLAGS_dir}"</span></span></code> </pre> <br>  However, in this solution there is a fly in the ointment: the library uses getopt for parsing options, and a bent getopt, as they say on the Internet, does not support long options.  So there may be compatibility issues. </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/133860/">https://habr.com/ru/post/133860/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../133855/index.html">Design patterns in automaton programming</a></li>
<li><a href="../133856/index.html">Continuation of the story about the "Heart" of an electronic device or the simplest programming Silicon Labs C8051F320</a></li>
<li><a href="../133857/index.html">Imagine Cup Meeting in Novosibirsk</a></li>
<li><a href="../133858/index.html">Monetizing Android applications using AdMob ads with the option of paid disconnection. Part one</a></li>
<li><a href="../133859/index.html">UK intelligence agencies GCHQ launched a hacking code contest to attract new talent</a></li>
<li><a href="../133862/index.html">Answers to questions about the PlayBook 4G and PIM applications</a></li>
<li><a href="../133863/index.html">Web server performance comparison using Wordpress as an example</a></li>
<li><a href="../133864/index.html">The evening school of Windows Phone returns in a new format</a></li>
<li><a href="../133866/index.html">Report on the First Kiev Habravstreche</a></li>
<li><a href="../133869/index.html">Synthesis and Speech Recognition from Google for Asterisk</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>