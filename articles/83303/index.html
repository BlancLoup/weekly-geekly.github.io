<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Fibonacci numbers (etude on C #)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probably many students had to study recursion using the example of calculating Fibonacci numbers. The problem is unconditionally academic, and it illu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Fibonacci numbers (etude on C #)</h1><div class="post__text post__text-html js-mediator-article">  Probably many students had to study recursion using the example of calculating Fibonacci numbers.  The problem is unconditionally academic, and it illustrates the recursion is clearly worse than the calculation of, say, factorials, but it is interesting because it has many solutions of different degrees of perversion.  In this post - a small sketch on this topic. <br><br><a name="habracut"></a><br>  I think that the default solution for calculating the N-th Fibonacci number will not surprise anyone: <br><br><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fib</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ? fib(n - <span class="hljs-number"><span class="hljs-number">1</span></span>) + fib(n - <span class="hljs-number"><span class="hljs-number">2</span></span>) : n; }</code> </pre> <br>  Also, there is a rather ‚Äúfashionable‚Äù form of the record of this solution which uses the Y-combinator: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs objectivec">Func&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; fib = Y&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(f =&gt; n =&gt; n &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ? f(n - <span class="hljs-number"><span class="hljs-number">1</span></span>) + f(n - <span class="hljs-number"><span class="hljs-number">2</span></span>) : n);</code> </pre><br>  Where <code>Y</code> defined, for example, like this: <br><br><pre> <code class="hljs django"><span class="xml"><span class="xml">static Func</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">A,</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">R</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Y</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">A,</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">R</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">(Func</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Func</span></span></span></span><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">A</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">R</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">, Func</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">A,</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">R</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">&gt; f) { Func</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">A,</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">R</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> g = null; g = f(a=&gt;g(a)); return g; }</span></span></code> </pre><br>  For large N, this approach is unproductive.  How to calculate the number N faster?  First, let's remember why, for example, <code>x*x</code> is considered faster than <code>Math.Pow(x,2)</code> ?  Because for the integer degree, you can not only do without the Taylor series, but also optimize the calculation for large degrees by creating temporary variables.  For example, x <sup>4</sup> can be considered as <code>int y = x * x; return y * y;</code> <code>int y = x * x; return y * y;</code>  - and the greater the degree, the greater the savings. <br><br>  Why am I doing this?  To the fact that the Fibonacci number can be calculated using the following formula: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/39c/140/3e9/39c1403e9f0a7b7a72dda9201163b357.jpg"><br><br><br>  Now I understand why we integer exponentiation?  For matrices, you can do the same, but first you need to understand how this is generally done.  On the Internet, I found a possibly <a href="http://www.johndcook.com/blog/2008/12/10/fast-exponentiation/">perfect algorithm</a> that optimizes integer exponentiation.  Please note that in the example below, the degree is of type <code>short</code> . <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IntPower</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> power</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (power == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (power == <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n = <span class="hljs-number"><span class="hljs-number">15</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((power &lt;&lt;= <span class="hljs-number"><span class="hljs-number">1</span></span>) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) n--; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> tmp = x; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (--n &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) tmp = tmp * tmp * (((power &lt;&lt;= <span class="hljs-number"><span class="hljs-number">1</span></span>) &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) ? x : <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tmp; }</code> </pre><br>  Now it remains to determine the 2 √ó 2 matrix.  Here one could use some kind of library, but I decided to write the simplest possible structure: <br><br><pre> <code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mtx2x2</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _11, _12, _21, _22; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> mtx2x2 <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>*(mtx2x2 lhs, mtx2x2 rhs) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> mtx2x2 { _11 = lhs._11*rhs._11 + lhs._12*rhs._21, _12 = lhs._11*rhs._12 + lhs._12*rhs._22, _21 = lhs._21*rhs._11 + lhs._22*rhs._21, _22 = lhs._21*rhs._12 + lhs._22*rhs._22 }; } }</code> </pre><br>  After that, it was necessary to determine two constants that will be useful to us - the matrix that we will raise to the power and the identity matrix: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> mtx2x2 fibMtx = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> mtx2x2 {_11 = <span class="hljs-number"><span class="hljs-number">1</span></span>, _12 = <span class="hljs-number"><span class="hljs-number">1</span></span>, _21 = <span class="hljs-number"><span class="hljs-number">1</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> mtx2x2 identity = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> mtx2x2 {_11 = <span class="hljs-number"><span class="hljs-number">1</span></span>, _22 = <span class="hljs-number"><span class="hljs-number">1</span></span>};</code> </pre><br>  Now we can rewrite the <code>IntPower()</code> method for 2 √ó 2 matrices: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> mtx2x2 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IntPower</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">mtx2x2 x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> power</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (power == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> identity; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (power == <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n = <span class="hljs-number"><span class="hljs-number">15</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((power &lt;&lt;= <span class="hljs-number"><span class="hljs-number">1</span></span>) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) n--; mtx2x2 tmp = x; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (--n &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) tmp = (tmp * tmp) * (((power &lt;&lt;= <span class="hljs-number"><span class="hljs-number">1</span></span>) &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) ? x : identity); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tmp; }</code> </pre><br>  And define a new method to calculate the Fibonacci number: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fibm</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> IntPower(fibMtx, (<span class="hljs-keyword"><span class="hljs-keyword">short</span></span>)(n<span class="hljs-number"><span class="hljs-number">-1</span></span>))._11; }</code> </pre><br>  That's all.  I think that comparing the performance is meaningless - I have <code>fib(40)</code> considered 4 seconds, and <code>fibm(40)</code> is displayed immediately.  ‚ñ† </div><p>Source: <a href="https://habr.com/ru/post/83303/">https://habr.com/ru/post/83303/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../83294/index.html">Typography for BuEditor by artlebedev</a></li>
<li><a href="../83296/index.html">LG explains how to watch pirated movies</a></li>
<li><a href="../83297/index.html">To reach heaven</a></li>
<li><a href="../83300/index.html">Adaptive horizontal menu</a></li>
<li><a href="../83302/index.html">Comparative review of Tweetie2 and TwitBird</a></li>
<li><a href="../83307/index.html">Will Google add the ability to browse stores to Street View?</a></li>
<li><a href="../83308/index.html">Online store and other updates</a></li>
<li><a href="../83309/index.html">Chrome 5.0.317.2</a></li>
<li><a href="../83311/index.html">Recursive pictures</a></li>
<li><a href="../83312/index.html">Safari - we block flash</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>