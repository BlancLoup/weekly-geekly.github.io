<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dependency Injection Container from PHPixie</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I do not like DI containers. Yes, they are convenient, but over time a lot of problems arise with them, so PHPixie uses the classic approach with the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dependency Injection Container from PHPixie</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/7cd/47c/66c/7cd47c66c5df9f4b83f7886240a1cba2.png" alt="image" align="right"><br>  I do not like DI containers.  Yes, they are convenient, but over time a lot of problems arise with them, so PHPixie uses the classic approach with the <i>Factory</i> pattern.  The ability to get any service from the container sometimes breaks the logical chain of the program, for example, when some validator pulls a service from a completely different bundle in Symfony2.  It is even worse when it is used as a <i>Service Locator</i> where all dependencies are obtained through a call in the style of <i>Locator :: get ('doctrine.entityManager')</i> .  In addition, different container implementations encourage configuration storage in YML and XML files, which sometimes makes debugging difficult.  But recently, I remembered the phrase ‚ÄúDo not think that a developer is a fool‚Äù, that is, not to impose your point on when designing an architecture.  In addition, it is difficult to argue with the fact that small projects are much easier to build using a container and / or dependency locator. <br><br>  Meet the <a href="https://phpixie.com/">PHPixie</a> DI. <br><a name="habracut"></a><br>  It should be noted right away that it is not used in the framework itself, although it comes with the default bundle as a fully optional component.  There are no dependencies, so you can use it completely separately from PHPixie. <br><br>  <b>Config</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To build a container, you need to expand the base class and override the <i>configure</i> method in it, for example: <br><br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Container</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPixie</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DI</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Container</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Root</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     $this-&gt;value('apiToken', '1234567890'); //    $this-&gt;callback('addFive', function($a, $b) { return $a + $b; }); //      , //      $this-&gt;build('twitterService', function() { return new TwitterService($this-&gt;apiToken()); //  return new TwitterService($this-&gt;get('apiToken')); }); //     : $this-&gt;instance('twitterService', TwitterService::class, ['@apiToken']); //      '@'        //   $this-&gt;group('user', function() { $this-&gt;instance('repository', UserRepository::class, ['@twitterService']); }); } } //   $container = new Container(); //    $container-&gt;get('apiToken'); $container-&gt;apiToken(); //     //    Container::apiToken(); Container::get('apiToken'); //   //        $container-&gt;add(6, 7); // 13 $container-&gt;call('add', [6, 7]); $callable = $container-&gt;get('add'); $callable(6, 7); //    $container-&gt;get('user.repository'); $userGroup = $container-&gt;user(); $userGroup-&gt;repository(); Container::user()-&gt;repository(); // ...</span></span></code> </pre> <br><br>  As an additional bonus, using the container, you can access the methods of the classes, for example, let's <i>say</i> there is a <i>getTweets</i> method in the <i>TwitterService</i> class, then you can do this: <br><br><pre> <code class="php hljs">$container-&gt;get(<span class="hljs-string"><span class="hljs-string">'twitterService.getTweets'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// $container-&gt;twitterService()-&gt;getTweets(); //   $container-&gt;call('twitterService.getTweets.first.delete', [true]); // $container-&gt;twitterService()-&gt;getTweets()-&gt;first()-&gt;delete(true); //     </span></span></code> </pre><br><br>  By the way, all methods <i>value</i> , <i>callback</i> , <i>build</i> and <i>instance are</i> declared as <i>protected</i> .  So, after building the container, nothing can be added or changed to it, which will protect you from being able to shoot yourself in the foot of changing the container on the fly (debugging is very unpleasant then).  But if you still need to configure it from the outside, you can always make it public.  By the way, ‚Äúconfiguration only from the inside‚Äù is one of my favorite features. <br><br>  <b>IDE Tips</b> <br>  It's worth mentioning that there is an opportunity to add annotations to the class that will allow most IDEs to prompt you with the names of the methods: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@method</span></span></span><span class="hljs-comment"> TwitterService twitterService() * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@method</span></span></span><span class="hljs-comment"> static TwitterService twitterService() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Container</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//... }</span></span></code> </pre><br><br>  <b>Use with PHPixie</b> <br><br>  Create a container class in your bundle: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    ,    //     class Container extends \PHPixie\DefaultBundle\Container { public function configure() { //.... parent::configure(); } }</span></span></code> </pre><br><br>  And add it to Builder: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Builder</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPixie</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultBundle</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Builder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildContainer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Container(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>); } }</code> </pre><br><br>  Builder will automatically create an instance of the container, so you can safely use static methods.  Well, a few examples: <br><br><pre> <code class="php hljs">$container = $builder-&gt;container(); $container-&gt;get(<span class="hljs-string"><span class="hljs-string">'components.orm'</span></span>); $query = $container-&gt;call(<span class="hljs-string"><span class="hljs-string">'components.orm.query'</span></span>, [<span class="hljs-string"><span class="hljs-string">'user'</span></span>]); $builder = Container::builder(); $frameworkBuilder = Container::frameworkBuilder();</code> </pre><br><br>  I hope you enjoy the new component and add <i>‚Äúphpixie / di‚Äù: "~ 3.0"</i> to your <i>composer.json</i> . </div><p>Source: <a href="https://habr.com/ru/post/301648/">https://habr.com/ru/post/301648/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../301636/index.html">Add dependencies to CDI. Part 1</a></li>
<li><a href="../301640/index.html">IPython notebook data processing for SEO tasks</a></li>
<li><a href="../301642/index.html">Positive Hack Days VI WAF Bypass Contest</a></li>
<li><a href="../301644/index.html">We are testing asynchronous code.</a></li>
<li><a href="../301646/index.html">Template Description Language Snakeskin</a></li>
<li><a href="../301650/index.html">Every vacancy on ‚ÄúMy Circle‚Äù is qualified by specialists</a></li>
<li><a href="../301652/index.html">Cisco learning old school</a></li>
<li><a href="../301654/index.html">Fast video encoding for Linux with Nvidia NVENC with SDK 7.5 and ffmpeg 3.0.2 on Nvidia GTX 960/970/980</a></li>
<li><a href="../301656/index.html">7 signs that you are the future boss</a></li>
<li><a href="../301658/index.html">How to complete long-term goals</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>