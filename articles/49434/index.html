<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Optimization of the process of creating unit tests</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! Habrayuzer shai_xylyd wrote an article about the aspects of testing, where they considered some of the concepts and values ‚Äã‚Äãof TDD. In particu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Optimization of the process of creating unit tests</h1><div class="post__text post__text-html js-mediator-article">  Hello!  Habrayuzer <a href="https://habrahabr.ru/users/shai_xylyd/" class="user_link">shai_xylyd</a> <a href="http://habrahabr.ru/blogs/testing/48727/">wrote</a> an article about the aspects of testing, where they considered some of the concepts and values ‚Äã‚Äãof TDD.  In particular, he mentioned a very interesting way to create primary unit tests - when a functional code is written in conjunction with a unit test code, which intrigued me a lot. <br><br>  The fact is that I (as a programmer), am in a state of transition between ‚Äúclassical‚Äù development and development of test-driven, so I‚Äôm looking for ways to simplify and make the latter more natural.  After a couple of squats, <a href="https://habrahabr.ru/users/shai_xylyd/" class="user_link">I was</a> unable to immediately join the <a href="https://habrahabr.ru/users/shai_xylyd/" class="user_link">shai_xylyd</a> technique.  He began a correspondence with the author of the article, where he gave me the idea to approach the solution from a mathematical point of view.  The idea is to take advantage of the functional space of the programming environment and ‚Äúdecompose‚Äù the writing of the unit test into its components.  Then draw conclusions. <br><a name="habracut"></a><br><h3>  Theory </h3><br>  First, a couple of definitions. <br><br>  The primary unit test is a block of code that covers the ‚Äúmain‚Äù function of the entity being tested. <br>  A secondary unit test is a block of code that covers the ‚Äúmain‚Äù function of the tested entity in boundary conditions. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The space <code>Rp</code> is a finite set of essential data of the programming environment. <br>  (In other words, this is the set of existing instances of any data type of a fixed development platform). <br><br>  The function <code>f(x) : Rp -&gt; Rp</code> is the name of a certain code sequence executed on the data <code>x</code> from <code>Rp</code> . <br>  (An example is, in the particular case, <code>f(x)</code> is a simple class method that takes <code>x</code> as input. If it is even tougher, then <code>f</code> is just a line of code). <br><br>  I need to determine the primary unit test (hereinafter just a test). <br><br>  Let <code>z = h(x)</code> , where <code>h</code> is a test function.  Fix some value <code>x <sub>o</sub></code> , then <code>z <sub>o</sub> = h(x <sub>o</sub> )</code> .  Now we define the function <code>a(z <sub>o</sub> )</code> , which returns 0 (if <code>z <sub>o</sub></code> incorrect) or 1 (if <code>z <sub>o</sub></code> correct).  In other words, we took some test data <code>x <sub>o</sub></code> , made some manipulations with them in the form of <code>h(x <sub>o</sub> )</code> and got <code>z <sub>o</sub></code> .  Then we made an <code>assert</code> for the received data <code>z <sub>o</sub></code> and checked the validity of the test. <br>  If translated into pseudo-code, then the test will be the following sequence of pseudo-code: <br><br> <code>def x <sub>o</sub> <br> z <sub>o</sub> = h(x <sub>o</sub> ) <br> a(z <sub>o</sub> ) <br></code> <br><br>  Let <code>f(x)</code> be a functional code (one that will work in the entity being developed). <br>  According to the method described at the very beginning, I have to write functional code together with the test code.  I.e: <br>  <code>z = h(x) = f(m(x))</code> , where <code>m(x)</code> is an auxiliary code: stub objects of the functional code dependencies, framework framework structures, etc.  (further <code>m(x)</code> - moki) <br><br>  Now a very important calculation: the nature of mocks is such as to deliver test data unchanged.  Those.  The essence of the mock object is to replace the dependency behavior in a test by producing a test data set defined by the programmer.  In other words, <code>m(x) = x</code> .  Hence the separation <code>f(m(x)) = f(x)</code> .  The latter allows you to clearly describe the test creation algorithm, where the functional code is developed together with the test code. <br><br><h3>  Algorithm </h3><br><ol><li>  Test data definition and validation <br><br> <code>def x <sub>o</sub> <br> def z <sub>o</sub> <br> a(z <sub>o</sub> ) <br></code> <br></li><li>  Creation of functional code <br><br> <code>def x <sub>o</sub> <br> z <sub>o</sub> = f(x <sub>o</sub> ) <br> a(z <sub>o</sub> ) <br></code> <br></li><li>  Creating mocks and auxiliary test code <br><br> <code>def x <sub>o</sub> <br> z <sub>o</sub> = f(m(x <sub>o</sub> )) <br> a(z <sub>o</sub> ) <br></code> <br></li><li>  Refactoring - putting <code>f(x)</code> into the entity being developed <br><br> <code>def x <sub>o</sub> <br> z <sub>o</sub> = h(x <sub>o</sub> ) <br> a(z <sub>o</sub> ) <br></code> <br></li></ol><br><br>  At each stage, the test should run successfully.  What is important, the TDD property is preserved - first we write a test for the entity, then the entity itself. <br><br><h3>  Practice and examples </h3><br>  I will try this method on <strike>cats</strike> myself.  Platform - .net, language - C #, test pad - NUnit 2.x + Rhino Mocks 3.x <br><br>  The task is as follows.  There is a topology of plants.  You need to define a microservice, which, by a plant identifier, returns an instance of the ‚ÄúPlant‚Äù class: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">/// &lt;summary&gt;</font> <br> <font color="#008000">///     </font> <br> <font color="#008000">/// &lt;/summary&gt;</font> <br> <font color="#008000">/// &lt;remarks&gt;</font> <br> <font color="#008000">///  ,        </font> <br> <font color="#008000">/// &lt;/remarks&gt;</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">interface</font> INodeResolver <br> { <br> <font color="#008000">/// &lt;summary&gt;</font> <br> <font color="#008000">///    </font> <br> <font color="#008000">/// &lt;/summary&gt;</font> <br> <font color="#008000">/// &lt;param name="id"&gt; &lt;/param&gt;</font> <br> <font color="#008000">/// &lt;returns&gt;&lt;/returns&gt;</font> <br> Node FindById( <font color="#0000ff">int</font> id); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  <code>ITopologyService</code> is responsible for these topologies: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">/// &lt;summary&gt;</font> <br> <font color="#008000">///   </font> <br> <font color="#008000">/// &lt;/summary&gt;</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">interface</font> ITopologyService <br> { <br> <font color="#008000">/// &lt;summary&gt;</font> <br> <font color="#008000">///  ""  (, , , , etc)</font> <br> <font color="#008000">/// &lt;/summary&gt;</font> <br> DataSets.TopologyData GetTopology(IDataFilter filter); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Those.  I need to create a service that has a dependency on <code>ITopologyService</code> , receives data from it and creates a new instance of the <code>Node</code> class using the passed identifier. <br><br><h4>  Creating a test </h4><br><br>  Step 1. You need to define the test data and the resulting value. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">[Test] <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> FindNodeByIdTest() <br> { <br> <font color="#008000">// x0</font> <br> TopologyData data = <font color="#0000ff">new</font> TopologyData(); <br> data.Node.AddNodeRow(1, <font color="#A31515">"1"</font> , <font color="#2B91AF">Guid</font> .NewGuid()); <br> <br> <font color="#008000">// z0</font> <br> Node node = <font color="#0000ff">new</font> Node { Id = 1, Name = <font color="#A31515">"1"</font> }; <br> <br> Assert.AreEqual(1, node.Id); <br> Assert.AreEqual( <font color="#A31515">"1"</font> , node.Name); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Step 2. Determine the functionality of the developed entity (by the plant identifier get the object "plant") <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">[Test] <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> FindNodeByIdTest2() <br> { <br> <font color="#008000">// x0</font> <br> TopologyData data = <font color="#0000ff">new</font> TopologyData(); <br> data.Node.AddNodeRow(1, <font color="#A31515">"1"</font> , <font color="#2B91AF">Guid</font> .NewGuid()); <br> <br> <font color="#008000">// f(x0)</font> <br> TopologyData.NodeRow nodeRow = data.Node.FindByID(1); <br> <br> <font color="#008000">// z0</font> <br> Node node = <font color="#0000ff">new</font> Node { Id = 1, Name = nodeRow.Description }; <br> Assert.AreEqual(1, node.Id); <br> Assert.AreEqual( <font color="#A31515">"1"</font> , node.Name); <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Step 3. Create moki <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">[Test] <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> FindNodeByIdTest3() <br> { <br> MockRepository repo = <font color="#0000ff">new</font> MockRepository(); <br> <br> <font color="#008000">// x0</font> <br> TopologyData data = <font color="#0000ff">new</font> TopologyData(); <br> data.Node.AddNodeRow(1, <font color="#A31515">"1"</font> , <font color="#2B91AF">Guid</font> .NewGuid()); <br> <br> <font color="#008000">// m(x0)</font> <br> ITopologyService service = repo.StrictMock&lt;ITopologyService&gt;(); <br> service.Expect(x =&gt; x.GetTopology(EmptyFilter.Instance)).Return(data).Repeat.Once(); <br> <br> repo.ReplayAll(); <br> <br> <font color="#008000">// f(m(x0)) = f(x0)</font> <br> TopologyData dataSet = service.GetTopology(EmptyFilter.Instance); <br> TopologyData.NodeRow nodeRow = dataSet.Node.FindByID(1); <br> <br> repo.VerifyAll(); <br> <br> <font color="#008000">// z0</font> <br> Node node = <font color="#0000ff">new</font> Node { Id = 1, Name = nodeRow.Description }; <br> Assert.AreEqual(1, node.Id); <br> Assert.AreEqual( <font color="#A31515">"1"</font> , node.Name); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Step 4: Refactoring and creating an entity: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">[Test] <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> FindNodeByIdTest4() <br> { <br> MockRepository repo = <font color="#0000ff">new</font> MockRepository(); <br> <br> <font color="#008000">// x0</font> <br> TopologyData data = <font color="#0000ff">new</font> TopologyData(); <br> data.Node.AddNodeRow(1, <font color="#A31515">"1"</font> , <font color="#2B91AF">Guid</font> .NewGuid()); <br> <br> <font color="#008000">// m(x0)</font> <br> ITopologyService service = repo.StrictMock&lt;ITopologyService&gt;(); <br> service.Expect(x =&gt; x.GetTopology(EmptyFilter.Instance)).Return(data).Repeat.Once(); <br> <br> repo.ReplayAll(); <br> <br> NodeResolver resolver = <font color="#0000ff">new</font> NodeResolver(service); <br> <font color="#008000">// z0</font> <br> Node node = resolver.FindById(1); <br> <br> repo.VerifyAll(); <br> <br> Assert.AreEqual(1, node.Id); <br> Assert.AreEqual( <font color="#A31515">"1"</font> , node.Name); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  The developed entity <code>NodeResolver</code> turned out like this: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">/// &lt;summary&gt;</font> <br> <font color="#008000">///   </font> <br> <font color="#008000">/// &lt;/summary&gt;</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> NodeResolver : INodeResolver <br> { <br> <font color="#0000ff">public</font> NodeResolver(ITopologyService topologyService) <br> { <br> Guard.ArgumentNotNull(topologyService, <font color="#A31515">"service"</font> ); <br> _data = topologyService.GetTopology(EmptyFilter.Instance); <br> } <br> <br> <font color="#0000ff">#region</font> INodeResolver Members <br> <br> <font color="#0000ff">public</font> Node FindById( <font color="#0000ff">int</font> id) <br> { <br> <font color="#008000">// f(x)</font> <br> <font color="#0000ff">return</font> <font color="#0000ff">new</font> Node { Id = id, Name = _data.Node.FindByID(id).Description }; <br> } <br> <br> <font color="#0000ff">#endregion</font> <br> <br> <font color="#0000ff">private</font> TopologyData _data; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br><h3>  findings </h3><br>  Perhaps the most obvious advantage of the proposed method over the usual method of writing tests (when 4 is first executed and then <code>f(x)</code> is implemented) is the time saving and ‚Äúsmearing‚Äù of the development.  The programmer no longer has to spend time on code that does not directly relate to the functionality of the program.  He writes the code together with the test, making two rabbits one (the refactoring itself is o-small, which can be discarded). <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/49434/">https://habr.com/ru/post/49434/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../49421/index.html">Are the booty guys kinky? writing a morphological analyzer in Python</a></li>
<li><a href="../49428/index.html">We master Python. Ounce Zero. Introduction</a></li>
<li><a href="../49431/index.html">As we were not taken in Yandex.Catalog on a paid basis</a></li>
<li><a href="../49432/index.html">.NET StockTrader Sample Application</a></li>
<li><a href="../49433/index.html">OpenDesktop.org introduces the possibility of selling content.</a></li>
<li><a href="../49435/index.html">Ruby / Python programming training</a></li>
<li><a href="../49437/index.html">1992‚Äì2009</a></li>
<li><a href="../49439/index.html">Fugue updated! 1.2.5 from 01/19/09</a></li>
<li><a href="../49442/index.html">Bookmarks to show source code with highlight on your page</a></li>
<li><a href="../49443/index.html">Fixed a bug in Ubuntu that caused hard drive wear</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>