<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Java Garbage Collection on Infobox Jelastic cloud hosting</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Performance and price are two of the most significant factors in application hosting. We often ask ourselves how to spend less without degrading appli...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Java Garbage Collection on Infobox Jelastic cloud hosting</h1><div class="post__text post__text-html js-mediator-article">  Performance and price are two of the most significant factors in application hosting.  We often ask ourselves how to spend less without degrading application performance.  In this article, we will look at automatic memory management for Java applications hosted on <a href="http://infobox.ru/hosting/cloud/">Infobox Jelastic cloud hosting</a> using garbage collection and Jelastic GC Agent.  At the end of the article a little surprise. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6f2/e84/496/6f2e844964c25e2a05a1e3e7874928e1.png" title="Infobox Jelastic reduce costs" alt="Infobox Jelastic reduce costs" width="600"><br><br>  First, let's define what garbage collection is and what it does for our Java application.  Then we will talk in more detail from garbage collection processes in Jelastic. <br><a name="habracut"></a><br><h4>  Garbage collection in Java: materiel </h4><br>  Garbage Collection (GC) is a form of automatic memory management.  Its goal is to search for objects in memory that applications no longer need and free up space they take up for future use. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The created object uses a certain amount of memory that remains allocated as long as there are references to this object.  If there are no references to an object, it is considered no longer necessary and the memory occupied by it can be freed.  Thus, you do not pay for unused resources and can reduce your costs. <br><br><h4>  GC settings in Jelastic by default </h4><br>  If the user does not specify his own settings, Jelastic will configure the garbage collector as follows: <br><ul><li>  ParNew for all servers with a resource limit of less than 8 GB; </li><li>  G1 for servers with a resource limit of more than 8 GB (64 or more cloudsets). </li></ul><br>  In this case, it does not matter how many clouds are consumed at a particular point in time.  The garbage collector checks the maximum limit - the maximum number of cloudlet you allocate to the appropriate server. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7f9/b19/f11/7f9b19f11db541eddf519c9d03d7b3c9.jpg" title="Infobox Jelastic Scaling Limit" alt="Infobox Jelastic Scaling Limit" width="600"><br><br><h4>  ParNew garbage collector </h4><br>  ParNew - ‚Äústop the world‚Äù multithreaded garbage collector.  He collects the younger generation of objects.  Since the younger generation is usually small, in Jelastic this collector is used only for servers with a resource limit of less than 8 GB.  An assembly based on the size of objects runs very quickly and has little effect on the operation of your application.  In addition, the ParNew collector can free up unused memory, which allows vertical autoscaling to work correctly - one of the main functions of Jelastic. <br><br><h4>  Garbage ‚Äì First garbage collector </h4><br>  Garbage-First (G1) is a server-type garbage collector for multiprocessor machines with large amounts of memory.  A heap is divided into areas of fixed size and G1 tracks live data in these areas.  When garbage collection is needed, gc starts with areas with less live data. <br><br>  G1 focuses on applications that need large heaps with limited delays in garbage collection.  After in-depth analysis, we concluded that 8 GB of memory is enough to use G1. <br><br>  Together with these settings, the Jelastic specialized garbage collection agent is used, freeing up the used JVM memory in the OS. <br><br><h4>  Customizing GC settings in Jelastic </h4><br>  If you are sure that the default GC settings in Jelastic are not optimal for your application, you can set them according to your needs.  We recommend changing the settings only if you fully understand the effect they will have on the performance of your application. <br><br>  You can set your garbage collection (GC) parameters based on the requirements of your application: <br><ul><li>  by editing your server's Tomcat, TomEE, or Jetty <strong>variables.conf</strong> file </li><li>  by changing the JVM settings in the GlassFish server admin panel </li></ul><br>  1. To configure Tomcat, TomEE, or Jetty, open the configuration files for your Java server. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2d3/0e7/890/2d30e78902c1b817f95520a05d2f356e.png"><br><br>  2. Go to <strong>server</strong> &gt; <strong>variables.conf</strong> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d5c/8b3/05c/d5c8b305c23ba4760d0e2f03b22ef0b4.png"><br><br>  3. In the open <strong>variables.conf</strong> file, you can specify the necessary garbage collector by setting one of the following values ‚Äã‚Äãas the GC parameter: <br><br><pre><code class="java hljs">-XX:+UseParNewGC -XX:+UseG1GC -XX:+UseConcMarkSweepGC -XX:+UseSerialGC</code> </pre> <br>  4. When setting up GlassFish, you should use the same format of the GC parameter. <br>  Open the GlassFish admin panel, go to <strong>Configurations</strong> &gt; <strong>gfcluster-config</strong> &gt; <strong>JVM Settings</strong> &gt; <strong>JVM Options</strong> and edit the corresponding line as shown in the image below. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/07a/40e/a48/07a40ea485c94a3d2439fa45276d5118.png" width="800"><br><br>  5. After that, when launching your Java server, only the garbage collector you specify will be used, regardless of the allocated resources. <br><br>  Please note that GC agent Jelastic works only with two types of garbage collectors: <br><br><pre> <code class="java hljs">-XX:+UseParNewGC&lt;/li&gt; -XX:+UseG1GC&lt;/li&gt;</code> </pre><br>  If you manually specify another garbage collector, full garbage collection will be disabled. <br><br>  6. You can also reduce the garbage collector's use of processor power and control how the JVM uses heap memory.  To do this, you need to adjust the frequency of running garbage collection, specifying the -Xmx and -Xms parameters. <br><br>  The <b>-Xmx</b> parameter <b>is</b> used to run a JVM with a large maximum heap and free up processor time for important processes. <br><br>  The <strong>-Xms option</strong> ensures that the initial size of the JVM memory heap is equal to the maximum allocated memory limit (scaling limit). <br><br>  These parameters must be specified in the <strong>variables.conf</strong> file for Tomcat, TomEE and Jetty or in the JVM settings for GlassFish. <br><br><pre> <code class="java hljs">-Xmx&lt;&gt;m -Xms&lt;&gt;m</code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/14a/750/a5c/14a750a5c16125053617a78e34ba6e3e.png" width="800"><br><br><h4>  Jelastic garbage collection agent </h4><br>  Releasing a reserved, but at the same time, unused JVM memory in the OS is necessary for vertical autoscaling.  Therefore, Jelastic uses a special <strong>garbage collection agent</strong> . <br><br>  GC agent Jelastic includes an intelligent algorithm for monitoring consumed and free memory.  By processing the monitoring results, he recognizes the ability to free up some of the memory for the OS and starts the full garbage collection.  If the JVM does not have free memory that can be released for the OS, the Jelastic GC agent does not start the full garbage collection.  This approach can potentially reduce the degradation of application performance to zero. <br><br>  GC Jelastic agent works only for two types of garbage collectors (configured in Jelastic by default): <br><br><pre> <code class="java hljs">-XX:+UseParNewGC -XX:+UseG1GC</code> </pre><br>  If you change the default GCs to any other ones that do not support compression and do not free up memory for the OS, the Jelastic GC agent will be disabled and will not be able to run full garbage collection. <br><br>  To configure the Jelastic agent GC, go to <strong>server</strong> &gt; <strong>variables.conf</strong> for Tomcat, TomEE or Jetty server. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9f7/cf5/38d/9f7cf538d10cc1f345d196ac255e640d.png" width="800"><br><br>  For GlassFish GC, the Jelastic agent can be configured or disabled via the GlassFish administration panel in the <strong>gfcluster-config</strong> &gt; <strong>JVM Settings</strong> &gt; <strong>JVM Options</strong> section. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/349/b8d/718/349b8d718e156fbcb5f17028455f73ee.png" width="800"><br><br><h4>  Enable / Disable Gel Jelastic Agent </h4><br>  GC Jelastic agent is enabled by default for all newly created Java application servers. <br><br>  If you want to enable the GC Jelastic agent in an existing container, you should load the <a href="https://download.jelastic.com/public.php%3Fservice%3Dfiles%26t%3Daab2ed7d1ecb03dbd9dd9c8dcb92ff83%26download">jelastic-gc-agent.jar file</a> and turn on the agent manually as follows: <br>  1. Download the <a href="https://download.jelastic.com/public.php%3Fservice%3Dfiles%26t%3Daab2ed7d1ecb03dbd9dd9c8dcb92ff83%26download">jelastic-gc-agent.jar file</a> . <br>  2. Go to the <strong>configuration files of</strong> your Java server and upload the downloaded <strong>.jar</strong> file to the <strong>home</strong> folder. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/53f/3ff/e64/53f3ffe6402bf7c5d01106fce13d11c5.png"><br><br>  3. Go to <strong>server</strong> &gt; <strong>variables.conf</strong> and specify the path to your <strong>jelastic-gc-agent.jar file</strong> in the <strong>-javaagent</strong> parameter. <br>  The path depends on the Java server you are using: <br><ul><li>  <strong>Tomcat / TomEE</strong> : / opt / tomcat / temp </li><li>  <strong>GlassFish</strong> : / opt / glassfish3 / temp </li><li>  <strong>Jetty</strong> : / opt / jetty / home </li></ul><br>  4. Save the changes and restart the server. <br><br>  If you notice that the Jelastic agent GC processes have caused performance degradation for your application, comment out the following line and restart the server: <br>  <strong>-javaagent: /var/lib/jelastic/java/jelastic-gc-agent.jar</strong> <br><br><h4>  Change of inspection period </h4><br>  By default, the GC agent Jelastic performs a system check every <strong>15 minutes</strong> (starting with each JVM launch) to force the memory of unused applications to be freed.  The checkout period can be changed according to your needs. <br><br>  To change the validation period, specify the time between runs of full garbage collection in seconds, as shown below: <br><br>  <strong>-javaagent: /var/lib/jelastic/java/jelastic-gc-agent.jar=period=900</strong> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0f4/2c6/b96/0f42c6b96bfbcf4e63f6f3f8721f525b.png" width="800"><br><br>  To apply the changes, save the file and restart the server. <br><br><h4>  Enable debug mode </h4><br>  You can enable debug mode as follows: <br><br>  <strong>-javaagent: /var/lib/jelastic/java/jelastic-gc-agent.jar=debug=true</strong> <br><br>  As a result, you can track the processes of the GC logs. <br><br>  Please note that you can use both options (changing the test period and turning on debug mode) together: <br><br>  <strong>-javaagent: /var/lib/jelastic/java/jelastic-gc-agent.jar=debug=true,period=900</strong> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/983/026/d88/983026d8851c95b3a726b14506e7116a.png" width="800"><br><br>  Save the changes and restart the server. <br><br><h4>  Verify garbage collection results </h4><br>  To display the results of the configured periodic system checks and freeing memory, we will use the special <a href="https://download.jelastic.com/public.php%3Fservice%3Dfiles%26t%3Dbfc4cfcf4af68455c592d37e4a5baa46%26download">Loader</a> application. <br><br>  1. <a href="https://download.jelastic.com/public.php%3Fservice%3Dfiles%26t%3Dbfc4cfcf4af68455c592d37e4a5baa46%26download">Follow the</a> link and download the <a href="https://download.jelastic.com/public.php%3Fservice%3Dfiles%26t%3Dbfc4cfcf4af68455c592d37e4a5baa46%26download">Loader.war</a> archive with the test application. <br><br>  2. Download this <strong>.war</strong> archive to Jelastic. <br><br>  3. Deploy this application in an environment with a Java application. <br><br>  4. Open the <strong>configuration files</strong> and go to the <strong>server</strong> &gt; <strong>variables.conf</strong> file to check the Jelastic agent Java settings. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/29b/532/6eb/29b5326ebe5e45876e7c7269fd9f28f6.png" width="800"><br><br>  In our case, to get the results as soon as possible, we changed the period to 60 seconds.  If you change the settings, do not forget to save the changes and restart the server. <br><br>  5. After that, open the application in a browser and add the following parameters to the link: <br>  <strong>/ loader? mem = 500 &amp; duration = 300</strong> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8ed/d96/209/8edd96209d5380487ac7ca190cab5c9e.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/553/a92/8a8/553a928a82577f413d761621dbb842e9.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/73f/a94/d4b/73fa94d4b18832f83a5a0abd6d6f8efb.png"><br>  6. Now you can go to <strong>Statistics</strong> , where, after a while, you will see the results. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/86b/c3e/d6b/86bc3ed6bbf7ad141660e06436f14c3c.png"><br><br>  When you run an application request with the parameters added to the link, the memory consumption increases by 500 MB.  This amount of memory will be used for 300 seconds (also in accordance with the specified parameter). <br><br>  After that, memory usage will decrease as a result of launching with GC Jelastic agent for complete garbage collection.  This is because the GC agent sees the opportunity to free up memory, because the application has completed its active processes and no longer needs the full amount of memory. <br><br>  You can run the test application a few more times to load the memory and test its release process. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/62e/728/bb1/62e728bb1808bb28e440fef24d79c024.png" width="800"><br><br>  7. Since we enabled the debug mode for our Java agent, we can also track the process in the <strong>Log</strong> files. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/322/790/cde/322790cdec206f31d98512b39ea06ebf.png"><br><br>  The amount of available free memory (in bytes) can be viewed in <strong>catalina</strong> logs. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b5f/3a8/49b/b5f3a849b21cb64041eea3f278c25ab2.png" width="800"><br><br>  Thus, using this method, you can improve memory management for your application, which will reduce the memory consumption of the JVM.  As a result, you will save your money and increase the performance of your application. <br><br><h4>  300 rubles for Jelastic as a gift! </h4><br>  To everyone who read to the end of the article, we give 300 rubles to your Jelastic account.  <a href="http://infobox.ru/hosting/cloud/">Register in the trial version</a> , after the end of the trial, click on the button ‚ÄúSwitch to the paid version‚Äù in Jelastic, fill in the information about yourself and send your login to <a href="">trukhinyuri@infoboxcloud.com</a> . <br><br>  Successful use of Jelastic in the Infobox and great mood! </div><p>Source: <a href="https://habr.com/ru/post/230663/">https://habr.com/ru/post/230663/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../230651/index.html">An overview of the ST Nucleo developer platform using the example of Nucleo-F401RE</a></li>
<li><a href="../230655/index.html">Beaver mysql logger or how to find an error in the MySql application</a></li>
<li><a href="../230657/index.html">Ulefone U7 - thin phablet</a></li>
<li><a href="../230659/index.html">Home library of the modern child</a></li>
<li><a href="../230661/index.html">Web server in 5 minutes based on PIC and W5100</a></li>
<li><a href="../230665/index.html">‚Äú65K methods will be enough for everyone‚Äù or how to deal with the limit of DEX methods in Android</a></li>
<li><a href="../230667/index.html">NASA is considering the placement of cosmonaut settlements on the moon in lunar caves</a></li>
<li><a href="../230669/index.html">Interactive - a new scientific term or a manifesto of love for games</a></li>
<li><a href="../230671/index.html">Chart rendering: not as easy as it sounds</a></li>
<li><a href="../230673/index.html">How to return the domain "with interest"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>