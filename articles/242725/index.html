<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automatic connection of network multifunction devices with the ability to scan [Part 2]</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kyocera M2035dn, Xerox WorkCentre 3615 and 6505DN 
 As promised in the first part , for which I successfully received an invite in the sandbox, in thi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automatic connection of network multifunction devices with the ability to scan [Part 2]</h1><div class="post__text post__text-html js-mediator-article"><h1>  Kyocera M2035dn, Xerox WorkCentre 3615 and 6505DN </h1><br>  As promised in the <a href="http://habrahabr.ru/post/242513/">first part</a> , for which I successfully received an invite in the sandbox, in this article I will show how to connect the network multifunction devices Kyocera M2035dn, Xerox WorkCentre 3615 and 6505DN, and at the end of the article I will add a small bonus with which any script associated with the network becomes better . <br><br><img src="https://habrastorage.org/files/d60/8f5/e45/d608f5e454ac4aa8ad9e17657ce5aabd.png"><br><br>  No matter how beautiful the homogeneous infrastructures are, even in the part of printers and MFP, reality often sets its own conditions.  While the users themselves were fully connected and successfully scanned from the once problematic HP MFPs, a Japanese guest came to the company - Kyocera M2035dn. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  Kyocera M2035dn </h1><br>  I arrived, as always, not in my cozy admin's lair, but immediately at the object and, like the mfp from HP, I, frankly, didn‚Äôt even see it in my eyes. <br>  First of all, download the driver and watch the contents ... ba, all the familiar people: <br><br><img src="https://habrastorage.org/files/de5/da0/d60/de5da0d60a1146d086dd6418174b26b0.png"><br><br>  There is a note that the network connection is the ID! <a name="habracut"></a><br>  Let's try to connect the scanner via devcon, just as we connected the MFP from HP in the first part: <br> <code>.\devcon.exe /r install C:\Drivers\Scanners\2035dnscan\kmwiadrv.inf "KM_WC_ECOSYS_M2035dn_N_WIA"</code> <br> <br>  The scanner has connected, register the address of the scanner in the registry with the ScannerAddress parameter and start the scan.  Scanning application showed scanned sheet, everything works fine.  It would seem a victory, but the launch of the second program used by us for scanning diminished the joys - the scanner was not displayed in it. <br><br><img src="https://habrastorage.org/files/cea/e8b/0ac/ceae8b0ac6c343af8cfc8053384d72ba.png"><br><br>  It turns out that the Kyocera developers for some reason in the driver implemented scanning only through WIA, for TWAIN it is necessary to set a separate <s>costa .. a</s> wrapper that sends the TWAIN interface to WIA and returns the result.  This TWAIN driver looks like this: <br><br><img src="https://habrastorage.org/files/648/89d/435/64889d4355ef4442808ff061f27df75b.png"><br><br>  At the same time, according to WIA, we can connect several Kyocera scanners, while we will always have only one TWAIN interface.  Either use WIA, or run our utility each time and switch the scanner.  We'll have to accept, but for now let's see how we get around the launch of this utility on the user's machine. <br>  The utility stores settings in ini-files, one KM_TWAIN * .ini file for each network scanner and one resulting file with a description of scanners and their settings files. <br>  Screen of both files for one connected scanner: <br><br><img src="https://habrastorage.org/files/8d4/17e/0d8/8d417e0d8cf14bf0addabdd5a64a9950.png"><br><br>  Now the installation is seen as follows: <br>  - we connect the scanner through devcon <br>  - if the TWAIN utility is not installed, set it <br>  - add the scanner address to the registry <br>  - we go through the registry in the search for connected Kyocera scanners and, based on the data in the registry, generate ini-files <br><br>  Expand the scanner connection function from the previous note with the following code, which I tried to comment to the maximum: <br><br><pre> <code class="hljs rust">#        devcon <span class="hljs-string"><span class="hljs-string">"M2035dn"</span></span> { Push-Location <span class="hljs-symbol"><span class="hljs-symbol">'C</span></span>:\Drivers\Scanners\ip\<span class="hljs-number"><span class="hljs-number">2035</span></span>dnscan\' <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($(Get-Platform) -eq <span class="hljs-string"><span class="hljs-string">"Windows x64"</span></span>) { .\devconx64.exe /r install $dest\kmwiadrv.inf <span class="hljs-string"><span class="hljs-string">"KM_WC_ECOSYS_M2035dn_N_WIA"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { .\devcon.exe /r install $dest\kmwiadrv.inf <span class="hljs-string"><span class="hljs-string">"KM_WC_ECOSYS_M2035dn_N_WIA"</span></span> } Pop-Location #     kyocera,       $twain = Get-WMIObject -Class Win32_Product -Filter <span class="hljs-symbol"><span class="hljs-symbol">'Name</span></span> = <span class="hljs-string"><span class="hljs-string">"Kyocera TWAIN Driver"</span></span>' <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!($twain)) { Push-Location <span class="hljs-symbol"><span class="hljs-symbol">'C</span></span>:\Drivers\Scanners\<span class="hljs-number"><span class="hljs-number">2035</span></span>dnscan\TWAIN' .\setup.exe /S /v /qn Pop-Location } #            $scanclass = <span class="hljs-symbol"><span class="hljs-symbol">'HKLM</span></span>:\SYSTEM\CurrentControlSet\Control\Class\{<span class="hljs-number"><span class="hljs-number">6</span></span>BDD1FC6-<span class="hljs-number"><span class="hljs-number">810</span></span>F-<span class="hljs-number"><span class="hljs-number">11</span></span>D0-BEC7-<span class="hljs-number"><span class="hljs-number">08002</span></span>BE2092F}' #        ,        $item = (Get-ChildItem $scanclass | Where-Object Name -<span class="hljs-keyword"><span class="hljs-keyword">match</span></span> <span class="hljs-string"><span class="hljs-string">"\d{4}$"</span></span> | Select -Last <span class="hljs-number"><span class="hljs-number">1</span></span>).PSChildName #    New-ItemProperty <span class="hljs-string"><span class="hljs-string">"$scanclass\$item\DeviceData"</span></span> -Name <span class="hljs-string"><span class="hljs-string">"ScannerAddress"</span></span> -Value $ipaddress | Out-Null #     Foreach-Object,     #       ,       ; #    process      Get-ChildItem $scanclass | Foreach-Object -Begin { $count = <span class="hljs-number"><span class="hljs-number">0</span></span> Add-Type -As System.Web #  ,    $pass = '<span class="hljs-number"><span class="hljs-number">43</span></span>srWkUjR/<span class="hljs-number"><span class="hljs-number">8</span></span>=' $scanitem = @{} $filelist = @() } -Process { $path = $_.Name -replace <span class="hljs-symbol"><span class="hljs-symbol">'HKEY_LOCAL_MACHINE</span></span>', <span class="hljs-symbol"><span class="hljs-symbol">'HKLM</span></span>:' $prop = Get-ItemProperty $path <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($prop.Vendor -eq <span class="hljs-symbol"><span class="hljs-symbol">'Kyocera</span></span>') { $count ++ $twfilename = <span class="hljs-string"><span class="hljs-string">"KM_TWAIN$count`.INI"</span></span> $devicedata = Get-ItemProperty <span class="hljs-string"><span class="hljs-string">"$path\DeviceData"</span></span> $cont = @{<span class="hljs-symbol"><span class="hljs-symbol">'Unit</span></span><span class="hljs-string"><span class="hljs-string">'='</span></span><span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-string"><span class="hljs-string">';'</span></span>ScannerAddress'=$devicedata.ScannerAddress; <span class="hljs-symbol"><span class="hljs-symbol">'SSL</span></span><span class="hljs-string"><span class="hljs-string">'='</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>'} $auth = @{<span class="hljs-symbol"><span class="hljs-symbol">'Auth</span></span><span class="hljs-string"><span class="hljs-string">'='</span></span><span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-string"><span class="hljs-string">';'</span></span>UserName<span class="hljs-string"><span class="hljs-string">'='</span></span>'; <span class="hljs-symbol"><span class="hljs-symbol">'Account</span></span><span class="hljs-string"><span class="hljs-string">'='</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>'; <span class="hljs-symbol"><span class="hljs-symbol">'ID</span></span><span class="hljs-string"><span class="hljs-string">'='</span></span><span class="hljs-string"><span class="hljs-string">';'</span></span>Password'=$pass} $twcont = @{<span class="hljs-symbol"><span class="hljs-symbol">'Contents</span></span>'=$cont; <span class="hljs-symbol"><span class="hljs-symbol">'Authentication</span></span>'=$auth} Out-IniFile -inputobject $twcont -FilePath <span class="hljs-string"><span class="hljs-string">"$env:temp\$twfilename"</span></span> $filelist += , <span class="hljs-string"><span class="hljs-string">"$env:temp\$twfilename"</span></span> $devicename = $devicedata.<span class="hljs-symbol"><span class="hljs-symbol">'Model</span></span> Name' + <span class="hljs-string"><span class="hljs-string">" #$count"</span></span> $modelname = $devicedata.<span class="hljs-symbol"><span class="hljs-symbol">'Model</span></span> Name' $scanreg = @{<span class="hljs-symbol"><span class="hljs-symbol">'Name</span></span>'=$devicename;<span class="hljs-symbol"><span class="hljs-symbol">'Model</span></span>'=$modelname;<span class="hljs-symbol"><span class="hljs-symbol">'DefFile</span></span>'=$twfilename;<span class="hljs-symbol"><span class="hljs-symbol">'LastScan</span></span><span class="hljs-string"><span class="hljs-string">'='</span></span><span class="hljs-string"><span class="hljs-string">';'</span></span>ScanList<span class="hljs-string"><span class="hljs-string">'='</span></span><span class="hljs-string"><span class="hljs-string">';'</span></span>Pos'=($count-<span class="hljs-number"><span class="hljs-number">1</span></span>)} $scanitem.Add(<span class="hljs-string"><span class="hljs-string">"Scanner$count"</span></span>, $scanreg) } } -End { $regfilename = <span class="hljs-symbol"><span class="hljs-symbol">'RegList</span></span>.ini' $settings = @{<span class="hljs-symbol"><span class="hljs-symbol">'Type</span></span><span class="hljs-string"><span class="hljs-string">'='</span></span><span class="hljs-number"><span class="hljs-number">4</span></span>'; <span class="hljs-symbol"><span class="hljs-symbol">'DefaultUse</span></span>'=$count;<span class="hljs-symbol"><span class="hljs-symbol">'RegNum</span></span>'=$count;} $reglist = @{<span class="hljs-symbol"><span class="hljs-symbol">'Setting</span></span>'=$settings} $reglist += $scanitem Out-IniFile -inputobject $reglist -FilePath <span class="hljs-string"><span class="hljs-string">"$env:temp\$regfilename"</span></span> $filelist += , <span class="hljs-string"><span class="hljs-string">"$env:temp\$regfilename"</span></span> } #   ini-        Get-ChildItem $env:systemdrive\users -Directory -Recurse -Include <span class="hljs-symbol"><span class="hljs-symbol">'appdata</span></span>' -Force | ForEach-Object { $kyodir = $_.FullName + <span class="hljs-string"><span class="hljs-string">"\Roaming\Kyocera\KM_TWAIN"</span></span> If (!(Test-Path $kyodir)) { New-Item -Type Directory -Path $kyodir } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Remove-Item <span class="hljs-string"><span class="hljs-string">"$kyodir\*"</span></span> -Recurse } $filelist | ForEach-Object { <span class="hljs-built_in"><span class="hljs-built_in">Copy</span></span>-Item $_ $kyodir -Force | Out-Null } } }</code> </pre><br>  In the script, I used the function of displaying a hash table in the ini-file, here is its code: <br><br><pre> <code class="hljs mel">function Out-IniFile($inputobject, $filepath) { # .Example # $Category1 = @{<span class="hljs-string"><span class="hljs-string">'Key1'</span></span>=<span class="hljs-string"><span class="hljs-string">'Value1'</span></span>;<span class="hljs-string"><span class="hljs-string">'Key2'</span></span>=<span class="hljs-string"><span class="hljs-string">'Value2'</span></span>} # $Category2 = @{<span class="hljs-string"><span class="hljs-string">'Key1'</span></span>=<span class="hljs-string"><span class="hljs-string">'Value1'</span></span>;<span class="hljs-string"><span class="hljs-string">'Key2'</span></span>=<span class="hljs-string"><span class="hljs-string">'Value2'</span></span>} # $NewINIContent = @{<span class="hljs-string"><span class="hljs-string">'Category1'</span></span>=$Category1;<span class="hljs-string"><span class="hljs-string">'Category2'</span></span>=$Category2} # Out-IniFile -inputobject $NewINIContent -FilePath <span class="hljs-string"><span class="hljs-string">'C:\MyNewFile.INI'</span></span> $outfile = New-Item -ItemType File -Path $filepath -Force foreach ($i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $inputobject.keys) { Add-Content -Path $outfile -Value <span class="hljs-string"><span class="hljs-string">"[$i]"</span></span> Foreach ($j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ($inputobject[$i].keys | Sort-Object)) { Add-Content -Path $outfile -Value <span class="hljs-string"><span class="hljs-string">"$j=$($inputobject[$i][$j])"</span></span> } Add-Content -Path $outfile -Value <span class="hljs-string"><span class="hljs-string">''</span></span> } }</code> </pre><br><br><h1>  Xerox WorkCentre 3615 and 6505DN </h1><br>  This code worked successfully and there were no problems with it, probably for half a year until the wind again blew in the other direction.  Towards Xerox. <br>  A letter with the ip-addresses of two new MFPs, WorkCentre 3615 and WorkCentre 6505DN, fell into the Outlook.  The road of thought when meeting the new MFP has already been beaten, open the driver and see the familiar: <br><br><img src="https://habrastorage.org/files/732/c09/3c6/732c093c6a2d41e7bc4a7cb39b61d4df.png"><br><br>  And my mood has improved ¬© <br><br>  Unpack the driver, run the console, execute: <br> <code>.\devcon.exe /r install C:\Drivers\Scanners\xx3615\xrszdim.inf "NON_PNP&amp;WorkCentre3615"</code> <br> <br>  The scanner connected and a new run-up appeared on the screen, as they say, only from the Xerox developers: <br><br><img src="https://habrastorage.org/files/b13/7b2/22d/b137b222d9c24eadb887e107519db369.png"><br><br>  Another strange utility from the authors of the driver for prescribing IP, and it runs from the driver during installation.  So, in order to hide it from the user, we will nail it in the script, in general, it does not matter. <br><br>  Now I will show on the example of 3615 how to expand the scanner connection function.  It practically does not differ from the 6506DN, unless a different name of the driver file and ID: <br><br><pre> <code class="hljs tex">"3615" { Push-Location 'C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Drivers</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Scanners</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xx</span></span></span></span>3615<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">'</span></span></span></span> if (<span class="hljs-formula"><span class="hljs-formula">$(Get-Platform) -eq "Windows x64") { .</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">devconx</span></span></span></span></span><span class="hljs-formula">64.exe /r install C:</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">Drivers</span></span></span></span></span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">Scanners</span></span></span></span></span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">xx</span></span></span></span></span><span class="hljs-formula">3615</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">xrszdim</span></span></span></span></span><span class="hljs-formula">.inf "NON_PNP&amp;WorkCentre3615" } else { .</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">devcon</span></span></span></span></span><span class="hljs-formula">.exe /r install C:</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">Drivers</span></span></span></span></span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">Scanners</span></span></span></span></span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">xx</span></span></span></span></span><span class="hljs-formula">3615</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">xrszdim</span></span></span></span></span><span class="hljs-formula">.inf "NON_PNP&amp;WorkCentre3615" } Pop-Location Get-Process "AIOScanSettings" | Stop-Process -Force #         reg add, #     cmd,    New-ItemProperty    &amp;rg.exe add "hklm</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">SOFTWARE</span></span></span></span></span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">Xerox</span></span></span></span></span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">WorkCentre</span></span></span></span></span><span class="hljs-formula"> 3615</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">TwainDriver</span></span></span></span></span><span class="hljs-formula">" /v "EnableEnhancedBW" /t REG_DWORD /d 1 /f &amp;rg.exe add "hklm</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">SOFTWARE</span></span></span></span></span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">Xerox</span></span></span></span></span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">WorkCentre</span></span></span></span></span><span class="hljs-formula"> 3615</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">TwainDriver</span></span></span></span></span><span class="hljs-formula">" /v "ISO_B_Series" /t REG_DWORD /d 1 /f &amp;rg.exe add "hklm</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">SOFTWARE</span></span></span></span></span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">Xerox</span></span></span></span></span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">WorkCentre</span></span></span></span></span><span class="hljs-formula"> 3615</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">TwainDriver</span></span></span></span></span><span class="hljs-formula">" /v "IP Address" /t REG_SZ /d $</span></span>ipAddress /f }</code> </pre><br><br>  Now we can connect a whole zoo of network mfps and are not afraid at all, it remains to add some magic ... magic snmp! <br><br><h1>  We are looking for an MFP in the network by snmp </h1><br><blockquote>  SNMP (Simple Network Management Protocol) is a standard Internet protocol for managing devices on IP networks based on TCP / UDP architectures. <br>  <a href="https://ru.wikipedia.org/wiki/SNMP">ru.wikipedia.org/wiki/SNMP</a> </blockquote><br><br>  To work with powershell snmp, I used the sharpsnmp open library in the script, read more about its use at: <a href="http://vwiki.co.uk/SNMP_and_PowerShell">vwiki.co.uk/SNMP_and_PowerShell</a> <br>  After the library is connected, obtaining information is reduced to calling the Invoke-SNMPget function indicating Ip and uid, the last of which is easily googled. <br>  Example from code: <br> <code>Invoke-SNMPget $ip .1.3.6.1.2.1.25.3.2.1.3.1</code> <br> <br>  The result of the search is displayed on the screen, on how to do it in one command just below: <br><br><img src="https://habrastorage.org/files/158/331/6ad/1583316ad8b04874b8b9f44c0fe13c19.png"><br><br>  It remains to select the desired printer and click OK, by the way, multiple selection is also possible, in this case all selected printers will be connected. <br>  This handy magic is provided by the Out-GridView cmdlet, which displays any objects passed to it.  When calling with the PassThru parameter, after clicking OK, he will pass on the selected objects down the pipeline, we just have to call in turn our driver installation functions with the parameters that came in the object from the pipeline. <br><br>  In a simplified form, the script will take the form: <br><pre> <code class="hljs perl">$hosts | Out-GridView -Title <span class="hljs-string"><span class="hljs-string">"   "</span></span> -PassThru | Foreach-Object { $printername = $_.Name $printersource = $_.Source switch -regex ($printername) { <span class="hljs-string"><span class="hljs-string">"xerox.+3615"</span></span> { $modelname = <span class="hljs-string"><span class="hljs-string">"Xerox WorkCentre 6505DN PCL 6"</span></span> $driverpath = <span class="hljs-string"><span class="hljs-string">'C:\Drivers\Scanners\xx6505\xrxmozi.inf'</span></span> } } Write-Host <span class="hljs-string"><span class="hljs-string">"  IP  $printerName"</span></span> Add-PrinterPort $modelname $printersource Write-Host <span class="hljs-string"><span class="hljs-string">"   $printername"</span></span> Add-PrinterDriver $modelname $driverpath Write-Host <span class="hljs-string"><span class="hljs-string">"   $printername"</span></span> Add-Scanner $printersource $modelname }</code> </pre><br><br>  In the process of studying the responses of printers, I came across the fact that printers sometimes give a name that differs from the name written in the driver, to bypass this feature I added a simple switch with regulars to the script that never miss, and as we know Turing is full ;-) <br><br><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> -regex ($printername) { <span class="hljs-string"><span class="hljs-string">"hp.+305\d"</span></span> { $modelName = <span class="hljs-string"><span class="hljs-string">"HP LaserJet 3050 Series PCL 6"</span></span> } <span class="hljs-string"><span class="hljs-string">"hp.+3390"</span></span> { $modelName = <span class="hljs-string"><span class="hljs-string">"HP LaserJet 3390 Series PCL 6"</span></span> } <span class="hljs-string"><span class="hljs-string">"xerox.+3615"</span></span> { $modelName = <span class="hljs-string"><span class="hljs-string">"Xerox WorkCentre 3615 PCL6"</span></span> } <span class="hljs-string"><span class="hljs-string">"xerox.+650[0,5]DN"</span></span> { $modelName = <span class="hljs-string"><span class="hljs-string">"Xerox WorkCentre 6505DN PCL 6"</span></span> } }</code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Full code of the ready script for searching and connecting a network printer</b> <div class="spoiler_text"><pre> <code class="hljs rust">$ErrorActionPreference = <span class="hljs-string"><span class="hljs-string">"silentlycontinue"</span></span> function Main { #    $driversdistrib = <span class="hljs-symbol"><span class="hljs-symbol">'C</span></span>:\Drivers\' #  snmp  $snmplibpath = Join-Path (Get-Location).path <span class="hljs-string"><span class="hljs-string">"\SharpSnmpLib.dll"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Test-Path $snmplibpath) { [reflection.assembly]::LoadFrom((Resolve-Path $snmplibpath)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Write-Host <span class="hljs-string"><span class="hljs-string">"   SharpSnmpLib"</span></span> Exit } #  ,   ,     /<span class="hljs-number"><span class="hljs-number">24</span></span> $network = (Get-IPaddress).<span class="hljs-built_in"><span class="hljs-built_in">ToString</span></span>() -replace <span class="hljs-string"><span class="hljs-string">"\.[0-9]{1,3}$"</span></span> #        $hosts = <span class="hljs-number"><span class="hljs-number">10</span></span>..<span class="hljs-number"><span class="hljs-number">40</span></span> | ForEach-Object { $ip = <span class="hljs-string"><span class="hljs-string">"$network.$_"</span></span> $snmpanswer= $null $snmpanswer = Invoke-SNMPget $ip .<span class="hljs-number"><span class="hljs-number">1.3</span></span>.<span class="hljs-number"><span class="hljs-number">6.1</span></span>.<span class="hljs-number"><span class="hljs-number">2.1</span></span>.<span class="hljs-number"><span class="hljs-number">25.3</span></span>.<span class="hljs-number"><span class="hljs-number">2.1</span></span>.<span class="hljs-number"><span class="hljs-number">3.1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($snmpanswer) { #          $hosts [pscustomobject]@{ Name = $snmpanswer.Data; Source = $ip; } } } #       PassThru,       $hosts | Out-GridView -Title <span class="hljs-string"><span class="hljs-string">"   "</span></span> -PassThru | Foreach-Object { $printername = $_.Name $printersource = $_.Source switch -regex ($printername) { <span class="hljs-string"><span class="hljs-string">"hp.+305\d"</span></span> { $printername = <span class="hljs-string"><span class="hljs-string">"HP LaserJet 3050 Series PCL 6"</span></span> $driverpath = Join-Path $driversdistrib <span class="hljs-symbol"><span class="hljs-symbol">'Printers</span></span>\<span class="hljs-number"><span class="hljs-number">3050</span></span>\hppcp601.inf' } <span class="hljs-string"><span class="hljs-string">"hp.+3390"</span></span> { $printername = <span class="hljs-string"><span class="hljs-string">"HP LaserJet 3390 Series PCL 6"</span></span> $driverpath = Join-Path $driversdistrib <span class="hljs-symbol"><span class="hljs-symbol">'Printers</span></span>\<span class="hljs-number"><span class="hljs-number">3050</span></span>\hppcp601.inf' } <span class="hljs-string"><span class="hljs-string">"hp.+153[0,6]"</span></span> { $printername = <span class="hljs-string"><span class="hljs-string">"HP LaserJet M1530 MFP Series PCL 6"</span></span> $driverpath = Join-Path $driversdistrib <span class="hljs-symbol"><span class="hljs-symbol">'Printers</span></span>\<span class="hljs-number"><span class="hljs-number">1530</span></span>\hpc1530c.inf' } <span class="hljs-string"><span class="hljs-string">"hp.+1522"</span></span> { $printername = <span class="hljs-string"><span class="hljs-string">"HP LaserJet M1522 MFP Series PCL 6"</span></span> $driverpath = Join-Path $driversdistrib <span class="hljs-symbol"><span class="hljs-symbol">'Printers</span></span>\<span class="hljs-number"><span class="hljs-number">1522</span></span>\hppcp608.inf' } <span class="hljs-string"><span class="hljs-string">"M2035dn"</span></span> { $printername = <span class="hljs-string"><span class="hljs-string">"Kyocera ECOSYS M2035dn KX"</span></span> $driverpath = Join-Path $driversdistrib <span class="hljs-symbol"><span class="hljs-symbol">'Printers</span></span>\<span class="hljs-number"><span class="hljs-number">2035</span></span>dn\OEMSETUP.INF' } <span class="hljs-string"><span class="hljs-string">"xerox.+3615"</span></span> { $printername = <span class="hljs-string"><span class="hljs-string">"Xerox WorkCentre 3615 PCL6"</span></span> $driverpath = Join-Path $driversdistrib <span class="hljs-symbol"><span class="hljs-symbol">'Scanners</span></span>\xx3615\x2GPROX.inf' } <span class="hljs-string"><span class="hljs-string">"xerox.+650[0,5]DN"</span></span> { $printername = <span class="hljs-string"><span class="hljs-string">"Xerox WorkCentre 6505DN PCL 6"</span></span> $driverpath = Join-Path $driversdistrib <span class="hljs-symbol"><span class="hljs-symbol">'Scanners</span></span>\xx6505\xrxmozi.inf' } } Write-Host <span class="hljs-string"><span class="hljs-string">"  IP  $printerName"</span></span> Add-PrinterPort $printername $printersource Write-Host <span class="hljs-string"><span class="hljs-string">"   $printername"</span></span> Add-PrinterDriver $printername $driverpath Write-Host <span class="hljs-string"><span class="hljs-string">"   $printername"</span></span> Add-Scanner $printersource $printername } } function Add-PrinterPort ($printersource) { &amp;cscript C:\Windows\System32\Printing_Admin_Scripts\ru-RU\prnport.vbs ` -a -r $printersource -h $printersource -o RAW -n <span class="hljs-number"><span class="hljs-number">9100</span></span> | Out-Null } function Add-PrinterDriver ($printerName, $driverpath) { $folder = Split-Path $driverpath cscript C:\Windows\System32\Printing_Admin_Scripts\ru-RU\prndrvr.vbs ` -a -m $printerName -e Get-Platform -h $folder -i $driverpath } function Add-Scanner ($ipaddress, $printername) { switch -regex ($printername) { <span class="hljs-string"><span class="hljs-string">"1530"</span></span> { Push-Location (Join-Path $driversdistrib <span class="hljs-symbol"><span class="hljs-symbol">'Scanners</span></span>\<span class="hljs-number"><span class="hljs-number">1536</span></span>scan\') <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($(Get-Platform) -eq <span class="hljs-string"><span class="hljs-string">"Windows x64"</span></span>) { .\hppniscan64.exe -f <span class="hljs-string"><span class="hljs-string">"hppasc16.inf"</span></span> -m <span class="hljs-string"><span class="hljs-string">"vid_03f0&amp;pid_012a&amp;IP_SCAN"</span></span> -a $ipAddress -n <span class="hljs-number"><span class="hljs-number">1</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { .\hppniscan01.exe -f <span class="hljs-string"><span class="hljs-string">"hppasc16.inf"</span></span> -m <span class="hljs-string"><span class="hljs-string">"vid_03f0&amp;pid_012a&amp;IP_SCAN"</span></span> -a $ipAddress -n <span class="hljs-number"><span class="hljs-number">1</span></span> } Pop-Location } <span class="hljs-string"><span class="hljs-string">"(305\d)|(3390)"</span></span> { Push-Location (Join-Path $driversdistrib <span class="hljs-symbol"><span class="hljs-symbol">'Scanners</span></span>\<span class="hljs-number"><span class="hljs-number">3055</span></span>scan\') switch -regex ($printername) { <span class="hljs-string"><span class="hljs-string">"3050"</span></span> { .\hppniscan01.exe -f <span class="hljs-string"><span class="hljs-string">"hppasc01.inf"</span></span> -m <span class="hljs-string"><span class="hljs-string">"vid_03f0&amp;pid_3217&amp;IP_SCAN"</span></span> -a $ipAddress -n <span class="hljs-number"><span class="hljs-number">1</span></span> } <span class="hljs-string"><span class="hljs-string">"3052"</span></span> { .\hppniscan01.exe -f <span class="hljs-string"><span class="hljs-string">"hppasc01.inf"</span></span> -m <span class="hljs-string"><span class="hljs-string">"vid_03f0&amp;pid_3317&amp;IP_SCAN"</span></span> -a $ipAddress -n <span class="hljs-number"><span class="hljs-number">1</span></span> } <span class="hljs-string"><span class="hljs-string">"3055"</span></span> { .\hppniscan01.exe -f <span class="hljs-string"><span class="hljs-string">"hppasc01.inf"</span></span> -m <span class="hljs-string"><span class="hljs-string">"vid_03f0&amp;pid_3417&amp;IP_SCAN"</span></span> -a $ipAddress -n <span class="hljs-number"><span class="hljs-number">1</span></span> } <span class="hljs-string"><span class="hljs-string">"3390"</span></span> { .\hppniscan01.exe -f <span class="hljs-string"><span class="hljs-string">"hppasc01.inf"</span></span> -m <span class="hljs-string"><span class="hljs-string">"vid_03f0&amp;pid_3517&amp;IP_SCAN"</span></span> -a $ipAddress -n <span class="hljs-number"><span class="hljs-number">1</span></span> } } Pop-Location } <span class="hljs-string"><span class="hljs-string">"1522"</span></span> { Push-Location (Join-Path $driversdistrib <span class="hljs-symbol"><span class="hljs-symbol">'Scanners</span></span>\<span class="hljs-number"><span class="hljs-number">1522</span></span>scan\') <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($(Get-Platform) -eq <span class="hljs-string"><span class="hljs-string">"Windows x64"</span></span>) { .\hppniscan64.exe -f <span class="hljs-string"><span class="hljs-string">"hppasc08.inf"</span></span> -m <span class="hljs-string"><span class="hljs-string">"vid_03f0&amp;pid_4517&amp;IP_SCAN"</span></span> -a $ipAddress -n <span class="hljs-number"><span class="hljs-number">1</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { .\hppniscan01.exe -f <span class="hljs-string"><span class="hljs-string">"hppasc08.inf"</span></span> -m <span class="hljs-string"><span class="hljs-string">"vid_03f0&amp;pid_4517&amp;IP_SCAN"</span></span> -a $ipAddress -n <span class="hljs-number"><span class="hljs-number">1</span></span> } Pop-Location } <span class="hljs-string"><span class="hljs-string">"M2035dn"</span></span> { Push-Location (Join-Path $driversdistrib <span class="hljs-symbol"><span class="hljs-symbol">'Scanners</span></span>\<span class="hljs-number"><span class="hljs-number">2035</span></span>dnscan\') <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($(Get-Platform) -eq <span class="hljs-string"><span class="hljs-string">"Windows x64"</span></span>) { .\devconx64.exe /r install $dest\kmwiadrv.inf <span class="hljs-string"><span class="hljs-string">"KM_WC_ECOSYS_M2035dn_N_WIA"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { .\devcon.exe /r install $dest\kmwiadrv.inf <span class="hljs-string"><span class="hljs-string">"KM_WC_ECOSYS_M2035dn_N_WIA"</span></span> } Pop-Location $twain = Get-WMIObject -Class Win32_Product -Filter <span class="hljs-symbol"><span class="hljs-symbol">'Name</span></span> = <span class="hljs-string"><span class="hljs-string">"Kyocera TWAIN Driver"</span></span>' <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!($twain)) { Push-Location (Join-Path $driversdistrib <span class="hljs-symbol"><span class="hljs-symbol">'Scanners</span></span>\<span class="hljs-number"><span class="hljs-number">2035</span></span>dnscan\TWAIN') .\setup.exe /S /v /qn Pop-Location } $scanclass = <span class="hljs-symbol"><span class="hljs-symbol">'HKLM</span></span>:\SYSTEM\CurrentControlSet\Control\Class\{<span class="hljs-number"><span class="hljs-number">6</span></span>BDD1FC6-<span class="hljs-number"><span class="hljs-number">810</span></span>F-<span class="hljs-number"><span class="hljs-number">11</span></span>D0-BEC7-<span class="hljs-number"><span class="hljs-number">08002</span></span>BE2092F}' $item = (Get-ChildItem $scanclass | Where-Object Name -<span class="hljs-keyword"><span class="hljs-keyword">match</span></span> <span class="hljs-string"><span class="hljs-string">"\d{4}$"</span></span> | Select -Last <span class="hljs-number"><span class="hljs-number">1</span></span>).PSChildName New-ItemProperty <span class="hljs-string"><span class="hljs-string">"$scanclass\$item\DeviceData"</span></span> -Name <span class="hljs-string"><span class="hljs-string">"ScannerAddress"</span></span> -Value $ipAddress | Out-Null Get-ChildItem $scanclass | ForEach-Object -Begin { $count = <span class="hljs-number"><span class="hljs-number">0</span></span> Add-Type -As System.Web $pass = [System.Web.Security.Membership]::GeneratePassword(<span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) $scanitem = @{} $filelist = @() } -Process { $path = $_.Name -replace <span class="hljs-symbol"><span class="hljs-symbol">'HKEY_LOCAL_MACHINE</span></span>', <span class="hljs-symbol"><span class="hljs-symbol">'HKLM</span></span>:' $prop = Get-ItemProperty $path <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($prop.Vendor -eq <span class="hljs-symbol"><span class="hljs-symbol">'Kyocera</span></span>') { $count ++ $twfilename = <span class="hljs-string"><span class="hljs-string">"KM_TWAIN$count`.INI"</span></span> $devicedata = Get-ItemProperty <span class="hljs-string"><span class="hljs-string">"$path\DeviceData"</span></span> $cont = @{<span class="hljs-symbol"><span class="hljs-symbol">'Unit</span></span><span class="hljs-string"><span class="hljs-string">'='</span></span><span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-string"><span class="hljs-string">';'</span></span>ScannerAddress'=$devicedata.ScannerAddress; <span class="hljs-symbol"><span class="hljs-symbol">'SSL</span></span><span class="hljs-string"><span class="hljs-string">'='</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>'} $auth = @{<span class="hljs-symbol"><span class="hljs-symbol">'Auth</span></span><span class="hljs-string"><span class="hljs-string">'='</span></span><span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-string"><span class="hljs-string">';'</span></span>UserName<span class="hljs-string"><span class="hljs-string">'='</span></span>'; <span class="hljs-symbol"><span class="hljs-symbol">'Account</span></span><span class="hljs-string"><span class="hljs-string">'='</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>'; <span class="hljs-symbol"><span class="hljs-symbol">'ID</span></span><span class="hljs-string"><span class="hljs-string">'='</span></span><span class="hljs-string"><span class="hljs-string">';'</span></span>Password'=$pass} $twcont = @{<span class="hljs-symbol"><span class="hljs-symbol">'Contents</span></span>'=$cont; <span class="hljs-symbol"><span class="hljs-symbol">'Authentication</span></span>'=$auth} Out-IniFile -inputobject $twcont -FilePath <span class="hljs-string"><span class="hljs-string">"$env:temp\$twfilename"</span></span> $filelist += , <span class="hljs-string"><span class="hljs-string">"$env:temp\$twfilename"</span></span> $devicename = $devicedata.<span class="hljs-symbol"><span class="hljs-symbol">'Model</span></span> Name' + <span class="hljs-string"><span class="hljs-string">" #$count"</span></span> $modelname = $devicedata.<span class="hljs-symbol"><span class="hljs-symbol">'Model</span></span> Name' $scanreg = @{<span class="hljs-symbol"><span class="hljs-symbol">'Name</span></span>'=$devicename;<span class="hljs-symbol"><span class="hljs-symbol">'Model</span></span>'=$modelname;<span class="hljs-symbol"><span class="hljs-symbol">'DefFile</span></span>'=$twfilename;<span class="hljs-symbol"><span class="hljs-symbol">'LastScan</span></span><span class="hljs-string"><span class="hljs-string">'='</span></span><span class="hljs-string"><span class="hljs-string">';'</span></span>ScanList<span class="hljs-string"><span class="hljs-string">'='</span></span><span class="hljs-string"><span class="hljs-string">';'</span></span>Pos'=($count-<span class="hljs-number"><span class="hljs-number">1</span></span>)} $scanitem.Add(<span class="hljs-string"><span class="hljs-string">"Scanner$count"</span></span>, $scanreg) } } -End { $regfilename = <span class="hljs-symbol"><span class="hljs-symbol">'RegList</span></span>.ini' $settings = @{<span class="hljs-symbol"><span class="hljs-symbol">'Type</span></span><span class="hljs-string"><span class="hljs-string">'='</span></span><span class="hljs-number"><span class="hljs-number">4</span></span>'; <span class="hljs-symbol"><span class="hljs-symbol">'DefaultUse</span></span>'=$count;<span class="hljs-symbol"><span class="hljs-symbol">'RegNum</span></span>'=$count;} $reglist = @{<span class="hljs-symbol"><span class="hljs-symbol">'Setting</span></span>'=$settings} $reglist += $scanitem Out-IniFile -inputobject $reglist -FilePath <span class="hljs-string"><span class="hljs-string">"$env:temp\$regfilename"</span></span> $filelist += , <span class="hljs-string"><span class="hljs-string">"$env:temp\$regfilename"</span></span> } Get-ChildItem $env:systemdrive\users -Directory -Recurse -Include <span class="hljs-symbol"><span class="hljs-symbol">'appdata</span></span>' -Force | ForEach-Object { $kyodir = $_.FullName + <span class="hljs-string"><span class="hljs-string">"\Roaming\Kyocera\KM_TWAIN"</span></span> If (!(Test-Path $kyodir)) { New-Item -Type Directory -Path $kyodir } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Remove-Item <span class="hljs-string"><span class="hljs-string">"$kyodir\*"</span></span> -Recurse } $filelist | ForEach-Object { <span class="hljs-built_in"><span class="hljs-built_in">Copy</span></span>-Item $_ $kyodir -Force | Out-Null } } } <span class="hljs-string"><span class="hljs-string">"6505"</span></span> { Push-Location (Join-Path $driversdistrib <span class="hljs-symbol"><span class="hljs-symbol">'Scanners</span></span>\xx6505\') <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($(Get-Platform) -eq <span class="hljs-string"><span class="hljs-string">"Windows x64"</span></span>) { .\devconx64.exe /r install $dest\xrsmoim.inf <span class="hljs-string"><span class="hljs-string">"NON_PNP&amp;WorkCentre6505"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { .\devcon.exe /r install $dest\xrsmoim.inf <span class="hljs-string"><span class="hljs-string">"NON_PNP&amp;WorkCentre6505"</span></span> } Pop-Location Get-Process <span class="hljs-string"><span class="hljs-string">"AIOScanSettings"</span></span> | Stop-Process -Force &amp;rg.exe add <span class="hljs-string"><span class="hljs-string">"hklm\SOFTWARE\Xerox\WorkCentre 6505\TwainDriver"</span></span> /v <span class="hljs-string"><span class="hljs-string">"EnableEnhancedBW"</span></span> /t REG_DWORD /d <span class="hljs-number"><span class="hljs-number">1</span></span> /f &amp;rg.exe add <span class="hljs-string"><span class="hljs-string">"hklm\SOFTWARE\Xerox\WorkCentre 6505\TwainDriver"</span></span> /v <span class="hljs-string"><span class="hljs-string">"IP Address"</span></span> /t REG_SZ /d $ipAddress /f } <span class="hljs-string"><span class="hljs-string">"3615"</span></span> { Push-Location (Join-Path $driversdistrib <span class="hljs-symbol"><span class="hljs-symbol">'Scanners</span></span>\xx3615\') <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($(Get-Platform) -eq <span class="hljs-string"><span class="hljs-string">"Windows x64"</span></span>) { .\devconx64.exe /r install $dest\xrszdim.inf <span class="hljs-string"><span class="hljs-string">"NON_PNP&amp;WorkCentre3615"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { .\devcon.exe /r install $dest\xrszdim.inf <span class="hljs-string"><span class="hljs-string">"NON_PNP&amp;WorkCentre3615"</span></span> } Pop-Location Get-Process <span class="hljs-string"><span class="hljs-string">"AIOScanSettings"</span></span> | Stop-Process -Force #    rg,   ,     ¬Æ &amp;rg.exe add <span class="hljs-string"><span class="hljs-string">"hklm\SOFTWARE\Xerox\WorkCentre 3615\TwainDriver"</span></span> /v <span class="hljs-string"><span class="hljs-string">"EnableEnhancedBW"</span></span> /t REG_DWORD /d <span class="hljs-number"><span class="hljs-number">1</span></span> /f &amp;rg.exe add <span class="hljs-string"><span class="hljs-string">"hklm\SOFTWARE\Xerox\WorkCentre 3615\TwainDriver"</span></span> /v <span class="hljs-string"><span class="hljs-string">"ISO_B_Series"</span></span> /t REG_DWORD /d <span class="hljs-number"><span class="hljs-number">1</span></span> /f &amp;rg.exe add <span class="hljs-string"><span class="hljs-string">"hklm\SOFTWARE\Xerox\WorkCentre 3615\TwainDriver"</span></span> /v <span class="hljs-string"><span class="hljs-string">"IP Address"</span></span> /t REG_SZ /d $ipAddress /f } } } function Get-IPaddress { $ipWmiObject = Get-WmiObject Win32_NetworkAdapterConfiguration -filter <span class="hljs-string"><span class="hljs-string">"IPEnabled = 'True'"</span></span> $ipWmiObject.IPAddress -<span class="hljs-keyword"><span class="hljs-keyword">match</span></span> <span class="hljs-string"><span class="hljs-string">"^192\.([0-9]{1,3}\.){2}[0-9]{1,3}$"</span></span> } function Get-Platform { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([System.Environment]::Is64BitOperatingSystem) { <span class="hljs-string"><span class="hljs-string">"Windows x64"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-string"><span class="hljs-string">"Windows NT x86"</span></span> } } function Out-IniFile($inputobject, $filepath) { # .Example # $Category1 = @{<span class="hljs-symbol"><span class="hljs-symbol">'Key1</span></span><span class="hljs-string"><span class="hljs-string">'='</span></span>Value1<span class="hljs-string"><span class="hljs-string">';'</span></span>Key2<span class="hljs-string"><span class="hljs-string">'='</span></span>Value2'} # $Category2 = @{<span class="hljs-symbol"><span class="hljs-symbol">'Key1</span></span><span class="hljs-string"><span class="hljs-string">'='</span></span>Value1<span class="hljs-string"><span class="hljs-string">';'</span></span>Key2<span class="hljs-string"><span class="hljs-string">'='</span></span>Value2'} # $NewINIContent = @{<span class="hljs-symbol"><span class="hljs-symbol">'Category1</span></span>'=$Category1;<span class="hljs-symbol"><span class="hljs-symbol">'Category2</span></span>'=$Category2} # Out-IniFile -inputobject $NewINIContent -FilePath <span class="hljs-symbol"><span class="hljs-symbol">'C</span></span>:\MyNewFile.INI' $outfile = New-Item -ItemType File -Path $filepath -Force foreach ($i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $inputobject.keys) { Add-Content -Path $outfile -Value <span class="hljs-string"><span class="hljs-string">"[$i]"</span></span> Foreach ($j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ($inputobject[$i].keys | Sort-Object)) { Add-Content -Path $outfile -Value <span class="hljs-string"><span class="hljs-string">"$j=$($inputobject[$i][$j])"</span></span> } Add-Content -Path $outfile -Value '' } } function Invoke-SNMPget { param ( [string]$sIP, $sOIDs, [string]$Community = <span class="hljs-string"><span class="hljs-string">"public"</span></span>, [int]$UDPport = <span class="hljs-number"><span class="hljs-number">161</span></span>, [int]$TimeOut=<span class="hljs-number"><span class="hljs-number">30</span></span> ) $vList = New-Object <span class="hljs-symbol"><span class="hljs-symbol">'System</span></span>.Collections.Generic.List[Lextm.SharpSnmpLib.Variable]' foreach ($sOID <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $sOIDs) { $oid = New-Object Lextm.SharpSnmpLib.ObjectIdentifier ($sOID) $vList.Add($oid) } $ip = [System.Net.IPAddress]::Parse($sIP) $svr = New-Object System.Net.IpEndPoint ($ip, <span class="hljs-number"><span class="hljs-number">161</span></span>) $ver = [Lextm.SharpSnmpLib.VersionCode]::V1 try { $msg = [Lextm.SharpSnmpLib.Messaging.Messenger]::Get($ver, $svr, $Community, $vList, $TimeOut) } catch { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $null } $res = @() foreach ($var <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $msg) { $line = <span class="hljs-string"><span class="hljs-string">""</span></span> | Select OID, Data $line.OID = $var.Id.<span class="hljs-built_in"><span class="hljs-built_in">ToString</span></span>() $line.Data = $var.Data.<span class="hljs-built_in"><span class="hljs-built_in">ToString</span></span>() $res += $line } $res } . Main</code> </pre><br></div></div><br><br>  That's all for today, I hope my notes will help you forget about problems with network printers and free up time to learn PowerShell. <br>  Thank you for your attention to those who read up to this point ;-) </div><p>Source: <a href="https://habr.com/ru/post/242725/">https://habr.com/ru/post/242725/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../242707/index.html">The story of how a mobile operator wrote off money from the developer Dr. Tariff (grab popcorn)</a></li>
<li><a href="../242709/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ133 (November 3 - 9, 2014)</a></li>
<li><a href="../242711/index.html">Polytech 2.0: First chips!</a></li>
<li><a href="../242713/index.html">Runner under iOS with five characters</a></li>
<li><a href="../242715/index.html">Blade syntax extension</a></li>
<li><a href="../242727/index.html">Analyzing HTTP traffic with Mitmproxy</a></li>
<li><a href="../242729/index.html">Configuring Ruby Module</a></li>
<li><a href="../242731/index.html">Low cost, small, networked computers - a small overview</a></li>
<li><a href="../242739/index.html">Power Raspberry Pi using Arduino</a></li>
<li><a href="../242741/index.html">Open vSwitch as a virtual network core</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>