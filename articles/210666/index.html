<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Access to the file system from the Portable Class Library (PCL)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One day, I had the idea of ‚Äã‚Äãporting my .NET code to other platforms with the main logic (all that does not apply to the UI) being transferred to a se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Access to the file system from the Portable Class Library (PCL)</h1><div class="post__text post__text-html js-mediator-article">  One day, I had the idea of ‚Äã‚Äãporting my .NET code to other platforms with the main logic (all that does not apply to the UI) being transferred to a separate Portable Class Library (PCL) library. <br><br>  In theory, everything sounds cool - you can work with PCL on almost all devices, and not only with the .NET Framework, but even with Mono!  With this approach, large multiplatform prospects are opening up, for example, porting Windows Phone code to Android and iOS using Xamarin. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/de8/bd1/4a5/de8bd14a57e508e4de8ad4fa9cb2ed72.png"></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  But having familiarized myself with PCL more closely, I came to the conclusion that such a library is essentially a truncated .NET that takes into account the limitations of each platform.  That is, even with seemingly similar WP8 and W8, it is not possible to push everything into PCL. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/743/325/99a/74332599acfb8a4574253cb97e23ca9e.png"></div><br><br>  <i>PCL Capabilities Table on Multiple Platforms</i> <br><br><br>  At first glance, my code had to go without problems (target platforms: Windows .NET, Windows 8, Windows Phone), but the compiler cursed System.IO, namely StreamReader, which directly opened the file. <br><br>  Recalling that Windows 8 and Windows Phone have completely different ways to work with files and are different among themselves: <br><br>  WP uses IsolatedStorage to access the application files, and Windows 8, although it has access to public folders, does it through Windows.Storage (WP8 can now also through it, but to maintain WP7 support, this method is not recommended).  Having used Google, it became clear to me that it was impossible to organize access to files on pure PCL, and tips like transferring Steam from an application or hard file inclusion in a DLL for my solution did not fit.  The fact is that the program worked with a large external dictionary and saved the temporary results of the work in files.  But then the PCLStorage library came across, promising any kind of work with filesystems via PCL. <br><br>  PCLStorage provides three interfaces - IFIle, IDirectory, IFileSystem, all of them provide asynchronous read and write operations for files and directories. <br><br>  <i>Note: All further tests were conducted on the "classic" Windows.</i> <br><br>  Example of writing a file: <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PCLCreateFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> content</span></span></span><span class="hljs-function">)</span></span> { IFolder localStorage = FileSystem.Current.LocalStorage; IFolder contentFolder = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> localStorage.CreateFolderAsync(<span class="hljs-string"><span class="hljs-string">"Content"</span></span>, CreationCollisionOption.OpenIfExists); IFile file = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> contentFolder.CreateFileAsync(name, CreationCollisionOption.ReplaceExisting); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> file.WriteAllTextAsync(content); }</code> </pre> <br><br>  Example of reading the file: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PCLReadFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name</span></span></span><span class="hljs-function">)</span></span> { IFolder localStorage = FileSystem.Current.LocalStorage; IFolder contentFolder = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> localStorage.GetFolderAsync(<span class="hljs-string"><span class="hljs-string">"Content"</span></span>); IFile file = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> contentFolder.GetFileAsync(name); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> file.ReadAllTextAsync(); }</code> </pre><br><br>  Everything looks and works perfectly.  But ... how to get access to the file, which is located in the program directory? <br><br>  IFileSystem returns two LocalStorage and RoamingStorage paths.  The first points to the directory that is allocated for the program in the current system, the second to the public directory for data synchronization.  In particular, in Windows LocalStorage pointed to (AppData \ Local), which was far from being the application directory and did not contain any files. <br><br>  Unfortunately, the PCLStorage application directory could not indicate. <br><br>  Of course, it was possible to create a special installer, but what about the Store apps?  However, a solution appeared - copying files to LocalStorage from the application itself (or downloading from the network in the PCL itself (not verified).  Well, the method ultimately came out simpler than the Stream transfer, plus the opportunity to work with temporary files in a limited portable library environment. <br><br>  PS: At the end of the experiment, it turned out that the support for WP7 from the latest version was thrown out, which is why it was actually started (due to the separate use of IsolatedStorage on WP and Windows.Storage on Windows 8). </div><p>Source: <a href="https://habr.com/ru/post/210666/">https://habr.com/ru/post/210666/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../210652/index.html">Who needs nested tasks in a project management system?</a></li>
<li><a href="../210654/index.html">Direct entry to the 1C: Enterprise Directory via Linq on the example of working with Asp.Net users</a></li>
<li><a href="../210656/index.html">Horizontal scaling PHP applications. Part 1</a></li>
<li><a href="../210660/index.html">What to do if the client is a friend / good friend?</a></li>
<li><a href="../210664/index.html">My comfortable home</a></li>
<li><a href="../210668/index.html">Two or more jobs on the same computer - free solution</a></li>
<li><a href="../210672/index.html">10 obscure Objective-C features</a></li>
<li><a href="../210676/index.html">Smartphone / clock video review iconBIT Callisto 100</a></li>
<li><a href="../210680/index.html">Do you use web components?</a></li>
<li><a href="../210682/index.html">Escene ES620 IP Phone Review with Escene ESM 32 Expansion Module</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>