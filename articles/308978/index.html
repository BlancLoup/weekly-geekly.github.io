<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Sort a huge file with an array with a known data dictionary</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi Habr! Recently came an interesting assignment: 
 There is a multi-gigabyte file containing an array of integers from 1 to 10,000. The elements are ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Sort a huge file with an array with a known data dictionary</h1><div class="post__text post__text-html js-mediator-article">  Hi Habr!  Recently came an interesting assignment: <br><blockquote>  There is a multi-gigabyte file containing an array of integers from 1 to 10,000. The elements are arranged chaotically with repetitions.  It is necessary to sort it.  Take into account resource constraints. </blockquote><br>  The laziest way to sort can be using "external sorting with merge", but this is a very long and hard method.  In this publication I will tell you what method occurred to me - I could not help but share it. <br><a name="habracut"></a><br>  So, I was confused by the data dictionary: from 1 to 10,000 and at the same time, limited resources.  Decided to do the following.  To begin with, we will generate the input file we need, without writing it with our hands.  For this, I used the good old rnd: <br><br><pre><code class="cs hljs">System.IO.StreamWriter file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.IO.StreamWriter(<span class="hljs-string"><span class="hljs-string">@"C:\1\Nabor.txt"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  Random rnd = new Random(); this.progressBar1.Maximum = Convert.ToInt32(this.textBox1.Text); //     int value; for (int i = 0;i&lt;Convert.ToInt32(this.textBox1.Text);i++) //     { value = rnd.Next(0, 10000); file.WriteLine(value); //       this.progressBar1.Value++; } file.Close();</span></span></code> </pre> <br><br>  Next, the sorting itself: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>1.</b> Create an array int [10000].  In RAM, it will take 40 MB.  In C # (a little more in other languages).  I will call it a <b>RAM</b> array, the original array is an <b>IN array</b> , and the output array is an <b>OUT array</b> . <br><br>  Why 10,000?  Because the data dictionary we have in the range from 1 to 10,000. <br><br>  <b>2.</b> Read the source file element by element (line by line in my case) and do the following with each record: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span> line; <span class="hljs-comment"><span class="hljs-comment">//     int[] arr; arr = new int[10000]; //   System.IO.StreamReader file2 = new System.IO.StreamReader(@"C:\1\Nabor.txt"); while ((line = file2.ReadLine()) != null) { arr[Convert.ToInt32(line)]++; //      } file2.Close();</span></span></code> </pre> <br>  That is, in the element of the <b>RAM array</b> with the index equal to the value read from the <b>array,</b> we make +1.  As a result, the <b>RAM array</b> will contain the number of repetitions of each element from the <b>array IN</b> . <br><br>  He visually tried to portray in the figure: <br><div style="text-align:center;"><img src="https://habrastorage.org/files/104/6c1/3a2/1046c13a26894e1eb36ffafdd7a8a874.PNG"></div><br>  <b>3.</b> And the last stage we run through our <b>RAM array</b> and write down in turn all the indices of the <b>RAM array</b> elements by the number of their repetitions: <br><br><pre> <code class="cs hljs">System.IO.StreamWriter file3 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.IO.StreamWriter(<span class="hljs-string"><span class="hljs-string">@"C:\1\Sort.txt"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i, j; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-number"><span class="hljs-number">10000</span></span>;i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (arr[i]&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment">//     { for (j = 0; j &lt; arr[i]; j++) // ,    =   RAM { file3.WriteLine(i); //   ,     } } } file3.Close();</span></span></code> </pre> <br>  Thus, the file size of 575MB with 100,000,000 entries was sorted and recorded in 7.53 seconds on the machine: AMD A10, 6GB, SATA.  Without greed to memory and resources. <br><br>  Finally I want to say that <b>you need to use this method carefully</b> , avoiding type overflow.  That is, if we take an array of 5,000,000,000 values, even with the same data dictionary, and assume that all the values ‚Äã‚Äãin it are the same number, then an overflow of the int type will occur, and the program will throw an exception. <br><br>  I think it makes no sense to lay out the whole project, but if you have any wishes, I‚Äôll post it.  Successful development!) </div><p>Source: <a href="https://habr.com/ru/post/308978/">https://habr.com/ru/post/308978/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../308966/index.html">New release of Kali Linux 2016.2</a></li>
<li><a href="../308968/index.html">AMD introduces new security mechanisms for its AMD-V hypervisor</a></li>
<li><a href="../308972/index.html">The logic of consciousness. Part 3. Holographic memory in a cellular automaton</a></li>
<li><a href="../308974/index.html">Tabs or spaces? Analysis of 400 thousand GitHub repositories, billion files, 14 TB code</a></li>
<li><a href="../308976/index.html">A gift for September 1 to all fans of digital circuitry and computer architecture</a></li>
<li><a href="../308980/index.html">Input lag during rendering and how to win</a></li>
<li><a href="../308982/index.html">Sorry, we are launching a new product.</a></li>
<li><a href="../308984/index.html">Everyone will die, and I will stay: replication and disaster recovery to the cloud using Veeam Cloud Connect Replication</a></li>
<li><a href="../308986/index.html">Meet p5.js</a></li>
<li><a href="../308988/index.html">Go to 2FA (Two-Factor Authentication for ASA SSL VPN)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>