<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Little Brave Arkanoid (Part 1 - IwGl)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As I said, the framework I described earlier lacks a lot to be considered a full-fledged game engine. It does not have physics simulation, it uses inf...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Little Brave Arkanoid (Part 1 - IwGl)</h1><div class="post__text post__text-html js-mediator-article">  As I said, the <a href="http://habrahabr.ru/post/161681/">framework</a> I described earlier lacks a lot to be considered a full-fledged game engine.  It does not have physics simulation, it uses inflexible and not fast Iw2D for graphics output.  In fact, all he can do is perform 2D sprite animations, accompanied by sound effects.  In order to somehow grow above oneself, it is obviously necessary to master new opportunities, but it is boring and uninteresting to do this without having a goal. <br><br>  We will set a goal, and develop a small prototype of the well-known game <a href="http://ru.wikipedia.org/wiki/Arkanoid">Arcanoid</a> .  For a start, let's try to heed the <a href="http://habrahabr.ru/post/161681/">advice of the</a> distinguished <a href="http://habrahabr.ru/users/crmmaster/" class="user_link">crmMaster</a> and try to figure out what IwGl is and how it can be used.  True, we will not pull the textures on the cube today.  We must start with a simple one, and today we will learn to draw triangles. <br><a name="habracut"></a><br>  So, we know about Open GL that he can draw triangles.  We also know that he can draw them with a beautiful gradient fill, quickly and quite a lot.  Knowing how to quickly draw a lot of triangles, you can draw anything. <br><br>  Let's start as usual with the mkb file: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">arcanoid.mkb</b> <div class="spoiler_text"><pre><code class="cpp hljs">#!/usr/bin/env mkb options { } subprojects { iwgl } includepath { ./source/Main ./source/Model } files { [Main] (source/Main) Main.cpp Main.h Quads.cpp Quads.h Desktop.cpp Desktop.h IO.cpp IO.h [Model] (source/Model) Bricks.cpp Bricks.h Ball.cpp Ball.h Board.cpp Board.h } assets { }</code> </pre> <br></div></div><br>  Here we announce that we intend to use IwGl to display the graphics, and also define several files with the source text that we intend to write today. <br><br>  The Main module, traditionally, will contain the main application loop, as well as the initialization and deinitialization of all subsystems. <br><br><div class="spoiler">  <b class="spoiler_title">Main.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Main.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"s3e.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"IwGL.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Desktop.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"IO.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Quads.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Board.h"</span></span></span><span class="hljs-meta"> Board board; void init() { desktop.init(); io.init(); quads.init(); board.init(); } void release() { io.release(); desktop.release(); } int main() { init(); { while (!s3eDeviceCheckQuitRequest()) { io.update(); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (io.isKeyDown(s3eKeyAbsBSK) || io.isKeyDown(s3eKeyBack)) break; quads.update(); desktop.update(); board.update(); board.refresh(); quads.refresh(); io.refresh(); desktop.refresh(); } } release(); return 0; }</span></span></code> </pre><br></div></div><br>  I tried to hide all the marmalade code, scattering it across various subsystems.  The simplest of these subsystems is the IO module.  His task, for today, is handling the keyboard state.  As I said earlier, we have to handle pressing the ‚ÄúBack‚Äù button in order to correctly terminate the application on the Android platform. <br><br><div class="spoiler">  <b class="spoiler_title">IO.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> _IO_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _IO_H_ class IO { public: void init() {} void release() {} void update(); void refresh() {} bool isKeyDown(s3eKey key) const; }; extern IO io; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// _IO_H_</span></span></span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">IO.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"s3e.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"IO.h"</span></span></span><span class="hljs-meta"> IO io; void IO::update() { s3eKeyboardUpdate(); } bool IO::isKeyDown(s3eKey key) const { return (s3eKeyboardGetState(key) &amp; S3E_KEY_STATE_DOWN) == S3E_KEY_STATE_DOWN; }</span></span></code> </pre><br></div></div><br>  Having finished with the boring part, go to the Desktop module.  He will be engaged in the actual drawing of IwGl frames, as well as recalculating some abstract coordinates (in which the model will work) into physical ones, depending on the screen size of the device on which we launched the application. <br><br><div class="spoiler">  <b class="spoiler_title">Desktop.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> _DESKTOP_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _DESKTOP_H_ class Desktop { private: int width; int height; int vSize; int duration; public: void init(); void release(); void update(); void refresh(); int getWidth() const {return width;} int getHeight() const {return height;} void setVSize(int v) {vSize = v;} int toRSize(int x) const; }; extern Desktop desktop; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// _DESKTOP_H_</span></span></span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Desktop.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"IwGL.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"s3e.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Desktop.h"</span></span></span><span class="hljs-meta"> Desktop desktop; void Desktop::init() { IwGLInit(); glClearColor(0, 0, 0, 0); width = IwGLGetInt(IW_GL_WIDTH); height = IwGLGetInt(IW_GL_HEIGHT); vSize = 0; duration = 1000 / 60; } void Desktop::release() { IwGLTerminate(); } void Desktop::update() { glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT); glMatrixMode(GL_PROJECTION); glLoadIdentity(); glOrthof(0, (float)width, (float)height, 0, -10.0f, 10.0f); glViewport(0, 0, width, height); } void Desktop::refresh() { IwGLSwapBuffers(); s3eDeviceYield(duration); } int Desktop::toRSize(int x) const { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (vSize == 0) return x; return (x * width) / vSize; }</span></span></code> </pre><br></div></div><br>  On the code of recalculation of logical coordinates in the screen, while you can not pay attention.  We will need it when we learn to download the level description. <br><br>  Attention should be paid to how the frame is redrawn in the update method.  The image is initially built in a hidden buffer, after which the hidden and visible buffers are switched by calling IwGLSwapBuffers.  Screen cleaning and camera setup for 2D images are carried out in the update method (I‚Äôll say right away that I looked at all this code in the standard example IwGL / IwGLVirtualRes).  From this, it is clear that the update method should be called before drawing any primitives, and refresh when done, to redraw the screen. <br><br>  The second point I overlooked in IwGLVirtualRes is the way to quickly output an array of triangles.  This task will be handled by the Quads module. <br><br><div class="spoiler">  <b class="spoiler_title">Quads.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> _QUADS_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _QUADS_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAX_QUADS 2000 class Quads { private: int16 Verts[MAX_QUADS * 4 * 2]; uint16 Inds[MAX_QUADS * 6]; uint32 Cols[MAX_QUADS * 4]; int outQuad; public: void init(); void update() {outQuad = 0;} void refresh(); int16* getQuadPoints(); uint32* getQuadCols(); }; extern Quads quads; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// _QUADS_H_</span></span></span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Quads.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"IwGL.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"s3e.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Quads.h"</span></span></span><span class="hljs-meta"> Quads quads; void Quads::init() { uint16* inds = Inds; for (int n = 0; n </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt; MAX_QUADS; n++) { uint16 baseInd = n*4; //Triangle 1 *inds++ = baseInd; *inds++ = baseInd+1; *inds++ = baseInd+2; //Triangle 2 *inds++ = baseInd; *inds++ = baseInd+2; *inds++ = baseInd+3; } glVertexPointer(2, GL_SHORT, 0, Verts); glEnableClientState(GL_VERTEX_ARRAY); glColorPointer(4, GL_UNSIGNED_BYTE, 0, Cols); glEnableClientState(GL_COLOR_ARRAY); } void Quads::refresh() { glDrawElements(GL_TRIANGLES, outQuad*6, GL_UNSIGNED_SHORT, Inds); } int16* Quads::getQuadPoints() { if (outQuad &gt;= MAX_QUADS) return NULL; return Verts + 2 * 4 * outQuad; } uint32* Quads::getQuadCols() { if (outQuad &gt;= MAX_QUADS) return NULL; return Cols + 4 * outQuad++; }</span></span></span></span></code> </pre><br></div></div><br>  Any display object, for its drawing, can request from the Quads module a set of pairs of triangles, changing their parameters accordingly.  Upon completion, Quads will display all the triangles that have been changed in a single call to glDrawElements.  In this way, the Bricks module will be able to draw several rectangles on the screen. <br><br><div class="spoiler">  <b class="spoiler_title">Bricks.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> _BRICKS_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _BRICKS_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"IwGL.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"s3e.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Desktop.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> BRICK_COLOR_1 0xffffff00 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> BRICK_COLOR_2 0xff50ff00 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> BRICK_HALF_WIDTH 20 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> BRICK_HALF_HEIGHT 10 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;vector&gt; using namespace std; class Bricks { private: struct SBrick { SBrick(int x, int y): x(x), y(y), hw(BRICK_HALF_WIDTH), hh(BRICK_HALF_HEIGHT), ic(BRICK_COLOR_1), oc(BRICK_COLOR_2) {} SBrick(const SBrick&amp; p): x(px), y(py), hw(p.hw), hh(p.hh), ic(p.ic), oc(p.oc) {} int x, y, hw, hh, ic, oc; }; vector&lt;SBrick&gt; bricks; public: Bricks(): bricks() {} void refresh(); void clear(){bricks.clear();} void add(SBrick&amp; b); typedef vector&lt;SBrick&gt;::iterator BIter; friend class Board; }; #endif // _BRICKS_H_</span></span></span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Bricks.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Bricks.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Quads.h"</span></span></span><span class="hljs-meta"> void Bricks::refresh() { for (BIter p = bricks.begin(); p != bricks.end(); ++p) { CIwGLPoint point(p-&gt;x, p-&gt;y); point = IwGLTransform(point); int16* quadPoints = quads.getQuadPoints(); uint32* quadCols = quads.getQuadCols(); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> ((quadPoints == NULL) || (quadCols == NULL)) break; *quadPoints++ = point.x - p-&gt;hw; *quadPoints++ = point.y + p-&gt;hh; *quadCols++ = p-&gt;ic; *quadPoints++ = point.x + p-&gt;hw; *quadPoints++ = point.y + p-&gt;hh; *quadCols++ = p-&gt;oc; *quadPoints++ = point.x + p-&gt;hw; *quadPoints++ = point.y - p-&gt;hh; *quadCols++ = p-&gt;ic; *quadPoints++ = point.x - p-&gt;hw; *quadPoints++ = point.y - p-&gt;hh; *quadCols++ = p-&gt;oc; } } void Bricks::add(SBrick&amp; b) { bricks.push_back(b); }</span></span></code> </pre><br></div></div><br>  We use two colors to draw gradient rectangles. <br><br>  Now that we have coped with the rectangles, we have a more interesting task.  We need, using triangles, to draw a ball (well, well, not a ball, but a circle, with a nice gradient fill representing a highlight). <br><br><div class="spoiler">  <b class="spoiler_title">Ball.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> _BALL_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _BALL_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;vector&gt; #include "IwGL.h" #include "s3e.h" #include "Desktop.h" #define MAX_SEGMENTS 7 #define BALL_COLOR_1 0x00000000 #define BALL_COLOR_2 0xffffffff #define BALL_RADIUS 15 using namespace std; class Ball { private: struct Offset { Offset(int dx, int dy): dx(dx), dy(dy) {} Offset(const Offset&amp; p): dx(p.dx), dy(p.dy) {} int dx, dy; }; vector&lt;Offset&gt; offsets; int x; int y; public: void init(); void refresh(); virtual void setXY(int X, int Y); typedef vector&lt;Offset&gt;::iterator OIter; }; #endif // _BALL_H_</span></span></span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Ball.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Ball.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Quads.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Desktop.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;math.h&gt; #define PI 3.14159265f void Ball::init(){ x = desktop.getWidth() / 2; y = desktop.getHeight()/ 2; float delta = PI / (float)MAX_SEGMENTS; float angle = delta / 2.0f; float r = (float)desktop.toRSize(BALL_RADIUS); for (int i = 0; i &lt; MAX_SEGMENTS; i++) { offsets.push_back(Offset((int16)(cos(angle) * r), (int16)(sin(angle) * r))); angle = angle + delta; offsets.push_back(Offset((int16)(cos(angle) * r), (int16)(sin(angle) * r))); angle = angle + delta; offsets.push_back(Offset((int16)(cos(angle) * r), (int16)(sin(angle) * r))); } } void Ball::setXY(int X, int Y) { x = X; y = Y; } void Ball::refresh() { CIwGLPoint point(x, y); point = IwGLTransform(point); OIter o = offsets.begin(); int r = desktop.toRSize(BALL_RADIUS); for (int i = 0; i &lt; MAX_SEGMENTS; i++) { int16* quadPoints = quads.getQuadPoints(); uint32* quadCols = quads.getQuadCols(); if ((quadPoints == NULL) || (quadCols == NULL)) break; *quadPoints++ = point.x + (r / 4); *quadPoints++ = point.y + (r / 4); *quadCols++ = BALL_COLOR_2; *quadPoints++ = point.x + o-&gt;dx; *quadPoints++ = point.y + o-&gt;dy; *quadCols++ = BALL_COLOR_1; o++; *quadPoints++ = point.x + o-&gt;dx; *quadPoints++ = point.y + o-&gt;dy; *quadCols++ = BALL_COLOR_1; o++; *quadPoints++ = point.x + o-&gt;dx; *quadPoints++ = point.y + o-&gt;dy; *quadCols++ = BALL_COLOR_1; o++; } }</span></span></span></span></code> </pre><br></div></div><br>  Recalling the school trigonometry course, we divide the circle into segments.  In order to simulate a flare, move the top of all segments slightly to the right and down from the center of the circle.  Well, in order not to deal with all this trigonometry with each redrawing, we calculate all coordinates once, in the init method. <br><br>  Implementing the remaining Board module, for now, is trivial. <br><br><div class="spoiler">  <b class="spoiler_title">Board.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> _BOARD_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _BOARD_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Bricks.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Ball.h"</span></span></span><span class="hljs-meta"> class Board { private: Bricks bricks; Ball ball; public: void init(); void refresh(); void update() {} }; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// _BOARD_H_</span></span></span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Board.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Board.h"</span></span></span><span class="hljs-meta"> void Board::init() { </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// DE</span></span><span class="hljs-doctag"><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-doctag">BUG:</span></span></span></span><span class="hljs-meta"><span class="hljs-comment"> Bricks::SBrick b(200, 80); bricks.add(b); // ball.init(); } void Board::refresh() { bricks.refresh(); ball.refresh(); }</span></span></span></span></code> </pre><br></div></div><br>  It remains to make the necessary settings in app.icf: <br><pre> <code class="cpp hljs">[S3E] SysGlesVersion=<span class="hljs-number"><span class="hljs-number">1</span></span> DispFixRot=FixedPortrait DataDirIsRAM=<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  and run the program for execution: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eb7/090/2e0/eb70902e0d2103a34848399c2221aa9f.png" alt="image"><br><br>  In the next <a href="http://habrahabr.ru/post/166357">article</a> , we will learn how to download a level description from a <a href="http://ru.wikipedia.org/wiki/YAML">YAML</a> file. <br></div><p>Source: <a href="https://habr.com/ru/post/165667/">https://habr.com/ru/post/165667/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../165649/index.html">Javascript: from beginning to end</a></li>
<li><a href="../165657/index.html">The new Samsung refrigerator offers recipes based on its contents.</a></li>
<li><a href="../165659/index.html">Procrastination New tasks. Part 2</a></li>
<li><a href="../165661/index.html">Quipu is an esoteric programming language based on the Incas nodular script</a></li>
<li><a href="../165663/index.html">Optimization of LIKE expression when using Sqlite in iOS application</a></li>
<li><a href="../165669/index.html">Simulate dark-eye adaptation in 3D, or HDR for dummies</a></li>
<li><a href="../165671/index.html">Mass publication of online journal articles in memory of Aaron Schwarz</a></li>
<li><a href="../165675/index.html">Results 24pullrequests</a></li>
<li><a href="../165677/index.html">ViBe - background subtraction algorithm</a></li>
<li><a href="../165681/index.html">Flyme 2.0 Review</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>