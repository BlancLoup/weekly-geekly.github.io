<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ten Node.js Questions You Can't Answer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This year, at the Forward.js JavaScript conference, I gave a talk on ‚ÄúYou don't know Node‚Äù. During the presentation, I asked the audience a few questi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ten Node.js Questions You Can't Answer</h1><div class="post__text post__text-html js-mediator-article">  This year, at the Forward.js JavaScript conference, I gave a talk on ‚ÄúYou don't know Node‚Äù.  During the presentation, I asked the audience a few questions about Node, and most of those present could not answer many of them.  But my report listened to technical experts.  I didn‚Äôt make any calculations, but it looked that way, and several listeners who approached me after the performance confirmed this. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ck/un/yn/ckunynwnlbqduobuchxu1datwzo.jpeg"></div><br>  The problem that made me do this performance is that, in my opinion, the Node training system is not built correctly.  Most training materials focus on Node packages, but not on the platform itself.  Often these packages serve as wrappers for Node modules (like <code>http</code> or <code>stream</code> ).  As a result, the one who does not know Node and is faced with a problem, the source of which may not be a package, but the platform, is in a very disadvantageous position. <br><a name="habracut"></a><br>  I selected several questions and answers from that conference and included them in this article.  The questions themselves are presented in the headings of sections of the article.  Try reading the question, do not read further, but first answer it mentally.  If you find a mistake in my answers - please <a href="https://medium.com/%40samerbuna">let me know</a> . <br><br><h2>  <font color="#3AC1EF"><b>Question number 1.</b></font>  <font color="#3AC1EF">What is the call stack and is it part of the V8 engine?</font> </h2><br>  Call Stack is definitely part of the V8.  This is the data structure that V8 uses to track function calls.  Every time we call a function, V8 places a reference to this function on the call stack, and when other functions are called from this function, it continues to do the same with references to them.  In addition, functions that call themselves recursively are added to the stack. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/4e2/20d/048/4e220d0484a3eeef9fc2e9071c6ea913.png"><br>  <i><font color="#999999">Call stack</font></i>  <i><font color="#999999">Screenshot from my Pluralsight advanced Node.js course</font></i> <br><br>  When, with nested function calls, the function terminates, V8 retrieves the function reference from the top of the call stack and substitutes the value returned to it where the program logic requires. <br><br>  Why is it important to understand when working with Node?  The fact is that there is only one call stack for each Node process.  If the stack is full, the process will be loaded with some work.  This is worth remembering. <br><br><h2>  <font color="#3AC1EF"><b>Question number 2.</b></font>  <font color="#3AC1EF">What is the event loop?</font>  <font color="#3AC1EF">Is it part of the V8 engine?</font> </h2><br>  Where do you think the next figure shows the event loop? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a18/d00/b77/a18d00b77f3e5021a16b3d6c7fbf7d61.png"><br>  <i><font color="#999999">Environment V8.</font></i>  <i><font color="#999999">Screenshot from my Pluralsight advanced Node.js course</font></i> <br><br>  The event loop is implemented in the <code>libuv</code> library.  It is not part of the V8. <br><br>  The event loop is an entity that processes external events and converts them into callback calls.  This is a rather complicated loop that takes events from the event queue and puts their callbacks on the call stack. <br><br>  If you hear about a cycle of events for the first time, the above reasoning may not be particularly intelligible.  The event loop is part of a much more general picture: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c5c/7a2/091/c5c7a2091e1f7ba2bf782c84dc2791c4.png"><br>  <i><font color="#999999">The cycle of events.</font></i>  <i><font color="#999999">Screenshot from my Pluralsight advanced Node.js course</font></i> <br><br>  In order to understand the essence of the event cycle, it is useful to know about the environment in which it works.  You need to understand the role of V8, be aware of the Node API, and how the event queue works, the code associated with which is executed in V8. <br><br>  Node's APIs are functions like <code>setTimeout</code> or <code>fs.readFile</code> .  They are not part of javascript.  These are just functions that Node gives us access to. <br><br>  The cycle of events is in the center of all this (of course, in fact, it is all more complicated) and plays the role of an organizer.  When the V8 call stack is empty, the event loop can decide what to do next. <br><br><h2>  <font color="#3AC1EF"><b>Question number 3.</b></font>  <font color="#3AC1EF">What will Node do when the call stack and event loop queues are empty?</font> </h2><br>  The answer is simple: Node will just shut down. <br><br>  When you start the application, Node automatically starts the event loop, and when the event loop is idle, when it has nothing to do, the process shuts down. <br><br>  In order for the Node process not to complete, you need to put something in the event queue.  For example, when you start a timer or HTTP server, you tell the event loop that it needs to continue to work and monitor these events. <br><br><h2>  <font color="#3AC1EF"><b>Question number 4.</b></font>  <font color="#3AC1EF">Besides the V8 engine and the libuv library, what other external dependencies does Node have?</font> </h2><br>  Here are some standalone libraries that the Node process can use: <br><br><ul><li> <code>http-parser</code> <br> </li><li> <code>c-ares</code> <br> </li><li> <code>OpenSSL</code> <br> </li><li> <code>zlib</code> <br> </li></ul><br>  All of them, in relation to the Node, are external.  They have their own source code, their distribution is governed by separate licenses.  Node just uses them. <br><br>  This is worth remembering in order to know exactly where the code of your program is executed.  If, for example, you are doing data compression, you may encounter a problem that occurred in the depths of the <code>zlib</code> stack.  Perhaps the reason - in the library error, so do not blame all the blame on Node. <br><br><h2>  <font color="#3AC1EF"><b>Question number 5.</b></font>  <font color="#3AC1EF">Can I run the Node process without V8?</font> </h2><br>  This is a tricky question.  To run the Node process, you need a JS engine, but V8 is not the only available engine.  Alternatively, you can use Chakra. <br><br>  Take a look at <a href="https://github.com/nodejs/node-chakracore">this</a> Github repository to learn more about the <code>node-chakra</code> project. <br><br><h2>  <font color="#3AC1EF"><b>Question number 6.</b></font>  <font color="#3AC1EF">What is the difference between module.exports and exports?</font> </h2><br>  To export modules API you can always use the <code>module.exports</code> command.  You can, with the exception of one situation, use and <code>exports</code> : <br><br><pre> <code class="hljs java"><span class="hljs-keyword"><span class="hljs-keyword">module</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">exports</span></span>.g = ...  <span class="hljs-comment"><span class="hljs-comment">// Ok exports.g = ...         // Ok module.exports = ...    // Ok exports = ...           //   Ok</span></span></code> </pre> <br>  Why? <br><br>  The <code>exports ‚Äî</code> command is just a link, an alias for the <code>module.exports</code> construct.  When you try to write something directly to <code>exports</code> , you change the link that is stored there, as a result, during subsequent calls to <code>exports</code> you no longer work with what this variable refers to in the official API (and this is <code>module.exports</code> ) .  By writing something to <code>exports</code> , you turn this keyword into a local variable within the scope of the module. <br><br><h2>  <font color="#3AC1EF"><b>Question number 7.</b></font>  <font color="#3AC1EF">Why aren‚Äôt top-level variables global?</font> </h2><br>  Suppose you have a <code>module1</code> module in which a top-level variable <code>g</code> defined: <br><br><pre> <code class="hljs objectivec"><span class="hljs-comment"><span class="hljs-comment">// module1.js var g = 42;</span></span></code> </pre> <br>  Next, there is another module, <code>module2</code> , to which <code>module1</code> connected and trying to access the variable <code>g</code> , receiving in response an error message <code>g is not defined</code> . <br><br>  Why?  After all, if you do the same in the browser, then after connecting the scripts, you can refer to their global variables. <br><br>  Each Node file is wrapped in its own immediately invoked functional expression (IIFE, Immediately Invoked Function Expression).  All variables declared in the Node file are inside this IIFE and are not visible from the outside. <br><br>  Here is the question related to the question under consideration: what will be displayed after running the next Node file, in which there is only one line of code: <br><br><pre> <code class="hljs objectivec"><span class="hljs-comment"><span class="hljs-comment">// script.js console.log(arguments);</span></span></code> </pre> <br>  Obviously, some arguments will fall into the console! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4b7/bbb/5b6/4b7bbb5b62a5aeed10aed25698dc8be9.png"><br>  <i><font color="#999999">Output arguments</font></i> <br><br>  Why?  The point is that this Node file performs as a function.  Node wraps the code in a function and this function has five arguments, which can be seen in the figure. <br><br><h2>  <font color="#3AC1EF"><b>Question number 8.</b></font>  <font color="#3AC1EF">The exports, require, and module objects are globally available in each file, but each file has its own instances.</font>  <font color="#3AC1EF">How is this possible?</font> </h2><br>  When you need a <code>require</code> object, you simply call it directly, as if it were a global variable.  However, if you examine the <code>require</code> in two different files, it turns out that we have two different objects.  Why is this so? <br><br>  The whole thing - in the already familiar to us IIFE: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/844/d0e/2b4/844d0e2b484376c14be12e187c5843c7.png"><br>  <i><font color="#999999">Study of the features of the work Node</font></i> <br><br>  As you can see, IIFE passes the following five arguments to the code: <code>exports</code> , <code>require</code> , <code>module</code> , <code>__filename</code> , and <code>__dirname</code> . <br><br>  These five variables appear to be global when used in Node, but they are, in fact, the usual function arguments. <br><br><h2>  <font color="#3AC1EF">Question number 9.</font>  <font color="#3AC1EF">What are the cyclic dependencies of modules in Node?</font> </h2><br>  If you have a module <code>module1</code> , which depends on <code>module2</code> , and <code>module2</code> , in turn, depends on <code>module1</code> , what happens?  Will an error message appear? <br><br><pre> <code class="hljs perl">// module1 <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./module2'</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> module2 <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./module1'</span></span>);</code> </pre> <br>  There will be no error message.  Node allows this. <br><br>  So, <code>module1</code> connects to <code>module2</code> , but since <code>module2</code> connects to <code>module1</code> and <code>module1</code> is not fully ready yet, <code>module1</code> will simply receive an incomplete version of <code>module2</code> .  Now you know about it. <br><br><h2>  <font color="#3AC1EF">Question number 10.</font>  <font color="#3AC1EF">When is it permissible to use synchronous methods for working with the file system (like readFileSync)?</font> </h2><br>  Each asynchronous method of the <code>fs</code> object in Node has a synchronous version.  Why use synchronous methods instead of asynchronous? <br><br>  Sometimes there is nothing wrong with synchronous methods.  For example, they can be useful at the initialization stage, when the server is loaded.  Often they are used like this when everything that is done after initialization depends on the data loaded at the initialization stage.  Instead of building code based on callbacks in such situations, when a one-time download of any data is performed, synchronous methods are quite acceptable. <br><br>  However, if you use synchronous methods inside some event handlers, such as the HTTP server callback, which is responsible for handling requests, then this is absolutely wrong without options.  Doing so strongly is not recommended. <br><br><h2>  <font color="#3AC1EF">Results</font> </h2><br>  I hope you were able to answer all these questions, or at least some of them. <br><br>  Dear readers!  If you were at a JS conference, in the place of the author of this article, what questions about Node.js would you ask the audience? </div><p>Source: <a href="https://habr.com/ru/post/341646/">https://habr.com/ru/post/341646/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../341636/index.html">We document and test the REST API using SpringRestDocs</a></li>
<li><a href="../341638/index.html">Open Data Council: Related Data Working Group, Openness of FIU and Rosleskhoz</a></li>
<li><a href="../341640/index.html">Lenovo ThinkSystem SR950 Server Overview</a></li>
<li><a href="../341642/index.html">PM from Facebook: Counterintuitive conclusions about management (part 1)</a></li>
<li><a href="../341644/index.html">Security Week 44: a quiet hunt, or Carbanak to help, why the Firefox features Tor Browser, a Google loophole - buganizer</a></li>
<li><a href="../341648/index.html">Statistics identify software vulnerabilities in the framework of certification tests</a></li>
<li><a href="../341650/index.html">Orange Pi Zero WiFi Speaker / Player or Lost Time Story</a></li>
<li><a href="../341652/index.html">From user to CAD developers</a></li>
<li><a href="../341654/index.html">The cat died, the tail peeled off</a></li>
<li><a href="../341656/index.html">We invite to the conference FPConf 2017</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>