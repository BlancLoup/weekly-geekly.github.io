<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write the console alarm clock on BASH-e</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The task "Wake up in the morning" for me, frankly, is quite complicated. A week ago, I got the idea: to write a simple alarm clock that will play musi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write the console alarm clock on BASH-e</h1><div class="post__text post__text-html js-mediator-article">  The task "Wake up in the morning" for me, frankly, is quite complicated.  A week ago, I got the idea: to write a simple alarm clock that will play music louder and louder until you solve a mathematical example. <br><br><img src="https://habrastorage.org/storage2/ab0/2cb/dbd/ab02cbdbd5f65d7d6ec48034770e1d2a.png"><br><a name="habracut"></a><br><br>  There are some <a href="http://ubuntovod.ru/instructions/budilnik-rtcwake-cron.html">articles</a> and <a href="http://linuxforum.ru/viewtopic.php%3Fid%3D19367">topics</a> in Google, but this is not what is needed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I‚Äôll just say that the computer (in my case, the laptop) is in sleep mode at night, so it will need a little charge for the night (it takes about 30% of the battery overnight). <br>  If you have a desktop computer, there are interruptions in electricity and there is no <a href="http://ru.wikipedia.org/wiki/%25D0%2598%25D0%2591%25D0%259F">UPS</a> , then do not risk. <br><br>  Next, you need to make sure that your computer supports certain sleep modes.  You can read about it <a href="http://wiki.linux.ru/wiki/index.php/%25D0%2591%25D1%2583%25D0%25B4%25D0%25B8%25D0%25BC_%25D0%25B2%25D0%25B0%25D1%2588_%25D0%25BA%25D0%25BE%25D0%25BC%25D0%25BF%25D1%258C%25D1%258E%25D1%2582%25D0%25B5%25D1%2580_%25D1%2581_%25D0%25BF%25D0%25BE%25D0%25BC%25D0%25BE%25D1%2589%25D1%258C%25D1%258E_%25D0%25B7%25D0%25B0%25D0%25B4%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B9_%25D0%25B2_%25D0%25BF%25D0%25BB%25D0%25B0%25D0%25BD%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D1%2589%25D0%25B8%25D0%25BA%25D0%25B5">here</a> . <br><br><h5>  What do we need? </h5><br>  - <b>rtcwake</b> utility - for falling asleep computer (built into the kernel). <br>  - Utility <b>amixer</b> - to gradually increase the volume of the sound. <br>  - Any player that allows you to play music in a loop (in my case <b>mplayer</b> ). <br><br><h5>  Let's start </h5><br>  Set the necessary variables: <br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    tm='07:05' #   volume=10 #   volume_max=90 #     sec=2 #    folder=~username/Music/alarm/* #     temp=`mktemp -t alarm_status_XXX.txt`</span></span></code> </pre> <br>  Everything is clear here. <br>  "Time to change the task" - idle time before generating a new task. <br>  ‚ÄúFolder with music‚Äù - a folder from which you need to take a list of music.  I just created the alarm folder and created hard links to the songs I need. <br>  "Temporary file for status" - needed to complete the increase in volume.  If there is a non-empty file, then we complete the background process (by the way, you can simply find our process through ‚Äújobs -l‚Äù). <br><br>  Now you need to write a function that will kill the mplayer processes and / or re-play random music. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   alarm_start() { #    mplayer- jbs=(`ps al | grep [m]player | gawk -F ' ' '{print $3}'`) for job in ${jbs[*]} ; do kill -15 $jbs done #       if [ -z "$1" ] ; then mplayer -loop 0 -shuffle $folder &amp;&gt; /dev/null &amp; fi }</span></span></code> </pre><br>  Also need to intercept signals the completion of the process. <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">trap</span></span> <span class="hljs-string"><span class="hljs-string">"echo -e '\n,  !' &amp;&amp; sleep 1 &amp;&amp; alarm_start"</span></span> SIGINT SIGTERM SIGHUP SIGQUIT SIGTSTP SIGSTOP</code> </pre><br>  In order to be able to specify the waking time, we will use the optional parameter $ 1.  Immediately do all the validity checks date. <br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [[ <span class="hljs-variable"><span class="hljs-variable">$#</span></span> &gt; 0 ]] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [[ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> == [0-9]:[0-9][0-9] ]] || [[ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> == [0-9][0-9]:[0-9][0-9] ]] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> tm=<span class="hljs-variable"><span class="hljs-variable">$1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'  . : "07:00".'</span></span> &gt;&amp;2 <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> 10 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> date1=$(date -d <span class="hljs-string"><span class="hljs-string">"`date +%m/%d/%y` </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$tm</span></span></span><span class="hljs-string">"</span></span> +%s) date2=$(date -d <span class="hljs-string"><span class="hljs-string">"`date +%m/%d/%y` </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$tm</span></span></span><span class="hljs-string"> tomorrow"</span></span> +%s) <span class="hljs-comment"><span class="hljs-comment">#   (  ) err=$? if [[ $err &gt; 0 ]] ; then echo '  . : "07:00".' &gt;&amp;2 exit $err fi #       ,     if [[ $date1 &lt; `date -u +%s` ]] ; then date=$date2 else date=$date1 fi</span></span></code> </pre><br>  The variables date1 and date2 are needed in case the user specifies the past date, then the time for waking up will be set tomorrow.  If time is specified, for example, ‚Äú07:99‚Äù, then the error code will be entered into the err variable. <br><br>  Now you can "make" the computer to sleep.  <b>rtcwake requires superuser privileges</b> .  You can use sudo.  Everything that you do - you do at your own peril and risk. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  sudo rtcwake -m mem -t $date #   amixer -q set Master $volume% #   alarm_start</span></span></code> </pre><br>  About rtcwake, as already mentioned, you can read <a href="http://wiki.linux.ru/wiki/index.php/%25D0%2591%25D1%2583%25D0%25B4%25D0%25B8%25D0%25BC_%25D0%25B2%25D0%25B0%25D1%2588_%25D0%25BA%25D0%25BE%25D0%25BC%25D0%25BF%25D1%258C%25D1%258E%25D1%2582%25D0%25B5%25D1%2580_%25D1%2581_%25D0%25BF%25D0%25BE%25D0%25BC%25D0%25BE%25D1%2589%25D1%258C%25D1%258E_%25D0%25B7%25D0%25B0%25D0%25B4%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B9_%25D0%25B2_%25D0%25BF%25D0%25BB%25D0%25B0%25D0%25BD%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D1%2589%25D0%25B8%25D0%25BA%25D0%25B5">here</a> . <br><br>  It remains only to make a volume increase and an example for the solution. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    while true ; do amixer sset Master 1%+ &amp;&gt; /dev/null volume=$(( $volume+1 )) if [ $volume -eq $volume_max ] ; then break elif [ -s "$temp" ] ; then rm "$temp" #    amixer -q set Master 50% break fi sleep 2 done &amp;</span></span></code> </pre><br>  With the line ‚Äúamixer sset Master 1% + &amp;&gt; / dev / null‚Äù we indicate that you need to increase the volume by 1 percent and do not need to display anything on the screen. <br>  The ampersand &amp; after the done operator is needed so that the volume increase is in the background. <br><br>  And generate an example: <br><pre> <code class="bash hljs">clear <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'    :'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-comment"><span class="hljs-comment">#  echo " $sec ." sleep $sec #     var1=$(( $RANDOM % 10000 - 5000 )) var2=$(( ($RANDOM % 100000 - 50000)/($RANDOM % 800 + 1) )) #  case $(( $RANDOM % 3 )) in 0) opt='+' result=$(( $var1 + $var2 )) ;; 1) opt='-' result=$(( $var1 - $var2 )) ;; 2) opt='*' var2=$(( ($RANDOM % 5 + 5) )) result=$(( $var1 * $var2 )) ;; esac #   if [[ $var2 &lt; 0 ]] ; then if [[ "$opt" == '-' ]] ; then opt='+' var2=$(( $var2 * -1 )) elif [[ "$opt" == '+' ]] ; then opt='-' var2=$(( $var2 * -1 )) fi fi #  read -p "$var1 $opt $var2 = " answer #       if [[ $answer == $result ]] ; then echo "! : $result." break else clear echo -n "!   : $var1 $opt $var2 = $result." if [ -n "$answer" ] ; then echo "  : $answer." else echo "" fi fi done #   ,      alarm_start false #     echo "done" &gt; "$temp"</span></span></code> </pre><br><br>  That's all.  The alarm clock was written a week ago.  The phone alarms were off.  For this week I could easily wake up while solving an example (the problem can be very simple (1020 - 120) or difficult (394 * 5). One morning I came across an example of multiplication 13 times in a row). <br><br>  You can create an alias in the ~ / .bashrc file: "alias alarm = '~ / path_to_script / alarm.sh'" <br>  To prevent the alarm from turning off by closing the console program, I exit the current session and switch to another console (Alt + Ctrl + F1 or another F [1-7]). <br>  If you wish, you can turn off the alarm by giving a forced close signal, but to do this you will need to go to another console, log in, find this process and kill.  Faster probably solve an example :) <br><br><div class="spoiler">  <b class="spoiler_title">Full alarm code</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #  #   alarm_start() { #    mplayer- jbs=(`ps al | grep [m]player | gawk -F ' ' '{print $3}'`) for job in ${jbs[*]} ; do kill -15 $jbs done #       if [ -z "$1" ] ; then mplayer -loop 0 -shuffle $folder &amp;&gt; /dev/null &amp; fi } #    tm='07:05' #   volume=10 #   volume_max=90 #     sec=2 #    folder=~username/Music/alarm/* #     temp=`mktemp -t alarm_status_XXX.txt` #      trap "echo -e '\n,  !' &amp;&amp; sleep 1 &amp;&amp; alarm_start" SIGINT SIGTERM SIGHUP SIGQUIT SIGTSTP SIGSTOP if [[ $# &gt; 0 ]] ; then if [[ "$1" == [0-9]:[0-9][0-9] ]] || [[ "$1" == [0-9][0-9]:[0-9][0-9] ]] ; then tm=$1 else echo '  . : "07:00".' &gt;&amp;2 exit 10 fi fi date1=$(date -d "`date +%m/%d/%y` $tm" +%s) date2=$(date -d "`date +%m/%d/%y` $tm tomorrow" +%s) #   (  ) err=$? if [[ $err &gt; 0 ]] ; then echo '  . : "07:00".' &gt;&amp;2 exit $err fi #       ,     if [[ $date1 &lt; `date -u +%s` ]] ; then date=$date2 else date=$date1 fi #  sudo rtcwake -m mem -t $date # sudo echo "$date" &gt; /sys/class/rtc/rtc0/wakealarm #   amixer -q set Master $volume% #   # day=$(( `date +%u` - 1 )) #   alarm_start #    while true ; do amixer sset Master 1%+ &amp;&gt; /dev/null volume=$(( $volume+1 )) if [ $volume -eq $volume_max ] ; then break elif [ -s "$temp" ] ; then rm "$temp" #    amixer -q set Master 50% break fi sleep 2 done &amp; clear echo '    :' while true ; do #  echo " $sec ." sleep $sec #     var1=$(( $RANDOM % 10000 - 5000 )) var2=$(( ($RANDOM % 100000 - 50000)/($RANDOM % 800 + 1) )) #  case $(( $RANDOM % 3 )) in 0) opt='+' result=$(( $var1 + $var2 )) ;; 1) opt='-' result=$(( $var1 - $var2 )) ;; 2) opt='*' var2=$(( ($RANDOM % 5 + 5) )) result=$(( $var1 * $var2 )) ;; esac #   if [[ $var2 &lt; 0 ]] ; then if [[ "$opt" == '-' ]] ; then opt='+' var2=$(( $var2 * -1 )) elif [[ "$opt" == '+' ]] ; then opt='-' var2=$(( $var2 * -1 )) fi fi #  read -p "$var1 $opt $var2 = " answer #       if [[ $answer == $result ]] ; then echo "! : $result." break else clear echo -n "!   : $var1 $opt $var2 = $result." if [ -n "$answer" ] ; then echo "  : $answer." else echo "" fi fi done alarm_start false #     echo "done" &gt; "$temp"</span></span></code> </pre><br></div></div><br>  For convenience, the code is copied to <a href="http://pastebin.com/g9jcg3i0">pastebin</a> so that you can <a href="http://pastebin.com/download.php%3Fi%3Dg9jcg3i0">download it</a> . <br><br>  I hope this alarm will make not sleep on study or work :) </div><p>Source: <a href="https://habr.com/ru/post/159987/">https://habr.com/ru/post/159987/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../159977/index.html">We invite to work secret agents</a></li>
<li><a href="../159979/index.html">Level Up in Project Management</a></li>
<li><a href="../159981/index.html">Forum "Robots 2012"</a></li>
<li><a href="../159983/index.html">AWS TCO Calculator</a></li>
<li><a href="../159985/index.html">OCUnit in Xcode 4.5 for newbies</a></li>
<li><a href="../159997/index.html">Murphy's Laws in IT</a></li>
<li><a href="../160001/index.html">Modding Angel Eyes</a></li>
<li><a href="../160003/index.html">Ways to create navicon</a></li>
<li><a href="../160007/index.html">The digest of interesting news and materials from the world of ayti for the last week ‚Ññ32 (November 17 - 23, 2012)</a></li>
<li><a href="../160009/index.html">O Boost Multi-index Containers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>