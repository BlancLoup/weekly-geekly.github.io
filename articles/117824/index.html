<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introduction to Core Graphics on iOS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I recently discovered that there are no articles on working with Core Graphics in iOS, as well as I did not find similar articles in Russian. The Appl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introduction to Core Graphics on iOS</h1><div class="post__text post__text-html js-mediator-article">  I recently discovered that there are no articles on working with Core Graphics in iOS, as well as I did not find similar articles in Russian.  The Apple site for developers has documentation on working with 2D graphics in the iOS - Core Graphics Framework Reference, which includes 400 pages of documentation, useful as a reference, but does not give an initial idea of ‚Äã‚Äãworking with views and drawing.  So I decided to write an introductory article on working with 2D graphics in iOS. <a name="habracut"></a><br><br><h4>  Introduction </h4><br>  Cocoa Touch is not known to include AppKit, which provides classes and methods for working with the interface on Mac OS X. Instead of AppKit on the iOS platform, 2D uses the low-level Core Framework Core Graphics framework, which is also part of the Mac OS X SDK, but is used less frequently , since C functions and memory management are not as convenient and flexible as Objective-C classes in AppKit.  In addition, it is obvious that when working with Core Graphics, you have to write more code that is more difficult to expand and maintain.  In this article, we will create a Custom View and explore the capabilities of the framework. <br><br><h4>  Beginning of work </h4><br>  First we need to create an application and add a Custom View to it, on which we will next draw our objects. <br>  Create an Xcode View-based Application and call it Graphics. <br><img src="https://habrastorage.org/storage/habraeffect/84/a9/84a911f24a7f894a1f75d02282eeb8ed.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Next we add our View (Cmd + N) and call it MyCanvas, <br><img src="https://habrastorage.org/storage/habraeffect/d7/83/d78346f029615ab3bd0a7d3cb4cd8c82.png" alt="image"><br>  which will be an Objective-C class and a UIView subclass. <br><br>  All ‚Äúdrawing‚Äù happens in the method: <br><br> <code>- (void)drawRect:(CGRect)rect <br> { <br> //   <br> }</code> <br> <br>  Remember that we never call the -drawRect: method directly.  We only implement this method, which is executed when the View is initialized. <br>  To update the content, when we need to update this View or some part of it (aRect), we use the UIView methods. <br> <code>-(void)setNeedsDisplay; <br> -(void)setNeedsDisplayInRect:(CGRect)aRect;</code> <br>  respectively. <br><br>  Draw a simple square using the drawRect: method.  All drawing takes place in a context, which determines where drawing takes place.  To get the context, the C function UIGraphicsGetCurrentContext is used.  In iOS, the center of coordinates when drawing is in the upper left corner, and not in the lower left, as in Mac OS X. <br><br> <code>- (void)drawRect:(CGRect)rect <br> { <br> //  context <br> CGContextRef context = UIGraphicsGetCurrentContext(); <br> CGContextClearRect(context, rect); //  context <br> <br> CGContextSetRGBFillColor(context, 255, 0, 0, 1); <br> CGContextFillRect(context, CGRectMake(20, 20, 100, 100)); <br> }</code> <br> <br>  There is no need to clear the context in this case, since we will not redraw our graphics, however it is good practice to clear graphic elements before drawing.  Please note that after cleaning the View will turn black. <br><br>  The CGContextSetRGBFillColor function sets the fill color for a given context, and the CGContextFillRect function draws a square. <br><br>  Now we will launch our application in the simulator (Cmd + R), and as we see, nothing happened.  The fact is that we have not created our View and have not added it to the hierarchy. <br>  There are two ways to create a View, including Custom View - Interface Builder and directly using code.  As for IB, it's simple, add a UIView element by dragging and set the Custom Class: MyView to it in the Identity Inspector. <br>  To create our View we will manually create it in GraphicsViewController.m: <br><br> <code>- (void)viewDidLoad <br> { <br> [super viewDidLoad]; <br> MyCanvas *myView = [[MyCanvas alloc] initWithFrame:self.view.bounds]; <br> [self.view addSubview:myView]; <br> }</code> <br> <br>  AddSubview: is used to add a View to the hierarchy. RemoveFromSuperview: is removed from the hierarchy.  In this case, the first method is sent to the superview, and the second type, which needs to be deleted. <br><br>  More information about working with memory will be discussed at the end of the article, here I just note that you need to keep in mind when we release the top view in the hierarchy, we also release all of its subviews, and if we turn to them later, the application will crash. <br><br>  Now, if we launch our application, we will see a red square with indents of 20 points. <br>  When drawing, we use points (pt), not pixels (px), so that the dimensions are the same for Retina and a regular display.  Work with pixels is also possible.  To determine the type of screen for a specific device, use the property @property CGFloat contentScaleFactor;  which returns the ‚Äúscale‚Äù (how many pixels are in a point for a given view on the screen).  The value can be 2.0 for retina or 1.0 for a regular screen. <br><img src="https://habrastorage.org/storage/habraeffect/92/23/9223418332c0f3b1138ad975260b5587.png" alt="image"><br><br>  Consider working with other primitives: <br>  1) The circle with blue fill is created by the CGContextFillEllipseInRect method, and fits into the rectangle, so you can create ellipses. <br><br> <code>CGContextSetRGBFillColor(context, 0, 0, 255, 1); <br> CGContextFillEllipseInRect(context, CGRectMake(30, 140, 80, 80));</code> <br> <br>  2) A circle without a fill with a green outline and a line thickness of 3, the thickness of the line is specified by the CGContextSetLineWidth method, and a circle without a fill is drawn by the CGContextStrokeEllipseInRect method. <br><br> <code>CGContextSetRGBStrokeColor(context, 0, 255, 0, 1); <br> CGContextSetLineWidth(context, 3.0); <br> CGRect circleRect = CGRectMake(140, 20, 100, 100); <br> CGContextStrokeEllipseInRect(context, circleRect);</code> <br> <br>  3) A triangle inscribed in a red square is drawn by points from an array. <br><br> <code>CGContextSetRGBStrokeColor(context, 255, 0, 255, 1); <br> CGPoint points[6] = {CGPointMake(70, 20), CGPointMake(120, 120), <br> CGPointMake(120, 120), CGPointMake(20, 120), <br> CGPointMake(20, 120), CGPointMake(70, 20)}; <br> CGContextStrokeLineSegments(context, points, 6);</code> <br> <br>  4) Bezier spline.  In this case, you need to set the starting and ending points, as well as the coordinates of the points that define the curvature.  For those who are not familiar with Bezier curves, a short crash course: <br><img src="https://habrastorage.org/storage/habraeffect/10/8e/108e16fb14317fb247f719fd8f1fc639.png" alt="image"><br>  Set points with separate CGpoints so as not to be confused: <br><br> <code>CGPoint bezierStart = {20, 260}; <br> CGPoint bezierEnd = {300, 260}; <br> CGPoint bezierHelper1 = {80, 320}; <br> CGPoint bezierHelper2 = {240, 320}; <br> CGContextBeginPath(context); <br> CGContextMoveToPoint(context, bezierStart.x, bezierStart.y); <br> CGContextAddCurveToPoint(context, <br> bezierHelper1.x, bezierHelper1.y, <br> bezierHelper2.x, bezierHelper2.y, <br> bezierEnd.x, bezierEnd.y); <br> CGContextStrokePath(context);</code> <br> <br>  Draw a more complex element, for example, a sinusoid: <br><br> <code>CGContextSetRGBStrokeColor(context, 255, 255, 255, 1); <br> int y; <br> for(int x=rect.origin.x; x &lt; rect.size.width; x++) <br> { <br> y = ((rect.size.height/6) * sin(((x*4) % 360) * M_PI/180)) + 380; <br> if (x == 0) CGContextMoveToPoint(context, x, y); <br> else CGContextAddLineToPoint(context, x, y); <br> } <br> CGContextStrokePath(context);</code> <br> <br>  In the 5th line we added 380 points to shift the function vertically down. <br><br>  As a result, the screen of our iPhone after launching the application will look like this: <br><img src="http://habrastorage.org/storage/habraeffect/95/37/953767a4b04d5aa47db5690f0e344ad4.png" alt="image"><br><br><h4>  Work with text </h4><br>  The most convenient way to display text on the screen is to use the UILabel object, which has many methods for converting text.  However, there are situations when you need to draw text in the -drawRect method, for example, if we want to rotate the text. <br><br>  Drawing with Core Graphics: <br><br> <code>char *txt = "My CG text"; //   ,     <br> CGContextSelectFont(context, "Helvetica", 18.0, kCGEncodingMacRoman); //   <br> CGContextSetTextDrawingMode(context, kCGTextFill); //    : kCGTextFill ()  kCGTextStroke () <br> CGContextShowTextAtPoint(context, 20, 280, txt, strlen(txt)); //    </code> <br> <br>  You can use a UIFont object to select the font, size, display style, metrics.  And using the [UIFont familyNames] method, you can get an array of available fonts. <br><br>  If we want to use UILabel and create it programmatically and not in Interface Builder, we will add the following code to our GraphicsViewController.m: <br><br> <code>UILabel *scaleNumber = [[UILabel alloc] initWithFrame:CGRectMake(160, 140, 140, 21)]; // ,     View <br> scaleNumber.textColor = [UIColor yellowColor]; //   <br> scaleNumber.backgroundColor = [UIColor colorWithWhite:0 alpha:0]; //  ,        (  )  <br> scaleNumber.text = @"Vitaly Ishkulov"; //-  <br> scaleNumber.adjustsFontSizeToFitWidth = YES; // ,    ,   ,       ( ,    )    <br> [myView addSubview:scaleNumber]; //     View <br> [scaleNumber release]; //  ,     /    myView</code> <br> <br><h4>  Conclusion and a few words about working with memory </h4><br>  To release views from memory, do not use [myView release];  Instead, create a releaseOutlets method: <br> <code>- (void)releaseOutlets { <br> self.myView = nil; <br> }</code> <br>  And call this method from viewDidUnload and dealloc: <br> <code>- (void)viewDidUnload <br> { <br> [super viewDidUnload]; <br> [self releaseOutlets]; <br> // Release any retained subviews of the main view. <br> // eg self.myOutlet = nil; <br> }</code> <br> <code>- (void)dealloc <br> { <br> [self releaseOutlets]; <br> [super dealloc]; <br> }</code> <br>  A slightly weird expression self.myView = nil;  in fact, easily explained if you look at the setter that the <a href="https://habrahabr.ru/users/synthesize/" class="user_link">synthesize</a> myView command synthesizes for us: <br> <code>- (void)setMyView:(MyCanvas *)anObject <br> { <br> if (anObject != myView) { <br> [myView release]; <br> myView = [anObject retain]; <br> } <br> }</code> <br>  If anObject = nil, then the method last line in the method assigns myView to nil, and the previous one releases the current View from memory, which is what we wanted to do. <br><br>  This is a brief introduction to CoreGraphics, I hope it will be useful to someone. <br><br>  Links for further study: <br>  <a href="http://developer.apple.com/library/ios/">View Programming Guide for iOS</a> <br>  <a href="http://developer.apple.com/library/ios/">Core Graphics Framework Reference</a> </div><p>Source: <a href="https://habr.com/ru/post/117824/">https://habr.com/ru/post/117824/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../117819/index.html">Testing UPS APC Power Saving Back-UPS Pro 550</a></li>
<li><a href="../117820/index.html">ESA does not consider the recent hacking of its network critical</a></li>
<li><a href="../117821/index.html">A little about our blog. And interesting research</a></li>
<li><a href="../117822/index.html">minor changes in philips</a></li>
<li><a href="../117823/index.html">Project "Iceberg"</a></li>
<li><a href="../117825/index.html">Discount on some JetBrains products</a></li>
<li><a href="../117826/index.html">A smartphone, a second smartphone, or an uncomplicated look at the Nokia C5-03</a></li>
<li><a href="../117827/index.html">Spy on users in Django</a></li>
<li><a href="../117830/index.html">Bridgestone Introduces Flexible Electronic Paper</a></li>
<li><a href="../117832/index.html">The Cocoa Environment. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>