<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Schi, or Recognition of 330 million people at a speed of 400 photos / sec</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The recognition of faces in 2018 will not surprise anyone - every student, maybe even a schoolboy, did it. But everything becomes a bit more complicat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Schi, or Recognition of 330 million people at a speed of 400 photos / sec</h1><div class="post__text post__text-html js-mediator-article"><p>  The recognition of faces in 2018 <b>will not surprise anyone</b> - every student, maybe even a schoolboy, did it.  But everything becomes a bit more complicated when you <b>don‚Äôt</b> have <b>1 million</b> users, but: </p><br><ul><li>  <b>330 million</b> user accounts; </li><li>  <b>20 million</b> user photos are uploaded daily; </li><li>  the maximum time for processing one photo should not exceed <b>0.2 seconds</b> ; </li><li>  limited equipment for solving the problem. </li></ul><br><p> <a href="http://habrahabr.ru/post/350566/"><img src="https://habrastorage.org/webt/_i/e0/io/_ie0iovgx8sl68r1rpptcpkge4o.png"></a> </p><br><p>  In this article, we will share the experience of developing and launching the facial recognition system on user photos on the Odnoklassniki social network and tell you everything from A to Z: </p><br><ul><li>  mathematical apparatus; </li><li>  technical implementation; </li><li>  launch results; </li><li>  and the <b>StarFace</b> share that we used for PR of our solution. </li></ul><br><a name="habracut"></a><br><h2>  Task </h2><br><p>  More than 330 million accounts registered in Odnoklassniki, these accounts contain more than 30 billion photos. </p><br><p>  OK users upload 20 million photos per day.  On 9 million photos uploaded per day, there are faces, and a total of 23 million faces are detected.  That is, an average of 2.5 faces per photo containing at least one face. </p><br><p>  Users have the opportunity to mark people in a photo, but usually they are lazy.  We decided to automate the search for friends in photos in order to increase the user's awareness of the photos uploaded with him and the amount of feedback for user photos. </p><br><p><img src="https://habrastorage.org/webt/nh/ky/jo/nhkyjo1ioy_wmi-uz2j7tu-415y.png" alt="image"></p><br><p>  In order for the author to instantly confirm friends after uploading a photo, in the worst case, the processing of the photo must be within 200 milliseconds. </p><br><h2 id="sistema-raspoznavaniya-polzovateley-v-soc-seti">  User recognition system in the social network </h2><br><h4 id="raspoznavanie-lic-na-zagruzhennom-foto">  Face Recognition on Uploaded Photo </h4><br><p>  The user uploads a photo from any client (from a browser or iOS, Android mobile applications), it hits the detector, whose task is to find faces and align them. </p><br><p>  After the detector, the sliced ‚Äã‚Äãand preprocessed faces fall on the neural network recognizer, which builds the characteristic profile of the user's face.  After this, the most similar profile is searched in the database.  If the degree of similarity of profiles is greater than the limit value, then the user is automatically detected, and we send him a notification that he is in the photo. </p><br><p><img src="https://habrastorage.org/webt/8k/s8/t-/8ks8t-gg4n59gjhc2lyq9zihpf4.png" alt="image"></p><br><p>  <em>Figure 1. Recognizing users in the photo</em> </p><br><p>  Before you start automatic recognition, you need to create a profile for each user and fill out the database. </p><br><h4 id="postroenie-polzovatelskih-profiley">  Building user profiles </h4><br><p>  For face recognition algorithms, just one photo, such as avatars, is enough.  But will this avatar contain a profile photo?  Users put photos of stars on avatars, and profiles are replete with memes or contain only group photos. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/978/d27/a90/978d27a90dda66de0c882c075cda0785.png" alt="image"></p><br><p>  <em>Figure 2. Difficult profile</em> </p><br><p>  Consider a user profile consisting of group photos only. <br>  Determine the owner of the account (Fig. 2), if you consider his gender and age, as well as friends, whose profiles were built earlier. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/51f/d52/b33/51fd52b33b0e4ddad978d413dac20852.png" alt="image"></p><br><p>  <em>Figure 3. Building user profiles</em> </p><br><p>  We built the user profile as follows (Fig. 3): </p><br><p>  1) Chose the highest quality photos of the user </p><br><p>  If there were too many photos, we used no more than a hundred of the best. <br>  Photo quality was determined based on: </p><br><ul><li>  the presence of user marks on the photo (fotopinov) manually; </li><li>  photo information (photo uploaded from a mobile phone, taken on the front camera, on vacation, ...); </li><li>  photo was on avatar </li></ul><br><p>  2) We searched for these faces in these photos </p><br><ul><li>  it is not scary if it will be other users (in step 4 we will filter them) </li></ul><br><p>  3) Calculate the characteristic facial vector </p><br><ul><li>  such a vector is called embedding </li></ul><br><p>  4) Produced clustering vectors </p><br><p>  The task of this clustering is to determine which particular set of vectors belongs to the account holder.  The main problem is the presence of friends and relatives in the photographs.  For clustering, we use the DBScan algorithm. </p><br><p>  5) Determined the leading cluster </p><br><p>  For each cluster, we calculated the weight based on: </p><br><ul><li>  cluster size; </li><li>  the quality of the photographs, according to which embeddings in the cluster are built; </li><li>  the presence of photopins attached to individuals from the cluster; </li><li>  matching gender and age of individuals in the cluster with information from the profile; </li><li>  The proximity of the cluster centroid to the profiles of friends previously calculated. </li></ul><br><p>  The coefficients of the parameters involved in calculating the weight of the cluster will be trained by linear regression.  Honest gender and age profile - a separate challenge, we will tell about it later. </p><br><p>  In order for a cluster to be considered a leader, it is necessary that its weight be greater than the nearest competitor by a constant calculated on the training set.  If the leader is not found, we once again go to point 2, but use a larger number of photos.  For some users, we saved two clusters.  This happens for joint profiles - some families have a common profile. </p><br><p>  6) Received user embeddings in his clusters </p><br><ul><li>  Finally, we build a vector that will characterize the appearance of the account holder, ‚Äúuser embedding‚Äù. </li></ul><br><p>  User embedding is the centroid of the selected (leading) cluster. <br>  You can build centroids in many different ways.  After numerous experiments, we returned to the simplest of them: averaging the vectors included in the cluster. </p><br><p>  Like clusters, the user may have several embeddings. </p><br><p>  During the iteration, we processed eight billion photos, iterated 330 million profiles and built embeddings for three hundred million accounts.  On average, to build one profile, we processed 26 photos.  At the same time, even one photo is enough to build a vector, but the larger the photo, the greater our confidence that the built profile belongs to the account holder. </p><br><p>  We made the process of building all profiles on the portal several times, as the availability of information about friends improves the quality of cluster selection. <br>  The amount of data needed to store the vectors is ~ 300 GB. </p><br><h2 id="detektor-lic">  Face detector </h2><br><p>  The first version of the OK face detector was launched in 2013 on the basis of a third-party solution, similar in characteristics to the detector based on the Viola-Jones method.  For 5 years, this solution is outdated, modern solutions based on <a href="https://arxiv.org/abs/1604.02878">MTCNN</a> , show accuracy twice as high.  Therefore, we decided to follow the trends and built our cascade of convolutional neural networks (MTCNN). </p><br><p>  For the operation of the old detector, we used more than 100 ‚Äúold‚Äù servers with CPUs.  Almost all modern algorithms for finding faces in the photo are based on convolutional neural networks that most effectively work on the GPU.  We were unable to purchase a large number of video cards for objective reasons: <del>  expensive </del>  all bought miners.  It was decided to run c detector on the CPU (well, do not throw out the same server). </p><br><p>  To detect faces on the photos we upload, we use a cluster of 30 cars (the rest <del>  drank </del>  passed in the scrap).  Detection when building custom vectors (iteration through accounts) is done on 1000 virtual cores with low priority in our cloud.  The <a href="https://habrahabr.ru/company/odnoklassniki/blog/346868/">cloud</a> solution is described in detail in the report of <a href="https://habrahabr.ru/users/m0nstermind/">Oleg Anastasyev</a> : <a href="https://habrahabr.ru/company/odnoklassniki/blog/346868/">One-cloud is the OS of the level of the data center in Odnoklassniki</a> . </p><br><p>  When analyzing the detector operation time, we encountered such a worse case: the top-level network skips too many candidates to the next cascade level, and the detector begins to work for a long time.  For example, the search time reaches 1.5 seconds in such photos: </p><br><p><img src="https://habrastorage.org/webt/i0/3x/gv/i03xgveyskwetxfuvzdefxuey5s.png" alt="image"></p><br><p>  <em>Figure 4. Examples of a large number of candidates after the first network in a cascade</em> </p><br><p>  Optimizing this case, we suggested that there are usually few faces in the photograph.  Therefore, after the first stage of the cascade, we leave no more than 200 candidates, relying on the confidence of the corresponding neural network that this person. <br>  This optimization reduced the worst case time to 350 ms, i.e., 4 times. </p><br><p>  Applying a pair of optimizations (for example, replacing <a href="https://www.pyimagesearch.com/2014/11/17/non-maximum-suppression-object-detection-python/">Non-Maximum Suppression</a> after the first stage of the cascade with <a href="https://www.learnopencv.com/blob-detection-using-opencv-python-c/">Blob detection</a> based filtering), the detector was further dispersed 1.4 times without loss of quality. <br>  However, progress on the spot also did not stand, and now it is more elegant methods to look for faces on the photo - see. <a href="https://arxiv.org/abs/1708.05234">FaceBoxes</a> .  We do not exclude that in the near future we will move to something similar. </p><br><h2 id="raspoznavatel-lic">  Face Recognizer </h2><br><p>  When developing a recognizer system, we experimented with several architectures: <a href="https://arxiv.org/abs/1605.07146">Wide ResNet</a> , <a href="https://arxiv.org/abs/1602.07261">Inception-ResNet</a> , <a href="https://arxiv.org/abs/1511.02683">Light CNN</a> . <br>  Inception-ResNet showed itself a little bit better than the rest while staying on it. </p><br><p>  The algorithm requires a trained neural network.  It can be found on the Internet, buy or train yourself.  For the training of neural networks, a certain set of data (dataset) is needed, on which training and validation takes place.  Since face recognition is a well-known task, ready-made datasets already exist for it: MSCeleb, VGGFace / VGGFace2, MegaFace.  However, here comes the harsh reality: the generalizing ability of modern neural networks in the tasks of identification by face (and indeed in general) leaves much to be desired. <br>  And on our portal, faces are very different from what can be found in open datasets: </p><br><ul><li>  Other age distribution - there are children in our photos; </li><li>  Other distribution of ethnic groups; </li><li>  There are people in very low quality and resolution (photos from the phone, taken 10 years ago, group photos). </li></ul><br><p>  The third point is easy to overcome, artificially reducing the resolution and imposing jpeg-artifacts, but the rest will not be able to emulate the quality. <br>  Therefore, we decided to create our own dataset. </p><br><p>  In the process of building a set of trial and error, we came to this procedure: </p><br><ol><li> We download photos from ~ 100k open profiles <br>  Profiles are chosen randomly, minimizing the number of those who are friends with each other.  As a result, we assume that each person from dataset appears in only one profile. </li><li>  We build vectors (embeddingings) of persons <br>  To build embeddings, we use the pre-trained open source neural network (we took it <a href="https://github.com/davidsandberg/facenet">from here</a> ). </li><li><p>  Cluster entities within each account <br>  A couple of obvious observations: </p><br><ul><li>  We do not know how many different people appear on the photo from the account.  Therefore, the clusteriser should not require the number of clusters as a hyperparameter. </li><li>  Ideally, for the faces of the same person, we hope to get very similar vectors that form dense spherical clusters.  But the universe does not care about our aspirations, and in practice these clusters crawl into intricate forms (for example, for a person with glasses and without a cluster usually consists of two clots).  Therefore, centroid-based methods will not help us here, you need to use density-based. <br><br>  For these two reasons and the results of the experiments, <a href="http://scikit-learn.org/stable/modules/clustering.html">DBSCAN was</a> chosen.  Hyperparameters were picked up by hands and validated by eyes, everything is standard here.  For the most important of them - <a href="http://scikit-learn.org/stable/modules/clustering.html">eps in terms of scikit-learn</a> - came up with a simple heuristic on the number of people in the account. </li></ul><br></li><li><p>  Filter the cluster <br>  The main sources of pollution dataset and how we fought with them: </p><br><ul><li>  Sometimes the faces of different people merge into one cluster (due to the imperfection of the neural network replicator and the density-based nature of DBSCAN). <br>  The simplest reinsurance helped us: if two or more people in a cluster came from one photo, we would throw out such a cluster just in case. <br>  This means that lovers of selfie collages did not fall into ours, but it was worth it, because the number of false ‚Äúmergers‚Äù has decreased significantly. </li><li>  The opposite happens: the same person forms several clusters (for example, when there are photos with glasses and without, makeup and without, etc.). <br>  Common sense and experiments led us to the following.  We measure the distance between the centroids of a pair of clusters.  If it is more than a certain threshold, we merge; if it is large enough, but the threshold does not pass, we throw one of the clusters away from sin. </li><li>  It happens, the detector is mistaken, and not the faces are in the clusters at all. <br>  Fortunately, the neural network recognizer is easily forced to filter such false positives.  More on this below. </li></ul><br></li><li>  We will train the neural network on what we have, we return with it to point 2 <br>  Repeat 3-4 times until ready. <br>  Gradually, the network is getting better, and at the last iterations there is no need for our heuristics to filter. </li></ol><br><p>  Having decided that the more diverse, the better - we mix in our new dataset (3.7M people, 77K people; code name - OKFace) something else. <br>  The <a href="http://www.robots.ox.ac.uk/~vgg/data/vgg_face2/">VGGFace2</a> turned out to be the most useful of something else - quite large and complex (turns, lighting).  As usual, made up of celebrity photos found in Google.  No wonder very ‚Äúdirty‚Äù.  Fortunately, cleaning it up with a neural network pre-trained on OKFace is trivial. </p><br><h4 id="funkciya-poter">  Loss function </h4><br><p>  A good loss function for embedding learning is still an open task.  We tried to approach it, relying on the following position: it is necessary to strive so that the loss function <b>most closely corresponds to how the model will be used after training</b> </p><br><p>  And our network will be used in the most standard way. </p><br><p>  When you are on the photo of his face embedding <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>x</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.455ex" viewBox="0 -520.7 572.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-78" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-1"> x </script>  will be compared with centroids from candidate profiles (the user himself + his friends) <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>c</mi><mn>1</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>c</mi><mi>n</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.456ex" height="1.817ex" viewBox="0 -520.7 4071.4 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-31" x="613" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-2C" x="887" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-2E" x="1332" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-2E" x="1777" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-2E" x="2222" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-2C" x="2668" y="0"></use><g transform="translate(3113,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-6E" x="613" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>c</mi><mn>1</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>c</mi><mi>n</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-2"> c_1, ..., c_n </script>  over cosine distance.  If a <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo>,</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mo>&amp;gt;=</mo><msub><mi>m</mi><mi>p</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.211ex" height="2.78ex" viewBox="0 -832 7410.1 1197.1" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-63" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-6F" x="433" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-73" x="919" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-28" x="1388" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-78" x="1778" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-2C" x="2350" y="0"></use><g transform="translate(2795,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-69" x="613" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-29" x="3573" y="0"></use><g transform="translate(4240,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-3E"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-3D" x="778" y="0"></use></g><g transform="translate(6075,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-70" x="1242" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>&gt;=</mo><msub><mi>m</mi><mi>p</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-3"> cos (x, c_i)> = m_p </script>  , we declare that the photo - candidate number <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.802ex" height="1.937ex" viewBox="0 -728.2 345.5 834" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-69" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-4"> i </script>  . </p><br><p>  Accordingly, we want to: </p><br><ul><li>  for the ‚Äúright‚Äù candidate <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>t</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.84ex" height="1.937ex" viewBox="0 -728.2 361.5 834" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-74" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-5"> t </script>  , <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo>,</mo><msub><mi>c</mi><mi>t</mi></msub><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.231ex" height="2.66ex" viewBox="0 -832 3974.3 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-63" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-6F" x="433" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-73" x="919" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-28" x="1388" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-78" x="1778" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-2C" x="2350" y="0"></use><g transform="translate(2795,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-74" x="613" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-29" x="3584" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><msub><mi>c</mi><mi>t</mi></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-6"> cos (x, c_t) </script>  exceeded the threshold <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>m</mi><mi>p</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.1ex" height="2.057ex" viewBox="0 -520.7 1334.5 885.9" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-70" x="1242" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>m</mi><mi>p</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-7"> m_p </script>  ; </li><li>  for the rest - was lower <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>m</mi><mi>p</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.1ex" height="2.057ex" viewBox="0 -520.7 1334.5 885.9" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-70" x="1242" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>m</mi><mi>p</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-8"> m_p </script>  and even desirable with a margin <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>m</mi><mi>n</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.259ex" height="1.817ex" viewBox="0 -520.7 1403.1 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-6E" x="1242" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>m</mi><mi>n</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-9"> m_n </script>  . </li></ul><br><p>  Deviation from this ideal will be punished by the square, <s>because everyone does it</s> empirically so it turned out better.  The same in terms of formulas: </p><br><p></p><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo>,</mo><mi>t</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>m</mi><mi>p</mi></msub><mo>&amp;#x2212;</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo>,</mo><msub><mi>c</mi><mi>t</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mo>,</mo><mn>0</mn><msup><mo stretchy=&quot;false&quot;>)</mo><mn>2</mn></msup><mo>+</mo><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>!</mo><mo>=</mo><mi>t</mi></mrow></msub><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy=&quot;false&quot;>(</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo>,</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mo>&amp;#x2212;</mo><msub><mi>m</mi><mi>n</mi></msub><mo>,</mo><mn>0</mn><msup><mo stretchy=&quot;false&quot;>)</mo><mn>2</mn></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="72.918ex" height="3.142ex" viewBox="0 -987.6 31394.9 1352.7" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-6C" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-6F" x="298" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-73" x="784" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-73" x="1253" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-28" x="1723" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-78" x="2112" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-2C" x="2685" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-74" x="3130" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-29" x="3491" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-3D" x="4158" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-6D" x="5215" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-61" x="6093" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-78" x="6623" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-28" x="7195" y="0"></use><g transform="translate(7585,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-70" x="1242" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-2212" x="9141" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-63" x="10142" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-6F" x="10576" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-73" x="11061" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-28" x="11531" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-78" x="11920" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-2C" x="12493" y="0"></use><g transform="translate(12938,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-74" x="613" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-29" x="13727" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-2C" x="14116" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-30" x="14562" y="0"></use><g transform="translate(15062,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-29" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-32" x="550" y="583"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-2B" x="16128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-73" x="17378" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-75" x="17848" y="0"></use><g transform="translate(18420,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-6D" x="0" y="0"></use><g transform="translate(878,-163)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-21" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-3D" x="624" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-74" x="1402" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-6D" x="20646" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-61" x="21525" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-78" x="22054" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-28" x="22627" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-63" x="23016" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-6F" x="23450" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-73" x="23935" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-28" x="24405" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-78" x="24794" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-2C" x="25367" y="0"></use><g transform="translate(25812,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-69" x="613" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-29" x="26590" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-2212" x="27202" y="0"></use><g transform="translate(28202,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-6E" x="1242" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-2C" x="29605" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-30" x="30051" y="0"></use><g transform="translate(30551,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-29" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-32" x="550" y="583"></use></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><msub><mi>m</mi><mi>p</mi></msub><mo>‚àí</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><msub><mi>c</mi><mi>t</mi></msub><mo stretchy="false">)</mo><mo>,</mo><mn>0</mn><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>+</mo><mtext>&nbsp;</mtext><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>!</mo><mo>=</mo><mi>t</mi></mrow></msub><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>‚àí</mo><msub><mi>m</mi><mi>n</mi></msub><mo>,</mo><mn>0</mn><msup><mo stretchy="false">)</mo><mn>2</mn></msup></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-10"> loss (x, t) = max (m_p - cos (x, c_t), 0) ^ 2 + \ sum_ {i! = t} max (cos (x, c_i) - m_n, 0) ^ 2 </script></p><br><br><p>  And the centroids themselves <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>c</mi><mn>1</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>c</mi><mi>n</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.456ex" height="1.817ex" viewBox="0 -520.7 4071.4 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-31" x="613" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-2C" x="887" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-2E" x="1332" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-2E" x="1777" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-2E" x="2222" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMAIN-2C" x="2668" y="0"></use><g transform="translate(3113,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-6E" x="613" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>c</mi><mn>1</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>c</mi><mi>n</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-11"> c_1, ..., c_n </script>  - these are just the parameters of the neural network, they are trained, like everything else, by gradient descent. </p><br><p>  This loss function has its problems.  Firstly, it is poorly suited for learning from scratch.  Secondly, select as many as two parameters - <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>m</mi><mi>p</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.1ex" height="2.057ex" viewBox="0 -520.7 1334.5 885.9" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-70" x="1242" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>m</mi><mi>p</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-12"> m_p </script>  and <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>m</mi><mi>n</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.259ex" height="1.817ex" viewBox="0 -520.7 1403.1 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/odnoklassniki/blog/350566/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjvWgYVoPCNSna2Dwmxc_36OcpNCQ#MJMATHI-6E" x="1242" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>m</mi><mi>n</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-13"> m_n </script>  - quite tiring.  However, the additional training with its use has allowed us to achieve higher accuracy than the other known functions: <a href="https://www.researchgate.net/publication/308190438_A_Discriminative_Feature_Learning_Approach_for_Deep_Face_Recognition">Center Loss</a> , <a href="https://arxiv.org/abs/1707.07391">Contrastive-Center Loss</a> , <a href="https://www.semanticscholar.org/paper/SphereFace%253A-Deep-Hypersphere-Embedding-for-Face-Re-Liu-Wen/366adbacaeea8c35435bf41134b78bb7aba73315">A-Softmax (SphereFace)</a> , <a href="https://arxiv.org/abs/1801.09414">LMCL (CosFace)</a> . </p><br><h4 id="i-stoilo-ono-togo">  And was it worth it? </h4><br><table><tbody><tr><td></td><td colspan="2">  Lfw </td><td colspan="2">  OKFace, test set </td></tr><tr><td></td><td>  Accuracy </td><td>  TP@FP0.001 </td><td>  Accuracy </td><td>  TP@FP0.001 </td></tr><tr><td>  Before </td><td>  0.992 + -0.003 </td><td>  0.977 + -0.006 </td><td>  0.941 + -0.007 </td><td>  0.476 + -0.022 </td></tr><tr><td>  After </td><td>  0.997 + -0.002 </td><td>  0.992 + -0.004 </td><td>  0.994 + -0.003 </td><td>  0.975 + -0.012 </td></tr></tbody></table><br><p>  <em>the numbers in the table are average results of 10 measurements + standard deviation</em> </p><br><p>  An important indicator for us is TP @ FP: what percentage of faces we identify with a fixed proportion of false positives (here - 0.1%). <br>  With a limit of 1 in 1000 errors and without further training of the neural network on our dataset, we could recognize only half of the faces on the portal. </p><br><h4 id="minimiziruem-lozhnye-srabatyvaniya-detektora">  Minimizing detector false alarms </h4><br><p>  The detector sometimes finds faces where there are none, and often does on user photos (4% of false positives). <br>  It is rather unpleasant when such ‚Äúgarbage‚Äù falls into the training dataset. <br>  It is very unpleasant when we persistently ask our users to ‚Äúmark a friend‚Äù in a bouquet of roses or on a carpet texture. <br>  The problem can be solved, and the most obvious way is to collect more non-individuals and run them through the neural network replicator. </p><br><p>  We, as usual, decided to start with a quick crutch: </p><br><ol><li>  We borrow from the Internet a dozen images on which, in our opinion, individuals should not be <br><img src="https://habrastorage.org/getpro/habr/post_images/c3a/a8f/125/c3aa8f1253cee7774f9ef17ef1697cce.png" alt="image"></li><li>  We take random crops, build embeddingings for them and cluster them.  We only got 14 clusters. </li><li>  If the embedding of the tested ‚Äúface‚Äù is close to the centroid of one of the clusters, then we consider the ‚Äúface‚Äù to be a non-face. </li><li>  We are happy with how well our method works. </li><li>  We realize that the described scheme is implemented by a two-layer neural network (with 14 units on a hidden layer) on top of embeddings, and we are a bit sad. </li></ol><br><p>  The interesting thing is that the network-resolver sends all the variety of non-persons to just a few areas in the embeddingd space, although nobody has taught it to that. </p><br><h4 id="vse-vrut-ili-opredelenie-realnogo-vozrasta-i-pola-v-socialnoy-seti">  Everyone lies or the definition of the real age and gender in the social network </h4><br><p>  Users often do not indicate their age or indicate it incorrectly.  Therefore, the user‚Äôs age will be estimated using his friend graph.  Here clustering of ages of friends will help us: in general, the age of a user is in the largest cluster of ages of his friends, and first and last names helped us with determining gender. </p><br><p>  <a href="https://habrahabr.ru/users/khud/">Vitaliy Khudobakhshov</a> told about this: ‚Äú <a href="https://ok.ru/video/313332866731">How to find out the age of a person in a social network, even if it is not specified</a> ‚Äù </p><br><h2 id="arhitektura-resheniya">  Solution Architecture </h2><br><p>  Since the entire internal infrastructure is OK built on Java, then we will wrap all the components in Java.  Inference to detector and recognizer works under TensorFlow control via Java API.  The Detector runs on the CPU as it meets our requirements and runs on the existing hardware.  For Recognizer, we installed 72 GPU cards, since running Inception-ResNet is not expedient on the CPU in terms of resources. </p><br><p>  As a database for storing user vectors we use Cassandra. <br>  Since the total volume of the vectors of all portal users is ~ 300Gb, for quick access to the vectors we add a cache.  The cache is implemented in off-heap, details can be found in the article by <a href="https://habrahabr.ru/users/apangin/">Andrei Pangin</a> : " <a href="https://habrahabr.ru/company/odnoklassniki/blog/148139/">Using shared memory in Java and off-heap caching</a> ." </p><br><p>  The built architecture maintains a load of up to 1 billion photos per day while iterating over user profiles, and at the same time processing of new uploaded photos ~ 20 million photos per day continues. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/115/35b/6ee/11535b6ee0e8f8e4490da745a502e4ff.png" alt="image"></p><br><p>  <em>Figure 6. Solution architecture</em> </p><br><h2 id="rezultaty">  results </h2><br><p>  As a result, we wrote down a system that was trained on real data of a social network, which gives good results with limited resources. </p><br><p>  The recognition quality on a dataset built on real profiles from OC was TP = 97.5% with FP = 0.1%.  The average processing time for a single photograph is 120 ms, and the 99th percentile fits into 200 ms.  The system is self-learning, and the more the user tags on the photo, the more accurate his profile becomes. </p><br><p>  Now, after uploading photos, users found on them receive notifications and can confirm themselves in the photo or delete if they don‚Äôt like the photo. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f7f/116/5ee/f7f1165ee2fbccd78a331660a9abaa54.png" alt="image"></p><br><p>  Automatic recognition led to a 2-fold increase in impressions of events in the tape about the elevations in photographs, and the number of clicks on these events increased by 3 times.  The interest of users to the new feature is obvious, but we plan to increase the activity even more by improving UX and new points of application, such as Starface. </p><br><p>  <a href="https://ok.ru/video/712314849816">Custom UX video</a> </p><br><h4 id="fleshmob-starface">  StarFace flashmob </h4><br><p>  In order to acquaint users of the social network with new functionality, OK announced a contest: users upload their photos with Russian sports stars, show business and popular bloggers leading their Odnoklassniki accounts, and receive a badge for an avatar or a subscription to paid services.  Details here: <a href="https://insideok.ru/blog/odnoklassniki-zapustili-raspoznavanie-lic-na-foto-na-osnove-neyrosetey">https://insideok.ru/blog/odnoklassniki-zapustili-raspoznavanie-lic-na-foto-na-osnove-neyrosetey</a> </p><br><p>  In the first days of the promotion, users have already uploaded more than 10 thousand photos with celebrities.  They laid out selfies and photos with stars, photos against posters and, of course, ‚Äúphotoshop‚Äù.  Photos of users who received VIP status: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/4e6/1ed/cec/4e61edcec69c14c760a87c58e60df53b.png" alt="image"></p><br><h2 id="plany">  Plans </h2><br><p>  Since most of the time is spent on the detector, the speed should be further optimized exactly in the detector: replace it or transfer it to the GPU. </p><br><p>  Try a combination of different models of recognition, if it significantly improves the quality. <br>  From a user point of view, the next step is to recognize the people in the video.  We also plan to inform the user about the availability of copies of his profile on the network with the opportunity to complain about the clone. </p><br><p>  Offer your ideas for using face recognition in comments. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/350566/">https://habr.com/ru/post/350566/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350556/index.html">How to convince others to respond to letters and become a universal email machine</a></li>
<li><a href="../350558/index.html">Why we put content first</a></li>
<li><a href="../350560/index.html">Asynchronous (self-timed) circuits. Calculation of logical functions directly on the event graph. Part 2</a></li>
<li><a href="../350562/index.html">As I wrote the fastest memoization feature</a></li>
<li><a href="../350564/index.html">The preliminary program DUMP-2018 is ready. Speakers from Microsoft, VKontakte, Rambler, Tinkoff, HTML Academy</a></li>
<li><a href="../350570/index.html">Backend on CodeFest: bigdate, machine and blockchain</a></li>
<li><a href="../350572/index.html">Backlog in product management: what to do when ideas grow ‚Äúlike a snowball‚Äù</a></li>
<li><a href="../350574/index.html">You can not just take and edit subtitles</a></li>
<li><a href="../350576/index.html">Background removal using deep learning</a></li>
<li><a href="../350578/index.html">UX-design in Russia and the CIS "under the microscope"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>