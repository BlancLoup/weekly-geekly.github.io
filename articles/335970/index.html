<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We break haks completely. We read machine codes as an open book.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If haXe is translated in C ++, and from it into machine codes, this may seem hopeless, especially since at first glance this code is replete with call...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We break haks completely. We read machine codes as an open book.</h1><div class="post__text post__text-html js-mediator-article"> <a href=""><img src="https://habrastorage.org/web/fe0/b84/852/fe0b8485240f46f3aea4d043ee430bba.png" align="right"></a>  If haXe is translated in C ++, and from it into machine codes, this may seem hopeless, especially since at first glance this code is replete with calls to virtual methods, which, without running the debugger, are difficult to correlate with the addresses of the method bodies. <br><br>  But it's not so bad.  Even with script support disabled (HXCPP_SCRIPTABLE), strings with method and field names can be detected in the file.  We analyze how to unwind this tangle, compare the names of the methods with their addresses and offsets in the table of virtual methods. <br><a name="habracut"></a><br><h2>  Some theory </h2><br>  After translation in C ++, all haXe classes are inherited from hx.Object (defined in <a href="">hxcpp / include / hx / Object.h</a> ).  Of particular interest are the following methods: <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> Dynamic __Field(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> String &amp;inString, hx::PropertyAccess inCallProp); <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> Dynamic __SetField(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> String &amp;inField,<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Dynamic &amp;inValue, hx::PropertyAccess inCallProp);</code> </pre> <br>  These methods are redefined in classes translated in C ++, and their implementation everywhere looks something like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">src / openfl / geom / Matrix.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs">Dynamic Matrix_obj::__Field(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ::String &amp;inName,hx::PropertyAccess inCallProp) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(inName.length) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"a"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"b"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> b; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"c"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> c; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"d"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> d; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"tx"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tx; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"ty"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ty; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"clone"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> clone_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"scale"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> scale_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"setTo"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> setTo_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"concat"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> concat_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"equals"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> equals_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"invert"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> invert_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"rotate"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rotate_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"__array"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> __array; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"toArray"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> toArray_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"copyFrom"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> copyFrom_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"identity"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> identity_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"toString"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> toString_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"copyRowTo"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> copyRowTo_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"createBox"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> createBox_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"translate"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> translate_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"to3DString"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> to3DString_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"copyRowFrom"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> copyRowFrom_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"setRotation"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> setRotation_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"toMozString"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> toMozString_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"__toMatrix3"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> __toMatrix3_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"copyColumnTo"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> copyColumnTo_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"__transformX"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> __transformX_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"__transformY"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> __transformY_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"__cleanValues"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> __cleanValues_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"copyColumnFrom"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> copyColumnFrom_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"transformPoint"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> transformPoint_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"__transformPoint"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> __transformPoint_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"createGradientBox"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> createGradientBox_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"deltaTransformPoint"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> deltaTransformPoint_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"__transformInverseX"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> __transformInverseX_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"__transformInverseY"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> __transformInverseY_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"__translateTransformed"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> __translateTransformed_dyn(); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HX_FIELD_EQ(inName,<span class="hljs-string"><span class="hljs-string">"__transformInversePoint"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> __transformInversePoint_dyn(); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> super::__Field(inName,inCallProp); }</code> </pre> </div></div><br>  As you can see, the fields in the understanding of the haX translator turn out to be not only what is usually considered fields, but also methods, however, in dynamic wrappers from which they have yet to be pulled out. <br><br><h2>  Training </h2><br>  Accordingly, it is worth starting with finding the __Field method.  For example, it can be accessed by return link to the string with the name of the method.  If you read what lines are in the file, then you can get back links, for example, in __ToString or RTTI.  Of these, the reverse link must go to VMT.  If the string is a field name, then instead of __Field you can get into a similar __SetField method, which is worse, since there are no references to dynamic wrappers for methods.  While in VMT, open the overridden methods (allocated to addresses) and look for which ones are similar to __Field (you can see a large switch at the beginning): <br><br><div class="spoiler">  <b class="spoiler_title">Start __Field</b> <div class="spoiler_text"><pre> <code class="hljs mel">.<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B3DB8 var_30 = <span class="hljs-number"><span class="hljs-number">-0x30</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B3DB8 var_2C = <span class="hljs-number"><span class="hljs-number">-0x2C</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B3DB8 var_28 = <span class="hljs-number"><span class="hljs-number">-0x28</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B3DB8 var_20 = <span class="hljs-number"><span class="hljs-number">-0x20</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B3DB8 .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B3DB8 PUSH.W {R4-R9,LR} .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B3DBC SUB SP, SP, #<span class="hljs-number"><span class="hljs-number">0x14</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B3DBE MOV R7, R2 .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B3DC0 MOV R4, R0 .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B3DC2 LDR R0, [R7] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B3DC4 MOV R9, R3 .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B3DC6 MOV R5, R1 .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B3DC8 SUBS R0, #<span class="hljs-number"><span class="hljs-number">4</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> cases .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B3DCA CMP R0, #<span class="hljs-number"><span class="hljs-number">0x1B</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B3DCC BHI.W def_10B3DD0 ; jumptable <span class="hljs-number"><span class="hljs-number">010</span></span>B3DD0 <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B3DD0 TBH.W [PC,R0,LSL#<span class="hljs-number"><span class="hljs-number">1</span></span>] ; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> jump .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B3DD0 ; --------------------------------------------------------------------------- .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B3DD4 jpt_10B3DD0 DCW <span class="hljs-number"><span class="hljs-number">0x1C</span></span> ; jump table <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> statement .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B3DD6 DCW <span class="hljs-number"><span class="hljs-number">0x35</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Start __SetField</b> <div class="spoiler_text"><pre> <code class="hljs mel">.<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48DC var_38 = <span class="hljs-number"><span class="hljs-number">-0x38</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48DC var_30 = <span class="hljs-number"><span class="hljs-number">-0x30</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48DC var_28 = <span class="hljs-number"><span class="hljs-number">-0x28</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48DC var_24 = <span class="hljs-number"><span class="hljs-number">-0x24</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48DC var_20 = <span class="hljs-number"><span class="hljs-number">-0x20</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48DC arg_0 = <span class="hljs-number"><span class="hljs-number">0</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48DC .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48DC PUSH.W {R4-R9,LR} .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48E0 SUB SP, SP, #<span class="hljs-number"><span class="hljs-number">0x1C</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48E2 MOV R7, R2 .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48E4 MOV R8, R0 .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48E6 LDR R0, [R7] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48E8 MOV R6, R3 .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48EA LDR R5, [SP,#<span class="hljs-number"><span class="hljs-number">0x38</span></span>+arg_0] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48EC MOV R9, R1 .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48EE SUBS R0, #<span class="hljs-number"><span class="hljs-number">6</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> cases .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48F0 CMP R0, #<span class="hljs-number"><span class="hljs-number">0xC</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48F2 BHI.W def_10B48F6 ; jumptable <span class="hljs-number"><span class="hljs-number">010</span></span>B48F6 <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48F6 TBH.W [PC,R0,LSL#<span class="hljs-number"><span class="hljs-number">1</span></span>] ; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> jump .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48F6 ; --------------------------------------------------------------------------- .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48FA jpt_10B48F6 DCW <span class="hljs-number"><span class="hljs-number">0xD</span></span> ; DATA XREF: .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">01329970</span></span>‚Üìo .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48FA ; jump table <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> statement .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B48FC DCW <span class="hljs-number"><span class="hljs-number">0x25</span></span></code> </pre> </div></div><br>  __Field in the virtual method table is earlier than __SetField, and there are usually fewer options.  In this example, 13 vs 28. <br><br><h2>  First stage: looking for dynamic wrappers </h2><br>  When both methods are found, you need to go to the __Field, look where the branch goes after 0 == memcmp and give the names to the wrappers.  This can come across as ordinary fields, and wrappers.  It‚Äôs easy to learn how to distinguish them, here‚Äôs an example of a normal field, then a dynamic wrapper for a method: <br><br><pre> <code class="hljs mel">.<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B44B0 loc_10B44B0 ; CODE XREF: __Field+<span class="hljs-number"><span class="hljs-number">16</span></span>A‚Üëj .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B44B0 LDR R0, [R5,#<span class="hljs-number"><span class="hljs-number">0x20</span></span>] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B44B2 B loc_10B4582 .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B44B4 ; --------------------------------------------------------------------------- .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B44B4 .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B44B4 loc_10B44B4 ; CODE XREF: __Field+<span class="hljs-number"><span class="hljs-number">1</span></span>B0‚Üëj .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B44B4 LDR R2, =(get_error_dyn+<span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-number"><span class="hljs-number">0x10B44BA</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B44B6 ADD R2, PC ; get_error_dyn .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">010</span></span>B44B8 B loc_10B44D2</code> </pre> <br>  There was, but not in this file, such a problem that pointers to wrappers are not recognized.  It looks like an abnormally large orange integer operand.  Via Ctrl + R, in IDA it is necessary to make it offset. <br><br><h2>  The second stage: the most simple cases </h2><br>  First, let's look at how methods and wrappers for them are located after translation in C ++: <br><br><div class="spoiler">  <b class="spoiler_title">src / openfl / geom / Matrix.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// ‚Ä¶ ::lime::math::Matrix3 Matrix_obj::__toMatrix3( ){ HX_STACK_FRAME("openfl.geom.Matrix","__toMatrix3",0xaf6ed17e,"openfl.geom.Matrix.__toMatrix3","openfl/geom/Matrix.hx",480,0xa0d54189) HX_STACK_THIS(this) HX_STACK_LINE(482) Float tmp = this-&gt;a; HX_STACK_VAR(tmp,"tmp"); HX_STACK_LINE(482) Float tmp1 = this-&gt;b; HX_STACK_VAR(tmp1,"tmp1"); HX_STACK_LINE(482) Float tmp2 = this-&gt;c; HX_STACK_VAR(tmp2,"tmp2"); HX_STACK_LINE(482) Float tmp3 = this-&gt;d; HX_STACK_VAR(tmp3,"tmp3"); HX_STACK_LINE(482) Float tmp4 = this-&gt;tx; HX_STACK_VAR(tmp4,"tmp4"); HX_STACK_LINE(482) Float tmp5 = this-&gt;ty; HX_STACK_VAR(tmp5,"tmp5"); HX_STACK_LINE(482) ::lime::math::Matrix3 tmp6 = ::lime::math::Matrix3_obj::__new(tmp,tmp1,tmp2,tmp3,tmp4,tmp5); HX_STACK_VAR(tmp6,"tmp6"); HX_STACK_LINE(482) return tmp6; } HX_DEFINE_DYNAMIC_FUNC0(Matrix_obj,__toMatrix3,return ) Void Matrix_obj::__transformInversePoint( ::openfl::geom::Point point){ { HX_STACK_FRAME("openfl.geom.Matrix","__transformInversePoint",0xde42fb73,"openfl.geom.Matrix.__transformInversePoint","openfl/geom/Matrix.hx",487,0xa0d54189) // ‚Ä¶</span></span></code> </pre> </div></div><br>  It can be seen that the body of the method goes first, then the macro constructs a dynamic wrapper, then the next method, then a dynamic wrapper for it, and so on.  Since the names were given to the wrappers at the first stage, but not to the methods proper, the IDA subroutine list should have a ‚Äústriped‚Äù picture when the named subroutines are interspersed with the named ones. <br><br>  This is not quite true, but at this stage only the most obvious cases need to be handled - when there is exactly one subprogram between the dynamic wrappers, and, most likely, this is the method.  He is given the name on the wrapper, which is below him. <br><br>  <u>Caution</u> : there were cases, but not in this file, when IDA did not recognize the body of the method as a subroutine, but it did recognize something auxiliary, going after the method.  This method is backlink from VMT. <br><br><h2>  The third stage: when there are two subprograms between the wrappers </h2><br>  Dynamic wrappers are created by a <a href="">macro that looks like this</a> : <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> HX_DEFINE_DYNAMIC_FUNC0(class,func,ret) \ ::Dynamic __##class##func(hx::Object *inObj) \ { \ ret reinterpret_cast</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;class *&gt;(inObj)-&gt;func(); return ::Dynamic(); \ }; \ ::Dynamic class::func##_dyn() \ {\ return hx::CreateMemberFunction0(this,__##class##func); \ }</span></span></span></span></code> </pre> <br>  As you can see, two wrappers are created here at once, typed and untyped, but typed is usually thrown out by the C ++ translator as unnecessary.  If between dynamic wrappers there are two nameless subroutines at once, then, most likely, the first of them is the desired method, and the second is a typed wrapper. <br><br>  By the beginning of the third stage, most of the methods should already be named, so if you look from VMT, these will be single spaces, and at this stage they will be eliminated. <br><br><h2>  Stage Four: Close Large Spaces in VMT </h2><br>  It happens that there are large gaps in the VMT, two or more methods.  Once again, the convenience of looking from VMT can be noted.  So, if you miss one method while traversing __Field, it will appear in the list of IDA subroutines as three unnamed subroutines between dynamic wrappers, but haX can generate additional subroutines for other needs, and then three unnamed subroutines between dynamic wrappers can also be generated. <br><br>  From VMT, you can see: if there is a gap of two elements, then this is the missing dynamic wrapper in __Field.  We find in the list of subroutines where this space is, go to the middle subroutine, it should be a wrapper.  With the help of X, we open the list of backlinks, among them should be __Field.  We go there, find out the name of the wrapper, the space in the list of subroutines is ‚Äútightened‚Äù by a strip, and then follow the described algorithm with the names of the methods. <br><br><h2>  Hx.Object methods </h2><br>  For completeness, you can open <a href="">hxcpp / include / hx / Object.h</a> , write out all the virtual methods in order, and identify the methods at the beginning of the VMT. <br><br><h2>  Defining data types of fields and arguments </h2><br>  When the fields and arguments are called methods (like all virtual), you need to understand in which VMT to look for them, and for this you need to understand what types they are.  If you do not run the debugger, dynamic wrappers help to do this.  At the input, they receive arguments of formal types (Dynamic, Dynamic, Dynamic, ...) and, in order to make a call, they first lead Dynamic to the actual method expected by the method.  During this conversion, it is just possible to find out these same types. <br><br>  For example, if in the body of the wrapper we see: <br><br><pre> <code class="hljs pgsql">.text:<span class="hljs-number"><span class="hljs-number">010</span></span>B3884 LDR R1, =(off_23DE1D4 - <span class="hljs-number"><span class="hljs-number">0x10B388E</span></span>) .text:<span class="hljs-number"><span class="hljs-number">010</span></span>B3886 MOVS R3, #<span class="hljs-number"><span class="hljs-number">0</span></span> .text:<span class="hljs-number"><span class="hljs-number">010</span></span>B3888 LDR R2, =(off_23E04A0 - <span class="hljs-number"><span class="hljs-number">0x10B3890</span></span>) .text:<span class="hljs-number"><span class="hljs-number">010</span></span>B388A <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> R1, PC ; off_23DE1D4 .text:<span class="hljs-number"><span class="hljs-number">010</span></span>B388C <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> R2, PC ; off_23E04A0 .text:<span class="hljs-number"><span class="hljs-number">010</span></span>B388E LDR R1, [R1] ; hx_Object_ci .text:<span class="hljs-number"><span class="hljs-number">010</span></span>B3890 LDR R2, [R2] ; off_22D9DE0 .text:<span class="hljs-number"><span class="hljs-number">010</span></span>B3892 BLX.W __dynamic_cast</code> </pre> <br>  ... it can be seen that the cast from hx.Object to something else is done.  If you have not yet identified hx_Obejct_ci, then both classes will be unknown, but this is solvable.  We look at whose pointers they are writing in RTTI (in this example, off_22D9DE0), we put down the names, we draw conclusions. <br><br>  Similarly, for fields, __SetField comes in handy, which is forced to cast the Dynamic type to the actual field type, thereby giving a hint. <br><br><h2>  Static fields and methods </h2><br>  If a class has static elements, it will override the static methods __GetStatic and / or __SetStatic.  For obvious reasons, in VMT, they are not visible, but if the class contains both static and normal elements, then the translated code goes in order __Field, __GetStatic, __SetField, __SetStatic, so that, knowing where __Field and __SetField, you can calculate __GetStatic and __SetStatic next to them.  There is also at the beginning of the switch on the length of the line, and then the comparison operation. <br><br><h2>  Screencast </h2><br><iframe width="560" height="315" src="https://www.youtube.com/embed/ZlV63-jbj5o" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  00:00 Find __ Field and __ Set Field <br>  03:00 First stage: we are looking for dynamic wrappers <br>  21:30 Second stage: the simplest cases <br>  30:48 The third stage: when there are two subprograms between the wrappers <br>  33:15 Stage Four: Close Large Spaces in VMT <br>  49:00 hx.Object Methods </div><p>Source: <a href="https://habr.com/ru/post/335970/">https://habr.com/ru/post/335970/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../335960/index.html">Playfully bash'im</a></li>
<li><a href="../335962/index.html">Parametric modeling in CAD SolveSpace: "The ways of the Solver are inscrutable" or "Newton's Wormholes"</a></li>
<li><a href="../335964/index.html">How cloud service Drimkas Cabinet copes with spontaneous loads</a></li>
<li><a href="../335966/index.html">Celesta and Flute: Creating Business Logic in the Java Ecosystem</a></li>
<li><a href="../335968/index.html">Cloning the Lode Runner game from the first PC in the USSR "BK-0010" plus a few words about the programming of games in the late 80s</a></li>
<li><a href="../335972/index.html">Game model of behavior in the market of two competing firms in Python</a></li>
<li><a href="../335974/index.html">Labyrinth generation by Eller algorithm in Unity</a></li>
<li><a href="../335976/index.html">About website rejuvenation - decision criteria</a></li>
<li><a href="../335980/index.html">Configuring the automatic assembly of the project Unity3d in Gitlab CI</a></li>
<li><a href="../335982/index.html">How to create a map with the voices of fans for the Olympics. Lecture in Yandex</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>