<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using the Chrome profiler frontend in your own projects</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="You may know that Google Chrome has a built-in profiler . But even from those people who saw it, the majority believes that it can only be used for de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using the Chrome profiler frontend in your own projects</h1><div class="post__text post__text-html js-mediator-article">  You may know that Google Chrome has a <a href="http://dev.chromium.org/developers/how-tos/trace-event-profiling-tool">built-in profiler</a> .  But even from those people who saw it, the majority believes that it can only be used for debugging Javascript or drawing frames in the browser.  But in fact, it can be quite simply screwed as a means of visualizing profiling data in your project. <br><br>  I will not reveal any unique secrets here, for example, <a href="https://twitter.com/duhroach">Colt McAnlis</a> wrote about the similar use of the Chrome profiler in game projects <a href="http://www.gamasutra.com/view/news/176420/Indepth_Using_Chrometracing_to_view_your_inline_profiling_data.php">back in 2012</a> .  Everything written there is still true, and I will write one more material - just for better dissemination of knowledge about such a useful tool. <br><br><h2>  Prehistory </h2><br>  For some part of our code-building system, we once wrote a simple profiler (called TinyProfiler).  It is rather trivial - it measures the execution time of certain blocks of code and creates a set of HTML + SVG files that visualize this data in the style of <a href="http://queue.acm.org/detail.cfm%3Fid%3D2927301">flame-graphs</a> : 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/90e/bf7/4f9/90ebf74f9b03000bc48ad95fd0757e63.png" alt="image"><br><br>  This, in principle, worked well, but the resulting HTML was not very interactive.  It was possible to bring the mouse to a specific block and see its name in the tooltip, but that‚Äôs all the amenities and ended.  There was no zoom, no filtering, no scrolling, no search - in general, nothing that I would like to receive from a more or less professional tool.  All this could, of course, sit down and write, but ... why do it if you can not do this?  After all, there is already someone (Chrome developers) who have already done all this. <br><a name="habracut"></a><br><h2>  Using Chrome Tracing </h2><br>  All we have to do is: <br><br><ol><li>  Create a JSON file of a <a href="https://docs.google.com/document/d/1CvAClvFfyA5R-PhYUmn5OOQtYMH4h6I0nSsKchNAySU/edit">specific format</a> containing data about the events being profiled </li><li>  Open chrome in chrome: // tracing </li><li>  Drag JSON file to this page </li></ol><br>  The result is visually quite similar to the picture of our mini profiler: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/05d/536/bdd/05d536bdd9100fd3b1b752abc2a61898.png" alt="image"><br><br>  The advantages of this approach: <br><br><ul><li>  Significantly improved UI: zoom, scrolling, filtering, statistics, etc. </li><li>  We no longer need to write our (even if simple) code for the UI </li><li>  Significantly simplified data collection and processing code (JSON is easier to create than SVG) </li></ul><br>  But there are a few drawbacks: <br><br><ul><li>  There is no easy way to click on the report file to open it.  Chrome does not allow you to open files with trace data from the command line.  It is necessary to open the chrome: // tracing page every time and only to open the necessary file from it. </li><li>  This can be corrected if you take the trace2html utility from <a href="https://github.com/catapult-project/catapult/tree/master/tracing">the</a> Chrome <a href="https://github.com/catapult-project/catapult/tree/master/tracing">repository</a> - it can create ready-made HTML with everything you need.  But for this you have to pull down to yourself, store and collect 1 GB of sources (there is not only this utility there).  And this is somehow too much for a similar task.  Perhaps, it would be possible to cut out from the repository only what is needed to build this utility - but this would take time, and even with further compatibility support, problems would arise. </li><li>  We are tied to another third-party tool.  However, it seems to be fairly stable (for example, the 2012 <a href="http://www.gamasutra.com/view/news/176420/Indepth_Using_Chrometracing_to_view_your_inline_profiling_data.php">article</a> mentioned above is still literally true in 2017), is <a href="https://github.com/catapult-project/catapult/tree/master/tracing">open,</a> and some serious tools (like <a href="https://buckbuild.com/about/performance_tuning.html">Facebook Buck</a> ) are already using it. </li></ul><br>  It seems to me that the advantages outweigh the disadvantages. <br><br><h2>  JSON file format </h2><br>  This format is quite simple in and of itself, and is <a href="https://docs.google.com/document/d/1CvAClvFfyA5R-PhYUmn5OOQtYMH4h6I0nSsKchNAySU/edit">well documented</a> .  The basic structure looks like this: <br><br><pre><code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"traceEvents"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tid"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ts"</span></span>:<span class="hljs-number"><span class="hljs-number">87705</span></span>, <span class="hljs-attr"><span class="hljs-attr">"dur"</span></span>:<span class="hljs-number"><span class="hljs-number">956189</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ph"</span></span>:<span class="hljs-string"><span class="hljs-string">"X"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Jambase"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"args"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"ms"</span></span>:<span class="hljs-number"><span class="hljs-number">956.2</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tid"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ts"</span></span>:<span class="hljs-number"><span class="hljs-number">128154</span></span>, <span class="hljs-attr"><span class="hljs-attr">"dur"</span></span>:<span class="hljs-number"><span class="hljs-number">75867</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ph"</span></span>:<span class="hljs-string"><span class="hljs-string">"X"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"SyncTargets"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"args"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"ms"</span></span>:<span class="hljs-number"><span class="hljs-number">75.9</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tid"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ts"</span></span>:<span class="hljs-number"><span class="hljs-number">546867</span></span>, <span class="hljs-attr"><span class="hljs-attr">"dur"</span></span>:<span class="hljs-number"><span class="hljs-number">121564</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ph"</span></span>:<span class="hljs-string"><span class="hljs-string">"X"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"DoThings"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"args"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"ms"</span></span>:<span class="hljs-number"><span class="hljs-number">121.6</span></span> } } ], <span class="hljs-attr"><span class="hljs-attr">"meta_user"</span></span>: <span class="hljs-string"><span class="hljs-string">"aras"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"meta_cpu_count"</span></span>: <span class="hljs-string"><span class="hljs-string">"8"</span></span> }</code> </pre> <br>  traceEvents are the events that will be shown in the UI.  Anything that is not an event is considered ‚Äúmetadata‚Äù that will be displayed in the metadata dialog (in this case, meta_user and meta_cpu_count).  The above JSON file will look like this in Chrome Tracing: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/68f/081/593/68f081593e4bc3bd6ef61e79c885bca6.png" alt="image"><br><br>  The events that are described in it are quite simple.  They are called ‚Äúcompleted‚Äù (type ph: X) - for their description we will need to specify the start time and the duration in microseconds (attributes ts and dur).  The attributes of the process ID and thread ID, as well as the name of the event are specified.  There is no need to specify the parent-child relationship - the UI will determine it itself based on the start time and duration of each event. <br><br>  You can also attach some data to the events (the args attribute), which, when you select this event, will be displayed in the bottom panel.  There is a small nuance - in order for an event to be chosen at all, it must have non-empty args.  That is, at least something (even if unnecessary) is better to put there.  You can not think of anything - duplicate the event duration there (perhaps converting it from microseconds to milliseconds or seconds). <br><br>  That's all that I wanted to tell you about the basic use of this tool.  Perhaps the article turned out to be somewhat rustic - but this is because the tool itself is simple and convenient.  For advanced uses, read the <a href="https://docs.google.com/document/d/1CvAClvFfyA5R-PhYUmn5OOQtYMH4h6I0nSsKchNAySU/edit">documentation</a> .  Successful profiling. </div><p>Source: <a href="https://habr.com/ru/post/336584/">https://habr.com/ru/post/336584/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336570/index.html">Zabbix: LLD monitoring of FlexLM services (UPDATED)</a></li>
<li><a href="../336572/index.html">Go, go, go ... First impressions</a></li>
<li><a href="../336574/index.html">Generation of documents. Easy and free</a></li>
<li><a href="../336578/index.html">Cryptoalgorithms. Classification in terms of the number of keys</a></li>
<li><a href="../336580/index.html">Metasloy: ideas about applying prediction to optimize programming and resource allocation in the OS</a></li>
<li><a href="../336586/index.html">Analysis of MS SQL Server, for those who see it for the first time (part 2)</a></li>
<li><a href="../336588/index.html">Inkscape: ms_meme and holiday tree</a></li>
<li><a href="../336590/index.html">Puzzle game from scratch on ASP.NET Core 2, let's play?</a></li>
<li><a href="../336592/index.html">Android Oreo bites off a piece of PWA</a></li>
<li><a href="../336594/index.html">Face segmentation on a selfie without neural networks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>