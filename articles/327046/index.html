<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Performance comparison of the iron server and the Amazon cloud</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today, developers do not imagine a high-load system without a database. This method of storing information becomes cult. We used to work with the data...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Performance comparison of the iron server and the Amazon cloud</h1><div class="post__text post__text-html js-mediator-article">  Today, developers do not imagine a high-load system without a database.  This method of storing information becomes cult.  We used to work with the database every day, but still there are dark spots.  One of them is performance.  Many articles have been written on tuning, database optimization, etc.  They are useful if you already have a database (DB) and its performance is not enough.  But these articles will not help if you need to run the database in cloud services such as AWS, Azure, Rackspace, etc. <br><a name="habracut"></a><br>  I am sure these questions are familiar to some, because I was asked a lot about this: <br><br><ul><li>  Should I use AWS or a regular iron server? </li><li>  What type of server to choose on Amazon? </li><li>  Use for Amazon RDS or EC2 database? </li><li>  Choose from Amazon dedicated or on demand instances? </li><li>  How many transactions can each type of server handle? </li></ul><br>  The purpose of the article is to resolve these issues.  Of course, there is no direct answer to them, it will begin with the words "depends on ...".  But I hope my analysis will still help you make the right decision. <br><br><h2>  Testing environment </h2><br>  In the left corner of the ring there is an amazing dedicated HP DL380 G9 iron server with the following specifications: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">CPU</span></span>: 16 <span class="hljs-selector-tag"><span class="hljs-selector-tag">cores</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">Dual</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Socket</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Octo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Core</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Intel</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Xeon</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">E5</span></span>‚Äì2630<span class="hljs-selector-tag"><span class="hljs-selector-tag">v3</span></span> 2<span class="hljs-selector-class"><span class="hljs-selector-class">.4GHz</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#Processors</span></span>: 2, <span class="hljs-selector-id"><span class="hljs-selector-id">#Cores</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">per</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Proc</span></span>: 8) <span class="hljs-selector-tag"><span class="hljs-selector-tag">RAM</span></span>: 128 <span class="hljs-selector-tag"><span class="hljs-selector-tag">GB</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">DISKS</span></span>: 500 <span class="hljs-selector-tag"><span class="hljs-selector-tag">GB</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RAID</span></span> 5 <span class="hljs-selector-tag"><span class="hljs-selector-tag">SSD</span></span></code> </pre> <br>  And in the right corner of the ring there are two Amazon services: EC2 and RDS.  To achieve the same characteristics as on the iron server, I use two database instances: DB1 (Memory Optimized) and DB2 (Compute optimized).  The specifications are as follows: <br><br>  <b>DB1:</b> <br><br><pre> <code class="hljs pgsql">r3<span class="hljs-number"><span class="hljs-number">.4</span></span>xlarge (memory optimized) <span class="hljs-number"><span class="hljs-number">16</span></span> cores <span class="hljs-number"><span class="hljs-number">122</span></span> GB RAM <span class="hljs-number"><span class="hljs-number">320</span></span> GB SSD Instance <span class="hljs-keyword"><span class="hljs-keyword">Storage</span></span></code> </pre><br>  <b>DB2:</b> <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">c3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.8xlarge</span></span> 32 <span class="hljs-selector-tag"><span class="hljs-selector-tag">cores</span></span> 60 <span class="hljs-selector-tag"><span class="hljs-selector-tag">GB</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RAM</span></span> 750 <span class="hljs-selector-tag"><span class="hljs-selector-tag">GB</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">io1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">EBS</span></span> 7500 <span class="hljs-selector-tag"><span class="hljs-selector-tag">IOPS</span></span></code> </pre><br>  I will also test instances with different types of leases: dedicated and on demand, plus EBS optimization for an instance in which it is not included by default (for example, r3.4xlarge). <br><br>  <b>Note:</b> <br><br><ul><li>  I did not tune RDS or EC2 services, I used only standard configurations </li><li>  Results may vary by availability zones (AWS) and regions. </li><li>  Unlike iron servers, Amazon has some overhead for HVM virtualization. </li></ul><br><h2>  Test conditions </h2><br><ul><li>  Operating system for EC2 and iron server: Ubuntu 14.04 LTS x64 </li><li>  EC2 instance types: r3.4xlarge and c3.8xlarge </li><li>  RDS instance types: db.r3.4xlarge and db.m4.10xlarge (db.c3.8xlarge instance is not available on RDS, so I replaced it with a higher instance level) </li><li>  Volumes: 320 GB SSD for DB1 and 750 GB IO1 7500 IOPS for DB2 </li><li>  MariaDB engine: 10.0.17 </li><li>  SysBench version: 0.4.2 </li><li>  SysBench test: OLTP complex test </li><li>  The command to start SysBench: <br><pre> <code class="hljs mel">sysbench --db-driver=mysql --num-threads=$THREADS --<span class="hljs-keyword"><span class="hljs-keyword">max</span></span>-requests=<span class="hljs-number"><span class="hljs-number">0</span></span> --test=oltp --mysql-table-engine=innodb --oltp-table-<span class="hljs-keyword"><span class="hljs-keyword">size</span></span>=<span class="hljs-number"><span class="hljs-number">2000000</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">max</span></span>-time=<span class="hljs-number"><span class="hljs-number">60</span></span> --mysql-engine-trx=yes --mysql-user=$USER --mysql-password=$PASSWORD --mysql-host=$HOST run</code> </pre><br></li><li>  Maximum number of connections (configuration file my.cnf): 300 </li><li>  Flows: 1 to 256 </li><li>  Host to start sysbench: localhost for EC2, for RDS - in the same availability zone </li><li>  Results: the number of transactions per second according to the results of the SysBench test </li><li>  SysBench tests are conducted in isolation from other tests. </li></ul><br><h2>  AWS Best Practices </h2><br>  Before proceeding to testing, I want to show you the recommendations of Amazon.  In 2015, the company released a detailed Whitepaper on the launch of relational databases on EC2 and RDS.  Full documentation can be found <a href="http://d0.awsstatic.com/whitepapers/rdbms-in-the-cloud-sql-server-on-aws.pdf">at the link</a> . <br><br>  <b>Here is a brief excerpt from the document:</b> <br><br>  We recommend that you first consider <b>Amazon RDS</b> .  This is the best choice if: <br><br><ul><li>  You focus on high-level tasks such as performance tuning, circuit optimization.  You expect Amazon to provide a database, manage backup and recovery, security patches, upgrade SQL Server versions (RDBMS), and manage storage. <br><br></li><li>  You are looking for a highly available database solution and want to use Multi-AZ synchronous replication at the click of a button without the need to manually configure and maintain database mirroring, failover clustering or AlwaysOn availability groups. <br><br></li><li>  You do not want to manage the backup and, most importantly, restore the database to a specific point in time - prefer AWS to automate this process. </li></ul><br>  It is better to run SQL Server on <b>EC2</b> if: <br><br><ul><li>  You need complete control over the database instances, including access to the operating system and software stack. </li><li>  You want your own administrators to manage the database, including backup, replication, and clustering. </li><li>  Database size and performance exceeds current maxima or other Amazon RDS limits. </li><li>  You want to use SQL Server features or options that are not supported by Amazon RDS. </li><li>  You want to set up a disaster recovery solution when working with SQL Server on AWS as a source. </li><li>  You must use a version of SQL Server that is not supported by Amazon RDS (for example, a version of 2014 that is not supported at the time of this writing). </li></ul><br><h2>  results </h2><br>  As I said, we have two fighters in the ring, so as a result we will get an iron server against AWS.  Since we are using a couple of Amazon services, there will be several tests: <br><br><ul><li>  EC2 and RDS based on DB1 compared to the iron server </li><li>  EC2 and RDS based on DB2 compared to the iron server </li></ul><br><img src="https://habrastorage.org/files/10d/77f/961/10d77f961577484b8d46d16180c1d05a.png" alt="image"><br><br><img src="https://habrastorage.org/files/a73/695/ead/a73695ead37240f6aab10a4810b4ac9e.png" alt="image"><br><br>  The results are very interesting, let's try to analyze: <br><br><ul><li>  The values ‚Äã‚Äãfor both EC2 servers are very similar, grow linearly to 16 threads, and then stop and stay at almost the same level even after the number of threads increases. <br>  EBS optimization slightly increases the number of transactions per second for more threads. <br><br></li><li>  Dedicated instances have virtually no effect on performance.  The results for selected and on-demand instances are very similar - the difference is literally 2-3%.  This means that the selected instances do not speed up the work of the database, but ensure data security.  Since they are isolated from other users' instances at the host hardware level. <br><br></li><li>  Compute optimized instances show slightly lower performance than Memory Optimized instances on both tests: for EC2 and RDS. <br><br></li><li>  RDS with fewer threads behaves somewhat worse than EC2 or iron server, this gap persists up to 16 threads.  Starting with 16 threads, RDS performance is growing rapidly with a large margin over EC2.  On 256 threads, the value for RDS is three times larger. <br><br></li><li>  The iron server performs well for fewer threads and loses RDS starting at 128 threads. <br><br></li><li>  The iron server shows its best result at 32 streams, at higher rates the value decreases. </li></ul><br><img src="https://habrastorage.org/files/e9c/85f/921/e9c85f9214cd46e9931fec91abcbde5a.png"><br><br><h2>  Conclusion </h2><br>  As you can see from the graphs above, EC2 instances do not work well for heavily loaded systems with a huge number of connections.  Therefore, to the question ‚ÄúUse for Amazon RDS or EC2 database?‚Äù I have to answer: ‚ÄúIt depends on ...‚Äù.  If you are working with a highly loaded database with a huge number of connections, then you should definitely choose RDS.  Compared to the iron servers, it shows good results, despite the difference with fewer threads.  But if you use a cluster system with a pair of slave nodes and the number of threads less than 16, select EC2 - this service works a little better with a smaller number of threads. <br>  To the question: "Should I use AWS or an iron server for my database," I will also answer: "It depends on ...", just remember that: <br><table><tbody><tr><th></th><th>  <b>Iron server</b> <br>  Physical dedicated server </th><th>  <b>Cloud IaaS</b> <br>  Virtual machines in a public cloud </th></tr><tr><td>  <b>P</b> <b><br></b>  <b>l</b> <b><br></b>  <b>Yu</b> <b><br></b>  <b>with</b> <b><br></b>  <b>s</b> </td><td><ul><li>  good for intensive workloads </li><li>  full access to the server, no "noisy neighbors" </li><li>  stable performance </li><li>  containers do not need virtualization </li></ul><br></td><td><ul><li>  suitable for different loads </li><li>  virtual machines are deploying faster </li><li>  better management tools for backups, testing </li><li>  cheaper </li><li>  a variety of VM sizes allows you to choose the right size for specific jobs </li></ul></td></tr><tr><td>  <b>M</b> <b><br></b>  <b>and</b> <b><br></b>  <b>n</b> <b><br></b>  <b>at</b> <b><br></b>  <b>with</b> <b><br></b>  <b>s</b> </td><td><ul><li>  expensive </li><li>  not so flexible, takes longer </li><li>  not so cool management tools (there will be no images of the entire machine for backup) </li><li>  too many resources for most workloads </li></ul></td><td><ul><li>  unstable performance, possible problem of "noisy neighbor" </li><li>  security issues when sharing resources </li></ul></td></tr></tbody></table><br>  According to Amazon, dedicated instances mainly provide data security.  Test results for different regions are floating - they differ literally by 2-3%.  This mainly depends on the load on the region and, as a result, discrepancies of the graphs.  I would not consider the selected instances as a way to increase the speed of the database. <br><br>  And yes, it is still difficult to answer the question: "What type of server should I choose on Amazon?".  But I advise you to run the database for high-load systems on RDS.  If, however, you decide to use EC2, then EBS-optimized Memory Optimized instances are the best choice. </div><p>Source: <a href="https://habr.com/ru/post/327046/">https://habr.com/ru/post/327046/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327026/index.html">What programming languages ‚Äã‚Äãare popular late at night</a></li>
<li><a href="../327030/index.html">Monad transformers for practicing programmers</a></li>
<li><a href="../327038/index.html">Gorilla: fast, scalable in-memory time-series database</a></li>
<li><a href="../327042/index.html">Videos: Moscow Zabbix Meetup in the office of Badoo</a></li>
<li><a href="../327044/index.html">Critical vulnerabilities are discovered in 25 Linksys Smart Wi-Fi devices.</a></li>
<li><a href="../327048/index.html">Analysis of communication from the Tor network to the infrastructure using the ELK stack</a></li>
<li><a href="../327050/index.html">Internal mechanisms of TCP, affecting the download speed: part 2</a></li>
<li><a href="../327052/index.html">Virtuality and overhead projector</a></li>
<li><a href="../327054/index.html">7Ps Framework: we structure meetings to make effective</a></li>
<li><a href="../327056/index.html">"The little things that we noticed": case IaaS-provider</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>