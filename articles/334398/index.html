<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>R and Big Data: Use Replyr</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="replyr is short for RE mote PLY ing of big data for R (remote processing of big data in R). 

 Why try the replyr ? Because it allows you to use stand...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>R and Big Data: Use Replyr</h1><div class="post__text post__text-html js-mediator-article"> <code>replyr</code> is short for <b>RE</b> mote <b>PLY</b> ing of big data for <b>R</b> (remote processing of big data in R). <br><br>  Why try the <code><a href="https://cran.r-project.org/web/packages/replyr/index.html">replyr</a></code> ?  Because it allows you to use standard working approaches to remote data (databases or <a href="https://spark.apache.org/">Spark</a> ). <br><br>  You can work the same way as with local <code>data.frame</code> .  <code>replyr</code> provides these features: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Data <code>replyr_summary()</code> : <code>replyr_summary()</code> . </li><li>  Combining tables: <code>replyr_union_all()</code> . </li><li>  Linking tables in rows: <code>replyr_bind_rows()</code> . </li><li>  Using the functions of division, union, combination ( <code>dplyr::do()</code> ): <code>replyr_split()</code> , <code>replyr::gapply()</code> . </li><li>  Aggregation / distribution: <code>replyr_moveValuesToRows()</code> / <code>replyr_moveValuesToColumns()</code> . </li><li>  Track intermediate results. </li><li>  Controller unions. </li></ul><br>  Most likely, you do all this with the data locally, so these features will make working with <code>Spark</code> and <code><a href="https://spark.rstudio.com/">sparklyr</a></code> <i>much</i> easier. <br><br>  <code><a href="https://github.com/WinVector/replyr">replyr</a></code> is a product of the collective experience of using R in application solutions for many clients, collecting feedback and correcting flaws. <br><br>  Examples below. <br><a name="habracut"></a><br>  Everything is now changing rapidly, so we will use for examples the versions of packages in development. <br><br><pre> <code class="hljs lua">base::<span class="hljs-built_in"><span class="hljs-built_in">date</span></span>() ## [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-string"><span class="hljs-string">"Thu Jul 6 15:56:28 2017"</span></span> # devtools::install_github(<span class="hljs-string"><span class="hljs-string">'rstudio/sparklyr'</span></span>) # devtools::install_github(<span class="hljs-string"><span class="hljs-string">'tidyverse/dplyr'</span></span>) # devtools::install_github(<span class="hljs-string"><span class="hljs-string">'tidyverse/dbplyr'</span></span>) # install.packages(<span class="hljs-string"><span class="hljs-string">"replyr"</span></span>) suppressPackageStartupMessages(library(<span class="hljs-string"><span class="hljs-string">"dplyr"</span></span>)) packageVersion(<span class="hljs-string"><span class="hljs-string">"dplyr"</span></span>) ## [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-string"><span class="hljs-string">'0.7.1.9000'</span></span> packageVersion(<span class="hljs-string"><span class="hljs-string">"dbplyr"</span></span>) ## [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-string"><span class="hljs-string">'1.1.0.9000'</span></span> library(<span class="hljs-string"><span class="hljs-string">"tidyr"</span></span>) packageVersion(<span class="hljs-string"><span class="hljs-string">"tidyr"</span></span>) ## [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-string"><span class="hljs-string">'0.6.3'</span></span> library(<span class="hljs-string"><span class="hljs-string">"replyr"</span></span>) packageVersion(<span class="hljs-string"><span class="hljs-string">"replyr"</span></span>) ## [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-string"><span class="hljs-string">'0.4.2'</span></span> suppressPackageStartupMessages(library(<span class="hljs-string"><span class="hljs-string">"sparklyr"</span></span>)) packageVersion(<span class="hljs-string"><span class="hljs-string">"sparklyr"</span></span>) ## [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-string"><span class="hljs-string">'0.5.6.9012'</span></span> #  ,    https://github.com/rstudio/sparklyr/issues/<span class="hljs-number"><span class="hljs-number">783</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> &lt;- spark_config() <span class="hljs-built_in"><span class="hljs-built_in">config</span></span><span class="hljs-string"><span class="hljs-string">[["sparklyr.shell.driver-memory"]]</span></span> &lt;- <span class="hljs-string"><span class="hljs-string">"8G"</span></span> sc &lt;- sparklyr::spark_connect(version=<span class="hljs-string"><span class="hljs-string">'2.1.0'</span></span>, hadoop_version = <span class="hljs-string"><span class="hljs-string">'2.7'</span></span>, master = <span class="hljs-string"><span class="hljs-string">"local"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">config</span></span>)</code> </pre><br><h2>  Summary </h2><br>  Standard <code>summary()</code> and <code>glance()</code> , which cannot be performed on <code>Spark</code> . <br><br><pre> <code class="hljs vhdl">mtcars_spark &lt;- copy_to(sc, mtcars) #  ,    summary(mtcars_spark) ## Length Class Mode ## src <span class="hljs-number"><span class="hljs-number">1</span></span> src_spark list ## ops <span class="hljs-number"><span class="hljs-number">2</span></span> op_base_remote list packageVersion(<span class="hljs-string"><span class="hljs-string">"broom"</span></span>) ## [<span class="hljs-number"><span class="hljs-number">1</span></span>] '<span class="hljs-number"><span class="hljs-number">0.4</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>' broom::glance(mtcars_spark) ## <span class="hljs-literal"><span class="hljs-literal">Error</span></span>: glance doesn<span class="hljs-symbol"><span class="hljs-symbol">'t</span></span> know how <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> deal <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> data <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> class tbl_sparktbl_sqltbl_lazytbl</code> </pre><br>  <code>replyr_summary</code> works. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">replyr_summary</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">mtcars_spark</span></span>) %&gt;% <span class="hljs-selector-tag"><span class="hljs-selector-tag">select</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">-lexmin</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-lexmax</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-nunique</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-index</span></span>) ## <span class="hljs-selector-tag"><span class="hljs-selector-tag">column</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">class</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nrows</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nna</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">min</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mean</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sd</span></span> ## 1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">mpg</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">numeric</span></span> 32 0 10<span class="hljs-selector-class"><span class="hljs-selector-class">.400</span></span> 33<span class="hljs-selector-class"><span class="hljs-selector-class">.900</span></span> 20<span class="hljs-selector-class"><span class="hljs-selector-class">.090625</span></span> 6<span class="hljs-selector-class"><span class="hljs-selector-class">.0269481</span></span> ## 2 <span class="hljs-selector-tag"><span class="hljs-selector-tag">cyl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">numeric</span></span> 32 0 4<span class="hljs-selector-class"><span class="hljs-selector-class">.000</span></span> 8<span class="hljs-selector-class"><span class="hljs-selector-class">.000</span></span> 6<span class="hljs-selector-class"><span class="hljs-selector-class">.187500</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.7859216</span></span> ## 3 <span class="hljs-selector-tag"><span class="hljs-selector-tag">disp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">numeric</span></span> 32 0 71<span class="hljs-selector-class"><span class="hljs-selector-class">.100</span></span> 472<span class="hljs-selector-class"><span class="hljs-selector-class">.000</span></span> 230<span class="hljs-selector-class"><span class="hljs-selector-class">.721875</span></span> 123<span class="hljs-selector-class"><span class="hljs-selector-class">.9386938</span></span> ## 4 <span class="hljs-selector-tag"><span class="hljs-selector-tag">hp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">numeric</span></span> 32 0 52<span class="hljs-selector-class"><span class="hljs-selector-class">.000</span></span> 335<span class="hljs-selector-class"><span class="hljs-selector-class">.000</span></span> 146<span class="hljs-selector-class"><span class="hljs-selector-class">.687500</span></span> 68<span class="hljs-selector-class"><span class="hljs-selector-class">.5628685</span></span> ## 5 <span class="hljs-selector-tag"><span class="hljs-selector-tag">drat</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">numeric</span></span> 32 0 2<span class="hljs-selector-class"><span class="hljs-selector-class">.760</span></span> 4<span class="hljs-selector-class"><span class="hljs-selector-class">.930</span></span> 3<span class="hljs-selector-class"><span class="hljs-selector-class">.596563</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.5346787</span></span> ## 6 <span class="hljs-selector-tag"><span class="hljs-selector-tag">wt</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">numeric</span></span> 32 0 1<span class="hljs-selector-class"><span class="hljs-selector-class">.513</span></span> 5<span class="hljs-selector-class"><span class="hljs-selector-class">.424</span></span> 3<span class="hljs-selector-class"><span class="hljs-selector-class">.217250</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.9784574</span></span> ## 7 <span class="hljs-selector-tag"><span class="hljs-selector-tag">qsec</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">numeric</span></span> 32 0 14<span class="hljs-selector-class"><span class="hljs-selector-class">.500</span></span> 22<span class="hljs-selector-class"><span class="hljs-selector-class">.900</span></span> 17<span class="hljs-selector-class"><span class="hljs-selector-class">.848750</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.7869432</span></span> ## 8 <span class="hljs-selector-tag"><span class="hljs-selector-tag">vs</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">numeric</span></span> 32 0 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.000</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.437500</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.5040161</span></span> ## 9 <span class="hljs-selector-tag"><span class="hljs-selector-tag">am</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">numeric</span></span> 32 0 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.000</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.406250</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.4989909</span></span> ## 10 <span class="hljs-selector-tag"><span class="hljs-selector-tag">gear</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">numeric</span></span> 32 0 3<span class="hljs-selector-class"><span class="hljs-selector-class">.000</span></span> 5<span class="hljs-selector-class"><span class="hljs-selector-class">.000</span></span> 3<span class="hljs-selector-class"><span class="hljs-selector-class">.687500</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.7378041</span></span> ## 11 <span class="hljs-selector-tag"><span class="hljs-selector-tag">carb</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">numeric</span></span> 32 0 1<span class="hljs-selector-class"><span class="hljs-selector-class">.000</span></span> 8<span class="hljs-selector-class"><span class="hljs-selector-class">.000</span></span> 2<span class="hljs-selector-class"><span class="hljs-selector-class">.812500</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.6152000</span></span></code> </pre> <br><h2>  Aggregation / distribution </h2><br>  <code>tidyr</code> works mainly with local data. <br><br><pre> <code class="hljs scala">mtcars2 &lt;- mtcars %&gt;% mutate(car = row.names(mtcars)) %&gt;% copy_to(sc, ., <span class="hljs-symbol"><span class="hljs-symbol">'mtcars</span></span>2') #  mtcars2 %&gt;% tidyr::gather(<span class="hljs-symbol"><span class="hljs-symbol">'fac</span></span>t', <span class="hljs-symbol"><span class="hljs-symbol">'valu</span></span>e') ## <span class="hljs-type"><span class="hljs-type">Error</span></span> in <span class="hljs-type"><span class="hljs-type">UseMethod</span></span>(<span class="hljs-string"><span class="hljs-string">"gather_"</span></span>): no applicable method <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'gather</span></span>_' applied to an <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">of</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">'tbl_spark', 'tbl_sql', 'tbl_lazy', 'tbl'</span></span></span><span class="hljs-class">)" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mtcars2</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">%&gt;%</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">replyr_moveValuesToRows</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">nameForNewKeyColumn= 'fact', nameForNewValueColumn= 'value', columnsToTakeFrom= colnames(mtcars</span></span></span><span class="hljs-class">), </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nameForNewClassColumn=</span></span></span><span class="hljs-class"> '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">') </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">%&gt;%</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">arrange</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">car, fact</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">##</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">#</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Source</span></span></span></span>: <span class="hljs-keyword"><span class="hljs-keyword">lazy</span></span> query [?? x <span class="hljs-number"><span class="hljs-number">4</span></span>] ## # <span class="hljs-type"><span class="hljs-type">Database</span></span>: spark_connection ## # <span class="hljs-type"><span class="hljs-type">Ordered</span></span> by: car, fact ## car fact value <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">##</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">##</span></span></span><span class="hljs-class"> 1 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AMC</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Javelin</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">am</span></span></span><span class="hljs-class"> 0.00 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">numeric</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">##</span></span></span><span class="hljs-class"> 2 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AMC</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Javelin</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">carb</span></span></span><span class="hljs-class"> 2.00 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">numeric</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">##</span></span></span><span class="hljs-class"> 3 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AMC</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Javelin</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cyl</span></span></span><span class="hljs-class"> 8.00 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">numeric</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">##</span></span></span><span class="hljs-class"> 4 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AMC</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Javelin</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">disp</span></span></span><span class="hljs-class"> 304.00 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">numeric</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">##</span></span></span><span class="hljs-class"> 5 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AMC</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Javelin</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">drat</span></span></span><span class="hljs-class"> 3.15 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">numeric</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">##</span></span></span><span class="hljs-class"> 6 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AMC</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Javelin</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gear</span></span></span><span class="hljs-class"> 3.00 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">numeric</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">##</span></span></span><span class="hljs-class"> 7 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AMC</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Javelin</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hp</span></span></span><span class="hljs-class"> 150.00 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">numeric</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">##</span></span></span><span class="hljs-class"> 8 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AMC</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Javelin</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mpg</span></span></span><span class="hljs-class"> 15.20 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">numeric</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">##</span></span></span><span class="hljs-class"> 9 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AMC</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Javelin</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">qsec</span></span></span><span class="hljs-class"> 17.30 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">numeric</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">##</span></span></span><span class="hljs-class"> 10 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AMC</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Javelin</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">vs</span></span></span><span class="hljs-class"> 0.00 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">numeric</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">##</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">#</span></span></span><span class="hljs-class"> ... </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> 342 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">more</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rows</span></span></span></span></code> </pre> <br><h2>  String binding </h2><br>  <code>dplyr bind_rows</code> , <code>union</code> and <code>union_all</code> not applicable in <code>Spark</code> .  <code>replyr::replyr_union_all()</code> and <code>replyr::replyr_bind_rows()</code> is a workable alternative. <br><br><h3>  bind_rows () </h3><br><pre> <code class="hljs pgsql">db1 &lt;- copy_to(sc, data.frame(x=<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>, y=c(<span class="hljs-string"><span class="hljs-string">'a'</span></span>,<span class="hljs-string"><span class="hljs-string">'b'</span></span>), stringsAsFactors=<span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>), <span class="hljs-type"><span class="hljs-type">name</span></span>=<span class="hljs-string"><span class="hljs-string">'db1'</span></span>) db2 &lt;- copy_to(sc, data.frame(y=c(<span class="hljs-string"><span class="hljs-string">'c'</span></span>,<span class="hljs-string"><span class="hljs-string">'d'</span></span>), x=<span class="hljs-number"><span class="hljs-number">3</span></span>:<span class="hljs-number"><span class="hljs-number">4</span></span>, stringsAsFactors=<span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>), <span class="hljs-type"><span class="hljs-type">name</span></span>=<span class="hljs-string"><span class="hljs-string">'db2'</span></span>) #  -     ,    bind_rows(list(db1, db2)) ## Error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> bind_rows_(x, .id): Argument <span class="hljs-number"><span class="hljs-number">1</span></span> must be a data frame <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> a named atomic vector, <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> a tbl_spark/tbl_sql/tbl_lazy/tbl</code> </pre> <br><h3>  union_all </h3><br><pre> <code class="hljs swift">#          union_all(db1, db2) ## # <span class="hljs-type"><span class="hljs-type">Source</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> query [?? x <span class="hljs-number"><span class="hljs-number">2</span></span>] ## # <span class="hljs-type"><span class="hljs-type">Database</span></span>: spark_connection ## xy ## ## <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> a ## <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> b ## <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> ## <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> d</code> </pre> <br><h3>  union </h3><br><pre> <code class="hljs swift">#          #  ,     union(db1, db2) ## # <span class="hljs-type"><span class="hljs-type">Source</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> query [?? x <span class="hljs-number"><span class="hljs-number">2</span></span>] ## # <span class="hljs-type"><span class="hljs-type">Database</span></span>: spark_connection ## xy ## ## <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> d ## <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> a ## <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> ## <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> b</code> </pre> <br><h3>  replyr_bind_rows </h3><br>  <code>replyr::replyr_bind_rows</code> can link together several <code>data.frame</code> s. <br><br><pre> <code class="hljs php">replyr_bind_rows(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>(db1, db2)) <span class="hljs-comment"><span class="hljs-comment">## # Source: table [?? x 2] ## # Database: spark_connection ## xy ## ## 1 1 a ## 2 2 b ## 3 3 c ## 4 4 d</span></span></code> </pre> <br><h2>  dplyr :: do </h2><br>  In our example, we simply take several rows from each group of an aggregated data set.  Please note: since we do not explicitly set the order with the help of arrange, one cannot always expect the results to coincide in different data sources (DB or <code>Spark</code> ). <br><br><h3>  <code>dplyr::do</code> on local data </h3><br>  From <code>help('do', package='dplyr')</code> : <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">by_cyl</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">group_by</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">mtcars</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cyl</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">do</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">by_cyl</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">head</span></span>(., 2)) ## # <span class="hljs-selector-tag"><span class="hljs-selector-tag">A</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">tibble</span></span>: 6 <span class="hljs-selector-tag"><span class="hljs-selector-tag">x</span></span> 11 ## # <span class="hljs-selector-tag"><span class="hljs-selector-tag">Groups</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">cyl</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[3]</span></span> ## <span class="hljs-selector-tag"><span class="hljs-selector-tag">mpg</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cyl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">disp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">hp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">drat</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">wt</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">qsec</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">vs</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">am</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">gear</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">carb</span></span> ## ## 1 22<span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span> 4 108<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> 93 3<span class="hljs-selector-class"><span class="hljs-selector-class">.85</span></span> 2<span class="hljs-selector-class"><span class="hljs-selector-class">.320</span></span> 18<span class="hljs-selector-class"><span class="hljs-selector-class">.61</span></span> 1 1 4 1 ## 2 24<span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span> 4 146<span class="hljs-selector-class"><span class="hljs-selector-class">.7</span></span> 62 3<span class="hljs-selector-class"><span class="hljs-selector-class">.69</span></span> 3<span class="hljs-selector-class"><span class="hljs-selector-class">.190</span></span> 20<span class="hljs-selector-class"><span class="hljs-selector-class">.00</span></span> 1 0 4 2 ## 3 21<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> 6 160<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> 110 3<span class="hljs-selector-class"><span class="hljs-selector-class">.90</span></span> 2<span class="hljs-selector-class"><span class="hljs-selector-class">.620</span></span> 16<span class="hljs-selector-class"><span class="hljs-selector-class">.46</span></span> 0 1 4 4 ## 4 21<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> 6 160<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> 110 3<span class="hljs-selector-class"><span class="hljs-selector-class">.90</span></span> 2<span class="hljs-selector-class"><span class="hljs-selector-class">.875</span></span> 17<span class="hljs-selector-class"><span class="hljs-selector-class">.02</span></span> 0 1 4 4 ## 5 18<span class="hljs-selector-class"><span class="hljs-selector-class">.7</span></span> 8 360<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> 175 3<span class="hljs-selector-class"><span class="hljs-selector-class">.15</span></span> 3<span class="hljs-selector-class"><span class="hljs-selector-class">.440</span></span> 17<span class="hljs-selector-class"><span class="hljs-selector-class">.02</span></span> 0 0 3 2 ## 6 14<span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span> 8 360<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> 245 3<span class="hljs-selector-class"><span class="hljs-selector-class">.21</span></span> 3<span class="hljs-selector-class"><span class="hljs-selector-class">.570</span></span> 15<span class="hljs-selector-class"><span class="hljs-selector-class">.84</span></span> 0 0 3 4</code> </pre> <br><h3>  <code>dplyr::do</code> on <code>Spark</code> </h3><br><pre> <code class="hljs objectivec">by_cyl &lt;- group_by(mtcars_spark, cyl) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>(by_cyl, head(., <span class="hljs-number"><span class="hljs-number">2</span></span>)) <span class="hljs-meta"><span class="hljs-meta">## # A tibble: 3 x 2 ## cyl V2 ## ## 1 6 ## 2 4 ## 3 8</span></span></code> </pre> <br>  We get not quite what can be used. <br><br><h3>  <code>replyr</code> split / merge </h3><br><pre> <code class="hljs delphi">mtcars_spark %&gt;% replyr_split(<span class="hljs-string"><span class="hljs-string">'cyl'</span></span>, partitionMethod = <span class="hljs-string"><span class="hljs-string">'extract'</span></span>) %&gt;% lapply(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(di)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">head</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(di, 2)</span></span></span><span class="hljs-function">) %&gt;% </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">replyr_bind_rows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> ## # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Source</span></span></span><span class="hljs-function">:</span></span> table [?? x <span class="hljs-number"><span class="hljs-number">11</span></span>] ## # Database: spark_connection ## mpg cyl disp hp drat wt qsec vs am gear carb ## ## <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">21.0</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">160.0</span></span> <span class="hljs-number"><span class="hljs-number">110</span></span> <span class="hljs-number"><span class="hljs-number">3.90</span></span> <span class="hljs-number"><span class="hljs-number">2.620</span></span> <span class="hljs-number"><span class="hljs-number">16.46</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ## <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">21.0</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">160.0</span></span> <span class="hljs-number"><span class="hljs-number">110</span></span> <span class="hljs-number"><span class="hljs-number">3.90</span></span> <span class="hljs-number"><span class="hljs-number">2.875</span></span> <span class="hljs-number"><span class="hljs-number">17.02</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ## <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">22.8</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">108.0</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">3.85</span></span> <span class="hljs-number"><span class="hljs-number">2.320</span></span> <span class="hljs-number"><span class="hljs-number">18.61</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> ## <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">24.4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">146.7</span></span> <span class="hljs-number"><span class="hljs-number">62</span></span> <span class="hljs-number"><span class="hljs-number">3.69</span></span> <span class="hljs-number"><span class="hljs-number">3.190</span></span> <span class="hljs-number"><span class="hljs-number">20.00</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> ## <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">18.7</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">360.0</span></span> <span class="hljs-number"><span class="hljs-number">175</span></span> <span class="hljs-number"><span class="hljs-number">3.15</span></span> <span class="hljs-number"><span class="hljs-number">3.440</span></span> <span class="hljs-number"><span class="hljs-number">17.02</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> ## <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">14.3</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">360.0</span></span> <span class="hljs-number"><span class="hljs-number">245</span></span> <span class="hljs-number"><span class="hljs-number">3.21</span></span> <span class="hljs-number"><span class="hljs-number">3.570</span></span> <span class="hljs-number"><span class="hljs-number">15.84</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span></code> </pre> <br><h3> <code>replyr gapply</code> </h3> <br><pre> <code class="hljs lua">mtcars_spark %&gt;% gapply(<span class="hljs-string"><span class="hljs-string">'cyl'</span></span>, partitionMethod = <span class="hljs-string"><span class="hljs-string">'extract'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(di)</span></span></span></span> head(di, <span class="hljs-number"><span class="hljs-number">2</span></span>)) ## # Source: <span class="hljs-built_in"><span class="hljs-built_in">table</span></span> [?? x <span class="hljs-number"><span class="hljs-number">11</span></span>] ## # Database: spark_connection ## mpg cyl disp hp drat wt qsec vs am gear carb ## ## <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">21.0</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">160.0</span></span> <span class="hljs-number"><span class="hljs-number">110</span></span> <span class="hljs-number"><span class="hljs-number">3.90</span></span> <span class="hljs-number"><span class="hljs-number">2.620</span></span> <span class="hljs-number"><span class="hljs-number">16.46</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ## <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">21.0</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">160.0</span></span> <span class="hljs-number"><span class="hljs-number">110</span></span> <span class="hljs-number"><span class="hljs-number">3.90</span></span> <span class="hljs-number"><span class="hljs-number">2.875</span></span> <span class="hljs-number"><span class="hljs-number">17.02</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ## <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">22.8</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">108.0</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">3.85</span></span> <span class="hljs-number"><span class="hljs-number">2.320</span></span> <span class="hljs-number"><span class="hljs-number">18.61</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> ## <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">24.4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">146.7</span></span> <span class="hljs-number"><span class="hljs-number">62</span></span> <span class="hljs-number"><span class="hljs-number">3.69</span></span> <span class="hljs-number"><span class="hljs-number">3.190</span></span> <span class="hljs-number"><span class="hljs-number">20.00</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> ## <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">18.7</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">360.0</span></span> <span class="hljs-number"><span class="hljs-number">175</span></span> <span class="hljs-number"><span class="hljs-number">3.15</span></span> <span class="hljs-number"><span class="hljs-number">3.440</span></span> <span class="hljs-number"><span class="hljs-number">17.02</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> ## <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">14.3</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">360.0</span></span> <span class="hljs-number"><span class="hljs-number">245</span></span> <span class="hljs-number"><span class="hljs-number">3.21</span></span> <span class="hljs-number"><span class="hljs-number">3.570</span></span> <span class="hljs-number"><span class="hljs-number">15.84</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span></code> </pre> <br><h2> <code>replyr::replyr_apply_f_mapped</code> </h2> <br>  What I would like to receive: the data with the names corresponding to the code (ie, change the data, not the code). <br><br>  By some thought, this can be achieved by associating the change in data with the environment of the function, and not with the data.  That is, the data is changed as long as the corresponding monitoring function is executed.  In our case, this function is <code>replyr::replyr_apply_f_mapped()</code> , and it works as follows. <br><br>  Suppose that the operation we want to use is a function of decreasing order, obtained from some source that is not under our control (for example, a packet).  This may be a simple function (as below), but suppose we want to use it without modification (excluding even very small ones, like the introduction of <code>wrapr::let()</code> ). <br><br><pre> <code class="hljs lua">#          DecreaseRankColumnByOne &lt;- <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d)</span></span></span></span> { d$RankColumn &lt;- d$RankColumn - <span class="hljs-number"><span class="hljs-number">1</span></span> d }</code> </pre> <br>  To apply this function to <code>d</code> (in which the column names are not as expected!), We use <code>replyr::replyr_apply_f_mapped()</code> to create a new parameterized adapter: <br><br><pre> <code class="hljs django"><span class="xml"><span class="xml">#   d </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data.frame</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Sepal_Length</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">c(5.8,5.7),</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Sepal_Width</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">c(4.0,4.4),</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Species</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">'setosa'</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">rank</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">c(1,2))</span></span></span></span><span class="xml"><span class="hljs-tag"> #     </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">DecreaseRankColumnByOneNamed</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">d</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ColName</span></span></span></span><span class="xml"><span class="hljs-tag">) { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">replyr::replyr_apply_f_mapped</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">d</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">f</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">DecreaseRankColumnByOne,</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">nmap</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">c(RankColumn</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">ColName),</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">restrictMapIn</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">FALSE,</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">restrictMapOut</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">FALSE)</span></span></span></span><span class="xml"><span class="hljs-tag"> } #  </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">dF</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">DecreaseRankColumnByOneNamed</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">d</span></span></span></span><span class="xml"><span class="hljs-tag">, '</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">rank</span></span></span></span><span class="xml"><span class="hljs-tag">') </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">print</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">dF</span></span></span></span><span class="xml"><span class="hljs-tag">) ## </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Sepal_Length</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Sepal_Width</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Species</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">rank</span></span></span></span><span class="xml"><span class="hljs-tag"> ## </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">5.8</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">4.0</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">setosa</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag"> ## </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">2</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">5.7</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">4.4</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">setosa</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span></span></span></code> </pre> <br>  <code>replyr::replyr_apply_f_mapped()</code> renames columns as expected in <code>DecreaseRankColumnByOne</code> (the match is specified in <code>nmap</code> ), applies <code>DecreaseRankColumnByOne</code> and returns the names to the original before returning the result. <br><br><h2>  Track Intermediate Results </h2><br>  Many tasks in <code><a href="https://cran.r-project.org/web/packages/sparklyr/index.html">Sparklyr</a></code> involve the creation of intermediate or temporary tables.  This can be done with <code>dplyr::copy_to()</code> and <code>dplyr::compute()</code> .  These methods can be resource intensive. <br><br>  In <code><a href="https://cran.r-project.org/web/packages/replyr/index.html">replyr</a></code> there are functions to keep the process under control: temporary name generators that do not alter the actual data (they are also used within the packet itself). <br><br>  The function itself is fairly simple: <br><br><pre> <code class="hljs swift"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(replyr::makeTempNameGenerator) ## function (<span class="hljs-keyword"><span class="hljs-keyword">prefix</span></span>, suffix = <span class="hljs-type"><span class="hljs-type">NULL</span></span>) ## { ## force(<span class="hljs-keyword"><span class="hljs-keyword">prefix</span></span>) ## <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((length(<span class="hljs-keyword"><span class="hljs-keyword">prefix</span></span>) != <span class="hljs-number"><span class="hljs-number">1</span></span>) || (!<span class="hljs-keyword"><span class="hljs-keyword">is</span></span>.character(<span class="hljs-keyword"><span class="hljs-keyword">prefix</span></span>))) { ## stop(<span class="hljs-string"><span class="hljs-string">"repyr::makeTempNameGenerator prefix must be a string"</span></span>) ## } ## <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">is</span></span>.null(suffix)) { ## alphabet &lt;- <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>(letters, toupper(letters), <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.character(<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">9</span></span>)) ## suffix &lt;- paste(base::sample(alphabet, size = <span class="hljs-number"><span class="hljs-number">20</span></span>, replace = <span class="hljs-type"><span class="hljs-type">TRUE</span></span>), ## collapse = <span class="hljs-string"><span class="hljs-string">""</span></span>) ## } ## <span class="hljs-built_in"><span class="hljs-built_in">count</span></span> &lt;- <span class="hljs-number"><span class="hljs-number">0</span></span> ## nameList &lt;- list() ## function(..., peek = <span class="hljs-type"><span class="hljs-type">FALSE</span></span>, dumpList = <span class="hljs-type"><span class="hljs-type">FALSE</span></span>, remove = <span class="hljs-type"><span class="hljs-type">NULL</span></span>) { ## <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (length(list(...)) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { ## stop(<span class="hljs-string"><span class="hljs-string">"replyr::makeTempNameGenerator tempname generate unexpected argument"</span></span>) ## } ## <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (peek) { ## <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(names(nameList)) ## } ## <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dumpList) { ## v &lt;- names(nameList) ## nameList &lt;&lt;- list() ## <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(v) ## } ## <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">is</span></span>.null(remove)) { ## victims &lt;- intersect(remove, names(nameList)) ## nameList[victims] &lt;&lt;- <span class="hljs-type"><span class="hljs-type">NULL</span></span> ## <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(victims) ## } ## nm &lt;- paste(<span class="hljs-keyword"><span class="hljs-keyword">prefix</span></span>, suffix, sprintf(<span class="hljs-string"><span class="hljs-string">"%010d"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">count</span></span>), ## sep = <span class="hljs-string"><span class="hljs-string">"_"</span></span>) ## nameList[[nm]] &lt;&lt;- <span class="hljs-number"><span class="hljs-number">1</span></span> ## <span class="hljs-built_in"><span class="hljs-built_in">count</span></span> &lt;&lt;- <span class="hljs-built_in"><span class="hljs-built_in">count</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span> ## nm ## } ## } ## ##</code> </pre> <br>  For example, to combine multiple tables, a good solution for some data sources is to call <code>compute</code> after each join (otherwise, the resulting SQL can become long and difficult to understand and maintain).  The code looks like this: <br><br><pre> <code class="hljs lua">#     names &lt;- paste(<span class="hljs-string"><span class="hljs-string">'table'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span>, sep=<span class="hljs-string"><span class="hljs-string">'_'</span></span>) tables &lt;- lapply(names, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ni)</span></span></span></span> { di &lt;- data.frame(key= <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>) di<span class="hljs-string"><span class="hljs-string">[[paste('val',ni,sep='_')]]</span></span> &lt;- runif(nrow(di)) copy_to(sc, di, ni) }) #     tmpNamGen &lt;- replyr::makeTempNameGenerator(<span class="hljs-string"><span class="hljs-string">'JOINTMP'</span></span>) #      joined &lt;- tables<span class="hljs-string"><span class="hljs-string">[[1]]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> seq(<span class="hljs-number"><span class="hljs-number">2</span></span>,length(tables))) { ti &lt;- tables<span class="hljs-string"><span class="hljs-string">[[i]]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(i&lt;length(tables)) { joined &lt;- compute(left_join(joined, ti, by=<span class="hljs-string"><span class="hljs-string">'key'</span></span>), name= tmpNamGen()) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { #    joined &lt;- compute(left_join(joined, ti, by=<span class="hljs-string"><span class="hljs-string">'key'</span></span>), name= <span class="hljs-string"><span class="hljs-string">'joinres'</span></span>) } } #    temps &lt;- tmpNamGen(dumpList = TRUE) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(temps) ## [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-string"><span class="hljs-string">"JOINTMP_1dr7xHI9CkSZJwXfKA1B_0000000000"</span></span> ## [<span class="hljs-number"><span class="hljs-number">2</span></span>] <span class="hljs-string"><span class="hljs-string">"JOINTMP_1dr7xHI9CkSZJwXfKA1B_0000000001"</span></span> ## [<span class="hljs-number"><span class="hljs-number">3</span></span>] <span class="hljs-string"><span class="hljs-string">"JOINTMP_1dr7xHI9CkSZJwXfKA1B_0000000002"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(ti <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> temps) { db_drop_table(sc, ti) } #  <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(joined) ## # Source: <span class="hljs-built_in"><span class="hljs-built_in">table</span></span> [?? x <span class="hljs-number"><span class="hljs-number">6</span></span>] ## # Database: spark_connection ## key val_table_1 val_table_2 val_table_3 val_table_4 val_table_5 ## ## <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.8045418</span></span> <span class="hljs-number"><span class="hljs-number">0.5006293</span></span> <span class="hljs-number"><span class="hljs-number">0.8656174</span></span> <span class="hljs-number"><span class="hljs-number">0.5248073</span></span> <span class="hljs-number"><span class="hljs-number">0.8611796</span></span> ## <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0.1593121</span></span> <span class="hljs-number"><span class="hljs-number">0.5802938</span></span> <span class="hljs-number"><span class="hljs-number">0.9722113</span></span> <span class="hljs-number"><span class="hljs-number">0.4532369</span></span> <span class="hljs-number"><span class="hljs-number">0.7429018</span></span> ## <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0.4853835</span></span> <span class="hljs-number"><span class="hljs-number">0.5313043</span></span> <span class="hljs-number"><span class="hljs-number">0.6224256</span></span> <span class="hljs-number"><span class="hljs-number">0.1843134</span></span> <span class="hljs-number"><span class="hljs-number">0.1125551</span></span></code> </pre> <br>  Accurate introduction and management of time data can save resources (both time and place) and significantly improve results.  It seems to us good practice to explicitly set a temporary name generator, pass it to all <code>Sparklyr</code> transformations, and then clear the temporary values ‚Äã‚Äãall together when the results no longer depend on them. <br><br><h2>  Conclusion </h2><br>  If you want to carefully control the processing of data in <code>Spark</code> or DB using <code>R</code> , consider <code>replyr</code> in addition to <code><a href="https://cran.r-project.org/web/packages/dplyr/index.html">dplyr</a></code> and <code>sparklyr</code> . <br><br><pre> <code class="hljs php">sparklyr::spark_disconnect(sc) rm(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>=ls()) gc() <span class="hljs-comment"><span class="hljs-comment">## used (Mb) gc trigger (Mb) max used (Mb) ## Ncells 821292 43.9 1442291 77.1 1168576 62.5 ## Vcells 1364897 10.5 2552219 19.5 1694265 13.0</span></span></code> </pre> </div><p>Source: <a href="https://habr.com/ru/post/334398/">https://habr.com/ru/post/334398/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334388/index.html">Authorization form with sending an encrypted password</a></li>
<li><a href="../334390/index.html">Magento Dare to Share - Open Platform for Reports on Magento, PHP and eCommerce</a></li>
<li><a href="../334392/index.html">Putting things in order: Chrome and Firefox will end the credibility of Symantec certification center</a></li>
<li><a href="../334394/index.html">Mutation Testing</a></li>
<li><a href="../334396/index.html">Hacking a casino through a smart aquarium and DDoS stock brokers: new attacks on finance</a></li>
<li><a href="../334400/index.html">Biomechanics and artificial intelligence in medicine. Lecture at YaC 2017</a></li>
<li><a href="../334402/index.html">Grant for startups: online magistracy awaits the best</a></li>
<li><a href="../334404/index.html">Doctrine Specification Pattern or your reusable QueryBuilder</a></li>
<li><a href="../334406/index.html">China tightens VPN regulation</a></li>
<li><a href="../334408/index.html">The simplest redux types generator for asynchronous requests</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>