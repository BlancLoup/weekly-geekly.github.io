<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Squeryl - simplicity and grace</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, Habr! 

 I decided to write a small review with examples on the lightweight ORM for Scala - Squeryl 0.9.5 

 Let's start with the main...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Squeryl - simplicity and grace</h1><div class="post__text post__text-html js-mediator-article">  Good afternoon, Habr! <br><br>  I decided to write a small review with examples on the lightweight ORM for Scala - Squeryl 0.9.5 <br><br>  Let's start with the main advantages of this framework. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1) Squeryl provides DSL for SQL queries.  For example <br><br><pre><code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">songs</span></span></span><span class="hljs-function"> </span></span>= from(<span class="hljs-type"><span class="hljs-type">MusicDb</span></span>.songs)(s =&gt; where(s.artistId === id) select(s)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fixArtistName</span></span></span><span class="hljs-function"> </span></span>= update(songs)(s =&gt; where(s.title === <span class="hljs-string"><span class="hljs-string">"Prodigy"</span></span>) set( s.title := <span class="hljs-string"><span class="hljs-string">"The Prodigy"</span></span>, ) )</code> </pre> <br><br>  The syntax is reminiscent of C # LINQ.  As you may have noticed, lambda expressions are used in queries, which significantly reduces the amount of code. <br><br>  In this example, the songs method returns a Query [Song] object that implements the Iterable interface, which allows you to work with it as with a regular collection. <br><br>  It is also worth noting that queries can be used as subqueries; for this, it is sufficient to specify a query in the from construction instead of a table. <br><a name="habracut"></a><br>  2) The simplest description of the models <br><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">var id:</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Long</span></span></span></span><span class="hljs-class"><span class="hljs-params">, var username:</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KeyedEntity</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Long</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MySchema</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Schema</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> userTable = table[<span class="hljs-type"><span class="hljs-type">User</span></span>] }</code> </pre><br><br>  In this example, you describe a model with the primary key id of type Long and a field username of type String; no additional configs are required.  After we have described the model, it is necessary to register it in the scheme. <br><br>  By default, Squeryl uses class names for table names and class property names for field names. <br>  To explicitly specify the name of the table, you can use <br><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> userTable = table[<span class="hljs-type"><span class="hljs-type">User</span></span>](<span class="hljs-string"><span class="hljs-string">"USER_TABLE"</span></span>)</code> </pre><br><br>  and for columns you can use the @Column attribute <br><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">var id:</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Long</span></span></span></span><span class="hljs-class"><span class="hljs-params">, @</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Column</span></span></span></span><span class="hljs-class"><span class="hljs-params">("</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">USER_NAME</span></span></span></span><span class="hljs-class"><span class="hljs-params">"</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">var</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">username</span></span></span></span>:<span class="hljs-type"><span class="hljs-type">String</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">extends</span></span> <span class="hljs-type"><span class="hljs-type">KeyedEntity</span></span>[<span class="hljs-type"><span class="hljs-type">Long</span></span>]</code> </pre><br><br>  For composite keys, the types CompositeKey2 [K1, K2], CompositeKey3 [K1, K2, K3] and so on are used, according to the number of fields in the composite key. <br><br>  To ensure that the field is not saved in the database, it is enough to mark it with <a href="https://habrahabr.ru/users/transient/" class="user_link">Transient</a> annotation. <br><br>  3) custom functions. <br><br>  Squeryl contains the necessary minimum of functions for working with the database, this set can be easily supplemented. <br><br>  For example, we implement the function date_trunc for PostgreSQL <br><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DateTrunc</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">span: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, e: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">DateExpression</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Timestamp</span></span></span></span><span class="hljs-class"><span class="hljs-params">], m: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">OutMapper</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Timestamp</span></span></span></span><span class="hljs-class"><span class="hljs-params">]</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FunctionNode</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Timestamp</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> "date_trunc", </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Some</span></span></span></span><span class="hljs-class"><span class="hljs-params">(m</span></span></span><span class="hljs-class">), </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Seq</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">new </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">TokenExpressionNode</span></span></span></span><span class="hljs-class"><span class="hljs-params">("'" + span + "'"</span></span></span><span class="hljs-class">), </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">e</span></span></span><span class="hljs-class">) ) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DateExpression</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Timestamp</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dateTrunc</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">span: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, e: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">DateExpression</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Timestamp</span></span></span></span><span class="hljs-class"><span class="hljs-params">]</span></span></span><span class="hljs-class">)(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">implicit m: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">OutMapper</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Timestamp</span></span></span></span><span class="hljs-class"><span class="hljs-params">]</span></span></span><span class="hljs-class">) </span></span>= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">DateTrunc</span></span>(span, e, m)</code> </pre><br><br>  A more detailed description can be found on the official website <a href="http://squeryl.org/getting-started.html">squeryl.org/getting-started.html</a> <br><br><h4>  Well closer to practice </h4><br><h6>  Task </h6><br>  To demonstrate the work of ORM, we will write a small application on the Play Framework 2, which will provide a universal API for getting an object, saving / creating an object and deleting it, by class name and its identifier <br><br>  We will use PostgreSQL 9.3 as the database. <br><br><h6>  Integration </h6><br>  Add to build.sbt <br><br><pre> <code class="scala hljs"> <span class="hljs-string"><span class="hljs-string">"org.squeryl"</span></span> %% <span class="hljs-string"><span class="hljs-string">"squeryl"</span></span> % <span class="hljs-string"><span class="hljs-string">"0.9.5-7"</span></span>, <span class="hljs-string"><span class="hljs-string">"org.postgresql"</span></span> % <span class="hljs-string"><span class="hljs-string">"postgresql"</span></span> % <span class="hljs-string"><span class="hljs-string">"9.3-1101-jdbc41"</span></span></code> </pre><br><br>  Add to conf / application.conf <br><br><pre> <code class="hljs swift">db.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.driver = org.postgresql.<span class="hljs-type"><span class="hljs-type">Driver</span></span> db.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.url = <span class="hljs-string"><span class="hljs-string">"postgres://postgres:password@localhost/database"</span></span> db.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.logStatements = <span class="hljs-literal"><span class="hljs-literal">true</span></span> evolutionplugin = disabled</code> </pre><br><br>  Create Global.scala in the app directory <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.squeryl.adapters.<span class="hljs-type"><span class="hljs-type">PostgreSqlAdapter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.squeryl.{<span class="hljs-type"><span class="hljs-type">Session</span></span>, <span class="hljs-type"><span class="hljs-type">SessionFactory</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> play.api.db.<span class="hljs-type"><span class="hljs-type">DB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> play.api.mvc.<span class="hljs-type"><span class="hljs-type">WithFilters</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> play.api.{<span class="hljs-type"><span class="hljs-type">Application</span></span>, <span class="hljs-type"><span class="hljs-type">GlobalSettings</span></span>} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Global</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GlobalSettings</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onStart</span></span></span></span>(app: <span class="hljs-type"><span class="hljs-type">Application</span></span>) { <span class="hljs-type"><span class="hljs-type">SessionFactory</span></span>.concreteFactory = <span class="hljs-type"><span class="hljs-type">Some</span></span>(() =&gt; <span class="hljs-type"><span class="hljs-type">Session</span></span>.create(<span class="hljs-type"><span class="hljs-type">DB</span></span>.getConnection()(app), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PostgreSqlAdapter</span></span>)) } }</code> </pre><br><br>  So when you start the application, we initialize the session factory with the default connection. <br><br><h6>  Models </h6><br>  We implement the base trait for the models, which will contain the id fields of the Long type, created - the model creation time in the database, updated - the last modification time, (maybe I will call hollivar, but still) the deleted Boolean field, which will be the flag deleted object or not, and if necessary, this object can be restored. <br><br>  We also immediately implement the functionality for converting an object to json, for this we will use the Gson library, to add it you will register in build.sbt: <br><br> <code>"com.google.code.gson" % "gson" % "2.2.4" <br></code> <br><br>  Of course, the Play Framework has built-in mechanisms for working with json, but in my opinion they have flaws, so we will combine them with Gson. <br><br>  To do this, create app / models / Entity.scala <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.gson.<span class="hljs-type"><span class="hljs-type">Gson</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.joda.time.<span class="hljs-type"><span class="hljs-type">DateTime</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.squeryl.<span class="hljs-type"><span class="hljs-type">KeyedEntity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> play.api.libs.json.<span class="hljs-type"><span class="hljs-type">JsValue</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityBase</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">K</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KeyedEntity</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">K</span></span></span><span class="hljs-class">] </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">table</span></span></span><span class="hljs-function"> </span></span>= findTablesFor(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).head <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">json</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> gson: <span class="hljs-type"><span class="hljs-type">Gson</span></span>): <span class="hljs-type"><span class="hljs-type">JsValue</span></span> = play.api.libs.json.<span class="hljs-type"><span class="hljs-type">Json</span></span>.parse(gson.toJson(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isNew</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Boolean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span></span>(): <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = transaction { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isNew) table.insert(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> table.update(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityC</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">K</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityBase</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">K</span></span></span><span class="hljs-class">] </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> created: <span class="hljs-type"><span class="hljs-type">TimeStamp</span></span> = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span></span>(): <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isNew) created = <span class="hljs-type"><span class="hljs-type">DateTime</span></span>.now() <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.save() } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityCUD</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">K</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityC</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">K</span></span></span><span class="hljs-class">] </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> updated: <span class="hljs-type"><span class="hljs-type">TimeStamp</span></span> = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> deleted = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span></span>(): <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = { updated = <span class="hljs-type"><span class="hljs-type">DateTime</span></span>.now() <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.save() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delete</span></span></span></span>(): <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = { deleted = <span class="hljs-literal"><span class="hljs-literal">true</span></span> save() } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityCUD</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Long</span></span></span><span class="hljs-class">] </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id = <span class="hljs-number"><span class="hljs-number">0</span></span>L <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isNew</span></span></span><span class="hljs-function"> </span></span>= id == <span class="hljs-number"><span class="hljs-number">0</span></span>L }</code> </pre><br><br>  In this code, several traits are implemented, which are inherited from each other by adding new functionality. <br><br>  The basic concept: the save () method, checks whether the object is saved in the database or not, and depending on this, the create or update method is called on its corresponding table. <br><br>  To store time, Squeryl uses the java.sql.Timestamp type, which for me (and many will agree with me) is not very convenient to use.  To work with time, I prefer to use joda.DateTime.  The benefit of Scala provides a convenient mechanism for implicit type conversions. <br><br>  Let's create a data scheme and a set of useful utilities, for convenience, create a package object, for this we create the file app / models / package.scala with the following code: <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.sql.<span class="hljs-type"><span class="hljs-type">Timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.gson.<span class="hljs-type"><span class="hljs-type">Gson</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.joda.time.<span class="hljs-type"><span class="hljs-type">DateTime</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.squeryl.customtypes._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.squeryl.{<span class="hljs-type"><span class="hljs-type">Schema</span></span>, <span class="hljs-type"><span class="hljs-type">Table</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> play.api.libs.json.{<span class="hljs-type"><span class="hljs-type">JsObject</span></span>, <span class="hljs-type"><span class="hljs-type">JsValue</span></span>, <span class="hljs-type"><span class="hljs-type">Json</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> scala.language.implicitConversions <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">models</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Schema</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomTypesMode</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> logins = table[<span class="hljs-type"><span class="hljs-type">Login</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTable</span></span></span></span>[<span class="hljs-type"><span class="hljs-type">E</span></span> &lt;: <span class="hljs-type"><span class="hljs-type">Entity</span></span>]()(<span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> manifestT: <span class="hljs-type"><span class="hljs-type">Manifest</span></span>[<span class="hljs-type"><span class="hljs-type">E</span></span>]): <span class="hljs-type"><span class="hljs-type">Table</span></span>[<span class="hljs-type"><span class="hljs-type">E</span></span>] = tables.find(_.posoMetaData.clasz == manifestT.runtimeClass).get.asInstanceOf[<span class="hljs-type"><span class="hljs-type">Table</span></span>[<span class="hljs-type"><span class="hljs-type">E</span></span>]] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTable</span></span></span></span>(name: <span class="hljs-type"><span class="hljs-type">String</span></span>): <span class="hljs-type"><span class="hljs-type">Table</span></span>[_ &lt;: <span class="hljs-type"><span class="hljs-type">Entity</span></span>] = tables.find(_.posoMetaData.clasz.getSimpleName.toLowerCase == name) .get.asInstanceOf[<span class="hljs-type"><span class="hljs-type">Table</span></span>[_ &lt;: <span class="hljs-type"><span class="hljs-type">Entity</span></span>]] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span></span>[<span class="hljs-type"><span class="hljs-type">T</span></span> &lt;: <span class="hljs-type"><span class="hljs-type">Entity</span></span>](id: <span class="hljs-type"><span class="hljs-type">Long</span></span>)(<span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> manifestT: <span class="hljs-type"><span class="hljs-type">Manifest</span></span>[<span class="hljs-type"><span class="hljs-type">T</span></span>]): <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">T</span></span>] = getTable[<span class="hljs-type"><span class="hljs-type">T</span></span>]().lookup(id).map(e =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.deleted) <span class="hljs-type"><span class="hljs-type">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-type"><span class="hljs-type">Some</span></span>(e) }).getOrElse(<span class="hljs-type"><span class="hljs-type">None</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span></span>(table: <span class="hljs-type"><span class="hljs-type">String</span></span>, id: <span class="hljs-type"><span class="hljs-type">Long</span></span>): <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">Entity</span></span>] = getTable(table).lookup(id).map(e =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.deleted) <span class="hljs-type"><span class="hljs-type">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-type"><span class="hljs-type">Some</span></span>(e) }).getOrElse(<span class="hljs-type"><span class="hljs-type">None</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAll</span></span></span></span>(table: <span class="hljs-type"><span class="hljs-type">String</span></span>): <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">Entity</span></span>] = from(getTable(table))(e =&gt; select(e)).toSeq <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span></span>(table: <span class="hljs-type"><span class="hljs-type">String</span></span>, json: <span class="hljs-type"><span class="hljs-type">String</span></span>)(<span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> gson: <span class="hljs-type"><span class="hljs-type">Gson</span></span>) = gson.fromJson( json, getTable(table).posoMetaData.clasz ).save() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delete</span></span></span></span>(table: <span class="hljs-type"><span class="hljs-type">String</span></span>, id: <span class="hljs-type"><span class="hljs-type">Long</span></span>) = get(table, id).map(_.delete()) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TimeStamp</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">t: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Timestamp</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TimestampField</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">t</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implicit</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">jodaToTimeStamp</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">dateTime: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">DateTime</span></span></span></span></span><span class="hljs-class">)</span></span>: <span class="hljs-type"><span class="hljs-type">TimeStamp</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">TimeStamp</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Timestamp</span></span>(dateTime.getMillis)) <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">timeStampToJoda</span></span></span></span>(timeStamp: <span class="hljs-type"><span class="hljs-type">TimeStamp</span></span>): <span class="hljs-type"><span class="hljs-type">DateTime</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">DateTime</span></span>(timeStamp.value.getTime) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Json</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">s: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringField</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">s</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implicit</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stringToJson</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">s: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">)</span></span>: <span class="hljs-type"><span class="hljs-type">Json</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Json</span></span>(s) <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jsonToString</span></span></span></span>(json: <span class="hljs-type"><span class="hljs-type">Json</span></span>): <span class="hljs-type"><span class="hljs-type">String</span></span> = json.value <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jsValueToJson</span></span></span></span>(jsValue: <span class="hljs-type"><span class="hljs-type">JsValue</span></span>): <span class="hljs-type"><span class="hljs-type">Json</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Json</span></span>(jsValue.toString()) <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jsonToJsObject</span></span></span></span>(json: <span class="hljs-type"><span class="hljs-type">Json</span></span>): <span class="hljs-type"><span class="hljs-type">JsObject</span></span> = <span class="hljs-type"><span class="hljs-type">Json</span></span>.parse(json.value).asInstanceOf[<span class="hljs-type"><span class="hljs-type">JsObject</span></span>] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ForeignKey</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">E</span></span></span><span class="hljs-class"> &lt;: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Entity</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">l: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Long</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LongField</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">l</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _entity = <span class="hljs-type"><span class="hljs-type">Option</span></span>.empty[<span class="hljs-type"><span class="hljs-type">E</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">entity</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> manifestT: <span class="hljs-type"><span class="hljs-type">Manifest</span></span>[<span class="hljs-type"><span class="hljs-type">E</span></span>]): <span class="hljs-type"><span class="hljs-type">E</span></span> = _entity.getOrElse({ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> res = get[<span class="hljs-type"><span class="hljs-type">E</span></span>](value).get _entity = <span class="hljs-type"><span class="hljs-type">Some</span></span>(res) res }) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">entity_=</span></span></span></span>(value: <span class="hljs-type"><span class="hljs-type">E</span></span>) { _entity = <span class="hljs-type"><span class="hljs-type">Some</span></span>(value) } } <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">entityToForeignKey</span></span></span></span>[<span class="hljs-type"><span class="hljs-type">E</span></span> &lt;: <span class="hljs-type"><span class="hljs-type">Entity</span></span>](entity: <span class="hljs-type"><span class="hljs-type">E</span></span>): <span class="hljs-type"><span class="hljs-type">ForeignKey</span></span>[<span class="hljs-type"><span class="hljs-type">E</span></span>] = { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> fk = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">ForeignKey</span></span>[<span class="hljs-type"><span class="hljs-type">E</span></span>](entity.id) fk.entity = entity fk } <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foreignKeyToEntity</span></span></span></span>[<span class="hljs-type"><span class="hljs-type">T</span></span> &lt;: <span class="hljs-type"><span class="hljs-type">Entity</span></span>](fk: <span class="hljs-type"><span class="hljs-type">ForeignKey</span></span>[<span class="hljs-type"><span class="hljs-type">T</span></span>])(<span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> manifestT: <span class="hljs-type"><span class="hljs-type">Manifest</span></span>[<span class="hljs-type"><span class="hljs-type">T</span></span>]): <span class="hljs-type"><span class="hljs-type">T</span></span> = fk.entity <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">longToForeignKey</span></span></span></span>[<span class="hljs-type"><span class="hljs-type">T</span></span> &lt;: <span class="hljs-type"><span class="hljs-type">Entity</span></span>](l: <span class="hljs-type"><span class="hljs-type">Long</span></span>)(<span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> manifestT: <span class="hljs-type"><span class="hljs-type">Manifest</span></span>[<span class="hljs-type"><span class="hljs-type">T</span></span>]) = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">ForeignKey</span></span>[<span class="hljs-type"><span class="hljs-type">T</span></span>](l) }</code> </pre><br><br>  Here the main methods for working with the database are implemented, a class for the TimeStamp time, a class for storing json in the database and a class for foreign keys with all the necessary implicit conversions are created.  Many will find the code overkilom, but I will immediately say in most tasks in practice, this code does not need anything at all, I tried to show you what kind of functionality Squeryl has. <br><br>  And finally, we will write a Login model with the login, password field and an external key to the Login who invited it and do not forget to create the corresponding table in the database with test data. <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> models <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Login</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> login = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> password = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parent: <span class="hljs-type"><span class="hljs-type">ForeignKey</span></span>[<span class="hljs-type"><span class="hljs-type">Login</span></span>] = <span class="hljs-literal"><span class="hljs-literal">null</span></span> }</code> </pre><br><br><h6>  Actions </h6><br>  In order to fulfill the request, you must put the code in inTransaction {} or transaction {}. <br><br>  inTransaction {} adds the request to the current transaction. <br><br>  transaction {} executes code in a single transaction. <br><br>  We assume that one action corresponds to one transaction and in order not to write in each action transaction block we will create a DbAction in the app / controller / BaseController.scala file <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> controllers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> models._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> play.api.mvc._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> utils.<span class="hljs-type"><span class="hljs-type">Jsons</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> scala.concurrent.<span class="hljs-type"><span class="hljs-type">Future</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> scala.language.implicitConversions <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> gson = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Gson</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DbAction</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionBuilder</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Request</span></span></span><span class="hljs-class">] </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invokeBlock</span></span></span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>](request: <span class="hljs-type"><span class="hljs-type">Request</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>], block: (<span class="hljs-type"><span class="hljs-type">Request</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>]) =&gt; <span class="hljs-type"><span class="hljs-type">Future</span></span>[<span class="hljs-type"><span class="hljs-type">Result</span></span>]): <span class="hljs-type"><span class="hljs-type">Future</span></span>[<span class="hljs-type"><span class="hljs-type">Result</span></span>] = transaction { block(request) } } }</code> </pre><br><br>  Here we also specify the gson object that will be used to convert the model to json / <br><br>  Finally, let's write a controller for the API, app / controllers / Api.scala <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> controllers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> play.api.libs.json.<span class="hljs-type"><span class="hljs-type">Json</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> play.api.mvc.<span class="hljs-type"><span class="hljs-type">Action</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Api</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span></span>(cls: <span class="hljs-type"><span class="hljs-type">String</span></span>, id: <span class="hljs-type"><span class="hljs-type">Long</span></span>) = <span class="hljs-type"><span class="hljs-type">DbAction</span></span> { <span class="hljs-type"><span class="hljs-type">Ok</span></span>(models.get(cls, id).map(_.json).getOrElse(<span class="hljs-type"><span class="hljs-type">Json</span></span>.obj())) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span></span>(cls: <span class="hljs-type"><span class="hljs-type">String</span></span>) = <span class="hljs-type"><span class="hljs-type">DbAction</span></span>{ request =&gt; <span class="hljs-type"><span class="hljs-type">Ok</span></span>(models.save(cls, request.form.getOrElse(<span class="hljs-string"><span class="hljs-string">"data"</span></span>, <span class="hljs-string"><span class="hljs-string">"{}"</span></span>)).json) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delete</span></span></span></span>(cls: <span class="hljs-type"><span class="hljs-type">String</span></span>, id: <span class="hljs-type"><span class="hljs-type">Long</span></span>) = <span class="hljs-type"><span class="hljs-type">DbAction</span></span> { <span class="hljs-type"><span class="hljs-type">Ok</span></span>(models.delete(cls, id).map(_.json).getOrElse(<span class="hljs-type"><span class="hljs-type">Json</span></span>.obj())) } }</code> </pre><br><br>  Add actions to conf / routes routes <br><br><pre> <code class="scala hljs"># <span class="hljs-type"><span class="hljs-type">Api</span></span> <span class="hljs-type"><span class="hljs-type">GET</span></span> /api/:cls/:id controllers.<span class="hljs-type"><span class="hljs-type">Api</span></span>.get(cls:<span class="hljs-type"><span class="hljs-type">String</span></span>,id:<span class="hljs-type"><span class="hljs-type">Long</span></span>) <span class="hljs-type"><span class="hljs-type">POST</span></span> /api/save/:cls controllers.<span class="hljs-type"><span class="hljs-type">Api</span></span>.save(cls:<span class="hljs-type"><span class="hljs-type">String</span></span>) <span class="hljs-type"><span class="hljs-type">POST</span></span> /api/delete/:cls/:id controllers.<span class="hljs-type"><span class="hljs-type">Api</span></span>.delete(cls:<span class="hljs-type"><span class="hljs-type">String</span></span>,id:<span class="hljs-type"><span class="hljs-type">Long</span></span>)</code> </pre><br><br>  And finally run: <br><br><img src="http://s1.hostingkartinok.com/uploads/images/2014/07/0eb3a14a8ffc98c4e9cff7e0fbf71bc7.jpg" alt="image"><br><br>  Moreover, you can register in the url any id, any class instead of login and get the answer you need Json.  If necessary, the models can overload the json method to add / hide any data.  It is worth noting that Gson does not serialize the Scala collection, so for this you have to use the transformations in the Java collection, or use the built-in Play Framework mechanism for working with Json. <br><br><h5>  Summarize </h5><br>  The written code perfectly demonstrates the wide possibilities of Squeryl, but it is worth noting that for small tasks it is not necessary to implement something like this, Squeryl can provide you with full-fledged work with the database in just 5 lines. <br><br>  The main drawback in my opinion is the absence of the migration mechanism, the maximum that Squeryl can do is to issue the current DDL. <br><br>  I will not conduct a comparative analysis of Squeryl with other ORMs (at least in this article), but for me personally a very lazy person and not willing to write something extra when adding new entities to the database, this ORM fits perfectly. </div><p>Source: <a href="https://habr.com/ru/post/230353/">https://habr.com/ru/post/230353/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../230343/index.html">Firmware Intel Integrated RAID Module RMS25JB080 in IT mode</a></li>
<li><a href="../230345/index.html">Browser Browser - empowering file sharing, as well as a way to survive pirated sites with anti-piracy laws</a></li>
<li><a href="../230347/index.html">How PolyITAN-1 was born in KPI laboratories</a></li>
<li><a href="../230349/index.html">Lock-free data structures. Queue dissection</a></li>
<li><a href="../230351/index.html">Simple websocket chat on Dart</a></li>
<li><a href="../230355/index.html">Measure temperature: TEMPer + Python + Windows</a></li>
<li><a href="../230357/index.html">Parallel non-parallel or search for prime numbers on the GPU</a></li>
<li><a href="../230359/index.html">SASM - IDE for assembler</a></li>
<li><a href="../230361/index.html">LG G3: outside and inside the clearest smartphone in the world</a></li>
<li><a href="../230365/index.html">HybridAuth for UMI.CMS. Authorization through social networks on UMI.CMS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>