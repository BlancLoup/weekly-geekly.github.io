<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Traffic Inspector in action: monitor network activity via VPN</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 As you know, VPN technology is used to organize a direct secure connection between clients (the end user and the corporate office) or t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Traffic Inspector in action: monitor network activity via VPN</h1><div class="post__text post__text-html js-mediator-article"><h5>  Introduction </h5><br>  As you know, VPN technology is used to organize a direct secure connection between clients (the end user and the corporate office) or two local networks through a public Internet channel.  Using VPN, remote users can access enterprise servers and communicate with various offices of their company. <br><br>  VPN does not need dedicated lines, so anyone who has access to the Internet can use it.  Once the connection is established, the employee can work with all network resources as if he were in the office.  But perhaps the most important advantage of this technology is that, despite the public infrastructure, a direct VPN connection (the so-called VPN tunnel) is so securely protected that it is almost impossible to steal data or gain unauthorized access to a geographically distributed network. <br><br>  In this article, we will look at how, with the help of <a href="http://www.smart-soft.ru/ru/products/Traffic-Inspector/">Traffic Inspector, we can</a> monitor VPN collaboration in a corporate network and track network activity. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Configuration </h5><br>  Let our company have a head office in Moscow and a branch in St. Petersburg.  Suppose we need to combine the St. Petersburg office with the Moscow office into a single corporate network through a VPN, as well as organize Internet access through the Moscow office and monitor network activity in both offices.  Suppose also that a VPN is created programmatically and that each client machine connects separately. <br><br><h5>  General principle </h5><br>  In the most general form, the tuning algorithm will be as follows: <br><br><ul><li>  Create and configure a VPN server at the head office. </li><li>  Create and configure VPN connections to the head office from the branch. </li><li>  Check work on VPN. </li><li>  Install and activate Traffic Inspector on the gateway in the head office. </li><li>  Create permissions in Traffic Inspector in the external firewall for VPN. </li><li>  Add branch users to Traffic Inspector. </li><li>  Assign rules to individual users and their groups (for example, deny access to certain resources, set up accounting and charging for day-time traffic, etc.). </li><li>  Check the operation of the rules and the correctness of the settings. </li></ul><br><br><h5>  Configure the VPN server </h5><br>  So, now we know the general order of adjustment and we can proceed to the description of specific actions.  For example, we took Windows Server 2012, but the same applies to earlier versions (Windows 2003 and 2008). <br><br>  In the <b>Routing and Remote Access</b> service, right-click your server and select <b>Configure and Enable Routing and Remote Access.</b> <b><br></b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d81/0e7/e39/d810e7e39509aba4644b99f2fda7baf8.jpg" alt="image"><br><br><a name="habracut"></a><ul><li>  In the Routing and Remote Access Server Setup Wizard that opens, click <b>Next</b> and select <b>Special configuration.</b> </li><li>  In the next window, select <b>Virtual Private Network Access (VPN), Network Address Translation (NAT), LAN Routing</b> and click <b>Next.</b> </li><li>  In the final wizard window, click <b>Finish</b> and start the service. </li><li>  Now go to the server properties: </li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/faf/4f1/69b/faf4f169b5349621097dd27ae22a77ab.jpg" alt="image"><br><br>  and on the <b>General</b> tab <b>,</b> set the following parameters: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/33d/516/3da/33d5163da13ef5ef6aea90745da21d47.jpg" alt="image"><br><br>  Go to the <b>IPv4</b> tab and select the static address pool: 4 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f88/13e/d86/f8813ed86232b62941a9120ac7198c67.jpg" alt="image"><br><br>  Click the <b>Add</b> button and assign an address pool (in this case, the subnet <b>192.168.200.1-192.168.200.10</b> is selected, consisting of 10 addresses, and the server receives the address 192.168.200.1): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fe6/b57/542/fe6b5754288b4f8d6505af8d5859f051.jpg" alt="image"><br><br>  Click the <b>Logging</b> tab and check the <b>Log errors and warnings</b> box <b>.</b> <br>  Right-click <b>Ports</b> and select <b>Properties:</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/940/e4d/251/940e4d2510576922eaf86e4d287dff24.jpg" alt="image"><br><br>  For stable server operation, it is recommended to remove unnecessary ports (SSTP, PPOE, L2TP, IKEv2) and create the required number of PPTP ports (in our case, you need 10 such ports): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/697/666/9aa/6976669aac968c4ee8b171f4522311ed.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/bda/1fa/499/bda1fa4994b5724f14f310e7c3f153ae.jpg" alt="image"><br><br>  Go to <b>Network Address Translation (NAT)</b> and add a new interface: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/324/b45/9ef/324b459ef8ecca7eac89ae37009f0a97.jpg" alt="image"><br><br>  Select an Internet connection and check the boxes under the <b>common interface connected to the Internet</b> and <b>Enable NAT on this interface.</b> <br>  Then mark the local network interface as ‚Äú <b>Private interface connected to private network</b> ‚Äù, and the internal interface as <b>Private interface connected to private network.</b>  It turns out about the following: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a7e/d55/1c9/a7ed551c9c43fc9943a89c44f4bdd5e0.jpg" alt="image"><br><br>  This completes the configuration of the VPN server at the head office and completes the configuration of VPN clients in the branch office. <br><br><h5>  Configure VPN Clients </h5><br>  On the server side, start computer management: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c05/568/6b7/c055686b789ef9c6e4678374dd2871ac.jpg" alt="image"><br><br>  and in the section <b>Local Users and Groups - Users</b> add a new user and provide his credentials: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/256/0ee/8e0/2560ee8e04520409dd9db507e176f26d.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d74/889/c17/d74889c17e68bc0d19abea3e44f9aa50.jpg" alt="image"><br><br>  Go to the user properties on the <b>Incoming Calls</b> tab and specify the settings as shown in the figure (you can also assign a static IP to the user): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/80d/59a/fcb/80d59afcba6514814ff0ff4964140462.jpg" alt="image"><br><br>  Now, on the client side, create a VPN connection using the operating system (for example, take Windows 8).  To do this, in the Network and Sharing Center, select the <b>Configure a new connection or network</b> option, and in the opened wizard, select <b>Connect to a workstation:</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/94d/838/a90/94d838a90b3def92cd12536f652c452d.jpg" alt="image"><br><br>  Select <b>Use my Internet connection (VPN)</b> and click <b>Next</b> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf0/89c/b1b/cf089cb1b64e628f7c2e83cfdff4e25d.jpg" alt="image"><br><br>  Then enter the URL or IP address of the VPN server, specify the name of its location and click the <b>New</b> button: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/30e/7ae/f89/30e7aef8951e99f9c67ef2171710ff7c.jpg" alt="image"><br><br><h5>  Configuring Traffic Inspector on the VPN server </h5><br>  After configuring the VPN server and clients, you can proceed to installing and configuring Traffic Inspector itself.  Please note that Traffic Inspector is installed only at this stage, so the performance of the VPN should be checked in advance using standard Windows tools (ping, netstat, tracert, etc.). <br><br>  In the <b>Traffic Inspector</b> configurator in the service settings, check the Use <b>RAS server</b> checkbox: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/29c/a56/33c/29ca5633c799ad04e9cba546b5965c4c.jpg" alt="image"><br><br>  In the <b>External Firewall Rules</b> section in Traffic Inspector, create two rules ‚Äî in one rule, allow TCP connections to port 1723 for external clients, and in the second rule, allow connections using the GRE protocol (option <b>Specified IP type</b> , number <b>47</b> ): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3bb/b87/163/3bbb87163385f92cdee3a2c268a2a0aa.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d6/23f/a39/6d623fa39ee484c7f94ca4d3df1ceb65.jpg" alt="image"><br><br>  The remaining parameters can be not changed and leave the default values. <br><br>  Add a new client to the program and specify the connection method. <b>Connect via Windows RAS server</b> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f19/2d8/9e2/f192d89e2ce0abf919c6f8efac025d5a.jpg" alt="image"><br><br>  The remaining settings are similar to the settings of the program clients.  In this case, IP authorization is used: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/336/9e6/68b/3369e668bf9d019f30d7702bc2d12e97.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/287/496/84b/28749684b10618bbb29cf0e51823097f.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/49e/7fe/274/49e7fe274eadc99567de3a3401cd7e1f.jpg" alt="image"><br><br>  If necessary, you can configure automatic shutdown of the client in case of exceeding the allowable balance, or you can deny access to the server on certain days: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/076/ac2/bd0/076ac2bd0af4cd66d9e58a36f714f133.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/39d/c16/aa1/39dc16aa14e8bbc3bf6f3a68a0a89d60.jpg" alt="image"><br><br>  Traffic Inspector provides 4 levels of traffic filtering for users - banners, multimedia, graphics and text only.  To select one of them, select the <b>Set individual minimum filtering level for user</b> checkbox <b>:</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ce/138/15e/6ce13815ed8d9a6202fb1fd116aa3977.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/e5e/0c2/865/e5e0c2865ea47a5b34f36b6a6286205f.jpg" alt="image"><br><br>  In addition, the user can be allocated a certain quota of traffic (for example, 100 MB): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2b4/207/ee2/2b4207ee25f2337f20f8191ff919fd77.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/950/930/324/950930324871ce37a952892d3275e30e.jpg" alt="image"><br><br>  After the settings are completed, a new RAS server (dial in) network will appear in the main Traffic Inspector window: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8b6/b8a/4d4/8b6b8a4d45e7314eea9319dbe99f93bc.jpg" alt="image"><br><br><h5>  Conclusion </h5><br>  The organization of a VPN tunnel can provide high-speed and secure connections in the corporate network, guaranteed bandwidth, and cost savings on the network infrastructure.  However, the problem of network security remains relevant for VPN.  Traffic Inspector fills this gap, allowing you to quickly monitor users on the Internet and connect to the corporate server, including setting <a href="http://www.smart-soft.ru/ru/products/Traffic-Inspector/Features/ogranichenie-skorosti-internet/">quotas for traffic</a> , limit access to certain resources, adjust various levels of filtering for users, and much more.  In this case, the system administrator does not require any special knowledge - all configuration is done in the Windows Management Console (MMC) using convenient step-by-step wizards. </div><p>Source: <a href="https://habr.com/ru/post/227247/">https://habr.com/ru/post/227247/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../227237/index.html">Broadcast video from a mobile device to YouTube</a></li>
<li><a href="../227239/index.html">3 of 130. New Android tablets at Intel Atom</a></li>
<li><a href="../227241/index.html">Operator preceding descending parser</a></li>
<li><a href="../227243/index.html">Swift: problems and prospects</a></li>
<li><a href="../227245/index.html">Mad House on PHDays: cyber threats of an ordinary apartment</a></li>
<li><a href="../227249/index.html">They want to send "computer microprobe" to Europe</a></li>
<li><a href="../227253/index.html">The model of the natural series of numbers (nrch). Ulam Spiral</a></li>
<li><a href="../227255/index.html">Automobile race and service testing</a></li>
<li><a href="../227257/index.html">Brave new world: mobile operators, as the largest providers of advertising data</a></li>
<li><a href="../227261/index.html">The government is ready to pay for Russian studies in foreign universities</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>