<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Facts in puppet</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Often, we are faced with the problem that standard facts that come with puppet are not always enough. The solution to this problem can be achieved by ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Facts in puppet</h1><div class="post__text post__text-html js-mediator-article">  Often, we are faced with the problem that standard facts that come with puppet are not always enough.  The solution to this problem can be achieved by adding new facts.  You can add your own Ruby facts to the puppet server.  Then the server, using synchronization plug-ins, will distribute them to all clients. <br><a name="habracut"></a><br>  In order to see all the facts that are now on the client, use the command facter -p <br><br>  What are the facts you can see at the beginning of the <a href="http://habrahabr.ru/company/badoo/blog/157023/">article</a> by <a href="https://habrahabr.ru/users/badoo/" class="user_link">Badoo</a> <br><br><h5>  Example </h5><br>  Suppose we need to get the output of the uname -i command to determine the system capacity.  For this we need to create a fact.  Let's call our fact hardware_platform, and create hardware_platform.rb, on the Puppet server: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      {modulepath} <br>  {‚îÄ‚îÄ {module} <br>  Lib‚îÄ‚îÄ lib <br>  Fac‚îÄ‚îÄ facter <br><br><br><pre><code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># hardware_platform.rb Facter.add("hardware_platform") do setcode do Facter::Util::Resolution.exec('/bin/uname -i') end end</span></span></code> </pre> <br><br><h5>  Facts in Facts </h5><br>  We can use factual values ‚Äã‚Äãwhen writing our own using the Facter.value (‚Äúsomefact‚Äù) or Facter.somefact construct.  In the absence of a fact, the first will return 0, and the second exception. <br><pre> <code class="ruby hljs">Facter.add(<span class="hljs-string"><span class="hljs-string">"osfamily"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> setcode <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> distid = Facter.value(<span class="hljs-string"><span class="hljs-string">'lsbdistid'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> distid <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> /RedHatEnterprise<span class="hljs-params"><span class="hljs-params">|CentOS|</span></span>Fedora/ <span class="hljs-string"><span class="hljs-string">"redhat"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">"ubuntu"</span></span> <span class="hljs-string"><span class="hljs-string">"debian"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> distid <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Now after the next launch of the agent puppet on the client, the fact will become available. <br><br><h5>  Comment </h5><br>  On the puppet server and client in the [main] section there should be an option <br> <code>pluginsync = true</code> <br> <br><h4>  Customize the facts. </h4><br>  Facts have several parameters that can be used to fine-tune facts. <br><br><h5>  Timeout </h5><br>  If your fact is unreliable and cannot always shut down correctly, you can use timeout.  If the execution time of the setcode block is longer than the timeout, Facter will interrupt the process and assign the value specified on the error to the fact. <br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment">#  timeout Facter.add(:sleep) do timeout = 10 setcode do if Random.rand(6) == 0 sleep 999999 else "awake" end end end</span></span></code> </pre><br><br><h5>  Caching </h5><br>  If the facts do not change for some time or it takes a long time to find them, they can be cached.  To do this, we need to add the option ': ttl' when declaring a fact <br><pre> <code class="ruby hljs">Facter.add(<span class="hljs-string"><span class="hljs-string">"mylongoperation"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:ttl</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">600</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> setcode <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ...  ... <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br>  0 - never cache.  The default behavior. <br>  -1 - Cash forever.  Useful for one-time operations.  For example: the name of the distribution. <br><br><h5>  Importance of facts </h5><br>  Facts have a parameter - weight.  Facts with more weight are performed before <br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment">#  Facter.add(:role) do has_weight 100 setcode do if File.exist? "/etc/postgres_server" "postgres_server" end end end #     Facter.add(:role) do has_weight 50 setcode do if File.exist? "/usr/sbin/pg_create" "postgres_server" end end end #      ,    Facter.add(:role) do setcode do "desktop" end end</span></span></code> </pre><br><br><h5>  Limiting facts </h5><br>  We can limit the execution of facts on the basis of other facts with the help of the parameter - confine. <br>  For example, finding a fact only if the system kernel is Linux. <br><pre> <code class="ruby hljs">Facter.add(<span class="hljs-symbol"><span class="hljs-symbol">:powerstates</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> confine <span class="hljs-symbol"><span class="hljs-symbol">:kernel</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"Linux"</span></span> setcode <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> Facter::Util::Resolution.exec(<span class="hljs-string"><span class="hljs-string">'cat /sys/power/states'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/165543/">https://habr.com/ru/post/165543/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../165531/index.html">Death Star is not needed when there is Curiosity</a></li>
<li><a href="../165533/index.html">Vulnerability in ICQ allows access to the archive of files transferred via the service.</a></li>
<li><a href="../165535/index.html">Sigrand Distributed Video Surveillance System</a></li>
<li><a href="../165537/index.html">The official trailer for the movie The Pirate Bay Away From Keyboard</a></li>
<li><a href="../165541/index.html">Reddit co-founder Aaron Schwartz committed suicide</a></li>
<li><a href="../165545/index.html">Are profits lost? Django freed</a></li>
<li><a href="../165547/index.html">The principle of "anchor" in the game balance</a></li>
<li><a href="../165549/index.html">Take care of your sight, use f.lux</a></li>
<li><a href="../165551/index.html">For a scrap of colored tape</a></li>
<li><a href="../165553/index.html">Magic Panel - jQuery plugin for fast page scrolling</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>