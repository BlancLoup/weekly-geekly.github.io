<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We create a video wall with the image broadcast from ip-cameras via satellite with a minimum of traffic</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article describes how to provide ‚Äúalmost video broadcasting‚Äù with ffmpeg, wget, JS, html and such and such mothers . In fact, we create a slidesho...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We create a video wall with the image broadcast from ip-cameras via satellite with a minimum of traffic</h1><div class="post__text post__text-html js-mediator-article">  The article describes how to provide ‚Äúalmost video broadcasting‚Äù with ffmpeg, wget, JS, html <s>and such and such mothers</s> .  In fact, we create a slideshow with its accurate output and dynamic update on a web page.  Perhaps someone will benefit from my experience. <br>  Knowledgeable people will not find anything new in the article for themselves, but if they read it, I would love to hear comments on how to improve this scheme. <br><a name="habracut"></a><br><h5>  Introduction and Prehistory </h5><br>  I work as a system administrator (network support specialist) in a company that, by occupation, has about 10 branches located in the taiga.  Internet in all branches, except one, the happiest, is provided via satellite.  Satellite Internet, when it is the only way to communicate with the outside world (except for jokes, the nearest village with a connection is usually 70 kilometers away), turns out to be a very unstable and expensive thing. <br><br>  Among other things (mail, sip-telephony), the Internet in our company is spent on video surveillance.  The Directorate is very keen to observe the work in the branches.  But little traffic.  At the maximum rate of FAP.4000 + .AST 2GB of traffic per day, that in the presence of three two-megapixel cameras is ridiculous.  In principle, the image from the cameras can be cut (we do so), but still viewing the cameras without internal traffic restrictions can easily drive the point into a ‚Äúhard limit‚Äù (when the daily traffic limit is reached).  One camera with a 128 kbit / s stream per day will eat 1350 mb. <br><br>  I was given the task to create a kind of ‚Äúvideo wall‚Äù for the directors, where images from all the cameras of our company would be displayed.  With the draconian limitations of satellite Internet, there is no talk about direct streaming from the camera.  Software type from Macroscop does not support stream recoding from camera on the fly.  To be honest, it seems to me that Macroscop gives its client a bold stream than it receives from the camera.  I experimented with VLC (unstable, periodically browser plugin crashes or spontaneously pauses the stream, eats a lot of resources during transcoding), ffmpeg + ffserver (so I did not start this bundle).  As a result, I came up with the idea of ‚Äã‚Äãcapturing screenshots from the stream from the cameras and its further transfer to the central office with a predetermined frequency.  Everything turned out, but it turned out clumsy and kondovo.  I would say Dubove.  But it works.  I will finish in the future. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Technical part </h5><br>  Our cameras are mostly Beward.  There are several Hikvision.  All cameras (in theory, but practice later) support RTSP.  In ideal conditions, we use it.  The final image is always issued through ffmpeg - it adjusts the image size and jpg quality, using these parameters, we can control the amount of traffic that flows per day.  Also, the frequency of request for frames from the central server affects the amount of traffic. <br><br>  Next comes JavaScript and some HTML (and a bit of php).  On the Internet, I found a script on JS, which dynamically updates the image on the page, but only after downloading it and catching the OnLoad event.  A page was prepared for this case, with which I pass the parameters (the name of the camera, the address of its admin, a link to the screenshot). <br><div class="spoiler">  <b class="spoiler_title">Personal camera page</b> <div class="spoiler_text"><pre><code class="php hljs">&lt;!DOCTYPE html <span class="hljs-keyword"><span class="hljs-keyword">PUBLIC</span></span> <span class="hljs-string"><span class="hljs-string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span></span> <span class="hljs-string"><span class="hljs-string">"http://www.w3.org/TR/html4/loose.dtd"</span></span>&gt; &lt;html&gt; &lt;head&gt; &lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> speed = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cam_show</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imac = document.getElementById(<span class="hljs-string"><span class="hljs-string">'camimage'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> time = now(); imac.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ start_show(imac, now()-time); document.getElementById(<span class="hljs-string"><span class="hljs-string">'speed'</span></span>).innerHTML = ((now()-time)*(speed+<span class="hljs-number"><span class="hljs-number">5</span></span>))/<span class="hljs-number"><span class="hljs-number">1000</span></span>; }; imac.src = <span class="hljs-string"><span class="hljs-string">"&lt;?php echo ($_GET['urlpic']) ?&gt;?r="</span></span> + Math.random(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">now</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Date).getTime(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start_show</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(img, time)</span></span></span><span class="hljs-function"> </span></span>{ setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ctime = now(); img.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ start_show(img, now()-ctime) document.getElementById(<span class="hljs-string"><span class="hljs-string">'speed'</span></span>).innerHTML = ((now()-ctime)*(speed+<span class="hljs-number"><span class="hljs-number">5</span></span>))/<span class="hljs-number"><span class="hljs-number">1000</span></span>; }; img.src = <span class="hljs-string"><span class="hljs-string">"&lt;?php echo ($_GET['urlpic']) ?&gt;?r="</span></span> + Math.random(); }, time*(speed+<span class="hljs-number"><span class="hljs-number">5</span></span>)); } &lt;/script&gt; &lt;meta http-equiv=<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span> content=<span class="hljs-string"><span class="hljs-string">"text/html; charset=windows-1251"</span></span>&gt; &lt;meta http-equiv=<span class="hljs-string"><span class="hljs-string">"imagetoolbar"</span></span> content=<span class="hljs-string"><span class="hljs-string">"no"</span></span>&gt; &lt;/head&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> error_reporting(E_ALL); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;body onload=<span class="hljs-string"><span class="hljs-string">"cam_show()"</span></span>&gt; &lt;center&gt;<span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;a class='store' href=\"./cam-get.php?picwidth=60%&amp;urladmin={$_GET['urladmin']}&amp;urlpic={$_GET['urlpic']}&amp;textpage={$_GET['textpage']}\" target=_blank alt=test&gt;{$_GET['textpage']}&lt;/a&gt;"</span></span>;<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span>&lt;/center&gt; &lt;div align=<span class="hljs-string"><span class="hljs-string">"center"</span></span>&gt; &lt;img width=<span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"{$_GET['picwidth']}"</span></span>;<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> id=<span class="hljs-string"><span class="hljs-string">"camimage"</span></span> src=<span class="hljs-string"><span class="hljs-string">""</span></span> alt=<span class="hljs-string"><span class="hljs-string">""</span></span>&gt; &lt;/div&gt; &lt;center&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;div id=\"div1\" style=\"display:{$_GET['visibletxt']}\"&gt;"</span></span> <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;a class='store' href=\"{$_GET['urladmin']}\" target=_blank&gt;[]&lt;/a&gt;"</span></span>;<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;a class='store' href=\"{$_GET['urlpic']}\" target=_blank&gt;[ ]&lt;/a&gt;"</span></span>;<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;/div&gt; &lt;/center&gt; &lt;/body&gt; &lt;/html&gt;</code> </pre> <br></div></div><br><br><h5>  How is all of this tied up? </h5><br>  In the branches on the servers (win 2008 r2 or win 7, if it is a separate virtual machine), the following software is installed: <br><br><ul><li>  nnCron Lite (I did not manage to configure the Windows scheduler, it periodically hung, only manual completion of all instances of the task, saving the task, starting and starting) saved; </li><li>  Apache 2.4; </li><li>  ffmpeg; </li><li>  wget (yes, under Windows, here I am a pervert). </li></ul><br><br>  nnCron runs tasks (it is much more stable than the Windows task scheduler), these are ordinary .bat, in which ffmpeg indicates what to get from and where and how and where to put it.  If the camera has difficulties with RTSP, the dances begin with ftp, sampling the last screenshot and banging the extras and substituting the correct date into the address, because the Beardard cameras want to put screens at ddmmgggg \ camera_name \ 1 \ *. Jpg.  Ugliness, of course, but where to go? <br><br><div class="spoiler">  <b class="spoiler_title">Vindov.bat for processing screenshots from cameras, self-folding them on an ftp-server</b> <div class="spoiler_text"><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> day=<span class="hljs-variable"><span class="hljs-variable">%DATE:~0,2%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> month=<span class="hljs-variable"><span class="hljs-variable">%DATE:~3,2%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> year=<span class="hljs-variable"><span class="hljs-variable">%DATE:~6,4%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> YYYYMMDD=<span class="hljs-variable"><span class="hljs-variable">%year%</span></span>-<span class="hljs-variable"><span class="hljs-variable">%month%</span></span>-<span class="hljs-variable"><span class="hljs-variable">%day%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> /L <span class="hljs-variable"><span class="hljs-variable">%%i</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DO</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> "C:\ftp\kpp\<span class="hljs-variable"><span class="hljs-variable">%YYYYMMDD%</span></span>\kpp\<span class="hljs-number"><span class="hljs-number">1</span></span>\" c: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> /f <span class="hljs-variable"><span class="hljs-variable">%%i</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ('<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span> /b /T:A /A:-D /O:-D *.jpg') <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> /Y "<span class="hljs-variable"><span class="hljs-variable">%%i</span></span>" "c:\ftp\<span class="hljs-built_in"><span class="hljs-built_in">copy</span></span>\andat-kpp.jpg") C:\ffmpeg\bin\ffmpeg.exe -i "c:\ftp\<span class="hljs-built_in"><span class="hljs-built_in">copy</span></span>\andat-kpp.jpg" -f image2 -vframes <span class="hljs-number"><span class="hljs-number">1</span></span> -y -q:v <span class="hljs-number"><span class="hljs-number">15</span></span> -s <span class="hljs-number"><span class="hljs-number">480</span></span>x360 C:\Apache24\htdocs\andat-kpp.jpg <span class="hljs-built_in"><span class="hljs-built_in">del</span></span> /Q "C:\ftp\kpp\<span class="hljs-variable"><span class="hljs-variable">%YYYYMMDD%</span></span>\kpp\<span class="hljs-number"><span class="hljs-number">1</span></span>\*.jpg" timeout /t <span class="hljs-number"><span class="hljs-number">5</span></span> /nobreak ) <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span></code> </pre><br></div></div><br>  ffmpeg adds images with the necessary sizes and quality to the root folder of the web server.  Then begins the server in the central office, where all this is stored and slipped into the main page, where the video wall is located. <br><br><div class="spoiler">  <b class="spoiler_title">The script that pulls out the screenshots from the branch and adds the old screenshots to the archive</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh cd /var/www/ mkdir /var/www/archieve/ mkdir /var/www/archieve/tuhterek mkdir /var/www/archieve/tuhterek/gep1/ mkdir /var/www/archieve/tuhterek/polygon/ cp /var/www/tuht-gep1.jpg /var/www/archieve/tuhterek/gep1/gep1-`date +-%d-%m-%Y-%H%M%S`.jpg cp /var/www/tuht-polygon.jpg /var/www/archieve/tuhterek/polygon/polygon-`date +-%d-%m-%Y-%H%M%S`.jpg wget http://172.30.99.80/tuht-gep1.jpg -O tuht-gep1.jpg.bak cp tuht-gep1.jpg.bak tuht-gep1.jpg wget http://172.30.99.80/tuht-polygon.jpg -O tuht-polygon.jpg.bak cp tuht-polygon.jpg.bak tuht-polygon.jpg</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">A slice of the video wall</b> <div class="spoiler_text"><pre> <code class="php hljs">&lt;iframe src=<span class="hljs-string"><span class="hljs-string">"./cam-get.php?urlpic=http://192.168.1.239/bak_cam200.jpg&amp;picwidth=92%&amp;textpage=26  -  &amp;urladmin=http://192.168.0.200"</span></span>align=center width=<span class="hljs-string"><span class="hljs-string">"340"</span></span> height=<span class="hljs-string"><span class="hljs-string">"290"</span></span> scrolling=<span class="hljs-string"><span class="hljs-string">"no"</span></span>&gt;test&lt;/iframe&gt; &lt;iframe src=<span class="hljs-string"><span class="hljs-string">"./cam-get.php?urlpic=http://192.168.1.239/bak_cam201.jpg&amp;picwidth=92%&amp;textpage=26  -   &amp;urladmin=http://192.168.0.201"</span></span>align=center width=<span class="hljs-string"><span class="hljs-string">"340"</span></span> height=<span class="hljs-string"><span class="hljs-string">"290"</span></span> scrolling=<span class="hljs-string"><span class="hljs-string">"no"</span></span>&gt;test&lt;/iframe&gt; &lt;iframe src=<span class="hljs-string"><span class="hljs-string">"./cam-get.php?urlpic=http://192.168.1.239/bak_cam202.jpg&amp;picwidth=92%&amp;textpage=26  - &amp;urladmin=http://192.168.0.202"</span></span>align=center width=<span class="hljs-string"><span class="hljs-string">"340"</span></span> height=<span class="hljs-string"><span class="hljs-string">"290"</span></span> scrolling=<span class="hljs-string"><span class="hljs-string">"no"</span></span>&gt;test&lt;/iframe&gt; &lt;iframe src=<span class="hljs-string"><span class="hljs-string">"./cam-get.php?urlpic=http://192.168.1.239/bak_cam203.jpg&amp;picwidth=92%&amp;textpage=26  - &amp;urladmin=http://192.168.0.203"</span></span>align=center width=<span class="hljs-string"><span class="hljs-string">"340"</span></span> height=<span class="hljs-string"><span class="hljs-string">"290"</span></span> scrolling=<span class="hljs-string"><span class="hljs-string">"no"</span></span>&gt;test&lt;/iframe&gt; &lt;iframe src=<span class="hljs-string"><span class="hljs-string">"./cam-get.php?urlpic=http://192.168.1.239/bak_cam205.jpg&amp;picwidth=92%&amp;textpage=26  -  &amp;urladmin=http://192.168.0.205"</span></span>align=center width=<span class="hljs-string"><span class="hljs-string">"340"</span></span> height=<span class="hljs-string"><span class="hljs-string">"290"</span></span> scrolling=<span class="hljs-string"><span class="hljs-string">"no"</span></span>&gt;test&lt;/iframe&gt; &lt;iframe src=<span class="hljs-string"><span class="hljs-string">"./cam-get.php?urlpic=http://192.168.1.239/bak_cam206.jpg&amp;picwidth=92%&amp;textpage=26  -  &amp;urladmin=http://192.168.0.206"</span></span>align=center width=<span class="hljs-string"><span class="hljs-string">"340"</span></span> height=<span class="hljs-string"><span class="hljs-string">"290"</span></span> scrolling=<span class="hljs-string"><span class="hljs-string">"no"</span></span>&gt;test&lt;/iframe&gt; &lt;iframe src=<span class="hljs-string"><span class="hljs-string">"./cam-get.php?urlpic=http://192.168.1.239/bak_cam204.jpg&amp;picwidth=92%&amp;textpage=26  - &amp;urladmin=http://192.168.0.204"</span></span>align=center width=<span class="hljs-string"><span class="hljs-string">"340"</span></span> height=<span class="hljs-string"><span class="hljs-string">"290"</span></span> scrolling=<span class="hljs-string"><span class="hljs-string">"no"</span></span>&gt;test&lt;/iframe&gt; &lt;iframe src=<span class="hljs-string"><span class="hljs-string">"./cam-get.php?urlpic=http://192.168.1.239/bak_cam207.jpg&amp;picwidth=92%&amp;textpage=26  - &amp;urladmin=http://192.168.0.207"</span></span>align=center width=<span class="hljs-string"><span class="hljs-string">"340"</span></span> height=<span class="hljs-string"><span class="hljs-string">"290"</span></span> scrolling=<span class="hljs-string"><span class="hljs-string">"no"</span></span>&gt;test&lt;/iframe&gt;</code> </pre><br></div></div><br>  The server periodically (several times per minute) extorts all screenshots from the dots, adds instead of the old ones, the old ones go to the archive.  At night, another script takes them from the archive, which carefully collects all the screenshots in one video and names it by date and camera name. <br><br><div class="spoiler">  <b class="spoiler_title">The script that compiles the archive of screenshots in the video</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash tochka=$1 kamera=$2 yestday=`date +%d -d yesterday` year=`date +%Y -d yesterday` mes=`date +%m -d yesterday` stime=`date +%H%M%S -d yesterday` mkdir /var/www/archieve/video/ mkdir /var/www/archieve/video/$tochka mkdir /var/www/archieve/video/$tochka/$kamera mkdir /tmp/picture/ rm /tmp/picture/* echo "$day $mes $year" cd /var/www/archieve/$tochka/$kamera/ find * -type f -size 0k -exec rm {} \; | awk '{ print $8 }' X=1; for i in *.jpg; do mv $i /tmp/picture/$(printf %07d.%s ${X%.*} ${i##*.}) let X="$X+1" done cd /tmp/picture/ ffmpeg -f image2 -r 1 -i %07d.jpg -y /var/www/archieve/video/$tochka/$kamera/$kamera-$yestday-$mes-$year.avi</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Screenshot flowchart</b> <div class="spoiler_text"><br></div></div><br><br><h5>  Future plans </h5><br>  I would very much like to get rid of the need to prescribe the same parameters n times in different scripts.  I plan to save the settings &lt;somewhere&gt;, take them from there as necessary and automatically generate the necessary scripts when adding the desired camera. <br>  I plan to fasten the form of adding a new camera. <br><br>  I would like to transfer everything to linux (it is not always possible to deploy virtual machines with it now, the company uses Win-server and hyper-v mainly). <br><br>  I would like greater reliability, increasing the quality of images and their update frequency, but without a strong increase in traffic. <br><br>  This is not the very first version, but it is still far from perfect.  This can be said to be a prototype.  Therefore, criticism (constructive) is welcomed, but cries of "cyclist on crutches" are not.  I know myself.  But, since the finished software does not fulfill our desires, you have to dodge and do it yourself. <br><br><h5>  PS </h5><br>  About errors in a personal, please, or mail. <br><br><h5>  UPD: </h5><br><div class="spoiler">  <b class="spoiler_title">Part of a home-made monitoring system</b> <div class="spoiler_text">  Clickable <br><br></div></div><br>  The inscription ‚Äúsite available‚Äù is issued using a php script that checks the availability of the camera admin panel on http.  When you hover on the image in the left column pops up a full-sized window. <br>  I will insert the wall a little later. </div><p>Source: <a href="https://habr.com/ru/post/239853/">https://habr.com/ru/post/239853/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../239835/index.html">Transition to cloud video analytics: problems and solutions</a></li>
<li><a href="../239837/index.html">English to Malibu</a></li>
<li><a href="../239841/index.html">Google used camel in the desert of Liva for Google Street View</a></li>
<li><a href="../239845/index.html">Google introduced the x86 64-bit Android L emulator for developers</a></li>
<li><a href="../239849/index.html">We design information architecture for e-commerce. Part 1</a></li>
<li><a href="../239855/index.html">What can the optimizer do that no one else can do?</a></li>
<li><a href="../239857/index.html">Features of cloning in an educational institution</a></li>
<li><a href="../239861/index.html">Direct access to Cach√© classes via REST, for example DHTMLX Grid</a></li>
<li><a href="../239863/index.html">Everything you wanted to know about scopes in JavaScript (but were afraid to ask)</a></li>
<li><a href="../239865/index.html">Not like in "Gravity": how astronauts repair the ISS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>