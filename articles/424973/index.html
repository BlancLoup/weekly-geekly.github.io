<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Face Detection Video: Raspberry Pi and Neural Compute Stick</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About a year ago, Intel Movidius released a device for the effective inference of convolutional neural networks - the Movidius Neural Compute Stick (N...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Face Detection Video: Raspberry Pi and Neural Compute Stick</h1><div class="post__text post__text-html js-mediator-article">  About a year ago, <a href="https://www.movidius.com/">Intel Movidius</a> released a device for the effective inference of convolutional neural networks - the Movidius Neural Compute Stick (NCS).  This device allows the use of neural networks for recognition or detection of objects in conditions of limited power consumption, including robotics tasks.  NCS has a USB interface and consumes no more than 1 watt.  In this article I will talk about the experience of using NCS with the Raspberry Pi for the task of detecting faces in video, including both the training of the Mobilenet-SSD detector and its launch on the Raspberry. <br><br>  All code can be found in my two repositories: <a href="https://github.com/BeloborodovDS/MobilenetSSDFace">detector training</a> and <a href="https://github.com/BeloborodovDS/NCS-face">face detection demo</a> . <br><br><img src="https://habrastorage.org/webt/qu/b_/tj/qub_tj1u6ztw9irfy9ivtaaidcc.jpeg"><br><a name="habracut"></a><br>  <a href="https://habr.com/post/347438/">In my first article</a> I already wrote about face detection using NCS: then it was a <a href="https://github.com/dannyblueliu/YOLO-Face-detection">YOLOv2</a> detector, which I converted from <a href="https://pjreddie.com/darknet/">Darknet</a> format to <a href="http://caffe.berkeleyvision.org/">Caffe</a> format, and then launched on NCS.  The conversion process turned out to be nontrivial: since these two formats set the last detector layer differently, the neural network output had to be parsed separately on the CPU, using a piece of code from Darknet.  In addition, this detector did not satisfy me both in speed (up to 5.1 FPS on my laptop) and in accuracy - I later became convinced that because of the sensitivity to image quality from it, it is difficult to get a good result on the Raspberry Pi. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the end, I decided to just train my detector.  The choice fell on the <a href="https://github.com/weiliu89/caffe/tree/ssd">SSD</a> detector with the <a href="https://arxiv.org/abs/1704.04861">Mobilenet</a> encoder: the lightweight Mobilenet convolutions make it possible to achieve high speed without much loss in quality, while the SSD detector itself is not inferior to YOLO and works on NCS out of the box. <br><br><div class="spoiler">  <b class="spoiler_title">How Mobilenet-SSD Detector Works</b> <div class="spoiler_text">  Let's start with Mobilenet.  In this architecture is complete <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>3</mn><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mn>3</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.762ex" height="2.074ex" viewBox="0 -772.3 3772.5 892.8" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-33" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-74" x="750" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-69" x="1112" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-6D" x="1457" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-65" x="2336" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="2802" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-33" x="3272" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></mn><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></mn></math></span></span><script type="math/tex" id="MathJax-Element-1"> 3 \ times 3 </script>  convolution (across all channels) is replaced with two lightweight convolutions: first <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>3</mn><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mn>3</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.762ex" height="2.074ex" viewBox="0 -772.3 3772.5 892.8" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-33" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-74" x="750" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-69" x="1112" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-6D" x="1457" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-65" x="2336" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="2802" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-33" x="3272" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></mn><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></mn></math></span></span><script type="math/tex" id="MathJax-Element-2"> 3 \ times 3 </script>  separately for each channel and then complete <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>1</mn><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mn>1</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.762ex" height="2.074ex" viewBox="0 -772.3 3772.5 892.8" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-31" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-74" x="750" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-69" x="1112" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-6D" x="1457" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-65" x="2336" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="2802" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-31" x="3272" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one</font></font></mn><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one</font></font></mn></math></span></span><script type="math/tex" id="MathJax-Element-3"> 1 \ times 1 </script>  convolution.  After each convolution, <a href="https://arxiv.org/abs/1502.03167">BatchNorm</a> and non-linearity (ReLU) are used.  The very first convolution of a network that receives an image as input is usually left complete.  This architecture can significantly reduce the complexity of calculations due to a small decrease in the quality of predictions.  There is a <a href="https://arxiv.org/abs/1801.04381">more advanced version</a> , but I have not tried it yet. <br><br>  SSD (Single Shot Detector) works like this: the outputs of several encoder bundles are hung in two <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>1</mn><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mn>1</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.762ex" height="2.074ex" viewBox="0 -772.3 3772.5 892.8" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-31" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-74" x="750" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-69" x="1112" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-6D" x="1457" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-65" x="2336" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="2802" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-31" x="3272" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one</font></font></mn><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one</font></font></mn></math></span></span><script type="math/tex" id="MathJax-Element-4"> 1 \ times 1 </script>  convolutional layer: one predicts the probabilities of classes, the other - the coordinates of the bounding box.  There is also a third layer, which gives the coordinates and positions of the default framework at the current level.  The meaning is as follows: the output of any layer is naturally divided into cells;  towards the end of the neural network, they are getting smaller (in this case, because of bundles with <code>stride=2</code> ), and the field of view of each cell increases.  For each cell on each of several selected layers, we set several default frames of different sizes and with different aspect ratios, and use additional convolutional layers to correct the coordinates and predict the class probabilities for each such frame.  Therefore, the SSD detector (as well as YOLO) always considers the same number of frames.  The same object can be detected on different layers: during training, the signal is sent to all frames that intersect quite strongly with the object, and during the application of detection, they are combined with non maximum suppression (NMS).  The final layer combines detections from all layers, counts their full coordinates, cuts off the probability threshold and produces NMS. <br></div></div><br><h2>  Detector training </h2><br><h3>  Architecture </h3><br>  The code for learning detector is located <a href="https://github.com/BeloborodovDS/MobilenetSSDFace">here</a> . <br><br>  I decided to use the <a href="https://github.com/chuanqi305/MobileNet-SSD">ready Mobilenet-SSD detector</a> trained in <a href="http://host.robots.ox.ac.uk/pascal/VOC/">PASCAL VOC0712</a> and add it to face detection.  Firstly, it helps to train the net faster, and secondly, you don‚Äôt have to reinvent the wheel. <br><br>  The original project included a <code>gen.py</code> script that literally collected the model's <code>.prototxt</code> file, substituting the input parameters.  I transferred it to my project, expanding the functionality a bit.  This script allows you to generate four types of configuration files: <br><br><ul><li>  <b>train</b> : at the entrance there is an LMDB training base, at the exit there is a layer with calculation of the loss function and its gradients, there is a BatchNorm </li><li>  <b>test</b> : at the entrance - test LMDB base, at the exit - a layer with a quality calculation (mean average precision), there is a BatchNorm </li><li>  <b>deploy</b> : input - image, output - layer with predictions, BatchNorm is absent </li><li>  <b>deploy_bn</b> : at the entrance - an image, at the exit - a layer with predictions, there is a BatchNorm </li></ul><br>  I added the last option later so that the scripts could load and convert the grid from BatchNorm without touching the LMDB database - otherwise, if there was no database, nothing worked.  (Actually, it seems to me strange that in Caffe a data source is set in the network architecture - this is at least not very practical). <br><br><div class="spoiler">  <b class="spoiler_title">How the network architecture looks like (shortly)</b> <div class="spoiler_text"><ul><li>  Entrance: <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>300</mn><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mn>300</mn><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mn>3</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="21.011ex" height="2.074ex" viewBox="0 -772.3 9046.5 892.8" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-33"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-30" x="1001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-74" x="1751" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-69" x="2113" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-6D" x="2458" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-65" x="3337" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="3803" y="0"></use><g transform="translate(4273,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-33"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-74" x="6024" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-69" x="6386" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-6D" x="6731" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-65" x="7610" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="8076" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-33" x="8546" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">300</font></font></mn><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">300</font></font></mn><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></mn></math></span></span><script type="math/tex" id="MathJax-Element-5"> 300 \ times 300 \ times 3 </script></li><li>  Full convolution <b>conv0</b> : 32 channels, <code>stride=2</code> </li><li>  Mobilenet convolution <b>conv1 - conv11</b> : 64, 128, 128, 256, 256, 512 ... 512 channels, some have <code>stride=2</code> </li><li>  Detection Layer: <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>19</mn><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mn>19</mn><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>$</mo></mrow><mn>51</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="21.011ex" height="2.211ex" viewBox="0 -831.5 9046.5 952" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-39" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-74" x="1251" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-69" x="1612" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-6D" x="1958" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-65" x="2836" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="3303" y="0"></use><g transform="translate(3772,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-39" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-74" x="5023" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-69" x="5385" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-6D" x="5730" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-65" x="6609" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="7075" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-24" x="7545" y="0"></use><g transform="translate(8045,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-35"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-31" x="500" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nineteen</font></font></mn><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nineteen</font></font></mn><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mrow class="MJX-TeXAtom-ORD"><mo><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$</font></font></mo></mrow><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">51</font></font></mn></math></span></span><script type="math/tex" id="MathJax-Element-6"> 19 \ times 19 \ times $ 51</script></li><li>  Mobilenet convolution <b>conv12, conv13</b> : 1024 channels, <b>conv12</b> has <code>stride=2</code> </li><li>  Detection Layer: <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>10</mn><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mn>10</mn><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mn>1024</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="22.174ex" height="2.074ex" viewBox="0 -772.3 9547 892.8" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-74" x="1251" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-69" x="1612" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-6D" x="1958" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-65" x="2836" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="3303" y="0"></use><g transform="translate(3772,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-74" x="5023" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-69" x="5385" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-6D" x="5730" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-65" x="6609" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="7075" y="0"></use><g transform="translate(7545,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-32" x="1001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-34" x="1501" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ten</font></font></mn><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ten</font></font></mn><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1024</font></font></mn></math></span></span><script type="math/tex" id="MathJax-Element-7"> 10 \ times 10 \ times 1024 </script></li><li>  Full convolution <b>conv14_1, conv14_2</b> : 256, 512 channels, with the first <code>kernel_size=1</code> , with the second <code>stride=2</code> </li><li>  Detection Layer: <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>5</mn><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mn>5</mn><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>$</mo></mrow><mn>51</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.686ex" height="2.211ex" viewBox="0 -831.5 8045.5 952" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-35" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-74" x="750" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-69" x="1112" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-6D" x="1457" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-65" x="2336" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="2802" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-35" x="3272" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-74" x="4022" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-69" x="4384" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-6D" x="4729" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-65" x="5608" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="6074" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-24" x="6544" y="0"></use><g transform="translate(7044,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-35"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-31" x="500" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">five</font></font></mn><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">five</font></font></mn><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mrow class="MJX-TeXAtom-ORD"><mo><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$</font></font></mo></mrow><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">51</font></font></mn></math></span></span><script type="math/tex" id="MathJax-Element-8"> 5 \ times 5 \ times $ 51</script></li><li>  Full convolutions of <b>conv15_1, conv15_2</b> : 128, 256 channels, for the first <code>kernel_size=1</code> , for the second <code>stride=2</code> </li><li>  Detection Layer: <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>3</mn><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mn>3</mn><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mn>256</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.686ex" height="2.074ex" viewBox="0 -772.3 8045.5 892.8" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-33" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-74" x="750" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-69" x="1112" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-6D" x="1457" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-65" x="2336" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="2802" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-33" x="3272" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-74" x="4022" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-69" x="4384" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-6D" x="4729" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-65" x="5608" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="6074" y="0"></use><g transform="translate(6544,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-35" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-36" x="1001" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></mn><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></mn><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">256</font></font></mn></math></span></span><script type="math/tex" id="MathJax-Element-9"> 3 \ times 3 \ times 256 </script></li><li>  Full convolution <b>conv16_1, conv16_2</b> : 128, 256 channels, with the first <code>kernel_size=1</code> , with the second <code>stride=2</code> </li><li>  Detection Layer: <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>2</mn><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mn>2</mn><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mn>256</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.686ex" height="2.074ex" viewBox="0 -772.3 8045.5 892.8" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-32" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-74" x="750" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-69" x="1112" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-6D" x="1457" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-65" x="2336" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="2802" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-32" x="3272" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-74" x="4022" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-69" x="4384" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-6D" x="4729" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-65" x="5608" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="6074" y="0"></use><g transform="translate(6544,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-35" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-36" x="1001" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></mn><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></mn><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">256</font></font></mn></math></span></span><script type="math/tex" id="MathJax-Element-10"> 2 \ times 2 \ times 256 </script></li><li>  Full convolution <b>conv17_1, conv17_2</b> : 64, 128 channels, with the first <code>kernel_size=1</code> , with the second <code>stride=2</code> </li><li>  Detection Layer: <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>1</mn><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mn>1</mn><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mn>128</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.686ex" height="2.074ex" viewBox="0 -772.3 8045.5 892.8" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-31" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-74" x="750" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-69" x="1112" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-6D" x="1457" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-65" x="2336" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="2802" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-31" x="3272" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-74" x="4022" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-69" x="4384" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-6D" x="4729" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-65" x="5608" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="6074" y="0"></use><g transform="translate(6544,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-32" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-38" x="1001" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one</font></font></mn><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one</font></font></mn><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">128</font></font></mn></math></span></span><script type="math/tex" id="MathJax-Element-11"> 1 \ times 1 \ times 128 </script></li><li>  Final Detection Output Layer </li></ul><br></div></div><br>  I slightly corrected the network architecture.  List of changes: <br><br><ul><li>  Obviously, the number of classes changed to 1 (not counting the background). </li><li>  The restrictions on the aspect ratio of the cut patches during training: have changed since <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mn>0.5</mn><mo>,</mo><mn>2.0</mn><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.271ex" height="2.66ex" viewBox="0 -832 3561.2 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-5B" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-35" x="779" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-2C" x="1558" y="0"></use><g transform="translate(2003,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-30" x="779" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-5D" x="3282" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[</font></font></mo><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.5</font></font></mn><mo><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></mo><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.0</font></font></mn><mo stretchy="false"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]</font></font></mo></math></span></span><script type="math/tex" id="MathJax-Element-12"> [0.5,2.0] </script>  on <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mn>0.7</mn><mo>,</mo><mn>1.4</mn><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.271ex" height="2.66ex" viewBox="0 -832 3561.2 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-5B" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-37" x="779" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-2C" x="1558" y="0"></use><g transform="translate(2003,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-34" x="779" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-5D" x="3282" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[</font></font></mo><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.7</font></font></mn><mo><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></mo><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4</font></font></mn><mo stretchy="false"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]</font></font></mo></math></span></span><script type="math/tex" id="MathJax-Element-13"> [0.7,1.4] </script>  (I decided to simplify the task a little and not study on too stretched pictures). </li><li>  Of the default frames, only square boxes remain, two for each cell.  I have greatly reduced their size, since the faces are significantly smaller than the objects in the classical problem of detecting objects. </li></ul><br>  Caffe calculates the size of the default framework as follows: having a minimum frame size <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>s</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.455ex" viewBox="0 -520.7 469.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi></math></span></span><script type="math/tex" id="MathJax-Element-14"> s </script>  and maximum <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.057ex" viewBox="0 -780.1 681.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-4C" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L</font></font></mi></math></span></span><script type="math/tex" id="MathJax-Element-15"> L </script>  it creates a small and large frame with dimensions <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>s</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.455ex" viewBox="0 -520.7 469.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi></math></span></span><script type="math/tex" id="MathJax-Element-16"> s </script>  and <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>q</mi><mi>r</mi><mi>t</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>s</mi><mi>L</mi></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.302ex" height="2.419ex" viewBox="0 -780.1 3144 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-71" x="719" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-72" x="1180" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-74" x="1631" y="0"></use><g transform="translate(1993,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-4C" x="469" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">q</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mrow class="MJX-TeXAtom-ORD"><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L</font></font></mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-17"> \ sqrt {sL} </script>  .  Since I wanted to detect as small faces as possible, I calculated the full <code>stride</code> for each layer of detections and equated the minimum frame size to it.  With such parameters, the small default framework will be located close to each other and will not intersect.  So at least we have a guarantee that the intersection with the object will exist for some frame.  I set the maximum size twice.  For layers <b>conv16_2, conv17_2</b> I put the dimensions on the eye, the same.  In this way, <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>s</mi><mo>,</mo><mi>L</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.707ex" height="2.419ex" viewBox="0 -780.1 1596.2 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-73" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-2C" x="469" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMATHI-4C" x="914" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mo><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></mo><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L</font></font></mi></math></span></span><script type="math/tex" id="MathJax-Element-18"> s, L </script>  for all layers were: <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>(</mo><mn>16.32</mn><mo stretchy=&quot;false&quot;>)</mo><mo>,</mo><mo stretchy=&quot;false&quot;>(</mo><mn>32.64</mn><mo stretchy=&quot;false&quot;>)</mo><mo>,</mo><mo stretchy=&quot;false&quot;>(</mo><mn>64.128</mn><mo stretchy=&quot;false&quot;>)</mo><mo>,</mo><mo stretchy=&quot;false&quot;>(</mo><mn>128.214</mn><mo stretchy=&quot;false&quot;>)</mo><mo>,</mo><mo stretchy=&quot;false&quot;>(</mo><mn>214</mn><mo>,</mo><mn>300</mn><mo stretchy=&quot;false&quot;>)</mo><mo>,</mo><mo stretchy=&quot;false&quot;>(</mo><mn>214</mn><mo>,</mo><mn>300</mn><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="56.717ex" height="2.66ex" viewBox="0 -832 24419.7 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-28" x="0" y="0"></use><g transform="translate(389,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-36" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-2E" x="1001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-33" x="1279" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-32" x="1780" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-29" x="2670" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-2C" x="3059" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-28" x="3504" y="0"></use><g transform="translate(3894,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-33"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-32" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-2E" x="1001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-36" x="1279" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-34" x="1780" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-29" x="6174" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-2C" x="6564" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-28" x="7009" y="0"></use><g transform="translate(7398,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-36"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-34" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-2E" x="1001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-31" x="1279" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-32" x="1780" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-38" x="2280" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-29" x="10179" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-2C" x="10569" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-28" x="11014" y="0"></use><g transform="translate(11403,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-32" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-38" x="1001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-2E" x="1501" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-32" x="1780" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-31" x="2280" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-34" x="2781" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-29" x="14685" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-2C" x="15074" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-28" x="15520" y="0"></use><g transform="translate(15909,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-31" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-34" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-2C" x="17411" y="0"></use><g transform="translate(17856,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-33"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-29" x="19357" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-2C" x="19747" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-28" x="20192" y="0"></use><g transform="translate(20582,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-31" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-34" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-2C" x="22083" y="0"></use><g transform="translate(22528,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-33"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424973/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhGPXg93aGMZN2MI1SOduK-pfbYjA#MJMAIN-29" x="24030" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></mo><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.32</font></font></mn><mo stretchy="false"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></mo><mo><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></mo><mo stretchy="false"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></mo><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32.64</font></font></mn><mo stretchy="false"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></mo><mo><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></mo><mo stretchy="false"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></mo><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64.128</font></font></mn><mo stretchy="false"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></mo><mo><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></mo><mo stretchy="false"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></mo><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">128.214</font></font></mn><mo stretchy="false"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></mo><mo><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></mo><mo stretchy="false"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></mo><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">214</font></font></mn><mo><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></mo><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">300</font></font></mn><mo stretchy="false"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></mo><mo><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></mo><mo stretchy="false"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></mo><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">214</font></font></mn><mo><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></mo><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">300</font></font></mn><mo stretchy="false"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></mo></math></span></span><script type="math/tex" id="MathJax-Element-19"> (16.32), (32.64), (64.128), (128.214), (214,300), (214,300) </script><br><br><div class="spoiler">  <b class="spoiler_title">What do some default frames look like (noise for clarity)</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/j9/ti/gj/j9tigjn9tq7sdz6m3tyxa1v2r9s.png"><br></div></div><br><h3>  Data </h3><br>  I used two <a href="http://mmlab.ie.cuhk.edu.hk/projects/WIDERFace/">datasets</a> : <a href="http://mmlab.ie.cuhk.edu.hk/projects/WIDERFace/">WIDER Face</a> and <a href="http://vis-www.cs.umass.edu/fddb/">FDDB</a> .  WIDER contains a lot of pictures with very small and blurred faces, and FDDB more to large images of faces (and an order of magnitude less than WIDER).  The annotation format is slightly different, but these are details. <br><br>  I didn‚Äôt use all the data for training: I threw out too small faces (less than six pixels or less than 2% of the image width), threw out all the images with the aspect ratio less than 0.5 or more than 2, threw out all the images marked as ‚Äúblurred‚Äù in WIDER dataset, since they corresponded for the most part to very small individuals, and I had to at least somehow align the ratio of small and large individuals.  After that, I made all the frames square, expanding the smallest side: I decided that I was not very interested in the proportions of the face, and the task for the neural network was a little simpler.  I also threw out all the black and white pictures, which were few and on which the database build script falls. <br><br>  To use them for training and testing, you need to build an LMDB base from them.  How it's done: <br><br><ul><li>  For each image, markup is created in the <code>.xml</code> format. </li><li>  A <code>train.txt</code> file is <code>train.txt</code> with lines like <code>"path/to/image.png path/to/labels.xml"</code> , the same is created for test. </li><li>  A <code>test_name_size.txt</code> file is <code>test_name_size.txt</code> with strings of the form <code>"test_image_name height width"</code> </li><li>  A <code>labelmap.prototxt</code> file is <code>labelmap.prototxt</code> with numeric matching labels. </li></ul><br><br>  The <code>ssd-caffe/scripts/create_annoset.py</code> (an example from the Makefile): <br><br><pre> <code class="bash hljs">python3 /opt/movidius/ssd-caffe/scripts/create_annoset.py --anno-type=detection \ --label-map-file=$(wider_dir)/labelmap.prototxt --min-dim=0 --max-dim=0 \ --resize-width=0 --resize-height=0 --check-label --encode-type=jpg --encoded \ --redo $(wider_dir) \ $(wider_dir)/trainval.txt $(wider_dir)/WIDER_train/lmdb/wider_train_lmdb ./data</code> </pre><br><div class="spoiler">  <b class="spoiler_title">labelmap.prototxt</b> <div class="spoiler_text"><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">item</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">name</span></span>: <span class="hljs-string"><span class="hljs-string">"none_of_the_above"</span></span> label: <span class="hljs-number"><span class="hljs-number">0</span></span> display_name: <span class="hljs-string"><span class="hljs-string">"background"</span></span> } <span class="hljs-selector-tag"><span class="hljs-selector-tag">item</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">name</span></span>: <span class="hljs-string"><span class="hljs-string">"face"</span></span> label: <span class="hljs-number"><span class="hljs-number">1</span></span> display_name: <span class="hljs-string"><span class="hljs-string">"face"</span></span> }</code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Example .xml markup</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">annotation</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">size</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">width</span></span></span><span class="hljs-tag">&gt;</span></span>348<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">width</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">height</span></span></span><span class="hljs-tag">&gt;</span></span>450<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">height</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depth</span></span></span><span class="hljs-tag">&gt;</span></span>3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depth</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">size</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">object</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>face<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bndbox</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xmin</span></span></span><span class="hljs-tag">&gt;</span></span>161<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xmin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ymin</span></span></span><span class="hljs-tag">&gt;</span></span>43<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ymin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xmax</span></span></span><span class="hljs-tag">&gt;</span></span>241<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xmax</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ymax</span></span></span><span class="hljs-tag">&gt;</span></span>123<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ymax</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bndbox</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">object</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">annotation</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  Using two datasets at the same time means only that you need to carefully merge the corresponding files in pairs, not forgetting to correctly register the paths, and also to mix the file for training. <br><br>  After that, you can start learning. <br><br><h3>  Training </h3><br>  The code for learning the model can be found in my <a href="https://colab.research.google.com/drive/1LExcFZO8vN46xrJ8deG159eIUaW0kB-H">Colab Notebook</a> . <br><br>  I did the training at Google Collaboration, because my laptop was barely able to test the mesh, and I was stuck in training.  Colaboratory allowed me to train the grid fairly quickly and for free.  The trick is that I had to write an SSD-Caffe compilation script for Collaboration (which includes such strange things as recompiling boost and editing sources), which takes about 40 minutes.  More details can be found <a href="https://habr.com/post/413229/">in my previous publication</a> . <br><br>  Colaboratory has one more feature: after 12 hours, the car dies, permanently erasing all the data.  The best way to avoid data loss is to install a Google disk into the system and save network weights into it every 500-1000 learning iterations. <br><br>  As for my detector, in one session at Colaboratory he managed to unlearn 4500 iterations, and he fully studied in two sessions. <br><br>  The quality of predictions (average average precision) on the test data set that I selected (merged by WIDER and FDDB with the limitations listed above) was about 0.87 for the best model.  To measure the mAP on the scales saved during the training, there is a script <code>scripts/plot_map.py</code> . <br><br>  Detector operation on (very strange) example from dataset: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nw/kc/jy/nwkcjyrtsz09v2fivdbs4uny3lc.png" width="60%"></div><br><h2>  Run on NCS </h2><br>  The face detection demo is <a href="https://github.com/BeloborodovDS/NCS-face">here</a> . <br><br>  To compile a neural network for the Neural Compute Stick, you need <a href="https://movidius.github.io/ncsdk/">Movidius NCSDK</a> : it contains utilities for compiling and profiling neural networks, as well as C ++ and Python API.  It is worth noting that a second version was recently released that was not compatible with the first one: all API functions were renamed for some reason, the internal format of neural networks was changed, FIFOs were added to interact with NCS and (finally) automatic conversion from float 32 bit to float 16 bit, which is so lacking in C ++.  I updated all my projects to the second version, but left a couple of crutches for compatibility with the first one. <br><br>  After learning the detector, it is worthwhile to merge the BatchNorm layers with the next convolutions to speed up the neural network.  This is handled by the <code>merge_bn.py</code> script <a href="https://github.com/BeloborodovDS/MobilenetSSDFace/tree/master/models/ssd_voc">from here</a> , which I also borrowed from the Mobilenet-SSD project. <br><br>  Then you need to call the <code>mvNCCompile</code> utility, for example: <br><br><pre> <code class="bash hljs">mvNCCompile -s 12 -o graph_ssd -w ssd-face.caffemodel ssd-face.prototxt</code> </pre><br>  In the project's Makefile there is a <code>graph_ssd</code> target for this.  The resulting <code>graph_ssd</code> file is a description of the neural network in a format understood by NCS. <br><br>  Now about how to interact with the device itself.  The process is not very complicated, but requires a fairly large amount of code.  The sequence of actions is approximately as follows: <br><br><ul><li>  Get device descriptor by ordinal number </li><li>  Open device </li><li>  Read the compiled file of the neural network in the buffer (as a binary file) </li><li>  Create an empty calculation graph for NCS </li><li>  Place the graph on the device, using the data from the file, and select for it a FIFO on input / output;  file buffer can now be freed </li><li>  Run detector: <br><ul><li>  Get the image from the camera (or from any other source) </li><li>  Process it: scale to the desired size, convert to float32 and result in a range [-1,1] </li><li>  Download the image to the device and request the inference </li><li>  Request a result (the program will be blocked until the result is received) </li><li>  Parse the result, select the object frames (about the format - below) </li><li>  Display image with predictions </li></ul><br></li><li>  Free all resources: delete the FIFO and the calculation graph, close the device and delete its descriptor </li></ul><br>  Almost for every action with NCS there is a separate function, and in C ++ it looks very cumbersome, and you have to carefully monitor the release of all resources.  In order not to load the code, I created <a href="https://github.com/BeloborodovDS/NCS-face/tree/master/wrapper">a wrapper class for working with NCS</a> .  In it, all the initialization work is hidden in the constructor and the <code>load_file</code> function, and in the release of resources, in the destructor, and working with NCS comes down to calling 2-3 class methods.  In addition, there is a convenient function to explain the errors that have occurred. <br><br>  Create a wrapper by passing the input size and output size (number of elements) to the constructor: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">NCSWrapper </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NCS</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(NETWORK_INPUT_SIZE*NETWORK_INPUT_SIZE*</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">3</span></span></span></span><span class="hljs-function"><span class="hljs-params">, NETWORK_OUTPUT_SIZE)</span></span></span></span>;</code> </pre><br>  We load the compiled file with a neural network, simultaneously initializing everything we need: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!NCS.load_file(<span class="hljs-string"><span class="hljs-string">"./models/face/graph_ssd"</span></span>)) { NCS.print_error_code(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br>  Let's convert the image to float32 ( <code>image</code> is <code>cv::Mat</code> in <code>CV_32FC3</code> format) and upload it to the device: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!NCS.load_tensor_nowait((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>*)image.data)) { NCS.print_error_code(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; }</code> </pre><br>  We get the result ( <code>result</code> - this is a free <code>float</code> pointer, the result buffer is supported by a wrapper);  until the end of the calculations, the program is blocked: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!NCS.get_result(result)) { NCS.print_error_code(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; }</code> </pre><br>  In fact, there is a method in the wrapper that allows you to load data and get the result simultaneously: <code>load_tensor((float*)image.data, result)</code> .  I refused to use it for a reason: using separate methods, you can slightly speed up the execution of the code.  After the image is loaded, the CPU will remain idle until the result of executing with NCS (in this case it is about 100 ms) comes, and at this time you can do some useful work: read the new frame and convert it, and display the previous detections. .  This is how the demo program is implemented, in my case it slightly increases the FPS.  You can go ahead and start image processing and face detection asynchronously in two different threads - it really works and allows you to speed up a bit more, but it is not implemented in the demo program. <br><br>  The detector returns a float array of size <code>7*(keep_top_k+1)</code> as a result.  Here, <code>keep_top_k</code> is the parameter specified in the <code>.prototxt</code> file of the model and indicating how many detections (in order of decreasing confidence) must be returned.  This parameter, as well as the parameter responsible for filtering detections by the minimum confidence value, and the parameters of non maximum suppression can be configured in the model‚Äôs <code>.prototxt</code> file in the most recent layer.  It should be noted that if Caffe returns as many detections as it was found in the image, then NCS always returns <code>keep_top_k</code> detections so that the size of the array is constant. <br><br>  The result array itself is organized as follows: if we treat it as a matrix with <code>keep_top_k+1</code> rows and 7 columns, then in the first row, in the first element there will be the number of detections, and starting with the second row, the detections themselves will be in the format <code>"garbage, class_index, class_probability, x_min, y_min, x_max, y_max"</code> .  The coordinates are in the range [0,1], so they will need to be multiplied by the height / width of the image.  In the remaining elements of the array will be garbage.  In this case, the maximum maximum suppression is performed automatically, even before the result is obtained (it seems, right on the NCS). <br><br><div class="spoiler">  <b class="spoiler_title">Parsing detector output</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_detection_boxes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">* predictions, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> w, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> h, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> thresh, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">vector</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;&amp; probs, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">vector</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;cv::Rect&gt;&amp; boxes)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> num = predictions[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> score = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cls = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">1</span></span>; i&lt;num+<span class="hljs-number"><span class="hljs-number">1</span></span>; i++) { score = predictions[i*<span class="hljs-number"><span class="hljs-number">7</span></span>+<span class="hljs-number"><span class="hljs-number">2</span></span>]; cls = predictions[i*<span class="hljs-number"><span class="hljs-number">7</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (score&gt;thresh &amp;&amp; cls&lt;=<span class="hljs-number"><span class="hljs-number">1</span></span>) { probs.push_back(score); boxes.push_back(Rect(predictions[i*<span class="hljs-number"><span class="hljs-number">7</span></span>+<span class="hljs-number"><span class="hljs-number">3</span></span>]*w, predictions[i*<span class="hljs-number"><span class="hljs-number">7</span></span>+<span class="hljs-number"><span class="hljs-number">4</span></span>]*h, (predictions[i*<span class="hljs-number"><span class="hljs-number">7</span></span>+<span class="hljs-number"><span class="hljs-number">5</span></span>]-predictions[i*<span class="hljs-number"><span class="hljs-number">7</span></span>+<span class="hljs-number"><span class="hljs-number">3</span></span>])*w, (predictions[i*<span class="hljs-number"><span class="hljs-number">7</span></span>+<span class="hljs-number"><span class="hljs-number">6</span></span>]-predictions[i*<span class="hljs-number"><span class="hljs-number">7</span></span>+<span class="hljs-number"><span class="hljs-number">4</span></span>])*h)); } } }</code> </pre><br></div></div><br><h2>  Startup features on the Raspberry Pi </h2><br>  The demo program itself can be run either on a regular computer or a laptop with Ubuntu, or on Raspberry Pi with Raspbian Stretch.  I use the Raspberry Pi 2 model B, but the demo should work on other models.  The project's makefile contains two targets for mode switching: <code>make switch_desk</code> for a computer / laptop and <code>make switch_rpi</code> for a Raspberry Pi.  The principal difference in the program code is only that in the first case, OpenCV is used to read data from the camera, and in the second case, the <a href="http://www.uco.es/investiga/grupos/ava/node/40">RaspiCam</a> library.  To run the demo on Raspberry you need to compile and install it. <br><br>  Now a very important point: installing NCSDK.  If you follow the standard installation instructions on the Raspberry Pi, it won't end well: the installer will try to pull in and compile SSD-Caffe and Tensorflow.  Instead, NCSDK must be <a href="https://movidius.github.io/blog/ncs-apps-on-rpi/">compiled in API-only mode</a> .  In this mode, only C ++ and Python API will be available (that is, it will not be possible to compile and profile neural network graphs).  This means that the graph of the neural network must first be compiled on a regular computer and then copied to Raspberry.  For convenience, I added two compiled files to the repository, for YOLO and for SSD. <br><br>  Another interesting point is the purely physical connection of the NCS to the Raspberry.  It would seem easy to connect it to a USB-connector, but you need to remember that its body will block the other three connectors (it is quite healthy, since it performs the function of a radiator).  The easiest way out is to connect it via a USB cable. <br><br>  It is also worth bearing in mind that the execution speed will differ for different USB versions (for this particular network: 102 ms for USB 3.0, 92 ms for USB 2.0). <br><br>  Now about the power of the NCS.  According to the documentation, it consumes up to 1 watt (with 5 volts on the USB connector it will be up to 200 ma; for comparison: the Raspberry camera consumes up to 250 ma).  When powered from a conventional 5 volt charger, 2 amps all work fine.  However, when you try to connect two or more NCS to the Raspberry, problems may arise.  In this case, it is recommended to use a USB splitter with external power supply. <br><br>  On Raspberry, the demo runs slower than on a computer / laptop: 7.2 FPS vs. 10.4 FPS.  This is due to several factors: first, it is impossible to get rid of computing on the CPU, and they are performed much slower;  secondly, the speed of data transmission affects (for USB 2.0). <br><br>  Also, for comparison, I tried to run a face detector from my first article on Raspberry YOLOv2, but it worked very badly: at a speed of 3.6 FPS, it misses a lot of faces even on simple frames.  Apparently, it is very sensitive to the parameters of the input image, the quality of which in the case of the Raspberry camera is far from ideal.  The SSD is much more stable, although I had to tweak the video parameters a bit in the RapiCam settings.  he, too, sometimes misses faces in the frame, but he does this quite rarely.  To increase stability in real applications, you can add a simple <a href="https://www.pyimagesearch.com/2018/07/23/simple-object-tracking-with-opencv/">centroid tracker</a> . <br><br>  By the way: the same can be reproduced in Python, there is a <a href="https://www.pyimagesearch.com/2018/02/19/real-time-object-detection-on-the-raspberry-pi-with-the-movidius-ncs/">tutorial on PyImageSearch</a> (used by Mobilenet-SSD for the object detection task). <br><br><h4>  Other ideas </h4><br>  I also tested a couple of ideas for accelerating the neural network itself: <br><br>  The first idea: you can leave only the detection of the layers <code>conv11</code> and <code>conv13</code> , and remove all the extra layers.  The result is a detector that detects only small faces and works a little faster.  Overall, not worth it. <br><br>  The second idea was interesting, but it did not work: I tried to discard convolutions with weights close to zero from the neural network, hoping that it would become faster.  However, such bundles turned out to be few, and their removal only slightly slowed down the neural network (the only guess is that this is due to the fact that the number of channels ceased to be a power of two). <br><br><h2>  Conclusion </h2><br>  I‚Äôve been thinking about finding faces on Raspberry for quite some time, as a subtask of my robotic project.  I did not like the classic detectors in terms of speed and quality, and I decided to try neural network methods, at the same time testing the Neural Compute Stick, as a result of which two projects appeared on GitHub and three articles on Habr√© (including the current one).  In general, the result suits me - most likely, I will use this detector in my robot (perhaps there will be another article about it).  It is worth noting that my decision may not be optimal - nevertheless, this is an educational project, made partly out of curiosity towards NCS.  Nevertheless, I hope that this article will be useful to someone. </div><p>Source: <a href="https://habr.com/ru/post/424973/">https://habr.com/ru/post/424973/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../424963/index.html">Zuckerberg Finance: Building Tools for Science Together</a></li>
<li><a href="../424965/index.html">Develop React applications using ReasonReact</a></li>
<li><a href="../424967/index.html">Closures in javascript for beginners</a></li>
<li><a href="../424969/index.html">Node.js Part 9 Guide: Working with the File System</a></li>
<li><a href="../424971/index.html">Habrokast "Sunset Manually" # 1. We are trying to set up an environment for developing toys under Windows</a></li>
<li><a href="../424975/index.html">SIEM depths: out-of-box correlations. Part 2. Data schema as a reflection of the ‚Äúworld‚Äù model</a></li>
<li><a href="../424977/index.html">Learning from mistakes: optimizing applications in the App Store and Google Play</a></li>
<li><a href="../424979/index.html">Elm. Comfortable and awkward. Http, Task</a></li>
<li><a href="../424981/index.html">Easter eggs-text RPG code in Google search engine</a></li>
<li><a href="../424985/index.html">In an important case law, the US secret services were unable to eavesdrop on calls in the messenger</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>