<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Network configuration in OpenWRT</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will talk about how to configure the network in OpenWRT. In particular, I will talk about how to make multiple SSIDs on one radio ca...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Network configuration in OpenWRT</h1><div class="post__text post__text-html js-mediator-article">  In this article I will talk about how to configure the network in OpenWRT.  In particular, I will talk about how to make multiple SSIDs on one radio card, configure WPA2-Enterprise, raise VLANs, and how to configure a software switch (swconfig). <br><a name="habracut"></a><br><h3>  UCI </h3><br>  All settings will be carried out through the console as it is not limited in capabilities, unlike the web interface.  OpenWRT uses the Unified Configuration Interface (UCI) subsystem for system settings, which allows you to centrally configure all kinds of services from the file system mount service to the QoS service.  All UCI settings are in the "/ etc / config /" directory and have the same syntax.  To control the UCI system, use the <b>uci</b> program.  Using it, you can edit configuration files, view current settings and more.  uci is very convenient to use to configure the system from scripts.  It is also possible to write extensions for uci.  The syntax of the configuration files is: <br><pre> config 'example' 'test'
         option 'string' 'some value'
         option 'boolean' '1'
         list 'collection' 'first item'
         list 'collection' 'second item'
</pre><br>  config 'example' 'test' is the beginning of the section, example is the type by which uci will understand how to interpret the options in this section, test is the section identifier.  option or list defines the type of settings, list - composite settings (for example, the list interface for listening to Apache).  string, boolean, collection - variable names. <br><br><h4>  Configuring Network Interfaces </h4><br>  Configuration file - / etc / config / network. <br>  In the simplest case, the network setup looks like this: <br><pre> config interface lan
         option ifname eth1
         option proto static
         option ipaddr 192.168.0.10
         option netmask 255.255.255.0
         option gateway 192.168.0.1
         option dns 192.168.0.1
</pre><br>  Where lan is the role of this interface.  It is necessary in order that it would be possible to abstract from the name of interfaces.  For example, you can specify in the firewall that allow all incoming traffic from the lan. <br>  An example of adding a static route: <br><pre> config route
         option interface lan
         option target 10.1.1.1
         option netmask 255.255.255.255
         option gateway 192.168.0.100
</pre><br>  I note that the interface must be specified. <br>  An example of configuring the vlan and adding it to the bridge: <br><pre> config interface guest
         option ifname "eth1.123"
         option type bridge
         option proto static
         option netmask 255.255.255.0
         option ipaddr 192.168.2.2
</pre><br>  Creates the ‚Äúbr-guest‚Äù interface and includes the eth1.123 interface (123 vlan-id on the eth1 interface).  Below is an example of how to add a wireless interface to this bridge. <br>  Since the chipsets used in routers usually have 1-2 ethernet ports, and I want more, we use a separate controller for ethernet.  It connects one port to the main chipset, and the rest out.  Directly in the network system, such a soft switch is not represented.  The switch can be configured via the <b>swconfig</b> utility or via uci.  Suppose we have one ethernet port eth0 connected to the 5th port of the managed switch: <br><pre> config 'switch' 'eth0'
    option 'enable' '1'
    option 'enable_vlan' '1'
    option 'reset' '1'

 config 'switch_vlan'
    option 'vlan' '0'
    option 'device' 'eth0'
    option 'ports' '0 1 2 5t'

 config 'switch_vlan'
    option 'vlan' '1'
    option 'device' 'eth0'
    option 'ports' '3 5t'

 config 'switch_vlan'
    option 'vlan' '124'
    option 'device' 'eth0'
    option 'ports' '6t 5t'
</pre><br>  Here eth0 is the name of the interface where the switch is connected.  In the first section we turn on the switch and turn on tagged (traffic with vlan) traffic.  Each switch_vlan section is responsible for a specific VLAN specified in the vlan option.  This tag will be used to add tags for the ports specified in the ports section.  The letter <b>t</b> at the port means that traffic to this port should be transmitted tagged (tagged), to the rest of the listed ports it will go without a tag.  Writing '0 1 2 5t' needs to be read like this: send untagged traffic from ports 0, 1, 2 to port 5 with a label 0. Since VLAN with a label 0 is the same as traffic without a label, we get traffic on our port eth0 from ports 0, 1, 2 without any vlan.  The following section says: ports = '3 5t', vlan = 1.  This means that untagged traffic from port 3 will come to eth0 with vlan-id = 1 (I do not recommend using vlan-id = 1).  In the last section, vlan = 124 is written, port = ‚Äú6t 5t‚Äù - this means that the traffic that came to port6 ‚Äã‚Äãwith the tag 124 comes to eth0 with the tag 124. <br>  In the network, you can configure connections such as PPTP, PPPoE and even 6to4. <br><br><h4>  Wi-fi setup: </h4><br>  The configuration file is here - / etc / config / wireless. <br>  Tuning radio interfaces is divided into two parts: phy level settings (physics) and interface settings.  The minimum settings are as follows: <br><pre> config 'wifi-device' 'radio0'
         option 'type' 'mac80211'
         option 'channel' '6'
 config 'wifi-iface'
         option 'device' 'radio0'
         option 'network' 'guest'
         option 'mode' 'ap'
         option 'ssid' 'guest'
         option 'encryption' 'none'
</pre><br>  In the first section, we indicated that the type of chipset / driver is mac80211 (determined when loading), the channel used is 6. Also, you can specify the standards used, the transmitter power, the antennas used, and so on.  In the second section we already describe the interface itself.  Interfaces can be several, for example with different SSID.  In the device option, you must specify the ID of the section with the description of the device, in this case radio0.  network = guest means that you need to attach this device to the guest interface used in the network.  Since we (see above) say in the network description that interface = guest is a bridge, this wireless interface should be added to the bridge br-guest. <br>  An example of setting up a multi-ssid with wpa2-enterprise + ccmp encryption: <br><pre> config 'wifi-iface'           
         option 'device' 'radio1'
         option 'network' 'wlan'
         option 'mode' 'ap'
         option 'ssid' 'super'
         option 'encryption' 'wpa2'
         option 'server' '192.168.0.11'
         option 'port' '1812'
         option 'key' 'secret'
                                                                        
 config 'wifi-iface'       
         option 'device' 'radio1'
         option 'network' 'wlan'   
         option 'mode' 'ap'              
         option 'ssid' 'puper'             
         option 'encryption' 'wpa2'                    
         option 'server' '192.168.0.11'                              
         option 'port' '1812'                                                
         option 'key' 'secret' 
</pre><br>  OpenWRT will create two interfaces with different ssid (super and puper) and will authorize them through the RADIUS server 192.168.0.11.  key is the RADIUS key.  You can usually pick up to 4 SSID, depending on the radio card.  I will also note that OpenWRT automatically creates devices like monitor for each wifi device, with which you can catch 802.11 headers. <br>  Related Links: <br>  <a href="http://wiki.openwrt.org/doc/uci">wiki.openwrt.org/doc/uci</a> <br>  <a href="http://wiki.openwrt.org/doc/uci/network">wiki.openwrt.org/doc/uci/network</a> <br>  <a href="http://wiki.openwrt.org/doc/uci/wireless">wiki.openwrt.org/doc/uci/wireless</a> <br>  <a href="http://wiki.openwrt.org/doc/uci/network/switch">wiki.openwrt.org/doc/uci/network/switch</a> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/128451/">https://habr.com/ru/post/128451/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128445/index.html">Mail.Ru Mail Support: Past, Present, Future</a></li>
<li><a href="../128446/index.html">The court forbade Anonymous to go online under the real name</a></li>
<li><a href="../128448/index.html">Kevin Turner, Microsoft COO, will speak at Tech ‚àô Ed Russia 2011</a></li>
<li><a href="../128449/index.html">Fix ACPI on Samsung N250</a></li>
<li><a href="../128450/index.html">The history of the online store, which has become a world monopolist for $ 5,000</a></li>
<li><a href="../128453/index.html">Google launched flight search</a></li>
<li><a href="../128454/index.html">Calculate the number of pi by the Monte Carlo method</a></li>
<li><a href="../128455/index.html">Windows 8 BSOD</a></li>
<li><a href="../128457/index.html">You need to know your tool in person: an overview of the most frequently used data structures</a></li>
<li><a href="../128458/index.html">Centos release 5.7 released</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>