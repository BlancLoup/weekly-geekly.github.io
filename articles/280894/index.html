<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Wi-Fi module WF121 and HTTP server in addition</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After reading the article [HOW-TO] Add HTML button press functionality to the application on the Silicon Labs website about using the built-in HTTP se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Wi-Fi module WF121 and HTTP server in addition</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/cdd/d36/3eb/cddd363eb3ad474a9f88d4af58a4f4f3.jpg"><br>  After reading the article <a href="http://community.silabs.com/t5/Wireless-Knowledge-Base/HOW-TO-Add-HTML-button-press-functionality-to-the-application/ta-p/147761">[HOW-TO] Add HTML button press functionality to the application</a> on the Silicon Labs website about using the built-in HTTP server of the WF121 Wi-Fi module, I wanted to try how it works.  Moreover, the debug board of the module was at hand. <br><br>  <i>* Useful links - at the end of the article.</i> <br><a name="habracut"></a><br>  I had a simple plan - to implement control of the lights (or rather, the LEDs of the debugging board) from the phone / tablet / PC via Wi-Fi via the WEB interface, using the capabilities of the built-in HTTP server of the WF121 module and the BGScript language. <br>  Of course, you can control the light bulb with just TCP commands, but this requires creating and installing a special application on your phone / tablet / PC, and this is not always convenient.  The advantage of the built-in HTTP server is that you can forget about installing the application and use any browser on any device.  Actually, therefore the HTTP server is implemented in WF121. <br><br><h2>  What is WF121? </h2><br>  <b>WF121</b> - Wi-Fi-module b / g / n 2.4 GHz for embedded systems, which can work both as a client and as an access point.  The features of the module include: <br><ul><li>  support for up to five clients in the access point mode; </li><li>  the ability to redirect traffic from one client to another in access point mode; </li><li>  in addition to UART, SPI, I2C, USB, GPIO, the presence of an RMII interface that allows you to connect to an Ethernet module; </li><li>  availability of a configurable HTTP server; </li><li>  the ability to flexibly manage all of this by loading into the module applications written in BGScript. </li></ul><br>  There are three options for controlling the WF121 module: <br><ol><li>  With the help of an external controller and BGAPI protocol; </li><li>  Using the BGScript application that loads into the module itself; </li><li>  Combined when using both BGAPI and BGScript at the same time. </li></ol><br>  The possibilities of BGAPI are of little interest to me now, since I am going to realize my plans using BGScript. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  What is BGScript? </h2><br>  <b>BGScript</b> is a simple scripting language ‚Äúinvented‚Äù by Bluegiga for its Bluetooth and Wi-Fi modules.  Using BGScript, a developer can write his own application and load it into a module, so that the module becomes a self-contained device and does not require external control.  After the unification of Bluegiga and SiLabs, the language continues to evolve and improve under the flag of Silicon Labs. <br>  When using BGScript, the developer describes the reaction of the system to the events occurring in it approximately as follows: <br><pre><code class="hljs pgsql">event system_boot(major,minor,patch,build,bootloader,tcpip,hw) #  ‚Äì     Wi-Fi- <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> sme_wifi_on() #  Wi-Fi <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> event sme_wifi_is_on(result) #  - Wi-Fi  <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> sme_connect_ssid(<span class="hljs-number"><span class="hljs-number">6</span></span>,"myWiFi") #     myWiFi <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  Those.  the module is turned on -&gt; we turn on Wi-Fi, <br>  Wi-Fi turned on -&gt; connect to the access point and so on. <br>  In addition to Wi-Fi control, from BGScript you can work with interfaces, timers, create TCP / UDP sockets (client / server), save important data in non-volatile memory, etc. If you want more details, I invite you to familiarize yourself with <i>BGScript for WF121 Developer Guide</i> (links - at the end of the article). <br>  When BGScript is ready, it is included in the WF121 project as a file with the .bgs extension. <br><br><h2>  What is a WF121 project? </h2><br>  <b>Project WF121</b> - a set of files that contain a description of the settings and the logic of the Wi-Fi-module WF121.  A list of project files is contained in the project.xml file.  In the case of the http_serv project, the project.xml file looks like this: <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scripting</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">in</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"main.bgs"</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">scripting</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">software</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">binary</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">in</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"fw/wifi_http_serv.juo"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">software</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">hardware</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">uart</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">channel</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">baud</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"5000000"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">api</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">handshake</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"True"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">sleep</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">interrupts</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"0x1"</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">hardware</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">files</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">file</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"404.html"</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">file</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"main.html"</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">file</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"ap.html"</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">file</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"appl.html"</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">file</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"client.html"</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">file</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"index.html"</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">file</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"logo.gif"</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">file</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"style.css"</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">files</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">project</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>  As you have already guessed, the name of the file containing BGScript is placed in the &lt;scripting&gt; tags. <br>  The wifi_http_serv.juo file is not available for configuration and will not be considered here. <br>  The &lt;hardware&gt; tags of the project.xml file describe the configuration of the external interfaces of the module, in general - UART, SPI, I2C, Ethernet, ADC, GPIO.  In this case, an example of UART configuration is shown - this configuration will be useful to preserve the possibility of flashing the module using the <i>Bluegiga WiFi GUI</i> program.  Alternatively, the interface description can be moved to a separate file.  A detailed description of how to configure the WF121 interfaces is provided in the <i>WF121 Configuration Guide</i> . <br>  The &lt;image&gt; tag contains the names of the firmware files that we get after compilation and will be loaded into the module.  You can generate files in two formats: dfu and hex.  We are now more interested in the dfu format, which is used by the <i>Bluegiga WiFi GUI</i> program. <br>  Finally, the &lt;files&gt; tag contains descriptions of files related to our HTTP server. <br><br>  If details are interesting, welcome to the <i>WF121 Configuration Guide</i> (see links at the end of the article). <br><br><h2>  Modify the source project to turn lights on and off from the browser. </h2><br>  To control light bulbs (LEDs) from the browser of your favorite smartphone or tablet, we need: <br><ul><li>  include in the project a web page with buttons; </li><li>  describe with the help of BGScript the response of the Wi-Fi module to pressing individual buttons; </li><li>  Do not forget in the BGScript file to configure the pins of the module to which our LEDs are connected. </li></ul><br>  There are examples of creating buttons and configuring outputs in the original project, we just have to add event handling for pressing WEB buttons.  A total of 4 LEDs are installed on the DKWF121 debug board, which can be controlled: RD4, RD5, RD6 and RD7.  Since the RD6 and RD7 LEDs are used in this example to indicate the status of the module, we use the RD4 and RD5 LEDs to simulate light bulbs.  We will make minimal changes to adapt the project to our needs: <br><br>  1. The HTTP server of the original example contains several pages and many unnecessary buttons for us ‚Äî all this can be carefully removed and only two pairs of buttons left to control the LEDs (see the project‚Äôs appl.html file): <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/button.cgi"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"get"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"On 1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn_body"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"On 2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn_body"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Off 1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn_body"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Off 2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn_body"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  2. When the button is pressed on the WEB-page in the module, the event https_button (number) is generated.  The reaction to this event will be described in the main.bgs file as follows: <br><pre> <code class="hljs pgsql">event https_button(number) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> number = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> hardware_io_port_write(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-meta"><span class="hljs-meta">$0010</span></span>, <span class="hljs-meta"><span class="hljs-meta">$0010</span></span>) #   <span class="hljs-number"><span class="hljs-number">1</span></span> ‚Äì  RD4 <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> number = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> hardware_io_port_write(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-meta"><span class="hljs-meta">$0020</span></span>, <span class="hljs-meta"><span class="hljs-meta">$0020</span></span>) #   <span class="hljs-number"><span class="hljs-number">2</span></span> ‚Äì  RD5 <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> number = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> hardware_io_port_write(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-meta"><span class="hljs-meta">$0010</span></span>, <span class="hljs-meta"><span class="hljs-meta">$0000</span></span>) #   <span class="hljs-number"><span class="hljs-number">3</span></span> ‚Äì  RD4 <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> number = <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> hardware_io_port_write(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-meta"><span class="hljs-meta">$0020</span></span>, <span class="hljs-meta"><span class="hljs-meta">$0000</span></span>) #   <span class="hljs-number"><span class="hljs-number">4</span></span> ‚Äì  RD5 <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  3. Configure the pins to which the RD4 and RD5 LEDs are connected: <br><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">event</span></span> system_boot(major, minor, patch, build, bootloader_version, tcpip_version, hw) ... ... call hardware_io_port_config_direction(<span class="hljs-number"><span class="hljs-number">3</span></span>, $0020, $0000) #  RD4   call hardware_io_port_write(<span class="hljs-number"><span class="hljs-number">3</span></span>, $0020, $0000) #  RD4  <span class="hljs-number"><span class="hljs-number">0</span></span>    call hardware_io_port_config_direction(<span class="hljs-number"><span class="hljs-number">3</span></span>, $0010, $0000) #  RD5   call hardware_io_port_write(<span class="hljs-number"><span class="hljs-number">3</span></span>, $0010, $0000) #  RD5  <span class="hljs-number"><span class="hljs-number">0</span></span>    ... end ...</code> </pre><br>  Of course, the changes made are minimally necessary, and for the normal operation of the module, further BGScript combing and beauty guidance in other project files is required. <br>  I note that I assigned different buttons to turn on and off the LEDs, since during the testing it turned out that when using Mozilla Firefox or IE and pressing the WEB button in the module, one event https_button (number) is generated, and when using Chrome - as many as two!  Therefore, when using Chrome and the combined on / off button, the light turns on and then turns off, causing testers displeasure.  As a result, I preferred to make separate buttons ‚ÄúOn‚Äù and ‚ÄúOff‚Äù to turn on and off the LEDs, respectively.  All this applies to the SDK 1.2.4-73. <br>  When the project is ready, it remains only to generate the firmware file and load it into the module. <br><br><h2>  Compile the project and load the resulting code in WF121 </h2><br>  To quickly compile the firmware and download them into the module, the <i>Bluegiga WiFi GUI</i> program is designed.  It is also convenient to use for quick configuration / testing of the module, as well as BGAPI research.  The program works only under 64-bit OS, when launched on 32-bit OS it says that 64 bits are needed.  It is believed that this restriction can be circumvented, but I have not tried it, I don‚Äôt know the details, and I will not lie.  The <i>Bluegiga WiFi GUI</i> program, along with <i>sample</i> applications, is included with the SDK. <br><br>  In general, the algorithm of actions when compiling a project and loading it into the module is as follows: <br><ul><li>  install on the PC SDK WF121; </li><li>  launch the <i>Bluegiga WiFi GUI</i> ; </li><li>  select the port, speed and click "Connect"; </li><li>  go to the tab ‚ÄúFirmware upgrade‚Äù; </li><li>  select the project with the ‚ÄúOpen project‚Äù button; </li><li>  compile it with the ‚ÄúBuild‚Äù button; </li><li>  click "Boot into DFU mode" to put the module in programming mode; </li><li>  and load our firmware with the ‚ÄúUpload‚Äù button. </li></ul><br>  After the project is loaded into the module, you can connect your phone, tablet, etc. to the Wi-Fi Bluegiga access point, launch the browser, go to the page at 192.168.1.1, then press the buttons and watch the LEDs react.  The screen of the smartphone at the same time turned out like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/7f6/963/d2f/7f6963d2f07844faa681813b2f030933.JPG"></div><br>  Documentation on WF121, SDK, the project can be downloaded on the site <a href="http://wless.ru/technology/%3Faction%3Ddetails%26id%3D600%26pf%3Dtech%26pf_id%3D7%26prod%3D24%26tech%3D7%26type%3D20">wless.ru</a> <br><br>  Please note that now there are two current versions of the SDK: 1.2.4-73 and 1.3.0-85, and they are not completely compatible with each other.  In this case, it is assumed that you are using this example with version 1.2.4-73, otherwise it will not work. <br><br>  All success and good mood! <br><br><hr><br>  <a href="http://wless.ru/technology/%3Faction%3Ddetails%26id%3D600%26pf%3Dtech%26pf_id%3D7%26prod%3D24%26tech%3D7%26type%3D20">WF121 on wless.ru</a> <br>  <a href="http://wless.ru/files/WiFi/Bluegiga/WF121/BGScript_for_WF121_Developer_Guide_v19.pdf">BGScript for WF121 Developer Guide</a> <br>  <a href="http://wless.ru/files/WiFi/Bluegiga/WF121/WF121_Configuration_Guide_v22.pdf">WF121 Configuration Guide</a> <br>  <a href="http://wless.ru/files/WiFi/Bluegiga/WF121/WF121_Datasheet.pdf">WF121 Datasheet</a> <br>  <a href="http://wless.ru/files/WiFi/Bluegiga/WF121/DKWF121_v131_Datasheet.pdf">DKWF121 Datasheet</a> <br>  <a href="">SDK 1.2.4-73</a> <br>  <a href="http://wless.ru/files/WiFi/Bluegiga/WF121/">Draft http_serv as amended</a> <br>  <a href="https://www.bluegiga.com/en-US/products/wf121-wifi-module/">WF121 on the Bluegiga website (registration required)</a> <br>  <a href="http://community.silabs.com/t5/forums/filteredbylabelpage/board-id/4/label-name/wifi">Community SiLabs Wi-Fi</a> </div><p>Source: <a href="https://habr.com/ru/post/280894/">https://habr.com/ru/post/280894/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../280884/index.html">4.04</a></li>
<li><a href="../280886/index.html">GSM-traps: another hello from Big Brother</a></li>
<li><a href="../280888/index.html">Overview of Local Binary Patterns (LBP) Image Descriptors and Their Variations</a></li>
<li><a href="../280890/index.html">Coding Dojo meeting in Artec 3D</a></li>
<li><a href="../280892/index.html">How we scored on asynchrony when hiking on backends</a></li>
<li><a href="../280896/index.html">Personal data of 50 million Turkish citizens leaked to the network</a></li>
<li><a href="../280898/index.html">Debugging Office Add-ins on iOS (iPad)</a></li>
<li><a href="../280900/index.html">RUVDS introduces new Huawei FusionSphere OpenStack virtualization systems</a></li>
<li><a href="../280902/index.html">Rust and Swift (third, fourth, fifth and sixth parts)</a></li>
<li><a href="../280904/index.html">man! (C => D => Rust)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>