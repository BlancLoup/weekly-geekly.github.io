<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Delving deep into Graphics2D</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, Habrazhiteli! 

 Today, I will again try to draw your attention to some aspects and subtleties of working with graphics in Java. I hav...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Delving deep into Graphics2D</h1><div class="post__text post__text-html js-mediator-article">  <strong>Good afternoon, Habrazhiteli!</strong> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/38f/b56/f38/38fb56f382cd3e4030a1c56fd50780f6.png" align="right">  Today, I will again try to draw your attention to some aspects and subtleties of working with graphics in Java.  I have already briefly described in the <a href="http://habrahabr.ru/blogs/java/117430/">previous article</a> some of the available tools and methods for creating components and UI, but this is only the tip of the iceberg.  That is why I want to pay special attention (and the article) to working with graphics.  Naturally referring to Graphics2D - Java 3D is a large separate topic (maybe it will be discussed further in the future, but not today). <br><br>  So, from the previous article you should already know some basics of building components - we will try to expand this knowledge. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To begin with, if you consider any component from the <a href="http://lib.juga.ru/article/articleview/163/1/68/">MVC</a> point of view, it consists of 3 parts: <br>  <strong>Model</strong> - a model that stores data on the state of a component and on the basis of which the appearance is built <br>  <strong>View</strong> - directly visual display of the component <br>  <strong>Controller</strong> - responsible for controlling the component (events from the keyboard, mouse, and other input devices) <br><br>  In fact, all standard Swing components are built on the MVC pattern.  For example, in JButton, ButtonModel is responsible for the behavior and state of the button (Controller and Model), and ButtonUI, in turn, for its external representation (View).  As a result, the share of the JButton class itself is practically nothing left.  It will be mostly about the implementation of the external representation of the components (View), and if you specify - about Graphics2D, on the basis of which, in fact, the entire interface is drawn. <br><br>  <i>I will not argue that there is a lot of different material on this topic, but it is so fragmented and scattered across the expanses of the network that it seems to me that it is not superfluous to collect everything in one place and consistently state.</i> <br><br><a name="habracut"></a><br><h1>  Meet on clothes </h1>  No matter what anyone says, the interface has always played, plays and will play an important role in the success of any application.  Depending on the audience of the application, the role of the interface may be secondary or, on the contrary, paramount and most important.  For example, in the case of games or various editors, the interface and usability decide everything (in part because these are applications that you use often enough or for a long time). <br><br>  So, today we will analyze the standard tools provided by Graphics2D, as well as some techniques and tricks for rendering components of any complexity. <br><br>  <i>It is clear that without sensible ideas, no means will help to do anything, but here I, alas, is powerless.</i>  <i>Probably the designer / UX-specialist will be able to help you with this if everything is really bad with fantasy.</i>  <i>Honestly, it is rather difficult to ‚Äúsqueeze out‚Äù what a new component will look like.</i>  <i>It happens that it is even more complicated and takes more time than directly writing working code and debugging it.</i> <br><br>  In any case, let's get down to business ... <br><br><h1>  Small table of contents </h1><ol><li>  Figures </li><li>  Rendering hints </li><li>  Fill </li><li>  Combination when drawing </li><li>  Stroke </li><li>  Shadows </li><li>  Correct clipping </li><li>  Animation </li><li>  Few tricks </li><li>  WebLookAndFeel </li><li>  Finally... </li><li>  Resources </li></ol><br><h1>  Figures </h1>  Without figures - nowhere.  For any component, any simplest thing, you need to draw the outlines of the parts.  Doing it manually pixel by pixel is not a pleasant task.  Especially if you need to add anti-aliasing to drawing or any other effects.  Thank God you don‚Äôt need to do it manually - all the standard shapes (Line2D, Rectangle2D, RoundRectangle2D, Ellipse2D, Arc2D, etc.) that you may need to draw are already implemented - all that remains is to specify their coordinates and sizes for drawing in a certain place. <br><br>  In addition to standard shapes, there are also specific ones (such as the GeneralPath) that allow you to quickly create your own shapes. <br><br>  There are also some individual projects that have various specific forms: <br>  <a href="http://java-sl.com/shapes.html">http://java-sl.com/shapes.html</a> <br>  <a href="http://geosoft.no/graphics/">http://geosoft.no/graphics/</a> <br>  <a href="http://designervista.com/shapes/index.php">http://designervista.com/shapes/index.php</a> <br>  <a href="http://www.jfree.org/jcommon/">http://www.jfree.org/jcommon/</a> <br><br>  There is no point in describing each individual figure ‚Äî you can read about it in detail <a href="http://java.sun.com/developer/technicalArticles/GUI/java2d/java2dpart1.html">here</a> or <a href="http://www.datadisk.co.uk/html_docs/java/graphics_java2d.htm">here</a> (there are also examples of use in both descriptions). <br><br>  I would just like to clarify here a little bit about how the figure is drawn and what influences the final result.  Suppose you have a certain shape (shape shape): <br><ul><li>  You can use 2 different methods - g2d.fill (shape) and g2d.draw (shape).  Fill - Fills all pixels inside the shape, draw - draws the outline of the shape. </li><li>  The installed inheritor of the Paint class (g2d.setPaint (Paint)) is responsible for the color or colors in which the drawing takes place - it provides the paint color for every single pixel of the area.  The simplest version of this mode is any color (Color) - it simply returns the same color for each pixel.  More complex examples are, for example, gradient and texture fills (GradientPaint, TexturePaint, etc.). </li><li>  The thickness, frequency (or dash) and the type of merge at the corners and edges of the border of the drawn outline of the shape are affected by the set Stroke (g2d.setStroke (Stroke)). </li><li>  The smoothing, rendering quality of shapes and text, as well as other aspects are affected by various parameters given in the chapter below. </li></ul><br><br><h1>  Rendering hints </h1>  Anti-aliasing is included in the set of standard tools that come bundled with Graphics2D: <br>  g2d.setRenderingHint (RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON); <br>  This is enough to enable smoothing of all the figures drawn in the future. <br>  The main thing to remember is to turn off anti-aliasing after your operations, if you don‚Äôt want everything that is rendered after, to also use anti-aliasing - for example, if you implement your button background drawing and don‚Äôt want to cause anti-aliasing of the default text. <br><br>  The value of this parameter (RenderingHints.KEY_ANTIALIASING) also affects the smoothing of the text, if it has the default selection. <br>  It is possible to separately enable / disable the need for text smoothing: <br>  g2d.setRenderingHint (RenderingHints.KEY_TEXT_ANTIALIASING, RenderingHints.VALUE_TEXT_ANTIALIAS_ON); <br>  When setting this parameter to any other than VALUE_TEXT_ANTIALIAS_DEFAULT, it will ignore the RenderingHints.KEY_ANTIALIASING value. <br><br>  Here is a small and simple example showing the differences between drawing with and without anti-aliasing: <br><img src="https://habrastorage.org/getpro/habr/post_images/4b4/465/9b9/4b44659b973f0333aa3d1208e44e6196.png"><br>  (Example and source code can be downloaded <a href="">here</a> ) <br><br>  If you look closely - you can also notice many other available settings in RenderingHints: <br>  KEY_ANTIALIASING - setting smoothing shapes (and text) <br>  KEY_RENDERING - setting quality / speed of rendering <br>  KEY_DITHERING - mixing colors with limited palette <br>  KEY_TEXT_ANTIALIASING - text smoothing setting <br>  KEY_TEXT_LCD_CONTRAST - text contrast (from 100 to 250) when drawing using special text smoothing <br>  KEY_FRACTIONALMETRICS - setting the "accuracy" of drawing text characters <br>  KEY_INTERPOLATION - setting that is responsible for modifying the pixels of the images when drawing (for example, when you rotate the image) <br>  KEY_ALPHA_INTERPOLATION - setting the quality / speed of processing alpha values <br>  KEY_COLOR_RENDERING - set the quality / speed of color processing <br>  KEY_STROKE_CONTROL - setting the ability to modify the geometry of the figures to improve the final view <br><br>  Most of these settings usually remain in the ‚Äúdefault‚Äù state.  However, they can be very useful in some specific cases. <br>  For example, if you set KEY_INTERPOLATION to VALUE_INTERPOLATION_BILINEAR, you can avoid loss of image quality when modifying it (rotating / compressing / shifting, etc.) or improving the contrast of text on your background by changing KEY_TEXT_LCD_CONTRAST without affecting the text rendering code. <br><br>  In any case, you should carefully use these settings and avoid their ‚Äúgoing beyond‚Äù your drawing method, because, for example, the same antialiasing included in the JTextField will smooth the text and modify it (and probably shift). <br><br><h1>  Fill </h1>  There are several available heirs to the Paint class that allow you to paint / fill the shapes in different ways: <br><ul><li>  <strong>Color</strong> - the easiest, allows you to draw or fill a shape with one color. </li><li>  <strong>TexturePaint</strong> - allows you to use the existing BufferedImage for filling / drawing as a background image. </li><li>  <strong>GradientPaint</strong> is a simple linear gradient from one point to another with starting and ending colors. </li><li>  <strong>LinearGradientPaint</strong> - a more complex linear gradient from one point to another with any number of intermediate colors with redefinable distances between them. </li><li>  <strong>RadialGradientPaint</strong> - circular gradient with indication of the center of the circle and radius, as well as colors and distances between them, similarly to LinearGradientPaint. </li></ul><br><br>  For clarity, a small example using 3 different gradients to fill three equal parts on a component: <br><img src="https://habrastorage.org/getpro/habr/post_images/c5a/80c/bcb/c5a80cbcb14d137f4560f8852618d974.png"><br>  (Example and source code can be downloaded <a href="">here</a> ) <br><br>  <i>By the way, probably not everyone knows that in any fillings / drawings, when specifying a color, you can also indicate its transparency (alpha).</i> <i><br></i>  <i>For example, new Color (255, 255, 255, 128) is a white color that is transparent to 50%.</i>  <i>Alpha in this case is 128. It can vary from 0 to 255. 0 is a completely transparent color, 255 is completely opaque (used by default).</i> <br><br><h1>  Combination when drawing </h1>  So, we are systematically moving on to more complicated things ... <br>  Combining (in other words, Composite) allows you to specify various ‚Äúmodes‚Äù of combining new drawing shapes / images with pixels already present on the canvas. <br><br>  I was able to find the most successful illustrations for different ‚Äúmodes‚Äù of combining, as well as an example of their real influence on the figures drawn <a href="http://download.oracle.com/javase/tutorial/2d/advanced/compositing.html">here</a> .  There is also a detailed description of each of the "modes". <br><br>  In practice, personally, I most often use the AlphaComposite.SRC_OVER variant and the transparency indication to draw further elements in a certain transparency over the things already drawn.  There are also quite interesting examples of the use of certain modes when working with images, but more on that later. <br><br>  In addition to Composite, it is also possible to create your own forms using standard and combining them with various geometric operations.  A small example on this topic: <br><img src="https://habrastorage.org/getpro/habr/post_images/512/9ac/0da/5129ac0da7d6eb75ebd526387c3b84af.png"><br>  (Example and source code can be downloaded <a href="">here</a> ) <br><br>  To create this shape, it took only 2 lines: <br><blockquote><code><font color="black">Area area = <font color="#0000ff">new</font> Area ( <font color="#0000ff">new</font> Ellipse2D.Double ( 0, 0, 75, 75 ) ); <br> area.add ( <font color="#0000ff">new</font> Area ( <font color="#0000ff">new</font> Ellipse2D.Double ( 0, 50, 75, 75 ) ) );</font></code> </blockquote> <br>  What is most interesting is that the border of the new figure does not include the internal parts of the borders of the ellipses (those that fall inside the opposite of the ellipse). <br><br>  In general, the Area can be used for many different things: it can not only add new shapes to existing shapes, but also create an intersection area or exclude certain shapes from others, it is possible to learn from it the common boundaries of the shape (bounds).  Also with its help, you can quickly and easily create complex shapes from any other simple shapes available. <br><br>  <i>If you need a specific shape that you use often enough, it is probably best to create a heir to the Shape class and implement the necessary shape in it.</i>  <i>In the future, this will reduce both time costs and the size of the code itself.</i> <br><br><h1>  Stroke </h1>  ... or as suggested by <a href="https://habrahabr.ru/users/theshock/" class="user_link">TheShock</a> " <a href="https://habrahabr.ru/users/theshock/" class="user_link">Stroke</a> ." <br><br>  In fact, Stroke provides the ability to set the border style drawn by any call to the draw method of the graphic. <br>  In the standard JDK, there is only 1 implementation of the Stroke interface - BasicStroke.  It allows you to set the width of the line, how the lines at the corners are combined and how they look on the kots, and also to create dashed lines. <br><br>  To set Stroke in code, do the following: <br><blockquote> <code><font color="black">g2d.setStroke ( <font color="#0000ff">new</font> BasicStroke ( 2f ) );</font></code> </blockquote>  This example will force all subsequent borders to be drawn 2 pixels wide. <br>  By the way, do not worry that the width and some other parameters can be set to float (although the pixels should be integers) - non-integer numbers will only create ‚Äúsmeared‚Äù lines / outlines when drawing, which in some cases may even be useful. <br><br>  More information about the features of BasicStroke can be found, for example, <a href="http://www.projava.net/Glava9/Index13.htm">here</a> . <br><br>  Although the JDK includes only one implementation of Stroke, there are other projects and examples describing the real possibilities of this tool, but more on that later. <br><br><h1>  Shadows </h1>  There is no standard implementation of shadows in Java2D, but there are many ways to achieve the ‚Äúeffect‚Äù of the shadow ‚Äî I will tell you about them in this chapter. <br>  Perhaps we start with the most simple options ... <br><br>  <strong>The shadow obtained by a slight shift / modification of the original figure</strong> <br><img src="https://habrastorage.org/getpro/habr/post_images/938/9ab/037/9389ab03721e78bc6b53ba6fc207fcff.png"><img src="https://habrastorage.org/getpro/habr/post_images/e8f/503/fe9/e8f503fe91d79456c3ca4ca399c95c26.png"><br>  In the second image - a narrower and tidy version of this type of shadow. <br>  (Example and source code can be downloaded <a href="">here</a> ) <br><br>  The shadow obtained in this way is applicable only if it extends no more than 1-3 pixels beyond the edge of the original figure, otherwise it starts to seem unnatural.  Also, this method requires a rather cumbersome code - for any individual shape you will have to repeatedly check and pick up a shadow. <br><br>  <strong>Iterative shadow</strong> <br>  The shadow obtained by repeatedly drawing a modified shape.  At the same time, in each subsequent iteration, the size of the figure increases (as one of the options) and the transparency decreases (or the color changes). <br><img src="https://habrastorage.org/getpro/habr/post_images/d88/574/afc/d88574afc22d397d41092b823733f2ad.png"><br>  (Example and source code can be downloaded <a href="">here</a> ) <br><br>  This option is good because it does not limit you in the size of the shadow, but at the same time it is even more cumbersome and even more difficult to modify.  Also, it is the most sub-optimal of all options in terms of drawing speed. <br><br>  <strong>Gradient shadow</strong> <br>  This option is based on the use of gradient fills around the edges of the figure. <br>  In fact, we have 8 parts at the edges in the case of a rectangle in which a fill is required: <br><img src="https://habrastorage.org/getpro/habr/post_images/042/7da/243/0427da24396f074c523b8f7ea0632f11.png"><br>  In 4 cases - LinearGradientPaint, in other 4 cases - RadialGradientPaint.  The result is such a neat shadow: <br><img src="https://habrastorage.org/getpro/habr/post_images/614/376/ae6/614376ae6e29ddabb6ec0956a4bb91e6.png"><br>  (Example and source code can be downloaded <a href="">here</a> ) <br><br>  You can also vary the location of the gradient and get other interesting options, such as this: <br><img src="https://habrastorage.org/getpro/habr/post_images/636/012/b58/636012b58b5856ddb2cc229462032356.png"><br>  (Example and source code can be downloaded <a href="">here</a> ) <br><br>  The advantage of this option is the speed and quality of rendering the shadow.  However, the size of the code again suffers, as can be seen from the example. <br><br>  <strong>Shadow obtained by modifying Stroke when drawing</strong> <br>  To be more precise - the shape is drawn several times in a loop with variable color / transparency and Stroke, which allows you to create a semblance of a shadow: <br><img src="https://habrastorage.org/getpro/habr/post_images/961/14e/98a/96114e98a49486a76154f7455766d42a.png"><br>  (Example and source code can be downloaded <a href="">here</a> ) <br><br>  Since the shape of the shape does not affect the rendering of the shadow at all, this technique can be used for any, even the most cunning shapes: <br><img src="https://habrastorage.org/getpro/habr/post_images/fdd/e90/1e0/fdde901e09825d4ec24bee0862dbe75d.png"><br>  (Example and source code can be downloaded <a href="">here</a> ) <br><br>  You can also easily render the shadow rendering itself into a separate independent method: <br><blockquote> <code><font color="black"><font color="#0000ff">private</font> <font color="#0000ff">void</font> drawShade ( Graphics2D g2d, RoundRectangle2D rr, Color shadeColor, <font color="#0000ff">int</font> width ) <br> { <br> Composite comp = g2d.getComposite (); <br> Stroke old = g2d.getStroke (); <br> width = width * 2; <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = width; i &gt;= 2; i -= 2 ) <br> { <br> <font color="#0000ff">float</font> opacity = ( <font color="#0000ff">float</font> ) ( width - i ) / ( width - 1 ); <br> g2d.setColor ( shadeColor ); <br> g2d.setComposite ( AlphaComposite.getInstance ( AlphaComposite.SRC_OVER, opacity ) ); <br> g2d.setStroke ( <font color="#0000ff">new</font> BasicStroke ( i ) ); <br> g2d.draw ( rr ); <br> } <br> g2d.setStroke ( old ); <br> g2d.setComposite ( comp ); <br> }</font></code> </blockquote> <br>  <strong>Shadow image</strong> <br>  For images, we will not be able to get a shape for drawing a shadow in any previous ways, if it is not just rectangular, but for example round or completely amorphous.  To create a shadow in this case, we will approach it a bit from the other side - with the help of AlphaComposite we will create a monochrome copy of the original image and use it as a shadow: <br><img src="https://habrastorage.org/getpro/habr/post_images/6b3/044/247/6b30442472b7e4afd97699d09ee8d397.png"><br>  (Example and source code can be downloaded <a href="">here</a> ) <br><br>  Of course, in some cases, such a shadow would be suitable, but still, I would like to get more smoothed / gradient edges near the shadow itself.  Filtering will help us with this problem.  To be more precise, we use a special filter on the resulting ‚Äúshadow‚Äù of the image for its more realistic look: <br><img src="https://habrastorage.org/getpro/habr/post_images/c33/ca0/f2a/c33ca0f2aa90d8554d3d0fbdca4392ee.png"><br>  (Example and source code can be downloaded <a href="">here</a> ) <br><br>  Frankly, for this example, I took the finished version of the filter given <a href="http://www.jhlabs.com/ip/blurring.html">here</a> .  But even without additional funds, you can ‚Äúblock‚Äù the shadow obtained in the first example rather quickly and easily and place it under the image. <br><br>  <i>By the way, this shadow can also be used for shapes, if you first apply them to a separate image, on the basis of which the filter will work.</i>  <i>This can be quite applicable, for example, if the figure (s) do not change dynamically when the application is executed - it is enough to ‚Äúshoot‚Äù it once and use the resulting image when drawing.</i>  <i>But personally, I don‚Äôt really like this option due to its resource cost, so I excluded it from the list.</i> <br><br><h1>  Correct clipping </h1>  I would like to tell you about one more important aspect that is necessary when working with graphics and creating ‚Äúcorrect‚Äù components - working with a clip, or cutting off unwanted parts when drawing. <br><br>  To use this tool, it is enough to set the form according to which ‚Äúclipping‚Äù will occur: <br><blockquote> <code><font color="black">g.setClip ( x, y, width, height ); <br> g.setClip ( <font color="#0000ff">new</font> Rectangle ( x, y, width, height ) ); <br> g.setClip ( <font color="#0000ff">new</font> Rectangle2D.Double ( x, y, width, height ) );</font></code> </blockquote>  All three of these methods will lead to the establishment of the same rectangular clipping region. <br><br>  There are many cases where this tool can be useful. <br>  First of all, when drawing any component, a certain cut-off form is always pre-installed (usually it is a rectangle (bounds) of the component) - it does not allow the component to ‚Äúcrawl out‚Äù beyond its borders.  It must be taken into account when setting its specific clipping region.  Simply enough, you can do it like this: <br><blockquote> <code><font color="black">Shape oldClip = g.getClip (); <br> Shape newClip = <font color="#0000ff">new</font> Rectangle ( x, y, width, height ); <br> Area clip = <font color="#0000ff">new</font> Area ( oldClip ); <br> clip.intersect ( <font color="#0000ff">new</font> Area ( newClip ) ); <br> g.setClip ( clip );</font></code> </blockquote>  In fact, you combine the existing clipping region with a new one.  Thus, you will not lose the restriction in the form of the component boundaries, but also add a new one that you need. <br><br>  If you go back to the chapter on creating shadows, and to be more precise to point 4, you can improve it by cutting off a part of the shadow: <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> drawShade ( Graphics2D g2d, Shape shape, Color shadeColor, <font color="#0000ff">int</font> width, <br> Shape clip, boolean round ) <br> { <br> Shape oldClip = g2d.getClip (); <br> <font color="#0000ff">if</font> ( clip != <font color="#0000ff">null</font> ) <br> { <br> Area finalClip = <font color="#0000ff">new</font> Area ( clip ); <br> finalClip.intersect ( <font color="#0000ff">new</font> Area ( oldClip ) ); <br> g2d.setClip ( finalClip ); <br> } <br> <br> Composite comp = g2d.getComposite (); <br> <font color="#0000ff">float</font> currentComposite = 1f; <br> <font color="#0000ff">if</font> ( comp instanceof AlphaComposite ) <br> { <br> currentComposite = ( ( AlphaComposite ) comp ).getAlpha (); <br> } <br> <br> Stroke old = g2d.getStroke (); <br> width = width * 2; <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = width; i &gt;= 2; i -= 2 ) <br> { <br> <font color="#0000ff">float</font> opacity = ( <font color="#0000ff">float</font> ) ( width - i ) / ( width - 1 ); <br> g2d.setColor ( shadeColor ); <br> g2d.setComposite ( AlphaComposite <br> .getInstance ( AlphaComposite.SRC_OVER, opacity * currentComposite ) ); <br> g2d.setStroke ( <br> <font color="#0000ff">new</font> BasicStroke ( i, round ? BasicStroke.CAP_ROUND : BasicStroke.CAP_BUTT, <br> BasicStroke.JOIN_ROUND ) ); <br> g2d.draw ( shape ); <br> } <br> g2d.setStroke ( old ); <br> g2d.setComposite ( comp ); <br> <br> <font color="#0000ff">if</font> ( clip != <font color="#0000ff">null</font> ) <br> { <br> g2d.setClip ( oldClip ); <br> } <br> }</font></code> </blockquote> <br>  Thus, it becomes possible to additionally transfer the desired clipping region to this method ‚Äî the method itself will do the rest. <br><br>  <i>As some of the tests performed show, cropping non-rendered parts (for example, what goes beyond the screen) does not give any significant increase in the speed of work.</i>  <i>However, this is understandable, because all calculations of the ‚Äúwhat, where and how to draw‚Äù type and the drawing itself still work, even if the clip is set to 1 ‚Äúavailable‚Äù pixel.</i>  <i>So "manual" optimization will be much more useful in this case.</i> <i><br><br></i>  <i>Clip is mostly created for the convenience of drawing complex parts and correctly limiting borders, so that neighboring components do not overlap each other.</i> <br><br><h1>  Animation </h1>  So, it's time to combine some of the knowledge gained and do something more interesting. <br><br>  By itself, the animation is fairly simple to understand and represents only the change in the drawn objects over time.  But in practice there are much more questions and problems. <br><br>  Depending on the type of animation, you may need a lot of additional code that is responsible for the ‚Äúdevelopment of events‚Äù and reflects the changes.  It is also important not to forget about optimization when redrawing - that is, it is desirable to redraw only those areas of the animated component in which changes have occurred.  To do this, simply call the method repaint (new Rectangle (x, y, width, height)). <br><br>  Consider a small example of the implementation of animation - we will create an effect of the flare running through the text of JLabel.  To do this, we first need to decide how it will look to clearly represent what we need to implement. <br><br>  Let's take as a basis for the ‚Äúflare‚Äù a gradient-filled circle (from light gray in the center to the font color (black) on the edge).  We also need a separate timer that is responsible for moving this circle from the beginning to the end of the component. <br><br>  So, something like this will look like component rendering: <br><blockquote> <code><font color="black"><font color="#0000ff">private</font> boolean animating = <font color="#0000ff">false</font> ; <br> <font color="#0000ff">private</font> <font color="#0000ff">int</font> animationX = 0; <br> <font color="#0000ff">private</font> <font color="#0000ff">int</font> animationLength = 140; <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">float</font> [] fractions = { 0f, 1f }; <br> <font color="#0000ff">private</font> Color[] colors = <font color="#0000ff">new</font> Color[]{ <font color="#0000ff">new</font> Color ( 200, 200, 200 ), <font color="#0000ff">new</font> Color ( 0, 0, 0 ) }; <br> <br> <font color="#0000ff">protected</font> <font color="#0000ff">void</font> paintComponent ( <font color="#2B91AF">Graphics</font> g ) <br> { <br> <font color="#008000">//  ,         </font> <br> BufferedImage bi = <br> <font color="#0000ff">new</font> BufferedImage ( getWidth (), getHeight (), BufferedImage.TYPE_INT_ARGB ); <br> Graphics2D g2d = bi.createGraphics (); <br> g2d.setFont ( g.getFont () ); <br> <br> <font color="#008000">//  </font> <br> super.paintComponent ( g2d ); <br> <br> <font color="#008000">//     </font> <br> <font color="#0000ff">if</font> ( animating ) <br> { <br> g2d.setRenderingHint ( RenderingHints.KEY_ANTIALIASING, <br> RenderingHints.VALUE_ANTIALIAS_ON ); <br> <br> g2d.setComposite ( AlphaComposite.getInstance ( AlphaComposite.SRC_IN ) ); <br> g2d.setPaint ( <font color="#0000ff">new</font> RadialGradientPaint ( animationX - animationLength / 2, <br> getHeight () / 2, animationLength / 2, fractions, colors ) ); <br> g2d.fillRect ( animationX - animationLength, 0, animationLength, getHeight () ); <br> } <br> <br> <font color="#008000">//      </font> <br> g2d.dispose (); <br> g.drawImage ( bi, 0, 0, <font color="#0000ff">null</font> ); <br> }</font></code> </blockquote>  The main essence is hidden in the creation of a separate image on which the text is drawn, as well as setting the Composite when rendering the highlight. <br><br>  The image is necessary so that only those pixels on which text is present are occupied on it, otherwise with standard rendering, the entire filled rectangle with the specified gradient will fill the incoming Graphics AlphaComposite.SRC_IN method, since in addition to the text on the graph, the bottom panel will already be present (panels) background. <br><br>  So, now it remains for us to implement the timer, which is triggered, for example, when the cursor enters the JLabel area: <br><blockquote> <code><font color="black"><font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">class</font> AnimatedLabel extends JLabel <br> { <br> <font color="#0000ff">public</font> AnimatedLabel ( <font color="#2B91AF">String</font> text ) <br> { <br> super ( text ); <br> setupSettings (); <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">void</font> setupSettings () <br> { <br> <font color="#008000">//   </font> <br> setOpaque ( <font color="#0000ff">false</font> ); <br> <font color="#008000">//     </font> <br> setFont ( getFont ().deriveFont ( <font color="#2B91AF">Font</font> .BOLD ).deriveFont ( 30f ) ); <br> <br> <font color="#008000">// ,  </font> <br> addMouseListener ( <font color="#0000ff">new</font> MouseAdapter() <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> mouseEntered ( MouseEvent e ) <br> { <br> startAnimation (); <br> } <br> } ); <br> } <br> <br> <font color="#0000ff">private</font> Timer animator = <font color="#0000ff">null</font> ; <br> <font color="#0000ff">private</font> boolean animating = <font color="#0000ff">false</font> ; <br> <font color="#0000ff">private</font> <font color="#0000ff">int</font> animationX = 0; <br> <font color="#0000ff">private</font> <font color="#0000ff">int</font> animationLength = 140; <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">float</font> [] fractions = { 0f, 1f }; <br> <font color="#0000ff">private</font> Color[] colors = <font color="#0000ff">new</font> Color[]{ <font color="#0000ff">new</font> Color ( 200, 200, 200 ), <font color="#0000ff">new</font> Color ( 0, 0, 0 ) }; <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">void</font> startAnimation () <br> { <br> <font color="#008000">//    ,  </font> <br> <font color="#0000ff">if</font> ( animator != <font color="#0000ff">null</font> &amp;&amp; animator.isRunning () ) <br> { <br> <font color="#0000ff">return</font> ; <br> } <br> <br> <font color="#008000">//  </font> <br> animating = <font color="#0000ff">true</font> ; <br> animationX = 0; <br> animator = <font color="#0000ff">new</font> Timer ( 1000 / 48, <font color="#0000ff">new</font> ActionListener() <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> actionPerformed ( ActionEvent e ) <br> { <br> <font color="#008000">//        </font> <br> <font color="#0000ff">if</font> ( animationX &lt; getWidth () + animationLength ) <br> { <br> animationX += 10; <br> AnimatedButton. <font color="#0000ff">this</font> .repaint (); <br> } <br> <font color="#0000ff">else</font> <br> { <br> animator.stop (); <br> } <br> } <br> } ); <br> animator.start (); <br> } <br> <br> <font color="#0000ff">protected</font> <font color="#0000ff">void</font> paintComponent ( <font color="#2B91AF">Graphics</font> g ) <br> { <br> <font color="#008000">//</font> <br> } <br> }</font></code> </blockquote>  I doubt that in this piece of code it is necessary to explain something (besides what is described by comments). <br><br>  As a result, we get here <a href="">such a</a> funny effect. <br><br>  Of course, this example is only the tip of the iceberg.  With good imagination, you can create a lot of interesting static or animated things. <br><br><h1>  Few tricks </h1>  Sometimes it's not enough just to know the standard tools to do everything you need.  It is necessary to invent various "cunning" things.  I would like to share with you what I could find on the net and the ‚Äúinvented bikes‚Äù with you in several separate examples.  So let's get down to business ... <br><br>  <strong>Image edge smoothing</strong> <br>  Suppose we need to crop the image in a certain form, but standard tools like clip'a when drawing will lead to a disastrous result.  In this case, you should use AlphaComposite: <br><blockquote> <code><font color="black">ImageIcon icon = <font color="#0000ff">new</font> ImageIcon ( iconPath ); <br> <br> BufferedImage roundedImage = <font color="#0000ff">new</font> BufferedImage ( icon.getIconWidth (), icon.getIconHeight (), <br> BufferedImage.TYPE_INT_ARGB ); <br> Graphics2D g2d = roundedImage.createGraphics (); <br> g2d.setRenderingHint ( RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON ); <br> g2d.setPaint ( Color.WHITE ); <br> g2d.fillRoundRect ( 0, 0, icon.getIconWidth (), icon.getIconHeight (), 10, 10 ); <br> g2d.setComposite ( AlphaComposite.getInstance ( AlphaComposite.SRC_IN ) ); <br> g2d.drawImage ( icon.getImage (), 0, 0, <font color="#0000ff">null</font> ); <br> g2d.dispose (); <br> <br> ImageIcon roundedIcon = <font color="#0000ff">new</font> ImageIcon ( roundedImage );</font></code> </blockquote>  Thus, we first draw a rounded rectangle smoothed in the corners, and then using it as a stencil we impose an image on top. <br><br>  <strong>Using Custom Stroke</strong> <br>  For a long time, I found a very interesting <a href="http://www.jhlabs.com/java/java2d/strokes/">article</a> on writing my own Stroke class. <br>  In some cases, such a Stroke can greatly facilitate rendering. <br><br>  <strong>Using blur / shadow filters</strong> <br>  On the same resource, you can also find a very interesting <a href="http://www.jhlabs.com/ip/blurring.html">article</a> on blur. <br>  It may be useful to those engaged in working with images. <br><br>  <strong>Using GlyphVector</strong> <br>  One of the "stressful" moments when working with graphics is text rendering, especially if this text is subject to change.  For the correct positioning of the text will have to calculate its size and draw based on them. <br>  For such calculations there are two means: <br>  <strong>1.</strong> FontMetrics <br>  It can be obtained directly from the Graphics2D instance (g2d.getFontMetrics ()). <br>  It allows you to determine the different sizes of indents and heights of the set font. <br>  <strong>2.</strong> GlyphVector <br>  This option will be more useful in cases when it is necessary to center the text on the Y-coordinate, since it allows you to know exactly the dimensions of a certain text: <br><blockquote> <code><font color="black">FontMetrics fm = g2d.getFontMetrics (); <br> GlyphVector gv = g2d.getFont ().createGlyphVector ( fm.getFontRenderContext (), <font color="#A31515">"Text"</font> ); <br> Rectangle visualBounds = gv.getVisualBounds ().getBounds ();</font></code> </blockquote>  Also from GlyphVector you can get a lot of useful information, for example, the outer border of the text (directly its form): <br><blockquote> <code><font color="black">Shape textOutline = gv.getOutline ();</font></code> </blockquote> <br>  <strong>Creating your own tooltip manager</strong> <br>  Swing has a lot of unsightly things that, however, can be easily smoothed out by changing the UI of the components or working with their layout.  In some cases, things are not so simple. <br><br>  The system of tooltips, implemented for all J-components, applies to such cases.  Since all shown tooltips are displayed on a separate <strong>strictly rectangular</strong> popup (lightweight or heavyweight, depending on whether the tooltip falls within the window borders), we are limited to this area and form, which is very sad.  And this is in the era of neat web interfaces and ‚Äúrounded‚Äù shapes! <br><br>  Of course, you can break the standard TooltipManager, find places for creating windows, set the desired shape for them through new features, but this is firstly - it still does not work on all operating systems, secondly, this is not a very good and optimal option. <br><br>  Therefore, I had the idea of ‚Äã‚Äãusing GlassPane, which is present in all standard windows, as a display area for tooltips (and later on all kinds of internal windows). <br><br>  The idea itself consists of several parts: <br>  <strong>1.</strong> A separate manager ( <a href="">TooltipManager.java</a> ), who would, if necessary, create a GlassPane for a specific window, on which the tooltip opens and remembers it.  Further creation of the tooltip would occur directly in the GlassPane. <br>  <strong>2.</strong> GlassPane ( <a href="">TooltipGlassPane.java</a> ) is a transparent panel that skips any events and displays tooltips at the right moment. <br>  <strong>3.</strong> The tooltip itself ( <a href="">CustomTooltip.java</a> ) is a standard J-component that displays any content in a nice design depending on its location on the GlassPane. <br><br>  As a result, the displayed tooltips will look something like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/4ad/d62/76c/4add6276ca7ee8fc7a006cbdebeeb9ef.png"><br><br>  <i>You can look at the full implementation of this idea in the <a href="">library</a> described below.</i>  <i>I did not give it in connection with a very large amount of code.</i>  <i>The names of the classes that implement the idea have been noted above and correspond to the names of the classes in the project.</i> <br><br>  <strong>Editable list</strong> <br>  In addition to adding their ‚Äúbikes‚Äù, in some cases it is quite easy and elegant to use standard means to complement the functionality of existing components. <br><br>  I think everyone knows the Jlist component, in which, however, there was initially no provision for editing.  So now I will show you how to fix this flaw. <br><br>  First, you need to create an interface that the editor will implement: <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">interface</font> ListEditor <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> installEditor ( JList list, Runnable startEdit ); <br> <br> <font color="#0000ff">public</font> boolean isCellEditable ( JList list, <font color="#0000ff">int</font> index, Object <font color="#0000ff">value</font> ); <br> <br> <font color="#0000ff">public</font> JComponent createEditor ( JList list, <font color="#0000ff">int</font> index, Object <font color="#0000ff">value</font> ); <br> <br> <font color="#0000ff">public</font> Rectangle getEditorBounds ( JList list, <font color="#0000ff">int</font> index, Object <font color="#0000ff">value</font> , Rectangle cellBounds ); <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setupEditorActions ( JList list, Object <font color="#0000ff">value</font> , Runnable cancelEdit, <br> Runnable finishEdit ); <br> <br> <font color="#0000ff">public</font> Object getEditorValue ( JList list, <font color="#0000ff">int</font> index, Object oldValue ); <br> <br> <font color="#0000ff">public</font> boolean updateModelValue ( JList list, <font color="#0000ff">int</font> index, Object <font color="#0000ff">value</font> , boolean updateSelection ); <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> editStarted ( JList list, <font color="#0000ff">int</font> index ); <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> editFinished ( JList list, <font color="#0000ff">int</font> index, Object oldValue, Object newValue ); <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> editCancelled ( JList list, <font color="#0000ff">int</font> index ); <br> }</font></code> </blockquote>  The heir to this interface will provide everything you need to create and display an editor on the list.  That's just to inherit each time and define the full set of these functions is very expensive, let's make an abstract class that implements a more or less common part for different editors: <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> AbstractListEditor implements ListEditor <br> { <br> <font color="#0000ff">protected</font> <font color="#0000ff">int</font> editedCell = -1; <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> installEditor ( final JList list, final Runnable startEdit ) <br> { <br> <font color="#008000">// ,  </font> <br> list.addMouseListener ( <font color="#0000ff">new</font> MouseAdapter() <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> mouseClicked ( MouseEvent e ) <br> { <br> <font color="#0000ff">if</font> ( e.getClickCount () == 2 &amp;&amp; SwingUtilities.isLeftMouseButton ( e ) ) <br> { <br> startEdit.run (); <br> } <br> } <br> } ); <br> list.addKeyListener ( <font color="#0000ff">new</font> KeyAdapter() <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> keyReleased ( KeyEvent e ) <br> { <br> <font color="#0000ff">if</font> ( e.getKeyCode () == KeyEvent.VK_F2 ) <br> { <br> startEdit.run (); <br> } <br> } <br> } ); <br> } <br> <br> <font color="#0000ff">public</font> boolean isCellEditable ( JList list, <font color="#0000ff">int</font> index, Object <font color="#0000ff">value</font> ) <br> { <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> } <br> <br> <font color="#0000ff">public</font> Rectangle getEditorBounds ( JList list, <font color="#0000ff">int</font> index, Object <font color="#0000ff">value</font> , Rectangle cellBounds ) <br> { <br> <font color="#008000">//       </font> <br> <font color="#0000ff">return</font> <font color="#0000ff">new</font> Rectangle ( 0, 0, cellBounds.width, cellBounds.height + 1 ); <br> } <br> <br> <font color="#0000ff">public</font> boolean updateModelValue ( JList list, <font color="#0000ff">int</font> index, Object <font color="#0000ff">value</font> , boolean updateSelection ) <br> { <br> <font color="#008000">//     </font> <br> ListModel model = list.getModel (); <br> <font color="#0000ff">if</font> ( model instanceof DefaultListModel ) <br> { <br> ( ( DefaultListModel ) model ).setElementAt ( <font color="#0000ff">value</font> , index ); <br> list.repaint (); <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> } <br> <font color="#0000ff">else</font> <font color="#0000ff">if</font> ( model instanceof AbstractListModel ) <br> { <br> final Object[] values = <font color="#0000ff">new</font> Object[ model.getSize () ]; <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; model.getSize (); i++ ) <br> { <br> <font color="#0000ff">if</font> ( editedCell != i ) <br> { <br> values[ i ] = model.getElementAt ( i ); <br> } <br> <font color="#0000ff">else</font> <br> { <br> values[ i ] = <font color="#0000ff">value</font> ; <br> } <br> } <br> list.setModel ( <font color="#0000ff">new</font> AbstractListModel() <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getSize () <br> { <br> <font color="#0000ff">return</font> values.length; <br> } <br> <br> <font color="#0000ff">public</font> Object getElementAt ( <font color="#0000ff">int</font> index ) <br> { <br> <font color="#0000ff">return</font> values[ index ]; <br> } <br> } ); <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> } <br> <font color="#0000ff">else</font> <br> { <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> editStarted ( JList list, <font color="#0000ff">int</font> index ) <br> { <br> <font color="#008000">//    </font> <br> editedCell = index; <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> editFinished ( JList list, <font color="#0000ff">int</font> index, Object oldValue, Object newValue ) <br> { <br> <font color="#008000">//    </font> <br> editedCell = -1; <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> editCancelled ( JList list, <font color="#0000ff">int</font> index ) <br> { <br> <font color="#008000">//    </font> <br> editedCell = -1; <br> } <br> <br> <font color="#0000ff">public</font> boolean isEditing () <br> { <br> <font color="#008000">//   </font> <br> <font color="#0000ff">return</font> editedCell != -1; <br> } <br> }</font></code> </blockquote>  Now, based on this abstract class, it will be quite easy to implement, for example, a text editor for the list ‚Äî it will look something like this ‚Äî <a href="">WebStringListEditor.java</a> . <br><br>  There remains the last point - the method of installing the editor in the list.  We will carry it into a separate class and make it static for convenience: <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> ListUtils <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> installEditor ( final JList list, final ListEditor listEditor ) <br> { <br> <font color="#008000">//  ,    </font> <br> final Runnable startEdit = <font color="#0000ff">new</font> Runnable() <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> run () <br> { <br> <font color="#008000">//     </font> <br> final <font color="#0000ff">int</font> index = list.getSelectedIndex (); <br> <font color="#0000ff">if</font> ( list.getSelectedIndices ().length != 1 || index == -1 ) <br> { <br> <font color="#0000ff">return</font> ; <br> } <br> <br> <font color="#008000">//      </font> <br> final Object <font color="#0000ff">value</font> = list.getModel ().getElementAt ( index ); <br> <font color="#0000ff">if</font> ( !listEditor.isCellEditable ( list, index, <font color="#0000ff">value</font> ) ) <br> { <br> <font color="#0000ff">return</font> ; <br> } <br> <br> <font color="#008000">//  </font> <br> final JComponent editor = listEditor.createEditor ( list, index, <font color="#0000ff">value</font> ); <br> <br> <font color="#008000">//       </font> <br> editor.setBounds ( computeCellEditorBounds ( index, <font color="#0000ff">value</font> , list, listEditor ) ); <br> list.addComponentListener ( <font color="#0000ff">new</font> ComponentAdapter() <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> componentResized ( ComponentEvent e ) <br> { <br> checkEditorBounds (); <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">void</font> checkEditorBounds () <br> { <br> Rectangle newBounds = <br> computeCellEditorBounds ( index, <font color="#0000ff">value</font> , list, listEditor ); <br> <font color="#0000ff">if</font> ( newBounds != <font color="#0000ff">null</font> &amp;&amp; !newBounds.equals ( editor.getBounds () ) ) <br> { <br> editor.setBounds ( newBounds ); <br> list.revalidate (); <br> list.repaint (); <br> } <br> } <br> } ); <br> <br> <font color="#008000">//    </font> <br> list.add ( editor ); <br> list.revalidate (); <br> list.repaint (); <br> <br> <font color="#008000">//    </font> <br> <font color="#0000ff">if</font> ( editor.isFocusable () ) <br> { <br> editor.requestFocus (); <br> editor.requestFocusInWindow (); <br> } <br> <br> <font color="#008000">//      </font> <br> final Runnable cancelEdit = <font color="#0000ff">new</font> Runnable() <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> run () <br> { <br> list.remove ( editor ); <br> list.revalidate (); <br> list.repaint (); <br> <br> listEditor.editCancelled ( list, index ); <br> } <br> }; <br> final Runnable finishEdit = <font color="#0000ff">new</font> Runnable() <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> run () <br> { <br> Object newValue = listEditor.getEditorValue ( list, index, <font color="#0000ff">value</font> ); <br> boolean changed = <br> listEditor.updateModelValue ( list, index, newValue, <font color="#0000ff">true</font> ); <br> <br> list.remove ( editor ); <br> list.revalidate (); <br> list.repaint (); <br> <br> <font color="#0000ff">if</font> ( changed ) <br> { <br> listEditor.editFinished ( list, index, <font color="#0000ff">value</font> , newValue ); <br> } <br> <font color="#0000ff">else</font> <br> { <br> listEditor.editCancelled ( list, index ); <br> } <br> } <br> }; <br> listEditor.setupEditorActions ( list, <font color="#0000ff">value</font> , cancelEdit, finishEdit ); <br> <br> <font color="#008000">//    </font> <br> listEditor.editStarted ( list, index ); <br> } <br> }; <br> listEditor.installEditor ( list, startEdit ); <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> Rectangle computeCellEditorBounds ( <font color="#0000ff">int</font> index, Object <font color="#0000ff">value</font> , JList list, <br> ListEditor listEditor ) <br> { <br> <font color="#008000">//      </font> <br> Rectangle cellBounds = list.getCellBounds ( index, index ); <br> <font color="#0000ff">if</font> ( cellBounds != <font color="#0000ff">null</font> ) <br> { <br> Rectangle editorBounds = listEditor.getEditorBounds ( list, index, <font color="#0000ff">value</font> , cellBounds ); <br> <font color="#0000ff">return</font> <font color="#0000ff">new</font> Rectangle ( cellBounds.x + editorBounds.x, cellBounds.y + editorBounds.y, <br> editorBounds.width, editorBounds.height ); <br> } <br> <font color="#0000ff">else</font> <br> { <br> <font color="#0000ff">return</font> <font color="#0000ff">null</font> ; <br> } <br> } <br> }</font></code> </blockquote> <br>  That's it, now we can install the editor on any available list with a single line of code: <br><img src="https://habrastorage.org/getpro/habr/post_images/671/f64/94f/671f6494f447134b629eb0c75938f2ad.png"><br><br>  The main thing to remember is to change the methods of setting / getting the value to / from the editor, if you use non-String'ami in the model.  To do this, just override the two methods (of course, depending on the complexity of the required editor) in <a href="">WebStringListEditor.java</a> - createEditor and getEditorValue. <br><br><h1>  Web Look And Feel </h1><img src="https://habrastorage.org/getpro/habr/post_images/c8f/6bf/79f/c8f6bf79f80f2f222ce662b340deb452.png" align="right">  Since I devote a lot of time to working with Swing and graphics (especially recently), I had the idea of ‚Äã‚Äãcreating a separate library of UI, advanced components and utilities, which are often so necessary in various places in the code.  And little by little this idea began to be realized as a separate library - <a href="http://weblookandfeel.com/">WebLookAndFeel</a> . <br><br>  I took as a basis various techniques and developments, which I already wrote in this article, as well as some others, which I will describe later in detail. <br><br>  By the way, considering that I have on my nose the development of the second version of our <a href="http://guimachine.ru/">commercial product</a> , this idea was once again spurred on by the need for similar functionality and capabilities. <br><br>  Actually, the library includes most of the techniques described in this article, and many other interesting and useful things for working with graphics: <br><ul><li>  Web LaF itself is a separate full-fledged cross-platform pure-java LaF </li><li>  A set of additional components (also styled as Web LaF) - FileChooser / ColorChooser / Gallery / Calendar and many others (lots of them!) </li><li>  A set of utility classes for: working with graphics, files, text, images, and many other aspects (for example, to simplify downloading files from a URL, reading images, various operations with them, etc.) </li></ul><br>  Also here are some technical "advantages" and features: <br><ul><li>  Fully cross-platform and easily customizable LookAndFeel (directly tested on Windows XP / Vista / 7, Mac OS X 10.6.7, Ubuntu 9/11) </li><li>  Minimum memory requirements (it will be easy to run on -Xms16m -Xmx16m and will perform even heavy operations with images, not to mention the work of LaF and various utilities) </li><li>  Single-jar bundle - that is, everything you need is included in a single jar library that works for all operating systems </li><li>  JDK 1.6 update 20 and newer is required (I can‚Äôt say anything about JDK 7 yet - I have not tried it, but in theory no deprecated things and test features are used in the code) </li></ul><br>  More information about it can be read on a <a href="http://weblookandfeel.com/">separate site</a> . <br><br>  This library may seem like a kind of ‚Äúbicycle‚Äù to many, and it may be possible for someone to assert that similar functionality is already present in other well-known libraries ... <br>  To this I can say two things: <br>  <strong>First</strong> , other libraries provide their components at best, with the possibility of styling for a particular UI (and often with crutches).  The same library contains a set of additional components already stylized as a general view of WebLaF, which will expand over time. <br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secondly, there</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are no different things that I added and are just going to add to the library anywhere. I have not found a single </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sensible</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> implementation of ColorChooser in the open spaces of the network, which could be replaced by the terrible JColorChooser. There are no other implementations of JFileChooser. Of course, there is SWT, but to be honest with it there are other problems, difficulties and limitations, which I propose not to go deep yet and discard this option - all this is about Swing. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, in order to ‚Äúfeel‚Äù the interface and components, I added a class to the library with a small demonstration of completed components: </font></font><br><img src="https://habrastorage.org/getpro/habr/post_images/7b5/4b0/4a4/7b54b04a49910b9baa676f8d5382c85e.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(An example and source code can be downloaded </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) The </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">full source code and the distribution kit of the library are available on the website:</font></font><br> <a href="http://weblookandfeel.com/download/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://weblookandfeel.com/download/</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> At the moment, the library is not yet complete, and there are some minor flaws in LookAndFeel, ‚Äúunsmoothed‚Äù places in the code, as well as some functionality and appearance remains very ‚Äúcontroversial‚Äù and will be changed to the best side. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In connection with all the above, I will be glad to hear any comments, suggestions and constructive criticism on the topic :)</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Finally... </font></font></h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I hope now your knowledge in terms of graphics in Java a little structured and become more tangible and applicable in practice. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I hope that the source codes of WebLookAndFeel libraries presented above will be able to assist you in mastering the work with graphics. There are many more different interesting things (for example, implementations of UI classes for each of the standard Swing components, LookAndFeel organization, global managers, etc.) than I covered with this article, so I strongly advise you to study them (if you have time and desire , of course). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Also, I apologize for a fairly large break in the publication of articles - the collection of materials, alas, took much longer than I expected, not to mention bringing the WebLaF library to a more or less usable form.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The next article will most likely be devoted to writing your own LookAndFeel (with examples and in pictures, of course), as well as some features of the UI of individual J-components. </font></font><br><br><h1>  Resources </h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Various third-party resources on the topic: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(including those given in the article)</font></font><br><br>  <strong>MVC</strong> <br> <a href="http://lib.juga.ru/article/articleview/163/1/68/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://lib.juga.ru/article/articleview/163/1/68/ </font></font></a> <br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shapes </font></font></strong> <br> <a href="http://java.sun.com/developer/technicalArticles/GUI/java2d/java2dpart1.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://java.sun.com/developer/technicalArticles/GUI/java2d/java2dpart1.html </font></font></a> <br> <a href="http://www.datadisk.co.uk/html_docs/java/graphics_java2d.htm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http: //www.datadisk. co.uk/html_docs/java/graphics_java2d.htm </font></font></a> <br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extended Shapes </font></font></strong> <br> <a href="http://java-sl.com/shapes.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://java-sl.com/shapes.html </font></font></a> <br> <a href="http://geosoft.no/graphics/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://geosoft.no/graphics/ </font></font></a> <br> <a href="http://designervista.com/shapes/index.php"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://designervista.com/shapes/index.php </font></font></a> <br> <a href="http://www.jfree.org/jcommon/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http : //www.jfree.org/jcommon/ </font></font></a> <br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Composite </font></font></strong> <br> <a href="http://download.oracle.com/javase/tutorial/2d/advanced/compositing.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://download.oracle.com/javase/tutorial/2d/advanced/compositing.html </font></font></a> <br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BasicStroke </font></font></strong> <br> <a href="http://www.projava.net/Glava9/Index13.htm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://www.projava.net/Glava9/Index13.htm </font></font></a> <br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extended Strokes </font></font></strong> <br> <a href="http://www.jhlabs.com/java/java2d/strokes/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://www.jhlabs.com/java/java2d/strokes/ </font></font></a> <br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blurring </font></font></strong> <br> <a href="http://www.jhlabs.com/ip/blurring.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://www.jhlabs.com/ip/blurring.html</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Libraries used in WebLookAndFeel:</font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">java-image-scaling </font></font></strong> <br> <a href="http://code.google.com/p/java-image-scaling/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://code.google.com/p/java-image-scaling/ </font></font></a> <br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TableLayout </font></font></strong> <br> <a href="http://java.net/projects/tablelayout"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://java.net/projects/tablelayout </font></font></a> <br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data Tips</font></font></strong> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Unfortunately at this time there are no resources available for this library </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jericho HTML Parser </font></font></strong> <br> <a href="http://jericho.htmlparser.net/docs/index.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://jericho.htmlparser.net/docs/index.html</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and icon sets: </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fugue icons </font></font></strong> <br> <a href="http://code.google.com/p/fugue-icons-src/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://code.google.com/p/fugue-icons-src/ </font></font></a> <br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fatcow icons </font></font></strong> <br> <a href="http://www.fatcow.com/free-icons"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http: //www.fatcow. com / free-icons</font></font></a> <br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Special thanks to... </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Project </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Source Code Highlighter</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for readable code highlighting: </font></font><br> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://virtser.net/blog/post/source-code-highlighter.aspx</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hosting images</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for image storage: </font></font><br> <a href="http://hostingkartinok.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://hostingkartinok.com/ </font></font></a> <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Upd1:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a little tweak and links Illustrations </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Upd2:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Updated library distributions with fixes for various inaccuracies and problems. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Upd3:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fixed inaccuracies and image curves in the article.</font></font></div><p>Source: <a href="https://habr.com/ru/post/127518/">https://habr.com/ru/post/127518/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../127507/index.html">How we participated in public procurement</a></li>
<li><a href="../127508/index.html">Invitations to closed foreign trackers of the training subject (Part II)</a></li>
<li><a href="../127511/index.html">Open DSLR firmware for Canon</a></li>
<li><a href="../127512/index.html">In the new academic year, we again invite mega-active students to partnership</a></li>
<li><a href="../127516/index.html">Color techniques in web design</a></li>
<li><a href="../127520/index.html">The effect of saving and loading the game state on the game process</a></li>
<li><a href="../127521/index.html">You are not authorized by keys yet? Then we go to you</a></li>
<li><a href="../127522/index.html">Developing a simple google chrome extension</a></li>
<li><a href="../127523/index.html">The simplest reminder of bash dumplings</a></li>
<li><a href="../127524/index.html">We get a passport through gosuslugi.ru (part 1)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>