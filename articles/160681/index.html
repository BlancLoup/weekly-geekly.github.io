<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create an AD user through the web interface</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not every web developer will encounter AD at least because a server administrator must first configure a module for working with ldap via php. But som...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create an AD user through the web interface</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/71e/c40/32d/71ec4032d8815c3d7d869bfc22a0b2f4.jpg"><br><br>  Not every web developer will encounter <a href="http://ru.wikipedia.org/wiki/Active_Directory">AD</a> at least because a server administrator must first configure a module for working with <a href="http://ru.wikipedia.org/wiki/LDAP">ldap</a> via php.  But sometimes it still happens - the company has a good admin and the need for centralized management of employees. <br><br>  To put it very simply, this is exactly what AD does - it stores information about employees and gives it to various applications and services as a database, say, MySQL.  For setting up and managing AD, there can also be a whole individual employee, but the implementation of access via the web interface will predictably fall on the web programmer.  And then there may be some difficulties. <br><a name="habracut"></a><br>  If you understand the general principles of AD and implement, for example, displaying the structure of a company in a browser for a person familiar with databases, it will be quite simple, then organizing input is already more difficult.  The fact is that real AD specialists use desktop applications, the console and VBScript (it seems), and manipulate users as objects, and only some functions and the transfer of the user as an array of data are available to the php programmer.  Determining which keys to write and in which format the values ‚Äã‚Äãshould be is not a trivial task.  Because the network for the function ldap_add () is just <a href="http://yandex.ru/yandsearch%3Ftext%3Dldap_add">one use case</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Therefore, it is relevant to create another example - a more detailed one and with all the ‚Äúbody kit‚Äù, in order to check the work could be without any significant changes. <br><br>  We assume that the server is already set up, access is obtained, and our user is granted write access.  The first stage - connection - is described in the manuals in sufficient detail: <br><br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/* Connection parameters */</span></span> $ldap_host = <span class="hljs-string"><span class="hljs-string">"xxx.local"</span></span>; <span class="hljs-comment"><span class="hljs-comment"># domain controller or ip-address $ldap_port = "389"; # port for connection $ldap_user ="admin@xxx.local"; # AD-user $ldap_pass = "123321";# AD-user's password /* Open connection */ $connect = ldap_connect( $ldap_host, $ldap_port); ldap_set_option($connect, LDAP_OPT_PROTOCOL_VERSION, 3); ldap_set_option($connect, LDAP_OPT_REFERRALS, 0); $bind = ldap_bind($connect, $ldap_user, $ldap_pass);</span></span></code> </pre> <br><br>  Now we‚Äôll check the output and build a hierarchical tree of our company's divisions: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/* Hierarchical tree */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build_tree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($connect, $ou = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $base_dn = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'OU=!Users_all,DC=xxx,DC=local'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ $specific_dn = $base_dn; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">''</span></span> != $ou) {$specific_dn = <span class="hljs-string"><span class="hljs-string">'OU='</span></span>.$ou.<span class="hljs-string"><span class="hljs-string">','</span></span>.$base_dn;} $filter = <span class="hljs-string"><span class="hljs-string">'ou=*'</span></span>; $justthese = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">"ou"</span></span>); $sr = ldap_list($connect, $specific_dn, $filter, $justthese); $info = ldap_get_entries($connect, $sr); $result = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i=<span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; $info[<span class="hljs-string"><span class="hljs-string">"count"</span></span>]; $i++) { $specific_ou = $info[$i][<span class="hljs-string"><span class="hljs-string">"ou"</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]; $result .= <span class="hljs-string"><span class="hljs-string">'&lt;ul&gt;'</span></span>; $result .= <span class="hljs-string"><span class="hljs-string">'&lt;li&gt;&lt;input type="radio" name="dep" value="OU='</span></span>.$specific_ou.<span class="hljs-string"><span class="hljs-string">','</span></span>.$specific_dn.<span class="hljs-string"><span class="hljs-string">'" title="'</span></span>.$specific_ou.<span class="hljs-string"><span class="hljs-string">'" /&gt; '</span></span>.$specific_ou; $result .= build_tree($connect, $specific_ou, $specific_dn); $result .= <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>; $result .= <span class="hljs-string"><span class="hljs-string">'&lt;/ul&gt;'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $result; }</code> </pre><br><br>  We immediately add form elements to the output, which we will need in the next step.  The function calls itself that will allow to pass any level of nesting. <br>  If everything works, we will write a simple form for adding an employee: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/* Output */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">' &lt;form method="POST" action="'</span></span>.$_SERVER[<span class="hljs-string"><span class="hljs-string">'REQUEST_URI'</span></span>].<span class="hljs-string"><span class="hljs-string">'"&gt; &lt;h3&gt;&lt;/h3&gt; &lt;input type="hidden" name="new_emp" value="1" /&gt; &lt;input type="text" name="family_name" value="" size="20" /&gt; &lt;input type="text" name="first_name" value="" size="20" /&gt; &lt;input type="text" name="fathers_name" value="" size="20" /&gt; &lt;br/&gt; &lt;h3&gt;&lt;/h3&gt; &lt;input type="text" name="position" value="" size="40" /&gt; &lt;br/&gt; &lt;h3&gt;  &lt;/h3&gt; &lt;input type="text" name="tel_num" value="+7(999) 999-9999" size="20" /&gt; &lt;h3&gt;&lt;/h3&gt; &lt;div class="tree"&gt; '</span></span>.build_tree($connect).<span class="hljs-string"><span class="hljs-string">' &lt;/div&gt; &lt;br/&gt; &lt;input type="submit" value="" /&gt; &lt;/form&gt;'</span></span>;</code> </pre><br><br>  And now - the important part: checking and processing input <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/* Input check */</span></span> $errors = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* EXAMPLE OF CORRECT POST new_emp: 1 family_name:  first_name:  fathers_name:  position:  tel_num: +7(999) 999-9999 dep:      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_POST[<span class="hljs-string"><span class="hljs-string">'new_emp'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($_POST <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $value) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-string"><span class="hljs-string">''</span></span> == $value) {$errors .= <span class="hljs-string"><span class="hljs-string">' '</span></span>.$key.<span class="hljs-string"><span class="hljs-string">'  &lt;br/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {$$key = $value;} } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_POST[<span class="hljs-string"><span class="hljs-string">'dep'</span></span>])) {$errors .= <span class="hljs-string"><span class="hljs-string">' ¬´¬ª  &lt;br/&gt;'</span></span>;} <span class="hljs-comment"><span class="hljs-comment">/* Creating employee */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-string"><span class="hljs-string">''</span></span> == $errors) { $trans_family_name = translit($family_name); $trans_first_name = translit($first_name); $trans_fathers_name = translit($fathers_name); $account = $trans_family_name.substr($trans_first_name, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).substr($trans_fathers_name, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); $dn = <span class="hljs-string"><span class="hljs-string">'CN='</span></span>.$family_name.<span class="hljs-string"><span class="hljs-string">' '</span></span>.$first_name.<span class="hljs-string"><span class="hljs-string">' '</span></span>.$fathers_name.<span class="hljs-string"><span class="hljs-string">','</span></span>.$dep; <span class="hljs-comment"><span class="hljs-comment">//Getting manager $filter = '(&amp;(objectClass=user)(objectCategory=PERSON))'; $sr = ldap_search($connect, $dep, $filter); $info = ldap_get_entries($connect, $sr); //echo Arratomy($info); $manager = $info[0]['manager'][0]; $department = explode(',', $dep); $department = str_replace('OU=', '', $department[0]); $newuser['cn'] = $family_name.' '.$first_name.' '.$fathers_name; $newuser["objectclass"][0] = "top"; $newuser["objectclass"][1] = "person"; $newuser["objectclass"][2] = "organizationalPerson"; $newuser["objectclass"][3] = "user"; $newuser['displayname'] = $family_name.' '.$first_name.' '.$fathers_name; $newuser['givenname'] = $first_name.' '.$fathers_name; $newuser['name'] = $family_name.' '.$first_name.' '.$fathers_name; $newuser['sn'] = $family_name; $newuser['description'] = $position; $newuser['mobile'] = $tel_num; $newuser['samAccountName'] = $account; $newuser['userPrincipalName'] = $account.'@xxx.local'; $newuser['title'] = $position; $newuser['department'] = $department; $newuser['manager'] = $manager; $newuser['useraccountcontrol'] = 0x0002; // Account disabled $newuser['pwdLastSet'] = 0; // User must change password $newuser['userPassword'] = '123321'; //echo '&lt;h2&gt;New AD user&lt;/h2&gt;'.Arratomy($newuser); $result = ldap_add($connect, $dn, $newuser); if($result) {echo '&lt;div class="success"&gt; &lt;/div&gt;';} else {$errors = ldap_error($connect);} } if('' != $errors) {echo '&lt;h2 style="color:red;"&gt;&lt;/h2&gt;&lt;div class="errors"&gt;'.$errors.'&lt;/div&gt;';} }</span></span></code> </pre><br><br>  Of course, it may happen that you do not need to fill in so many user attributes, or vice versa - that they will need much more.  However, such a set already shows much more clearly what will be encountered. <br>  Critical variables are: <br><br><pre> <code class="php hljs"> $dn = <span class="hljs-string"><span class="hljs-string">'CN=  ,OU=!Users_all,DC=xxx,DC=local'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Distinguished name $newuser['cn'] = $family_name.' '.$first_name.' '.$fathers_name; $newuser["objectclass"][0] = "top"; $newuser["objectclass"][1] = "person"; $newuser["objectclass"][2] = "organizationalPerson"; $newuser["objectclass"][3] = "user"; $newuser['samAccountName'] = $account; $newuser['userPrincipalName'] = $account.'@xxx.local';</span></span></code> </pre><br><br>  Without everything else, as a rule, you can do. <br><br><div class="spoiler">  <b class="spoiler_title">Putting it all together (+ styles and service functions):</b> <div class="spoiler_text"><pre> <code class="php hljs">&lt;style&gt; .tree {height:<span class="hljs-number"><span class="hljs-number">500</span></span>px; overflow-y:scroll; border:<span class="hljs-number"><span class="hljs-number">1</span></span>px solid <span class="hljs-comment"><span class="hljs-comment">#ccc;} .tree li:hover {cursor:pointer;} .tree input {display:inline;} .errors {margin:10px 0px; border: 1px dotted red; padding:10px;} .success {margin:10px 0px; border: 1px dotted green; padding:10px;} &lt;/style&gt; &lt;?php //ini_set('display_errors','On'); error_reporting(E_ALL | E_STRICT); /* Service functions */ function Arratomy($array) { $result = "\n".'&lt;span&gt;Array (&lt;b&gt;'.sizeof($array).'&lt;/b&gt; items)&lt;/span&gt;'."\n".'&lt;ol&gt;'."\n"; foreach ($array as $key =&gt; $value) { $result .= '&lt;li&gt;'; if(is_array($value)) {$result .= '&lt;b&gt;'.$key.'&lt;/b&gt;: '.Arratomy($array[$key]);} else {$result .= '&lt;b&gt;'.$key.'&lt;/b&gt;: '.$value.'&lt;/br&gt;'."\n";} $result .= '&lt;/li&gt;'; } $result .= '&lt;/ol&gt;'."\n"; return $result; } function translit($text) { $alphabet_ru = array ( '','','','','','','','', '','','','','','','','', '','','','','','','','', '','','','','','','','','', '','','','','','','','', '','','','','','','','', '','','','','','','','', '','','','','','','','','', ' ' ); $alphabet_eng = array ( 'e','y','ts','u','k','e','n','g', 'sh','sch','z','h','','f','y','v', 'a','p','r','o','l','d','j','e', 'ya','ch','s','m','i','t','','b', 'yu', 'E','Y','Ts','U','K','E','N','G', 'Sh','Sch','Z','H','','F','Y','V', 'A','P','R','O','L','D','J','E', 'Ya','Ch','S','M','I','T','','B', 'Yu', '_' ); return str_replace($alphabet_ru, $alphabet_eng, $text); } /* Connection parameters */ $ldap_host = "xxx.local"; # domain controller or ip-address $ldap_port = "389"; # port for connection // $filter = "ou=*"; # search any department // overridden in the function // $base_dn = "OU=!Users_all,DC=xxx,DC=local"; # specific OU // overridden in the function $ldap_user ="admin@xxx.local"; # AD-user $ldap_pass = "123321";# AD-user's password /* Open connection */ $connect = ldap_connect( $ldap_host, $ldap_port); ldap_set_option($connect, LDAP_OPT_PROTOCOL_VERSION, 3); ldap_set_option($connect, LDAP_OPT_REFERRALS, 0); $bind = ldap_bind($connect, $ldap_user, $ldap_pass); /* Input check */ //echo '&lt;h2&gt;POST&lt;/h2&gt;'.Arratomy($_POST); $errors = ''; /* EXAMPLE OF CORRECT POST new_emp: 1 family_name:  first_name:  fathers_name:  position:  tel_num: +7(999) 999-9999 dep:      */ if(isset($_POST['new_emp'])) { foreach($_POST as $key =&gt; $value) { if('' == $value) {$errors .= ' '.$key.'  &lt;br/&gt;'; break;} else {$$key = $value;} } if(!isset($_POST['dep'])) {$errors .= ' ¬´¬ª  &lt;br/&gt;';} /* Creating employee */ if('' == $errors) { $trans_family_name = translit($family_name); $trans_first_name = translit($first_name); $trans_fathers_name = translit($fathers_name); $account = $trans_family_name.substr($trans_first_name, 0, 1).substr($trans_fathers_name, 0, 1); $dn = 'CN='.$family_name.' '.$first_name.' '.$fathers_name.','.$dep; //Getting manager $filter = '(&amp;(objectClass=user)(objectCategory=PERSON))'; $sr = ldap_search($connect, $dep, $filter); $info = ldap_get_entries($connect, $sr); //echo Arratomy($info); $manager = $info[0]['manager'][0]; $department = explode(',', $dep); $department = str_replace('OU=', '', $department[0]); $newuser['cn'] = $family_name.' '.$first_name.' '.$fathers_name; $newuser["objectclass"][0] = "top"; $newuser["objectclass"][1] = "person"; $newuser["objectclass"][2] = "organizationalPerson"; $newuser["objectclass"][3] = "user"; $newuser['displayname'] = $family_name.' '.$first_name.' '.$fathers_name; $newuser['givenname'] = $first_name.' '.$fathers_name; $newuser['name'] = $family_name.' '.$first_name.' '.$fathers_name; $newuser['sn'] = $family_name; $newuser['description'] = $position; $newuser['mobile'] = $tel_num; $newuser['samAccountName'] = $account; $newuser['userPrincipalName'] = $account.'@xxx.local'; $newuser['title'] = $position; $newuser['department'] = $department; $newuser['manager'] = $manager; $newuser['useraccountcontrol'] = 0x0002; // Account disabled $newuser['pwdLastSet'] = 0; // User must change password $newuser['userPassword'] = '123321'; //echo '&lt;h2&gt;New AD user&lt;/h2&gt;'.Arratomy($newuser); $result = ldap_add($connect, $dn, $newuser); if($result) {echo '&lt;div class="success"&gt; &lt;/div&gt;';} else {$errors = ldap_error($connect);} } if('' != $errors) {echo '&lt;h2 style="color:red;"&gt;&lt;/h2&gt;&lt;div class="errors"&gt;'.$errors.'&lt;/div&gt;';} } /* Hierarchical tree */ function build_tree($connect, $ou = '', $base_dn = 'OU=!Users_all,DC=xxx,DC=local') { $specific_dn = $base_dn; if ('' != $ou) {$specific_dn = 'OU='.$ou.','.$base_dn;} $filter = 'ou=*'; $justthese = array("ou"); $sr = ldap_list($connect, $specific_dn, $filter, $justthese); $info = ldap_get_entries($connect, $sr); $result = ''; for ($i=0; $i &lt; $info["count"]; $i++) { $specific_ou = $info[$i]["ou"][0]; $result .= '&lt;ul&gt;'; $result .= '&lt;li&gt;&lt;input type="radio" name="dep" value="OU='.$specific_ou.','.$specific_dn.'" title="'.$specific_ou.'" /&gt; '.$specific_ou; $result .= build_tree($connect, $specific_ou, $specific_dn); $result .= '&lt;/li&gt;'; $result .= '&lt;/ul&gt;'; } return $result; } /* Output */ echo ' &lt;form method="POST" action="'.$_SERVER['REQUEST_URI'].'"&gt; &lt;h3&gt;&lt;/h3&gt; &lt;input type="hidden" name="new_emp" value="1" /&gt; &lt;input type="text" name="family_name" value="" size="20" /&gt; &lt;input type="text" name="first_name" value="" size="20" /&gt; &lt;input type="text" name="fathers_name" value="" size="20" /&gt; &lt;br/&gt; &lt;h3&gt;&lt;/h3&gt; &lt;input type="text" name="position" value="" size="40" /&gt; &lt;br/&gt; &lt;h3&gt;  &lt;/h3&gt; &lt;input type="text" name="tel_num" value="+7(999) 999-9999" size="20" /&gt; &lt;h3&gt;&lt;/h3&gt; &lt;div class="tree"&gt; '.build_tree($connect).' &lt;/div&gt; &lt;br/&gt; &lt;input type="submit" value="" /&gt; &lt;/form&gt;'; /* Close connection */ ldap_close($connect); ?&gt;</span></span></code> </pre><br></div></div><br><br><habracut></habracut></div><p>Source: <a href="https://habr.com/ru/post/160681/">https://habr.com/ru/post/160681/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../160667/index.html">Managing Parallels Automation for Cloud Infrastructure with API</a></li>
<li><a href="../160669/index.html">Desire HD: Which firmware is better?</a></li>
<li><a href="../160675/index.html">About the absence of hot swap drives in the BX924 S3</a></li>
<li><a href="../160677/index.html">SCSS and cross-platform gradient (well, almost)</a></li>
<li><a href="../160679/index.html">Pseudo web sockets</a></li>
<li><a href="../160685/index.html">How does Fishing Joy 2 in China manage to get $ 1.6 million per month</a></li>
<li><a href="../160687/index.html">Types and formats of references</a></li>
<li><a href="../160689/index.html">Digitizing 35mm film</a></li>
<li><a href="../160691/index.html">"Failsafe" system based on Ubuntu and btrfs</a></li>
<li><a href="../160693/index.html">How to reduce the risk of interaction with customers in three stages</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>