<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Joomla performance on large volumes of content</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Joomla is very bad at digesting a database with even a few thousand articles in the _content table. With several tens of thousands of queries to the d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Joomla performance on large volumes of content</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/908/db9/d07/908db9d07e1a44e42a76993d1e8d5aac.jpg" alt="image"><br><br>  Joomla is very bad at digesting a database with even a few thousand articles in the _content table.  With several tens of thousands of queries to the database of standard modules of type mod_articles_popular may hang for seconds. <br><br>  It's all about the ACL (Access Control List) - access control policy.  Checking the legality of user access to the materials takes over 98% of the time the request is executed. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the meantime, there are sites that do not need it.  For example, the news site, showing in the left column the module "Most read articles" all in a row.  What to do in this case?  Disable ACL checking in the helper.php module.  Fortunately, this is not difficult - just comment on the line: <br><br><pre><code class="php hljs">$model-&gt;setState(<span class="hljs-string"><span class="hljs-string">'filter.access'</span></span>, $access);</code> </pre> <br>  Let's look at the result.  We turn on debugging in the admin panel, look in the debag information to the request in the database of this module.  Here it is without an ACL: <br><br><div class="spoiler">  <b class="spoiler_title">Request to mod_articles_popular DB without ACL</b> <div class="spoiler_text"><pre> <code class="sql hljs"> : 18.84 ms   : 6.38 ms  : 0.012 MB   : 7.288 MB  : 5 <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> a.id, a.title, a.alias, a.introtext, a.fulltext, a.checked_out, a.checked_out_time, a.catid, a.created, a.created_by, a.created_by_alias, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> a.modified = <span class="hljs-string"><span class="hljs-string">'0000-00-00 00:00:00'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> a.created <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> a.modified <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> modified, a.modified_by, uam.name <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> modified_by_name, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> a.publish_up = <span class="hljs-string"><span class="hljs-string">'0000-00-00 00:00:00'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> a.created <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> a.publish_up <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> publish_up,a.publish_down, a.images, a.urls, a.attribs, a.metadata, a.metakey, a.metadesc, a.access, a.hits, a.xreference, a.featured, a.language, <span class="hljs-keyword"><span class="hljs-keyword">LENGTH</span></span>(a.fulltext) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> readmore, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> badcats.id <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> a.state <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> state,c.title <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> category_title, c.path <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> category_route, c.access <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> category_access, c.alias <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> category_alias, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> a.created_by_alias &gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> a.created_by_alias <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> ua.name <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> author,ua.email <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> author_email,parent.title <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> parent_title, parent.id <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> parent_id, parent.path <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> parent_route, parent.alias <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> parent_alias,<span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(v.rating_sum / v.rating_count, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> rating, v.rating_count <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> rating_count,c.published, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> badcats.id <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> c.published <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> parents_published <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> jos_content <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> jos_categories <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.id = a.catid <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> jos_users <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ua <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ua.id = a.created_by <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> jos_users <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> uam <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> uam.id = a.modified_by <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> jos_categories <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> parent.id = c.parent_id <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> jos_content_rating <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> v <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> a.id = v.content_id <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> cat.id <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> jos_categories <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> cat <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> jos_categories <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> cat.lft <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> parent.lft <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> parent.rgt <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> parent.extension = <span class="hljs-string"><span class="hljs-string">'com_content'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> parent.published != <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> cat.id ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> badcats <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> badcats.id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> badcats.id <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> a.state <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> a.catid <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">13</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">21</span></span>,<span class="hljs-number"><span class="hljs-number">24</span></span>,<span class="hljs-number"><span class="hljs-number">25</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> a.publish_up &gt;= <span class="hljs-keyword"><span class="hljs-keyword">DATE_SUB</span></span>(<span class="hljs-string"><span class="hljs-string">'2018-04-30 03:27:24'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">INTERVAL</span></span> <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DAY</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> a.hits <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span></code> </pre> <br></div></div><br>  Here's the ACL: <br><br><div class="spoiler">  <b class="spoiler_title">Request to mod_articles_popular DB with ACL</b> <div class="spoiler_text"><pre> <code class="sql hljs"> : 972.79 ms   : 3.96 ms  : 0.012 MB   : 7.378 MB  : 5 <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> a.id, a.title, a.alias, a.introtext, a.fulltext, a.checked_out, a.checked_out_time, a.catid, a.created, a.created_by, a.created_by_alias, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> a.modified = <span class="hljs-string"><span class="hljs-string">'0000-00-00 00:00:00'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> a.created <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> a.modified <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> modified, a.modified_by, uam.name <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> modified_by_name, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> a.publish_up = <span class="hljs-string"><span class="hljs-string">'0000-00-00 00:00:00'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> a.created <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> a.publish_up <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> publish_up,a.publish_down, a.images, a.urls, a.attribs, a.metadata, a.metakey, a.metadesc, a.access, a.hits, a.xreference, a.featured, a.language, <span class="hljs-keyword"><span class="hljs-keyword">LENGTH</span></span>(a.fulltext) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> readmore, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> badcats.id <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> a.state <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> state,c.title <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> category_title, c.path <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> category_route, c.access <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> category_access, c.alias <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> category_alias, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> a.created_by_alias &gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> a.created_by_alias <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> ua.name <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> author,ua.email <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> author_email,parent.title <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> parent_title, parent.id <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> parent_id, parent.path <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> parent_route, parent.alias <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> parent_alias,<span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(v.rating_sum / v.rating_count, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> rating, v.rating_count <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> rating_count,c.published, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> badcats.id <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> c.published <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> parents_published <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> jos_content <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> jos_categories <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.id = a.catid <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> jos_users <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ua <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ua.id = a.created_by <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> jos_users <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> uam <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> uam.id = a.modified_by <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> jos_categories <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> parent.id = c.parent_id <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> jos_content_rating <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> v <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> a.id = v.content_id <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> cat.id <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> jos_categories <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> cat <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> jos_categories <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> cat.lft <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> parent.lft <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> parent.rgt <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> parent.extension = <span class="hljs-string"><span class="hljs-string">'com_content'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> parent.published != <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> cat.id ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> badcats <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> badcats.id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> a.access <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> c.access <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> badcats.id <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> a.state <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> a.catid <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">13</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">21</span></span>,<span class="hljs-number"><span class="hljs-number">24</span></span>,<span class="hljs-number"><span class="hljs-number">25</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> a.publish_up &gt;= <span class="hljs-keyword"><span class="hljs-keyword">DATE_SUB</span></span>(<span class="hljs-string"><span class="hljs-string">'2018-04-30 03:36:50'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">INTERVAL</span></span> <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DAY</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> a.hits <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span></code> </pre> <br></div></div><br>  The difference is just two checks in the WHERE clause: <br><br><pre> <code class="sql hljs">a.access IN (1,1,2,3,6) AND c.access IN (1,1,2,3,6)</code> </pre> <br>  as well as in the first line query execution time: 19 milliseconds and 973 milliseconds.  98%.  On a database with 5,000 articles.  On a powerful server hoster.  This is the price of the widely advertised Joomla ACL. <br><br>  But it turns out that the developers of this framework are well aware of this moment, and they have built into its admin panel the ability to disable the ACL check.  But they did it so that no one would guess. <br><br>  The option is located in ‚ÄúGeneral Settings‚Äù -&gt; ‚ÄúMaterials‚Äù, at the bottom of the first ‚ÄúMaterials‚Äù tab, is called ‚ÄúShow links unauthorized‚Äù.  It is interpreted by a pop-up hint like: " <i>If set to Yes, then all users, including those who are not authorized, will be able to see links to view the full text of materials, but to view the full text, the system will require to enter a login and password</i> ." <br><br>  It seems to be irrelevant, but does exactly what is needed - cancels the ACL check for all modules (which use this policy).  The $ access variable in $ model-&gt; setState ('filter.access', $ access) is this checkbox (with a backward / exclamation mark).  One of the developers of this CMS suggested its existence. <br><br>  Who needs can revive their Joomla. <br><br>  <i>Note: As it turned out from the tests and discussions in the comments, such braking on this request with the ACL check is irregular and non-deterministic.</i>  <i>A sample without an index with calculated fields in a condition using disk operations with large amounts of data on my tests was sometimes not placed in the DBMS memory, sometimes placed - in this case, the above requests with ACLs were about 50% longer.</i>  <i>Perhaps it depends on the server environment.</i> </div><p>Source: <a href="https://habr.com/ru/post/354678/">https://habr.com/ru/post/354678/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354664/index.html">The digest of interesting materials for the mobile developer # 251 (April 23 - April 29)</a></li>
<li><a href="../354670/index.html">Stm32f103 programming from the very beginning</a></li>
<li><a href="../354672/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ312 (April 23 - 29, 2018)</a></li>
<li><a href="../354674/index.html">Virtual server with DDoS protection on VPS.house</a></li>
<li><a href="../354676/index.html">9 useful tricks for those who program in JavaScript</a></li>
<li><a href="../354680/index.html">The Balance of Commerce of Ideas (a fundamental article by Nikolos Negroponte on the digital economy for 1995, part 4)</a></li>
<li><a href="../354682/index.html">Phased configuration of Continuous Integration (build, test, deploy) for .NET Core WebApp + GitHub</a></li>
<li><a href="../354684/index.html">Issue # 20: IT training - current issues and challenges from leading companies</a></li>
<li><a href="../354686/index.html">What to read at the weekend: 5 books on practical information security</a></li>
<li><a href="../354690/index.html">Experience with WebAssembly or as C ++ undefined behavior shot in the leg</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>