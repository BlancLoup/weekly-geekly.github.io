<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Anatomy and cloning of the USB adapter for the SD card</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="... or how to supply your DIY project on MIPS or a light ARM with a fast micro SD card. 
 Good day to all respected community. I would like to continu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Anatomy and cloning of the USB adapter for the SD card</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/f54/e21/451/f54e21451bfa4ed38bb087e1641cdf12.jpg"></div><br>  ... or how to supply your DIY project on MIPS or a light ARM with a fast micro SD card. <br>  Good day to all respected community.  I would like to continue my story about the <a href="https://geektimes.ru/post/286872/">box-device</a> , namely, about how she managed to acquire a micro SD card connected to the USB 2 port. <br><a name="habracut"></a><br>  The root of the whole problem was that USB 2, and not even one, its processor module has, and QSPI (QuadSPI) or a card interface - alas, no.  How is this sad fact related to SD cards?  Very simply, any SD card in the physical basis of its connection has an SPI (SerialPeripheral) interface.  Classic SPI for transmitting and receiving serial data uses one physical line.  Simple and economical, both in terms of money and milliamps.  However, disadvantages, as is well known, are a continuation of the merits, and for SPI they first of all became a relatively low data exchange rate.  To solve this problem, a four-bit mode of data exchange with an SD card was developed, which is a close relative of the QSPI protocol.  When using this mode, the host controller and the card first agree on the exchange parameters in single-bit mode, and then go to four-bit when using not one line for receiving and transmitting, but four for everything about everything (plus one more to indicate the command). <br><br>  What to do if the hardware does not directly support the four-bit protocol, but does it need a fast exchange?  The obvious answer is to equip the project with a ‚Äúfast interface‚Äù bridge - a ‚Äúfour-bit SD card‚Äù. <br><br>  To solve this problem, a couple of USB-SD adapters were purchased and subjected to preparation (vivisection was not used - we are not what monsters).  Before reheating a soldering iron and a hairdryer, a very important check was made to see if the Debian processor module sees the proposed whistle adapter.  The test went off with a bang, welcome to the operating room.  The bought whistle looks like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/files/899/740/5e7/8997405e7cdc4981aac38d2aad8b1c35.jpg"></div><br>  And so: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a70/962/4bf/a709624bf49a44a1ac3ab97c63049c1c.jpg"></div><br>  After the case was disassembled, it became possible to make out a printed circuit board (from all its two sides). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/140/a2f/164/140a2f16457b41a6be2902e9dca08a5d.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/2d9/48f/33d/2d948f33d59f4afc8fff7b97ebcb5a7e.png"></div><br>  The scheme is simple, its basis is the IC GL823F - a microcontroller with an 8051 command system and with mask memory, equipped with a USB 2 interface hardware unit, apparently not of a very high quality (why do I say that - I don‚Äôt see the exact analog bias resistor and crystal oscillator , which means the restoration of the frequency of the received signal based on the internal calibrated generator).  Will work, but not HiFi, no.  Everything else - the minimum kit: blocking capacitors, pull-up and current-limiting resistors, LED and connectors, that's all engineering. <br><br>  Blow off the components with a hair dryer and look at the printed circuit board.  In many ways, the board is double-sided with plated holes.  After a brief examination of the board in the microscope, drawing the wiring diagram and comparing it with the datasheet on the related ICs of the GL company, we restore the circuit diagram. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d96/74e/a6e/d9674ea6ed584e8aa5566554642f4f18.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/454/79e/797/45479e797ffd47a5966944d5a3e4b88d.jpg"></div><br>  And here we begin to see one small hitch.  What exactly?  Our box is powered from a guaranteed voltage of 3.3V, and the GL823 circuit requires 5 volts.  Well, as it requires - she was so used to it, because it is how much USB gives her.  The micro SD itself is powered by 3.3V, so the built-in LDO stabilizer has been added to the GL823.  Hence the question - and if the circuit is powered by 3.3V, then can it work?  If an LDO is able not to drop the voltage too much, it can, but not all LDOs are equally useful.  A little hint is given by datasheet ‚Äî the output that powers the SD card is called PMOS.  Such an abbreviation can not but rejoice - it can be assumed that the HighSide PMOS scheme is used, in which the voltage drop on the regulating element can be very small.  However, all this is reasoning, and the only decisive argument is experience, it is the son of difficult mistakes. <br><br>  So what kind of experience will we put?  Let's try feeding the IC with two switchable voltages - from 5 V USB or from 3.3 V, received by a separate stabilizer.  Now we have enough knowledge to draw a schematic diagram. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/fb7/4bc/a0b/fb74bca0b27545c192d85f552f89d9f9.gif"></div><br>  The numbering of the components in the diagram is somewhat strange for the reason that at the factory of printed circuit boards a multi-stock was ordered with several more test circuits, and all of them had a continuous numbering of components.  Preparing the article, the concept I brought into line with the photo, and it turned out what happened. <br><br>  What do we see in the diagram?  Clearly, the core is GL823F.  The micro-SD connector is obviously connected to it.  The only thing to note is that the pin 9 at the connector is a sliding contact of the presence of a card in the slot, when the card is in place, it is closed to the ground.  C7-C10 - blocking capacitors on the power supply.  If you want to slightly increase noise immunity, then conclusions 2 and 16 of the DD1 can be connected via a ferrite choke.  R4 limits the current through HL1, R5 pulls up the GPIO line to one in the absence of a card in the slot.  DA2, C11 and C12 form a 3.3V linear voltage regulator. <br><br>  Since at that moment, when the scheme was being drawn, on the one hand, it was not clear how much it would consume, and on the other there was an unpleasant experience of using some USB flash drives (it would not point with a finger) that consumed 400mA when recording, it was decided to add R6.  In general, this is a standard technique - with a noticeable consumption in the linear LDO circuit (the keywords here are LowDropout), put a low-impedance high-power resistor at the input and dissipate some of the heat on it, and not on the stabilizer.  Experience, however, showed that there is no need for R6, and you will see it later on the photo of the board. <br><br>  XS4 is just designed for the experience - switching power DD1 between 5 and 3.3 volts.  XS2 is a standard USBB connector, so that you can put it in front of you, and not climb to free USB ports under your desk to your PC. <br><br>  Here is what happened after tracing, PP manufacturing and installation: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f54/e21/451/f54e21451bfa4ed38bb087e1641cdf12.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d3d/efa/490/d3defa4908c8471181c4c5a177f66a5a.jpg"></div><br>  As you can see, the lower side of the board is completely uncomplicated, and the upper one is not much more complicated. <br><br>  I am not going to delay the plot decoupling, I will say straight away that experience has shown that it is possible to power the GL823F from a 3.3V source without problems, switching the XS4 does not affect anything other than the power consumption (not current). <br><br>  To make sure that the board made is working normally, the recording speed and current consumption for three different micro-SD cards was measured.  Photo contestants - in the studio! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/5d0/b44/93f/5d0b4493fa7b4383bf2209d97733a56f.jpg"></div><br>  The evaluation of the current consumed (by measuring what was done, my language cannot be called naked) was carried out with the help of such a combined current-voltage meter-quantity of the battery charge.  To be frank, some surprise for me was that it also transmits USB data. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ccb/1ec/e7f/ccb1ece7f12d4f14b50c78a014df4dfc.jpg"></div><br>  Only the current consumption reading was used, the division price of this, if I may say so, device is 0.01A, plus at least a sampling error of 1 lower order digit is 0.01A.  Therefore, the table shows only the ranges of indications between which the figure of current consumption jumped.  I hope, however, that for those who would be interested to apply GL823 in their decisions, it will still be possible to evaluate the upper bar of consumption. <br><br>  In addition to testing the board made, to improve objectivity, a couple of control measurements were made using another SD card reader.  Here is this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/bb6/65a/79d/bb665a79dcfa41269e29baf219bb7977.jpg"></div><br>  This sample was not prepared, I borrowed it from my daughter for 5 minutes, and if I had gutted it, I would have been gutted right there.  One thing is for sure - the chip in it does not belong to the GL823 family, whose members know how to work with the SD standard so much, the multistandard is too tough for them. <br><br>  The read-write speeds were measured in the simplest way: the same file with the size of 1058268 KBytes was written to and read from the test card.  The control experiment (on another reader) was conducted only in order to eliminate system errors for one or the other decimal order, the data on it were not processed, I just made sure that approximately the times and currents of consumption fight with those obtained at the previous stage. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/3c9/44d/ea0/3c944dea089342df93633cb585f542fa.png"></div><br>  If you want to use the described scheme in your project, then when estimating consumption, make an amendment to the fact that the supply current came from a USB voltage of 5 Volts, but the GL823 was powered from a voltage of 3.3 V and the difference was 5-3.3 = 1.7 (and this is 50 % of 3.3) was simply lost on DA2.  When powered from a centralized (and, I hope, pulsed) source of 3.3 volts, you get a decent savings. </div><p>Source: <a href="https://habr.com/ru/post/403199/">https://habr.com/ru/post/403199/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../403185/index.html">How Uber Manages People</a></li>
<li><a href="../403189/index.html">How to treat crazy. 1.1 - Pharmacotherapy: Basics and Schizophrenia</a></li>
<li><a href="../403191/index.html">Logging in the ROS program</a></li>
<li><a href="../403193/index.html">How we did our audio exhibit and demo.</a></li>
<li><a href="../403197/index.html">Why are physicists so worried about the paradox of the disappearance of information in a black hole</a></li>
<li><a href="../403201/index.html">The colony. Chapter 9: Unexpected Attack</a></li>
<li><a href="../403203/index.html">Exhibition VacuumTechExpo 2017</a></li>
<li><a href="../403209/index.html">How to open your bank in Europe: choose a country for the residence "Polybius"</a></li>
<li><a href="../403213/index.html">Hobbies + business or how to put yourself in the client's place</a></li>
<li><a href="../403215/index.html">On the "Uber" no longer train in debt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>