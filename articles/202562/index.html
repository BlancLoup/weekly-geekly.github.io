<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Migrating an application from Windows 8 to Windows 8.1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Migrating applications to a new version of the operating system is always a difficult question. Finding the right balance between introducing new func...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Migrating an application from Windows 8 to Windows 8.1</h1><div class="post__text post__text-html js-mediator-article">  Migrating applications to a new version of the operating system is always a difficult question.  Finding the right balance between introducing new functionality, maintaining code, and having a target audience is key. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ab/3c2/36a/0ab3c236a3a7afd4900465c3dbdd49e3.png"><br><br>  All these parameters are individual for each project, and in a certain sense depend on each other. <br><a name="habracut"></a><br>  For example, Windows Store allows you to host different builds of applications for Windows 8 and Windows 8.1: applications built under W8 run on W8.1, but not vice versa.  You can invest your efforts in adding the necessary new functionality to the W8 build, which will be available both to those who have been updated and to those who have not yet done so, receiving the entire audience at once and delighting it with new amenities.  Or you can invest in adding new features only under W8.1, which can be much simpler (which means you can do more good for users), but the W8 audience will not receive any updates. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/818/1a5/8fe/8181a58feac1288c28b4d5edaa17cf81.png"><br><br>  The picture above shows these two conditional strategies - both assuming that you already have some kind of application for W8.  In many cases, the upper strategy will be correct: freeze the version under W8 - and start developing the version under W8.1. <br><br>  Although, of course, there may be scenarios when it is more cost-effective to postpone the freezing to a later period.  Here you need to estimate how many users you will have time to catch during the migration (the graph is rather conditional): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/166/5aa/3b2/1665aa3b2c9d4d166ea214024cfd26e7.png"><br><br>  Obviously, sooner or later, most users will switch from Windows 8 to Windows 8.1, but the specific speed of the transition may depend on many parameters: from the availability of the Internet in the region to it-policies within the organization.  Accordingly, for example, from the point of view of monetization, you need to ask yourself: what is the volume of the market inside Windows 8 (without updating), given the decreasing dynamics. <br><br>  And another thing: depending on the specific functionality of the application, perhaps you are more than enough with the capabilities of Windows 8 ... <br><br><h2>  What is important to consider </h2><br>  In the context of the transition from Windows 8 to Windows 8.1, you should also consider the following "nuances": <br><ul><li>  Working with XAML and HTML in Windows 8.1 is faster and more energy efficient.  Even a simple migration without changing the code (just redirecting to a new platform) can lead to an improved application responsiveness. </li><li>  In Windows 8.1, new controls have been added that make it easier to do many things.  For example, the same Hub, or ready-made Flyout elements in XAML.  This can sometimes save considerable development time.  (I'm not talking about many new APIs here). </li><li>  The store for Windows 8.1 has new monetization features, including consumable resources for embedded payments. </li><li>  In Windows 8.1, the behavior of the application on the screen has been updated (new display modes) and how the search works has also changed.  Applications built for Windows 8 will run in compatibility mode. </li></ul><br><br><h2>  How to migrate an application </h2><br>  First of all, you will need Windows 8.1 and Visual Studio 2013 for the migration. As soon as you start your project for W8 in the new studio, you will be automatically asked to update the application under W8.1: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d73/18a/00f/d7318a00f32c7b75006ca8de03cc1972.png"><br><br>  Here you will be offered to read about <a href="http://msdn.microsoft.com/en-us/library/windows/apps/bg182410">new features in Windows 8.1</a> and learn about the <a href="http://msdn.microsoft.com/en-us/library/windows/apps/bg182410">intricacies of code migration</a> .  I recommend to pay attention to the fact that part of the API is marked as obsolete and may stop working. <br><br>  In order to ‚Äúredirect‚Äù the projects of your solution under Windows 8.1, it is enough to select the corresponding item in the context menu of each project: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b4a/c8c/bfa/b4ac8cbfafb0490dc5e0d56d5ab95765.png"><br><br>  After the implementation of this procedure, I recommend trying to build a project and make sure that everything works.  It is also worth noting that, in fact, only the project files and the application manifest are automatically updated. <br><br><h2>  Performance </h2><br>  For the curious, I also advise you to experiment with how the application works before and after retargeting.  To do this, in VS2013, you can get into the debugging and find the item ‚ÄúPerformance and Diagnostics‚Äù there, after which you can choose the appropriate test: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/629/579/c76/629579c76dfd159e980c346f93e901de.png"><br><br>  For example, let's compare the responsiveness of a XAML interface.  As a guinea pig, I will use the application " <a href="http://apps.microsoft.com/webpdp/app/dbaf766a-708d-4f77-a93e-4f29bdf31fac">Learning Windows 8</a> ". <br><br>  Results of Windows 8 application on Windows 8.1: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/64f/0bf/0a3/64f0bf0a39709213d1a0c1659a7837a5.png"><br><br>  Here, much time at first takes both parsing appx.xaml, and the actual processing of the application pages. <br><br>  But the results of the same application after redirecting to Windows 8.1 (and without changing the code) on the same scale: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aec/0b5/aa9/aec0b5aa9375e95e59c1451b03d6062e.png"><br><br>  (You can ignore the pause between pages, except that the small spike in the middle is the scrolling of the GridView.) <br><br>  Not a bad improvement, is it? <br><br><h2>  Display application on the screen </h2><br>  Applications on Windows 8 could work in three modes: Fill, Full, and Snapped. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/100/15b/e0b/10015be0bac0f963f85d592951526f9a.png"><br><br>  In Windows 8.1, applications (more precisely, the user) have much more flexibility in positioning on the screen - and they can occupy any width up to 500px (by default) or 320 (optional). <br><br>  However, if the application was built under Windows 8, if there is not enough space, it will be displayed in Snapped View with gray bars on the sides (compatibility mode): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8b1/c06/c1e/8b1c06c1e65016c682fcc07c8cbdedce.png"><br><br>  As soon as you redirect the application under Windows 8.1, it will immediately begin to use the general (Full) view of the width of the display up to 500px: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b75/60a/dda/b7560adda89c365ac11b2b8338425dd8.png"><br><br>  In this place, you should think about how your application behaves in such a fairly narrow space!  Please note that it must remain fully functional. <br><br>  Step back: what happened to our Snapped View?  By default, after migration (and for new projects), the minimum supported width is 500px for applications.  You can indicate in the manifest that your application does well with 320px: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fac/457/7c9/fac4577c9bbd87716a99c60882c09523.png"><br><br>  In this case, between 320 and 500px, your application will switch to what was previously called Snapped view: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/664/dba/2a3/664dba2a35c8fbe7d27d5e21aa29415a.png"><br><br>  Here you need to think again, re-read the migration instructions and understand that you now have deprecated code in your project. <br><br>  So far it works, but it can break - you obviously should change it / update it.  For example, in our project all pages are based on the class LayoutAwarePage, which was previously included in the standard template.  In it you can find the following code: <br><br><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InvalidateVisualState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_layoutAwareControls != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> visualState = DetermineVisualState(ApplicationView.Value); <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (Control layoutAwareControl <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _layoutAwareControls) { VisualStateManager.GoToState(layoutAwareControl, visualState, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } }</code> </pre> <br><br>  The line with the extraction of the state from the ApplicationView is now obsolete - inside DetermineVisualState, a string value was taken from the Value field.  In Windows 8.1, you need to switch the state depending on the available width of the application: <br><br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DetermineVisualState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> windowWidth = Window.Current.Bounds.Width; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> windowHeight = Window.Current.Bounds.Height; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> viewState; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (windowWidth &lt; <span class="hljs-number"><span class="hljs-number">500</span></span>) { viewState = <span class="hljs-string"><span class="hljs-string">"Snapped"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (windowWidth &lt; windowHeight) { viewState = <span class="hljs-string"><span class="hljs-string">"FullScreenPortrait"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { viewState = <span class="hljs-string"><span class="hljs-string">"FullScreenLandscape"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> viewState; }</code> </pre><br><br>  Here I removed the parameters from the DetermineVisualState function, and inside it I had to add an explicit choice of state depending on the width and height of the window. <br><br>  By the way, since both functions are virtual, perhaps somewhere inside your project, you also additionally updated the logic of mode switching.  Probably you should use the search ... or a great opportunity for VS2013 to see where else in the project a specific method is used: <br><br><img src="http://img-fotki.yandex.ru/get/9262/25193168.1a/0_709da_9db206_XXL.png"><br><br>  We test, make sure that everything works. <br><br><h2>  Search </h2><br>  The next important point of our migration program is search.  In Windows 8.1, we took into account two things: <br><ul><li>  Difficulty in finding users </li><li>  The need to combine search from different places into a single interface </li></ul><br><br>  Therefore, we now have a beautiful ‚Äúpowered by Bing‚Äù <a href="http://msdn.microsoft.com/ru-ru/library/windows/apps/bg182890.aspx">search</a> that combines file, web, store and application <a href="http://msdn.microsoft.com/ru-ru/library/windows/apps/bg182890.aspx">search</a> : <br><br><img src="http://img-fotki.yandex.ru/get/9253/25193168.1a/0_709db_2ec4e53b_XL.png"><br><br>  ... and the recommendation to implement search inside the application using SearchBox. <br><br>  Perhaps you, like us, updating applications, are worried about what happened to the Search contract?  It is still present and works for your application when it is running: <br><br><img src="http://img-fotki.yandex.ru/get/9511/25193168.1a/0_709dc_a2a3fd65_XXL.png"><br><br>  However, as you can see in the screenshot above, by default, it searches everywhere, and not in your particular application.  From the drop-down list, you can switch to the application: <br><br><img src="http://img-fotki.yandex.ru/get/6725/25193168.1a/0_709dd_187de428_XXL.png"><br><br>  In order for switching to occur immediately automatically, it is necessary that the search contract, or rather SearchPane, be activated directly from the application.  To do this, you need to make quite a bit of effort: add a search button and hang an event on it. <br><br>  For convenience, I recommend immediately wrapping a button in a UserControl, since you will need to paste it into almost all pages of your application. <br><br>  Our button looks like a search icon in a circle: <br><br><img src="http://img-fotki.yandex.ru/get/9310/25193168.1a/0_709de_8ca0b98d_L.png"><br><br>  This is a regular button (Button) with the desired symbol inside (&amp; # xE11A;), the correct font (Segoe UI Symbol), and selected styles. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UserControl</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"EventsApp.UserControls.SearchButton"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:local</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"using:EventsApp.UserControls"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:d</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:mc</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"searchButton"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"searchIconCodeHere"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HorizontalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Stretch"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">VerticalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Stretch"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">FontFamily</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Segoe UI Symbol"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">FontSize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"24"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Tapped</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"searchButton_Tapped"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">FontWeight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Normal"</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UserControl</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  By clicking on the button, the corresponding event is triggered: <br><br><pre> <code class="hljs pgsql"> private <span class="hljs-type"><span class="hljs-type">void</span></span> searchButton_Tapped(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> sender, Windows.UI.Xaml.<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>.TappedRoutedEventArgs e) { Windows.ApplicationModel.<span class="hljs-keyword"><span class="hljs-keyword">Search</span></span>.SearchPane.GetForCurrentView().<span class="hljs-keyword"><span class="hljs-keyword">Show</span></span>(); }</code> </pre> <br><br>  It remains to insert a button on the application pages.  Now when you activate the search from the application, SearchPane is shown with the correct settings. <br><br><img src="http://img-fotki.yandex.ru/get/9327/25193168.1a/0_709e0_6491e1d2_XL.png"><br><br>  By the way, I recommend adding such a button even for applications compiled under Windows 8 -&gt; it will continue to work correctly for users under Windows 8.1, if you don‚Äôt provide them with a separate assembly. <br><br><h2>  Searchbox </h2><br>  Naturally, you can make the search even closer to the user.  To do this, you can add a <a href="http://msdn.microsoft.com/ru-ru/library/windows/apps/windows.ui.xaml.controls.searchbox.aspx">SearchBox</a> control to the <a href="http://msdn.microsoft.com/ru-ru/library/windows/apps/windows.ui.xaml.controls.searchbox.aspx">application</a> , which will allow you to search right inside the application without switching to the additional panel.  It should be noted that the SearchBox API is very similar to that for working with SearchPane. <br><br>  Also, as with the button for calling the search bar, the easiest way would be if you wrap the SearchBox inside your own UserControl ‚Äî in this case, you can easily integrate all the logic into it, and only insert a control onto the pages. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UserControl</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"EventsApp.UserControls.LearnSearchBox"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:local</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"using:EventsApp.UserControls"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:d</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:mc</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SearchBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"searchBox"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"300"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"48"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">QuerySubmitted</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"searchBox_QuerySubmitted"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UserControl</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  And further in the code: <br><br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">searchBox_QuerySubmitted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SearchBox sender, SearchBoxQuerySubmittedEventArgs args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> frame = Window.Current.Content <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Frame; frame.Navigate(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(SearchPage), args.QueryText); }</code> </pre><br><br>  By the way, this code is almost the same as that used when sending a request to SearchPane.  To be precise, I copied it from there. <br><br>  The next step is to insert our new control in all the right places: <br><br><img src="http://img-fotki.yandex.ru/get/9172/25193168.1a/0_709e1_5a9b77d6_XL.png"><br><br>  Here your can trap an error that is difficult to understand at once (especially if you don‚Äôt read the documentation): <br><br><img src="http://img-fotki.yandex.ru/get/9262/25193168.1a/0_709e2_24aee696_XL.png"><br><br>  The thing is, you can't use SearchPane and SearchBox at the same time.  You will need to choose one.  In my case, I comment on all the lines referring to SearchPane. <br><br>  One of the reasons for this conflict is undoubtedly duplication of functionality, another one is that both search engines are tied to the same system hint mechanism (controlled in the OS settings): <br><br><img src="http://img-fotki.yandex.ru/get/9511/25193168.1a/0_709e3_912d9e6b_XXL.png"><br><br>  Similar to working with SearchPane, you can add your own tips.  You can also easily add search activation by typing from the keyboard on the screen: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SearchBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"searchBox"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"300"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"48"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">QuerySubmitted</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"searchBox_QuerySubmitted"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">FocusOnKeyboardInput</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"True"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br><br>  An example of use can be found at <a href="http://code.msdn.microsoft.com/windowsapps/SearchBox-control-sample-0f64f94d">code.msdn.microsoft.com</a> . <br><br><h2>  Live tiles </h2><br>  Another thing to pay a little attention to is live tiles.  In Windows 8, the application could implement tiles of two sizes: square 150x150px and wide 310x150px.  In Windows 8.1, they added two more square sizes: a small 70x70px and a large 310x310px. <br><br>  To add their support to the application, you need to do two key manipulations: <br><br>  1. Prepare static images: <br><br><img src="http://img-fotki.yandex.ru/get/9327/25193168.1a/0_709e4_2ba78354_XXL.png"><br><br>  and specify them in the application manifest: <br><br><img src="http://img-fotki.yandex.ru/get/9253/25193168.1a/0_709e5_d931113b_XXL.png"><br><br>  As well as for Windows 8, if you wish, you can provide the application with images of tiles for different scaling modes (depending on DPI). <br><br>  2. Update the live tile generation code to include new templates.  Let us dwell on this in a bit more detail. <br><br>  As you may know, ready <a href="http://msdn.microsoft.com/ru-ru/library/windows/apps/hh761491.aspx">-</a> made <a href="http://msdn.microsoft.com/ru-ru/library/windows/apps/hh761491.aspx">XML templates</a> are available for specifying live tiles that are accessible through the corresponding APIs.  In some cases, it may be more convenient to work with them as with text, especially when you need to update templates for several tile sizes at once, as in our case. <br><br>  Our update tiles look something like this: <br><br><pre> <code class="hljs pgsql"> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> UpdateImageTile() { var <span class="hljs-type"><span class="hljs-type">xml</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XmlDocument(); <span class="hljs-type"><span class="hljs-type">xml</span></span>.LoadXml( string.Format( @"&lt;?xml version=""1.0"" encoding=""utf-8"" ?&gt; &lt;tile&gt; &lt;visual branding=""none""&gt; &lt;binding template=""TileSquareImage""&gt; &lt;image id=""1"" src=""{0}"" alt=""{1}""/&gt; &lt;/binding&gt; &lt;binding template=""TileWidePeekImage03""&gt; &lt;image id=""1"" src=""{0}"" alt=""{1}""/&gt; &lt;text id=""1""&gt;{1}&lt;/text&gt; &lt;/binding&gt; &lt;/visual&gt; &lt;/tile&gt;", Entity.Thumbnails.OrderByDescending(x =&gt; x.Width).FirstOrDefault().Url, Entity.Title)); TileUpdateManager.CreateTileUpdaterForApplication().<span class="hljs-keyword"><span class="hljs-keyword">Update</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> TileNotification(<span class="hljs-type"><span class="hljs-type">xml</span></span>)); }</code> </pre> <br><br>  In this case, we just show a preview image of one of the reports on the live tile.  In the case of a wide tile, we use an animation template.  Patterns for square and wide tiles are collected in one line. <br><br>  To add a large square tile, we need: <br><ul><li>  Update template version to 2 </li><li>  Change template names to reflect new sizes. </li><li>  "Stick" below another pattern. </li></ul><br>  The result should be something like this: <br><br><pre> <code class="hljs pgsql"> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> UpdateImageTile() { var <span class="hljs-type"><span class="hljs-type">xml</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XmlDocument(); <span class="hljs-type"><span class="hljs-type">xml</span></span>.LoadXml( string.Format( @"&lt;?xml version=""1.0"" encoding=""utf-8"" ?&gt; &lt;tile&gt; &lt;visual branding=""none"" version=""2""&gt; &lt;binding template=""TileSquare150x150Image"" fallback=""TileSquareImage""&gt; &lt;image id=""1"" src=""{0}"" alt=""{1}""/&gt; &lt;/binding&gt; &lt;binding template=""TileWide310x150PeekImage03"" fallback=""TileWidePeekImage03""&gt; &lt;image id=""1"" src=""{0}"" alt=""{1}""/&gt; &lt;text id=""1""&gt;{1}&lt;/text&gt; &lt;/binding&gt; &lt;binding template=""TileSquare310x310ImageAndText01""&gt; &lt;image id=""1"" src=""{0}"" alt=""{1}""/&gt; &lt;text id=""1""&gt;{1}&lt;/text&gt; &lt;/binding&gt; &lt;/visual&gt; &lt;/tile&gt;" , Entity.Thumbnails.OrderByDescending(x =&gt; x.Width).FirstOrDefault().Url, Entity.Title)); TileUpdateManager.CreateTileUpdaterForApplication().<span class="hljs-keyword"><span class="hljs-keyword">Update</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> TileNotification(<span class="hljs-type"><span class="hljs-type">xml</span></span>)); }</code> </pre> <br><br>  Done! <br><br>  By the way, in Windows 8.1 you can add the display of live tiles also through the manifest: <br><br><img src="http://img-fotki.yandex.ru/get/6725/25193168.1a/0_709e6_f4b3ef19_XXL.png"><br><br><h2>  Summing up </h2><br><img src="http://img-fotki.yandex.ru/get/9262/25193168.1a/0_709e7_30031234_XXL.png"><br><br>  So why is it worth updating an application under Windows 8.1?  Firstly, this performance increase even without updating the code simply due to the fact that many controls were optimized in W8.1.  Secondly, these are all new features, including new tile sizes, new controls, and new APIs.  Third, it takes into account changes in the operating system itself: in particular, the modes of displaying applications on the screen and the search behavior. <br><br>  What you need to do to update: <br><ol><li>  To redirect the project in VS2013 from Windows 8 to Windows 8.1 </li><li>  Update the logic of switching the display modes of the application so that it depends on the size of the ‚Äúwindow‚Äù and the ratio of width and height, rather than specific states (full, fill, snapped) and orientation of the device. </li><li>  Update search activation: <ul><li>  a.  If a search contract was used, at least add an activation button within the application </li><li>  b.  Try to search inside an application using SearchBox </li></ul></li><li>  Add new tile sizes <ul><li>  a.  Draw two more sizes of static tiles </li><li>  b.  Update live tile generation code. </li></ul></li></ol><br><br>  Further improvements are at your discretion.  Successful migration! </div><p>Source: <a href="https://habr.com/ru/post/202562/">https://habr.com/ru/post/202562/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../202548/index.html">New mitigation mechanisms in Windows 8.1</a></li>
<li><a href="../202550/index.html">Shopping list</a></li>
<li><a href="../202554/index.html">Dmitry Sklyarov: ‚ÄúAttentiveness and some logic. How complicated is simple. ‚Äù</a></li>
<li><a href="../202556/index.html">JavaScript race (30 lines of code)</a></li>
<li><a href="../202560/index.html">English idioms with names</a></li>
<li><a href="../202564/index.html">Microsoft has released a 3D printing program for a mass audience.</a></li>
<li><a href="../202566/index.html">Ratings, or why a sex shop forum?</a></li>
<li><a href="../202568/index.html">Idea: Closed discussion / pre-presentation</a></li>
<li><a href="../202570/index.html">US Senate Bitcoin Hearings: Department of Justice Reports and SECs</a></li>
<li><a href="../202572/index.html">3D print show in Paris first hand</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>