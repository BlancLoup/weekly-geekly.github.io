<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Own WebGL engine. Article number 1. Canvas</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Through a series of articles I will try to disassemble the engine on the webgl. 

 The basic requirement is minimum data entry. After all, roughly spe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Own WebGL engine. Article number 1. Canvas</h1><div class="post__text post__text-html js-mediator-article">  Through a series of articles I will try to disassemble the engine on the webgl. <br><br>  The basic requirement is minimum data entry.  After all, roughly speaking, the engine is a model created to simplify the task.  The material is designed for beginners, for those who read the basics of webgl and wants to try to start working.  Those like me. <br><br><h5>  The first.  Task description on fingers </h5><br>  It is necessary to create classes of objects (primitives), which from a set of points.  At the same time, the primitives should be independent of each other.  Each primitive can be moved, rotated around the center or around an arbitrary point. <br>  It is necessary to create a mechanism for describing these objects. <br>  And finally, you need to create something like a map on which you can install our objects and on which you can move freely. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><h5>  The second.  Mechanism of the outline </h5><br>  The mechanism of painting, just a canvas and paint for the artist.  What is the necessary minimum that the user of our engine must finally bring in so that he has a canvas ready?  In my opinion, this is just a link to the DOM canvas.  And then you can set the color and size. <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scene = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Scene(<span class="hljs-string"><span class="hljs-string">"webglID"</span></span>); scene.setBackgroundColor([<span class="hljs-number"><span class="hljs-number">0.1</span></span>,<span class="hljs-number"><span class="hljs-number">0.5</span></span>,<span class="hljs-number"><span class="hljs-number">0.6</span></span>,<span class="hljs-number"><span class="hljs-number">0.2</span></span>]); scene.setViewPort(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">300</span></span>);</code> </pre> <br><br>  What could be easier if we consider that we only need the first line? <br>  "WebglID" is the id of the canvas element in which the drawing will occur. <br>  The implementation of this mechanism is also not a big deal, as long as there is no drawing. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Scene</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">canvasID</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.backgroundColor = {<span class="hljs-attr"><span class="hljs-attr">red</span></span>:<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-attr"><span class="hljs-attr">green</span></span>:<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-attr"><span class="hljs-attr">blue</span></span>:<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-attr"><span class="hljs-attr">alpha</span></span>:<span class="hljs-number"><span class="hljs-number">1.0</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.canvas = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(canvasID); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getContext(); } Scene.prototype = { <span class="hljs-attr"><span class="hljs-attr">setViewPort</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">width,height</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl.viewportWidth = width; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl.viewportHeight = height; }, <span class="hljs-attr"><span class="hljs-attr">setBackgroundColor</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">colorVec</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (colorVec){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (colorVec.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.backgroundColor.red = colorVec[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (colorVec.length &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.backgroundColor.green = colorVec[<span class="hljs-number"><span class="hljs-number">1</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (colorVec.length &gt; <span class="hljs-number"><span class="hljs-number">2</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.backgroundColor.blue = colorVec[<span class="hljs-number"><span class="hljs-number">2</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (colorVec.alpha &gt; <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.backgroundColor.red = colorVec[<span class="hljs-number"><span class="hljs-number">3</span></span>]; } } }, <span class="hljs-attr"><span class="hljs-attr">getContext</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> names = [<span class="hljs-string"><span class="hljs-string">"webgl"</span></span>, <span class="hljs-string"><span class="hljs-string">"experimental-webgl"</span></span>, <span class="hljs-string"><span class="hljs-string">"webkit-3d"</span></span>, <span class="hljs-string"><span class="hljs-string">"moz-webgl"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ii = <span class="hljs-number"><span class="hljs-number">0</span></span>; ii &lt; names.length; ++ii) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.canvas.getContext(names[ii]); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(e) {} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } }</code> </pre><br><br>  (The getContext method is taken from the <a href="http://habrahabr.ru/post/112430/">article</a> . (Just wrote before - this.gl = this.canvas.getContext ("webgl");) <br><br><h6>  Canvas is created, it remains to purchase brushes and paints </h6><br>  Before you add the ability to draw in our engine, you need to decide: <br><ol><li>  We will draw by vertices or indices. </li><li>  What figures will our primitives consist of? </li></ol><br><ul><li>  LINES </li><li>  LINE_STRIP </li><li>  LINE_LOOP </li><li>  TRIANGLES </li><li>  TRIANGLE_STRIP </li><li>  TRIANGLE_FAN </li><li>  POINTS </li></ul><br><br>  For the engine, I chose to draw by index, as it seems to me, it is obvious.  A type of figure - TRIANGLES.  It is less obvious here, but I will try to explain. <br><br>  We will use one buffer for all objects and, accordingly, all vertices and indices.  Further, if it is possible to use several buffers, the type of the figure will be located in the primitive object itself.  (If you already have such an opportunity - please write in the comments.) At the same time, the objects should be independent from each other, so we still have a choice among - LINES, TRIANGLES and POINTS.  I chose TRIANGLES as a figure filling in from the inside. <br><br>  The drawing process itself will consist of two stages - we add the object (s) to the scene and draw the whole scene.  In fact, in the future it will be 3 stages - the detection of objects that we need to draw, adding to the scene, and of drawing the whole scene. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vertex = [ <span class="hljs-number"><span class="hljs-number">-50</span></span>,<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-number"><span class="hljs-number">-50</span></span>,<span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">-50</span></span>,<span class="hljs-number"><span class="hljs-number">-50</span></span>,<span class="hljs-number"><span class="hljs-number">50</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> indices = [<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> botuObject(vertex,indices); scene.AddObject(obj); scene.draw();</code> </pre><br><br>  botuObject is our first primitive.  Not the most elegant, well, what is.  It simply contains the vertices and indices that are passed to it.  By and large, all primitives will contain vertices and indices, only other primitives will calculate these vertices themselves, during initialization.  About them will be written in detail in subsequent articles. <br><br>  Primitive implementation: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">botuObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">vertex,indices</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.vertex = vertex; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.indices = indices; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.vertex.size = <span class="hljs-number"><span class="hljs-number">3</span></span>; }</code> </pre><br><br>  Canvas final version: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*.  WebGl. canvasID - id  canvas  html */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Scene</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">canvasID</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.backgroundColor = {<span class="hljs-attr"><span class="hljs-attr">red</span></span>:<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-attr"><span class="hljs-attr">green</span></span>:<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-attr"><span class="hljs-attr">blue</span></span>:<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-attr"><span class="hljs-attr">alpha</span></span>:<span class="hljs-number"><span class="hljs-number">1.0</span></span>}; <span class="hljs-comment"><span class="hljs-comment">/* */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.canvas = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(canvasID); <span class="hljs-comment"><span class="hljs-comment">/* webgl Context*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getContext(); <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.indicBuffer = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.vecVertex = []; <span class="hljs-comment"><span class="hljs-comment">/* */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.vecIndices = []; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.initProgram(<span class="hljs-string"><span class="hljs-string">"vertexShader"</span></span>, <span class="hljs-string"><span class="hljs-string">"fragmentShader"</span></span>); } Scene.prototype = { <span class="hljs-comment"><span class="hljs-comment">/* ,     */</span></span> clear: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.indicBuffer = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.vecVertex = []; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.vecIndices = []; }, <span class="hljs-comment"><span class="hljs-comment">/* WebGl Context,    */</span></span> getContext:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> names = [<span class="hljs-string"><span class="hljs-string">"webgl"</span></span>, <span class="hljs-string"><span class="hljs-string">"experimental-webgl"</span></span>, <span class="hljs-string"><span class="hljs-string">"webkit-3d"</span></span>, <span class="hljs-string"><span class="hljs-string">"moz-webgl"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ii = <span class="hljs-number"><span class="hljs-number">0</span></span>; ii &lt; names.length; ++ii) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.canvas.getContext(names[ii]); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(e) {} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } }, <span class="hljs-comment"><span class="hljs-comment">/*   .        vertex,   2  ,         2-  */</span></span> initBuffers: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">vertex, indices</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.vertexBuffer = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl.createBuffer(); <span class="hljs-comment"><span class="hljs-comment">/* */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.vertexBuffer.size = vertex.size; <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl.bindBuffer(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl.ARRAY_BUFFER, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.vertexBuffer); <span class="hljs-comment"><span class="hljs-comment">/*   - botuPosition*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.program.botuPositionAttr = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl.getAttribLocation(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.program, <span class="hljs-string"><span class="hljs-string">"botuPosition"</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* ,        - this.program.botuPositionAttr*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl.enableVertexAttribArray(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.program.botuPositionAttr); <span class="hljs-comment"><span class="hljs-comment">/*  ,    Float32,    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl.bufferData(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl.ARRAY_BUFFER,<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Float32Array</span></span>(vertex), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl.STATIC_DRAW); <span class="hljs-comment"><span class="hljs-comment">/*    this.program.botuPositionAttr,   - this.vertexBuffer.size   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl.vertexAttribPointer(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.program.botuPositionAttr,<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.vertexBuffer.size,<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl.FLOAT,<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(indices) { <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.indicBuffer = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl.createBuffer(); <span class="hljs-comment"><span class="hljs-comment">/* -   - */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.indicBuffer.numberOfItems = indices.length; <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl.bindBuffer(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl.ELEMENT_ARRAY_BUFFER, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.indicBuffer); <span class="hljs-comment"><span class="hljs-comment">/*  ,     Uint16,    indices*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl.bufferData(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl.ELEMENT_ARRAY_BUFFER, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Uint16Array</span></span>(indices), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl.STATIC_DRAW); } }, <span class="hljs-comment"><span class="hljs-comment">/*  , vxShaderDom - id  script      , frShaderDom - id  script       */</span></span> initProgram: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">vxShaderDom, frShaderDom</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vxShader = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(vxShaderDom).textContent; <span class="hljs-comment"><span class="hljs-comment">/* */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> frShader = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(frShaderDom).textContent; <span class="hljs-comment"><span class="hljs-comment">/*    this.gl  :   vxShader    - frShader*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.program = createProgram(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl,vxShader, frShader); <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gl.useProgram(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.program); <span class="hljs-comment"><span class="hljs-comment">/*     - vxs    - frs     context*/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProgram</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">context, vxs, frs</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prg = context.createProgram(); <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> VertexShader = createShader(context, context.VERTEX_SHADER, vxs); <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> FragmentShader = createShader(context, context.FRAGMENT_SHADER, frs); <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> context.attachShader(prg,VertexShader); <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> context.attachShader(prg,FragmentShader); <span class="hljs-comment"><span class="hljs-comment">/*    - context*/</span></span> context.linkProgram(prg); <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!context.getProgramParameter(prg, context.LINK_STATUS)) { <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> alert(context.getProgramInfoLog(prg)); } <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prg; } <span class="hljs-comment"><span class="hljs-comment">/*    context   type,    - shader*/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createShader</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">context,type,shader</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*    - type*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sh = context.createShader(type); <span class="hljs-comment"><span class="hljs-comment">/*  - shader*/</span></span> context.shaderSource(sh, shader); <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> context.compileShader(sh); <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!context.getShaderParameter(sh, context.COMPILE_STATUS)) { <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> alert(context.getShaderInfoLog(sh)); } <span class="hljs-comment"><span class="hljs-comment">//   return sh; } }, /*  - width   - height */ setViewPort: function(width,height){ this.gl.viewportWidth = width; this.gl.viewportHeight = height; }, /*     colorVec*/ setBackgroundColor: function(colorVec){ if (colorVec){ if (colorVec.length &gt; 0) { /* */ this.backgroundColor.red = colorVec[0]; } if (colorVec.length &gt; 1) { /*- */ this.backgroundColor.green = colorVec[1]; } if (colorVec.length &gt; 2) { /*- */ this.backgroundColor.blue = colorVec[2]; } } }, /*  botuObj  */ AddObject: function(botuObj){ /*   */ this.vecVertex.size = botuObj.vertex.size; /*-    */ var next = Math.max(this.vecVertex.length / this.vecVertex.size,0); /*  */ this.vecVertex = this.vecVertex.concat(botuObj.vertex); /*  ,              */ this.vecIndices = this.vecIndices.concat(botuObj.indices.map(function(i){return i + next})); /* */ this.vecVertex.size = botuObj.vertex.size; }, /**/ draw: function () { /*  */ this.gl.viewport(0, 0, this.gl.viewportWidth, this.gl.viewportHeight); /*  */ this.gl.clearColor(this.backgroundColor.red,this.backgroundColor.green,this.backgroundColor.blue,this.backgroundColor.alpha); /*- */ this.gl.clear(this.gl.COLOR_BUFFER_BIT); /*         this.vecVertex    this.vecIndices*/ this.initBuffers(this.vecVertex, this.vecIndices); /*    - DEPTH_TEST*/ this.gl.enable(this.gl.DEPTH_TEST); /*   -  - TRIANGLES, -  - this.indicBuffer.numberOfItems*/ this.gl.drawElements(this.gl.TRIANGLES, this.indicBuffer.numberOfItems, this.gl.UNSIGNED_SHORT, 0); } }</span></span></code> </pre><br><br>  Reading someone else's code is the most ungrateful thing, except when it is a master code.  This code does not pretend to this, so in brief about all the methods: <br><br><ul><li>  clear.  Clears the vertices and indexes that will fill the buffer for drawing.  Originally created for animation, will later be used with any dynamics. </li><li>  getContext has already been mentioned.  Taken from the <a href="http://habrahabr.ru/post/112430/">article</a> .  Context initialization  Used only at the very beginning to customize the canvas. </li><li>  initProgram.  Creation of the program and shaders.  It is worth stopping here and discussing a small flaw in my engine - while the shaders are stored separately and should be in standard form (at least), then the flaw will be corrected. </li><li>  attributeSetup.  If we add a new attribute to the shaders, this method will initialize this attribute. </li><li>  initBuffers  Build and initialize buffers.  We use arrays of loaded primitive objects. </li><li>  setViewPort.  Set the width and height of the canvas. </li><li>  setBackgroundColor.  Set the canvas background. </li><li>  AddObject.  Add a primitive.  To primitive only 2 requirements - the presence of an array of vertices and indices. </li><li>  draw.  Actually drawing itself. </li></ul><br><br>  So, the first obvious ‚Äúdefect‚Äù of the engine is shaders.  I have them installed as follows: <br><br><pre> <code class="javascript hljs"> &lt;script type=<span class="hljs-string"><span class="hljs-string">"x-shader"</span></span> id=<span class="hljs-string"><span class="hljs-string">"vertexShader"</span></span>&gt; attribute vec3 botuPosition; varying vec4 colorPos; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> main(){ colorPos = abs(vec4(botuPosition.x, botuPosition.y, botuPosition.z,<span class="hljs-number"><span class="hljs-number">200.0</span></span>) / <span class="hljs-number"><span class="hljs-number">200.0</span></span>); gl_Position = vec4(botuPosition,<span class="hljs-number"><span class="hljs-number">200</span></span>); } &lt;<span class="hljs-regexp"><span class="hljs-regexp">/script&gt; &lt;script type="x-shader" id="fragmentShader"&gt; precision highp float; varying vec4 colorPos; void main(){ gl_FragColor = colorPos; } &lt;/</span></span>script&gt;</code> </pre><br><br>  This is a temporary option.  When adding texturing, the shaders will need to be corrected a little. <br><br><h4>  What's next </h4><br>  In the next article - the description of the "samopisny" matrix  And also the first ‚Äúnormal‚Äù primitive is a cube. </div><p>Source: <a href="https://habr.com/ru/post/227201/">https://habr.com/ru/post/227201/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../227189/index.html">Hola: principles of work</a></li>
<li><a href="../227193/index.html">Creating offline maps for iOS applications</a></li>
<li><a href="../227195/index.html">Reflections on the blues - once again about exception handling</a></li>
<li><a href="../227197/index.html">Porting a Windows 8.1 application to Windows Phone 8.0 with troubleshooting</a></li>
<li><a href="../227199/index.html">Modern aspects of the presentation of texts in the analysis of natural language: classical and alternative approaches</a></li>
<li><a href="../227203/index.html">Migration and Coexistence of Mail Systems</a></li>
<li><a href="../227205/index.html">Autotiling: automatic tile transitions</a></li>
<li><a href="../227209/index.html">The line between the cargo cult and the evolution in learning success</a></li>
<li><a href="../227211/index.html">Increase website conversion: How to use cognitive beliefs</a></li>
<li><a href="../227213/index.html">Dell is preparing for the arrival of ARM processors in servers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>