<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Crawler for crawler</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For a number of applications related to monitoring Internet resources and collecting statistics, the task of searching for textual information in the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Crawler for crawler</h1><div class="post__text post__text-html js-mediator-article"><img src="http://data.whicdn.com/images/137052514/large.png" width="250" align="left" alt="image"><br>  For a number of applications related to monitoring Internet resources and collecting statistics, the task of searching for textual information in the network is relevant.  What exactly is this useful for and how? <br><br clear="left">  If interested, then welcome under the cat! <br><a name="habracut"></a><br>  Vivid examples are the tasks of copywriting, search for borrowing, document leaks, in the end.  Do you need your own crawler for this or you can use search engines?  In the course of resolving this issue, an idea arose to write a ‚Äúcrawler for a crawler,‚Äù in other words, collecting data from search engines for a given request. <br><br>  The first reasonable question: why not use the regular search engine API?  If we use only one search engine, then the API is also possible, but for this we will need to monitor its changes and edit our code.  We decided to make a universal mechanism: replacing the XPath in the settings, you can tune in to work with any search engines (but not limited to them).  Of course, I had to consider working with the list of proxies so that, firstly, they would not be banned, and, secondly, so that they could receive search results for different regions (using the proxy geoIP). <br><br>  When building the structure of the application, a step was taken towards cross-platform development using the microservice architecture based on docker containers. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/59/ef/40/59ef40a7bf717624832504.png"><br><br>  The scheme of the application is extremely simple: the interface of interaction with the system is implemented in flask, at the input of which a JSON-RPC request is expected which has the following form: <br><br><pre><code class="python hljs">requests.post(<span class="hljs-string"><span class="hljs-string">'http://127.0.0.1:5000/social'</span></span>, json={ <span class="hljs-string"><span class="hljs-string">"jsonrpc"</span></span>:<span class="hljs-string"><span class="hljs-string">"2.0"</span></span>, <span class="hljs-string"><span class="hljs-string">'id'</span></span>:<span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-string"><span class="hljs-string">'method'</span></span>:<span class="hljs-string"><span class="hljs-string">'initialize'</span></span>, <span class="hljs-string"><span class="hljs-string">'params'</span></span>:{ <span class="hljs-string"><span class="hljs-string">'settings'</span></span>:{ <span class="hljs-string"><span class="hljs-string">'searcher'</span></span>:<span class="hljs-string"><span class="hljs-string">'&lt;  &gt;'</span></span>, <span class="hljs-string"><span class="hljs-string">'search_q'</span></span>:[ <span class="hljs-string"><span class="hljs-string">'why people hate php'</span></span> ], <span class="hljs-string"><span class="hljs-string">'count'</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> } } })</code> </pre> <br>  Next, the task is initialized in the RabbitMQ queue.  When its turn comes, the task processing module takes it into development.  During the process, the current proxy is provided, a browser emulator is created. <br><br>  Why should we use that ill-starred emulation, and not use our favorite requests?  The answer is simple: <br><br><ul><li>  to solve problems with dynamically loaded content; </li><li>  <s>pretend to be a snake</s> (a user with a real browser) to delay proxy blocking. </li></ul><br>  For this purpose, the <a href="http://www.seleniumhq.org/docs/03_webdriver.jsp">selenium webdriver is used</a> , which allows us to get the page in the form in which the user receives it in his browser (with all the scripts and checks that have been worked out), and, if necessary, makes it possible to simulate actions on the page, for example, to get the next piece of data. <br><br>  Fortunately, in most search engines, the process of obtaining the next page occurs by clicking on a pre-arranged link, and it can be implemented using GET queries, incrementing its number. <br><br>  As soon as the desired page is received by us, the business remains for the small one and it will be happy to be executed by parser (using the config file that we constructed containing the necessary elements Xpath), which, in turn, will send the information of interest to us to MongoDB. <br>  At each stage of execution, Redis indicates the processing status of a task, based on its id. <br><br>  Consider possible problems we may encounter: <br><br><ol><li>  Advertisement in the issue - noise data, inflates the database; </li><li>  Sites can load content dynamically, for example, when scrolling a page; </li><li>  Captcha - well, everything is obvious here. </li></ol><br>  If the site masks ads among useful content, then <a href="https://stackoverflow.com/questions/20832159/python-using-adblock-with-selenium-and-firefox-webdriver">firefox webdriver + adblock + selenium</a> comes to the rescue.  However, in the case of search engines, advertising is easily detected with the help of XPATH and is removed from the list. <br><br>  So, captcha is our worst enemy. <br>  Recognizing it is a non-trivial task and requires significant resources for implementation.  So we will look for a way around. <br><br>  And we found it by us!  For this we will use a proxy.  As it turned out, most of the proxies, which are in the public domain, do not allow us to bypass our opponent (since they have long since become sore and banned), the situation with paid proxies is slightly better, but also not perfect (and still gives us a ray of light in the dark kingdom). <br><br>  The first thought is to play around with the user-agent.  It was experimentally found out that the frequent rotation of the user agent only brought the proxy closer to a premature death (no one canceled the blocking of the proxy by search services).  The correct solution for extending the life of a proxy turned out to be the inclusion of a timeout for its use, requests should go with some delay.  This, of course, is not a panacea, but better than nothing. <br><br>  You can also use anti-captcha service, but that's another story ... <br><br>  As a result, we got the architecture and <a href="https://github.com/mixamax007/crawler">prototype of the system</a> , which allows to collect data from search and other sources. <br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/340994/">https://habr.com/ru/post/340994/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../340978/index.html">PostgreSQL Indexes - 7</a></li>
<li><a href="../340982/index.html">Mathematical model of a vibrating level gauge with a resonator in the form of a cantilever elliptical tube</a></li>
<li><a href="../340984/index.html">Ethereum smart contract to calculate bonuses using fractional degrees</a></li>
<li><a href="../340986/index.html">Six questions for FrontFest speakers</a></li>
<li><a href="../340992/index.html">Blockchain: how it works, and why this technology will change the world</a></li>
<li><a href="../340996/index.html">Building projects with GitLab CI: one .gitlab-ci.yml for hundreds of applications</a></li>
<li><a href="../340998/index.html">UI Solitaire: Making Your StackView in Android</a></li>
<li><a href="../341000/index.html">Digest of IT events for November</a></li>
<li><a href="../341002/index.html">Installing FlexLM on Ubuntu Server 16</a></li>
<li><a href="../341004/index.html">Computer predicted the victory of the United States in Vietnam</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>