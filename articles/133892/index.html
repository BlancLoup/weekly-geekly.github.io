<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The tale of how the tower robot collected</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Immediately make a reservation that under the "towers" in the title of the post means the puzzle game "Sarov towers", located on the website bashni.or...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The tale of how the tower robot collected</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/fc6b5f95/9ba61ecc/9892cae8/3b6aa17b.png"><br><br>  Immediately make a reservation that under the "towers" in the title of the post means the puzzle game "Sarov towers", located on the website <a href="http://bashni.org/">bashni.org</a> , the existence of which I learned from a habrapost <a href="http://habrahabr.ru/blogs/i_am_advertising/118862/">How to build a tower</a> . <br><br>  If you are familiar with this game and this site, then no further explanation is required, if not - you can go over both links to understand what it is about. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Well, or you can just read about how one lazy programmer wanted to automate the process of solving a puzzle, over the hands of which sometimes people used to beat the IQ going wild, and what came of it all. <br><a name="habracut"></a><br><h5>  Introduction </h5><br>  So, in October 2011, I came across the above article, and, by virtue of my craving for various puzzles, ‚Äúhooked‚Äù on this game.  He collected the towers little by little, with time getting better and better, but often he turned out to be a bit more experienced opponents, or could not repeat the result they had already achieved. <br><br>  Here is the time to mention the competitive element of the game, if you certainly have not had time to learn about it from the links I have provided.  The bottom line is that the task is not just to solve the puzzle, but to do it in fewer moves than other players.  Because  each layout has a unique number, and the site keeps statistics of all assemblies, then all this is very clearly shown, and creates a completely competitive atmosphere. <br><br>  And so, once again, having failed to overtake, or at least just catch up with the honored masters of sports in tower engineering, I decided to use ‚Äúdope‚Äù, i.e.  write a program to solve the problem.  In the end, shouldn't robots work instead of humans in the progressive third millennium? <br><br>  An additional incentive for me was that the creator of the game, notorious in the <a href="http://habrahabr.ru/users/papabubadiop/" class="user_link">PapaBubaDiop Habr√©</a> , <a href="http://habrahabr.ru/blogs/i_am_advertising/118862/">repeatedly</a> <a href="http://habrahabr.ru/blogs/i_am_advertising/118862/">stated</a> in the comments to that article that the number of <a href="http://habrahabr.ru/users/papabubadiop/" class="user_link">turn</a> options in complex layouts is very large, and you can programmatically select them for a very, very long time, while another <a href="http://habrahabr.ru/users/volerog/" class="user_link">volerog</a> <a href="http://habrahabr.ru/blogs/i_am_advertising/118862/">claimed</a> that he already wrote a bot that can solve most of the towers in a matter of minutes. <br><br>  In general, without delaying the case indefinitely, I began to write the code. <br><br>  Because  My main working tool is JavaScript, and the game is browser-based, then writing a program in this language was a natural solution.  Many of course may argue that the interpreted scripting language is not best suited for processing large amounts of information, and it would be better to write all this in C (or even Asm, ‚Äúfor truly‚Äù), but such efforts for the Just for fun task seemed excessive to me . <br><br>  I was even too lazy to do something like plug-in userscript for the browser from the program, and I limited myself to copying the code to the dev console (the same one that is called by the F12 button in FF and Chrome).  Actually, it was Chrome, which has the fastest JavaScript engine I know of, and became my test site. <br><br>  If the reader to this place has not yet at least fluently familiarized with the rules of the game, then it‚Äôs worth it on <a href="http://bashni.org/rules">this wonderful page</a> , where everything is very accessible, and even there is a vivid animation example.  Fortunately, these rules are very simple and concise. <br>  Have you read?  Great, go ahead. <br><br><h5>  The first pancake - lumpy </h5><br>  The first version of the program was very primitive, and simply checked all possible solutions from left to right (in the order of the columns).  The initial alignment was taken, the first column was searched, which allowed the move to be allowed by the rules, the move was made (virtually), a recursive return to the first paragraph of the algorithm went on, only now it was not the initial position of the towers that was taken as a base, but what happened after the move. <br><br>  And so many, many times, the banal decision tree. <br>  If at the next move the puzzle was solved (i.e., all the towers turned out to be assembled), then the solution was remembered with the number of moves spent on it.  According to the results of the program, a solution was used with the least number of moves found. <br><br>  One of the basic optimizations was cutting of branches of moves whose length exceeded the solutions already found, which is quite obvious, since  no use of such branches. <br><br>  The second optimization was the check for "blocks-neighbors", i.e.  blocks of the same color with adjacent numbers, for example.  3 and 4. Since such blocks after folding are combined and can be moved at the same time, I decided that all the ‚Äúneighbors‚Äù should be connected always, as soon as the opportunity arises, and not create extra branches of options.  As a result, if the program saw, for example, red 3 and 4, then it always first put the top three on the four, and only then went through the search.  This greatly reduced the time of the script, because  the more blocks ‚Äústuck together‚Äù together, the fewer moves there were left. <br><br>  The script quite tolerably worked on the "African" towers (the minimum level of complexity), finding a solution in 1-2 minutes, and sometimes less.  However, on the ‚ÄúHanoi‚Äù he was already late for 15-30 minutes, and I was even afraid to take on the ‚ÄúSarov‚Äù. <br><br>  In addition, a couple of times I noticed that the program, even sorting through all the possible options, cannot repeat the result achieved by the players, and lags behind him by 1-2 moves.  As it turned out later, the reason for this was my optimization on ‚Äúblock-neighbors‚Äù, since  it was based only on my empirical assumption (I myself did this when I played with my ‚Äúhead‚Äù), and not on any objective arguments. <br><br>  However, if you completely turn off this optimization, then the time to solve puzzles goes off scale, and even for African towers exceeded 15 minutes. <br><br>  It was necessary to change something. <br><br><h5>  Bug work </h5><br>  First, it was necessary to deal with the issue of gluing "blocks of neighbors."  The problem was that when they merged, we lost the ‚Äúfootprint‚Äù for smaller blocks.  For example, having ‚Äúnot glued‚Äù 4 and 5 of the same color in different columns, we could put blocks with values ‚Äã‚Äãfrom zero to three on each of them, and work with these two sets in parallel.  Often it was critical to save those 1-2 moves that led to the optimal solution. <br><br>  After certain conclusions, I came to the conclusion that we can unconditionally glue together only blocks where the upper brick of the upper block is zero or one.  Because  only in this case we are guaranteed not to suffer from the loss of ‚Äúseats‚Äù (on the block with a zero brick, you can‚Äôt put anything else on top, but you can only put zero on the block with a unit, and therefore there is no need to save 2 ‚Äúseats‚Äù, having only one possible variant of the ‚Äúlanding block‚Äù). <br><br>  Secondly, it was necessary to optimize the order of bypass options, because  busting the tree from left to right was extremely inefficient in cases where the best option was just on the right side. <br><br>  After each turn, I began to evaluate the "cost" of the current position of the towers as the difference between the total number of moves made at the moment and the number of "weak" moves.  Weakly call intermediate moves that do not immediately lead to the desired result (for example, when we put the red three on the top five, because later we will still have to shift it to the four).  Thus, the options with the least number of weak moves with respect to the overall progress of the decision had the best estimate. <br><br>  Options are queued based on their cost, and first of all, the options with the best rating are decided, because  they are the ones most likely to turn into the optimal solution.  By itself, this optimization is meaningless, because  to guarantee finding the best result, we still need to go through all the options, but in combination with discarding branches of solutions that are longer in length (and cost) already found, this allowed us to reduce the search time by orders of magnitude, because  short (although not always the best) solutions were found very quickly, usually in the very first seconds, after which huge branches of ‚Äúlong‚Äù solutions could be immediately thrown away, focusing on finding the optimum. <br><br>  Well, the third success of the whale was the chance observation that different branches of options (even with different number of moves) can lead to the same positions of the towers.  It is obvious that the further development of these options there is no reason to consider separately for each branch, because  with the same starting position and the decision tree will be the same. <br><br>  I began to make a text cast of each position after each move and put it into a hash table (which, as you know, underlies the work of objects in JS, which I used).  It turned out that there are significantly more such duplicate branches than I had anticipated, and, discarding them, we managed to reduce the search time by several times. <br><br>  There were a number of minor optimizations that are hardly worth mentioning here, for example, protection against looping moves or moving blocks from one empty space to another.  All this is quite obvious and does not significantly affect the algorithm. <br><br><h5>  Glory to the robots!  Kill all humans! </h5><br>  The final result exceeded all my expectations.  The script was solved by most African towers in a matter of seconds (1-3 on average), Hanoi - within 10 seconds, Russian (Sarov) - from 30 seconds to 10 minutes in most cases, and 20-30 minutes for the most difficult layouts that I met, including the first hundred of the "complicated" layouts. <br><br>  As it turned out, most of the towers of the middle and complex levels are not optimally solved by people, even taking into account the competitive element (that is, after the players tried several times to exceed each other‚Äôs results).  Usually, the script finds a solution by 1-2, and sometimes by 3-5 moves shorter than the best result in humans. <br><br>  Well, of course, iron brains are far ahead of human brains in terms of finding solutions. <br><br>  For some time I had fun, posing as a mega-brain, but after a week or two of everyday victories from a previously unknown player, ‚Äúthe bees began to suspect something,‚Äù and this process became quite boring, as usually happens if you play with ‚Äúcheats‚Äù . <br><br>  To the result of the two-day brain effort did not disappear completely in vain, I decided to tell this story here in Habr√©, and put the program code in open access. <br><br>  Let me explain why I am doing this. <br>  The game itself is wonderful, and I want to once again express my gratitude to its creator <a href="http://habrahabr.ru/users/papabubadiop/" class="user_link">PapaBubaDiop</a> , for undying enthusiasm.  However, the very same competitive element that was intended to be its highlight can also become its problem.  It is quite obvious at the moment that a bot that quickly finds the best solution can be created, and this can be done in a relatively short time, and many can do this (although not everyone, of course).  Once again, this is proved by the fact that the habrauser <a href="http://habrahabr.ru/users/rois/" class="user_link">Rois</a> recently created its own bot, no worse than mine (and perhaps better in terms of speed), apparently in order to understand if I can be a bot. <br><br>  I am writing this article and posting the code so that the guys who are serious about the competitive element in this game understand that yes - I can be a bot, Rois can be a bot, anyone can be a bot.  And you can never know about it if the bot owner sets himself such a goal (there are a lot of ways to look like a person, even if you are a bot).  And by purely technical means you will not reveal the bot, and you will not stop it. <br><br>  One can only reconsider the very concept of the competition or the attitude to their results. <br><br>  PS I will not support the code, of course, and if, for example, on the game site, something is changed so that it cannot read the initial position of the towers, those who want to correct it themselves. <br><br>  PPS I almost forgot :) <a href="http://pastebin.com/AJyR2E71">pastebin.com/AJyR2E71</a> - that's the code </div><p>Source: <a href="https://habr.com/ru/post/133892/">https://habr.com/ru/post/133892/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../133885/index.html">Online store fast</a></li>
<li><a href="../133886/index.html">QR on the computer!</a></li>
<li><a href="../133887/index.html">The first high-level programming language - Plankalk√ºl</a></li>
<li><a href="../133889/index.html">Samsung Omnia W - the first alternative</a></li>
<li><a href="../133891/index.html">Digital telephone systems for dummies. Part 1 - Voice Coding</a></li>
<li><a href="../133893/index.html">Square root extraction using normal Markov algorithms</a></li>
<li><a href="../133894/index.html">The complex of devices for automatic fare payment on the basis of a system of long-range RFID identification</a></li>
<li><a href="../133895/index.html">GTV Channel: Steve Jobs Documentary and NEXT. 1986 (Russian translation)</a></li>
<li><a href="../133896/index.html">Kaspersky vs SOPA</a></li>
<li><a href="../133897/index.html">Cross platform is cool</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>