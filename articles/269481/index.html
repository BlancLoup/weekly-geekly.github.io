<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>I am writing a CMS for PHP. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Despite numerous attempts to dissuade me from this undertaking, I still will continue as planned. Every comment of the previous part, I read and heede...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>I am writing a CMS for PHP. Part 2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/6e1/fc3/847/6e1fc384776f4257ad5356aafaf52ca1.jpg" alt="Php"><br><br>  Despite numerous attempts to dissuade me from this undertaking, I still will continue as planned.  Every comment of the previous part, I read and heeded.  I met both my own wishes of some people and strong recommendations not to turn my own bike.  I liked the comments of <a href="http://habrahabr.ru/users/ainu/" class="user_link">ainu</a> and <a href="http://habrahabr.ru/users/fesor/" class="user_link">Fesor</a> , in my opinion - a very constructive view of what is missing in the CMS &amp; Framework for today.  For example, the implementation of the task of a quick and easy way to create a blog for a person who is quite difficult to explain how to use it is extremely complex in nature.  And since such tasks appear more and more often, I decided to take up this idea closely. <br><a name="habracut"></a><br>  Can you imagine how convenient it is to realize the integration of social networks, the Analytics API and other ‚Äúsweets‚Äù of the current capabilities of the information technology world for the end user?  How simple and intuitive can you make an information resource interface?  I can continue to describe my ideas and goals for quite a long time, but until this happens, progress is not progressing, which means time is wasted.  We will come to all this in the following parts of my series of articles, but for now - on the case. <br><br><h4>  Project subdirectory hierarchy </h4><br><ul><li>  engine <br><ul><li>  Service </li><li>  System </li></ul><br></li><li>  module <br><ul><li>  Module </li><li>  ... </li></ul><br></li><li>  public <br><ul><li>  Downloads </li><li>  ... </li></ul><br></li><li>  view <br><ul><li>  Theme </li><li>  ... </li></ul><br></li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Very often, working with large projects, I met a huge number of folders containing one or another ‚Äúvital‚Äù component of a working system.  What can not be said for example about Django / Symfony.  Each of their folders is responsible for its own component that is, to some extent or other, autonomous, initially implying the fulfillment of certain goals.  The same can be said about many other frameworks, but now is not about that. <br><br>  The <b>engine</b> folder will contain system classes, as well as services providing the execution of a task. <br><br>  The <b>module</b> folder includes controllers with a description of routing, configuration files, cache files, and traits. <br><br>  The <b>public</b> folder contains files that are supposed to be directly accessed by the client by issuing the server directly.  In other words - files for download by users. <br><br>  The <b>view</b> folder will contain the themes folder with all the necessary components in the form of cascading styles, scripts, sass sources, pictures and other visible media content. <br><br><h4>  Architecture </h4><br>  In the last article, I was fascinated by the ignorance of design patterns.  In my defense, I can say that design patterns are not appropriate in all situations.  For example, using MVC / HMVC, I would easily be able to design a WEB application for PHP.  But if you take the same Pattern Facade or Observer, the overall picture is not so obvious, although you can imagine it. <br><br>  For a more visual explanation of what I want to achieve, I will give an example of the implementation of the authorization of a user in Django (Python): <br><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">auth_controller</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request)</span></span></span><span class="hljs-function">:</span></span> user = authenticate(username=request.POST[<span class="hljs-string"><span class="hljs-string">'username'</span></span>], password=request.POST[<span class="hljs-string"><span class="hljs-string">'password'</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> user.is_active: login(request, user)</code> </pre> <br>  Yes, I omitted many small details, but did not miss the most important thing and I want to achieve.  Such things as authorization / registration should be implemented at the time, as the Django development team showed us.  If the CMS services are designed using the <b>Facade pattern</b> , it will be possible to achieve fairly good results.  All checks, escapes and validations in this case should take place not in the controller, which I observe quite often, but in the service where the data will be filtered and the result will be reported as soon as the task is completed - to the controller, where the program cycle will continue.  Such small things at first glance will ease, speed up and avoid elementary mistakes that we often make because of inattention or ignorance of the input data processing process and the correct task cycle.  Therefore, I came to the conclusion that the Facade pattern will be the most correct in terms of the implementation of services of its CMS. <br><br>  The module itself will be implemented according to a similar principle but with some nuances.  Often there is a need to implement an elementary API, which with the use of CMS is a rather cumbersome and complex task, if this is not provided for by the system itself.  Therefore, the entry point of each module will be the parent method of the base module, the " <b>request</b> ", the argument of which will be the object that will contain the means for changing the resultant header set.  Thus, we will achieve the most modifiable and convenient interface for modifying the server response for a particular request, which is the main task of our controller. <br><br>  As an illustrative example - the implementation of RSS: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Module</span></span>/<span class="hljs-title"><span class="hljs-title">News</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RSS</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">request</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($request)</span></span></span><span class="hljs-function"> </span></span>{ $request-&gt;response-&gt;headers[<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>] = <span class="hljs-string"><span class="hljs-string">'application/xml'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">route</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($router)</span></span></span><span class="hljs-function"> </span></span>{ $router-&gt;map(<span class="hljs-string"><span class="hljs-string">'^rss\.xml$'</span></span>, [<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>, <span class="hljs-string"><span class="hljs-string">'feed'</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">feed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($io)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;service(<span class="hljs-string"><span class="hljs-string">'Rss'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;service(<span class="hljs-string"><span class="hljs-string">'News'</span></span>)-&gt;getLatest(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>)); } }</code> </pre><br>  The example is rather crude and does not show the whole idea of ‚Äã‚Äãwhat I wanted to show, but as I mentioned earlier, the modules may contain traits, in which we can store our controllers for clarity.  And if the module is too voluminous, nothing prevents the routing from passing a callback of the form ‚ÄúModule / News / Feed :: xml‚Äù from the same namespace. <br><br><h4>  Finally </h4><br>  As always, I look forward to constructive criticism from your side.  In the next part, taking into account the comments on this article, I‚Äôll post all the edits, acknowledgments, and the Github repository.  All the best! </div><p>Source: <a href="https://habr.com/ru/post/269481/">https://habr.com/ru/post/269481/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269471/index.html">Marshmallow. This must be done by everyone. Add SDK 23 support to our applications.</a></li>
<li><a href="../269473/index.html">Using gitlab continuous integration for deployment</a></li>
<li><a href="../269475/index.html">CQRS, UI, based on tasks, Event sources ... ah</a></li>
<li><a href="../269477/index.html">Why I bet on Elixir</a></li>
<li><a href="../269479/index.html">Conveniently create Composition Root using Autofac</a></li>
<li><a href="../269487/index.html">The digest of interesting materials for the mobile developer # 126 (October 19-25)</a></li>
<li><a href="../269489/index.html">How to make friends AWS Lambda and PostgreSQL</a></li>
<li><a href="../269491/index.html">Android 6.0: Doze Mode, App Standby, Runtime Permissions. Everything every developer needs to know</a></li>
<li><a href="../269493/index.html">Taming of the Shrew. We connect a single number to several mobile</a></li>
<li><a href="../269495/index.html">Extreme economy fonts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>