<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How and why to determine voice mail</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúThe subscriber is not a subscriber - please leave your message after the beep!‚Äù - we hear this automatic reply many times and are already used to han...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How and why to determine voice mail</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/y4/mx/3y/y4mx3y_tz9xlm_dhg_yh63kaaiq.jpeg"></div><br>  ‚ÄúThe subscriber is not a subscriber - please leave your message after the beep!‚Äù - we hear this automatic reply many times and are already used to hanging up, knowing that no one ever checks ‚Äúvoice mail‚Äù.  I, like all of my interviewees, would not even be able to check it without Google!  Why do operators need this weird thing?  And in order to take money for calls that would otherwise be free.  And not only from ordinary subscribers, but also from companies that use automatics for calls.  Imagine a store that confirms orders not with a call center in half an hour, but with a robot in ten seconds.  And some of these calls "go" to voicemail, spending the company's money and breaking statistics.  Under the cut - a detective story about early media, big data, machine learning and TensorFlow. <br><a name="habracut"></a><br><h2>  What kind of "free calls"? </h2><br>  Telephony is already a rather old area, with many ‚Äúhistorically formed‚Äù pieces and technical solutions twenty years ago.  For example, monetization: operator ‚ÄúA‚Äù pays operator ‚ÄúB‚Äù for the duration of the call to the telephone number served by operator ‚ÄúB‚Äù.  "All incoming calls are free!" - this is from here.  Operators receive money for calling their subscribers.  I remember, there used to be even tariffs, where they paid extra for incoming calls! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tv/f8/q9/tvf8q9z_vktxip_impwjwdc7lwe.jpeg"></div><br>  Such a solution has pros and cons.  If incoming and outgoing calls are roughly equal, then "no one owes anyone."  More incoming calls - the operator makes money.  More outgoing - spends.  Operators want to make money, so they are trying with all their might to maximize incoming and minimize outgoing.  One of such mechanisms for minimizing expenses is the agreement on ‚ÄúEarly Media‚Äù. <br><br><h2>  Early Media - when the subscriber is not a subscriber </h2><br>  What happens when the subscriber "A" from his cell phone calls the subscriber "B", who also has a cell phone?  A lot of things happen, but if you simplify as much as possible, then the operator ‚ÄúA‚Äù using the text protocol SIP sends the operator ‚ÄúB‚Äù a call request, and he starts looking for the subscriber ‚ÄúB‚Äù through the towers (actually via SS7 over PRI, but let's not talk about sad)  So that the ‚ÄúA‚Äù subscriber didn‚Äôt have silence on the phone at that time and it was possible to sell all kinds of ‚Äúreplace the dial tone‚Äù, the operators agreed on the state of ‚ÄúEarly Media‚Äù: while the operator ‚ÄúB‚Äù is looking for his subscriber, he can reply via SIP ‚Äúearly media "And start transmitting audio via RTP.  Hooters, music or "sorry, the subscriber is not a subscriber." 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The operators also agreed that the ‚Äúearly media‚Äù will not be charged as an incoming call, operator ‚ÄúA‚Äù does not pay operator ‚ÄúB‚Äù for this music or beeps.  And so that no one cheats, they also agreed to give the sound in the ‚Äúearly media‚Äù state only to the side of the caller and cut off such a call after 60 seconds.  Although with such limitations there are craftsmen doing something useful in the early media on the ‚Äúfree‚Äù 8-800-, but this is a separate story.  And our story about voice mail. <br><br><h2>  Voicemail as an "honest" way to take money </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/se/uj/gr/seujgrym7lp6zskxvky7vc9mrco.jpeg"></div><br>  If the operator did not find his subscriber, he did not earn money on the incoming call.  Telecom operators, like any commercial organizations, love to earn money, so a brilliant voice mail was invented.  The phrase ‚Äúleave a message after the signal‚Äù allows the receiving operator to ‚Äúaccept‚Äù the call even when the subscriber is not available.  Honestly write down 20 seconds of silence somewhere and, most importantly, take money from the calling operator for this.  The most cunning ones do not even wait for ‚Äúpiiip‚Äù and immediately take a call - what is the money to lose? <br><br><h2>  What a man can do to a robot is a sadness </h2><br>  Cellular subscribers voice mail, as a rule, no way.  For me personally, there is no difference, the phone will say ‚Äúthe subscriber is temporarily unavailable‚Äù or ‚Äúthe subscriber is temporarily unavailable, leave your message after the signal‚Äù.  I, like all my friends, will hang up the word "unavailable".  And what a single operator will pay a penny to another for such a call is not very interesting to me. <br><br>  It is quite another thing if I am Voximplant and on the basis of our platform automatic order confirmation is made in the online store.  Early media is also free with us, but for voice mail money will be withdrawn from the client‚Äôs account at the rates of the operator on whose phone the call was made.  The amount itself is small, but we multiply by thousands or tens of thousands of calls per day - and not so small anymore. <br><br>  But the automation is not limited to ‚Äúcall after the buyer has pressed the‚Äú buy ‚Äùbutton on the retailer's web page and suggest that you click on one or say‚Äú I confirm ‚Äùto confirm the order‚Äù.  There are automatic notifications about, for example, a concert ticket.  Statistics show that the subscriber had a call and he listened to the message - and in fact the message was ‚Äúlistened‚Äù to the voice mail.  Or even worse: automation calls around customers to, for example, discuss the conditions of the ordered house cleaning.  She synthesizes the client ‚Äúhello, this is a robot of such a company, calling about the ordered cleaning, connecting with the operator,‚Äù the operator synthesizes ‚Äúphoned to such and such client‚Äù and shows the order card in CRM, and then the operator talks for 20 seconds with silence in voice mail <br><br><h2>  First attempts to determine voice mail </h2><br>  We have been engaged in automating telephone and video calls for a long time, so the task of determining voice mail began to be solved several years ago.  What do all voice mails have in common?  They all have ‚Äúpi-and-and-and-and‚Äù, which is between ‚Äúleave your message after the signal‚Äù and transferring the call from ‚Äúearly media‚Äù to ‚Äúaccepted‚Äù.  The bad news is that ‚Äún-and-and-and-and‚Äù is different for everyone.  One beep, several, at the same frequency, at two, of different duration and frequency.  Moreover, the operators love this ‚Äúpi-and-and-and-and‚Äù to change from time to time.  I wonder why? .. <br><br>  Our first implementation used the Goertzel Algorithm to calculate the ‚Äúcarrier‚Äù frequency and the heuristic in order to recognize the voice mail sound when the frequency appeared in the audio stream.  Alas, this method, although it worked, had serious flaws.  If the operator changed the sound signal pattern, then the heuristics ‚Äúbroke‚Äù and we needed to manually update it under the new pi-pi-pi-pi-pi-pi.  False positives were much worse: ‚Äútricky‚Äù signals at two frequencies were difficult to distinguish from the human voice and showed voice mail where a real person actually responded.  Customers wanted reliability. <br><br><h2>  Deep Learning.  Deep Learning Everywhere </h2><br>  Having failed with the usual math, we decided that we should try to multiply the matrices.  After all, this is not just math, but Deep Learning and Artificial Intelligence!  TensorFlow was installed and work began to boil: the recordings of conversations and voice mails were fed to different models in the hope that they would find patterns that were invisible to us: characteristic time delays, even intonation, a certain set of words, all this. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_m/ww/fe/_mwwfeuw--adojlg3bdy3rz523w.jpeg"></div><br>  The very first problem happened with the data: even a few seconds of a voice with a ‚Äútelephone‚Äù frequency of 8 kilohertz are tens of thousands of values.  And the more complex the data on which we train the neural network, the more this data is needed for an adequate result.  To train a neural network on "raw" data, we would need labeled entries of <b>millions of</b> calls. <br><br>  Therefore, the data needed to be processed.  We connected to Python specific telecom libraries written in C / C ++ and implementing the logic of working with voice: noise reduction, echo cancellation, carrier extraction and many others.  After processing, the record turned into a set of parameters, on which the neural network was already trained. <br><br>  The result immediately became much more fun, and for the next six months we played IT alchemists: we selected a model, processing options for the input data and the results of applying the model, so that, after a few seconds of recording, voice mail was determined.  The result was very good - now it is enough to start the conversation without emotionally with the phrase ‚ÄúThe subscriber is temporarily unavailable‚Äù to receive a notification that the voice mail is most likely on the other side of the handset.  And what to do next with the information received, each client decides for himself in cloud-based JavaScript.  For a programmer, <a href="http://voximplant.com/docs/references/appengine/Module_AI.html">using a</a> detector looks like this: <br><br><div class="oembed"><script type="text/javascript" src="https://gist.github.com/a5be08559185fd1e368d3ffc9a2d356a.js"></script><link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-b3b573358bfc66d89e1e95dbf8319c09.css"><div id="gist84024789" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-scenario-js" class="file">
    

  <div itemprop="text" class="blob-wrapper data type-javascript ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-scenario-js-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-scenario-js-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-c1">require</span>(<span class="pl-smi">Modules</span>.<span class="pl-c1">AI</span>); <span class="pl-c"><span class="pl-c">//</span> ,      AI-</span></td>
      </tr>
      <tr>
        <td id="file-scenario-js-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-scenario-js-LC2" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-scenario-js-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-scenario-js-LC3" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span>  JS  </span></td>
      </tr>
      <tr>
        <td id="file-scenario-js-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-scenario-js-LC4" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">call</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-smi">CallEvents</span>.<span class="pl-smi">AudioStarted</span>, <span class="pl-smi">e</span> <span class="pl-k">=&gt;</span> {</td>
      </tr>
      <tr>
        <td id="file-scenario-js-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-scenario-js-LC5" class="blob-code blob-code-inner js-file-line">  <span class="pl-c1">AI</span>.<span class="pl-en">detectVoicemail</span>(call)</td>
      </tr>
      <tr>
        <td id="file-scenario-js-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-scenario-js-LC6" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">//</span> "confidence"    0  100 -     ,</span></td>
      </tr>
      <tr>
        <td id="file-scenario-js-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-scenario-js-LC7" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">//</span>   VoiceMail</span></td>
      </tr>
      <tr>
        <td id="file-scenario-js-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-scenario-js-LC8" class="blob-code blob-code-inner js-file-line">    .<span class="pl-c1">then</span>(<span class="pl-smi">e</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">Logger</span>.<span class="pl-c1">write</span>(<span class="pl-s"><span class="pl-pds">`</span>Voicemail detected (<span class="pl-s1"><span class="pl-pse">${</span><span class="pl-smi">e</span>.<span class="pl-smi">confidence</span><span class="pl-pse">}</span></span>%)<span class="pl-pds">`</span></span>)</td>
      </tr>
      <tr>
        <td id="file-scenario-js-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-scenario-js-LC9" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">//</span> Reject,      ,   voicemail</span></td>
      </tr>
      <tr>
        <td id="file-scenario-js-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-scenario-js-LC10" class="blob-code blob-code-inner js-file-line">    .<span class="pl-c1">catch</span>(<span class="pl-smi">e</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">Logger</span>.<span class="pl-c1">write</span>(<span class="pl-s"><span class="pl-pds">"</span>Voicemail not detected!<span class="pl-pds">"</span></span>));</td>
      </tr>
      <tr>
        <td id="file-scenario-js-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-scenario-js-LC11" class="blob-code blob-code-inner js-file-line">});</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="" style="float:right">view raw</a>
        <a href="">scenario.js</a>
        hosted with ‚ù§ by <a href="">GitHub</a>
      </div>
    </div>
</div>
</div><br><h2>  TL; DR </h2><br>  Machine learning is a good thing when a task is difficult to formalize with ‚Äúordinary‚Äù mathematics and if-s.  But get ready to play the alchemist: preparing data, choosing a model for a neural network and interpreting the results are areas where there is little ‚Äúbest practice‚Äù and you can spend months, if not years, on selecting a working solution. <br><br>  And you need the marked data.  Many marked data.  A lot of marked up data.  But this is a topic for a separate post. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b6/g3/tt/b6g3ttypzu64vgvlyeztq6mqbqe.jpeg"></div></div><p>Source: <a href="https://habr.com/ru/post/344224/">https://habr.com/ru/post/344224/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../344210/index.html">How to find out what the program for Linux will do without actually doing it?</a></li>
<li><a href="../344214/index.html">Strike iron: hot hardware startups</a></li>
<li><a href="../344216/index.html">What's new in DataGrip 2017.3</a></li>
<li><a href="../344220/index.html">Kubernetes 1.9: a review of major innovations</a></li>
<li><a href="../344222/index.html">How to build an image classifier based on a pre-trained neural network</a></li>
<li><a href="../344226/index.html">Tanchiki in the console, the first article: "From the dispute to writing code"</a></li>
<li><a href="../344228/index.html">‚ÄúIs it a good design or not?‚Äù - how do I answer this question with the help of 3 categories</a></li>
<li><a href="../344230/index.html">Oracle Open World 2017: Announcements of ‚ÄúAutonomous AI‚Äù</a></li>
<li><a href="../344234/index.html">Python Meetup 11/14/2017: Python in Porto, Aiohttp and again tests</a></li>
<li><a href="../344236/index.html">The future billing systems and how they change the communications market</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>