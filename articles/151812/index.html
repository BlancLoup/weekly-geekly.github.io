<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Transcend Library 4: Introduction</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Work with the network in c ++ just, two, three. 


network n = OpenNetwork(); connection c = n.OpenConnection("habrahabr.ru", 80); html_request h("GET...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Transcend Library 4: Introduction</h1><div class="post__text post__text-html js-mediator-article">  Work with the network in c ++ just, two, three. <br><pre><code class="cpp hljs">network n = OpenNetwork(); connection c = n.OpenConnection(<span class="hljs-string"><span class="hljs-string">"habrahabr.ru"</span></span>, <span class="hljs-number"><span class="hljs-number">80</span></span>); <span class="hljs-function"><span class="hljs-function">html_request </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">h</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"GET"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"/"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; c &lt;&lt; h; c.WaitForMessage(); n.Response(); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; c;</code> </pre> <br><br><a name="habracut"></a><br>  Good day dear habravchane, today I want to tell you about my work over the past 4 years.  About my creation, about my life.  It will be a question of a multifunctional library for working with the network, its history and the reasons for its creation, problems to be solved, as well as the internal structure. <br><br>  I want to make a reservation right away, maybe my job is a bicycle, but I couldn‚Äôt find any analogues that satisfy me either at the time of creation or at the time of switching to new versions. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Story </h4><br><h5>  Start </h5><br>  It all started back in 2008, in the summer.  We just went through winsock, tried to make our first server.  <s>I got a teacher that was unimportant, because nothing was clearly</s> understood. I was a fool and did not understand anything. <br>  I was also extremely upset by the inconvenient api, and immediately wanted to encapsulate the whole thing.  I did not know c ++ then, and the first version was just renaming functions (now lost). <br><br>  More and more, I was moving away from the native winsock scheme, making the communication more transparent.  (For example, when calling the connect function, a socket was immediately created, a dns request was made, and the connection was opened).  Gradually, it became so convenient that I decided to try to make a game. <br><br><h5>  Ancient legend </h5><br>  However, before the TL2 version, there were no significant improvements, and the ‚Äúlibrary‚Äù itself had, God forbid, 300 lines of code. <br>  With the advent of a real task, a problem arose - transferring several data in one connection (chat, texture, music).  It is from this that progress itself began.  For half a year I solved this problem, selected the optimal packet splitting, the format of service messages, did tests.  As a result, the library successfully coped with the task, with the support of simultaneous data transfer up to 255 "messages" simultaneously, with a maximum size of 4 gigabytes each. <br>  Unfortunately, we never wrote the game due to the leakage of personnel, altruists, after all.  Yes, and competitors appeared.  Therefore, I was able to leave in the development of the following versions. <br><br><h5>  Tl4 </h5><br>  The next iteration was the transition to C ++ and the addition of new standards, the use of new features and new features. <br>  Now the library began to work fully in two modes at the same time - the server and the client, allowing you to solve proxy or p2p tasks.  The maximum message size has increased to infinity, and the maximum number of simultaneously transmitted up to 2 ^ 32 (with 255 remaining actively transmitted).  Added auto-reconnect features, priority appeared to send messages. <br>  The library became asynchronous, with non-blocking sockets, reducing the load on the main thread by several times.  (For example, the standard connection opening took me 443 ms in TL2, this number was reduced to 17 ms TL4). <br>  Added encryption, compression, etc., the list can be continued for a long time. <br><br><h4>  Main tasks to be solved </h4><br>  The library allows, regardless of the platform, to do the following: <br>  To the client - open the connection, and transfer any data set from any sources (file, array, other connection) and be sure that no matter how many times the connection is interrupted, the data will be delivered. <br>  To the server - to listen to the port and always, it is intuitive to have information about the number of connections, traffic on each connection, time online, average speed, and so on. <br><br><h4>  Example "PROXY" </h4><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;tl4/def.h&gt; using namespace ax::tl4; bool proxy( connection &amp;c, message &amp;m ) { std::string s; s &lt;&lt; m; //   host:pass,   connection nc = c.GetNetwork().OpenConnection(s); nc &lt;&lt; s; nc &lt;&lt; c; nc &gt;&gt; c; return true; } void main() { network n = OpenNetwork(); port p = n.OpenPort(8080); p.NonTL4Compatible(true); p.OnOpenConnection(proxy); while (1) n.Response(); }</span></span></span></span></code> </pre><br>  Of course, the example is played out, without error handling, and in general a curve (when trying to convert message to std :: string, the program will be blocked until the arrival of \ 0 or by timeout), but the essence is clear. <br><br><h4>  Opportunities </h4><br><ul><li>  No protocol restrictions </li><li>  Support encryption, compression </li><li>  The most accurate synchronization </li><li>  Making your handlers (encryption) at the level of the message package.  Fully variable packet construction pipe. </li><li>  Combining connections into ‚Äúvirtual networks‚Äù (groups processed in ‚Äúone go‚Äù).  All communication between networks is thread safe. </li><li>  Transfer up to 4 billion objects simultaneously through one connection. </li><li>  Adjustable connection parameters, software speed limit and the like. </li><li>  Custom event handlers for each connection or group. </li><li>  Priorities for the transfer of objects, the full control of "what exactly will be transferred now." </li><li>  The ability to transfer not fully available objects - for example, a torrent, a stream of Internet radio.  No size limit. </li><li>  Ability to process "new object", "new piece of object", "completion of downloading object", "every N bytes", "every N seconds". </li><li>  Development of the protocol in one place. </li></ul><br><br><h5>  Protocol in one place </h5><br>  This is a very handy thing, allowing you to develop client-server applications without duplicating code. <br>  A little introduction.  For each object and each package, a queue of handlers is called (it cannot be changed on the fly for obvious reasons).  The handler has two methods - Encode and Decode.  Thus, the encryption / decryption code, compression / decompression code is always in one place.  This allows you to verify the correctness of the handler - it is enough to call the Test method, the one on the random or provided data will check that after the encryption and decryption, the original version is obtained. <br>  The same is true in your protocol - for the protocol as a whole, there are the same methods that allow you to convert an object into a message and a message into an object. <br><br><h4>  How it works </h4><br><h5>  Stream </h5><br>  Everything in the programming world can be represented through a sequence.  An array, string, file is all a sequence of bytes.  Also about the variable and incoming-outgoing connection. <br>  The stream class system was created in order to abstract from the physical source of the stream and abstract from the transformations actually occurring over information. <br>  Something similar to stl :: stream but with some improvements. <br><br><h6>  Pipe </h6><br>  Imagine a simple task, we want to transfer a picture from the disk.  To do this, you need to download it, convert bmp-&gt; jpg, encrypt.  Now this can be done simply by putting the handlers one by one, and saying that this is an atomic transformation (anologia with a water supply system - the pipes go to butt). <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">pipe *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ImageTransferPipe</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> filename )</span></span></span><span class="hljs-function"> </span></span>{ pipe_constructor c; c.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BMP2JPG()); c.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BlowFishCrypt()); <span class="hljs-function"><span class="hljs-function">pipe </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">p</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> p.GetScheme().Source(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> read_file_stream(filename)); }</code> </pre><br>  I am sure that from the first time it seems not very clear and convenient, but be sure, after getting acquainted with api it becomes easy. <br><br><h5>  Out-of-box encryption </h5><br>  As you may have guessed, when creating a connection, there is a single logical functionality: <br><pre> <code class="cpp hljs">connection::SetHandler( pipe * )</code> </pre><br>  Each byte, when sent, will pass through this handler, and each byte, when received, will also pass through a corresponding handler (pipe :: GetInverseScheme). <br><br><h5>  Transfer of several objects simultaneously </h5><br>  The idea is painfully simple, I hope it will be useful to those who need it, and who have not done it yet. <br>  All objects in the queue for sending are shredded by 255 bytes, and are sent by these blocks.  Blocks are supplied with an id object.  Objects are transmitted cyclically - the first second third first second third. <br>  I note that the blocks are always 255 bytes, and are not supplied with size.  If suddenly the unit is smaller, it will be adjusted through the service messages. <br>  If suddenly the next portion of the object is ‚Äúnot ready‚Äù (no data), then it moves to the inactive queue, instead of one ready.  All this is regulated through system messages. <br><br><h5>  System messages </h5><br>  They carry several functions.  The transferring party reports active-inactive rotations, warns of the approaching end of the object, reports the addition of objects, the transfer of "low-level" exceptions, the transfer of the pipe format for the object and the most interesting thing is synchronization. <br><h6>  Sync machines </h6><br>  For proper operation it must be turned on two ends.  It was because of this task that we had to implement the priority of objects, it is necessary that these service messages be added to the queue at the time of creation. <br>  Hosts exchange their timestamp with milliseconds, thus getting ping.  After setting the average value, they begin to share it too.  As a result, both cars have a response time. <br>  The most interesting begins in a server solution.  Players with ping more than a couple of hundred will understand me.  The enemy for a few milliseconds learns something important earlier, and this is all decided. <br>  And now imagine the games where events come on all machines at the same time, and it is done simply.  When sending a ‚Äúconcurrent‚Äù message, the connections are sorted in order of delays, and the actual sending of data occurs so that the estimated arrival time is equal, taking into account the stability of the connection (error less than 10ms for wired solutions). <br><br><h4>  Why this post? </h4><br>  The fact is that the library is not complete.  For example, not all the planned connection parameters are supported, I would like out-of-the-box encryption algorithms, check sum, and so on.  In general, the work is still underway. <br>  Here I didn‚Äôt appear to be promoted, but to find out if there are analogues (I would like to <s>steal a couple of ideas to</s> look like people‚Äôs), whether anyone needs this (it makes sense to enter the market) and find out what you wouldn‚Äôt have enough the system. <br><br><h5>  Public apologies </h5><br>  Please forgive me for my presentation, mistakes and inaccuracies.  I was unable to add the ‚ÄúI am PR‚Äù tag due to low karma.  And indeed in vain, I guess it is. <br><br>  UPD: <a href="http://habrahabr.ru/post/151958/">Continued</a> </div><p>Source: <a href="https://habr.com/ru/post/151812/">https://habr.com/ru/post/151812/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../151803/index.html">Chameleon 1.0 released</a></li>
<li><a href="../151804/index.html">BAXTER industrial robot can adapt and learn</a></li>
<li><a href="../151806/index.html">How many games began to do?</a></li>
<li><a href="../151810/index.html">iOS 6 is available in iTunes</a></li>
<li><a href="../151811/index.html">The illusion of effective development: design</a></li>
<li><a href="../151813/index.html">Office, which make holidays!</a></li>
<li><a href="../151814/index.html">Practical tips for efficient code inspection</a></li>
<li><a href="../151815/index.html">Application Cache API - new features and problems</a></li>
<li><a href="../151816/index.html">Such a dangerous Internet Explorer ...</a></li>
<li><a href="../151818/index.html">How to restore data in Storelab</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>