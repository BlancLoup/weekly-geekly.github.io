<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Prototyping a mobile game, where to start, and how to do it. Part 3 (final)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the first part, I reasoned for what prototyping and in general where to start 
 - Part 1 

 In the second part, we ran a little bit by key classes....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Prototyping a mobile game, where to start, and how to do it. Part 3 (final)</h1><div class="post__text post__text-html js-mediator-article">  In the first part, I reasoned for what prototyping and in general where to start <br>  - <a href="https://habr.com/ru/post/453056/">Part 1</a> <br><br>  In the second part, we ran a little bit by key classes. <br>  and architecture - <a href="https://habr.com/ru/post/453236/">Part 2</a> <br><br>  And here is the third part - there will actually be some reasoning in it, let's look at how modifiers work, and drops on the playing field (this is not difficult, but there are nuances).  And a little about architecture, I will try without tediousness. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Screenshots about the rocket as a whole are dull, so I propose to watch a video of another prototype, which was assembled in 2 weeks together with graphics, and was abandoned due to the fact that in the genre of platformers and so not overflowed.  By the way, this is one of the key ideas around the prototype - to collect, to see if it is shit, is it necessary?  And honestly throw in the basket if you find the answers do not seem convincing enough.  But!  This does not apply to creative projects - sometimes creativity is for the sake of creativity). <br><br>  So vidosik, you need to look at the texts placed on the level, and not on the gameplay): <br><iframe width="560" height="315" src="https://www.youtube.com/embed/lY8e1igkzI0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><a name="habracut"></a><br><br><h3>  Small retreat </h3><br>  In the last article I received a review code and am grateful for it, criticism helps to develop even if you disagree with it. <br><br>  <b>But I want to deploy for the architecture and syntax regarding prototypes:</b> <br><ol><li>  No matter how steep you are, it‚Äôs impossible to foresee that it will not be pledged, and there may be a lot of pledging - which is not needed.  Therefore, in any case, refactoring or expansion will be needed.  If you can not describe the specific benefits of the code / approach, it is better not to spend a lot of time on this code. </li><li>  Why, in my opinion, OOP / Event model / composition is simpler for prototypes than ECS, Unity COOP, DI FrameWorks, Reactive Frameworks, etc.  Less scribbling, all links are visible in the code, because the main task of the prototype is to answer the main question - is it possible to play this, and on a number of minor ones - what is better for the gameplay, this or that.  Therefore, you need as quickly as possible to implement the necessary functionality.  Why on a small project to introduce the framework, prescribe all the junk to implement three game entities?  Each of which is actually a class of 50-100 lines.  The architecture should be thought through as part of the tasks for the prototype, and as part of a possible expansion to the alpha, but the second is needed in the head rather than in the code, in order not to burn while writing the code </li></ol><br><br><h3>  About modifiers: </h3><br>  <b>And finally, about the modifier itself:</b> <br>  Here and earlier I call the modifiers the force fields that the rocket touches, and which affect its trajectory, in the prototype there are two types - acceleration and deflection. <br><br><div class="spoiler">  <b class="spoiler_title">Modifier class</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PushSideModificator</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MonoBehaviour</span></span></span><span class="hljs-class"> </span></span>{ [SerializeField] TypeOfForce typeOfForce = TypeOfForce.Push; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> force; [SerializeField] DropPanelConfig dropPanelConfig; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> boundsOfCollider; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnTriggerEnter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Collider other)</span></span></span><span class="hljs-function"> </span></span>{ boundsOfCollider = other.bounds.extents.x; GlobalEventAggregator.EventAggregator.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpaceForces { TypeOfForce = typeOfForce, Force = force, ColliderBound = boundsOfCollider, CenterOfObject = transform.position, IsAdded = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnTriggerExit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Collider other)</span></span></span><span class="hljs-function"> </span></span>{ GlobalEventAggregator.EventAggregator.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpaceForces { CenterOfObject = transform.position, IsAdded = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> }); } }</code> </pre> <br></div></div><br>  This is a very simple class whose task is to pass two events: <br><ol><li>  A player is hit in a field (which is actually a physical unit trigger), and all the necessary context is the type of modifier, its position, the size of the collider, the impact force of the modifier, and so on.  In this plus the event aggregator, it can transfer any context to interested parties.  In this vein, this is a rocket model that processes the modifier. </li><li>  The second event - the player left the field.  To remove its effect on the player's trajectory </li></ol><br>  <b>What is the event model for?</b>  <b>Who else might need this event?</b> <b><br></b>  <b>This is not implemented in the current project, but:</b> <br><ol><li>  Voice acting (got an event that someone entered the field - we play the corresponding sound, someone came out - similarly) </li><li>  UI markers, let's say for each field we‚Äôll remove some fuel from the rocket, pop-up prompts should appear that we entered the field and lost fuel, well, or score points for each hit in the field, there are many options for the fact that the interface is interesting to the player field. </li><li>  Specialist.  effects - when getting into a different type of field, different effects can be superimposed, both on the rocket itself and on the space around the rocket / field.  Specialist.  effects can be handled by a separate entity / controller, which will also be subscribed to events from modifiers. </li><li>  Well, this is a minimum of code, no service locators, aggregation, dependencies, etc. are needed. </li></ol><br><br><h3>  The basis of the gameplay </h3><br>  In this prototype, the essence of the gameplay is to place modifiers on the playing field, adjusting the flight path of the rocket, for flying over obstacles and hitting the destination point / planet.  To do this, we have a panel on the right, on which icons of modifiers are located. <br><br><img src="https://habrastorage.org/webt/lj/eb/ga/ljebgar88u47kcyxyhz_6kzxyke.jpeg"><br><br><div class="spoiler">  <b class="spoiler_title">Panel class</b> <div class="spoiler_text"><pre> <code class="java hljs"> [RequireComponent (typeof(CanvasGroup))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DragAndDropModifiersPanel</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MonoBehaviour</span></span></span><span class="hljs-class"> </span></span>{ [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> DropModifiersIcon iconPrfb; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> DropPanelConfig config; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CanvasGroup canvasGroup; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ GlobalEventAggregator.EventAggregator.AddListener&lt;ButtonStartPressed&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, RocketStarted); canvasGroup = GetComponent&lt;CanvasGroup&gt;(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RocketStarted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ButtonStartPressed obj)</span></span></span><span class="hljs-function"> </span></span>{ canvasGroup.DOFade(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); (canvasGroup.transform as RectTransform).DOAnchorPosX(<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x&lt; <span class="hljs-number"><span class="hljs-number">3</span></span>; x++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mod = config.GetModifierByType(TypeOfForce.Push); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> go = Instantiate(iconPrfb, transform); go.Init(mod); } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>; x++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mod = config.GetModifierByType(TypeOfForce.AddSpeed); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> go = Instantiate(iconPrfb, transform); go.Init(mod); } } }</code> </pre> <br></div></div><br><br>  Anticipating questions: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x&lt; <span class="hljs-number"><span class="hljs-number">3</span></span>; x++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>; x++)</code> </pre><br><br>  3 and 1 - the so-called magic numbers, which are simply taken from the head and inserted into the code, this should be avoided, but why are they here?  The principle by which the right panel is formed has not been defined, and it was decided to just test the prototype for the prototype with just such a number of modifiers. <br><br>  How to do it right?  - at least put in the serializable fields, and set the required quantities through the inspector.  Why am I too lazy and should you do it?  Here it is necessary to proceed from the general picture; a separate entity and a config will still be responsible for forming the required number of modifiers, so here I was too lazy to rely on greater refactoring in the future.  But better not lazy!  ) <br><br>  About configs - when the first lectures about ScriptableObject appeared, I liked the idea of ‚Äã‚Äãstoring data as an asset.  You get the necessary data where you need, without reference to a single-copy instance.  Then there was a lecture on the approach to developing games with ScriptableObject, where storage of instance settings was used.  Actually the presets / settings of something stored in an asset is the config. <br><br>  <b>Consider the config class:</b> <br><div class="spoiler">  <b class="spoiler_title">Config class</b> <div class="spoiler_text"><pre> <code class="java hljs"> [CreateAssetMenu(fileName = <span class="hljs-string"><span class="hljs-string">"DropModifiersPanel"</span></span>, menuName = <span class="hljs-string"><span class="hljs-string">"Configs/DropModifier"</span></span>, order = <span class="hljs-number"><span class="hljs-number">2</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DropPanelConfig</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScriptableObject</span></span></span><span class="hljs-class"> </span></span>{ [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ModifierBluePrintSimple[] modifierBluePrintSimples; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> DropModifier </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetModifierByType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TypeOfForce typeOfModifiers)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> modifierBluePrintSimples.FirstOrDefault(x =&gt; x.GetValue.TypeOfModifier == typeOfModifiers).GetValue; } } [System.Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DropModifier</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TypeOfForce TypeOfModifier; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Sprite Icon; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> GameObject Modifier; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Material Material; }</code> </pre> <br></div></div><br><br>  What is the essence of his work?  It stores a customized data class about the modifier. <br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DropModifier</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TypeOfForce TypeOfModifier; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Sprite Icon; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> GameObject Modifier; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Material Material; }</code> </pre> <br><br>  The type of the modifier is needed for identification, the icon for the interface, the gamemob itself the game object of the modifier, the material is here so that it can be changed during configuration.  The modifiers may already be located on the playing field, and let's say the game designer changes its type, now it gives acceleration, the modifier is inserted from the config and updates all fields, including the material, according to this type of modifier. <br><br>  Working with the config is very simple - we refer to the configuration for the data for a particular type, we obtain this data, initial visual and possible settings from this data. <br><br>  <b>Where is the profit?</b> <br>  The benefit is a lot of flexibility, for example, you want to change the material and the icon on the acceleration modifier, or let's assume you can replace the game object as a whole.  Instead of rewriting and forwarding into the fields of the inspector, we simply change this data in one config and voila - everything will be updated on all scenes / levels / panels. <br><br>  <b>And if in the config there are several data for the acceleration modifier?</b> <br>  In the prototype, you can easily track it manually so that the data are not duplicated; on the working draft, you need tests and data validation. <br><br><h3>  From the icon on the playing field </h3><br><div class="spoiler">  <b class="spoiler_title">Class modifier icon</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DropModifiersIcon</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MonoBehaviour</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IDragHandler</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IBeginDragHandler</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IEndDragHandler</span></span></span><span class="hljs-class"> </span></span>{ [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Image icon; [Header(<span class="hljs-string"><span class="hljs-string">"       "</span></span>)] [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> RectTransform canvas; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CanvasGroup canvasGroup; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> DropModifier currentModifier; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector3 startPoint; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector3 outV3; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GameObject currentDraggedObj; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ canvasGroup = GetComponent&lt;CanvasGroup&gt;(); startPoint = transform.position; canvas = GetComponentInParent&lt;Canvas&gt;().transform as RectTransform; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DropModifier dropModifier)</span></span></span><span class="hljs-function"> </span></span>{ icon.sprite = dropModifier.Icon; currentModifier = dropModifier; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnBeginDrag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PointerEventData eventData)</span></span></span><span class="hljs-function"> </span></span>{ BlockRaycast(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); currentDraggedObj = Instantiate(currentModifier.Modifier, WorldSpaceCoord(), Quaternion.identity); GlobalEventAggregator.EventAggregator.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImOnDragEvent { IsDragging = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BlockRaycast</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bool state)</span></span></span><span class="hljs-function"> </span></span>{ canvasGroup.blocksRaycasts = state; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDrag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PointerEventData eventData)</span></span></span><span class="hljs-function"> </span></span>{ Vector2 outV2; RectTransformUtility.ScreenPointToLocalPointInRectangle(canvas, Input.mousePosition, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, out outV2); transform.position = canvas.transform.TransformPoint(outV2); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentDraggedObj != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) currentDraggedObj.transform.position = WorldSpaceCoord(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WorldSpaceCoord</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ RectTransformUtility.ScreenPointToWorldPointInRectangle(canvas, Input.mousePosition, Camera.main, out outV3); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> outV3; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEndDrag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PointerEventData eventData)</span></span></span><span class="hljs-function"> </span></span>{ GlobalEventAggregator.EventAggregator.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImOnDragEvent { IsDragging = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eventData.pointerCurrentRaycast.gameObject != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; eventData.pointerCurrentRaycast.gameObject.layer == <span class="hljs-number"><span class="hljs-number">5</span></span>) { Destroy(currentDraggedObj); transform.SetAsLastSibling(); canvasGroup.blocksRaycasts = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Destroy(gameObject); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> struct ImOnDragEvent { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> bool IsDragging; }</code> </pre><br></div></div><br><br>  <b>What's going on here?</b> <br>  We grab the icon from the panel, under it we create the gamemoj of the modifier itself.  And we actually coordinate the click / click coordinate in the game space, thus moving the modifier in the game space along with the icon in the UI, by the way I advise you to read about RectTransformUtility, this is a great helper class in which there are a lot of features for the interface. <br><br>  Suppose we change our mind to put a modifier and return it back to the panel, <br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eventData.pointerCurrentRaycast.gameObject != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; eventData.pointerCurrentRaycast.gameObject.layer == <span class="hljs-number"><span class="hljs-number">5</span></span>)</code> </pre> <br>  This piece of code makes us understand what is under the click.  Why is there also a check for the layer?  And why again the magic number 5?  As we remember from the second part, we use the racaster graph not only for the UI, but also for the button that is in the scene, and if we add the functionality to remove already placed modifiers across the field or move them, they will also fall under the raikast graph, therefore there is also an additional check for belonging to the UI layer.  This is the default layer, and its order does not change, so the figure 5 here is generally not a magic number. <br><br>  The result is that if we release the icon above the panel - it will return to the panel, if above the playing field - the modifier remains on the field, the icon will be removed. <br><br>  The prototype code was spent 1 working day.  Plus a little mess on the filing and graphics.  In general, the gameplay was found to be suitable, despite a ton of questions on art and game design tweaks.  Mission Complete. <br><br><h3>  Conclusions and recommendations </h3><br><ol><li>  Lay the minimum architecture, but nevertheless the architecture </li><li>  Follow the basic principles, but without fanaticism) </li><li>  Choose simple solutions </li><li>  Between versatility and speed - for the prototype it is better to choose the speed </li><li>  For large / medium-sized projects, mean that the project is better rewritten from scratch.  For example, now the trend in Unity - DOTS, will have to write a lot of components and systems, on short runs it is bad, you lose on time, on long runs - when all components and systems are registered, the gain in time begins.  I do not think it's cool to spend a lot of time on a trend architecture, and find out that the prototype is shitty </li></ol><br>  All successful prototypes. </div><p>Source: <a href="https://habr.com/ru/post/453748/">https://habr.com/ru/post/453748/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../453734/index.html">Meet Helm 3</a></li>
<li><a href="../453738/index.html">THE AMOUNT OF ALL CONSCIOUS | --1-- |</a></li>
<li><a href="../45374/index.html">WUD 2008: photo, video, presentation</a></li>
<li><a href="../453742/index.html">Memcached plugin: NoSQL in MySQL</a></li>
<li><a href="../453744/index.html">We use the pseudo-class: not () on the example of the task ‚ÄúSelecting the active row of a table in pure CSS‚Äù</a></li>
<li><a href="../45375/index.html">parsing MS-office files</a></li>
<li><a href="../453750/index.html">Baltimore‚Äôs recent cyber attack</a></li>
<li><a href="../453756/index.html">Problems of the current methodology for determining the actual threats from FSTEC</a></li>
<li><a href="../453760/index.html">Training camp on circuit design for tanks and bookmarks to processors</a></li>
<li><a href="../453764/index.html">Voluntary amnesia: manipulation of the hippocampus to remove painful memories</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>