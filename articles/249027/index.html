<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Procedural generation of planetary textures based on the Diamond-Square algorithm, part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. As with me, as soon as I figured out some difficult question for myself, I immediately want to tell everyone the solution. Therefore, I deci...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Procedural generation of planetary textures based on the Diamond-Square algorithm, part 1</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/b8a/b3f/d27/b8ab3fd276ab744744eca2a1cd8376ba.jpg" alt="image"><br><br>  Good day.  As with me, as soon as I figured out some difficult question for myself, I immediately want to tell everyone the solution.  Therefore, I decided to write a series of two articles on such an interesting topic as procedural generation.  More specifically, I will talk about the generation of textures of the planets.  This time I prepared more thoroughly and will try to make the material more qualitative than in my previous post <a href="http://habrahabr.ru/post/245219/">‚ÄúSimple Event System in Unity‚Äù</a> (by the way, thank you all for the responsive posts).  Before proceeding, I want to draw your attention to a few points: <br><br>  1) This generator does not pretend to be realistic, and I wrote it in order to generate unique textures for hundreds of small balls that occupy 10% of the screen and are also covered by clouds. <br>  2) But this does not mean that I will not be happy with criticism.  On the contrary, one of the reasons for writing this post is to get tips on improving the algorithm, I will gladly improve it. <br>  3) A purely technical point: I am writing in C # under Unity3d, so you will have to think about how to display the image with acceptable speed yourself, for each language and platform its own methods. <br>  So, the plan is this: in the first article I talk about procedural generation of terra-type planets, then I get a barrage of criticism, for which everything was done, improve the algorithm, refine for other types of planets and write the second part. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Ready?  Go. <br><a name="habracut"></a><br><h4>  Prologue </h4><br>  <i>* This part does not carry much meaning *</i> <br><br>  As I wrote above, I absolutely needed the textures of the planets.  In principle, it would be enough for 2 - 3 for each type, but even that amount for me, never used anything more difficult than paint.net, is very heavy.  And even if I painted, the quality would have left much to be desired.  Therefore, I decided that it is better to write a generator.  Of course, immediately rushed to write a bicycle.  I decided to do ‚Äúcell generation‚Äù.  My idea was that we create a two-dimensional array, the cells of which can take several integer values ‚Äã‚Äã(or enums, without difference), which are responsible for what ‚Äúelement‚Äù (grass, desert, sea, <s>bedrock</s> ...) will be drawn to this pixel on the screen.  After a day of fruitless attempts, the idea was rejected as "hopeless."  Maybe this approach has the right to life, but it has a lot of flaws: <br><br>  1) Complex logic, especially if there are several cells. <br>  2) Of all 16 million colors, we use at most 10 ‚Äî the number of cells. <br><br>  In general, I began to look for more optimal algorithms and comes on the scene ... <br><br><h4>  Diamond-square </h4><br>  A long time ago one good man, Gavin SP Miller, described the 2D noise generation algorithm.  And 4 years ago another good person, <a href="http://habrahabr.ru/users/denull/" class="user_link">deNULL</a> , wrote a detailed <a href="http://habrahabr.ru/post/111538/">article</a> about this and some other methods of generation.  Before going further, I highly recommend reading, the algorithm is described very well.  But when I started writing code, there were several technical problems.  What were the problems and how I managed to solve them in the course of the article.  Let's start with a general scheme of actions: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/387/10b/12e/38710b12e3ff4d2ab48226ca18d8f545.jpg" alt="image"><br><br>  First, using our algorithm, we generate a ‚Äúheight map‚Äù - roughly the same as what we see in the second picture.  Since the value of the color component in Unity is represented by a fractional number from 0 to 1, my implementation of the algorithm fills the field with values ‚Äã‚Äãin this range, but it is easy to alter the algorithm for another range.  Then this value in certain ratios is entered into the color r, g, b of the color of the corresponding pixel.  Proceed to the first paragraph. <br><br><h4>  Generate elevation map </h4><br>  At this point you, I hope, are already imagining the general principle of operation of the diamond-square itself, if not, still read the article that I have indicated above.  I will only describe my implementation.  To begin with, we will create a two-dimensional array, whose dimensions should be equal to 2 ^ n + 1, for other sizes it will not work).  I took 2049x1025 (2: 1 ratio is best suited for spherical planets in a vacuum).  Let's write the Square and Diamond methods.  The first one takes the coordinates of the lower left and right upper corners of the square and writes the value to its center.  The second one takes the value of the point to be calculated (that is, the midpoints of the sides of this square) and calculates it based on the values ‚Äã‚Äãof the adjacent angles of the square, its center and the center of the adjacent square.  Here at this place there will be an interesting snag, but first the methods themselves: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ysize = <span class="hljs-number"><span class="hljs-number">1025</span></span>, xsize = ysize * <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[,] heighmap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[xsize, ysize]; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> roughness = <span class="hljs-number"><span class="hljs-number">2f</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  ,  ,      public static void Square(int lx, int ly, int rx, int ry) { int l = (rx - lx) / 2; float a = heighmap[lx, ly]; // B--------C float b = heighmap[lx, ry]; // | | float c = heighmap[rx, ry]; // | ce | float d = heighmap[rx, ly]; // | | int cex = lx + l; // A--------D int cey = ly + l; heighmap[cex, cey] = (a + b + c + d) / 4 + Random.Range(-l * 2 * roughness / ysize, l * 2 * roughness / ysize); }</span></span></code> </pre> <br>  Important note: Random.Range (float min, float max) returns a pseudo-random number in the specified range.  It is fast, but is only in Unity.  How will it be with System.Random I do not know.  I mean, you may have to write a pseudo-random number generator yourself. <br><br>  Going further: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> lrflag = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Diamond</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tgx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tgy, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> l</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a, b, c, d; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tgy - l &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) a = heighmap[tgx, tgy - l]; <span class="hljs-comment"><span class="hljs-comment">// C-------- else // | | a = heighmap[tgx, ysize - l]; // B---t g----D | // | | // A-------- if (tgx - l &gt;= 0) b = heighmap[tgx - l, tgy]; else if (lrflag) b = heighmap[xsize - l, tgy]; else b = heighmap[ysize - l, tgy]; if (tgy + l &lt; ysize) c = heighmap[tgx, tgy + l]; else c = heighmap[tgx, l]; if (lrflag) if (tgx + l &lt; xsize) d = heighmap[tgx + l, tgy]; else&lt;source lang="cs"&gt; d = heighmap[l, tgy]; else if (tgx + l &lt; ysize) d = heighmap[tgx + l, tgy]; else d = heighmap[l, tgy]; heighmap[tgx, tgy] = (a + b + c + d) / 4 + Random.Range(-l * 2 * roughness / ysize, l * 2 * roughness / ysize); }</span></span></code> </pre><br>  Here we will stop in more detail.  As you can see, for each point I am checking whether it goes beyond the array.  If it does, then I assign the opposite value to it.  Those.  if, for example, we calculate a rhombus on the left side, then the abscissa of its left vertex is less than zero, instead of it we use the value of a point to it symmetric, i.e.  xsize - l (l - half of the side of the square).  Thus, when applied to a sphere, we get a seamless texture.  In addition, for coordinates that can go beyond the right border, an additional check is carried out.  The fact is that diamond-square is valid only for squares.  I make a rectangle with 2: 1 sides and consider it as two squares.  Therefore, I entered a flag that determines in which part we act and in accordance with it considered the right border to be either 1025 or 2049 (ysize or xsize).  Not a very elegant solution, but cheap, reliable and practical, I still don‚Äôt need other correlations, so I left it as it is. <br><br>  <u>Recheck all coordinates!</u>  Because of one mistake in the diamond parameter, I puzzled all day for this, certainly mathematically interesting, but not at all in the subject of the picture: <br><div class="spoiler">  <b class="spoiler_title">Spoiler</b> <div class="spoiler_text"><img src="http://i.imgur.com/olEW5aT.jpg" alt="image"><br></div></div><br>  Our tools are almost ready, there is the last small method that combines them for one square. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DiamondSquare</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ly, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ry</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> l = (rx - lx) / <span class="hljs-number"><span class="hljs-number">2</span></span>; Square(lx, ly, rx, ry); Diamond(lx, ly + l, l); Diamond(rx, ry - l, l); Diamond(rx - l, ry, l); Diamond(lx + l, ly, l); }</code> </pre><br>  Please note, we do NOT call this method recursively, I will explain why.  Look at this picture: <br><br><img src="http://i.imgur.com/nHdsnwrl.jpg" alt="image"><br><br>  I drew step by step what would happen if Diamond-Square was called recursively for sub-squares.  The first square is considered normal, because  diamond's tops extend beyond the array and the center of the square is used instead.  But the square inside it is considered wrong, because  middle squares - neighbors are not counted yet.  As a result, nothing good will come of it.  Thus, as written in that article, it is necessary to consider layers and recursion in this case is not needed.  Some time after realizing this fact, I managed to come up with this counting by layers: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Generate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { heighmap[<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] = Random.Range(<span class="hljs-number"><span class="hljs-number">0.3f</span></span>, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>); heighmap[<span class="hljs-number"><span class="hljs-number">0</span></span>, ysize - <span class="hljs-number"><span class="hljs-number">1</span></span>] = Random.Range(<span class="hljs-number"><span class="hljs-number">0.3f</span></span>, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>); heighmap[xsize - <span class="hljs-number"><span class="hljs-number">1</span></span>, ysize - <span class="hljs-number"><span class="hljs-number">1</span></span>] = Random.Range(<span class="hljs-number"><span class="hljs-number">0.3f</span></span>, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>); heighmap[xsize - <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] = Random.Range(<span class="hljs-number"><span class="hljs-number">0.3f</span></span>, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>); heighmap[ysize - <span class="hljs-number"><span class="hljs-number">1</span></span>, ysize - <span class="hljs-number"><span class="hljs-number">1</span></span>] = Random.Range(<span class="hljs-number"><span class="hljs-number">0.3f</span></span>, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>); heighmap[ysize - <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] = Random.Range(<span class="hljs-number"><span class="hljs-number">0.3f</span></span>, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> l = (ysize - <span class="hljs-number"><span class="hljs-number">1</span></span>) / <span class="hljs-number"><span class="hljs-number">2</span></span>; l &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; l /= <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; xsize - <span class="hljs-number"><span class="hljs-number">1</span></span>; x += l) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &gt;= ysize - l) lrflag = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> lrflag = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; ysize - <span class="hljs-number"><span class="hljs-number">1</span></span>; y += l) DiamondSquare(x, y, x + l, y + l); } }</code> </pre><br>  We go through all the lengths of the sides of the squares (attentive people may have noticed that the search starts immediately from half the length; to be honest, I have no idea why, but if you take the full side at once, the continents turn out to be overgrown on the whole map) and for each of them we iterate over all left lower corners of the squares in this "layer" of lengths  Thus, all the squares always "know" the centers of the neighbors and get the correct picture.  By the way, as can be seen from the code, the four corners of the picture (in our rectangular case, 4 corners and midpoints of large sides) should be specified, these are the input data of the algorithm. <br><br>  Voila! <br><br><img src="http://i.imgur.com/GKLLIUX.jpg" alt="image"><br><br>  <b>Well, now the most interesting thing is color</b> . <br><br>  <u>Disclaimer</u> : All that is written below is my bicycle.  And, frankly, not the best.  It gives far from the most realistic picture, its code is cumbersome and I will be happy to hear ideas for improvement.  All you are warned, prepare your keyboard for writing essays on the processes of the formation of planets, I did not listen well at school and did not remember anything. <br><br>  I decided to divide the entire planet into three zones: snow, green zone, desert zone.  Remember in geography textbooks pictures with them?  Now we will do them.  For this, I created a separate class.  It is small, I post it all at once: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TemperatureCurves_class</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> xsize = Heighmap_class.xsize; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> snowEdge = Heighmap_class.ysize / <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> greenEdge = Heighmap_class.ysize / <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] northGreen = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[xsize]; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] southGreen = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[xsize]; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] northSnow = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[xsize]; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] southSnow = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[xsize]; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> snowRoughness = <span class="hljs-number"><span class="hljs-number">0.03f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> greenRoughness = <span class="hljs-number"><span class="hljs-number">0.15f</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MidPointDisplacement1D</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] curve, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> l, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> r, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> roughness</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (r - l &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { curve[(l + r) / <span class="hljs-number"><span class="hljs-number">2</span></span>] = (curve[l] + curve[r]) / <span class="hljs-number"><span class="hljs-number">2</span></span> + (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)Random.Range(-(r - l) * roughness, (r - l) * roughness); MidPointDisplacement1D(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> curve, l, (l + r) / <span class="hljs-number"><span class="hljs-number">2</span></span>, roughness); MidPointDisplacement1D(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> curve, (l + r) / <span class="hljs-number"><span class="hljs-number">2</span></span>, r, roughness); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Generate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { northSnow[<span class="hljs-number"><span class="hljs-number">0</span></span>] = northSnow[xsize - <span class="hljs-number"><span class="hljs-number">1</span></span>] = Heighmap_class.ysize - snowEdge; southSnow[<span class="hljs-number"><span class="hljs-number">0</span></span>] = southSnow[xsize - <span class="hljs-number"><span class="hljs-number">1</span></span>] = snowEdge; northGreen[<span class="hljs-number"><span class="hljs-number">0</span></span>] = northGreen[xsize - <span class="hljs-number"><span class="hljs-number">1</span></span>] = Heighmap_class.ysize - greenEdge; southGreen[<span class="hljs-number"><span class="hljs-number">0</span></span>] = southGreen[xsize - <span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-function"><span class="hljs-function">greenEdge </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MidPointDisplacement1D</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> northGreen, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, xsize - </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">, greenRoughness</span></span></span><span class="hljs-function">)</span></span>; MidPointDisplacement1D(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> southGreen, <span class="hljs-number"><span class="hljs-number">0</span></span>, xsize - <span class="hljs-number"><span class="hljs-number">1</span></span>, greenRoughness); MidPointDisplacement1D(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> northSnow, <span class="hljs-number"><span class="hljs-number">0</span></span>, xsize - <span class="hljs-number"><span class="hljs-number">1</span></span>, snowRoughness); MidPointDisplacement1D(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> southSnow, <span class="hljs-number"><span class="hljs-number">0</span></span>, xsize - <span class="hljs-number"><span class="hljs-number">1</span></span>, snowRoughness); } }</code> </pre><br>  So, as the name suggests, in this class lie the boundaries of climatic zones.  They are in the form of arrays - two southern, two northern.  And we generate them using the diamond-square: midpoint displacement ancestor.  In our case, we use it on the line.  I think the principle of its action after diamond-square is not necessary to explain, especially since <a href="http://habrahabr.ru/users/denull/" class="user_link">deNULL</a> has done it for me a long time ago.  In fact, there lies a set of y coordinates, mapped to the x coordinate, denoting the boundary between the belts.  For the belt to be closed (we will, after all, apply tension to the sphere), we make its edges equal.  And for realism, the snow and the green strip make different roughness values ‚Äã‚Äãso that the polar circle is round (straight on the texture), and the belts can wriggle along the most unpredictable trajectories (but it is important not to overdo it, the desert on the snow border will look weird).  However, the desert will still look weird, because  they are determined not only by proximity to the equator, but also by mountains, winds and other factors. <br><br>  <b>We work with color</b> <br>  The most bulky and bike part of the code, get ready. <br>  First, let's create an array of colors (in unit there is a method that quickly reads such an array and writes its elements to texture pixels, it is much faster than any SetPixel () and others): <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Texture2D tex; <span class="hljs-comment"><span class="hljs-comment">//  ,     public static Color[] colors = new Color[Heighmap_class.xsize * Heighmap_class.ysize]; float waterLevel = 0.2f;</span></span></code> </pre><br>  Incidentally, as <a href="http://habrahabr.ru/users/denull/" class="user_link">deNULL</a> wrote, it is useful to build the height map values ‚Äã‚Äãin a square, this will smooth it a bit and make it more similar to the real one. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SqrHeighmap</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; Heighmap_class.xsize; x++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; Heighmap_class.ysize; y++) Heighmap_class.heighmap[x, y] *= Heighmap_class.heighmap[x, y]; }</code> </pre><br>  In addition, I impose the following effect on the finished texture: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SmoothImg</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; Heighmap_class.xsize * Heighmap_class.ysize - <span class="hljs-number"><span class="hljs-number">2</span></span>; i++) { Color clr1 = colors[i]; Color clr2 = colors[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; colors[i] = (<span class="hljs-number"><span class="hljs-number">2</span></span> * clr1 + clr2) / <span class="hljs-number"><span class="hljs-number">3</span></span>; colors[i + <span class="hljs-number"><span class="hljs-number">1</span></span>] = (clr1 + <span class="hljs-number"><span class="hljs-number">2</span></span> * clr2) / <span class="hljs-number"><span class="hljs-number">3</span></span>; } }</code> </pre><br>  The effect is small, but it doesn't seem to affect the speed either. <br>  And now we write methods for assigning colors to different types of terrain: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetSnow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> counter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> heigh</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (heigh &lt; waterLevel + Random.Range(<span class="hljs-number"><span class="hljs-number">-0.04f</span></span>, <span class="hljs-number"><span class="hljs-number">0.04f</span></span>)) colors[counter] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Color(Random.Range(<span class="hljs-number"><span class="hljs-number">0.8f</span></span>, <span class="hljs-number"><span class="hljs-number">0.85f</span></span>), Random.Range(<span class="hljs-number"><span class="hljs-number">0.8f</span></span>, <span class="hljs-number"><span class="hljs-number">0.85f</span></span>), Random.Range(<span class="hljs-number"><span class="hljs-number">0.85f</span></span>, <span class="hljs-number"><span class="hljs-number">0.9f</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { colors[counter].r = <span class="hljs-number"><span class="hljs-number">0.005f</span></span> / heigh + Random.Range(<span class="hljs-number"><span class="hljs-number">0.8f</span></span>, <span class="hljs-number"><span class="hljs-number">0.85f</span></span>); colors[counter].g = <span class="hljs-number"><span class="hljs-number">0.005f</span></span> / heigh + Random.Range(<span class="hljs-number"><span class="hljs-number">0.8f</span></span>, <span class="hljs-number"><span class="hljs-number">0.85f</span></span>); colors[counter].b = <span class="hljs-number"><span class="hljs-number">0.01f</span></span> / heigh + Random.Range(<span class="hljs-number"><span class="hljs-number">0.8f</span></span>, <span class="hljs-number"><span class="hljs-number">0.85f</span></span>); } }</code> </pre><br>  The winter is coming.  If water gets under the distribution, cover it with a homogeneous snow crust, otherwise cover it with a snow crust with weak outlines of the continents with slight darkening in the region of the hills. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetOcean</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> counter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> heigh</span></span></span><span class="hljs-function">)</span></span> { colors[counter].r = heigh / <span class="hljs-number"><span class="hljs-number">5</span></span>; colors[counter].g = heigh / <span class="hljs-number"><span class="hljs-number">5</span></span>; colors[counter].b = <span class="hljs-number"><span class="hljs-number">0.2f</span></span> + heigh / <span class="hljs-number"><span class="hljs-number">2</span></span> + Random.Range(<span class="hljs-number"><span class="hljs-number">-0.02f</span></span>, <span class="hljs-number"><span class="hljs-number">0.02f</span></span>); }</code> </pre><br>  Well, everything is clear here, the ocean is on the other planets the ocean. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetGreen</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> counter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> heigh</span></span></span><span class="hljs-function">)</span></span> { colors[counter].g = <span class="hljs-number"><span class="hljs-number">0.1f</span></span> / heigh + <span class="hljs-number"><span class="hljs-number">0.05f</span></span> + Random.Range(<span class="hljs-number"><span class="hljs-number">-0.04f</span></span>, <span class="hljs-number"><span class="hljs-number">0.04f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (heigh &lt; waterLevel + <span class="hljs-number"><span class="hljs-number">0.1f</span></span>) colors[counter].g -= (waterLevel + <span class="hljs-number"><span class="hljs-number">0.1f</span></span> - heigh); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (colors[counter].g &gt; <span class="hljs-number"><span class="hljs-number">0.5f</span></span>) colors[counter].g = <span class="hljs-number"><span class="hljs-number">0.5f</span></span> / heigh + <span class="hljs-number"><span class="hljs-number">0.05f</span></span> + Random.Range(<span class="hljs-number"><span class="hljs-number">-0.04f</span></span>, <span class="hljs-number"><span class="hljs-number">0.04f</span></span>); colors[counter].r = <span class="hljs-number"><span class="hljs-number">0</span></span>; colors[counter].b = <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br>  We change color in inverse proportion to height - the higher, the darker.  In addition, so that the edges of the continents are not illuminated, we reduce it slightly at the water edge. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetDesert</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> counter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> heigh</span></span></span><span class="hljs-function">)</span></span> { colors[counter].r = Random.Range(<span class="hljs-number"><span class="hljs-number">0.6f</span></span>, <span class="hljs-number"><span class="hljs-number">0.75f</span></span>) + heigh / <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">0.35f</span></span>; colors[counter].g = Random.Range(<span class="hljs-number"><span class="hljs-number">0.6f</span></span>, <span class="hljs-number"><span class="hljs-number">0.75f</span></span>) + heigh / <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">0.35f</span></span>; colors[counter].b = Random.Range(<span class="hljs-number"><span class="hljs-number">0.2f</span></span>, <span class="hljs-number"><span class="hljs-number">0.3f</span></span>) + heigh / <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">0.35f</span></span>; }</code> </pre><br>  Everything is clear, and another type of terrain: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetMountains</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> counter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> heigh</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rnd = Random.Range(<span class="hljs-number"><span class="hljs-number">-0.03f</span></span>, <span class="hljs-number"><span class="hljs-number">0.03f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (heigh &gt; <span class="hljs-number"><span class="hljs-number">1.1f</span></span>) heigh = <span class="hljs-number"><span class="hljs-number">1.1f</span></span> + Random.Range(<span class="hljs-number"><span class="hljs-number">-0.05f</span></span>, <span class="hljs-number"><span class="hljs-number">0.05f</span></span>); colors[counter].r = heigh * heigh / <span class="hljs-number"><span class="hljs-number">2</span></span> + rnd - <span class="hljs-number"><span class="hljs-number">0.1f</span></span>; colors[counter].g = heigh * heigh / <span class="hljs-number"><span class="hljs-number">2</span></span> + rnd - <span class="hljs-number"><span class="hljs-number">0.1f</span></span>; colors[counter].b = heigh * heigh / <span class="hljs-number"><span class="hljs-number">2</span></span> + rnd - <span class="hljs-number"><span class="hljs-number">0.05f</span></span>; }</code> </pre><br>  Mountains, while avoiding glare (a separate question, why do values ‚Äã‚Äãappear at all greater than 1.0f, but the unit seems to have nothing against it). <br><br>  And the service method of checking the value between the minimum and maximum will be used to determine whether a point belongs to a belt: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ChechInRange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> min, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> max, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rand</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &gt; min + rand) &amp;&amp; (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &lt; max + rand)); }</code> </pre><br>  And now the very meat: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Heighmap_class.Generate(); TemperatureCurves_class.Generate(); tex.Resize(Heighmap_class.xsize, Heighmap_class.ysize); tex.Apply(); SqrHeighmap(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; Heighmap_class.ysize; y++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; Heighmap_class.xsize; x++) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> heigh = Heighmap_class.heighmap[x, y]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (heigh &lt; waterLevel) SetOcean(counter, heigh); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ChechInRange(y, TemperatureCurves_class.southSnow[x], TemperatureCurves_class.northSnow[x], Random.Range(<span class="hljs-number"><span class="hljs-number">-10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>))) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ChechInRange(y, TemperatureCurves_class.southGreen[x], TemperatureCurves_class.northGreen[x], Random.Range(<span class="hljs-number"><span class="hljs-number">-10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>))) { SetDesert(counter, heigh); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (heigh &lt; waterLevel + <span class="hljs-number"><span class="hljs-number">0.1f</span></span> + Random.Range(<span class="hljs-number"><span class="hljs-number">-0.05f</span></span>, <span class="hljs-number"><span class="hljs-number">0.05f</span></span>)) SetGreen(counter, heigh); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> SetGreen(counter, heigh); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (heigh &gt; <span class="hljs-number"><span class="hljs-number">0.82f</span></span> + Random.Range(<span class="hljs-number"><span class="hljs-number">-0.05f</span></span>, <span class="hljs-number"><span class="hljs-number">0.05f</span></span>)) SetMountains(counter, heigh); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((y &lt; TemperatureCurves_class.southSnow[x] + Random.Range(<span class="hljs-number"><span class="hljs-number">-10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>)) || (y &gt; TemperatureCurves_class.northSnow[x] + Random.Range(<span class="hljs-number"><span class="hljs-number">-10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>))) SetSnow(counter, heigh); counter++; } SmoothImg(); tex.SetPixels(colors); tex.Apply(); }</code> </pre><br>  Let's try the words: <br>  We generate a height map, generate belt boundaries, initialize the texture, square it. <br>  In the loop: <br>  If the height is less than the ocean level, fill the pixel with the ocean. <br>  Otherwise, check for belonging to the green strip, inside we check the belonging of the desert, if so, then we make a desert, if not - then green. <br>  On top of this just put the mountains, if suddenly the height was high. <br>  And even higher, if you hit the Arctic Circle, then we call the <s>white walkers</s> snow. <br>  Well, after the cycle, we smooth the image and load it into the texture. <br><br>  This is the generator I got.  And what is yours? <br><img src="http://i.imgur.com/2JuuxtB.png?1" alt="image"><br><br>  PS Sources: <br>  <a href="https://drive.google.com/file/d/0By_SLVoA8ddOYnB6R0o2Z0dQeGs/view%3Fusp%3Dsharing">Demo</a> <br>  <a href="https://drive.google.com/file/d/0By_SLVoA8ddOM2MxcTc3WUNQNnc/view%3Fusp%3Dsharing">Unity project</a> <br><div class="spoiler">  <b class="spoiler_title">Text</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Heighmap_class</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ysize = <span class="hljs-number"><span class="hljs-number">1025</span></span>, xsize = ysize * <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[,] heighmap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[xsize, ysize]; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> roughness = <span class="hljs-number"><span class="hljs-number">2f</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  ,  ,      public static void Square(int lx, int ly, int rx, int ry) { int l = (rx - lx) / 2; float a = heighmap[lx, ly]; // B--------C float b = heighmap[lx, ry]; // | | float c = heighmap[rx, ry]; // | ce | float d = heighmap[rx, ly]; // | | int cex = lx + l; // A--------D int cey = ly + l; heighmap[cex, cey] = (a + b + c + d) / 4 + Random.Range(-l * 2 * roughness / ysize, l * 2 * roughness / ysize); } static bool lrflag = false; public static void Diamond(int tgx, int tgy, int l) { float a, b, c, d; if (tgy - l &gt;= 0) a = heighmap[tgx, tgy - l]; // C-------- else // | | a = heighmap[tgx, ysize - l]; // B---t g----D | // | | // A-------- if (tgx - l &gt;= 0) b = heighmap[tgx - l, tgy]; else if (lrflag) b = heighmap[xsize - l, tgy]; else b = heighmap[ysize - l, tgy]; if (tgy + l &lt; ysize) c = heighmap[tgx, tgy + l]; else c = heighmap[tgx, l]; if (lrflag) if (tgx + l &lt; xsize) d = heighmap[tgx + l, tgy]; else d = heighmap[l, tgy]; else if (tgx + l &lt; ysize) d = heighmap[tgx + l, tgy]; else d = heighmap[l, tgy]; heighmap[tgx, tgy] = (a + b + c + d) / 4 + Random.Range(-l * 2 * roughness / ysize, l * 2 * roughness / ysize); } public static void DiamondSquare(int lx, int ly, int rx, int ry) { int l = (rx - lx) / 2; Square(lx, ly, rx, ry); Diamond(lx, ly + l, l); Diamond(rx, ry - l, l); Diamond(rx - l, ry, l); Diamond(lx + l, ly, l); } public static void MidPointDisplacement(int lx, int ly, int rx, int ry) { int l = (rx - lx) / 2; if (l &gt; 0) { float a = heighmap[lx, ly]; // B--------C float b = heighmap[lx, ry]; // | | float c = heighmap[rx, ry]; // | ce | float d = heighmap[rx, ly]; // | | // A--------D int cex = lx + l; int cey = ly + l; heighmap[cex, cey] = (a + b + c + d) / 4 + Random.Range(-l * 2 * roughness / xsize, l * 2 * roughness / xsize); heighmap[lx, cey] = (a + b) / 2 + Random.Range(-l * 2 * roughness / xsize, l * 2 * roughness / xsize); heighmap[rx, cey] = (c + d) / 2 + Random.Range(-l * 2 * roughness / xsize, l * 2 * roughness / xsize); heighmap[cex, ly] = (a + d) / 2 + Random.Range(-l * 2 * roughness / xsize, l * 2 * roughness / xsize); heighmap[cex, ry] = (b + c) / 2 + Random.Range(-l * 2 * roughness / xsize, l * 2 * roughness / xsize); MidPointDisplacement(lx, ly, cex, cey); MidPointDisplacement(lx, ly + l, lx + l, ry); MidPointDisplacement(cex, cey, rx, ry); MidPointDisplacement(lx + l, ly, rx, cey); } } public static void Generate() { heighmap[0, 0] = Random.Range(0.3f, 0.6f); heighmap[0, ysize - 1] = Random.Range(0.3f, 0.6f); heighmap[xsize - 1, ysize - 1] = Random.Range(0.3f, 0.6f); heighmap[xsize - 1, 0] = Random.Range(0.3f, 0.6f); heighmap[ysize - 1, ysize - 1] = Random.Range(0.3f, 0.6f); heighmap[ysize - 1, 0] = Random.Range(0.3f, 0.6f); for (int l = (ysize - 1) / 2; l &gt; 0; l /= 2) for (int x = 0; x &lt; xsize - 1; x += l) { if (x &gt;= ysize - l) lrflag = true; else lrflag = false; for (int y = 0; y &lt; ysize - 1; y += l) DiamondSquare(x, y, x + l, y + l); } } }</span></span></code> </pre><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TemperatureCurves_class</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> xsize = Heighmap_class.xsize; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> snowEdge = Heighmap_class.ysize / <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> greenEdge = Heighmap_class.ysize / <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] northGreen = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[xsize]; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] southGreen = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[xsize]; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] northSnow = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[xsize]; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] southSnow = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[xsize]; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> snowRoughness = <span class="hljs-number"><span class="hljs-number">0.03f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> greenRoughness = <span class="hljs-number"><span class="hljs-number">0.15f</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MidPointDisplacement1D</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] curve, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> l, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> r, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> roughness</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (r - l &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { curve[(l + r) / <span class="hljs-number"><span class="hljs-number">2</span></span>] = (curve[l] + curve[r]) / <span class="hljs-number"><span class="hljs-number">2</span></span> + (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)Random.Range(-(r - l) * roughness, (r - l) * roughness); MidPointDisplacement1D(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> curve, l, (l + r) / <span class="hljs-number"><span class="hljs-number">2</span></span>, roughness); MidPointDisplacement1D(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> curve, (l + r) / <span class="hljs-number"><span class="hljs-number">2</span></span>, r, roughness); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Generate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { northSnow[<span class="hljs-number"><span class="hljs-number">0</span></span>] = northSnow[xsize - <span class="hljs-number"><span class="hljs-number">1</span></span>] = Heighmap_class.ysize - snowEdge; southSnow[<span class="hljs-number"><span class="hljs-number">0</span></span>] = southSnow[xsize - <span class="hljs-number"><span class="hljs-number">1</span></span>] = snowEdge; northGreen[<span class="hljs-number"><span class="hljs-number">0</span></span>] = northGreen[xsize - <span class="hljs-number"><span class="hljs-number">1</span></span>] = Heighmap_class.ysize - greenEdge; southGreen[<span class="hljs-number"><span class="hljs-number">0</span></span>] = southGreen[xsize - <span class="hljs-number"><span class="hljs-number">1</span></span>] = greenEdge + Random.Range(<span class="hljs-number"><span class="hljs-number">-100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>); MidPointDisplacement1D(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> northGreen, <span class="hljs-number"><span class="hljs-number">0</span></span>, xsize - <span class="hljs-number"><span class="hljs-number">1</span></span>, greenRoughness); MidPointDisplacement1D(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> southGreen, <span class="hljs-number"><span class="hljs-number">0</span></span>, xsize - <span class="hljs-number"><span class="hljs-number">1</span></span>, greenRoughness); MidPointDisplacement1D(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> northSnow, <span class="hljs-number"><span class="hljs-number">0</span></span>, xsize - <span class="hljs-number"><span class="hljs-number">1</span></span>, snowRoughness); MidPointDisplacement1D(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> southSnow, <span class="hljs-number"><span class="hljs-number">0</span></span>, xsize - <span class="hljs-number"><span class="hljs-number">1</span></span>, snowRoughness); } }</code> </pre><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Renderer_script</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Texture2D tex; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Color[] colors = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Color[Heighmap_class.xsize * Heighmap_class.ysize]; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> waterLevel = <span class="hljs-number"><span class="hljs-number">0.2f</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SqrHeighmap</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; Heighmap_class.xsize; x++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; Heighmap_class.ysize; y++) Heighmap_class.heighmap[x, y] *= Heighmap_class.heighmap[x, y]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetSnow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> counter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> heigh</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (heigh &lt; waterLevel + Random.Range(<span class="hljs-number"><span class="hljs-number">-0.04f</span></span>, <span class="hljs-number"><span class="hljs-number">0.04f</span></span>)) colors[counter] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Color(Random.Range(<span class="hljs-number"><span class="hljs-number">0.8f</span></span>, <span class="hljs-number"><span class="hljs-number">0.85f</span></span>), Random.Range(<span class="hljs-number"><span class="hljs-number">0.8f</span></span>, <span class="hljs-number"><span class="hljs-number">0.85f</span></span>), Random.Range(<span class="hljs-number"><span class="hljs-number">0.85f</span></span>, <span class="hljs-number"><span class="hljs-number">0.9f</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { colors[counter].r = <span class="hljs-number"><span class="hljs-number">0.005f</span></span> / heigh + Random.Range(<span class="hljs-number"><span class="hljs-number">0.8f</span></span>, <span class="hljs-number"><span class="hljs-number">0.85f</span></span>); colors[counter].g = <span class="hljs-number"><span class="hljs-number">0.005f</span></span> / heigh + Random.Range(<span class="hljs-number"><span class="hljs-number">0.8f</span></span>, <span class="hljs-number"><span class="hljs-number">0.85f</span></span>); colors[counter].b = <span class="hljs-number"><span class="hljs-number">0.01f</span></span> / heigh + Random.Range(<span class="hljs-number"><span class="hljs-number">0.8f</span></span>, <span class="hljs-number"><span class="hljs-number">0.85f</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetOcean</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> counter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> heigh</span></span></span><span class="hljs-function">)</span></span> { colors[counter].r = heigh / <span class="hljs-number"><span class="hljs-number">5</span></span>; colors[counter].g = heigh / <span class="hljs-number"><span class="hljs-number">5</span></span>; colors[counter].b = <span class="hljs-number"><span class="hljs-number">0.2f</span></span> + heigh / <span class="hljs-number"><span class="hljs-number">2</span></span> + Random.Range(<span class="hljs-number"><span class="hljs-number">-0.02f</span></span>, <span class="hljs-number"><span class="hljs-number">0.02f</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetGreen</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> counter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> heigh</span></span></span><span class="hljs-function">)</span></span> { colors[counter].g = <span class="hljs-number"><span class="hljs-number">0.1f</span></span> / heigh + <span class="hljs-number"><span class="hljs-number">0.05f</span></span> + Random.Range(<span class="hljs-number"><span class="hljs-number">-0.04f</span></span>, <span class="hljs-number"><span class="hljs-number">0.04f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (heigh &lt; waterLevel + <span class="hljs-number"><span class="hljs-number">0.1f</span></span>) colors[counter].g -= (waterLevel + <span class="hljs-number"><span class="hljs-number">0.1f</span></span> - heigh); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (colors[counter].g &gt; <span class="hljs-number"><span class="hljs-number">0.5f</span></span>) colors[counter].g = <span class="hljs-number"><span class="hljs-number">0.5f</span></span> / heigh + <span class="hljs-number"><span class="hljs-number">0.05f</span></span> + Random.Range(<span class="hljs-number"><span class="hljs-number">-0.04f</span></span>, <span class="hljs-number"><span class="hljs-number">0.04f</span></span>); colors[counter].r = <span class="hljs-number"><span class="hljs-number">0</span></span>; colors[counter].b = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetDesert</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> counter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> heigh</span></span></span><span class="hljs-function">)</span></span> { colors[counter].r = Random.Range(<span class="hljs-number"><span class="hljs-number">0.6f</span></span>, <span class="hljs-number"><span class="hljs-number">0.75f</span></span>) + heigh / <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">0.35f</span></span>; colors[counter].g = Random.Range(<span class="hljs-number"><span class="hljs-number">0.6f</span></span>, <span class="hljs-number"><span class="hljs-number">0.75f</span></span>) + heigh / <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">0.35f</span></span>; colors[counter].b = Random.Range(<span class="hljs-number"><span class="hljs-number">0.2f</span></span>, <span class="hljs-number"><span class="hljs-number">0.3f</span></span>) + heigh / <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">0.35f</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetMountains</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> counter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> heigh</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rnd = Random.Range(<span class="hljs-number"><span class="hljs-number">-0.03f</span></span>, <span class="hljs-number"><span class="hljs-number">0.03f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (heigh &gt; <span class="hljs-number"><span class="hljs-number">1.1f</span></span>) heigh = <span class="hljs-number"><span class="hljs-number">1.1f</span></span> + Random.Range(<span class="hljs-number"><span class="hljs-number">-0.05f</span></span>, <span class="hljs-number"><span class="hljs-number">0.05f</span></span>); colors[counter].r = heigh * heigh / <span class="hljs-number"><span class="hljs-number">2</span></span> + rnd - <span class="hljs-number"><span class="hljs-number">0.1f</span></span>; colors[counter].g = heigh * heigh / <span class="hljs-number"><span class="hljs-number">2</span></span> + rnd - <span class="hljs-number"><span class="hljs-number">0.1f</span></span>; colors[counter].b = heigh * heigh / <span class="hljs-number"><span class="hljs-number">2</span></span> + rnd - <span class="hljs-number"><span class="hljs-number">0.05f</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SmoothImg</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; Heighmap_class.xsize * Heighmap_class.ysize - <span class="hljs-number"><span class="hljs-number">2</span></span>; i++) { Color clr1 = colors[i]; Color clr2 = colors[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; colors[i] = (<span class="hljs-number"><span class="hljs-number">2</span></span> * clr1 + clr2) / <span class="hljs-number"><span class="hljs-number">3</span></span>; colors[i + <span class="hljs-number"><span class="hljs-number">1</span></span>] = (clr1 + <span class="hljs-number"><span class="hljs-number">2</span></span> * clr2) / <span class="hljs-number"><span class="hljs-number">3</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ChechInRange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> min, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> max, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rand</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &gt; min + rand) &amp;&amp; (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &lt; max + rand)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Heighmap_class.Generate(); TemperatureCurves_class.Generate(); tex.Resize(Heighmap_class.xsize, Heighmap_class.ysize); tex.Apply(); SqrHeighmap(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; Heighmap_class.ysize; y++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; Heighmap_class.xsize; x++) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> heigh = Heighmap_class.heighmap[x, y]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (heigh &lt; waterLevel) SetOcean(counter, heigh); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ChechInRange(y, TemperatureCurves_class.southSnow[x], TemperatureCurves_class.northSnow[x], Random.Range(<span class="hljs-number"><span class="hljs-number">-10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>))) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ChechInRange(y, TemperatureCurves_class.southGreen[x], TemperatureCurves_class.northGreen[x], Random.Range(<span class="hljs-number"><span class="hljs-number">-10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>))) { SetDesert(counter, heigh); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (heigh &lt; waterLevel + <span class="hljs-number"><span class="hljs-number">0.1f</span></span> + Random.Range(<span class="hljs-number"><span class="hljs-number">-0.05f</span></span>, <span class="hljs-number"><span class="hljs-number">0.05f</span></span>)) SetGreen(counter, heigh); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> SetGreen(counter, heigh); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (heigh &gt; <span class="hljs-number"><span class="hljs-number">0.82f</span></span> + Random.Range(<span class="hljs-number"><span class="hljs-number">-0.05f</span></span>, <span class="hljs-number"><span class="hljs-number">0.05f</span></span>)) SetMountains(counter, heigh); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((y &lt; TemperatureCurves_class.southSnow[x] + Random.Range(<span class="hljs-number"><span class="hljs-number">-10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>)) || (y &gt; TemperatureCurves_class.northSnow[x] + Random.Range(<span class="hljs-number"><span class="hljs-number">-10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>))) SetSnow(counter, heigh); counter++; } SmoothImg(); tex.SetPixels(colors); tex.Apply(); } }</code> </pre><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/249027/">https://habr.com/ru/post/249027/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../249015/index.html">Creating plug-ins for AutoCAD using the .NET API (part 3 - working with layers)</a></li>
<li><a href="../249017/index.html">Surface mounting: stencil and reflow oven at home</a></li>
<li><a href="../249021/index.html">The evolution of SAAS website designers</a></li>
<li><a href="../249023/index.html">Candelabrum vs Lollipop</a></li>
<li><a href="../249025/index.html">Announcement of the JPoint 2015 Java Conference</a></li>
<li><a href="../249029/index.html">Xcode 6 Objective-C Modernization Tool</a></li>
<li><a href="../249031/index.html">The synapse ensemble is a structural unit of the neural network</a></li>
<li><a href="../249037/index.html">Scan and index pages in multiple languages</a></li>
<li><a href="../249039/index.html">How I implemented multilingualism on the site and in the project</a></li>
<li><a href="../249041/index.html">YouTube abandoned Flash in favor of HTML5 by default.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>