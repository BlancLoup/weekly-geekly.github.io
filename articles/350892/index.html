<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Customize Syncthing. Blue insulating tape in small business and at home</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I suddenly had a guide on how to configure syncthing. I am sure that this may be useful to many. 

 About the revolution in the distribution of files,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Customize Syncthing. Blue insulating tape in small business and at home</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/e61/63f/aac/e6163faac9f0d68a393404bcf7c1da18.svg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/cd5/58a/b49/cd558ab492821fb346e6904bcb6c81cd.png" alt="image"><br>  I suddenly had a guide on how to configure syncthing.  I am sure that this may be useful to many. <br><br>  About the revolution in the distribution of files, which made the torrent-protocol to talk too.  One problem was with the classic version of the technology - static.  If the data in the directory was changed, you had to re-create and transfer the new torrent file to everyone.  And suddenly, BitTorrentSync suddenly appears.  Happiness comes, now you can synchronize whole arrays of changing data.  However, after a while, the proprietary nature of software translates into a drastic reduction in functionality, linking to its servers and a rather aggressive monetization.  This is where the ideologically kosher free successor comes to the scene - Syncthing. <br><a name="habracut"></a><br>  Syncthing, like normal torrent, can crawl through almost any barriers in the form of firewalls, NAT, and the like.  In the case of gray IP addresses, it relies on centralized relays and server announcers.  In this case, you can safely raise them yourself, which gives complete independence from the developers infrastructure.  All nodes in the cluster are equal.  You can set two-sided and one-sided synchronization when the changes on the deleted copies do not affect the original.  Is able to versioning.  Beauty, in a word. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In my case, the task of daily backup database was solved.  3 independent offices in different parts of the city.  Internet via Yota-modem stuck in Mikrotik.  The channel is narrow and unstable in width.  The main idea that has been implemented is the exchange of database bases on the principle of the torrent-protocol at night, when the load on the network is minimal, and nobody touches the database.  As a result, each unit stores copies of two adjacent ones.  Good redundancy and geographical distribution, which has already saved once, when the server was suddenly killed by a lightning strike. <br><br>  Install.  By default, I mean a server based on deb-based Linux, although syncthing has versions for Windows and Android.  For production, add the repositories from the stable branch and install: <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Add the release PGP keys: curl -s https://syncthing.net/release-key.txt | sudo apt-key add - # Add the "stable" channel to your APT sources: echo "deb https://apt.syncthing.net/ syncthing stable" | sudo tee /etc/apt/sources.list.d/syncthing.list # Update and install syncthing: sudo apt-get update sudo apt-get install syncthing</span></span></code> </pre> <br>  Now you need to deal with demons.  Such software should not work as root.  All files created as a result of synchronization must belong to a local user.  Therefore, there are two options - automatic start as a system service or as a user service.  The second option will work only when the user is logged in via ssh or logged in to the local system.  We are interested in the system daemon, and the systemd publicly beloved by the public is best for this.  Paths may vary slightly in different distributions.  This manual applies to Debian and Ubuntu 16.04 Server.  First, create a unit: <br><br><pre> <code class="bash hljs">sudo nano /etc/systemd/system/syncthing@.service</code> </pre> <br>  And we bring in the following contents: <br><br> <code>[Unit] <br> Description=Syncthing - Open Source Continuous File Synchronization for %I <br> Documentation=man:syncthing(1) <br> After=network.target <br> Wants=syncthing-inotify@.service <br> <br> [Service] <br> User=%i <br> ExecStart=/usr/bin/syncthing -no-browser -no-restart -logflags=0 <br> Restart=on-failure <br> SuccessExitStatus=3 4 <br> RestartForceExitStatus=3 4 <br> <br> [Install] <br> WantedBy=multi-user.target <br></code> <br><br>  Now it remains only to activate the service on behalf of the desired user and you can configure the node. <br><br><pre> <code class="bash hljs">sudo systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> syncthing@username.service sudo systemctl start syncthing@username.service</code> </pre><br><img src="https://habrastorage.org/webt/59/e4/5f/59e45f0a74703115820823.png"><br><br>  The interface is available at 127.0.0.1:8384.  If you want to log in from another machine, you will have to fix the config ~ / .config / syncthing / config.xml.  Further settings are extremely simple - trusted nodes are added using a unique key, and then the necessary directories are shared in single- or two-way synchronization.  If necessary, you can manually specify the ip address and port of the node; without this, a network of server announcers and relays will be used to establish the connection.  Moreover, you can raise announcers and relays on your infrastructure, which allows you to use the software within the company's extensive local network. <br><br><img src="https://habrastorage.org/webt/59/e4/09/59e409a48481d813622594.png"><br><br>  At any time, you can conveniently view a list of synchronized files.  Extremely useful and easy to set up turned out software.  Resources consumes quite sparingly.  right now in standby mode it eats about 15 megabytes of RAM and a fraction of a percent of processor time.  The total amount of data in a cluster in the region of 500 GB. <br><br>  Good luck to everyone in the experiments.  Durable electrical tape. <br><br><h2>  Update 1 </h2><br>  Thanks <a href="https://habr.com/users/datacompboy/" class="user_link">datacompboy</a> .  Found an interesting flag to ignore the deletion in the master node. <br><blockquote>  the incoming index updates updates.  When set, incoming updates with flag set are ignored. </blockquote><br><br>  Some problem is that from the point of view of other nodes, it will be an out of sync. <br><br><blockquote>  Assume two devices, ‚ÄúAlice‚Äù and ‚ÄúBob‚Äù, are sharing a folder.  Bob has set ignoreDelete. <br><br>  Alice and Bob.  Deleted as well.  When Alice deletes a file <br><br>  In this state, it can be seen. <br><br>  It has been noted that it has been the case. <br><br>  It is a rainy day. </blockquote>  . <br><br><h2>  Update 2 </h2><br>  Addition from <a href="https://habr.com/users/stam_emg/" class="user_link">Stam_emg</a> . <br>  To automatically confirm customers, you can do this: <br><blockquote>  It is necessary to turn on the Introducer mode on the distribution server, then when adding a folder on the client, it will be added to the server without confirmation. </blockquote><br>  docs.syncthing.net/users/introducer.html </div><p>Source: <a href="https://habr.com/ru/post/350892/">https://habr.com/ru/post/350892/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350882/index.html">(Not) original greeting for March 8</a></li>
<li><a href="../350884/index.html">Analog Clock, CSS and Nothing More</a></li>
<li><a href="../350886/index.html">Simple static webpack site 4</a></li>
<li><a href="../350888/index.html">Service Portal: how does a single interface work for interacting with an IaaS provider?</a></li>
<li><a href="../350890/index.html">The Power of Open: The Power of Openness</a></li>
<li><a href="../350894/index.html">Digest of interesting materials for the mobile developer # 244 (March 5 - March 11)</a></li>
<li><a href="../350896/index.html">Effective data compression methods when training neural networks. Lecture in Yandex</a></li>
<li><a href="../350898/index.html">10 main qualities of a manager according to Google</a></li>
<li><a href="../350900/index.html">Multi-classification of Google queries using neural network in Python</a></li>
<li><a href="../350902/index.html">Podcast "Rules of the Game": accounting subtleties for technological (and other) business</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>