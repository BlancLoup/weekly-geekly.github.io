<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PVS-Studio now supports C ++ / CLI</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Support for projects written in C ++ / CLI is not a priority in PVS-Studio. There are quite a few such projects, but nevertheless from time to time we...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PVS-Studio now supports C ++ / CLI</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/9d3/c20/130/9d3c20130c3ee0f66c55671af7fcad48.png" alt="PVS-Studio, C ++ / CLI" align="left"><br>  Support for projects written in C ++ / CLI is not a priority in PVS-Studio.  There are quite a few such projects, but nevertheless from time to time we come across them.  Microsoft currently has no plans to stop supporting the C ++ / CLI language, so we decided to support this type of language. <br><a name="habracut"></a><br><h2>  C ++ / CLI support </h2><br>  Wikipedia: <a href="http://www.viva64.com/go.php%3Furl%3D1397">C ++ / CLI</a> - <a href="http://www.viva64.com/go.php%3Furl%3D1397">C ++</a> programming language binding to Microsoft .NET programming environment.  It integrates the C ++ ISO standard with the Unified Type System (UTS), considered as part of the Common Language Infrastructure (Common Language Infrastructure, CLI).  It supports both the source level and the interoperability of executables compiled from native and managed C ++.  C ++ / CLI is a further development of C ++. <br><br>  We implemented C ++ / CLI support in PVS-Studio at a level sufficient for testing most projects.  However, we didn‚Äôt have enough projects to test and some language constructs may be processed incorrectly or will produce obviously false positives.  It's hard to keep track of everything.  If you have any problems with checking your projects, please let us know. <br><br>  This article can be finished, but it is not interesting.  Therefore, we checked a small project SlimDX about what and describe below. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Slimdx </h2><br>  Wikipedia: <a href="http://www.viva64.com/go.php%3Furl%3D1398">SlimDX</a> is an open source API to DirectX programming under .NET.  SlimDX can be used for any language under the .NET runtime (due to the CLR).  SlimDX can be used to develop multimedia and interactive applications (eg games).  It makes it possible to use the graphical hardware. <br><br>  Official site: <a href="http://slimdx.org/">http://slimdx.org/</a> <br><br>  The check was carried out with the help of the <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> code analyzer.  Since the project is small and represents a wrapper over another library, there were very few suspicious places.  However, they are enough to write about them. <br><br><h2>  Test results </h2><br>  Below are the code snippets that seemed to me wrong. <br><br>  <b>Fragment N1</b> <br><pre><code class="cpp hljs">ContainmentType BoundingBox::Contains( BoundingBox box, BoundingSphere sphere ) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( box.Minimum.X + radius &lt;= sphere.Center.X &amp;&amp; sphere.Center.X &lt;= box.Maximum.X - radius &amp;&amp; box.Maximum.X - box.Minimum.X &gt; radius &amp;&amp; &lt;&lt;&lt;=== box.Minimum.Y + radius &lt;= sphere.Center.Y &amp;&amp; sphere.Center.Y &lt;= box.Maximum.Y - radius &amp;&amp; box.Maximum.Y - box.Minimum.Y &gt; radius &amp;&amp; box.Minimum.Z + radius &lt;= sphere.Center.Z &amp;&amp; sphere.Center.Z &lt;= box.Maximum.Z - radius &amp;&amp; box.Maximum.X - box.Minimum.X &gt; radius) &lt;&lt;&lt;=== <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ContainmentType::Contains; .... }</code> </pre> <br>  PVS-Studio warning: V501 There are identical sub-expressions 'box.Maximum.X - box.Minimum.X&gt; radius' operator.  boundingbox.cpp 94 <br><br>  Most likely this code was written using Copy-Paste and forgot to make changes in the last line.  At the end of the expression should be written "box.Maximum.Z - box.Minimum.Z&gt; radius". <br><br>  <b>Fragment N2</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DIJOYSTATE2</span></span></span><span class="hljs-class"> {</span></span> .... LONG rglSlider[<span class="hljs-number"><span class="hljs-number">2</span></span>]; .... LONG rglVSlider[<span class="hljs-number"><span class="hljs-number">2</span></span>]; .... LONG rglASlider[<span class="hljs-number"><span class="hljs-number">2</span></span>]; .... LONG rglFSlider[<span class="hljs-number"><span class="hljs-number">2</span></span>]; .... } DIJOYSTATE2, *LPDIJOYSTATE2; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> JoystickState::AssignState(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DIJOYSTATE2 &amp;joystate) { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>; i++ ) { sliders[i] = joystate.rglSlider[i]; asliders[i] = joystate.rglASlider[i]; vsliders[i] = joystate.rglVSlider[i]; fsliders[i] = joystate.rglVSlider[i]; } .... }</code> </pre> <br>  PVS-Studio warning: V525 The code containing the collection of similar blocks.  Check items 'rglSlider', 'rglASlider', 'rglVSlider', 'rglVSlider' in lines 93, 94, 95, 96. joystickstate.cpp 93 <br><br>  I think this code contains a typo.  The last line probably should have used the rglFSlider array: <br><pre> <code class="cpp hljs">sliders[i] = joystate.rglSlider[i]; asliders[i] = joystate.rglASlider[i]; vsliders[i] = joystate.rglVSlider[i]; fsliders[i] = joystate.rglFSlider[i];</code> </pre> <br>  <b>Fragment N3</b> <br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">array</span></span>&lt;SoundEffectResult&gt;^ SecondarySoundBuffer::SetEffects( <span class="hljs-built_in"><span class="hljs-built_in">array</span></span>&lt;Guid&gt;^ effects ) { DWORD count = effects-&gt;Length; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( effects != <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span> &amp;&amp; count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) .... }</code> </pre> <br>  PVS-Studio warning: V595 The 'effects' pointer was used before it was verified against nullptr.  Check lines: 66, 73. secondarysoundbuffer.cpp 66 <br><br>  At the beginning, the 'effects' pointer is dereferenced.  Then, in the code below, it is checked for equality to zero. <br><br>  <b>Fragment N4</b> <br><br>  There is a 'TVariable' class that contains virtual functions: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> IBaseInterface&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TVariable</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IBaseInterface { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> BOOL </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsValid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ .... } .... };</code> </pre> <br>  The class SMember is inherited from this class.  Note that zeros are written to the fields of this class using the ZeroMemory () function. <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SMember</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TVariable&lt;TMember&lt;ID3DX11EffectVariable&gt; &gt; { }; CEffectVectorOwner&lt;SMember&gt; m_pMemberInterfaces; ZeroMemory HRESULT CEffect::CopyMemberInterfaces(....) { .... ZeroMemory( &amp;m_pMemberInterfaces[i], <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(SMember) * ( Members - i ) ); .... }</code> </pre> <br>  PVS-Studio warning: V598 The 'memset' function is used to make it clear the fields of the 'SMember' class.  Virtual method table will be maintained by this.  effectnonruntime.cpp 1739 <br><br>  Since there are virtual functions, the SMember class contains a pointer to a table of virtual methods.  This pointer will be corrupted when the ZeroMemory () function is called. <br><br>  Similarly: <ul><li>  effectload.cpp 1106 </li><li>  effectload.cpp 1107 </li></ul><br>  <b>Fragment N5</b> <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">warning</span></span></span><span class="hljs-meta">(disable: 4369) public enum class WaveFormatTag : System::Int32 { Pcm = WAVE_FORMAT_PCM, AdPcm = WAVE_FORMAT_ADPCM, IeeeFloat = WAVE_FORMAT_IEEE_FLOAT, MpegLayer3 = WAVE_FORMAT_MPEGLAYER3, DolbyAC3Spdif = WAVE_FORMAT_DOLBY_AC3_SPDIF, WMAudio2 = WAVE_FORMAT_WMAUDIO2, WMAudio3 = WAVE_FORMAT_WMAUDIO3, WmaSpdif = WAVE_FORMAT_WMASPDIF, Extensible = WAVE_FORMAT_EXTENSIBLE, }; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">warning</span></span></span><span class="hljs-meta">(default: 4369)</span></span></code> </pre> <br>  PVS-Studio warning: V665 Possibly, the usage of #pragma warning (default: X) 'is incorrect in this context.  The '#pragma warning (push / pop)' should be used instead.  Check lines: 1089, 1102. enums.h 1102 <br><br>  Incorrect compiler warnings suppressed.  At the end, the default value is restored.  More correctly at the beginning to save the state of the settings, and then restore.  This is not a serious mistake.  However, for libraries it is important not to spoil the alert level settings in user projects.  The correct way to suppress warnings is described in the <a href="http://www.viva64.com/ru/d/0290/">V665</a> warning <a href="http://www.viva64.com/ru/d/0290/">description</a> . <br><br>  There are several similar shortcomings in the header file "enums.h".  Line numbers: 224, 267, 346. <br><br><h2>  Conclusion </h2><br>  I admit that the first article about checking the C ++ / CLI project turned out to be boring and brief.  The first pancake is lumpy.  I hope in the future it will be possible to check out some larger and more interesting project. <br><br>  I suggest to download and test your C ++ / CLI projects using <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> .  We will be happy to receive your feedback and comments. <br><br><h2>  This article is in English. </h2><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Andrey Karpov.  <a href="http://www.viva64.com/en/b/0255/">C ++ / CLI Now Supported in PVS-Studio</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected the answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio and CppCat, version 2014</a> .  Please review the list. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/221721/">https://habr.com/ru/post/221721/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../221707/index.html">Remote access to accepted payments and project statistics by API in Funding.To</a></li>
<li><a href="../221711/index.html">Useful materials for mobile developer # 51 (April 28-May 4)</a></li>
<li><a href="../221713/index.html">Attack of bots on Twitter. Pleas for help to the community</a></li>
<li><a href="../221715/index.html">3D Ultrasonic Healing Corset</a></li>
<li><a href="../221719/index.html">Programming and JTAG debugging of the Atmega16 microcontroller in the C language in the IAR environment, part 1</a></li>
<li><a href="../221723/index.html">No one can handle errors</a></li>
<li><a href="../221727/index.html">Last day of registration for the all-Ukrainian UA Web Challenge VI championship for front-end developers</a></li>
<li><a href="../221733/index.html">What is the difference between factory and provider in AngularJS (on fingers)</a></li>
<li><a href="../221735/index.html">Imagine Cup 2014, as it was or a three-year path to the final</a></li>
<li><a href="../221737/index.html">Mediabox</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>