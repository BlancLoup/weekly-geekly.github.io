<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Short course of computer graphics, addendum: we treat according to the photo</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A year ago I published a series of articles aimed at popularizing graphic programming. A lot of water has flowed under the bridge since then, an Engli...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Short course of computer graphics, addendum: we treat according to the photo</h1><div class="post__text post__text-html js-mediator-article">  A year ago I published a <a href="https://habrahabr.ru/post/248963/">series of articles</a> aimed at popularizing graphic programming.  A lot of water has flowed under the bridge since then, an <a href="https://github.com/ssloy/tinyrenderer/wiki">English version of the</a> cycle appeared, which underwent some polishing compared to the original.  This year several hundred people wrote to me, and many asked to help debug their code. <br><br>  I suggest you play a game: I give only a picture on which the problem is visible, try to understand where in the code you need to look for a bug, what exactly is broken.  I play this game every day, thoroughly watch hundreds of versions of the render, I have no way, so I, as a real psychic, fly through the photo.  Often successful. <br><br>  Absolutely all the pictures are not generated by me, I just collected the most typical bugs.  The real human pain in front of your eyes, to me, of course, is addressed (especially by mail) only after they cannot find the bug themselves within a reasonable time. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here is the first bug for the seed, on the left a broken render, on the right what was expected: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d3e/ccd/e4f/d3eccde4f31474b9ade4b264477e8579.jpg"><br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  The first hint: very round shape.  Immediately he hints that instead of an array of vertices, a person has loaded an array of normal vectors, more precisely, he confused the lines ‚Äúvxyz‚Äù and ‚Äúvn xyz‚Äù from the .obj file </div></div><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b80/40f/de5/b8040fde592d3a0fa6b54aaf1e84fe58.png"><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  Triangles do not fit well with each other.  In the wavefront .obj files, the array indices start with one, and not from zero, a person forgot to subtract one after reading the model file. </div></div><br><br><img src="https://habrastorage.org/getpro/habr/post_images/0b2/2e2/053/0b22e205331a5a10ea33558c5a26b09b.jpg"><br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  Note that all the triangles are in their geometric location, and the texture problem areas form full rings around one vertex, which hints that one vertex is periodically broken.  So it was, there was a floating bug in reading textural indices. </div></div><br><br><img src="https://habrastorage.org/getpro/habr/post_images/fb0/fc1/d44/fb0fc1d445a17a1ee26522366b1c9eaa.png"><br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  In the picture, Guro's tinting, the filling of the triangle are clearly done using a scanning line, when the vertices are sorted according to their coordinates, and then the triangle is swept up with horizontal lines.  The order of the peaks has changed, but the color of the peaks has been forgotten.  Very frequent bug. </div></div><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c09/3b5/127/c093b512715cfa08d45452dc20b52289.jpg"><br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  In the picture is a broken z-buffer.  Almost the same as the previous bug, just forgot to change the z-coordinate of the vertices when sorting. </div></div><br><br><img src="https://habrastorage.org/getpro/habr/post_images/e6e/c3d/e24/e6ec3de24cbf32e8ce08bfb0dfbb20cf.jpg"><br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  And again the same bug, but slightly in another place: when a triangle is swept up, for convenience it is divided into two parts, each horizontal line is drawn from left to right.  Swapping the top of the line, they forgot about the texture coordinates. </div></div><br><br><img src="https://habrastorage.org/getpro/habr/post_images/6c8/4c9/3b3/6c84c93b36521f790be576abc2a781e2.png"><br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  Rounding errors, the scanning line game is explicitly calculated by interpolation, rather than directly making a sweeping cycle. </div></div><br><br><img src="https://habrastorage.org/getpro/habr/post_images/408/860/75a/40886075a4e126410befd93036d421ac.png"><br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  Again rounding errors, the screen vertices of the triangle were not rounded before rasterization. </div></div><br><br>  It is useful to know here that a person tried to make a shiny surface (specular map): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/218/5f0/9af/2185f09af8e7142b214ee17747936466.jpg"><br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  It doesn't matter that a degree of zero gives a unit ... </div></div><br><br><img src="https://habrastorage.org/getpro/habr/post_images/610/b5c/57b/610b5c57b3059c7679af64e5ddab995e.jpg"><br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  Rasterization of the triangle is clearly done through the barycentric coordinates, and it would be nice to move them in a circle when calculating texture coordinates. </div></div><br><br><img src="https://habrastorage.org/getpro/habr/comment_images/506/5f5/5d3/5065f55d3585088c84b1c35e5b2c120e.jpg"><br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  The texture clearly needs to be flipped vertically. </div></div><br><br>  Ha, this picture is very similar to the previous one, but the bug is completely different (why?) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a69/c08/a14/a69c08a146e1815944c96f4242d126c7.jpg"><br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  Instead of texture coordinates, the person simply used the xy of the current pixel to search for the color in the texture ... </div></div><br><br>  Here and below are pictures before and after debugging: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fed/52e/e5a/fed52ee5aabeba11400cc2916f20efa8.png"><br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  The direction of the light was used to cut off the rear faces.  But it would be necessary to look at the direction ... </div></div><br><br>  Attempt to apply normal map: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/68d/2b9/5b7/68d2b95b7df78ac40d164339c1f0d06a.jpg"><br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  Well, the color living in RGB [0,255] ^ 3 was converted to XYZ, living in [0,2] ^ 3, and not in [-1,1] ^ 3. </div></div><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c62/be1/5fd/c62be15fd1bf48f4e58a6ff4d9e9d59e.png"><br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  With flat shading, the light vector and / or the normal vector was not normalized, as a result, an attempt to draw colors with a value of more than 255, unsigned char overflow </div></div><br><br><img src="https://habrastorage.org/getpro/habr/post_images/352/d53/0a0/352d530a0efbce5fe453983d78b2584e.png"><br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  Overflow is evident again, but this time negative values.  Man forgot that the scalar product is negative.  The picture on the right is fabs (intensity), the previous picture could be obtained if instead of fabs we used the usual clamp </div></div><br><br><img src="https://habrastorage.org/getpro/habr/post_images/310/f08/c1b/310f08c1b541594fab458b1e4cd01f34.jpg"><br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  Explicitly negative focus on the camera, the wrong sign was used <a href="https://github.com/ssloy/tinyrenderer/wiki/Lesson-4:-Perspective-projection">in the formula (2)</a> </div></div><br><br><h3>  Surprise </h3><br><br>  Incredibly, today I received exactly the same bug from a perfect other person, as we have already seen, with file parsing + a texturing bug! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c81/c30/788/c81c30788615ce548f1d113626ed7ca3.jpg"><br><br>  Have fun! </div><p>Source: <a href="https://habr.com/ru/post/278309/">https://habr.com/ru/post/278309/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278291/index.html">Eric the Blood Ax (Chris Goggans): "Information wants to be free"</a></li>
<li><a href="../278293/index.html">JARVIS - the invisible assistant to Leo</a></li>
<li><a href="../278299/index.html">Internet and calls from a smartphone - free of charge for a month</a></li>
<li><a href="../278303/index.html">Zabbix Moscow Meetup 2016</a></li>
<li><a href="../278305/index.html">‚ÄúAttack on Wi-Fi‚Äù at Barcelona Airport (MWC 2016) - much ado about nothing</a></li>
<li><a href="../278313/index.html">Java programmer cheat sheet 7.2 Typical tasks: Traversing the Map, counting the number of occurrences of a substring</a></li>
<li><a href="../278315/index.html">Digest KolibriOS # 11 all the news from the latest issue and Google Summer of Code 2016</a></li>
<li><a href="../278317/index.html">Monitoring from Russia: new features of the HostTracker service</a></li>
<li><a href="../278319/index.html">What to do when entangled in textures</a></li>
<li><a href="../278323/index.html">Unusual property of push notifications - lifetime</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>