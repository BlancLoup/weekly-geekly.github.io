<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CSTroN - a homemade monitor on a vintage CSTN-matrix with a VGA-input and control board on the FPGA</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What if TFT never invented? LCD monitor with CSTN-matrix 

 Introduction 
 When CRT monitors prevailed, the following argument was put forward in thei...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CSTroN - a homemade monitor on a vintage CSTN-matrix with a VGA-input and control board on the FPGA</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/ts/vw/uo/tsvwuobygirooozzafy1gnmiiua.jpeg"><br><br>  What if TFT never invented?  LCD monitor with CSTN-matrix <br><br><h1>  Introduction </h1><br>  When CRT monitors prevailed, the following argument was put forward in their favor: despite all the improvements, LCD displays never outperform pipe imaging.  They, as before, will be used only where energy efficiency and small thickness are required [1].  Decades have passed, and now we know whether the proponents of this argument were right.  But today it is interesting to look at the LCDs of that time: are they really so low-quality?  What is it like to look at the CSTN matrix in 2019? <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/fm/yv/rf/fmyvrfvnpiqfyih0abovza8tn-m.jpeg"><br><br>  <i>Left TFT, right CSTN, both displays from the nineties</i> <br><br><h1>  LCD in the last century </h1><br>  Before switching to TFT, a variety of display technologies were used in portable computers.  At first, they used the same CRT monitors as desktop computers, only smaller ones.  For example, in Compaq Portable (1983), IBM 5155 (1984) or Commodore SX-64 (also 1984). <br><br><img src="https://habrastorage.org/webt/ge/nb/za/genbzaejmhqeermw61pdxau4nli.jpeg"><br><br>  <i>IBM 5155, author: Soupmeister, license: CC-BY-SA-2.0, <a href="https://www.flickr.com/photos/29012094%40N07/5235790747">from here</a></i> <br><br>  Carrying such a PC with you everywhere was hard, a completely different thing - a laptop with TN-LCD (twist nematic), for example, IBM 5140 (1986), Toshiba T1000 (1987).  These displays have low contrast and viewing angle. <br><br><img src="https://habrastorage.org/webt/ee/u8/xr/eeu8xrwciq0nl2cl6z8cha0zu5u.jpeg"><br><br>  <i>Toshiba T1100 with a monochrome TN-display, author: Johann H. Addicks, license: GFDL, <a href="http://www.addicks.net/gallery/Irgendwo/Toshiba_T1100_In_Betrieb">hence</a> , the link is broken, in the original too</i> <br><br>  Some manufacturers have experimented with gas discharge matrices, so Toshiba T3200 (1987) and IBM PS / 2 P70 (1991) laptops saw the light.  They provided high contrast and several shades of brightness in red-orange light, but they were quite expensive.  Finally, STN-LCDs (supertwist nematic) were developed, as, for example, in MS1504 Electronics and its Toshiba T1100 prototype.  The contrast was much better - from 1: 5 to 1:50, and several gradations of brightness were enough for business applications (using a laptop in everyday life was still too expensive).  But what if the user wants a color image?  In this case, he was offered two technologies: TFT and CSTN (color supertwist nematic).  The first notebook with TFT - NEC PC9801NC - was introduced in 1990, the image quality for those years was above all praise, but it cost ‚Äúsuch a toy‚Äù much more than other, and so expensive, portable computers.  Well, the CSTN-display is just an STN-display, which is superimposed on the filter.  For a long time, matrices of both types were used in laptops.  And in the cars of the New York subway CSTN-monitors are still working. <br><br><img src="https://habrastorage.org/webt/kk/ch/bd/kkchbdoyuc75xvwabt_3zwmrcp0.jpeg"><br><br>  <i>One of them, source: <a href="https://www.youtube.com/channel/UC-kZX9OHvg7H8dwkTtl8npw">Transit + PLUS</a></i> <br><br><h1>  CSTroN </h1><br>  The author wanted to look at the CSTN-display.  How?  For starters, just buy an old laptop with it and use it.  It was AMD 5x86-P133 processor.  That is, the most dynamic thing that can be run on it is DOS games (oh well, he and MPEG1 will pull in the program QV - translator).  Of course, it‚Äôs great to play them, but I wanted to see how YouTube, for example, looks on such a display or a modern game - but this is impossible. <br><br>  Or? <br><br>  In general, you need to somehow add a VGA or HDMI input to it - and you can send a signal from something modern.  TFT screens from laptops are often converted into monitors quite often.  Just buy a fee that fits the matrix - and that's it.  And you can make your own prefix on the FPGA, which converts a VGA or HDMI signal into a stream of data about pixels. <br><br>  Some time ago, motherboards were also released to turn CSTN matrixes into VGA monitors, but this is no longer to be found.  But you can adapt for this debug board on the ML505 FPGA. <br><br><img src="https://habrastorage.org/webt/ts/vw/uo/tsvwuobygirooozzafy1gnmiiua.jpeg"><br><br>  <i>The finished result.</i>  <i>It is rather unusual to observe this on the CSTN-display: 16 GB of RAM.</i> <br><br><h1>  Matrix Management </h1><br>  Let's start with the basics.  Like any matrix display, the CSTN display has rows and columns.  Have you ever led a microcontroller LED array?  Here is the same, but the stresses are variable.  You need to send certain signals to both selected and unselected rows and columns - and the pixel at the intersection of the selected row and column will show what you need.  The shape of the signals is quite complex, the mean square voltage value, the phase shift between the voltages on the row and the column, and the offset are important ... And so, pixel by pixel, an image is formed. <br><br>  Fortunately, the FPGA is not required to generate all these signals, and even on such a huge number of lines.  All this is done by the module built into the display.  There the pulse converter increases the constant voltage, it passes through the divider and the repeater, this is how the bias voltage is obtained.  Row and column drivers transform this voltage into a variable of the required form.  All that is required is to submit a stream of data about the state of pixels to the display module. <br><br>  On TFT-LCD with DPI (digital parallel interface) interface, all data on one pixel are received at once in one clock cycle.  On the line of horizontal and vertical synchronization, pulses arrive after each, respectively, line and frame.  Pixels are simply continuously transmitted line by line, frame by frame.  If the transfer of a full frame takes 1/60 s, then the refresh rate is 60 Hz.  The data bus width is equal to the color depth in bits, usually 16 (5 bits for red and blue, 6 for green), 18 (6 bits for each of the colors), or 24 (8 bits for each of the colors).  LVDS is the same thing, only the bits are transmitted not in parallel, but in series along the differential pairs, but in MIPI DSI they are also combined into packets.  The SPI / i80 bus allows you to send various commands to the controller, and the one that executes them generates signals for a DPI or similar interface.  Which, in turn, is somewhat similar to VGA, only the data on the brightness of each of the colors do not come in analog, but in digital form.  There are VGA to DPI converters and back.  The boards are very convenient, allowing to receive a VGA-signal from the Raspberry Pi, although initially this computer produces only HDMI and composite video. <br><br>  The display module of the CSTN-matrix should be given signals that are very similar to those supplied to the TFT-matrix with the DPI interface.  The datasheet on the SX21V001 [2] shows how to control a CSTN display with a resolution of 640x480: <br><br><img src="https://habrastorage.org/webt/ga/au/fu/gaaufudmnscsyjt2mj89ir2hj-g.png"><br><br>  Here is the transfer of the whole frame.  The signal comes to the CL1 line after each line, to the FLM - after each frame.  And there is a data bus of 16 lines.  Actually, in this figure, an error was made: during the transmission of the first and second lines, data Y1 and Y2 are received along the lines UD0-UD7, but not X1 and X2, and along LD0-LD8 - Y241 and Y242, respectively.  Here, U and L are, respectively, upper and lower, that is, the display consists of two matrices with a resolution of 640x240, one above the other.  Here it is, the mysterious "dual scan" from the old laptop advertising, from which the horizontal bar comes across the entire screen.  In STN and CSTN displays, the contrast is inversely proportional to the number of rows, so this separation allows it to be increased.  But this is not the only way in which they differ in control from TFT. <br><br><img src="https://habrastorage.org/webt/po/cu/_2/pocu_2wfevtfpev7hbuapasb2va.png"><br><br>  It is not clear why the horizontal axis here was called Y ... But in any case, CL2 here is a line for supplying clock pulses switching pixels.  But for the UD and LD buses, in a single clock cycle, not data about one multi-bit pixel, as in a TFT, is transmitted, but data about several pixels at once, three bits for each.  One bit per color, three bits per pixel ‚Äî eight colors in all. <br><br><img src="https://habrastorage.org/webt/ur/dr/6u/urdr6uzrqstflu-gy2r5q-opazy.jpeg"><br><br>  But how so?  It is clear that the number of colors in CSTN-displays is small, for example, 4096 or 32768, but not 8.  It turns out that PWM is used here.  Light-emitting diodes are controlled in this way, which means that LCD pixels are also possible.  We need, for example, a brightness of 50% - we turn on a pixel in even frames and turn it off in odd frames.  This method is called FRC (frame rate control), well, in this context, PWM is called pixel brightness control in the same way, but within not one or more frames, but one.  The FRC performs the external device, and the PWM implements the chips in the display module, if there is support for this function.  The author does not know CSTN displays with PWM, but he assumes that these are HPA-type matrices.  In any case, since PWM is not available, the required color depth can be obtained using FRC. <br><br><img src="https://habrastorage.org/webt/2s/fv/ui/2sfvuishe3qnnb9fytk4mmbthju.jpeg"><br><br>  The price of this will be flickering, so there are monstrous (compared to TFT) frame rates in CSTN displays.  For example, in this module initially was 120 Hz, and the author overclocked it to 240. <br><br><h1>  How it was implemented </h1><br>  The developer had several difficulties at once: <br><br>  - the input signal has a frame rate of 60 Hz, it should be doubled or even quadrupled <br><br>  - in the input signal, the frame is not divided into upper and lower halves of 640x240 pixels each, but here it is necessary to divide <br><br>  - and still need to implement FRC, otherwise the color depth will be 3 bits per pixel <br><br>  The first two points mean that a framebuffer is needed, and not simple, but a two-port one.  Well, the third problem is solved using the GLDP LUT (grayscale-level display pattern lookup table) [3].  The lookup table has two types of input data: the color to be displayed and the state of the frame counter.  And one kind of output data: those three bits that need to be sent to the subpixels of one or another pixel at the moment.  Hence, the following nodes will be required: <br><br><img src="https://habrastorage.org/webt/fi/lx/4-/filx4-nrwyepv-5jjdvjd5jvgh0.png"><br><br>  The first step is to fill the entire screen with some color.  At this stage, it is not necessary to know where a pixel is, it is enough to make sure that the display module supplies signals of the required shape to the matrix.  The code for the fill in the FPGA is <a href="">here</a> . <br><br><img src="https://habrastorage.org/webt/_m/ux/-q/_mux-qskx5al8bielsybiavnvba.jpeg"><br><br>  Now we will try to display something, and with incomplete brightness as well.  Looking for such lookup tables for FRC to minimize flicker.  The author came up with two tables that are applied to the pixels in staggered order.  Therefore, every two adjacent pixels flicker out of sync.  The code is <a href="">here</a> . <br><br><img src="https://habrastorage.org/webt/f2/vl/n9/f2vln9pc18h0txrwkm632snrlns.jpeg"><br><br>  So, to show the image we have already ‚Äútaught‚Äù the board, the next thing you need is a framebuffer.  With 640x480 and 5 bits for each of the colors, its volume will be about 600 kilobytes.  Not much, but there is not so much in FPGA.  Well, the board has DDR2 RAM and Xilinx MIG for managing it.  Two FIFOs are implemented, one for reading, the other for writing.  The arbitrator decides whether the next data exchange with DDR2 will be reading or writing.  There are two buffers, the recording goes to one, reading from another, and when changing frames, they are swapped.  Referee code is <a href="">here</a> . <br><br>  It remains to realize the video capture, in one of the previous projects of the author there is already a similar development, after completion the converter code from VGA to DPI has become <a href="">like this</a> . <br><br><h1>  And what happened? </h1><br>  Look! <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/hsehw-7-VTM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  For the author, this is the third project on the FPGA, it was interesting to work with the Xilinx MIG and DDR2, as well as with a simple conveyor.  A better FRC with delta-sigma modulation is planned, as well as experiments with later CSTN panels using Sharp's HPA (High Performance Addressing) technology. <br><br>  Thanks for attention! <br><br><h1>  Sources </h1><br>  1. Li, W., &amp; Guo, Q. (2000).  Liquid Crystal Display Application Technology.  Beijing: Electrical Industry Press. <br><br>  2. HITACHI (1999).  SX21V001-Z4 Customer's Acceptance Specifications. <br><br>  3. Hsueh, Y., &amp; Lee, J. (2008).  Image improvement method for LCD frame rate controller.  2008 IEEE International Symposium on Consumer Electronics.  doi: 10.1109 / isce.2008.4.4959534 </div><p>Source: <a href="https://habr.com/ru/post/444762/">https://habr.com/ru/post/444762/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../444748/index.html">3 key qualities of a successful product manager: Yuri Golikov, VP of Engineering Wrike</a></li>
<li><a href="../444750/index.html">The new version of Firefox blocks the automatic playback of media content.</a></li>
<li><a href="../444756/index.html">DARPA will develop a nuclear rocket engine</a></li>
<li><a href="../444758/index.html">Technical differences between BI systems (Power BI, Qlik Sense, Tableau)</a></li>
<li><a href="../444760/index.html">CNC machine from what was lying around in the garage</a></li>
<li><a href="../444764/index.html">Java cryptography</a></li>
<li><a href="../444766/index.html">Facebook employees had access to the passwords of Facebook and Instagram users.</a></li>
<li><a href="../444768/index.html">Decreased dependence on tagged data on generative-contention networks</a></li>
<li><a href="../444770/index.html">How we looked for data leakage in SimilarWeb</a></li>
<li><a href="../444774/index.html">Error with ru-RU locale migration to Google Chrome and how to get rid of it</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>