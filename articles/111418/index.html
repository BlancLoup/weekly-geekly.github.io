<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Basics of JavaScript execution and interaction with sites within Qt programs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Many have probably heard about the Qt cross-platform library. About the WebKit web page display engine all the more. Not so long ago, t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Basics of JavaScript execution and interaction with sites within Qt programs</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  Many have probably heard about the Qt cross-platform library.  About the WebKit web page display engine all the more.  Not so long ago, the first one began to contain a wrapper over the second, examples of creating browsers in 50 lines are not difficult to find.  However, not much is written about how to access individual elements of a web page from a Qt code. <br><a name="habracut"></a><br>  In this description, I assume that people have basic knowledge of PyQt (I taught in Summerfield), and a vague idea of ‚Äã‚ÄãJavaScript.  I characterize my level exactly that way, so I apologize in advance for mistakes, especially in the description of the java script.  Despite the fact that C ++ / Qt programmers should not be used as a language for Python. <br>  Test examples run on PyQt-4.7.3, version of Python-2.6.6-r1 under the GNU / Linux OS.  From the programs you need a browser with debugging JS (Chrome, for example) and PyQt IDE at your discretion, I use Eric4. <br><br><h4>  Example 1. The browser, which we will scoff </h4><br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"># -*- coding: utf-8 -*- <br> <font color="#0000ff">from</font> PyQt4.QtCore import * <br> <font color="#0000ff">from</font> PyQt4.QtNetwork import * <br> <font color="#0000ff">from</font> PyQt4.QtGui import * <br> <font color="#0000ff">from</font> PyQt4.QtWebKit import * <br> <br> <font color="#0000ff">class</font> BaseBrowser(QWidget): <br> def __init__(self, parent = None): <br> super(BaseBrowser, self).__init__(parent) <br> self.__progress = 0 <br> QNetworkProxyFactory.setUseSystemConfiguration(True) <br> self.webView = QWebView() <br> self.webView.load(QUrl( <font color="#A31515">"http://www.yandex.ru"</font> )) <br> self.connect(self.webView, SIGNAL( <font color="#A31515">"loadFinished(bool)"</font> ), self.adjustLocation) <br> self.connect(self.webView, SIGNAL( <font color="#A31515">"titleChanged(QString)"</font> ), self.adjustTitle) <br> self.connect(self.webView, SIGNAL( <font color="#A31515">"loadProgress(int)"</font> ), self.setProgress) <br> self.connect(self.webView, SIGNAL( <font color="#A31515">"loadFinished(bool)"</font> ), self.finishLoading) <br> self.locationEdit = QLineEdit() <br> self.locationEdit.setSizePolicy(QSizePolicy.Expanding, self.locationEdit.sizePolicy().verticalPolicy()) <br> self.connect(self.locationEdit, SIGNAL( <font color="#A31515">"returnPressed()"</font> ), self.changeLocation) <br> self.goButton = QPushButton( <font color="#A31515">"Go"</font> ) <br> self.connect(self.goButton, SIGNAL( <font color="#A31515">"clicked()"</font> ), self.changeLocation) <br> self.layout = QGridLayout(self) <br> self.layout.addWidget(self.locationEdit, 0, 0) <br> self.layout.addWidget(self.goButton, 0, 1) <br> self.layout.addWidget(self.webView, 1, 0, 1, 2) <br> self.setLayout(self.layout) <br> <br> def adjustLocation(self): <br> self.locationEdit.setText(self.webView.url().toString()) <br> <br> def changeLocation(self): <br> url = self.locationEdit.text() <br> <font color="#0000ff">if</font> url[0:7] != <font color="#A31515">'http://'</font> : <br> url = <font color="#A31515">'http://'</font> + url <br> self.webView.load(QUrl(url)) <br> self.webView.setFocus() <br> <br> def adjustTitle(self): <br> <font color="#0000ff">if</font> self.__progress &lt;= 0 or self.__progress &gt;= 100: <br> self.setWindowTitle(self.webView.title()) <br> <font color="#0000ff">else</font> : <br> self.setWindowTitle(QString( <font color="#A31515">"%1 (%2%)"</font> ).arg(self.webView.title()).arg(self.__progress)) <br> <br> def setProgress(self, p): <br> self.__progress = p <br> self.adjustTitle() <br> <br> def finishLoading(self): <br> self.__progress = 100 <br> self.adjustTitle() <br> <br> <font color="#0000ff">if</font> __name__ == <font color="#A31515">"__main__"</font> : <br> import sys <br> app = QApplication(sys.argv) <br> prog = BaseBrowser() <br> prog.show() <br> sys.exit(app.exec_())</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Example 1 code: <u><a href="http://pastebin.com/GVQ4dw1M">pastebin.com/GVQ4dw1M</a></u> <br><br>  The browser presents a variation on the browser theme from the C ++ / Qt and PyQt tutorial examples, in the next two examples we will inherit it.  I understand that programs, even small ones, do not write, and the program should not be one class, but I keep the balance between the amount of code, its visibility and correctness of the architecture as I can. <br>  So, our browser is not able to do much, but it can load and display the entered page, the QWebView widget is used for this, standard signals created by this widget are tied to the slots of our browser, which allows the program to know the program to change the title of the current SIGNAL web page (‚ÄútitleChanged (QString) "), the progress of loading SIGNAL (" loadProgress (int) ") and the end of loading - SIGNAL (" loadFinished (bool) ").  In addition, a QlineEdit field is created to enter the address of the page and a button to go to this web page, either by pressing ‚ÄúEnter‚Äù or clicking on the button. <br>  We launch the browser, try it in work, ofigam on the speed of the work of the ‚Äúbare‚Äù WebKit.  So far we have not written anything special.  Our browser does not even follow links by any. <br><br><h4>  Example 2. DOM trees and access to their elements from Qt </h4><br><br>  In general, it would be better to read about the structure of HTML pages separately, to describe this in two sentences is problematic.  In general, if you make an offline shell to any web interface, the Java script will still need to learn, at least that part of it that relates to data access.  So, any modern browser allows you to access the contents of a web page by presenting it in a tree of nodes, each node of which is an element, attribute, text, graphic, or any other object.  The nodes are interconnected by a parent-child relationship (yes, this is a string from Wikipedia).  Using the JavaScript interpreter, the nodes of this tree can be accessed.  Let's open our browser and go to the same yandex.ru (I hope they will not be covered with a habra effect).  How many links do you see above the search box? <br>  Click on the list of links and open them in the developer‚Äôs menu (in Chrome, this is ‚Äúcheck item‚Äù in the context list).  So we will see the position of the current element in the tree.  The list has a simple id = "tabs" and is a table.  Switch to the JavaScript console and try selecting this table: <br> <code>document.getElementById("tabs").</code> <br>  Look at how many lines in it: <br> <code>document.getElementById("tabs").rows.length</code> <br>  And how many columns: <br> <code>document.getElementById("tabs").rows(0).cells.length.</code> <br>  Now we get the same result in our browser. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"># -*- coding: utf-8 -*- <br> <font color="#0000ff">from</font> basebrowser import * <br> <br> <font color="#0000ff">class</font> SimpleJavaScript(BaseBrowser): <br> def __init__(self, parent = None): <br> super(SimpleJavaScript, self).__init__(parent) <br> self.jsButton = QPushButton( <font color="#A31515">"ExecuteJS"</font> ) <br> self.connect(self.jsButton, SIGNAL( <font color="#A31515">"clicked()"</font> ), self.jsScript) <br> self.jsStringEdit = QLineEdit() <br> self.jsStringEdit.setSizePolicy(QSizePolicy.Expanding, self.jsStringEdit.sizePolicy().verticalPolicy()) <br> self.jsStringEdit.setText( <font color="#A31515">"document.getElementById(\"tabs\").rows(0).cells.length"</font> ) <br> self.connect(self.jsStringEdit, SIGNAL( <font color="#A31515">"returnPressed()"</font> ), self.jsScript) <br> self.jsReturnText = QTextEdit() <br> self.layout.addWidget(self.jsStringEdit, 2, 0, 1, 1) <br> self.layout.addWidget(self.jsButton, 2, 1, 1, 1) <br> self.layout.addWidget(self.jsReturnText, 3, 0, 1, 2) <br> <br> def jsScript(self): <br> jsString = self.jsStringEdit.text() <br> jsReturn = self.webView.page().currentFrame().evaluateJavaScript(jsString) <br> self.jsReturnText.setPlainText(jsReturn.toString()) <br> <br> <font color="#0000ff">if</font> __name__ == <font color="#A31515">"__main__"</font> : <br> import sys <br> app = QApplication(sys.argv) <br> ui = SimpleJavaScript() <br> ui.show() <br> sys.exit(app.exec_())</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Example 2 code: <u><a href="http://pastebin.com/p4P1ZEtS">pastebin.com/p4P1ZEtS</a></u> <br>  So the JS code is calculated in the webView.page (). CurrentFrame (). EvaluateJavaScript (jsString) function <br>  The evaluateJavaScript function (string) takes as its only argument a QString string containing the JavaScript code.  This code will be executed on the current page and the result will be returned as a QVariant variable.  At the same time, unfortunately, you will not be able to get the subtree of DOM elements as a result, but any textual or numeric information is welcome. <br><br><h4>  Example 3. Creating offline controls </h4><br><br>  This time, the address of the homepage is chosen because I have an ATI card and I am sitting under Linux, who knows, he will understand that this is not from big love.  In fact, there are many Select controls on the page, for one of which we will create an equivalent. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"># -*- coding: utf-8 -*- <br> <font color="#0000ff">from</font> basebrowser import * <br> <font color="#0000ff">from</font> PyQt4.QtGui import * <br> <font color="#0000ff">from</font> PyQt4.QtCore import * <br> <br> <font color="#0000ff">class</font> JSSelectList(QAbstractListModel): <br> def __init__ (self, _id, _jsFunc, parent = None): <br> super(JSSelectList, self).__init__(parent) <br> self.id = _id <br> self.jsFunc = _jsFunc <br> <br> def data(self, index, role=Qt.DisplayRole): <br> <font color="#0000ff">if</font> not index.isValid(): <br> <font color="#0000ff">return</font> QVariant() <br> <font color="#0000ff">if</font> role == Qt.DisplayRole: <br> jsstring = QString( <font color="#A31515">"document.getElementById('%1').options[%2].textContent"</font> ).arg(self.id).arg(index.row()) <br> jsreturn = self.jsFunc(jsstring) <br> <font color="#0000ff">return</font> jsreturn.toString().trimmed() <br> <br> def rowCount(self, index=QModelIndex()): <br> jsstring = QString( <font color="#A31515">"document.getElementById('%1').length"</font> ).arg(self.id) <br> jsreturn = self.jsFunc(jsstring) <br> ok = False <br> count, ok = jsreturn.toInt() <br> <font color="#0000ff">return</font> count <font color="#0000ff">if</font> ok <font color="#0000ff">else</font> 0 <br> <br> def headerData(self, section, orientation, role=Qt.DisplayRole): <br> <font color="#0000ff">if</font> role != Qt.DisplayRole: <br> <font color="#0000ff">return</font> QVariant() <br> <font color="#0000ff">else</font> : <br> <font color="#0000ff">return</font> self.id <br> <br> <font color="#0000ff">class</font> JSComboBoxDemo(BaseBrowser): <br> def __init__(self, parent = None): <br> super(JSComboBoxDemo, self).__init__(parent) <br> self.vendorComboBox = QComboBox() <br> id = QString( <font color="#A31515">"productLine"</font> ) <br> self.vendorListModel = JSSelectList(id, self.webView.page().currentFrame().evaluateJavaScript) <br> self.vendorComboBox.setModel(self.vendorListModel) <br> self.connect(self.vendorComboBox, SIGNAL( <font color="#A31515">"currentIndexChanged(int)"</font> ), self.setSelectOnWebPage); <br> self.connect(self.webView, SIGNAL( <font color="#A31515">"loadFinished(bool)"</font> ), self.initComboBox) <br> self.layout.addWidget(self.vendorComboBox, 2, 0, 1, 1) <br> self.webView.load(QUrl( <font color="#A31515">"http://www.amd.com"</font> )) <br> <br> def setSelectOnWebPage(self, new_id): <br> jsstring = QString( <font color="#A31515">"document.getElementById('productLine').selectedIndex=%1"</font> ).arg(new_id) <br> self.webView.page().currentFrame().evaluateJavaScript(jsstring) <br> <br> def initComboBox(self): <br> self.vendorComboBox.setCurrentIndex(0) <br> <br> <font color="#0000ff">if</font> __name__ == <font color="#A31515">"__main__"</font> : <br> import sys <br> app = QApplication(sys.argv) <br> ui = JSComboBoxDemo() <br> ui.show() <br> sys.exit(app.exec_())</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Example 3 code: <u><a href="http://pastebin.com/YzA9hL3H">pastebin.com/YzA9hL3H</a></u> <br><br>  When creating such GUI elements as a table, list, dropdown (I don‚Äôt know how to translate correctly), Qt allows you to use the convenient MVC approach.  You only need to describe the access to your data model - you only need to inherit your data representation from the built-in abstract class and attach it to the standard control (for Summerfield, this seems to be chapter 14).  In this case, QAbstractListModel is used, from the parameters it is passed only the JS execution function and the name select  ªa on the page.  All override standards. <br><br>  In the example itself, everything is also quite clear, except for two signal-slot connections that I would like to draw your attention to. <br><br>  First, it is useless to try to execute JavaScript before the page loads, so we‚Äôll use the fact that when the download finishes, the QWebView widget generates the SIGNAL ("loadFinished (bool)") signal, which I already mentioned in the first example. <br><br> <code>self.connect(self.webView, SIGNAL("loadFinished(bool)"), self.initComboBox)</code> <br> <br>  Otherwise, if you push a string <br><br> <code>self.vendorComboBox.setCurrentIndex(0)</code> <br> <br>  in __init__, no initialization of the first value will occur - evaluateJavaScript will not return anything, since the page will not have time to load yet. <br>  Secondly, we need synchronization in both directions: <br><br> <code>self.connect(self.vendorComboBox, SIGNAL("currentIndexChanged(int)"), self.setSelectOnWebPage)</code> <br> <br>  Similarly, you can synchronize almost all the information on the page, click buttons, download information. <br><br>  I would be glad if the information will be useful for someone.  Merry Christmas and all the New Year. <br><br>  References: <br><br>  J. Blanchett, M. Summerfield.  Qt 4: GUI programming in C ++. <br>  Mark Summerfield.  Rapid GUI Programming with Python and Qt. <br>  Other sources: <br>  Various Internet sites on JavaScript and PyQt, the source code of the Internet browser Arora. </div><p>Source: <a href="https://habr.com/ru/post/111418/">https://habr.com/ru/post/111418/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../111412/index.html">Excel is my financial auditor</a></li>
<li><a href="../111413/index.html">Molecular Dynamics Programming</a></li>
<li><a href="../111415/index.html">We write our handler task on .NET</a></li>
<li><a href="../111416/index.html">"Vkontakte" - a paradise for the spammer</a></li>
<li><a href="../111417/index.html">Genetic Algorithms in MATLAB</a></li>
<li><a href="../111419/index.html">Group discount services - typical communication problems</a></li>
<li><a href="../111420/index.html">'Hello World' tutorial - your first application on the Play framework (Part 1)</a></li>
<li><a href="../111422/index.html">How do datagrids work and why?</a></li>
<li><a href="../111424/index.html">Unfinished transition history from Delphi to C #</a></li>
<li><a href="../111425/index.html">Tactile Technologies and Society: Cultural Newspeak</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>