<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Javascript Neural Networks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The idea for writing this article came up last summer, when I listened to a talk at the BigData conference on neural networks. The lecturer ‚Äúsprinkled...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Javascript Neural Networks</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/4d6/aec/01e/4d6aec01e1492b48c0657c0322f49a76.jpg" alt="image"><br>  The idea for writing this article came up last summer, when I listened to a talk at the BigData conference on neural networks.  The lecturer ‚Äúsprinkled‚Äù the listeners with the unusual words ‚Äúneuron‚Äù, ‚Äútraining sample‚Äù, ‚Äútrain the model‚Äù ... ‚ÄúI didn‚Äôt understand anything - it's time for managers,‚Äù I thought.  But recently the topic of neural networks nevertheless touched my work and I decided on a simple example to show how to use this tool in JavaScript. <br><br>  We will create a neural network with which we will recognize the manual writing of numbers from 0 to 9. The working example will take several lines.  The code will be clear even to those programmers who have not dealt with neural networks before.  How it all works, it will be possible to see directly in the browser. <br><a name="habracut"></a><br><br>  If you already know what Perceptron is, you should skip the next chapter. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Quite a bit of theory </h2><br>  Neural networks have arisen from research in the field of artificial intelligence, namely, from attempts to reproduce the ability of biological nervous systems to learn and correct errors, simulating a low-level structure of the brain.  In the simplest case, it consists of several interconnected neurons. <br><br><h4>  Math neuron </h4><br>  A simple machine that converts input signals into a resultant output signal. <br><img src="https://habrastorage.org/getpro/habr/post_images/7da/882/845/7da8828451ad8733c647137e7b25d18a.gif" alt="Mathematical neuron circuit"><br>  Signals x1, x2, x3‚Ä¶ xn, acting on the input, are converted in a linear fashion, i.e.  the body of the neuron receives forces: w1x1, w2x2, w3x3 ... wnxn, where wi are the weights of the corresponding signals.  The neuron sums these signals, then applies a certain function f (x) to the sum and outputs the output signal y. <br>  As a function of f (x), sigmoid or threshold functions are most often used. <br><img src="https://habrastorage.org/getpro/habr/post_images/7f0/a3d/8bf/7f0a3d8bf652fcb6d5a991266a34f9f3.gif" alt="sigmoid and threshold functions"><br><br>  The threshold function can take only two discrete values ‚Äã‚Äãof 0 or 1. A change in the value of a function occurs when going over a given threshold T. + <br><br>  Sigmoid is a continuous function, it can take infinitely many values ‚Äã‚Äãin the range from 0 to 1. <br><br>  UPD: The comments also mention the <a href="https://en.wikipedia.org/wiki/Rectifier_(neural_networks)">ReLU</a> and <b>MaxOut functions</b> as more modern. <br><br>  <a href="https://github.com/cazala/synaptic/wiki/Architect">The architecture of the neural network may be different</a> , we consider one of the simple implementations of the neural network - <b>Perceptron</b> <br><br><h4>  Perceptron Architecture </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/e64/7f8/64a/e647f864a901dceace6ed54f7b961d98.png" alt="Perceptron Architecture"><br><br>  There is a layer of input neurons (where information comes from outside), a layer of output neurons (where you can get the result) and a series of so-called hidden layers between them.  Neurons can be located in several layers.  Each connection between neurons has its weight <b>Wij</b> <br><br><h2>  Input and output signals </h2><br>  Before sending signals to the neurons of the incoming layer of the network, we need to normalize them.  Normalization of input data is a process in which all input data undergo a process of ‚Äúalignment‚Äù, i.e.  reduction to the interval [0,1] or [-1,1].  If you do not carry out normalization, the input data will have an additional impact on the neuron, which will lead to wrong decisions.  In other words, how can we compare values ‚Äã‚Äãof different orders? <br><br>  On the neurons of the output layer, we also will not have a clean "1" or "0", this is normal.  There is a certain threshold at which we will assume that we have received ‚Äú1‚Äù or ‚Äú0‚Äù.  We'll talk about the interpretation of the results later. <br><br><h2>  "An example in the studio, but I already fall asleep" </h2><br>  For convenience, I recommend putting nodejs and npm to myself. <br><br>  We will describe the network using the <a href="">Brain.js</a> library.  At the end of the article, I will also provide links to other libraries that can be configured in a similar way.  I liked Brain.js for its speed and ability to save a trained model. <br><br>  Let's try an example from the documentation - the XOR function emulator: <br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> brain = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'brain.js'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> net = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> brain.NeuralNetwork(); net.train([{<span class="hljs-attr"><span class="hljs-attr">input</span></span>: [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-attr"><span class="hljs-attr">output</span></span>: [<span class="hljs-number"><span class="hljs-number">0</span></span>]}, {<span class="hljs-attr"><span class="hljs-attr">input</span></span>: [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-attr"><span class="hljs-attr">output</span></span>: [<span class="hljs-number"><span class="hljs-number">1</span></span>]}, {<span class="hljs-attr"><span class="hljs-attr">input</span></span>: [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-attr"><span class="hljs-attr">output</span></span>: [<span class="hljs-number"><span class="hljs-number">1</span></span>]}, {<span class="hljs-attr"><span class="hljs-attr">input</span></span>: [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-attr"><span class="hljs-attr">output</span></span>: [<span class="hljs-number"><span class="hljs-number">0</span></span>]}]); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> output = net.run([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-comment"><span class="hljs-comment">// [0.987] console.log(output);</span></span></code> </pre> <br>  we will write everything into the file <b>simple1.js</b> , so that the example will work, put the <b>brain</b> module and run <br><pre> <code class="bash hljs">npm install brain.js node simple1.js <span class="hljs-comment"><span class="hljs-comment"># [ 0.9331839217737243 ]</span></span></code> </pre><br><br>  We have 2 incoming neurons and one neuron at the output, the brain.js library will configure the hidden layer itself and install as many neurons there as it sees fit (in this example, 3 neurons). <br><br>  What we passed to the <b>.train</b> method is called a training sample, each element of which consists of an array of objects with an input and output property (an array of input and output parameters).  We did not normalize the incoming data, since the data itself is already in the required form. <br><br>  Please note: at the output we get not <i>[0.987]</i> but <i>[0.9331 ...]</i> .  You may have a slightly different meaning.  This is normal, since the learning algorithm uses random numbers when selecting weights. <br><br>  The <b>.run</b> method <b>is</b> used to receive the neural network response to the array of incoming signals specified in the argument. <br><br>  Other simple examples can be found in the <a href="">brain documentation.</a> <br><br><h2>  Recognize the numbers </h2><br>  In the beginning, we need to get images with handwritten numbers that are the same size.  In our example, we will use the <a href="https://github.com/ApelSYN/mnist">MNIST digits</a> module, a set of 28x28px thousand binary images of handwritten digits from 0 to 9: <br><img src="https://habrastorage.org/getpro/habr/post_images/366/21a/d71/36621ad7140e47a880bf3e6a1b7d81fb.png" alt="nmist training sample"><br><br>  The original MNIST database contains 60,000 examples for training and 10,000 examples for testing; it can be downloaded from the <a href="http://yann.lecun.com/exdb/mnist/">LeCun</a> website.  <a href="https://github.com/cazala">The author of MNIST digits</a> made some of these examples available for the JavaScript language, the library has already normalized incoming signals.  With the help of this module, we can receive training and test samples automatically. <br><br>  I had to clone the MNIST digits library, since there is some confusion with the data.  I reloaded 10,000 examples from the original database, so I need to use the <a href="https://github.com/ApelSYN/mnist">MNIST digits from my repository</a> . <br><br><h4>  Network configuration </h4><br>  In the input layer, we need 28x28 = 784 neurons, at the output of 10 neurons.  The hidden layer brain.js will configure itself.  Looking ahead, I will clarify: there will be 392 neurons.  The training set will be generated by the mnist module. <br><br><h4>  We train model </h4><br>  Install mnist <br><pre> <code class="bash hljs">npm install https://github.com/ApelSYN/mnist</code> </pre><br><br>  Everything is ready, we train the network <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> brain = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'brain.js'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> net = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> brain.NeuralNetwork(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mnist = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mnist'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> set = mnist.set(<span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> trainingSet = set.training; net.train(trainingSet, { <span class="hljs-attr"><span class="hljs-attr">errorThresh</span></span>: <span class="hljs-number"><span class="hljs-number">0.005</span></span>, <span class="hljs-comment"><span class="hljs-comment">// error threshold to reach iterations: 20000, // maximum training iterations log: true, // console.log() progress periodically logPeriod: 1, // number of iterations between logging learningRate: 0.3 // learning rate } ); let wstream = fs.createWriteStream('./data/mnistTrain.json'); wstream.write(JSON.stringify(net.toJSON(),null,2)); wstream.end(); console.log('MNIST dataset with Brain.js train done.')</span></span></code> </pre><br>  We create a network, we get 1000 elements of the training set, we call the <b>.train</b> method, which produces network training - we save everything into the './data/mnistTrain.json' file (do not forget to create the "./data" folder). <br><br>  If everything is done correctly, you will get something like this: <br><pre> <code class="hljs css"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[root@HomeWebServer nn]</span></span># <span class="hljs-selector-tag"><span class="hljs-selector-tag">node</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">train</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.js</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">iterations</span></span>: 0 <span class="hljs-selector-tag"><span class="hljs-selector-tag">training</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">error</span></span>: 0<span class="hljs-selector-class"><span class="hljs-selector-class">.060402555338691676</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">iterations</span></span>: 1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">training</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">error</span></span>: 0<span class="hljs-selector-class"><span class="hljs-selector-class">.02802436102035996</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">iterations</span></span>: 2 <span class="hljs-selector-tag"><span class="hljs-selector-tag">training</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">error</span></span>: 0<span class="hljs-selector-class"><span class="hljs-selector-class">.020358600820106914</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">iterations</span></span>: 3 <span class="hljs-selector-tag"><span class="hljs-selector-tag">training</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">error</span></span>: 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0159533285799183</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">iterations</span></span>: 4 <span class="hljs-selector-tag"><span class="hljs-selector-tag">training</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">error</span></span>: 0<span class="hljs-selector-class"><span class="hljs-selector-class">.012557029942873513</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">iterations</span></span>: 5 <span class="hljs-selector-tag"><span class="hljs-selector-tag">training</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">error</span></span>: 0<span class="hljs-selector-class"><span class="hljs-selector-class">.010245175822114688</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">iterations</span></span>: 6 <span class="hljs-selector-tag"><span class="hljs-selector-tag">training</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">error</span></span>: 0<span class="hljs-selector-class"><span class="hljs-selector-class">.008218147206099617</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">iterations</span></span>: 7 <span class="hljs-selector-tag"><span class="hljs-selector-tag">training</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">error</span></span>: 0<span class="hljs-selector-class"><span class="hljs-selector-class">.006798613211310184</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">iterations</span></span>: 8 <span class="hljs-selector-tag"><span class="hljs-selector-tag">training</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">error</span></span>: 0<span class="hljs-selector-class"><span class="hljs-selector-class">.005629051609641436</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">iterations</span></span>: 9 <span class="hljs-selector-tag"><span class="hljs-selector-tag">training</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">error</span></span>: 0<span class="hljs-selector-class"><span class="hljs-selector-class">.004910207736789503</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MNIST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dataset</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Brain</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.js</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">train</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">done</span></span>.</code> </pre><br><br><h4>  Everything can be recognized </h4><br>  It remains to write quite a bit of code - and the recognition system is ready! <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> brain = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'brain.js'</span></span>), mnist = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mnist'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> net = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> brain.NeuralNetwork(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> set = mnist.set(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> testSet = set.test; net.fromJSON(<span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./data/mnistTrain'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> output = net.run(testSet[<span class="hljs-number"><span class="hljs-number">0</span></span>].input); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(testSet[<span class="hljs-number"><span class="hljs-number">0</span></span>].output); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(output);</code> </pre><br><br>  We get 1 random test case from a sample of 10,000 records, load the previously trained model, transfer the test record to the network input and see if it was recognized correctly. <br><br>  Here is an example run <br><pre> <code class="hljs json">[ <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ] [ <span class="hljs-number"><span class="hljs-number">0.0002863506627761867</span></span>, <span class="hljs-number"><span class="hljs-number">0.00002389940760904011</span></span>, <span class="hljs-number"><span class="hljs-number">0.00039954062883041345</span></span>, <span class="hljs-number"><span class="hljs-number">0.9910109896013567</span></span>, <span class="hljs-number"><span class="hljs-number">7.562879202664903e-7</span></span>, <span class="hljs-number"><span class="hljs-number">0.0038756598319246837</span></span>, <span class="hljs-number"><span class="hljs-number">0.000016752919557362786</span></span>, <span class="hljs-number"><span class="hljs-number">0.0007205981595354964</span></span>, <span class="hljs-number"><span class="hljs-number">0.13699517762991756</span></span>, <span class="hljs-number"><span class="hljs-number">0.0011053963693377692</span></span> ]</code> </pre><br>  In the example, a digitized triple arrived at the incoming neurons (the first array is the perfect answer), at the output of the network we received an array of elements, one of which is close to one <i>(0.9910109896013567)</i> is also the third bit.  Pay attention to the fourth bit there 7.56 ... to -7 degrees, this is the form of writing floating-point numbers in JavaScript. <br><br>  Well, recognition passed correctly.  Congratulations, our network has earned! <br><br>  We will slightly "comb" our results with the softmax function, which I took from one example of machine learning: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">softmax</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">output</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> maximum = output.reduce(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">p,c</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> p&gt;c ? p : c; }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> nominators = output.map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.exp(e - maximum); }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> denominator = nominators.reduce(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">p, c</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> p + c; }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> softmax = nominators.map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> e / denominator; }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> maxIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; softmax.reduce(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">p,c,i</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(p&lt;c) {maxIndex=i; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> c;} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> p;}); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;output.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i==maxIndex) result.push(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> result.push(<span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre><br><br>  The function can be placed at the beginning of our code and replace the last line with <br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(softmax(output));</code> </pre><br><br>  All friends - now everything works beautifully: <br><pre> <code class="hljs css"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[root@HomeWebServer nn]</span></span># <span class="hljs-selector-tag"><span class="hljs-selector-tag">node</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">simpleRecognize</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.js</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ 0, 0, 1, 0, 0, 0, 0, 0, 0, 0 ]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ 0, 0, 1, 0, 0, 0, 0, 0, 0, 0 ]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[root@HomeWebServer nn]</span></span># <span class="hljs-selector-tag"><span class="hljs-selector-tag">node</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">simpleRecognize</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.js</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 ]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 ]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[root@HomeWebServer nn]</span></span># <span class="hljs-selector-tag"><span class="hljs-selector-tag">node</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">simpleRecognize</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.js</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ 0, 0, 0, 0, 0, 0, 1, 0, 0, 0 ]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ 0, 0, 0, 0, 0, 0, 1, 0, 0, 0 ]</span></span></code> </pre><br><br>  Sometimes the network can give the wrong result (we took a small sample and set a not quite strict error). <br><br><h2>  And how to recognize the number that you write? </h2><br>  Of course, there is no fraud here, but still I want to check for "strength" what happened. <br><br>  Using HTML5 Canvas and still the same brain.js with the saved model, I managed to make the recognition implementation in the browser, I borrowed some of the code for the drawing and the interface design on the Internet.  <a href="http://linux.ria.ua/mnist_brain/nnTest.html">You can try it live</a> .  In a mobile device, you can draw with your finger. <br><br><h2>  Related Links </h2><br><ul><li>  JavaScript libraries for working with neural networks <br><ul><li>  <a href="">brain.js</a> </li><li>  <a href="http://synaptic.juancazala.com/">Synaptic.js</a> </li><li>  <a href="https://github.com/karpathy/convnetjs">ConvNetJS</a> </li><li>  <a href="http://www.mindjs.net/">Mind.js</a> </li></ul><br></li><li>  <a href="https://github.com/ApelSYN/mnist_brain">All examples from the article on github</a> </li><li>  <a href="http://linux.ria.ua/mnist_brain/nnTest.html">A live example of digit recognition in the browser</a> <br>  <a href="https://habrahabr.ru/company/epam_systems/blog/317050/">Neural networks on JS.</a>  <a href="https://habrahabr.ru/company/epam_systems/blog/317050/">Creating a network from scratch</a> <br></li><li>  [Eng] <a href="https://github.com/harthur/brain/issues/72">Why use</a> the <a href="">brain.js</a> library and not the <a href="https://github.com/harthur/brain">brain</a> </li></ul><br><br>  UPD: Alternative implementations of live example <a href="https://rawgit.com/TigranGalstyan/mnistconvnetdemo/master/index.html">1</a> , <a href="http://myselph.de/neuralNet.html">2</a> on JavaScript from comments and personal correspondence. </div><p>Source: <a href="https://habr.com/ru/post/304414/">https://habr.com/ru/post/304414/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../304404/index.html">Context in advertising: successful examples of advertising campaigns</a></li>
<li><a href="../304406/index.html">Sport, Darth Vader and the paper plane: gamification in a single company</a></li>
<li><a href="../304408/index.html">10 useful sites with 2D resources for games</a></li>
<li><a href="../304410/index.html">6 golden rules for learning anything in record time</a></li>
<li><a href="../304412/index.html">Data Center Cooling: Experience Bluon Energy, Emerson, Star Refrigeration, Asetek and CoolIT Systems</a></li>
<li><a href="../304416/index.html">We write puzzles on FBD. Fifteen and Simpson</a></li>
<li><a href="../304422/index.html">Implement http / 2 server push using nghttp2</a></li>
<li><a href="../304424/index.html">IBM Watson and no magic: an IBM engineer created a dispensing hat from Harry Potter for his daughters</a></li>
<li><a href="../304426/index.html">Java & PostgreSQL - meeting with Alvaro Hernandez, St. Petersburg</a></li>
<li><a href="../304428/index.html">Very simple and fast HTML-> TEXT</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>