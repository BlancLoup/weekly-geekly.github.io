<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bash scripts, part 11: expect and automate interactive utilities</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bash scripts: start 
 Bash scripts, part 2: loops 
 Bash scripts, part 3: command line options and keys 
 Bash scripts, part 4: input and output 
 Bas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bash scripts, part 11: expect and automate interactive utilities</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <a href="https://habrahabr.ru/company/ruvds/blog/325522/">Bash scripts: start</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/325928/">Bash scripts, part 2: loops</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/326328/">Bash scripts, part 3: command line options and keys</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/326594/">Bash scripts, part 4: input and output</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/326826/">Bash Scripts, Part 5: Signals, Background Tasks, Script Management</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/327248/">Bash scripts, part 6: functions and library development</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/327530/">Bash scripts, part 7: sed and word processing</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/327754/">Bash scripts, part 8: awk data processing language</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/327896/">Bash scripts, part 9: regular expressions</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/328346/">Bash scripts, part 10: practical examples</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/328436/">Bash scripts, part 11: expect and automate interactive utilities</a> </blockquote><br>  Last time we talked about the development of bash scripts.  If we summarize everything that we have sorted out in the previous ten materials, then you, if you started reading them without knowing anything about bash, now you can do quite a lot of useful things. <br><br> <a href="https://habrahabr.ru/company/ruvds/blog/328436/"><img src="https://habrastorage.org/files/803/892/bfe/803892bfe548499aa763df324d40fd01.png"></a> <br><br>  Today's topic, the final one in this series of materials, is devoted to automating work with interactive utilities, for example, with scripts that, in the process of execution, interact with the user.  In this case, we will help expect - a tool based on the Tcl language. <br><a name="habracut"></a><br>  Expect allows you to create programs that await questions from other programs and give them answers.  Expect can be compared with a robot that can replace a user when interacting with command line scripts. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> <br><br><h2>  <font color="#3AC1EF">Basics of expect</font> </h2><br>  If expect is not installed on your system, fix it, for example, in Ubuntu, you can do this: <br><br><pre><code class="hljs kotlin">$ apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install <span class="hljs-keyword"><span class="hljs-keyword">expect</span></span></code> </pre> <br>  In something like CentOs, the installation is done with the following command: <br><br><pre> <code class="hljs sql">$ yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> expect</code> </pre> <br>  Expect provides a set of commands that allow you to interact with command line utilities.  Here are his main commands: <br><br><ul><li>  <code>spawn ‚Äî</code> starting a process or program.  For example, it could be a command shell, <a href="https://likegeeks.com/ftp-server-linux/">FTP</a> , Telnet, ssh, scp, and so on. <br><br></li><li>  <code>expect ‚Äî</code> waiting for data output by the program.  When writing a script, you can specify what kind of output it is waiting for and how to respond to it. <br><br></li><li>  <code>send ‚Äî</code> send reply.  Expect-script with the help of this command can send input data to an automated program.  It looks like the familiar <code>echo</code> command in ordinary bash scripts. <br><br></li><li>  <code>interact ‚Äî</code> allows you to switch to the "manual" mode of program control. <br></li></ul><br><h2>  <font color="#3AC1EF">Automate bash script</font> </h2><br>  We write a script that interacts with the user and automate it with expect.  Here is the code for the bash script <code>questions</code> : <br><br><pre> <code class="hljs smalltalk">#!/bin/bash echo <span class="hljs-comment"><span class="hljs-comment">"Hello, who are you?"</span></span> read <span class="hljs-string"><span class="hljs-string">$R</span></span>EPLY echo <span class="hljs-comment"><span class="hljs-comment">"Can I ask you some questions?"</span></span> read <span class="hljs-string"><span class="hljs-string">$R</span></span>EPLY echo <span class="hljs-comment"><span class="hljs-comment">"What is your favorite topic?"</span></span> read <span class="hljs-string"><span class="hljs-string">$R</span></span>EPLY</code> </pre> <br>  Now we will write an expect-script that will run the <code>questions</code> script and will answer its questions: <br><br><pre> <code class="hljs kotlin">#!/usr/bin/<span class="hljs-keyword"><span class="hljs-keyword">expect</span></span> -f <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> timeout -<span class="hljs-number"><span class="hljs-number">1</span></span> spawn ./questions <span class="hljs-keyword"><span class="hljs-keyword">expect</span></span> <span class="hljs-string"><span class="hljs-string">"Hello, who are you?\r"</span></span> send -- <span class="hljs-string"><span class="hljs-string">"Im Adam\r"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">expect</span></span> <span class="hljs-string"><span class="hljs-string">"Can I ask you some questions?\r"</span></span> send -- <span class="hljs-string"><span class="hljs-string">"Sure\r"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">expect</span></span> <span class="hljs-string"><span class="hljs-string">"What is your favorite topic?\r"</span></span> send -- <span class="hljs-string"><span class="hljs-string">"Technology\r"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">expect</span></span> eof</code> </pre> <br>  Save the script by giving it the name <code>answerbot</code> . <br><br>  At the beginning of the script is the identification string, which, in this case, contains the path to expect, since the script will be interpreted exactly by expect. <br>  In the second line, we disable the timeout by setting the expect <code>timeout</code> variable to -1.  The rest of the code is the automation of working with the bash script. <br><br>  First, using the <code>spawn</code> command, we run a bash script.  Naturally, any other command line utility can be invoked here.  Next, a sequence of questions from the bash-script, and the answers given to them by expect.  After receiving a question from the subprocess, expect gives him the specified answer and expects the next question. <br><br>  In the last command, expect expects a sign of the end of the file, the script, having reached this command, ends. <br><br>  Now it's time to try it all out.  Make the <code>answerbot</code> executable: <br><br><pre> <code class="hljs perl">$ <span class="hljs-keyword"><span class="hljs-keyword">chmod</span></span> +<span class="hljs-keyword"><span class="hljs-keyword">x</span></span> ./answerbot</code> </pre> <br>  And call it: <br><br><pre> <code class="hljs mel">$./answerbot</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/456/54e/801/45654e80149d0ffc4f4fa6616857ef44.png"></div><br>  <i><font color="#999999">Expect script answers bash script questions</font></i> <br><br>  As you can see, the expect-script answered the questions of the bash-script correctly.  If at this stage you encounter an error caused by the incorrect location of the expect, you can find out its address as follows: <br><br><pre> <code class="hljs kotlin">$ which <span class="hljs-keyword"><span class="hljs-keyword">expect</span></span></code> </pre> <br>  Please note that after running the <code>answerbot</code> script <code>answerbot</code> everything happens in fully automatic mode.  The same can be done for any command line utility.  Here it should be noted that our bash-script is very simple, we know exactly what data it displays, so it is easy to write an expect-script to interact with it.  The task is complicated when working with programs that are written by other developers.  However, a tool for automated creation of expect-scripts comes to the rescue. <br><br><h2>  <font color="#3AC1EF">Autoexpect - automated creation of expect scripts</font> </h2><br>  Autoexpect allows you to run programs that need to be automated, and then writes down what they output and what the user enters, answering their questions.  Call autoexpect, passing the name of our script to this utility: <br><br><pre> <code class="hljs ruby">$ autoexpect ./questions</code> </pre> <br>  In this mode, the interaction with the bash script is no different from the usual: we ourselves enter the answers to his questions. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fb8/131/0fe/fb81310fe0054606d27778474d80079f.png"></div><br>  <i><font color="#999999">Running a bash script with autoexpect</font></i> <br><br>  After completing work with the bash-script, autoexpect will report that the collected data is recorded in the file <code>script.exp</code> .  Take a look at this file. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/10f/e73/1bd/10fe731bd35562c114a5158121450126.png"></div><br>  <i><font color="#999999">Script.exp file</font></i> <br><br>  In general, with the exception of some details, we have the same script that we wrote on our own.  If you run this script, the result will be the same. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0a2/0d5/456/0a20d545683e4b5b5469495a642671ab.png"></div><br>  <i><font color="#999999">Run an automatically generated expect script</font></i> <br><br>  When recording interaction sessions with some programs, such as FTP clients, you may encounter that they use information on the time of the operation in the output data, or output data reflecting the process of performing some long-term actions.  In general, we are talking about the fact that the output of the program at each launch of it, correctly perceived by a person and causing input of the same answers, will, under the same conditions, look new to expect. <br><br>  If in the expect-script, the lines expected from such a program will be rigidly fixed, such a script will not be able to work normally.  You can cope with this either by deleting data from the expect-script that looks new every time the program is started, or by using templates, using which expect can correctly understand what the program wants from it. <br><br>  As you can see, autoexpect is a very useful tool, but it is also not without flaws, which can only be corrected manually.  Therefore we will continue to master the language of expect-scripts. <br><br><h2>  <font color="#3AC1EF">Work with variables and command line parameters</font> </h2><br>  To declare variables in expect scripts, use the <code>set</code> command.  For example, in order to assign the value 5 to the variable <code>VAR1</code> , the following construction is used: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-type"><span class="hljs-type">VAR1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span></code> </pre> <br>  To access the value of a variable, you must add a dollar sign, $, in front of its name.  In our case, it will look like <code>$VAR1</code> . <br><br>  In order to gain access to the command line arguments that the expect script is called with, you can do this: <br><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VAR</span></span> [lindex $argv <span class="hljs-number"><span class="hljs-number">0</span></span>]</code> </pre> <br>  Here we declare the <code>VAR</code> variable and write a pointer to it to the first command-line argument, <code>$argv 0</code> . <br><br>  For the purposes of the updated expect script, we are going to write the value of the first argument, which is the user name that will be used in the program, to the variable <code>my_name</code> .  The second argument, symbolizing what the user likes, will fall into the variable <code>my_favorite</code> .  As a result, the variable declaration will look like this: <br><br><pre> <code class="hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> my_name [lindex <span class="hljs-variable"><span class="hljs-variable">$argv</span></span> 0] <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> my_favorite [lindex <span class="hljs-variable"><span class="hljs-variable">$argv</span></span> 1]</code> </pre> <br>  Edit the <code>answerbot</code> script, bringing it to this view: <br><br><pre> <code class="hljs kotlin">#!/usr/bin/<span class="hljs-keyword"><span class="hljs-keyword">expect</span></span> -f <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> my_name [lindex $argv <span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> my_favorite [lindex $argv <span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> timeout -<span class="hljs-number"><span class="hljs-number">1</span></span> spawn ./questions <span class="hljs-keyword"><span class="hljs-keyword">expect</span></span> <span class="hljs-string"><span class="hljs-string">"Hello, who are you?\r"</span></span> send -- <span class="hljs-string"><span class="hljs-string">"Im </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$my_name</span></span></span><span class="hljs-string">\r"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">expect</span></span> <span class="hljs-string"><span class="hljs-string">"Can I ask you some questions?\r"</span></span> send -- <span class="hljs-string"><span class="hljs-string">"Sure\r"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">expect</span></span> <span class="hljs-string"><span class="hljs-string">"What is your favorite topic?\r"</span></span> send -- <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$my_favorite</span></span></span><span class="hljs-string">\r"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">expect</span></span> eof</code> </pre> <br>  Run it, passing <code>SomeName</code> as the first parameter, <code>Programming</code> as the second parameter: <br><br><pre> <code class="hljs ruby">$ ./answerbot SomeName Programming</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/850/bb0/9e3/850bb09e300047626407ed2b0c8ccee1.png"></div><br>  <i><font color="#999999">Expect script using variables and command line parameters</font></i> <br><br>  As you can see, everything works as expected.  Now the expect-script answers the questions of the bash-script, using the command line parameters passed to it. <br><br><h2>  <font color="#3AC1EF">Answers to various questions that may appear in the same place.</font> </h2><br>  If an automated program can, in one situation, produce one line, and in another, in the same place, another, in expect, you can use blocks enclosed in braces and containing script response options to different data received from the program.  It looks like this: <br><br><pre> <code class="hljs perl">expect {   <span class="hljs-string"><span class="hljs-string">"something"</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">send</span></span> -- <span class="hljs-string"><span class="hljs-string">"send this\r"</span></span> }   <span class="hljs-string"><span class="hljs-string">"*another"</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">send</span></span> -- <span class="hljs-string"><span class="hljs-string">"send another\r"</span></span> } }</code> </pre> <br>  Here, if the expect script sees the string ‚Äúsomething‚Äù, it will send the reply ‚Äúsend this‚Äù.  If it is a certain line ending in "another", it will send the answer "send another". <br><br>  Let's write a new script by writing it to the <code>questions</code> file, which randomly sets different questions in the same place: <br><br><pre> <code class="hljs mel">#!/bin/bash let number=$RANDOM <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ $number -gt <span class="hljs-number"><span class="hljs-number">25000</span></span> ] then echo <span class="hljs-string"><span class="hljs-string">"What is your favorite topic?"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> echo <span class="hljs-string"><span class="hljs-string">"What is your favorite movie?"</span></span> fi read $REPLY</code> </pre> <br>  Here we generate a random number each time the script is run, and, after analyzing it, we derive one of two questions. <br><br>  To automate such a script, we can use the above construction: <br><br><pre> <code class="hljs kotlin">#!/usr/bin/<span class="hljs-keyword"><span class="hljs-keyword">expect</span></span> -f <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> timeout -<span class="hljs-number"><span class="hljs-number">1</span></span> spawn ./questions <span class="hljs-keyword"><span class="hljs-keyword">expect</span></span> {   <span class="hljs-string"><span class="hljs-string">"*topic?"</span></span> { send -- <span class="hljs-string"><span class="hljs-string">"Programming\r"</span></span> }   <span class="hljs-string"><span class="hljs-string">"*movie?"</span></span> { send -- <span class="hljs-string"><span class="hljs-string">"Star wars\r"</span></span> } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cce/aeb/72a/cceaeb72a9cfe0513d09353f1e01c485.png"></div><br>  <i><font color="#999999">Answers to different questions appearing in the same place.</font></i> <br><br>  As you can see, when an automated script prints a string ending in a ‚Äútopic?‚Äù, The expect script sends it the string ‚ÄúProgramming‚Äù.  Having received in the same place, with another launch of the program, the question ending in ‚Äúmovie?‚Äù, The expect-script answers: ‚ÄúStar wars‚Äù.  This is a very useful technique. <br><br><h2>  <font color="#3AC1EF">Conditional operator</font> </h2><br>  Expect supports the <code>if-else</code> conditional statement and other control constructs.  Here is an example of using a conditional statement: <br><br><pre> <code class="hljs cpp">#!/usr/bin/expect -f <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> TOTAL <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> { $TOTAL &lt; <span class="hljs-number"><span class="hljs-number">5</span></span> } { <span class="hljs-built_in"><span class="hljs-built_in">puts</span></span> <span class="hljs-string"><span class="hljs-string">"\nTOTAL is less than 5\n"</span></span> } elseif { $TOTAL &gt; <span class="hljs-number"><span class="hljs-number">5</span></span> } { <span class="hljs-built_in"><span class="hljs-built_in">puts</span></span> <span class="hljs-string"><span class="hljs-string">"\nTOTAL greater than 5\n"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">puts</span></span> <span class="hljs-string"><span class="hljs-string">"\nTOTAL is equal to 5\n"</span></span> } expect eof</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8c6/9e0/558/8c69e055846d656af2cc6c11da767b73.png"></div><br>  <i><font color="#999999">Conditional operator in expect</font></i> <br><br>  Here we assign a certain number to the variable <code>TOTAL</code> , after which we check it and display the text depending on the result of the check. <br><br>  Note the configuration of the curly braces.  The next opening bracket must be located on the same line as the previous constructions. <br><br><h2>  <font color="#3AC1EF">While loop</font> </h2><br>  The <code>while</code> loops in expect are very similar to those used in regular bash scripts, but, again, curly braces are used here: <br><br><pre> <code class="hljs kotlin">#!/usr/bin/<span class="hljs-keyword"><span class="hljs-keyword">expect</span></span> -f <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> COUNT <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> { $COUNT &lt;= <span class="hljs-number"><span class="hljs-number">5</span></span> } { puts <span class="hljs-string"><span class="hljs-string">"\nCOUNT is currently at </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$COUNT</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> COUNT [ expr $COUNT + <span class="hljs-number"><span class="hljs-number">1</span></span> ] } puts <span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://lh6.googleusercontent.com/19F2r17sDNowQV52cowtXGsMOl__tiRLfkzmj7MjygsMzuDL5RPeUu_Mhb2a2zYWrsfTT6ycbrAIKjtq0EPHhw58sTJqAo6HqZd5Vh8QCp15saZVlCHHZdPNoiiRxXU1w4bJXgAWpw_vIYb0BA"></div><br>  <i><font color="#999999">While loop in expect</font></i> <br><br><h2>  <font color="#3AC1EF">Cycle for</font> </h2><br>  The <code>for</code> loop in expect is arranged in a special way.  At the beginning of the cycle, in independent pairs of curly brackets, it is necessary to specify the variable counter, the condition for terminating the cycle and the rule for modifying the counter.  Then, again in curly braces, the body of the loop goes: <br><br><pre> <code class="hljs kotlin">#!/usr/bin/<span class="hljs-keyword"><span class="hljs-keyword">expect</span></span> -f <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> {<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> COUNT <span class="hljs-number"><span class="hljs-number">0</span></span>} {$COUNT &lt;= <span class="hljs-number"><span class="hljs-number">5</span></span>} {incr COUNT} { puts <span class="hljs-string"><span class="hljs-string">"\nCOUNT is at </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$COUNT</span></span></span><span class="hljs-string">"</span></span> } puts <span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://lh3.googleusercontent.com/h3Hyo_lzUuZJnYZ9taZ1XvIY-IhWkG8eyyi8nEbELzQDP_M42RCOH2QPn1T-Qv41NMv9Zzk4O0vQUtW_SUy4Pset1Sl_wH14_YgJvYWl_ecMsl3wFzqkQIeHr_n3GU_aF6jTZqsgQhQ-wYyamw"></div><br>  <i><font color="#999999">For loop in expect</font></i> <br><br><h2>  <font color="#3AC1EF">Declaration and use of functions</font> </h2><br>  Expect allows a programmer to declare functions using the <code>proc</code> keyword: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">proc</span></span> myfunc { <span class="hljs-attribute"><span class="hljs-attribute">MY_COUNT</span></span> } { <span class="hljs-attribute"><span class="hljs-attribute">set</span></span> MY_COUNT [expr <span class="hljs-variable"><span class="hljs-variable">$MY_COUNT</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>] return <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MY_COUNT</span></span></span><span class="hljs-string">"</span></span> }</code> </pre> <br>  This is what an expect script looks like that uses the same function declared in it: <br><br><pre> <code class="hljs kotlin">#!/usr/bin/<span class="hljs-keyword"><span class="hljs-keyword">expect</span></span> -f proc myfunc { MY_COUNT } { <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> MY_COUNT [expr $MY_COUNT + <span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MY_COUNT</span></span></span><span class="hljs-string">"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> COUNT <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> {$COUNT &lt;= <span class="hljs-number"><span class="hljs-number">5</span></span>} { puts <span class="hljs-string"><span class="hljs-string">"\nCOUNT is currently at </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$COUNT</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> COUNT [myfunc $COUNT] } puts <span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://lh5.googleusercontent.com/4rvWSMdIyQR0zXItxldVlUntwL36cCK0iQ4jOKbpE_YeD123l5-DhUCZbh10y4hELKAhAuc5mfz17ZxVBzGZz0Cvg3dQnpdn8NhaollSGPua6nBHFp_6LjEXSXYl6yBu521Eg-CuHoSPDcK_fw"></div><br>  <i><font color="#999999">Functions in expect</font></i> <br><br><h2>  <font color="#3AC1EF">Interact team</font> </h2><br>  It happens that expect-automated programs require the input of sensitive data, such as passwords that you would not want to store in plain text in the script code.  In this situation, you can use the <code>interact</code> command, which will allow you, after automating some part of the interaction with the program, to independently enter, say, a password, and then again transfer control to the expectation. <br><br>  When this command is executed, the expect-script switches to reading the answer to the program's question from the keyboard, instead of transmitting to it the data previously recorded in it. <br><br>  Here is a bash script, in general, exactly the same as we considered earlier, but now waiting to enter a password in response to one of its questions: <br><br><pre> <code class="hljs smalltalk">#!/bin/bash echo <span class="hljs-comment"><span class="hljs-comment">"Hello, who are you?"</span></span> read <span class="hljs-string"><span class="hljs-string">$R</span></span>EPLY echo <span class="hljs-comment"><span class="hljs-comment">"What is you password?"</span></span> read <span class="hljs-string"><span class="hljs-string">$R</span></span>EPLY echo <span class="hljs-comment"><span class="hljs-comment">"What is your favorite topic?"</span></span> read <span class="hljs-string"><span class="hljs-string">$R</span></span>EPLY</code> </pre> <br>  Let's write an expect-script, which, when offered to provide a password, transfers control to us: <br><br><pre> <code class="hljs kotlin">#!/usr/bin/<span class="hljs-keyword"><span class="hljs-keyword">expect</span></span> -f <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> timeout -<span class="hljs-number"><span class="hljs-number">1</span></span> spawn ./questions <span class="hljs-keyword"><span class="hljs-keyword">expect</span></span> <span class="hljs-string"><span class="hljs-string">"Hello, who are you?\r"</span></span> send -- <span class="hljs-string"><span class="hljs-string">"Hi Im Adam\r"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">expect</span></span> <span class="hljs-string"><span class="hljs-string">"*password?\r"</span></span> interact ++ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> send <span class="hljs-string"><span class="hljs-string">"\r"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">expect</span></span> <span class="hljs-string"><span class="hljs-string">"*topic?\r"</span></span> send -- <span class="hljs-string"><span class="hljs-string">"Technology\r"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">expect</span></span> eof</code> </pre> <br><div style="text-align:center;"><img src="https://lh3.googleusercontent.com/QzISHnYVurZOqWM7NCNcVW8-248AGrBMf0qwzxf2WijbRWqI8eVOKcWECEod_AXg551sIKSnHJR-U5sz-qHHOk5evCg48H4kadYk0Kngk16BQSU0vYhML7xsb0TG-8R_9yABDjzws0YMbesWAQ"></div><br>  <i><font color="#999999">The interact command in the expect script</font></i> <br><br>  Upon encountering the <code>interact</code> command, the expect-script will stop, giving us the opportunity to enter a password.  After entering the password, you must enter ‚Äú++‚Äù and the expect-script will continue to work, once again having control. <br><br><h2>  <font color="#3AC1EF">Results</font> </h2><br>  Opportunities expect can be used in programs written in different programming languages ‚Äã‚Äãthanks to the appropriate libraries.  Among these languages ‚Äã‚Äãare C #, Java, Perl, Python, Ruby, and others.  The fact that expect is available for different development environments is far from coincidence.  The thing is that this is a really important and useful tool that is used to solve a variety of tasks.  Here you can check software quality and perform various network administration tasks, automate file transfer, automatically install updates and much more. <br><br>  Having mastered this material, you familiarized yourself with the basic concepts of expect and learned how to use the autoexpect tool to automatically generate scripts.  Now you can continue to study expect using additional sources.  Here is a <a href="http://wiki.tcl.tk/11584">collection of</a> educational and reference materials.  Here is a noteworthy series of three articles ( <a href="https://www.ibm.com/developerworks/ru/library/l-expect_1/">1</a> , <a href="https://www.ibm.com/developerworks/ru/library/l-expect_2/">2</a> , <a href="https://www.ibm.com/developerworks/ru/library/l-expect_3/">3</a> ).  And here is the <a href="https://www.nist.gov/services-resources/software/expect">official</a> expect <a href="https://www.nist.gov/services-resources/software/expect">page</a> , where you can find links to the source code of the program and the list of publications. <br><br>  This concludes the series of materials on bash-scripts.  Hopefully, its eleven parts, as well as countless comments to them, helped those who wanted to learn how to write scripts on the command line to achieve the goal. <br><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> <br><br>  Dear readers!  We thank everyone who was with us.  We wish you successful automation in Linux!  And, if you have experience with expect, we are waiting for your stories. </div><p>Source: <a href="https://habr.com/ru/post/328436/">https://habr.com/ru/post/328436/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328426/index.html">How to become a web developer in 2017 - an action plan</a></li>
<li><a href="../328428/index.html">Welcome to MOSDROID May Meetup May 20</a></li>
<li><a href="../328430/index.html">New tools for organizing effective teamwork</a></li>
<li><a href="../328432/index.html">How we published an iOS video chat app on the App Store</a></li>
<li><a href="../328434/index.html">Explore RxJava 2 for Android</a></li>
<li><a href="../328440/index.html">Do I need to experiment in the development process?</a></li>
<li><a href="../328442/index.html">"The most serious opportunity I, of course, consider a multimaster," - Ivan Frolkov on the development of Postgres Pro EE</a></li>
<li><a href="../328444/index.html">ONTAP 9.2: new functionality</a></li>
<li><a href="../328446/index.html">Cellular communication even in the taiga: three generations of mobile base stations</a></li>
<li><a href="../328448/index.html">29 reports DotNext 2017 Piter: From .NET Standard and containers to security and performance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>