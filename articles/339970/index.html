<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>IoTmanager is a mobile MQTT client with an unusual concept</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="He removed the post from the vote, because the moderator moved it to "I am promoting".  In a recent article on GeekTimes about the completion of an in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>IoTmanager is a mobile MQTT client with an unusual concept</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/59/df/cd/59dfcd76416c2802096841.jpeg" align="left" width="250"><blockquote>  He removed the post from the vote, because the moderator moved it to "I am promoting". </blockquote>  In a recent article on GeekTimes about the <a href="https://geektimes.ru/post/292735/">completion of an intercom with the MQTT protocol,</a> I conducted a survey on what article to write next, and about 50% of readers voted for an article about working with the <b>IoTmanager</b> MQTT client mobile app. <br><br>  This application is slightly different in concept from all presented mobile MQTT clients: the appearance of the widgets is set directly in the topics.  Thus, all settings are stored in one place - the final physical device, and IoTmanager simply serves to display and control widgets.  Such an approach may be useful for a certain range of tasks. <br><br>  On Habr√© and GeekTimes <b>IoTmanager</b> practically does not mention that I consider it undeserved and I want to tell a little about the peculiarities of working with the application using the example of a bundle with ESP8266.  I invite in the comments to the discussion of analogues. <br>  <b>Disclaimer:</b> I have no relation to the author or the application, it is completely free, does not require registration and does not have built-in advertising, I am writing an article with the aim of learning the basics of the Internet of things. <br><a name="habracut"></a><br><h3>  Description </h3><br>  <b>IoTmanager is</b> built on the Ionic framework (HTML5 + AngularJS) and is available for Android and iOS operating systems.  Each widget has its own html markup, which can be found from the documentation on the official website of the application, and the parameters of which are set in the JSON-format topics.  MQTT is implemented on top of WebSockets on Paho.js and MQTT.js libraries (can be selected in the settings). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      HTML example of <b>Toggle</b> switch widget markup: <br><br><img src="https://habrastorage.org/webt/59/e1/a1/59e1a1162b354222240285.gif" align="right" width="200"><pre><code class="javascript hljs">&lt;div <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"class1"</span></span> style=<span class="hljs-string"><span class="hljs-string">"style1"</span></span>&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"item-toggle descrClass"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"descrStyle"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">i</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"iconClass"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"iconStyle"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">descr</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">i</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">label</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"toggle"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"checkbox"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"track"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"trackStyle"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"handle"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"handleStyle"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">label</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  All classes, styles and icons can be set in MQTT topics.  Yes, there is an opinion that this implementation contradicts the very idea of ‚Äã‚ÄãMQTT - the lightness of the protocol with a minimum of transmitted data, but I found this approach interesting: all settings are stored on a physical device and you do not need to configure each client separately, and, if necessary, you can change the appearance managing widgets right on the fly.  This approach is the place to be. <br><br>  For example, I found it convenient to work with an intercom, the link to the article about which I gave at the very beginning of the article.  I installed the application to several people, selected ‚ÄúEnd User Mode‚Äù in the settings (hides all settings, logs, statistics), and they all have access to my intercom without thinking about how the application works, and I can change the functionality of the device as of necessity. <br><br>  The application has a wide variety of widgets and more than 500 different icons for use.  Here are examples (clickable): <br><br> <a href=""><img src="https://habrastorage.org/webt/59/e4/40/59e44009579e3740993406.jpeg"></a> <br><br><h3>  Broker setup </h3><br>  For example, I'll start a broker at <a href="https://www.cloudmqtt.com/">cloudmqtt.com</a> , but, of course, it could be your local broker.  I created a broker on the free Cute Cat tariff plan, as a result I received the server address + ports: <br><br><img src="https://habrastorage.org/webt/59/e7/1b/59e71bb062f3c622415460.jpeg"><br><br>  I immediately add the <b>test</b> user with a password and give this user the right to read and write all the topics (set simply #): <br><br><img src="https://habrastorage.org/webt/59/e7/1c/59e71c422cd8b289519215.jpeg"><br><br>  At this, the broker setting ends, enough for our needs. <br><br><h3>  Application setup </h3><br><br><img src="https://habrastorage.org/webt/59/e5/a5/59e5a5f37fe62270301577.jpeg" align="right" width="500">  In the application settings, enter the broker data: server, port (the one that WebSockets TLS only), the user with the password, turn on the toggle switch to use <b>SSL / TLS</b> , leave the standard <b>/ IoTmanager</b> as a prefix for the names of the topics.  We click on the connect (speedometer icon in the upper right corner) and see the green <b>Broker</b> icon, which means a successful connection. <br><br>  In the broker, we should see the application's welcome topics with service information: <br><br><img src="https://habrastorage.org/webt/59/e7/03/59e703ea4dfd4224127488.jpeg"><br><br>  That's it, now we have a fully functional mobile application for managing anything over the Internet.  Do not worry that the workspace is completely empty, all further setting up the appearance of the application will be done on a physical device, nothing is configured on the phone itself. <br><br><h3>  Procurement firmware for ESP8266 </h3><br>  Let's try to blink the LED on NodeMCU using our application on the phone.  Classic, is not it?  As an IDE, I will use the Atom editor with the PlatformIO extension and Arduin libraries. <br><br>  Further, I give all the explanations regarding the <b>Toggle</b> switch widget, since I already gave the html-code above.  All widgets are described in detail on the official website of the application with all sorts of buns and specific examples. <br><br>  When writing firmware for NodeMCU, I used the <b>ESP8266WiFi</b> libraries to connect to WiFi, the <b>PubQubClient</b> MQTT client <b>(by Imroy)</b> and <b>ArduinoJson</b> for conveniently generating JSON strings.  Link to the firmware repository is at the end of the article.  I will explain a little the principle of work. <br><br><pre> <code class="cpp hljs"> JsonObject&amp; root = jsonBuffer.createObject(); root[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] = <span class="hljs-string"><span class="hljs-string">"0"</span></span>; root[<span class="hljs-string"><span class="hljs-string">"widget"</span></span>] = <span class="hljs-string"><span class="hljs-string">"toggle"</span></span>; root[<span class="hljs-string"><span class="hljs-string">"topic"</span></span>] = <span class="hljs-string"><span class="hljs-string">"IoTmanager/"</span></span> + deviceID + <span class="hljs-string"><span class="hljs-string">"/led1"</span></span>; root[<span class="hljs-string"><span class="hljs-string">"descr"</span></span>] = <span class="hljs-string"><span class="hljs-string">" 1"</span></span>; root[<span class="hljs-string"><span class="hljs-string">"style1"</span></span>] = <span class="hljs-string"><span class="hljs-string">"padding-top:10px;"</span></span>; root[<span class="hljs-string"><span class="hljs-string">"descrStyle"</span></span>] = <span class="hljs-string"><span class="hljs-string">"font-size:20px;"</span></span>; root.printTo(thing_config[<span class="hljs-number"><span class="hljs-number">0</span></span>]);</code> </pre> <br>  This creates a JSON string containing the necessary parameters for configuring the widget, and which will later be sent to the topic <b>/ IoTmanager / deviceID / config</b> to display the widget in IoTmanager. <br><br>  To set the status of the widget (on / off position), you need to send a JSON string of the form <b>{"status": "1"}</b> to the topic <b>/ IoTmanager / deviceID / led1 / status</b> . <br><br>  In turn, the application, when the switch is pressed, sends a <b>0</b> or <b>1</b> message to the topic <b>/ IoTmanager / deviceID / led1 / control</b> (for the convenience of parsing on microcontrollers).  Accordingly, on ESP this can be caught in the function of a callback like this: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sub.topic() == <span class="hljs-string"><span class="hljs-string">"IoTmanager/"</span></span> + deviceID + <span class="hljs-string"><span class="hljs-string">"/led1/control"</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sub.payload_string() == <span class="hljs-string"><span class="hljs-string">"0"</span></span>) ledStatus(ESP_LED, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ledStatus(ESP_LED, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); }</code> </pre> <br>  Now in the firmware it is made so that when getting to the main topic <b>/ IoTmanager</b> (the same prefix) of the <b>HELLO</b> message (as the program does), ESP returns all configs for the widgets.  Thus, they immediately appear in the application and this automatically means that the device is connected: <br><br><img src="https://habrastorage.org/webt/59/e7/a9/59e7a95ccd5e5964377339.jpeg" align="right" width="200"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sub.topic() == prefix) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sub.payload_string() == <span class="hljs-string"><span class="hljs-string">"HELLO"</span></span>) { pubConfig(); } }</code> </pre> <br>  But you can use the flag <b>retained</b> for config messages.  Then the broker, when the application is connected to it, will give all the topics with this flag.  Ie, regardless of whether the device is connected or not, widgets will be displayed in the application.  I use this approach in the intercom.  And in order to know whether the device is connected or not, when the <b>HELLO</b> message is received, the intercom gives the widget's configuration with the text <b>There is a contact</b> (slightly noticeable at the bottom of the screenshot). <br><br><h3>  Video work </h3><br><iframe width="560" height="315" src="https://www.youtube.com/embed/d3HHZ1MDf8c" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h3>  useful links </h3><br>  1. <a href="https://github.com/xDWart/IoTforHabr">The repository of the resulting firmware</a> <br>  2. <a href="http://iotmanager.ru/ru/">Application site with all documentation</a> <br>  3. <a href="https://esp8266.ru/iot-manager-for-diy/">Manual for quick application setup</a> <br>  4. <a href="https://esp8266.ru/forum/threads/iot-manager-predlozhenija-po-rasshireniju-funkcionala.1030/page-5">Description and useful links from the author</a> <br>  5. <a href="https://geektimes.ru/post/293679/">My example of using the application</a> <br><br>  <b>Thank you all for your attention, I hope the review will be useful.</b> <br>  I invite in comments - write what programs you used and in what their advantages. </div><p>Source: <a href="https://habr.com/ru/post/339970/">https://habr.com/ru/post/339970/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339958/index.html">Total exhaustion, or is there life after IPv4</a></li>
<li><a href="../339960/index.html">ServiceNow-conference "Knowledge17"</a></li>
<li><a href="../339962/index.html">[CppCon 2017] Matt Godbolt: What did my compiler do for me?</a></li>
<li><a href="../339966/index.html">Five stages of the evolution of CRM users</a></li>
<li><a href="../339968/index.html">Data Geometry 5. Base Conversion</a></li>
<li><a href="../339972/index.html">Raiffeisenbank DevOps: Flight Phase</a></li>
<li><a href="../339974/index.html">How we did and do memed</a></li>
<li><a href="../339976/index.html">How IIS supports our BI analytics, and what are the features of settings under Highload</a></li>
<li><a href="../339978/index.html">TLS 1.2 and new GOST</a></li>
<li><a href="../339980/index.html">Lenovo data center solutions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>