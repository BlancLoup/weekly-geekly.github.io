<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I decided to protect documents from falsification and ‚Äúinvented‚Äù an electronic digital signature</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What is it about 
 The idea to create your own small Internet project to protect documents from forgery, I was prompted by the discussion on the forum...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I decided to protect documents from falsification and ‚Äúinvented‚Äù an electronic digital signature</h1><div class="post__text post__text-html js-mediator-article"><h2>  What is it about </h2><br>  The idea to create your own small Internet project to protect documents from forgery, I was prompted by the discussion on the forum of flaw detectors dedicated to the mass-scale forgery of the quality control reports issued by them. <br><br>  During the implementation of my project, I realized that I had come to the concept of an electronic digital signature, that is, a bicycle, I, of course, did not invent it, but the story about my path can be instructive. <br><br><h2>  The urgency of the task of protection against fakes </h2><br>  The fact is that in our century of paperless information, not a single capital construction, be it a gas pipeline or a shopping center, can be done without preparing a complete set of as-built executive documentation, part of which includes non-destructive testing findings (visual, radiographic, ultrasound). <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/cm/7n/ee/cm7nee3ngx3tpo1yb-ihvnpregc.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This conclusion is a document drawn up on a certain form with a conclusion about the suitability or unsuitability of, for example, a weld.  Non-destructive testing services cost money and often quite considerable ones.  A dishonest customer / intermediary may hire an accredited laboratory, obtain several conclusions from it and terminate or suspend work. <br><br>  What surprise can there be for a defectoscopist or laboratory chief when they learn that after the work has been stopped, conclusions are issued on their behalf, fake seals are put on them and signatures are forged.  The reputation of the laboratory suffers, and indeed the law is violated.  Just in some cases, no one will know about it. <br><br>  As part of the discussion on how to protect your documents, the idea was put to put a QR code on the document, in which the conclusion number, date and conclusion of the validity or non-validity of the object of control will be recorded.  What is so good about this method - the QR code will remain well distinguishable when scanning, copying a document. <br><br>  However, fraudsters will be able to just generate a QR code with the necessary content. <br><br><h2>  The birth of an idea </h2><br>  And then a thought struck me: why not encrypt the contents of such a QR code with a reliable algorithm.  If so - you need to think of a way to decrypt it when scanning, for example, through the camera of a smartphone.  Here was born the idea to do decryption on the side of the web-service, which will store the decryption key. <br><br>  The last time I did a site in 2000 was in notepad and I‚Äôm not very familiar with modern site-building technologies, so I chose Wix, thinking that with the help of the service I would get a nice picture and minimal possibilities of working with the database, and with the help of Wix code I would encode what I need. <br><br>  I will say right away that I did it without much difficulty, and in a few evenings, as an amateur, I was able to assemble the solution I needed from more or less ready-made blocks. <br><br><h2>  Encryption </h2><br>  I took a ready <a href="https://github.com/ricmoo/aes-js">-made</a> AES 128-bit encryption <a href="https://github.com/ricmoo/aes-js">algorithm</a> with a Java Script implementation on Github and placed it in the backend section of the site. <br><br>  This was probably the easiest part of the job.  How encryption works itself was not at all interesting for me.  I was worried about the grandeur of the plan. <br><br>  The main thing to remember to translate the encoded text in Bytes, and the result of encryption in HEX. <br><br><pre><code class="plaintext hljs">// Convert text to bytes var textBytes = aesjs.utils.utf8.toBytes(text); // The counter is optional, and if omitted will begin at 1 var aesCtr = new aesjs.ModeOfOperation.ctr(key, new aesjs.Counter(5)); var encryptedBytes = aesCtr.encrypt(textBytes); // To print or store the binary data, you may convert it to hex var encryptedHex = aesjs.utils.hex.fromBytes(encryptedBytes);</code> </pre> <br><h2>  QR code generation </h2><br>  I used ready <a href="http://goqr.me/api">API</a> . <br><br>  To work, it is enough to create an html1 object - to display an arbitrary html code and call the API function <br><br><pre> <code class="plaintext hljs">let val = ‚Äú " $w("#html1").src = "https://api.qrserver.com/v1/create-qr-code/?size=100x100&amp;data=" + val.toString(); $w("#html1").show();</code> </pre> <br><h2>  Work with users </h2><br>  Wix supports basic user registration and profile editing features.  A tool that is somewhat buggy, but workable. <br><br>  I just needed to add a field that describes the name of the organization that the registered user represents, but this field is read only and the service administrator fills it when he receives confirmation that the registered user really represents the specified organization. <br><br>  It was also necessary to fasten the simplest logic associated with paid / free access to functions (up to 20 documents per month can be protected for free) and the term of payment for services. <br><h2>  Principle of operation </h2><br>  A unique encryption private key is tied to a user account. <br><br>  A logged in user fills out a form with information on the conclusion (number, date, result): <br><br><img src="https://habrastorage.org/webt/fo/id/ct/foidct3dccu6c3_6lorfm6c7pai.png"><br><br>  The algorithm then returns a URL containing the TEXT ciphertext and acting as the public key USER_ID, as in the example below: <br><br> <code>https:// <i>* *</i> /checkqr?user=3b01b0aa-68a0-4521-ab12-f17b86d3eabc&amp;v=1.0&amp;text=8a026594c26be959f4280e28fe8402c1acef233e369a31613d654d3b0a5bbaca206f3058d27d2fde66b65cb64a5a6caecb69b07ad39c0015e923dad89eb723</code> <br> <br>  The URL turns into a QR code that the user already puts on his document by copying it to the clipboard (you can include it in the source file or stick it as a sticker on the finished printed document). <br><br> <a href="https://protectmydoc.com/checkqr%3Fuser%3D3b01b0aa-68a0-4521-ab12-f17b86d3eabc%26v%3D1.0%26text%3D8a026594c26be959f4280e28fe8402c1acef233e369a31613d654d3b0a5bbaca206f3058d27d2fde66b65cb64a5a6caecb69b07ad39c0015e923dad89eb723"><img src="https://habrastorage.org/webt/lp/f-/0o/lpf-0ojmmbrd1bh7ylqqa-pmyzu.png"></a> <br><br>  What is important here is that - as such, the information does not fall into the database of the site, but remains only in the form of this link and a QR code containing this link.  Thus, no information about the contents of the protected document is stored on the server. <br><br><h2>  Code verification is performed by the site when linking. </h2><br>  For parsing when the website recognized the link, I used Wix code help. <br>  <a href="http-functions.html">www.wix.com/code/reference/wix-http-functions.html</a> <br><br>  If something went wrong during the decoding, but it could be if they tried to make some changes to the original QR code <br><blockquote>  ‚ÄúThe document code has been decrypted with an error.  Fake is possible.  Contact the organization that prepared the document for clarification. ‚Äù </blockquote>  If the decoding is completed successfully, the decrypted text containing the laboratory name, document number, date of issue and result is issued, and the user is asked to compare the result of the decryption with what he sees on the real document. <br><br><h2>  Conclusion </h2><br>  From the birth of the idea, I came to a working implementation with the help of a number of ready-made bricks. <br><br>  I invite you to discuss the idea invented by me, trying to test / hack my service. <br><br><h4>  What is left to finish </h4><br><ul><li>  <s>Write on habr implementation</s> </li><li>  Understand how to reset a query, if the link has already been checked once </li><li>  Think up how to squeeze the cipher text, because when a long URL is encoded, the size of the QR code is too big </li><li>  Add the ability to copy the code to the clipboard or send to the mail by clicking on the button (until I figured out how to do it in javascript) </li><li>  Improve the work with the mobile version </li></ul><br><h4>  Preliminary response to possible criticism: </h4><br><blockquote>  Is it not easier for the laboratory to keep a register of conclusions on its website, but will a similar QR tag lead to this register or even display a copy of the conclusion? </blockquote>  This can be done, but it will take considerable manual work or the introduction of its own IT solution like the one developed by me, but it will obviously cost more than take the ready-made solution. <br><br>  It is impossible to make such a register fully public, because the information is not open, but can only be considered by the contractor, the customer and Rostechnadzor. </div><p>Source: <a href="https://habr.com/ru/post/442210/">https://habr.com/ru/post/442210/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442200/index.html">Moonlight mission "Bereshit" - engineers at the SpaceIL and Israel Aerospace Industries (IAI) MCC solved problems</a></li>
<li><a href="../442202/index.html">Mailing Push Notifications with SpringBoot Server</a></li>
<li><a href="../442204/index.html">Laptop Compaq LTE 5000, part one - acquaintance</a></li>
<li><a href="../442206/index.html">Preparations for the inspection of Roskomnadzor: a harsh practice for the brave</a></li>
<li><a href="../442208/index.html">Posting typos in publications</a></li>
<li><a href="../442212/index.html">Data Science Digest</a></li>
<li><a href="../442218/index.html">FunTech iOS-meetup # 1</a></li>
<li><a href="../442222/index.html">Curious perversions from the IT world - 3</a></li>
<li><a href="../442224/index.html">Bad advice: how to write technical documentation? Part two</a></li>
<li><a href="../442226/index.html">This is not available in your country: news that you can not find out from Russia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>