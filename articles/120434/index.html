<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PowerShell: machine vs man</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago I inherited a terminal server farm. And the management set me a task - to eradicate skype, chrome, firefox and mail.ru agents on all ter...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PowerShell: machine vs man</h1><div class="post__text post__text-html js-mediator-article"> Some time ago I inherited a terminal server farm.  And the management set me a task - to eradicate skype, chrome, firefox and mail.ru agents on all terminal servers.  Historically, the company uses thin clients and only privileged users have a full-fledged PC, and the above-mentioned programs are allowed there, and on the terminals - no, no. <br><br><img src="http://lh4.googleusercontent.com/-2aJM7pkoHho/Tec6KUzjXMI/AAAAAAAAAQE/vKffDfMECtc/s288/45191523_1245122983_1web.jpg" alt="image"><br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I demolished all the programs, screwed AD policies that restrict the launch of specified applications and decided that this is probably all.  But a day later I found that users are using the program again, but already a portable version, and the exe-files were renamed 123 * .exe. I confess I was surprised by the awareness and preparedness of users. <br><br>  The issue of closing the Internet or banning absolutely all programs except those that were allowed was not suitable due to the specifics of the office.  There was a sports interest and I decided to use powershell: <br><br>  1. determine the running processes <br> <code>get-process</code> <br> <br>  2. Further, only those that are interesting to us are required - here we pay attention to the fact that if the process is renamed to 123.exe and in the process list it will hang like 123, and this is bad, because  it is not clear whether this is a good process or a bad one, so we look at the description field - even though the skype file is renamed 123 and 123 hangs in the processes, but here‚Äôs an old description - skype <br><br> <code>where-object { $_.Description -match 'skype' }</code> <br> <br>  3. stop the found processes: <br><br> <code>Stop-Process -Force</code> <br> <br>  In the dry residue we have a design of the form: <br> <code>get-process | where-object { $_.Description -match "skype" } | Stop-Process -Force</code> <br> <br>  You can put this in a ps1 script and screw it to something, but then you will need to sign it or disable the security requirement ‚Äî do not run unsigned scripts. <br><br>  I acted differently - I created a task in the scheduler, where I indicated to run the program: <br> <code>C:\Windows\...\powershell.exe</code> <br>  with parameter <br> <code>get-process | where-object { $_.Description -match 'skype' } | Stop-Process -Force</code> <br> <br>  In this case, the launch takes place and the script signature is not required.  Now the task can be launched at least every minute and nail down programs that we don‚Äôt want.  And if you add refined filtering <a href="http://social.technet.microsoft.com/Forums/ru-RU/scrlangru/thread/e8779e16-6b35-4f04-9300-d7658319b848/">to this solution</a> , then in general it is possible to wean users from using any given programs in the entire domain (without refined search, the renamed files will not work). </div><p>Source: <a href="https://habr.com/ru/post/120434/">https://habr.com/ru/post/120434/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../120428/index.html">Browser Strategy "Paths of History." Architecture and project evolution</a></li>
<li><a href="../120429/index.html">Creating real-time applications using Server-Sent Events</a></li>
<li><a href="../120430/index.html">Kango - framework for creating cross-browser extensions</a></li>
<li><a href="../120432/index.html">Work with KVM virtual machines. Introduction</a></li>
<li><a href="../120433/index.html">New service from PRUFFI: ‚Äúwe sell‚Äù ready start-up teams</a></li>
<li><a href="../120437/index.html">Himself a PR man. Writers and Speakers</a></li>
<li><a href="../120438/index.html">Developing games using Cocos2d in Python</a></li>
<li><a href="../120442/index.html">Video review Samsung Galaxy S 2</a></li>
<li><a href="../120443/index.html">Do I need a graduate school?</a></li>
<li><a href="../120446/index.html">Parking.ru expands its capabilities</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>