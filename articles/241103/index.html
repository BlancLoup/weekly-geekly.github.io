<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Rendering Clones in a Python Project</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently in our project it was required to set up code quality monitoring. The quality of the code is a subjective notion, however, many metrics long ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Rendering Clones in a Python Project</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/c38/4db/d32/c384dbd3287c41b98d14ea7e30e50085.png" align="left"><br>  Recently in our project it was required to set up code quality monitoring.  The quality of the code is a subjective notion, however, many metrics long ago were invented that allow for a quantitative analysis.  For example, cyclomatic complexity or maintainability index.  Measuring indicators of this kind is commonplace for languages ‚Äã‚Äãlike Java or C ++, however (one gets the impression) in the community of python it‚Äôs rare that someone thinks about it.  Fortunately, there is a wonderful <a href="https://pypi.python.org/pypi/radon">radon</a> with <a href="https://pypi.python.org/pypi/xenon/">xenon</a> , which quickly and <a href="https://pypi.python.org/pypi/radon">accurately</a> calculates the metrics mentioned above and even some others.  Of course, for professional enterprise tools is not enough, but everything you need is present. <br><br>  In addition to calculating metrics, it is also useful to perform a dependency analysis.  If an architecture is declared in the project, then certain links should exist between the individual parts.  The most frequent example: an application is built around a library that provides an API, and it is highly undesirable to perform actions around this API.  In other words, ioctl is not good in the kernel when libc is present.  For python, there are several packages that build a dependency graph between modules, and <a href="http://furius.ca/snakefood/">snakefood</a> seemed to me the most successful. <br><br>  In addition to analyzing dependencies, it is equally useful to define copy-paste, especially if the project involves juniors or other people who like to ‚Äúcut corners with a grinder‚Äù.  This is exactly what will be discussed in the article. <br><a name="habracut"></a><br><h3>  clonedigger </h3><br>  Surely science knows the commercial tools for determining copy-paste for Python, but the main selection criterion was free.  The very first link in the search engine led to <a href="http://clonedigger.sourceforge.net/">clonedigger</a> .  For this wonderful package we say thanks to <a href="https://habrahabr.ru/users/peter_bulychev/" class="user_link">peter_bulychev</a> .  The <a href="http://habrahabr.ru/post/30172/">article 6 years ago</a> you can see the <a href="http://clonedigger.sourceforge.net/clonedigger_europython2008.ppt">presentation</a> , it contains a description of the algorithm and retelling it makes no sense.  The most important from the application point of view: pip install clonedigger, there is no support for the troika, it has not been updated for 3 years, there is a <a href="https://github.com/jlachowski/clonedigger">deadly fork on the githaba</a> .  Well, okay!  At 2.7.8 it works fine, but my project is still thoroughly saturated with the sixth. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Digger is a console utility of the same name, with which the options and the path to the root of the experimental project are input.  Is able to spit out machine-readable XML according to the <a href="http://pmd.sourceforge.net/">CPD</a> scheme, if you pass --cpd-output.  This makes the Violations Plugin in Jenkins happy. <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  If you look at the list of languages ‚Äã‚Äãwith which ‚Äúdon't shoot the messenger‚Äù works, injustice immediately catches the eye: there are all sorts of <s>PHP</s> , but no Python!  And so with many tools.  Hence the remark at the beginning of the article about the community. </div></div><br>  Also, clonedigger has a super cool feature ‚Äúdo not scan selected directories‚Äù (--ignore-dir), which allows you <s>not to blush with govnokod in tests to</s> exclude third-party code from analysis.  True, it is implemented original: <br><br><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">walk</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dirname)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> dirpath, dirs, files <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.walk(file_name): dirs[:] = (<span class="hljs-keyword"><span class="hljs-keyword">not</span></span> options.ignore_dirs <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> dirs) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> [d <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> dirs <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> d <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> options.ignore_dirs] ...</code> </pre> <br>  Explanation: not relative paths are excluded, but names.  Passing, for example, ‚Äúext‚Äù, you exclude both ‚Äúroot / ext‚Äù, and ‚Äúroot / foo / bar / ext‚Äù, and ‚Äúroot / tests / ext‚Äù at once - you had to spend some time to realize this, and even get into the source. <br><br>  So, after the digger is completed with the required option, XML will appear with the clones found.  The structure is approximately as follows: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pmd-cpd</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">duplication</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lines</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"13"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tokens</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"40"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">line</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"853"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tornado/auth.py"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">line</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"735"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tornado/auth.py"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">codefragment</span></span></span><span class="hljs-tag">&gt;</span></span> &lt;![CDATA[ def _on_friendfeed_request(self, future, response): if response.error: future.set_exception(AuthError( "Error response %s fetching %s" % (response.error, response.request.url))) return future.set_result(escape.json_decode(response.body)) def _oauth_consumer_token(self): self.require_setting("friendfeed_consumer_key", "FriendFeed OAuth") self.require_setting("friendfeed_consumer_secret", "FriendFeed OAuth") return dict( key=self.settings["friendfeed_consumer_key"], secret=self.settings["friendfeed_consumer_secret"]) ]]&gt; <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">codefragment</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">duplication</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">duplication</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pmd-cpd</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  It's great when you can get a list of clones in CI at any time, but for monitoring, perhaps, is not enough.  There is no notorious picture, looking at which, the project manager will be able to form an opinion on the scale of the disaster. <br><br><h3>  Visualization </h3><br>  I submit to the public a <a href="https://gist.github.com/vmarkovtsev/cf3158fd3c2affc30e9a">script to display the value of mutual copy-paste in the project modules</a> .  Two files are input: the XML from clonedigger and the image being created.  Dependencies: matplotlib, scipy, xmltodict, cairo.  Work algorithm: <br><ol><li>  Parse cpd </li><li>  Build a matrix of cloning values ‚Äã‚Äãbetween modules </li><li>  Cluster modules on the inverse matrix (i.e., on the matrix of the distance between files) </li><li>  Apply the found order of the modules to the original matrix </li><li>  Long and tedious draw on matplotlib </li></ol><br><h5>  Parsing </h5><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-string"><span class="hljs-string">'r'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> fin: data = xmltodict.parse(fin.read())</code> </pre> <br>  Parsing is essentially done in one line to my favorite xmltodict: no SAX, no knowledge of xml, it's even simpler than an XDocument in Sharp.  If xmltodict encounters several identical tags on the same level, then it creates an array, and the attributes differ from the nested "@" elements at the beginning of the name.  Of course, this is not the fastest method and not the most universal, but in this case it works for one hundred percent. <br><br><h5>  Matrix clones </h5><br>  Next we get a list of unique paths and build an index: <br><pre> <code class="python hljs">files = list(sorted(set.union({dup[<span class="hljs-string"><span class="hljs-string">'file'</span></span>][i][<span class="hljs-string"><span class="hljs-string">'@path'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> dup <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data[<span class="hljs-string"><span class="hljs-string">'pmd-cpd'</span></span>][<span class="hljs-string"><span class="hljs-string">'duplication'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)}))) findex = {f: i <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(files)}</code> </pre> <br>  We run along the parsed tree and build a triangular matrix, in the cells of which lie the summarized number of rows in the found clones: <br><br><pre> <code class="python hljs">mat = numpy.zeros((len(files), len(files))) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> dup <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data[<span class="hljs-string"><span class="hljs-string">'pmd-cpd'</span></span>][<span class="hljs-string"><span class="hljs-string">'duplication'</span></span>]: mat[tuple(findex[dup[<span class="hljs-string"><span class="hljs-string">'file'</span></span>][i][<span class="hljs-string"><span class="hljs-string">'@path'</span></span>]] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>))] += \ int(dup[<span class="hljs-string"><span class="hljs-string">'@lines'</span></span>])</code> </pre> <br>  We add to our triangular matrix the same, but transposed, thereby creating a full-fledged matrix: <br><br><pre> <code class="python hljs">mat += mat.transpose()</code> </pre> <br><h5>  Clustering </h5><br>  If we draw our matrix right now, it will not be very clear which groups of files copy each other.  In the case of single pairs, everything is clear, but clones have the vile property of being dragged at once into many modules at the same time, for example, due to poor refactoring.  Therefore, it is better to first group the files by similarity among themselves, forming square pairwise disjoint areas.  Strictly speaking, if module A is similar to module B, and B is similar to C, this does not mean at all that A is similar to C (the relation is not transitive), but <b>very often this is the case</b> . <br><br>  We build the distance matrix as inverse to the cloning matrix, not forgetting that it is impossible to divide by zero, then we cluster: <br><br><pre> <code class="python hljs">mat[mat == <span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">0.001</span></span> order = leaves_list(linkage(<span class="hljs-number"><span class="hljs-number">1</span></span> / mat))</code> </pre> <br>  That's what I love scipy for!  One line, but how much is inside!  By the way, instead of linkage, you can try another method <a href="http://docs.scipy.org/doc/scipy/reference/cluster.hierarchy.html">available</a> .  Oh yes, clustering should be hierarchical (see, for example, <a href="http://habrahabr.ru/post/101338/">this article is</a> what it is), because  we want to organize the files (the leaves_list function).  If you want to play yourself, it is convenient to use a dendrogram to display the resulting hierarchy. <br><br>  Apply the found order to the file names and matrix: <br><br><pre> <code class="python hljs">mat = mat[numpy.ix_(order, order)] files = [files[i] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> order]</code> </pre> <br><h5>  art </h5><br>  I am not a specialist in scientific visualization, and I assembled the code on my knee using the good old <a href="http://stackoverflow.com/questions/14391959/heatmap-in-matplotlib-with-pcolor">stackoverflow driven development</a> .  First, choose a palette in the gradations of red and white: <br><br><pre> <code class="python hljs">cdict = {<span class="hljs-string"><span class="hljs-string">'red'</span></span>: ((<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>), (<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>)), <span class="hljs-string"><span class="hljs-string">'green'</span></span>: ((<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>), (<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>)), <span class="hljs-string"><span class="hljs-string">'blue'</span></span>: ((<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>), (<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>))} reds = LinearSegmentedColormap(<span class="hljs-string"><span class="hljs-string">'Reds'</span></span>, cdict)</code> </pre> <br>  You can choose any other from the matplotlib.cm collection.  Next, create a shape and axis and polish them with a file for a long time: <br><br><pre> <code class="python hljs">fig = pyplot.figure() ax = fig.add_subplot(<span class="hljs-number"><span class="hljs-number">111</span></span>) ax.pcolor(mat, cmap=reds) <span class="hljs-comment"><span class="hljs-comment"># uncomment the following to remove the frame around the map # ax.set_frame_on(False) ax.set_xlim((0, len(files))) ax.set_ylim((0, len(files))) ax.set_xticks(numpy.arange(len(files)) + 0.5, minor=False) ax.set_yticks(numpy.arange(len(files)) + 0.5, minor=False) ax.invert_yaxis() ax.xaxis.tick_top() ax.set_xticklabels([os.path.basename(f) for f in files], minor=False, rotation=90) ax.set_yticklabels([os.path.basename(f) for f in files], minor=False) ax.grid(False) ax.set_aspect(1) for t in ax.xaxis.get_major_ticks(): t.tick1On = False t.tick2On = False for t in ax.yaxis.get_major_ticks(): t.tick1On = False t.tick2On = False</span></span></code> </pre> <br>  As you can see, the file names are taken basic, without a path, because  otherwise for branchy projects will not fit in the drawing area.  Ok, very little remains: set an adequate size and actually render: <br><br><pre> <code class="python hljs">fig_size = <span class="hljs-number"><span class="hljs-number">16</span></span> * len(files) / <span class="hljs-number"><span class="hljs-number">55</span></span> fig.set_size_inches(fig_size, fig_size) pyplot.savefig(sys.argv[<span class="hljs-number"><span class="hljs-number">2</span></span>], bbox_inches=<span class="hljs-string"><span class="hljs-string">'tight'</span></span>, transparent=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, dpi=<span class="hljs-number"><span class="hljs-number">100</span></span>, pad_inches=<span class="hljs-number"><span class="hljs-number">0.1</span></span>)</code> </pre> <br>  The size is matched to the eye so that the file names do not stick together.  The file format is determined by its extension automatically, at a minimum, cairo supports png and svg. <br><br><h3>  Testing </h3><br>  For the demonstration, I took three open projects: tornado, matplotlib and twisted.  Tests were excluded from the analysis.  By the way, KDPV - the upper left corner of twisted. <br><br><img src="https://habrastorage.org/files/81e/b09/450/81eb094501fb4ee3b18dbdd9fd31933b.png" width="512" height="512"><br>  tornado <br><br><img src="https://habrastorage.org/files/b71/c5a/eee/b71c5aeeece24c2391922f5830e30e68.png"><br>  matplotlib <br><br><img src="https://habrastorage.org/files/09a/e23/c0d/09ae23c0d02e4e82912648ba3ce7d4ea.png"><br>  twisted <br><br>  As you can see, all projects have a main diagonal, i.e.  most often files copy themselves.  Perhaps this is due to the peculiarities of the language, perhaps the lack of macros.  Nevertheless, bright red dots deserve close attention and are candidates for refactoring - proved by our own projects. <br><br>  I will be glad to comments and corrections, thank you for your attention. </div><p>Source: <a href="https://habr.com/ru/post/241103/">https://habr.com/ru/post/241103/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../241085/index.html">Development of 3D games for Windows 8 using C ++ and Microsoft DirectX</a></li>
<li><a href="../241087/index.html">Veeam announces free utility for backup of physical machines and servers</a></li>
<li><a href="../241089/index.html">Mobile applications for web developers</a></li>
<li><a href="../241095/index.html">Git as subversion</a></li>
<li><a href="../241099/index.html">How to make profitable design development sites (part 1)</a></li>
<li><a href="../241105/index.html">Tinkoff Bank at #MBLTDev 2014</a></li>
<li><a href="../241109/index.html">Monitoring of transport: CIS vs West</a></li>
<li><a href="../241111/index.html">Translation of the book "The Little Book on CoffeeScript"</a></li>
<li><a href="../241113/index.html">This poodle bites: using SSL 3.0 holes</a></li>
<li><a href="../241117/index.html">Material Design Icon Set by Google</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>