<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Integration of Asterisk and SugarCRM</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Let's try to combine all this and make a convenient call center. 


 Initially, the task was to install CRM to work in conjunction with Asterisk to ma...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Integration of Asterisk and SugarCRM</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/e77/a40/24e/e77a4024e2b514a4b5594723a66d316e.png"><br>  Let's try to combine all this and make a convenient call center. <br><a name="habracut"></a><br><br>  Initially, the task was to install CRM to work in conjunction with Asterisk to maintain a customer base and track incoming calls.  VTigerCRM and SugarCRM came up with a description of the needs and the claimed availability of the merger.  We didn‚Äôt have a friendship with vTiger - their module, which comes bundled with the engine, was very careless about its duties: it missed calls or showed them with a delay.  In SugarCRM, on the contrary, a module called YAAI KINAMU / abcona Open Asterisk Connector works like a clock.  It is not included, we will install it separately.  The working principle and functionality of these CRMs is similar, so we opted for <a href="http://www.sugarcrm.com/download">SugarCRM Community Edition</a> .  There is an excellent Russification module for this system - RUSSIAN RAPIRA LANGUAGE PACK.  But I will show the setting for now without it. <br><br>  I will not tell you how to install SugarCRM - there is a lot of information on the network about it.  Immediately proceed to the method of integration with telephony. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Swing the YAAI module <a href="http://www.sugarforge.org/frs/%3Fgroup_id%3D773">from here</a> .  Do not unpack.  Install through the admin CRM: <i>Admin -&gt; Module Loader</i> .  Download, click 'Install'.  Again we go into the admin panel, look for the very bottom of our module, go to the configurator.  Here we need the data from the <i>/etc/asterisk/manager.conf</i> file of our Asterisk server.  You can edit <i>manager.conf</i> and create a new AMI user, or use the admin account, changing the default password (if you have not already done this when installing Asterisk, then your system is at risk).  Here you can specify which host is allowed to connect AMI-manager.  I have 127.0.0.1 since we have CRM on the same machine.  We take this data and copy it to the settings of the YAAI module: host, login, port, secret.  It remains to drive a SOAP user.  Let it be any CRM user with their password.  The remaining settings can not touch at all. <br><br>  Since the latest version of the module itself does not add to the user profile a field for entering the internal telephone, we will have to work on the interface ourselves.  Go to <i>Admin -&gt; Studio</i> .  We are looking for the User daddy, expand the list, find <i>Layouts, Edit View.</i>  The user edit form editor opens.  Drag the first left-to-right <i>New Panel and New Row</i> .  We impose <i>Asterisk Extensinon, Magic Dial Buttons, Call notification</i> on top of them.  Save the view: <i>Save &amp; Deploy</i> . <br><br><img src="https://habrastorage.org/storage2/e6a/f27/1c9/e6af271c9332943ffd5f86bb70f87d8c.png"><br><br>  I hope you already have a CRM user who has his own SIP phone.  We fix for his account his number.  Go to <i>Admin -&gt; User Management.</i>  We select the user, we press <i>Edit</i> .  From above we see the panel we created.  In <i>Asterisk Extension,</i> enter the user's internal number and put both checkboxes: <i>Magic Dial</i> - to quickly call back by clicking on the icon next to the saved number (our device rings first - pick up the phone - the outgoing number is dialed) and <i>Call Notification</i> - a pop-up window with the caller‚Äôs number and other data . <br><br><img src="https://habrastorage.org/storage2/784/a7d/c62/784a7dc623a405d66bf422ea10be5153.png"><br><br>  Now you need to run a PHP script that will interact with Asterisk.  Go to <i>folder_c_SugarCRM / custom / modules / Asterisk</i> and run: <br><br><pre><code class="bash hljs">php asteriskLogger.php</code> </pre> <br><br>  If everything is in order, we will see the message <i>"Waiting for events"</i> .  If errors are issued, then you need to check the settings of the asterisk manager and SOAP. <br><br>  In principle, everything should work, but in order for us not to run the script all the time manually, we will make it a service. <br><br>  1. Download the <i>asterisk_logger</i> file <i>:</i> <br><br><pre> <code class="bash hljs">wget https://raw.github.com/blak3r/yaai/master/misc/asterisk_logger</code> </pre> <br><br>  or extract it from the YAAI zip archive in <i>misc / asterisk_logger.</i> <br>  2. Copy it to <i>/etc/init.d/</i> <br>  3. We expose the attributes: <br><br><pre> <code class="bash hljs">chmod 755 /etc/init.d/asterisk_logger</code> </pre> <br><br>  4. Open it for editing in the editor. <br>  - edit the path where <i>asteriskLogger is located</i> (usually it is / <i>var / www / html / sugarcrm / custom / modules / Asterisk / asteriskLogger.php</i> ) <br>  - we show the user from whom the web server is started (usually it is <i>asterisk</i> ) <br>  5. Install the script: <br>  - for Centos, Red Hat, Fedora Core, Suse, etc .: <br><br><pre> <code class="bash hljs">chkconfig --add asterisk_logger</code> </pre> <br><br>  for Debian, Ubuntu and similar: <br><br><pre> <code class="bash hljs">update-rc.d -f asterisk_logger start 80 2 3 4 5 . stop 30 0 1 6 .</code> </pre> <br><br>  Check by running <br><br><pre> <code class="bash hljs">/etc/init.d/asterisk_logger start</code> </pre> <br><br>  If it started, then everything was done correctly.  If mistakes are made, then look further.  It is likely that asterisk_logger will have to remove the newline characters ^ M.  You can do this in the editor built into mc.  Also, if you have CentOS 6.X, you will have to change the line with <br><pre> <code class="bash hljs">. /lib/lsb/init-functions</code> </pre> <br>  on <br><pre> <code class="bash hljs">/etc/init.d/<span class="hljs-built_in"><span class="hljs-built_in">functions</span></span></code> </pre> <br>  That's all.  You can call and check how pop-up windows with numbers appear in CRM.  True, if the number is less than four digits, it will be deselected.  This behavior is configured in the YAAI module in CRM. <br><br><img src="https://habrastorage.org/storage2/726/313/753/72631375343a8d6b415ed68ca4ec4e63.png"><br><br>  Pls, throw karma if someone useful article. </div><p>Source: <a href="https://habr.com/ru/post/174637/">https://habr.com/ru/post/174637/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../174625/index.html">Facebook usability. Part 1: The Scale of Disaster</a></li>
<li><a href="../174627/index.html">Spherical panoramas of Mars and Curiosity</a></li>
<li><a href="../174629/index.html">Chrome has been updated to version 26</a></li>
<li><a href="../174631/index.html">A study of the statistics of search queries allows you to detect previously unknown side effects of drugs.</a></li>
<li><a href="../174635/index.html">Flexibility Exercise - Lenovo IdeaPad Yoga 13</a></li>
<li><a href="../174639/index.html">Activision has introduced a new technology for rendering photo-realistic characters.</a></li>
<li><a href="../174641/index.html">Pebble Kickstarter Review</a></li>
<li><a href="../174643/index.html">Cyberbunker vs Spamhaus</a></li>
<li><a href="../174647/index.html">Wrapper Interceptor Library</a></li>
<li><a href="../174649/index.html">Habr's export to FB2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>