<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Routers, attack vectors and other adventures of Shurik</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago, in just one month, about 10 vulnerabilities related to getting root shell or admin accounts on home network devices saw the light. Wi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Routers, attack vectors and other adventures of Shurik</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img width="400" height="400" src="https://habrastorage.org/web/0a6/6cc/81e/0a66cc81ef2d4fd7810b180d3c32302e.jpg"></div><br>  Not so long ago, in just one month, about 10 vulnerabilities related to getting root shell or admin accounts on home network devices saw the light.  Wi-Fi and 3G routers with admin's accounts around us.  By paying $ 50 for a paid account on <a href="https://www.shodan.io/">shodan.io</a> , anyone can access tens of millions of IoT devices.  These include routers, webcams and other gadgets.  On the other hand, developers and network device vendors do not attach importance to such concepts as "testing" and "security."  Many serious vulnerabilities remain without patches, and if patches do come out, users are in no hurry to use them.  What is the result?  Legions of devices are waiting in the wings to be hacked and become bots for DDOS attacks. <br><a name="habracut"></a><br><h2>  Prehistory </h2><br>  In August 2016, the world met a botnet called Mirai.  Researchers from the MalwareMustDie group began to study the malicious network activity of IoT devices in early August, and on September 20, a botnet of about 150,000 devices (mainly DVR and IP cameras) attacked Minecraft servers located at the French provider OVH. <br><br>  IoT devices were infected by selecting a Telnet account on ports 23 or 2323 from a list of 62 standard passwords.  IP addresses were generated absolutely randomly over the entire range, and after being included in the network, each infected device began scanning these random addresses.  The code controlling the botnet was not stored in the long-term memory and, therefore, could not survive the device reset.  However, given the speed at which the bots scanned the Internet, after a reboot, the device was soon re-incorporated into the botnet. <br><br>  This was followed by the largest attacks on journalist Brian Krebs, on DynDNS, Liberia, the German operator Deutsche Telekom and one of the colleges in the United States.  The source code of the Mirai botnet was published in early October and the attack on the German operator two months later was carried out using a modified version of Mirai, which exploited the RomPager server vulnerability on port 7547 (CWMP). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      According to the author, who published the code Mirai, he had 380 thousand devices as part of a botnet at a time.  This scale, of course, was due to negligence: Telnet service open to the outside and the absence of a mandatory password change do not contribute to security. <br><br><h2>  Anything other than webcams? </h2><br>  Fighting such attacks slowly but surely leads to a decrease in the number of compromised devices with standard passwords.  Gradually, tactics change from selecting accounts to exploiting various kinds of vulnerabilities. <br><br>  While the botnet predominantly absorbed video cameras and other IoT devices, in which the Telnet service gives access to Linux commands, the Telnet service on routers provided access only to the CLI settings.  This CLI allows you to read and change the device configuration, DNS settings, ip route and system information, which in itself will allow you to conduct some attacks, but does not allow you to install software for remote control. <br><br><div class="spoiler">  <b class="spoiler_title">Such a boiling protection against bots can be found on port 23:</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/web/10a/865/c32/10a865c320514945a52d58c9977ec996.png" alt="image"></div></div></div><br>  However, the absence of a bash terminal does not mean the absence of other attack vectors. <br><br>  What is the average home router?  It: <br><br><ul><li>  an externally accessible web panel with an aggressive design; </li><li>  read-only file system squashfs and ~ 10 MB of flash memory; </li><li>  Of course, busybox (compact UNIX command line interface with a set of utilities); </li><li>  micro http web server; DropBear SSH server; </li><li>  open ports 80, 443, 23, 22, 21, 137. </li></ul><br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/a73/eb8/8d2/a73eb88d28ae400bb67cde19d497e76d.png"></div><br>  In this case, the average age of the firmware on the device is 3-4 years.  This age correlates with the average age of the router itself, or, in other words, users change the device itself rather than update its firmware.  Recently, this statistic has been changing for the better by providers who, remotely and without user intervention, diagnose, configure and roll updates on users' routers.  True, it works only for those devices that providers supply under its own brand. <br><br>  At the moment, it has been empirically established that the passwords of about 15 out of 100 devices have never changed from the default values.  And knowing only the five most popular couples, you can access the admin panel of every tenth device: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/db6/ee5/03a/db6ee503ab274d6fb25e2304b0eef1e8.png"></div><br>  By accessing the web panel, the attacker also has a unique opportunity to ruin the lives of all users on the other side, conduct DNS Spoofing and explore the internal network.  With great luck, he is also able to call commands such as ping or traceroute from a web panel, find a vulnerability in the web server code to get a shell, or use one of those already found. <br><br>  The variety and simplicity of known vulnerabilities (as well as bug reports) in router software indicate that device functionality is rarely covered by sufficient testing and software developers do not have the necessary skills for safe development.  Also, the development does not take into account the models of intruders.  A buyer can purchase a router with one of the similar vulnerabilities on board: <br><br><ul><li><h3>  NETGEAR DGN2200v1 / v2 / v3 / v4 - 'ping.cgi' RCE ( <a href="http://seclists.org/fulldisclosure/2017/Feb/50">link</a> ) </h3><br>  The lack of checks in ping.cgi leads to the fact that the entered IP address from the user goes directly to bash.  You can execute arbitrary commands in the terminal simply by writing them in the IP address field in the POST request.  Like this: 12/12/12;  nc -l 4444 -e / bin / bash.  Instead of nc, you can add a more functional load, for example, msfvenom.  <a href="https://www.shodan.io/search%3Fquery%3DDGN2200">3000</a> devices waiting in the wings to unlock the potential.  Operation will require authorization on the web interface. <br><br></li><li><h3>  Multiple vulnerabilities in GoAhead WIFICAM cameras ( <a href="http://seclists.org/fulldisclosure/2017/Mar/23">link</a> ) </h3><br>  Numerous vulnerabilities have been discovered in more than 1,250 models of IP cameras, and around <a href="https://www.shodan.io/search%3Fquery%3DGoAhead%2B5ccc069c403ebaf9f0171e9517f40e41">130,000</a> cameras are at risk.  The error in the implementation of the custom authorization mechanism, which allows you to get the admin password, and the OS Command Injection vulnerability on the set_ftp.cgi page, which allows you to execute any terminal commands, together give complete control over the device without any restrictions.  Impressive!  The use of this vulnerability was added in its arsenal of the botnet TheMoon, known since 2014.  In the course of the study, infected cameras were detected, to the settings.ini file of which a script was added that downloads malicious code from the attacker's server when the device was booted. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/3c9/f93/ef4/3c9f93ef4c494acaabb4ecedc4f9fbb9.png"></div><br>  At the end of the download chain, the executable file compiled for the ARM architecture arrives from the attacker's server: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/e49/bd2/1e7/e49bd21e7c0145eeb3f3052626219317.png"></div><br>  which <a href="https://www.virustotal.com/en/file/376fbadbdc6cdddac510134f77fc4514b6ddf061a1821f05b11d47a3ee0f5bc4/analysis/">17 of 54</a> antiviruses are identified as Linux / Proxy. <br><br></li><li><h3>  Linksys Smart Wi-Fi Vulnerabilities ( <a href="http://blog.ioactive.com/2017/04/linksys-smart-wi-fi-vulnerabilities.html">link</a> ) </h3><br>  According to a study of 25 models of the Linksys Smart Wi-Fi routers that are being actively sold all over the world, 10 vulnerabilities of various degrees of danger were exposed.  Among the vulnerabilities are those that allow you to execute arbitrary commands with root privileges.  Despite the fact that in total, using Shodan can detect only about 1000 units, the researchers talk about more than 7000 scanned devices. <br><br></li><li><h3>  Siklu EtherHaul Unauthenticated Remote Command Execution Vulnerability (&lt;7.4.0) ( <a href="http://seclists.org/fulldisclosure/2017/Feb/53">link</a> ) </h3><br>  These serious pieces of iron from <a href="https://www.siklu.com/portfolio-posts/etherhaul-1200-series/">Siklu</a> provide subscribers with communication through the millimeter-wave radio waves at frequencies of 70/80 GHz.  The researcher discovered that the mysterious port 555 on them serves to communicate with other Siklu EH.  Add to this the lack of restrictions on access to the port and storing passwords in the clear, he got an exploit to change the admin password.  This architectural design error was assigned its CVE number: <a href="http%253A%252F%252Fblog.iancaling.com%252Fpost%252F155127766533%252Fsiklu-etherhaul-unauthenticated-remote-command%26m%3D1">CVE-2017-7318</a> . <br><br></li><li><h3>  Bypassing Authentication on iball Baton Routers ( <a href="http://seclists.org/fulldisclosure/2017/Mar/22">link</a> ) </h3><br>  Although the admin panel of the iBall Baton 150M device is securely closed by HTTP authorization, the password.cgi page is visible to anyone.  It seems that the developers have forgotten about this fact and stored passwords from all three accounts on the device in clear text in the HTML-page script;  <a href="https://www.shodan.io/search%3Fquery%3Diball%2BBaton%2B150M">1500</a> admin passwords in the public domain! <br><br></li></ul><br>  These examples were collected in just one month.  There are also <a href="http://routersecurity.org/bugs.php">routersecurity.org</a> router vulnerability aggregator and the wonderful <a href="https://github.com/reverse-shell/routersploit">routersploit</a> framework that collect dozens of vulnerabilities and exploits under one roof. <br><br>  A huge number of holes in the web admin code allows you to get passwords and execute arbitrary code. <br><br><h2>  Alternative threat vectors </h2><br>  In addition to the web interface, an average of 4-5 ports are open on the router.  These include Telnet (23), SSH (22) and FTP (21). <br><div style="text-align:center;"><img src="https://habrastorage.org/web/496/a00/0e1/496a000e19f14bac81acaceacadacdde.png"></div><br>  As practice shows, the Telnet service serves to access the CLI settings of the router, and FTP - to remotely update the firmware.  For example, for <a href="https://www.shodan.io/search%3Fquery%3Dftp%2Bfirmware%2Bupdate%26page%3D1">18,000</a> D-Link DSL 2750U modems, when selecting accounts, anyone has the ability to roll firmware with a built-in backdoor.  This way he will receive bots that will surely survive the reboot and are unlikely to be hacked by anyone else.  The action algorithm is as follows: <br><br><ol><li>  Download the firmware for this device from the <a href="http://ftp.dlink.ru/pub/ADSL/DSL-2750U/Firmware/">site of the</a> manufacturer D-Link. </li><li>  Unpack </li><li>  Supplement it with a backdoor account or a script that runs the bind shell.  At this step, the attacker can show imagination and embody any of his ways of getting a shell. </li><li>  Assemble the Frankenstein back using the available tools.  For example, the firmware framework. </li><li>  Update device firmware via FTP. </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/web/9f5/fbd/03a/9f5fbd03ae754bc2b4bcb39cd3eb5cef.png"></div><br><br>  In addition to FTP updates from D-Link, you can also update via Telnet ( <a href="https://www.shodan.io/search%3Fquery%3DBroadband%2BRouter%2Bport%253A23">140,000</a> CLI available) or via a web panel.  DNS Hijack on this background does not look serious. <br><br>  Recent attacks on Eir D1000 devices were related to OS Command Injection vulnerability in CWMP implementation - TR-064.  The result was an infection of about <a href="https://blog.fox-it.com/2016/11/28/recent-vulnerability-in-eir-d1000-router-used-to-spread-updated-version-of-mirai-ddos-bot/">900,000</a> devices with a modified version of Mirai.  Another vulnerability in the RomPager &lt;4.34 server under its own name Misfortune Cookie (CVE-2014-9222) has the highest <a href="https://nvd.nist.gov/vuln-metrics/cvss/v2-calculator%3Fname%3DCVE-2014-9222%26vector%3D(AV:N/AC:L/Au:N/C:C/I:C/A:C)">CVSS</a> value of <a href="https://nvd.nist.gov/vuln-metrics/cvss/v2-calculator%3Fname%3DCVE-2014-9222%26vector%3D(AV:N/AC:L/Au:N/C:C/I:C/A:C)">10</a> . <br><div style="text-align:center;"><img src="https://habrastorage.org/web/9fb/60b/450/9fb60b450d784e06b3157bd9a75a4578.png"></div><br>  Meanwhile, slightly less than half of all CWMPs use the vulnerable RomPager 4.07.  This is almost <a href="https://www.shodan.io/search%3Fquery%3Drompager%252F4.07%2Bport%253A7547">2,500,000</a> devices available.  Check Point at RSA 2017 presented their own <a href="https://www.rsaconference.com/writable/presentations/file_upload/hta-r04-the-internet-of-tr-069-things-one-exploit-to-rule-them-all_final_copy1.pdf">study</a> of the security issues of the TR-064. <br><br>  RomPager 4.07 is not the only ancient service used by firmware providers.  Genivia gSOAP 2.7 was released in 2004, and DropBear SSH 0.46 was released in the second half of 2005. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/afd/6b9/258/afd6b92582c944f6bb17d77113928d17.png"></div><br>  At least some <a href="https://matt.ucc.asn.au/dropbear/CHANGES">vulnerabilities are</a> known for DropBear (DoS and Authenticated RCE). <br><br>  On April 4, researchers Bertin Jose and Fernandez Ezequiel published a <a href="https://stringbleed.github.io/">report</a> , according to which 18 vendors, 78 models and more than half a million devices contain an error in the SNMP agent, which allows anyone who wants to get full read / write access over all values.  The mistake is that the agent simply does not check the community string: any combinations are authorized.  Vulnerability has received the fashionable name StringBleed, and mainly home cable modems are exposed to it, although researchers talk about the detection of other systems with similar vulnerabilities.  The consequences are the same as in the absence of authorization at all. <br><br>  And finally, 9 out of 1000 routers provide a free DNS server with recursion enabled by default.  The technique of operation has been known for a long time and will exist until the default DNS on routers stops responding to requests from the Internet. <br><br><h2>  Conclusion </h2><br>  Manufacturers of home network devices are gradually closing the usual ways to get bots.  Instead of brute force tactics, the attacker's focus shifts to exploiting vulnerabilities, and this gives significantly better results than brute force.  Continuous scanning of the entire range of IP addresses allows attackers to find all vulnerable devices.  In fact, a huge number of device models are subject to certain vulnerabilities, some are specific to a particular model, and some cover hundreds of thousands or millions of copies, turning devices into toys for intruders. <br><br>  Ways of dealing with botnets are simple (we list as the efficiency decreases): <br><br><ul><li>  by default, restrict access to the administration panel, CLI and FTP from the Internet; </li><li>  use the latest firmware versions; </li><li>  force customers to change standard passwords; </li><li>  restrict brute force attempts. </li></ul><br>  The most massive devices is the primary goal of researchers;  until security receives proper priority, the development cycle will introduce new vulnerabilities into the router software. <br><br>  The report was presented at the third meeting of the Nizhny Novgorod <a href="http://defcon-nn.ru/">Defcon NN</a> community and all lovers of the live narration can watch its video: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/ayorZ8V0gCg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/329902/">https://habr.com/ru/post/329902/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329892/index.html">What are women talking about? (Text mining of beauty blogs)</a></li>
<li><a href="../329894/index.html">Reactive Stream Log Processing with RxJava - Part 1</a></li>
<li><a href="../329896/index.html">Recipes for Android: Scroll-To-Dismiss Activity</a></li>
<li><a href="../329898/index.html">Must see: videos of MoscowJS 37 mitap</a></li>
<li><a href="../329900/index.html">Initial setup of Puppet is not as simple as it sounds.</a></li>
<li><a href="../329904/index.html">How to use a token to make a Windows domain safer? Part 2</a></li>
<li><a href="../329906/index.html">I want to break free. What and how to learn to escape from 1C</a></li>
<li><a href="../329908/index.html">Visual Studio Mobile Center: Deploy mobile software using Microsoft devops pipeline</a></li>
<li><a href="../329910/index.html">Analysis of changes in the game</a></li>
<li><a href="../329914/index.html">How do i make backups. DBMS FireBird</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>