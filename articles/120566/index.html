<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Restrict editing interface using proxy models</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The administrative interface django allows you to customize access rights to objects of various applications. For any model of any application, you ca...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Restrict editing interface using proxy models</h1><div class="post__text post__text-html js-mediator-article"> The administrative interface django allows you to customize access rights to objects of various applications.  For any model of any application, you can allow the user three actions: add new objects, edit and delete existing objects. <br><br>  And what if we want to allow the user to edit only part of the fields?  And at the same time leave the opportunity to other users to edit all the fields. <a name="habracut"></a><br><br>  <a href="https://docs.djangoproject.com/en/dev/topics/db/models/">Proxy models</a> will help us.  In terminology, a django proxy model is an object that has the interface of a conventional model, but is not tied to a database, or rather, it is tied to data from another model.  What is it for? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The jango documentation uses the following example.  We want the objects in the <code>auth.User</code> model <code>auth.User</code> have an additional method.  To do this, we create a proxy model based on the <code>auth.User</code> model, describe this method there and use this proxy model instead of the original one, where <code>auth.User</code> . <br><br>  Let's return to our task.  Proxy models are useful in that we can prohibit the user to work with the original model, allow him access to the proxy model, and customize the edit form so that only allowed fields are available. <br><br>  Let's imagine that we have the following model: <br><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Article</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">models</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Model</span></span></span><span class="hljs-class">): title = models.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CharField</span></span></span><span class="hljs-class">(...) body = models.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CharField</span></span></span><span class="hljs-class">(...) tags = models.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CharField</span></span></span><span class="hljs-class">(...)</span></span></code> </pre><br><br>  We want the editor to enter the admin area, see the list of articles, change tags, but cannot change the title or body of the article. <br><br>  Let's create a proxy model for starters: <br><br><pre> <code class="hljs python"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArticleEditProxy</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Article)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> proxy = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre><br><br>  Now we register this model in <code>admin.site</code> and assign it a special form in which only tags are editable. <br><br><pre> <code class="hljs python"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArticleEditProxyForm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(forms.ModelForm)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> model = ArticleEditProxy fields = [<span class="hljs-string"><span class="hljs-string">'tags'</span></span>] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArticleEditProxyAdmin</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(admin.ModelAdmin)</span></span></span><span class="hljs-class">:</span></span> list_display = [<span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'tags'</span></span>] form = ArticleEditProxyForm readonly_fields = [<span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'body'</span></span>] admin.site.register(ArticleEditProxy, ArticleEditProxyAdmin)</code> </pre><br><br>  Now, when you go to the admin area, the user will be able to see the list of articles and will be able to change tags for any article, he will also see the title and content of the article, but will not be able to change them. <br><br>  Another nuance.  Access rights to objects of various models are implemented in jang through objects of the Permission model.  Reading is one object of Permission, record - another, one more - removal.  Permission objects for new models are created during the run of the <code>manage.py syncdb</code> .  If at the time of creating the proxy model your application was controlled through the south, then Permission objects will not be created, the south will not ‚Äúnotice‚Äù your proxy model, and the syncdb operation will not work with applications serviced by the south <a href="https://grablab.org/">.</a> <br><br>  You will have to create a migration that will send a post_syncdb signal to your proxy model. <br><br><pre> <code class="hljs python"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Migration</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(SchemaMigration)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forwards</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, orm)</span></span></span><span class="hljs-function">:</span></span> db.send_create_signal(<span class="hljs-string"><span class="hljs-string">'myapp'</span></span>, [<span class="hljs-string"><span class="hljs-string">'ArticleEditProxy'</span></span>])</code> </pre><br><br>  Details of the hack with migration, I learned in <a href="http://dev.markhaus.com/blog/2011/04/django-admin-permissions-and-contenttype-table-doesnt-update-when-adding-proxy-models/">this</a> blog. </div><p>Source: <a href="https://habr.com/ru/post/120566/">https://habr.com/ru/post/120566/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../120556/index.html">Geolocation and usability</a></li>
<li><a href="../120559/index.html">HackDay16: photo report from the event and demofest. Announcement of HackDay17 in Novosibirsk</a></li>
<li><a href="../120560/index.html">HTC and MTS unveiled Superphone Sensation</a></li>
<li><a href="../120562/index.html">"It looks like." How perceptual hash works</a></li>
<li><a href="../120564/index.html">PaymentGate is a payment solution from Paysto that allows you to fully automate payments to any number of recipients</a></li>
<li><a href="../120567/index.html">Appeal to the Minister of Communications on the division of responsibility of the owners of Internet resources and their visitors</a></li>
<li><a href="../120568/index.html">Writing programs for AVR microcontrollers in Code :: Blocks 10.5 environment</a></li>
<li><a href="../120569/index.html">Forensic examination of computers infected with TDL4</a></li>
<li><a href="../120570/index.html">Visual demonstration of machine learning algorithms</a></li>
<li><a href="../120572/index.html">Skype 2.2.0.35 released</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>