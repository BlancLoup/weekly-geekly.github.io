<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mobile services, blobs and Windows 8. Store data in the cloud</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. 

 We live in a world of total globalization, both in real life and in virtual life. I mean that we want to have the same data, the same set...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mobile services, blobs and Windows 8. Store data in the cloud</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/22f/c80/b76/22fc80b76897a72a4511497ad70f172c.png"><br><br>  Good day. <br><br>  We live in a world of total globalization, both in real life and in virtual life.  I mean that we want to have the same data, the same settings and the same behavior of programs on different devices.  Such synchronization of everything and everyone in our time is easy to achieve with the help of clouds.  This is what will be discussed in this article, namely, the crossing of an application for Windows 8 (WinRT) with the Windows Azure cloud for storing data and metadata. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Introductory </h4><br>  So, suppose that we have an application for Windows 8 (let it be a service for storing some text records), which: <br>  1) It should display a list of records with minimal information about each of them (for example, a title or a creation date).  Let's call it metadata. <br>  2) It should be able to show detailed information about the entry (content) when navigating to a specific item.  Let's call it data. <br>  3) Must synchronize data between different devices running Windows 8 (created a record at home, viewed it at work). <br><br>  The most correct approach I see is to split the data and metadata and store it in different places.  This will allow us to quickly obtain small in terms of metadata for display in the form of a list, and load the "heavy" data at the user's request. <br><br>  In the course of this article, we will become familiar with Windows Azure Mobile Services for storing metadata and Windows Azure Blob Storage for storing data.  There is a lot of text and pictures ahead. <br><a name="habracut"></a><br><h4>  Step 1. Working with cloud storage </h4><br>  For more flexible and cross-platform work with Windows Azure Blob Storage, I additionally recommend that you enter another layer as a WCF service that will receive and process requests from mobile clients.  Therefore, the first step of this manual will consist of several stages. <br><br><h5>  Creating the necessary Windows Azure services </h5><br>  First we need to prepare a cloud environment by creating two services in Windows Azure - Cloud Service and Storage.  Let's start with the second.  Go to the <a href="https://manage.windowsazure.com/">portal management Windows Azure</a> .  At the bottom of the page there is a big button with a plus.  Clicking will open a selection of services to create.  We need <i>DATA SERVICES -&gt; STORAGE</i> : <br><img src="https://habrastorage.org/storage2/ed2/9d6/130/ed29d61305c94b82c04178092697a979.png"><br><br>  Enter any convenient service name for us, click the checkbox button below and wait until the service receives Online status.  After that we go into the settings of our storage and look for the "Mange keys" button with the icon i on board with our eyes and mouse.  Click on it and see three fields in front of you.  The first one will contain the name of this service, which we assigned to it during the creation, and the second and third will store the access keys.  Remember the first of them, he will come in handy soon. <br><br><h5>  Creation of WCF service </h5><br>  To create a WCF service and its corresponding service in Windows Azure, we will use Visual Studio 2012. I will show the example of the Ultimate version, but the free version of the Web is suitable. <br>  So, open a studio and create a new project with the type of Cloud: <br><img src="https://habrastorage.org/storage2/b51/445/30f/b5144530fd285a9d992e021538ac6557.png"><br><br>  In the window that appears, we will be asked to choose the types of projects that need to be placed in the cloud.  We are interested in WCF Service Web Role.  Select it and add to the list of created (do not forget to rename): <br><img src="https://habrastorage.org/storage2/7bf/17f/6a4/7bf17f6a4899883a5af0e68eaf426121.png"><br><br>  Visual Studio, after some deliberation, will create two projects for us, one of which will be a WCF service project, and the second a special project for publishing to the Windows Azure cloud.  Let's build them a little bit. <br><br>  In order to painlessly publish our service to the cloud, Visual Studio needs to know exactly which cloud to do it, and also understand that we have this right.  To convince her, just right-click on the Cloud project and select the Publish menu item: <br><img src="https://habrastorage.org/storage2/b13/038/351/b13038351b1ade24975961c3ceb3c7ba.png"><br><br>  If you have not previously published anything to the cloud, then instead of the value WindowsAzureMSDN you will have empty.  To make it thick, just <a href="https://windows.azure.com/download/publishprofile.aspx%3Fwa%3Dwsignin1.0">follow the link</a> , download the publication profile and import it using the Import button in Visual Studio.  This will allow you to perform operations on cloud services directly from the IDE. <br><br>  After we have access to the cloud from VS2012, we move on to the next step, where we will create the Cloud Service directly to host our WCF service.  On the Common Settings tab, select <i>Cloud Service -&gt; Create New</i> , and on the Advanced Settings tab, select the existing Storage Account (it should already be available for selection in the list).  Ensure that both the Cloud Service and the Storage Account are in the same zone: <br><img src="https://habrastorage.org/storage2/300/5f4/26f/3005f426f9768b393702f6c1647e9d12.png"><br><img src="https://habrastorage.org/storage2/e49/f37/be6/e49f37be6e3dab2e354360f26bad27de.png"><br><br>  After performing these steps, we simply click the Publish button, and the project will leak into the network. <br><br><h4>  Step 2. Using the repository </h4><br>  First of all, add the connection string to the web.config file of our service.  The line looks like this: <br>  <i>DefaultEndpointsProtocol = https; AccountName = service_name; AccountKey = that_the_key_key_ot_Storage</i> <br><br>  Working with cloud storage can be done in two ways - using the REST API and using the .NET wrapper.  In this article I will use the second option as the most simple.  Moreover, it was not for nothing that we created our own service. <br><br>  So, in order to use this functionality, you need to connect the ‚ÄúWindows Azure Storage‚Äù package to your NuGet project: <br><img src="https://habrastorage.org/storage2/d66/fe8/941/d66fe8941da0a8346f674b7e01781e6b.png"><br><br>  BLOB containers are connected and managed using the client: <br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.WindowsAzure.<span class="hljs-keyword"><span class="hljs-keyword">Storage</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.WindowsAzure.<span class="hljs-keyword"><span class="hljs-keyword">Storage</span></span>.Blob; CloudStorageAccount storageAccount = CloudStorageAccount.Parse(_connectionString); _blobClient = storageAccount.CreateCloudBlobClient();</code> </pre> <br>  Further work with the repository is quite simple: <br><pre> <code class="hljs haskell">//   <span class="hljs-type"><span class="hljs-type">CloudBlobContainer</span></span> container = <span class="hljs-type"><span class="hljs-type">BlobClient</span></span>.<span class="hljs-type"><span class="hljs-type">GetContainerReference</span></span>(<span class="hljs-type"><span class="hljs-type">ContainerName</span></span>); // ,     container.<span class="hljs-type"><span class="hljs-type">CreateIfNotExists</span></span>(); //     <span class="hljs-string"><span class="hljs-string">"-&lt;id &gt;"</span></span> <span class="hljs-type"><span class="hljs-type">CloudBlockBlob</span></span> blockBlob = container.<span class="hljs-type"><span class="hljs-type">GetBlockBlobReference</span></span>(<span class="hljs-type"><span class="hljs-type">BlobNamePrefix</span></span> + <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class">); //   var serializer = new </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">XmlSerializer</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typeof</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CompositeType</span></span></span><span class="hljs-class">)); using (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">var</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">s</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MemoryStream</span></span></span><span class="hljs-class">()) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">serializer</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Serialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">s</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">); </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">s</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Seek</span></span></span><span class="hljs-class">(0, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SeekOrigin</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Begin</span></span></span><span class="hljs-class">); //    </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">blob</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">blockBlob</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UploadFromStream(s)</span></span></span><span class="hljs-class">; }</span></span></code> </pre><br>  Similarly, the data can be obtained: <br><pre> <code class="hljs pgsql">//   CloudBlobContainer container = BlobClient.GetContainerReference(ContainerName); //    -  <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!container.<span class="hljs-keyword"><span class="hljs-keyword">Exists</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; //      var blockBlob = container.GetBlockBlobReference(BlobNamePrefix + id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!blockBlob.<span class="hljs-keyword"><span class="hljs-keyword">Exists</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; //     var serializer = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XmlSerializer(typeof(CompositeType)); CompositeType result = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var s = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> MemoryStream()) { //     blockBlob.DownloadToStream(s); s.Seek(<span class="hljs-number"><span class="hljs-number">0</span></span>, SeekOrigin.<span class="hljs-keyword"><span class="hljs-keyword">Begin</span></span>); result = serializer.Deserialize(s) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> CompositeType; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result;</code> </pre><br>  The above methods were placed in a wrapper class, and the WCF service itself is obsessed with a simple contract of two actions: <br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">ServiceContract</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IBlobService</span></span> { [OperationContract] <span class="hljs-function"><span class="hljs-function">CompositeType </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span>; [OperationContract] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PutData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">CompositeType data</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre><br>  <b>!!!</b>  Here it is necessary to mention an important, but absolutely non-obvious thing.  Blob names of containers and blocks must be in small case.  That is, the name <i>BlobContainer</i> will cause an error when attempting to create, and, for example, a <i>blob-container</i> will be created without problems. <br><br>  After we have written the service, we publish it once again to the cloud and after completing this procedure it will be available at <i>your_service_name.cloudapp.net/BlobService.svc</i> . <br><br><h4>  Step 3. Mobile services </h4><br>  The previous two steps were aimed at creating an infrastructure for storing ‚Äúdata‚Äù - a large amount of information that is not always needed, but on request.  Now let's move on to storing ‚Äúmetadata‚Äù.  To do this, we will use the recent novelty in Windows Azure - Mobile Services. <br><br>  Creating a new mobile service is as easy as other services in Windows Azure.  Again we go to the <a href="https://manage.windowsazure.com/">management portal</a> , where in the creation menu below we select <i>COMPUTE -&gt; MOBILE SERVICE</i> and see the wizard in front of us: <br><img src="https://habrastorage.org/storage2/4b5/5f0/49a/4b55f049ad4e8e7d9823550065cee79b.png"><br><br>  We indicate in it the name of the future service, the region of placement (do not forget to be located somewhere in one place), specify the Storage where our data will be stored (you can use an existing one or create a new one) and complete the wizard. <br><br>  As soon as the service is created, go to its page in the section marked with the cloud icon with a lightning (I do not know the name of it).  On this page there are two options - <i>Create a new Windows Store app</i> and <i>Connect an existing Windows Store app</i> .  The first will allow you to download the archive with the application configured to work with your mobile service, and the second will simply give a piece of code that needs to be embedded into an existing application.  In principle, now it does not matter which option you choose.  I suggest using the second one and creating the application manually. <br><br>  In the meantime, we have not done this, let's prepare Mobile Services for use.  To do this, first go to the Data section (in the top menu) and add a new table to store the records.  You can call it whatever you like, I have TestItem: <br><img src="https://habrastorage.org/storage2/832/944/eff/832944effdbbbf2ace150ff4b48f7894.png"><br><br>  This table will later contain the metadata entries entered in the Windows 8 application. <br><br><h4>  Step 4. Windows 8 </h4><br>  It is time to do something for which everything was started.  The application for Windows 8 (WinRT) can be created for free in the Express version of Visual Studio 2012 (like the one we used for the WCF service, but now for Win8 applications). <br>  File -&gt; New Project -&gt; Windows Store: <br><img src="https://habrastorage.org/storage2/280/c83/d4f/280c83d4fdeec58c208a82d8ea753799.png"><br><br>  First you need to add the necessary links to the library so that you can enjoy the benefits of Mobile Services.  If you noticed, in the previous step, Windows Azure offered us to download and install <a href="https://go.microsoft.com/fwLink/%3FLinkID%3D257545%26clcid%3D0x409">Mobile Services SDK</a> .  This needs to be done, because with its help we will work with cloud services for mobile devices. <br><br>  Once the SDK is installed, we can connect it to the project using the standard procedure <i>Add Reference</i> : <br><img src="https://habrastorage.org/storage2/da2/302/88d/da230288dde0119da08dc32df00b0c0d.png"><br><br>  Then we will also include a link to our WCF service.  This is also done easily using the standard <i>Add Service Reference</i> dialog: <br><img src="https://habrastorage.org/storage2/b4c/1c8/0c5/b4c1c80c56280f9012c3cf41a2d5d2fe.png"><br><br>  As a result of connecting the Service Reference, Visual Studio will create for us a special wrapper class that will look like a regular class with a service contract, but in fact will contact the remote WCF at the specified address. <br><br>  And finally, add the code for using mobile services, which, as I said above, can be obtained on the page with a little cloud and lightning in Windows Azure.  It looks like this: <br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> MobileServiceClient MobileService = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MobileServiceClient( <span class="hljs-string"><span class="hljs-string">"https://***.azure-mobile.net/"</span></span>, <span class="hljs-string"><span class="hljs-string">"secret_key"</span></span>);</code> </pre><br>  I added this field to the App.xaml page to access mobile services from anywhere in the application. <br><br><h4>  Step 5. Putting it all together </h4><br>  It is time to connect all the paths in one place and write the code, which, when adding a new record, will place it in the Azure Blob Storage and Mobile Services store. <br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">private</span></span> async <span class="hljs-type"><span class="hljs-type">Task</span></span> <span class="hljs-type"><span class="hljs-type">PutDataTestWCF</span></span>(<span class="hljs-type"><span class="hljs-type">CompositeType</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">) { //      </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WCF</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">var</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cli</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">await</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Task</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Run</span></span></span><span class="hljs-class">(() =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BlobServiceClient</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BasicHttpBinding</span></span></span><span class="hljs-class">(), </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EndpointAddress(CloudServiceEndpoint)</span></span></span><span class="hljs-class">)); //      () </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">await</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cli</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PutDataAsync(data)</span></span></span><span class="hljs-class">; //     </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">await</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cli</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CloseAsync</span></span></span><span class="hljs-class">(); //      </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">var</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">table</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">App</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MobileService</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetTable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TestItem</span></span></span><span class="hljs-class">&gt;(); //     </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">var</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">await</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">table</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Select</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class"> == </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class">).</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ToListAsync</span></span></span><span class="hljs-class">(); //    ,   ,  -  </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class"> != </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">null</span></span></span><span class="hljs-class"> &amp;&amp; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Count</span></span></span><span class="hljs-class"> &gt; 0) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">await</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">table</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UpdateAsync</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TestItem</span></span></span><span class="hljs-class">() {</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Text</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Text</span></span></span><span class="hljs-class">}); else await table.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">InsertAsync</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TestItem</span></span></span><span class="hljs-class">() {</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Text</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Text</span></span></span><span class="hljs-class">}); }</span></span></code> </pre><br>  Here you should pay attention to a few things.  First, all methods that work with the network in one way or another are asynchronous.  Even the client class to the WCF service that was automatically generated also contains asynchronous methods (PutDataAsync).  This is great because it allows you to make the application more responsive, without forcing the user to watch the blocked interface while the application tries to connect to the Internet. <br>  In addition, work with both services has become quite simple and transparent.  What works with WCF, what about Mobile Services, both of them look like simple calls to .Net code, hiding all the details "somewhere out there."  I did not write here any abstract layers of data access, but if you get confused and do everything correctly, then we can easily make mocks for testing the application. <br><br><h4>  Conclusion </h4><br>  In this article, first of all, I wanted to show not how to write Windows 8 applications, but how to embed the ability to work with different types of cloud storage in different ways.  I deliberately cited not so much code, since the article turned out to be large and, possibly, difficult to read.  Below I attach the archive with the code that can be used for training: <br>  <a href="https://skydrive.live.com/redir%3Fresid%3D1A98D7400F0A091A!2230%26authkey%3D!ALQ56zmznPo4nog">Download archive</a> <br>  In it, I replaced all references to my service with *** or ****.  I think it will be clear what and where it is necessary to substitute so that everything takes off. <br><br>  In preparing the article and the test application, the following materials were used: <br>  - <a href="https://www.windowsazure.com/en-us/develop/net/how-to-guides/blob-storage/">Official Blob Storage Guide</a> <br>  - <a href="https://www.windowsazure.com/en-us/develop/mobile/tutorials/get-started-with-data-dotnet/">The official guide to working with data in mobile services</a> <br>  - <a href="http://www.google.ru/">Google</a> , <a href="http://www.bing.com/">Bing</a> , <a href="http://www.yandex.ru/">Yandex</a> <br>  - Own thoughts and guesses <br><br>  <i>PS A big request to not indifferent minusators - please write the arguments of your cons either in the comments or in a personal.</i>  <i>It is important for me to know my flaws in order to correct them in future publications.</i>  <i>Thank you very much.</i> </div><p>Source: <a href="https://habr.com/ru/post/157641/">https://habr.com/ru/post/157641/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../157627/index.html">ScrollUP buttons. Fast scrolling on any site</a></li>
<li><a href="../157631/index.html">Overview of Corporate Training Services</a></li>
<li><a href="../157633/index.html">MIPS sold its patents, and then Imagination was purchased.</a></li>
<li><a href="../157635/index.html">THQ lost half its capitalization</a></li>
<li><a href="../157639/index.html">Calendar for ITshnikov: introduction</a></li>
<li><a href="../157645/index.html">Linux Steam: closed beta testing has begun</a></li>
<li><a href="../157647/index.html">Create a module "New Mail" for Magento (Part 1)</a></li>
<li><a href="../157649/index.html">InterSystems recruits interns</a></li>
<li><a href="../157651/index.html">Google increases the energy efficiency of the Chrome browser in a number of scenarios up to 25%</a></li>
<li><a href="../157655/index.html">Handspring Visor Edge or Short adaptation course for time travelers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>