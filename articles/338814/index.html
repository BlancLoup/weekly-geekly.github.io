<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We translate interfaces into fifty languages. Sketch</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Heroes of the series "Sherlock" 


 Hello! I'm Alexei Timin, an engineer from the Badoo localization team. In this post I will tell you about how we h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We translate interfaces into fifty languages. Sketch</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/59/cb/ae/59cbae92d0813432765213.jpeg"><br>  <em>Heroes of the series <a href="https://ru.wikipedia.org/wiki/%25D0%25A8%25D0%25B5%25D1%2580%25D0%25BB%25D0%25BE%25D0%25BA_%2528%25D1%2582%25D0%25B5%25D0%25BB%25D0%25B5%25D1%2581%25D0%25B5%25D1%2580%25D0%25B8%25D0%25B0%25D0%25BB%2529">"Sherlock"</a></em> </p><br><p>  Hello!  I'm Alexei Timin, an engineer from the Badoo localization team.  In this post I will tell you about how we help translators in their hard work, and about the new Open Source solution that allows you to generate screenshots of the design prepared in Sketch for different languages. </p><br><p>  If you create designs for multilingual projects or work in a company that develops such projects, then the information will be useful to you. </p><a name="habracut"></a><br><p>  There are only two developers in the Badoo localization team, but we hold and create very interesting tools: </p><br><ul><li>  <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25B0%25D0%25BC%25D1%258F%25D1%2582%25D1%258C_%25D0%25BF%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B2%25D0%25BE%25D0%25B4%25D0%25BE%25D0%25B2">Translation memory</a> </li><li>  <a href="https://en.wikipedia.org/wiki/Collaborative_translation">Collaborative Translation Platform</a> , available at <a href="https://translate.badoo.com/">https://translate.badoo.com/</a> , </li><li>  the functionality of providing correct translation to a specific user (depending on the language, gender, declination, number), </li><li>  A / B testing <a href="https://ru.wikipedia.org/wiki/A/B-%25D1%2582%25D0%25B5%25D1%2581%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">translation preparation system</a> (yes, we are testing translation options to determine which wording is better), </li><li>  a dozen interfaces for translators, </li><li>  collecting statistics on the work of translators and their use of tools. </li></ul><br><p>  These tools are designed to help in the process of localizing the site and mobile applications of Badoo in 47 languages.  This is a huge scope of work. </p><br><p>  Our translators work with lexemes (this is how we call an indivisible translation unit: a word or a sentence).  For each lexeme, the wording of the optimal length is selected in order to ensure that the application is correctly displayed on users' screens.  Sometimes a translation must be not only correct, but also attractive (for example, for marketing needs). </p><br><p>  The translation process looks like this: </p><br><ol><li>  Designers draw. </li><li>  Programmers are programming. </li><li>  Translators translate. </li><li>  Release </li></ol><br><p>  As you can see, translators are forced to wait for the prototype of the application from the programmers.  Or, if there are changes in the translations, they need to ask the developers to re-build the test version to check the mapping.  But we got the idea to limit the participation of programmers as much as possible in the translation process and speed up the preparation of the release. </p><br><p>  According to our idea, the process should look like this: </p><br><ol><li>  Designers draw. </li><li>  Programmers program, and translators translate and can immediately see the result in some way. </li><li>  Release </li></ol><br><p>  To make it easier for you to present a problem, I present the process diagrams before and after.  The optimized area is highlighted in red in the first scheme: </p><br><p><img src="https://habrastorage.org/webt/59/cb/cd/59cbcd8b3120e035270530.png"></p><br><p> Our designers work in the graphic editor Sketch.  We found out that the <code>sketch-tool</code> utility that comes with it can generate screenshots, which means that when adding a translation, you can immediately show the screenshot to the translator!  But the question arose: how to replace the source code in the design in order to get a localized screenshot? </p><br><p>  In the intervals between the parties, we discussed possible options for the implementation of the idea.  And the exit was found. </p><br><p>  Let's figure out how the <code>.sketch-</code> from the inside. </p><br><h3 id="predstavlenie-dannyh-vnutri-sketch-fayla">  Representation of data inside a .sketch file </h3><br><p>  In the 43rd version of Sketch, developers began to use the <a href="http://sketchplugins.com/d/87-new-file-format-in-sketch-43"><code>  .sketch-</code></a> for "better integration with third-party services." </p><br><p>  Logically in the design prepared in Sketch, Pages, Artboards and graphic elements are highlighted.  Each entity ‚Äî Pages, Artboards, and graphic elements ‚Äî is assigned a unique identifier ( <a href="https://ru.wikipedia.org/wiki/UUID">UUID</a> ) once (at the time of creation), which does not change afterwards. </p><br><p>  Schematically, the relationship between entities can be represented as: </p><br><p><img src="https://habrastorage.org/webt/59/cb/cb/59cbcb8e5a65b963410531.png"></p><br><p>  See the picture below to see what is in the Sketch interface: iPhone SE and iPhone 7 are two of the possible Artboards, and Page 1 is one of the possible Pages. </p><br><p><img src="https://habrastorage.org/webt/59/cb/d3/59cbd3187d282658459260.png"></p><br><p>  The design saved in a .sketch file is a ZIP archive, inside which there are directories with PNG and JSON files.  Looks easy? </p><br><p>  If we unzip the .sketch file, the directory tree will look like this: </p><br><p><img src="https://habrastorage.org/webt/59/cc/a7/59cca7f74e7e5945728552.png"></p><br><p>  Information about each Page and related Artboard objects is stored in pages / *. Json.  The file name is the Page object's UUID, and there is one file for each Page object. </p><br><p>  We can easily open any <code>pages/*.json</code> and edit, for example, the name of one of the Artboards.  To define a specific file for editing, run: </p><br><pre> <code class="hljs perl">$ <span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> -l <span class="hljs-string"><span class="hljs-string">'iPhone 7'</span></span> pages/*</code> </pre> <br><p>  And if changing the name is not a problem, then changing, say, the text ‚ÄúPress me‚Äù on the button is already more difficult.  After wandering around the forums and searching for a suitable library without results, we realized that many other people are also looking for a solution. </p><br><blockquote>  <em>... his death at the end of the needle, that needle in the egg, then the egg in the duck, the duck in the hare, the hare in the chest, and the chest stands on a tall oak ...</em> <br>  "Princess Frog" </blockquote><p>  The text on the button is packed into a binary <code>plist</code> encoded into the Base64 string, which is the attribute value of the serialized JS object located in one of the files compressed with the ZIP file. <br><img src="https://habrastorage.org/webt/59/cb/d6/59cbd6d1edde4536181259.png"></p><br><p>  We will not deal with questions of unzipping and reading JSON from files, but it is worth mentioning the <a href="https://developer.apple.com/library/content/documentation/General/Conceptual/DevPedia-CocoaCore/PropertyList.html">property list</a> format (bplist in the diagram above).  To modify the text "Click me", you can use the <a href="https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man1/plutil.1.html"><code>plutil</code></a> utility.  It allows you to insert a new one and remove the old value of a certain property, and with its help you can convert a plist from a binary view to XML and vice versa.  XML is a convenient format, there are many tools for working with it.  It is also possible to export to JSON, but, firstly, this results in the loss of data types, and secondly, not always plist can be converted to JSON.  For example, with a plist from a .sketch file, export to JSON did not work. </p><br><p>  So, we have dealt with the internal presentation and finally proceed to the options for the implementation of our ideas. </p><br><h3 id="vybor-podhodyaschey-realizacii">  Choosing the right implementation </h3><br><h4 id="variant-1-lenivoe-reshenie">  Option 1. Lazy solution </h4><br><p>  We tried to tell translators about JSON, Base64 and bplist, to teach them to replace texts with translations and to take screenshots.  But when they were shown the console export export command </p><br><pre> <code class="hljs javascript">$ sketchtool <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> artboards --items=<span class="hljs-string"><span class="hljs-string">'42C53146-F9BF-4EEE-A4F8-BB489F0A3CDA,BF38A95A-F0CD-452E-BE26-E346EBD349CE'</span></span> --formats=png --save-<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>-web example_design.sketch</code> </pre> <br><p>  understood that this option is no good. </p><br><p>  (Joke, we didn‚Äôt tell the translators anything, but immediately switched to the second variant). </p><br><h4 id="variant-2-true-way">  Option 2. True way </h4><br><p>  Translators should not think about technical issues.  You just need a screenshot when saving the translation. </p><br><p>  For this we decided to develop a service, the minimum functionality of which would be: </p><br><ol><li>  The definition of graphic elements containing text in a .sketch UUID file. </li><li>  Generate screenshots with localized text. </li></ol><br><p>  The project was named Sketch Modifier and was published on <a href="https://github.com/AlexTimin/sketch-modifier/">GitHub</a> . </p><br><h3 id="rabota-so-sketch-modifier">  Work with Sketch Modifier </h3><br><p>  To start using Sketch Modifier, you need to install Node.js.  on macOS (where, of course, Sketch <a href="https://www.sketchapp.com/">https://www.sketchapp.com/</a> should already be installed).  Yes, Sketch is only under macOS.  But if your designer works in Sketch, then you have at least one Mac. </p><br><p>  Consider the process of working with Sketch Modifier step by step. </p><br><h4 id="shag-1-ustanovka">  Step 1. Installation </h4><br><p>  Find a computer running macOS.  Download and install <a href="https://nodejs.org/en/"><code>Node.js</code></a> on it, which is quite simple. </p><br><p>  Next, download the archive or clone the repository with the GitHub command </p><br><pre> <code class="hljs ruby">$ git clone <span class="hljs-symbol"><span class="hljs-symbol">https:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/github.com/</span></span>AlexTimin/sketch-modifier.git</code> </pre> <br><p>  Go to the project directory </p><br><pre> <code class="hljs dos">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> sketch-modifier</code> </pre> <br><p>  Install dependencies using npm: </p><br><pre> <code class="hljs sql">$ npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span></code> </pre> <br><p>  And finally, start the server </p><br><pre> <code class="hljs ruby">$ ./bin/www</code> </pre> <br><p>  Everything, now at <code>http://localhost:3000</code> you should respond to the server.  You can go to this address in the browser and check. </p><br><h4 id="shag-2-zagruzka-sketch-fayla-i-opredelenie-ishodnyh-tekstov">  Step 2. Download the <code>.sketch</code> file and source definition </h4><br><p>  For example, take <a href="https://drive.google.com/file/d/0Byxfc0fklW5NM3p4ZFFaQzBONG8/view%3Fusp%3Dsharing"><code>example_design.sketch</code></a> and load it into the system.  To do this, send a request from the directory where you saved <code>example_design.sketch</code> : </p><br><pre> <code class="hljs scala">$ curl -<span class="hljs-type"><span class="hljs-type">F</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'data</span></span>=<span class="hljs-meta"><span class="hljs-meta">@example</span></span>_design.sketch' http:<span class="hljs-comment"><span class="hljs-comment">//localhost:3000/add-sketch/</span></span></code> </pre> <br><p>  <code>.sketch</code> will be assigned a UUID.  In response, you will receive the following JSON: </p><br><pre> <code class="hljs ruby">{ <span class="hljs-string"><span class="hljs-string">"8a2009c5-36ca-4328-87d6-16aa0c2e2800"</span></span>: { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  example_design.sketch UUID,      <span class="hljs-string"><span class="hljs-string">"5A0F429A-C974-460A-9482-93AED7456850"</span></span>: { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Page <span class="hljs-number"><span class="hljs-number">1</span></span> UUID <span class="hljs-string"><span class="hljs-string">"C1C29749-B967-494D-8D7E-A484EAB37534"</span></span>: { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> iPhone SE Artboard UUID <span class="hljs-string"><span class="hljs-string">"E335D359-9DF3-4DCC-8B79-E77E38824714"</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span> /<span class="hljs-regexp"><span class="hljs-regexp">/ UUID    } ‚Ä¶ /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    Artboards } ‚Ä¶ /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    Pages } }</span></span></code> </pre> <br><p>  You can save this data to your database, send it to / dev / null or do something else interesting.  But we keep them in the database. </p><br><h4 id="shag-3-generaciya-perevedyonnyh-prevyu">  Step 3. Generation of translated previews </h4><br><p>  To replace the text, you need to send a request to <code>http://localhost:3000/generate-preview/</code> with the indication of the <code>screens</code> and <code>textReplaces</code> .  The list of required commands will be lower, but for now let's deal with the structure of the request parameters. </p><br><p>  In the <code>screens</code> parameter, we specify the list of UUIDs of those Artboards whose screenshots we want to receive.  The parameter value has the following structure: </p><br><pre> <code class="hljs ruby">{ Example Design <span class="hljs-symbol"><span class="hljs-symbol">UUID:</span></span> [ <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> example_design.sketch Artboard UUID, <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> iPhone SE ... ] }</code> </pre> <br><p>  In the <code>textReplaces</code> we specify the UUID of the text elements and the new text.  The parameter value has the following structure: </p><br><pre> <code class="hljs objectivec">{ Text UUID: <span class="hljs-string"><span class="hljs-string">" , "</span></span>, ... }</code> </pre> <br><p>  So, we form a request to generate a screenshot.  Replace the text "Click me" on "Start the party!", For example.  For this we need the file generate-preview-request-data, in which we indicate the values ‚Äã‚Äãof the request parameters. </p><br><p>  The contents of the file <code>generate-preview-request-data</code> : </p><br><pre> <code class="hljs smalltalk">textReplaces={ <span class="hljs-comment"><span class="hljs-comment">"E335D359-9DF3-4DCC-8B79-E77E38824714"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"Start the party!"</span></span> }&amp;screens={ <span class="hljs-comment"><span class="hljs-comment">"8a2009c5-36ca-4328-87d6-16aa0c2e2800"</span></span> : [ <span class="hljs-comment"><span class="hljs-comment">"C1C29749-B967-494D-8D7E-A484EAB37534"</span></span> ] }</code> </pre> <br><p>  Execute the command from the directory in which you saved the file <code>generate-preview-request-data</code> . </p><br><pre> <code class="hljs ruby">$ curl -X POST -d <span class="hljs-string"><span class="hljs-string">"@generate-preview-request-data"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">http:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/localhost:3000/generate</span></span>-preview/</code> </pre> <br><p>  In response, you will receive screenshots in Base64.  The structure of the response will be as follows: </p><br><pre> <code class="hljs objectivec">{ <span class="hljs-string"><span class="hljs-string">"C1C29749-B967-494D-8D7E-A484EAB37534"</span></span>: <span class="hljs-string"><span class="hljs-string">"data:image/7HYUIY786GFFDASeY+...;base64"</span></span>, ... }</code> </pre> <br><p>  Probably, you guessed that the key in the response structure is the UUID of the requested screenshot, and the value is the representation of the screenshot in Base64 (let me remind you that we requested a screenshot for iPhone SE). </p><br><p>  If you save, say, in example.html the following code with the Base64 representation of the image substituted </p><br><p> <code>&lt;img src="  Base64"&gt;</code> </p> <br><p>  and then open example.html in the browser, you will see the translated screenshot: </p><br><p><img src="https://habrastorage.org/webt/59/cb/b7/59cbb717b2ada606625949.png"></p><br><p>  With the help of Sketch Modifier you can take screenshots before localization, during the process and after localization, which is very important.  You will see how the design behaves when using real texts, and understand what needs to be improved. </p><br><h3 id="zaklyuchenie">  Conclusion </h3><br><p>  We set up working with Sketch Modifier in such a way that the design is loaded once, and screenshots are generated when saving translations.  Translators will immediately see if the selected translation language fits in the specified areas.  So, the problems will be known in advance. </p><br><p>  The source code for the implementation is <a href="https://github.com/AlexTimin/sketch-modifier">on GitHub</a> . </p><br><p>  Use, advise ways to improve, write reviews. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/338814/">https://habr.com/ru/post/338814/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338804/index.html">$ mol_app_calc: Spreadsheet Party</a></li>
<li><a href="../338806/index.html">Loading OS on ARM</a></li>
<li><a href="../338808/index.html">Review of music software code defects. Part 1. MuseScore</a></li>
<li><a href="../338810/index.html">"Kings of Mathematics": Big Data Analytics in a bank. Project GAUSS in VTB</a></li>
<li><a href="../338812/index.html">How can a never called function be called?</a></li>
<li><a href="../338816/index.html">MBLTdev 2017: Hardcore Android Development Reports</a></li>
<li><a href="../338818/index.html">Why headlines are needed</a></li>
<li><a href="../338820/index.html">12 personal productivity tools to help you keep track of your deadline.</a></li>
<li><a href="../338822/index.html">Ticket Trick: Hacking hundreds of companies through customer support</a></li>
<li><a href="../338824/index.html">Who needs flakes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>