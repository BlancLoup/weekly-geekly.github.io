<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Capistrano: Remote Application Deployment</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article describes an example of using the Capistrano tool for remote deployment of applications. An example is an PHP application. 

 Capistrano ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Capistrano: Remote Application Deployment</h1><div class="post__text post__text-html js-mediator-article">  This article describes an example of using the Capistrano tool for remote deployment of applications.  An example is an PHP application. <br><br>  <b>Capistrano is a tool that can perform tasks on a remote machine via ssh access.</b>  It is developed in Ruby and is widely used to publish Ruby on Rails applications. However, it can easily be used with other programming languages, such as PHP. <br><br>  For more detailed information and practical use, you should read the additional documentation and practice.  I just want to demonstrate the possibilities of capistrano. <br><a name="habracut"></a><br><h3>  What do you need: </h3><br>  1. availability of <b>ssh-access</b> to the hosting on which the application will be published; <br>  2. project in any version control system;  default is <b>subversion</b> ; <br>  3. The local developer's machine (i.e. with which the remote publishing is performed) should work under <b>Linux, Mac OS or BSD</b> , Windows will not work. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  What do we have </h3><br>  PHP application with structure <br>  myproject / <br>  ** lib / <br>  ** config / <br>  ** public / <br>  **** index.php <br><br>  Repository address <br>  svn: // svnhost / trunk / myproject / <br>  Repository user: mysvnuser <br><br>  Hosting <br>  1. host: web1234 <br>  2. user: myuser <br>  3. directory of the project on the hosting: / home / myuser / myproject <br>  4. root web directory of the site: / home / myuser / myproject / public_html <br><br><h3>  Training </h3><br><br>  First, install the necessary tool. <br><br>  <b>On the local machine,</b> install (for ubuntu): <br>  1. chop: sudo apt-get install ruby ‚Äã‚Äãrubygems <br>  2. capistrano: sudo gem install capistrano, <br>  3. client svn: sudo apt-get install subversion <br><br>  If I forgot something, look <a href="http://www.capify.org/install">here</a> . <br><br>  <b>On the remote server,</b> create the directory / home / myuser / myproject / deploy, where the project will be extracted from the repository. <br><br><h3>  Go </h3><br><br>  We do everything on the <b>local</b> machine. <br><br>  Go to the project directory <br> <code>$ cd /var/www/myproject <br> $ ll <br> drwxr-xr-x 2 alex alex 4096 2009-01-14 20:56 config <br> drwxr-xr-x 2 alex alex 4096 2009-01-14 20:56 lib <br> drwxr-xr-x 2 alex alex 4096 2009-01-14 20:56 public <br></code> <br><br>  Run the command "capify." <br> <code>$ capify . <br> [add] writing `./Capfile' <br> [add] writing `./config/deploy.rb' <br> [done] capified! <br></code> <br><br>  The capify command has created 2 files: <br>  1. Capify, which is necessary capistrano;  its minimum task is to load config / deploy.rb; <br>  2. config / deploy.rb - a rubi script that stores instructions and capitrano settings. <br><br>  We do not touch the Capify file, we make all changes in deploy.rb.  Copy the code below into config / deploy.rb and modify it to fit your needs. <br><br> <code>#   <br> set :application, "myproject" <br> #   set   application     "myproject" <br> <br> #       ,   -. <br> role :web, "web1234" #    <br> set :user, 'myuser' #    <br> set :use_sudo, false #     sudo <br> <br> #      <br> set :app_dir, "/home/#{user}/#{application}/" # /home/myuser/myproject/ <br> #  "/home/#{user}/#{application}/"  "/home/$user/$application/"  PHP <br> <br> # ,    checkout   <br> set :deploy_to, "#{app_dir}/deploy" # /home/myuser/myproject/deploy <br> <br> #   <br> set :scm, :subversion #  subversion <br> set :scm_user, 'mysvnuser' #    <br> set :scm_url, "svn://svnhost/trunk/#{application}" # svn://svnhost/trunk/myproject/ <br> #   svn checkout --username mysvnuser svn://host/trunk/myproject <br> set :repository, Proc.new { "--username #{scm_user} #{scm_url}"} <br> <br> task :after_symlink, :roles =&gt; :web do <br> run "ln -nfs #{release_path}/public #{app_dir}/public_html" <br> end <br></code> <br><br>  On the local machine, execute the command <br> <code>$ cap deploy:setup <br></code> <br>  We connect via ssh to the web1234 server, actually ssh myuser @ web1234: 22, and it creates the directories it needs in / home / myuser / myproject / deploy: <br>  ** releases, <br>  ** shared <br><br>  We execute the command <br> <code>$ cap deploy:update</code> <br>  Capistrano runs the following commands on a remote server: <br>  1. create a new directory in / home / myuser / myproject / <b>deploy / releases</b> , for example, <b>releases / 20090114102030</b> <br>  2. makes <b>svn checkout</b> svn: // svnhost / trunk / myproject / to this directory <br>  3. creates a / home / myuser / myproject / <b>deploy / current</b> symlink on / home / myuser / myproject / <b>deploy / releases / 20090114102030</b> <br>  4. creates the / home / myuser / myproject / <b>public_html simlink</b> on / home / myuser / myproject / <b>deploy / releases / 20090114102030 / public</b> <br><br>  Item 4 implemented in rows <br> <code>task :after_symlink, :roles =&gt; :web do <br> run "ln -nfs #{release_path}/public #{app_dir}/public_html" <br> end <br></code> <br>  The <b>release_path</b> variable contains the path to the current release of the application. <br><br>  Change the application code a little (for example, in index.php), commit the changes and repeat the command <br> <code>$ cap deploy:update</code> <br>  Capistrano will create a new directory, <b>releases / 20090114203040,</b> and make svn checkout from the repository.  Then install the <b>deploy / current</b> symlink on <b>deploy / releases / 20090114203040 /</b> , and publick_html on <b>deploy / releases / 20090114203040 / public</b> . <br><br>  You will already have this directory structure: <br>  deploy / <br>  ** releases <br>  **** 20090114102030 <br>  ******** lib / <br>  ******** config / <br>  ******** public / <br>  ************ index.php <br>  **** 20090114203040 <br>  ******** lib / <br>  ******** config / <br>  ******** public / <br>  ************ index.php <br>  ** current -&gt; releases / 20090114203040 <br>  ** shared <br>  public_html -&gt; deploy / releases / 20090114203040 / public <br><br>  It should be noted that the task deploy: update is performed by the capistrano in a transaction. <br><br>  This is the minimum that is needed for remote publication of the application.  In this example, you do not need to restart the web server (or several servers), make changes in the database, etc.  For real projects you have to explore capistrano yourself. </div><p>Source: <a href="https://habr.com/ru/post/49127/">https://habr.com/ru/post/49127/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../49118/index.html">Why do you use Windows and not other operating systems?</a></li>
<li><a href="../49119/index.html">Watching user</a></li>
<li><a href="../49122/index.html">Intel Atom N280</a></li>
<li><a href="../49125/index.html">Our response to the financial crisis: first month results</a></li>
<li><a href="../49126/index.html">not http: links</a></li>
<li><a href="../49129/index.html">GNOME: Turning off the dull effect of minimizing windows</a></li>
<li><a href="../49130/index.html">Twitter on C #</a></li>
<li><a href="../49131/index.html">Taxes on the Internet?</a></li>
<li><a href="../49133/index.html">Windows 7 - just no words!</a></li>
<li><a href="../49136/index.html">An interesting problem in .htaccess or special characters, mod_rewrite and C ++ tag.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>