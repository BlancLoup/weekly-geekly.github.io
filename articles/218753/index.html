<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Variation in programming</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Still can not sleep, trying to comprehend the concept of covariance and contravariance? Feel how they breathe in your back, but when you turn around y...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Variation in programming</h1><div class="post__text post__text-html js-mediator-article"><p>  Still can not sleep, trying to comprehend the concept of covariance and contravariance?  Feel how they breathe in your back, but when you turn around you find nothing?  There is a solution! </p><br><p>  My name is Nikita, and today we will try to make the mechanism in the head work correctly.  You will find the most accessible consideration of the topic of variation in the examples.  Welcome under cat. </p><br><a name="habracut"></a><br><h4>  Briefing </h4><br><p>  The variation in this post is understood without regard to any programming language.  The examples in the practice section are written in pseudo-language (it miraculously turned out to be similar to C #) and therefore do not have to be compiled by your favorite compiler.  Let's get started </p><br><h4>  Terminology tricks </h4><br><p>  In the documentation, technical literature and other sources you could meet with various names for variance phenomena.  No need to get scared and confused. </p><br><p>  The terms covariance and covariance are equivalent (at least in programming).  Moreover, the terms contravariance and contravariance are also equivalent.  For example, the terms covariance and contravariance are used in Wikipedia and in Troelsen (in translation).  And the terms covariance and contravariance are found, for example, on MSDN and in Skit (in translation). </p><br><p>  In English, everything is easier - covariance and contravariance. </p><br><h4>  Theory </h4><br><p>  <i>Variance</i> is a transfer of the inheritance of the original types to the types derived from them.  Derived types are containers, delegates, generalizations, and not types associated by ancestor-child relationships.  Various types of variation are covariance, contravariance and invariance. </p><br><p>  <i>Covariance</i> is a transfer of the inheritance of the original types to the types derived from them in direct order. <br>  <i>Contravariance</i> is a transfer of the inheritance of the original types to the types derived from them in the reverse order. <br>  <i>Invariance</i> is a situation when inheritance of initial types is not transferred to derivatives. </p><br><p>  If derived types have covariance, they are said to be covariant to the original type.  If derivative types show contravariance, they are said to be contravariant to the original type.  If the derived types have neither the one nor the other, they are said to be invariant. </p><br><p>  That's all you need to know.  Of course, for those who first encounter variation, it is difficult to grasp.  Therefore, we consider specific examples. </p><br><h4>  Practice </h4><br><h6>  What is all this for? </h6><br><p>  The whole point of variation is the use of inheritance advantages in derived types.  It is known that if two types are connected by a parent-child relationship, then the child object can be stored in an ancestor-type variable.  In practice, this means that we can use descendant objects for any operations instead of ancestor objects.  Thus, you can write more flexible and short code to perform actions supported by different descendants with a common ancestor. </p><br><h6>  Source hierarchy and derived types </h6><br><p> To begin with we will describe type hierarchy with which we will operate.  At the top of the hierarchy we have a <code>Device</code> (device), the descendants of which are <code>Mouse</code> (mouse), <code>Keyboard</code> (keyboard).  <code>Mouse</code> in turn, also has descendants - <code>WiredMouse</code> (wired mouse), <code>WirelessMouse</code> (wireless mouse). </p><br><img src="https://habrastorage.org/getpro/habr/post_images/996/640/8fd/9966408fd577dda9ca21748c8430501f.jpg" title="Source hierarchy"><br><p>  Everyone loves containers.  Using their example, it is easiest to explain what is meant by derived types.  If we talk about lists as derived types, then for the type <code>Device</code> derivative will be <br>  <code>List&lt;Device&gt;</code> (list of devices).  Similarly, for the <code>Keyboard</code> type, the derivative is <code>List&lt;Keyboard&gt;</code> (the list of keyboards).  I think if there were doubts, now they are not. </p><br><h6>  Classical covariance </h6><br><p>  Covariance is also easier to study using containers.  To do this, select the part of the hierarchy (branch) - <code>Keyboard : Device</code> (the keyboard is a device, the keyboard is a special case of the device).  Again, take lists and build a covariant derivative branch - <code>List&lt;Keyboard&gt; : List&lt;Device&gt;</code> (the list of keyboards is a special case of the list of devices).  As you can see, inheritance passed in direct order. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/d0c/4b6/1dd/d0c4b61dd3efe7a883747edb17d91408.jpg" title="Covariance hierarchy"><br><p>  Consider the sample code.  There is a function that accepts the <code>List&lt;Device&gt;</code> list and performs some manipulations on them.  As you have already guessed, you can transfer the <code>List&lt;Keyboard&gt;</code> keyboards to this function: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoSmthWithDevices</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">List&lt;Device&gt; devices</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> } ... List&lt;Keyboard&gt; keyboards = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Keyboard&gt; { <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> }; DoSmthWithDevices(keyboards);</code> </pre> <br><h6>  Classical contravariance </h6><br><p>  Canonical for the study of contravariance is its consideration on the basis of delegates.  Suppose we have a generic delegate: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">delegate</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Action&lt;T&gt;(T something);</code> </pre> <br><p>  For the original <code>Device</code> type, the derivative will be <code>Action&lt;Device&gt;</code> , and for the <code>Keyboard</code> , <code>Action&lt;Keyboard&gt;</code> .  Received delegates can represent functions that perform some actions on the device or mouse, respectively.  For the <code>Keyboard : Device</code> branch, we construct a derivative contravariant branch - <code>Action&lt;Device&gt; : Action&lt;Keyboard&gt;</code> (the action on the device is a special case of the action on the keyboard - it sounds strange, but it is).  If you can press a key on the keyboard, this does not mean that you can press it on the device (it may not have a clue about what a key is).  But if you can connect the device, you can connect the keyboard using the same method (method, function).  As you can see, inheritance is transferred in the reverse order. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/b50/f45/e5a/b50f45e5a1c730f5cef4d6576535185e.jpg" title="Contravariant hierarchy"><br><p>  From the above, it is logical that if a function can perform something on the device, then it can also perform it on the keyboard.  This means we can pass the delegate object <code>Action&lt;Device&gt;</code> to the function that accepts the delegate object <code>Action&lt;Keyboard&gt;</code> .  Consider the code: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoSmthWithKeyboard</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action&lt;Keyboard&gt; actionWithKeyboard</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">/*  actionWithKeyboard   */</span></span> } ... Action&lt;Device&gt; actionWithDevice = device =&gt; device.PlugIn(); DoSmthWithKeyboard(actionWithDevice);</code> </pre> <br><h6>  Little invariance </h6><br><p>  If the derived types are invariant to the original types, then neither a covariant ( <code>List&lt;Keyboard&gt; : List&lt;Device&gt;</code> ) nor a contravariant ( <code>Action&lt;Device&gt; : Action&lt;Keyboard&gt;</code> ) branch is formed for the <code>Keyboard : Device</code> branch.  This means that there is no connection between derived types.  As you can see, inheritance is not transferred. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/b4b/ead/cf8/b4beadcf87472f1e1788f2954762de18.jpg" title="Hierarchy invariance"><br><h4>  What if? </h4><br><h6>  Unobvious covariance </h6><br><p>  Delegates of type <code>Action&lt;T&gt;</code> may be covariant.  This means that for the <code>Keyboard : Device</code> branch, a covariant branch is formed - <code>Action&lt;Keyboard&gt; : Action&lt;Device&gt;</code> .  Thus, in the function that accepts the object delegate <code>Action&lt;Device&gt;</code> , you can pass the object delegate <code>Action&lt;Keyboard&gt;</code> . </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoSmthWithDevice</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action&lt;Device&gt; actionWithDevice</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">/*  actionWithDevice   */</span></span> } ... Action&lt;Keyboard&gt; actionWithKeyboard = keyboard =&gt; ((Device)keyboard).PlugIn(); DoSmthWithDevice(actionWithKeyboard);</code> </pre> <br><h6>  Unobvious contravariance </h6><br><p>  Containers can be contravariant.  This means that for the <code>Keyboard : Device</code> branch a contravariant branch is formed - <code>List&lt;Device&gt; : List&lt;Keyboard&gt;</code> .  Thus, in a function that accepts <code>List&lt;Keyboard&gt;</code> , you can pass <code>List&lt;Device&gt;</code> : </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FillListWithKeyboards</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">List&lt;Keyboard&gt; keyboards</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> } ... List&lt;Devices&gt; devices = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Devices&gt;(); FillListWithKeyboards(devices);</code> </pre> <br><h6>  Sacred meaning </h6><br><p>  The above exotic types of variation have, perhaps, academic value.  It is difficult to come up with a real task, which is easier to solve with these kinds of opportunities.  It is worth remembering that covariance and contravariance can cause run-time errors.  To eliminate them, certain restrictions are required.  Compilers, as a rule, do not impose such restrictions. </p><br><h6>  Container Security </h6><br><p>  If the derived type is covariant, then for security, the container must be read only.  Otherwise, it remains possible to write to the <code>List&lt;Keyboard&gt;</code> an object of the wrong type ( <code>Device</code> , <code>Mouse</code> , etc.) by casting to the <code>List&lt;Device&gt;</code> : </p><br><pre> <code class="cs hljs">List&lt;Device&gt; devices = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Keyboard&gt;(); devices.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Device()); <span class="hljs-comment"><span class="hljs-comment">//   </span></span></code> </pre> <br><p>  If the derived type is contravariant, then for security, the container must be write only.  Otherwise, it remains possible to read from the <code>List&lt;Device&gt;</code> object of the wrong type ( <code>Keyboard</code> , <code>Mouse</code> and others) by casting it to the appropriate list ( <code>List&lt;Keyboard&gt;</code> , <code>List&lt;Mouse&gt;</code> and others): </p><br><pre> <code class="cs hljs">List&lt;Keyboard&gt; keyboards = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Device&gt;(); keyboards.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Keyboard()); keyboards[<span class="hljs-number"><span class="hljs-number">0</span></span>].PressSpace(); <span class="hljs-comment"><span class="hljs-comment">//   </span></span></code> </pre> <br><h6>  Double standards for delegates </h6><br><p>  For delegates, the covariance for the output value and contravariance for the input parameters (excluding transmission by reference) are reasonable for the delegates.  If these conditions are met, run-time errors do not occur. </p><br><h4>  Debriefing </h4><br><p>  The examples presented are sufficient to understand the principles of how variation works.  For information on its support for different types of your favorite language, look for the corresponding specification.  If something went wrong - close your eyes, exhale and drink tea.  After that, try again.  Thanks for attention. </p><br><h4>  UDP </h4><br><p>  Perhaps a more correct definition of variation is proposed by Eric Lippert.  Thanks to <a href="https://habrahabr.ru/users/alex_sik/" class="user_link">Alex_sik</a> for the <a href="http://blogs.msdn.com/b/ericlippert/archive/2009/11/30/what-s-the-difference-between-covariance-and-assignment-compatibility.aspx">link to the article</a> . </p><br><p>  <i>Compatibility assignment, assignment compatibility</i> is the ability to assign a value of a more particular type to a compatible variable of a more general type. <br>  <i>Variance</i> is the preservation of the compatibility of the assignment of the original types of derived types. <br>  <i>Covariance</i> is the preservation of the compatibility of the assignment of the original types of derivatives in the direct order. <br>  <i>Contravariance</i> is the preservation of the compatibility of the assignment of the original types of derivatives in the reverse order. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/218753/">https://habr.com/ru/post/218753/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../218743/index.html">How to use handlebars</a></li>
<li><a href="../218745/index.html">[video] How to avoid unplanned rollback: analysis of 7 real negotiation situations</a></li>
<li><a href="../218747/index.html">Solar charging for lithium battery</a></li>
<li><a href="../218749/index.html">JoysMaker R2 Black - 3D printer for the inexperienced</a></li>
<li><a href="../218751/index.html">We work asynchronously in PHP or the story of another chat</a></li>
<li><a href="../218757/index.html">Another migration of PROXMOX to softRAID1, but now already 3.2 and on GPT partitions, installing FreeNAS 9.2 on a virtual machine and forwarding a physical disk to it</a></li>
<li><a href="../218759/index.html">Windows command line subtleties</a></li>
<li><a href="../218761/index.html">Capture video in OpenGL applications using Intel INDE Media Pack</a></li>
<li><a href="../218763/index.html">The sound on the chip AY-3-8910 (or Yamaha YM2149F) comes from the ZX Spectrum on the PC via LPT-port</a></li>
<li><a href="../218765/index.html">Have you seen your printed circuit boards under the microscope?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>