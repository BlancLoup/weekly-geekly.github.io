<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Multisiting in Drupal</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It seemed to me strange that this topic was practically not covered in Habr√© and I will try to correct this situation a little. 

 I am not a proponen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Multisiting in Drupal</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/14d4af5b/dca8cdf2/a7f592fa/e977a2f5.jpg"><br>  It seemed to me strange that this topic was practically not covered in Habr√© and I will try to correct this situation a little. <br><br>  I am not a proponent of Anglicism, but in our language there is not even a similar term.  In short, multisiting can be defined as the ability to use engine files for different sites.  I will not understand the etymology of this word, but I dare to suggest that its appearance was associated with Drupal.  One of the most common examples of multisiting may be the use of a common user database on several sites.  In Drupal, multisiting is implemented attractively, in terms of simplicity and convenience, which I decided to write about. <a name="habracut"></a><br><br><h4>  Instead of intro </h4><br>  In my opinion, Drupal is plasticine, from which, if desired, you can make very nice little things.  Although my experience with Drupal is not so great, but so far I haven‚Äôt happened to meet a task that I couldn‚Äôt have solved with its help.  I have to admit that if the level of knowledge / motivation / experience of the developer is small, then this clay will most likely have a handful of well-known non-sinking mass, but this is not the case. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  How it's done? </h4><br>  It is necessary to note the logical literacy of the construction of the Drupal folder structure.  The kernel is separated from its own code, the entire code is separated from the markup.  Multisiting is provided by drupal "out of the box", for which there is a folder called sites in the root directory.  This folder should contain the settings files of sites that are in conjunction with the main site.  People who have installed Drupal at least once know that Drupal requires creating settings.php file in the folder <br><br> <code>sites/default</code> <br> <br>  In this case, the name of the folder 'default' defines its belonging to the "main" site. <br>  In the case when you need to organize multisiting, folders with domain names are created next to 'default' and the settings.php files are copied from sites / all / default / default.settings.php <br><br> <code>sites/first.example.ru/settings.php <br> sites/second.example.ru/settings.php <br> . <br> . <br> . <br> sites/n.example.ru/settings.php</code> <br> <br>  which specify the specific settings for this site.  Themes and modules that need to be made available only for the specified site are placed in the appropriate folders. <br><br> <code>sites/first.example.ru/themes/ <br> sites/first.example.ru/modules/</code> <br> <br>  Themes and modules located in the folder <br><br> <code>sites/all</code> <br> <br>  will be available to all sites in the multisiting bundle.  Thus, you can significantly reduce the time to update them. <br><br>  <b>Important!</b>  Document root for all sites in the bundle should be one - the root directory with the drupal installed (where index.php is located).  A variant of the symlink to this folder is also possible. <br><br><h4>  How to name folders? </h4><br>  In the process of searching for settings.php files, the drupal ‚Äúcuts off‚Äù the names of subdomains from left to right, and the names of subfolders from right to left.  From the example it should be clear what is meant by this. <br><br>  Suppose we have a site set to <br><br> <code><a href="http://www.example.ru/mysite/test/"></a> www.example.ru/mysite/test</code> <br> <br>  Drupal will look for the settings.php file in the following folders in the specified sequence: <br><br> <code>1. sites/www.example.ru.mysite.test <br> 2. sites/example.ru.mysite.test <br> 3. sites/ru.mysite.test <br> <br> 4. sites/www.example.ru.mysite <br> 5. sites/example.ru.mysite <br> 6. sites/ru.mysite <br> <br> 7. sites/www.example.ru <br> 8. sites/example.ru <br> 9. sites/ru <br> <br> 10. sites/default</code> <br> <br>  The first file found will be used, the rest are ignored.  From the example it is clear that for the work of the site example.ru it is enough to place the settings.php in <br><br> <code>sites/example.ru/settings.php</code> <br> <br>  and don't need to duplicate it in <br><br> <code>sites/www.example.ru/settings.php</code> <br> <br>  because  and on the request through example.ru, and on the request of <a href="http://www.example.ru/">www.example.ru</a> Drupal will find the same file. <br><br>  In case it is necessary to bind a site installed on a non-standard port, the port is indicated as an additional subdomain.  So, for the site <br><br> <code><a href="http://www.example.ru/"></a> www.example.ru:8080/mysite/test/</code> <br> <br>  folder with settings.php file should be <br><br> <code>sites/8080.www.example.ru.mysite.test</code> <br> <br>  From myself I would add that I would not advise linking sites that are installed in a subfolder, since  their correct functioning is not guaranteed (as stated in the documentation).  There are, of course, recommendations for correcting possible errors, such as creating the document root symlink for <a href="http://www.example.ru.mysite/">www.example.ru.mysite</a> to document root for <a href="http://www.example.ru/">www.example.ru</a> : <br><br> <code><a href="http://www.example.ru/"></a> ( document root  www.example.ru)</code> <br> <code>ln -s . mysite</code> <br> <br>  but this is not a panacea and you need to choose this method only when absolutely necessary. <br><br><h4>  What to change in settings.php? </h4><br><h5>  1. If we want to use completely independent sites </h5><br>  then in settings.php in $ db_url we specify a separate database.  The user may also be different.  The presence or absence of the prefix here does not matter, but, again, I add on my own, assigning prefixes to the site database is, although not great, but a tribute to security and should not be neglected. <br><br><h5>  2. If we want to use sites with a common database or with common tables </h5><br><h6>  a.  if sites will use the same database </h6><br>  you need to use different prefixes for unique tables and the same for general ones.  For example, common_ is designed as a prefix for common user tables and profiles, default_ for own tables of the main site's database, and first_ for own tables of the site's first.example.ru database. <br><br>  In sites / first.ru / settings.php we write: <br><br> <code>// $db_prefix = ''; <br> <br> $db_prefix = array( <br> "default" =&gt; "first_", <br> "users" =&gt; "common_", <br> "sessions" =&gt; "common_", <br> "authmap" =&gt; "common_", <br> "profile_fields" =&gt; "common_", <br> "profile_values" =&gt; "common_", <br> ); <br></code> <br><br>  In sites / default / settings.php <br><br> <code>// $db_prefix = ''; <br> <br> $db_prefix = array( <br> "default" =&gt; "default_", <br> "users" =&gt; "common_", <br> "sessions" =&gt; "common_", <br> "authmap" =&gt; "common_", <br> "profile_fields" =&gt; "common_", <br> "profile_values" =&gt; "common_", <br> ); <br></code> <br>  Thus, the site first.example.ru will use a common c base of example.ru base of users and their profiles.  But do not get involved in this way, because  on average, with each new site in the bundle, the number of tables will increase by 60-70.  It is easy to calculate what will happen to the database already at ten sites.  Add to this the dependence of all sites on the correct operation of a single database. <br><br><h6>  b.  if sites will use different databases and some common tables. </h6><br>  Suppose we need to use: <br><ul><li>  common views (created by the views module) </li><li>  common database of users and their profiles for example.ru and fisrt.example.ru sites </li></ul><br>  and suppose that: <br><ul><li>  database name for example.ru - example </li><li>  table prefix for example.ru - example_, </li><li>  database name for first_example.com - first </li><li>  The table prefix for fisrt.example.com is first_. </li></ul><br>  In sites / first.ru / settings.php we write: <br><br> <code>// $db_prefix = ''; <br> <br> $db_prefix = array( <br> "default" =&gt; "first_", <br> "users" =&gt; "example.example_", <br> "sessions" =&gt; "example.example_", <br> "authmap" =&gt; "example.example_", <br> "profile_fields" =&gt; "example.example_", <br> "profile_values" =&gt; "example.example_", <br> "views_display" =&gt; "example.example_", <br> "views_view" =&gt; "example.example_", <br> <br> );</code> <br> <br>  In sites / default / settings.php <br><br> <code>$db_prefix = 'example_';</code> <br> <br>  Thus, for first.example.ru data about views and users will be taken from the example database, and all the rest - from the example.ru database <br><br>  <b>Important!</b>  The point here is interpreted by the drupal as the end of the database name, so you should not create a prefix with a dot. <br><br><h4>  Conclusion </h4><br>  Drupal Multisiting is fairly easy to configure and works stably.  I did not have to deal with problems, despite the fact that in order to accomplish the task I needed to combine the views_display, views_view, blocks, and blocks_roles tables, while Vlad Savitsky <a href="http://habrahabr.ru/blogs/drupal/76350/">classified</a> blocks * as tables, which cannot be joined, and views_ * as tables, which need to be combined with great care. <br>  Max Kirilenko also <a href="http://www.razgonka.ru/info/39">believes</a> that ‚ÄúMultisitebook on the general tables is Drupal's undocumented opportunity, it has more problems than advantages‚Äù.  But his article refers to Drupal 5, and perhaps this is the reason. <br>  Waiting for comments on this. <br><br><h6>  Two useful modules on this topic: </h6><br>  <a href="http://drupal.org/project/multisite_search">Multisite search</a> - allows you to index the contents of sites in a bundle and search them <br>  <a href="http://drupal.org/project/multisite_login">Multisite login</a> - allows you to save authorization for all sites in a bundle, even on different domains <br><br>  <b>UPD:</b> <a href="https://habrahabr.ru/users/pvasili/" class="user_link">pvasili</a> advises to be careful when updating modules in the / sites / all folder (be sure to run update.php on all domains that use this folder). <br>  <b>UPD:</b> At first, the drupal will look for the module in sites / example.ru / modules, and then in / sites / all / modules <br>  <b>UPD:</b> To update via drush <a href="https://habrahabr.ru/users/andyceo/" class="user_link">andyceo</a> wrote a <a href="">script</a> <br>  <b>UPD:</b> <a href="https://habrahabr.ru/users/shuba/" class="user_link">shuba</a> <a href="http://habrahabr.ru/blogs/drupal/133086/">described a</a> useful innovation for Drupal 7 </div><p>Source: <a href="https://habr.com/ru/post/133086/">https://habr.com/ru/post/133086/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../133081/index.html">LG GT540: Increase partition size / data due to / system</a></li>
<li><a href="../133082/index.html">http: // (Any_word) .jpg.to</a></li>
<li><a href="../133083/index.html">We are looking for unused PHP extensions</a></li>
<li><a href="../133084/index.html">C ++ Variadic templates. Currying and partial application</a></li>
<li><a href="../133085/index.html">Sending SMS from 3G / GSM modem</a></li>
<li><a href="../133087/index.html">HelloWorld - is it easy?</a></li>
<li><a href="../133088/index.html">Arduino in Chinese or Arduinski vernier caliper</a></li>
<li><a href="../133089/index.html">Lean startup on the turn</a></li>
<li><a href="../133090/index.html">Droider Show # 16. Smartphone for adults</a></li>
<li><a href="../133092/index.html">The birth of a startup. From idea to realization</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>