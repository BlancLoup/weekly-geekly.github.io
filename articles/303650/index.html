<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introduction to ReactiveUI: we pump properties in ViewModel</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In my C # projects, when implementing GUIs, I often use the ReactiveUI framework. 

 ReactiveUI is a full-fledged MVVM framework: bindings, routing, m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introduction to ReactiveUI: we pump properties in ViewModel</h1><div class="post__text post__text-html js-mediator-article">  In my C # projects, when implementing GUIs, I often use the ReactiveUI framework. <br><br>  <a href="http://reactiveui.net/">ReactiveUI</a> is a full-fledged MVVM framework: bindings, routing, message bus, commands and other words that are in the description of almost any MVVM framework, there is here.  It can be used almost anywhere where .NET is: WPF, Windows Forms, UWP, Windows Phone 8, Windows Store, Xamarin. <br><br>  Of course, if you already have experience with it, you will hardly find anything new for yourself here.  In this article, we will get acquainted with its basic capabilities regarding working with properties in ViewModel, and in the future, I hope, we will get to other, more interesting and complex features. <br><a name="habracut"></a><br><h4>  Introduction </h4><br>  ReactiveUI is built around a reactive programming model and uses <a href="http://reactivex.io/">Reactive Extensions</a> (Rx).  However, I don‚Äôt set myself the goals to write a guide on reactive programming, only if necessary I will explain how it works.  Very soon you will see for yourself that to use the basic features you don‚Äôt even need to understand what this beast is: reactive programming.  Although you already know him, events are just that.  Usually, even in places where ‚Äúreactivity‚Äù is manifested, the code can be quite easy to read and understand what will happen.  Of course, if you use the library (and Reactive Extensions) to its fullest, you will have to seriously get acquainted with the reactive model, but for the time being we will go over the basics. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Personally, besides the features of ReactiveUI, I like its unobtrusiveness: you can use only a subset of its features, not paying attention to others and not adjusting your application to the framework.  Even, for example, apply it side by side with other frameworks, without running into incompatibility.  Pretty comfortable. <br><br>  There is a fly in the ointment.  Her name is documentation.  She is very bad.  There is something <a href="https://github.com/reactiveui/ReactiveUI/tree/master/docs">here</a> , but many pages are just stubs, and everything is very dry.  There is documentation <a href="http://docs.reactiveui.net/en/">here</a> , but the problem is the same: stubs, some copy-paste from the developers' chat, links to sample applications in various sources, descriptions of features of a future version, etc.  Developers are quite active in answering questions on StackOverflow, but many questions would not exist if the documentation were normal.  However, what is not, is not. <br><br><h4>  What will be discussed </h4><br>  Let us turn to the specifics.  This article will talk about a typical problem with properties in ViewModels, and how it is solved in ReactiveUI.  Of course, this problem is the interface INotifyPropertyChanged;  a problem that is somehow solved in different ways. <br><br>  Let's see the classic implementation: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _firstName; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FirstName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _firstName; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == _firstName) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; _firstName = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> PropertyChangedEventHandler PropertyChanged; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPropertyChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[CallerMemberName] </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> propertyName = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span> { PropertyChanged?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertyChangedEventArgs(propertyName)); }</code> </pre> <br>  What problems?  Yes, like no.  Well, three lines in the setter, never mind.  In general, I usually write auto-customization and do auto-factoring with resharper in a reduced form, with a minimum of gestures. <br><br>  But there are still problems.  What if you need to synchronize the FullName property when you change FirstName?  There are two options: either this is a calculated property and you just need to generate an event about its change, or it should be implemented in the same way as FirstName, and it should be changed.  In the first variant, the FirstName property setter will generate the necessary notification: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == _firstName) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; _firstName = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); OnPropertyChanged(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(FullName)); }</code> </pre><br>  In the second, the property will be updated, and it will generate the notification itself: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == _firstName) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; _firstName = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); UpdateFullName(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateFullName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { FullName = <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{FirstName}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{LastName}</span></span></span><span class="hljs-string">"</span></span>; }</code> </pre><br>  It still looks relatively simple, but this is the road to hell.  There is also LastName, which must also change FullName.  Then we will fasten the search by the entered name, and everything will become even more difficult.  And then, and more ... And we find ourselves in a situation where there are continuous event generations in the code, a lot of actions are started from the setters, some errors occur because not all possible execution paths are taken into account or something is caused not in tom okay and other nightmares. <br><br>  And in general, why does the FirstName property know that FullName is somewhere, and that it is necessary to run a search by name?  This is not his concern.  It should change and report it.  Yes, you can do it, and to call additional actions, you can cling to your own PropertyChanged event, but there is little joy in it - you can sort these events with the name of the changed property in the line. <br>  Yes, and the simple implementation given at the very beginning is still annoying: almost the same code, which you still have to read, into which an error can creep in ... <br><br><h4>  What does ReactiveUI offer us? </h4><br>  Declarativity and putting dependencies in order. <br><br>  Install it from Nuget.  We are looking for "reactiveui", I put the currently relevant version 6.5.0.  Now let's follow the list of available updates and update the Splat that appeared there to the latest version (now 1.6.2).  Without this, at one moment everything fell. <br><br>  Now that we have installed the framework, we will try to improve our first example a little.  First we inherit from ReactiveObject and rewrite the property setters: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PersonViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">ReactiveObject</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _firstName; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FirstName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _firstName; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.RaiseAndSetIfChanged(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> _firstName, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); UpdateFullName(); } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _lastName; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> LastName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _lastName; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.RaiseAndSetIfChanged(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> _lastName, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); UpdateFullName(); } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _fullName; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FullName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _fullName; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.RaiseAndSetIfChanged(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> _fullName, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateFullName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { FullName = <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{FirstName}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{LastName}</span></span></span><span class="hljs-string">"</span></span>; } }</code> </pre><br>  Not a lot yet.  Such RaiseAndSetIfChanged could be written by hand.  But it is necessary to immediately say that ReactiveObject implements not only INPC: <br><br><img src="https://habrastorage.org/files/523/031/f77/523031f77fe9417cb925dd63f8647213.png"><br><br>  Here we see, in particular, the implementation of INotifyPropertyChanged, INotifyPropertyChanging and some three IObservable &lt;&gt;. <br><br><h5>  Read more about the reactive model </h5><br>  Here it is worth saying a few words about what IObservable is.  These are reactive (push-based) notification providers.  The principle is quite simple: in the classical model (pull-based) we ourselves run to the data providers and poll them for updates.  In reactive - we subscribe to such a channel of notifications and do not worry about the survey, all updates will come to us by ourselves: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IObservable</span></span>&lt;<span class="hljs-title"><span class="hljs-title">out</span></span> <span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-function"><span class="hljs-function">IDisposable </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Subscribe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IObserver&lt;T&gt; observer</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre><br>  We act as an IObserver &lt;&gt; - observer: <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IObserver</span></span>&lt;<span class="hljs-title"><span class="hljs-title">in</span></span> <span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNext</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnError</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Exception error</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnCompleted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre><br>  OnNext will be called when the next notification appears.  OnError - if an error occurs.  OnCompleted - when notifications are over. <br>  At any time, you can unsubscribe from new notifications: for this, the Subscribe method returns a certain IDisposable.  You call Dispose - and no new notifications will be received. <br><br>  Now, if we subscribe to Changed and change FirstName, the OnNext method will be called, and the parameters will contain the same information as in the event PropertyChanged (that is, the reference to the sender and the name of the property). <br><br>  And also here we have many methods at our disposal, some of which came from LINQ.  Select we have already tried.  What else can be done?  Filter the flow of notifications using Where, make Distinct recurring notifications or DistinctUntilChanged to avoid identical notifications going in a row, use Take, Skip and other LINQ methods. <br><br><div class="spoiler">  <b class="spoiler_title">Let's look at an example of using Rx</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> observable = Enumerable.Range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>).ToObservable(); observable.Subscribe(Observer.Create&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;( i =&gt; Console.WriteLine(i), e =&gt; Console.WriteLine(e), () =&gt; Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Taking numbers: complete"</span></span>) )); <span class="hljs-comment"><span class="hljs-comment">//1 //2 //3 //4 //Taking numbers: complete observable.Select(i =&gt; i*i).Subscribe(Observer.Create&lt;int&gt;( i =&gt; Console.WriteLine(i), e =&gt; Console.WriteLine(e), () =&gt; Console.WriteLine("Taking squares: complete") )); //1 //4 //9 //16 //Taking squares: complete observable.Take(2).Subscribe(Observer.Create&lt;int&gt;( i =&gt; Console.WriteLine(i), e =&gt; Console.WriteLine(e), () =&gt; Console.WriteLine("Taking two items: complete") )); //1 //2 //Taking two items: complete observable.Where(i =&gt; i % 2 != 0).Subscribe(Observer.Create&lt;int&gt;( i =&gt; Console.WriteLine(i), e =&gt; Console.WriteLine(e), () =&gt; Console.WriteLine("Taking odd numbers: complete") )); //1 //3 //Taking odd numbers: complete</span></span></code> </pre><br></div></div><br>  Here you can move all these notifications in time and see what works. <br><br>  It turned out quite briefly, but I think so far this is enough.  More can be read, for example, <a href="https://nesteruk.wordpress.com/2010/03/18/intro-to-rx/">here</a> or <a href="http://sergeyteplyakov.blogspot.ru/2010/11/blog-post.html">here</a> . <br><br><h4>  Associate properties with ReactiveUI </h4><br>  Let's return to the improvement of our problem code.  We put in order dependencies: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PersonViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">ReactiveObject</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _firstName; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FirstName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _firstName; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.RaiseAndSetIfChanged(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> _firstName, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _lastName; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> LastName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _lastName; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.RaiseAndSetIfChanged(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> _lastName, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _fullName; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FullName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _fullName; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.RaiseAndSetIfChanged(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> _fullName, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PersonViewModel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> firstName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lastName</span></span></span><span class="hljs-function">)</span></span> { _firstName = firstName; _lastName = lastName; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.WhenAnyValue(vm =&gt; vm.FirstName, vm =&gt; vm.LastName).Subscribe(_ =&gt; UpdateFullName()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateFullName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { FullName = <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{FirstName}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{LastName}</span></span></span><span class="hljs-string">"</span></span>; } }</code> </pre><br>  See, the properties no longer contain anything extra, all dependencies are described in one place: in the constructor.  Here we say to subscribe to the changes FirstName and LastName, and when something changes - call UpdateFullName ().  By the way, it can be a little different: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PersonViewModel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">...</span></span></span><span class="hljs-function">)</span></span> { ... <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.WhenAnyValue(vm =&gt; vm.FirstName, vm =&gt; vm.LastName).Subscribe(t =&gt; UpdateFullName(t)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateFullName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Tuple&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; tuple</span></span></span><span class="hljs-function">)</span></span> { FullName = <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{tuple.Item1}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{tuple.Item2}</span></span></span><span class="hljs-string">"</span></span>; }</code> </pre><br>  The notification parameter is a tuple in which the current property values ‚Äã‚Äãlie.  We can transfer them to our full name update method.  Although the update method is generally possible to remove and do so: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.WhenAnyValue(vm =&gt; vm.FirstName, vm =&gt; vm.LastName).Subscribe(t =&gt; { FullName = <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{t.Item1}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{t.Item2}</span></span></span><span class="hljs-string">"</span></span>; });</code> </pre><br>  Now let's look at FullName again: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _fullName; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FullName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _fullName; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.RaiseAndSetIfChanged(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> _fullName, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } }</code> </pre><br>  Why do we supposedly change the property, when in fact it should be completely dependent on the parts of the name and be read-only?  Fix this: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ObservableAsPropertyHelper&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; _fullName; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FullName =&gt; _fullName.Value; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PersonViewModel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">...</span></span></span><span class="hljs-function">)</span></span> { ... _fullName = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.WhenAnyValue(vm =&gt; vm.FirstName, vm =&gt; vm.LastName) .Select(t =&gt; <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{t.Item1}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{t.Item2}</span></span></span><span class="hljs-string">"</span></span>) .ToProperty(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, vm =&gt; vm.FullName); }</code> </pre><br>  ObservableAsPropertyHelper &lt;&gt; helps to implement output properties.  Inside there is an IObservable, the property becomes read-only, but when changes are made, notifications are generated. <br><br>  By the way, besides what came from LINQ, there are other interesting methods for IObservable &lt;&gt;, for example, Throttle: <br><br><pre> <code class="cs hljs">_fullName = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.WhenAnyValue(vm =&gt; vm.FirstName, vm =&gt; vm.LastName) .Select(t =&gt; <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{t.Item1}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{t.Item2}</span></span></span><span class="hljs-string">"</span></span>) .Throttle(TimeSpan.FromSeconds(<span class="hljs-number"><span class="hljs-number">1</span></span>)) .ToProperty(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, vm =&gt; vm.FullName);</code> </pre><br>  Notifications are dropped here, for a second after which the following has followed.  That is, as long as the user types something in the name field, FullName will not change.  When he stops for at least a second, the full name is updated. <br><br><h4>  Result </h4><br><div class="spoiler">  <b class="spoiler_title">Summary code</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Reactive.Linq; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ReactiveUI.Guide.ViewModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PersonViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">ReactiveObject</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _firstName; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FirstName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _firstName; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.RaiseAndSetIfChanged(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> _firstName, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _lastName; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> LastName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _lastName; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.RaiseAndSetIfChanged(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> _lastName, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ObservableAsPropertyHelper&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; _fullName; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FullName =&gt; _fullName.Value; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PersonViewModel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> firstName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lastName</span></span></span><span class="hljs-function">)</span></span> { _firstName = firstName; _lastName = lastName; _fullName = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.WhenAnyValue(vm =&gt; vm.FirstName, vm =&gt; vm.LastName) .Select(t =&gt; <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{t.Item1}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{t.Item2}</span></span></span><span class="hljs-string">"</span></span>) .ToProperty(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, vm =&gt; vm.FullName); } } }</code> </pre><br></div></div><br>  We received ViewModel in which communications between properties are described declaratively, in one place.  It seems to me a cool opportunity: you do not need to shovel all the code, trying to understand what will happen when you change certain properties.  No side effects - it's pretty obvious.  Of course, the result of all these manipulations is some performance degradation.  Although this problem should not seriously arise: it is not the core of the system, which should be as productive as possible, but the ViewModel layer. <br><br>  I hope someone will find this article useful and interesting, and you will try to use the described technologies in your projects.  In the future, I hope to describe such things as reactive collections and teams, and then get to more complex examples, which show the interaction between the View and ViewModel layers, routing and user interaction. <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/303650/">https://habr.com/ru/post/303650/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../303638/index.html">Joker 2016 Java Conference: Peter, October 14-15</a></li>
<li><a href="../303640/index.html">Channels Philosophy</a></li>
<li><a href="../303644/index.html">How we promoted the website of the veterinary clinic in the TOP</a></li>
<li><a href="../303646/index.html">BizTalk Server 2010 Support: Tips and Tricks</a></li>
<li><a href="../303648/index.html">Maven vs Gradle? This is a wrong question.</a></li>
<li><a href="../303652/index.html">Sketchode: a side view</a></li>
<li><a href="../303654/index.html">Interview with python-developer Alexander Koshkin about the Python language and life in the USA</a></li>
<li><a href="../303656/index.html">Russian social media - the most important trends in 2016</a></li>
<li><a href="../303658/index.html">DConf2016</a></li>
<li><a href="../303660/index.html">JS Programming Contest: Word Classifier (Final Results)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>