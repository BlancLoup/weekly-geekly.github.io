<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DB. Directories. Globals. Nested structures. Living examples</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Picture to attract attention showing an example of the upcoming "nesting" camera with a parachute in a satchel. 

 Part 1 
 Part 2 
 Part 3 

 Last ti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DB. Directories. Globals. Nested structures. Living examples</h1><div class="post__text post__text-html js-mediator-article">  <i>Picture to attract attention showing an example of the upcoming <b>"nesting"</b> camera with a parachute in a satchel.</i> <br><img src="https://habrastorage.org/storage2/082/fe4/0ab/082fe40ab657d34379e7b41a99d9e78d.jpg" align="left"><br>  <a href="http://habrahabr.ru/company/intersystems/blog/175773/">Part 1</a> <br>  <a href="http://habrahabr.ru/company/intersystems/blog/177319/">Part 2</a> <br>  <a href="http://habrahabr.ru/post/178563/">Part 3</a> <br><br>  Last time we stopped at the fact that we have a <a href="http://habrahabr.ru/post/178563/"><b>create ()</b></a> method, which, based on the global rule <a href="http://habrahabr.ru/post/178563/"><b>^ RuleDictionary,</b></a> creates directory elements.  We have analyzed the example of creating elements of a simple, one-level directory.  Today, we will look at how nested structures can be created using our globals and methods. <br><br>  In <a href="http://habrahabr.ru/post/178563/">the program code</a> , the <i>transparent</i> variables <b>t</b> and <b>map</b> were used, which are not explicitly passed to the methods, but are available inside them.  I was told that this is not the best way to demonstrate the work, especially given that for most, the syntax of Cach√© Object Script is new.  Therefore, before proceeding to the nested structures, we make some changes to the program. <hr><br><a name="habracut"></a><a name="macros"></a><br><h4>  Macros </h4><br>  Macros allow you to set pseudonyms (other names) to constants, global and local variables, individual pieces of code, and more.  The advantage of using macros is that if you change the actual location of your data (the name of the namespace, global, etc.), you don‚Äôt need to change anything in the program code, you just need to change one macro (in the inc file), recompile the project, and everything will work with new names.  Also, the use of macros can reduce the recording without losing comprehension.  The macro is declared the service word <b>#define</b> , then the name of the macro is transmitted through the space, another space is indicated by what this macro means.  Macros can contain other macros within themselves, the main thing is that they are defined earlier.  Parameters can be passed to macros (macro parameters start with a <b>%</b> ). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>#define defNameSpace "MONTOLOGY"</b> <br><br>  This macro creates an alias, instead of <b>‚ÄúMONTOLOGY‚Äù</b> - now we can write <b>$$$ defNameSpace</b> .  Three dollars means that the macro was created by the developer (not system).  Despite the fact that <b>$$$ defNameSpace</b> contains more characters and less clarity than <b>‚ÄúMONTOLOGY</b> ‚Äù, this macro will be very useful to us, as it will be used in other macros, and in the program code it will practically not be encountered. <br><br>  Suppose we have the following dictionary.inc file <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#;     #define defNameSpace "MONTOLOGY" #;    #define dData ^|$$$defNameSpace|Dictionary #;    #define dName ^|$$$defNameSpace|NameDictionaryElement #;    #define dIndex ^|$$$defNameSpace|IndexDictionary #;   #define dRefs ^|$$$defNameSpace|RefsDictionary #;    #define dMaxID $increment($$$dData("MaxID")) #;   #define dRule ^|$$$defNameSpace|RuleDictionary #;      #define dDTO ^|$$$defNameSpace|tmwOntology #;        #define getDTOin(%param,%def) $get($$$dDTO($job,"in",%param),%def) #;        #define setDTOproc(%param,%val) set $$$dDTO($job,"proc",%param)=%val #;        #define getDTOproc(%param,%def) $get($$$dDTO($job,"proc",%param),%def) #;        #define setDTOout(%param,%val) set $$$dDTO($job,"out",%param)=%val #;        #define getDTOout(%param,%def) $get($$$dDTO($job,"out",%param),%def) #;          #define getDTOname(%lang) $get($$$dDTO($job,"in","nameList",%lang))</span></span></code> </pre> <br>  Now, in order to access the global: <b>^ | "MONTOLOGY" | IndexDictionary</b> in the program code, you can write just <b>$$$ dIndex</b> .  Pay attention to the <b>$$$ dMaxID</b> macro: it performs an increment operation.  The compiler will simply go through the entire <b>Dictionary</b> program and replace all the macros with what they actually mean.  Perform a normal text replacement.  Macro <b>$$$ dDTO</b> (dictionary Data Transfer Object) - we will use instead of the transparent variable <b>map</b> to transfer parameters between subroutines.  <a href=""><b>$ job</b></a> is a system variable, inside which the current process number is stored.  That is, we assume that the global <b>^ | "MONTOLOGY" | tmwOntology</b> , available under the <b>$$$ dDTO</b> macro, can simultaneously run several processes.  Each of them will refer to its <b>$$$ dDTO ($ job)</b> index, and further the following service branches will be used: <br><br><ul><li>  <b>$$$ dDTO ($ job, "in")</b> - input parameter branch </li><li>  <b>$$$ dDTO ($ job, "proc")</b> - processing parameters branch </li><li>  <b>$$$ dDTO ($ job, "out")</b> - output parameter branch </li></ul><br>  Our globals, from past articles, inside the program code are available in the following macros: <br><ul><li>  <a href="http://habrahabr.ru/company/intersystems/blog/175773/"><b>^ Dictionary</b></a> - <b>$$$ dData</b> </li><li>  <a href="http://habrahabr.ru/company/intersystems/blog/175773/"><b>^ NameDictionaryElement</b></a> - <b>$$$ dName</b> </li><li>  <a href="http://habrahabr.ru/company/intersystems/blog/177319/"><b>^ IndexDictionary</b></a> - <b>$$$ dIndex</b> </li><li>  <a href="http://habrahabr.ru/company/intersystems/blog/177319/"><b>^ RefsDictionary</b></a> - <b>$$$ dRefs</b> </li><li>  <a href="http://habrahabr.ru/post/178563/"><b>^ RuleDictionary</b></a> - <b>$$$ dRule</b> </li></ul><br>  For example, let's rewrite the first method of the <b>Dictionary</b> program using macros <br><br>  Was (without macros): <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#; -------------------------------------------------------------------------------------------------- #;   #; -------------------------------------------------------------------------------------------------- Dictionary #; -------------------------------------------------------------------------------------------------- #;   . #; -------------------------------------------------------------------------------------------------- retrieve(id,lang="ru",version=0) quit $get(^NameDictionaryElement(id,lang,version),"") #; --------------------------------------------------------------------------------------------------</span></span></code> </pre><br>  It became (with macros): <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#; -------------------------------------------------------------------------------------------------- #;    Dictionary.inc,   (inc) -      #include Dictionary #; -------------------------------------------------------------------------------------------------- #;   #; -------------------------------------------------------------------------------------------------- Dictionary #; -------------------------------------------------------------------------------------------------- #;   . #; -------------------------------------------------------------------------------------------------- retrieve(id,lang="ru",version=0) quit $get($$$dName(id,lang,version),"") #; --------------------------------------------------------------------------------------------------</span></span></code> </pre><br>  Let's transform all the code of <a href="http://habrahabr.ru/post/178563/">our program</a> taking into account the use of macros and without the use of transparent variables. <br><br><div class="spoiler">  <b class="spoiler_title">Reformed Dictionary Program</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#; -------------------------------------------------------------------------------------------------- #;    Dictionary.inc,   (inc) -      #include Dictionary #; -------------------------------------------------------------------------------------------------- #;   #; -------------------------------------------------------------------------------------------------- Dictionary #; -------------------------------------------------------------------------------------------------- #;   . #; -------------------------------------------------------------------------------------------------- retrieve(id,lang="ru",version=0) quit $get($$$dName(id,lang,version),"") #; -------------------------------------------------------------------------------------------------- #;      . #; -------------------------------------------------------------------------------------------------- retrieveListByIndex(ontology,type,index,value,str="",lang="ru") #;     ,       set str=$zconvert(str,"L") set id="" for { #;  ()    set id=$order($$$dIndex(ontology,type,index,value,id)) #;  ,        quit:id="" #;   set name=$$retrieve(id,lang) #;      str if $extract($zconvert(name,"L"),1,$length(str))=str { #;  (  ) write id_" "_name,! } } quit #; -------------------------------------------------------------------------------------------------- #;   . #;         . #; -------------------------------------------------------------------------------------------------- create() #;     kill $$$dDTO($job,"out") #;     t #;         create new t #;      set t("err")=$$check("create") #; ,    if t("err")&lt;0 { quit t("err") } st("ontology")=$$$getDTOin("ontology","") st("type")=$$$getDTOin("type","") st("id")=$$$getDTOproc("id","") #;   "UpdateTime" do setProperty(t("ontology"),t("type"),"UpdateTime",$horolog,t("id"),"false") #;   "uid" do setProperty(t("ontology"),t("type"),"uid",$$$getDTOin("uid",888),t("id"),"true") set t("lang")="" for { #;    (     ) set t("lang")=$order($$$dDTO($job,"in","nameList",t("lang"))) #;   ,     quit:t("lang")="" #;      set t("name")=$get($$$dDTO($job,"in","nameList",t("lang")),"") #;      do setName(t("ontology"),t("type"),t("lang"),t("name"),t("id")) } #;          do saveOntoAndTypeID(t("id"),t("ontology"),t("type")) #;         do saveElementPath(t("id"),$$$getDTOproc("path","")) #;         $$$setDTOout("id",t("id")) #;     kill $$$dDTO($job,"in") #;     kill $$$dDTO($job,"porc") #;     quit t("id") #; -------------------------------------------------------------------------------------------------- #;  . #;    ^RuleDictionary    . #; -------------------------------------------------------------------------------------------------- check(action)private #;     check new check #;        action set check=$case(action,"create":$$checkCreate(),"update":$$checkUpdate(),"delete":$$checkDelete(),:-1) #;   quit:check&lt;0 check #; ,      "check",        if $data($$$dRule($$$getDTOin("ontology",""),$$$getDTOin("type",""),action,"check")) { #;  check("map")        set check("map")=$name($$$dRule($$$getDTOin("ontology",""),$$$getDTOin("type",""),action,"check")) } else { #;  check("map")              set check("map")=$name($$$dRule("SimpleOntology","SimpleType",action,"check")) } set check("i")="" for { #;     set check("i")=$order(@check("map")@(check("i"))) #;   ,     quit:check("i")="" #;     xecute $get(@check("map")@(check("i"))) #;   ,     quit:check&lt;0 } #;    quit check #; -------------------------------------------------------------------------------------------------- #;      . #; -------------------------------------------------------------------------------------------------- checkCreate()private new t #;       quit:$$$getDTOin("ontology","")="" -1 #;  ,      quit:$$$getDTOin("type","")="" -1 #;     set t("check")=$$checkNames() #;  ,     quit:t("check")&lt;0 t("check") #;       $$$setDTOproc("id",$$$dMaxID) #;      ^Dictionary $$$setDTOproc("path",$name($$$dData($$$getDTOin("ontology",""),$$$getDTOin("type",""),$$$getDTOproc("id","")))) #;     quit 0 #; -------------------------------------------------------------------------------------------------- checkUpdate() quit 0 #; -------------------------------------------------------------------------------------------------- checkDelete() quit 0 #; -------------------------------------------------------------------------------------------------- #;     . #; -------------------------------------------------------------------------------------------------- checkNames()private new t #;   t("check")  #;         set t("check")=-1 set t("lang")="" for { #;    set t("lang")=$order($$$dDTO($job,"in","nameList",t("lang"))) #;   ,     quit:t("lang")="" #;      set t("name")=$get($$$dDTO($job,"in","nameList",t("lang")),"") #;    if t("name")="" { #;   t("check")  set t("check")=-1 #;    quit } else { #;  t("check")   ,     set t("check")=0 } } #;     quit t("check") #; -------------------------------------------------------------------------------------------------- #;    . #; -------------------------------------------------------------------------------------------------- processingNames(function) new t set t("lang")="" for { #;     set t("lang")=$order($$$dDTO($job,"in","nameList",t("lang"))) quit:t("lang")="" #;        xecute "set "_$name($$$dDTO($job,"in","nameList",t("lang")))_"=$$"_function_"("""_$$$getDTOname(t("lang"))_""")" } quit #; -------------------------------------------------------------------------------------------------- checkUniqueNameElementAllLang() new t set t("check")=0 st("ontology")=$$$getDTOin("ontology","") st("type")=$$$getDTOin("type","") set t("lang")="" for { #;     set t("lang")=$order($$$dDTO($job,"in","nameList",t("lang"))) quit:t("lang")="" #;    set t("name")=$get($$$dDTO($job,"in","nameList",t("lang")),"") #;   t("check")     (0 -  ) st("check")=$$checkUniqueNameElement(t("ontology"),t("type"),t("lang"),t("name"),$$$getDTOproc("id","")) #;     -    quit:t("check")&lt;0 } quit t("check") #; -------------------------------------------------------------------------------------------------- #;         . #; -------------------------------------------------------------------------------------------------- clearPunctuationAndControlChar(str) new t #;  t("str")     set t("str")="" #;      for t("i")=1:1:$length(str) { #;    set t("ch")=$extract(str,t("i")) if `((t("ch")?1P)||(t("ch")?1C)) { #;       set t("str")=t("str")_t("ch") } } #;    quit t("str") #; -------------------------------------------------------------------------------------------------- #; -------------------------------------------------------------------------------------------------- #;       . #;      . #;        (     ). #;      ,   "."   . #; -------------------------------------------------------------------------------------------------- specialClearStr(str) new t set t("str")="",t("flag")="start",t("delim")="" for t("i")=1:1:$L(str) { set t("ch")=$extract(str,t("i")) ;#     set:t("ch")=$char(9) t("ch")=" " continue:(t("ch")?1C) if (t("flag")="start")&amp;&amp;`(t("ch")?1P) { set t("str")=t("ch"),t("flag")="word" } elseif t("flag")="word" { if `(t("ch")?1P) { set t("str")=t("str")_t("ch") } else { set t("delim")=t("ch"),t("flag")="delim" } } elseif t("flag")="delim" { if (t("ch")?1P) { set:t("ch")`=" " t("delim")=t("ch") } else { set t("str")=t("str")_t("delim")_t("ch"),t("flag")="word",t("delim")="" } } } set:t("delim")="." t("str")=t("str")_t("delim") quit t("str") #; -------------------------------------------------------------------------------------------------- #; -------------------------------------------------------------------------------------------------- #;      ,   ,   . #;  ,   . #; -------------------------------------------------------------------------------------------------- checkUniqueNameElement(ontology,type,lang,name,id) new t #;    set t("q")=0 set t("uniqueId")="" for { #; ,         #;   , ,   (  ) set t("uniqueId")=$order($$$dIndex(ontology,type,"name",lang,$zconvert(name,"l"),t("uniqueId"))) #;     quit:t("uniqueId")="" #; ,      #;     update if (t("uniqueId")`=id) { #;  ,       set t("q")=-1 quit } } #;   quit t("q") #; -------------------------------------------------------------------------------------------------- #;  ,     . #;         . #; -------------------------------------------------------------------------------------------------- setProperty(ontology,type,property,value,id,index="true")private #;      ()    set $$$dData(ontology,type,id,0,property)=value #;    if index="true" { #;   set $$$dIndex(ontology,type,property,value,id)=1 #;      set $$$dRefs(id,$name($$$dIndex(ontology,type,property,value,id)))=1 } quit 0 #; -------------------------------------------------------------------------------------------------- #;   ,     . #;  (  )   . #; -------------------------------------------------------------------------------------------------- setName(ontology,type,lang,value,id)private #;         set $$$dName(id,lang,0)=value #;   / set $$$dName(id,lang,0,"UpdateTime")=$horolog #;     set $$$dIndex(ontology,type,"name",lang,$zconvert(value,"l"),id)=1 #;    set $$$dRefs(id,$name($$$dIndex(ontology,type,"name",lang,$zconvert(value,"l"),id)))=1 quit 0 #; -------------------------------------------------------------------------------------------------- saveOntoAndTypeID(id,ontology,type) set $$$dIndex("ID",id,"ontology")=ontology set $$$dRefs(id,$name($$$dIndex("ID",id,"ontology")))=1 set $$$dIndex("ID",id,"type")=type set $$$dRefs(id,$name($$$dIndex("ID",id,"type")))=1 quit #; -------------------------------------------------------------------------------------------------- saveElementPath(id,path) set $$$dIndex("ID",id,"path")=path set $$$dRefs(id,$name($$$dIndex("ID",id,"path")))=1 quit #; --------------------------------------------------------------------------------------------------</span></span></code> </pre><br>  In the program listing, the symbol <b>'was</b> replaced with the symbol <b>'</b> - this is necessary for a more beautiful display of the code.  In the case of copying the program code in Cach√©, it is necessary to make a reverse replacement: replace all the characters with <br></div></div><br>  Converted global rules: <br><br><pre> <code class="bash hljs">MONTOLOGY&gt;zwrite ^RuleDictionary(<span class="hljs-string"><span class="hljs-string">"SimpleOntology"</span></span>) ^RuleDictionary(<span class="hljs-string"><span class="hljs-string">"SimpleOntology"</span></span>,<span class="hljs-string"><span class="hljs-string">"SimpleType"</span></span>,<span class="hljs-string"><span class="hljs-string">"create"</span></span>,<span class="hljs-string"><span class="hljs-string">"check"</span></span>,10)=<span class="hljs-string"><span class="hljs-string">"do processingNames("</span></span><span class="hljs-string"><span class="hljs-string">"clearPunctuationAndControlChar"</span></span><span class="hljs-string"><span class="hljs-string">")"</span></span> ^RuleDictionary(<span class="hljs-string"><span class="hljs-string">"SimpleOntology"</span></span>,<span class="hljs-string"><span class="hljs-string">"SimpleType"</span></span>,<span class="hljs-string"><span class="hljs-string">"create"</span></span>,<span class="hljs-string"><span class="hljs-string">"check"</span></span>,20)=<span class="hljs-string"><span class="hljs-string">"s check=$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$checkUniqueNameElementAllLang</span></span></span><span class="hljs-string">()"</span></span> ^RuleDictionary(<span class="hljs-string"><span class="hljs-string">"SimpleOntology"</span></span>,<span class="hljs-string"><span class="hljs-string">"SimpleType"</span></span>,<span class="hljs-string"><span class="hljs-string">"update"</span></span>,<span class="hljs-string"><span class="hljs-string">"check"</span></span>,10)=<span class="hljs-string"><span class="hljs-string">"do processingNames("</span></span><span class="hljs-string"><span class="hljs-string">"clearPunctuationAndControlChar"</span></span><span class="hljs-string"><span class="hljs-string">")"</span></span> ^RuleDictionary(<span class="hljs-string"><span class="hljs-string">"SimpleOntology"</span></span>,<span class="hljs-string"><span class="hljs-string">"SimpleType"</span></span>,<span class="hljs-string"><span class="hljs-string">"update"</span></span>,<span class="hljs-string"><span class="hljs-string">"check"</span></span>,20)=<span class="hljs-string"><span class="hljs-string">"s check=$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$checkUniqueNameElementAllLang</span></span></span><span class="hljs-string">()"</span></span> MONTOLOGY&gt;</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Create Global Ctrl + C / V</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^RuleDictionary(<span class="hljs-string"><span class="hljs-string">"SimpleOntology"</span></span>,<span class="hljs-string"><span class="hljs-string">"SimpleType"</span></span>,<span class="hljs-string"><span class="hljs-string">"create"</span></span>,<span class="hljs-string"><span class="hljs-string">"check"</span></span>,10)=<span class="hljs-string"><span class="hljs-string">"do processingNames("</span></span><span class="hljs-string"><span class="hljs-string">"clearPunctuationAndControlChar"</span></span><span class="hljs-string"><span class="hljs-string">")"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^RuleDictionary(<span class="hljs-string"><span class="hljs-string">"SimpleOntology"</span></span>,<span class="hljs-string"><span class="hljs-string">"SimpleType"</span></span>,<span class="hljs-string"><span class="hljs-string">"create"</span></span>,<span class="hljs-string"><span class="hljs-string">"check"</span></span>,20)=<span class="hljs-string"><span class="hljs-string">"s check=$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$checkUniqueNameElementAllLang</span></span></span><span class="hljs-string">()"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^RuleDictionary(<span class="hljs-string"><span class="hljs-string">"SimpleOntology"</span></span>,<span class="hljs-string"><span class="hljs-string">"SimpleType"</span></span>,<span class="hljs-string"><span class="hljs-string">"update"</span></span>,<span class="hljs-string"><span class="hljs-string">"check"</span></span>,10)=<span class="hljs-string"><span class="hljs-string">"do processingNames("</span></span><span class="hljs-string"><span class="hljs-string">"clearPunctuationAndControlChar"</span></span><span class="hljs-string"><span class="hljs-string">")"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^RuleDictionary(<span class="hljs-string"><span class="hljs-string">"SimpleOntology"</span></span>,<span class="hljs-string"><span class="hljs-string">"SimpleType"</span></span>,<span class="hljs-string"><span class="hljs-string">"update"</span></span>,<span class="hljs-string"><span class="hljs-string">"check"</span></span>,20)=<span class="hljs-string"><span class="hljs-string">"s check=$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$checkUniqueNameElementAllLang</span></span></span><span class="hljs-string">()"</span></span></code> </pre><br></div></div><br>  Perform global cleanup (except global rules) and insert the first two directory elements, like <a href="http://habrahabr.ru/post/178563/">last time</a> , to make sure that we never made any mistakes when switching to macros and avoiding transparent variables. <br><br><div class="spoiler">  <b class="spoiler_title">Check the converted program Dictionary</b> <div class="spoiler_text">  Remove all our globals, except the global rules <b>^ RuleDictionary</b> : <br><pre> <code class="bash hljs">MONTOLOGY&gt;<span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> ^Dictionary,^IndexDictionary,^NameDictionaryElement,^RefsDictionary MONTOLOGY&gt;</code> </pre><br>  Create the first two elements of the directory: <br><pre> <code class="bash hljs">MONTOLOGY&gt;<span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>) MONTOLOGY&gt;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"ontology"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"type"</span></span>)=<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span> MONTOLOGY&gt;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>)=<span class="hljs-string"><span class="hljs-string">" ,"</span></span>,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>)=<span class="hljs-string"><span class="hljs-string">"akp"</span></span> MONTOLOGY&gt;write $<span class="hljs-variable"><span class="hljs-variable">$create</span></span>^Dictionary() 1 MONTOLOGY&gt;<span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>) MONTOLOGY&gt;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"ontology"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"type"</span></span>)=<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span> MONTOLOGY&gt;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>)=<span class="hljs-string"><span class="hljs-string">""</span></span>,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>)=<span class="hljs-string"><span class="hljs-string">"meh"</span></span> MONTOLOGY&gt;write $<span class="hljs-variable"><span class="hljs-variable">$create</span></span>^Dictionary() 2 MONTOLOGY&gt;</code> </pre><br>  Print all our globals: <br><pre> <code class="bash hljs">MONTOLOGY&gt;zwrite ^Dictionary,^IndexDictionary,^NameDictionaryElement,^RefsDictionary ^Dictionary(<span class="hljs-string"><span class="hljs-string">"MaxID"</span></span>)=2 ^Dictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span>,1,0,<span class="hljs-string"><span class="hljs-string">"UpdateTime"</span></span>)=<span class="hljs-string"><span class="hljs-string">"62968,77638"</span></span> ^Dictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span>,1,0,<span class="hljs-string"><span class="hljs-string">"uid"</span></span>)=888 ^Dictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span>,2,0,<span class="hljs-string"><span class="hljs-string">"UpdateTime"</span></span>)=<span class="hljs-string"><span class="hljs-string">"62968,77664"</span></span> ^Dictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span>,2,0,<span class="hljs-string"><span class="hljs-string">"uid"</span></span>)=888 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,1,<span class="hljs-string"><span class="hljs-string">"ontology"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,1,<span class="hljs-string"><span class="hljs-string">"path"</span></span>)=<span class="hljs-string"><span class="hljs-string">"^|"</span></span><span class="hljs-string"><span class="hljs-string">"MONTOLOGY"</span></span><span class="hljs-string"><span class="hljs-string">"|Dictionary("</span></span><span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span><span class="hljs-string"><span class="hljs-string">",1)"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,1,<span class="hljs-string"><span class="hljs-string">"type"</span></span>)=<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,2,<span class="hljs-string"><span class="hljs-string">"ontology"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,2,<span class="hljs-string"><span class="hljs-string">"path"</span></span>)=<span class="hljs-string"><span class="hljs-string">"^|"</span></span><span class="hljs-string"><span class="hljs-string">"MONTOLOGY"</span></span><span class="hljs-string"><span class="hljs-string">"|Dictionary("</span></span><span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span><span class="hljs-string"><span class="hljs-string">",2)"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,2,<span class="hljs-string"><span class="hljs-string">"type"</span></span>)=<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>,<span class="hljs-string"><span class="hljs-string">"akp"</span></span>,1)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>,<span class="hljs-string"><span class="hljs-string">"meh"</span></span>,2)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>,1)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>,2)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span>,<span class="hljs-string"><span class="hljs-string">"uid"</span></span>,888,1)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span>,<span class="hljs-string"><span class="hljs-string">"uid"</span></span>,888,2)=1 ^NameDictionaryElement(1,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>,0)=<span class="hljs-string"><span class="hljs-string">"akp"</span></span> ^NameDictionaryElement(1,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>,0,<span class="hljs-string"><span class="hljs-string">"UpdateTime"</span></span>)=<span class="hljs-string"><span class="hljs-string">"62968,77638"</span></span> ^NameDictionaryElement(1,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>,0)=<span class="hljs-string"><span class="hljs-string">""</span></span> ^NameDictionaryElement(1,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>,0,<span class="hljs-string"><span class="hljs-string">"UpdateTime"</span></span>)=<span class="hljs-string"><span class="hljs-string">"62968,77638"</span></span> ^NameDictionaryElement(2,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>,0)=<span class="hljs-string"><span class="hljs-string">"meh"</span></span> ^NameDictionaryElement(2,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>,0,<span class="hljs-string"><span class="hljs-string">"UpdateTime"</span></span>)=<span class="hljs-string"><span class="hljs-string">"62968,77664"</span></span> ^NameDictionaryElement(2,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>,0)=<span class="hljs-string"><span class="hljs-string">""</span></span> ^NameDictionaryElement(2,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>,0,<span class="hljs-string"><span class="hljs-string">"UpdateTime"</span></span>)=<span class="hljs-string"><span class="hljs-string">"62968,77664"</span></span> ^RefsDictionary(1,<span class="hljs-string"><span class="hljs-string">"^|"</span></span><span class="hljs-string"><span class="hljs-string">"MONTOLOGY"</span></span><span class="hljs-string"><span class="hljs-string">"|IndexDictionary("</span></span><span class="hljs-string"><span class="hljs-string">"ID"</span></span><span class="hljs-string"><span class="hljs-string">",1,"</span></span><span class="hljs-string"><span class="hljs-string">"ontology"</span></span><span class="hljs-string"><span class="hljs-string">")"</span></span>)=1 ^RefsDictionary(1,<span class="hljs-string"><span class="hljs-string">"^|"</span></span><span class="hljs-string"><span class="hljs-string">"MONTOLOGY"</span></span><span class="hljs-string"><span class="hljs-string">"|IndexDictionary("</span></span><span class="hljs-string"><span class="hljs-string">"ID"</span></span><span class="hljs-string"><span class="hljs-string">",1,"</span></span><span class="hljs-string"><span class="hljs-string">"path"</span></span><span class="hljs-string"><span class="hljs-string">")"</span></span>)=1 ^RefsDictionary(1,<span class="hljs-string"><span class="hljs-string">"^|"</span></span><span class="hljs-string"><span class="hljs-string">"MONTOLOGY"</span></span><span class="hljs-string"><span class="hljs-string">"|IndexDictionary("</span></span><span class="hljs-string"><span class="hljs-string">"ID"</span></span><span class="hljs-string"><span class="hljs-string">",1,"</span></span><span class="hljs-string"><span class="hljs-string">"type"</span></span><span class="hljs-string"><span class="hljs-string">")"</span></span>)=1 ^RefsDictionary(1,<span class="hljs-string"><span class="hljs-string">"^|"</span></span><span class="hljs-string"><span class="hljs-string">"MONTOLOGY"</span></span><span class="hljs-string"><span class="hljs-string">"|IndexDictionary("</span></span><span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"partUri"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"akp"</span></span><span class="hljs-string"><span class="hljs-string">",1)"</span></span>)=1 ^RefsDictionary(1,<span class="hljs-string"><span class="hljs-string">"^|"</span></span><span class="hljs-string"><span class="hljs-string">"MONTOLOGY"</span></span><span class="hljs-string"><span class="hljs-string">"|IndexDictionary("</span></span><span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"ru"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">",1)"</span></span>)=1 ^RefsDictionary(1,<span class="hljs-string"><span class="hljs-string">"^|"</span></span><span class="hljs-string"><span class="hljs-string">"MONTOLOGY"</span></span><span class="hljs-string"><span class="hljs-string">"|IndexDictionary("</span></span><span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"uid"</span></span><span class="hljs-string"><span class="hljs-string">",888,1)"</span></span>)=1 ^RefsDictionary(2,<span class="hljs-string"><span class="hljs-string">"^|"</span></span><span class="hljs-string"><span class="hljs-string">"MONTOLOGY"</span></span><span class="hljs-string"><span class="hljs-string">"|IndexDictionary("</span></span><span class="hljs-string"><span class="hljs-string">"ID"</span></span><span class="hljs-string"><span class="hljs-string">",2,"</span></span><span class="hljs-string"><span class="hljs-string">"ontology"</span></span><span class="hljs-string"><span class="hljs-string">")"</span></span>)=1 ^RefsDictionary(2,<span class="hljs-string"><span class="hljs-string">"^|"</span></span><span class="hljs-string"><span class="hljs-string">"MONTOLOGY"</span></span><span class="hljs-string"><span class="hljs-string">"|IndexDictionary("</span></span><span class="hljs-string"><span class="hljs-string">"ID"</span></span><span class="hljs-string"><span class="hljs-string">",2,"</span></span><span class="hljs-string"><span class="hljs-string">"path"</span></span><span class="hljs-string"><span class="hljs-string">")"</span></span>)=1 ^RefsDictionary(2,<span class="hljs-string"><span class="hljs-string">"^|"</span></span><span class="hljs-string"><span class="hljs-string">"MONTOLOGY"</span></span><span class="hljs-string"><span class="hljs-string">"|IndexDictionary("</span></span><span class="hljs-string"><span class="hljs-string">"ID"</span></span><span class="hljs-string"><span class="hljs-string">",2,"</span></span><span class="hljs-string"><span class="hljs-string">"type"</span></span><span class="hljs-string"><span class="hljs-string">")"</span></span>)=1 ^RefsDictionary(2,<span class="hljs-string"><span class="hljs-string">"^|"</span></span><span class="hljs-string"><span class="hljs-string">"MONTOLOGY"</span></span><span class="hljs-string"><span class="hljs-string">"|IndexDictionary("</span></span><span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"partUri"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"meh"</span></span><span class="hljs-string"><span class="hljs-string">",2)"</span></span>)=1 ^RefsDictionary(2,<span class="hljs-string"><span class="hljs-string">"^|"</span></span><span class="hljs-string"><span class="hljs-string">"MONTOLOGY"</span></span><span class="hljs-string"><span class="hljs-string">"|IndexDictionary("</span></span><span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"ru"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">",2)"</span></span>)=1 ^RefsDictionary(2,<span class="hljs-string"><span class="hljs-string">"^|"</span></span><span class="hljs-string"><span class="hljs-string">"MONTOLOGY"</span></span><span class="hljs-string"><span class="hljs-string">"|IndexDictionary("</span></span><span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"uid"</span></span><span class="hljs-string"><span class="hljs-string">",888,2)"</span></span>)=1</code> </pre><br>  As you can see, these globals are different from <a href="http://habrahabr.ru/post/178563/">these</a> , only the value of <b>"UpdateTime"</b> .  Changes to the <b>Dictionary</b> program can be considered successful. <br></div></div><hr><br><a name="nested"></a><h4>  Nested structures </h4><br>  Consider the simplest example of nested directory structures.  Suppose that the ontology of the <b>Vehicle</b> contains the <b>Make</b> reference book, inside of which the <b>Model</b> reference book (vehicle makes and models) is contained.  We describe these directories in our global rule <b>^ RuleDIctionary</b> .  For convenience, we will create a program <b>InitRuleDic</b> which will initialize our global rules.  We also write the rules for reference books and ontology by default.  Let me remind you that instead of <b>^ RuleDictionary</b> , inside programs, the abbreviated <b>$$$ dRule</b> entry is now available to <b>us</b> . <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#; ------------------------------------------------------------------------------------------------------------ #include Dictionary #; ------------------------------------------------------------------------------------------------------------ InitRuleDic #; ------------------------------------------------------------------------------------------------------------ kill $$$dRule set $$$dRule("SimpleOntology","SimpleType","create","check",10)="do processingNames(""clearPunctuationAndControlChar"")" set $$$dRule("SimpleOntology","SimpleType","create","check",20)="s check=$$checkUniqueNameElementAllLang()" set $$$dRule("SimpleOntology","SimpleType","update","check",10)="do processingNames(""clearPunctuationAndControlChar"")" set $$$dRule("SimpleOntology","SimpleType","update","check",20)="s check=$$checkUniqueNameElementAllLang()" set $$$dRule("Vehicle","Make","property","lastId")="otherId" set $$$dRule("Vehicle","Make","property","lastId","index")="true" set $$$dRule("Vehicle","Make","create","check",10)="do processingNames(""specialClearStr"")" set $$$dRule("Vehicle","Make","create","check",20)="s check=$$checkUniqueNameElementAllLang()" set $$$dRule("Vehicle","Make","create","check",50)="s check=$$checkUniqueParamElement(""lastId"",""Vehicle"",""Make"")" set $$$dRule("Vehicle","Make","update","check",10)="do processingNames(""specialClearStr"")" set $$$dRule("Vehicle","Make","update","check",20)="s check=$$checkUniqueNameElementAllLang()" set $$$dRule("Vehicle","Make","update","check",50)="s check=$$checkUniqueParamElement(""lastId"",""Vehicle"",""Make"")" set $$$dRule("Vehicle","Model","parent")="Make" set $$$dRule("Vehicle","Model","property","parentId")="parent" set $$$dRule("Vehicle","Model","property","parentId","index")="true" set $$$dRule("Vehicle","Model","property","lastId")="otherId" set $$$dRule("Vehicle","Model","property","lastId","index")="true" set $$$dRule("Vehicle","Model","create","check",15)="do processingNames(""specialClearStr"")" set $$$dRule("Vehicle","Model","create","check",20)="s check=$$checkUniqueNameElementAllLang(""true"")" set $$$dRule("Vehicle","Model","create","check",50)="s check=$$checkUniqueParamElement(""lastId"",""Vehicle"",""Model"")" set $$$dRule("Vehicle","Model","update","check",15)="do processingNames(""specialClearStr"")" set $$$dRule("Vehicle","Model","update","check",20)="s check=$$checkUniqueNameElementAllLang(""true"")" set $$$dRule("Vehicle","Model","update","check",50)="s check=$$checkUniqueParamElement(""lastId"",""Vehicle"",""Model"")" zwrite $$$dRule quit #; ------------------------------------------------------------------------------------------------------------</span></span></code> </pre><br>  Let's take a closer look at our global rules.  In the <b>Make</b> directory, the <b>lastId</b> property <b>appeared</b> .  This is the ID of the reference item in the old database (not globals).  In some places, the last identifier can be used for binding, so it needs to be saved.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The task of finding the correspondence between the elements of such reference books (in different systems) still remains one of the most relevant in the field of data migration. </font><font style="vertical-align: inherit;">The type of property </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">otherId</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is not processed in any way in the program, it is just a text reminder of what is inside. </font><font style="vertical-align: inherit;">If necessary, nothing prevents the handler from hanging on this type of property in the methods of processing directories. </font><font style="vertical-align: inherit;">The </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lastId</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> property </font><b><font style="vertical-align: inherit;">is</font></b><font style="vertical-align: inherit;"> indexable, as indicated by the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">index</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> branch </font><font style="vertical-align: inherit;">with the value </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äúture‚Äù</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Next comes a set of three functions used to check when creating / updating an item. </font><font style="vertical-align: inherit;">The </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">checkUniqueParamElement ()</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">for us is new - we will add it to the program.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">checkUniqueParamElement ()</font></font></b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#; -------------------------------------------------------------------------------------------------- #;      . #; -------------------------------------------------------------------------------------------------- checkUniqueParamElement(param,ontology,type) new t #;    set t("value")=$$$getDTOin(param,"") #;   ,     -    quit:t("value")="" 0 #;    set t("q")=0 set t("uniqueId")="" for { #; ,         #;   , ,    set t("uniqueId")=$o($$$dIndex(ontology,type,param,t("value"),t("uniqueId"))) #;     quit:t("uniqueId")="" #; ,      #;     update if (t("uniqueId")`=$$$getDTOproc("id","")) { #;  ,       set t("q")=-1 quit } } quit t("q") #; --------------------------------------------------------------------------------------------------</span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extend the functionality of our </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create ()</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">‚Äî add property handling to it:</font></font><br><pre> <code class="bash hljs"> st(<span class="hljs-string"><span class="hljs-string">"property"</span></span>)=<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { <span class="hljs-comment"><span class="hljs-comment">#;    st("property")=$o($$$dDTO($j,"in",t("property"))) #;   ,    quit:t("property")="" #;  ,              continue:$get($$$dRule(t("ontology"),t("type"),"property",t("property")),"")="" #;    set t("index")=$get($$$dRule(t("ontology"),t("type"),"property",t("property"),"index"),"false") #;    set t("value")=$get($$$dDTO($j,"in",t("property")),"") #;     -   if t("value")`="" { do setProperty(t("ontology"),t("type"),t("property"),t("value"),t("id"),t("index"),$$$getDTOproc("pathParent","")) } }</span></span></code> </pre><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Full version create</font></font></b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#; -------------------------------------------------------------------------------------------------- #;   . #;         . #; -------------------------------------------------------------------------------------------------- create() #;     kill $$$dDTO($job,"out") #;     t #;         create new t #;      set t("err")=$$check("create") #; ,    if t("err")&lt;0 { quit t("err") } st("ontology")=$$$getDTOin("ontology","") st("type")=$$$getDTOin("type","") st("id")=$$$getDTOproc("id","") #;   "UpdateTime" do setProperty(t("ontology"),t("type"),"UpdateTime",$horolog,t("id"),"false",$$$getDTOproc("pathParent","")) #;   "uid" do setProperty(t("ontology"),t("type"),"uid",$$$getDTOin("uid",888),t("id"),"true",$$$getDTOproc("pathParent","")) set t("lang")="" for { #;    (     ) set t("lang")=$order($$$dDTO($job,"in","nameList",t("lang"))) #;   ,     quit:t("lang")="" #;      set t("name")=$get($$$dDTO($job,"in","nameList",t("lang")),"") #;      do setName(t("ontology"),t("type"),t("lang"),t("name"),t("id")) } st("property")="" for { #;    st("property")=$o($$$dDTO($j,"in",t("property"))) #;   ,    quit:t("property")="" #;  ,              continue:$get($$$dRule(t("ontology"),t("type"),"property",t("property")),"")="" #;    set t("index")=$get($$$dRule(t("ontology"),t("type"),"property",t("property"),"index"),"false") #;    set t("value")=$get($$$dDTO($j,"in",t("property")),"") #;     -   if t("value")`="" { do setProperty(t("ontology"),t("type"),t("property"),t("value"),t("id"),t("index"),$$$getDTOproc("pathParent","")) } } #;          do saveOntoAndTypeID(t("id"),t("ontology"),t("type")) #;         do saveElementPath(t("id"),$$$getDTOproc("path","")) #;         $$$setDTOout("id",t("id")) #;     kill $$$dDTO($job,"in") #;     kill $$$dDTO($job,"porc") #;     quit t("id") #; --------------------------------------------------------------------------------------------------</span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pay attention to the line: </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">do setProperty (t ("ontology"), t ("type"), t ("property"), t ("value"), t ("id"), t ("index"), $$$ getDTOproc ("pathParent", ""))</font></font></i> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> One more </font><b><font style="vertical-align: inherit;">pathParent</font></b><font style="vertical-align: inherit;"> parameter was added to the </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">call to the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setProperty () </font></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">method</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - it is needed to handle nesting.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add a couple of car brands to our directory (the brands I chose at random - there is no advertising here).</font></font></b> <div class="spoiler_text"><pre> <code class="bash hljs">MONTOLOGY&gt;<span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>) MONTOLOGY&gt;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"ontology"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"type"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Make"</span></span> MONTOLOGY&gt;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>)=<span class="hljs-string"><span class="hljs-string">"MAZDA"</span></span>,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>)=<span class="hljs-string"><span class="hljs-string">"mazda"</span></span> MONTOLOGY&gt;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"lastId"</span></span>)=122 MONTOLOGY&gt;write $<span class="hljs-variable"><span class="hljs-variable">$create</span></span>^Dictionary() 3 MONTOLOGY&gt;<span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>) MONTOLOGY&gt;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"ontology"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"type"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Make"</span></span> MONTOLOGY&gt;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>)=<span class="hljs-string"><span class="hljs-string">"BMW"</span></span>,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>)=<span class="hljs-string"><span class="hljs-string">"bmw"</span></span> MONTOLOGY&gt;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"lastId"</span></span>)=1269 MONTOLOGY&gt;write $<span class="hljs-variable"><span class="hljs-variable">$create</span></span>^Dictionary() 4 MONTOLOGY&gt;</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carefully look at the </font></font><a href="https://habr.com/ru/post/179949/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rules</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Model</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . A </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parent</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> branch appeared </font><font style="vertical-align: inherit;">with the value </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúMake‚Äù</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - an indication that the parent for the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Model</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> directory </font><font style="vertical-align: inherit;">is </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Make</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Next, an indexable </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parentId</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> property is </font><b><font style="vertical-align: inherit;">declared</font></b><font style="vertical-align: inherit;"> , in which the parent ID is stored. Let the elements of the nested directory, in the global </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">^ Dictionary</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , be stored in the </font><b><font style="vertical-align: inherit;">children</font></b><font style="vertical-align: inherit;"> branch</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parent element. </font><font style="vertical-align: inherit;">We will not limit the number of nesting levels by software (only restrictions on the length of the index of the variable remain). </font><font style="vertical-align: inherit;">We also assume that indexes and names for nested directories will be stored in the same way as for normal ones. </font><font style="vertical-align: inherit;">Let's write the parent check function.</font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#; -------------------------------------------------------------------------------------------------- #;   ,   . #;     . #; -------------------------------------------------------------------------------------------------- checkParent()private new t #;           (  ) st("parent")=$get($$$dRule($$$getDTOin("ontology",""),$$$getDTOin("type",""),"parent"),"") #;    if t("parent")`="" { #;    parentId      set t("parentId")=$$$getDTOin("parentId","") #;       if t("parentId")="" { quit -1 } #;       #;        if $get($$$dIndex("ID",t("parentId"),"ontology"),"")`=$$$getDTOin("ontology","") { quit -1 } #;       if $get($$$dIndex("ID",t("parentId"),"type"),"")`=t("parent") { quit -1 } #;     st("pathParent")=$get($$$dIndex("ID",t("parentId"),"path"),"") #;      if t("pathParent")="" { quit -1 } #;          $$$setDTOproc("pathParent",t("pathParent")) } #;      quit 0 #; --------------------------------------------------------------------------------------------------</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As you can see, the function checks in the global rules whether the created element is nested, and if so, it checks the presence and correctness of the passed parent identifier. </font><font style="vertical-align: inherit;">You will also have to make some changes to the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">checkCreate ()</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">: add the call to the parent check to it, and change the rule for forming the path to the directory element in the global </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">^ Dictionary</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#; -------------------------------------------------------------------------------------------------- #;      . #; -------------------------------------------------------------------------------------------------- checkCreate()private new t #;       quit:$$$getDTOin("ontology","")="" -1 #;  ,      quit:$$$getDTOin("type","")="" -1 #;     st("check")=$$checkParent() #;  ,     quit:t("check")&lt;0 t("check") #;     set t("check")=$$checkNames() #;  ,     quit:t("check")&lt;0 t("check") #;       $$$setDTOproc("id",$$$dMaxID) #;      ^Dictionary if $$$getDTOproc("pathParent","")="" { #;    -     ^Dictionary(ontology) set t("path")=$name($$$dData($$$getDTOin("ontology",""))) } else { #;      -         children set t("path")=$name(@($$$getDTOproc("pathParent",""))@(0,"children")) } #;           st("path")=$name(@(t("path"))@($$$getDTOin("type",""),$$$getDTOproc("id",""))) $$$setDTOproc("path",t("path")) #;     quit 0 #; --------------------------------------------------------------------------------------------------</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Also note the following line in the global rules: </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set $$$ dRule ("Vehicle", "Model", "create", "check", 20) = "s check = $$ checkUniqueNameElementAllLang (" "true" ")"</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The method </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">checkUniqueNameElement ()</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , we added one parameter </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inparent</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which determines whether it is necessary to check for uniqueness within all directory elements or only within the parent. </font><font style="vertical-align: inherit;">For our case it is easy to explain, there are many models of cars that are equally called, but they have different brands. </font><font style="vertical-align: inherit;">We need to check that matches only within the parent - and in this case, produce an error. </font><font style="vertical-align: inherit;">Similar requirements may arise, for example, when implementing an address directory. </font><font style="vertical-align: inherit;">In one country there is a huge number of settlements with the same name. </font><font style="vertical-align: inherit;">He himself was surprised by the far from single presence of such settlements in Ukraine as Nikolaev, Poltava, Cherkasy and others. </font><font style="vertical-align: inherit;">Therefore, it is sometimes necessary to limit the domain within which the uniqueness is verified.</font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#; -------------------------------------------------------------------------------------------------- #;      ,   ,   . #;  ,   . #; -------------------------------------------------------------------------------------------------- checkUniqueNameElement(ontology,type,lang,name,id,inparent="false") new t #;    set t("q")=0 set t("uniqueId")="" for { #; ,         #;   , ,   (  ) set t("uniqueId")=$order($$$dIndex(ontology,type,"name",lang,$zconvert(name,"l"),t("uniqueId"))) #;     quit:t("uniqueId")="" #; ,      #;     update if (t("uniqueId")`=id) { #;          if inparent="false" { #;  ,       set t("q")=-1 quit } else { #;        if $data($$$dIndex(ontology,type,"parentId",$$$getDTOin("parentId",""),t("uniqueId"))) { #;          #;    /  set t("q")=-1 quit } } } } #;   quit t("q") #; --------------------------------------------------------------------------------------------------</span></span></code> </pre><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All Dictionary Code</font></font></b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#; -------------------------------------------------------------------------------------------------- #;    Dictionary.inc,   (inc) -      #include Dictionary #; -------------------------------------------------------------------------------------------------- #;   #; -------------------------------------------------------------------------------------------------- Dictionary #; -------------------------------------------------------------------------------------------------- #;   . #; -------------------------------------------------------------------------------------------------- retrieve(id,lang="ru",version=0) quit $get($$$dName(id,lang,version),"") #; -------------------------------------------------------------------------------------------------- #;      . #; -------------------------------------------------------------------------------------------------- retrieveListByIndex(ontology,type,index,value,str="",lang="ru") #;     ,       set str=$zconvert(str,"L") set id="" for { #;  ()    set id=$order($$$dIndex(ontology,type,index,value,id)) #;  ,        quit:id="" #;   set name=$$retrieve(id,lang) #;      str if $extract($zconvert(name,"L"),1,$length(str))=str { #;  (  ) write id_" "_name,! } } quit #; -------------------------------------------------------------------------------------------------- #;   . #;         . #; -------------------------------------------------------------------------------------------------- create() #;     kill $$$dDTO($job,"out") #;     t #;         create new t #;      set t("err")=$$check("create") #; ,    if t("err")&lt;0 { quit t("err") } st("ontology")=$$$getDTOin("ontology","") st("type")=$$$getDTOin("type","") st("id")=$$$getDTOproc("id","") #;   "UpdateTime" do setProperty(t("ontology"),t("type"),"UpdateTime",$horolog,t("id"),"false",$$$getDTOproc("pathParent","")) #;   "uid" do setProperty(t("ontology"),t("type"),"uid",$$$getDTOin("uid",888),t("id"),"true",$$$getDTOproc("pathParent","")) set t("lang")="" for { #;    (     ) set t("lang")=$order($$$dDTO($job,"in","nameList",t("lang"))) #;   ,     quit:t("lang")="" #;      set t("name")=$get($$$dDTO($job,"in","nameList",t("lang")),"") #;      do setName(t("ontology"),t("type"),t("lang"),t("name"),t("id")) } st("property")="" for { #;    st("property")=$order($$$dDTO($j,"in",t("property"))) #;   ,    quit:t("property")="" #;  ,              continue:$get($$$dRule(t("ontology"),t("type"),"property",t("property")),"")="" #;    set t("index")=$get($$$dRule(t("ontology"),t("type"),"property",t("property"),"index"),"false") #;    set t("value")=$get($$$dDTO($j,"in",t("property")),"") #;     -   if t("value")`="" { do setProperty(t("ontology"),t("type"),t("property"),t("value"),t("id"),t("index"),$$$getDTOproc("pathParent","")) } } #;          do saveOntoAndTypeID(t("id"),t("ontology"),t("type")) #;         do saveElementPath(t("id"),$$$getDTOproc("path","")) #;         $$$setDTOout("id",t("id")) #;     kill $$$dDTO($job,"in") #;     kill $$$dDTO($job,"porc") #;     quit t("id") #; -------------------------------------------------------------------------------------------------- #;  . #;    ^RuleDictionary    . #; -------------------------------------------------------------------------------------------------- check(action)private #;     check new check #;        action set check=$case(action,"create":$$checkCreate(),"update":$$checkUpdate(),"delete":$$checkDelete(),:-1) #;   quit:check&lt;0 check #; ,      "check",        if $data($$$dRule($$$getDTOin("ontology",""),$$$getDTOin("type",""),action,"check")) { #;  check("map")        set check("map")=$name($$$dRule($$$getDTOin("ontology",""),$$$getDTOin("type",""),action,"check")) } else { #;  check("map")              set check("map")=$name($$$dRule("SimpleOntology","SimpleType",action,"check")) } set check("i")="" for { #;     set check("i")=$order(@check("map")@(check("i"))) #;   ,     quit:check("i")="" #;     xecute $get(@check("map")@(check("i"))) #;   ,     quit:check&lt;0 } #;    quit check #; -------------------------------------------------------------------------------------------------- #;      . #; -------------------------------------------------------------------------------------------------- checkCreate()private new t #;       quit:$$$getDTOin("ontology","")="" -1 #;  ,      quit:$$$getDTOin("type","")="" -1 #;     st("check")=$$checkParent() #;  ,     quit:t("check")&lt;0 t("check") #;     set t("check")=$$checkNames() #;  ,     quit:t("check")&lt;0 t("check") #;       $$$setDTOproc("id",$$$dMaxID) #;      ^Dictionary if $$$getDTOproc("pathParent","")="" { #;    -     ^Dictionary(ontology) set t("path")=$name($$$dData($$$getDTOin("ontology",""))) } else { #;      -         children set t("path")=$name(@($$$getDTOproc("pathParent",""))@(0,"children")) } #;           st("path")=$name(@(t("path"))@($$$getDTOin("type",""),$$$getDTOproc("id",""))) $$$setDTOproc("path",t("path")) #;     quit 0 #; -------------------------------------------------------------------------------------------------- #;   ,   . #;     . #; -------------------------------------------------------------------------------------------------- checkParent()private new t #;           (  ) st("parent")=$get($$$dRule($$$getDTOin("ontology",""),$$$getDTOin("type",""),"parent"),"") #;    if t("parent")`="" { #;    parentId      set t("parentId")=$$$getDTOin("parentId","") #;       if t("parentId")="" { quit -1 } #;       #;        if $get($$$dIndex("ID",t("parentId"),"ontology"),"")`=$$$getDTOin("ontology","") { quit -1 } #;       if $get($$$dIndex("ID",t("parentId"),"type"),"")`=t("parent") { quit -1 } #;     st("pathParent")=$get($$$dIndex("ID",t("parentId"),"path"),"") #;      if t("pathParent")="" { quit -1 } #;          $$$setDTOproc("pathParent",t("pathParent")) } #;      quit 0 #; -------------------------------------------------------------------------------------------------- checkUpdate() quit 0 #; -------------------------------------------------------------------------------------------------- checkDelete() quit 0 #; -------------------------------------------------------------------------------------------------- #;     . #; -------------------------------------------------------------------------------------------------- checkNames()private new t #;   t("check")  #;         set t("check")=-1 set t("lang")="" for { #;    set t("lang")=$order($$$dDTO($job,"in","nameList",t("lang"))) #;   ,     quit:t("lang")="" #;      set t("name")=$get($$$dDTO($job,"in","nameList",t("lang")),"") #;    if t("name")="" { #;   t("check")  set t("check")=-1 #;    quit } else { #;  t("check")   ,     set t("check")=0 } } #;     quit t("check") #; -------------------------------------------------------------------------------------------------- #;    . #; -------------------------------------------------------------------------------------------------- processingNames(function) new t set t("lang")="" for { #;     set t("lang")=$order($$$dDTO($job,"in","nameList",t("lang"))) quit:t("lang")="" #;        xecute "set "_$name($$$dDTO($job,"in","nameList",t("lang")))_"=$$"_function_"("""_$$$getDTOname(t("lang"))_""")" } quit #; -------------------------------------------------------------------------------------------------- checkUniqueNameElementAllLang(inparent="false") new t set t("check")=0 st("ontology")=$$$getDTOin("ontology","") st("type")=$$$getDTOin("type","") set t("lang")="" for { #;     set t("lang")=$order($$$dDTO($job,"in","nameList",t("lang"))) quit:t("lang")="" #;    set t("name")=$get($$$dDTO($job,"in","nameList",t("lang")),"") #;   t("check")     (0 -  ) st("check")=$$checkUniqueNameElement(t("ontology"),t("type"),t("lang"),t("name"),$$$getDTOproc("id",""),inparent) #;     -    quit:t("check")&lt;0 } quit t("check") #; -------------------------------------------------------------------------------------------------- #;         . #; -------------------------------------------------------------------------------------------------- clearPunctuationAndControlChar(str) new t #;  t("str")     set t("str")="" #;      for t("i")=1:1:$length(str) { #;    set t("ch")=$extract(str,t("i")) if `((t("ch")?1P)||(t("ch")?1C)) { #;       set t("str")=t("str")_t("ch") } } #;    quit t("str") #; -------------------------------------------------------------------------------------------------- #; -------------------------------------------------------------------------------------------------- #;       . #;      . #;        (     ). #;      ,   "."   . #; -------------------------------------------------------------------------------------------------- specialClearStr(str) new t set t("str")="",t("flag")="start",t("delim")="" for t("i")=1:1:$length(str) { set t("ch")=$extract(str,t("i")) ;#     set:t("ch")=$char(9) t("ch")=" " continue:(t("ch")?1C) if (t("flag")="start")&amp;&amp;`(t("ch")?1P) { set t("str")=t("ch"),t("flag")="word" } elseif t("flag")="word" { if `(t("ch")?1P) { set t("str")=t("str")_t("ch") } else { set t("delim")=t("ch"),t("flag")="delim" } } elseif t("flag")="delim" { if (t("ch")?1P) { set:t("ch")`=" " t("delim")=t("ch") } else { set t("str")=t("str")_t("delim")_t("ch"),t("flag")="word",t("delim")="" } } } set:t("delim")="." t("str")=t("str")_t("delim") quit t("str") #; -------------------------------------------------------------------------------------------------- #;      . #; -------------------------------------------------------------------------------------------------- checkUniqueParamElement(param,ontology,type) new t #;    set t("value")=$$$getDTOin(param,"") #;   ,     -    quit:t("value")="" 0 #;    set t("q")=0 set t("uniqueId")="" for { #; ,         #;   , ,    set t("uniqueId")=$order($$$dIndex(ontology,type,param,t("value"),t("uniqueId"))) #;     quit:t("uniqueId")="" #; ,      #;     update if (t("uniqueId")`=$$$getDTOproc("id","")) { #;  ,       set t("q")=-1 quit } } quit t("q") #; -------------------------------------------------------------------------------------------------- #;      ,   ,   . #;  ,   . #; -------------------------------------------------------------------------------------------------- checkUniqueNameElement(ontology,type,lang,name,id,inparent="false") new t #;    set t("q")=0 set t("uniqueId")="" for { #; ,         #;   , ,   (  ) set t("uniqueId")=$order($$$dIndex(ontology,type,"name",lang,$zconvert(name,"l"),t("uniqueId"))) #;     quit:t("uniqueId")="" #; ,      #;     update if (t("uniqueId")`=id) { #;          if inparent="false" { #;  ,       set t("q")=-1 quit } else { #;        if $data($$$dIndex(ontology,type,"parentId",$$$getDTOin("parentId",""),t("uniqueId"))) { #;          #;    /  set t("q")=-1 quit } } } } #;   quit t("q") #; -------------------------------------------------------------------------------------------------- #;  ,     . #;         . #; -------------------------------------------------------------------------------------------------- setProperty(ontology,type,property,value,id,index="true",pathParent="")private #;      ()    if pathParent="" { #;    set $$$dData(ontology,type,id,0,property)=value } else { #;    set @(pathParent)@(0,"children",type,id,0,property)=value } #;    if index="true" { #;   set $$$dIndex(ontology,type,property,value,id)=1 #;      set $$$dRefs(id,$name($$$dIndex(ontology,type,property,value,id)))=1 } quit 0 #; -------------------------------------------------------------------------------------------------- #;   ,     . #;  (  )   . #; -------------------------------------------------------------------------------------------------- setName(ontology,type,lang,value,id)private #;         set $$$dName(id,lang,0)=value #;   / set $$$dName(id,lang,0,"UpdateTime")=$horolog #;     set $$$dIndex(ontology,type,"name",lang,$zconvert(value,"l"),id)=1 #;    set $$$dRefs(id,$name($$$dIndex(ontology,type,"name",lang,$zconvert(value,"l"),id)))=1 quit 0 #; -------------------------------------------------------------------------------------------------- saveOntoAndTypeID(id,ontology,type) set $$$dIndex("ID",id,"ontology")=ontology set $$$dRefs(id,$name($$$dIndex("ID",id,"ontology")))=1 set $$$dIndex("ID",id,"type")=type set $$$dRefs(id,$name($$$dIndex("ID",id,"type")))=1 quit #; -------------------------------------------------------------------------------------------------- saveElementPath(id,path) set $$$dIndex("ID",id,"path")=path set $$$dRefs(id,$name($$$dIndex("ID",id,"path")))=1 quit #; --------------------------------------------------------------------------------------------------</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the program listing, the symbol </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'was</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> replaced </font><font style="vertical-align: inherit;">with the symbol </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - this is necessary for a more beautiful display of the code. </font><font style="vertical-align: inherit;">In the case of copying the program code in Cach√© - it is necessary to make a reverse replacement: replace all the characters </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'</font></font></b> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add a couple of models, print our globals and see what nesting in the global </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">^ Dictionary</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> looks like </font><font style="vertical-align: inherit;">.</font></font><br><pre> <code class="bash hljs">MONTOLOGY&gt;<span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>) MONTOLOGY&gt;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"ontology"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"type"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Model"</span></span> MONTOLOGY&gt;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>)=6,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>)=6 MONTOLOGY&gt;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"parentId"</span></span>)=3 MONTOLOGY&gt;write $<span class="hljs-variable"><span class="hljs-variable">$create</span></span>^Dictionary() 5 MONTOLOGY&gt;<span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>) MONTOLOGY&gt;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"ontology"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"type"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Model"</span></span> MONTOLOGY&gt;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>)=<span class="hljs-string"><span class="hljs-string">"BMW"</span></span>,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>)=<span class="hljs-string"><span class="hljs-string">"bmw"</span></span> MONTOLOGY&gt;^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>)=3,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>)=3 MONTOLOGY&gt;write $<span class="hljs-variable"><span class="hljs-variable">$create</span></span>^Dictionary() 6 MONTOLOGY&gt;zw ^Dictionary ^Dictionary(<span class="hljs-string"><span class="hljs-string">"MaxID"</span></span>)=6 ^Dictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Make"</span></span>,3,0,<span class="hljs-string"><span class="hljs-string">"UpdateTime"</span></span>)=<span class="hljs-string"><span class="hljs-string">"62970,58071"</span></span> ^Dictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Make"</span></span>,3,0,<span class="hljs-string"><span class="hljs-string">"children"</span></span>,<span class="hljs-string"><span class="hljs-string">"Model"</span></span>,5,0,<span class="hljs-string"><span class="hljs-string">"UpdateTime"</span></span>)=<span class="hljs-string"><span class="hljs-string">"62970,58071"</span></span> ^Dictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Make"</span></span>,3,0,<span class="hljs-string"><span class="hljs-string">"children"</span></span>,<span class="hljs-string"><span class="hljs-string">"Model"</span></span>,5,0,<span class="hljs-string"><span class="hljs-string">"parentId"</span></span>)=3 ^Dictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Make"</span></span>,3,0,<span class="hljs-string"><span class="hljs-string">"children"</span></span>,<span class="hljs-string"><span class="hljs-string">"Model"</span></span>,5,0,<span class="hljs-string"><span class="hljs-string">"uid"</span></span>)=888 ^Dictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Make"</span></span>,3,0,<span class="hljs-string"><span class="hljs-string">"children"</span></span>,<span class="hljs-string"><span class="hljs-string">"Model"</span></span>,6,0,<span class="hljs-string"><span class="hljs-string">"UpdateTime"</span></span>)=<span class="hljs-string"><span class="hljs-string">"62970,58071"</span></span> ^Dictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Make"</span></span>,3,0,<span class="hljs-string"><span class="hljs-string">"children"</span></span>,<span class="hljs-string"><span class="hljs-string">"Model"</span></span>,6,0,<span class="hljs-string"><span class="hljs-string">"parentId"</span></span>)=3 ^Dictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Make"</span></span>,3,0,<span class="hljs-string"><span class="hljs-string">"children"</span></span>,<span class="hljs-string"><span class="hljs-string">"Model"</span></span>,6,0,<span class="hljs-string"><span class="hljs-string">"uid"</span></span>)=888 ^Dictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Make"</span></span>,3,0,<span class="hljs-string"><span class="hljs-string">"lastId"</span></span>)=122 ^Dictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Make"</span></span>,3,0,<span class="hljs-string"><span class="hljs-string">"uid"</span></span>)=888 ^Dictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Make"</span></span>,4,0,<span class="hljs-string"><span class="hljs-string">"UpdateTime"</span></span>)=<span class="hljs-string"><span class="hljs-string">"62970,58071"</span></span> ^Dictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Make"</span></span>,4,0,<span class="hljs-string"><span class="hljs-string">"lastId"</span></span>)=1269 ^Dictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Make"</span></span>,4,0,<span class="hljs-string"><span class="hljs-string">"uid"</span></span>)=888 ^Dictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span>,1,0,<span class="hljs-string"><span class="hljs-string">"UpdateTime"</span></span>)=<span class="hljs-string"><span class="hljs-string">"62970,58071"</span></span> ^Dictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span>,1,0,<span class="hljs-string"><span class="hljs-string">"uid"</span></span>)=888 ^Dictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span>,2,0,<span class="hljs-string"><span class="hljs-string">"UpdateTime"</span></span>)=<span class="hljs-string"><span class="hljs-string">"62970,58071"</span></span> ^Dictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span>,2,0,<span class="hljs-string"><span class="hljs-string">"uid"</span></span>)=888 MONTOLOGY&gt;zw ^IndexDictionary ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,1,<span class="hljs-string"><span class="hljs-string">"ontology"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,1,<span class="hljs-string"><span class="hljs-string">"path"</span></span>)=<span class="hljs-string"><span class="hljs-string">"^|"</span></span><span class="hljs-string"><span class="hljs-string">"MONTOLOGY"</span></span><span class="hljs-string"><span class="hljs-string">"|Dictionary("</span></span><span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span><span class="hljs-string"><span class="hljs-string">",1)"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,1,<span class="hljs-string"><span class="hljs-string">"type"</span></span>)=<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,2,<span class="hljs-string"><span class="hljs-string">"ontology"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,2,<span class="hljs-string"><span class="hljs-string">"path"</span></span>)=<span class="hljs-string"><span class="hljs-string">"^|"</span></span><span class="hljs-string"><span class="hljs-string">"MONTOLOGY"</span></span><span class="hljs-string"><span class="hljs-string">"|Dictionary("</span></span><span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span><span class="hljs-string"><span class="hljs-string">",2)"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,2,<span class="hljs-string"><span class="hljs-string">"type"</span></span>)=<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,3,<span class="hljs-string"><span class="hljs-string">"ontology"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,3,<span class="hljs-string"><span class="hljs-string">"path"</span></span>)=<span class="hljs-string"><span class="hljs-string">"^|"</span></span><span class="hljs-string"><span class="hljs-string">"MONTOLOGY"</span></span><span class="hljs-string"><span class="hljs-string">"|Dictionary("</span></span><span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"Make"</span></span><span class="hljs-string"><span class="hljs-string">",3)"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,3,<span class="hljs-string"><span class="hljs-string">"type"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Make"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,4,<span class="hljs-string"><span class="hljs-string">"ontology"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,4,<span class="hljs-string"><span class="hljs-string">"path"</span></span>)=<span class="hljs-string"><span class="hljs-string">"^|"</span></span><span class="hljs-string"><span class="hljs-string">"MONTOLOGY"</span></span><span class="hljs-string"><span class="hljs-string">"|Dictionary("</span></span><span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"Make"</span></span><span class="hljs-string"><span class="hljs-string">",4)"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,4,<span class="hljs-string"><span class="hljs-string">"type"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Make"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,5,<span class="hljs-string"><span class="hljs-string">"ontology"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,5,<span class="hljs-string"><span class="hljs-string">"path"</span></span>)=<span class="hljs-string"><span class="hljs-string">"^|"</span></span><span class="hljs-string"><span class="hljs-string">"MONTOLOGY"</span></span><span class="hljs-string"><span class="hljs-string">"|Dictionary("</span></span><span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"Make"</span></span><span class="hljs-string"><span class="hljs-string">",3,0,"</span></span><span class="hljs-string"><span class="hljs-string">"children"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"Model"</span></span><span class="hljs-string"><span class="hljs-string">",5)"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,5,<span class="hljs-string"><span class="hljs-string">"type"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Model"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,6,<span class="hljs-string"><span class="hljs-string">"ontology"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,6,<span class="hljs-string"><span class="hljs-string">"path"</span></span>)=<span class="hljs-string"><span class="hljs-string">"^|"</span></span><span class="hljs-string"><span class="hljs-string">"MONTOLOGY"</span></span><span class="hljs-string"><span class="hljs-string">"|Dictionary("</span></span><span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"Make"</span></span><span class="hljs-string"><span class="hljs-string">",3,0,"</span></span><span class="hljs-string"><span class="hljs-string">"children"</span></span><span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">"Model"</span></span><span class="hljs-string"><span class="hljs-string">",6)"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>,6,<span class="hljs-string"><span class="hljs-string">"type"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Model"</span></span> ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Make"</span></span>,<span class="hljs-string"><span class="hljs-string">"lastId"</span></span>,122,3)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Make"</span></span>,<span class="hljs-string"><span class="hljs-string">"lastId"</span></span>,1269,4)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Make"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>,<span class="hljs-string"><span class="hljs-string">"bmw"</span></span>,4)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Make"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>,<span class="hljs-string"><span class="hljs-string">"mazda"</span></span>,3)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Make"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>,<span class="hljs-string"><span class="hljs-string">"bmw"</span></span>,4)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Make"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>,<span class="hljs-string"><span class="hljs-string">"mazda"</span></span>,3)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Make"</span></span>,<span class="hljs-string"><span class="hljs-string">"uid"</span></span>,888,3)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Make"</span></span>,<span class="hljs-string"><span class="hljs-string">"uid"</span></span>,888,4)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Model"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>,3,6)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Model"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>,6,5)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Model"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>,3,6)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Model"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>,6,5)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Model"</span></span>,<span class="hljs-string"><span class="hljs-string">"parentId"</span></span>,3,5)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Model"</span></span>,<span class="hljs-string"><span class="hljs-string">"parentId"</span></span>,3,6)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Model"</span></span>,<span class="hljs-string"><span class="hljs-string">"uid"</span></span>,888,5)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Model"</span></span>,<span class="hljs-string"><span class="hljs-string">"uid"</span></span>,888,6)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>,<span class="hljs-string"><span class="hljs-string">"akp"</span></span>,1)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>,<span class="hljs-string"><span class="hljs-string">"meh"</span></span>,2)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>,1)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>,2)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span>,<span class="hljs-string"><span class="hljs-string">"uid"</span></span>,888,1)=1 ^IndexDictionary(<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span>,<span class="hljs-string"><span class="hljs-string">"uid"</span></span>,888,2)=1 MONTOLOGY&gt;</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We have added two models of the brand </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAZDA</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (the numbers are the names of the models).</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All cleaning commands and creating directories in one place</font></font></b> <div class="spoiler_text"><pre> <code class="bash hljs"> <span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> ^Dictionary,^IndexDictionary,^NameDictionaryElement,^RefsDictionary d ^InitRuleDic <span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"ontology"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"type"</span></span>)=<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>)=<span class="hljs-string"><span class="hljs-string">" ,"</span></span>,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>)=<span class="hljs-string"><span class="hljs-string">"akp"</span></span> write $<span class="hljs-variable"><span class="hljs-variable">$create</span></span>^Dictionary(),! <span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"ontology"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"type"</span></span>)=<span class="hljs-string"><span class="hljs-string">"TransmissionType"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>)=<span class="hljs-string"><span class="hljs-string">""</span></span>,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>)=<span class="hljs-string"><span class="hljs-string">"meh"</span></span> write $<span class="hljs-variable"><span class="hljs-variable">$create</span></span>^Dictionary(),! <span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"ontology"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"type"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Make"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>)=<span class="hljs-string"><span class="hljs-string">"MAZDA"</span></span>,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>)=<span class="hljs-string"><span class="hljs-string">"mazda"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"lastId"</span></span>)=122 write $<span class="hljs-variable"><span class="hljs-variable">$create</span></span>^Dictionary(),! <span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"ontology"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"type"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Make"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>)=<span class="hljs-string"><span class="hljs-string">"BMW"</span></span>,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>)=<span class="hljs-string"><span class="hljs-string">"bmw"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"lastId"</span></span>)=1269 write $<span class="hljs-variable"><span class="hljs-variable">$create</span></span>^Dictionary(),! <span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"ontology"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"type"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Model"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>)=6,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>)=6 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"parentId"</span></span>)=3 write $<span class="hljs-variable"><span class="hljs-variable">$create</span></span>^Dictionary(),! <span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"ontology"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Vehicle"</span></span>,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"type"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Model"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>)=3,^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"nameList"</span></span>,<span class="hljs-string"><span class="hljs-string">"partUri"</span></span>)=3 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ^tmwOntology(<span class="hljs-variable"><span class="hljs-variable">$job</span></span>,<span class="hljs-string"><span class="hljs-string">"in"</span></span>,<span class="hljs-string"><span class="hljs-string">"parentId"</span></span>)=3 write $<span class="hljs-variable"><span class="hljs-variable">$create</span></span>^Dictionary(),! zwrite ^Dictionary,^IndexDictionary,^NameDictionaryElement,^RefsDictionary</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I think many of you paid attention to the fact that in these articles, issues of transactions, locks and error handling are completely unaffected (returning -1 in the case of any error is clearly not enough). </font><font style="vertical-align: inherit;">These are the issues we will discuss in the next article, unless there are other wishes in the comments. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I remind you that globals and codes from these articles are used in a live project (although starting with this article, the identifiers of the created elements will differ from those used in the real system). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I would be happy to ask questions and comments, tell me how you are implementing this in your database (even if there are no globals, but there is SQL).</font></font><br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/179949/">https://habr.com/ru/post/179949/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../179929/index.html">Resume for the programmer? No, have not heard</a></li>
<li><a href="../179931/index.html">Google I / O 2013 First day. Brief summary</a></li>
<li><a href="../179933/index.html">Cloud Server Rescue Update: Automatic Network Configuration</a></li>
<li><a href="../179937/index.html">Two tasks for a developer interview</a></li>
<li><a href="../179947/index.html">IBM has released a social application for public control / monitoring of water supply (currently only in South Africa)</a></li>
<li><a href="../179951/index.html">Lexand LPB-78W: router and "socket" to the country and in travel</a></li>
<li><a href="../179953/index.html">About one disadvantage of VK API out loud</a></li>
<li><a href="../179961/index.html">iOS Saturday in Vinnitsa</a></li>
<li><a href="../179965/index.html">Technical partner problems and their warning in mini-stories</a></li>
<li><a href="../179967/index.html">Motivation of people and animals - inside view</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>