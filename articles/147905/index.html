<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Panoramas on Yandex.Maps using KRPano</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The task was set: to come up with the integration of Yandex.Map and the popular panorama viewer KRPano . First of all, of course, we climb into the AP...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Panoramas on Yandex.Maps using KRPano</h1><div class="post__text post__text-html js-mediator-article">  The task was set: to come up with the integration of <a href="http://maps.yandex.ru/">Yandex.Map</a> and the popular panorama <a href="http://krpano.com/">viewer KRPano</a> .  First of all, of course, we climb into the API and ... we get a ton of <a href="">answers</a> that panorama can not be done with the help of Ya.Kart. <br>  Do not worry, because  panoramas will be used home-made, but the main thing that needs to be done is the so-called.  a radar that will indicate where the panorama is currently looking. <br><img src="http://yandex.st/maps/2.20.9/controls/panorama-marker/icon_large.png"><br>  <i>Radar with panoramas Y.Kart</i> <br><a name="habracut"></a><br>  So, there is a certain KRPano tour, each panorama of which should be displayed on the map by some standard icon.  When you click a certain panorama should load, as well as change the icon to the image of the radar (with the correct rotation on the map).  When viewing a panorama, the radar should also rotate around its axis as the viewing angle changes. <br><br>  To begin with, when the <b>onxmlcomplete</b> event is <b>triggered</b> , <b>let</b> 's make a call to a certain JS function, for example, <b>loaded</b> , which will accept the ID of the loaded panorama: <br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pano</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"solar_tower_1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlurl</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"%SWFPATH%/scenes/solar_tower_1/scene.xml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pageurl</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/solar_tower_1/"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pagetitle</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"  #1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onxmlcomplete</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"trace(  #1 loaded); js(loaded(0))"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  What will this feature do?  Nothing complicated - it only rebuilds the points (Placemark) on the map and starts the function of checking the viewing angle of the panorama (with an interval of 100 ms, for example): <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loaded</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id</span></span></span><span class="hljs-function">) </span></span>{ activeId = id; <span class="hljs-comment"><span class="hljs-comment">//  ID  ,   addPmark(id); } function addPmark(id) { clearTimeout(degreeInterval); //        resetAll(); //       if (typeof inactiveMarks[id] != 'undefined') map.geoObjects.remove(inactiveMarks[id]); //    hotspot' map.geoObjects.remove(pMark); //     hotspot' //    -         pMark = new ymaps.Placemark(pmarks[id].coords, { iconContent: '&lt;img src="map/icon_large.png" id="pMarkIcon"&gt;', }, { iconImageHref: 'map/pixel.png', iconImageSize: [93, 93], iconImageOffset: [-54, -35] }); map.geoObjects.add(pMark); degreeInterval = setInterval(updateDegree, 100); //     } function resetAll() { var size = pmarks.length; for (var i = 0; i &lt; size; ++i) { if (typeof inactiveMarks[i] != 'undefined') map.geoObjects.remove(inactiveMarks[i]); inactiveMarks[i] = new ymaps.Placemark(pmarks[i].coords, { iconContent: '&lt;img src="map/binocular.png" style=" background:url(\'map/blue-bg.png\');"&gt;' }, { iconImageHref: 'map/placemark-bg-blue.png', iconImageSize: [44, 55], iconImageOffset: [-17, -37], panoPath: pmarks[i].xml //      }); if (typeof pmarks[i] != 'undefined') { inactiveMarks[i].events.add('click', function(p) { //          kr.call('loadpano(' + p.originalEvent.target.options.get('panoPath') + ')'); }); } map.geoObjects.add(inactiveMarks[i]); } }</span></span></code> </pre><br>  What we did: the panorama was loaded, we first built the dots by default, then changed the icon to the active one, saved its ID and once every 100 ms we check for changing the viewing angle. <br><br>  The most interesting thing is the turn of the radar.  It happens as follows: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateDegree</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hlookat = kr.get(<span class="hljs-string"><span class="hljs-string">'view.hlookat'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// check offset offset = pmarks[activeId].offset; //   ,              hlookat -= offset; //      rotate   $('#pMarkIcon').css({ '-moz-transform': 'rotate(' + hlookat + 'deg)', '-webkit-transform': 'rotate(' + hlookat + 'deg)', '-o-transform': 'rotate(' + hlookat + 'deg)', '-ms-transform': 'rotate(' + hlookat + 'deg)' }); }</span></span></code> </pre><br>  The points in this example are stored in a simple array with coordinates, offset in degrees and paths to the scenes: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pmarks = [ {<span class="hljs-attr"><span class="hljs-attr">coords</span></span>: [<span class="hljs-number"><span class="hljs-number">107.60835728615834</span></span>, <span class="hljs-number"><span class="hljs-number">51.80498497161981</span></span>], <span class="hljs-attr"><span class="hljs-attr">offset</span></span>: <span class="hljs-number"><span class="hljs-number">29.612430</span></span>, <span class="hljs-attr"><span class="hljs-attr">iconContent</span></span>: <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">xml</span></span>: <span class="hljs-string"><span class="hljs-string">'%SWFPATH%/scenes/solar_tower_1/scene.xml'</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">coords</span></span>: [<span class="hljs-number"><span class="hljs-number">107.60834053847577</span></span>, <span class="hljs-number"><span class="hljs-number">51.80625216324661</span></span>], <span class="hljs-attr"><span class="hljs-attr">offset</span></span>: <span class="hljs-number"><span class="hljs-number">52.541204</span></span>, <span class="hljs-attr"><span class="hljs-attr">iconContent</span></span>: <span class="hljs-string"><span class="hljs-string">'2'</span></span>, <span class="hljs-attr"><span class="hljs-attr">xml</span></span>: <span class="hljs-string"><span class="hljs-string">'%SWFPATH%/scenes/solar_tower_2/scene.xml'</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">coords</span></span>: [<span class="hljs-number"><span class="hljs-number">107.60839418265618</span></span>, <span class="hljs-number"><span class="hljs-number">51.807256449274895</span></span>], <span class="hljs-attr"><span class="hljs-attr">offset</span></span>: <span class="hljs-number"><span class="hljs-number">58.053150</span></span>, <span class="hljs-attr"><span class="hljs-attr">iconContent</span></span>: <span class="hljs-string"><span class="hljs-string">'3'</span></span>, <span class="hljs-attr"><span class="hljs-attr">xml</span></span>: <span class="hljs-string"><span class="hljs-string">'%SWFPATH%/scenes/solar_tower_3/scene.xml'</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">coords</span></span>: [<span class="hljs-number"><span class="hljs-number">107.60832980963896</span></span>, <span class="hljs-number"><span class="hljs-number">51.807974732832555</span></span>], <span class="hljs-attr"><span class="hljs-attr">offset</span></span>: <span class="hljs-number"><span class="hljs-number">-59.017464</span></span>, <span class="hljs-attr"><span class="hljs-attr">iconContent</span></span>: <span class="hljs-string"><span class="hljs-string">'4'</span></span>, <span class="hljs-attr"><span class="hljs-attr">xml</span></span>: <span class="hljs-string"><span class="hljs-string">'%SWFPATH%/scenes/solar_tower_4/scene.xml'</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">coords</span></span>: [<span class="hljs-number"><span class="hljs-number">107.60930374795694</span></span>, <span class="hljs-number"><span class="hljs-number">51.808262554869444</span></span>], <span class="hljs-attr"><span class="hljs-attr">offset</span></span>: <span class="hljs-number"><span class="hljs-number">52.025996</span></span>, <span class="hljs-attr"><span class="hljs-attr">iconContent</span></span>: <span class="hljs-string"><span class="hljs-string">'5'</span></span>, <span class="hljs-attr"><span class="hljs-attr">xml</span></span>: <span class="hljs-string"><span class="hljs-string">'%SWFPATH%/scenes/russian_dramatic_theater_1/scene.xml'</span></span>} ];</code> </pre><br>  <a href="http://paste2.org/p/2074791">The code is complete.</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Well, it all looks like this (unfortunately, I can‚Äôt give a link to the demo, therefore only screenshots): <br><br>  Panorama 1: <br><img src="https://habrastorage.org/storage2/c67/192/972/c67192972ab763352e7722cc12c18113.png"><br><br><img src="https://habrastorage.org/storage2/f66/706/848/f66706848876981cefea26a8ba957c42.png"><br><br>  Panorama 2: <br><img src="https://habrastorage.org/storage2/72a/03a/5cf/72a03a5cf13c3a5d9503bc4a23b9927e.png"><br><br><img src="https://habrastorage.org/storage2/21f/697/9db/21f6979db6f7d4790fd80189fee6a484.png"></div><p>Source: <a href="https://habr.com/ru/post/147905/">https://habr.com/ru/post/147905/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../147899/index.html">AWS ELB: Forced disconnection of the instance from the balancer</a></li>
<li><a href="../147900/index.html">800,000 signed a petition for the right to download videos from Youtube</a></li>
<li><a href="../147901/index.html">A fresh look at impurities in javascript</a></li>
<li><a href="../147902/index.html">Automated testing of ASP.NET applications via CUITe - features</a></li>
<li><a href="../147904/index.html">MIT creates an electronic "co-pilot"; Google talks about drones</a></li>
<li><a href="../147906/index.html">Probability theory under your arm</a></li>
<li><a href="../147907/index.html">Simulator for keyboard shortcuts</a></li>
<li><a href="../147908/index.html">Roskomnadzor demanded that Livejournal and YouTube delete personal data of Russians</a></li>
<li><a href="../147911/index.html">Mobile Internet in Finland. 3G by Saunalahti</a></li>
<li><a href="../147912/index.html">jQuery CoreUISelect - plugin for styling select</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>