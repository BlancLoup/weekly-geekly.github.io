<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Recommendations for using SQLite on mobile devices</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In burzhunete there is an interesting document on optimizing SQLite on the BlackBerry platform. However, the ideas that it contains, generally speakin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Recommendations for using SQLite on mobile devices</h1><div class="post__text post__text-html js-mediator-article">  In burzhunete there is an interesting <a href="http://docs.blackberry.com/en/developers/deliverables/17952/BP_Optimizing_SQLite_database_performance_1219781_11.jsp">document</a> on optimizing SQLite on the BlackBerry platform.  However, the ideas that it contains, generally speaking, refer to any mobile platform.  We decided to develop this list and create a kind of reference text in runet with a set of useful, introductory tips for programming SQLite under mobile devices.  We accept your suggestions in the comments. <br><br><a name="habracut"></a><br><br><h5>  Always use UTF-8 encoding. </h5><br>  This is the best option in terms of speed and memory size (inside SQLite translates all requests into UTF-8, since it only has this encoding parser). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Store as little data as possible in the database </h5><br>  This advice is not from Captain Obvious.  Do not use SQLite simply because it is "fashionable."  Think of alternatives: XML, for example.  For using SQLite you have to pay with waste of resources. <br><br><h5>  Always explicitly manage transactions. </h5><br>  Otherwise, a separate, implicit transaction will be created and committed to each SQL command.  Group data changes. <br><br><h5>  Carefully consider creating indexes. </h5><br>  Indexes speed up sampling, but slow down data modification.  Sometimes it is useful to use covering indexes when data fields are included in the index definition: <br><br><pre><code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> idx <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tab(key1, key2, data1, data2, data3);</code> </pre> <br>  Now, if you select (by the condition on key1 and key2) the data of the data1, data2, data2 columns, SQLite can take their values ‚Äã‚Äãfrom the index itself (there is no need for additional reading of data from the table).  But such an index takes up more space.  Therefore, the following advice: <br><br><h5>  The best way to test something: test on a specific device </h5><br>  And, of course, not on an empty base.  Fill it with random data, if not suitable.  Otherwise, the performance in the real scenario will surprise you unpleasantly. <br><br><h5>  Think about how to store BLOBs </h5><br>  The official site <a href="http://www.sqlite.org/intern-v-extern-blob.html">provides a</a> test that shows that when using BLOBs you should: <br>  - put the page size larger (8192 or 16384); <br>  - large BLOBs stored in separate files. <br>  If you decide to store BLOBs in the database, create a separate table for them: <br><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> blobs(blobid <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BLOB</span></span>)</code> </pre><br>  and in the data tables, put the field with reference to the entry in this table.  This is advice from the SQLite developers themselves. <br><br><h5>  Use temporary tables </h5><br>  If you create a table, you specify "TEMP" <br><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> TEMP <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> tab(...)</code> </pre><br>  then the created table will be deleted automatically when the database is closed. <br><br><h5>  Use parameterized queries </h5><br>  That is, pass values ‚Äã‚Äãto SQL queries not in the form of literals inside SQL, but by binding them to parameters.  This will simultaneously protect your code from SQL injection attacks and increase speed. <br><br><h5>  Add AUTOINCREMENT to the PRIMARY KEY definition </h5><br>  Column <br><br><pre> <code class="hljs pgsql">id <span class="hljs-type"><span class="hljs-type">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRIMARY KEY</span></span></code> </pre><br>  is a synonym for the ROWID (unique record identifier) ‚Äã‚Äãfield.  The trick is that SQLite does not guarantee that new rows will receive new keys if records were previously deleted from the table.  If you need "real uniqueness" identifiers add to the definition of AUTOINCREMENT: <br><br><pre> <code class="hljs pgsql">id <span class="hljs-type"><span class="hljs-type">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRIMARY KEY</span></span> AUTOINCREMENT</code> </pre><br>  Now, under any circumstances, the new line will get a unique id (and rowid) value (well, or you will exhaust the 8-byte counter). <br><br><h5>  Use foreign keys (FOREIGN KEY) only if you really need it. </h5><br>  SQLite has a fairly advanced foreign key support mechanism.  By default, it is disabled (for compatibility).  On the one hand, foreign keys guarantee integrity.  On the other hand, they require resources.  If you do decide to use them, then ... <br><br><h5>  For each foreign key field, create an index </h5><br>  Suppose there are a couple of tables: <br><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">master</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">mid</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> ...); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> detail(fk_master <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> <span class="hljs-keyword"><span class="hljs-keyword">master</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">mid</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASCADE</span></span> ...);</code> </pre><br>  When deleting a record from the master table, SQLite should check whether some record in the detail table refers to it and makes an additional selection: <br><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">rowid</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> detail <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> fk_master = ?</code> </pre><br>  As a rule, developers forget to create an index using the FK key, and this selection takes a very long time. <br><br><h5>  Deleting data from a database does not reduce its file size. </h5><br>  To compress the database file, run <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">VACUUM</span></span></code> </pre><br>  This operation takes time. <br><br>  Well, the most important advice. <br><br><h5>  Think carefully about the database schema </h5><br>  Usually, first the data is normalized as much as possible, and then denormalization is performed for optimization.  For example, if a user often requires the name of his department, this name can be duplicated in the user table in a separate field.  Think about what data is changing most intensively in your database, perhaps they should be separated into a separate table. <br><br>  <b>Updated</b> <br><br><h5>  How to run multiple SQL statements? </h5><br>  Combine them into one line through ";". <br><br><h5>  How to quickly add a lot of records (bulk insert)? </h5><br>  Before inserting a large number of entries, execute <br><br><pre> <code class="hljs sql"> <span class="hljs-keyword"><span class="hljs-keyword">PRAGMA</span></span> <span class="hljs-keyword"><span class="hljs-keyword">synchronous</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">PRAGMA</span></span> journal_mode = <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>;</code> </pre><br>  Insert records.  The best performance can be achieved by compiling (prepare) an insert statement with parameters and repeatedly executing it with the required values.  After inserting, restore the settings (the default settings are given): <br><br><pre> <code class="hljs sql"> <span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">PRAGMA</span></span> <span class="hljs-keyword"><span class="hljs-keyword">synchronous</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">NORMAL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">PRAGMA</span></span> journal_mode = <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span>;</code> </pre><br>  Creating indexes on the table is better after insertion, but not before.  Note that when the log is turned off, the database may be corrupted if the application ‚Äúcrashes‚Äù during the insertion process. <br><br>  Ps.  Use a <a href="http://sqlitedog.com/ru/idx.html">modern manager</a> to administer the SQLite database. </div><p>Source: <a href="https://habr.com/ru/post/200954/">https://habr.com/ru/post/200954/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../200942/index.html">Launch ChromeOS from USB stick</a></li>
<li><a href="../200946/index.html">Gitphp in badoo</a></li>
<li><a href="../200948/index.html">Pick 3: How to "open" the microcircuit and what's inside? Soviet Z80, TTL Logic, FPGA Altera Cyclone I and others</a></li>
<li><a href="../200950/index.html">Training data architects: designing and modeling information systems using ER / Studio</a></li>
<li><a href="../200952/index.html">We work with the developer version of CKEditor 4</a></li>
<li><a href="../200956/index.html">IKEA self-assembling stools and tomorrow's substance programming technologies</a></li>
<li><a href="../200960/index.html">Video review of the new Nexus 5</a></li>
<li><a href="../200966/index.html">How to create a product concept and write TK for electronics development</a></li>
<li><a href="../200972/index.html">Free COLT licenses for Open-Source projects</a></li>
<li><a href="../200976/index.html">How to help children learn foreign languages? Take advantage of mobile applications, of course!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>