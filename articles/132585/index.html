<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Three lines of shamanism</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I learned how to do on one great website how to run WinWord and insert my own lines into the document: http://jmvidal.cse.sc.edu/csce790/PS4/ 

 What ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Three lines of shamanism</h1><div class="post__text post__text-html js-mediator-article">  I learned how to do on one great website how to run WinWord and insert my own lines into the document: <a href="http://jmvidal.cse.sc.edu/csce790/PS4/">http://jmvidal.cse.sc.edu/csce790/PS4/</a> <br><br><img align="left" src="https://habrastorage.org/storage1/635038ff/47885e7c/796605ca/7f3eabbb.png">  What is there, you ask, because <b>Microsoft OLE Automation technology</b> is described quite widely and has been used for more than 10 years.  And what is surprising here is that when the DO_WORD function was moved to another project, this led to an error, Word simply did not want to start.  This is despite the fact that the project is written in C ++, but, unfortunately, does not use MFC technology.  Why does nothing work, because the initialization of OLE takes place as indicated in all the manuals?  It turns out that this alone is not enough and you need to further initialize the MFC library.  How to do it? <br><a name="habracut"></a><br>  As a result, we have 2 programs, in the first one, which performs the role of our project and is presented in the form of source texts below, the call to the DO_WORD function comes directly from _tWinMain ().  In the second program, which was obtained from the link above, first a dialogue is created via MFC, and only then DO_WORD is called.  As expected, the first program refuses to work, the second one works fine. <br><br>  Then the second program was subjected to indescribable shamanism in the debugger.  As a result, the first one was finalized and we got the code offered below for your attention.  Only three lines of shamanism lead to a normal start of WinWord and full-fledged work. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      File wordmain.cpp: <br><pre><code class="hljs lua">#include <span class="hljs-string"><span class="hljs-string">"stdafx.h"</span></span> #include <span class="hljs-string"><span class="hljs-string">"msword9.h"</span></span> void DO_WORD(void) { AfxOleInit(); AfxEnableControlContainer(); //start word COleVariant covTrue((short)TRUE), covFALSE((short)FALSE), covOptional((long)DISP_E_PARAMNOTFOUND, VT_ERROR); _Application app; Documents Docs; _Document Doc; Selection Select; _Font Font; Find myFind; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!app.CreateDispatch(<span class="hljs-string"><span class="hljs-string">"Word.Application"</span></span>)) { AfxMessageBox (<span class="hljs-string"><span class="hljs-string">"Couldn't start Word"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ;//FALSE; } app.SetVisible(TRUE); CString fileName = <span class="hljs-string"><span class="hljs-string">"C:/MyDocFile.doc"</span></span>; Docs = app.GetDocuments(); Doc = Docs.Add(covOptional,covOptional,covOptional,covOptional); Select = app.GetSelection(); //Get Current font object <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> change it Font = Select.GetFont(); Font.SetBold(TRUE); Font.SetItalic(TRUE); Font.SetSize(<span class="hljs-number"><span class="hljs-number">18</span></span>); Select.TypeText(<span class="hljs-string"><span class="hljs-string">"Hello this is a Word doc.\n"</span></span>); /* Doc.SaveAs(COleVariant(fileName), covOptional,covOptional,covOptional, covOptional,covOptional,covFALSE,covOptional, covOptional,covOptional,covOptional); //Doc.Close(covFALSE, covOptional, covOptional); app.Quit(covFALSE,covOptional,covOptional); */ AfxOleTerm(); } extern <span class="hljs-string"><span class="hljs-string">"C"</span></span> int WINAPI _tWinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPTSTR lpCmdLine, int nCmdShow) { //   AFX_MODULE_STATE* pModuleState = AfxGetModuleState(); pModuleState-&gt;m_bDLL = <span class="hljs-number"><span class="hljs-number">0</span></span>; CWinApp *theApp = new CWinApp; DO_WORD(); delete theApp; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><br>  The compile.bat file is suitable for both Visual Studio 2010 and the old Visual Studio 6.0.  In it, we compile two files, the wordmain.cpp above, as well as msword9.cpp which can be obtained by following <a href="http://jmvidal.cse.sc.edu/csce790/PS4/">the link instructions</a> , namely pressing Ctrl-W and then on the Automation tab click the Add New Class button and then select the file ‚Äú C: \ Program Files \ Microsoft Office \ Office \ msword9.olb ‚Äùand select all classes by clicking first on the first and holding down the Shift key on the last element of the corresponding list of classes. <br><br>  Compile file compile.bat: <br><pre> <code class="hljs sql">rem Visual Studio 2010 <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-string"><span class="hljs-string">"C:\Program Files\Microsoft Visual Studio 10.0\VC\BIN\vcvars32.bat"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">rem</span></span> Visual Studio <span class="hljs-number"><span class="hljs-number">6.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">rem</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-string"><span class="hljs-string">"C:\Program Files\Microsoft Visual Studio\VC98\BIN\vcvars32.bat"</span></span> mkdir <span class="hljs-keyword"><span class="hljs-keyword">Release</span></span> cl /nologo /MD /W3 /GX /O2 /D <span class="hljs-string"><span class="hljs-string">"WIN32"</span></span> /D <span class="hljs-string"><span class="hljs-string">"NDEBUG"</span></span> /D <span class="hljs-string"><span class="hljs-string">"_WINDOWS"</span></span> /D <span class="hljs-string"><span class="hljs-string">"_AFXDLL"</span></span> /D <span class="hljs-string"><span class="hljs-string">"_MBCS"</span></span> /Fo<span class="hljs-string"><span class="hljs-string">".\Release\\"</span></span> /Fd<span class="hljs-string"><span class="hljs-string">".\Release\\"</span></span> /FD /c <span class="hljs-string"><span class="hljs-string">"wordmain.cpp"</span></span> <span class="hljs-string"><span class="hljs-string">"msword9.cpp"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> /nologo /subsystem:windows /incremental:<span class="hljs-keyword"><span class="hljs-keyword">no</span></span> /machine:I386 /<span class="hljs-keyword"><span class="hljs-keyword">out</span></span>:<span class="hljs-string"><span class="hljs-string">".\Release\wordmain.exe"</span></span> <span class="hljs-string"><span class="hljs-string">".\Release\wordmain.OBJ"</span></span> <span class="hljs-string"><span class="hljs-string">".\Release\msword9.obj"</span></span></code> </pre><br><br>  <b>UPD: I</b> posted the sources from this post, including msword9.cpp, <a href="http://files.mail.ru/49EXCR">in the statja.rar file</a> . </div><p>Source: <a href="https://habr.com/ru/post/132585/">https://habr.com/ru/post/132585/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132579/index.html">New payment system PrivatePay</a></li>
<li><a href="../132581/index.html">Art Wallpapers + Weather Widget</a></li>
<li><a href="../132582/index.html">Really three-dimensional volume image</a></li>
<li><a href="../132583/index.html">A set of PHD CTF Quals / Afterparty teams opens.</a></li>
<li><a href="../132584/index.html">Google hides bold future projects in a secret lab</a></li>
<li><a href="../132586/index.html">Video review of Android applications and games - kedDroid</a></li>
<li><a href="../132587/index.html">Why sell on social networks profitable?</a></li>
<li><a href="../132591/index.html">Update Active Directory Credentials</a></li>
<li><a href="../132593/index.html">Please me internet with filter</a></li>
<li><a href="../132594/index.html">Enter into the program hierarchical list</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>