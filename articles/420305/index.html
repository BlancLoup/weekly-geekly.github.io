<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to write programs at the junction of mobile development and algorithms? Yandex Contest and Stories</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From 10 to 22 September will be a Yandex. Blitz competition on mobile development. Registration is open . Blitz is a short way to Yandex: it will be e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to write programs at the junction of mobile development and algorithms? Yandex Contest and Stories</h1><div class="post__text post__text-html js-mediator-article">  From 10 to 22 September will be a Yandex. Blitz competition on mobile development.  Registration is <a href="https://yandex.ru/promo/jobs/blitz/2018/mobile/index%3Futm_source%3Dhabr">open</a> .  Blitz is a short way to Yandex: it will be enough for participants in the top 5 to successfully complete one interview section instead of the standard four in order to receive a job offer. <br><br>  On the occasion of the competition, we talked with colleagues about interesting tasks related immediately to mobile platforms and algorithms.  Today we will share their stories with readers of Habr. <br><br><img src="https://habrastorage.org/webt/3z/_5/ry/3z_5rygov_eu9yhgyzngfbv6vmy.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      There is an opinion that the development of mobile applications is something special, far from programming in a general sense, and specialists who write under Android and iOS never encounter the solution of algorithmic problems, limited to connecting ready-made libraries, screen layouts, writing simple business logic and research of bugs of a specific platform.  But not everything is so simple. <br><br><a name="habracut"></a>  Creating software for mobile devices is always fraught with limitations.  Even in top devices, not so powerful CPU and GPU and not so much memory as in a modern computer.  At the same time, budget smartphones with even weaker hardware make up the bulk of the market.  Their owners are particularly hard hit by a lack of resources. <br><br>  The development of a complex competitive project is impossible without the use of solutions that cope with the tasks faster than in quadratic time.  Users can go to a competitor if they don‚Äôt like the speed or how your application consumes battery power. <br><br>  Historically, Blitz is a competition for knowledge of algorithms and the ability to translate the idea of ‚Äã‚Äãa solution in code.  Blitz, which will be held in September, will not be an exception.  We tried to select tasks with algorithms similar to those that had to be used by Yandex mobile developers in real projects for Android and iOS. <br><br><h4>  Acceleration of the Sadzhest Browser </h4><br>  <b><i>Mikhail Efimov, lead developer</i></b> : <br><blockquote>  - I was engaged in the omnibox - browser search string.  Autocomplete works in it - just enter the beginning of the word, and we will suggest the whole word.  The initial task can be simplified to the following: having received a string at the input, find all the words from a predetermined set in which the entered string occurs as a substring.  To do this, we take all the suffixes of the word - all the substrings with which it ends.  For example, for the word "table" it will be "table" and "tol".  Suffixes of one and two characters - here we would have ‚Äúol‚Äù and ‚Äúl‚Äù - are not taken into account, because by them garbage falls into the sadjest. <br><br>  Thus, instead of one word, we get two.  If it consisted of five letters, you would get three, etc. Further, for example, you can build a well-known data structure trie, which allows you to search for them.  But this structure has a flaw - it can take up a lot of space in the memory. <br><br>  We, in turn, kept a sorted list of suffixes - suffix array.  An element in the array is not the entire suffix ‚Äî then the structure would take up too much memory, a quadratic number ‚Äî but just a couple of pointers.  The first one indicates the word or phrase to be used, the second one - to the character in the word or phrase from which the suffix begins.  This approach perfectly saves memory.  We have only two pointers, two eight-byte numbers instead of very long words. <br><br>  Then the question arises how to store the already sorted list.  It can be stored as a simple array - but new entries will then be inserted into it for a very long time.  Therefore, I chose to store an ‚Äúaugmented‚Äù binary search tree - augmented binary search tree.  As a key, each node of the tree contains a certain suffix of a certain word, and as a ‚Äúsupplement‚Äù, information on priorities is stored in the nodes.  All that needs to be done is to find the tree node corresponding to the entered prefix.  You can then analyze this and neighboring nodes in order to understand which words can be used for issuing. <br><br>  Among them are those with higher priority.  The priority is affected by the length of the indentation suffix from the beginning of the word.  Words with zero indent have a higher priority ‚Äî say, if a user entered ‚Äúst‚Äù, then the word ‚Äútable‚Äù will be much higher in priority than the word ‚Äúbridge‚Äù.  But in principle, you can enter a sequence of characters that the browser will reply with a word where this sequence occurs in the middle or the end.  For example - if there is no word that begins with this sequence. </blockquote><br><h4>  Displaying CCTV cameras on mobile Yandex.Maps </h4><br>  <i><b>Sergey Kuznetsov, Lead Developer</b> :</i> <br><blockquote>  - We had an algorithm that displayed the cameras on the map.  He worked in quadratic time, not very fast.  There was a thought that it is possible to improve it, and without resorting to some frills. <br><br>  If we talk about the formulation of the problem, then we had a lot of cameras that need to be displayed.  On the high scales of the map, they could intersect with each other, and it was ugly - it was required to display one camera instead of many intersecting ones. <br><br>  If this task is formalized, then it comes down to the following: there are n identical squares on the plane with sides parallel to the axes of coordinates, and you need to choose from them so many squares that they do not intersect inside it, and all other squares intersect at least one of squares of the original set.  The simplest solution algorithm ‚Äî when we selected a square and intersected it with all the others ‚Äî worked for n <sup>2</sup> .  But the problem can also be solved for n * log (n), using a certain class of algorithms, which in the literature is called the ‚Äúscanning straight line‚Äù.  If you do not know about this approach, then this problem, of course, can be solved, but if you know, it is much easier to solve.  Immediately you know in which direction to think. </blockquote><br><img src="https://habrastorage.org/webt/qp/5g/kq/qp5gkqw4zm-uhpoopbmma9jqk1q.png" width="350"><img src="https://habrastorage.org/webt/mr/sv/qt/mrsvqt_-ri1ognvqr4eokhkvj4m.png" width="350"><br><h5>  <sub><sup>Cameras on mobile Maps.</sup></sub>  <sub><sup>If you zoom out, only one icon remains.</sup></sub> </h5><br><h4>  Retrieving data from one of the sources of the Sadgest Browser </h4><br>  <i><b>Alexander Yashkin, head of the portal backend group</b> :</i> <br><blockquote>  - There are several "heavy" sources of prompts that are displayed when typing in the browser omnibox.  One such source is the user's local history.  Tips from history unloads historical provider - component came to us from Chromium.  What is the feature of the omnibox?  It should be very fast, prompt immediately as you type, so the sources are mostly synchronous.  When the browser starts, the provider builds a fast index of history tips for the last week.  In Chromium, the history index for omnibox used associative containers std :: set and std :: map from the standard C ++ library.  Red-ebony is usually used to store data inside such containers. <br><br>  Our task was to speed up the search through the history in the omnibox.  By histograms from users, we have seen that historical search takes the most time, and people really suffer on slow computers.  For some, the expectation was one-tenth of a second ‚Äî when you quickly type the characters in the omnibox, it is too long, and it can be even worse. <br><br>  I made several approaches, optimizations, upstream in Chromium.  In parallel, I made changes to our code.  Then the task passed to our developer Denis Yaroshevsky.  He is a passionate developer ‚Äî interested in C ++, STL, algorithms.  Having rummaged, he suggested to act radically: replace std :: set with flat_set, and std :: map with flat_map.  That is, just change the basic structure.  std :: set and std :: map store their elements in tree nodes, and flat_set and flat_map are, in essence, wrappers over a sorted vector.  Flat-containers are one of the most popular containers that are not included in the standard C ++ library.  Perhaps in the next standard, they still fall into it. <br><br>  At first there was some distrust: the proposed path seemed too simple, lay on the surface.  To prove its effectiveness, we made perf test: took the profile of one of our colleagues, built an index of history from it and drove popular queries on it.  Chose 10 queries and counted the times.  Denis showed me the result, the improvements were obvious, and I also believed in his idea. <br><br>  The problem found was not specific to Yandex. Browser.  It was reflected in any Chromium-based browser, so at first we, as members of the Chromium project, decided to make upstream.  But in Chromium many who commit, and part of the proposed ideas - wild.  The developers of Chromium have a rather cautious attitude towards everyone who offers to change something outside, all the more drastically.  At first, they did not want to take our patch.  They offered to prove their effectiveness and write a mini-design-doc, so that they could understand the idea, the benefits and criticize the proposal. <br><br>  In addition, they said: once you need, write and add separate implementations of flat-containers.  Do not add to our project any new libraries - implementations already exist in boost, eastl.  Flat-containers had to be added to the base-components of Chromium.  This is an analogue of the standard library, and chromiummen are very worried that nothing superfluous falls into it. <br><br>  Denis Yaroshevsky did all this, spent time writing a design document, wrote flat_set implementation in C ++ templates, applied a lot of template magic, wrote tests covering the functionality of containers, created another synthetic perf test - we could not send perf test with this one colleague profile.  Denis argued with the owners of the base code and the omnibox, significantly reworked the code based on the review results - and finally overcame them and updated the code in Chromium. <br><br>  This whole epic lasted six months.  Chromiums then wrote: ‚ÄúYes, we did see a 10‚Äì20% improvement on all histograms.  Cool, thanks!".  From them it is already through downstream came to us in the browser, and then happy end.  Indeed, the historical index has significantly accelerated on all configurations, on all platforms.  In this index, the advantages of flat-containers appeared much better than the disadvantages. <br><br>  After the upstream, flat_set and flat_map were used much more often - now you can find several hundred places in the code where they are involved.  The moral is patience and hard work, and carefully choose not only algorithms for your code, but also suitable data structures. </blockquote><br><img src="https://habrastorage.org/webt/ax/2-/3k/ax2-3k3so-zw4zsgqtgmkajj7uo.png"><br><h5>  <sub><sup>See the left side of the graph.</sup></sub>  <sub><sup>The sharp decrease in the load time of the omnibox results in early 2017 is connected precisely with the transition to flat_set and flat_map</sup></sub> </h5><br><h4>  Acceleration of one of HashMap in Chromium </h4><br>  <i><b>Oleg Maksimenko, Lead Developer</b> :</i> <br><blockquote> - The task was to speed up the preservation of ordinary HTML pages in one of our subprojects.  I used the standard code profiling tools - I looked at which pieces of code were ‚Äúhot‚Äù during the save process.  Stumbled upon an unexpected place.  That is, this is not the main logic, but simply a search on the HashMap container, which should occupy a small percentage of the total work time.  Instead, there were really strong costs. <br><br>  I decided to replace the existing implementation.  It was an internal HashMap, from Chromium.  I replaced it and received a win several times.  Then I went a little further and made sure that this was not the mistake of the guys from Google, that it was not the implementation of the entire HashMap, but the hash function.  This is an external thing.  And it turned out that they had a trivial hash in the code we used, the address in memory was used as a hash.  Perhaps due to some peculiarities, for example, a small volume, this solution suited them.  Maybe their HashMap was not a hot place, but it became with us when we applied this structure.  By simply replacing the naive and trivial hash function with std :: hash, we obtained a speed increase of 3‚Äì10 times.  As a result, this appeal to the hash-memory was lost from the list of hot spots, it began to occupy a small percentage, as expected at first.  Everything became good and beautiful. </blockquote></div><p>Source: <a href="https://habr.com/ru/post/420305/">https://habr.com/ru/post/420305/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../420295/index.html">NeoQUEST-2018: the long-awaited Cold Boot, science research and guests from Nizhny Novgorod</a></li>
<li><a href="../420297/index.html">Step-by-step instructions for restoring access to a Linux Amazon EC2 instance when you lose a pem file</a></li>
<li><a href="../420299/index.html">My favorite examples of functional programming in the Kotlin language</a></li>
<li><a href="../420301/index.html">Indian Prime Minister Narendra Modi: we will send the flag of the country into space aboard the Gaganyana in 2022</a></li>
<li><a href="../420303/index.html">Load distribution when parsing websites and connecting additional cloud resources</a></li>
<li><a href="../420307/index.html">5 CSS tricks you should know about</a></li>
<li><a href="../420311/index.html">How our intuition deceives us in matters of global warming</a></li>
<li><a href="../420313/index.html">Making literary hours based on e-books</a></li>
<li><a href="../420315/index.html">Making a 3D configurator without programming and layout</a></li>
<li><a href="../420317/index.html">Developed a new instant blood test for brain damage.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>