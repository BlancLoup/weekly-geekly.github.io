<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Financial Transmission Ways # 3: Plaza II Protocol</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In addition to international standards and financial information transfer protocols such as FIX and FAST , which we described earlier, the so-called ‚Äú...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Financial Transmission Ways # 3: Plaza II Protocol</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://habrahabr.ru/company/itinvest/blog/261709/"><img src="https://habrastorage.org/files/476/fc9/428/476fc94283dd40a084130abf540307d9.png"></a> <br><br>  In addition to international standards and financial information transfer protocols such as <a href="http://habrahabr.ru/company/itinvest/blog/242789/">FIX</a> and <a href="http://habrahabr.ru/company/itinvest/blog/243657/">FAST</a> , which we described earlier, the so-called ‚Äúnative‚Äù financial data transfer protocols operate on the stock market.  They are used to obtain the necessary information by both private traders and brokerage companies - such native protocols are more functional than the generally accepted standards (such as the same FIX) that attract brokers. <br><br>  The exchanges of MICEX and RTS that existed in Russia, which now merged into the Moscow Exchange, also developed their own native protocols.  Today we will talk about the Plaza II protocol project, which was created by RTS specialists. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Plaza II Infrastructure </h4><br>  For communication between the exchange trading system (it is called Spectra) and client software, the so-called Plaza II gateway is used - a special software that receives and sends data using the appropriate protocol.  The gateway is installed on a computer that must have a connection to the corporate network of the exchange, and to the network where the user's client application is located. <br><br><img src="https://habrastorage.org/files/2dc/47d/8fa/2dc47d8faa8748f8b5fdf4c4429aee67.png"><br><br>  As a rule, traders install their servers either directly into the data center of the exchange, or place them in the <a href="http://www.itinvest.ru/services/access/razmeshenie/">data centers of their brokers</a> , which are connected to the exchange by dedicated communication channels - this allows you to save money (colocation in the exchange data center is expensive), while maintaining a high level of exchange rate data. <br><br>  SPECTRA Plaza-2 gateway includes two software components: <br><br><ul><li>  The P2MQRouter module, which establishes TCP connections to exchange servers, receives and sends messages in the Plaza II format, encrypts information sent by a participant, and decrypts information received from the exchange, as well as authenticates the participant in the exchange network. </li><li>  Library P2ClientGate, which third-party companies are just used to create software for working in the stock market. </li></ul><br>  The P2ClientGate library exists in two versions that support different COM streaming models: STA and MTA models. <br>  In addition, the P2ClientGate library is available for 32-bit and 64-bit Windows systems (similarly for CGate). <br><br><img src="https://habrastorage.org/files/e41/cf7/34b/e41cf734b2914f70a3ee82794cb3219e.png"><br><br>  The exchange has a special <a href="">document</a> , which describes in detail the requirements for hardware and software for the normal operation of applications.  For example, if we need to save data to a disk, then the requirements will sound like this: 4 GB operating memory, SAS controller with write-back caching mode, at least 4 disks in RAID10, etc.). <br><br><h4>  Data transfer </h4><br>  The main method of data distribution on the Plaza II platform is replication - the data is transmitted by the server to the clients in the push mode (that is, the client does not explicitly request data changes).  The data is translated as a sequence of changes in relational tables, that is, replication data streams. <br><br>  The client software subscribes to the necessary data based on the name of the stream (at the stream level the rights to access specific data are also set). <br><br>  A stream can be in several states, including receiving snapshots (history of data changes), online mode (updating data in real-time mode) and error mode (this means that for some reason the stream cannot be opened). <br><br>  When opening a stream, the developer of a trading application can set its mode of operation, which is selected based on the goals pursued (receiving snapshots, receiving and updating data, or receiving only data from the current time). <br><br>  Each replicable table has in its structure the first three fields of a fixed type i8, designed to provide a replication mechanism: <br><br><ul><li>  <b>replID</b> - unique identifier of the entry in the table.  When you insert a new record into the table, it is assigned an identifier. </li><li>  <b>replRev</b> - unique change number in the table.  For any change in the table (insertion, editing, deleting a record), the affected record gets a replRev value equal to the maximum replRev in the table before the +1 change. </li><li>  <b>replAct</b> is a sign that the entry has been deleted.  When a record is deleted on the server, the replAct field contains the value of its replID.  If replAct = 0, the record is active (not deleted). </li></ul><br><br><table><tbody><tr><th>  Plaza Types II </th><th>  String representation </th></tr><tr><td>  i1, i2, i4, i8 </td><td>  Signed whole </td></tr><tr><td>  u1, u2, u4, u8 </td><td>  Unsigned integer </td></tr><tr><td>  d s </td><td>  Signed fixed-point number of the form [sign] nnnn.mmmm </td></tr><tr><td>  t </td><td>  Date and time in the format YYYY / MM / DD HH: NN: SS.XXX </td></tr><tr><td>  c </td><td>  Character string with a zero at the end </td></tr><tr><td>  a </td><td>  One character string </td></tr><tr><td>  f </td><td>  Signed floating-point number of the form [sign] dddd.dddd </td></tr></tbody></table><br>  After the implementation of data schema matching, the client application sends to the server the maximum values ‚Äã‚Äãof the replRev fields for each table.  The initial synchronization consists in the transfer of all data with checks (‚Äúrevision‚Äù) by the server to the client, larger than those indicated by the client. <br><br>  After the initial synchronization, the stream goes online (for all tables, the maximum client revolutions coincided with the maximum server revolutions). <br><br>  This means that the data in the tables after receiving the StreamDataEnd notification and before receiving the next StreamDataBegin notification is consistent. <br><br>  Data change notifications can arrive only in the interval between the StreamDataBegin and the StreamDataEnd and in this interval the data in the table are not consistent. <br><br><h4>  Presentation of information </h4><br>  All data passing through the Plaza II gateway is divided into several logical groups: <br><br><ul><li>  Reference information - the schedule and status of trading sessions, directories of instruments, bonds, firms and customers; </li><li>  Trading information - aggregation of ‚Äúglasses‚Äù (broadcast by several replication streams), general market indicators, order and transaction logs of the user (and the trading system); </li><li>  Information for recovery; </li><li>  Information on funds and limits; </li><li>  Clearing information - clearing settlement prices, variation margin, delivery reports, customer funds based on clearing results; </li><li>  Information about indices and rates - the current values ‚Äã‚Äãof the RTS indices, the values ‚Äã‚Äãof exchange rates; </li><li>  Auxiliary information flows - current volatility values ‚Äã‚Äãand theoretical options prices, variation margin values. </li></ul><br>  In order to carry out operations in the markets operating on the Spectra trading system, the user‚Äôs system must receive on-line a schedule of sessions (session) and a tool directory (fut_sess_contents, opt_sess_contents). <br><br><h4>  Data streams </h4><br>  Consider the specific data streams of the Plaza II protocol.  For example, the FORTS_FUTTRADE_REPL stream contains information on bids and <a href="http://habrahabr.ru/company/itinvest/blog/222257/">futures</a> transactions on the Moscow Exchange derivatives market (FORTS). <br>  The stream data schema includes the tables: <br><ul><li>  <b>orders_log</b> - application log; </li><li>  <b>deal</b> - deals log; </li><li>  <b>multileg_orders_log</b> - application log by bundles; </li><li>  <b>multileg_deal</b> - transaction log for bundles; </li><li>  <b>heartbeat</b> - service table of server hours; </li><li>  <b>sys_events</b> - table of events. </li></ul><br>  The orders_log table looks like this: <br><br><table><tbody><tr><th>  Field </th><th>  Type of </th><th>  Description </th></tr><tr><td>  replID </td><td>  i8 </td><td>  Replication subsystem service field </td></tr><tr><td>  replRev </td><td>  i8 </td><td>  Replication subsystem service field </td></tr><tr><td>  replAct </td><td>  i8 </td><td>  Replication subsystem service field </td></tr><tr><td>  id_deal </td><td>  i8 </td><td>  Transaction number </td></tr><tr><td>  sess_id </td><td>  i4 </td><td>  Session Id </td></tr><tr><td>  isin_id </td><td>  i4 </td><td>  Unique numeric identifier of the instrument </td></tr><tr><td>  price </td><td>  d16.5 </td><td>  Price </td></tr><tr><td>  amount </td><td>  i4 </td><td>  Volume, number of instrument units </td></tr><tr><td>  moment </td><td>  t </td><td>  Time of the transaction </td></tr><tr><td>  code_sell </td><td>  c7 </td><td>  Seller Code </td></tr><tr><td>  code_buy </td><td>  c7 </td><td>  Buyer Code </td></tr><tr><td>  id_ord_sell </td><td>  i8 </td><td>  Seller‚Äôs Request Number </td></tr><tr><td>  ext_id_sell </td><td>  i4 </td><td>  External number from the application of the seller </td></tr><tr><td>  comment_sell </td><td>  c20 </td><td>  Comment from the seller‚Äôs application </td></tr><tr><td>  trust_sell </td><td>  i1 </td><td>  Sign of remote control (trust management) from the seller‚Äôs application </td></tr><tr><td>  status_sell </td><td>  i4 </td><td>  Status of the transaction by the seller </td></tr><tr><td>  id_ord_buy </td><td>  i8 </td><td>  Buyer Application Number </td></tr><tr><td>  ext_id_buy </td><td>  i4 </td><td>  External number from the application of the buyer </td></tr><tr><td>  trust_buy </td><td>  i1 </td><td>  Sign of the trust (trust management) from the application of the buyer </td></tr><tr><td>  status_buy </td><td>  i4 </td><td>  Status of the transaction by the buyer </td></tr><tr><td>  pos </td><td>  i4 </td><td>  The number of positions on the instrument in the market after the transaction </td></tr><tr><td>  nosystem </td><td>  i1 </td><td>  Sign of a non-system transaction </td></tr><tr><td>  hedge_sell </td><td>  i1 </td><td>  Merchant hedge sign </td></tr><tr><td>  hedge_buy </td><td>  i1 </td><td>  Sign of a hedge deal by the buyer </td></tr><tr><td>  login_sell </td><td>  c20 </td><td>  Seller username </td></tr><tr><td>  login_buy </td><td>  c20 </td><td>  Buyer User Login </td></tr><tr><td>  code_rts_buy </td><td>  c7 </td><td>  Buyer RTS Code </td></tr><tr><td>  code_rts_sell </td><td>  c7 </td><td>  Seller's RTS Code </td></tr><tr><td>  free_sell </td><td>  d26.2 </td><td>  Seller transaction fee </td></tr><tr><td>  free_buy </td><td>  d26.2 </td><td>  Buyer transaction fee </td></tr><tr><td>  id_deal_multileg </td><td>  i8 </td><td>  Transaction number for the bundle </td></tr></tbody></table><br>  There are other data streams: <br><br><ul><li>  FORTS_FUTTRADE_REPL - futures: orders and transactions; </li><li>  FORTS_OPTTRADE_REPL - options: orders and deals; </li><li>  FORTS_ORDLOG_REPL - flow of anonymous requests; </li><li>  FORTS_DEALS_REPL - a stream of anonymous transactions; </li><li>  FORTS_FUTORDERBOOK_REPL - futures: cut of the glass; </li><li>  FORTS_OPTORDERBOOK_REPL - options: cut glass; </li><li>  FORTS_FUTCOMMON_REPL - futures: general information; </li><li>  FORTS_OPTCOMMON_REPL - options: general information. </li></ul><br>  Also, the client can subscribe to receive data from streams of aggregated glasses: <br><ul><li>  FORTS_POS_REPL - position information; </li><li>  FORTS_PART_REPL - information about funds and limits; </li><li>  FORTS_FUTINFO_REPL - futures: reference and session information; </li><li>  FORTS_OPTINFO_REPL - options: reference and session information; </li><li>  FORTS_MISCINFO_REPL - additional reference information; </li><li>  RTS_INDEX_REPL - stock indices; </li><li>  RTS_INDEXLOG_REPL - history of index values; </li><li>  FORTS_VM_REPL - variation margin; </li><li>  FORTS_VOLAT_REPL - volatility; </li><li>  FORTS_INFO_REPL - additional reference information; </li><li>  FORTS_TNPENALTY_REPL - information about the charges for the transaction; </li><li>  MOEX_RATES_REPL - online currency exchange rates. </li></ul><br>  Each of these data streams has its own table schema, they are described in more detail in a special <a href="http://ift.tt/1vgOrnj">document</a> for developers of trading software. <br><br>  With the help of the Plaza II protocol, not only information is received, but also commands are transmitted for performing operations in the stock market.  For example, adding an application is carried out using a special method (FutAddOrder), which is represented by a separate table (for the CGate library, the names of the tables may differ). <br><br>  The table for the result of the action is as follows: <br><br><table><tbody><tr><th>  Parameter name </th><th>  Type of </th><th>  Default value </th><th>  Description </th></tr><tr><td>  code </td><td>  i4 </td><td></td><td>  Return code </td></tr><tr><td>  message </td><td>  c255 </td><td></td><td>  Message text </td></tr><tr><td>  order_id </td><td>  i8 </td><td></td><td>  Application code in the system </td></tr></tbody></table><br>  The success of the operation is described by code 0, any other value indicates an error.  Similarly, the removal of the application or the movement of applications. <br><br><h4>  Work with Plaza II </h4><br>  With the help of the Plaza II protocol, it is possible to work in different ways with the stock exchange: for example, there is a viewing mode, which is used only to get data, but not to make transactions with securities.  To work in the system in different modes, special <a href="http://moex.com/s444">logins of</a> different types are used. <br><br>  You can connect to trades using this native protocol through brokers whose systems are <a href="http://moex.com/a1198">certified by the</a> exchange (ITinvest <a href="http://www.itinvest.ru/services/access/">is included</a> in this list). <br><br><h4>  Other protocols </h4><br>  In addition to the Plaza II protocol, which was developed by employees of the RTS Exchange, there is a protocol for work created on the MICEX Stock Exchange (as mentioned above, these two sites later merged into the Moscow Exchange).  ASTS Bridge (TEAP) bidirectional <a href="http://moex.com/a574">gateway is</a> used to carry out trading operations and obtain stock exchange data on the foreign exchange and stock markets - it will be discussed in one of our following materials.  In addition, we will talk about the protocol Simple Binary Encoding, which, to a certain extent, is the successor of the FIX case. <br><br>  Today, thank you for your attention, we will be happy to answer questions in the comments. <br><br>  PS If you notice a typo or mistake - write a personal message, and we will fix everything promptly. </div><p>Source: <a href="https://habr.com/ru/post/261709/">https://habr.com/ru/post/261709/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../261691/index.html">FLProg - continuation of evolution</a></li>
<li><a href="../261699/index.html">How I compiled the application bundle for MacOS on Linux</a></li>
<li><a href="../261701/index.html">Deploying Nano Server with Windows Assessment and Deployment Kit (ADK) RC for Windows 10</a></li>
<li><a href="../261703/index.html">ASP.NET 5 beta5 in Visual Studio 2015</a></li>
<li><a href="../261707/index.html">Apple fixed OS X vulnerabilities</a></li>
<li><a href="../261711/index.html">Basics of using Cocoapods in iOS app development</a></li>
<li><a href="../261715/index.html">DevStack as a tool</a></li>
<li><a href="../261717/index.html">Magic Tensor Algebra: Part 3 - Curvilinear Coordinates</a></li>
<li><a href="../261719/index.html">We collect and configure the BUNDY DNS server (BIND10). Part 1</a></li>
<li><a href="../261721/index.html">Android Process: I gave birth to you, I you and ...</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>