<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple trading bot for The Settlers Online</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Long ago, back in the days when MsDOS lived on personal computers, it was possible to play Settlers II. The game touched me, and I gladly spent a few ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple trading bot for The Settlers Online</h1><div class="post__text post__text-html js-mediator-article">  Long ago, back in the days when MsDOS lived on personal computers, it was possible to play Settlers II.  The game touched me, and I gladly spent a few days alone with her.  Much later he passed it again, and then again, and each time despite the antiquity of this game, he spent time playing it with pleasure.  Not so long ago I saw an advertisement for the online game The Settlers Online and succumbed to the nostalgia registered in it.  The first impression was a delight, so everything was like my favorite Settlers II.  But the rainbow euphoria quickly passed.  I will not talk about all the pros and cons in this article, I‚Äôll tell you only about one minus - trade.  You can read more about the game in the article <a href="http://habrahabr.ru/post/110293/">The Settlers: Now Online</a> . <br><a name="habracut"></a><br><h4>  Cause </h4><br>  Trading in the game is implemented in such a way that it requires constant presence.  Any trading lot is set for only 10 minutes, and then becomes unavailable to other players.  As a result, in order for the trade to bring any tangible profit at all it is necessary to spend more than one hour in the trade interface. <br><br><h4>  The investigation </h4><br>  So the idea was born to write a bot that will exhibit the lot automatically. <br><br><h4>  We write bot </h4><br>  Since Linux is installed on my desktop, the Perl programming language and the xdotool mouse cursor control utility were selected as development tools. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And so begin. <br>  The bot will consist of 2 files: <br><ul><li>  simple.trade.bot.pl - the bot itself. </li><li>  trade.guns.pl - a file with the coordinates of the buttons and additional data for trading the selected item (in my case it was the guns sold for footballs). </li></ul><br><br>  Let's start with the <b>trade.guns.pl</b> file.  This file contains a list of HASH (named) arrays containing the coordinates of the buttons that need to be pressed to set a lot, and other additional information. <br><pre><code class="perl hljs">( { <span class="hljs-string"><span class="hljs-string">x=&gt;</span></span><span class="hljs-string"><span class="hljs-string">'288'</span></span>, <span class="hljs-string"><span class="hljs-string">y=&gt;</span></span><span class="hljs-string"><span class="hljs-string">'852'</span></span>}, <span class="hljs-comment"><span class="hljs-comment">#  [].      { x=&gt;'790', y=&gt;'667'}, #  [].    . { x=&gt;'1126', y=&gt;'658'}, #  [].    . { x=&gt;'871', y=&gt;'594'}, #  [].    . { #       . #     100  . #    400 . x=&gt;'983', y=&gt;'742', #   . dx=&gt;'874', dy=&gt;'750', #   . #  99 . inc=&gt;{ #   : x=&gt;'1010', y=&gt;'745', #       1. inc=&gt;'1', #     . rnd=&gt;'0', #   0     0  rnd   inc. timer =&gt; [ #        . { sh=&gt;0, eh=&gt;24, inc=&gt;0 } #      0   . ] } }, { x=&gt;'1064', y=&gt;'733', rx=&gt;'20', ry=&gt;'10'}, #  [].     . { x=&gt;'1131', y=&gt;'668', rx=&gt;'10', ry=&gt;'2'}, #  [].    . #          #   . { x=&gt;'1016', y=&gt;'548', rx=&gt;'20', ry=&gt;'10'}, #  [].    . { #       . #     20   + 0, 2, 4  8   #    +   0  15 . #    400 . x=&gt;'988', y=&gt;'743', #   . dx=&gt;'804', dy=&gt;'746', #   . #  1 . inc=&gt;{ #   : x=&gt;'1010', y=&gt;'745', #       1. inc=&gt;'19', #     . rnd=&gt;'15', #   0     0  rnd   inc. timer =&gt; [ #        . #    -       . { sh=&gt;0, eh=&gt;24, inc=&gt;0 },# 0   . { sh=&gt;0, eh=&gt;8, inc=&gt;8 },# +8 c 00.00  08.00. { sh=&gt;8, eh=&gt;9, inc=&gt;4 },# +4 c 08.00  09.00. { sh=&gt;9, eh=&gt;10, inc=&gt;2 } # +2 c 09.00  10.00. ] } }, { x=&gt;'1083', y=&gt;'736', rx=&gt;'20', ry=&gt;'10' }, #  [].     . { x=&gt;'961', y=&gt;'596', rx=&gt;'14', ry=&gt;'12' } #  [].    . );</span></span></code> </pre> <br><br>  In a more detailed description in addition to what is given in the comments, this file does not need.  Therefore, let's proceed to the consideration of <b>simple.trade.bot.pl</b> .  This is the bot itself. <br><br><pre> <code class="hljs mel">#!/usr/bin/perl #      <span class="hljs-number"><span class="hljs-number">20</span></span>               sleep <span class="hljs-number"><span class="hljs-number">20</span></span>; #         my @g_trade = <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-string"><span class="hljs-string">"trade.guns.pl"</span></span>; #    .  . #          [Ctrl]+c. <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(){ #         . <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"NEXT TRADE\n"</span></span>; #          . <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> my $l_cur ( @g_trade ){ sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( defined $l_cur-&gt;{dx} ){ #       dx    -   #   . #     ($l_count). #      . my $l_count=$l_cur-&gt;{inc}{inc}; #   .   ‚Ññ<span class="hljs-number"><span class="hljs-number">2</span></span> - . my @l_curtime=localtime(time); #     x, y  . <span class="hljs-keyword"><span class="hljs-keyword">move</span></span>($l_cur); #        . my $l_inc=<span class="hljs-number"><span class="hljs-number">0</span></span>; #       . <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> my $l_timer ( @{$l_cur-&gt;{inc}{timer}} ){ #       ,  . $l_inc=$l_timer-&gt;{inc} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> $l_curtime[<span class="hljs-number"><span class="hljs-number">2</span></span>] &gt;= $l_timer-&gt;{sh} &amp;&amp; $l_curtime[<span class="hljs-number"><span class="hljs-number">2</span></span>] &lt;= $l_timer-&gt;{eh}; } #      . my $l_rnd=<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">rand</span></span>($l_cur-&gt;{inc}{rnd})); #       . $l_count+=$l_inc; $l_count+=$l_rnd; #              . <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"\tSET: [$l_count] [$l_cur-&gt;{inc}{inc} + $l_up + $l_rnd\($l_cur-&gt;{inc}{rnd})]\n"</span></span>; #      . <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($l_count){ $l_count--; clicktoxy($l_cur-&gt;{inc}); usleep(<span class="hljs-number"><span class="hljs-number">80</span></span>); } }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ #   dx   -           . clicktoxy($l_cur); } } #  .  <span class="hljs-number"><span class="hljs-number">11</span></span>  +   <span class="hljs-number"><span class="hljs-number">0</span></span>  <span class="hljs-number"><span class="hljs-number">4</span></span>  (        ). my $l_time=<span class="hljs-number"><span class="hljs-number">11</span></span>+<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">rand</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>)); my $count=<span class="hljs-number"><span class="hljs-number">0</span></span>; #           . <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($count=<span class="hljs-number"><span class="hljs-number">0</span></span>;$count&lt;$l_time;$count++){ sleep <span class="hljs-number"><span class="hljs-number">60</span></span>; mousemove(<span class="hljs-number"><span class="hljs-number">400</span></span>,<span class="hljs-number"><span class="hljs-number">500</span></span>); sleep <span class="hljs-number"><span class="hljs-number">1</span></span>; mousemove(<span class="hljs-number"><span class="hljs-number">1400</span></span>,<span class="hljs-number"><span class="hljs-number">500</span></span>); sleep <span class="hljs-number"><span class="hljs-number">1</span></span>; } #       <span class="hljs-number"><span class="hljs-number">0</span></span>  <span class="hljs-number"><span class="hljs-number">60</span></span> sleep(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">rand</span></span>(<span class="hljs-number"><span class="hljs-number">60</span></span>))); #         } sub usleep{ #      (   Ms Windows). my $l_ptr=shift; $l_ptr*=<span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-string"><span class="hljs-string">`usleep $l_ptr`</span></span>; } sub <span class="hljs-keyword"><span class="hljs-keyword">move</span></span>{ #             . my $l_coord=shift; mousemove($l_coord-&gt;{x},$l_coord-&gt;{y}); mousedown(<span class="hljs-number"><span class="hljs-number">1</span></span>); usleep(<span class="hljs-number"><span class="hljs-number">600</span></span>); mousemove($l_coord-&gt;{dx},$l_coord-&gt;{dy}); mouseup(<span class="hljs-number"><span class="hljs-number">1</span></span>); } sub click{ #        . mousedown(<span class="hljs-number"><span class="hljs-number">1</span></span>); mouseup(<span class="hljs-number"><span class="hljs-number">1</span></span>); } sub clicktoxy{ #    ,         #    . my $l_coord=shift; mousemove($l_coord-&gt;{x},$l_coord-&gt;{y}); mousedown(<span class="hljs-number"><span class="hljs-number">1</span></span>); mouseup(<span class="hljs-number"><span class="hljs-number">1</span></span>); usleep(<span class="hljs-number"><span class="hljs-number">300</span></span>); } sub mousedown{ #     xdotool    . #  : # <span class="hljs-number"><span class="hljs-number">1</span></span> -    () # <span class="hljs-number"><span class="hljs-number">2</span></span> -    () my $l_key = shift; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( $l_key ){ <span class="hljs-string"><span class="hljs-string">`xdotool mousedown $l_key`</span></span>; } } sub mouseup{ #     xdotool    . #  : # <span class="hljs-number"><span class="hljs-number">1</span></span> -    () # <span class="hljs-number"><span class="hljs-number">2</span></span> -    () my $l_key = shift; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( $l_key ){ <span class="hljs-string"><span class="hljs-string">`xdotool mouseup $l_key`</span></span>; } } sub mousemove{ #     xdotool      x, y. my $l_x = shift; my $l_y = shift; my $l_com=<span class="hljs-string"><span class="hljs-string">'xdotool mousemove'</span></span>; $l_com.=<span class="hljs-string"><span class="hljs-string">" $l_x $l_y"</span></span>; <span class="hljs-string"><span class="hljs-string">`$l_com`</span></span>; }</code> </pre><br><br>  The bot is ready. <br><br><h4>  In conclusion </h4><br>  This bot is very simple.  He still does not have many of the necessary features.  Here is a short list of ideas how to make the bot more perfect: <br><ul><li>  Teach the bot to see from the screen.  You can use ImageMagick for this. </li><li>  Teach the bot to tune to different screen resolutions and different browsers.  Find borders and buttons using the ImageMagick compare utility. </li><li>  Teach the bot to read from the screen.  You can use ImageMagick + gocr for this. </li><li>  Teach the bot to accept transactions.  But since the transfer of fraudulent transactions is practiced in the game, the bot must verify the transaction before accepting the transaction.  You can use ImageMagick + gocr for this. </li><li>  Teach the bot to know in advance all the lots set out in the trading interface.  Lots are transmitted to the browser in clear text as XML.  You can use the perl module <a href="">Net :: Pcap to capture it</a> .  You can use ImageMagick + gocr to search in the trading interface of a product selected at the stage of interception of product packages. </li></ul><br><br><h4>  Should be considered </h4><br><ul><li>  This bot is written under Linux.  In order to make it work under Ms Windows, you need to use an analog for Ms Windows instead of xdotool.  Perhaps the <a href="http://www.autoitscript.com/site/autoit/">autoit</a> utility will <a href="http://www.autoitscript.com/site/autoit/">do</a> .  Also in Ms Windows you will need to install <a href="http://www.activestate.com/activeperl">Perl</a> . </li><li>  The file with the coordinates <b>trade.guns.pl is</b> designed for a specific product (100 guns change to 20 - 34 balls), to my screen resolution and my browser.  To use the bot you will need to calculate your coordinates of the buttons. </li><li>  According to the rules established in the game for the use of even such a simple bot punishment <a href="http://forum.thesettlersonline.ru/threads/16805-The-Settlers-%25D0%259E%25D0%25BD%25D0%25BB%25D0%25B0%25D0%25B9%25D0%25BD-%25D0%259F%25D1%2580%25D0%25B0%25D0%25B2%25D0%25B8%25D0%25BB%25D0%25B0"><b>ban without the right to restore.</b></a>  <a href="http://forum.thesettlersonline.ru/threads/16805-The-Settlers-%25D0%259E%25D0%25BD%25D0%25BB%25D0%25B0%25D0%25B9%25D0%25BD-%25D0%259F%25D1%2580%25D0%25B0%25D0%25B2%25D0%25B8%25D0%25BB%25D0%25B0"><b>clause 6.4</b></a> . </li></ul></div><p>Source: <a href="https://habr.com/ru/post/145842/">https://habr.com/ru/post/145842/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../145833/index.html">Skype 5.8 for Mac OS X</a></li>
<li><a href="../145834/index.html">BlackBerry 10 Jam World Tour in Moscow June 26</a></li>
<li><a href="../145835/index.html">Metaclasses in Python</a></li>
<li><a href="../145836/index.html">What interesting things I learned at DevConf 2012</a></li>
<li><a href="../145837/index.html">Crowdfunding (skladchiny) in Russia: Interviews with the coordinators of the project "Tugize"</a></li>
<li><a href="../145843/index.html">Analyzing the capabilities of mass auditing based on leaked hashes from LinkedIn</a></li>
<li><a href="../145844/index.html">User rating site content</a></li>
<li><a href="../145846/index.html">Karma provider encourages users to share traffic</a></li>
<li><a href="../145848/index.html">Webinar: Basics of using the Page Object pattern with Selenium WebDriver</a></li>
<li><a href="../145849/index.html">A couple of devices for DSLRs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>