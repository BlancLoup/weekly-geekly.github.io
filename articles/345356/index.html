<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Universal Dumper / Injector Unity3D (Mono, Android)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings 

 Not so long ago, I became interested in the study of games under android. As it turned out, a very considerable number of developers use ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Universal Dumper / Injector Unity3D (Mono, Android)</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/609/a9c/770/609a9c7706e137a5be51e20f3a594866.gif" alt="image"></div><br>  Greetings <br><br>  Not so long ago, I became interested in the study of games under android.  As it turned out, a very considerable number of developers use Unity3D (probably, 50-60 percent of the games that I was interested in are based on this engine).  Immediately make a reservation - I am not an expert on hacking and I don‚Äôt even practically know C ++ / asm (in spite of a slight acquaintance with this topic), so please do not throw the toilet bowls with the help of gravhes.  There is also a small clarification - I practically studied only MMO / semi-online games in the style of ‚Äúcracking plot dungeon until blue in the face, and then fighting in the arena with other players, and semi-offline).  Offline games on Unity3D are simply boring to explore. <br><br>  Actually, as far as I know, toys for Unity3D use 2 technologies: Mono and Il2cpp. <br>  Within this material, I want to consider the process of replacing .NET dll'ok and dump even encrypted versions of these same dll'ok directly from the game. <br><a name="habracut"></a><br>  I am developing for windows / node.js, because the technology stack will be described in the context of what I use myself. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, we will need: <br><br>  1. Routed android (without the root will not start frida-server) <br>  2. Android SDK (more precisely, <a href="https://developer.android.com/studio/releases/platform-tools.html">adb</a> ) <br>  3. Frida. <br><br>  What it is and why you need it, you can read here - <a href="https://www.frida.re/">Frida</a> . <br>  An example guide under android - <a href="https://www.codemetrix.net/hacking-android-apps-with-frida-1/">Android guide</a> . <br><br>  We now need <a href="https://github.com/frida/frida-node">frida-node</a> , <a href="https://github.com/frida/frida-load">frida-load</a> and <a href="https://github.com/frida/frida/releases">frida-server</a> (which of the archives is needed, I won‚Äôt say exactly, it depends on the architecture, I wound up <br>  frida-server-10.6.19-android-x86.xz). <br><br>  Actually, extract the file somewhere from the archive, rename it somehow shorter (for example, serv) and push it somewhere via adb push or handles. <br><br>  Fill: <br><br>  -Rename the file, for example, in serv <br>  -Fill on the device: <br>  adb push serv / data / local / tmp / serv <br><br>  Run: <br><br>  -adb shell <br>  -su <br>  - / data / local / tmp / serv <br><br>  4. Next to the code create a folder csharp.  Yes, I'm so lazy that I would add 2 lines of code to check the existence of this folder (even considering the fact that it took more characters to clarify this). <br><br>  5. Actually, the code. <br>  Install the above frida-node, create 2 files ‚Äî app.js and unity_bootstrap.js. <br><br>  File ID: <br><br>  app.js <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> frida = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'frida'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> load = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'frida-load'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> spawn = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'child_process'</span></span>).spawn; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> spawnAwait = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">file</span></span></span><span class="hljs-function">)=&gt;</span></span><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, reject</span></span></span><span class="hljs-function">)=&gt;</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> child = spawn(<span class="hljs-string"><span class="hljs-string">'adb'</span></span>, [<span class="hljs-string"><span class="hljs-string">'push'</span></span>, <span class="hljs-string"><span class="hljs-string">'csharp/'</span></span>+file, <span class="hljs-string"><span class="hljs-string">"/sdcard/"</span></span>+file]); child.on(<span class="hljs-string"><span class="hljs-string">'close'</span></span>, (code) =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`child process exited with code </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${code}</span></span></span><span class="hljs-string">`</span></span>); resolve(); }); }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> waitBuild = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">file</span></span></span><span class="hljs-function">)=&gt;</span></span><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, reject</span></span></span><span class="hljs-function">)=&gt;</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> child = spawn(<span class="hljs-string"><span class="hljs-string">'build.bat'</span></span>, []); child.on(<span class="hljs-string"><span class="hljs-string">'close'</span></span>, (code) =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`child process exited with code </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${code}</span></span></span><span class="hljs-string">`</span></span>); resolve(); }); }); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> appName=process.argv[<span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!appName){ appName=<span class="hljs-string"><span class="hljs-string">"COM.ANDROID.SOMETHING"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> session, script; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> hexToBytes=<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">hex</span></span></span><span class="hljs-function">)=&gt;</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> newLine=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bytes = [], c = <span class="hljs-number"><span class="hljs-number">0</span></span>; c &lt; hex.length; c += <span class="hljs-number"><span class="hljs-number">2</span></span>){ bytes.push(hex.substr(c, <span class="hljs-number"><span class="hljs-number">2</span></span>)); newLine+=<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(newLine&gt;=<span class="hljs-number"><span class="hljs-number">40</span></span>){ bytes.push(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>); newLine=<span class="hljs-number"><span class="hljs-number">0</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bytes.join(<span class="hljs-string"><span class="hljs-string">" "</span></span>); } <span class="hljs-comment"><span class="hljs-comment">// /data/local/tmp/serv (async () =&gt; { fs.writeFileSync("session_log.txt", "Starting session\n", ()=&gt;{}); const device = await frida.getUsbDevice(); let pid = await device.spawn([appName]); session = await device.attach(pid); const source = await load(require.resolve('./unity_bootstrap.js')); script = await session.createScript(source); script.events.listen('message', (message,b) =&gt; { if (pid &amp;&amp; message.type === 'send' &amp;&amp; message.payload &amp;&amp; message.payload.event === 'ready'){ device.resume(pid); console.log("Resume"); } else { if(!message.payload){ console.log(message); return; } if (message.payload.event == "dump") { fs.appendFile("csharp/"+message.payload.name, b, ()=&gt;{}); } } }); await script.load(); let injectedLibs=['Assembly-CSharp.dll'/* , 'UnityEngine.dll' */]; injectedLibs=injectedLibs.filter(x=&gt;fs.existsSync("csharp/"+x)); if(!injectedLibs.length){ script.post({type: 'loadData', count: 0}); } await Promise.all(injectedLibs.map(x=&gt;spawnAwait(x))); injectedLibs.forEach(x=&gt;script.post({type: 'loadData', count: injectedLibs.length, payload: x}, fs.readFileSync("csharp/"+x))); process.on('exit', function (){}); console.log("Done"); })();</span></span></code> </pre> <br>  unity_bootstrap.js <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dllData={} <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> globalCaller; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMessage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">message, data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(message.type==<span class="hljs-string"><span class="hljs-string">"loadData"</span></span>&amp;&amp;message.count&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>){ dllData[message.payload]=data; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(message.payload, dllData, <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(dllData).length); send({ <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">"waiting"</span></span> }) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(dllData).length==message.count) send({ <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">"ready"</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> send({ <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">"waiting"</span></span> }) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(message.type==<span class="hljs-string"><span class="hljs-string">"loadData"</span></span>&amp;&amp;message.count==<span class="hljs-number"><span class="hljs-number">0</span></span>){ send({ <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">"ready"</span></span> }); } recv(onMessage); } recv(onMessage); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> awaitForCondition = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callback</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> int = setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> addr = Module.findExportByName(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"mono_get_root_domain"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (addr) { clearInterval(int); callback(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } }, <span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_s</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">str</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Memory.allocUtf8String(str); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hookSet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mono_assembly_get_image=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NativeFunction(Module.findExportByName(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"mono_assembly_get_image"</span></span>), <span class="hljs-string"><span class="hljs-string">'pointer'</span></span>, [<span class="hljs-string"><span class="hljs-string">'pointer'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mono_image_open_full=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NativeFunction(Module.findExportByName(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"mono_image_open_full"</span></span>), <span class="hljs-string"><span class="hljs-string">'pointer'</span></span>, [<span class="hljs-string"><span class="hljs-string">"pointer"</span></span>, <span class="hljs-string"><span class="hljs-string">"pointer"</span></span>, <span class="hljs-string"><span class="hljs-string">"int"</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgLoads={}; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> dllData){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> img=mono_image_open_full(_s(<span class="hljs-string"><span class="hljs-string">"/sdcard/"</span></span>+i), NULL, <span class="hljs-number"><span class="hljs-number">1</span></span>); imgLoads[i]=img; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> addr = Module.findExportByName(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"mono_assembly_load_from_full"</span></span>); Interceptor.attach(addr, { <span class="hljs-attr"><span class="hljs-attr">onEnter</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">args</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name=Memory.readUtf8String(ptr(args[<span class="hljs-number"><span class="hljs-number">1</span></span>])); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(name); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parts=name.split(<span class="hljs-string"><span class="hljs-string">'/'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(parts.length&lt;<span class="hljs-number"><span class="hljs-number">2</span></span>){ parts=name.split(<span class="hljs-string"><span class="hljs-string">','</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dllName=parts[parts.length<span class="hljs-number"><span class="hljs-number">-1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dllName=dllName; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(dllData[dllName]){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> img=imgLoads[dllName]; args[<span class="hljs-number"><span class="hljs-number">0</span></span>]=img; args[<span class="hljs-number"><span class="hljs-number">1</span></span>]=_s(<span class="hljs-string"><span class="hljs-string">"/sdcard/"</span></span>+dllName); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"Replaced"</span></span>); } }, <span class="hljs-attr"><span class="hljs-attr">onLeave</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">retval</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dllName==<span class="hljs-string"><span class="hljs-string">'Assembly-CSharp.dll'</span></span>){ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(retval, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dllName); } <span class="hljs-comment"><span class="hljs-comment">//DUMP DLL if(!dllData[this.dllName]){ var image=mono_assembly_get_image(retval); var dataPtr=ptr(Memory.readInt(image.add(8))); var dataLength=Memory.readInt(image.add(12)); var result=Memory.readByteArray(dataPtr, dataLength); send({ event: 'dump', name: this.dllName }, result); } } }); } awaitForCondition(hookSet);</span></span></code> </pre><br>  Consider the code in more detail (by the way, I know that the code is far from perfect, but there is no need to lick it yet). <br><br>  App.js acts as a bootloader.  Starting standard - node app PACKAGE_ID (you can zaparkodit in the source, replacing COM.ANDROID.SOMETHING). <br><br>  For the most part, here is the usual download of frida from their manual, with the exception of some additional features: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.all(injectedLibs.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">=&gt;</span></span>spawnAwait(x)));</code> </pre> <br>  and <br><br><pre> <code class="hljs pgsql">injectedLibs.<span class="hljs-keyword"><span class="hljs-keyword">forEach</span></span>(x=&gt;script.post({<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-string"><span class="hljs-string">'loadData'</span></span>, count: injectedLibs.length, payload: x}, fs.readFileSync("csharp/"+x)));</code> </pre> <br>  In fact, it combines 2 ways. <br><br>  In general, I started with the transmission of an array of bytes, but in one of the toys I ran into a situation when loading the library from memory did not work, therefore, as a result, I load the array of bytes and the file, but in the example I use only the file. <br><br>  waitBuild is a helper function to simplify the assembly of its dll.  This example is not used, so you can ignore. <br><br>  If in brief, it all works like this: app.js is launched, the js-engine injects the frida-server into the target process, app.js sends the source code to the unity_bootstrap.js, the built-in engine executes the code. <br><br>  app.js reads the libraries that need to be embedded, then sends them to unity_bootstrap.js, waits for the download to finish, and continues the execution of the main process. <br><br>  Now consider the main code itself (unity_bootstrap.js). <br><br>  The awaitForCondition function is responsible for waiting for the mono to be loaded.  Since  we embed the code before the execution of the main code, at the time of the execution of our code, the desired functions are not yet available. <br><br>  Further, the code for the sake of which all this was started is actually processed.  You can read the mono API <a href="http://docs.go-mono.com/%3Flink%3Dxhtml%253Adeploy%252Fmono-api-assembly.html">here</a> , an example of use is <a href="http://www.mono-project.com/docs/advanced/embedding/">here</a> .  Even during the development of <a href="https://www.unknowncheats.me/forum/c-and-c-/163630-injecting-unity-game-webbrowser.html">this article</a> has helped. <br><br>  Actually, we do the following: intercept library loading via mono_assembly_load_from_full, then read the path of the loaded library and, if necessary, replace it with our own (with the help of mono_image_open_full we read the binary from the android file system). <br><br>  The trick is this: we are, in fact, replacing the binary code that was loaded in MonoImage. <br><br>  Further along the code, you can see the piece responsible for the dump dll'ok (see the comment // dump dll). <br>  It waits for the function to execute, then it reads the return value and sends it back to app.js, which dumps the dll to the csharp folder. <br><br>  Actually, after starting the application, it is worth waiting for the appearance of the lines <br>  /data/app/OUR_AWESOME_GAME.APK/assets/bin/Data/Managed/System.dll, this means that the interception worked and it went. <br><br>  After 1 download you can comment out the code responsible for the library dump so that it does not spoil the raspberries.  I, frankly, was just too lazy to write code that does it programmatically. <br><br>  If you did everything right and you were lucky, you will have all the necessary libraries in the csharp folder.  At the moment I researched about 20 toys on unity3d, this code with reservations (I had to add artificial delays in 1 toy, in 2 - load the code from the file system instead of memory) worked in all that used Mono. <br><br>  PS Of all the toys studied, I found a really serious vulnerability only in 1 (though I didn‚Äôt spend much time on just one): in many toys of this kind, solo-dungeons are calculated offline, but this drop is only in this game goes to the server and is also there.  As a result, it turned out to completely replace the drop in dungeon by loading my version of sqlite base, after which I received 20 VIPs, a bunch of diamonds, junk, a ban, a support report, a promise to transfer the bug to the developers and the subsequent fix.  Even said thank you, it was nice.). <br><br>  Another 1 toy, written on Corona using lua, turned out to change the number of golds per dungeon, but they had some kind of restriction on the server, because all the time it was issued static at 5k.  And so - every little thing that is calculated on the client, however, it can just be changed, as your heart desires. <br><br>  PPS If someone is interested, in principle, I can write a mini-guide on editing the code in dnSpy (very cool stuff), embedding my library, sending logs to my web server and other funny and not so good things. <br><br>  Thank you for your attention and hope for constructive criticism! </div><p>Source: <a href="https://habr.com/ru/post/345356/">https://habr.com/ru/post/345356/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345342/index.html">What are dangerous social networks on your PC?</a></li>
<li><a href="../345344/index.html">Sending a request to the specified MS SQL Server databases of all the specified servers using available tools</a></li>
<li><a href="../345346/index.html">Nebraska problem</a></li>
<li><a href="../345348/index.html">Adapting RoboVM for compiling for iOS from Windows / Linux</a></li>
<li><a href="../345350/index.html">Adding 3D objects to video</a></li>
<li><a href="../345358/index.html">Creating a Christmas animation with Wolfram Language</a></li>
<li><a href="../345362/index.html">Monte Carlo option premium calculation vs Black-Scholes formula</a></li>
<li><a href="../345364/index.html">We include support for TLS v1.3 in Nginx using the example of Debian 9</a></li>
<li><a href="../345366/index.html">Richard Hamming: "There are thoughts you can't think about"</a></li>
<li><a href="../345368/index.html">A selection of tutorials on AR / VR</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>