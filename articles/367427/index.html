<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We design the board in KiCad with QEDA: from idea to prototype</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago I published a presentation article about a tool called QEDA. In short, this is a utility to facilitate the process of creating a library...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We design the board in KiCad with QEDA: from idea to prototype</h1><div class="post__text post__text-html js-mediator-article"><p>  Some time ago I published a <a href="http://habrahabr.ru/post/271051">presentation article</a> about a tool called QEDA.  In short, this is a utility to facilitate the process of creating a library of electronic elements. </p><br><p>  Useful conclusions were made, further work was carried out, the project was developed.  The command line interface (CLI) has appeared.  Today we can talk about some milestone: the project has reached version <strong>0.1</strong> . </p><br><p>  In this article I will look at a typical workflow for creating a board in KiCad environment and using the QEDA utility. </p><br><p><img src="https://habrastorage.org/files/2ef/58f/40c/2ef58f40c67944308b264b630a03b777.png" alt="KDPV"></p><br><p>  <strong>Warning</strong> : there will be pictures and, as a result, traffic. </p><a name="habracut"></a><br><h1>  <font color="#2b4b76">Instead of preamble</font> </h1><br><p> Let me briefly remind you that you need to install <a href="https://nodejs.org/">Node.js</a> to work, and then start it in the console (in * nix you may need <code>sudo</code> ): </p><br><pre> <code class="bash hljs">npm install -g qeda</code> </pre> <br><p>  And of course, we will need <a href="http://kicad-pcb.org/">KiCad EDA</a> , which also needs to be installed. </p><br><p>  The development described below is carried out in Ubuntu Linux, but in the general case (probably with some amendments) it is possible in any OS. </p><br><p>  At the moment, the project is sorely lacking documentation, but it is planned to be fixed in the future. </p><br><h1>  <font color="#2b4b76">About the device</font> </h1><br><p>  The device is an adapter for connecting the ESP-07 Wi-Fi module to the Pixhawk autopilot. </p><br><h1>  <font color="#2b4b76">Formation of the library of elements</font> </h1><br><p>  Actually this is the central part of our narrative. </p><br><p>  If everything was established without errors, then a new command line utility should have appeared in the system.  Check that this is the case - run in the console: </p><br><pre> <code class="bash hljs">qeda --version</code> </pre> <br><p>  If you see something like ... </p><br><pre> <code class="bash hljs">QEDA v0.1.4</code> </pre> <br><p>  ... so we can continue. </p><br><p>  To begin, choose a folder for the future project.  In my case, this will be the <code>wifi-adapter</code> directory. </p><br><pre> <code class="bash hljs">mkdir wifi-adapter <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> wifi-adapter</code> </pre> <br><h2>  <font color="#2b4b76">Step 1. Choosing a PCB manufacturer</font> </h2><br><p>  In my case, I will create a library of elements with the requirements of a particular manufacturer.  Of course, some parameters can be tweaked in the process of tracing in EDA, but here I will show how to take into account the production capabilities at the very first stage. </p><br><p>  So, for example, take <a href="https://oshpark.com/guidelines">OSH Park</a> .  Of the most significant for us are the requirements for: </p><br><ul><li>  minimum distance between conductors: <strong>6 mil</strong> (0.2 mm) minimum spacing </li><li>  minimum hole diameter: <strong>13 mil</strong> (0.4 mm) minimum drill size </li><li>  minimum width of the rim of the metallized hole: <strong>7 mil</strong> (0.2 mm) minimum annular ring </li></ul><br><p>  In parentheses, I indicated the values ‚Äã‚Äãconverted to the metric system and rounded up to the tenths. </p><br><p>  Create a folder for the future library of elements: </p><br><pre> <code class="bash hljs">mkdir lib <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> lib</code> </pre> <br><p>  Now, using the <code>qeda</code> console command, <code>qeda</code> write the above restrictions.  I repeat that while the teams are not documented, so far I will explain them in place. </p><br><pre> <code class="bash hljs">qeda config pattern.clearance.padToPad 0.2 <span class="hljs-comment"><span class="hljs-comment">#      qeda config pattern.minimum.drillDiameter 0.4 #    qeda config pattern.minimum.ringWidth 0.2 #     </span></span></code> </pre> <br><p>  After executing these commands, a <code>.qeda.yaml</code> file will appear in the current directory, which stores all specified settings. </p><br><h2>  <font color="#2b4b76">Step 2. Other settings</font> </h2><br><p>  We can choose the preferred method for generating the chip pattern (pattern): recommended by the manufacturer or according to the IPC-7351 standard.  The default is recommended by the manufacturer (default values ‚Äã‚Äãare not required in the settings, but we will duplicate them to demonstrate the capabilities): </p><br><pre> <code class="bash hljs">qeda config pattern.preferManufacturer <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br><p>  Those items whose descriptions do not contain manufacturer's recommendations are calculated according to the IPC-7351 standard.  The standard provides for three levels of density (layout level): </p><br><ul><li>  <em>Least</em> ( <code>L</code> ) - the densest (recommended with limited dimensions of the printed circuit board) </li><li>  <em>Nominal</em> ( <code>N</code> ) - normal (recommended in most cases) </li><li>  <em>Most</em> ( <code>M</code> ) - the least dense layout (recommended for boards designed for harsh environments) </li></ul><br><p>  Since we are not limited in size, choose the least dense option: </p><br><pre> <code class="bash hljs">qeda config pattern.densityLevel M</code> </pre> <br><p>  Since it is supposed to solder the board manually, let's set one more parameter: the minimum distance from the output edge of the element to the opposite edge of its contact pad. </p><br><pre> <code class="bash hljs">qeda config pattern.minimum.spaceForIron 0.5</code> </pre> <br><p>  It is also possible to configure the following parameters (in brackets are the default values): </p><br><ul><li>  <code>pattern.clearance.padToMask</code> (0.05): the distance from the edge of the contact pad to the edge of the mask (mask opening) </li><li>  <code>pattern.minimum.maskWidth</code> (0.2): minimum width of the mask belt (takes precedence over the previous parameter) </li><li>  <code>pattern.lineWidth.silkscreen</code> (0.12): thickness of the line in the screen printing layer </li><li>  <code>pattern.fontSize.refDes</code> (1.2): reference designator height </li></ul><br><p>  We will leave these parameters by default. </p><br><p>  In addition, it is possible to set some settings for future conditional graphic symbols (HLO) of elements (schematic symbol): </p><br><ul><li>  <code>symbol.style</code> ('default'): UGO tracing style, alternative: 'GOST' </li><li>  <code>symbol.gridSize</code> (2.5): anchor grid cell size </li><li>  <code>symbol.fontSize.refDes</code> (2.5): font height for reference designators </li><li>  <code>symbol.fontSize.name</code> (2.5): font height for the element name </li><li>  <code>symbol.fontSize.pin</code> (2.5): font height to indicate conclusions </li></ul><br><p>  They also will not touch. </p><br><h2>  <font color="#2b4b76">Step 3. Adding items</font> </h2><br><p>  Since descriptions of the elements used are already contained in <a href="https://github.com/qeda/library">the element repository</a> , we only need to list them.  However, for interested persons, links to descriptions of the elements used are given in the spoiler below. </p><br><pre> <code class="bash hljs">qeda add espressif/esp-07 <span class="hljs-comment"><span class="hljs-comment">#  Wi-Fi qeda add capacitor/c0603 #  0603 qeda add capacitor/c1210 #  1210 qeda add resistor/r0603 #  0603 qeda add misc/tp-th-1 #   (testpoint) qeda add ti/lm1117mpx # LDO qeda add hirose/df13a-6p-1.25h # </span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Item descriptions</b> <div class="spoiler_text"><ul><li>  <a href="">Espressif ESP-07</a> </li><li>  <a href="">Capacitor C0603</a> </li><li>  <a href="">Capacitor C1210</a> </li><li>  <a href="">Resistor R0603</a> </li><li>  <a href="">Misc TP-TH-1</a> </li><li>  <a href="">TI LM1117MPX</a> </li><li>  <a href="">Hirose DF13A-6P-1.25H</a> </li></ul></div></div><br><p>  If the required item is not in the repository, you need to create a <code>library</code> subdirectory and add the item description in YAML format. </p><br><p>  Add more symbols of power and land: </p><br><pre> <code class="bash hljs">qeda power +5V <span class="hljs-comment"><span class="hljs-comment">#  +5  qeda power +3V3 #  +3.3  qeda ground signal/GND #   ( : 'chassis/', 'earth/'   )</span></span></code> </pre> <br><h2>  <font color="#2b4b76">Step 4. Library generation</font> </h2><br><p>  Well, here we come to the main and simplest step.  Let's call our library <code>wa</code> . </p><br><pre> <code class="bash hljs">qeda generate wa</code> </pre> <br><p>  If the process has completed without errors, then two subdirectories should appear in the current <code>lib</code> directory: </p><br><ul><li>  <code>library</code> containing cached YAML descriptions of the elements used </li><li>  <code>kicad</code> with KiCad library files </li></ul><br><p>  Everything: it's time to start drawing a scheme.  Instructions for designing a circuit and a PCB are more like a well-known joke about how to draw an owl.  However, this is due to the fact that the article is devoted mainly to the process of generating a library of elements, and the details of the design in KiCad would make the article even more bloated. </p><br><h1>  <font color="#2b4b76">Circuit design</font> </h1><br><p>  Create a KiCad project in the <code>wifi-adapter/board</code> directory. </p><br><p>  Since our library of elements is self-sufficient, you can delete all the default KiCad libraries, and add only our <code>wa</code> : </p><br><p><img src="https://habrastorage.org/files/350/c62/0e8/350c620e86564127a5cc18215e26515d.png" alt="Eschema properties"></p><br><p>  We draw the scheme: </p><br><p><img src="https://habrastorage.org/files/54a/138/c69/54a138c692c5408a9b82e2c8f3a420b7.png" alt="Schematic"></p><br><p>  And in the style of GOST, the scheme would look like this: </p><br><p><img src="https://habrastorage.org/files/32c/35d/5ec/32c35d5ec5574257b21b19f777e73673.png" alt="Schematic GOST"></p><br><p>  QEDA eliminates the need for such a stage as associating footprints to assignment footprints, as each element is already associated with a unique footprint.  In other words, Cvpcb will not have to run. </p><br><p>  We generate netlist. </p><br><h1>  <font color="#2b4b76">PCB Design</font> </h1><br><p>  To begin with, we also inform the editor that we need to draw seats from our newly baked <code>wa</code> library.  To do this, create a file <code>fp-lib-table</code> with the following contents in the project directory: </p><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">fp_lib_table</span></span> (<span class="hljs-name"><span class="hljs-name">lib</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> wa)(<span class="hljs-name"><span class="hljs-name">type</span></span> KiCad)(<span class="hljs-name"><span class="hljs-name">uri</span></span> ${KIPRJMOD}/../lib/kicad/wa.pretty)(<span class="hljs-name"><span class="hljs-name">options</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>)(<span class="hljs-name"><span class="hljs-name">descr</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>)) )</code> </pre> <br><p>  We import netlist, we do auto-spread. </p><br><p><img src="https://habrastorage.org/files/d0e/90a/334/d0e90a3345104db194343ea5bd9308cf.png" alt="Footprints"></p><br><p>  Well, then "draw the rest of the owl."  The tracer from me is not very good, so please do not judge strictly. </p><br><p><img src="https://habrastorage.org/files/0a2/0e2/9ac/0a20e29ac5774d08bcbca3ad51a1fffe.png" alt="PCB"></p><br><p>  Realistic 3D: </p><br><p><img src="https://habrastorage.org/files/e77/9fa/8fa/e779fa8fae3e4854924e0b8563f2a90f.jpg" alt="PCB 3D"></p><br><p>  We generate gerber'y and can be given to production. </p><br><h1>  <font color="#2b4b76">Conclusion</font> </h1><br><p>  On the simplest example, we reviewed the process of developing a printed circuit board, as they say, from scratch.  I admit, the board did not reach production, but the pre-production control was successful. </p><br><p>  Future plans: </p><br><ul><li>  Test the utility on a more complex multi-layer board project and bring it to production. </li><li>  Document all settings and features. </li><li>  Start a web service that facilitates the work with the utility. </li><li>  To develop the service towards the support of new functions and different EDA. </li></ul><br><p>  Sources: </p><br><ul><li>  Utility: <a href="https://github.com/qeda/qeda">https://github.com/qeda/qeda</a> </li><li>  Item Descriptions: <a href="https://github.com/qeda/library">https://github.com/qeda/library</a> </li><li>  Project <code>wifi-adapter</code> : <a href="https://github.com/qeda/examples/tree/master/wifi-adapter">https://github.com/qeda/examples/tree/master/wifi-adapter</a> </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/367427/">https://habr.com/ru/post/367427/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../367413/index.html">5 startups that will change our lives in 5 years</a></li>
<li><a href="../367415/index.html">Nissan will give a second life to LEAF batteries</a></li>
<li><a href="../367417/index.html">Replacing the deceased middle button of the Logitech G602 mouse</a></li>
<li><a href="../367421/index.html">The State Duma introduces a fine of 1 million rubles for search engines for failure to exercise the "right to oblivion"</a></li>
<li><a href="../367425/index.html">Ask Ethan # 3: Expansion of the Universe</a></li>
<li><a href="../367429/index.html">Weather in the house and on the street - how to ensure a healthy microclimate around you?</a></li>
<li><a href="../367431/index.html">New Year greetings and deer from Boston Dynamics</a></li>
<li><a href="../367433/index.html">Bartesian: get any cocktail from the capsule</a></li>
<li><a href="../367435/index.html">Blood cells on the chip will allow you to learn more about thrombosis and their treatment.</a></li>
<li><a href="../367437/index.html">BBC developers have learned to control TV with the help of thoughts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>