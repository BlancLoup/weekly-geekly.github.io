<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Generating a family tree based on Wikipedia data</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I want to show how using the Selenium Webdriver framework, based on Wikipedia data, you can create a genealogical tree of a given per...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Generating a family tree based on Wikipedia data</h1><div class="post__text post__text-html js-mediator-article">  In this article, I want to show how using the <a href="http://www.seleniumhq.org/projects/webdriver/">Selenium Webdriver</a> framework, based on <a href="https://ru.wikipedia.org/wiki/%25D0%2597%25D0%25B0%25D0%25B3%25D0%25BB%25D0%25B0%25D0%25B2%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2581%25D1%2582%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B8%25D1%2586%25D0%25B0">Wikipedia</a> data, you can create a genealogical tree of a given person (for example, the legendary founder of the first dynasty of Russian rulers <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D1%258E%25D1%2580%25D0%25B8%25D0%25BA">Rurik</a> ). <br><br>  The article will explain how to determine the name of the person, calculate the links to the pages of the person‚Äôs children, and also will build a genealogical tree generation algorithm. <a name="habracut"></a><br>  I will use <a href="https://java.com/ru/">Java</a> , <a href="http://www.seleniumhq.org/projects/webdriver/">Selenium Webdriver</a> and <a href="https://www.google.ru/chrome/browser/desktop/index.html">Chrome</a> .  Chrome, because it is faster than other browsers, and since the transition by url is the most time-consuming operation in the program, the choice of browser most noticeably affects time.  You can even abandon the browser and use, say <a href="http://phantomjs.org/">PhantomJs</a> , but it's harder to debug.  Therefore, I stopped at Chrome. <br><br>  First of all, we will create a test that verifies that the browser has started up correctly and that when navigating through <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D1%258E%25D1%2580%25D0%25B8%25D0%25BA">https://ru.wikipedia.org/wiki/Rurik,</a> a page with the title ‚ÄúRurik - Wikipedia‚Äù opens: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@BeforeClass</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{     driver = DriverHelper.getDriver(); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGetDriver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{     driver.navigate().to(<span class="hljs-string"><span class="hljs-string">"https://ru.wikipedia.org/wiki/%D0%A0%D1%8E%D1%80%D0%B8%D0%BA"</span></span>);     assertTrue(driver.getTitle().equals(<span class="hljs-string"><span class="hljs-string">" ‚Äî "</span></span>)); } <span class="hljs-meta"><span class="hljs-meta">@AfterClass</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{     driver.quit(); }</code> </pre> <br>  Create a class DriverHelper with a static getDriver () method so that the project compiles and the test is successful: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DriverHelper</span></span></span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TIMEOUT = <span class="hljs-number"><span class="hljs-number">30</span></span>;    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> WebDriver </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDriver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{        WebDriver driver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChromeDriver();        driver.manage().window().maximize();        driver.manage().timeouts().implicitlyWait(TIMEOUT, TimeUnit.SECONDS);        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> driver;    } }</code> </pre><br>  We run the test to make sure that the browser starts up correctly and opens the page you need. <br><br><h3>  Creating the Person class </h3><br>  Let's move on to the creation of the Person class, in which information about a person will be stored, as well as to the creation of a person's page class on the Wikipedia PersonPage. <br><br>  In the class Person for now there will be only two fields - name and url.  As the name, we will use the full name of the person, without division into a surname, first name, patronymic name, since  most members of the dynasty will not have a surname, but will have nicknames, titles and ordinal names. <br><br>  The url will point to a Wikipedia page dedicated to this person. <br>  Create a test that checks the formation of the person: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGetPerson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{    PersonPage page = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PersonPage(driver);    Person person = page.getPerson(<span class="hljs-string"><span class="hljs-string">"https://ru.wikipedia.org/wiki/_"</span></span>);    assertTrue(person.getName().equals(<span class="hljs-string"><span class="hljs-string">" "</span></span>));    assertTrue(person.getUrl().equals(        <span class="hljs-string"><span class="hljs-string">"https://ru.wikipedia.org/wiki/        %D0%92%D0%BB%D0%B0%D0%B4%D0%B8%D0%BC%D0%B8%D1%80_        %D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B0%D0%BD%D0%B4%D1%80%D0%BE%D0%B2%D0%B8%D1%87"</span></span>)); }</code> </pre><br>  testGetPerson () does not compile.  We need to design the PersonPage page to determine the name and page of the person.  We identify the url by the url of the current page, and the name by the textual content of the tag with the identifier firstHeading.  GetPerson () method: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Person </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPerson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String url)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> MalformedURLException </span></span>{    driver.navigate().to(url);    String name = getName();    Person person = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Person(driver.getCurrentUrl());    person.setName(name);    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> person; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> MalformedURLException </span></span>{    String namePage = driver.findElement(By.cssSelector(<span class="hljs-string"><span class="hljs-string">"#firstHeading"</span></span>)).getText();    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> namePage; }</code> </pre><br>  Reproof Tests - turned green. <br>  It is worth mentioning separately why the url is redefined, although it is passed as a parameter: the fact is that in Wikipedia several pages can be devoted to one person and redirected to one.  As a result, if we use the original URLs, then duplicates can occur when there are several people with ‚Äúdifferent‚Äù URLs, which are actually one person.  Therefore, the url is used as the URL to which all others redirect. <br><br>  For example: the page <a href="https://ru.wikipedia.org/wiki/%25D0%25AF%25D1%2580%25D0%25BE%25D1%2581%25D0%25BB%25D0%25B0%25D0%25B2_%25D0%259C%25D1%2583%25D0%25B4%25D1%2580%25D1%258B%25D0%25B9">https://ru.wikipedia.org/wiki/Yaroslav_Mudry is</a> redirected to <a href="https://ru.wikipedia.org/wiki/%25D0%25AF%25D1%2580%25D0%25BE%25D1%2581%25D0%25BB%25D0%25B0%25D0%25B2_%25D0%2592%25D0%25BB%25D0%25B0%25D0%25B4%25D0%25B8%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2587_%25D0%259C%25D1%2583%25D0%25B4%25D1%2580%25D1%258B%25D0%25B9">https://ru.wikipedia.org/wiki/Yaroslav_Vladimirovich_Wise</a> , and the page <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BD%25D0%25B4%25D1%2580%25D0%25B5%25D0%25B9_%25D0%2591%25D0%25BE%25D0%25B3%25D0%25BE%25D0%25BB%25D1%258E%25D0%25B1%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9">https://ru.wikipedia.org/wiki/Andrey_Bogolyubsky</a> - to <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BD%25D0%25B4%25D1%2580%25D0%25B5%25D0%25B9_%25D0%25AE%25D1%2580%25D1%258C%25D0%25B5%25D0%25B2%25D0%25B8%25D1%2587_%25D0%2591%25D0%25BE%25D0%25B3%25D0%25BE%25D0%25BB%25D1%258E%25D0%25B1%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9">https : //ru.wikipedia.org/wiki/Andrey_Yurievich_Bogolyubsky</a> <br><br><h3>  Definition of person's children </h3><br>  Let's try to identify the children of the person who have their own pages in Wikipedia. <br>  To begin with, we will write a test for determining the children of Rurik (more precisely, one - <a href="https://ru.wikipedia.org/wiki/%25D0%2598%25D0%25B3%25D0%25BE%25D1%2580%25D1%258C_%25D0%25A0%25D1%258E%25D1%2580%25D0%25B8%25D0%25BA%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2587">Igor</a> ): <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGetChildrenUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{    driver.navigate().to(<span class="hljs-string"><span class="hljs-string">"https://ru.wikipedia.org/wiki/"</span></span>);    PersonPage page = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PersonPage(driver);    List&lt;Person&gt; children = page.getChildrenUrl();    assertTrue(children.size() == <span class="hljs-number"><span class="hljs-number">1</span></span>);    Person person = children.get(<span class="hljs-number"><span class="hljs-number">0</span></span>);    assertTrue(person.getUrl().equals(<span class="hljs-string"><span class="hljs-string">"https://ru.wikipedia.org/wiki/        %D0%98%D0%B3%D0%BE%D1%80%D1%8C_        %D0%A0%D1%8E%D1%80%D0%B8%D0%BA%D0%BE%D0%B2%D0%B8%D1%87"</span></span>)); }</code> </pre><br>  In order for the test to be successful, you need to add to the PersonPage page a method for determining the urls of the person‚Äôs children: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Person&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getChildrenUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> MalformedURLException </span></span>{    List&lt;WebElement&gt; childrenLinks = driver.findElements(        By.xpath(<span class="hljs-string"><span class="hljs-string">"//table[contains(@class, 'infobox')]//tr[th[.=':']]//a"</span></span>));    List&lt;Person&gt; children = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;Person&gt;();    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (WebElement link : childrenLinks) {        Person person = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Person(link.getAttribute(<span class="hljs-string"><span class="hljs-string">"href"</span></span>));        children.add(person);    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> children; }</code> </pre><br>  So far, we ignore the fact that children may not be devoted to the pages in Wikipedia and therefore they do not have links to their pages.  For example, as in the case of the children of <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25BB%25D0%25B0%25D0%25B4%25D0%25B8%25D0%25BC%25D0%25B8%25D1%2580_%25D0%25AF%25D1%2580%25D0%25BE%25D1%2581%25D0%25BB%25D0%25B0%25D0%25B2%25D0%25B8%25D1%2587_(%25D0%25BA%25D0%25BD%25D1%258F%25D0%25B7%25D1%258C_%25D0%25B3%25D0%25B0%25D0%25BB%25D0%25B8%25D1%2586%25D0%25BA%25D0%25B8%25D0%25B9)">Vladimir Yaroslavich (the Galician prince)</a> .  We also ignore the fact that information about descendants can be located in the main area, such as, for example, <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B0%25D1%2580%25D0%25B8%25D1%258F_%25D0%2594%25D0%25BE%25D0%25B1%25D1%2580%25D0%25BE%25D0%25BD%25D0%25B5%25D0%25B3%25D0%25B0">on the page of Maria Dobronega</a> or <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B2%25D1%258F%25D1%2582%25D0%25BE%25D1%2581%25D0%25BB%25D0%25B0%25D0%25B2_%25D0%2592%25D1%2581%25D0%25B5%25D0%25B2%25D0%25BE%25D0%25BB%25D0%25BE%25D0%25B4%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2587_(%25D0%25BA%25D0%25BD%25D1%258F%25D0%25B7%25D1%258C_%25D1%2582%25D1%2580%25D1%2583%25D0%25B1%25D1%2587%25D0%25B5%25D0%25B2%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9)">on the page of Svyatoslav Vsevolodovich (Prince Trubchevsky)</a> . <br><br>  Add tests that verify the correctness of the definition of children for the person. <br>  As stated above, for the time being we assume that Vladimir Yaroslavich (the Galician prince) and Maria Dobronega did not have children, and <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25BB%25D0%25B0%25D0%25B4%25D0%25B8%25D0%25BC%25D0%25B8%25D1%2580_%25D0%25A1%25D0%25B2%25D1%258F%25D1%2582%25D0%25BE%25D1%2581%25D0%25BB%25D0%25B0%25D0%25B2%25D0%25B8%25D1%2587">Vladimir Svyatoslavich</a> had 16 children, although Wikipedia claims that he had 5 more unknown persons named after his daughters. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testChildrenSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{    driver.navigate().to(<span class="hljs-string"><span class="hljs-string">"https://ru.wikipedia.org/wiki/"</span></span>);    PersonPage page = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PersonPage(driver);    List&lt;String&gt; children = page.getChildrenUrl();    assertTrue(children.size() == <span class="hljs-number"><span class="hljs-number">1</span></span>);    driver.navigate().to(<span class="hljs-string"><span class="hljs-string">"https://ru.wikipedia.org/wiki/_"</span></span>);    children = page.getChildrenUrl();    assertTrue(children.size() == <span class="hljs-number"><span class="hljs-number">16</span></span>);    driver.navigate().to(<span class="hljs-string"><span class="hljs-string">"https://ru.wikipedia.org/wiki/__(_)"</span></span>);    children = page.getChildrenUrl();    assertTrue(children.size() == <span class="hljs-number"><span class="hljs-number">0</span></span>);    driver.navigate().to(<span class="hljs-string"><span class="hljs-string">"https://ru.wikipedia.org/wiki/_"</span></span>);    children = page.getChildrenUrl();    assertTrue(children.size() == <span class="hljs-number"><span class="hljs-number">0</span></span>); }</code> </pre><br>  In the Person class, we will add fields for the unique identifier of the person (int id) and the list of the person‚Äôs children (List &lt;Integer&gt; children), in which the identifiers of the children will be stored. <br>  We will develop a method for adding a child's identifier to the list of person's children.  A child can be added to the list only if he is not there yet. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setChild</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> childId)</span></span></span><span class="hljs-function"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!children.contains(childId)) {        children.add(childId);    } }</code> </pre><br>  Of course, do not forget to cover all the code with <a href="https://artemkorsakov.github.io/GenealogicalTree/">tests</a> and achieve a green result. <br><br><h3>  Descendant Search Algorithm </h3><br>  We now turn to the most interesting - the development of an algorithm for the search for descendants of a given person.  Create a GenerateGenealogicalTree class with the main method. <br><br>  As already mentioned, the most time-consuming is the transition by url, so you need to minimize the number of these transitions.  To do this, create a list of persons in which the whole genealogical tree will be stored.  In this list, let's remember the index of the current person - the one on whose page we are at the moment.  All persons with a lower index are considered ‚Äúvisited‚Äù, and all with a larger index (+ current) - ‚Äúunvisited‚Äù.  After the transition to the page of the current person has been made and its basic data have been calculated, the index is increased by one.  Thus, the current person falls into the category of "visited".  And it remains only to bypass the remaining "unvisited" persons.  At each moment of time those persons are known whose pages have already been viewed. <br><br>  The filling of the family tree with new ‚Äúunvisited‚Äù persons happens by adding the children of the current person to the end of the list.  At the same time, we add only those children who are not yet on the list so that duplicates do not occur (such a situation is possible when the husband and wife are both descendants of the forefather of the dynasty from different branches. Examples: <a href="https://ru.wikipedia.org/wiki/%25D0%2593%25D0%25BB%25D0%25B5%25D0%25B1_%25D0%2592%25D1%2581%25D0%25B5%25D1%2581%25D0%25BB%25D0%25B0%25D0%25B2%25D0%25B8%25D1%2587">husband</a> and <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BD%25D0%25B0%25D1%2581%25D1%2582%25D0%25B0%25D1%2581%25D0%25B8%25D1%258F_%25D0%25AF%25D1%2580%25D0%25BE%25D0%25BF%25D0%25BE%25D0%25BB%25D0%25BA%25D0%25BE%25D0%25B2%25D0%25BD%25D0%25B0">wife</a> are descendants of Rurik, <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25BB%25D0%25B0%25D0%25B4%25D0%25B8%25D0%25BC%25D0%25B8%25D1%2580_%25D0%2590%25D0%25BB%25D0%25B5%25D0%25BA%25D1%2581%25D0%25B0%25D0%25BD%25D0%25B4%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2587">husband</a> and <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B0%25D1%2580%25D0%25B8%25D1%258F_%25D0%259F%25D0%25B0%25D0%25B2%25D0%25BB%25D0%25BE%25D0%25B2%25D0%25BD%25D0%25B0_%25D0%259C%25D0%25B5%25D0%25BA%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B1%25D1%2583%25D1%2580%25D0%25B3-%25D0%25A8%25D0%25B2%25D0%25B5%25D1%2580%25D0%25B8%25D0%25BD%25D1%2581%25D0%25BA%25D0%25B0%25D1%258F">wife</a> are descendants <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25B0%25D0%25B2%25D0%25B5%25D0%25BB_I">Paul I</a> ). <br><br>  The genealogical tree is considered built when there are no ‚Äúunvisited‚Äù persons left, i.e.  when the index of the current person has become equal to the size of the pedigree tree. <br><br>  The algorithm is as follows: <br><br><ol><li>  The founder of the dynasty is created on the basis of a given url. </li><li>  Generated family tree based on the founder of the dynasty </li><li>  In the cycle as long as there are "unvisited" person </li><li>  The person is calculated on the basis of the current URL of the pedigree tree.  This person is set as current. </li><li>  If the current person is not a duplicate, then the list of her children is calculated and set.  All children are added to the list. </li><li>  If the current person has already met among the "visited" people, then it is removed. </li><li>  The transition to the next "unvisited" person, which is taken as the "current". </li></ol><br>  Algorithm code: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GenerateGenealogicalTree</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{        String url = getUrl(args);        GenealogicalTree tree = getGenealogicalTreeByUrl(url);        saveResultAndQuit(tree);    }    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> GenealogicalTree </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getGenealogicalTreeByUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String url)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> MalformedURLException </span></span>{        WebDriver driver = DriverHelper.getDriver();        Person person = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Person(url);        GenealogicalTree tree = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GenealogicalTree(person);        PersonPage page = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PersonPage(driver);        <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (tree.hasUnvisitingPerson()) {            String currentUrl = tree.getCurrentUrl();            Person currentPerson = page.getPerson(currentUrl);            tree.setCurrentPerson(currentPerson);            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!tree.isCurrentPersonDeleted()) {                List&lt;Person&gt; children = page.getChildrenUrl();                tree.setChildren(children);            }            tree.updatingCurrentPerson();        }        driver.quit();        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tree;    } }</code> </pre><br>  The GenealogicalTree class has three fields: List &lt;Person&gt; allPersons - a list of all members of the family tree, int indexCurrentUnvisitedPerson - the index of the current person in the list of allPersons, and boolean isCurrentPersonDeleted - a sign of whether the ‚Äúcurrent‚Äù person has been deleted (i.e., it is duplicate). <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GenealogicalTree</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Person&gt; allPersons;    <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> indexCurrentUnvisitedPerson;    <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> isCurrentPersonDeleted; }</code> </pre><br>  Initialization takes place on the basis of the ‚Äúancestor‚Äù of the dynasty - the first person whose descendants we are looking for: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenealogicalTree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Person person)</span></span></span><span class="hljs-function"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (person == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) {        <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"   "</span></span>);    }    allPersons = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;Person&gt;();    allPersons.add(person);    indexCurrentUnvisitedPerson = <span class="hljs-number"><span class="hljs-number">0</span></span>;    isCurrentPersonDeleted = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; }</code> </pre><br>  At this point, the family tree consists of one current ‚Äúunvisited‚Äù person.  There are no "visited" persons. <br><br>  As already mentioned, the list is checked for the presence of ‚Äúunvisited‚Äù persons as follows: if the current person‚Äôs index ‚Äúhas reached the end,‚Äù we believe that there are no ‚Äúunvisited‚Äù persons. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasUnvisitingPerson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> indexCurrentUnvisitedPerson &lt; allPersons.size(); }</code> </pre><br>  In the role of the url of the pedigree tree is the url of the current person: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCurrentUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> allPersons.get(indexCurrentUnvisitedPerson).getUrl(); }</code> </pre><br>  The setCurrentPerson method replaces the current person with the specified one. <br><br>  Initially, we only know about the person her url, which we get from the page of the parent.  Therefore, a person is added to the family tree, having only this information.  In essence, all ‚Äúunvisited‚Äù persons are simply urls.  The setCurrentPerson method ‚Äúspecifies‚Äù a person after the index ‚Äúgot to it‚Äù and the person has become current. <br><br>  If the ‚Äúrefined‚Äù person being installed has already been encountered before (this is possible if a redirect has occurred from the current person's url to one of the pages that was previously encountered), then the current person is deleted.  After that, the current person is marked as deleted.  If a given person does not occur earlier, then it "replaces" the current one.  In this case, the person is not considered deleted. <br><br>  The concept of "occurs before" implies that we check only the "visited" person.  "Unvisited" is not checked.  Theoretically, it is possible that the url of the current person redirects to the url, which can be met "later" among the "unvisited".  But this is such a rare situation that it is not worthwhile to ‚Äúrun through‚Äù the entire array each time.  In this rare case, the duplicate will be deleted anyway, when a queue ‚Äúcomes to it‚Äù and the index of the current person will point to the person with the url to which the redirect occurred. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCurrentPerson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Person currentPerson)</span></span></span><span class="hljs-function"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> indexDuplicate = allPersons.indexOf(currentPerson);    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-number"><span class="hljs-number">0</span></span> &lt;= indexDuplicate) &amp;&amp; (indexDuplicate &lt; indexCurrentUnvisitedPerson)) {        removePerson(indexDuplicate);    } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {        allPersons.get(indexCurrentUnvisitedPerson).copyMainData(currentPerson);        isCurrentPersonDeleted = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>;    } }</code> </pre><br>  In order for the indexOf (Object Object) method to work correctly, it is necessary in the Person class to override the equals (Object object) and hashCode () methods: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object object)</span></span></span><span class="hljs-function"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((object == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) || (!(object <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Person))) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>;    }    Person person = (Person) object;    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.url.equals(person.url); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.url.hashCode(); }</code> </pre><br>  Why do I need to constantly check the presence of a person in the list? <br>  The occurrence of duplicates is possible for many reasons: <br><br><ol><li>  Fatherhood is not known for certain.  As, for example, in the case of <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B2%25D1%258F%25D1%2582%25D0%25BE%25D0%25BF%25D0%25BE%25D0%25BB%25D0%25BA_%25D0%2592%25D0%25BB%25D0%25B0%25D0%25B4%25D0%25B8%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2587_%25D0%259E%25D0%25BA%25D0%25B0%25D1%258F%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B9">Svyatopolk the Accursed</a> , whose father is either <a href="https://ru.wikipedia.org/wiki/%25D0%25AF%25D1%2580%25D0%25BE%25D0%25BF%25D0%25BE%25D0%25BB%25D0%25BA_%25D0%25A1%25D0%25B2%25D1%258F%25D1%2582%25D0%25BE%25D1%2581%25D0%25BB%25D0%25B0%25D0%25B2%25D0%25B8%25D1%2587">Yaropolk Svyatoslavich</a> or <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25BB%25D0%25B0%25D0%25B4%25D0%25B8%25D0%25BC%25D0%25B8%25D1%2580_%25D0%25A1%25D0%25B2%25D1%258F%25D1%2582%25D0%25BE%25D1%2581%25D0%25BB%25D0%25B0%25D0%25B2%25D0%25B8%25D1%2587">Vladimir Svyatoslavich</a> </li><li>  Both parents are descendants of Rurik from different branches.  Example: <a href="http://fonkost.ru/genealogicaltree/rurick/95">Gleb Vseslavich</a> - a descendant of Rurik in the 8th generation was married to <a href="http://fonkost.ru/genealogicaltree/rurick/111">Anastasia Yaropolkovna</a> - also a descendant of Rurik (they are four cousins ‚Äã‚Äãwith her sister). </li><li>  Errors on the page: it is doubtful that <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D1%2581%25D0%25B5%25D0%25B2%25D0%25BE%25D0%25BB%25D0%25BE%25D0%25B4_%25D0%259C%25D1%2581%25D1%2582%25D0%25B8%25D1%2581%25D0%25BB%25D0%25B0%25D0%25B2%25D0%25B8%25D1%2587_(%25D0%25BA%25D0%25BD%25D1%258F%25D0%25B7%25D1%258C_%25D0%25BD%25D0%25BE%25D0%25B2%25D0%25B3%25D0%25BE%25D1%2580%25D0%25BE%25D0%25B4%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9)">Vsevolod Mstislavich</a> had a son, <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25BE%25D0%25BB%25D0%25BE%25D0%25B4%25D0%25B0%25D1%2580%25D1%258C_%25D0%2593%25D0%25BB%25D0%25B5%25D0%25B1%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2587">Volodar Glebovich</a> , whose parents recorded other people, also belonging to the Rurik dynasty.  Most likely, it's just a typo in Wikipedia </li></ol><br>  If these duplicates are not eliminated, then they will generate new repetitions, because  for all descendants of duplicates, the round will be performed twice, or even three times (in the case of <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25BE%25D0%25BB%25D0%25BE%25D0%25B4%25D0%25B0%25D1%2580%25D1%258C_%25D0%2593%25D0%25BB%25D0%25B5%25D0%25B1%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2587">Volodar Glebovich</a> ). <br><br>  Now consider removing a person from the list when it is a duplicate.  The person being removed may be on the list of children of a member of the family tree.  For example, when both parents are representatives of the same dynasty, one parent has a link to one page of the ‚Äúchild‚Äù and the other to another, which will then redirect to the first.  It turns out that if it is ‚Äúsimple‚Äù to remove the duplicate, then the second parent will have a link to a non-existent person. <br><br>  Therefore, before deleting the current person, in the list of children‚Äôs identifiers of all ‚Äúvisited‚Äù persons, its identifier should be replaced by the identifier of the found match (the ‚Äúunvisited‚Äù children do not have). <br><br>  After deletion, the current person is marked as deleted. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removePerson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> indexDuplicate)</span></span></span><span class="hljs-function"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> idRemovedPerson = allPersons.get(indexCurrentUnvisitedPerson).getId();    <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> idDuplicate = allPersons.get(indexDuplicate).getId();    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; indexCurrentUnvisitedPerson; i++) {        Person person = allPersons.get(i);        person.replaceChild(idRemovedPerson, idDuplicate);    }    allPersons.remove(indexCurrentUnvisitedPerson);    isCurrentPersonDeleted = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre><br>  In the Person class, add the method of replacing the "child": <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">replaceChild</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> oldId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> newId)</span></span></span><span class="hljs-function"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (oldId == newId) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;    }    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!children.contains(oldId)) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;    }    children.remove((Object) oldId);    setChild(newId); }</code> </pre><br>  Consider adding children to the current person. <br><br>  At the entrance we get a list of people who need to be set current as children. <br>  The main difference in the search for duplicates is that now we will look for them not only among the ‚Äúvisited‚Äù persons, but also among the ‚Äúunvisited‚Äù, i.e.  within the whole family tree. <br>  If the current person is deleted, an exception is thrown, because  in fact, there is no one to install children. <br><br>  If not deleted, then go over the list passed as a parameter.  If the child is already found in the pedigree tree, then the identifier of the duplicate found is added to the list of children.  If a child does not occur in the pedigree tree, then its identifier is added to the list of children, in addition, the child itself is added to the end of the pedigree tree, to the list of "unvisited" persons. <br><br>  Thus, the list is filled with the setChildren () method. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setChildren</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;Person&gt; children)</span></span></span><span class="hljs-function"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isCurrentPersonDeleted) {        <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalArgumentException(            <span class="hljs-string"><span class="hljs-string">"    .    "</span></span>);    }    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Person person : children) {        <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = allPersons.indexOf(person);        <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id;        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) {            id = allPersons.get(index).getId();        } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {            allPersons.add(person);            id = person.getId();        }        allPersons.get(indexCurrentUnvisitedPerson).setChild(id);    } }</code> </pre><br>  The counter of the current person needs to be updated, otherwise the family tree will never be built.  It happens this way: if the current person is removed, then the next ‚Äúunvisited‚Äù person is already in ‚Äúher place‚Äù, therefore, simply ‚Äúremove‚Äù the sign of the deleted person from the current person.  If the current person is not deleted, then we consider it ‚Äúfilled‚Äù with all the data and proceed to the next ‚Äúunvisited‚Äù person. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updatingCurrentPerson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isCurrentPersonDeleted) {        isCurrentPersonDeleted = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>;    } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {        indexCurrentUnvisitedPerson++;    } }</code> </pre><br>  Circumvention is carried out by generations: first, the founder of the dynasty (0th generation), then all his children (1st generation) from elder to younger (we assume that the URLs in Wikipedia are in this order), then grandchildren (2nd generation ) (children of the eldest son by seniority, then - the 2nd son, and so on until the youngest), great-grandchildren (3rd generation) and so on until the last representative of the dynasty. <br><br>  Naturally, do not forget to bring the code coverage with tests up to 100%, to make sure that everything works exactly as intended.  A description of the tests is available in <a href="https://artemkorsakov.github.io/GenealogicalTree/">javadoc</a> . <br><br>  Separately, it is worth mentioning this: the GenealogicalTree class is very insecure and easy to force to work incorrectly if used outside the generation tree generation algorithm (outside GenerateGenealogicalTree).  The only correct solution in this situation is to transfer this class as an internal private class for GenerateGenealogicalTree.  But this has not yet been done for the convenience of testing the algorithm. <br>  Run the program. <br><br><h3>  Logging results in the database </h3><br>  The first launch shows that we have a huge amount of data that must somehow be analyzed to weed out deliberately incorrect results.  Looking ahead, I will inform you that on September 17, 2017 there were <a href="http://fonkost.ru/genealogicaltree/rurick">3448 pages of direct descendants of Rurik</a> on Wikipedia.  The easiest way is to process a similar amount of information in the database. <br><br>  First, we deploy a local database, which we call genealogtree.  With a standard root user without a password.  To interact with the database, we will use the standard <a href="https://mvnrepository.com/artifact/mysql/mysql-connector-java">MySQL JDBC Type 4 driver</a> library. <br><br>  And then we create a new class for interacting with the database and a method for saving the genealogical tree in the table with the specified name: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MySqlHelper</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String url = <span class="hljs-string"><span class="hljs-string">"jdbc:mysql://localhost:3306/genealogicaltree"</span></span>        + <span class="hljs-string"><span class="hljs-string">"?serverTimezone=UTC&amp;useUnicode=yes&amp;characterEncoding=UTF-8"</span></span>;    <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String user = <span class="hljs-string"><span class="hljs-string">"root"</span></span>;    <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String password = <span class="hljs-string"><span class="hljs-string">""</span></span>;    <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Connection connection;    <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Statement statement;    <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> ResultSet resultSet;    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveTree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String tableName, List&lt;Person&gt; tree)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> MalformedURLException </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {            connection = DriverManager.getConnection(url, user, password);            statement = connection.createStatement();            String table = createTable(tableName);            statement.executeUpdate(table);            <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Person person : tree) {                String insert = insertPerson(tableName, person);                statement.executeUpdate(insert);            }        } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (SQLException sqlEx) {            sqlEx.printStackTrace();        } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> {            <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {                connection.close();            } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (SQLException se) {            }            <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {                statement.close();            } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (SQLException se) {            }        }    }    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createTable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String tableName)</span></span></span><span class="hljs-function"> </span></span>{        StringBuilder sql = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder();        sql.append(<span class="hljs-string"><span class="hljs-string">"CREATE TABLE "</span></span> + tableName + <span class="hljs-string"><span class="hljs-string">" ("</span></span>);        sql.append(<span class="hljs-string"><span class="hljs-string">"id INTEGER not NULL, "</span></span>);        sql.append(<span class="hljs-string"><span class="hljs-string">"name VARCHAR(255), "</span></span>);        sql.append(<span class="hljs-string"><span class="hljs-string">"url VARCHAR(2048), "</span></span>);        sql.append(<span class="hljs-string"><span class="hljs-string">"children VARCHAR(255), "</span></span>);        sql.append(<span class="hljs-string"><span class="hljs-string">"PRIMARY KEY ( id ))"</span></span>);        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sql.toString();    }    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">insertPerson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String tableName, Person person)</span></span></span><span class="hljs-function"> </span></span>{        StringBuilder sql = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder();        sql.append(<span class="hljs-string"><span class="hljs-string">"INSERT INTO genealogicaltree."</span></span> + tableName);        sql.append(<span class="hljs-string"><span class="hljs-string">"(id, name, url, nameUrl, children, parents, numberGeneration) \n VALUES ("</span></span>);        sql.append(person.getId() + <span class="hljs-string"><span class="hljs-string">","</span></span>);        sql.append(<span class="hljs-string"><span class="hljs-string">"'"</span></span> + person.getName() + <span class="hljs-string"><span class="hljs-string">"',"</span></span>);        sql.append(<span class="hljs-string"><span class="hljs-string">"'"</span></span> + person.getUrl() + <span class="hljs-string"><span class="hljs-string">"',"</span></span>);        sql.append(<span class="hljs-string"><span class="hljs-string">"'"</span></span> + person.getChildren() + <span class="hljs-string"><span class="hljs-string">"',"</span></span>);        sql.append(<span class="hljs-string"><span class="hljs-string">");"</span></span>);        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sql.toString();    } }</code> </pre><br>  We finalize saving the generation results: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveResultAndQuit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GenealogicalTree tree)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{    Timestamp timestamp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Timestamp(System.currentTimeMillis());    String tableName = <span class="hljs-string"><span class="hljs-string">"generate"</span></span> + timestamp.getTime();    MySqlHelper.saveTree(tableName, tree.getGenealogicalTree()); }</code> </pre><br><h3>  Parsing first results </h3><br>  The first run of GenerateGenealogicalTree.main () produced a lot of entries, a quick inspection of which shows the presence of non-existent and erroneous pages. <br><br>  We expand errors into categories: <br><br><ol><li>  The year has been added to the list of children (for example, <a href="https://ru.wikipedia.org/wiki/1153_%25D0%25B3%25D0%25BE%25D0%25B4">1153</a> from the page of <a href="https://ru.wikipedia.org/wiki/%25D0%25AF%25D1%2580%25D0%25BE%25D1%2581%25D0%25BB%25D0%25B0%25D0%25B2_%25D0%25A1%25D0%25B2%25D1%258F%25D1%2582%25D0%25BE%25D1%2581%25D0%25BB%25D0%25B0%25D0%25B2%25D0%25B8%25D1%2587">Yaroslav Svyatoslavovich</a> ) <br></li><li>  Non-Russian article: <a href="https://fr.wikipedia.org/wiki/Ad%25C3%25A9la%25C3%25AFde_de_France">Adelaide of France</a> , daughter of <a href="https://ru.wikipedia.org/wiki/%25D0%259B%25D1%258E%25D0%25B4%25D0%25BE%25D0%25B2%25D0%25B8%25D0%25BA_VII">Louis VII</a> , King of France </li><li>  Page <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25BD%25D0%25B5%25D0%25B1%25D1%2580%25D0%25B0%25D1%2587%25D0%25BD%25D1%258B%25D0%25B9_%25D1%2580%25D0%25B5%25D0%25B1%25D1%2591%25D0%25BD%25D0%25BE%25D0%25BA">"bastard child"</a> , which appeared from the same Louis VII </li><li>  External pages like <a href="https://www.wikidata.org/wiki/Q3439613%3Fuselang%3Dru">this</a> which are on the list, for example, from <a href="https://ru.wikipedia.org/wiki/%25D0%2593%25D0%25B0%25D0%25BB%25D0%25B5%25D1%2580%25D0%25B0%25D0%25BD_IV_%25D0%25B4%25D0%25B5_%25D0%2591%25D0%25BE%25D0%25BC%25D0%25BE%25D0%25BD,_%25D0%25B3%25D1%2580%25D0%25B0%25D1%2584_%25D0%25B4%25D0%25B5_%25D0%259C%25D1%2591%25D0%25BB%25D0%25B0%25D0%25BD">Galeran IV de Beaumont</a> </li><li>  "Creating a page."  For example, <a href="https://ru.wikipedia.org/w/index.php%3Ftitle%3D%25D0%2590%25D0%25BD%25D0%25BD%25D0%25B0_%25D0%25AE%25D1%2580%25D1%258C%25D0%25B5%25D0%25B2%25D0%25BD%25D0%25B0%26action%3Dedit%26redlink%3D1">Anna Yurievna</a> , daughter of Prince <a href="https://ru.wikipedia.org/wiki/%25D0%25AE%25D1%2580%25D0%25B8%25D0%25B9_%25D0%25AF%25D1%2580%25D0%25BE%25D1%2581%25D0%25BB%25D0%25B0%25D0%25B2%25D0%25B8%25D1%2587_(%25D0%25BA%25D0%25BD%25D1%258F%25D0%25B7%25D1%258C_%25D1%2582%25D1%2583%25D1%2580%25D0%25BE%25D0%25B2%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9)">Yury Yaroslavich of</a> Turov </li></ol><br>  We will refine the getChildrenUrl () method of defining children‚Äôs pages in order to exclude obviously erroneous ones.  In order not to fall 1 category, you need to remove those links, the text content of which begins with a number.  To avoid 2 category, you need to remove those links whose class is equal to extiw.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To avoid 3-4 categories, it is necessary to exclude links whose parent tag is equal to sup (clarifying links). </font><font style="vertical-align: inherit;">To remove a category from list 5, you must exclude links whose class is new (page creation). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To begin with, let's finalize the testChildrenSize () test, adding to it a check of all categories of reference curves:</font></font><br><br><pre> <code class="java hljs">driver.navigate().to(<span class="hljs-string"><span class="hljs-string">"https://ru.wikipedia.org/wiki/_"</span></span>); children = page.getChildrenUrl(); assertTrue(children.size() == <span class="hljs-number"><span class="hljs-number">3</span></span>); driver.navigate().to(<span class="hljs-string"><span class="hljs-string">"https://ru.wikipedia.org/wiki/_VII"</span></span>); children = page.getChildrenUrl(); assertTrue(children.size() == <span class="hljs-number"><span class="hljs-number">5</span></span>); driver.navigate().to(<span class="hljs-string"><span class="hljs-string">"https://ru.wikipedia.org/wiki/_IV__,___"</span></span>); children = page.getChildrenUrl(); assertTrue(children.size() == <span class="hljs-number"><span class="hljs-number">0</span></span>); driver.navigate().to(<span class="hljs-string"><span class="hljs-string">"https://ru.wikipedia.org/wiki/__(_)"</span></span>); children = page.getChildrenUrl(); assertTrue(children.size() == <span class="hljs-number"><span class="hljs-number">5</span></span>);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The test is predictably red. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now we will finalize the getChildrenUrl () method:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Person&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getChildrenUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> MalformedURLException </span></span>{    waitLoadPage();    List&lt;WebElement&gt; childrenLinks = getChildrenLinks();    List&lt;Person&gt; children = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;Person&gt;();    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (WebElement link : childrenLinks) {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (DriverHelper.isSup(link)) {            <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>;        }        Person person = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Person(link.getAttribute(<span class="hljs-string"><span class="hljs-string">"href"</span></span>));        person.setNameUrl(link.getText());        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (person.isCorrectNameUrl()) {            children.add(person);        }    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> children; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> List&lt;WebElement&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getChildrenLinks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{    List&lt;WebElement&gt; childrenLinks = DriverHelper.getElements(driver,        By.xpath(<span class="hljs-string"><span class="hljs-string">"//table[contains(@class, 'infobox')]//tr[th[.=':']]"</span></span> +                <span class="hljs-string"><span class="hljs-string">"//a[not(@class='new' or @class='extiw')]"</span></span>));    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> childrenLinks; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">waitLoadPage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.driver.findElement(By.cssSelector(<span class="hljs-string"><span class="hljs-string">"#firstHeading"</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DriverHelper</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-comment"><span class="hljs-comment">/**    *       .&lt;br&gt;    *      -  ,       *    ,          * ,   ,     .       *    ,    ,       * .    */</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> List&lt;WebElement&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getElements</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(WebDriver driver, By by)</span></span></span><span class="hljs-function"> </span></span>{        driver.manage().timeouts().implicitlyWait(<span class="hljs-number"><span class="hljs-number">0</span></span>, TimeUnit.SECONDS);        List&lt;WebElement&gt; result = driver.findElements(by);        driver.manage().timeouts().implicitlyWait(DriverHelper.TIMEOUT, TimeUnit.SECONDS);        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result;    }    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isSup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(WebElement element)</span></span></span><span class="hljs-function"> </span></span>{        String parentTagName = element.findElement(By.xpath(<span class="hljs-string"><span class="hljs-string">".//.."</span></span>)).getTagName();        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parentTagName.equals(<span class="hljs-string"><span class="hljs-string">"sup"</span></span>);    } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String nameUrl;    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isCorrectNameUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{        Pattern p = Pattern.compile(<span class="hljs-string"><span class="hljs-string">"^[\\D]+.+"</span></span>);        Matcher m = p.matcher(nameUrl);        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m.matches();    } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nameUrl is the name of the person‚Äôs link that it has on the parent‚Äôs page. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We rethrow the entire test suite - turned green. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rurik has a lot of descendants to whom the Russian-language pages are devoted to Wikipedia, so first we will run through the program for </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B8%25D1%2585%25D0%25B0%25D0%25B8%25D0%25BB_%25D0%25A4%25D1%2591%25D0%25B4%25D0%25BE%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2587"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Fedorovich</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - the first tsar from the Romanov dynasty. </font><font style="vertical-align: inherit;">Run, wait for the end and analyze the results.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Romanovs </font></font></h3><br>   383      (    ,         ,    ,     18   <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2591%25D1%2582%25D1%2580_II"> II</a> ),   <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B0%25D1%2580%25D0%25B3%25D1%2580%25D0%25B5%25D1%2582%25D0%25B5_II"> </a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25B8%25D0%25BB%25D0%25B8%25D0%25BF%25D0%25BF_VI_(%25D0%25BA%25D0%25BE%25D1%2580%25D0%25BE%25D0%25BB%25D1%258C_%25D0%2598%25D1%2581%25D0%25BF%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B8)"> </a> , <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25B8%25D0%25BB%25D0%25BB%25D0%25B5%25D0%25BC-%25D0%2590%25D0%25BB%25D0%25B5%25D0%25BA%25D1%2581%25D0%25B0%25D0%25BD%25D0%25B4%25D1%2580"> </a> , <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D0%25BB_XVI_%25D0%2593%25D1%2583%25D1%2581%25D1%2582%25D0%25B0%25D0%25B2"> </a> ,    <a href="https://ru.wikipedia.org/wiki/%25D0%2595%25D0%25BB%25D0%25B8%25D0%25B7%25D0%25B0%25D0%25B2%25D0%25B5%25D1%2582%25D0%25B0_II">   II</a> ,   <a href="https://ru.wikipedia.org/wiki/%25D0%25A7%25D0%25B0%25D1%2580%25D0%25BB%25D1%258C%25D0%25B7,_%25D0%25BF%25D1%2580%25D0%25B8%25D0%25BD%25D1%2586_%25D0%25A3%25D1%258D%25D0%25BB%25D1%258C%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9">    </a> .   , ,      . <br><br>       .     : <br><br><ol><li>     <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25BB%25D0%25B0%25D0%25B4%25D0%25B8%25D0%25BC%25D0%25B8%25D1%2580_%25D0%2590%25D0%25BB%25D0%25B5%25D0%25BA%25D1%2581%25D0%25B0%25D0%25BD%25D0%25B4%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2587"> </a>      <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2580%25D0%25B8%25D0%25B7%25D0%25BE_%25D0%259E%25D1%2580%25D0%25B0%25D0%25BD%25D1%2581%25D0%25BA%25D0%25BE-%25D0%259D%25D0%25B0%25D1%2581%25D1%2581%25D0%25B0%25D1%2583%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9"> -</a> </li><li>      <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D1%2582%25D0%25B8_%25D0%2590%25D0%25BB%25D0%25B5%25D0%25BA%25D1%2581%25D0%25B5%25D1%258F_%25D0%259C%25D0%25B8%25D1%2585%25D0%25B0%25D0%25B9%25D0%25BB%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2587%25D0%25B0">  </a> ,   ‚Äî <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D1%2582%25D0%25B8_%25D0%2598%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B0_V">  V</a> ,   ‚Äî <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D1%2582%25D0%25B8_%25D0%259F%25D0%25B5%25D1%2582%25D1%2580%25D0%25B0_I">  I</a>   -  <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D1%2582%25D0%25B8_%25D0%259C%25D0%25B8%25D1%2585%25D0%25B0%25D0%25B8%25D0%25BB%25D0%25B0_%25D0%25A4%25D1%2591%25D0%25B4%25D0%25BE%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2587%25D0%25B0">  </a> </li></ol><br>    ‚Äî    <a href="https://ru.wikipedia.org/wiki/URL"></a> ,      ,         ,    ,        ‚Äî   . <br><br> ,     ‚Äî  ,         , ..    ( ,  ,  <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2580%25D0%25B8%25D0%25B7%25D0%25BE_%25D0%259E%25D1%2580%25D0%25B0%25D0%25BD%25D1%2581%25D0%25BA%25D0%25BE-%25D0%259D%25D0%25B0%25D1%2581%25D1%2581%25D0%25B0%25D1%2583%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9"> -</a> ,     ) <br>      getChildrenUrl(),   ,   url  .   ,    ¬´¬ª        , ..    ,      . <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Person&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getChildrenUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{    waitLoadPage();    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (DriverHelper.hasAnchor(driver)) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;Person&gt;();    }    ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DriverHelper</span></span></span><span class="hljs-class"> </span></span>{    ...    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasAnchor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(WebDriver driver)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> MalformedURLException </span></span>{        URL url = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URL(driver.getCurrentUrl());        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> url.getRef() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>;    }    ... }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Add a new test that checks that the person with the anchor URL has no children: </font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testEmptyChildrenInPersonWithAnchor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{    driver.navigate().to(<span class="hljs-string"><span class="hljs-string">"https://ru.wikipedia.org/wiki/_"</span></span>);    PersonPage page = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PersonPage(driver);    List&lt;String&gt; children = page.getChildrenUrl();    assertTrue(children.size() == <span class="hljs-number"><span class="hljs-number">5</span></span>);    driver.navigate().to(        <span class="hljs-string"><span class="hljs-string">"https://ru.wikipedia.org/wiki/_#.D0.A1.D0.B5.D0.BC.D1.8C.D1.8F"</span></span>);    children = page.getChildrenUrl();    assertTrue(children.size() == <span class="hljs-number"><span class="hljs-number">0</span></span>); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We rethrow the whole test suite to make sure that nothing is broken. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If offspring is not calculated, then what is the point in going through the url with an anchor? </font><font style="vertical-align: inherit;">The offspring, of course, is not defined, but other information can be obtained: the name of the person or, for example, the years of life. </font><font style="vertical-align: inherit;">Therefore, it is better to ‚Äúsave‚Äù such URLs for future functionality expansion.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Calculating the name of the "anchor" </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In most cases, the name of a person can be calculated by ‚Äúanchor‚Äù: the name is the textual content of the tag with an identifier equal to the value of the ‚Äúanchor‚Äù. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's refine the getName () method:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> MalformedURLException </span></span>{    waitLoadPage();    String namePage = driver.findElement(By.cssSelector(<span class="hljs-string"><span class="hljs-string">"#firstHeading"</span></span>)).getText();    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!DriverHelper.hasAnchor(driver)) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> namePage;    }    String anchor = DriverHelper.getAnchor(driver);    List&lt;WebElement&gt; list = DriverHelper.getElements(driver, By.id(anchor));    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (list.size() == <span class="hljs-number"><span class="hljs-number">0</span></span>) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> namePage;    }    String name = list.get(<span class="hljs-number"><span class="hljs-number">0</span></span>).getText().trim();    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name.isEmpty() ? namePage : name; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DriverHelper</span></span></span><span class="hljs-class"> </span></span>{    ...    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAnchor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(WebDriver driver)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> MalformedURLException </span></span>{        URL url = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URL(driver.getCurrentUrl());        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> url.getRef();    }    ... }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the current url contains an ‚Äúanchor‚Äù, then it is necessary to check the existence of an element on the page with an identifier equal to ‚Äúanchor‚Äù. </font><font style="vertical-align: inherit;">It can not exist, as is the case with </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D1%2582%25D0%25B8_%25D0%259F%25D0%25B5%25D1%2582%25D1%2580%25D0%25B0_I"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Natalia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - daughter </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2591%25D1%2582%25D1%2580_I"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">of Peter I of</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">On Peter‚Äôs page, the link contains a non-existent ‚Äúanchor‚Äù that does not match the ‚Äúanchor‚Äù of Natalia. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You also need to make sure that the tag with the ‚Äúanchor‚Äù identifier contains non-empty text and return the name of the page otherwise. </font><font style="vertical-align: inherit;">Otherwise, as, for example, in the situation with </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%2591%25D0%25B5%25D0%25BB%25D0%25BE%25D0%25B7%25D0%25B5%25D1%2580%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B5_%25D0%25BA%25D0%25BD%25D1%258F%25D0%25B7%25D1%258C%25D1%258F"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demyan Glebovich</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , an empty name will be determined and the program will crash with an exception. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The tests turned green again.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adding Link Name, Parent, and Generation Number </font></font></h3><br>  :  ,   <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25BB%25D0%25B0%25D0%25B4%25D0%25B8%25D0%25BC%25D0%25B8%25D1%2580_%25D0%2590%25D0%25BB%25D0%25B5%25D0%25BA%25D1%2581%25D0%25B0%25D0%25BD%25D0%25B4%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2587"> </a> ,   ¬´¬ª.    ?! <br><br>                   , ..   getChildrenUrl().          nameUrl   ,       . <br><br> ,       . <br><br>    ,       ¬´¬ª,      ¬´  ¬ª. ,   ,   ,   nameUrl    (  ""  ). <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We override the program for the Romanovs and check the data with those that were collected before refactoring. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is how urles with anchors now look like:</font></font><br><table><tbody><tr><th>  id </th><th>  name </th><th>  children </th><th>  url </th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> urlName </font></font></th></tr><tr><td>  eight </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pelagia </font></font></td><td>  [] </td><td>  <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D1%2582%25D0%25B8_%25D0%259C%25D0%25B8%25D1%2585%25D0%25B0%25D0%25B8%25D0%25BB%25D0%25B0_%25D0%25A4%25D1%2591%25D0%25B4%25D0%25BE%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2587%25D0%25B0">link</a> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pelagia </font></font></td></tr><tr><td>  9 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Marfa </font></font></td><td>  [] </td><td>  <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D1%2582%25D0%25B8_%25D0%259C%25D0%25B8%25D1%2585%25D0%25B0%25D0%25B8%25D0%25BB%25D0%25B0_%25D0%25A4%25D1%2591%25D0%25B4%25D0%25BE%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2587%25D0%25B0">link</a> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Marfa </font></font></td></tr><tr><td>  ten </td><td>  Sofia </td><td>  [] </td><td>  <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D1%2582%25D0%25B8_%25D0%259C%25D0%25B8%25D1%2585%25D0%25B0%25D0%25B8%25D0%25BB%25D0%25B0_%25D0%25A4%25D1%2591%25D0%25B4%25D0%25BE%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2587%25D0%25B0">link</a> </td><td>  Sofia </td></tr><tr><td>  15 </td><td>  Anna </td><td>  [] </td><td>  <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D1%2582%25D0%25B8_%25D0%2590%25D0%25BB%25D0%25B5%25D0%25BA%25D1%2581%25D0%25B5%25D1%258F_%25D0%259C%25D0%25B8%25D1%2585%25D0%25B0%25D0%25B9%25D0%25BB%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2587%25D0%25B0">link</a> </td><td>  Anna </td></tr><tr><td>  23 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Evdokia (younger) </font></font></td><td>  [] </td><td>  <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D1%2582%25D0%25B8_%25D0%2590%25D0%25BB%25D0%25B5%25D0%25BA%25D1%2581%25D0%25B5%25D1%258F_%25D0%259C%25D0%25B8%25D1%2585%25D0%25B0%25D0%25B9%25D0%25BB%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2587%25D0%25B0">link</a> </td><td>  Evdokia </td></tr><tr><td>  26 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Theodora </font></font></td><td>  [] </td><td>  <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D1%2582%25D0%25B8_%25D0%2590%25D0%25BB%25D0%25B5%25D0%25BA%25D1%2581%25D0%25B5%25D1%258F_%25D0%259C%25D0%25B8%25D1%2585%25D0%25B0%25D0%25B9%25D0%25BB%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2587%25D0%25B0">link</a> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Theodora </font></font></td></tr><tr><td>  28 </td><td>  Maria </td><td>  [] </td><td>  <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D1%2582%25D0%25B8_%25D0%2598%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B0_V">link</a> </td><td>  Maria </td></tr><tr><td>  29 </td><td>  Theodosius </td><td>  [] </td><td>  <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D1%2582%25D0%25B8_%25D0%2598%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B0_V">link</a> </td><td>  Theodosius </td></tr><tr><td>  36 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Children of Peter I </font></font></td><td>  [] </td><td>  <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D1%2582%25D0%25B8_%25D0%259F%25D0%25B5%25D1%2582%25D1%2580%25D0%25B0_I">link</a> </td><td>  Natalia </td></tr><tr><td>  133 </td><td>  Family </td><td>  [] </td><td>  <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25BB%25D0%25B0%25D0%25B4%25D0%25B8%25D0%25BC%25D0%25B8%25D1%2580_%25D0%2590%25D0%25BB%25D0%25B5%25D0%25BA%25D1%2581%25D0%25B0%25D0%25BD%25D0%25B4%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2587">link</a> </td><td>  Alexander </td></tr><tr><td>  360 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Marriage and children </font></font></td><td>  [] </td><td>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2580%25D0%25B8%25D0%25B7%25D0%25BE_%25D0%259E%25D1%2580%25D0%25B0%25D0%25BD%25D1%2581%25D0%25BA%25D0%25BE-%25D0%259D%25D0%25B0%25D1%2581%25D1%2581%25D0%25B0%25D1%2583%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9">link</a> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Luana of Orange-Nassau </font></font></td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adding the name of the link did not pass unnoticed. </font><font style="vertical-align: inherit;">The program run for Rurik unexpectedly took off with the exception of a violation of the insert instruction on </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%2593%25D0%25B5%25D0%25BD%25D1%2580%25D0%25B8%25D1%2585_II_(%25D0%25BA%25D0%25BE%25D1%2580%25D0%25BE%25D0%25BB%25D1%258C_%25D0%259D%25D0%25B0%25D0%25B2%25D0%25B0%25D1%2580%25D1%2580%25D1%258B)"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Henry II (King of Navarre)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> due to the fact that nameUrl contains a value with an apostrophe, Henry II d'Albre. </font><font style="vertical-align: inherit;">We will refine the setName and setNameUrl methods in the Person class, keeping the specified value without apostrophes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I recall that in Wikipedia there were about three and a half thousand descendants of Rurik. </font><font style="vertical-align: inherit;">If you display this information in the form of a table, you get a </font></font><a href="http://fonkost.ru/genealogicaltree/rurick"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">very large page.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">you get tired of scrolling. It would be interesting not only to see the whole plate, but also to have the opportunity to highlight the connection of a given representative with the ancestor of the dynasty (that is, to select all the ancestors of a given representative up to the ancestor). And also to know what kind of generation it is. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To make it easier to implement this new functionality, add the fields for the generation number and the list of parents to the Person class (so that it is easier to build an increasing relationship):</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Integer&gt; parents = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;Integer&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> numberGeneration = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setParent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> parent)</span></span></span><span class="hljs-function"> </span></span>{    parents.add(parent); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setNumberGeneration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> numberGeneration)</span></span></span><span class="hljs-function"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.numberGeneration == <span class="hljs-number"><span class="hljs-number">0</span></span>) {        <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.numberGeneration = numberGeneration;    } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The parent in most cases will be one, but there may be situations where both parents are descendants of the forefather of the dynasty from different branches and then there will be two of them. Above was even given an example of an error, when at once three "are" the parents of the same person (the </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D1%2581%25D0%25B5%25D0%25B2%25D0%25BE%25D0%25BB%25D0%25BE%25D0%25B4_%25D0%259C%25D1%2581%25D1%2582%25D0%25B8%25D1%2581%25D0%25BB%25D0%25B0%25D0%25B2%25D0%25B8%25D1%2587_(%25D0%25BA%25D0%25BD%25D1%258F%25D0%25B7%25D1%258C_%25D0%25BD%25D0%25BE%25D0%25B2%25D0%25B3%25D0%25BE%25D1%2580%25D0%25BE%25D0%25B4%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9)"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">first</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%2593%25D0%25BB%25D0%25B5%25D0%25B1_%25D0%2592%25D1%2581%25D0%25B5%25D1%2581%25D0%25BB%25D0%25B0%25D0%25B2%25D0%25B8%25D1%2587"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">second</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BD%25D0%25B0%25D1%2581%25D1%2582%25D0%25B0%25D1%2581%25D0%25B8%25D1%258F_%25D0%25AF%25D1%2580%25D0%25BE%25D0%25BF%25D0%25BE%25D0%25BB%25D0%25BA%25D0%25BE%25D0%25B2%25D0%25BD%25D0%25B0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">third</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25BE%25D0%25BB%25D0%25BE%25D0%25B4%25D0%25B0%25D1%2580%25D1%258C_%25D0%2593%25D0%25BB%25D0%25B5%25D0%25B1%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2587"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">their "common" child</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - and all of Rurikovich). Of course, physiologically this is impossible, it turns out, as in the </font></font><a href="http://bash.im/quote/402657"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anectode</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but, unfortunately, </font><font style="vertical-align: inherit;">it is impossible </font><font style="vertical-align: inherit;">to automatically determine who their ‚Äúsuperfluous‚Äù them is, so you will have to save everyone.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is obvious that in the list of parents there can only be representatives of the dynasty and ‚Äúgather‚Äù all the ancestors of a given representative of the dynasty up to the ancestor can be very easy, the name only this information. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As for the number of the knee, it is set only once from the first parent. </font><font style="vertical-align: inherit;">At that moment, when the second parent appears, referring to the child, the generation number is no longer updated.</font></font> Since<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bypassing the genealogical tree occurs by generations, it is obvious that the number of the generation of the first parent will be equal to or greater than the number of the tribe of the first parent, which means the fastest way to build a connection through the "first parents". </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We will set the generation number and parent identifier in the setChildren (List &lt;Person&gt; children) method of the GenerateGenealogicalTree class:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setChildren</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;Person&gt; children)</span></span></span><span class="hljs-function"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isCurrentPersonDeleted) {        <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalArgumentException(            <span class="hljs-string"><span class="hljs-string">"    .    "</span></span>);    }    Person currentPerson = allPersons.get(indexCurrentUnvisitedPerson);    <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> numberGeneration = currentPerson.getNumberGeneration();    numberGeneration++;    <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> idParent = currentPerson.getId();    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Person person : children) {        <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = allPersons.indexOf(person);        <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id;        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//  ,                allPersons.get(index).setParent(idParent);            id = allPersons.get(index).getId();        } else { //              person.setNumberGeneration(numberGeneration);            person.setParent(idParent);            allPersons.add(person);            id = person.getId();        }        currentPerson.setChild(id);    } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Of course, we don‚Äôt forget to cover all the code with tests - if you don‚Äôt do this right away, then it will be difficult to sort through the code porridge. </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Final results </font></font></h3><br>         : <br> <a href="http://fonkost.ru/genealogicaltree/adam"> ‚Äî    </a> <br> <a href="http://fonkost.ru/genealogicaltree/genghiskhan"> ‚Äî    </a> <br> <a href="http://fonkost.ru/genealogicaltree/romanov"></a> <br> <a href="http://fonkost.ru/genealogicaltree/rurick"></a> (  ‚Äî 3452 ). <br><br>   : <br><br> )         Wikipedia <br> )    ‚Ññ       . ,  , ,  <a href="http://fonkost.ru/genealogicaltree/rurick/7564">   II     29 </a> . <br> )                . <br><br>  , , ,    <a href="http://fonkost.ru/genealogicaltree/rurick/6497"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nicholas II</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> was a descendant of Rurik in the 28th generation. </font><font style="vertical-align: inherit;">Moreover, all Russian emperors, beginning with </font></font><a href="http://fonkost.ru/genealogicaltree/rurick/3930"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peter III</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="http://fonkost.ru/genealogicaltree/rurick/3922"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catherine II,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> were descended from Rurik from different branches.</font></font><br><br>  <a href="https://github.com/artemkorsakov/GenealogicalTree">Project source code</a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PS 24-09-2017 </font></font><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Realization in the form of a tree </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To visualize the data as a tree, I used the </font></font><a href="https://philogb.github.io/jit/index.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfoVis Toolkit JavaScript</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> library </font><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Links to the tree of the tree in the form of a tree, not a list: </font></font><br> <a href="http://fonkost.ru/genealogicaltree_tree/adam"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adam </font></font></a> <br> <a href="http://fonkost.ru/genealogicaltree_tree/genghiskhan"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Genghis Khan </font></font></a> <br> <a href="http://fonkost.ru/genealogicaltree_tree/romanov"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Romanov </font></font></a> <br> <a href="http://fonkost.ru/genealogicaltree_tree/rurick"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rurikovich</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PS 22-10-2017</font></font><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Generating a tree using Wikidata </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As correctly suggested in the comments, it is advisable to use Wikidata for generation. </font><font style="vertical-align: inherit;">Improvements were small, more about them </font></font><a href="http://fonkost.ru/2/generaciya-rodoslovnogo-dereva-na-osnove-dannyx-wikidata"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The results are as follows: </font></font><br> <a href="http://fonkost.ru/genealogicaltree_tree/wikidata_adam"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adam</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 243 representatives instead of 31 </font></font><br> <a href="http://fonkost.ru/genealogicaltree_tree/wikidata_genghiskhan"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Genghis Khan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 405 representatives instead of 33</font></font></div><p>Source: <a href="https://habr.com/ru/post/338190/">https://habr.com/ru/post/338190/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338176/index.html">Create a GTK video player using Haskell</a></li>
<li><a href="../338178/index.html">Sotsinzhiniring in military propaganda</a></li>
<li><a href="../338180/index.html">Materials from VLDB, conferences about the future of databases</a></li>
<li><a href="../338186/index.html">Data geometry 1. Simplexes and graphs</a></li>
<li><a href="../338188/index.html">Control of dangerous cash operations: integration of video surveillance with 1C</a></li>
<li><a href="../338192/index.html">Experiment: Is everyone really good at design?</a></li>
<li><a href="../338194/index.html">I do not want to learn, I want ...</a></li>
<li><a href="../338196/index.html">The results of the poll "How would you like to see Toster.ru?"</a></li>
<li><a href="../338198/index.html">What is dinghy or how to speed up docker</a></li>
<li><a href="../338200/index.html">GeekUniversity opens a set of game development faculty</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>