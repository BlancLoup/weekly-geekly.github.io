<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We invent technology: the experience of connecting several open-source projects</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I would like to share the experience of creating an application, or more precisely a technology based on several open-source projects. This is somethi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We invent technology: the experience of connecting several open-source projects</h1><div class="post__text post__text-html js-mediator-article"> I would like to share the experience of creating an application, or more precisely a technology based on several open-source projects.  This is something like a web server with support for asynchronous messages and the ability to execute scripts in JavaScript. <br><br><a name="habracut"></a><br>  I encountered the need to invent something after the end of several projects related somehow to the automation of finance.  We used the usual three-tier model client-server application-database server with some modifications.  I realized that even a bunch of improvements does not make this technology convenient.  She always ‚Äúcrawls out‚Äù and needs attention. <br><br>  Thus, I thought about the ‚Äúideal‚Äù automation model of something and came to some conclusions. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1) The client must be a browser. <br><br>  Only a very serious reason can force us to make a ‚Äúfat‚Äù application with its graphic library and then as an add-on to the browser.  Having looked at the current state of affairs, at the speed of Chrome, at Google Gears, Google Docs, at work with the canvas object, at the possibility of graphical frameworks in JavaScript, I was firmly established in this decision. <br><br>  2) The most convenient form of data storage is a relational database with SQL. <br><br>  Everywhere!  That is, not only also on the application server, but also on the client!  There is no rational reason to drop the ability to have data in a relational form, even for a client, except for the need for wild performance.  Of course, by this time I had already stumbled upon SQLITE ( <a href="http://sqlite.org/">sqlite.org</a> ).  This is a built-in cross-platform relational database in source codes, in the public domain, with support for virtually everything that is really needed in SQL.  I generally advise anyone to get acquainted with this project as a training tool.  SQLITE has very interesting (and useful in my opinion) features.  For example.  The data type is stored together with the value itself, that is, in the same column of the table in different records, you can store both a string, a number, and a blob.  It is possible to create an in-memory database (that is, completely in RAM).  There are triggers.  There is no built-in language!  The source code for the project is available in a convenient form called amalgamation ( <a href="http://sqlite.org/amalgamation.html">sqlite.org/amalgamation.html</a> ), that is, literally from two files: cpp and h.  It is very convenient to include in the project.  The project is flexibly configured compilation options. <br><br>  3) Business logic should be created in a high-level scripting language. <br><br>  It should not be C ++ or Java.  These languages ‚Äã‚Äãwill introduce unnecessary complexity and will not give the necessary flexibility.  Oddly enough, my choice fell on JavaScript.  At one time I was doing quite a bit of web programming and I had a very pleasant impression of the JavaScript language.  This is a very flexible and easily extensible language, but for some reason it is not used as a server solution.  As the implementation, I chose Google V8 ( <a href="http://code.google.com/p/v8/">code.google.com/p/v8</a> ).  This is a compiler and JavaScript runtime project that implements the ECMA-262 standard ( <a href="http://www.ecma-international.org/publications/standards/Ecma-262.htm">www.ecma-international.org/publications/standards/Ecma-262.htm</a> ) and is used in the Chrome browser. <br><br>  V8 source code is available through the subversion system ( <a href="http://ru.wikipedia.org/wiki/Subversion">ru.wikipedia.org/wiki/Subversion</a> ).  Often subversion is called svn by the name of a standard client application.  In the wiki, everything is well described, but in a nutshell, this is a system of repositories (centralized file repositories along with their entire history of changes) and working copies (‚Äúsnapshots‚Äù of project branches in the form of directories and files on users' local computers).  This system has replaced CVS.  After the trial, I chose SmartSVN ( <a href="http://www.syntevo.com/smartsvn/">www.syntevo.com/smartsvn</a> ) as a subversion client and was more or less satisfied.  There is a free version. <br><br>  4) The transport of the future system should be based on asynchronous messages. <br><br>  This will allow applications to forget about the intricacies of connections and protocol nuances, to create a universal layer for sending messages.  The transport layer acquires a familiar event form. <br><br>  We must get to work, but where to start?  I don‚Äôt really want to work with files, network, even with cross-platform capabilities from scratch, why refuse Linux as an alternative, and maybe the main platform?  After a brief search, I found STLPlus ( <a href="http://stlplus.sourceforge.net/">stlplus.sourceforge.net</a> ).  This is a fairly well-designed Windows and Unix C ++ library, which has everything you need for the initial set of functionality.  I had to drank it with a file. <br><br>  So, first of all create an asynchronous messaging system.  We will not be wasted on trifles, because we are building an ideal.  Therefore, this system should be a) zero-configuration and b) automatically switch from a faulty network to a healthy one.  This means that every computer within our network must send out UDP broadcast messages with a list of its IP addresses all the time, and as a result, each computer will communicate with each one through all available networks and exclude the connection used from the exchange in the event of a network failure.  In the simplest case, we can connect computers using Ethernet and WiFi, and if the Ethernet fails, the system automatically switches to WiFi.  Access control issues will be postponed for now. <br><br>  The next layer implements addressing.  Here is the simplest solution.  On each computer, you can register an arbitrary network address (point @ host) and send / receive messages.  Plus, there is a system like message boards in fido, which allows one network address to declare the processing of certain names, and another to look for these handlers.  This allows you to freely move tasks across computers without any need for configuration changes. <br><br>  The next step is to embed a web server.  Unfortunately, I did not find anything suitable in open-source.  Either the solutions were too monstrous, or narrowly specialized, or too simplified, or they dragged their libraries with them.  I had to write this part, that is, support HTTP 1.1 as a server, on my own.  There is nothing special here, everything is well documented, checked by the browser right there. <br><br>  All tasks our application performs within sessions.  This is something that is created on the server to handle client requests or to run constant background tasks.  As a session, our system uses ... a javascript context.  Figuratively, this can be represented as follows: when a client opens a document in the browser and makes a request, a certain ‚Äúdocument‚Äù also opens on the server, inside which javaScript code is executed to process requests.  An astute reader probably already guessed that in this ‚Äúdocument‚Äù there is no complete implementation of the DOM or, say, a window object.  Of course, but there are much more useful wrappers: access to the messaging system and the SQLITE database.  Moreover, in-memory SQLITE database is created automatically for each new session.  The ability to send the result of any SELECT query within the message is built into the messaging system and this data will be automatically restored in the recipient database.  That is, the script actually works all the time using SQL from a local relational database, into which you can retrieve any data from a remote database. <br><br>  However, the javascript context, of course, allows you to do more than that.  After all, in fact, we are dealing with a global javaScript object, we have the opportunity to freely create new properties for it, define functions, that is, do everything the same as in the client context in a browser window.  We cache any required data in properties, etc.  And virtually all the javaScript code being executed will be compiled before execution, the performance is very high. <br><br>  Let's return to our client: the browser.  Recently, there has been a trend of turning web pages into web applications (read the first sentence in the Chrome comic, <a href="http://www.google.com/googlebooks/chrome/small_00.html">www.google.com/googlebooks/chrome/small_00.html</a> ).  And what does it mean?  This means that the processing of data presentation is being transferred more and more to the client, that is, to the browser.  In fact, at present, nothing prevents to form visible HTML entirely on the browser.  A modern web page will first load the necessary styles, bile libraries (in fact, the only time), and then go offline and allow the user to customize the look and decompose the visual elements as needed.  Access to the web server will occur only for the actual data, say, in the form of XML.  Of course, I draw a certain ideal, but everything is now striving for it.  And most importantly, technology makes it possible. <br><br>  Let's say Google Gears ( <a href="http://gears.google.com/">gears.google.com</a> , the wiki is here: <a href="http://ru.wikipedia.org/wiki/Google_Gears">ru.wikipedia.org/wiki/Google_Gears</a> ).  This is the ability of the browser to work with the local SQLITE database, cache resources, and run asynchronous background javascript execution threads. <br><br>  To move data from the SQLITE database to the browser's SQLITE database, I wrote the simplest replication based on triggers.  All you need to do is to list the replicated tables and periodically retrieve SQL changes of the remote database (s).  Data is collected using AJAX requests. <br><br>  Here I will make a small digression about AJAX.  Actually, I think he is known to all.  But, faced with the need to embed it in client libraries, I was surprised to find that almost all AJAX examples on the Internet are horrible in terms of design.  The same bewilderment befell me when I wanted to quickly find the simplest script engine to send the form via an AJAX POST request.  Then, of course, I already guessed that most programmers today use certain frameworks (such as jQuery) on the client, which have similar functionality built into them. <br><br>  Actually, summing up the line.  Three months later, the system lives and feels great.  All ideas are implemented in full.  In general, I was pleasantly surprised that it all worked and almost as intended.  There were also disappointments, the most significant of which probably should be considered the limitation of the V8, which in fact is not multi-threaded.  The code can be executed at a time by only one thread, although you can prepare as many contexts as you like.  Chrome runs a separate process on each tab. <br><br>  System performance is enough for us.  Actually, now we start its operation.  On the results, if interested, I will inform later in a separate article. <br></div><p>Source: <a href="https://habr.com/ru/post/48842/">https://habr.com/ru/post/48842/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../48832/index.html">IronPython as an engine for macros in .NET applications</a></li>
<li><a href="../48834/index.html">IE vs all</a></li>
<li><a href="../48835/index.html">jQuery & Greasemonkey</a></li>
<li><a href="../48837/index.html">Cover</a></li>
<li><a href="../48839/index.html">ZTE531B flashing on NetComm NB6Plus4W with DHCP setting for working with Stream TV</a></li>
<li><a href="../48846/index.html">Genetic engineering from A to Z part 2</a></li>
<li><a href="../48848/index.html">FLV software control</a></li>
<li><a href="../48851/index.html">For 10 euros, everyone can be on-line homeless</a></li>
<li><a href="../48853/index.html">announced third-generation Intel Classmate PC netbook</a></li>
<li><a href="../48856/index.html">Licensing cartographic activities for everyone?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>