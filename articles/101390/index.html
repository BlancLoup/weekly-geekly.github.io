<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Easy backup automation for Windows</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The question of backup concerns every specialist responsible for the safety of the priceless official documents / databases / other files entrusted to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Easy backup automation for Windows</h1><div class="post__text post__text-html js-mediator-article"> The question of backup concerns every specialist responsible for the safety of the priceless official documents / databases / other files entrusted to him.  In order to feel more confident in the face of various probable force majeure, you need to periodically back up critical data.  No less urgent is the problem of saving acquired by overwork and for home users. <br>  We offer you a simple but effective script that helps to solve this problem. <br><br><a name="habracut"></a><br><br>  We have the initial conditions: <br>  Operating system: MS Windows XP, 2003, etc .; <br>  Backup Objects: Folders and files located on local and network drives in the amount of ~ 200 GB; <br>  Budget: 0 rub .; <br>  The number of specially trained staff to set up the process: 1 person. <br>  The number of specially trained staff to service the process: 0 people. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Task: daily full backup of data, storage of a specified number of backups created without operator participation. <br><br>  In the vastness of the web, you can find a fairly large number of different programs that solve a similar problem.  According to the task and the conditions set, the following programs were found, installed and tested under close combat conditions: Cobian Backup (9, 10), Toucan, Areca, FBackup, Backup2Net and Samsung Auto Backup backup software (included with a removable disk of the same name) . <br><br>  Testing these programs on working data volumes showed their steady inability to cope with the simple task of automatically creating daily backups of data of the required volume.  Problems arose both at the stage of preparing for the implementation of the reservation, and actually in the progress thereof. <br>  Cobian Backup 10 lasted the longest (about a week), after which it went to the abandoned one and stubbornly began to make backups of only about 600 MB of data and dumping with a bunch of errors in the logs.  Manipulations with the settings of shadow copying and archiving did not lead to anything, unfortunately, and in general the program left a rather pleasant impression, so it is recommended to use it (assuming stable work in your specific conditions). <br>  Special hope was on Toucan, as the program belongs to the ACT.  But alas, hopes were not justified.  In the course of the assignment at different stages, the program fell out with a classic mistake about an unacceptable operation and the need for its (program) closure. <br>  The remaining participants of the selection also did not suit me for various reasons.  I don‚Äôt see much point in revealing the process of testing these programs because  to the purpose of writing this article is not directly related. <br>  Thus, a simple idea of ‚Äã‚Äãfinding a free solution to the problem was failed miserably.  Since there was no longer any strength, desire or hope to roam further across the expanses of the Web for free backup programs for commercial use, and backups were urgently needed, a natural decision / desire to build something of their own arose.  The result of thinking for quite a short time was the solution proposed below for simple automation of data backup by means of an ordinary bat-script and a standard scheduler.  The script works, as they say, out of the box, and does not require additional testing and debugging, you only need to provide it with input data and create the catalogs involved in the process in advance (there are no checks on this item for reasons of simplicity). <br>  Anticipating the dissatisfaction of many about laying out ready-to-use solutions, I want to say that not many of our fellow citizens have the desire / time / opportunity / talent / to enter the right one in order to deal with the syntax of the standard Windows command line.  I also dare to point out the non-zero probability that at least a few young and green administrators will take a look at the unquestionable <s>bes</s> uselessness of studying this field. <br><br>  And so, let's get started.  First give the full text of the script without comment.  Full analysis with comments see below. <br><br> <code>@Echo Off <br> echo %date% %time% ***Start*** <br> SetLocal EnableDelayedExpansion <br> Set $SRC=list_add.txt <br> Set $EXC=list_excl.txt <br> Set $DST=D:\backups <br> Set $PSW=password <br> Set $COMPR=1 <br> Set $COPIES=7 <br> C:\"Program Files"\7-Zip\7z.exe a -t7z -mhe=on "%$DST%\files%DATE:~-4%-%DATE:~3,2%-%DATE:~0,2%_%TIME:~0,2%-%TIME:~3,2%-%TIME:~6,2%.7z" @%$SRC% -scsWIN -p%$PSW% -mx=%$COMPR% -ssw -xr@%$EXC% &gt;&gt; log_7z.log <br> For /F "Delims=" %%i In ('DIR /B/O:-N %$DST%\files????-??-??_??-??-??.7z') Do ( <br> Set /A $COPIES-=1 <br> If !$COPIES! LSS 0 DEL "%$DST%\%%i" <br> ) <br> echo %date% %time% ***End***</code> <br> <br>  The result of the daily work of the script will be a set of backups of the data you need, which looks something like this: <br> <code>dir d:\backups\ <br> <br> files2010-07-12_22-00-00.7z <br> files2010-07-13_22-00-00.7z <br> files2010-07-14_22-00-00.7z <br> files2010-07-15_22-00-00.7z <br> files2010-07-16_22-00-00.7z</code> <br> <br>  Promised analysis with comments. <br><br> <code>@Echo Off ::     <br> echo %date% %time% ***Start*** ::      <br> SetLocal EnableDelayedExpansion ::       .</code> <br> <br>  In the usual case, to determine the value of an environment variable, you must use the% variable%.  However, if the variable value changes inside the loop and is read there, then for the bat file to work correctly, use the SetLocal EnableDelayedExpansion command and use the "!" Symbol instead of the "%" symbol.  Otherwise, the value of a variable in a loop will always be the same ‚Äî the same as it was before the entry into the loop. <br><br>  Further, for successful operation of the proposed script, it is necessary to set the following input parameters (variables): <br><br> <code>$SRC=list_add.txt ::-   <br> $EXC=list_excl.txt ::-   <br> $DST=D:\backups ::    <br> $PSW=password ::    <br> $COMPR=1 ::    7zip (1=  , 5= , 9=-, 0=  ) <br> $COPIES=7 ::   </code> <br> <br>  The next line starts archiving using 7-Zip files and folders listed in the <b>list_add.txt</b> file, except for the files specified in the exceptions <b>list_excl.txt</b> file <b>.</b> <br><br> <code>C:\"Program Files"\7-Zip\7z.exe a -t7z -mhe=on "%$DST%\files%DATE:~-4%-%DATE:~3,2%-%DATE:~0,2%_%TIME:~0,2%-%TIME:~3,2%-%TIME:~6,2%.7z" @%$SRC% -scsWIN -p%$PSW% -mx=%$COMPR% -ssw -xr@%$EXC% &gt;&gt; log_7z.log</code> <br> <br>  Let us examine this line in more detail: <br><br>  <b>C: \ "Program Files" \ 7-Zip \ 7z.exe</b> :: Indicates the location of the executable file of the <a href="http://7-zip.org.ua/ru/">7-Zip archiver</a> (or rather its console version); <br><br>  <b>a</b> :: is a command to add files / folders to the archive; <br><br>  <b>-t7z</b> :: key sets the type of archive being created = 7z; <br><br>  <b>-mhe = on</b> :: enables encryption of the archive header and file / folder names in the archive with a password; <br><br> <code>%$DST%\files%DATE:~-4%-%DATE:~3,2%-%DATE:~0,2%_%TIME:~0,2%-%TIME:~3,2%-%TIME:~6,2%.7z</code> <br>  The command dynamically forms the full path and file name of the archive of the form <i>‚ÄúD: \ backups \ files2010-07-12_22-00-00.7z‚Äù</i> , where the name contains the date and time of archiving; <br><br>  <b>@% $ SRC%</b> :: specifies the name of the file list of the archived data, instead of% $ SRC% the script substitutes the name of the file; <br><br>  <b>-scsWIN</b> :: sets the encoding win for the list file; <br><br>  <b>-p% $ PSW%</b> :: key sets the password for encrypting the archive, instead of% $ PSW% the script substitutes the text string of the password; <br><br>  <b>-mx =% $ COMPR%</b> :: key sets the compression level for the archived data; <br><br>  <b>The -ssw</b> :: key allows archiving of files opened by applications for writing; <br><br>  <b>-xr @% $ EXC%</b> :: sets the name of the file listing the data to be excluded from the archiving process, r = means that the subfolders should also be excluded, instead of <b>% $ EXC% the</b> script substitutes the name of the file; <br><br>  <b>&gt;&gt; log_7z.log</b> :: symbols <b>&gt;&gt;</b> denote the redirection of messages displayed as a whole line from the screen (standard stream) to the <i>log_7z.lo</i> g file, which is convenient for the subsequent analysis of the script operation; <br><br>  This part of the script is responsible for automatically deleting already unnecessary data archives, in accordance with the number specified by the <b>$ COPIES</b> variable. <br><br> <code>For /F "Delims=" %%i In ('DIR /B/O:-N %$DST%\files????-??-??_??-??-??.7z') Do ( <br> Set /A $COPIES-=1 <br> If !$COPIES! LSS 0 DEL "%$DST%\%%i" <br> )</code> <br> <br>  We will analyze in more detail.  Automatic deletion is implemented by organizing a cycle in which a set of names (set) of archive files is searched (how it is formed - see the <b>DIR</b> line below) <b>...</b> <br>  In general, our cycle has the form: <b>for / F [‚ÄúKeyword of Disassembly‚Äù] {%% |</b>  <b>%} variable in (Set Filename) do command [Command Line Parameters]</b> <br>  The <b>/ F</b> switch determines that the loop will parse all the elements of the Set <b>of NameFiles</b> ; <br>  <b>‚ÄúKey words of Disassembly‚Äù</b> - indicate which separators are used between the elements of the set being parsed, in our case there is no separator; <br>  <b>%% i</b> is the variable <b>i</b> , which contains in each iteration step the current element of the set being parsed (that is, the next file name in our case). <br><br> <code>DIR /B/O:-N %$DST%\files????-??-??_??-??-??.7z</code> <br> <br>  The command forms a set (set) of file names contained in the folder of the specified <b>$ DST</b> variable and corresponding to the mask <b>files ???? - ?? ?? ?? ?? ?? ?? ?? ?? 7z</b> , where the question mark denotes any character in the given positions;  the <b>/ B</b> switch only displays file names, and the <b>/ O</b> switch <b>: -N</b> sets the sort by name ( <b>N</b> ) or in reverse order ( <b>-N</b> ), in our case the reverse order. <br>  The set has the form: <br>  <i>files2010-07-01_22-00-00.7z</i> <i><br></i>  <i>files2010-06-30_22-00-00.7z</i> <i><br></i>  <i>files2010-06-29_22-00-00.7z</i> <br>  Pay attention to the order of sorting items! <br><br>  <b>Do (...)</b> - in brackets contains the command (s) executed in each iteration, in our case: <br>  <b>Set / A $ COPIES- = 1</b> :: decrement of the <b>COPIES</b> variable, which acts as a loop counter; <br>  <b>If! $ COPIES!</b>  <b>LSS 0 DEL "% $ DST% \ %% i"</b> :: the command checks the condition <b>$ COPIES LSS 0</b> i.e.  <b>$ COPIES &lt;0</b> , if true, then the command to delete the archive file with the name of the current element should be executed, so the number of stored copies of the archive will not exceed the specified value, in our example <b>$ COPIES = 7</b> . <br><br> <code>echo %date% %time% ***End*** ::      </code> <br> <br>  I will also give, for example, the contents of the <b>list_add.txt</b> list file: <br><br> <code>M:\mail <br> U:\updates <br> Z:\ <br> Z:\* <br> z:\ <br> Z:\ <br></code> <br>  And the <b>list_excl.txt</b> exception <b>file</b> : <br><br> <code>*.bak <br> *.tmp <br> *.avi <br> *.mkv <br> *.mp3</code> <br> <br>  Actually, that's the whole layout.  The script is small, but reliably working.  There are no tricks, everything is quite simple. <br>  And finally, the banality ... To automate the launch, you can use the standard Windows scheduler, the command line of the form "d: \ backup \ backup.bat &gt;&gt; d: \ backup \ backup.log".  This will allow displaying script messages in a log file. <br>  Good luck to all. <br><br>  Literature: <br><br>  1) Reference on command line parameters from MS. <br>  <a href="http://technet.microsoft.com/ru-ru/library/cc737438%2528WS.10%2529.aspx">technet.microsoft.com/ru-ru/library/cc737438%28WS.10%29.aspx</a> <br><br>  2) Detailed help on the functions of the console version of 7-Zip is attached to the archiver. </div><p>Source: <a href="https://habr.com/ru/post/101390/">https://habr.com/ru/post/101390/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../101383/index.html">All-Russian project search</a></li>
<li><a href="../101385/index.html">Demo version of Mafia II</a></li>
<li><a href="../101386/index.html">Big brother helps you</a></li>
<li><a href="../101388/index.html">Search YouTube on the main page of Yandex</a></li>
<li><a href="../101389/index.html">FSB learns to recognize Caucasians by voice</a></li>
<li><a href="../101391/index.html">Google bought virtual payment service Jambool</a></li>
<li><a href="../101394/index.html">Multibar from Tikno - tasty and healthy</a></li>
<li><a href="../101395/index.html">Personal service</a></li>
<li><a href="../101396/index.html">Contrary to the claims of Google, the open Chromium is also watching you.</a></li>
<li><a href="../101397/index.html">Yandex.Mail finally gave the opportunity to send mail from external email addresses</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>