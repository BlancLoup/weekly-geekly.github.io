<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Piano in 24 lines on Javascript: if you play, then music</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As long as handset makers measure who is thinner, programmers continue to measure who is shorter. 

 I also decided to take part in this special spont...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Piano in 24 lines on Javascript: if you play, then music</h1><div class="post__text post__text-html js-mediator-article">  As long as handset makers measure who is thinner, programmers continue to measure who is shorter. <br><br>  I also decided to take part in this <s>special</s> spontaneous Olympiad of coding skills, and remembered the phrase of one of my musician friends: ‚ÄúIf you play, then on the piano‚Äù.  And I decided: so be it.  Instead of playing, I'll write a piano.  <a href="http://jsfiddle.net/c62Pe/1/embedded/result/">And wrote</a> . <br><br>  <i>I‚Äôll make a reservation right away: I‚Äôm never a musician, my musical education is limited to a dozen thieves' songs on an upset guitar, so with the terminology I can and I will surely lie godlessly, but I‚Äôll be damn glad if you correct me.</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  So, let's begin. </h5><br>  The keyboard of a classical piano consists of 88 keys covering the range from A0 (A la sub-counter-octave, sound frequency 27.5 Hz) to C8 (Up to the fifth octave, frequency 4186 Hz).  Each octave on the keyboard consists of twelve notes: <br>  Before, <b>C-sharp</b> , D, <b>D-sharp</b> , Mie, Fa, <b>F-sharp</b> , Sol, <b>G-sharp</b> , A, <b>A-sharp / B-flat</b> , C.  The bold keys are the top row, they are usually black on the keyboard. <br><br>  Actually, this is what one octave looks like: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b34/e76/6a8/b34e766a82548897f6e928bedf8826e3.png" alt="image"><br><br>  Just by looking at the <a href="http://www.gitaristam.ru/school/frequency.htm">frequency table of the notes</a> , the pattern becomes obvious: each successive octave is exactly twice as high as the previous one.  Thus, we can say that: <br><br>  Nx = N1 √ó 2 <sup>x-1</sup> , where: <br><ul><li>  N - the name of the note; </li><li>  x is the number of the octave (from 0 to 8); </li><li>  Nx, respectively, the sound frequency corresponding to the note of the N octave x; </li></ul><br>  N1 instead of N0 appears in the formula only because part of the sub-counter-octave notes (N0) has a sound frequency below the threshold of hearing by the human ear (&lt;20 Hz). <br><br>  In order for the notes to turn out clean, we need sufficiently accurate values ‚Äã‚Äãof the frequencies of the notes of the contraktawa, from which we begin to count.  Actually, here they are: <br><a name="habracut"></a><br>  C: 32.703, <br>  C #: 34.648, <br>  D: 36.708, <br>  D #: 38.891, <br>  E: 41.203, <br>  F: 43.654, <br>  F #: 46.249, <br>  G: 48.999, <br>  G #: 51.913, <br>  A: 55, <br>  A #: 58.27, <br>  B: 61.735 <br><br>  Based on this, we write a function that takes as its argument a string with the name of the key in the form of <code>"A4"</code> or <code>"C5#"</code> , and returns the frequency of its sound: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> controctave = { <span class="hljs-string"><span class="hljs-string">'C'</span></span>: <span class="hljs-number"><span class="hljs-number">32.703</span></span>, <span class="hljs-string"><span class="hljs-string">'#'</span></span>: <span class="hljs-number"><span class="hljs-number">34.648</span></span>, <span class="hljs-string"><span class="hljs-string">'D'</span></span>: <span class="hljs-number"><span class="hljs-number">36.708</span></span>, <span class="hljs-string"><span class="hljs-string">'D#'</span></span>: <span class="hljs-number"><span class="hljs-number">38.891</span></span>, <span class="hljs-string"><span class="hljs-string">'E'</span></span>: <span class="hljs-number"><span class="hljs-number">41.203</span></span>, <span class="hljs-string"><span class="hljs-string">'F'</span></span>: <span class="hljs-number"><span class="hljs-number">43.654</span></span>, <span class="hljs-string"><span class="hljs-string">'F#'</span></span>: <span class="hljs-number"><span class="hljs-number">46.249</span></span>, <span class="hljs-string"><span class="hljs-string">'G'</span></span>: <span class="hljs-number"><span class="hljs-number">48.999</span></span>, <span class="hljs-string"><span class="hljs-string">'G#'</span></span>: <span class="hljs-number"><span class="hljs-number">51.913</span></span>, <span class="hljs-string"><span class="hljs-string">'A'</span></span>: <span class="hljs-number"><span class="hljs-number">55</span></span>, <span class="hljs-string"><span class="hljs-string">'A#'</span></span>: <span class="hljs-number"><span class="hljs-number">58.27</span></span>, <span class="hljs-string"><span class="hljs-string">'B'</span></span>: <span class="hljs-number"><span class="hljs-number">61.735</span></span>, }, note = key[<span class="hljs-number"><span class="hljs-number">0</span></span>].toUpperCase(), octave = <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(key[<span class="hljs-number"><span class="hljs-number">1</span></span>]), sharp = key[<span class="hljs-number"><span class="hljs-number">2</span></span>] == <span class="hljs-string"><span class="hljs-string">'#'</span></span> ? <span class="hljs-literal"><span class="hljs-literal">true</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sharp) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> controctave[note + <span class="hljs-string"><span class="hljs-string">'#'</span></span>] * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(<span class="hljs-number"><span class="hljs-number">2</span></span>, octave<span class="hljs-number"><span class="hljs-number">-1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> controctave[note] * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(<span class="hljs-number"><span class="hljs-number">2</span></span>, octave<span class="hljs-number"><span class="hljs-number">-1</span></span>); } }</code> </pre><br>  Oh yes, we do not write beautifully, but briefly.  Slightly shorten: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> controctave = { <span class="hljs-string"><span class="hljs-string">'C'</span></span>: <span class="hljs-number"><span class="hljs-number">32.703</span></span>, <span class="hljs-string"><span class="hljs-string">'#'</span></span>: <span class="hljs-number"><span class="hljs-number">34.648</span></span>, <span class="hljs-string"><span class="hljs-string">'D'</span></span>: <span class="hljs-number"><span class="hljs-number">36.708</span></span>, <span class="hljs-string"><span class="hljs-string">'D#'</span></span>: <span class="hljs-number"><span class="hljs-number">38.891</span></span>, <span class="hljs-string"><span class="hljs-string">'E'</span></span>: <span class="hljs-number"><span class="hljs-number">41.203</span></span>, <span class="hljs-string"><span class="hljs-string">'F'</span></span>: <span class="hljs-number"><span class="hljs-number">43.654</span></span>, <span class="hljs-string"><span class="hljs-string">'F#'</span></span>: <span class="hljs-number"><span class="hljs-number">46.249</span></span>, <span class="hljs-string"><span class="hljs-string">'G'</span></span>: <span class="hljs-number"><span class="hljs-number">48.999</span></span>, <span class="hljs-string"><span class="hljs-string">'G#'</span></span>: <span class="hljs-number"><span class="hljs-number">51.913</span></span>, <span class="hljs-string"><span class="hljs-string">'A'</span></span>: <span class="hljs-number"><span class="hljs-number">55</span></span>, <span class="hljs-string"><span class="hljs-string">'A#'</span></span>: <span class="hljs-number"><span class="hljs-number">58.27</span></span>, <span class="hljs-string"><span class="hljs-string">'B'</span></span>: <span class="hljs-number"><span class="hljs-number">61.735</span></span>}; freq = key[<span class="hljs-number"><span class="hljs-number">2</span></span>] == <span class="hljs-string"><span class="hljs-string">'#'</span></span> ? controctave[key[<span class="hljs-number"><span class="hljs-number">0</span></span>].toUpperCase() + <span class="hljs-string"><span class="hljs-string">'#'</span></span>] * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(<span class="hljs-number"><span class="hljs-number">2</span></span>, (key[<span class="hljs-number"><span class="hljs-number">1</span></span>]|<span class="hljs-number"><span class="hljs-number">0</span></span>) - <span class="hljs-number"><span class="hljs-number">1</span></span>) : controctave[key[<span class="hljs-number"><span class="hljs-number">0</span></span>].toUpperCase()] * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(<span class="hljs-number"><span class="hljs-number">2</span></span>, (key[<span class="hljs-number"><span class="hljs-number">1</span></span>]|<span class="hljs-number"><span class="hljs-number">0</span></span>) - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> freq; }</code> </pre><br><br>  Already used four lines of code. <br><br><h5>  Let's draw the keyboard </h5><br>  The 88 keyboard keys start with the note A (A0). <br>  Accordingly, the cycle will be the following: in the cycle we draw 12 keys, and every <i>second, fourth, seventh, ninth and eleventh</i> we make black.  Each key is assigned an id corresponding to the note that it should play when pressed. <br><br>  In general, as follows: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> width = <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> deck = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'div'</span></span>), octave = [<span class="hljs-string"><span class="hljs-string">'A'</span></span>, <span class="hljs-string"><span class="hljs-string">'A#'</span></span>, <span class="hljs-string"><span class="hljs-string">'B'</span></span>, <span class="hljs-string"><span class="hljs-string">'C'</span></span>, <span class="hljs-string"><span class="hljs-string">'C#'</span></span>, <span class="hljs-string"><span class="hljs-string">'D'</span></span>, <span class="hljs-string"><span class="hljs-string">'D#'</span></span>, <span class="hljs-string"><span class="hljs-string">'E'</span></span>, <span class="hljs-string"><span class="hljs-string">'F'</span></span>, <span class="hljs-string"><span class="hljs-string">'F#'</span></span>, <span class="hljs-string"><span class="hljs-string">'G'</span></span>, <span class="hljs-string"><span class="hljs-string">'G#'</span></span>], id = <span class="hljs-string"><span class="hljs-string">""</span></span>, keynumber = <span class="hljs-number"><span class="hljs-number">0</span></span>, whitekeys = <span class="hljs-number"><span class="hljs-number">0</span></span>, keys = []; deck.style.width = width; parent: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">8</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; <span class="hljs-number"><span class="hljs-number">12</span></span>; j++) { keynumber = (i * <span class="hljs-number"><span class="hljs-number">12</span></span>) + j; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keynumber &gt;= <span class="hljs-number"><span class="hljs-number">88</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> parent; keys[keynumber] = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'div'</span></span>); keys[keynumber].style.border = <span class="hljs-string"><span class="hljs-string">"1px solid black"</span></span>; keys[keynumber].style.position = <span class="hljs-string"><span class="hljs-string">"absolute"</span></span>; id = (octave[j][<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-string"><span class="hljs-string">'#'</span></span>) ? octave[j] + i + <span class="hljs-string"><span class="hljs-string">'s'</span></span> : octave[j] + i; keys[keynumber].id = id; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(j%<span class="hljs-number"><span class="hljs-number">12</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>: keys[keynumber].style.backgroundColor = <span class="hljs-string"><span class="hljs-string">'black'</span></span>; keys[keynumber].style.left = ((width / <span class="hljs-number"><span class="hljs-number">50</span></span> * whitekeys) - (width / <span class="hljs-number"><span class="hljs-number">200</span></span>)) + <span class="hljs-string"><span class="hljs-string">'px'</span></span>; keys[keynumber].style.width = width/<span class="hljs-number"><span class="hljs-number">100</span></span> + <span class="hljs-string"><span class="hljs-string">"px"</span></span>; keys[keynumber].style.height = <span class="hljs-string"><span class="hljs-string">"200px"</span></span>; keys[keynumber].style.zIndex = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: keys[keynumber].style.backgroundColor = <span class="hljs-string"><span class="hljs-string">'white'</span></span>; keys[keynumber].style.left = (width / <span class="hljs-number"><span class="hljs-number">50</span></span> * whitekeys) + <span class="hljs-string"><span class="hljs-string">'px'</span></span>; keys[keynumber].style.width = width/<span class="hljs-number"><span class="hljs-number">50</span></span> + <span class="hljs-string"><span class="hljs-string">"px"</span></span>; keys[keynumber].style.height = <span class="hljs-string"><span class="hljs-string">"300px"</span></span>; whitekeys++; } deck.appendChild(keys[keynumber]); } } <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.appendChild(deck);</code> </pre><br>  And once again <s>turn the normal code into unreadable govnishch</s> apply a small optimization. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> width = <span class="hljs-number"><span class="hljs-number">1000</span></span>, octave = [<span class="hljs-string"><span class="hljs-string">'A'</span></span>, <span class="hljs-string"><span class="hljs-string">'A#'</span></span>, <span class="hljs-string"><span class="hljs-string">'B'</span></span>, <span class="hljs-string"><span class="hljs-string">'C'</span></span>, <span class="hljs-string"><span class="hljs-string">'C#'</span></span>, <span class="hljs-string"><span class="hljs-string">'D'</span></span>, <span class="hljs-string"><span class="hljs-string">'D#'</span></span>, <span class="hljs-string"><span class="hljs-string">'E'</span></span>, <span class="hljs-string"><span class="hljs-string">'F'</span></span>, <span class="hljs-string"><span class="hljs-string">'F#'</span></span>, <span class="hljs-string"><span class="hljs-string">'G'</span></span>, <span class="hljs-string"><span class="hljs-string">'G#'</span></span>], id = <span class="hljs-string"><span class="hljs-string">""</span></span>, div, whitekeys=<span class="hljs-number"><span class="hljs-number">0</span></span>, keys = []; parent: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">8</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; <span class="hljs-number"><span class="hljs-number">12</span></span>; j++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((i * <span class="hljs-number"><span class="hljs-number">12</span></span>) + j &gt;= <span class="hljs-number"><span class="hljs-number">88</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> parent; div = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'div'</span></span>); div.id = (octave[j][<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-string"><span class="hljs-string">'#'</span></span>) ? octave[j][<span class="hljs-number"><span class="hljs-number">0</span></span>] + ((((i * <span class="hljs-number"><span class="hljs-number">12</span></span>) + j + <span class="hljs-number"><span class="hljs-number">9</span></span>) / <span class="hljs-number"><span class="hljs-number">12</span></span>)|<span class="hljs-number"><span class="hljs-number">0</span></span>) + <span class="hljs-string"><span class="hljs-string">'s'</span></span> : octave[j] + ((((i * <span class="hljs-number"><span class="hljs-number">12</span></span>) + j + <span class="hljs-number"><span class="hljs-number">9</span></span>) / <span class="hljs-number"><span class="hljs-number">12</span></span>)|<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (j % <span class="hljs-number"><span class="hljs-number">12</span></span> == <span class="hljs-number"><span class="hljs-number">1</span></span> || j % <span class="hljs-number"><span class="hljs-number">12</span></span> == <span class="hljs-number"><span class="hljs-number">4</span></span> || j % <span class="hljs-number"><span class="hljs-number">12</span></span> == <span class="hljs-number"><span class="hljs-number">6</span></span> || j % <span class="hljs-number"><span class="hljs-number">12</span></span> == <span class="hljs-number"><span class="hljs-number">9</span></span> || j % <span class="hljs-number"><span class="hljs-number">12</span></span> == <span class="hljs-number"><span class="hljs-number">11</span></span>) { div.setAttribute(<span class="hljs-string"><span class="hljs-string">'style'</span></span>, <span class="hljs-string"><span class="hljs-string">'border:1px solid black; position:absolute; background-color:black; left:'</span></span> + ((width / <span class="hljs-number"><span class="hljs-number">50</span></span> * whitekeys) - (width / <span class="hljs-number"><span class="hljs-number">200</span></span>)) + <span class="hljs-string"><span class="hljs-string">'px; width:'</span></span> + width/<span class="hljs-number"><span class="hljs-number">100</span></span> + <span class="hljs-string"><span class="hljs-string">'px; height: 200px; z-index:1;'</span></span>);} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { div.setAttribute(<span class="hljs-string"><span class="hljs-string">'style'</span></span>, <span class="hljs-string"><span class="hljs-string">'border:1px solid black; position:absolute; background-color:white; left:'</span></span> + (width / <span class="hljs-number"><span class="hljs-number">50</span></span> * whitekeys) + <span class="hljs-string"><span class="hljs-string">'px; width:'</span></span> + width/<span class="hljs-number"><span class="hljs-number">50</span></span> + <span class="hljs-string"><span class="hljs-string">'px; height:300px;'</span></span>); whitekeys++; } <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.appendChild(div);}}</code> </pre><br><br>  We spent another 13 lines. <br><br><h5>  Teach the piano to make sounds </h5><br>  For this we need the <a href="http://www.w3.org/TR/webaudio/">Web Audio API</a> , which at this moment is supported only by Webkit-based browsers and Firefox. <br><br>  Add the creation of the audio context to the line of the declaration of global variables <br><pre> <code class="javascript hljs">context = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.AudioContext ? <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AudioContext() : <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> webkitAudioContext();</code> </pre><br>  add a keystroke handler: <br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, play);</code> </pre><br>  and the play function itself is changed as follows: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> controctave = { <span class="hljs-string"><span class="hljs-string">'C'</span></span>: <span class="hljs-number"><span class="hljs-number">32.703</span></span>, <span class="hljs-string"><span class="hljs-string">'Cs'</span></span>: <span class="hljs-number"><span class="hljs-number">34.648</span></span>, <span class="hljs-string"><span class="hljs-string">'D'</span></span>: <span class="hljs-number"><span class="hljs-number">36.708</span></span>, <span class="hljs-string"><span class="hljs-string">'Ds'</span></span>: <span class="hljs-number"><span class="hljs-number">38.891</span></span>, <span class="hljs-string"><span class="hljs-string">'E'</span></span>: <span class="hljs-number"><span class="hljs-number">41.203</span></span>, <span class="hljs-string"><span class="hljs-string">'F'</span></span>: <span class="hljs-number"><span class="hljs-number">43.654</span></span>, <span class="hljs-string"><span class="hljs-string">'Fs'</span></span>: <span class="hljs-number"><span class="hljs-number">46.249</span></span>, <span class="hljs-string"><span class="hljs-string">'G'</span></span>: <span class="hljs-number"><span class="hljs-number">48.999</span></span>, <span class="hljs-string"><span class="hljs-string">'Gs'</span></span>: <span class="hljs-number"><span class="hljs-number">51.913</span></span>, <span class="hljs-string"><span class="hljs-string">'A'</span></span>: <span class="hljs-number"><span class="hljs-number">55</span></span>, <span class="hljs-string"><span class="hljs-string">'As'</span></span>: <span class="hljs-number"><span class="hljs-number">58.27</span></span>, <span class="hljs-string"><span class="hljs-string">'B'</span></span>: <span class="hljs-number"><span class="hljs-number">61.735</span></span>}, osc = context.createOscillator(); osc.frequency.value = e.target.id[<span class="hljs-number"><span class="hljs-number">2</span></span>] == <span class="hljs-string"><span class="hljs-string">'s'</span></span> ? controctave[e.target.id[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-string"><span class="hljs-string">'s'</span></span>] * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(<span class="hljs-number"><span class="hljs-number">2</span></span>, (e.target.id[<span class="hljs-number"><span class="hljs-number">1</span></span>]|<span class="hljs-number"><span class="hljs-number">0</span></span>) - <span class="hljs-number"><span class="hljs-number">1</span></span>) : controctave[e.target.id[<span class="hljs-number"><span class="hljs-number">0</span></span>]] * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(<span class="hljs-number"><span class="hljs-number">2</span></span>, (e.target.id[<span class="hljs-number"><span class="hljs-number">1</span></span>]|<span class="hljs-number"><span class="hljs-number">0</span></span>) - <span class="hljs-number"><span class="hljs-number">1</span></span>); osc.type = <span class="hljs-string"><span class="hljs-string">"square"</span></span>; osc.connect(context.destination); osc.start(<span class="hljs-number"><span class="hljs-number">0</span></span>); setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ osc.stop(<span class="hljs-number"><span class="hljs-number">0</span></span>); osc.disconnect(context.destination); }, <span class="hljs-number"><span class="hljs-number">1000</span></span> / <span class="hljs-number"><span class="hljs-number">2</span></span>);}</code> </pre><br><br>  Here we created an oscillator: <code>osc = context.createOscillator();</code>  , set the necessary frequency for it: <code>osc.frequency.value = e.target.id[2] == 's' ? controctave[e.target.id[0] + 's'] * Math.pow(2, (e.target.id[1]|0) - 1) : controctave[e.target.id[0]] * Math.pow(2, (e.target.id[1]|0) - 1);</code> <code>osc.frequency.value = e.target.id[2] == 's' ? controctave[e.target.id[0] + 's'] * Math.pow(2, (e.target.id[1]|0) - 1) : controctave[e.target.id[0]] * Math.pow(2, (e.target.id[1]|0) - 1);</code>  (well, we don‚Äôt follow the cleanliness and neatness of the code, do we?), set the waveform: <code>osc.type = "square";</code>  (the default was sinusoidal) connected it to an audio output device: <code>osc.connect(context.destination);</code>  , and gave the command to start playback: <code>osc.start(0);</code>  .  After that, we need to silence the key after a while (500ms), otherwise it will be squeaking like that.  For this we use <code>osc.stop(0)</code> , wrapped in an interval.  Required element is <code>osc.disconnect(context.destination);</code>  - disconnect the oscillator from the output device. <br><br>  We summarize: we have such a simple code: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> width = <span class="hljs-number"><span class="hljs-number">1000</span></span>, octave = [<span class="hljs-string"><span class="hljs-string">'A'</span></span>, <span class="hljs-string"><span class="hljs-string">'A#'</span></span>, <span class="hljs-string"><span class="hljs-string">'B'</span></span>, <span class="hljs-string"><span class="hljs-string">'C'</span></span>, <span class="hljs-string"><span class="hljs-string">'C#'</span></span>, <span class="hljs-string"><span class="hljs-string">'D'</span></span>, <span class="hljs-string"><span class="hljs-string">'D#'</span></span>, <span class="hljs-string"><span class="hljs-string">'E'</span></span>, <span class="hljs-string"><span class="hljs-string">'F'</span></span>, <span class="hljs-string"><span class="hljs-string">'F#'</span></span>, <span class="hljs-string"><span class="hljs-string">'G'</span></span>, <span class="hljs-string"><span class="hljs-string">'G#'</span></span>], id = <span class="hljs-string"><span class="hljs-string">""</span></span>, div, whitekeys=<span class="hljs-number"><span class="hljs-number">0</span></span>, keys = [],context = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.AudioContext ? <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AudioContext() : <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> webkitAudioContext(); parent: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">8</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; <span class="hljs-number"><span class="hljs-number">12</span></span>; j++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((i * <span class="hljs-number"><span class="hljs-number">12</span></span>) + j &gt;= <span class="hljs-number"><span class="hljs-number">88</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> parent; div = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'div'</span></span>); div.id = (octave[j][<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-string"><span class="hljs-string">'#'</span></span>) ? octave[j][<span class="hljs-number"><span class="hljs-number">0</span></span>] + ((((i * <span class="hljs-number"><span class="hljs-number">12</span></span>) + j + <span class="hljs-number"><span class="hljs-number">9</span></span>) / <span class="hljs-number"><span class="hljs-number">12</span></span>)|<span class="hljs-number"><span class="hljs-number">0</span></span>) + <span class="hljs-string"><span class="hljs-string">'s'</span></span> : octave[j] + ((((i * <span class="hljs-number"><span class="hljs-number">12</span></span>) + j + <span class="hljs-number"><span class="hljs-number">9</span></span>) / <span class="hljs-number"><span class="hljs-number">12</span></span>)|<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (j % <span class="hljs-number"><span class="hljs-number">12</span></span> == <span class="hljs-number"><span class="hljs-number">1</span></span> || j % <span class="hljs-number"><span class="hljs-number">12</span></span> == <span class="hljs-number"><span class="hljs-number">4</span></span> || j % <span class="hljs-number"><span class="hljs-number">12</span></span> == <span class="hljs-number"><span class="hljs-number">6</span></span> || j % <span class="hljs-number"><span class="hljs-number">12</span></span> == <span class="hljs-number"><span class="hljs-number">9</span></span> || j % <span class="hljs-number"><span class="hljs-number">12</span></span> == <span class="hljs-number"><span class="hljs-number">11</span></span>) { div.setAttribute(<span class="hljs-string"><span class="hljs-string">'style'</span></span>, <span class="hljs-string"><span class="hljs-string">'border:1px solid black; position:absolute; background-color:black; left:'</span></span> + ((width / <span class="hljs-number"><span class="hljs-number">50</span></span> * whitekeys) - (width / <span class="hljs-number"><span class="hljs-number">200</span></span>)) + <span class="hljs-string"><span class="hljs-string">'px; width:'</span></span> + width/<span class="hljs-number"><span class="hljs-number">100</span></span> + <span class="hljs-string"><span class="hljs-string">'px; height: 200px; z-index:1;'</span></span>);} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { div.setAttribute(<span class="hljs-string"><span class="hljs-string">'style'</span></span>, <span class="hljs-string"><span class="hljs-string">'border:1px solid black; position:absolute; background-color:white; left:'</span></span> + (width / <span class="hljs-number"><span class="hljs-number">50</span></span> * whitekeys) + <span class="hljs-string"><span class="hljs-string">'px; width:'</span></span> + width/<span class="hljs-number"><span class="hljs-number">50</span></span> + <span class="hljs-string"><span class="hljs-string">'px; height:300px;'</span></span>); whitekeys++; } <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.appendChild(div);}} <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, play); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> controctave = { <span class="hljs-string"><span class="hljs-string">'C'</span></span>: <span class="hljs-number"><span class="hljs-number">32.703</span></span>, <span class="hljs-string"><span class="hljs-string">'Cs'</span></span>: <span class="hljs-number"><span class="hljs-number">34.648</span></span>, <span class="hljs-string"><span class="hljs-string">'D'</span></span>: <span class="hljs-number"><span class="hljs-number">36.708</span></span>, <span class="hljs-string"><span class="hljs-string">'Ds'</span></span>: <span class="hljs-number"><span class="hljs-number">38.891</span></span>, <span class="hljs-string"><span class="hljs-string">'E'</span></span>: <span class="hljs-number"><span class="hljs-number">41.203</span></span>, <span class="hljs-string"><span class="hljs-string">'F'</span></span>: <span class="hljs-number"><span class="hljs-number">43.654</span></span>, <span class="hljs-string"><span class="hljs-string">'Fs'</span></span>: <span class="hljs-number"><span class="hljs-number">46.249</span></span>, <span class="hljs-string"><span class="hljs-string">'G'</span></span>: <span class="hljs-number"><span class="hljs-number">48.999</span></span>, <span class="hljs-string"><span class="hljs-string">'Gs'</span></span>: <span class="hljs-number"><span class="hljs-number">51.913</span></span>, <span class="hljs-string"><span class="hljs-string">'A'</span></span>: <span class="hljs-number"><span class="hljs-number">55</span></span>, <span class="hljs-string"><span class="hljs-string">'As'</span></span>: <span class="hljs-number"><span class="hljs-number">58.27</span></span>, <span class="hljs-string"><span class="hljs-string">'B'</span></span>: <span class="hljs-number"><span class="hljs-number">61.735</span></span>}, osc = context.createOscillator(); osc.frequency.value = e.target.id[<span class="hljs-number"><span class="hljs-number">2</span></span>] == <span class="hljs-string"><span class="hljs-string">'s'</span></span> ? controctave[e.target.id[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-string"><span class="hljs-string">'s'</span></span>] * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(<span class="hljs-number"><span class="hljs-number">2</span></span>, (e.target.id[<span class="hljs-number"><span class="hljs-number">1</span></span>]|<span class="hljs-number"><span class="hljs-number">0</span></span>) - <span class="hljs-number"><span class="hljs-number">1</span></span>) : controctave[e.target.id[<span class="hljs-number"><span class="hljs-number">0</span></span>]] * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(<span class="hljs-number"><span class="hljs-number">2</span></span>, (e.target.id[<span class="hljs-number"><span class="hljs-number">1</span></span>]|<span class="hljs-number"><span class="hljs-number">0</span></span>) - <span class="hljs-number"><span class="hljs-number">1</span></span>); osc.type = <span class="hljs-string"><span class="hljs-string">"square"</span></span>; osc.connect(context.destination); osc.start(<span class="hljs-number"><span class="hljs-number">0</span></span>); setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ osc.stop(<span class="hljs-number"><span class="hljs-number">0</span></span>); osc.disconnect(context.destination); }, <span class="hljs-number"><span class="hljs-number">1000</span></span> / <span class="hljs-number"><span class="hljs-number">2</span></span>);}</code> </pre><br><br>  In conclusion, I want to say that <s>now I need to call the Stradivarius of the XXI century</s> Web Audio API - a very cool and interesting thing.  You can <a href="http://www.html5rocks.com/en/tutorials/webaudio/intro/">read</a> about it, of course, <a href="https://developer.mozilla.org/en-US/docs/Web_Audio_API">on MDN</a> , I can advise a <a href="http://www.html5rocks.com/en/tutorials/webaudio/intro/">nice tutorial on HTML5Rocks</a> and <a href="http://flippinawesome.org/2013/10/28/audio-synthesis-in-javascript/">one more fun experiment</a> . <br><br>  And the piano came out terribly primitive, but I'm still satisfied with the experiment.  I hope you were interested too. <br><br>  <a href="http://jsfiddle.net/c62Pe/1/embedded/result/">To play</a> <br><br>  <a href="http://jsfiddle.net/c62Pe/1/light/">View code</a> <br><br>  PS Macbook speakers, for example, refuse to make audible sounds down to a small octave (ie, up to 130 Hz), which is not surprising.  In general, do not be surprised if the left side of the keyboard does not seem to sound at all. </div><p>Source: <a href="https://habr.com/ru/post/202646/">https://habr.com/ru/post/202646/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../202632/index.html">Does it make sense in articles for those who are starting to learn symfony</a></li>
<li><a href="../202634/index.html">NASA held a successful launch of a satellite to study the atmosphere of Mars</a></li>
<li><a href="../202638/index.html">Your next web application framework</a></li>
<li><a href="../202640/index.html">PickMeUp is a good jQuery datepicker plugin</a></li>
<li><a href="../202642/index.html">Configuring ASP.NET MVC 5 Scaffolding Templates in Visual Studio 2013</a></li>
<li><a href="../202650/index.html">Say a word about organic photovoltaics. Part 1</a></li>
<li><a href="../202652/index.html">.NET Web Browser (30 lines)</a></li>
<li><a href="../202654/index.html">Kill Exchange - Using Bitcoin Correctly</a></li>
<li><a href="../202662/index.html">Recognizing the meaning - why to do it and what approaches underlie</a></li>
<li><a href="../202668/index.html">How to escape from VAT with services</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>