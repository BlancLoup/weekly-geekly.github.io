<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Technologies of development and support of a complex product: the experience of "Hydra"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In our blog, we already talked about billing for Hydra communication operators - our approaches to the development of complex products , and also desc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Technologies of development and support of a complex product: the experience of "Hydra"</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a93/f6f/f7b/a93f6ff7b70aa81238756225da15b428.jpg" alt="image"></div><br>  In our blog, we already talked about <a href="http://www.hydra-billing.ru/">billing for Hydra communication operators</a> - our approaches to the <a href="http://blog.hydra-billing.ru/stories/698">development of complex products</a> , and also described <a href="http://blog.hydra-billing.ru/stories/716">real cases of</a> system <a href="http://blog.hydra-billing.ru/stories/716">implementation</a> .  Today we will talk more about the stack of technologies and tools that are used in the development and operation of our project. <br><a name="habracut"></a><br><h3>  Architecture </h3><br>  Before describing the technologies used, we will take a closer look at what the billing system consists of. <br><br><ul><li>  <b>Data</b> - information about services consumed by subscribers, personal account balances, details of payments and debits. </li><li>  <b>The kernel</b> is part of the system in which all data operations are conducted.  In Hydra, it is integrated with data - business logic is located directly in the database in the form of stored procedures.  Modifying data directly to external applications is prohibited, it can be done only through the API. </li><li>  <b>AAA server (Authentication, Authorization, Accounting)</b> is an element that is responsible for authentication, authorization and accounting of important information about the services consumed by subscribers. </li><li>  <b>Payment gateway</b> - accepts information about payments made from various payment systems. </li><li>  <b>Subscriber personal account and web control panel</b> - interfaces for access and work with the system. </li></ul><br><img src="https://habrastorage.org/files/35a/bcb/1b0/35abcb1b06654defb5f3565b3e2bb914.png" alt="image"><br><br>  <i>System architecture overview</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now let's talk about specific technologies. <br><br><h3>  DBMS: Oracle and MongoDB </h3><br>  Our billing system uses the relational DBMS Oracle for accounting of primary data and storage of financial information.  It is perfect for this purpose.  The main database stores data and the core of the system.  We use a degenerate three-tier architecture - business logic (stored procedures and functions in Oracle) and data (tables) are tightly integrated into the DBMS, the browser (‚Äúthin client‚Äù) acts as a client, and the web interface serves as a program shell to the kernel. <br><br>  But some Hydra modules, for example, a RADIUS server, work under high load and can receive thousands of requests per second with severe restrictions on the processing time of the request.  In addition, in the database of our autonomous RADIUS server, the data is stored as an AVP set (attribute / value pair).  In such a scenario, a relational DBMS no longer looks like the best solution, and then MongoDB comes to the rescue with its repository of documents of arbitrary structure, quick response and horizontal scalability. <br><br>  When operating on more than 100 Hydra installations over the past 5 years, we have not found any serious problems with Mongo.  But a couple of nuances are still there.  First, after a sudden shutdown of the server, the database, although it recovers from the log, but it happens slowly.  Fortunately, the need for this occurs infrequently.  Secondly, even with a small database size, rarely used data is flushed to disk, and when a request is received, it takes a long time to retrieve it.  As a result, the restrictions on the execution time of the request are violated. <br><br>  All of this refers to the MMAPv1 engine, which Mongo uses by default.  We have not yet experimented with others (WiredTiger and InMemory) - the problems are not so serious. <br><br>  <b>See also: <a href="https://habrahabr.ru/company/latera/blog/280196/">When it is worth and not worth using MongoDB</a></b> <br><br><h3>  Work with data: JSON </h3><br>  In addition to Hydra billing, we are developing an open-source business process management system Hydra OMS.  In this project, PostgreSQL is also used, and JSON is used to work with data.  In particular, we store in these fields the values ‚Äã‚Äãof process variables, the structure of which is determined at the time of product introduction, and not during its development. <br><br>  Work with the fields of the table is made through the adapter framework Ruby On Rails for PostgreSQL.  Reading and writing work in native Ruby mode - through hashes and lists.  Thus, you can work with data from the field without additional conversions. <br><br>  <b>See also: <a href="https://habrahabr.ru/company/latera/blog/282281/">How to use JSON restrictions when working with PostgreSQL</a></b> <br><br><h3>  Performance Optimization: Denormalization </h3><br>  We in Latera do a lot of work on optimizing the performance of the billing system, which is not surprising given the volumes of our clients and the specifics of the telecom industry. <br><br>  On Habr√© we discussed the <a href="http://www.vertabelo.com/blog/technical-articles/denormalization-when-why-and-how">material of</a> foreign colleagues on the use of denormalization of databases.  One of the examples presented in this article assumes the creation of a table with intermediate totals to speed up the reports.  Of course, the most difficult thing in this approach is to maintain the current state of such a table.  Sometimes it is possible to shift this task to a DBMS ‚Äî for example, to use materialized views.  But, when business logic is slightly more complex to obtain intermediate results, the relevance of denormalized data has to be maintained manually. <br><br>  So, Hydra has a deeply developed system of privileges for users, billing operators.  Rights are granted in several ways - you can allow certain actions to a specific user, you can prepare roles in advance and give them different sets of rights, you can give a certain department special privileges.  Just imagine how slow the calls to any entities of the system would be if every time you had to go through this whole chain to make sure: ‚Äúyes, this employee is allowed to enter into agreements with legal entities‚Äù or ‚Äúno, this operator does not have enough privileges to work with subscribers of the neighboring branch ".  Instead, we separately store the ready aggregated list of existing rights for users and update it when changes are made to the system that can affect this list.  Employees move from one department to another much less frequently than they open the next subscriber in the billing interface, which means we have to calculate the full set of their rights just as often. <br><br>  Of course, denormalizing the repository is only one of the measures taken.  Part of the data should be cached directly in the application, but if intermediate results on average live much longer than user sessions, it makes sense to seriously think about denormalization to speed up reading. <br><br>  <b>See also: <a href="https://habrahabr.ru/company/latera/blog/281262/">Why database denormalization is needed, and when to use it</a></b> <br><br><h3>  Hardware Control: Clojure </h3><br>  We are now using Clojure hardware management commands.  The specificity of the task lies in the requirements for simultaneity in the execution of commands and flexible constraints.  On the one hand, it is impossible to ‚Äúfill up‚Äù one device with commands, on the other hand, to execute all commands sequentially inefficiently, because they can be executed in parallel on different equipment.  This task is easily solved by the core.async library, which adds support for go-blocks and channels familiar from the Go language, where they use interacting sequential processes (a term better known as CSP). <br><br>  At the same time, Slojure is a general-purpose language; it is easy to find its use.  Since it is based on the JVM, there is actually a huge choice of libraries for it, so using it does not need to write everything anew, which greatly reduces the entry threshold. <br><br>  Even if you don‚Äôt tolerate Lisp, you should become familiar with the concepts that are inherent in the language, many of them make you take a fresh look at programming. <br><br>  <b>See also: <a href="https://habrahabr.ru/company/latera/blog/280734/">Why you should learn and use Clojure</a></b> <br><br><h3>  Project management and support </h3><br>  Initially, the Jira system was used for the tasks of the implementation and technical support department.  However, over time it became obvious that adapting this tool for developers to the tasks of the implementation and support department is not so easy.  As a result, we began to look for alternative means. <br><br>  One of the options considered was the Zendesk service, but the inconvenient one-page interface was an obstacle to its use, in which and only in which, according to the authors, the support department staff should work.  In addition, the speed of Zendesk left much to be desired.  We encountered these problems in 2013, perhaps now the project has taken a step forward, however we have already found an alternative to it. <br><br>  She became the service Freshdesk - it is similar to Zendesk, but has a more friendly interface and is developing quite actively.  The developers promptly respond to requests, the API interface is implemented in their system. <br><br>  To manage implementation projects, we use the Teamwork PM service.  In this system, all the necessary stages of the project, tasks that need to be completed, and those areas of work that will be unlocked after this are shown.  Also listed are those responsible for solving the tasks on both sides. <br><br><img src="https://habrastorage.org/files/f6d/f72/921/f6df72921a13432a920290435e7527cd.png"><br><br>  Also for some tasks Jira is still used (management of tasks that are not suitable for the purpose of any of the other control systems). <br><br>  In addition, we have organized our own data warehouse (Data Warehouse), which uploads information from all existing systems and Hydra billing itself, which is used for charging the paid support time (it is automatically loaded into the billing from the storage) and billing.  This information is then used to organize the work of the support department. <br><br>  <b>See also: <a href="https://habrahabr.ru/company/latera/blog/269181/">How to organize support for a complex product</a></b> <br><br><h3>  Conclusion </h3><br>  Our project has been developing for 9 years, and during this time we have participated in more than 100 implementation projects.  We are constantly working to make the system more reliable and convenient for customers. <br><br>  In our blog, we will continue to talk about the technologies we use and approaches to improving the work of ‚ÄúHydra‚Äù. <br><br><h3>  Other articles on IT infrastructure from the <a href="http://www.latera.ru/">Latera</a> team: </h3><br><ul><li>  <a href="http://blog.hydra-billing.ru/stories/716">Weekdays billing: How we prepared for the denomination in Belarus</a> </li><li>  <a href="http://blog.hydra-billing.ru/stories/657">How to make migration to a new billing easy and understandable: automate data transfer</a> </li><li>  <a href="http://blog.hydra-billing.ru/stories/574">We automate the accounting of addresses and bindings in IPoE-networks</a> </li><li>  <a href="https://habrahabr.ru/company/planado/blog/294424/">Developing an application to increase the efficiency of field staff: Experience Planado.ru</a> </li><li>  <a href="https://habrahabr.ru/company/latera/blog/271271/">What else affects the infrastructure: How to ensure the quality of equipment installation</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/313508/">https://habr.com/ru/post/313508/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../313496/index.html">All you wanted to know about the design and manufacture of chips, but hesitate to ask</a></li>
<li><a href="../313498/index.html">PVS-Studio for Linux</a></li>
<li><a href="../313500/index.html">PPC - now Pay Per Call</a></li>
<li><a href="../313502/index.html">How to become smarter in a world where we want to leave an idiot</a></li>
<li><a href="../313506/index.html">Power OK: Schneider Electric Galaxy G300</a></li>
<li><a href="../313510/index.html">The book "Learning Python. Game programming, data visualization, web applications</a></li>
<li><a href="../313512/index.html">Live Container Migration: An Inside Look</a></li>
<li><a href="../313514/index.html">The Pros & Cons of Test-Driven Development</a></li>
<li><a href="../313516/index.html">Creating a console application using Android NDK</a></li>
<li><a href="../313518/index.html">7 more services for monitoring sites</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>