<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Determining GPS availability in Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings, habrasoobschestvo! 

 This article, I hope, will be a good help to beginners in the field of programming for Android. And maybe even experi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Determining GPS availability in Android</h1><div class="post__text post__text-html js-mediator-article">  Greetings, habrasoobschestvo! <br><br>  This article, I hope, will be a good help to beginners in the field of programming for Android.  And maybe even experienced pros get something. <br><br>  So, I needed to somehow determine whether the GPS fix is ‚Äã‚Äãcurrently available.  It would seem that LBS (location-based service) is a promising and popular thing, and Google, knowing this very well, will provide an easy-to-use tool for their development.  Yeah, I ran away ... It‚Äôs not all that simple, so I have to excel to a certain extent. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  Well, what's the problem here?  Problem in determining the current location of the user.  There are several types, but TK orders to use GPS and positioning along cellular towers.  The task is to determine the current coordinates with maximum accuracy, i.e.  ideally on gps.  If it is not available, then on the towers.  If there is a GPS signal, then everything is easy and simple - we take the coordinates from the satellite and do anything with them.  If there is no signal, then with the processing of coordinates you risk running into null, in which there is very little good, and with improper handling of exceptions there may be something with sad consequences.  So, we need to somehow determine, and if we have a fix? <br><br>  Well, the problem is visible - we will solve! <br><br>  Let's start with picking the LocationManager.  It has a curious property isProviderEnabled (), which returns a boolean value.  Hooray?  Sooner ... This value only describes whether the GPS receiver of your phone is on or not (in fact, it was possible to guess from the name).  The first pancake turned out as always, go ahead. <br><br>  Climb into the interior LocationListener.  What do we see?  Bah, yes, this is an onStatusChanged () handler!  Ideally, it responds to the change in the status of the provider by setting appropriate values.  Ideally ... He does not react to anything since android 2.1!  With sadness we pass by. <br><br>  Continue?  Of course we will continue!  The next feint with ears looks obvious - comparing the time of the last fix that came with the current system time.  It would seem logical - once the fix is ‚Äã‚Äãold, the GPS is unavailable.  Not quite like this: fixes come only when moving, so you can confuse the inaccessibility of satellites with a simple seat in place.  Agree, it will not be entirely pleasant if you sit for yourself, and then suddenly - oppa!  - and your phone decided that you teleported 400-500 meters.  Again, not that, but remember the trick - it will come in handy. <br><br>  Now let's look towards GpsStatus.Listener, which implements the onGpsStatusChanged method (int event).  The event variable can take several values, but we are interested in GPS_EVENT_SATELLITE_STATUS.  The occurrence of such an event indicates that your receiver is analyzing GPS satellites.  This is what we need!  Then everything is simple and understandable - we take the current GPS status and pull available satellites out of it.  In the simplest case, we are just interested in their number. <br><br>  A small digression for beginners in the field of navigation.  To determine the current coordinate, we generally need three satellites (for a three-dimensional coordinate).  But this is if you have an atomic clock, which is very, very rare in the case of mobile devices.  Therefore, to synchronize the time we need another satellite. <br><br>  The status handler will look something like this: <br><pre><code class="java hljs">LocationManager lm = (LocationManager) getSystemService(Context.LOCATION_SERVICE); GpsStatus.Listener lGPS = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GpsStatus.Listener() { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onGpsStatusChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> event)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( event == GpsStatus.GPS_EVENT_SATELLITE_STATUS){ GpsStatus status = lm.getGpsStatus(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); Iterable&lt;GpsSatellite&gt; sats = status.getSatellites(); doSomething(); } } }; lm.addGpsStatusListener(lGPS);</code> </pre> <br>  The status variable contains information about all available satellites. <br><br>  So, then everything is quite wonderful - we look at the number of satellites, if there are less than four, then there is no fix and there can be no other means of positioning (sorry, but I will not describe the specific implementation).  This method can be crossed with the juxtaposition of the times described a couple of paragraphs above.  So you can set a certain period of "trust" fix <br><br>  Let's make a balance.  All of the above does not give you precise guarantees for determining the availability of a fix.  In fact, they just cut off situations in which there is definitely no fix.  This, of course, is not quite what I wanted, but already something! <br><br>  <b>UPD</b> : Looks like a solution is found!  It <a href="http://habrahabr.ru/users/r_ii/" class="user_link">happened</a> thanks to <a href="http://habrahabr.ru/users/r_ii/" class="user_link">r_ii</a> . <br>  So, your GPS receiver, when turned on, constantly receives signals in accordance with the <a href="http://ru.wikipedia.org/wiki/NMEA">NMEA</a> protocol.  That is what we need! <br>  To view these signals, add the following to the code: <br><br><pre> <code class="java hljs">lm.addNmeaListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GpsStatus.NmeaListener() { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNmeaReceived</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> timestamp, String nmea)</span></span></span><span class="hljs-function"> </span></span>{ parseNMEA(nmea); }});</code> </pre> <br><br>  For this code, thanks to <a href="http://habrahabr.ru/blogs/android/121190/">this</a> topic <a href="http://habrahabr.ru/users/2m0nd/" class="user_link">2m0nd</a> .  A full description of the protocol <a href="http://www.tronico.fi/OH6NT/docs/NMEA0183.pdf">here</a> (pdf, eng). <br><br>  Actually, it's small - to parse the resulting string.  In this case, we are interested in the lines with the key (first) field $ GPGGA, and in them the parameter number 6, cleverly called GPS Quality Indicator.  It takes the following values: <br><ul><li>  0-fix is ‚Äã‚Äãnot available </li><li>  1-GPS fix </li><li>  2-differential fix </li></ul>  Bingo! <br><br>  PS In no case do I claim to authorship of these methods, since  All found exclusively with the help of Google.  The purpose of the article is to collect all the information in one heap and some of its structuring so that those who travel to the fabulous world of navigation and programming of mobile devices with a small green creature do not waste time and nerves. <br>  PPS Obviously, the method is far from ideal, so its improvement continues.  Any help and criticism (objective) is welcome! </div><p>Source: <a href="https://habr.com/ru/post/123397/">https://habr.com/ru/post/123397/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../123388/index.html">Sony is going to put into operation the Playstation Network and Qriocity by July 6</a></li>
<li><a href="../123391/index.html">Using MySQL events in practice</a></li>
<li><a href="../123394/index.html">Working with ShapeFile (* .shp) in Delphi</a></li>
<li><a href="../123395/index.html">Accounting system based on the OCR system</a></li>
<li><a href="../123396/index.html">Czech! Who is to blame and what should an IT specialist do abroad !?</a></li>
<li><a href="../123400/index.html">Three.js - 3D do it yourself browser or WebGL gets closer</a></li>
<li><a href="../123401/index.html">Backing up Rails projects without a hitch</a></li>
<li><a href="../123403/index.html">Maps in your Android application</a></li>
<li><a href="../123404/index.html">Google launched Prizes.org</a></li>
<li><a href="../123405/index.html">IPO for dummies. Part VIII: About Motivation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>