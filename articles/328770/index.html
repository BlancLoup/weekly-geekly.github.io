<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Configuring CryptoPro IPsec VPN with GOST Encryption</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day% username%! Everyone knows that the Federal Law of the Russian Federation No. 152 dictates to us that we must use certified means to protect ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Configuring CryptoPro IPsec VPN with GOST Encryption</h1><div class="post__text post__text-html js-mediator-article">  Good day% username%!  Everyone knows that the Federal Law of the Russian Federation No. 152 dictates to us that we must use certified means to protect PD.  There was a task to ensure the security of the channel under Federal Law 152 for remote connection of clients.  For this, a VPN server with CryptoPro IPsec and GOST certificates were used. <br><br>  Instruction inside. <br><a name="habracut"></a><br>  Before setting up the services and connections on the server and client machines, you must install CryptoPro CSP and CryptoPro IPSec on them! <br><br>  <b>We configure the VPN server on Windows Server 2012 R2</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Open the Server Manager snap-in and use the Role-based or feature-based installation through the Add Roles Wizard. <br><br><img src="https://habrastorage.org/web/1b4/056/398/1b40563987d84f9ea10430c7866e1dc5.png" alt="image"><br><br>  Next, select the server from the server pool. <br><br><img src="https://habrastorage.org/web/7ea/1ce/41a/7ea1ce41a9594cc8a79b6e167377b7c8.png" alt="image"><br><br>  At the step of selecting roles, choose the role of Remote Access. <br><br><img src="https://habrastorage.org/web/13c/a0d/3c9/13ca0d3c95924e78a9ce2a8a4efdaf70.png" alt="image"><br><br>  Step Features are skipped without making changes.  At the step of selecting the services to include in the role, select the DirectAccess and VPN (RAS) service. <br><br><img src="https://habrastorage.org/web/447/853/eb7/447853eb7d704f739e3dcd40a0defaf5.png" alt="image"><br><br>  After selecting a service, a window will open to add additional components associated with the selected service.  We agree with their installation by clicking Add Features. <br><br><img src="https://habrastorage.org/web/f44/6c9/674/f446c9674f6e41bfa5e1554841881c13.png" alt="image"><br><br>  The Web Server Role (IIS) role will be added to the Add Roles Wizard.  We skip the corresponding step of the Web Server Role (IIS) wizard and the dependent Role Services options with the default settings and start the installation process, after which a link to the Remote Access wizard of the Remote Access service will be available. <br><br><img src="https://habrastorage.org/web/271/776/c8b/271776c8bc0949b082c53cde4de9a205.png" alt="image"><br><br>  The RAS Configuration Wizard can be invoked by clicking on the appropriate link here, or later from the Server Manager snap-in: <br><br><img src="https://habrastorage.org/web/cb5/323/e8b/cb5323e8b5804788915ab7e6f996b168.png" alt="image"><br><br>  Since the setting of DirectAccess in the context of our task is not needed, in the wizard window we select the option VPN only - Deploy VPN only. <br><br><img src="https://habrastorage.org/web/fa4/1d6/be5/fa41d6be50fb46dcbe9171ae715554dc.png" alt="image"><br><br>  <b>Configuring the Routing and Remote Access service</b> <br><br>  From the Control Panel, open the Administrative Tools \ Routing and Remote Access snap-in, select the server name and open the context menu.  Select the item Configure and Enable Routing and Remote Access. <br><br><img src="https://habrastorage.org/web/11d/6df/01b/11d6df01b27846709466c48597380d8a.jpg" alt="image"><br><br>  Since we only need VPN choose. <br><br><img src="https://habrastorage.org/web/dfc/4ed/b1f/dfc4edb1ff7f4bdaa582c47b8dcae432.jpg" alt="image"><br><br>  Choose a VPN. <br><br><img src="https://habrastorage.org/web/40f/3e0/58b/40f3e058b1c848c8ba463d436a6b4ca7.jpg" alt="image"><br><br>  Next, specify the external interface that has access to the Internet, to which remote clients will connect. <br><br><img src="https://habrastorage.org/web/69b/342/699/69b342699f3b4004ad5920ef9e639fd1.jpg" alt="image"><br><br>  We configure the range of addresses for clients. <br><br><img src="https://habrastorage.org/web/30a/545/c41/30a545c41f0d4813a2b1321ee2a303e8.jpg" alt="image"><br><img src="https://habrastorage.org/web/e8c/db5/8db/e8cdb58db8674207809f646da7b718e2.jpg" alt="image"><br><br>  We indicate that we do not use the RADIUS server. <br><br><img src="https://habrastorage.org/web/8ce/941/08a/8ce94108a9034f50bd3835e275ee1166.jpg" alt="image"><br><br>  We agree with the launch of the service.  After startup, you need to configure user authentication methods. <br><br><img src="https://habrastorage.org/web/df0/4cb/bd4/df04cbbd48c54a31a5721d15e9158f45.jpg" alt="image"><br><br>  <b>We issue GOST certificates in CryptoPro UTS 2.0 for VPN.</b> <br><br>  In order for IPSec to work with us, we need: <br><br><ul><li>  CA Root Certificate </li><li>  Server certificate </li><li>  Client certificate </li></ul><br>  And so, we will create two IPSec client IPSec server templates in the TC Manager. <br><br><img src="https://habrastorage.org/web/630/0c6/c68/6300c6c6802a449096b38b80a170eef8.jpg" alt="image"><br><br>  Add the Client Authentication parameter (1.3.6.1.5.5.7.3.2) to the IPSec client template configuration.  IP security IKE intermediate (1.3.6.1.5.5.8.2.2). <br><br><img src="https://habrastorage.org/web/02c/ad9/f4f/02cad9f4fe10414eb04f4dabdd9c5186.jpg" alt="image"><br><br>  The IPSec server template is the same with the Server Authentication parameter (1.3.6.1.5.5.7.3.3.1). <br><br><img src="https://habrastorage.org/web/693/5d1/135/6935d113521a422c8a4d1febd1abee5e.jpg" alt="image"><br><br>  After the work done in the Management Console, we create users to request and generate a certificate. <br><br><img src="https://habrastorage.org/web/931/372/a00/931372a00cd24eb7b864d73de7e5e342.jpg" alt="image"><br><br>  Next, we request a certificate for the created users.  When you request, you must specify the template that we created. <br><br><img src="https://habrastorage.org/web/aee/c58/879/aeec588790b444068def9360cef74efa.jpg" alt="image"><br><br>  Choose a storage location (container) for the private key. <br><br><img src="https://habrastorage.org/web/7dc/bd7/91c/7dcbd791c54740c881ca09140339f2f0.jpg" alt="image"><br><br>  After nervous jerking with the mouse (this is necessary for the HRO), we set the password for the container. <br>  Now we need to export the certificate to a closed container. <br><br><img src="https://habrastorage.org/web/389/d1f/632/389d1f632bfa449e9edbe8cf648d3e3d.jpg" alt="image"><br><br>  After copying the certificate, you must copy the entire container to a file for transfer to the remote client's AWS.  We export using CryptoPro CSP in pfx format. <br><br><img src="https://habrastorage.org/web/28b/5cd/43e/28b5cd43e0774670b0c7f97d26526606.jpg" alt="image"><br><br>  Using the same algorithm, we create a certificate for the server using only a different template and install them using the CryptoPro CSP certificates snap-in.  Do not forget about the root certificate that should be in the Trusted Root Certification Authorities. <br><br>  <b>Configuring the IP Security Policy on the server</b> <br><br>  Step times. <br><br><img src="https://habrastorage.org/web/14c/39b/b41/14c39bb414024e6cb9e1af9be998e469.jpg" alt="image"><br><br>  Step two. <br><br><img src="https://habrastorage.org/web/8bd/7d7/614/8bd7d76149804182b495cbbd0615e674.jpg" alt="image"><br><br>  Step three. <br><br><img src="https://habrastorage.org/web/511/3c5/22e/5113c522eac0465f8697e2726a19814d.jpg" alt="image"><br><br>  On the Authentication Methods tab, add the Root Certificate. <br><br><img src="https://habrastorage.org/web/030/a00/9b4/030a009b4b7840fea3f164c67089690d.jpg" alt="image"><br><br>  Using the same algorithm, we configure the IP security policy on each remote AWP. <br>  The correctness of the certificate installation and IPSec health check, as well as error logging, can be checked using the CryptoPro IPSec cp_ipsec_info.exe utility.  After clicking the Update list menu, you will see a list of installed certificates.  On against the installed certificate should be ticked to confirm that everything is fine with it. <br><br><img src="https://habrastorage.org/web/886/540/1ea/8865401ea6954de5b94ed86d4dc17743.jpg" alt="image"><br><br>  <b>Configuring VPN connection to server</b> <br><br>  Connection is configured as standard but with minor changes. <br><br><img src="https://habrastorage.org/web/ac1/973/df3/ac1973df3f024ea3a422308c155416d0.jpg" alt="image"><br><br>  It seems to have told all the nuances, if there are comments or suggestions I will listen with joy! </div><p>Source: <a href="https://habr.com/ru/post/328770/">https://habr.com/ru/post/328770/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328760/index.html">Do cats know how to build regression?</a></li>
<li><a href="../328762/index.html">On fear of paranoids: where did the development of an analytics system lead us to fight industrial espionage?</a></li>
<li><a href="../328764/index.html">Multi-armed bandit in the task of finding objects in the video stream</a></li>
<li><a href="../328766/index.html">Applications for iOS, Android and Mac for developers</a></li>
<li><a href="../328768/index.html">Connecting to xxx.xxx.xx.xxx:443 ... failed: Unknown error or warned - so armed</a></li>
<li><a href="../328772/index.html">Dummy Origin: we test work of CDN</a></li>
<li><a href="../328774/index.html">The book "DevOps Philosophy. IT Management Art</a></li>
<li><a href="../328776/index.html">Nature has no bad laws. Generation 5, or what will work after LTE?</a></li>
<li><a href="../328778/index.html">Avito Picture Store History</a></li>
<li><a href="../328780/index.html">PDUG section on PHDays VII: how to develop applications that hackers do not hack</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>