<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Generating large amounts of useful data</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to share the experience of creating a mechanism for generating a large database of goods. With it, our users can generate in a few minutes more...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Generating large amounts of useful data</h1><div class="post__text post__text-html js-mediator-article">  I want to share the experience of creating a mechanism for generating a large database of goods.  With it, our users can generate in a few minutes more than a million of the same type, but different records. <br><a name="habracut"></a><br>  We created a large inventory system.  The number of goods promised to exceed several million and it became clear to us that manually adding products to the table would not be enough.  Products are usually of the same type and differ only in parameters.  For example: <br><ul><li>  The screw a galvanized cross of D 3 mm length is 16 mm for a tree </li><li>  Screw black cross D 3mm length 20mm for ledger </li><li>  The galvanized screw slot D 4mm length 16mm for metal </li><li>  Screw black slot D 4mm length 20mm universal </li><li>  ... </li></ul><br>  Screws can be several thousand.  For the ‚Äúhardware‚Äù product group, we also need nails, bolts, nuts, washers, dowels ... In the example, it is clear that the structure of the name consists of several fields, each of which has several options of values.  The whole set of screw names is a language (I remind you that a language is a set of strings) and this language can be described by a regular expression.  Usually, a regular expression is used to answer the question: does a string belong to a language or not?  In our case, we need to solve the inverse problem: on a regular expression, construct the entire set of strings or generate a language.  That is, the user can enter something like <br> <code> (|) D (2|3|3,5|4|5|6|7|8|9|10)  (10|12|16|20|25|30|40|50|60|80|100) (|) ( | | |)</code> <br>  The program should generate all sorts of screw options.  It should be noted that some regular expressions describe infinite languages, so not any expression can be used to generate data.  For example, the expression <code>[0-9]+</code> describes the language of non-negative integers and it is infinite. <br>  To generate data, we use two methods. <br><br><h5>  Generation with Automation </h5>  The OpenSource <a href="http://www.brics.dk/automaton/">Automation</a> package can work with finite automata, which is what a regular expression is.  Among other features, the library is able to generate strings that match the specified regular expression.  Then the matter of technology is to generate all the options and put them in the database. <br>  However, this method has a significant drawback - the speed of work.  It works well on several thousand lines, but it can take several hours for millions of records (mainly due to the slow insertion of one line into the database).  Therefore, a second method was developed. <br><br><h5>  Regular Expression SQL Generation </h5>  Imagine what happens if you execute a SQL query (MySQL dialect) <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">concat</span></span>(<span class="hljs-string"><span class="hljs-string">'  '</span></span>, t1.a, <span class="hljs-string"><span class="hljs-string">'  '</span></span>, t2.a, <span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'3'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">union</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-string"><span class="hljs-string">'4'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> a ) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> t1, ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'16'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">union</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-string"><span class="hljs-string">'20'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> a ) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> t2</code> </pre> <br>  The result will be 4 rows, which can be immediately inserted into the table: <br><pre> The screw diameter 3mm length 16mm
 The screw diameter 4mm length 16mm
 The screw diameter 3mm length 20mm
 The screw diameter 4mm length 20mm
</pre><br>  This simple example shows that you can write a SELECT query and use it as part of an INSERT query to insert the necessary rows into the database.  To generate such SQL, we wrote a simple regular expression parser.  It simply selects the brackets inside the expression, then uses the same Automation to generate all sorts of strings inside the brackets.  That is, for example, for the expression <br> <code>  (3|4)  (16|20)</code> <br>  The program selects the expressions in brackets <code>3|4</code> and <code>16|20</code> , then with the help of Automation for each pair of brackets generates various values ‚Äã‚Äãand generates a SQL query. <br>  Such a query runs much faster than inserting one entry at a time and is able to add millions of lines in a few seconds. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Limiting the generated data </h5>  The last problem remained.  Imagine a screw with a thickness of 2 mm and a length of 100 mm.  There is no such.  We needed a mechanism for limiting some combinations of parameters.  The easiest way is to ask the user to write a function in some scripting language that accepts all parameters and returns true / false.  But most likely it would meet misunderstanding from users.  Therefore, we decided to use the Pivot Table so that the user can select the desired combination of parameters, which we then simply add to the WHERE condition within the SELECT query. <br><br><img src="https://habrastorage.org/storage3/b33/055/d93/b33055d9304b3ed32e77fa02b5a2d5ba.gif" alt="image" title="Pivot table with selected items to add"><br><br>  The illustration shows a pivot table, with the columns open and the cells highlighted in yellow.  Blue color indicates products that have already been added to the database, green, those that have not yet been added.  It can be seen that all black screws for wood have already been added, and half (110/220) of all galvanized screws for metal has been added (in order to understand exactly what, you need to expand the ‚ÄúMaterial for metal‚Äù column in the summary table).  Also, the user has selected and is preparing to add black GK screws for a Phillips screwdriver and galvanized ones for a slotted screwdriver. <br>  I omit the details of how we ensured the removal of erroneously generated data and the processing of re-adding existing records.  This is more related to the subtleties of working with MySQL (or another database) and does not correspond to the topic of the post. <br>  This mechanism is well established.  Users were able to master it and use it in their work.  At the moment, the largest volume of the database of goods from one of our clients exceeds 50 million records.  Most of this volume was created in the first month of work. </div><p>Source: <a href="https://habr.com/ru/post/195624/">https://habr.com/ru/post/195624/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../195614/index.html">Exploring and Configuring CentOS 6.4 for a Server</a></li>
<li><a href="../195616/index.html">Color in the interface</a></li>
<li><a href="../195618/index.html">Analog Meggy JR RGB do it yourself</a></li>
<li><a href="../195620/index.html">Rare language - coding without IDE, but with convenience</a></li>
<li><a href="../195622/index.html">Zabbix + Cisco ISR: we monitor the loading of VPN tunnels via SNMP + Perl script + LLD</a></li>
<li><a href="../195628/index.html">Run LendWings. Part 2. Russian lands</a></li>
<li><a href="../195632/index.html">WebCrypt - online encryption service</a></li>
<li><a href="../195636/index.html">Angular.js vs Meteor.js vs Derby.js</a></li>
<li><a href="../195642/index.html">The influence of cats on the development of technology</a></li>
<li><a href="../195646/index.html">A detailed review of the iPhone 5s: a week of life with a novelty</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>