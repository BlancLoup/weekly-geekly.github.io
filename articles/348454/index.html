<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How is the advanced protection against DDoS in Selectel</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="More than two years have passed since the launch of the Selectel DDoS Protection service. Since then, more than 100 clients of the company have taken ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How is the advanced protection against DDoS in Selectel</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/aj/5z/cf/aj5zcfpvm5itdvhjj5yxnm7xrtu.png"><br><br>  More than two years have passed since the launch of the Selectel <a href="https://selectel.ru/services/additional/ddos-protection/%3Futm_source%3Dblog_selectel_ru%26utm_medium%3Dinner_referral">DDoS Protection</a> service.  Since then, more than 100 clients of the company have taken advantage of it, more than 200 single IP addresses have been defended, and some clients immediately protect the / 24 subnets.  During this time, the system has repelled more than 200 large attacks with a volume of more than 10 Gbit / s each, and the volume of traffic through the cleaning system has grown 5 times.  There were also attacks such as TCP SYN of the famous <a href="https://ru.wikipedia.org/wiki/Mirai_(%25D0%25B1%25D0%25BE%25D1%2582%25D0%25BD%25D0%25B5%25D1%2582)">Mirai</a> bot, which crossed the power mark of 70 Gbit / s at 17 million packets per second. <br><br>  Taking into account the experience gained in protecting against DDoS attacks, additional protection measures were introduced and unique cleaning algorithms were developed, working up to the L7 level of <a href="https://blog.selectel.ru/enhanced-protection-from-ddos/%3Futm_source%3Dblog_selectel_ru%26utm_medium%3Dinner_referral">the OSI model</a> , which are based on behavioral traffic analysis, recreating the algorithms of a real user. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This article describes the features of the organization of enhanced protection against DDoS in Selectel. <br><a name="habracut"></a><br>  All DDoS attacks, classifying them according to targets, can be divided into the following groups: <br><br><ul><li>  <b>Attacks that aim to overload bandwidth</b> .  Examples of attacks of this type are the above-mentioned UDP flood, ICMP flood (also known as ping flood), and other packet distribution practices that have not been requested.  The strength of such attacks is measured in gigabits per second.  It is constantly increasing and can now be up to 100 gigabits or more per second. </li><li>  <b>Attacks at the protocol level</b> .  As the name implies, attacks of this type exploit the limitations and vulnerabilities of various network protocols.  They "bombard" the server with parasitic packets, and it becomes unable to process requests from legitimate users.  As an example, SYN-flood, teardrop and other attacks that disrupt the normal movement of packets within the protocol at different stages. </li><li>  <b>Attacks at the application level</b> that disrupt the normal functioning of the system, exploiting the vulnerabilities and weaknesses of applications and operating systems.  These attacks are invisible to standard analyzers, as they sometimes make up to 1 Kpps.  Standard protection measures cannot detect such a small surge of traffic; therefore, protection always requires constant filtering and the cleaning complex must always know the algorithms of the application itself. </li></ul><br>  The existing protection system works well with bandwidth overload attacks and is acceptable at the protocol level.  Extended protection against DDoS attacks adds another step to the traffic cleaning complex - a special proxy server for protection against attacks at the protocol level and at the application level. <br><br>  The route of the traffic cleared by the usual protection against DDoS attacks is shown in the diagram: <br><br><img src="https://habrastorage.org/webt/ox/7w/si/ox7wsi3hjw9l3g0up2slw4bpzoo.png"><br>  For enhanced protection against DDoS attacks, it is necessary that the responses to requests from the server also go through the DDoS (traffic cleaning) protection complex: <br><br><img src="https://habrastorage.org/webt/1q/a5/h8/1qa5h8gs97cqjq-n6n974gxknag.png"><br>  In the simplest case, on the side of the DDoS protection complex, a software and hardware solution based on the proxy server principle is individually configured.  This solution passes all data through to the protected resource and back. <br><br>  If we talk about HTTP, the client's address is added by the proxy server to the HTTP header (for example, X-Forwarded-For or X-Real-IP).  But it only works for HTTP-like protocols (HTTP, HTTP / 2, HTTPS, Speedy).  For other protocols, both TCP and UDP based, no headers are added. <br><br><h2>  Scheme of work </h2><br>  Suppose the client IP address is 192.0.2.55. <br>  The real IP address of the protected server is 198.51.100.15. <br><br>  In order to put the server on advanced protection against DDoS, you need to fill out a special questionnaire, indicating which applications on the server you want to protect against attacks. <br><br>  How many applications - so many objects to be protected: <br><br><ul><li>  if there are two such applications, we are talking about two protected objects; </li><li>  if one - about one; </li><li>  if the application works with multiple TCP / UDP ports (for example, if it is SIP-proxy, then the application works with both TCP and UDP traffic) - this is one application; </li><li>  if we add a web server, we get another protected object.  For example, we protect SIP-proxy, which should be available from the Internet as sip.example.com. </li></ul><br>  Based on the questionnaire Selectel allocates a pair of IP addresses: <br><br><ul><li>  203.0.113.34 - for installation on a protected server; </li><li>  95.213.255.45 - for a proxy service on the side of the DDoS protection complex. </li><li>  In DNS records, the A record value for sip.example.com is set to 95.213.255.45. </li><li>  The client 192.0.2.55 contacts the service by the DNS name, the service by IP address 95.213.255.45. </li></ul><br>  This address is accessible by routing through the partner's network and thus all incoming traffic from clients to the server goes to the cleaning complex: <br><br><img src="https://habrastorage.org/webt/gp/4u/jv/gp4ujvfjnvxbw0t5pts-xdpjccs.png"><br>  The proxy service processes the traffic as follows: <br><br>  There was: (src-ip 192.0.2.55, dst-ip 95.213.255.45). <br><br>  Steel: (src-ip 192.168.0.45, dst-ip 203.0.113.34) - 192.168.0.45 - the address that the DDoS protection partner uses for NAT pools. <br><br><img src="https://habrastorage.org/webt/x2/pn/st/x2pnstqmv3ni-kno0s40ktayoam.png"><br>  The secure IP address of the server 203.0.113.34 is known only to the server administrator, Selectel and the DDoS protection partner.  The real server address 198.51.100.15 is known only to the server administrator and Selectel. <br><br>  This server address 95.213.254.15 is used to make connections from the server side, for example, for apt-get update and for server administration and monitoring, say, via ssh. <br><br>  Protected (203.0.113.34 in the example) and real (198.51.100.15 in the example) addresses must be kept secret, and their declassification may lead to a DDoS attack past the cleaning complex. <br><br>  The address 203.0.113.34 is used to connect the server with the traffic clearing complex and is unavailable from the Internet.  To match the server‚Äôs connection address with the traffic clearing complex of the current address of the protected address, Selectel uses static routing of the form: <br>  route 203.0.113.34/32 via 198.51.100.15/ <br><br>  The reverse traffic from the server to the Internet to the client is as follows: <br><br><ol><li>  The server sends IP packets (src-ip 203.0.113.34, dst-ip 192.168.0.45). </li><li>  The Selectel router isolates traffic from the incoming server to the following addresses: 192.168.0.45 (addresses of the NAT pools of the traffic clearing complex) and sends traffic back to the traffic clearing complex: </li></ol><br><img src="https://habrastorage.org/webt/cw/vh/um/cwvhum9ice3nyswftau9bs9utig.png"><br>  The packet passes through the reverse cleaning complex, where the SRC-IP and DST-IP addresses are replaced in the IP packet.  The client eventually leaves the IP packet (src-ip 95.213.255.45, dst-ip 192.0.2.55): <br><br><img src="https://habrastorage.org/webt/wy/xq/ja/wyxqjaqjjkclufj1e3ll-6xxkfy.png"><br>  Address conversion is transparent for both the client and the server.  If device addresses are transmitted within packets (in particular, SIP packets contain within the addresses of the parties), then these packets change inside due to ALG processing inside the DDoS protection complex.  Today the complex supports ALG profiles for FTP, TFTP, SIP, RTSP, PPTP, IPSec. <br><br><h3>  Supported Applications </h3><br>  For advanced protection against DDoS requires fine-tuning of the cleaning complex.  Today we at Selectel can offer extended protection for the following applications: <br><br><ul><li>  Web server (HTTP) </li><li>  Encrypted web server (https). </li><li>  Teamspeak </li><li>  Counter strike </li><li>  Minecraft </li><li>  Microsoft RDP </li><li>  DNS </li></ul><br>  For applications that process secure traffic (HTTPS, other protocols with TLS support), it is necessary to transfer the private key to the DDoS protection complex in order to organize proper proxying.  Without key transfer, application-level protection becomes impossible, and the possibilities are limited by the protocol level. <br><br>  Extended protection against DDoS attacks is designed for both HTTP resources and others: TeamSpeak, CounterStrike, DNS.  Over HTTP traffic - the complex is focused on full L7 analysis of passing packets and copes well with various HTTP attacks: XSS, SQL-injection and so on. </div><p>Source: <a href="https://habr.com/ru/post/348454/">https://habr.com/ru/post/348454/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../348444/index.html">Best UX - no UI at all</a></li>
<li><a href="../348446/index.html">Mobio Talks with Boris Golikov (YouDrive) about business, Yandex. Drive, car sharing and competition</a></li>
<li><a href="../348448/index.html">Web Apps: fast, cheap, cool</a></li>
<li><a href="../348450/index.html">Dissecting .xlsx files: editing a file with PL / SQL</a></li>
<li><a href="../348452/index.html">The man who with the Quantum "on you"</a></li>
<li><a href="../348458/index.html">Freeswitch: the path of least resistance</a></li>
<li><a href="../348460/index.html">Subtleties of the value restriction in F #</a></li>
<li><a href="../348462/index.html">Consilium in the smartphone: about the MegaFon.Health service and the development of telemedicine</a></li>
<li><a href="../348464/index.html">Operation "Y" and the new library ABI</a></li>
<li><a href="../348466/index.html">GopherCon Russia 2018: Conference Program Ready</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>