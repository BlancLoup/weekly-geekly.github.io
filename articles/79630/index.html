<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>STI - one table and many models.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Yesterday, in a note about polymorphic links in the comments the STI pattern was mentioned. As it turned out, not everyone knows what it is, how it wo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>STI - one table and many models.</h1><div class="post__text post__text-html js-mediator-article">  Yesterday, in a <a href="http://habrahabr.ru/blogs/ror/79431/">note</a> about polymorphic links in the comments the STI pattern was mentioned.  As it turned out, not everyone knows what it is, how it works and why it is needed.  I decided to fill this informational gap and briefly tell about this design pattern and its implementation in Rail. <br><br>  <i>STI (Single Table Inheritance) is a design pattern that allows you to transfer object-oriented inheritance to a relational database table.</i>  <i>In the database table there should be a field identifying the name of the class in the hierarchy.</i>  <i>Often, including in RoR, the field is called type.</i> <br><br>  Thus, we can have one table and several types of objects (models) that will be stored in it.  In the case of the aforementioned habrasame, this is one post table that stores posts of different types: link, podcast, article, translation, etc. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In order not to complicate your life, in this article we will consider a simpler example: several types of users with different powers and any other business logic.  Let it be: administrator, manager and ordinary user. <br><br>  Let's get started <a name="habracut"></a><br><br><h4>  Deciding on a task </h4><br>  For example, in our application (for example, an online store) we need to implement a hierarchy of users with different powers and, possibly, additional logic.  Let it be: administrator, manager and ordinary user.  It is logical for everyone to create a separate model: Administrator, Manager, User.  All user accounts are stored in the same database table. <br><br><h4>  Create a database structure </h4><br>  We need one table, for the sake of maximum simplification there will be two fields in it: <i>username</i> and <i>password</i> .  Also, we need to somehow store the user type, the default in the Rail for this purpose is a field called <i>type</i> . <br><br>  As a result, we obtain the following structure: <br> <code><font color="black"><font color="#993333"><b>CREATE</b></font> <font color="#993333"><b>TABLE</b></font> users <font color="#66cc66">(</font> &lt;br&gt; id INT <font color="#993333"><b>NOT</b></font> <font color="#993333"><b>NULL</b></font> <font color="#993333"><b>AUTO_INCREMENT</b></font> <font color="#66cc66">,</font> &lt;br&gt; username VARCHAR <font color="#66cc66">(</font> <font color="#cc66cc">20</font> <font color="#66cc66">)</font> <font color="#993333"><b>NOT</b></font> <font color="#993333"><b>NULL</b></font> <font color="#993333"><b>UNIQUE</b></font> <font color="#66cc66">,</font> &lt;br&gt; password VARCHAR <font color="#66cc66">(</font> <font color="#cc66cc">32</font> <font color="#66cc66">)</font> <font color="#993333"><b>NOT</b></font> <font color="#993333"><b>NULL</b></font> <font color="#66cc66">,</font> &lt;br&gt; type VARCHAR <font color="#66cc66">(</font> <font color="#cc66cc">40</font> <font color="#66cc66">)</font> <font color="#993333"><b>NOT</b></font> <font color="#993333"><b>NULL</b></font> <font color="#66cc66">,</font> &lt;br&gt; <font color="#993333"><b>PRIMARY</b></font> <font color="#993333"><b>KEY</b></font> <font color="#66cc66">(</font> id <font color="#66cc66">)</font> &lt;br&gt; <font color="#66cc66">)</font> ;</font></code> <br> <br>  Of course, it would be better to write a migration, but this is already beyond the scope of this article.  We will consider this a task for independent work :) <br><br><h4>  We create models </h4><br>  Create an ordinary user model: <br> <code><font color="black"><font color="#9966CC"><b>class</b></font> User <font color="#006600"><b>&lt;</b></font> <font color="#6666ff"><b>ActiveRecord::Base</b></font> &lt;br&gt; <font color="#9966CC"><b>end</b></font></font> <br></code> <br>  It should be borne in mind: we do not explicitly indicate the name of the table for this model.  in this case, the name of the table and model are consistent with the conventions adopted in the Rail. <br><br>  Create a model manager, inherit from the base user: <br> <code><font color="black"><font color="#9966CC"><b>class</b></font> Manager <font color="#006600"><b>&lt;</b></font> User&lt;br&gt; <font color="#9966CC"><b>end</b></font></font></code> <br> <br>  Create an administrator model, inherit from the manager: <br> <code><font color="black"><font color="#9966CC"><b>class</b></font> Administrator <font color="#006600"><b>&lt;</b></font> Manager&lt;br&gt; <font color="#9966CC"><b>end</b></font></font></code> <br> <br>  To simplify the example, we do not complicate the model with additional logic that we would need in a real application.  If required, you can always add a specific code for each type of user to the appropriate model. <br><br><h4>  We use! </h4><br>  Now in the controller we can make samples from models in the usual way: <br> <code><font color="black">users = User. <font color="#9900CC">find</font> <font color="#006600"><b>(</b></font> <font color="#ff3333"><b>:all</b></font> <font color="#006600"><b>)</b></font></font></code> <br>  In this case, we will get all users, including ordinary, managers and administrators. <br><br>  But if we make a selection from the Administrator model, we will get only administrators: <br> <code><font color="black">administrators = Administrator. <font color="#9900CC">find</font> <font color="#006600"><b>(</b></font> <font color="#ff3333"><b>:all</b></font> <font color="#006600"><b>)</b></font></font></code> <br> <br><h4>  Instead of conclusion </h4><br>  In this article, we missed many aspects that are not directly related to the main topic from writing migrations to using generators.  Also, not all the features that are provided by Rail ActiveRecord when using STI are mentioned.  Those interested can explore these points on their own. <br><br>  <a href="http://martinfowler.com/eaaCatalog/singleTableInheritance.html">Single Table Inheritance</a> by Martin Fowler <br>  <a href="http://api.rubyonrails.org/classes/ActiveRecord/Base.html">ActiveRecord documentation</a> in Ruby on Rails </div><p>Source: <a href="https://habr.com/ru/post/79630/">https://habr.com/ru/post/79630/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../79613/index.html">From the creators of the Rollers officials. Santa Claus Clip</a></li>
<li><a href="../79615/index.html">More xpPhone!</a></li>
<li><a href="../79619/index.html">Beeline - live on the black stripe</a></li>
<li><a href="../79621/index.html">Summing up the year. The turnover of my studio (in rubles) for 2009 compared to 2008:</a></li>
<li><a href="../79629/index.html">We make our own NTP server Stratum-1</a></li>
<li><a href="../79631/index.html">Details about the hacking algorithm A5 / 1</a></li>
<li><a href="../79633/index.html">Business 160 bytes. Part Three, Educational</a></li>
<li><a href="../79635/index.html">How printbook stole christmas</a></li>
<li><a href="../79637/index.html">The magnetic pole began to move faster.</a></li>
<li><a href="../79639/index.html">IT-tree</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>