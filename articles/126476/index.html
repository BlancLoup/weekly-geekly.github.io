<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make trash benefit?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What am I talking about? 
 Tasks are different ... There are simple, there are complex, and there are such, the solution of which can take more than o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make trash benefit?</h1><div class="post__text post__text-html js-mediator-article"><h4>  What am I talking about? </h4><br>  Tasks are different ... There are simple, there are complex, and there are such, the solution of which can take more than one week and a sufficient number of nerve cells.  One of these tasks is how to consider unfolding something serious on a large amount of weak iron.  Namely‚Ä¶ <br><br>  (Hereinafter we will talk about a little specific and optimized configuration of LTSP and raising a server cluster based on it). <br><a name="habracut"></a><br>  Some organization decided to deploy a terminal server and a bunch of terminal clients.  Without any preliminary calculations, without tests and apparently without brains, HP-shnye terminals of several types were purchased by someone.  They differed primarily in the amount of RAM and the size of the built-in flash drive.  The RAM size ranged from 128 to 512 MB, the drive size ranged from 64 to 256. Well, for completeness, we should mention the Via / AMD ~ 800 MHz x86 processors used, and the video from the same Via or SiS.  The zoo is shorter. <br><br>  Well bought and bought something already here.  They deployed the server, began to connect clients ... And approximately after connecting the 70th, a fairly powerful server just began to sink.  And along with the server, the clients also began to slow down, but how else?  There was not enough network resources or resources of the server itself.  What to do?  After all, about 150 non-connected terminals are still lying around!  Ay-yay-yay said at the same time users, admins and others.  Poludohalis half a year and scored.  By the way, yes, the terminals were originally under Windows CE and, accordingly, interacted with the terminal server via RDP. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And six months later they suddenly remembered ... And they gave it to an outsourcing.  With the farewell "But if you solve the problem of performance, all will be well!".  Actually what was required now from the terminals.  It was necessary that when the terminal was launched, a hand-written software was launched that allows the user to log in to the ‚Äúwhatever-that-is‚Äù server and, if the authorization was successful, launch the browser.  Business?  Yeah ... And all this should work even on the most dead terminals.  That is, the bar - 128MB of RAM, 64MB on the drive.  You can not worry about the processor, it will cope somehow ... <br><br><h4>  Attempt number one, or Embedded Linux will help us! </h4><br>  Naturally, taking into account the number of clients, it was decided not to use terminal solutions and to make each client self-sufficient.  For this was originally shut up Buildroot.  A small distribution was assembled, including the kernel, the minimum set of system and network utilities, Qt Embedded, a bit of its own software and ... yes, in fact, everything.  The size of the tse was about 40 mb, that is, it was completely placed on the weakest piece of iron.  The truth is not earned for all terminals.  If on Via the assembled complex earned from a half-kick, then it refused to start at the terminal with AMD.  It was necessary to collect Debian there separately, the benefit that places in that type of pieces of iron were dofig. <br><br>  The project was successfully completed and even handed over to the customer.  Everything worked of course is not perfect, there were gaps, it was necessary to limit the number of tabs in the browser 5th, so that it does not lean on the resources of the terminals.  It is possible to say that you can put it on the nose!  Everyone was happy, that's just ... <br><br><h4>  But what about a fun farm? </h4><br>  Yes, yes ... The omnipresent and so necessary Flash.  Well, to the heap - Java-plugin for the browser.  The problems are the same - there is not enough space in the firmware, and all the RAM has already been eaten by WebKit.  In addition, even if we had enough space, Qt Embedded does not support browser plugins, since on Linux it needs X.Org to work with these plugins.  Well, yes, that same XEmbedWindow, or whatever it is ... In short, the garbage, which allows you to embed external windows into your applications.  And as I said, even if we had enough space, the dead terminal with its 128 MB would never pull X's + Qt + running webcam browser + Flash.  It's sad.  Scale turnip ... Scale long ... Finally, we try something else.  We take as an option such a scheme: the OS starts from the terminal, but when logged in, the session is still started from the terminal server via the NX client.  In theory, this should at least a little to unload the server.  Horseradish bald ... <br><br>  Build a new Buildroot, this time throwing out Qt and stuffing X.Org and NX client.  For the sake of the test, we put the official NoMachine NX Server on the server.  This is <a href="http://www.nomachine.com/">here</a> if someone does not know.  We are loading, we see the mega login dialog in English, we understand, we are connected to the custom session ... Voila, we launched the browser from the server.  We ship in 5 tabs YouTube, let the video.  works.  We are looking at the load on the test server ... The word ‚ÄúLust!‚Äù And I want to leave the mouth: ~ 100-120 mb of RAM, taken away by a single client browser, doesn‚Äôt bring us closer to our optimization goal ... Add to that the load on the network, it‚Äôs not fun‚Ä¶ <br><br>  If we had at least 15-30 clients, it would still be possible ... But not over 300. Although again ... No settings for autologin were found for the NX-client, as no necessary parameters were found that can be passed to it at launch - type start up with this config, show me such a software on a server, while you don‚Äôt callus your Basurman face and shut up! <br><br><h4>  Ha ha!  And you did not work out? </h4><br>  What are you ... Then there would not be all this text =) In general, looking more towards a couple of options (like starting everything in the same build, something like ssh -X), I came to the conclusion that all this is not right otherwise. <br><br>  At this point in my search, I came across an <a href="http://ru.wikipedia.org/wiki/LTSP">LTSP</a> - Linux termianl Server Project.  In principle, I read about it at the very beginning, but I considered that ‚Äúall the same there is a terminal server, let‚Äôs go back to the same thing where we started‚Äù and skeptically closed the Wikipedia page.  However, partly due to the lack of other options, and partly due to the fact that in the <a href="https://help.ubuntu.com/community/UbuntuLTSP">Ubuntu Help</a> section, the LTSP dedicated feature <a href="https://wiki.ubuntu.com/LTSPLocalAppSetup">described the</a> ability to launch local applications on the terminal itself, I decided to try ... <br><br><h4>  Dust Jo It! </h4><br>  So.  As initial conditions, let's say, we have an i386 computer or a virtual machine (with two network cards on board) and a Ubuntu Server 11.04 distribution.  Plus a couple of terminals that can boot over the network.  To test ... <br><br>  First of all, of course, we install on our Ubuntu server.  Immediately after that, we throw out extra repositories and reinstall the necessary software. <br><br><pre><code class="hljs pgsql">echo "deb http://ftp.ubuntu.com/ubuntu/ natty main restricted universe multiverse" &gt; /etc/apt/sources.list apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install bash-completion openbox xserver-xorg xorg xbase-clients xterm ltsp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>-standalone arora gettext -y</code> </pre> <br>  Next, we need to configure both network interfaces.  So.  so that one looks into the general network, and the second one looks at its own subnet.  Rule file / etc / network / interfaces: <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">auto</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">lo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">iface</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">lo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">loopback</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">auto</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">eth0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">iface</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">eth0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">static</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">address</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.170</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">netmask</span></span> 255<span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">gateway</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">auto</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">eth1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">iface</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">eth1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">static</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">address</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.22</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">netmask</span></span> 255<span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span></code> </pre><br>  Then we collect the client: <br><pre> <code class="hljs axapta">ltsp-build-<span class="hljs-keyword"><span class="hljs-keyword">client</span></span></code> </pre><br>  The last but one we are setting up a DHCP server, the /etc/ltsp/dhcpd.conf file: <br><pre> <code class="hljs pgsql"> #authoritative; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> "ltsp-clients" { match <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> substring (hardware,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>) = "00:14:85"; } subnet <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.22</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> netmask <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> { #<span class="hljs-keyword"><span class="hljs-keyword">range</span></span> <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.22</span></span><span class="hljs-number"><span class="hljs-number">.20</span></span> <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.22</span></span><span class="hljs-number"><span class="hljs-number">.250</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">option</span></span> <span class="hljs-keyword"><span class="hljs-keyword">domain</span></span>-<span class="hljs-type"><span class="hljs-type">name</span></span> "example.com"; <span class="hljs-keyword"><span class="hljs-keyword">option</span></span> <span class="hljs-keyword"><span class="hljs-keyword">domain</span></span>-<span class="hljs-type"><span class="hljs-type">name</span></span>-servers <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.22</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">option</span></span> broadcast-address <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.22</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">option</span></span> routers <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.22</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">option</span></span> root-<span class="hljs-type"><span class="hljs-type">path</span></span> "192.168.22.1:/opt/ltsp/i386"; next-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.22</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">option</span></span> subnet-mask <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">option</span></span> root-<span class="hljs-type"><span class="hljs-type">path</span></span> "/opt/ltsp/i386"; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> substring( <span class="hljs-keyword"><span class="hljs-keyword">option</span></span> vendor-<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>-identifier, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span> ) = "PXEClient" { filename "/ltsp/i386/pxelinux.0"; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { filename "/ltsp/i386/nbi.img"; } pool { allow members <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> "ltsp-clients"; <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.22</span></span><span class="hljs-number"><span class="hljs-number">.20</span></span> <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.22</span></span><span class="hljs-number"><span class="hljs-number">.250</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> { next-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.22</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>; host test { deny-<span class="hljs-type"><span class="hljs-type">unknown</span></span>-clients; hardware ethernet <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">85</span></span>:<span class="hljs-number"><span class="hljs-number">47</span></span>:AA:<span class="hljs-number"><span class="hljs-number">73</span></span>; fixed-address <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.22</span></span><span class="hljs-number"><span class="hljs-number">.53</span></span>; } } }</code> </pre><br>  Here we indicate what and how to load, and in which subnet to distribute IP-addresses to our customers.  In addition, we only test our solution, and therefore do not want our DHCP server in any way to conflict with the main DHCP located in the organization‚Äôs network.  For this, we first call it not authoritative (when the machine asks for a certain IP from it, which it raves about at night, our server will simply kick it off) and then allocate a pool of MAC addresses that our server can assign IP to. <br><br>  Almost everything is ready for the first boot, but the IP of our server is far from 192.168.1.1, and therefore when booting the system on the client will not be in the course where to look for the NBD server.  Therefore, we need to fix the file /var/lib/tftpboot/ltsp/i386/pxelinux.cfg/default, replacing the nbdport parameter with nbdroot.  This file is downloaded by the client when PXE is loaded as the base config: <br><pre> <code class="hljs dos">default ltsp <span class="hljs-built_in"><span class="hljs-built_in">label</span></span> ltsp kernel vmlinuz <span class="hljs-built_in"><span class="hljs-built_in">append</span></span> ro initrd=initrd.img quiet splash nbdroot=<span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">170</span></span>:<span class="hljs-number"><span class="hljs-number">2000</span></span></code> </pre><br>  Reboot the server, start the network boot on the client and ... see the login screen: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bd9/7d1/63f/bd97d163f469cf5408f2ab0b288b2759.jpg" alt="image"><br><br>  Well, something like that.  If you think about it, now you can boot from clients, log in and work in the system.  The truth on the server at the moment is what xterm and openbox are.  In addition, this is not entirely consistent with our task. <br><br>  Suppose that for our needs there is no need to differentiate users at the OS level and all of them can simultaneously log into the system under one user.  After that, the software is launched for authorization, and if the authorization is successful, the main application, that is, the browser, is launched.  Let's try to get rid of the authorization screen first and automatically log in under a certain user.  First, create it: <br><pre> <code class="hljs pgsql">useradd ltspclient -p $(perl -<span class="hljs-string"><span class="hljs-string">e'print crypt("1234", "aa")'</span></span>) -m echo "ltspclient ALL = NOPASSWD: ALL" &gt;&gt; /etc/sudoers echo "ltspclient ALL = NOPASSWD: ALL" &gt;&gt; /opt/ltsp/i386/etc/sudoers</code> </pre><br>  There is another configuration file in LTSP, which can contain important and various settings, this is the file /var/lib/tftpboot/ltsp/i386/lts.conf.  The parameters specified in it are already used during the boot of the main operating system, whose image via NFS is mounted immediately after the PXE boot.  Fill it around like this: <br><pre> <code class="hljs pgsql">[<span class="hljs-keyword"><span class="hljs-keyword">Default</span></span>] LDM_AUTOLOGIN=<span class="hljs-keyword"><span class="hljs-keyword">true</span></span> LDM_USERNAME=ltspclient LDM_PASSWORD=<span class="hljs-number"><span class="hljs-number">1234</span></span> LOCAL_APPS=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span> XkbModel = pc104 XkbLayout = us,ru XkbOptions = "grp:alt_shift_toggle,grp_led:scroll"</code> </pre><br>  As it is easy to guess, this will allow our user to automatically log in.  Cool, yeah.  Just what should he do in an empty X.Org?  We need to run our own software after logging in.  There is always a wonderful /home/ltspclient/.xinitrc for this.  Create it and write: <br><pre> <code class="hljs cpp">#!/usr/bin/env bash <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> LANG=<span class="hljs-string"><span class="hljs-string">"en_US.UTF-8"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> LC_ALL=<span class="hljs-string"><span class="hljs-string">"en_US.UTF-8"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> LANGUAGE=<span class="hljs-string"><span class="hljs-string">"en_US.UTF-8"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> LC_CTYPE=<span class="hljs-string"><span class="hljs-string">"en_US.UTF-8"</span></span> openbox &amp; authorize -style cleanlooks #xterm</code> </pre><br>  And of course we create a symlink on it: <br><pre> <code class="hljs coffeescript">ln -s <span class="hljs-regexp"><span class="hljs-regexp">/home/ltspclient/</span></span>.xinitrc <span class="hljs-regexp"><span class="hljs-regexp">/home/ltspclient/</span></span>.xsession</code> </pre><br>  Restart the client.  Voila, after the download, our own application started up (let's say we have already deployed it on the server).  It was launched from the server, but it is quite small, it takes 2 MB of memory and you can not worry too much about it.  Another thing is the browser.  after the launch of which the server sags so badly ... again twenty-five have come to the fact that resources are gnawing on the server = (. Firstly, the network is constantly for all clients to draw a full browser (remember that Qt draws into X's just pictures?). Secondly, it‚Äôs 100 mb of RAM. On a server with 8 GB of RAM, you can deploy a maximum of 80 clients and then, provided that they do not constantly eat the processor and the network. <br><br>  Okay ... Bullshit war, the main maneuvers!  What was there about local applications?  As it turned out, local applications are real applications that are not located on the server, but are installed directly into the mounted image of the system.  And through some wrapper from the current server session, you can still run them.  In this case, the entire load falls on the terminal.  To implement such an idea, we need to deliver the necessary libraries and our browser to the image.  In short, it looks like this: <br><pre> <code class="hljs sql">cd /opt/ltsp/i386/ mount -o bind /proc ./proc chroot ./ apt-get <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> arora sudo flashplugin-nonfree sun-java6-<span class="hljs-keyword"><span class="hljs-keyword">plugin</span></span> ssh gettext -y <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> umount /opt/ltsp/i386/proc ltsp-<span class="hljs-keyword"><span class="hljs-keyword">update</span></span>-sshkeys ltsp-<span class="hljs-keyword"><span class="hljs-keyword">update</span></span>-image <span class="hljs-comment"><span class="hljs-comment">--arch i386</span></span></code> </pre><br>  Everything is simple - we make crhrot in the / opt / ltsp / i386 / directory in which the guts of the image lie, we deliver the right software right there (suppose for the sake of example that our browser is arora), and then just update the system image.  That's it, now we have an application that we can run locally! <br><br>  Before that, as I said, it was empirically found out that a browser with open 5 tabs with YouTube in each takes up a maximum of 120 MB in memory.  This means that terminals with 128 MB RAM can not be able to run it.  Let's try to cheat.  We will make it so that after launching the first application, it would look at the parameters of the system and, depending on them, decide whether to launch a local or remote browser.  Let's add the following to the code of the first application: <br><br>  Widget.h file: <br><pre> <code class="hljs cpp">... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Widget</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> QWidget { Q_OBJECT <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">explicit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Widget</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QWidget *parent = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; ~Widget(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readDeviceInfo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; ... <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: QString deviceUuidInfoFileName; ... }; ...</code> </pre><br>  Widget.cpp file: <br><pre> <code class="hljs lua">... Widget::Widget(QWidget *parent) : QWidget(parent) { ... //test <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> memory QString uuid = QUuid::createUuid ().toString().<span class="hljs-built_in"><span class="hljs-built_in">remove</span></span>(<span class="hljs-string"><span class="hljs-string">"{"</span></span>).<span class="hljs-built_in"><span class="hljs-built_in">remove</span></span>(<span class="hljs-string"><span class="hljs-string">"}"</span></span>); deviceUuidInfoFileName = QDesktopServices::storageLocation(QDesktopServices::HomeLocation) + <span class="hljs-string"><span class="hljs-string">"/.info_"</span></span> + uuid + <span class="hljs-string"><span class="hljs-string">"_mem.txt"</span></span>; QString runFileName = QDesktopServices::storageLocation(QDesktopServices::HomeLocation) + <span class="hljs-string"><span class="hljs-string">"/deviceInfo_"</span></span> + uuid +<span class="hljs-string"><span class="hljs-string">".sh"</span></span>; QString program = <span class="hljs-string"><span class="hljs-string">"/usr/bin/ltsp-localapps \"free -m | grep \"Mem:\" &gt; "</span></span> + deviceUuidInfoFileName + <span class="hljs-string"><span class="hljs-string">"\""</span></span>; QFile runFile(runFileName); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (runFile.<span class="hljs-built_in"><span class="hljs-built_in">open</span></span>(QIODevice::WriteOnly | QIODevice::Text)){ QTextStream out(&amp;runFile); out &lt;&lt; program &lt;&lt; <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; QFile::Permissions Permissions = runFile.permissions(); // Permissions == <span class="hljs-number"><span class="hljs-number">0x6600</span></span>; Permissions |= QFile::ExeOther|QFile::ExeUser|QFile::ExeOwner|QFile::ExeGroup; // Permissions == <span class="hljs-number"><span class="hljs-number">0x7711</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!runFile.setPermissions(Permissions)) { qDebug() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Cannot set file Permitions"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Permissions = runFile.permissions(); // Permissions == <span class="hljs-number"><span class="hljs-number">0x6600</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Permissions &amp; (QFile::ExeOther|QFile::ExeUser|QFile::ExeOwner|QFile::ExeGroup)) { qDebug() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Info"</span></span>, <span class="hljs-string"><span class="hljs-string">"Executable file"</span></span>; } runFile.<span class="hljs-built_in"><span class="hljs-built_in">close</span></span>(); } QProcess *ltspla = new QProcess(this); ltspla-&gt;start(runFileName); ltspla-&gt;waitForFinished(); runFile.<span class="hljs-built_in"><span class="hljs-built_in">remove</span></span>(runFile.fileName()); QTimer::singleShot ( <span class="hljs-number"><span class="hljs-number">500</span></span>, this, SLOT(readDeviceInfo())); } void Widget::readDeviceInfo() { QFile file(deviceUuidInfoFileName); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file.<span class="hljs-built_in"><span class="hljs-built_in">open</span></span>(QIODevice::ReadOnly | QIODevice::Text)){ qDebug() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Error reading memory info!"</span></span>; QTimer::singleShot ( <span class="hljs-number"><span class="hljs-number">500</span></span>, this, SLOT(readDeviceInfo())); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } QTextStream <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>(&amp;file); QString memory = <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>.readAll().split(<span class="hljs-string"><span class="hljs-string">" "</span></span>,QString::SkipEmptyParts).at(<span class="hljs-number"><span class="hljs-number">1</span></span>).trimmed(); qDebug() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Memory:"</span></span> &lt;&lt; memory; file.<span class="hljs-built_in"><span class="hljs-built_in">close</span></span>(); file.<span class="hljs-built_in"><span class="hljs-built_in">remove</span></span>(file.fileName()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (memory.toInt()&lt;<span class="hljs-number"><span class="hljs-number">220</span></span>){ ui-&gt;rbRunBrowserRemote-&gt;setChecked(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); } } ...</code> </pre><br>  Kostyuvo, but ... In fact, we run the command here / usr / bin / ltsp-localapps ‚Äúfree -m |  grep "Mem:‚Äú&gt; filename.txt "and then simply read the data from the file filename.txt and decide which version of the browser to run.  If the RAM is less than a certain level, then let the server version, if more - local. <br><br>  What does this give?  And quite tangible results ... After the launch of a local browser that unfolds in full screen, the client essentially forgets about the server.  For both X and the application are simultaneously locally started ‚Äî nothing is drawn on the server, and therefore no data is being transmitted over the network.  In addition, the calculations all occur just as locally and the server is completely unnecessary.  Cool?  Aha  This will allow to separate all more or less normal clients from their rather weak counterparts.  The first will provide themselves with resources, while the latter will still parasitize on the server. <br><br>  If we accept that we have approximately equal and equal clients, then we have achieved a part of the task - we were able to optimize the process so as to half load the server.  After all, normal clients will need it only during the download and briefly during authorization.  Although the bottleneck of course remains - this is the morning when a lot of people come and press the power button on their clients.  There is nothing you can do about it, the traffic load will be noticeable.  But this is also relatively relative.  And here's why: the boot process can be divided into two stages: <br>  1) PXE boot - approximately 8 MB of traffic from the eth1 interface is spent on it.  Then there is a small pause, initialization and the image of the main OS is requested for mounting <br>  2) Booting the main OS - this is loading the kernel, libraries, starting daemons and other stuff.  This stage requires about another 16 MB of data transmitted over the network via the eth0 interface.  This also includes autologin and the launch of the first application. <br><br>  This is what happens?  If the speed of our network cards is 100 Mbit / s, then it is 12.5 MB / s.  Round up to 10 to throw out various flaws related to collisions, etc.  Further.  For example, we have three types of terminals - if all of them are turned on at the same time at 9 am, then they will start loading a little bit at different speeds.  I think the analysis between different types will be 1-3 seconds. For each client, we need to transfer ~ 26 MB of data, that is, in general ~ 3 seconds per client (not immediately of course), multiply 3 * 300 (at the same time or with a period of a minute or two clients included). 900 seconds or 900/60 = 15 minutes, or 900 * 26 = 23,400 megabytes of data.  Lousy looks, is not it?  In general, of course, but not to say that much.  After all, we have two interfaces, and each of them will pump its own data volume - 900 * 16 = 14,400 mb through eth0 and 900 * 8 = 7,200 mb through eth1.  network load will remain high, but the load on each of the interfaces will be significantly reduced.  Unfortunately, no matter how cool it is, but a very narrow place remains and it would seem that one cannot get away from it.  It remains either to install gigabit interfaces, or to rely on the load time of a single terminal.  which is ~ 45 seconds, in which the whole process of downloading data from the server is spread. <br><br>  And yes, I am not sure about the correctness of my calculations in the previous paragraph, if I blunted somewhere, please correct. <br><br><h4>  Intermediate conclusions ... </h4><br>  Compared with the previous versions and compared with what was originally used on these pieces of iron.  under ideal conditions, we were able to unload our server in half, shifting some of the work to that of our trash, which is not quite trash ... And moreover, we were able to cram a full-fledged WebKit browser with plug-ins into it, and therefore users could unceasingly cut into Flash / html5-toys and watch porn right in the workplace (although the customer says that the plug-ins were needed for bank clients, but we all know =)). <br><br>  So this is koenchno, all is well ... Half the work is done.  But after all, we still have about 150 dead clients, with the above that we already understood that the server will be able to serve a maximum of 80, and given that the server needs not only to be served on the verge of possibilities, but also to work, but also to keep the connection with 150 more or less normal clients, it turns out that they can comfortably sit on a ~ 40-50 server of simultaneously connected dead terminal clients + 150 normal ones.  Not thick, though not empty ... What to do next?  And then we will come to the rescue ... <br><br><h4>  <s>Paste!</s>  Cluster! </h4><br>  Yes, yes, it is a cluster!  The fact.  that during its development, LTSP has grown to the point that it has the <a href="https://www.ltsp-cluster.org/">opportunity to</a> create a cluster of servers, with a load balancer, and even a web interface.  ‚ÄúUuuuuu ....‚Äù said the harsh Siberian lumberjacks.  Well, I went to read the <a href="https://www.ltsp-cluster.org/documentation/technical-introduction">datasheet</a> and the <a href="https://www.ltsp-cluster.org/documentation/howto/openvz-setup">manual for deploying an</a> LTSP cluster. <br><br>  First, let's look at what components ltsp-cluster consists of.  First of all, LTSP-Cluster itself is a set of plug-ins to an ltsp server included in the default distribution of the LTSP distribution.  In addition, to build a client that supports clustering, you do not need to install anything extra; you just need to run the client build with the --ltsp-cluster option <br><br>  The project includes the following components: <br><br><ul><li>  Load Balancer Server is the main load control server that monitors all connected application servers. </li><li>  Control Center (Web Interface) - a web interface that allows you to get information about connected clients and server load.  and also make some adjustments. </li><li>  Load Balancer Agent for GNU / Linux / Windows - placed on each application server, sends information about server load to Load Balancer Server </li><li>  Accounts Manager is a daemon installed on the same machine as the Load Balancer Agent.  Can dynamically create and delete users if necessary.  Well, that is, we started on the main server of the user ltspclient, but on the app-servers, it is not like it ... And we have autologin ... This is supposedly the Accounts Manager and monitors the automatic creation of this user when accessing one of the servers. </li><li>  PXE Configuration Editor ‚Äî Receives parameters from the Control Center and generates a PXE configuration file from them. </li><li>  NX Loadbalancer - starts the SSH server and monitors the connection of the user nx, if necessary, transfers it to one or another server. </li></ul><br>  Let's try, what ... <br><br>  First we need to rebuild our client with the cluster support options on our server: <br><pre> <code class="hljs objectivec">ltsp-build-client --arch i386 --ltsp-cluster --prompt-rootpass --accept-<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span>-packages</code> </pre><br>  During the build we will be asked a few questions that need to be answered: <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> LTSP-<span class="hljs-keyword"><span class="hljs-keyword">Cluster</span></span> NOTE: booleans must be answered <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> uppercase Y <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> N <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.170</span></span> Port (<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-number"><span class="hljs-number">80</span></span>): Use SSL [y/N]: N <span class="hljs-keyword"><span class="hljs-keyword">Enable</span></span> hardware inventory [Y/n]: Y Request timeout (<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>): <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  In the future, these parameters can be corrected in the /opt/ltsp/i386/etc/ltsp/getltscfg-cluster.conf file.  After another there will be an invitation to enter the root password. <br>  When this is done, you need to decide how to deploy the Control Center and the Load Balancer Server - on the same physical server, on different or just on different virtual machines.  Well, for simplicity, we deploy them in the same place as the main server. <br><br>  The first thing of course we put the Control Center: <br><pre> <code class="hljs pgsql">apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install ltsp-<span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span>-control postgresql <span class="hljs-comment"><span class="hljs-comment">--no-install-recommends</span></span></code> </pre><br>  Tweak the /etc/ltsp/ltsp-cluster-control.config.php config <br><pre> <code class="hljs perl">... $CONFIG[<span class="hljs-string"><span class="hljs-string">'loadbalancer'</span></span>] = <span class="hljs-string"><span class="hljs-string">"192.168.1.170"</span></span>; <span class="hljs-comment"><span class="hljs-comment">#Hostname of the loadbalancer ...</span></span></code> </pre><br>  Create a new user and a new database for PostgreSql (the password as in /etc/ltsp/ltsp-cluster-control.config.php is ltspcluster): <br><pre> <code class="hljs pgsql">sudo -u postgres createuser -SDRlP ltsp sudo -u postgres <span class="hljs-keyword"><span class="hljs-keyword">createdb</span></span> ltsp -O ltsp</code> </pre><br>  Next, you need to expand the scheme itself into the created database, the witch is shorter: <br><pre> <code class="hljs pgsql">cd /usr/<span class="hljs-keyword"><span class="hljs-keyword">share</span></span>/ltsp-<span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span>-control/DB/ cat <span class="hljs-keyword"><span class="hljs-keyword">schema</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">sql</span></span> <span class="hljs-keyword"><span class="hljs-keyword">functions</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">sql</span></span> | psql -h localhost ltsp ltsp wget http://bazaar.launchpad.net/%<span class="hljs-number"><span class="hljs-number">7</span></span>Eltsp-<span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span>-team/ltsp-<span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span>/ltsp-<span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span>-control/download/head%<span class="hljs-number"><span class="hljs-number">3</span></span>A/controlcenter.py<span class="hljs-number"><span class="hljs-number">-20090118065910</span></span>-j5inpmeqapsuuepd<span class="hljs-number"><span class="hljs-number">-3</span></span>/control-center.py wget http://bazaar.launchpad.net/%<span class="hljs-number"><span class="hljs-number">7</span></span>Eltsp-<span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span>-team/ltsp-<span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span>/ltsp-<span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span>-control/download/head%<span class="hljs-number"><span class="hljs-number">3</span></span>A/rdpldm.config<span class="hljs-number"><span class="hljs-number">-20090430131602</span></span>-g0xccqrcx91oxsl0<span class="hljs-number"><span class="hljs-number">-1</span></span>/rdp%<span class="hljs-number"><span class="hljs-number">2</span></span>Bldm.config apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install python-pygresql /etc/init.d/apache2 stop python control-center.py rdp+ldm.config /etc/init.d/apache2 <span class="hljs-keyword"><span class="hljs-keyword">start</span></span></code> </pre><br>  After all this, click on the link <a href="http://192.168.1.170/ltsp-cluster-control/Admin/">192.168.1.170/ltsp-cluster-control/Admin</a> where you can already poke around the interface ... Immediately on the first page you should indicate some important parameters: <br><pre> <code class="hljs pgsql">LANG = en_US.UTF<span class="hljs-number"><span class="hljs-number">-8</span></span> LDM_DIRECTX = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> LDM_SERVER = %LOADBALANCER% LOCAL_APPS_MENU = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> SCREEN_07 = ldm TIMESERVER = ntp.ubuntu.com XKBLAYOUT = us,ru</code> </pre><br>  Finished the first ... Next ... Load balancer ... also deployed on the same machine: <br><pre> <code class="hljs pgsql">apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install ltsp-<span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span>-lbserver <span class="hljs-comment"><span class="hljs-comment">--no-install-recommends</span></span></code> </pre><br>  Its config is /etc/ltsp/lbsconfig.xml: <br><pre> <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lbsconfig</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lbservice</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">listen</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*:8008"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">max-threads</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">refresh-delay</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"60"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">returns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$IP"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lbslave</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">is-slave</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mgmtservice</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">enabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">listen</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*:8001"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nodes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">default</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"default"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">node</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">address</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://192.168.1.171:8000"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ltsp-appserv01"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nodes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">variable</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LOADAVG"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">weight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"50"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rule</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">capacity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".7"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">variable</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">variable</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"NBX11SESS"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">weight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"25"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rule</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">capacity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$CPUFREQ*$CPUCOUNT*$CPUCOUNT/120"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">critical</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$CPUFREQ*$CPUCOUNT*$CPUCOUNT/100"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">variable</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">variable</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MEMUSED"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">weight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"25"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rule</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">capacity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$MEMTOTAL-100000"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">variable</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lbsconfig</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  I can only say that for our purposes in the future we only need to change the parameters inside. <br><pre> <code class="hljs pgsql"> &lt;nodes&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">group</span></span> default="true" <span class="hljs-type"><span class="hljs-type">name</span></span>="default"&gt; &lt;node address="http://192.168.1.171:8000" <span class="hljs-type"><span class="hljs-type">name</span></span>="ltsp-appserv01"/&gt; &lt;/<span class="hljs-keyword"><span class="hljs-keyword">group</span></span>&gt; &lt;/nodes&gt;</code> </pre><br>  In addition, you can change the number of threads.  By default, it is recommended (why) to set 1: <br><pre> <code class="hljs pgsql">&lt;lbservice <span class="hljs-keyword"><span class="hljs-keyword">listen</span></span>="*:8008" max-threads="1" <span class="hljs-keyword"><span class="hljs-keyword">refresh</span></span>-delay="60" <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span>="$IP"/&gt;</code> </pre><br>  Here it is easy to guess you can add / delete application servers.  Finally, restart Load balancer: <br><pre> <code class="hljs pgsql">/etc/init.d/ltsp-<span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span>-lbserver <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span></code> </pre><br>  Oh, and I'm tired of writing ... Well, okay.  at the moment we have a fully one fully configured main server with a web snout and load balancer.  In theory, then we only need to deploy new and new application servers and, as they are deployed, edit the balancer configuration a little. <br><br>  Oh yes, it is also necessary that the balancer be able to recognize the domain name ltsp-appserv01, for this in / etc / hosts on our lbserver, you need to add a line like: <br><pre> <code class="hljs css">192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.171</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ltsp-appserv01</span></span></code> </pre><br>  By the way, having already downloaded from any client, it will be possible to see the information that this client is connected to the application server 192.168.1.170 - that is, to our main server.  In this regard, the Control Center already logs with might and main and the MAC address of our client is recorded in the database.  Something tells me that we need to put Account Manager on the root server, but we don‚Äôt want to do this yet, we‚Äôll better move on to setting up the first of our application servers.  Well, a screenshot of the web interface.  so as to diversify this text: <br><img src="https://habrastorage.org/getpro/habr/post_images/35c/122/27d/35c12227d12a8a1cf341fd6e2cac1548.jpg" alt="image"><br><br>  So, on a virtual machine or on another computer we set Ubuntu Server 11.04 32bit.  During the installation process, specify the hostname as ltsp-appserv01 and mark it to install the Open SSH Server.  For convenience ... After a successful installation, we boot and first of all we edit the file / etc / network / interfaces.  I have some strange feeling of deja vu, and you? <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">auto</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">lo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">iface</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">lo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">loopback</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">auto</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">eth0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">iface</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">eth0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">static</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">address</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.171</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">netmask</span></span> 255<span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">gateway</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span></code> </pre><br>  They indicated that this is a computer with the address 171 - it is this IP that is registered for it in the lbserver config.  Restart interface: <br><pre> <code class="hljs ruby">$ sudo ifdown eth<span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; sudo ifup eth<span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  Address successfully changed.  Go ahead.  And then we have a choice of two options for the development of events, depending on the task at hand: <br>  1) We just install ubuntu-desktop and when the user login a standard ubunt shell is launched <br>  2) We can run exactly what we need.  Along this path and let's go ... <br>  Again we stamp on the beaten track: <br><pre> <code class="hljs pgsql">echo "deb http://ftp.ubuntu.com/ubuntu/ natty main restricted universe multiverse" &gt; /etc/apt/sources.list apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install bash-completion openbox xserver-xorg xorg xbase-clients xterm ltsp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> ltsp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> ltsp-<span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span>-lbagent ltsp-<span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span>-accountmanager arora -y <span class="hljs-keyword"><span class="hljs-keyword">update</span></span>-rc.d -f nbd-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> remove</code> </pre><br>  We are waiting for the whole matter to be delivered ... In fact, there is nothing more to do here, we first reboot the server with the agent, and then the main one.  We try to re-boot from the client.  And so it turns out that our good old 192.168.1.170, that is, the main server, is used as the Application server.  This is not surprising, because its load is very low and Load Balancer simply does not transfer the load to other servers.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Over time, this will of course change and other servers will be forced to take on part of the load. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yeah, schaz! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In order for the balancing to work, you will have to </font></font><a href="https://wiki.ubuntu.com/LDMLoadbalancingSupport"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">invent your</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> algorithm </font><font style="vertical-align: inherit;">yourself </font><font style="vertical-align: inherit;">, add the entire list of servers to the pool and finally add all the servers in the ssh_known_hosts file in the image. </font></font><a href="http://wiki.debian.org/DebianEdu/Documentation/Squeeze/HowTo/NetworkClients"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tyts! </font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) Address Pool. </font><font style="vertical-align: inherit;">To do this, we add the line to the end of the /var/lib/tftpboot/ltsp/i386/lts.conf file:</font></font><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">MY_SERVER_LIST</span></span> = <span class="hljs-string"><span class="hljs-string">"192.168.1.170 192.168.1.171"</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) We invent an algorithm (I just </font></font><a href="http://www.mail-archive.com/ltsp-discuss%40lists.sourceforge.net/msg37903.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sneaked a step</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) and write it to a file:</font></font><br><pre> <code class="hljs kotlin">#!/bin/sh max_rank=-<span class="hljs-number"><span class="hljs-number">1</span></span> max_server=<span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> server <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $MY_SERVER_LIST; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> rank=$(nc $server <span class="hljs-number"><span class="hljs-number">9571</span></span> | sed -n <span class="hljs-string"><span class="hljs-string">'s/rating://p'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$rank</span></span></span><span class="hljs-string">"</span></span> -gt <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$max_rank</span></span></span><span class="hljs-string">"</span></span> ]; then max_rank=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$rank</span></span></span><span class="hljs-string">"</span></span> max_server=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$server</span></span></span><span class="hljs-string">"</span></span> fi done echo <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$max_server</span></span></span><span class="hljs-string">"</span></span></code> </pre><br>  We carry out: <br><pre> <code class="hljs pgsql">chmod a+x /opt/ltsp/i386/usr/<span class="hljs-keyword"><span class="hljs-keyword">share</span></span>/ltsp/get_hosts</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nothing complicated, just go through all the NetCat servers and choose the least loaded one. </font><font style="vertical-align: inherit;">This script can be changed so that it uses the balancing server, but I don‚Äôt want to do this, because using such a simple script, in principle, you can get rid of lbagent and lbserver. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3) During the setup and raising of all additional servers, we have already generated DSA and RSA key pairs. </font><font style="vertical-align: inherit;">In order for clients to connect to additional servers, you must copy the generated public keys from the additional servers first to the main server and then to the image. </font><font style="vertical-align: inherit;">To do this, first on each additional server do the following:</font></font><br><pre> <code class="hljs ruby">ltsp-update-sshkeys --export ssh_known_hosts.<span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">1.171</span></span> scp ssh_known_hosts.<span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">1.171</span></span> root@192.<span class="hljs-number"><span class="hljs-number">168.1</span></span>.<span class="hljs-number"><span class="hljs-number">170</span></span><span class="hljs-symbol"><span class="hljs-symbol">:/etc/ltsp/</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And on the main server: </font></font><br><pre> <code class="hljs ruby">ltsp-update-sshkeys &amp;&amp; ltsp-update-image --arch i386 &amp;&amp; echo -e <span class="hljs-string"><span class="hljs-string">'default ltsp\nlabel ltsp\nkernel vmlinuz\nappend ro initrd=initrd.img quiet splash nbdroot=192.168.1.170:2000\n'</span></span> &gt; <span class="hljs-regexp"><span class="hljs-regexp">/var/lib</span></span><span class="hljs-regexp"><span class="hljs-regexp">/tftpboot/ltsp</span></span><span class="hljs-regexp"><span class="hljs-regexp">/i386/pxelinux</span></span>.cfg/default</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Checking: </font></font><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">cat</span></span> /opt/ltsp/i386/etc/ssh/ssh_known_hosts</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The only thing I don‚Äôt understand is what for then a balancing server is needed ... Probably in future releases the file / opt / ltsp / i386 / usr / share / ltsp / get_hosts, but this is not the case now. </font><font style="vertical-align: inherit;">But anyway, now balancing works exactly. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By the way, you can check how one or another application server is loaded using the /usr/share/pyshared/lbserver/test_comm.py script. </font><font style="vertical-align: inherit;">First, we indicate in it the address of the required server:</font></font><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">rpcserver</span></span> = xmlrpclib.ServerProxy(<span class="hljs-string"><span class="hljs-string">"http://192.168.1.171:8000"</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And then we execute it and look at the result: </font></font><br><pre> <code class="hljs pgsql">$ python /usr/<span class="hljs-keyword"><span class="hljs-keyword">share</span></span>/pyshared/lbserver/test_comm.py [{<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'MEMTOTAL'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-number"><span class="hljs-number">507788</span></span>}, {<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'CPUFREQ'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-number"><span class="hljs-number">3502.64</span></span>}, {<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'CPUCOUNT'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'DISTRO'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-string"><span class="hljs-string">'Ubuntu 11.04'</span></span>}, {<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'IP'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-string"><span class="hljs-string">'192.168.1.171'</span></span>}, {<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'HOSTNAME'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-string"><span class="hljs-string">'ltsp-appserv01'</span></span>}, {<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'ADDRESSES'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-string"><span class="hljs-string">'192.168.1.171'</span></span>}, {<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'MEMFREE'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-number"><span class="hljs-number">476144</span></span>}, {<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'MEMUSED'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-number"><span class="hljs-number">31676</span></span>}, {<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'LOADAVG'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-number"><span class="hljs-number">0.0</span></span>}, {<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'USERS'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-string"><span class="hljs-string">'kafeg'</span></span>}, {<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'NBUSERS'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'NBX11SESS'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>}]</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The script /usr/share/pyshared/lbserver/test_mgmt.py, which can access the main server and return some information, can also be useful. </font></font><br><pre> <code class="hljs pgsql">rpcserver = xmlrpclib.ServerProxy("http://192.168.1.170:8001") $ python /usr/<span class="hljs-keyword"><span class="hljs-keyword">share</span></span>/pyshared/lbserver/test_mgmt.py [{<span class="hljs-string"><span class="hljs-string">'default'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">'nodes'</span></span>: [{<span class="hljs-string"><span class="hljs-string">'active'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">'lastWeight'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span>: [{<span class="hljs-string"><span class="hljs-string">'critic'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'MEMTOTAL'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-number"><span class="hljs-number">507788</span></span>}, {<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'LOADAVG'</span></span>}, {<span class="hljs-string"><span class="hljs-string">'critic'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'ADDRESSES'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-string"><span class="hljs-string">'192.168.1.171'</span></span>}, {<span class="hljs-string"><span class="hljs-string">'critic'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'IP'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-string"><span class="hljs-string">'192.168.1.171'</span></span>}, {<span class="hljs-string"><span class="hljs-string">'critic'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'HOSTNAME'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-string"><span class="hljs-string">'ltsp-appserv01'</span></span>}, {<span class="hljs-string"><span class="hljs-string">'critic'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'NBUSERS'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-string"><span class="hljs-string">'critic'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'NBX11SESS'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-string"><span class="hljs-string">'critic'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'MEMFREE'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-number"><span class="hljs-number">476052</span></span>}, {<span class="hljs-string"><span class="hljs-string">'critic'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'CPUCOUNT'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-string"><span class="hljs-string">'critic'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'CPUFREQ'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-number"><span class="hljs-number">3502.64</span></span>}, {<span class="hljs-string"><span class="hljs-string">'critic'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'USERS'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-string"><span class="hljs-string">'kafeg'</span></span>}, {<span class="hljs-string"><span class="hljs-string">'critic'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'MEMUSED'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-number"><span class="hljs-number">31768</span></span>}, {<span class="hljs-string"><span class="hljs-string">'critic'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'DISTRO'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-string"><span class="hljs-string">'Ubuntu 11.04'</span></span>}], <span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'ltsp-appserv01'</span></span>, <span class="hljs-string"><span class="hljs-string">'address'</span></span>: <span class="hljs-string"><span class="hljs-string">'http://192.168.1.171:8000'</span></span>}], <span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'default'</span></span>}]</code> </pre><br><h4>  Everything </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">That's probably all I could dig about LTSP. </font><font style="vertical-align: inherit;">Finally, I would like to say that with such detail I tried to paint everything here only because there is practically no information on technology in Russian, although it looks quite attractive. </font><font style="vertical-align: inherit;">What stands out is my surprise, when after the first boot I heard from the terminal a KDE input sound and earned without any interrogation ... </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perhaps, period.</font></font></div><p>Source: <a href="https://habr.com/ru/post/126476/">https://habr.com/ru/post/126476/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../126467/index.html">Foursquare and Skype will be in Playstation Vita</a></li>
<li><a href="../126469/index.html">Moscow GTUG - Crystallization</a></li>
<li><a href="../126470/index.html">Logreplica: collecting logs from the entire cluster into a single point in real time</a></li>
<li><a href="../126471/index.html">Events bubbling and events capturing</a></li>
<li><a href="../126475/index.html">Tablet Archos 101, disadvantages and how to deal with them</a></li>
<li><a href="../126478/index.html">At the end of this year, the era of website intervention in the browser context menu via HTML5 will come.</a></li>
<li><a href="../126480/index.html">Rapid application development using the Greendroid library</a></li>
<li><a href="../126482/index.html">Pierre Farm Birthday</a></li>
<li><a href="../126483/index.html">Faceless pages with search giants search results</a></li>
<li><a href="../126484/index.html">Sony reduced prices for PS3 game consoles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>