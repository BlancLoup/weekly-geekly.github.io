<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Behind the Scenes of Android: Something You May Not Know</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="0. Table of Contents 



- 1. Preface 
- 2. Hack eMMC memory HTC Desire HD to change the identification information of the phone 
- 3. Creating a were...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Behind the Scenes of Android: Something You May Not Know</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/b66/2a5/eb7/b662a5eb7d734c8a5be9ffa4831501e3.jpg"><br><br><h5>  0. Table of Contents </h5><br><br><ul><li>  1. Preface </li><li>  2. Hack eMMC memory HTC Desire HD to change the identification information of the phone </li><li>  3. Creating a werewolf phone using cryptography </li><li>  4. False security: an overview of unauthorized data access threats. </li><li>  5. Conclusion </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  1. Preface </h5><br><br>  Mobile gadgets have become an integral part of our daily life, we trust them with our most intimate secrets, and the loss of such a device can lead to serious consequences.  Today, much attention is paid to the coverage of mobile security issues: conferences, meetings are held, large players produce complex products for personal and corporate protection of mobile devices.  But how effective are such tools when the device is already lost?  How comfortable they are in everyday use - constant inconvenience with additional software, increased battery consumption, increased risk of system errors.  What advice can I give to those who worry about the safety of their mobile data?  Do not store anything important on your smartphone?  Then why is he so needed - do not send the birds into space, in fact? <br>  Today I want to talk with you about devices running the Android OS, created by my esteemed Google company.  As an example, I use a good past years smartphone from HTC - Desire HD.  Why him?  Firstly, it was with him that we began our research in the field of security of Android devices, and secondly, it is still an up-to-date smartphone with the full range of functions of the average Googlephone.  It supports all versions of Android, in it the standard HTC look at the organization of the file system and the standard layout of the internal memory partitions.  In general, the perfect simulator for defense and attack. <br>  With this report, I spoke at the recent ZeroNights 2012 conference, and now I want to present it to the community.  I hope it will be interesting to you and even a little useful. <br><a name="habracut"></a><br><h5>  2. From A to Z: the history of the low-level hacking of the read-only eMMC memory of the HTC Desire HD smartphone </h5><br><br>  As we know, the eMMC device memory is divided into blocks, each of which carries certain information, this is how an approximate tree of memory blocks of HTC Desire HD smartphone looks like <br><br><img src="https://habrastorage.org/storage2/9fd/873/1ab/9fd8731abe2d5df336d66dd75302d06b.png"><br><br>  We are interested in the contents of <b>/ dev / block / mmcblk0p7</b> and, as luck would have it, the usual S-OFF hack does not allow us to climb.  More precisely, you can see, but to change - sorry. <br>  What is there that even the lack of a digital signature verification does not allow writing there? <br>  In HTC <b>partition 7, the</b> most important device information was hidden: <b>CID</b> , the state of the ‚Äú <b>S-ON \ S-OFF</b> ‚Äù flag, <b>IMEI,</b> and radio module settings.  Confident in the impenetrability of their protection, HTC stores this data in clear text. <br>  After conducting a deep analysis of the market for devices for ‚Äúrestoring‚Äù Android smartphones, the <b>HXC Dongle</b> device ( <a href="http://www.hxcdongle.com/">www.hxcdongle.com</a> ), created by unknown Chinese craftsmen, was found and purchased.  The device promised all kinds of manipulations with almost all models of HTC Android phones. <br><img src="https://habrastorage.org/storage2/aab/f28/d35/aabf28d35fa454e9137d02d8a95e447b.png"><br>  The product consisted of a USB smart card reader and the sim card itself.  An application was downloaded from the manufacturer's website (hxcdongle.com), which, using a smart card to verify its authenticity, performed any manipulations on the stock device that was not rooted, including the notorious S-OFF, change of CID and something else. <br>  At the same time, the device itself was connected to the PC with an ordinary USB-miniUSB cord and all operations went through ADB (Android Debug Bridge).  This led to the idea that all the "magic" is created on the device itself. <br>  The reverse engineering of the process was required, for this it was necessary to intercept the USB exchange via ADB.  We must pay tribute to the masters from the Middle Kingdom - they provided such an option of events that when using most USB sniffers, the program directly spoke about the presence of an intercepting driver, or the system simply fell into BSOD. <br>  However, this did not stop us and after a brief research, we finally saw the whole process, and also intervened and received the cherished dumps. <br><br>  A sequence of actions was restored from the dumps, which was a shell command, and some files were downloaded to the device.  Most of the files turned out to be well-known utilities (albeit cleverly renamed) - root-exploit, busybox and / dev / block / mmcblk0p7 dumps before and after the change + a stripping script that cleans up traces. <br><br>  But among them was the actual utility, which, using a unique key generated by the timestamp kernel, removed the write protection.  The strings command on this file gave us text strings of error messages, which Google brought us to the source code of the <b>gfree</b> utility by <b>Scotty2</b> (known person in the XDA community, a talented hacker), who could briefly (before reboot) remove the protection of the microcircuit and change Secure_Flag all in the same mmcblk0p7 <br>  The search for contact with the author led me to the <b># g2root</b> channel of the <b>freenode.net</b> IRC network, where I learned that <b>Scotty2</b> had not been seen for a long time, but his comrade, the hacker under the nickname <b>Guhl</b> , who was co-author of <b>gfree, got</b> in touch with me.  At first he was very angry that with the help of their work, the Chinese earn money, all the more without even mentioning the names of the creators and cutting all the copyrights out of the program's body.  Then, after reviewing the results of our research, he became interested in the changes that the Chinese made to the <b>wpthis.ko</b> module, thereby making RW access to partition 7 permanent. <br>  How is such a tricky write protection organized, and why does <b>gfree</b> know how to turn it off (this is the key to getting S-OFF)? <br>  Partition 7 is protected from recording in 2 stages: <br>  -Program protection in the memory sector <br>  -Protective instruction in the kernel, causing a reboot when a write attempt is detected <br><br>  <b>GFree</b> consists of two parts: the userlevel application and the kernel module, which is loaded during operation, then, if the module is successfully loaded, commands are sent to it, depending on the keys set. <br><br>  As we know from the kernel, we have direct access to the hardware and the <b>wpthis.ko</b> module provides the eMMC memory chip (Quallcomm MSM7XXX) with a control signal for the reset cycle (reset_and_init_emmc) via the voltage supply to the 88 leg: <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">powercycle_emmc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ gpio_tlmm_config(PCOM_GPIO_CFG(<span class="hljs-number"><span class="hljs-number">88</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, GPIO_OUTPUT, GPIO_NO_PULL, GPIO_2MA), <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">// turn off. gpio_set_value(88, 0); mdelay(200); // turn back on. gpio_set_value(88, 1); mdelay(200); }</span></span></code> </pre> <br><br>  Bootloader when the device is booted, configures the eMMC chip, setting its write protection.  Rebooting the eMMC chip resets the write protection settings.  Scotty managed to find a way (the 88th leg of the chip, shutting off and applying voltage to it, leads to the correct reboot of the eMMC controller. <br>  After that, we are one step away from accessing the entry in / dev / block / mmcblk0p7 in online mode; only the core with the protective function prevents us.  To bypass this protection, we will have to assemble our kernel from the source code, making small changes to it.  From the set of sources, we are interested in the file <b>drivers / mmc / card / block.c</b> <br>  In it, look for the line <b>#if 1</b> and just change it to <b>#if 0</b> .  What is curious is that in kernel mode there is no native reboot command, so BUG () is used, which creates an error leading to a reboot. <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> 1 </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (board_emmc_boot()) </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (mmc_card_mmc(card)) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (brq.cmd.arg </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt; 131073) {/* should not write any value before 131073 */ pr_err("%s: pid %d(tgid %d)(%s)\n", func, (unsigned)(current-&gt;pid), (unsigned)(current-&gt;tgid), current-&gt;comm); pr_err("ERROR! Attemp to write radio partition start %d size %d\n", brq.cmd.arg, blk_rq_sectors(req)); BUG(); return 0; } #endif</span></span></span></span></code> </pre><br><br>  Protection works like this: when both systems are turned on, when you try <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#dd if=/sdcard/mmcblk0p7 of=/dev/block/mmcblk0p7</span></span></code> </pre><br>  The phone just restarts.  If the kernel has already been modified, the recording will take place, but in fact it will not be recorded - the reboot will return everything back. <br>  What kind of vulnerability?  Of course, this is a hardware vulnerability - the manufacturer of the device left a loophole for overwriting memory, which should always remain Read-Only, this is also a personal vulnerability - the identification information of the phone can be changed and this will make it difficult to find it in case of loss / theft. <br>  But also this vulnerability - the vulnerability of mobile operators.  Experiments with partition7 showed that operators do not have an IMEI number filter ‚Äî devices with any IMEI, including duplicate and obviously not corresponding to reality, can be registered on the network.  The operators are certainly aware of the problem, but they are probably connected hand and foot ... by Chinese phones.  The fact is that a large share of the phone market belongs to devices with the same IMEI number.  Disconnecting these devices from the network will result in the loss of a large number of clients. <br>  Well, now we will talk about more mundane things - protecting our device from theft of information stored on it.  First, I will talk about how to protect themselves, and then - from what. <br><br><h5>  3. Paranoid Android: creating a werewolf phone using cryptography </h5><br><br>  Since the advent of android devices on the market, enthusiasts have been looking for ways to secure their data as much as possible and to unleash the potential of a greatly curtailed, but still Linux kernel Android OS. <br>  It all started with <b>The Guardian Project</b> (https://guardianproject.info), which released the port of the famous linux-utility <b>cryptsetup</b> , which implements the capabilities of the DM-crypt kernel module for transparent data encryption.  Since Android OS can use native encryption (albeit very crooked and unreliable), this module is present in all runoff cores.  Such a powerful tool, however, was used by the author for completely unserious purposes - the banal creation of cryptocontainers for storing files and folders.  We went further, finding a way to use this utility to encrypt user data on the fly, but not only ... <br>  So, let's take a look at creating a secure smartphone based on Android OS 2.3-4.1 using the example of <b>HTC Desire HD</b> . <br>  All important data is stored in two places (this follows from the areas accessible to the user for writing): <br><br><pre> <code class="bash hljs">/data/ /mnt/sdcard</code> </pre><br><br>  Therefore, the most obvious option is to ‚Äújust‚Äù encrypt them using cryptsetup.  In fact, everything turns out to be much more complicated and interesting: firstly, you have to solve the problem of opening and mounting cryptocontainers at the smartphone download stage ‚Äî you need to edit the kernel, adding to the download sequence, invoking the interactive password entry menu and operations with cryptocontainers, secondly, you need to create your own menu to enter a password at the stage of loading the device.  There were similar projects, but none of them reached the release - the inevitable problems of damage to the cryptocontainer during a power outage nullified the security benefits. <br>  We went another way - the crypto-OS is separated from the main system, thus, any problems will not prevent the phone from switching on and functioning and the kernel should not be tormented. <br><br>  Let's look at an example of step-by-step execution of our cryptophone. <br><img src="https://habrastorage.org/storage2/c9b/e46/1eb/c9be461ebfea597739f45151468de440.jpg"><br>  We will need: <br>  - Phone on Android version 2.3-4.1 <br>  - Root <br>  - installed package of console utilities busybox <br>  - installed console manager of crypto containers lm.cryptsetup <br>  - USB Debug mode enabled <br>  - ROM manager reboot binary <br><br>  I recommend using some custom rum that already has it all, for example Leedroid Rom for HTC Desire HD <br><br><h6>  1. We need to create containers for storing secure data, let's start with / data / container: </h6><br><br>  In the / data / directory we will create an empty file with a size of 800mb (remember, in Desire HD we have 1GB of internal memory available, you must leave at least 200mb for the functioning of an open system) - <pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#busybox dd if=/dev/zero of=/data/secure0 bs=1M count 800</span></span></code> </pre><br>  We tie it to a loopback device - <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#losetup /dev/block/loop3 /data/secure0</span></span></code> </pre><br>  Let's format in Luks-format using 128-bit AES encryption - <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#lm.cryptsetup luksFormat ‚Äìc aes-plain /dev/block/loop3</span></span></code> </pre><br>  Let's open our new cryptocontainer for further customization - <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#lm.cryptsetup luksOpen /dev/block/loop3 data</span></span></code> </pre><br>  Where data is the name we have chosen for the crypto container. <br>  Let's create ext4 file system in our crypto-container - <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#mke2fs ‚ÄìT ext4 ‚ÄìL Secure0 -F /dev/mapper/data</span></span></code> </pre><br>  The container for / data / is ready until we set it aside and work on the SD card, after saving the progress and closing the file correctly - <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#lm.cryptsetup luksClose data</span></span></code> </pre><br>  Now we need the <b>parted</b> command, it is in the custom recovery menu, where I will use it (being in the custom <b>RecoveryWorkMod Recovery,</b> we have access to ADB with Root rights), we will remap the SD-card, we will make one section 2 - open and encrypted - <br><pre> <code class="bash hljs">parted /dev/block/mmcblk1</code> </pre><br>  where mmcblk1 is our complete SD card (while mmcblk0 is all eMMC memory) <br>  We display the contents - <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></code> </pre><br>  Pay attention to the full size of the card, remember it.  By default, the HTC DHD comes with an 8GB card, and we will keep it. <br>  Delete the first and only section of the SD card - <pre> <code class="bash hljs">rm 1</code> </pre><br>  Create two new ones, first open in fat32, 4GB in size - <pre> <code class="bash hljs">mkpartfs primary fat32 0 4032</code> </pre><br>  Then the workpiece for the cryptocontainer, we do it in ext2, but this is not important, we reformat anyway - <br><pre> <code class="bash hljs">mkpartfs primary ext2 4032 8065</code> </pre><br>  As you can see, the first digit is the boundary of the first section, the second is the boundary of memory. <br>  Exit and reboot - <br><pre> <code class="bash hljs">quit</code> </pre><br>  Now in the SD card we have 2 partitions, / dev / block / mmcblk1p1 is 4GB of open flash drive, which is mounted to the PC when you connect the phone with a usb cord and / dev / block / mmcblk1p2 is a hidden partition of 4GB, which is nowhere mounted (linux, however, quite quickly recognizes it).  In other words, with a superficial assessment, the first thought is a fake SD card, this often happens in half the face value. <br><br>  We continue to work with the SD card.  Now, instead of a file, we have a block device (card section), which means we will not need a loopback device, we format the entire section in Luks at once - <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#lm.cryptsetup luksFormat ‚Äìc aes-plain /dev/block/mmcblk1p2</span></span></code> </pre><br>  Open the created container - <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#lm.cryptsetup luksOpen /dev/block/mmcblk1p2 sdcard</span></span></code> </pre><br>  Where sdcard is the selected name for the SD card container <br>  Format open container in fat32 - <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#mkfs.vfat -n Seccard0 /dev/mapper/sdcard</span></span></code> </pre><br>  We close the sd card container, it is completely ready, and do not touch it before the system finally works - <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#lm.cryptsetup luksClose sdcard</span></span></code> </pre><br>  Let's fill the data container, because now it is empty, and in this form the system will not work. <br>  Execute commands to open - <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#losetup /dev/block/loop3 /data/secure0 #lm.cryptsetup luksOpen /dev/block/loop3 data</span></span></code> </pre><br>  Create a folder in the root (previously remounting it in rw), where we will mount our cryptocontainer - <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#mount ‚Äìo remount,rw / #mkdir /DATA #mount ‚Äìt ext4 /dev/mapper/data /DATA</span></span></code> </pre><br>  You need to copy all the folders from the original / data / except ../dalvik-cache/ (the program will create the content when you first start the cryptosystem) and ../d/ and without the secure0 file itself - <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cp -a /data/app /DATA # cp -a /data/app-private /DATA # cp -a /data/backup /DATA # cp -a /data/data /DATA # cp -a /data/dontpanic /DATA # cp -a /data/drm /DATA # cp -a /data/etc /DATA # cp -a /data/htcfs /DATA # cp -a /data/local /DATA # cp -a /data/misc /DATA # cp -a /data/property /DATA # cp -a /data/secure /DATA # cp -a /data/system /DATA # cp -a /data/zipalign.log /DATA # mkdir /DATA/d # mkdir /DATA/dalvik-cache</span></span></code> </pre><br>  Now we have a double of our system with all the data, unmount and close the container - <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># umount /DATA # lm.cryptsetup luksClose data</span></span></code> </pre><br><br><h6>  2. Now we need to make from these two containers with data the second OS, loaded and unloaded according to our desire "on hot" </h6><br><br>  There are possible options, I will describe the very first, from which we started. <br>  So what needs to be done?  We need to replace the contents of / data / and / mnt / sdcard / on the fly with the contents of the prepared cryptocontainers, and when it will be necessary - go back.  Since the system is alive, it just will not work.  We use commands that allow us to stop the visible part of Android, while keeping the core working. <br>  Here is an example of one of the crypto mode entry algorithms: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#setprop ctl.stop zygote #mount -o remount,rw rootfs / #mkdir /DATA #mkdir /mnt/SDCARD #mount -o move /mnt/sdcard /mnt/SDCARD #lm.cryptsetup luksOpen /dev/block/mmcblk1p2 sdcard #mount -t vfat /dev/mapper/sdcard /mnt/sdcard #mount -o remount,ro rootfs / #mount /dev/block/mmcblk0p26 /DATA #losetup /dev/block/loop5 /DATA/secure0 #lm.cryptsetup luksOpen /dev/block/loop5 data #umount /data -l #mount -t ext4 /dev/mapper/data /data #setprop ctl.start zygote #killall zygote</span></span></code> </pre><br><br>  The algorithm is very rough and everything can be done much simpler and more efficient, but this is just an example.  In any case, the program for android to handle such an algorithm will either have to be written, or roughly use any program for executing scripts with interactive support. <br>  After completing this scenario, we will find ourselves in crypto mode, which so far 1 to 1 looks like the original.  In order not to be confused, it is better to immediately change the "wallpaper" and the location of the icons.  Losses in the speed and duration of the smartphone are almost imperceptible, which allows you to be in this mode constantly. <br><br><h6>  3. We need to think of a way to safely complete the work in crypto mode. </h6><br><br>  Incorrect shutdown in 1 case out of 10 will result in damage to the file system and make the crypto mode not loadable (but all the data can be retrieved intact, though manually digging through the container), which means that the standard shutdown and reboot options are not suitable for us. <br>  Turning off the phone painlessly will help us with this script: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#sync #setprop ctl.stop zygote #setprop ctl.stop runtime #setprop ctl.stop keystore #fuser /data -m -k #umount /data #/lm.cryptsetup luksClose data #/system/bin/reboot</span></span></code> </pre><br><br>  There is no need to worry about the crypto section on the SD card, nothing will happen to fat32. <br><br>  Now we have a double bottom phone.  How to use it?  You can hide in crypto mode mistresses, business partners, insider information, a collection of German films or Internet troll tools.  Obviously, when choosing a password of due complexity, breaking a cryptocontainer is not a trivial task.  So we put the pinlock, disable the ADB - and our data is behind a stone wall. <br><br><h5>  4. False security: an overview of how to extract data from a Google phone. </h5><br><br>  Above, we looked at a non-trivial way to deafly protect our mobile data, but we did not say a word - are we protecting ourselves from what?  A lot of copies are broken in Android OS security issues, a lot of reports have been made, products have been released, but the main defense-defense efforts are still directed at an external enemy - remote hacks, viruses, and traffic interception.  But the highest degree of threat is, as always, physical access to the device.  If the device fell into bad hands, then with a high degree of probability the information will leave its dungeons and will delight the intruder. <br>  We will put ourselves in the place of the attacker and try to create an algorithm for hacking the device, which we can touch.  Imagine that we again have HTC Desire HD in our hands, locked with a graphic key or pinlock, where to start? <br><br><h6>  1. We get access to data </h6><br><br>  The way to access the data depends on the initial conditions, but there will be two conditions - the presence of Android USB Debugging On and Root access. <br>  Taking into account the fact that a huge number of smartphones are rushing and reflashing right after unpacking the box, there is a great chance to get everything on a silver platter, because in most custom firmware ADB access is enabled by default, and in some of them the corresponding display has been removed.  So the first tip is to check the status of USB Debugging and turn it off if turned on. <br>  The next vulnerability of S-OFF devices is custom recovery.  If you have S-OFF, then most likely you are stitched with a custom, if you are stitched with a custom, then most likely you have custom recovery, and custom recovery is one continuous hole.  Here you have in one bottle both Root, and non-disconnectable USB Debugging, and then we do ‚Äúmount ‚Äìa‚Äù and for the time being the data.  How to fight?  The cryptography mentioned above is the only way out.  Why?  Therefore, even if the firmware of the native recovery does not help - the attacker in the same way again casts the fastboot with the caste, and then according to the instructions. <br>  The option is more complicated: the S-ON phone, the OS does not get - pinlock, ADB is off, there is no stock recovery and in general there is no root.  Hopeless case?  As if not so. <br>  There is such a thing, called <b>XTC Clip</b> , is a clone of the factory HTC device for low-level work with phones of different models of this manufacturer (from Hero to Sensation).  Allows you to make S-OFF without data loss (as opposed to the official unlock bootloader) and never loaded into the OS. <br><img src="https://habrastorage.org/storage2/4fc/613/786/4fc613786a0aa4fd1de96e9907be6695.png"><br><br>  Work with the device consists of 3 stages: <br><ul><li>  1. Connecting to a PC running Windows as a USB disk with the program </li><li>  2. Creation of the so-called GoldCard from the SD card (service information is written on the card for reading from the engineering menu of the phone) </li><li>  3. Phone downloads to the engineering menu via a cable inserted into the phone‚Äôs SIM connector and then reset the Secure Flag to 0 position </li></ul><br><img src="https://habrastorage.org/storage2/bab/e7a/7ab/babe7a7abf16037d5be7bd1007ed2429.png"><br><br>  Then we sew Recovery again and go to step 2 <br><br><h6>  2. What to take? </h6><br><br>  After getting access in the Root mode to the inside of the smartphone, we can completely clean it out.  For example, having completely copied the / data / directory, we will receive, in fact, a complete copy of the user's system settings - accounts, programs, software settings, access points, and so on.  It can simply be inserted into the phone of the same model with approximately the same OS version and get a clone of the device under attack. <br>  And you can take only what is interesting, for example: <br><pre> <code class="bash hljs">/data/system/accounts.db</code> </pre><br>  This is the SQlite database of your accounts, the trouble is that all the passwords in it are in clear text (Google does not consider this a problem, since accessing this section is a violation of the security of the device, not the OS), we put a program like <b>sqlitebrowser</b> on a PC (http://sourceforge.net/projects/sqlitebrowser/) <br><br>  All your accounts with passwords in a readable form, take it and use it! <br>  What we have more interesting? <br>  Phonebook! <br><pre> <code class="bash hljs">/data/data/com.android.providers.contacts/databases/contacts2.db</code> </pre><br>  Here we have the contacts and call history. <br>  Dig further, sms - <br><pre> <code class="bash hljs">/data/data/com.android.providers.telephony/databases/mmssms.db</code> </pre><br>  All the taste in the table Treads. <br>  Well, you can just remove the pinlock and use the phone in normal mode, also through ADB - <br><br><pre> <code class="bash hljs">adb shell <span class="hljs-comment"><span class="hljs-comment"># sqlite3 /data/data/com.android.providers.settings/databases/settings.db sqlite&gt; update secure set value=65536 where name='lockscreen.password_type'; sqlite&gt; .exit # exit adb reboot</span></span></code> </pre><br><br>  If sqlite3 is not in our recovery, then you need to download it separately and run it through ADB <br><br><h6>  3. How to defend? </h6><br><br><ul><li>  1. Do not use Android </li><li>  2. Do not take phones for which there is Root and S-OFF </li><li>  3. Encrypt, encrypt and encrypt again </li></ul><br>  The first option is not an option - to those who do not use, Android‚Äôs security problems are not interesting, the second option does not give any guarantees - today isn‚Äôt, and tomorrow will be.  How to use the third option, I told you. <br><br><h5>  Conclusion </h5><br><br>  Today we have examined several issues regarding the vulnerability of Android-based smartphones, some of which are also characteristic of tablets under this axis.  With regard to the vulnerability of the hardware, allowing to change the identification data of the device - this is a problem of the vendor and operators, and they will have to look for ways to solve it, we, in turn, have to keep ‚Äúinformational hygiene‚Äù, know the dangers in person and measure protection efforts with the value of the protected data. <br><br>  Everyone who mastered - thank you very much for your attention! </div><p>Source: <a href="https://habr.com/ru/post/160035/">https://habr.com/ru/post/160035/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../160017/index.html">STM32 + DHT11</a></li>
<li><a href="../160019/index.html">Seven Stone Age Ghosts or What Should Be the Perfect Online Store</a></li>
<li><a href="../160029/index.html">Bitcoin: Mining reward halving on Thursday morning</a></li>
<li><a href="../160031/index.html">The official port of SailFish OS for Nokia N9 will not be</a></li>
<li><a href="../160033/index.html">New search in Gmail</a></li>
<li><a href="../160037/index.html">Plugins for ReSharper 7.1</a></li>
<li><a href="../160039/index.html">20 years to the first smartphone in history</a></li>
<li><a href="../160043/index.html">"Lyapi" when using photos for website design</a></li>
<li><a href="../160049/index.html">JVM options. How it works</a></li>
<li><a href="../160051/index.html">Room maps appear on Google Maps</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>