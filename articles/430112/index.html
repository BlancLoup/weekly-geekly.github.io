<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we learned to talk to millions of people</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Marketing in the X5 is a large amount of data. Pyaterochka, for example, sends more than 30 million communications every month, and this number is con...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we learned to talk to millions of people</h1><div class="post__text post__text-html js-mediator-article">  Marketing in the X5 is a large amount of data.  Pyaterochka, for example, sends more than 30 million communications every month, and this number is constantly growing.  One client can simultaneously send several offers, and it is important to choose the right ones.  Store promotions should be interesting to the customer and economically viable for the retailer.  In this post we will tell you how we began to identify really popular offers using machine learning and eliminate the effect of spam. <br><br><img src="https://habrastorage.org/webt/j4/h3/pq/j4h3pqwpk3fbr80vohjqfuxh1ce.jpeg"><br><a name="habracut"></a><br>  A large team works in order to improve communication with customers of Pyaterochka, Perekrestok and Karusel, at X5 Retail Group. <br><br>  Now, to maintain this system, dozens of people and systems are required: accurate data accumulation in Oracle, data analysis and setting up campaigns in SAS, setting up rules for calculating bonuses in Comarch.  Analysts make decisions every day on how to select the most relevant proposal at the moment, choosing from a huge variety of options, based on historical data on the results of actions.  We are working to ensure that the communications were at the address and had nothing to do with spam. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We thought about how to translate the process of selecting a current offer for a customer into automatic mode using machine learning in order to: <br><br><ul><li>  accounted for the accumulated information on customers and past campaigns </li><li>  the system itself studied on new data </li><li>  planning was calculated more than one step ahead </li></ul><br>  So we came to the realization of self-organizing systems and the era of the development of the Reinforcement Learning system in X5 began. <br><br>  <b>A bit about Reinforcement Learning</b> <br>  * RL (Reinforcement Learning) is reinforced learning.  One of the ways of machine learning, during which the system under test (agent) is trained, interacting with a certain environment. <br><br>  Theory of learning with reinforcement operates with two concepts: action and state.  Based on the state of the object, the algorithm decides on the choice of actions.  As a result of the committed action, the object falls into a new state, and so on. <br><br><img src="https://habrastorage.org/webt/ad/wc/ce/adwcceygr-9khoxjow8pbuf0urg.png"><br><br>  Assuming that: <br><br><ul><li>  agent - client </li><li>  action - communication with the client </li><li>  state - state (Metrics set) of the client </li><li>  Target function - further client behavior (for example, increase in revenue or response to a targeted campaign) </li></ul><br>  ... then the described system should solve the set goal and the agents (clients) will choose their own actions (rewards and campaigns) for the sake of their comfort and meaningful relationship with the store. <br><br>  <b>What does the world mind RL offer?</b> <br>  First, we looked for examples of solving such problems, described in open sources. <br>  Found some interesting examples: <br><br>  <i>Pro tools:</i> <br><br><ul><li>  <a href="https://www.quora.com/What-frameworks-are-available-for-reinforcement-learning">www.quora.com/What-frameworks-are-available-for-reinforcement-learning</a> </li></ul><br>  <i>About the application of RL to similar tasks in marketing:</i> <br><br><ul><li>  <a href="https://www.researchgate.net/publication/221653839_Cross_channel_optimized_marketing_by_reinforcement_learning">www.researchgate.net/publication/221653839_Cross_channel_optimized_marketing_by_reinforcement_learning</a> </li><li>  <a href="http://cseweb.ucsd.edu/~elkan/254spring02/sequential.pdf">cseweb.ucsd.edu/~elkan/254spring02/sequential.pdf</a> </li><li>  <a href="http://www0.cs.ucl.ac.uk/staff/d.silver/web/Publications_files/concurrent-rl.pdf">www0.cs.ucl.ac.uk/staff/d.silver/web/Publications_files/concurrent-rl.pdf</a> </li><li>  <a href="https://arxiv.org/pdf/1504.01840.pdf">arxiv.org/pdf/1504.01840.pdf</a> </li><li>  <a href="https://habrahabr.ru/company/ods/blog/325416/">habrahabr.ru/company/ods/blog/325416</a> </li></ul><br>  But they all did not fit our case or did not inspire confidence. <br><br>  <b>Stage 1. Solution prototype</b> <br><br>  Therefore, we decided to develop our own approach. <br><br>  In order to minimize risks and not to fall into a situation where we developed a system for a long time without real use, and then it did not take off as a result, we decided to start with a prototype that would not implement the RL method in its pure form, but had a clear business result. <br><br>  The basis of basic implementations of learning with reinforcement is the state-action-result matrix, updated every time new information is received from the environment. <br><br>  To reduce the status space, within the framework of the prototype, a transition was made from the client to the segment, where all the clients were divided into 29 groups based on the parameters: <br><br><ul><li>  average check </li><li>  purchase frequency </li><li>  basket stability </li><li>  basket filling </li><li>  customer loyalty (proportion of the number of weeks with purchases to the number of weeks during which a person participated in the store loyalty program) </li></ul><br>  Thus, the task has been reduced to learning a matrix of the following form: <br><br><img src="https://habrastorage.org/webt/xg/od/fy/xgodfykbktkdomfwiethcvsxn20.png"><br><br>  At the intersection, the matrix had to be filled with the value of the goal function. <br><br>  In the first version of the algorithm, the specific response to the campaign was selected as a goal function. <br><br>  We developed the first prototype in a couple of weeks in SQL (Oracle) and Python.  We had historical data on communications, so we were able to partially fill in the matrix with the estimated weight of the segment-sentence pairs.  Unfortunately, it turned out that for some couples there is not enough data.  It did not stop us, we were eager for combat tests. <br><br>  The marketing department of Pyaterochka entrusted us with data on two million clients for 10 weeks of experiments.  At this time, these buyers were disconnected from all other communications.  We identified half of the clients in the control group, and the rest of the groups tested the prototype. <br><br>  The theory of RL told us that we must not only choose the best action, but also continuously continue learning.  Therefore, every time we tested a random campaign on a small percentage of our clients.  Accordingly, the remaining customers received the best offer (the best campaign).  Thus, we got our realization of Œµ - the greedy method of choosing the most optimal sentence. <br><br><img src="https://habrastorage.org/webt/uj/56/al/uj56aldamk8c6-xyunn7dvyndw8.png"><br><br>  After three launches of the system, it became clear that the choice of the best response campaign does not lead to an increase in the specific RTO per campaign (this indicator is the main measure of the effectiveness of any target campaign in any organization). <br><br>  By changing the goal function (and therefore the algorithm for choosing the best campaign) directly to the incremental RTO, we learned that the most successful campaigns from this point of view are unprofitable from the point of view of ROI. <br><br>  So, by the eighth launch of the system, we changed the goal function for the third time, now to ROI. <br><br>  <b>Conclusions from prototype development</b> <br><br>  Below are graphs of the effectiveness of the main indicators: <br><br><ul><li>  Net customer response to communication </li><li>  Incremental RTO </li><li>  Marginality </li></ul><br><img src="https://habrastorage.org/webt/3z/xi/ln/3zxilngdig1is0jilssemdqlof0.png"><br><br><img src="https://habrastorage.org/webt/q0/zq/t7/q0zqt7qlsvrfvadiva3wy6ff3ui.png"><br><br><img src="https://habrastorage.org/webt/b-/9a/ga/b-9aga-qsikuynb_u6r9hramzu8.png"><br><br>  It can be noted that by the last launch, the efficiency of the prototype (for incremental RTO) surpassed the average result of campaigns launched by analysts, and if we consider only the ‚Äúbest‚Äù segments and offers, the difference is more than two times. <br><br>  For the future, we made the following conclusions for ourselves: <br><br><ol><li>  Speaking in advance with a KPI business may not be enough.  KPI business customer is also changing.  (So ‚Äã‚Äãwe moved from RTO to marginality). </li><li>  Indirect goals (in our case, the response) is good, but sooner or later you will be asked to take into account immediate performance indicators. </li><li>  The best campaign segment pairs have been found that show consistently good results.  These campaigns were launched on the entire base and regularly generate profit. </li></ol><br>  Total: <br><br><ol><li>  circuit works </li><li>  It is necessary to take into account the cost of the client (the victory on the IITO did not ensure the growth of ROI) </li><li>  I would like to take into account the history of responses </li><li>  now it's not so scary to go to the client level </li></ol><br>  <b>Stage 2. Finishing the system</b> <br><br>  Inspired by the results of the first stage, we decided to finalize the system and introduce the following functional improvements: <br><br>  1) to move from the selection of the offer to the customer segment to the selection of the offer individually for the client, describing it with a set of metrics: <br><br><ul><li>  Last Response Flag </li><li>  The ratio of customer PTO in 2 weeks to PTO in 6 weeks </li><li>  The ratio of the number of days since the last purchase to the average distance between transactions </li><li>  The number of weeks since the last communication </li><li>  The ratio of the amount of used bonuses per month to the amount of PTO per month </li><li>  Reaching the goal in the previous two weeks </li><li>  Response flags for offers with different types of rewards </li><li>  choose not 1, but a chain of two subsequent campaigns </li></ul><br>  2) clarify the objective function, adding to it, in addition to the response, the growth of the PTO :). <br><br>  Now, choosing an individual offer for a client, we focus on the expected value of the objective function Q1: <br><br><ul><li>  Q = 1 if the client responded to the campaign and his 2-week RTO increased by m% during the episode </li><li>  Q = 0 if the client did NOT respond to the campaign and his 2-week RTO increased by m% during the episode </li><li>  Q = 0 if the client responded to the campaign and his 2-week RTO grew LESS than the episode by m% </li><li>  Q = -1 if the client did NOT respond to the campaign and his 2-week RTO grew less than m% during the episode </li></ul><br>  Now piloting the second approach is in full swing, but we have already surpassed the previous results. <br><br>  <b>What's next</b> <br><br>  Fortunately, the results are not only encouraging the implementation and development team, but also business customers, so in the future, in addition to functional improvements, it is planned to create similar systems that work for real-time- and online marketing. <br><br>  In addition, the attentive reader will notice that until now we have not used RL in its pure form, but only its concept.  Nevertheless, even with such a simplification, we observe a positive result and are now ready to move on, complicating our algorithm.  By our example, we want to inspire others to go "from simple to complex." <br><br>  <i>Editorial Habr X5 thanks Glowbyte Consulting for help in preparing the post.</i>  <i>The pilot was executed by a joint team of six Pyaterochka and Glowbyte specialists.</i> <i><br><br></i>  <i>By the way, we are looking for Big Data Product Development <a href="https://hh.ru/vacancy/28139278">Manager</a> , Data <a href="https://hh.ru/vacancy/27989545">Specialist</a> , Analytics <a href="https://hh.ru/vacancy/27989545">Specialist</a> and Loyalty Program <a href="https://hh.ru/vacancy/27725006">Manager</a> .</i> <i><br></i> </div><p>Source: <a href="https://habr.com/ru/post/430112/">https://habr.com/ru/post/430112/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../430094/index.html">Shelf retroconsole arrived: PC Classic for those who cherish DOS-games</a></li>
<li><a href="../430102/index.html">ENOG 15: "Why is the Internet still online?"</a></li>
<li><a href="../430104/index.html">Medical Data | Do not give out a medical card.</a></li>
<li><a href="../430106/index.html">New XYZprinting at IMTS 2018: 3D Printers and Robots</a></li>
<li><a href="../430108/index.html">Why "Young Technician" will not be able to build a laser</a></li>
<li><a href="../430114/index.html">How to create a reliable game mechanics in Excel. Part 2</a></li>
<li><a href="../430116/index.html">Computers write prose, but still give way to people. Why?</a></li>
<li><a href="../430118/index.html">Unity3D: Modifying the delegate of an iOS application</a></li>
<li><a href="../430120/index.html">Tame the beast. What did we encounter when developing an application for keeping a personal journal on React Native?</a></li>
<li><a href="../430122/index.html">Workaholism is a painful condition that is not customary to talk about</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>