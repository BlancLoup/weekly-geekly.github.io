<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How many times have I not abandoned the development of my second game</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Picture to attract attention 

 Reassured after the shock of the fact that my first game did not explode the Internet, I decided to make another one. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How many times have I not abandoned the development of my second game</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/59c/1dd/1c9/59c1dd1c90b6412c87a0863cc9e89386.jpg"><br>  <i>Picture to attract attention</i> <br><br>  Reassured after the shock of the fact that my <a href="http://habrahabr.ru/post/249297/">first game</a> did not explode the Internet, I decided to make another one.  The first thought, with which the development of the second game began, arose in my head and without deliberation became the cornerstone in the foundation of the game: ‚Äúif a game with endless gameplay did not become popular, then you need to make a content-dependent game with levels‚Äù. <br><br>  Since I already had a little experience in creating a game, I armed myself not with a keyboard, like last time, but with a pencil and paper, and I began to ‚Äúinvent‚Äù the game.  On different A4 sheets, I wrote down my thoughts in different directions: game mechanics, the setting, the interface, the rules, interesting thoughts, memorable games from childhood, and so on;  at the same time I am parallel to the wool of the Google Play Market looking for inspiration.  In the end, after a few days, it was decided that the game would become a puzzle, namely, a puzzle.  During this time, my brain and fingers were bored with programming, as a result of which I wanted to make at least some kind of prototype game.  This led me to a more intensive elaboration of the idea of ‚Äã‚Äãthe puzzle, and as a result the variant with the following rules was adopted as a worker: the playing field consists of square puzzle pieces (hereinafter referred to as tiles), on which multicolored lines are placed;  tiles can be interchanged;  goal of the game: to assemble a puzzle in the only way in which lines of one color are closed in a certain pattern. <br><a name="habracut"></a><br>  <b>Tip number 1:</b> <i>write down everything that comes to mind (on paper, in the diary, on the phone (as a temporary storage I liked Google Keep), anywhere), and then repeatedly filter, selecting the most valuable.</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Prototype </h3><br>  The prototype was written on a bunch of html + js (used canvas) for a couple of evenings.  Since  I haven‚Äôt done anything serious on canvas before, it was decided to bribe in order to get more in-depth acquaintance with this technology. <br><br><img src="https://habrastorage.org/files/246/a42/bb3/246a42bb371f4f3ea9752b7df2e11da6.png"><br>  <i>Fig.</i>  <i>1. The first version of the prototype.</i> <br><br>  It does not look very, I know.  It is for this reason that all my motivation quickly faded away, and the game was abandoned for several months.  Abandoned, but not completely: I continued to write down all the game ideas that came to my mind, and sometimes I reread them. <br><br>  At the same time, in order to somehow justify my inaction, I began to constantly read various near-game articles.  Habr (articles and digests of the gaming industry with collections of articles) and some popular sites with articles from the world of game development helped me in their search. <br><br>  <b>Tip number 2: a</b> <i>quick transition to programming without a sufficiently developed paper prototype can knock out for a long time.</i>  <i>If this happens and you cannot bring yourself to return to the project, then continue the work indirectly: the easiest options are reading articles about game development and writing down thoughts.</i> <br><br><h3>  Drawing - cardinal change of activity </h3><br>  After several months of inactivity in the field of creating a game, I quit my job.  The decision to leave matured long ago and in no way connected with the creation of the game, but thanks to the appearance of free time I was able to return to my project.  Returning to the game again, I realized that her meager appearance strongly demotivates me.  I coped with this problem by arming myself with several graphic editors: having painted a slightly more beautiful design, I killed several birds with one stone: <br><br>  1. Changed the occupation. <br>  2. Increased faith in myself (I myself drew design for the game). <br>  3. Invented that the lines can be roads, and tiles - pieces of land.  So began to emerge the essence of the game. <br>  4. I saw that the center of the tile must be closed by some image, since  different options of roads were ugly docked in the center.  So in the center of the tiles appeared at home. <br><br>  <b>Tip number 3: take a</b> <i>break from programming, change your occupation (designing on paper, thinking through monetization, design, game mechanics, reading) otherwise you can quickly cool off to the Idea.</i>  <i>Changing the type of activity in the initial stages can reveal problems or subtleties that need to be dealt with at the start of a project.</i> <br><br><img src="https://habrastorage.org/files/538/8ba/6ed/5388ba6ed408496491a7ad43ea05bbda.png"><br>  <i>Fig.</i>  <i>2. When the design of the game is a programmer.</i> <br><br>  It doesn't look much better, but if it helps to continue working on the project, then why not. <br>  Further, the prototype was supplemented with the basic functionality of the game: a screen with a list of levels and a screen for directly passing levels were created.  But in order to pass different levels, they must first be created.  And I gladly tried myself in a new role - I started creating levels. <br><br>  Each level was carefully preserved in json-format until the size of the levels grew and it became difficult to edit them.  I had to deal with an extraordinary task: the creation of a level designer.  It was the simplest editor, from which I copied the json level and pasted directly into the code of the game (brrr, I apologize to all readers for this horror).  But the frequent thoughts that the code and architecture of the game (and the architecture of the designer in particular) are not perfect, forced me to redo many pieces of the game again, and sometimes several times. <br><br>  <b>Tip # 4:</b> <i>re-read your code;</i>  <i>look for what can be simplified, improved, accelerated.</i>  <i>This will not only keep your interest, but make your code cool.</i> <br><br><h3>  Development </h3><br>  Summer came and with him I had a strong desire to find a job.  I moved to sites with vacancies, began to send my resume five years ago to different companies and in the process of this lesson I realized that over 5 years the industry has changed a lot, and all this time I lived in my cozy little html and jQuery.  After reading the requirements for vacancies and talking to recruiters, I realized that I did not know the new products, which did not allow me to feel confident in my abilities. <br><br>  It was necessary to do something, and I took up self-education, while not forgetting about the game.  Guided by the requirements for vacancies, I made a list of technologies, tools and other frameworks, which, in my opinion, I should have met, and began to study them.  First, I initialized the git repository in the project directory.  After a day of work, I could not imagine how I used to work without him.  Then he began to divide his overgrown super-object, which contained all the logic of the game, according to the modules of RequireJS.  This made it possible to get rid of duplication of the code in the game and the designer (long live <abbr title="Don't repeat yourself">DRY</abbr> !), Increased the readability of the code, allowed us to make a universal code for the future to quickly port the game to different social networks and, finally, returned me faith in my powers.  I gradually deleted more and more points from the list (closures, Promises, Web Workers, gulp, etc.), and it became more and more pleasant to look at the code. <br><br>  <b>Tip number 5:</b> <i>develop!</i>  <i>If you do not do this, then your competitors will do it, and you will go to a landfill.</i> <br><br><h3>  Procrastination </h3><br>  At one point in time, another trouble struck me: I have a tendency to irrational procrastination, so gradually I began to waste more and more time.  I decided to pull myself together and try some way to make myself work.  And then I caught the eye of the Pomodoro equipment.  It works like this: four working approaches for 25 minutes with five-minute breaks, after which you take a fifteen-minute break.  Having installed the application on the phone, I did not notice how I worked all day without any problems with motivation.  The next day I finished the technique: I made an agreement with myself that the break should be spent outside the computer to rest my eyes.  A miracle happened: the next day, I repaired / corrected / smeared / disassembled / disassembled the equipment in the house as much as I did in a whole year (subjective feeling).  Naturally, at some point during the breaks there was nothing to do and I came up with another trick: I began to push-ups, squat, do exercises for the press (exercises that can be done at home without any simulators). <br><br>  <b>Council number 6</b> : <i>if you suffer from procrastination, distraction, laziness, then try to deal with it in various ways.</i>  <i>Satisfaction from the victory over bad habits delivers only pleasant emotions, while problems with motivation and fantasy disappear.</i> <br><br><h3>  Descent from heaven </h3><br>  My inner perfectionist keeps telling me that I have to do the game alone.  If I listened to him, then I would never have started this game.  By July, I ceased to inspire the graphics drawn by me, and I matured to look for an artist.  First, I found examples of images that I like, then I compiled TK in my own words and went through the following search circles for illustrators: <br><br>  1. Habr.  He wrote to people who make games or draw.  Bottom line: to no avail. <br>  2. The community of artists / illustrators Vkontakte.  Result: I found an artist who disappeared after a month of work, leaving me with unfinished sketches.  Bottom line: to no avail. <br>  3. Specialized sites where you can see the works of artists and contact them: on one of the sites I found many suitable candidates, sent TK, selected two (plus later found another one on the same site), agreed to work together, a month later I was ready for the interface and two worlds (two styles for the level screen and the game screen). <br><br><img src="https://habrastorage.org/files/8ed/92f/cd8/8ed92fcd8b634974941d53bbb44995ba.png"><br>  <i>Fig.</i>  <i>3. Artwork ordered from artists.</i>  <i><b>UPD: The</b> default font is used.</i> <br><br>  <b>Tip number 7</b> : <i>look for an artist immediately after creating a prototype for creating sketches (for money / for interest), if you do not consider yourself a professional illustrator.</i>  <i>This is great fun interest.</i>  <i>Since the appearance of the professional design of the game, I have not had problems with motivation and efficiency.</i> <br><br><h2>  Interesting Facts </h2><br><h3>  Fonts </h3><br>  The font for the game was found 5 days before the launch of the game, before the game was used Tahoma.  At first, I thought that I would set the task of selecting the font for the artist, but then I looked at Habr√© for articles about fonts and, having adopted a couple of sites with free fonts, I began to select myself.  It took 2 days and brought to the piggy bank a dozen nice fonts, and now one of them pleases the eye of users. <br><br><img src="https://habrastorage.org/files/a2b/75f/669/a2b75f669c044f8db282b1b9826d4a5a.png"><br>  <i>Fig.</i>  <i>4. The screen of the game of the Ice World with a selected font.</i> <br><br>  <b>UPD:</b> <br><img src="https://habrastorage.org/files/066/bef/890/066bef8909a84dffb48d72ec200bd2ff.png"><br>  <i>Fig.</i>  <i>5. The screen of the levels of ancient Rome with a selected font.</i> <br><br><h3>  Music </h3><br>  On one site where you can find an artist for almost any task, I found a person with a lot of positive feedback and ordered background music and several effects from him.  After 2 days, I got everything I needed, paid for the work of the performer and realized that the music needed to be played.  Despite little experience in this area, I refused to go cycling and began searching for ready-made solutions.  I compared the two options (SoundManager2 and Ion.Sound) and chose the one I liked (Ion.Sound).  Testing and selection took another 2 days. <br><br><h3>  There should be only one solution per level. </h3><br>  As I mentioned earlier, the goal of the game begins with the words: ‚Äúassemble the puzzle in the only way‚Äù.  This formulation concealed the most fascinating task of all that I had to face in the process of creating the game.  At the same time, it took a very long time: the polishing of the algorithm for checking the number of possible combinations of the collection level constantly haunted me. <br><br>  Task setting: there is a field of N cells on which N tiles are placed.  On each tile there can be roads of different types and different directions.  A field is considered to be collected if the tiles are arranged so that each road connects to a neighboring road of the same type. <br><br>  A field must be assembled uniquely for several reasons: <br><br>  1. To hints worked correctly. <br>  2. To avoid claims and disputes about exactly how the collected level looks. <br><br>  Starting to create levels without a constructor, I missed a couple of moments in which levels could be assembled in several ways.  Therefore, having thought a little (unfortunately, a little), I piled the first version of the autosampler level, which recursively went through all possible combinations of arrangement (permutations) of tiles and at the end produced the number of permutations at which the level was assembled.  At first, when the number of tiles in a level was 9-12, this algorithm worked in less than a second, but when I reached the 16-tile levels, I ran into a very long execution time.  Let me remind you that all this works in a browser on js in one stream.  In some cases, when I left the execution of the algorithm for the night, the browser tab could hang for a long time and no longer respond.  In order not to clutter up the place in the article, I will describe the following optimization with the list: <br><br>  1. Added an array of already verified permutations (saved into it a json string) and did not double check the same options. <br>  2. Rewrote recursion cycles - the execution time has not changed significantly. <br>  3. Began to think how to get rid of N!  with all permutations.  I remembered how I invented in my head an algorithm for solving Sudoku in my head.  He began to draw an algorithm on paper and simultaneously stumbled upon an article <a href="http://habrahabr.ru/post/194410/">Algorithm X or what is common between a wooden puzzle and a dancing Link?</a>  .  I implemented algorithm X (I did not implement anything fundamentally new, so if the description of the algorithm is interesting, then it can be found in the above article). <br>  4. Made a "caching" of all possible characteristics necessary for the operation of the algorithm. <br>  5. Rewrote algorithm X with a cycle instead of recursion - the execution time has not changed significantly. <br>  6. Replaced the array of already verified permutations with a tree in which each i-th nesting level corresponds to all checked tiles in the i-th position.  Subjectively, this greatly reduced the running time of the algorithm at best. <br>  7. I tried to solve in several threads using Web Workers - the execution time increased by a few seconds. <br><br>  As a result of all the optimizations, it was possible to achieve collection time from 25 tiles to one and a half minutes.  Next thought: rewrite the algorithm in a programming language that can work with multithreading. <br><br><h3>  gulp.watch </h3><br>  At the stage of active development, I ran gulp watch in the console and encountered a mysterious behavior for myself.  Everything worked correctly until I started to edit css.  After starting watch after 2-3 changes in the css-file, gulp stopped saving the output file (it created an empty file with the correct name in the right directory and that was it).  The search for a solution took half a day and did not lead to anything.  The remaining files were processed correctly.  If someone came across and can explain in the comments, I will be glad: <br><div class="spoiler">  <b class="spoiler_title">gulpfile.js</b> <div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cssmin = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-cssmin'</span></span>), rename = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-rename'</span></span>); gulp.task(<span class="hljs-string"><span class="hljs-string">'css'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ gulp.src([<span class="hljs-string"><span class="hljs-string">'css/style.css'</span></span>]) .pipe(cssmin()) .pipe(rename({<span class="hljs-attr"><span class="hljs-attr">suffix</span></span>: <span class="hljs-string"><span class="hljs-string">'.min'</span></span>})) .pipe(gulp.dest(<span class="hljs-string"><span class="hljs-string">'build/'</span></span>)); }); gulp.task(<span class="hljs-string"><span class="hljs-string">'watch'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ gulp.watch(<span class="hljs-string"><span class="hljs-string">'css/style.css'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ gulp.run(<span class="hljs-string"><span class="hljs-string">'css'</span></span>); }); });</code> </pre> <br>  When deleting lines with cssmin and rename, the situation did not change. <br></div></div><br><br><h3>  RequireJS and gulp </h3><br>  Thanks to RequireJS, I managed to achieve modularity of the project, but before launching, I realized that I needed to optimize the code, so I had to tinker with different options for optimizing the project on RequireJS using gulp.  The requirejs was globally installed.  Next, the following modules were considered as candidates for use in gulp: gulp-requirejs, gulp-requirejs-optimize, and gulp-shell.  Examples of using: <br>  <b>gulp-requirejs:</b> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rjs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-requirejs'</span></span>); gulp.task(<span class="hljs-string"><span class="hljs-string">'optimize'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ rjs({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'script'</span></span>, <span class="hljs-attr"><span class="hljs-attr">baseUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'.'</span></span>, <span class="hljs-attr"><span class="hljs-attr">out</span></span>: <span class="hljs-string"><span class="hljs-string">'build/script.js'</span></span> }); });</code> </pre><br>  <b>gulp-requirejs-optimize:</b> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> requireJSOptimize = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-requirejs'</span></span>); gulp.task(<span class="hljs-string"><span class="hljs-string">'optimize'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ gulp.src(<span class="hljs-string"><span class="hljs-string">'script.js'</span></span>) .pipe(requireJSOptimize(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"script"</span></span>, <span class="hljs-attr"><span class="hljs-attr">baseUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'.'</span></span> } })) .pipe(gulp.dest(<span class="hljs-string"><span class="hljs-string">'./build/'</span></span>)); });</code> </pre><br>  <b>gulp-shell:</b> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shell = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-shell'</span></span>); gulp.task(<span class="hljs-string"><span class="hljs-string">'optimize'</span></span>, shell.task([<span class="hljs-string"><span class="hljs-string">'r.js -o baseUrl=. preserveLicenseComments=false name=script out=build/script.js'</span></span>]));</code> </pre><br>  In the end, I chose the option with gulp-shell, because  he only showed in the console the correct time to complete the task, and, accordingly, when used in dependencies of another task, he worked correctly.  The build time of the final js file for one social network is 7-8 seconds. <br><br><h3>  VK API </h3><br>  Since with the last game I suffered with changing the code when I tried to host the game on Odnoklassniki and Facebook, I knew in this project at the initial stage of development that all API calls needed to be moved to a separate module.  RequireJS allowed me to make a separate startup js-file for the social network, which defines the functions and methods that call the various methods of the social network API.  Part of the startup file: <br><pre> <code class="javascript hljs">requirejs.config({ <span class="hljs-attr"><span class="hljs-attr">baseUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'.'</span></span>, <span class="hljs-attr"><span class="hljs-attr">paths</span></span>: { <span class="hljs-string"><span class="hljs-string">'vk_api'</span></span>: <span class="hljs-string"><span class="hljs-string">'//vk.com/js/api/xd_connection.js?2'</span></span> } }); requirejs([ <span class="hljs-string"><span class="hljs-string">'vk_api'</span></span>, <span class="hljs-string"><span class="hljs-string">'script'</span></span> ], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">vk_api, script</span></span></span><span class="hljs-function">) </span></span>{ script.environment = <span class="hljs-string"><span class="hljs-string">'vk'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Tests social network's API * @return Promise */</span></span> script.testSocNetwork = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callback</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, reject</span></span></span><span class="hljs-function">) </span></span>{ VK.init(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> callback ===<span class="hljs-string"><span class="hljs-string">'function'</span></span>) { callback(); } resolve(); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ reject(); }); }); } <span class="hljs-comment"><span class="hljs-comment">/** * Shows invite friend dialog */</span></span> script.inviteFriends = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ VK.External.showInviteBox(); } <span class="hljs-comment"><span class="hljs-comment">/** * Gets array with IDs of friends and call callback with this array by argument * @return Promise */</span></span> script.getFriendsIds = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callback</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, reject</span></span></span><span class="hljs-function">) </span></span>{ VK.api(<span class="hljs-string"><span class="hljs-string">'friends.getAppUsers'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!(<span class="hljs-string"><span class="hljs-string">'response'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data)) { reject(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> response = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data.response) { response.push(data.response[f]); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> callback === <span class="hljs-string"><span class="hljs-string">'function'</span></span>) { callback(response); } resolve(); }); }); } <span class="hljs-comment"><span class="hljs-comment">/** * Shows buy ingame money dialog */</span></span> script.buyMoney = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">type</span></span></span><span class="hljs-function">) </span></span>{ VK.callMethod(<span class="hljs-string"><span class="hljs-string">'showOrderBox'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'item'</span></span>, <span class="hljs-attr"><span class="hljs-attr">item</span></span>: type}); } <span class="hljs-comment"><span class="hljs-comment">/** * Shows request dialog */</span></span> script.makeExorcismWithPerson = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uid, money</span></span></span><span class="hljs-function">) </span></span>{ VK.callMethod(<span class="hljs-string"><span class="hljs-string">'showRequestBox'</span></span>, uid, script.i18n(<span class="hljs-string"><span class="hljs-string">'makeExorcismWithPerson'</span></span>, {<span class="hljs-string"><span class="hljs-string">'MONEY_COUNT'</span></span>: money, <span class="hljs-string"><span class="hljs-string">'MONEY_CASES'</span></span>: script.i18n(<span class="hljs-string"><span class="hljs-string">'numeralForms'</span></span>)(money, script.i18n(<span class="hljs-string"><span class="hljs-string">'casesMoney'</span></span>))})); } <span class="hljs-comment"><span class="hljs-comment">/** * Adds callback for event onOrderSuccess */</span></span> script.bindOnOrderSuccess = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callback</span></span></span><span class="hljs-function">) </span></span>{ VK.addCallback(<span class="hljs-string"><span class="hljs-string">'onOrderSuccess'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> callback === <span class="hljs-string"><span class="hljs-string">'function'</span></span>) { callback(); } }); } <span class="hljs-comment"><span class="hljs-comment">//... //Initializes game script.init(); });</span></span></code> </pre><br>  Thus, it is possible to quickly deploy the game in other social networks, replacing API functions for specific cases. <br><br><h4>  The place where I blunted for an hour in the VK API </h4><br>  The code of the startup js file contains examples of calling the two Client API methods: showOrderBox and showRequestBox.  Because of my carelessness and the blurred eye, I missed the point that in the first case, the associative array with parameters is passed to the VK.callMethod method as the second argument, and the second and third arguments are passed to the second argument. <br><br><h3>  Internationalization </h3><br>  In the call code of the showRequestBox method, you can see the use of the method that returns texts for output based on the selected language.  At the moment there is only one interface language in the game, but there is a backlog for the future. <br><br>  The structure is as follows: <br>  The script super-object has the following properties: <br><br>  language - the string in which the two-character name of the current language is stored; <br>  phrases is an object in which two-character keys store objects with phrases in the appropriate language and a function that returns the desired form of a word, depending on the upcoming numeral. <br><br>  Simply set an example: <br><pre> <code class="javascript hljs">script.language = <span class="hljs-string"><span class="hljs-string">'ru'</span></span>; script.phrases = { <span class="hljs-string"><span class="hljs-string">'ru'</span></span>: { <span class="hljs-string"><span class="hljs-string">'numeralForms'</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">number, titles</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cases = [<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> titles[ (number % <span class="hljs-number"><span class="hljs-number">100</span></span> &gt; <span class="hljs-number"><span class="hljs-number">4</span></span> &amp;&amp; number % <span class="hljs-number"><span class="hljs-number">100</span></span> &lt; <span class="hljs-number"><span class="hljs-number">20</span></span>)? <span class="hljs-number"><span class="hljs-number">2</span></span> : cases[(number % <span class="hljs-number"><span class="hljs-number">10</span></span> &lt; <span class="hljs-number"><span class="hljs-number">5</span></span>) ? number % <span class="hljs-number"><span class="hljs-number">10</span></span> : <span class="hljs-number"><span class="hljs-number">5</span></span>] ]; }, <span class="hljs-string"><span class="hljs-string">'ok'</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'makeExorcismWithPerson'</span></span>: <span class="hljs-string"><span class="hljs-string">'    #MONEY_COUNT# #MONEY_CASES#!'</span></span>, <span class="hljs-string"><span class="hljs-string">'casesMoney'</span></span>: [<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>] }, <span class="hljs-string"><span class="hljs-string">'en'</span></span>: { <span class="hljs-string"><span class="hljs-string">'numeralForms'</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">number, titles</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> titles[ (number === <span class="hljs-number"><span class="hljs-number">1</span></span>)? <span class="hljs-number"><span class="hljs-number">0</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span> ]; }, <span class="hljs-string"><span class="hljs-string">'ok'</span></span>: <span class="hljs-string"><span class="hljs-string">'OK'</span></span>, <span class="hljs-string"><span class="hljs-string">'makeExorcismWithPerson'</span></span>: <span class="hljs-string"><span class="hljs-string">'You get #MONEY_COUNT# #MONEY_CASES# for exorcism!'</span></span>, <span class="hljs-string"><span class="hljs-string">'casesMoney'</span></span>: [<span class="hljs-string"><span class="hljs-string">'lightning'</span></span>, <span class="hljs-string"><span class="hljs-string">'lightnings'</span></span>] } };</code> </pre><br>  The script.i18n method, when called, returns the corresponding phrase of the current language or the numeralForms function, if it is set as the first argument.  The second argument can be passed an associative array with templates that will be substituted into the phrase.  Examples: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> money = <span class="hljs-number"><span class="hljs-number">10</span></span>; script.language = <span class="hljs-string"><span class="hljs-string">'ru'</span></span>; script.i18n(<span class="hljs-string"><span class="hljs-string">'ok'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   '' money = 123; script.i18n('makeExorcismWithPerson', {'MONEY_COUNT': money, 'MONEY_CASES': script.i18n('numeralForms')(money, script.i18n('casesMoney'))}); //   '    123 !' money = 1; script.language = 'en'; script.i18n('makeExorcismWithPerson', {'MONEY_COUNT': money, 'MONEY_CASES': script.i18n('numeralForms')(money, script.i18n('casesMoney'))}); //   'You get 1 lightning for exorcism!'</span></span></code> </pre><br><h3>  Monetization </h3><br>  Monetization in the game was implemented as follows: for real money you can buy in-game currency - lightning, for which you can buy hints and crony - transitions to the next level. <br><br><h2>  Launch </h2><br>  The original release date was set for October 31st.  Naturally, the game was not ready for this date.  More precisely, in my opinion, she was not ready.  Highlighting priority from the list of tasks, without which the launch would have been impossible, I began to work actively.  For two weeks I managed to refactor and do everything that was necessary, and on November 16 I submitted an application to host a Vkontakte game for a friendly beta test.  To my surprise, the game was approved about an hour after submitting the application, which I was notified by SMS message.  Having tested the game on comrades for three days, I applied for free placement in the "New Applications" block.  When submitting an application, you need to select the date of placement: the closest date was Monday, November 23 - I chose it. <br><br>  Waking up on the morning of November 23, I first ran to the laptop to make sure that I made a very popular game.  What I saw caused mixed feelings: on the one hand, over the night I had 3000 participants, and on the other, the game did not work.  Quickly assessing the scale of the disaster, I discovered the following: access to the server via ssh could only be obtained via putty, neither Eclipse nor WinSCP connected to the server (and the logs turned out that the connection was established and everything, nothing happened after that) slowly gave statics, and apache, performing php, responded to requests for a long time.  I called a friend of the administrator and asked to see what was the matter, and at the same time he himself climbed up to look at the characteristics of his VPS and the possibility of an upgrade.  Looking at the server, a friend said that the characteristics of the server are sufficient for the described load.  As it turned out, when buying a VPS, I missed the channel width item.  For my tariff plan it was allocated 10 Mbps.  I had to urgently buy and configure a new VPS from another host with a channel of 100 Mbps and transfer the game there.  As a result, due to the need to leave for family matters, this procedure was completed only by the evening of November 23. <br><br>  <b>Tip # 8</b> : <i>check all the characteristics of your hosting / VPS / personal server.</i> <br><br><h3>  New applications </h3><br>  We should also tell about this sponsor of free traffic.  On the application page there is a block ‚ÄúNew applications‚Äù, which shows 4 games per page, sorted in descending order by the date of placement in this block.  Those.  On November 23, my game was first, 24 - second, 25 - third, 26 - fourth, respectively, and 27 was on the second page, which, together with Friday, dramatically reduced the number of clicks on the link.  Subsequently, I twice saw the addition of two applications per day, which suggests that your application may be on the second page in less than four days. <br><br>  <b>Tip # 9</b> : It‚Äôs <i>best to be placed in the New Applications block on Monday to get more participants.</i> <br><br>  <b>Tip number 10</b> : <i>if you watch released after my game, you can conclude that the Vkontakte audience loves games about precious stones and treasures.</i> <br><br><h2>  Numbers </h2><br>  On Habr√© like numbers, I have them. <br><br><h3>  Spent money </h3><br><table><tbody><tr><th>  Name </th><th>  Rubles </th></tr><tr><td>  13 months VPS at two different hosters </td><td>  4240 </td></tr><tr><td>  All graphics </td><td>  61300 </td></tr><tr><td>  Music </td><td>  3780 </td></tr><tr><td>  All advertising </td><td>  700 </td></tr><tr><td>  <b>Total</b> </td><td>  70020 </td></tr></tbody></table><br><h3>  Earned money </h3><br>  109 votes = 317.19 rubles without a contract = 385.86 rubles with a contract = 697.60 rubles for advertising an application without withdrawing votes from Vkontakte. <br><br><h3>  Visitor statistics </h3><br><img src="https://habrastorage.org/files/d5e/b7e/b0e/d5eb7eb0e36a4b86b0f633713c02db44.png"><br><br><h3>  Statistics of installations / deletions of the game </h3><br><img src="https://habrastorage.org/files/651/fc0/739/651fc073949640a895a72d9e51a609e0.png"><br><br><h3>  Statistics of the number of participants </h3><br><img src="https://habrastorage.org/files/cb0/c2b/a39/cb0c2ba39efe40a8973a23c4c98fc741.png"><br><br><h3>  Statistics of game installation sources </h3><br><img src="https://habrastorage.org/files/509/688/02d/50968802d56a49c486074f9c4d313d06.png"><br><img src="https://habrastorage.org/files/b34/c15/4d8/b34c154d8f8c40cc9e3b080d0645f01f.png"><br><br><h3>  Statistics by sex and age of visitors </h3><br><img src="https://habrastorage.org/files/779/aed/fc7/779aedfc7f9743c88f0e8610f6d30091.png"><br><br><h3>  Visitor geography statistics </h3><br><img src="https://habrastorage.org/files/26f/e2b/96a/26fe2b96aa9d4b1c944cb5a7c8e1e009.png"><br><br><h3>  Browser statistics </h3><br><img src="https://habrastorage.org/files/5a3/523/5ba/5a35235bae82400fb5b3e8e662949b89.png"><br><br><h3>  Screen resolution statistics </h3><br><img src="https://habrastorage.org/files/c64/c83/daa/c64c83daa24b4a0e86cb8e1828fea34a.png"><br><br><h2>  Conclusion </h2><br>  Games, and any projects of your own, must be done, because this is not only new knowledge, professional development, pumping engineering, organizational, design skills, but also fun. <br><br>  <b>UPD:</b> after reading the comments I decided to add the article with the following postulates: <br>  1. I know how much money I spent and how much I earned, and I specifically write about it, because such information is rare. <br>  2. What motivated me when creating the game: I love puzzles, I like creating games, I'm tired of the power of the games that pump out money, I want to get a versatile experience. <br>  3. Purpose of the article: to answer some questions that arise for novice developers, and to help cope with various difficulties encountered in the development process. <br>  4. Taking this opportunity, I would like to ask people who have traveled the path of creating a social game to supplement my story with their own examples. </div><p>Source: <a href="https://habr.com/ru/post/272013/">https://habr.com/ru/post/272013/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../272003/index.html">Check Digit by Damme Method</a></li>
<li><a href="../272005/index.html">Swift! Protocol Oriented</a></li>
<li><a href="../272007/index.html">NextCastle Party 2015: how I showed my game</a></li>
<li><a href="../272009/index.html">About the report of Kirill Tolkachev and Alexander Tarasov about microservices on jug.msk.ru</a></li>
<li><a href="../272011/index.html">Six things you need to know about moving WordPress to JavaScript.</a></li>
<li><a href="../272015/index.html">Paranoid job: disaster recovery / continuity plans, meteorite, zombie apocalypse, 1000 cleaners, portal to hell</a></li>
<li><a href="../272017/index.html">SmartTV * - how to create an unsafe device in the modern world</a></li>
<li><a href="../272023/index.html">IBM launched cloud authentication service Identity Mixer</a></li>
<li><a href="../272025/index.html">Java Programmer Cheat Sheet 5. Two hundred and fifty Russian-language training video presentations and lectures on Java</a></li>
<li><a href="../272031/index.html">AllcountJS: Making a system for point of sale (POS)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>