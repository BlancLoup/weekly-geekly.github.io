<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Analytical calculation of the derivative of a function in the Scala language</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 


 This algorithm is implemented in the Scala language, a characteristic feature of which is the use of case classes that are so well su...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Analytical calculation of the derivative of a function in the Scala language</h1><div class="post__text post__text-html js-mediator-article"><h2>  Introduction </h2><br><p>  This algorithm is implemented in the Scala language, a characteristic feature of which is the use of <i>case classes</i> that are so well suited for writing a differentiation algorithm.  In this article, it is planned to describe only a part of the program containing the algorithm for finding the derivative, since the development of a parser for mathematical expressions is another big topic, <br>  worthy of a separate article </p><br><h2>  Training </h2><br><p>  First, we describe the data structure in which the original mathematical function will be stored.  We describe the MathAST <b><i>treit</i></b> : <br><br></p><pre><code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MathAST</span></span></span></span></code> </pre> <br>  And his heirs: <br><a name="habracut"></a><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleToken</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MathAST</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> a: <span class="hljs-type"><span class="hljs-type">MathAST</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DoubleToken</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MathAST</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> a: <span class="hljs-type"><span class="hljs-type">MathAST</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> b: <span class="hljs-type"><span class="hljs-type">MathAST</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LeafToken</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MathAST</span></span></span></span></code> </pre><cut><br>  <b><i>SingleToken</i></b> will implement the case classes of unary operators such as sin (a), -a, ln (a), etc. <br>  <b><i>DoubleToken</i></b> describes binary operators: a + b, a ^ b, etc. <br>  <b><i>LeafToken</i></b> - ‚Äúleaves‚Äù of a tree, i.e.  constants, variables and reserved constant names (pi number and exponent). <br><br>  We describe the classes / objects of operators and tokens: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pi</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LeafToken</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Exponenta</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LeafToken</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sin</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">override val a: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">MathAST</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleToken</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cos</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">override val a: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">MathAST</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleToken</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">‚Ä¶</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mul</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">override val a: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">MathAST</span></span></span></span><span class="hljs-class"><span class="hljs-params">, override val b: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">MathAST</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DoubleToken</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Add</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">override val a: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">MathAST</span></span></span></span><span class="hljs-class"><span class="hljs-params">, override val b: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">MathAST</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DoubleToken</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">‚Ä¶</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Differentiate</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">f: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">MathAST</span></span></span></span><span class="hljs-class"><span class="hljs-params">, dx: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Variable</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MathAST</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Variable</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">name: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LeafToken</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Constant</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">value: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">BigDecimal</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LeafToken</span></span></span></span></code> </pre> <br>  Pay attention to the <b><i>Differentiate</i></b> class, it has a special signature: <b>f</b> is the original function, <b>dx</b> is the variable by which differentiation occurs. <br><br>  Now there is everything to represent a mathematical function in the form of a tree of calculations, for example, let's take a function: <img src="https://habrastorage.org/getpro/habr/post_images/e7d/96c/2b7/e7d96c2b7e80abf089f336e6803340b2.gif" title="f (x) = 2 \ cdot x ^ {2}">  which will take the form: <br><br>  <b>Mul (Constant (BigDecimal (2)), Pow (x, Constant (BigDecimal (2)))</b> <br><br>  Of course, to get a tree expression from a regular string entered by a user, you need to write a parser, but, as mentioned above, this is another topic.  Let <b><i>me</i></b> just say that the program uses a self-made parser that inherits the Parsers <b><i>trait</i></b> from the <b>scala.util.parsing.combinator</b> package. <br><p></p><br><h2>  Algorithm for Finding the Derivative </h2><br><p>  The basis of which are the <a href="http://math-deque.rhcloud.com/articles/index/article_id/tablica_proizvodnih">rules of differentiation and the table of derivatives</a> . <br><br>  We describe a recursive function, which will transform the original mathematical function into the resulting derivative function: <br><br></p><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">differentiate</span></span></span></span>(f: <span class="hljs-type"><span class="hljs-type">MathAST</span></span>)(<span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> dx: <span class="hljs-type"><span class="hljs-type">String</span></span>): <span class="hljs-type"><span class="hljs-type">MathAST</span></span></code> </pre> <br>  The dx argument containing the name of the variable (by which differentiation occurs) is marked as implicit ( <i>implicit</i> ), this will allow not to transfer it to recursive calls, let the compiler do it. <br><br>  The input to the recursive function is an expression - the original function <b>f (x)</b> (in <b><i>MathAST</i></b> format), the return value is a derivative function <a href="https://www.codecogs.com/eqnedit.php%3Flatex%3D%5Cfrac%7B%5Cmathrm%7Bd%7D%26space%3Bf(x)%7D%7B%5Cmathrm%7Bd%7D%26space%3Bx%7D"><img src="https://habrastorage.org/getpro/habr/post_images/08d/284/9d8/08d2849d88a2cb274361121b1a61ef7c.gif" title="\ frac {\ mathrm {d} f (x)} {\ mathrm {d} x}"></a>  in the same format. <br><br>  <b><i>Note 1</i></b> : An expression can be a binary, unary or token. <br>  <b><i>Note 2</i></b> : The operator can be one of: "+", "-", "^", "*", "/", "abs", "sin", "cos", "tg", "ctg", " ln "," arcsin "," arccos "," arctg "," arcctg "," (",") ". <br>  <b><i>Note 3</i></b> : Input and output data are presented in MathAST format - tree-expression. <br><p></p><br><h3>  General algorithm </h3><br><p>  In general, the algorithm is too abstract, so we will analyze it further in more detail. </p><br><ol><li>  The recursive function receives data as input and using pattern matching ( <i>pattern-matching</i> ) performs the necessary actions, depending on the data type. <br><br></li><li>  The function calculates the derivative for the input expression and returns the result expression.  It may happen that the arguments <b>a</b> and / or <b>b</b> turned out to be not a constant or variable, but a complex function <b>u (x)</b> , <br>  then you need to recursively calculate the derivative <b>u '(x)</b> , i.e.  return <b>[differentiate (u (x))]</b> - go to step 1 with new data - <b>u (x)</b> . <br><br></li><li>  If the data is not correct, return an error message. </li></ol><br><h3>  Details of the principle of operation and connection with mathematical abstractions </h3><br><p>  The function took the input data - expression-function, which should be processed in accordance with the rules of differentiation </p><br><h4>  If binary expression </h4><br><p>  Binary expressions are marked with a DoubleToken <b><i>trait</i></b> .  The operator is checked for compliance with one of the available operators ("+", "-", "*", "/", "^"): <br><br></p><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Add</span></span>(a, b) =&gt; <span class="hljs-type"><span class="hljs-type">Add</span></span>(differentiate(a), differentiate(b)) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Sub</span></span>(a, b) =&gt; <span class="hljs-type"><span class="hljs-type">Sub</span></span>(differentiate(a), differentiate(b)) ‚Ä¶</code> </pre><p></p><br><ol><li>  If ‚Äú+‚Äù operator: return <b>[differentiate (a) + differentiate (b)]</b> . <br><br></li><li>  If the ‚Äú-‚Äù operator: return <b>[differentiate (a) - differentiate (b)]</b> . <br><br></li><li>  If the operator "*": Multiplication is a more complicated case, the operands <b>a</b> and <b>b</b> can be constants or variables (4 combinations in total: <b>u (x) * c</b> , <b>u (x) * v (x)</b> , <b>c * c</b> , <b>c * u (x)</b> ). <br>  The function analyzes which of the 4 options has fallen and returns the expression using the differentiation rule No. 1, No. 3, and No. 5, <br>  if one of the operands is a complex function.  For example: if <b>a = u (x)</b> and <b>b = v (x)</b> , then return <b>[differentiate (a) * b + a * differentiate (b))]</b> . <br>  The private <i><b>isDependsOnVar</b></i> method checks whether the subexpression depends on the variable by which differentiation is made. <br><br></li><li>  If the operator "/": Actions are similar, as with the operator "*". <br><br></li><li>  If the exponentiation operator ‚Äú^‚Äù: There are also 4 variants of expressions: <b>u (x) ^ c</b> , <b>u (x) ^ v (x)</b> , <b>c ^ c</b> , <b>c ^ u (x)</b> . <br>  The third case is the most non-trivial: <b>u (x) ^ v (x)</b> , to find the derivative of such an expression, you need to use the logarithm and its properties (the description of the logarithm procedure is beyond the scope of this article, therefore we will immediately give the finished formula - ‚Ññ 6). <br><br>  In the other three cases, standard table formulas are used. </li></ol><br><p>  As an example, we give the processing of the multiplication operation: <br><cut><br></cut></p><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Mul</span></span>(a, b) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> u = isDependsOnVar(a) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> v = isDependsOnVar(b) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (u &amp;&amp; !v) { <span class="hljs-type"><span class="hljs-type">Mul</span></span>(differentiate(a), b) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!u &amp;&amp; v){ <span class="hljs-comment"><span class="hljs-comment">// c^u(x), c=const Mul(a, differentiate(b)) }else if (!u &amp;&amp; !v){ // c^c, c=const Constant(BigDecimal(0)) }else Add(Mul(differentiate(a), b), Mul(a, differentiate(b))) }</span></span></code> </pre> <p></p><br><h4>  If unary expression </h4><br><p>  SingleToken classes are handled as follows: <br><cut><br></cut></p><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> e: <span class="hljs-type"><span class="hljs-type">SingleToken</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> d = e <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Sin</span></span>(x) =&gt; <span class="hljs-type"><span class="hljs-type">Cos</span></span>(x) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Cos</span></span>(x) =&gt; <span class="hljs-type"><span class="hljs-type">Usub</span></span>(<span class="hljs-type"><span class="hljs-type">Sin</span></span>(x)) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Tg</span></span>(x) =&gt; <span class="hljs-type"><span class="hljs-type">Div</span></span>(<span class="hljs-type"><span class="hljs-type">Constant</span></span>(<span class="hljs-type"><span class="hljs-type">BigDecimal</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>)), <span class="hljs-type"><span class="hljs-type">Pow</span></span>(<span class="hljs-type"><span class="hljs-type">Cos</span></span>(x), <span class="hljs-type"><span class="hljs-type">Constant</span></span>(<span class="hljs-type"><span class="hljs-type">BigDecimal</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>)))) ‚Ä¶ } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isLeaf(ea)) d <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-type"><span class="hljs-type">Mul</span></span>(d, differentiate(ea))</code> </pre> <br>  The operator is checked for compliance with one of the available operators ("sin", "-", "cos", ...) <br>  For example, the ‚Äúsin‚Äù operator: return <b>[cos (a)]</b> , if <b>a = x</b> , but if <b>a</b> is a complex function <b>u (x)</b> , then return <b>[cos (a) * differentiate (a)]</b> . <br><br>  With the other operators, similar actions occur, using the rule of differentiation of a complex function and the table rules for taking a derivative. <br><br>  Separately, you should consider <b>abs</b> - module, since it is not in the table. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4cf/e0c/a94/4cfe0ca940ca2212d4fdfeba15bbcbcb.gif" title="(| x |) '= (\ sqrt {x ^ {2}})' = \ left (\ dfrac {x} {| x |} \ right) '"></div><br>  The private <b><i>isLeaf</i></b> method <b><i>finds</i></b> out whether the function is complex or not; in the first case, you must return the current result multiplied by the derivative of the nested function, and in the second case you simply return the current result. <br><p></p><br><h4>  If one token </h4><br><p>  It's about a variable or a constant. <br><br></p><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Variable</span></span>(a) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a == dx) <span class="hljs-type"><span class="hljs-type">Constant</span></span>(<span class="hljs-type"><span class="hljs-type">BigDecimal</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-type"><span class="hljs-type">Constant</span></span>(<span class="hljs-type"><span class="hljs-type">BigDecimal</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Constant</span></span>(a) =&gt; <span class="hljs-type"><span class="hljs-type">Constant</span></span>(<span class="hljs-type"><span class="hljs-type">BigDecimal</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Pi</span></span> | <span class="hljs-type"><span class="hljs-type">Exponenta</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Constant</span></span>(<span class="hljs-type"><span class="hljs-type">BigDecimal</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">AbstractEvaluateException</span></span>(<span class="hljs-string"><span class="hljs-string">"Differentiate: Wrong input data"</span></span>)</code> </pre> <p></p><br><ol><li>  Incorrect data entered, display an error message and exit. </li><li>  If the variable (by which differentiation is performed, for example, <b>x</b> ), return <b>[1]</b> . </li><li>  If constant, return <b>[0]</b> . </li></ol><br><p>  Finally, add the line: <br><br></p><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Differentiate</span></span>(_f, _dx) =&gt; differentiate(_f)(_dx.name)</code> </pre> <br>  This is in case there is an embedded derivative inside the function, i.e.  now higher derivatives can be considered. <br><br>  I will give the whole code of differentiation, for a better understanding: <br><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Derivative</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span></span>(e: <span class="hljs-type"><span class="hljs-type">MathAST</span></span>)(<span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> dx: <span class="hljs-type"><span class="hljs-type">String</span></span>): <span class="hljs-type"><span class="hljs-type">MathAST</span></span> = differentiate(e) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">differentiate</span></span></span></span>(f: <span class="hljs-type"><span class="hljs-type">MathAST</span></span>)(<span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> dx: <span class="hljs-type"><span class="hljs-type">String</span></span>): <span class="hljs-type"><span class="hljs-type">MathAST</span></span> = f <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Differentiate</span></span>(_f, _dx) =&gt; differentiate(_f)(_dx.name) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Add</span></span>(a, b) =&gt; <span class="hljs-type"><span class="hljs-type">Add</span></span>(differentiate(a), differentiate(b)) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Sub</span></span>(a, b) =&gt; <span class="hljs-type"><span class="hljs-type">Sub</span></span>(differentiate(a), differentiate(b)) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Div</span></span>(a, b) =&gt; <span class="hljs-type"><span class="hljs-type">Div</span></span>(<span class="hljs-type"><span class="hljs-type">Sub</span></span>(<span class="hljs-type"><span class="hljs-type">Mul</span></span>(differentiate(a), b), <span class="hljs-type"><span class="hljs-type">Mul</span></span>(a, differentiate(b))), <span class="hljs-type"><span class="hljs-type">Pow</span></span>(b, <span class="hljs-type"><span class="hljs-type">Constant</span></span>(<span class="hljs-type"><span class="hljs-type">BigDecimal</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>)))) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Pow</span></span>(a, b) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> u = isDependsOnVar(a) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> v = isDependsOnVar(b) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (u &amp;&amp; !v) <span class="hljs-type"><span class="hljs-type">Mul</span></span>(<span class="hljs-type"><span class="hljs-type">Mul</span></span>(<span class="hljs-type"><span class="hljs-type">Pow</span></span>(a, <span class="hljs-type"><span class="hljs-type">Sub</span></span>(b, <span class="hljs-type"><span class="hljs-type">Constant</span></span>(<span class="hljs-type"><span class="hljs-type">BigDecimal</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>)))), differentiate(a)), b) <span class="hljs-comment"><span class="hljs-comment">// u(x)^c, c=const else if (!u &amp;&amp; v){ // c^u(x), c=const Mul(Mul(Pow(a, b), differentiate(b)), Ln(a)) }else if(!u &amp;&amp; !v){ Constant(BigDecimal(0)) }else Mul(Pow(a, Sub(b, Constant(BigDecimal(1)))), Add(Mul(b, differentiate(a)), Mul(Mul(a, Ln(a)), differentiate(b)))) } case Mul(a, b) =&gt; { val u = isDependsOnVar(a) val v = isDependsOnVar(b) if (u &amp;&amp; !v) { Mul(differentiate(a), b) } else if (!u &amp;&amp; v){ // c^u(x), c=const Mul(a, differentiate(b)) }else if (!u &amp;&amp; !v){// c^c, c=const Constant(BigDecimal(0)) }else Add(Mul(differentiate(a), b), Mul(a, differentiate(b))) } case e: SingleToken =&gt; val d = e match { case Sin(x) =&gt; Cos(x) case Cos(x) =&gt; Usub(Sin(x)) case Tg(x) =&gt; Div(Constant(BigDecimal(1)), Pow(Cos(x), Constant(BigDecimal(2)))) case Ctg(x) =&gt; Usub(Div(Constant(BigDecimal(1)), Pow(Sin(x), Constant(BigDecimal(2))))) case Abs(x) =&gt; Div(x, Abs(x)) case Ln(x) =&gt; Div(Constant(BigDecimal(1)), x) case Sqrt(x) =&gt; Div(Constant(BigDecimal(1)), Mul(Constant(BigDecimal(2)), Sqrt(x))) case Usub(x) =&gt; Usub(differentiate(x)) case Arcsin(x) =&gt; Div(Constant(BigDecimal(1)), Sqrt(Sub(Constant(BigDecimal(1)), Pow(x, Constant(BigDecimal(2)))))) case Arccos(x) =&gt; Usub(Div(Constant(BigDecimal(1)), Sqrt(Sub(Constant(BigDecimal(1)), Pow(x, Constant(BigDecimal(2))))))) case Arctg(x) =&gt; Div(Constant(BigDecimal(1)), Sub(Constant(BigDecimal(1)), Pow(x, Constant(BigDecimal(2))))) case Arcctg(x) =&gt; Usub(Div(Constant(BigDecimal(1)), Sub(Constant(BigDecimal(1)), Pow(x, Constant(BigDecimal(2)))))) case _ =&gt; throw new AbstractEvaluateException("Differentiate: Unknown unary operator") } if (isLeaf(ea)) d else Mul(d, differentiate(ea)) case Variable(a) =&gt; if (a == dx) Constant(BigDecimal(1)) else Constant(BigDecimal(0)) case Constant(a) =&gt; Constant(BigDecimal(0)) case Pi | Exponenta =&gt; Constant(BigDecimal(0)) case _ =&gt; throw new AbstractEvaluateException("Differentiate: Wrong input data") } private def isLeaf(e: MathAST): Boolean = e match { case Variable(_) | Constant(_) =&gt; true case Pi | Exponenta =&gt; true case _ =&gt; false } private def isDependsOnVar(tree: MathAST)(implicit dx: String): Boolean = tree match{ case e: DoubleToken =&gt; (ea match { case Variable(name) =&gt; if(name == dx) true else false case _ =&gt; isDependsOnVar(ea) })||(eb match { case Variable(name) =&gt; if(name == dx) true else false case _ =&gt; isDependsOnVar(eb) }) case e: SingleToken =&gt; isDependsOnVar(ea) case Variable(name) =&gt; if(name == dx) true else false case _ =&gt; false } }</span></span></code> </pre> <p></p><br><h2>  Conclusion </h2><br><p>  All source code can be downloaded on <a href="https://github.com/mathsatan/MathServiceScala">github</a> , you can test the program online on the <a href="http://math-deque.rhcloud.com/calc">Derivatives Calculator</a> site <a href="http://math-deque.rhcloud.com/calc">online</a> , the application is implemented as a REST service and supplemented with expression simplification modules. </p><br><h3>  Bibliography </h3><br><ul><li>  Mathematical portal ¬´mathprofi.ru¬ª <a href="http://mathprofi.ru/slozhnye_proizvodnye_logarifmicheskaja_proizvodnaja.html">mathprofi.ru/slozhnye_proizvodnye_logarifmicheskaja_proizvodnaja.html</a> </li><li>  Odersky M. ‚ÄúProgramming in Scala (second edition)‚Äù </li><li>  Hostmann K. "Scala for the impatient" </li></ul></cut></div><p>Source: <a href="https://habr.com/ru/post/309676/">https://habr.com/ru/post/309676/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../309666/index.html">IBM Watson got the job of a weather scientist</a></li>
<li><a href="../309668/index.html">How to become a designer. The main mistake and the necessary skills. Personal experience of employees Mail.Ru Group, Badoo, Trood</a></li>
<li><a href="../309670/index.html">Kotlin and autoboxing</a></li>
<li><a href="../309672/index.html">Write everything down</a></li>
<li><a href="../309674/index.html">Calculating 1,000,000 characters of Pi. On iphone</a></li>
<li><a href="../309678/index.html">Scaling text in a block using jQuery</a></li>
<li><a href="../309684/index.html">Internet marketing for a network of fitness centers: the realities of today</a></li>
<li><a href="../309686/index.html">Blockchain as a ‚Äúmagic tablet‚Äù?</a></li>
<li><a href="../309688/index.html">Secrets of the effective management of data centers around the world: from Tokyo to St. Louis, from Sydney to London</a></li>
<li><a href="../309694/index.html">Intel and Hewlett Packard have released a security alert for a ThinkPwn vulnerability</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>