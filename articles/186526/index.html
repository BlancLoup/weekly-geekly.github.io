<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Multi-file storage of Java objects in xml format (part 2)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The first post on the topic: Multi-file storage of Java objects in xml format (part 1) 

 Introduction 
 Since a lot of time has passed and the librar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Multi-file storage of Java objects in xml format (part 2)</h1><div class="post__text post__text-html js-mediator-article">  The first post on the topic: <a href="http://habrahabr.ru/post/185890/">Multi-file storage of Java objects in xml format (part 1)</a> <br><br><h4>  Introduction </h4><br>  Since a lot of time has passed and the library has changed, I decided to continue the description and highlight some points.  Many thanks to users for constructive criticism, which I hope helped to improve usability. <br>  The first thing I would like to note is that the group of methods for working with root objects has been removed from the main XmlDataStore front class.  Now the division of objects into root and others is absent. <br><br><h4>  IXmlDataStoreIdentifiable interface </h4><br>  Since, when discussing the first version, it was correctly noticed that the getId () and setId () methods can be used by data model developers for some of their own purposes and they will not necessarily work with the java.lang.String type, the method name has changed to getDataStoreId () and setDataStoreId ().  And the interface accordingly looks like this: <br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IXmlDataStoreIdentifiable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataStoreId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDataStoreId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String dataStoreId)</span></span></span></span>; }</code> </pre> <br>  An abstract class has also been added that implements this interface: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractXmlDataStoreIdentifiable</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IXmlDataStoreIdentifiable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String dataStoreId; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataStoreId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dataStoreId; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDataStoreId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String dataStoreId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dataStoreId = dataStoreId; } }</code> </pre><br>  It is possible to inherit from both the interface and the abstract class. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><h4>  File format </h4><br>  The library introduced the ability to change the file format of objects to any other.  This is done using a factory that should provide the writer and reader. <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IXmlDataStoreIOFactory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">IXmlDataStoreObjectsReader </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newInstanceReader</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Map&lt;Class&lt;? extends IXmlDataStoreIdentifiable&gt;, XmlDataStorePolicy&gt; policies)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">IXmlDataStoreObjectsWriter </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newInstanceWriter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Map&lt;Class&lt;? extends IXmlDataStoreIdentifiable&gt;, XmlDataStorePolicy&gt; policies)</span></span></span></span>; }</code> </pre><br>  It is clearly seen that the parameter of each of the methods is the storage policies map, so that the implementers of the writer and reader can determine the type of object storage and save individual objects as simple links.  Interfaces are as follows: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IXmlDataStoreObjectsWriter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeReferences</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Writer writer, Collection&lt;IXmlDataStoreIdentifiable&gt; references)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> XmlDataStoreIOException</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeObjects</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Writer writer, Collection&lt;IXmlDataStoreIdentifiable&gt; objects)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> XmlDataStoreIOException</span></span>; }</code> </pre><br>  The class writer must implement two methods: <br>  1) a method to serialize writeReferences (); <br>  2) a method for serializing writeObjects () objects. <br>  Moreover, in the event of any errors in the execution of these methods, they should throw an exception of type XmlDataStoreIOException. <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IXmlDataStoreObjectsReader</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">Collection&lt;IXmlDataStoreIdentifiable&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readReferences</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Reader reader)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> XmlDataStoreIOException</span></span>; <span class="hljs-function"><span class="hljs-function">Collection&lt;IXmlDataStoreIdentifiable&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readObjects</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Reader reader)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> XmlDataStoreIOException</span></span>; }</code> </pre><br>  The reader interface is symmetrical and defines methods for deserializing links and objects. <br><br><h4>  Sampling objects by different fields </h4><br>  Since the first version did not provide the ability to select objects from different fields, this feature was implemented in later versions via the IXmlDataStorePredicate interface. <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IXmlDataStorePredicate</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IXmlDataStoreIdentifiable</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">passed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T object)</span></span></span></span>; }</code> </pre><br>  The passed () method must return true if the object is to be included in the result set.  And in the XmlDataStore class the following method is implemented: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;T extends IXmlDataStoreIdentifiable&gt; <span class="hljs-function"><span class="hljs-function">Map&lt;String, T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadObjects</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Class&lt;T&gt; cl, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IXmlDataStorePredicate&lt;T&gt; predicate)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> XmlDataStoreReadException</span></span></code> </pre><br><br><h4>  Fragmentation </h4><br>  As mentioned in the previous article: ‚ÄúFragmentation means breaking up a single file (the ClassObjectsFile policy) into fragments containing a limited number of objects, and the index in this case will contain links indicating the fragment file in which the object is stored.‚Äù  To use or not to use fragmentation is configured during storage initialization, by simply specifying the fragment size in the number of objects in the constructor. <br>  I would like to note in advance that during fragmentation it is undesirable to set a large number of objects, since only one transaction can make changes within one fragment, the rest will be refused until the transaction that started the change is accepted or rolled back. <br>  I really do not like this moment, so in the next implementation, it will most likely be reworked. <br><br><h4>  Triggers </h4><br>  Triggers are added to the latest version of the library; they are executed as part of the transaction in which the object was modified, added or deleted.  The trigger is called after the transaction data on the modified object has been received, but until the moment when the data will be written to the disk.  Therefore, inside the trigger, additional processing of the obtained object is allowed and it is highly undesirable to modify objects of other classes (that is, objects stored in another resource object), since they may already be flushed to disk.  The trigger interface is as follows: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IXmlDataStoreTrigger</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IXmlDataStoreIdentifiable</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-function">XmlDataStoreTriggerType </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">Class&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getClazz</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">perform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T object)</span></span></span></span>; }</code> </pre><br>  The getType () method should return the type of operation after which the trigger should be called (add, change, or delete an object).  The getClazz () method determines the class of objects to which the trigger is configured.  And the perform (T object) method to perform some operations on the received object.  Modification of the received object is allowed. <br><br><h4>  Afterword </h4><br>  The latest release of xdstore-1.5 is a stable and streamlined version of the repository, which can already be used.  The interface will not change anymore.  The following changes will concern only the internal optimization hidden from the user. <br>  Therefore, if you have a need and / or desire to use, then you are <a href="">welcome</a> : <a href="">xdstore-1.5</a> . <br><br>  <u>Author: Beschastny Evgeny</u> </div><p>Source: <a href="https://habr.com/ru/post/186526/">https://habr.com/ru/post/186526/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../186512/index.html">End of an era, melancholy</a></li>
<li><a href="../186518/index.html">How well do you know the standard library?</a></li>
<li><a href="../186520/index.html">Haxe + OpenFL: even my grandmother can make a game under iOS!</a></li>
<li><a href="../186522/index.html">Microsoft has accused US customs of conspiring with Google</a></li>
<li><a href="../186524/index.html">Startup "From scratch" 2, my experience in finding the SRT of a startup co-founder, from hell to heaven</a></li>
<li><a href="../186528/index.html">Configuration profiles in OS X. SCEP requests and getting VPN settings</a></li>
<li><a href="../186530/index.html">Protection against listening to SIP using - TLS + SRTP + encrypted tunnel and Yealink T26p phone</a></li>
<li><a href="../186532/index.html">Interactive Globe - SVG versus Canvas</a></li>
<li><a href="../186534/index.html">Veeam Backup & Replication: tips and tricks. Part 2</a></li>
<li><a href="../186536/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ65 (July 7 - 13, 2013)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>