<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Adaptation of the project MR under HoloLens</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the end of our series of articles on Windows Mixed Reality. In it, we developed from scratch an application with mixed reality on Unity in the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Adaptation of the project MR under HoloLens</h1><div class="post__text post__text-html js-mediator-article">  This is the end of our series of articles on Windows Mixed Reality.  In it, we developed from scratch an application with mixed reality on Unity in the lab work format.  Today is the final chord in which we will talk about a very interesting topic - about HoloLens and the adaptation of the project for this device.  Join now! <br><br><img src="https://habrastorage.org/webt/7l/qn/el/7lqnelncue7h3vwfqqxkqerm4u8.jpeg"><a name="habracut"></a><br><br><blockquote>  The entire manual will consist of 5 parts.  It will be updated every week.  Below you can go to the part you need. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Part 1:</b> <a href="https://habr.com/company/microsoft/blog/418655/">Export a UWP for Windows Mixed Reality application from Unity</a> ; <br>  <b>Part 2:</b> <a href="https://habr.com/company/microsoft/blog/418657/">Setting up the environment (VR)</a> ; <br>  <b>Part 3:</b> <a href="https://habr.com/company/microsoft/blog/418661/">Controllers</a> ; <br>  <b>Part 4:</b> <a href="https://habr.com/company/microsoft/blog/418663/">Spatial sound</a> ; <br>  <b>Part 5:</b> <a href="https://habr.com/company/microsoft/blog/418665/">HoloLens and graphics</a> . </blockquote><br><h2>  Hololens </h2><br>  So far, our application works only with an immersive headset.  However, having made only a few changes to the application, we can implement support for the entire range of Mixed Reality devices (including HoloLens). <br><br>  Since we used the Mixed Reality Toolkit to control the camera, implement the interaction, and add buttons, we need to make a few changes to the project. <br><br><h4>  Hiding a virtual room </h4><br>  We need to write a script that would determine on which device our application runs - on an immersive headset or on a HoloLens device.  If the application runs on a HoloLens device, we need to hide the virtual room so that the user can interact with the real environment.  To do this, we first add the Tag element to the RoomPrefab prefab, and then we will access this tag in our script. <br><br>  1. Select the RoomPrefab prefab in the Hierarchy panel. <br><br>  2. In the Inspector pane, in the Tag drop-down list, select Add Tag ... (Add Tag ...). <br><br><img src="https://habrastorage.org/webt/qk/48/-o/qk48-otwilnhukhdowcvhdavqii.png"><br><br>  3. Click the ‚Äú+‚Äù icon to create a new tag, and give this tag the name HMDUOnly. <br><br><img src="https://habrastorage.org/webt/r7/yx/11/r7yx11_dfmnofazlnqssj3rgiog.png"><br><br>  4. Now again click the RoomPrefab prefab in the Hierarchy panel and select the HMDUOnly tag from the Tag drop-down menu in the Inspector panel. <br><br>  You can select game objects in the script in <a href="https://docs.unity3d.com/Manual/ControllingGameObjectsComponents.html">various ways</a> .  We can add a tag to any object that needs to be hidden (if we have several objects), and then sequentially hide each of them.  Calling the FindGameObjectsWithTag method is not the best way, but it is quite suitable for us. <br><br>  5. In the top Unity menu, select GameObject -&gt; Create Empty (Game Object -&gt; Create Empty). <br><br>  6. In the Hierarchy panel, change the name of the added empty GameObject object to GameManager. <br><br>  7. In the Inspector panel, click Add Component -&gt; New Script (Add Component -&gt; New Script) and give this script the name GameManager, choosing C sharp as the programming language.  Click Create and Add to create a script. <br><br>  8. To open the GameManager script, double-click it in the Inspector panel or the Assets panel. <br><br>  9. Replace the GameManager script code with the code below.  This test needs to be performed only once, when the application starts.  We will execute it inside the Start () function, and we will remove the Update () function. <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-comment"><span class="hljs-comment">// We need the UnityEngine.XR.WSA namespace to access Holographic Settings which contain // functions which effect the performance and presentation of Holograms on Windows // Holographic platforms. using UnityEngine.XR.WSA; public class GameManager : MonoBehaviour { void Start () { // Check if the MR headset display is transparent (not opaque). if(!HolographicSettings.IsDisplayOpaque){ // If that is the case, then we need to hide the virtual living room GameObject[] HMDUOnlyObjects = GameObject.FindGameObjectsWithTag("HMDUOnly"); for (int i = 0; i &lt; HMDUOnlyObjects.Length; i++){ // Set active to false disables the object. HMDUOnlyObjects[i].SetActive(false); } } } }</span></span></code> </pre> <br>  Finally, to ensure proper operation of the application on the HoloLens device, we must turn the background of the camera black. <br><br>  10. In the Hierarchy panel, select the MixedRealityCameraParent-&gt; MixedRealityCamera object.  Scroll down the Inspector panel and select black as the value of the Mixed Reality Camera Manager -&gt; Transparent Display Settings -&gt; Background Color option -&gt; Mixed Reality -&gt; Transparent Display Settings -&gt; Background Color). <br><br><img src="https://habrastorage.org/webt/n0/gh/qc/n0ghqcj63thf4zmn62uld9iu6pc.png"><br><br><h4>  Adding Spatial Mapping </h4><br>  Almost everything is ready!  Now we need to enable <a href="https://docs.microsoft.com/windows/mixed-reality/spatial-mapping">spatial mapping</a> .  The space mapping technology provides a detailed view of the physical surfaces in the HoloLens environment, allowing developers to create impressively realistic applications of mixed reality.  In our case, spatial mapping will allow the user to place the speakers in a natural way so that they are not obscured by physical surfaces. <br><br>  To begin with, we will ensure that the controls of the Bounding Box object (bounding box) that are responsible for moving and rotating are not hidden. <br><br>  1. Find the AppBarCustom Prefab in the Assets -&gt; Prefabs folder (Resources -&gt; Prefabs) in the Project panel. <br><br>  2. Set the value of 0 for the Hover Offset Y Scale property (Y-axis offset when hovering). <br><br><img src="https://habrastorage.org/webt/bv/tg/u8/bvtgu8gsj2xo8sg7n_ltnynmkgy.png"><br><br>  Now let's add spatial mapping components to the scene. <br><br>  3. Find the SpatialMapping prefab in the Assets -&gt; HoloTookit -&gt; SpatialMapping -&gt; Prefabs folder (Resources -&gt; HoloTookit -&gt; Spatial mapping -&gt; Prefabs). <br><br>  4. Drag it to the Hierarchy panel of our scene. <br><br><img src="https://habrastorage.org/webt/pu/gp/k3/pugpk3-irjbq5_tmpvbex8pcthg.png"><br><br><h4>  HoloLens gestures </h4><br>  Until now, all types of interaction in our application were carried out using motion controllers.  If the application will run on the HoloLens device (or its emulator), we need to use another way to move the speaker and switch to it in the program code.  The BoundingBox method can also be reused for HoloLens, but we want to optimize the interaction by making a few changes. <br><br>  1. Select the Speaker prefab in the Project panel. <br><br>  2. Click Add Component -&gt; Tap To Place (Add Component -&gt; Touch Placement).  This is the script for the HoloLens from the MR Toolkit kit, allowing the user to touch objects or holograms and easily move them in space. <br><br>  3. Disable it so that it does not start by default.  To disable a script, simply uncheck the box next to its name in the Inspector panel.  This component will also add an Interpolator script to the Speaker Prefab. <br><br><img src="https://habrastorage.org/webt/fu/od/db/fuoddb8y3g7lu_bmbd86dugvcrk.png"><br><br>  4. Add a script to the Speaker prefab by selecting the Add Component -&gt; New Script command, and name this script SpeakerMovement. <br><br>  5. Edit the script ‚Äî double-click it and replace the script code with the code below. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine.XR.WSA; <span class="hljs-comment"><span class="hljs-comment">// namespace for the TwoHandManipulatable script using HoloToolkit.Unity.InputModule.Utilities.Interactions; // namespace for the TapToPlace script using HoloToolkit.Unity.SpatialMapping; public class SpeakerMovement : MonoBehaviour { void Start () { if(!HolographicSettings.IsDisplayOpaque){ GetComponent&lt;TwoHandManipulatable&gt;().enabled = false; GetComponent&lt;TapToPlace&gt;().enabled = true; } } }</span></span></code> </pre> <br>  After specifying the namespace for the scripts used, we will use the same test that was used in the GameManager script to hide the room.  This time, when a HoloLens device is detected, the test will disable one script and enable another.  Since we changed the Speaker prefab, this change will affect all speakers in the scene.  If you have changed one of the instances of the Speaker prefab, in the upper right corner of the Inspector panel, click Apply to update this prefab. <br><br>  Done!  Now you can build the app and run it on an immersive headset or HoloLens device, and then place the speakers anywhere in the room, rotate and control them. <br><br><h2>  Graphics (optional) </h2><br>  Let's see how you can improve the visual aspect of our application, because even a small improvement can significantly change its perception.  If you want to learn how to easily make the application even more attractive, you can use the instructions below. <br><br><h4>  Adding a custom skybox </h4><br>  1. In the top menu, select Window -&gt; Lighting -&gt; Settings (Window -&gt; Lighting -&gt; Parameters). <br><br>  2. Drag the Cloudymorning.mat skybox from the Assets -&gt; Textures folder (Resources -&gt; Textures) to the Skybox Material property. <br><br><h4>  Post processing </h4><br>  Note.  The following actions can be performed for any camera scene, but they can not be viewed in the editor. <br><br>  1. Select the MixedRealityCameraParent -&gt; MixedRealityCamera item in the Hierarchy panel of the scene. <br><br>  2. Click Add Component -&gt; Post Processing Behavior (Add Component -&gt; Post Processing Behavior). <br><br>  3. Find the CustomProfile.asset element in the Assets -&gt; PostProcessing folder (Resources -&gt; Postprocessing) and drag it to the Profile property of the Post Processing Behavior script (Postprocessing behavior). <br><br>  Experiment with the postprocessing profile as you need, but remember that <a href="https://docs.unity3d.com/Manual/PostProcessing-Stack.html">postprocessing consumes resources</a> . <br><br>  Congratulations!  You have completed this practice. <br><br>  <a href="https://docs.microsoft.com/en-us/labs/insiderdevtour2018/mixedreality/">Original</a> <br>  Authors: Eric Ahlstrom, cbarkerms, Madison Hight </div><p>Source: <a href="https://habr.com/ru/post/418665/">https://habr.com/ru/post/418665/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../418655/index.html">Windows Mixed Reality: Developer Guide (Part 1)</a></li>
<li><a href="../418657/index.html">Available mixed reality: how to create a virtual space</a></li>
<li><a href="../418659/index.html">Discover Quantum Programming with Quantum Katas</a></li>
<li><a href="../418661/index.html">Development of mixed reality: did you put the speaker in the virtual living room?</a></li>
<li><a href="../418663/index.html">How sound is created for another reality</a></li>
<li><a href="../418667/index.html">Benchmarking HDFS 3 with HDFS 2</a></li>
<li><a href="../418669/index.html">Security Week 28: NetSpectre, attack on third-party channels through a network</a></li>
<li><a href="../418673/index.html">Why the ERP market is growing: statistics and trends</a></li>
<li><a href="../418675/index.html">How I went to Droidcon Berlin</a></li>
<li><a href="../418677/index.html">The whole truth about the RTOS. Article # 6. Other RTOS services</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>