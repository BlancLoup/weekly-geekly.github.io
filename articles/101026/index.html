<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating backups remotely using ssh, scp, tcl. Several ways</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Backups are a necessary thing. Especially you understand this when the law of meanness works and despite many precautionary moments, information is lo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating backups remotely using ssh, scp, tcl. Several ways</h1><div class="post__text post__text-html js-mediator-article">  Backups are a necessary thing.  Especially you understand this when the law of meanness works and despite many precautionary moments, information is lost, which can take a long time to restore if there are no backups. <br>  This article is primarily for programmers, but it is also possible that administrators will get some useful information for themselves. <br>  The task is that we have one or several servers, on which there is frequently updated information.  This information needs to be periodically backed up on some one "main" server.  To do this, we will write a script that we place on the main server, which will automatically connect to each server to create backups there, archive them and copy backup archives to the main server using the SCP secure copy protocol. <br>  And so on to our scripts. <br><a name="habracut"></a><br><h4>  First method </h4><br>  This is a bash (shell) script - uses the principle of remote passwordless entry by key, using SSH (via ssh-id).  How to configure such a connection, you can read in <a href="http://habrahabr.ru/blogs/linux/74199/">this</a> article <br><br>  <b>Our first script:</b> <br><br> <code>#!/bin/bash <br> <br> DST_IPADDR=91.214.132.14 <br> DST_LOGIN=root <br> <br> BACKUPDIRS="/home/test1 /home/test2" <br> TMPDIR="/home/" <br> timestamp=`date "+%Y_%m_%d"` <br> <br> err() { echo -e "* Error: $1"; exit 1; } <br> <br> ssh $DST_LOGIN@$DST_IPADDR 'tar -zcvf '$TMPDIR$DST_IPADDR'_'$timestamp'.tar.gz '$BACKUPDIRS || err "Remote connection failed" <br> scp $DST_LOGIN@$DST_IPADDR:${TMPDIR}${DST_IPADDR}_${timestamp}.tar.gz ./ <br> ssh $DST_LOGIN@$DST_IPADDR 'rm -f '$TMPDIR$DST_IPADDR'_'$timestamp'.tar.gz' || err "Remote connection failed"</code> <br> <br>  This script connects via ssh to a remote server, creates a backup, overwrites it to the main server and then deletes the created backup on the remote server. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Second method </h4><br>  It works on this principle - remote connection to the server using the TCL language. <br>  It can be used when for some reason it is not possible to create a password-free login (by key) using SSH. <br>  There is already required login data not only for the remote server, but also for the main server, for the subsequent copying of the backup to the main server <br><br>  <b>Our second script:</b> <br><br> <code>#!/usr/bin/expect -f <br> set timeout 100 <br> set SELFPASS "mypassword" <br> set SELFUSER "root" <br> set SELFIP "91.214.132.13" <br> set SELFDIR "/home/backup5" <br> <br> set PASS "remotepassword" <br> set USER "root" <br> set IPSERV "91.214.132.14" <br> set BackupDirectories "/home/test1 /home/test2" <br> set TMPDIR "/home/backup5" <br> <br> spawn ssh $USER@$IPSERV <br> expect "assword:" <br> send "$PASS\r" <br> expect "#" <br> send "tar -zcvf $TMPDIR/backup.tar.gz $BackupDirectories\r" <br> expect "#" <br> send "scp -r $TMPDIR/backup.tar.gz $SELFUSER@$SELFIP:$SELFDIR/\r" <br> expect { <br> -re ".*Are.*.*yes.*no.*" { <br> send "yes\r" <br> exp_continue <br> #look for the password prompt <br> } <br> "assword:" { <br> send "$SELFPASS\r" <br> #he expect command will now return <br> } <br> } <br> <br> send "exit;\r" <br> expect eof <br></code> <br><br>  This script connects to a remote server using the tcl language, and the command (method) expect is a step-by-step method for executing an algorithm with waiting for a response from a remote server.  Next, create a backup and copy it to the main server using the same scp protocol.  This script requires more thorough debugging and setting up additional tcl (expect) packages on the servers.  But it is still interesting in its performance.  in general, shows additional features of remote work with servers. <br><br>  These scripts can also be improved.  Add for example the creation of database backups (done in 1 line), also so that the script creates backups from several different servers automatically (sequentially), etc. This is according to your desire.  It is also worth registering the launch of this script using crown so that backups are created automatically after a certain time. <br><br>  PS I wish to always have a fresh backup! </div><p>Source: <a href="https://habr.com/ru/post/101026/">https://habr.com/ru/post/101026/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../101018/index.html">As we drove to look at the rally electric cars</a></li>
<li><a href="../101020/index.html">In the footsteps of intelligence</a></li>
<li><a href="../101021/index.html">A revolution is ripening in Belarus ... IT shnaya</a></li>
<li><a href="../101022/index.html">Import contacts to HTC Wildfire via Bluetooth</a></li>
<li><a href="../101024/index.html">Is Google going to close google wave?</a></li>
<li><a href="../101028/index.html">Live frame model of a motorcycle</a></li>
<li><a href="../101029/index.html">The cheapest coworking in Moscow</a></li>
<li><a href="../101030/index.html">Internet Explorer Platform Preview 4. Overview</a></li>
<li><a href="../101034/index.html">Web Scraping and .Net</a></li>
<li><a href="../101040/index.html">The art of programming under Unix (and not only). Part One, "the rule of modularity"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>