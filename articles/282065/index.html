<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How it is made: mobile cross-platform engine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For you, I have prepared a series of articles about mobile game development, based on the experience gained and the past rake. The first article focus...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How it is made: mobile cross-platform engine</h1><div class="post__text post__text-html js-mediator-article">  For you, I have prepared a series of articles about mobile game development, based on the experience gained and the past rake.  The first article focuses on creating your own cross-platform engine for mobile games.  In truth, not only mobile, and not just games. <br><img src="https://habrastorage.org/files/fa1/cf8/d1d/fa1cf8d1d6914ef0ad3abf8801cb5fe6.jpg"><br><a name="habracut"></a><br><h3>  Content </h3><br>  Part 1. Mobile cross-platform engine <br>  Part 2. <a href="https://habrahabr.ru/post/282191/">Rendering UTF-8 text using an SDF font</a> <br>  Part 3. <a href="https://habrahabr.ru/post/282590/">Rendering drops with transparency and reflections.</a> <br><hr><br><h2>  <font color="#265b82">Do you need your own engine at all?</font> </h2><br>  Every time another popular engine becomes free or open, I ask myself this question.  Let's look at the pros and cons: <br><br>  <b><font color="#007700">pros</font></b> <br><br><ul><li>  You always know how your projects work inside, and most importantly, you can influence their work as you wish.  You do not need to storm the developer forums with requests to add the functionality you need or fix old bugs. </li><li>  You will be able to independently add support for new platforms and add new third-party SDKs. </li><li>  You will be able to use any data storage formats convenient for you (graphics, sounds, resources). </li><li>  You are not limited to any licenses. </li></ul><br>  <b><font color="#aa0000">Minuses</font></b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  You will have to write everything yourself, as well as delve into all the nuances of each platform.  This process will take quite a lot of time, so you shouldn‚Äôt do it just ‚Äúfor the sake of interest‚Äù.  Another thing, if you do a game-dev professionally and plan to release quite a lot of games.  Practice shows that most game studios sooner or later create their own SDK. </li><li>  If you make custom projects, not all customers are happy with your samopisny solutions.  After all, it is possible to support the project will have a completely different people. </li><li>  Many popular engines have built-in visual 2D / 3D editors.  You can argue about their convenience for a long time, but initially you will not have that either. </li></ul><br>  Of course, everyone will see their own pros and cons.  My job is to warn.  Go! <br><br><h2>  <font color="#265b82">What is it made of?</font> </h2><br>  We are talking primarily about the development of mobile games, so the basis will be uniquely on <b>C ++ / OpenGL</b> .  No options!  However, without secondary languages, too, can not do.  Let's see what is used on each platform: <br><table><tbody><tr><td>  <b>Platform</b> </td><td>  <b>The foundation</b> </td><td>  <b>Wrapper</b> </td><td>  <b>Graphics</b> </td></tr><tr><td>  iOS </td><td>  C ++ </td><td>  ObjectiveC or Swift </td><td>  Opengl </td></tr><tr><td>  Android </td><td>  C ++ (NDK) </td><td>  Java </td><td>  Opengl </td></tr><tr><td>  Windowsphone </td><td>  C ++ </td><td>  C # </td><td>  OpenGL via Wrapper or DirectX </td></tr><tr><td>  tvOS (AppleTV) </td><td>  C ++ </td><td>  ObjectiveC or Swift </td><td>  Opengl </td></tr><tr><td>  Osx </td><td>  C ++ </td><td>  ObjectiveC or Swift </td><td>  Opengl </td></tr><tr><td>  Linux </td><td>  C ++ </td><td>  C ++ </td><td>  Opengl </td></tr></tbody></table>  As you can see, C ++ and OpenGL are everywhere.  On ObjectiveC / Java / C # you will have to write only a wrapper for working with the system of the device.  The very same code of your projects will be the same - in C ++.  On this note, we say: "Goodbye, painful porting!". <br><br><h4>  Opengl </h4><br>  I strongly recommend using OpenGL 2.0 and higher.  The time of OpenGL 1.1 is long past, and the transition from 1.x to 2.x will be remembered in nightmares.  However, do not rush to use the latest version of OpenGL without making sure that all target platforms support it.  In most cases, OpenGL 2.0 is enough and all platforms support it. <br><br><h4>  C ++ </h4><br>  The same situation with C ++ 11/14.  If you are sure that all compilers are friends with him - super.  I also have C ++ 98, so when adding a new platform - and there are plans to support consoles - I will be calm. <br><br><h4>  IDE </h4><br><img height="50" src="https://habrastorage.org/files/8f5/280/ff6/8f5280ff627441b6a3d5596601e2909f.png">  <b>Xcode</b> - for iOS, OSX, tvOS.  Plugins through <a href="https://cocoapods.org/">CocoaPods</a> . <br><img height="50" src="https://habrastorage.org/files/eaf/462/03a/eaf46203a8cd4d9ba333d0c1cddadf01.png">  <b>Android Studio</b> - for Android.  Plugins via <a href="http://gradle.org/getting-started-android/">Gradle</a> . <br><img height="50" src="https://habrastorage.org/files/aa1/267/987/aa126798741547529c2b86c11922cc80.png">  <b>Visual Studio</b> is all under Windows. <br><br><h2>  <font color="#265b82">Engine structure</font> </h2><br>  First of all, the engine and projects should be carefully and logically stored on disk.  As a result, I came to this structure: <br><br><ul><li>  <b>Engine</b> (all that concerns the engine) <br><ul><li>  <b>Classes</b> (.h, .cpp engine files) </li><li>  <b>Modules</b> (modules and third-party SDKs that are not needed in all projects) <br><ul><li>  Promotional SDK </li><li>  Analytics </li><li>  Game center </li><li>  Images </li><li>  Social networks </li><li>  ‚Ä¶ etc. </li></ul></li><li>  <b>Platforms</b> (platform specific classes) <br><ul><li>  Android </li><li>  iOS </li><li>  Osx </li><li>  tvOS </li><li>  ... other platforms </li></ul></li></ul><br></li><li>  <b>Test project</b> <br><ul><li>  <b>iOS</b> <br><ul><li>  Project.xcworkspace </li><li>  Icons (application icons, * auto - the project builder fills these folders) </li><li>  Launch (pictures when starting the application, * auto) </li><li>  Res (application resources ready, * auto) </li><li>  Pods </li><li>  ... other project ios files, plist, build, etc. </li></ul></li><li>  <b>Android, OSX, tvOS</b> ... the same for the meaning of the folder for different platforms and IDE.  For Android Studio has its own project structure. </li><li>  <b>Assets</b> <br><ul><li>  Icons (application icons of all sizes) </li><li>  Launch (Lunch Screens of all sizes) </li></ul></li><li>  <b>Resources</b> (originals of project resources) <br><ul><li>  General (core resources for all platforms) </li><li>  Lang (fonts and localization) <br><ul><li>  Fonts (folder with SDF fonts) </li><li>  Lang.xls (translation file) </li></ul></li><li>  Platform (platform specific resources) <br><ul><li>  iOS </li><li>  Android </li><li>  ... other platforms </li></ul></li><li>  Shaders (shaders) </li><li>  Sounds <br><ul><li>  MP3 (for tracks) </li><li>  OGG (for sounds) </li></ul></li><li>  Textures (texture format resources) <br><ul><li>  ATI </li><li>  Etc </li><li>  PVRTC </li><li>  S3tc </li></ul></li></ul></li><li>  <b>Source</b> (.h, .cpp files of the project itself) </li><li>  <b>Config</b> (project configuration file for collector) </li></ul></li></ul><br><h2>  <font color="#265b82">Project builder</font> </h2><br>  The project builder is responsible for preparing resources, formats, and packaging.  Namely: <br><ul><li>  Takes icons (or even one icon of maximum size 1024x1024) from Assets / Icons, makes other dimensions (from 16x16 to 1024x1024) and copies to folders by platform [Platform] / Icons </li><li>  It also comes with start screens from Assets / Launch </li><li>  Takes application resources from the following folders: <br><ul><li>  Resources / General </li><li>  Resources / Shaders </li><li>  Resources / Sounds / MP3, OGG </li><li>  Resources / Textures / [desired texture format] </li><li>  Resources / Platform / [platform] </li><li>  Resources / Lang / Fonts </li></ul></li></ul>  Next, the collector converts resources, encrypts, packages, and places them in [Platform] / Res. <br><br>  The most important thing here is the conversion of files by extension.  I use such conversions: <br><ul><li>  <b>PNG</b> and <b>JPEG are</b> converted to WEBP.  General conversion settings (for example, minimum quality) can be made into the Project / Config project settings, or you can specify it directly in the file name. <br><blockquote>  For example, <b>image ~ q100.png</b> will be compressed with the quality 100 parameter, and <b>image ~ less.png</b> will be compressed without loss of quality. </blockquote>  Presets are also well proven. <blockquote>  For example, the 1st preset will be applied to <b>image ~ p1.png</b> , which will flip the image mirror and save with a quality of 90%. </blockquote></li><li>  <b>Text files</b> and <b>shaders</b> (.txt, .vs, .ps) are encrypted in a simple way.  Simple protection from curious. </li><li>  The <b>localization</b> file Resources / Lang / Lang.xls is parsed by language, encrypted and packaged in a binary format. </li><li>  <b>Texture atlases</b> are created on the fly.  For example, from a folder named folder ~ atlas, all the pictures will be taken and packed into a single picture + the file with the coordinates will be saved. </li><li>  <b>Sounds are</b> converted to OGG format. </li><li>  <b>3D models are</b> converted to the internal format of the engine. </li><li>  Files named file.pack are converted from text files to <b>binary</b> files.  It is well suited for all sorts of game configs, levels, etc. </li></ul><br>  In this case, the collector looks at the time of the file change and converts only the changed files, which significantly speeds up its work.  Specifically, my collector is written in PHP.  Perhaps this is not the best choice, but it was easier for me.  In addition, it can potentially be transferred to the server for teamwork. <br><br><h2>  <font color="#265b82">Formats</font> </h2><br>  I would recommend using these formats: <br><br>  <b>WEBP</b> for pictures.  Hardly for anyone this format will be new.  And for those who hear about it for the first time - webp can store a picture without loss of quality as PNG, as well as with loss ‚Äî like JPEG, but with noticeably better quality, less weight and transparency.  Another advantage is the ability to scale pictures on the fly while reading a file.  Libwebp is compiled for all platforms without problems. <br><br>  <b>OGG</b> for sounds.  Android natively understands the OGG format, and on iOS / OSX / tvOS I use the <a href="https://wiki.xiph.org/Tremor">Tremor</a> library (fixed-point version of the Ogg Vorbis) to decode WAV sounds and feed them to OpenAL.  Attempts to use OpenAL and on Android were not crowned with success (the sounds were delayed). <br><br><h2>  <font color="#265b82">Classes and modules</font> </h2><br>  Let us examine in more detail what classes the engine contains and why modules are needed? <br>  The rule ‚Äúwhat to make in the module, and what in the engine?‚Äù Is very simple: <br><div style="text-align:center;"><img width="400" src="https://habrastorage.org/files/f62/f53/c5d/f62f53c5df9c405bb0cbcfa59efad930.jpg"></div><br><br>  Following this rule, I distributed the classes as follows: <br><br><h4><img height="70" src="https://habrastorage.org/files/fd7/076/7ec/fd70767ec5ea4c47938f89268e442e98.png">  Engine </h4><br><ul><li>  Work with the platform.  Here the application is initialized, as well as the transfer of external events (pause, touchscreen, buttons) to the main engine class. </li><li>  Main class.  Here the mainloop is spinning, incoming events are processed (already in a universal form independent of the platform), flows and background tasks are managed. </li><li>  Work with 2D.  Display images, atlases, post-effects. </li><li>  Work with 3D models.  Loading models, rendering, managing shaders. </li><li>  Standard UI elements.  Windows, buttons, scrolling, notifications. </li><li>  Textures.  Loading and unloading textures.  The decoders themselves are in modules. </li><li>  Text output, rendering SDF fonts. </li><li>  Maths.  All sorts of formulas, matrices, quaternions, etc. </li><li>  Social  Sending letters, standard sharing, rate me.  Themselves soc.  Networks are rendered into modules. </li><li>  Reading / writing files. </li><li>  Work with UTF8 strings. </li><li>  Work with the network. </li><li>  Music / Sounds. </li></ul><br><h4><img height="70" src="https://habrastorage.org/files/83b/063/ebc/83b063ebcaf84230b2f65c2e259c5a75.png">  Modules </h4><br><ul><li>  Social <br><ul><li>  Facebook </li><li>  Google Plus </li><li>  Twitter </li><li>  VK </li></ul></li><li>  Replay Kit (screen recording for iOS) </li><li>  Json / xml </li><li>  Picture Decoders <br><ul><li>  WEBP </li><li>  Jpeg </li><li>  PNG </li></ul></li><li>  In-apps (internal payments) </li><li>  Game Center, Google Play Services </li><li>  Crashlytics (track crash) </li><li>  Branch (deep links) </li><li>  Analytics <br><ul><li>  Google Analytics </li><li>  Game Analytics </li><li>  Flurry </li></ul></li><li>  Advertising <br><ul><li>  <s>Appodeal</s> ( <b>UPD</b> Unfair Company) </li><li>  Chartboost </li><li>  Fyber </li><li>  Adcolony </li><li>  Unityity </li><li>  Tapjoy </li><li>  Google Ads </li><li>  Heyzap </li><li>  Adtoap </li></ul></li></ul><br>  In the following articles I will focus on specific classes and modules, with examples and usefulness.  I want to pay special attention to rendering the SDF fonts (Signed Distance Field) and shaders in the game from the header. </div><p>Source: <a href="https://habr.com/ru/post/282065/">https://habr.com/ru/post/282065/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../282045/index.html">Scaling to 100 million: architecture defined by service level</a></li>
<li><a href="../282047/index.html">Evolution of viruses: from student fun to disruption of Iran‚Äôs nuclear program</a></li>
<li><a href="../282049/index.html">Preemptivity: how to take away the processor</a></li>
<li><a href="../282053/index.html">Andrei Ershov: ‚ÄúTwo Views of Programming‚Äù</a></li>
<li><a href="../282057/index.html">Xamarin Development Workshop: Technology Overview and Dive into Solution Development</a></li>
<li><a href="../282067/index.html">From the command line for knowledge</a></li>
<li><a href="../282071/index.html">What does the convolutional neural network look at when it sees nudity?</a></li>
<li><a href="../282073/index.html">Summit comes to us ...</a></li>
<li><a href="../282075/index.html">Week before the 5th International Mobile Conference MBLT16</a></li>
<li><a href="../282077/index.html">Chat bot development for Bitrix24</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>