<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Veeam Backup & Replication - Migrating Virtual Machines from Hyper-V 2008 R2 to 2012 R2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of the most important features of Hyper-V 2012 is the replication feature. It allows you to make a workable copy of a virtual machine (replica) on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Veeam Backup & Replication - Migrating Virtual Machines from Hyper-V 2008 R2 to 2012 R2</h1><div class="post__text post__text-html js-mediator-article"><p>  One of the most important features of Hyper-V 2012 is the replication feature.  It allows you to make a workable copy of a virtual machine (replica) on another server within a few minutes.  Unlike the ‚Äúclassic‚Äù disaster recovery scenarios, the replica can be used to migrate a virtual machine (VM) to a new infrastructure or to another domain. </p><br><br><p>  But what if the old server runs on Windows Server 2008 R2?  How can I move the VM to the new Hyper-V 2012 R2?  If you do not want to pay, you can use the standard ‚Äúexport / import‚Äù procedure, but such an operation may require several minutes for each VM, depending on the speed of the disks where the data is exported. </p><br><br><p>  Another way is to use Veeam Backup &amp; Replication, which allows you to create a job for replicating a VM (Replica Job) even if the OS versions of the source and remote hosts are different. </p>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/fd0/d64/75a/fd0d6475a98292dbe5a5e69d4a57a8c9.png"><br><a name="habracut"></a><br><br><p>  The first step is to install a driver on each host that includes the Change Block Tracking (CBT) mechanism.  After that, you can start creating a task for VM replication. </p><br><br><img src="https://habrastorage.org/getpro/habr/post_images/7f8/726/091/7f8726091d8ebf501f3a16a4c43407cb.png"><br><br><p>  Next, you need to create a name for the task, select the VM that you want to copy from the source host. </p><br><br><img src="https://habrastorage.org/getpro/habr/post_images/66b/2c6/52f/66b2c652fdf58b77798026b2197c986c.png"><br><br><p>  Then you need to select the destination server where replication is performed and the location of the VM files. </p><br><br><img src="https://habrastorage.org/getpro/habr/post_images/5a9/0d4/274/5a90d42746830f4ef4feabc1517814a8.png"><br><br><p>  Next, select the suffix for the name of the replica and the number of recovery points, the recovery point (the point may not be the latest, since our goal is to migrate the VM, and not restore the latest working version). </p><br><br><p>  After this step, you need to choose whether to use the Volume Shadow Copy (VSS) service.  The service is needed to ensure data consistency and is critical when working with VMs, which use applications that conduct database transactions (SQL, Exchange, AD, etc.) </p><br><br><img src="https://habrastorage.org/getpro/habr/post_images/675/423/47c/67542347c70a4c15d2cdb0f6e2644d27.png"><br><br><p>  Then select a work schedule and activate the task.  The VM will be available in a few minutes on a new host (depending on its size and the performance of the hosts).  That's all!  You can shut down the VM on the old server, deactivate the task for replication and turn on the VM on the new host. </p><br><br><h4>  Perfect cue </h4><br><p>  It is clear that the classic replica is not good enough, since such an operation cannot be performed during the working day, so it is very important to follow the correct strategy.  My recommendation here is to use 2 tasks for replication: one is early in the morning and the second is late at night.  This will reduce the replication ‚Äúwindow‚Äù.  It is important to remember that such an operation should be done outside working hours, possibly over the weekend, when there is more time to solve unexpected problems. </p><br><br><h4>  Replica vs Backup </h4><br><p>  Why is replica better than backup?  Just because the replica creates an ideal copy of the VM on the new host, and it can be great if you plan to change the basic infrastructure (server and storage).  The replica also makes it possible to reduce the time it takes to complete the operation, since it only needs to add newly modified data blocks when the backup job takes time to restore the VM to the new host. </p><br><br><h4>  Job automation </h4><br><p>  Another "trick" in Veeam Backup &amp; Replication is the ability to use <b>Windows PowerShell snap-in,</b> which allows you to automate various processes without using a UI.  The tool will have to be especially in place when there are many customized tasks at hand or repeated actions are performed. </p><br><br><p>  I remind you that Windows PowerShell snap-in is a separate component that requires installation, so if it is not there, just run the installer and reinstall the necessary component. </p><br><br><img src="https://habrastorage.org/getpro/habr/post_images/631/d3f/4b9/631d3f4b91940984fc04cc6a116608b2.png"><br><br><p>  With PowerShell, you can create a script to automate the described operations. </p><br><br><p>  ‚ÄúTurn off VM‚Äù, ‚Äústart replica tasks‚Äù, ‚Äústart VM on new server‚Äù, ‚Äúdeactivate replica tasks‚Äù - all this is possible without using the main console.  However, it should be remembered that in order for the PowerShell scripts to work correctly, the modules must be installed on the same server as Veeam Backup &amp; Replication.  It also requires the use of the same OS versions for Veeam and Hyper-V hosts (for example, Windows Server 2012 for Veeam and Windows Server 2012 R2 for the new host). </p><br><br><p>  It is also important to enable PowerShell on Hyper-V 2008 R2 and import the PowerShell library management module for Hyper-V, which can be found on the CodePlex website: <a href="http://pshyperv.codeplex.com/">pshyperv.codeplex.com</a> . </p><br><br><p>  Observe the following requirements: </p><br><ul><li>  Service Pack 1; </li><li>  <a href="http://www.microsoft.com/en-us/download/confirmation.aspx%3Fid%3D22833">Framework .NET 4</a> ; </li><li>  Windows Management Framework 3 (which contains PowerShell v3); </li></ul><br><br><p>  Copy the HyperV folder (from the archive downloaded from CodePlex) to <b>C: \ windows \ system32 \ windowsPowerShell \ v1.0 \ modules</b> </p><br><br>  <a href="">The following script</a> will provide an opportunity to perform such operations as: <br><ul><li>  Turn off VM on Hyper-V 2008 R2; </li><li>  Run a job for replication (Replica Job) on Veeam Backup &amp; Replication; </li><li>  Enable VM on Hyper-V 2012 R2; </li><li>  Deactivating a job for replication (Replica Job). </li></ul><br><br><h4>  Conclusion </h4><br><p>  The script is made to perform routine operations automatically, as well as use cmdlets, which are disabled by default.  Remember, to work with Windows Server 2012 R2, you must use the version of Veeam Backup &amp; Replication not lower than <a href="http://veeam.com/kb1831">v7 R2!</a> </p><br><br><p>  Thus, we got an interesting solution for automation.  When the standard functionality of Veeam Backup &amp; Replication v7 may not be enough, the PowerShell snap-in provides an opportunity for expansion.  If you are interested in Veeam Backup &amp; Replication, then download the <a href="http://www.veeam.com/virtual-machine-backup-solution-free.html">trial version</a> . </p><br><br><h4>  Additional materials </h4><br><ul><li>  <a href="http://www.insidetechnologies.eu/blog/articoli/VeeamBackupReplicationMigrateVMfromHyper-V2008R2to2012R2">Veeam Backup &amp; Replication: Migrate VM from Hyper-V 2008 R2 to 2012 R2 (English)</a> </li><li>  <a href="http://www.veeam.com/virtual-machine-backup-solution-free.html">Veeam Backup &amp; Replication Free Edition</a> </li><li>  <a href="http://helpcenter.veeam.com/backup/70/vsphere/quick_migration.html">Veeam Quick Migration (helpcenter)</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/211793/">https://habr.com/ru/post/211793/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../211777/index.html">Personalization: debunking myths</a></li>
<li><a href="../211779/index.html">Open Terminal Client - some history</a></li>
<li><a href="../211783/index.html">Applications open for Summer Research Microsoft Research</a></li>
<li><a href="../211787/index.html">Workplace Popcorn: How to become Super-productive working for yourself</a></li>
<li><a href="../211789/index.html">Visualization of floor plans or geographic information systems (GIS) in real estate</a></li>
<li><a href="../211797/index.html">Competition "Native Speech" - a week before the start!</a></li>
<li><a href="../211799/index.html">Ciklum Speakers' Corner "Tables - salt of the language of Lua", February 13</a></li>
<li><a href="../211801/index.html">C # / WPF + Pascal + Assembler: how I restored my first game</a></li>
<li><a href="../211805/index.html">10 of my favorite CodeRush features for .NET development in Visual Studio</a></li>
<li><a href="../211809/index.html">Bitcoin exchange Btc-e.com suspended the input and output of rubles, and MtGox.com temporarily stopped the withdrawal of funds in dollars</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>