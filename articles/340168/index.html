<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How did we choose Graylog2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Before each relatively large production sooner or later there is a question about the centralized collection and viewing of logs. Currently, there is ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How did we choose Graylog2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/59/e4/64/59e4643facf51959669989.jpeg"><br><br>  Before each relatively large production sooner or later there is a question about the centralized collection and viewing of logs.  Currently, there is a huge selection of open-source, paid, online and on-premises solutions.  I will try to outline the selection process in our particular case. <br><br>  This review article, the essence of which tells about the main features of Graylog2, why we chose it and how we exploit it. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A little about our infrastructure (you can read a little more <a href="https://habrahabr.ru/company/pixonic/blog/325040/">here</a> ): we use 7 data centers around the world, about 500 production servers and a couple more hundreds of various applications from which I would like to collect logs.  All this is running under both Linux and Windows, and heterogeneous services are spinning on top.  All services have their own log format, while there is also Java, which has a kind of StackTrace. <br><br><h4>  Our requirements and what we wanted to get in the end </h4><br>  From the programmers and all interested, the requirements for logs were simple: <br><br><ul><li>  the sending log agent should not heavily load the system; </li><li>  the ability to add custom fields at an arbitrary point in time, on arbitrary servers; </li><li>  search, sort and so on; </li><li>  the ability to send POST logs with requests or something similar (for sending logs, for example, from mobile devices). </li></ul><br>  Here, in general, nothing complicated, everything is quite normal.  But in our case, it was necessary to satisfy the following service requirements: <br><br><ul><li>  openLDAP authentication (in our case, this is <a href="https://habrahabr.ru/company/pixonic/blog/325546/">FreeIPA</a> ); </li><li>  convenient delineation of rights; </li><li>  convenient configuration of clients (preferably from one place); </li><li>  possibility of automated installation of agents on all used systems; </li><li>  the possibility of convenient monitoring of both the health of services and the necessary metrics; </li><li>  availability of community and documentation, or commercial support; </li><li>  simple scaling. </li></ul><br>  This set of requirements was quite critical so that the new service could fully fit into the existing infrastructure, taking into account the peculiarities of our automation, distribution of rights and would not turn out to be a white crow, who would have to spend too much time.  The service should be convenient for both end users and meet their requirements. <br><br>  At this stage, we realized that we were left with only some commercial solutions and Graylog2 from opensource. <br><br><h4>  How to count the number of logs and load </h4><br>  In short, no way.  Therefore, here I will point out the main approaches and nuances that helped us in this matter. <br><br>  In the beginning, we took and looked at the number of logs on the server focus group, measured the dynamics of changes in 2 weeks.  We multiplied the resulting number by the number of servers.  As a result, the average number of logs was about 1TB per day.  It was necessary to store these logs from 2 weeks to 3 months. <br><br>  At this stage, when calculating commercial solutions and own infrastructure, it was decided to use Graylog2.  Deciding that the best way to calculate the real load is to get some of the traffic to the test server, we deployed one Graylog2 node and sent traffic from a certain focus group there. <br><br>  For about a week, we saw a load of 10‚Äì20k messages per second and, in general, we were already prepared to use these numbers as we deployed the combat cluster.  But at some point on the servers something broke, the number of logs increased almost 10 times and on one server we saw a surge to 100k messages per second.  At the same time, the StackTrace part from Java applications did not fit into the allowed log size.  At this point, we came to the understanding that the logs are needed just for convenient work in such critical situations, and all previous calculations were conducted only in normal conditions. <br><br>  Main conclusions: <br><br><ul><li>  counting logs in normal conditions does not give a picture of what is happening in the event of accidents.  A collection of logs is needed precisely for the prompt resolution of these situations; </li><li>  different services and languages ‚Äã‚Äãwrite messages in their own way and such situations need to be considered in advance; </li><li>  cluster performance should allow processing many times more messages from the normal load. </li></ul><br><h4>  A small description of the functionality Graylog2 </h4><br>  The main reasons why we chose him: <br><br><ul><li>  Well proven earlier product.  With good documentation and illumination of the main problems. </li><li>  Ability to configure agents via the web interface through Collectors. </li><li>  Simple and functional integration with OpenLDAP, including group synchronization. </li><li>  Convenient horizontal scaling. </li><li>  A huge selection of different variations of inputs for logging. </li><li>  The presence of plug-ins and extensions. </li><li>  Pretty simple and convenient query and sample language. </li><li>  Availability of dashboards and the possibility of notifications. </li></ul><br>  This functionality has covered almost all of our needs and greatly simplified life.  Just a couple of months from a test service with a dubious future, it turned into a rather important business-critical unit and has been doing a great job for six months already. <br><br>  Of course, the implementation of such solutions is not the most transparent process.  We are faced with a fairly large number of nuances and pitfalls, both during the initial setup, and during further operation.  In the next article, I‚Äôll tell you exactly how we configured and tuned Graylog2 and its components such as MongoDB and Elasticsearch. </div><p>Source: <a href="https://habr.com/ru/post/340168/">https://habr.com/ru/post/340168/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../340156/index.html">FrontFest.JS: ClojureScript in production, optimization of React rendering and how to (not) get depressed with Angular</a></li>
<li><a href="../340158/index.html">VoIP server for a small company (FreePBX 14, Asterisk 15, Ubuntu 16.04) part 2</a></li>
<li><a href="../340160/index.html">Header design features</a></li>
<li><a href="../340164/index.html">Information security in the process control system: attack vector man-machine interface</a></li>
<li><a href="../340166/index.html">How Android Converts Resource Sizes</a></li>
<li><a href="../340170/index.html">Rust 1.21 release</a></li>
<li><a href="../340172/index.html">Analysis of the latest version of the Dridex malware for identity theft</a></li>
<li><a href="../340176/index.html">The whole web on 60+ FPS: how a new renderer in Firefox got rid of jerks and slowdowns</a></li>
<li><a href="../340178/index.html">Monoids, semigroups and all-all-all</a></li>
<li><a href="../340180/index.html">Wi-Fi security is compromised due to multiple vulnerabilities found in WPA2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>