<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to fix the infrastructure after the tsunami</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="While people are launching airplanes from a window, practicing proxy server settings, or even installing dante on a VPS , the mixed-sized business is ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to fix the infrastructure after the tsunami</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/ro/pd/zk/ropdzkdmdnmofeb--4lk5ir8udq.jpeg"></p><br><p>  While people are launching airplanes from a window, practicing proxy server settings, or even installing <a href="https://habr.com/company/aladdinrd/blog/353738/">dante on a VPS</a> , the mixed-sized business is faced with the real consequences of massive locks in its processes. </p><br><p>  You can have different attitudes to what is happening, but when the G Suite stops working or the cloud structure stops, it looks like a natural disaster.  And promptly rake the consequences accounted for ordinary system administrators.  Therefore, in this article I share options for the survival and rethinking of business processes - a kind of chronicles from the fields. <a name="habracut"></a></p><br><p>  The solution of the problem can be a variety of options, up to renting an apartment in <abbr title="city ‚Äã‚Äãon the border with Finland">Svetogorsk</abbr> and installing a 4G modem with a Finnish sim card there.  Or bribe a familiar provider to install in its data center a server connected to bypass the ‚ÄúRevizor‚Äù system.  But I will focus on a couple of reasonable and legitimate options. </p><br><h1 id="virtualnaya-chastnaya-set">  Virtual private network </h1><br><p>  When monitoring reports the unavailability of your servers, and in the process of clarifying the situation, you understand that the subnet of a foreign data center has been blocked, then the first censorship thought will be to deploy a VPN.  Virtual $ 5 droplets save the situation.  Although their addresses can also fall under the distribution. </p><br><blockquote>  Let me remind you that you can check the IP-address for blocking on the official <a href="https://blocklist.rkn.gov.ru/">website of</a> Roskomnadzor.  You can use and bots - they are abundant in the vast search. </blockquote><p>  If suddenly you have to ‚Äújump‚Äù over the data centers of some network supplier of capacities (while a normal solution is being looked for), here‚Äôs a little advice to simplify the process: create a snapshot of the virtual machine, make it available for the desired region and create a new virtual machine in the target region based on old snapshot. </p><br><p><img src="https://habrastorage.org/webt/_f/nw/jv/_fnwjv9zcrbl_zh4qgcuv6g5m9s.jpeg"><br>  <em>Select available regions for the virtual machine image.</em> </p><br><p>  I was lucky, and <em>until the</em> blocked address was caught on the third attempt. </p><br><p>  Anything can be used as a VPN solution.  OpenVPN is configured quickly and easily, but may require additional software installation.  L2TP \ IPSec is more complicated, but it is supported on fresh versions of IOS and Android. </p><br><p>  Below is a list of ready-made solutions in case you need to act quickly, and there is no time to understand: </p><br><ul><li>  <a href="https://github.com/StreisandEffect/streisand">Streisand</a> .  An all-in-one VPN server, including Shadowsocks and Tor.  At the same time helps to begin to understand Ansible. </li><li>  <a href="https://github.com/trailofbits/algo">Algo VPN</a> .  Without OpenVPN and Tor, but with IKEv2. </li><li>  <a href="https://github.com/Nyr/openvpn-install">Openvpn-install</a> .  A simple script to install OpenVPN. </li><li>  <a href="https://github.com/hwdsl2/setup-ipsec-vpn">IPsec VPN</a> .  A simple script to install the L2TP \ IPSec server. </li></ul><br><p>  Now that the organization has got some kind of access to its services, we need to think about what to do next - because at any moment, our VPN virtual machine can be distributed. </p><br><h1 id="ip-shestoy-versii">  IP version six </h1><br><p>  One of the options for restoring functionality was the transition to IPv6, the benefit of modern data centers provide this protocol.  In addition to access to cloud servers, IPv6 will help restore the work of Google services - such as G Suite, - which are tied to the business processes of many organizations. </p><br><p>  If you are lucky and your provider supports the new protocol - half the work is done.  If not so lucky, then one of the options would be to configure the 6to4 \ 6in4 tunnel. </p><br><blockquote>  A list of providers that support IPv6 can be found on the wiki-portal <a href="https://version6.ru/isp">version6.ru</a> . </blockquote><p>  Most routers support such tunnels.  In particular, setting up IPv6 on MikroTik equipment is described in the article ‚Äú <a href="https://habr.com/post/189008/">MikroTik - 6in4 or IPv6 without provider support</a> ‚Äù.  The general principle is extremely simple: register with a broker, create a tunnel, assign an addressing, prescribe routes, use.  You can check the work on one of the <a href="https://test-ipv6.com/">sites to test IPv6</a> . </p><br><p><img src="https://habrastorage.org/webt/vb/ii/cs/vbiicswts23gu0fnzjrrnivyjuk.jpeg"><br>  <em>Checking IPv6 performance - now Google services will work again.</em> </p><br><p>  An important point to consider when setting up IPv6 is that the protocol works without NAT, and all devices on the local network are on the ‚Äúbig internet‚Äù.  If you turned off the firewall on workstations, now is the time to turn it on and configure it.  Providing a little more protection will help configure the firewall on the router.  For example, on MikroTik I used the following settings: </p><br><pre><code class="hljs pgsql">/ipv6 firewall <span class="hljs-keyword"><span class="hljs-keyword">filter</span></span> #  ICMP- <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> chain=<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span>=<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span> protocol=icmpv6 <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> action=<span class="hljs-keyword"><span class="hljs-keyword">drop</span></span> chain=<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> protocol=icmpv6 #  ICMP- <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> chain=forward <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span>=<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span> protocol=icmpv6 <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> action=<span class="hljs-keyword"><span class="hljs-keyword">drop</span></span> chain=forward protocol=icmpv6 #    established  related <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> chain=<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>-state=established,related #         SSH\etc #      <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> action=<span class="hljs-keyword"><span class="hljs-keyword">drop</span></span> chain=<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>-interface=**StF** #    established  related <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> chain=forward <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>-state=established,related #           #   <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> action=<span class="hljs-keyword"><span class="hljs-keyword">drop</span></span> chain=forward <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>-interface=**StF**</code> </pre> <br><p>  <em>Where StF is the name of the 6to4 tunnel.</em> </p><br><p>  An alternative to setting up IPv6 on the router is setting up a tunnel on the workstation, since Windows supports the <a href="https://ru.wikipedia.org/wiki/Teredo_(%25D1%2581%25D0%25B5%25D1%2582%25D0%25B5%25D0%25B2%25D0%25BE%25D0%25B9_%25D0%25BF%25D1%2580%25D0%25BE%25D1%2582%25D0%25BE%25D0%25BA%25D0%25BE%25D0%25BB)">Teredo</a> protocol.  The configuration option is described in the ‚Äú <a href="https://superbit.ws/nastrojka-ipv6-teredo-v-windows-7-2/">IPv6 / Teredo configuration in Windows 7</a> ‚Äù material.  The peculiarity of this protocol is the ability to work because of NAT. </p><br><p><img src="https://habrastorage.org/webt/wq/e9/5d/wqe95dz7w7gtm-vu7nxuqxptohw.jpeg"><br>  <em>IPv6 in work.</em> </p><br><p>  Unfortunately, the lack of tunnels remains the potential for blocking tunnel brokers, and constantly changing servers is not the most elegant solution. </p><br><h1 id="reorganizaciya-biznes-processov">  Reorganization of business processes </h1><br><p>  When everything works, it's time to think about creating an infrastructure that will not be afraid of all these disasters.  Of course, if a company has enough funds to organize a geo-distributed cluster with one, or even several nodes in the Russian Federation, this will be a good solution. </p><br><p>  But if there are no funds, then you have to look for analogues of the G Suite.  The same Mail.ru and Yandex offer services like text collaboration and mail for a domain. </p><br><p>  Other organizations are increasingly thinking about a step back, towards their own infrastructure.  Clouds are good, but availability in modern realities is more expensive.  Therefore, a good option seems to be leasing your server, or renting colocation in domestic data centers. </p><br><p>  <strong>By the way, share your news from the fields - suddenly it will come in handy in the bright future.</strong> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/354506/">https://habr.com/ru/post/354506/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354494/index.html">GDPR on the nose - stop panic and begin to escape</a></li>
<li><a href="../354498/index.html">HOPE X. Conference "Breaking the elevator: from the basement to the penthouse." Part 2. "Security Systems"</a></li>
<li><a href="../354500/index.html">Badoo geolocation testing: bumps, stones, crutches and selfie stick</a></li>
<li><a href="../354502/index.html">The insides of the protocol, which browsers transmit voice and video</a></li>
<li><a href="../354504/index.html">Diarrhea for your backend on Node.JS - reduce build weight</a></li>
<li><a href="../354508/index.html">Let's take a look at the SObjectizer under the hood</a></li>
<li><a href="../354510/index.html">Mail.Ru Group at the fifth Moscow Data Fest</a></li>
<li><a href="../354512/index.html">How to use trams to make it easier for a taxi driver to find you</a></li>
<li><a href="../354516/index.html">There is work in RnD, or how to get away from monotonous and minor tasks</a></li>
<li><a href="../354518/index.html">And if we do not design a system for managing the production of IT products. Part 3. Infrastructure support</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>