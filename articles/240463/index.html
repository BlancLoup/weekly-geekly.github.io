<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Effective Django. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I present to you the translation of articles on Django from the site effectivedjango.com . I stumbled upon this site while studying this framework. Th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Effective Django. Part 1</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/364/751/01a/36475101ad10426197c121e865900197.png"></div><br>  <em>I present to you the translation of articles on Django from the site <a href="http://effectivedjango.com/">effectivedjango.com</a> .</em>  <em>I stumbled upon this site while studying this framework.</em>  <em>The information posted on this resource seemed useful to me, but since I did not find a translation into Russian anywhere, I decided to do this good deed myself.</em>  <em>This cycle of articles, I think, will be useful for web developers who are only taking the first steps in learning Django.</em> <br><a name="habracut"></a><br><hr><br><a name="contents"></a><h1>  Table of contents </h1><ul><li>  <a href="https://habr.com/ru/post/240463/">Introduction</a> </li><li>  Effective Django.  Manual <br><ul><li>  <a href="https://habr.com/ru/post/240463/">Chapter 1. Getting Started</a> </li><li>  <a href="https://habr.com/ru/post/240463/">Chapter 2. Using the model</a> </li><li>  <a href="http://habrahabr.ru/post/242261/">Chapter 3. We write a presentation</a> </li><li>  <a href="http://habrahabr.ru/post/242261/">Chapter 4. Using Static Resources</a> </li><li>  Chapter 5. Additional Basic Views </li><li>  Chapter 6. Form Basics </li><li>  Chapter 7. Related Models </li><li>  Chapter 8. Authentication and Authorization Processing </li></ul></li><li>  Testing in Django </li><li>  Understanding Middlewares </li><li>  Databases and Models </li><li>  Representation Classes (CBV) </li><li>  Forms </li></ul><br><a name="introduction"></a><h1>  Introduction <a href="https://habr.com/ru/post/240463/" title="to contents">‚áß</a> </h1><br>  Django is a popular, powerful Python framework.  He has many " <abbr title="battaries">batteries</abbr> ", and allows you to <abbr title="get up and going">immediately start development</abbr> .  However, all this power means that you can write low-grade code that seems to work.  So what is meant by Effective Django?  By Effective Django, we mean the use of Django in such a way that the written code is <em>coherent</em> , <em>tested</em> and <em>scalable</em> .  What does each of these words mean? <br><br>  " <em>Connected" code</em> is a code that focuses on doing one thing, only one thing.  This means that when you write a function or method, the code you write must do one thing and do it well. <br><br>  This directly relates to writing <em>test code</em> : code that does a lot of things is often too difficult to test.  When I catch myself thinking, ‚ÄúWell, this piece of code is too complicated to write tests for it ‚Äî it's just not worth the effort‚Äù ‚Äîthat is a signal to go back and focus on simplification.  <em>The</em> test <em>code</em> is a code that allows you to simply write tests for it;  code that is easy to find problems. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Finally, we want to write <em>scalable code</em> .  This means not only to scale it in terms of execution, but also to increase in terms of command and command understanding.  Well-tested applications are easier for others to understand (and easier for them to change), which implies a greater opportunity to improve your application by adding new engineers. <br><br>  My goal is to convince you of the importance of these principles, and provide examples of how, by following them, build a more robust Django application.  I'm going to go through the process of building a contact management application one by one, talking about the solutions and testing strategy that I use. <br><br>  These documents are a combination of notes and examples prepared for PyCon 2012, PyOhio 2012, and PyCon 2013, as well as for <a href="https://www.eventbrite.com/">Eventbrite</a> web development.  I'm still working on combining them into one document, but I hope you find them useful. <br><br>  Code <a href="https://github.com/nyergler/effective-django">samples</a> for this tutorial are available on <a href="https://github.com/nyergler/effective-django">github</a> .  Feedback, suggestions and questions can be sent to <a href="">nathan@yergler.net</a> . <br>  This document is available on the <a href="http://effectivedjango.com/">website</a> , as well as in <a href="http://effectivedjango.com/latex/EffectiveDjango.pdf">PDF</a> and <a href="">EPub formats</a> . <br><br>  Videos of this guide from PyCon can be viewed on <a href="https://www.youtube.com/watch%3Fv%3DNfsJDPm0X54">YouTube</a> . <br><br><a name="chapter_01"></a><h1>  Chapter 1. Getting Started <a href="https://habr.com/ru/post/240463/" title="to contents">‚áß</a> </h1><br><h2>  1.1.  Your development environment </h2><br>  When talking about your development environment, there are three important things to keep in mind: <strong><abbr title="isolation">isolation</abbr></strong> , <strong><abbr title="determinism">predetermination,</abbr></strong> and <strong><abbr title="similarity">similarity</abbr></strong> .  Each of them is important and they all interact with each other in concert. <br><br>  <u><em>Isolation</em></u> means that you cannot accidentally use tools or packages installed outside of your environment.  This is especially important when this happens with something similar to Python packages with extensions written in C: if you use something installed at the system level and you don‚Äôt know about it, then when you deploy or distribute your code you may find that it does not work as intended.  Tools like <a href="http://www.virtualenv.org/">virtualenv</a> can help create something similar to an isolated environment. <br><br>  Your environment is <u><em>predetermined</em></u> if you are sure which version of your dependencies you rely on and whether you can surely reproduce the system environment. <br><br>  And finally, the <u><em>similarity</em></u> with the production or development server environment means that the same operating system is installed everywhere (maybe even the same <abbr title="release">release</abbr> ) and you use the same tools to configure your development environment and to configure your production environment.  This is by no means a necessity, but if you build large and complex software, the similarity will be useful to make sure that all the problems that you can see on the ‚Äúcombat‚Äù server are replicable in the environment where you are developing.  In addition, the <u><em>similarity</em></u> limits the scope <abbr title="investigation">of</abbr> your code. <br><br><h3>  1.1.1.  Insulation </h3><br><ul><li>  We want to avoid using unknown dependencies or unknown versions. </li><li>  <a href="http://www.virtualenv.org/">virtualenv</a> provides a simple way to work on a project, without using system site-packages. </li></ul><br><h3>  1.1.2.  Predestination </h3><br><ul><li>  Predestination means dependency management. </li><li>  Select one of the tools and use both during development and on the ‚Äúcombat‚Äù server: <br><ul><li>  <a href="http://pip.readthedocs.org/en/latest/">pip</a> and <a href="http://pip.readthedocs.org/en/latest/user_guide.html">special dependency files</a> ; </li><li>  <a href="http://www.buildout.org/">buildout</a> ; </li><li> <a href="https://pythonhosted.org/setuptools/setuptools.html">install-requires</a> in <code>setup.py</code> . </li></ul></li><li>  Determine exact dependency versions. </li></ul><br>  You can pinpoint the versions using either the PyPI version of the package, or a specific revision (SHA in git, revision number in Subversion, etc.).  This ensures that you can get exactly the same version of the packages that you use when testing. <br><br><h3>  1.1.3.  Similarity </h3><br><ul><li>  Work in an environment similar to the one where you will deploy your application and try to detect problems. </li><li>  If you are developing something that requires additional services - the similarity becomes even more important. </li><li>  <a href="http://vagrantup.com/">Vagrant</a> is a virtual machine management tool that allows you to easily create an environment separate from your everyday environment. </li></ul><br><br><h2>  1.2.  Setting up your environment </h2><br><h3>  1.2.1.  Creating a clean workspace </h3><br><blockquote>  <em><u>Translator's Note:</u></em> <br>  <em>First, create a directory ( <code>tutorial</code> ) in which we will work:</em> <br><br><pre> <code class="hljs dos">~$ <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> tutorial ~$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> tutorial ~/tutorial$ <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> venv project</code> </pre> <br>  <em>Our virtual environment will be located in the <code>venv</code> directory, and the <code>project</code> directory will contain the Django project.</em> </blockquote><br><pre> <code class="hljs mel">~/tutorial$ virtualenv --prompt=<span class="hljs-string"><span class="hljs-string">"(venv:tutorial)"</span></span> ./venv/ New <span class="hljs-keyword"><span class="hljs-keyword">python</span></span> executable <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ./venv/bin/<span class="hljs-keyword"><span class="hljs-keyword">python</span></span> Installing setuptools............done. Installing pip...............done. ~/tutorial$ <span class="hljs-keyword"><span class="hljs-keyword">source</span></span> ./venv/bin/activate (venv:tutorial)~/tutorial$</code> </pre> <br><br><h3>  1.2.2.  Creating a dependency file </h3><br>  Create a <code>requirements.txt</code> file in the <code>tutorial</code> directory with a single line (dependency) in it: <br><br><pre> <code class="hljs">Django==1.6.7</code> </pre> <br><blockquote>  <em><u>Translator's Note:</u></em> <br>  <em>In case you want to use the latest version of Django (1.7 - at the time of writing the translation) - instead of the line <code>Django==1.6.7</code> just leave <code>Django</code> - pip installs the latest available version.</em> </blockquote><br><h3>  1.2.3.  Installing dependencies </h3><br>  And now we can use <a href="http://www.pip-installer.org/">pip</a> to install dependencies: <br><br><pre> <code class="hljs sql">(venv:tutorial)~/tutorial$ pip <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> -U -r requirements.txt Downloadping/unpacking Django==<span class="hljs-number"><span class="hljs-number">1.6</span></span><span class="hljs-number"><span class="hljs-number">.7</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> -r requirements.txt (line <span class="hljs-number"><span class="hljs-number">1</span></span>)) Downloading Django<span class="hljs-number"><span class="hljs-number">-1.6</span></span><span class="hljs-number"><span class="hljs-number">.7</span></span>.tar.gz (<span class="hljs-number"><span class="hljs-number">6.6</span></span>MB): <span class="hljs-number"><span class="hljs-number">6.6</span></span>MB downloaded Running setup.py egg_info <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> Django <span class="hljs-keyword"><span class="hljs-keyword">warning</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> previously-included files matching <span class="hljs-string"><span class="hljs-string">'__pycache__'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">found</span></span> <span class="hljs-keyword"><span class="hljs-keyword">under</span></span> <span class="hljs-keyword"><span class="hljs-keyword">directory</span></span> <span class="hljs-string"><span class="hljs-string">'*'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">warning</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> previously-included files matching <span class="hljs-string"><span class="hljs-string">'*.py[co]'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">found</span></span> <span class="hljs-keyword"><span class="hljs-keyword">under</span></span> <span class="hljs-keyword"><span class="hljs-keyword">directory</span></span> <span class="hljs-string"><span class="hljs-string">'*'</span></span> Installing collected packages: Django Running setup.py <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Django changing <span class="hljs-keyword"><span class="hljs-keyword">mode</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">build</span></span>/scripts<span class="hljs-number"><span class="hljs-number">-2.7</span></span>/django-admin.py <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">644</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">755</span></span> <span class="hljs-keyword"><span class="hljs-keyword">warning</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> previously-included files matching <span class="hljs-string"><span class="hljs-string">'__pycache__'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">found</span></span> <span class="hljs-keyword"><span class="hljs-keyword">under</span></span> <span class="hljs-keyword"><span class="hljs-keyword">directory</span></span> <span class="hljs-string"><span class="hljs-string">'*'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">warning</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> previously-included files matching <span class="hljs-string"><span class="hljs-string">'*.py[co]'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">found</span></span> <span class="hljs-keyword"><span class="hljs-keyword">under</span></span> <span class="hljs-keyword"><span class="hljs-keyword">directory</span></span> <span class="hljs-string"><span class="hljs-string">'*'</span></span> changing <span class="hljs-keyword"><span class="hljs-keyword">mode</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> /home/nathan/p/edt/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/django-admin.py <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">755</span></span> Successfully installed Django Cleaning up...</code> </pre> <br><br><h2>  1.3.  Beginning of the Django project </h2><br>  When a building is under construction, scaffolding is often used to maintain the structure until construction is completed.  Scaffoldings can be temporary or they can serve as part of the foundation of a building, but despite this, they provide some support when you first start working. <br><br>  Django, like many web frameworks, represents <abbr title="scaffolding"><a href="https://en.wikipedia.org/wiki/Scaffold_(programming)">scaffolding</a></abbr> for your development.  This happens by making decisions and providing a starting point for your code, which allows you to focus on the problem you are trying to solve, and not on how to parse the HTTP request.  Django provides scaffolding both for working with HTTP and for working with the file system. <br><br>  HTTP scaffolding controls, for example, the conversion of an HTTP request to a Python object, and also provides tools for creating server responses more easily.  File system scaffolding is different: it is a set of conventions for organizing your code.  These agreements make it easier to add new engineers to the project, as engineers (hypothetically) already understand how the code is organized.  In terms of Django, a <em><abbr title="project">project</abbr></em> is the final product, and it combines one or more <em><abbr title="apps">applications</abbr></em> within it.  In Django 1.4, the way projects and applications are placed on disk is changed, which makes it easier to disconnect and reuse applications in different projects. <br><br><h3>  1.3.1.  Project creation </h3><br>  Django installs the <code>django-admin.py</code> script into the system to handle scaffolding tasks.  To create project files, use the <code>startproject</code> task.  We will define the name of the project and the name of the directory in which we want to place the project.  Since we are already in an isolated environment, we can simply write: <br><br><blockquote>  <em><u>Translator's Note:</u></em> <br>  <em>Let's go to the <code>~/tutorial/project/</code> directory and in the future we will work only from this directory (by <code>$</code> we will mean <code>~/tutorial/project/$</code> ):</em> <br><br><pre> <code class="hljs ruby">(<span class="hljs-symbol"><span class="hljs-symbol">venv:</span></span>tutorial)~<span class="hljs-regexp"><span class="hljs-regexp">/tutorial/</span></span>$ cd project</code> </pre> </blockquote><br><pre> <code class="hljs pgsql">(venv:tutorial)$ django-<span class="hljs-keyword"><span class="hljs-keyword">admin</span></span>.py startproject addressbook .</code> </pre> <br>  The created project has the following structure <br><br><pre> <code class="hljs markdown">manage.py ./addressbook <span class="hljs-strong"><span class="hljs-strong">__init__</span></span>.py settings.py urls.py wsgi.py</code> </pre> <br><br><h3>  1.3.2.  Project scaffolding </h3><br><ul><li>  <code>manage.py</code> is a link to the <code>django-admin</code> script, but with pre-installed environment variables pointing to your project, both for reading settings from there and for managing it if necessary; </li><li>  <code>settings.py</code> - here are your project settings.  The file already contains some reasonable settings, but the database is not specified; </li><li>  <code>urls.py</code> - contains URLs for <abbr title="mapping"><a href="https://en.wikipedia.org/wiki/Data_mapping">mapping (displaying)</a></abbr> views: we will soon ( <em>in later chapters</em> ) talk more about this; </li><li>  <code>wsgi.py</code> is a <a href="https://en.wikipedia.org/wiki/Web_Server_Gateway_Interface">WSGI</a> <abbr title="wrapper">wrapper</abbr> for your application.  This file is used by the Django development server and possibly other containers, such as <code>mod_wsgi</code> , <code>uwsgi</code> and others on a ‚Äúcombat‚Äù server. </li></ul><br><br><h3>  1.3.3.  Create application </h3><br><pre> <code class="hljs mel">(venv:tutorial)$ <span class="hljs-keyword"><span class="hljs-keyword">python</span></span> ./manage.py startapp contacts</code> </pre> <br>  The created application has the following structure: <br><br><pre> <code class="hljs markdown">./contacts <span class="hljs-strong"><span class="hljs-strong">__init__</span></span>.py models.py tests.py views.py</code> </pre> <br><ul><li>  Starting with Django 1.4, applications are hosted inside a package with a project.  This is a remarkable improvement, especially when it comes time to deploy the project on a ‚Äúcombat‚Äù server; </li><li>  <code>models.py</code> will contain Django ORM models for your application; </li><li>  <code>views.py</code> will contain the view code; </li><li>  <code>tests.py</code> will contain the unit tests and integration tests you have written. </li><li>  <em>Django 1.7: <code>admin.py</code> will contain the model for the administrative interface.</em> </li><li>  <em>Django 1.7: <code>migrations/</code> contains migration files</em> </li></ul><br><blockquote>  <em><u>Translator's Note:</u></em> <br>  <em>Currently, our <code>~/tutorial/</code> directory contains the dependencies file ( <code>requirements.txt</code> ), the virtual environment directory ( <code>venv/</code> ), one project ( <code>project/addressbook</code> ), and one application ( <code>project/contacts</code> ) and has the following contents:</em> <br><br><pre> <code class="hljs markdown">~/tutorial/ requirements.txt venv/ ... project/ manage.py addressbook/ <span class="hljs-strong"><span class="hljs-strong">__init__</span></span>.py settings.py urls.py wsgi.py contacts/ <span class="hljs-strong"><span class="hljs-strong">__init__</span></span>.py models.py tests.py views.py</code> </pre> </blockquote><br><br><a name="chapter_02"></a><h1>  Chapter 2. Using the model <a href="https://habr.com/ru/post/240463/" title="to contents">‚áß</a> </h1><br><h2>  2.1.  Configuring the database </h2><br>  Django supports out of the box MySQL, PostgreSQL, SQLite3, and Oracle.  <a href="http://docs.python.org/2/library/sqlite3.html">SQLite3 has been</a> included in Python since version 2.5, so we will use it in our project (for simplicity).  If you want to use MySQL, for example, then you need to add <a href="https://pypi.python.org/pypi/MySQL-python">mysql-python</a> to your <code>requirements.txt</code> . <br><br>  To use SQLite as a database, edit the <code>DATABASES</code> definition in the <code>addressbook/settings.py</code> file.  The settings.py file contains the Django settings for our project.  It has several settings that you must specify - for example, <code>DATABASES</code> - as well as other, optional, settings.  Django sets up some of the settings itself when it generates a project.  The documentation contains a <a href="https://docs.djangoproject.com/en/1.5/ref/settings/">complete list of settings</a> .  In addition, you can add your own settings if necessary. <br><br>  To use SQLite, we need to specify the engine ( <code>ENGINE</code> ) and the name of the database ( <code>NAME</code> ).  SQLite interprets the database name as the file name for the database: <br><br><pre> <code class="python hljs">DATABASES = { <span class="hljs-string"><span class="hljs-string">'defaults'</span></span>: { <span class="hljs-string"><span class="hljs-string">'ENGINE'</span></span>: <span class="hljs-string"><span class="hljs-string">'django.db.backends.sqlite3,'</span></span> <span class="hljs-comment"><span class="hljs-comment"># 'postgresql_psycopg2', 'mysql', 'sqlite3' or 'oracle'. 'NAME': os.path.join(BASE_DIR, 'address.db'), 'USER': '', # Not used with sqlite3. 'PASSWORD': '', # Not used with sqlite3. 'HOST': '', # Set to empty string for localhost. Not used with sqlite3. 'PORT': '', # Set to empty string for default. Not used with sqlite3. } }</span></span></code> </pre> <br>  Notice that the database engine is specified as a string, and not as a direct reference to a Python object.  This is done for the reason that the settings file should be easily imported <abbr title="without triggering any side effects">without causing third-party effects</abbr> .  You should avoid adding import calls to this file. <br><br>  You rarely have to import the settings file directly: Django imports it for you, and makes the settings available as <code>django.conf.settings</code> .  You typically import settings from <code>django.conf</code> : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.conf <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> settings</code> </pre> <br><br><h2>  2.2.  Creating a model </h2><br>  Django models display (roughly) database tables, and provide a place to encapsulate business logic.  All models are descendants of the <a href="https://docs.djangoproject.com/en/1.5/ref/models/instances/">Model</a> base class and contain definition fields.  Let's create a simple <code>Contacts</code> model for our application in the <code>contacts/models.py</code> : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.db <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> models <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Contact</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(models.Model)</span></span></span><span class="hljs-class">:</span></span> first_name = models.CharField( max_length=<span class="hljs-number"><span class="hljs-number">255</span></span>, ) last_name = models.CharField( max_length=<span class="hljs-number"><span class="hljs-number">255</span></span>, ) email = models.EmailField() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__str__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>.join([ self.first_name, self.last_name, ])</code> </pre> <br>  Django provides a <a href="https://docs.djangoproject.com/en/1.5/ref/models/fields/">set of fields</a> for displaying data types and various validation rules.  For example, <code>EmailField</code> , which we used, is a mapping to a column with type <code>CharField</code> , but adds validation data. <br><br>  After you have created a model, you need to add new tables to your database.  The Django <code>syncdb</code> looks at the installed models and creates (if necessary) tables for them: <br><br><blockquote>  <em><u>Translator's Note:</u></em> <em><br></em>  <em>Django will offer to create a superuser for Android, which is enabled by default in this version.</em>  <em>Take advantage of his offer.</em> </blockquote><blockquote>  <em><u>Translator's Note:</u></em> <em><br></em>  <em>Since Django 1.7, native support for <a href="http://djbook.ru/rel1.7/topics/migrations.html">migrations has been</a> added to the framework and the <code>syncdb</code> been deprecated.</em>  <em>So be so kind as to use the <code>migrate</code> <code>syncdb</code> instead of <code>syncdb</code> .</em> </blockquote><br><pre> <code class="hljs sql">(venv:tutorial)$ python ./manage.py syncdb Creating tables ... Creating table django_admin_log Creating table auth_permission Creating table auth_group_permissions Creating table auth_group Creating table auth_user_groups Creating table auth_user_user_permissions Creating table auth_user Creating table django_content_type Creating table django_session You just installed Django's auth system, which means you don't have any superusers defined. Would you like to <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> one <span class="hljs-keyword"><span class="hljs-keyword">now</span></span>? (yes/<span class="hljs-keyword"><span class="hljs-keyword">no</span></span>): yes Username (leave blank <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-string"><span class="hljs-string">'bjakushka'</span></span>): Email address: <span class="hljs-keyword"><span class="hljs-keyword">Password</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Password</span></span> (again): Superuser created successfully. Installing custom <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> ... installing <span class="hljs-keyword"><span class="hljs-keyword">indexes</span></span> ... Installed <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>(s) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> fixture(s) (venv:tutorial)$</code> </pre> <blockquote>  <em><u>Translator's Note:</u></em> <em><br></em>  <em>If you are using Django version 1.7 and higher, the output will be as follows:</em> <br><br><pre> <code class="hljs vhdl">(venv:tutorial)$ python ./manage.py migrate Opperation <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> perform: Apply <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> migrations: admin, contenttypes, auth, sessions Running migrations: Applying contenttypes.<span class="hljs-number"><span class="hljs-number">0001_</span></span>initial... OK Applying auth.<span class="hljs-number"><span class="hljs-number">0001_</span></span>initial... OK Applying admin.<span class="hljs-number"><span class="hljs-number">0001_</span></span>initial... OK Applying sessions.<span class="hljs-number"><span class="hljs-number">0001_</span></span>initial... OK (venv:tutorial)$</code> </pre> </blockquote><br>  However, our table with contacts is nowhere to be seen.  The reason for this is that we still need to tell the project to use the application. <br><br>  Setup <code>INSTALLED_APPS</code> contains a list of applications used in the project.  This list contains strings that display Python packages.  Django will import each of the specified packages, and then watch the <code>models</code> module.  Let's add our <code>contacts</code> application to the project settings ( <code>addressbook/settings.py</code> ): <br><br><pre> <code class="python hljs">INSTALLED_APPS = ( <span class="hljs-string"><span class="hljs-string">'django.contrib.admin'</span></span>, <span class="hljs-string"><span class="hljs-string">'django.contrib.auth'</span></span>, <span class="hljs-string"><span class="hljs-string">'django.contrib.contenttypes'</span></span>, <span class="hljs-string"><span class="hljs-string">'django.contrib.sessions'</span></span>, <span class="hljs-string"><span class="hljs-string">'django.contrib.messages'</span></span>, <span class="hljs-string"><span class="hljs-string">'django.contrib.staticfiles'</span></span>, <span class="hljs-string"><span class="hljs-string">'contacts'</span></span>, )</code> </pre> <br>  After that, run <code>syncdb</code> again: <blockquote>  <em><u>Translator's Note:</u></em> <em><br></em>  <em>For Django version 1.7 and higher, you will need to first run the <code>makemigrations</code> command - to create migrations based on changes in models, and then execute the <code>migrate</code> command - in order to apply the created migrations.</em> </blockquote><br><pre> <code class="hljs cs">(venv:tutorial)$ python ./manage.py syncdb Creating tables ... Creating table contacts_contact Installing custom SQL ... Installing indexes ... Installed <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>(s) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> fixture(s) (venv:tutorial)$</code> </pre> <blockquote>  <em><u>Translator's Note:</u></em> <em><br></em>  <em>Conclusion for Django 1.7 and higher:</em> <br><br><pre> <code class="hljs sql">(venv:tutorial)$ python ./manage.py makemigrations Migrations for 'contacts': 0001_initial.py: - <span class="hljs-keyword"><span class="hljs-keyword">Create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> Contact (venv:tutorial)$ python ./manage.py migrate Opperation <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> perform: <span class="hljs-keyword"><span class="hljs-keyword">Apply</span></span> all migrations: <span class="hljs-keyword"><span class="hljs-keyword">admin</span></span>, contenttypes, sessions, auth, contacts Running migrations: Applying contacts<span class="hljs-number"><span class="hljs-number">.0001</span></span>_initial... OK (venv:tutorial)$</code> </pre> </blockquote><br>  Notice that Django creates a table called <code>contacts_contact</code> : by default, Dj ango gives tables a name using a combination of application name and model name.  You can change this with options in the <a href="https://docs.djangoproject.com/en/1.5/ref/models/options/">Meta</a> model. <br><br><h2>  2.3.  Interaction with the model </h2><br>  Now that the model is synchronized with the database, we can interact with it using an interactive shell: <br><br><pre> <code class="hljs pgsql">(venv:tutorial)$ python ./manage.py shell Python <span class="hljs-number"><span class="hljs-number">2.7</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>, Mar <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">2014</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">57</span></span>:<span class="hljs-number"><span class="hljs-number">14</span></span>) [GCC <span class="hljs-number"><span class="hljs-number">4.7</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> linux2 <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> "help", "copyright", "credits" <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> "license" <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> more information. (InteractiveConsole) &gt;&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> contacts.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Contact &gt;&gt;&gt; Contact.objects.<span class="hljs-keyword"><span class="hljs-keyword">all</span></span>() [] &gt;&gt;&gt; Contact.objects.<span class="hljs-keyword"><span class="hljs-keyword">create</span></span>(first_name=<span class="hljs-string"><span class="hljs-string">'Nathan'</span></span>, last_name=<span class="hljs-string"><span class="hljs-string">'Yergler'</span></span>) &lt;Contact: Nathan Yergler&gt; &gt;&gt;&gt; Contact.objects.<span class="hljs-keyword"><span class="hljs-keyword">all</span></span>() [&lt;Contact: Nathan Yergler&gt;] &gt;&gt;&gt; nathan = Contact.objects.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(first_name=<span class="hljs-string"><span class="hljs-string">'Nathan'</span></span>) &gt;&gt;&gt; nathan &lt;Contact: Nathan Yergler&gt; &gt;&gt;&gt; print nathan Nathan Yergler &gt;&gt;&gt; nathan.id <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  Here used a few new pieces.  First, the <code>manage.py shell</code> command runs the Python interactive shell for us with the correct paths for Django.  If you try to start the Python interpreter and just import your applications, an exception will be thrown, because Django does not know which settings to use, and cannot display the model instances on the database. <br><br>  Secondly, the property <code>objects</code> our model were used here.  This is <a href="https://docs.djangoproject.com/en/1.5/topics/db/managers/">the model manager</a> .  So, if a single instance of a model is an analogy for a row in a database, then the model manager is an analogy for a table.  By default, the model manager provides query functionality and can be configured.  When we call <code>all()</code> , <code>filter()</code> or the manager itself, the <code>QuerySet</code> object is returned.  <code>QuerySet</code> is an iterable object and loads data from the database as needed. <br><br>  And the last - the field with the name <code>id</code> , which we did not define in our model, was used above.  Django adds this field as the primary key for the model, but only if you yourself have not determined which field will be the <a href="https://docs.djangoproject.com/en/1.5/topics/db/models/">primary key</a> . <br><br><h2>  2.4.  Writing tests </h2><br>  In our model, one method is defined, <code>__str__</code> , so it is time to write the tests.  The <code>__str__</code> method will be used in just a few places, and <abbr title="it‚Äôs entirely conceivable">it is quite possible that it will be fully shown to the end user</abbr> .  <abbr title="It is worth writing.">For this method it is worth writing a test, while we understand how it works</abbr> .  Django created the <code>tests.py</code> file when it created the application, so we will add the first test to this file, the <code>contacts</code> application. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.test <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TestCase <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> contacts.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Contact <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContactTests</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TestCase)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Contact model tests."""</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_str</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> contact = Contact(first_name=<span class="hljs-string"><span class="hljs-string">'John'</span></span>, last_name=<span class="hljs-string"><span class="hljs-string">'Smith'</span></span>) self.assertEquals( str(contact), <span class="hljs-string"><span class="hljs-string">'John Smith'</span></span>, )</code> </pre> <br>  You can run tests for your application using the <code>manage.py test</code> command: <br><br><pre> <code class="hljs mel">(venv:tutorial)$ <span class="hljs-keyword"><span class="hljs-keyword">python</span></span> ./manage.py test</code> </pre> <br>  If you run this, you will see that it has completed about 420 tests.  This is surprising, since we wrote only one.  This happened because, by default, Django runs tests for all installed applications.  When you added the <code>contacts</code> application to our project, you could see that several built-in Django applications were added by default.  An additional 419 tests were taken from there. <br><blockquote>  <em><u>Translator's Note:</u></em> <br>  <em>In our case (when using Django version 1.6.7), the previous paragraph is somewhat outdated: only one test will start - the one we created.</em>  <em>The output of the command will be as indicated below.</em> </blockquote><br>  If you want to run tests for a specific application, enter the name of the application in the command: <br><br><pre> <code class="hljs bash">(venv:tutorial)$ python manage.py <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> contacts Creating <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> database <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> <span class="hljs-string"><span class="hljs-string">'default'</span></span>... . ---------------------------------------------------------------------- Ran 1 tests <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 0.001s OK Destroying <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> database <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> <span class="hljs-string"><span class="hljs-string">'default'</span></span>... (venv:tutorial)$</code> </pre> <br>  Another interesting thing to note before moving on is the first and last line of output: <code>Creating test database</code> and <code>Destroying test database</code> .  Some tests require access to the database, and since we don‚Äôt want to interfere with test data with ‚Äúreal‚Äù (for various reasons, not the least of which is predetermination), Django helpfully creates a test base for us before running the tests.  Essentially, a new database is created, and then <code>syncdb</code> started for it.  If the test class is a descendant of the <code>TestCase</code> class (like ours), Django will also reset the data to default values ‚Äã‚Äãafter running each test, so the changes in one of the tests will not affect the others. <br><br><h2>  2.5.  Summary </h2><br><ul><li>  The model defines the fields in the table, and contains the business logic. </li><li>  The <code>syncdb</code> creates tables in your database from models.  <em>In Django version 1.7 and higher, instead of the <code>syncdb</code> you must first use the <code>makemigrations</code> command ‚Äî to create migrations, and then the <code>migrate</code> command ‚Äî to make changes to the database.</em> </li><li>  The model manager allows you to operate with collections of instances: requests, creation, etc. </li><li>  Write unit tests for the methods you added to the model. </li><li>  The <code>test</code> control command runs unit tests. </li></ul><br><blockquote>  <em><u>Translator's Note:</u></em> <br>  <em>In order to test our, still empty, application, you need to run the following command:</em> <br><br><pre> <code class="hljs mel">(venv:tutorial)$ <span class="hljs-keyword"><span class="hljs-keyword">python</span></span> ./manage.py runserver <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>:<span class="hljs-number"><span class="hljs-number">8080</span></span></code> </pre> <br>  <em>This will launch the built-in server, the functionality of which Django graciously provides us.</em>  <em>The parameters after the <code>runserver</code> indicate the ip-address and port that the server will listen to.</em>  <em>In our case, the server will receive requests from all ip-addresses when accessing port 8080.</em> <em><br><br></em>  <em>I use to develop a home server with an internal IP of 192.168.1.51.</em>  <em>So in order to see the result of the development server in the browser, I go to <a href="http://192.168.1.51:8080/">http://192.168.1.51:8080/</a> .</em>  <em>You must substitute the address of your server.</em> <em><br><br></em> <div style="text-align:center;"><img src="https://habrastorage.org/files/339/803/b63/339803b63efd497285ec6b6ef79d1261.png"></div></blockquote><br><hr><br>  <em>Do you think it is necessary to continue translating the remaining chapters?</em>  <em>Was the translation helpful to you?</em> <em><br></em>  <em>I would be glad to constructive criticism in the comments.</em> <em><br></em>  <em>I ask you to report errors and inaccuracies of the translation in a personal message.</em> <em><br></em> <br>  <em>The image used at the beginning of the post was created as a variation of the <a href="http://aruseni.deviantart.com/art/Django-white-and-green-318200642">image of the</a> user <a href="https://habrahabr.ru/users/magic2lantern/" class="user_link">MaGIc2laNTern</a></em> </div><p>Source: <a href="https://habr.com/ru/post/240463/">https://habr.com/ru/post/240463/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../240453/index.html">Atomic battery for data center</a></li>
<li><a href="../240455/index.html">How are hackathons? And a week before PayPal BattleHack 2014 Moscow</a></li>
<li><a href="../240457/index.html">The second wave of speakers at the mobile developers conference #MBTLDev</a></li>
<li><a href="../240459/index.html">How, when and what to talk with your site visitor to increase conversion?</a></li>
<li><a href="../240461/index.html">Technological trends of the future</a></li>
<li><a href="../240465/index.html">Welcome to Kharkov on –°iklum Mobile Saturday 25 October</a></li>
<li><a href="../240469/index.html">MindCub3r in Russian - we make a robot that can assemble a Rubik's Cube (article updated)</a></li>
<li><a href="../240471/index.html">Utilities in (FREE status) for the calculation of wave resistance and not only ...</a></li>
<li><a href="../240473/index.html">Demo versions from Google Play, data on revenues from games for 2014, consolidation of market leaders from Japan - and other news of the week for a mobile developer</a></li>
<li><a href="../240475/index.html">Creating Today Extension for iOS 8</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>