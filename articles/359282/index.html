<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Navigation Architecture Component. Practical look</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At the recent Google IO 2018 , among other things, was presented a solution that helps in the implementation of navigation in applications. 


 Immedi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Navigation Architecture Component. Practical look</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/ub/d4/7b/ubd47bxo085m7_s6wnuhke6r7-w.png"></p><br><p>  At the recent <a href="https://www.youtube.com/playlist%3Flist%3DPLOU2XLYxmsIInFRc3M44HUTQc3b_YJ4-Y">Google IO 2018</a> , among other things, was <a href="https://www.youtube.com/watch%3Fv%3D8GCXtCjtg40">presented a solution</a> that helps in the implementation of navigation in applications. </p><br><p>  Immediately struck by the fact that the graph of navigation can be viewed in the UI editor, something reminiscent of storyboards from iOS-development.  This is really interesting and new for Android developers. </p><br><p>  And since I am also the creator of the fairly popular <a href="https://github.com/terrakok/Cicerone">Cicerone</a> library, which allows you to work with navigation on android, I received a lot of questions about whether it was time to migrate to Google‚Äôs solution, and why it is better / worse.  Therefore, as soon as free time appeared, I created a test project and began to understand. </p><a name="habracut"></a><br><h3 id="postanovka-zadachi">  Formulation of the problem </h3><br><p>  I will not repeat the introductory words about the new architectural component of the Navigation Architecture Component, about setting up the project and the main entities in the library ( <a href="https://habr.com/company/hh/blog/358414/">this was already done by Sasha Blinov</a> ), but I will go from the practical side and try the library in battle, examine the possibilities and applicability to real cases. </p><br><p>  I threw on a sheet of paper a graph of screens with transitions that I would like to implement. </p><br><p><img src="https://habrastorage.org/webt/yo/pk/s2/yopks2fbcoodyjfmyxegml8ja1k.jpeg"></p><br><blockquote>  I want to note that navigation in this case is considered within one Activity, I practice this approach not on the first draft, and it showed itself perfectly (discussion of this approach is not the goal of this article). </blockquote><p>  This graph I tried to describe the most frequent cases that are found in the applications: </p><br><ol><li>  A - start screen.  With it, the application starts when you start from the menu. </li><li>  There are several straight transitions: A-&gt; B, B-&gt; C, C-&gt; E, B-&gt; F </li><li>  From A you can run a separate flow ab </li><li>  From F, you can switch to new F screens by building a chain of identical FFF -... </li><li>  From F, you can also run the flow ab </li><li>  The flow ab is a sequence of two screens, where from the b screen you can exit the flow to the screen from which the flow was started. </li><li>  From screen C, you can go to D, replacing the screen, that is, from the chain ABC, go to ABD </li><li>  From screen E, you can switch to D, replacing two screens, that is, from the ABCE chain, go to ABD </li><li>  From screen E, you can return to screen B </li><li>  From screen D, you can return to screen A </li></ol><br><h3 id="realizaciya">  Implementation </h3><br><p>  After transferring such a graph to the code of the test Android application, it turned out beautifully: </p><br><p><img src="https://habrastorage.org/webt/lw/tj/wd/lwtjwdhxuz3vryvu6xvoahjfi_e.jpeg"></p><br><p>  At first glance, it is very similar to the expected result, but let's take it in order. </p><br><p>  <strong>1.</strong> The start screen is set by the property </p><br><pre><code class="xml hljs">app:startDestination="@id/AFragment"</code> </pre> <br><p>  It works as expected, the application starts from it. </p><br><p>  <strong>2.</strong> Rectilinear transitions look and work correctly. </p><br><p>  <strong>3. and 5.</strong> Nested navigation is easily described and launched as a simple screen.  And here is the <strong>first interesting feature</strong> : I expected the embedded navigation to be somehow connected with the embedded fragments, but it turned out that this is just a convenient representation in the UI-graph, but in practice <strong>everything works on one common stack of fragments</strong> . </p><br><p>  <strong>4.</strong> Running a chain of identical screens is done without problems.  And here you can use the <strong>special property of the transition.</strong> </p><br><pre> <code class="xml hljs">app:launchSingleTop="true"</code> </pre> <br><p>  When specifying this mode, before going to the new screen, the current top screen in the stack will be checked.  If the new and current screens are of the same type, the current screen will be deleted, that is, the upper screen will be constantly re-created without increasing the stack. </p><br><p>  The <strong>first bug</strong> is hidden here: if you open the F screen several times with the <code>app:launchSingleTop="true"</code> parameter <code>app:launchSingleTop="true"</code> and then press the "back" button, you will return to the B screen, but the F screen will remain "hanging" from above. </p><br><p>  <em>I can assume that this is due to the fact that the fragment manager inside has saved the transaction from B to the first instance F, and we have already changed it to a new one that will not be known to him.</em> </p><br><p>  <strong>6.</strong> A separate flow from two screens works fine, but the problem is that it is impossible to explicitly describe the behavior, that from the second screen of this flow you need to return to the running screen! </p><br><p>  Here we come to an important property of the UI-graph: <strong>it is impossible to describe backward transitions on a graph!</strong>  <strong>All arrows - this is the creation of a new screen and the transition to it!</strong> </p><br><p>  That is, to make the transition "back" in the stack, you must work with the code.  The simplest solution for our case is to call <code>popBackStack()</code> twice in a row, the new navigation does not help here.  And for more complex flow it will be necessary to invent other solutions. </p><br><pre> <code class="hljs pgsql">Navigation.findNavController(<span class="hljs-keyword"><span class="hljs-keyword">view</span></span>).apply { popBackStack() popBackStack() }</code> </pre> <br><p>  <strong>7.</strong> Replace screen C with D by specifying in the transition properties </p><br><pre> <code class="xml hljs">app:popUpTo="@+id/BFragment"</code> </pre> <br><p>  as you can see, here we have <strong>rigidly tied the logic of the transition</strong> between C and D to the previous screen B. This is also not the best place in the new library. </p><br><p>  <strong>8.</strong> Similarly with the transition from E to D - add the <code>app:popUpTo="@+id/BFragment"</code> , and it works as we wanted, but with reference to the screen B </p><br><p>  <strong>9.</strong> As I explained above, there are no returns on the UI-graph.  Therefore, returning from screen E to screen B can only be done from the code by calling <code>popBackStack(R.id.BFragment)</code> to the desired screen.  But if it is <em>not necessary for you to return</em> to screen B, but it is possible to create a new screen B, then this is done by switching to the UI-graph with the installation of two parameters: </p><br><pre> <code class="xml hljs">app:popUpTo="@+id/BFragment" app:popUpToInclusive="true"</code> </pre> <br><p>  This will throw off the stack to screen B, including him, and then create a new screen B from above. <br>  <strong>In real projects, such logic is certainly not suitable</strong> , but as an opportunity, it is interesting. </p><br><p>  <strong>10.</strong> Return to screen A, as you already understood, it is impossible to describe on the graph.  It is necessary to do it from the code.  But following the example of the previous case, you can throw off all the screens and create a new screen A at the root.  To do this, create a transition from D to A and add a special property </p><br><pre> <code class="xml hljs">app:clearTask="true"</code> </pre> <br><p>  Now, when calling such a transition, the entire stack of fragments will be cleared first. </p><br><p>  One unexplored parameter from the navigation editor UI remains: </p><br><pre> <code class="xml hljs">app:launchDocument="true"</code> </pre> <br><p>  I did not understand its purpose, but most likely it just does not work as stated in the documentation: </p><br><blockquote>  If you want to see the system Overview screen.  It will bring you the document. <br><br>  Click here for a copy of the document.  You have been taken to their home screen. </blockquote><br><h3 id="vyvody">  findings </h3><br><p>  From my experiments and a small study of the source code, we can conclude: the new navigation is just a UI wrapper for working with the fragment manager (for the case of an application in one Activity).  All arrow transitions are given a unique ID and a set of parameters by which the transaction of fragments is performed on the old ‚Äúgood‚Äù fragment manager.  The library is still in deep alpha, but already now bugs are noticeable that directly indicate the known problems of the manager‚Äôs fragment. </p><br><p>  If we need to somehow influence the stack of fragments and make a return on the previous screen, we will have to work in the old manner with the fragment manager. </p><br><p>  If you cause navigation when the application is minimized, the application will drop with the classic <br> <code>java.lang.IllegalStateException: Can not perform this action after onSaveInstanceState</code> </p> <br><p>  To navigate, you need access to the view to search for navController <br> <code>Navigation.findNavController(view)</code> </p> <br><p>  These are the problems that the <a href="https://github.com/terrakok/Cicerone">Cicerone</a> library solves, so comparing them makes little sense.  But you can combine!  Because there are useful sides to Google Navigation: </p><br><ul><li>  <strong>Visual graph</strong>  For small projects can be a very helpful hint. </li><li><p>  <strong>Description of</strong> screen <strong>input parameters</strong> and verification without launching the application directly in the studio. <br>  To do this, you need to connect an additional <a href="https://developer.android.com/topic/libraries/architecture/adding-components">Gradle plugin</a> and describe the required parameters in the xml properties of the screen. </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fragment</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/confirmationFragment"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.example.cashdog.cashdog.ConfirmationFragment"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fragment_confirmation"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tools:layout</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@layout/fragment_confirmation"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"amount"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:defaultValue</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">‚Äù0‚Äù</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"integer"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br></li><li>  Linking <strong>Deep Link</strong> to launch any screen from a graph. <br>  I was not able to verify this feature, but there is a suspicion that it is also made in the forehead, so there will simply be a different root screen, and not a complete chain of screens, as we would like.  But it is not exactly. </li><li>  The ability to create <strong>reusable parts of the graph</strong> is ‚ÄúNested Graph‚Äù.  That is, to carry out some part of the graph in a nested graph, which can be run from several places. </li></ul><br><h3 id="testovyy-proekt">  Test project </h3><br><p>  All experiments can be viewed and touched <a href="https://github.com/terrakok/google-navigation-test">on Github.</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/359282/">https://habr.com/ru/post/359282/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../359270/index.html">If you wanted to write to colleagues how to do something</a></li>
<li><a href="../359274/index.html">Google I / O 2018 User Guide</a></li>
<li><a href="../359276/index.html">Notes IoT provider. Introduction</a></li>
<li><a href="../359278/index.html">The most important thing to know about GDPR</a></li>
<li><a href="../359280/index.html">Survey: fraudulent ICO attracted more than $ 1 billion</a></li>
<li><a href="../359284/index.html">How I measured the evolution of admins in programmers</a></li>
<li><a href="../359286/index.html">Closed Q & A sessions with Giorgio Sardo</a></li>
<li><a href="../359290/index.html">Developing a game for several platforms: post-mortem Cat Quest</a></li>
<li><a href="../359292/index.html">Games and money: risks of legal uncertainty</a></li>
<li><a href="../359294/index.html">Notes IoT provider. Coating</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>