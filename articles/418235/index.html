<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Orchestrated saga or how to build business transactions in services with the pattern database per service</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! My name is Konstantin Evteev, I work in Avito as the head of the DBA unit. Our team develops Avito data storage systems, helps in selecting or ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Orchestrated saga or how to build business transactions in services with the pattern database per service</h1><div class="post__text post__text-html js-mediator-article"><p>  Hello!  My name is Konstantin Evteev, I work in Avito as the head of the DBA unit.  Our team develops Avito data storage systems, helps in selecting or issuing databases and related infrastructure, supports Service Level Objective for database servers, and we are also responsible for efficient use of resources and monitoring, advising on design, and possibly developing microservices, tied to storage systems or services for the development of the platform in the context of storage. </p><br><p>  I want to tell how we decided one of the challenges of the microservice architecture - carrying out business transactions in the infrastructure of services built using the Database per service pattern.  I spoke on this topic at the <a href="http://www.highload.ru/siberia/2018/">Highload ++ Siberia 2018</a> conference. </p><br><img src="https://habrastorage.org/webt/r3/bz/ty/r3bztya5eso1a_fkh9laghkue9k.png" alt="image"><a name="habracut"></a><br><p><br></p><br><h2 id="teoriya-maksimalno-kratko">  Theory.  As briefly as possible </h2><br><p>  I will not describe in detail the theory of sagas.  I will give only a brief introductory, so that you understand the context. </p><br><p>  As it was before (from the start of Avito until 2015 - 2016): we lived in a monolith, with monolithic bases and monolithic applications.  At some point, these conditions began to prevent us from growing.  On the one hand, we came up against the performance of the server with the main base, but this is not the main reason, since the performance issue can be solved, for example, using sharding.  On the other hand, the monolith has a very complex logic, and at a certain stage of growth, the delivery of changes (releases) becomes very long and unpredictable: there are a lot of unobvious and complex dependencies (everything is closely related), testing is also time consuming, in general there are a lot of problems.  The solution is to switch to microservice architecture.  At this stage, we have a question with business transactions strongly tied to ACID, provided by a monolithic base: there is no clarity on how to migrate this business logic.  When working with Avito, there are many different scenarios implemented by several services where integrity and consistency of data is very important, for example, buying a premium subscription, writing off money, applying services to a user, purchasing VAS packages ‚Äî in unexpected circumstances or accidents, things might not go unexpectedly. according to plan.  We found the solution in the sagas. </p><br><p>  I like the <a href="">technical description of the</a> sagas that Kenneth Salem led in 1987 and Hector Garcia-Molina, one of the current members of the Oracle board of directors.  As the problem was formulated: there are a relatively small number of long-lived transactions, which for a long time prevent the implementation of small, less demanding to resources and more frequent operations.  As a desired result, you can give an example from life: surely many of you were queuing to otkerokopirovat documents, and the operator Xerox, if he had the task to copy a whole book, or just many copies, from time to time made copies of other members of the queue.  But resource utilization is only part of the problem.  The situation is aggravated by long locks when performing resource-intensive tasks, a cascade of which will line up in your DBMS.  In addition, errors may occur during a long-running transaction: the transaction will not end and a rollback will begin.  If the transaction was long, then the rollback will also take a long time, and probably will still be retry from the application.  In general, "everything is quite interesting."  The solution proposed in the technical description of "SAGAS": split the long transaction into parts. </p><br><p>  It seems to me that many approached this without even reading this document.  We have repeatedly talked about our defproc (deferred procedures implemented with pgq).  For example, when blocking a user for fraud, we quickly execute a short transaction and respond to the client.  In this short transaction, including, we set the task in the transaction queue, and then asynchronously, in small batches, for example, with ten announcements, block its declarations.  We did this by implementing the <a href="https://www.pgcon.org/2008/schedule/attachments/55_pgq.pdf">transaction queues from Skype</a> . </p><br><p>  But our story today is a little different.  We need to look at these problems from the other side: cutting the monolith into microservices built using the database per service pattern. </p><br><p>  One of the most important parameters for us is reaching the maximum cutting speed.  Therefore, we decided to transfer the old functionality and all the logic as it is to microservices, without changing anything at all.  Additional requirements that we needed to fulfill: </p><br><blockquote><ul><li>  provide dependent data changes for business critical data; </li><li>  be able to set a strict order; </li><li>  Comply with 100% consistency - reconcile data even in case of accidents; </li><li>  guarantee the operation of transactions at all levels. </li></ul><br></blockquote><p>  Under the above requirements, a solution in the form of an orchestrated saga is best suited. </p><br><h2 id="realizaciya-orkestriruemoy-sagi-v-vide-servisa-pg-saga">  Implementing orchestrated saga as a PG Saga service </h2><br><p>  This is the PG Saga service. </p><br><p><img src="https://habrastorage.org/webt/mi/zm/0f/mizm0fidaxgpcv3wxoway4ksgoe.jpeg" alt="image"></p><br><p>  PG in the title, because as a service store uses synchronous PostgreSQL.  What else is inside: </p><br><ul><li>  API; </li><li>  executor; </li><li>  checker; </li><li>  healthchecker; </li><li>  compensator. </li></ul><br><p>  The diagram also shows the service owner of the sagas, and below - the services that will perform the steps of the saga.  They may have different storages. </p><br><h4 id="kak-eto-rabotaet">  How it works </h4><br><p>  Consider the example of buying VAS-packages.  VAS (Values-added services) - paid services to advertise. </p><br><p>  First, the service owner of the saga must register the creation of the saga in the service saga </p><br><p><img src="https://habrastorage.org/webt/6d/yo/zs/6dyozsxy0_qfoqmrtlrbijfaxeu.jpeg" alt="image"></p><br><p>  After that, it generates the saga class already with Payload. </p><br><p><img src="https://habrastorage.org/webt/ul/hr/ic/ulhric8ofs455lgaz4mozdhs2l8.jpeg" alt="image"></p><br><p>  Then, already in the saga service, executor picks up the previously created saga call from the storage and begins to perform it step by step.  The first step in our case is the purchase of a premium subscription.  At this moment, money is reserved in the billing service. </p><br><p><img src="https://habrastorage.org/webt/hf/re/yi/hfreyiq0vpgiojytn2gts5ws1ww.jpeg" alt="image"></p><br><p>  Then, in the user service, VAS operations are applied. </p><br><p><img src="https://habrastorage.org/webt/cy/lg/_m/cylg_mbibq4b6wfqvu_wz7ylcre.jpeg" alt="image"></p><br><p>  Then, VAS services are already operational, and packages of WAS are created.  Further, other steps are possible, but they are not so important to us. </p><br><p><img src="https://habrastorage.org/webt/h6/3r/r8/h63rr8iufd3m4tzovgonjywezhu.jpeg" alt="image"></p><br><h2 id="avarii">  Accidents </h2><br><p>  Accidents can happen in any service, but there are well-known tricks on how to prepare for them.  In a distributed system, it is important to know about these techniques.  For example, one of the most important limitations is that the network is not always reliable.  Approaches to solve interoperability problems in distributed systems: </p><br><blockquote><ol><li>  Retry. </li><li>  Mark each operation with an idempotent key.  This is necessary to avoid duplication of operations.  You can read more about idempotent keys in <a href="https://brandur.org/idempotency-keys">this</a> article. </li><li>  Compensate for transactions - an action characteristic of the sagas. </li></ol><br></blockquote><br><h4 id="kompensaciya-tranzakciy-kak-eto-rabotaet">  Transaction Compensation: How It Works </h4><br><p>  For each positive transaction, we need to describe the reverse actions: the business scenario of a step in case something goes wrong. </p><br><p>  In our implementation, we offer the following compensation scenario: </p><br><p>  If a step of the saga ended in failure, and we did a lot of retry, then there is a chance that the last repetition of the operation was a success, but we just did not get an answer.  We will try to compensate for the transaction, although this step is not necessary if the service provider of the problem step is really broken and completely inaccessible. </p><br><p>  In our example, it will look like this: </p><br><ol><li>  Turn off VAS packages. </li></ol><br><p><img src="https://habrastorage.org/webt/rf/6s/94/rf6s943lzidqq_hfyuu-_fnbd_a.jpeg" alt="image"></p><br><ol><li>  We cancel user operation. </li></ol><br><p><img src="https://habrastorage.org/webt/qv/wl/tx/qvwltxbftjc_diwxtudv5ym0mde.jpeg" alt="image"></p><br><ol><li>  Cancellation of funds. </li></ol><br><p><img src="https://habrastorage.org/webt/0b/_r/t9/0b_rt9gobty3zu1xhz6uqjo2cf8.jpeg" alt="image"></p><br><h4 id="chto-delat-esli-i-kompensaciya-ne-rabotaet">  What to do if compensation does not work </h4><br><p>  Obviously, it is necessary to act in approximately the same scenario.  Again, use retry, idempotent keys for compensating transactions, but if nothing works and this time, for example, the service is not available, you need to contact the service-owner of the saga, informing you that the saga has failed.  Further more serious actions: to escalate the problem, for example, for manual investigation or launching automation to solve such problems. </p><br><p>  What else is important: Imagine that any step of the saga service is unavailable.  Surely, the initiator of these actions will still do some kind of retry.  As a result, your saga service takes the first step, the second step, and its performer is unavailable, you cancel the second step, cancel the first step, and anomalies related to the lack of isolation may occur.  In general, the saga service in this situation is engaged in useless work, which still generates pressure and errors. </p><br><p> How to do?  Healthchecker should poll the services that perform the sag steps and see if they work.  If the service has become unavailable, then there are two ways: the sagas that are in operation - to compensate, and the new sagas - either to prevent the creation of new instances (calls), or to create, without taking them into work with the executer, so that the service does not work superfluous actions. </p><br><h4 id="esche-odin-scenariy-s-avariey">  Another accident scenario </h4><br><p>  Imagine that we are again making the same premium subscription. </p><br><ol><li>  We buy VAS-packages and reserve money. </li></ol><br><p><img src="https://habrastorage.org/webt/tn/ms/7p/tnms7pcslyj_8f4hftsqtzzlspm.jpeg" alt="image"></p><br><ol><li>  We apply to the user of the service. </li></ol><br><p><img src="https://habrastorage.org/webt/by/ep/fe/byepfee_drperqqj2on1hg3gq-a.jpeg" alt="image"></p><br><ol><li>  We create VAS packages. </li></ol><br><p><img src="https://habrastorage.org/webt/yq/l_/sf/yql_sf9gnlyolfstvyug4gwaday.jpeg" alt="image"></p><br><p>  It seems to be good.  But suddenly, when the transaction was completed, it turns out that asynchronous replication is used in the user service and an accident has occurred on the master base.  There can be several reasons for a replica lagging: the presence of a specific load on a replica, which either slows replication playback speed or blocks replication playback.  In addition, the source (master) is overloaded, and a lag of sending changes appears on the source side.  In general, for some reason, the replica was lagging behind, and the changes of the successfully completed step after the accident suddenly disappeared (result / condition). </p><br><p><img src="https://habrastorage.org/webt/hu/nh/hu/hunhhuizvvxmajf0hukmvbhzpnu.jpeg" alt="image"></p><br><p>  To do this, we implement another component in the system - use the checker.  The checker goes through all the steps of successful sagas through time that is obviously greater than all possible lags (for example, after 12 hours), and checks whether they are still successfully completed.  If the step is suddenly not executed, the saga rolls back. </p><br><p><img src="https://habrastorage.org/webt/kn/9n/cy/kn9ncyccg350yxl-orc9jamngbm.jpeg" alt="image"></p><br><p><img src="https://habrastorage.org/webt/hz/af/-m/hzaf-mwke2a8cvi8mdlb_uzquxy.jpeg" alt="image"></p><br><p><img src="https://habrastorage.org/webt/jg/ex/dc/jgexdcrgimsuugdqw27gay_i2kw.jpeg" alt="image"></p><br><p><img src="https://habrastorage.org/webt/xp/hv/mo/xphvmouowjv2tgln0-o1mf43rts.jpeg" alt="image"></p><br><p>  There may still be situations when, after 12 hours, there is already nothing left to cancel - everything changes and moves.  In this case, instead of the cancellation scenario, the solution might be to signal the service of the owner of the saga that this operation was not completed.  If the cancellation operation is impossible, say, you need to cancel after the money is credited to the user, and its balance is already zero, and the money cannot be written off.  We have such scenarios are always solved in the direction of the user.  You may have another principle, this is consistent with the representatives of the product. </p><br><p>  As a result, as you can see, in different places for the integration with the sagas service you need to implement a lot of different logic.  Therefore, when client teams want to create a saga, they will have a very large set of very unobvious tasks.  First of all, we create a saga so that duplication does not work out, for this we work with some idempotent operation of creating a saga and its tracking.  Also, the services need to realize the ability to track every step of each saga, in order not to execute it twice on the one hand, and to be able to answer on the other hand whether it was actually executed.  And all these mechanisms must somehow be maintained so that the service storages do not overflow.  In addition, there are many languages ‚Äã‚Äãin which services can be written, and a huge selection of repositories.  At each stage, you need to understand the theory and implement all this logic on different parts.  If you do not, you can make a whole bunch of mistakes. </p><br><p>  There are many correct ways, but there are no less situations where you can ‚Äúshoot yourself a limb‚Äù.  In order for the sagas to work correctly, you need to encapsulate all the above mechanisms in client libraries that will transparently implement them for your clients. </p><br><h4 id="primer-logiki-generacii-sagi-kotoruyu-mozhno-skryt-v-klientskoy-biblioteke">  An example of saga generation logic that can be hidden in the client library </h4><br><p>  You can do it differently, but I suggest the following approach. </p><br><ol><li>  We get the request ID, on which we have to create a saga. </li><li>  We go to the saga service, we get its unique identifier, we save it in the local storage in conjunction with the request ID from item 1. </li><li>  We start the saga with payload in the saga service.  An important caveat: I suggest local operations of the service, which creates a saga, to arrange as the first step of the saga. </li><li>  There is a kind of race when the saga service can perform this step (point 3), and our backend, which initiates the creation of the saga, will also perform it.  To do this, we do idempotent operations everywhere: one of them performs it, and the second call simply receives ‚ÄúOK‚Äù. </li><li>  We call the first step (point 4) and only after that we respond to the client who initiated this action. </li></ol><br><p>  In this example, we are working with the saga as a database.  You can send a request, and then the connection may be terminated, but the action will be executed.  Here is about the same approach. </p><br><h2 id="kak-eto-vse-proverit">  How to check it all </h2><br><p>  It is necessary to cover the entire service sagas tests.  Most likely, you will make changes, and tests written at the start will help to avoid unexpected surprises.  In addition, it is necessary to check the sagas themselves.  For example, how we have arranged the testing of the service of the sagas and the testing of the sequence of the sagas in the framework of one transaction.  There are different blocks of tests.  If we are talking about the saga service, he is able to perform positive transactions and compensation transactions, if the compensation does not work, he informs the service owner of the sagas.  We write tests in general, to work with an abstract saga. </p><br><p>  On the other hand, positive transactions and compensation transactions on services that perform the steps of the sagas are the same simple API, and tests of this part are in the area of ‚Äã‚Äãresponsibility of the team owning this service. </p><br><p>  And then the team owner of the saga writes end-to-end tests, where it checks that all business logic works correctly when the saga is executed.  The end-to-end test takes place on a full-fledged dev-environment, all instances of services, including the service sagas, are raised, and the business scenario is being tested there. </p><br><p><img src="https://habrastorage.org/webt/qb/j0/gn/qbj0gnyhcjvk2lz4djeip_qfaqe.png" alt="image" width="340" height="233" align="right"><br>  <strong>Total:</strong> </p><br><ul><li>  write more unit tests; </li><li>  write integration tests; </li><li>  write end-to-end tests. <br><br clear="right">  The next step is the CDC.  Microservice architecture affects the specifics of tests.  In Avito, we adopted the following approach to testing microservice architecture: Consumer-Driven Contracts.  This approach helps, above all, to highlight the problems that can be identified in the end-to-end tests, but the end-to-end test is ‚Äúvery expensive.‚Äù </li></ul><br><p>  What is the essence of the CDC?  There is a service that provides a contract.  He has an API - this is a provider.  And there is another service that calls the API, that is, uses the contract - the consumer. </p><br><p>  Service-consumer writes tests for the provider contract, and the tests that only the contract will check are non-functional tests.  It is important for us to ensure that if we change the API, we will not break steps in this context.  After we have written the tests, another service broker element appears - it records the information on CDC tests.  Each time the provider‚Äôs service changes, it will raise isolated environments and run tests that consumer has written.  What is the result: the team that generates the sagas, writes tests for all the steps of the saga and registers them. </p><br><p><img src="https://habrastorage.org/webt/n1/i-/hm/n1i-hmjmyxs9iavcoxzoem2mcly.jpeg" alt="image"><br>  Frol Kryuchkov told RIT ++ about how the Avito implemented the CDC approach for testing microservices.  Abstracts can be found on the website <a href="https://backendconf.ru/2018/abstracts/3440.html">Backend.conf</a> - I recommend to read. </p><br><h2 id="vidy-sag">  Types of sagas </h2><br><h4 id="po-poryadku-vyzova-funkciy">  In order of function call </h4><br><p>  a) unordered - the functions of the saga are called in any order and do not wait for each other to complete; <br>  b) ordered - the functions of the saga are called in the specified order, one after another, the next is not called until the previous one is completed; <br>  c) mixed - for some of the functions, an order is set, but for some, it is not, but it is set before or after what stages they are to be performed. </p><br><p>  Consider a specific scenario.  In the same scenario of buying a premium subscription, the first step is to reserve money.  Now we can make changes to the user and creating bonus packages in parallel, and we will send notifications to the user only when these two steps are completed. <br><img src="https://habrastorage.org/webt/d8/a0/r7/d8a0r7wv7mq1a8gdphaq0aug1oe.png" alt="image"></p><br><h4 id="po-polucheniyu-rezultata-vyzova-funkciy">  Upon receipt of the result of a function call </h4><br><p>  a) synchronous - the result of the function is known immediately; <br>  b) asynchronous - the function returns immediately ‚ÄúOK‚Äù, and the result is returned later, via the callback API of the sagas service from the client service. </p><br><p>  I want to warn you against an error: it is better not to take the synchronous steps of the sagas, especially when implementing an orchestrated saga.  If you take simultaneous steps of the sagas, the saga service will wait until this step is completed.  This is an extra burden, unnecessary problems in the service of the sagas, since it is one, and there are many participants in the sagas. </p><br><h2 id="masshtabirovanie-sag">  Scaling sagas </h2><br><p>  Scaling depends on the size of the system you are planning.  Consider a single instance of the repository: </p><br><blockquote><ul><li>  one handler of steps of the saga, we process steps with batches; </li><li>  n handlers, we implement the "comb" - we take the steps of the remainder of the division: when each executor gets its steps. </li><li>  n handlers and skip locked - will be even more efficient and more flexible. </li></ul><br></blockquote><p>  And only then, if you know in advance that you will run into the performance of a single server in a DBMS, you need to do a sharding - n instances of databases that will work with your data set.  Sharding can be hidden behind the API service sagas. </p><br><h4 id="bolshe-gibkosti">  More flexibility </h4><br><p>  In addition, in this pattern, at least in theory, the client service (performing the saga step) can access and fit into the saga service, and participation in the saga can also be optional.  There may be another scenario: if you have already sent an email, you cannot compensate for the action - you cannot return the letter back.  But you can send a new letter, that the previous one was wrong, and it looks like so-so.  It is better to use the scenario when the saga will be played only forward, without any compensation.  If it does not play forward, then it is necessary to inform the service owner of the saga about the problem. </p><br><h4 id="kogda-nuzhen-lok">    </h4><br><p>      :        ,  .  ‚Äî  .      :    . </p><br><p>         ,  ,    .     ,         .    -  ,     .           .   defproc         ,         ,         . </p><br><p>  How to do it?         ,       ,    ,           , ,  -      ,  .          .   .    :       ,       ,            . </p><br><p>   -,  ,    .   ,      ,    .   , ,    .        .       ‚Äî    ,     ,        . </p><br><h2 id="acid--bez-izolyacii"> ACID ‚Äî   </h2><br><p>    ,     ,  .            .   ‚Äî       durability.    .         .  ,     .   - ,  -  - ,          </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>T</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>T</mi><mi>j</mi><mo stretchy=&quot;false&quot;>(</mo><mi>o</mi><mi>r</mi><mi>C</mi><mi>i</mi><mo stretchy=&quot;false&quot;>)</mo><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="58.618ex" height="2.66ex" viewBox="0 -832 25238.1 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-54" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-69" x="704" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-72" x="1050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-65" x="1501" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-61" x="1968" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-64" x="2497" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-73" x="3021" y="0"></use><g transform="translate(3768,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-6F" x="5603" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-74" x="6088" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-68" x="6450" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-65" x="7026" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-72" x="7493" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-72" x="7944" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-74" x="8396" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-72" x="8757" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-61" x="9209" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-6E" x="9738" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-73" x="10339" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-61" x="10808" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-63" x="11338" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-74" x="11771" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-69" x="12133" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-6F" x="12478" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-6E" x="12964" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-77" x="13564" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-72" x="14281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-69" x="14732" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-74" x="15078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-65" x="15439" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-73" x="15906" y="0"></use><g transform="translate(16653,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-54" x="18488" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-6A" x="19192" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMAIN-28" x="19605" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-6F" x="19994" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-72" x="20480" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-43" x="20931" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-69" x="21692" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMAIN-29" x="22037" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-77" x="22427" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-72" x="23143" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-69" x="23595" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-74" x="23940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-65" x="24302" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-73" x="24768" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&gt;</mo><mi>T</mi><mi>j</mi><mo stretchy="false">(</mo><mi>o</mi><mi>r</mi><mi>C</mi><mi>i</mi><mo stretchy="false">)</mo><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-1">Ti reads => other rtransaction writes => Tj (or Ci) writes</script></p><br><p>   <strong></strong>  ‚Äî      - ,  - , , -    ,      .    , - ,  -   . </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>T</mi><mi>i</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>C</mi><mi>i</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="50.989ex" height="2.057ex" viewBox="0 -780.1 21953.6 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-54" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-69" x="704" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-77" x="1050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-72" x="1766" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-69" x="2218" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-74" x="2563" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-65" x="2925" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-73" x="3391" y="0"></use><g transform="translate(4138,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-6F" x="5973" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-74" x="6459" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-68" x="6820" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-65" x="7397" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-72" x="7863" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-74" x="8315" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-72" x="8676" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-61" x="9128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-6E" x="9657" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-73" x="10258" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-61" x="10727" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-63" x="11257" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-74" x="11690" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-69" x="12052" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-6F" x="12397" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-6E" x="12883" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-72" x="13483" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-65" x="13935" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-61" x="14401" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-64" x="14931" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-73" x="15454" y="0"></use><g transform="translate(16201,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-43" x="18036" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-69" x="18797" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-77" x="19142" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-72" x="19859" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-69" x="20310" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-74" x="20656" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-65" x="21017" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-73" x="21484" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>i</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&gt;</mo><mi>C</mi><mi>i</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">Ti writes => other transaction reads => Ci writes</script></p><br><p>  <strong></strong>  ‚Äî               . </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>T</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>T</mi><mi>j</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="50.154ex" height="2.419ex" viewBox="0 -780.1 21594.1 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-54" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-69" x="704" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-72" x="1050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-65" x="1501" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-61" x="1968" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-64" x="2497" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-73" x="3021" y="0"></use><g transform="translate(3768,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-6F" x="5603" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-74" x="6088" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-68" x="6450" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-65" x="7026" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-72" x="7493" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-74" x="7944" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-72" x="8306" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-61" x="8757" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-6E" x="9287" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-73" x="9887" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-61" x="10357" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-63" x="10886" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-74" x="11320" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-69" x="11681" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-6F" x="12027" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-6E" x="12512" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-77" x="13113" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-72" x="13829" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-69" x="14281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-74" x="14626" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-65" x="14988" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-73" x="15454" y="0"></use><g transform="translate(16201,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-54" x="18036" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-6A" x="18741" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-72" x="19153" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-65" x="19605" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-61" x="20071" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-64" x="20601" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/418235/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieLDAWg3ApeRl1ahwss54Ho6RrXw#MJMATHI-73" x="21124" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&gt;</mo><mi>T</mi><mi>j</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-3">Ti reads =>other transaction writes =>Tj reads</script></p><br><p>   : </p><br><blockquote><ol><li>    ,   , ,  ,      . </li><li> ,        .     ,    ,  ,  ,        ,     . </li><li>           . </li><li>   payload        .    eventual consistency ‚Äî       ,  ,      ,     .     ,  , ,       -. </li></ol><br></blockquote><br><h2 id="monitoring">  Monitoring </h2><br><p>             .    ,            .           .       checker.           .   ,   . </p><br><p><img src="https://habrastorage.org/webt/vm/gv/_w/vmgv_wl16ngyd78b78ndyp4v1_4.png" alt="image"></p><br><p><img src="https://habrastorage.org/webt/fv/cz/2l/fvcz2luhdac4ixpzmlbbarex_se.png" alt="image"></p><br><p>       (50%, 75%, 95%, 99%),        ,  -   . </p><br><p>    ,    ‚Äî    ,         .         .     ,  -   .  ,       ‚Äî           . </p><br><p>   .  ,  -   (   )   .    healthchecker   endpoint' info (keep-alive)  . </p><br><p>    .      -.  -,   -  ,           -  .       ,    ,    ,    end-to-end.      - . ,    ,      ‚Äî    . <br>      .           . </p><br><h2 id="na-chto-stoit-obratit-vnimanie">     : </h2><br><h4 id="izbegat-parazitnyh-nagruzok">    </h4><br><p>    ,    healthchecker,   -    ,     .     ,   .       . </p><br><h4 id="izbegat-slozhnoy-logiki-izbytochnoy-funkcionalnosti-v-servise-sag">         </h4><br><p>       ,        .   ,     ,      .         .  choreography     ‚Äî       -   .   ,       choreography- ,      .    choreography  ,    .     ,           . ,      ,       ,      . </p><br><h4 id="integrirovatsya-s-klientami">    </h4><br><p>        .     ,      ,         . ,        +               . </p><br><h4 id="versionnost-api">  API </h4><br><p>   ,   -     -  (  API ),    ,      API.                 API   .     ‚Äî         .           API  ,    ,   100%       . </p><br><p>   ,     ,     ,     ,     .    ‚Äî    ,    ,    .        . </p><br><h4 id="kompensaciya-pri-avariyah">    </h4><br><p>    ,    ,    ,          .        ( )         . </p><br><h4 id="otsutstvie-izolyacii">   </h4><br><p>     ,            ,  ,      ,        . </p><br><h4 id="blokirovki">  </h4><br><p>   .  ,     ,    . </p><br><h4 id="treysing-po-saga-call-id">   saga call ID </h4><br><p>         .  API   ,          . </p><br><h2 id="itog--chto-vybirat">  ‚Äî   </h2><br><p> -      legacy .         ,      (       ¬´¬ª                ).    ¬´ ¬ª?    -  ,     ,    ,   ,    - ,          .     ,  ,           ,         .    ,    ¬´ ¬ª,     ,         -.  .  ‚Äî     .  ,          . </p><br><p>      ,     ,        .  ,  ,      ,   ,      . ,  ,      .       . </p><br><p>            ,   .   . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/418235/">https://habr.com/ru/post/418235/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../418223/index.html">MIT course "Computer Systems Security". Lecture 7: "Sandbox Native Client", part 1</a></li>
<li><a href="../418225/index.html">MIT course "Computer Systems Security". Lecture 7: "Sandbox Native Client", part 2</a></li>
<li><a href="../418227/index.html">MIT course "Computer Systems Security". Lecture 7: "Sandbox Native Client", part 3</a></li>
<li><a href="../418229/index.html">MIT course "Computer Systems Security". Lecture 8: "Model of network security", part 1</a></li>
<li><a href="../418233/index.html">BMW Mnemonic for finding boundary values</a></li>
<li><a href="../418237/index.html">Development of multi-tenant applications on the SAP Cloud Platform in the Neo environment, part 2: authorization and authentication</a></li>
<li><a href="../418239/index.html">48 megapixel for smartphone</a></li>
<li><a href="../418241/index.html">Why gauss? (100 ways to solve an equation system)</a></li>
<li><a href="../418243/index.html">The popular history of astronomy is wrong</a></li>
<li><a href="../418245/index.html">How not to develop a project on Bitrix</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>