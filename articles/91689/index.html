<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Finder component: find your files</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Two days ago, a new component for symfony 2 called Finder appeared on github. And today on Fabien‚Äôs twitter I saw a link to a new post on his blog abo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Finder component: find your files</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/16c/326/ed4/16c326ed49cfbc176dd1221692914fc4.jpg" align="left"><br>  Two days ago, a new component for symfony 2 called <a href="http://github.com/symfony/symfony/tree/master/src/Symfony/Components/Finder/">Finder</a> appeared on github.  And today on <a href="http://twitter.com/fabpot">Fabien‚Äôs twitter</a> I saw a link to a new post on <a href="http://fabien.potencier.org/">his blog</a> about this component.  Well, let's understand.  Under the cut translation of the post <a href="http://fabien.potencier.org/article/43/find-your-files">Find your Files</a> .  So, let's begin. <br><a name="habracut"></a><br>  Best practices for finding files using PHP have evolved a lot in recent years.  Returning in 2004, one of the first things I did in PHP was porting the File :: Find :: Rule Perl module in PHP.  File :: Find :: Rule is a great way to describe files and directories you want to work with.  I used the PHP built-in functions opendir, readdir, and closedir, and it did its job quite well.  The PHP class was named sfFinder, and it can still be found in symfony versions.  Even if a class is attached to symfony, I know that some people use it for tasks of almost all types that are not necessarily related to symfony. <br><br>  But the code began to show its age;  firstly, because I learned a lot about PHP since that time, and also because now there are better options.  There are <a href="http://www.php.net/manual/en/spl.iterators.php">iterators</a> !  PHP 5 comes with a whole bunch of classes for iterations that simplify all types of iterations and iterations.  You can iterate through the standard foreach operator, a very powerful PHP construct. <br><br><h4>  <b>PHP iterators</b> </h4><br>  So, how to get all files and directories recursively using PHP iterators?  Frankly, I do not know.  Well, I more or less know which classes to use and how to build them, but in order not to bother, I always use an existing block of code to do this correctly.  Here is the code: <br><blockquote><code><font color="black"><font color="#008000">//     ...     (symlink)</font> <br> $flags = \FilesystemIterator::SKIP_DOTS | \FilesystemIterator::FOLLOW_SYMLINKS; <br> <font color="#008000">//     </font> <br> $iterator = <font color="#0000ff">new</font> \RecursiveDirectoryIterator($dir, $flags); <br> <font color="#008000">//     </font> <br> $iterator = <font color="#0000ff">new</font> \RecursiveIteratorIterator($iterator, \RecursiveIteratorIterator::SELF_FIRST); <br> <font color="#008000">//   </font> <br> <font color="#0000ff">foreach</font> ($iterator <font color="#0000ff">as</font> $file) <br> { <br> <font color="#008000">//  -  $file ( \SplFileInfo)</font> <br> } <br></font></code> </blockquote><br>  <font color="grey">Note: Notice the freaky \ character in front of each built-in class?</font>  <font color="grey">This is the path to accessing the built-in PHP classes when you use them in the context of the PHP 5.3 namespace.</font> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As you can see, nothing complicated.  You just have to know which iterator to use, which flags you can use, and how to use them together.  That is, the primary entry barrier is learning.  There are many presentations and tutorials about iterators on the Internet, but the official documentation on php.net probably lacks a few good examples. <br><br>  Another "problem" is that everything is very object oriented.  And as soon as you want to filter out an iterator, you need to create your own classes, which in most cases do not look practical.  This is because PHP iterators are very powerful and were written to be general purpose iterators. <br><br>  What is filtering?  Let's, for example, I want to exclude all files ending in .rb from the iterator.  I can create a simple \ FilterIterator for this: <br><blockquote> <code><font color="black"><font color="#0000ff">class</font> ExcludeRubyFilesFilterIterator extends \FilterIterator <br> { <br> <font color="#0000ff">public</font> function accept() { <br> $fileinfo = $ <font color="#0000ff">this</font> -&gt;getInnerIterator()-&gt;current(); <br> <br> <font color="#0000ff">if</font> (preg_match( <font color="#A31515">'/\.rb$/'</font> , $fileinfo)) { <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br> <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> } <br> } <br> <br></font></code> </blockquote><br>  The filtering iterator can be used with the previous code, for example by including: <br><blockquote> <code><font color="black">$iterator = <font color="#0000ff">new</font> ExcludeRubyFilesFilterIterator($iterator); <br></font></code> </blockquote><br>  It is quite simple.  But when I need to find files or directories, I always need filters of one specialized type, like excluding files of version control systems (such as .svn and .git directories), filtering files by name or size. <br><br><h4>  <b>Finder component in symfony</b> </h4><br>  Instead of writing the same iterators again and again, I arranged them as a symfony component: as a Finder component. <br><br>  The Finder component in symfony is equipped with many specialized iterator classes for locating files and directories.  It also adds a wrap for ease of everyday use. <br><br>  Like each symfony component, at the beginning you need to load your script with any class loader that can load classes following PHP 5.3 compatibility standards, such as the Symfony UniversalClassLoader class: <br><blockquote> <code><font color="black">require_once <font color="#A31515">'/path/to/src/Symfony/Foundation/UniversalClassLoader.php'</font> ; <br> <br> use Symfony\Foundation\UniversalClassLoader; <br> <br> $classLoader = <font color="#0000ff">new</font> UniversalClassLoader(); <br> $classLoader-&gt;registerNamespace( <font color="#A31515">'Symfony'</font> , <font color="#A31515">'/path/to/src'</font> ); <br> $classLoader-&gt;register();</font> <br></code> </blockquote><br>  Now, let's see how to use the Finder class, the main component class: <br><blockquote> <code><font color="black">use Symfony\Components\Finder\Finder; <br> <br> $finder = <font color="#0000ff">new</font> Finder(); <br> $iterator = $finder-&gt;files()-&gt; <font color="#0000ff">in</font> (__DIR__); <br> <br> <font color="#0000ff">foreach</font> ($iterator <font color="#0000ff">as</font> $file) <br> { <br> print $file-&gt;getRealpath(). <font color="#A31515">"\n"</font> ; <br> }</font> <br></code> </blockquote><br>  The code above recursively prints the names of all files in the current directory.  Notice that the Finder class uses the <a href="http://en.wikipedia.org/wiki/Fluent_interface">fluent interface</a> (when method calls can be made as a string), which means that all methods return an instance of the Finder class.  The only exception is the in () method, which builds and returns an iterator for this category, or an array of directories: <br><blockquote> <code><font color="black">$iterator = $finder-&gt;files()-&gt; <font color="#0000ff">in</font> (array( <font color="#A31515">'/path1'</font> , <font color="#A31515">'/path2'</font> ));</font> <br></code> </blockquote><br>  <font color="grey">Note: you can convert an iterator to an array using the iterator_to_array () method, and get the number of elements using iterator_count ().</font> <br><br>  If you want to restrict an iterator to return only PHP files in the current directory, use the name () and maxDepth () methods: <br><blockquote> <code><font color="black">$iterator = $finder <br> -&gt;files() <br> -&gt;name( <font color="#A31515">'*.php'</font> ) <br> -&gt;maxDepth(0) <br> -&gt; <font color="#0000ff">in</font> (__DIR__); <br></font></code> </blockquote><br>  The name () method supports globs, strings, or regexes: <br><blockquote> <code><font color="black">$finder <br> -&gt;files() <br> -&gt;name( <font color="#A31515">'/\.php$/'</font> );</font> <br></code> </blockquote><br>  There are also methods to exclude files by name or to exclude entire content directories from matches: <br><blockquote> <code><font color="black">$finder <br> -&gt;files() <br> -&gt;name( <font color="#A31515">'test.*'</font> ) <br> -&gt;notName( <font color="#A31515">'*.rb'</font> ) <br> -&gt;exclude( <font color="#A31515">'ruby'</font> );</font> <br></code> </blockquote><br>  The result will contain files with the name test of any extension, but only if they do not end in .rb (excluded test.rb), and the iterator will not match the files in ruby ‚Äã‚Äãdirectories (ruby / foo / test.php for example, does not match) . <br><br>  If you want to follow links, use the followLinks () method: <br><blockquote> <code><font color="black">$finder <br> -&gt;files() <br> -&gt;followLinks();</font> <br></code> </blockquote><br>  You can also limit files by size: <br><blockquote> <code><font color="black">$finder <br> -&gt;files() <br> -&gt;name( <font color="#A31515">'/\.php$/'</font> ) <br> -&gt;size( <font color="#A31515">'&lt; 1.5K'</font> );</font> <br></code> </blockquote><br>  Most methods are cumulative.  That is, if you want to get all files in PHP and Python with sizes between 1 and 2 K, you can use similar code: <br><blockquote> <code><font color="black">$finder <br> -&gt;files() <br> -&gt;name( <font color="#A31515">'*.php'</font> ) <br> -&gt;name( <font color="#A31515">'*.py/'</font> ) <br> -&gt;size( <font color="#A31515">'&gt;= 1K'</font> ) <br> -&gt;size( <font color="#A31515">'&lt;= 2K'</font> );</font> <br></code> </blockquote><br>  <font color="grey">Note: by default, the iterator ignores popular version control files.</font>  <font color="grey">This can be changed using the ignoreVCS () method.</font> <br><br>  Since the in () method returns an instance of \ Iterator, you can wrap it with your specialized iterator.  But instead of creating a class, you can also use the filter () method: <br><blockquote> <code><font color="black">$filter = function (\SplFileInfo $fileinfo) <br> { <br> <font color="#0000ff">if</font> (strlen($fileinfo) &gt; 10) { <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br> }; <br> <br> $finder <br> -&gt;files() <br> -&gt;name( <font color="#A31515">'*.php'</font> ) <br> -&gt;filter($filter);</font> <br></code> </blockquote><br>  This example excludes all files with a file length of more than 10 characters. <br><br>  If you want to sort the result by name, use the sortByName () method: <br><blockquote> <code><font color="black">$finder <br> -&gt;files() <br> -&gt;name( <font color="#A31515">'*.php'</font> ) <br> -&gt;sortByName();</font> <br></code> </blockquote><br>  <font color="grey">Notice that the sort * methods require the passage of all matched elements in order to do their work.</font>  <font color="grey">For large iterators, this can be quite slow.</font> <br><br>  Behind the curtain, the Finder class uses specialized iterator classes: <br><ul><li>  Chainiterator </li><li>  CustomFilterIterator </li><li>  DateRangeFilterIterator (coming soon) </li><li>  ExcludeDirectoryFilterIterator </li><li>  FileTypeFilterIterator </li><li>  FilenameFilterIterator </li><li>  IgnoreVcsFilterIterator </li><li>  LimitDepthFilterIterator </li><li>  SizeRangeFilterIterator </li><li>  SortableIterator </li></ul>  Take a look at the <a href="http://github.com/symfony/symfony/tree/master/src/Symfony/Components/Finder/">code</a> to learn more about these iterators and how they work. </div><p>Source: <a href="https://habr.com/ru/post/91689/">https://habr.com/ru/post/91689/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../91684/index.html">AIMP plugin for listening to music from VKontakte.ru</a></li>
<li><a href="../91685/index.html">Joint project "old rake". Or a proven way to spoil relationships</a></li>
<li><a href="../91686/index.html">We are on Habr√©!</a></li>
<li><a href="../91687/index.html">April 23 is World Book Day! ‚ÄúReading is useful!‚Äù (C) BookMix.ru</a></li>
<li><a href="../91688/index.html">LeftHand is not only iSCSI</a></li>
<li><a href="../91690/index.html">Update uBooks reader</a></li>
<li><a href="../91694/index.html">TOP-100 leading web studios Russia-2010</a></li>
<li><a href="../91698/index.html">How can a binary search be written correctly?</a></li>
<li><a href="../91699/index.html">Fast algorithm for calculating checksum for large JAR files</a></li>
<li><a href="../91702/index.html">How much money did donationware bring you?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>