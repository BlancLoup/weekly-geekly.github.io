<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implementing ToString () in C ++</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="To output to the log (and not only for this, but this is what I myself encountered), you need to convert the value of the variable into a string. 

 I...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implementing ToString () in C ++</h1><div class="post__text post__text-html js-mediator-article">  To output to the log (and not only for this, but this is what I myself encountered), you need to convert the value of the variable into a string. <br><br>  In C ++, this is usually done by outputting to the stream (alternatively, using boost: lexical_cast &lt;&gt; - which in our case is almost the same). <br><br>  For built-in types, this is not a problem, but what should we do if we need to display, say, std: vector?  Alas, std: vector does not have a stream output operator. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As a result of solving this problem, I wrote code that I want to share with the community. <br><a name="habracut"></a><br><br><h4>  Main idea. </h4><br>  So first the main idea.  The idea, in fact, is quite simple - to write a set of overloaded functions that will perform the conversion to a string. <br><br>  The first question that confronts us is what kind of function prototype to use: <br><br> <code><font color="black"><font color="#0000ff">template</font> <font color="#000080">&lt;</font> <font color="#0000ff">typename</font> T <font color="#000080">&gt;</font> <br> <font color="#0000ff">void</font> ToStream <font color="#008000">(</font> std <font color="#008080">::</font> <font color="#007788">wostream</font> <font color="#000040">&amp;</font> strm, <font color="#0000ff">const</font> T <font color="#000040">&amp;</font> val <font color="#008000">)</font> <font color="#008080">;</font></font></code> <br> <br>  or <br><br> <code><font color="black"><font color="#0000ff">template</font> <font color="#000080">&lt;</font> <font color="#0000ff">typename</font> T <font color="#000080">&gt;</font> <br> std <font color="#008080">::</font> <font color="#007788">wstring</font> ToString <font color="#008000">(</font> <font color="#0000ff">const</font> T <font color="#000040">&amp;</font> val <font color="#008000">)</font> <font color="#008080">;</font></font></code> <br> <br>  The second option seems more attractive - passing in a variable - returns a string. <br>  But in terms of performance (we need performance, otherwise why we‚Äôve gotten into C ++), the first option usually wins, because it does not create a temporary variable (of type std: wstring) for the return value. <br>  Besides, a simple wrapper without problems gives us the second option: <br><br> <code><font color="black"><font color="#0000ff">template</font> <font color="#000080">&lt;</font> <font color="#0000ff">typename</font> T <font color="#000080">&gt;</font> <br> std <font color="#008080">::</font> <font color="#007788">wstring</font> ToString <font color="#008000">(</font> <font color="#0000ff">const</font> T <font color="#000040">&amp;</font> val <font color="#008000">)</font> <br> <font color="#008000">{</font> <br> std <font color="#008080">::</font> <font color="#007788">wostringstream</font> strm <font color="#008080">;</font> <br> ToStream <font color="#008000">(</font> strm, val <font color="#008000">)</font> <font color="#008080">;</font> <br> <br> <font color="#0000ff">return</font> strm. <font color="#007788">str</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> <br> <font color="#008000">}</font></font></code> <br> <br>  The first problem is solved, now we are going to implement the ToStream () itself.  The simplest option is the output through the output operator (sorry for the tautology). <br><br> <code><font color="black"><font color="#0000ff">template</font> <font color="#000080">&lt;</font> <font color="#0000ff">typename</font> T <font color="#000080">&gt;</font> <br> <font color="#0000ff">void</font> ToStream <font color="#008000">(</font> std <font color="#008080">::</font> <font color="#007788">wostream</font> <font color="#000040">&amp;</font> strm, <font color="#0000ff">const</font> T <font color="#000040">&amp;</font> val <font color="#008000">)</font> <br> <font color="#008000">{</font> <br> strm <font color="#000080">&lt;&lt;</font> val <font color="#008080">;</font> <br> <font color="#008000">}</font></font></code> <br> <br>  Stop!  And what if the type has no output operator?  Stumbled upon an initial problem.  The solution is obvious - you need to allow this function only for types for which the operator of output to the stream is defined.  In code, it looks like this: <br><br> <code><font color="black"><font color="#666666">//   T       </font> <br> <font color="#666666">//    </font> <br> <font color="#0000ff">struct</font> AnyType <br> <font color="#008000">{</font> <br> <font color="#0000ff">template</font> <font color="#000080">&lt;</font> <font color="#0000ff">class</font> T <font color="#000080">&gt;</font> <br> AnyType <font color="#008000">(</font> T <font color="#008000">)</font> <br> <font color="#008000">{</font> <br> <font color="#008000">}</font> <br> <font color="#008000">}</font> <font color="#008080">;</font> <br> <br> <font color="#666666">//  </font> <br> <font color="#666666">//    ,      (operator&lt;&lt;)</font> <br> <font color="#0000ff">template</font> <font color="#000080">&lt;</font> <font color="#0000ff">class</font> <font color="#0000ff">Char</font> <font color="#000080">&gt;</font> <br> boost <font color="#008080">::</font> <font color="#007788">type_traits</font> <font color="#008080">::</font> <font color="#007788">no_type</font> operator <font color="#000080">&lt;&lt;</font> <font color="#008000">(</font> std <font color="#008080">::</font> <font color="#007788">basic_ostream</font> <font color="#000080">&lt;</font> <font color="#0000ff">Char</font> <font color="#000080">&gt;</font> <font color="#000040">&amp;</font> , AnyType <font color="#008000">)</font> <font color="#008080">;</font> <br> <br> <font color="#666666">//     T   (    T operator&lt;&lt;)?</font> <br> <font color="#0000ff">template</font> <font color="#000080">&lt;</font> <font color="#0000ff">class</font> T, <font color="#0000ff">class</font> <font color="#0000ff">Char</font> <font color="#000080">&gt;</font> <br> <font color="#0000ff">class</font> IsOutStreamable <br> <font color="#008000">{</font> <br> <font color="#0000ff">static</font> std <font color="#008080">::</font> <font color="#007788">basic_ostream</font> <font color="#000080">&lt;</font> <font color="#0000ff">Char</font> <font color="#000080">&gt;</font> <font color="#000040">&amp;</font> GetStrm <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> <br> <font color="#0000ff">static</font> <font color="#0000ff">const</font> T <font color="#000040">&amp;</font> GetT <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> <br> <font color="#0000ff">static</font> boost <font color="#008080">::</font> <font color="#007788">type_traits</font> <font color="#008080">::</font> <font color="#007788">no_type</font> Impl <font color="#008000">(</font> boost <font color="#008080">::</font> <font color="#007788">type_traits</font> <font color="#008080">::</font> <font color="#007788">no_type</font> <font color="#008000">)</font> <font color="#008080">;</font> <br> <font color="#0000ff">static</font> boost <font color="#008080">::</font> <font color="#007788">type_traits</font> <font color="#008080">::</font> <font color="#007788">yes_type</font> Impl <font color="#008000">(</font> ... <font color="#008000">)</font> <font color="#008080">;</font> <br> <font color="#0000ff">public</font> <font color="#008080">:</font> <br> <font color="#0000ff">static</font> <font color="#0000ff">const</font> <font color="#0000ff">bool</font> value <font color="#000080">=</font> <font color="#0000dd">sizeof</font> <font color="#008000">(</font> Impl <font color="#008000">(</font> GetStrm <font color="#008000">(</font> <font color="#008000">)</font> <font color="#000080">&lt;&lt;</font> GetT <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008000">)</font> <font color="#008000">)</font> <font color="#000080">==</font> <font color="#0000dd">sizeof</font> <font color="#008000">(</font> boost <font color="#008080">::</font> <font color="#007788">type_traits</font> <font color="#008080">::</font> <font color="#007788">yes_type</font> <font color="#008000">)</font> <font color="#008080">;</font> <br> <font color="#008000">}</font> <font color="#008080">;</font> <br> <br> <font color="#666666">// ===      T</font> <br> <font color="#0000ff">template</font> <font color="#000080">&lt;</font> <font color="#0000ff">typename</font> T <font color="#000080">&gt;</font> <br> <font color="#0000ff">typename</font> boost <font color="#008080">::</font> <font color="#007788">enable_if_c</font> <font color="#000080">&lt;</font> IsOutStreamable <font color="#000080">&lt;</font> T, <font color="#0000ff">wchar_t</font> <font color="#000080">&gt;</font> <font color="#008080">::</font> <font color="#007788">value</font> , <font color="#0000ff">void</font> <font color="#000080">&gt;</font> <font color="#008080">::</font> <font color="#007788">type</font> <br> ToStream <font color="#008000">(</font> std <font color="#008080">::</font> <font color="#007788">wostream</font> <font color="#000040">&amp;</font> strm, <font color="#0000ff">const</font> T <font color="#000040">&amp;</font> val <font color="#008000">)</font> <br> <font color="#008000">{</font> <br> strm <font color="#000080">&lt;&lt;</font> val <font color="#008080">;</font> <br> <font color="#008000">}</font></font></code> <br> <br>  Well, the first stage is over. <br>  What's next?  Define the output for the type std: pair - we will output in the form "(T, U)‚Äú: <br><br> <code><font color="black"><font color="#666666">// === std::pair</font> <br> <font color="#0000ff">template</font> <font color="#000080">&lt;</font> <font color="#0000ff">typename</font> T, <font color="#0000ff">typename</font> U <font color="#000080">&gt;</font> <br> <font color="#0000ff">void</font> ToStream <font color="#008000">(</font> std <font color="#008080">::</font> <font color="#007788">wostream</font> <font color="#000040">&amp;</font> strm, <font color="#0000ff">const</font> std <font color="#008080">::</font> <font color="#007788">pair</font> <font color="#000080">&lt;</font> T, U <font color="#000080">&gt;</font> <font color="#000040">&amp;</font> val <font color="#008000">)</font> <br> <font color="#008000">{</font> <br> strm <font color="#000080">&lt;&lt;</font> L <font color="#FF0000">'('</font> <font color="#008080">;</font> <br> ToStream <font color="#008000">(</font> strm, val. <font color="#007788">first</font> <font color="#008000">)</font> <font color="#008080">;</font> <br> strm <font color="#000080">&lt;&lt;</font> L <font color="#FF0000">", "</font> <font color="#008080">;</font> <br> ToStream <font color="#008000">(</font> strm, val. <font color="#007788">second</font> <font color="#008000">)</font> <font color="#008080">;</font> <br> strm <font color="#000080">&lt;&lt;</font> L <font color="#FF0000">')'</font> <font color="#008080">;</font> <br> <font color="#008000">}</font></font></code> <br> <br>  Did someone ask a question?  Please repeat - it‚Äôs hard to hear at a distance of 10,000 kilometers ... <br>  Why do we [recursively] call ToStream ()?  Everything is very simple.  The fact is that the types T and / or U in turn can be complex types, for example std: pair &lt;int, std :: pair &lt;int, int&gt;&gt;.  In the case of a recursive call, we get the output in the form (0, (1, 2)), which we actually need. <br><br>  The finest hour has come for standard containers (we print as "[3] (1, 2, 3)"): <br><br> <code><font color="black"><font color="#666666">//  has_iterator  ..</font> <br> BOOST_MPL_HAS_XXX_TRAIT_DEF <font color="#008000">(</font> iterator <font color="#008000">)</font> <font color="#008080">;</font> <br> BOOST_MPL_HAS_XXX_TRAIT_DEF <font color="#008000">(</font> const_iterator <font color="#008000">)</font> <font color="#008080">;</font> <br> BOOST_MPL_HAS_XXX_TRAIT_DEF <font color="#008000">(</font> value_type <font color="#008000">)</font> <font color="#008080">;</font> <br> <br> <font color="#666666">//    "     (STL container)"</font> <br> <font color="#666666">// ,    ,     </font> <br> <font color="#666666">//  iterator, const_iterator  value_type,    std::[w]string</font> <br> <font color="#0000ff">template</font> <font color="#000080">&lt;</font> <font color="#0000ff">typename</font> T <font color="#000080">&gt;</font> <br> <font color="#0000ff">struct</font> IsStdContainer <br> <font color="#008000">{</font> <br> <font color="#0000ff">static</font> <font color="#0000ff">const</font> <font color="#0000ff">int</font> value <font color="#000080">=</font> boost <font color="#008080">::</font> <font color="#007788">mpl</font> <font color="#008080">::</font> <font color="#007788">and_</font> <font color="#000080">&lt;</font> <br> has_iterator <font color="#000080">&lt;</font> T <font color="#000080">&gt;</font> , <br> has_const_iterator <font color="#000080">&lt;</font> T <font color="#000080">&gt;</font> , <br> has_value_type <font color="#000080">&lt;</font> T <font color="#000080">&gt;</font> , <br> boost <font color="#008080">::</font> <font color="#007788">mpl</font> <font color="#008080">::</font> <font color="#007788">not_</font> <font color="#000080">&lt;</font> boost <font color="#008080">::</font> <font color="#007788">is_same</font> <font color="#000080">&lt;</font> T, std <font color="#008080">::</font> <font color="#007788">string</font> <font color="#000080">&gt;</font> <font color="#000080">&gt;</font> , <br> boost <font color="#008080">::</font> <font color="#007788">mpl</font> <font color="#008080">::</font> <font color="#007788">not_</font> <font color="#000080">&lt;</font> boost <font color="#008080">::</font> <font color="#007788">is_same</font> <font color="#000080">&lt;</font> T, std <font color="#008080">::</font> <font color="#007788">wstring</font> <font color="#000080">&gt;</font> <font color="#000080">&gt;</font> <br> <font color="#000080">&gt;</font> <font color="#008080">::</font> <font color="#007788">value</font> <font color="#008080">;</font> <br> <font color="#008000">}</font> <font color="#008080">;</font> <br> <br> <font color="#666666">// === STL  ( ,    STL  - . IsStdContainer )</font> <br> <font color="#0000ff">template</font> <font color="#000080">&lt;</font> <font color="#0000ff">typename</font> T <font color="#000080">&gt;</font> <br> <font color="#0000ff">typename</font> boost <font color="#008080">::</font> <font color="#007788">enable_if</font> <font color="#000080">&lt;</font> IsStdContainer <font color="#000080">&lt;</font> T <font color="#000080">&gt;</font> , <font color="#0000ff">void</font> <font color="#000080">&gt;</font> <font color="#008080">::</font> <font color="#007788">type</font> <br> ToStream <font color="#008000">(</font> std <font color="#008080">::</font> <font color="#007788">wostream</font> <font color="#000040">&amp;</font> strm, <font color="#0000ff">const</font> T <font color="#000040">&amp;</font> val <font color="#008000">)</font> <br> <font color="#008000">{</font> <br> strm <font color="#000080">&lt;&lt;</font> L <font color="#FF0000">'['</font> <font color="#000080">&lt;&lt;</font> val. <font color="#007788">size</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#000080">&lt;&lt;</font> L <font color="#FF0000">"]("</font> <font color="#008080">;</font> <br> <br> <font color="#0000ff">if</font> <font color="#008000">(</font> <font color="#000040">!</font> val. <font color="#007788">empty</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008000">)</font> <br> <font color="#008000">{</font> <br> <font color="#0000ff">typename</font> T <font color="#008080">::</font> <font color="#007788">const_iterator</font> it <font color="#000080">=</font> val. <font color="#007788">begin</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> <br> ToStream <font color="#008000">(</font> strm, <font color="#000040">*</font> it <font color="#000040">++</font> <font color="#008000">)</font> <font color="#008080">;</font> <br> <font color="#0000ff">for</font> <font color="#008000">(</font> <font color="#008080">;</font> it <font color="#000040">!</font> <font color="#000080">=</font> val. <font color="#007788">end</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> <font color="#000040">++</font> it <font color="#008000">)</font> <br> <font color="#008000">{</font> <br> strm <font color="#000080">&lt;&lt;</font> L <font color="#FF0000">", "</font> <font color="#008080">;</font> <br> ToStream <font color="#008000">(</font> strm, <font color="#000040">*</font> it <font color="#008000">)</font> <font color="#008080">;</font> <br> <font color="#008000">}</font> <br> <font color="#008000">}</font> <br> <br> strm <font color="#000080">&lt;&lt;</font> L <font color="#FF0000">')'</font> <font color="#008080">;</font> <br> <font color="#008000">}</font></font></code> <br> <br>  Now we define a transform for the bool type.  Fortunately, this is simpler than previous functions.  Only one small note - in my code in the hider (.h) only the function description, and the definition is made in the .cpp file.  The reason is simple - if the leader is included in several .cpp files, the function is determined in several translation units, which is bad and linkovshik will inform us about it (gloating about its superiority).  For template functions this does not happen.  Solely for simplicity, I moved the definition of the function to the leader (which should not be done for working projects for the reason described above). <br><br> <code><font color="black"><font color="#666666">// === bool</font> <br> <font color="#0000ff">void</font> ToStream <font color="#008000">(</font> std <font color="#008080">::</font> <font color="#007788">wostream</font> <font color="#000040">&amp;</font> strm, <font color="#0000ff">const</font> <font color="#0000ff">bool</font> <font color="#000040">&amp;</font> val <font color="#008000">)</font> <br> <font color="#008000">{</font> <br> strm <font color="#000080">&lt;&lt;</font> <font color="#008000">(</font> val <font color="#008080">?</font> L <font color="#FF0000">"true"</font> <font color="#008080">:</font> L <font color="#FF0000">"false"</font> <font color="#008000">)</font> <font color="#008080">;</font> <br> <font color="#008000">}</font></font></code> <br> <br>  Here, in brief, and all the basic functions.  True, in my implementation there is also: <br><br> <code><font color="black"><font color="#666666">// === std::string</font> <br> <font color="#0000ff">void</font> ToStream <font color="#008000">(</font> std <font color="#008080">::</font> <font color="#007788">wostream</font> <font color="#000040">&amp;</font> strm, <font color="#0000ff">const</font> std <font color="#008080">::</font> <font color="#007788">string</font> <font color="#000040">&amp;</font> val <font color="#008000">)</font> <font color="#008080">;</font> <br> <br> <font color="#666666">// === char*</font> <br> <font color="#0000ff">void</font> ToStream <font color="#008000">(</font> std <font color="#008080">::</font> <font color="#007788">wostream</font> <font color="#000040">&amp;</font> strm, <font color="#0000ff">char</font> <font color="#000040">*</font> val <font color="#008000">)</font> <font color="#008080">;</font> <br> <br> <font color="#666666">// === const char*</font> <br> <font color="#0000ff">void</font> ToStream <font color="#008000">(</font> std <font color="#008080">::</font> <font color="#007788">wostream</font> <font color="#000040">&amp;</font> strm, <font color="#0000ff">const</font> <font color="#0000ff">char</font> <font color="#000040">*</font> val <font color="#008000">)</font> <font color="#008080">;</font> <br> <br> <font color="#666666">// === const char</font> <br> <font color="#0000ff">void</font> ToStream <font color="#008000">(</font> std <font color="#008080">::</font> <font color="#007788">wostream</font> <font color="#000040">&amp;</font> strm, <font color="#0000ff">const</font> <font color="#0000ff">char</font> val <font color="#008000">)</font> <font color="#008080">;</font></font></code> <br> <br>  For what?  For output to the ‚Äúwide‚Äù stream (std: wostream) of ‚Äúnarrow‚Äù strings / characters (char, std: string).  The fact is that in my projects I deal with strings in the UTF8 format.  Accordingly, I store such strings in std: string.  In the ToStream functions (std: wostream &amp; strm, const std: string &amp; val), I convert the string from UFT8 to std: wstring and output it.  I do not provide the function code, as it will complicate it, but it will not bring anything new in principle. <br><br>  Now examples of use. <br>  To begin with a couple of auxiliary macros (no need to throw stones at me! Sometimes macros can make life much easier). <br>  First macro: <br><br> <code><font color="black"><font color="#339900">#define _VAR(var) L ## #var &lt;&lt; L"&lt;" &lt;&lt; ToString(var) &lt;&lt; L"&gt; "</font></font></code> <br> <br>  allows us to write code: <br><br> <code><font color="black"><font color="#0000ff">int</font> i <font color="#000080">=</font> <font color="#0000dd">0</font> <font color="#008080">;</font> <br> <font color="#0000ff">int</font> n <font color="#000080">=</font> <font color="#0000dd">10</font> <font color="#008080">;</font> <br> std <font color="#008080">::</font> <font color="#0000dd">cout</font> <font color="#000080">&lt;&lt;</font> _VAR <font color="#008000">(</font> i <font color="#008000">)</font> <font color="#000080">&lt;&lt;</font> _VAR <font color="#008000">(</font> n <font color="#008000">)</font> <font color="#008080">;</font></font></code> <br> <br>  and get in the output: <br><br> <code><font color="black">i <font color="#000080">&lt;</font> <font color="#0000dd">0</font> <font color="#000080">&gt;</font> n <font color="#000080">&lt;</font> <font color="#0000dd">10</font> <font color="#000080">&gt;</font></font></code> <br> <br>  why not "i = 0 n = 10"?  The reason is felt when displaying lines: <br><br> <code><font color="black">std <font color="#008080">::</font> <font color="#007788">string</font> s1 <font color="#000080">=</font> <font color="#FF0000">""</font> <font color="#008080">;</font> <br> std <font color="#008080">::</font> <font color="#007788">string</font> s2 <font color="#000080">=</font> <font color="#FF0000">" "</font> <font color="#008080">;</font> <br> std <font color="#008080">::</font> <font color="#0000dd">cout</font> <font color="#000080">&lt;&lt;</font> _VAR <font color="#008000">(</font> s1 <font color="#008000">)</font> <font color="#000080">&lt;&lt;</font> _VAR <font color="#008000">(</font> s2 <font color="#008000">)</font> <font color="#008080">;</font></font></code> <br> <br>  output (if the code highlighting does not fail, the difference will be obvious): <br><br> <code><font color="black">s1 <font color="#000080">&lt;&gt;</font> s2 <font color="#000080">&lt;</font> <font color="#000080">&gt;</font></font></code> <br> <br>  The second macro for tests - if the condition is not met, then throws an exception: <br><br> <code><font color="black"><font color="#339900">#define CHECK(expr)     \</font> <br> <font color="#0000ff">if</font> <font color="#008000">(</font> <font color="#000040">!</font> <font color="#008000">(</font> expr <font color="#008000">)</font> <font color="#008000">)</font> \ <br> <font color="#008000">{</font> \ <br> <font color="#0000ff">throw</font> <font color="#339900">#expr;    \</font> <br> <font color="#008000">}</font> \ <br> <font color="#0000ff">else</font> \ <br> <font color="#008000">(</font> <font color="#008000">(</font> <font color="#0000ff">void</font> <font color="#008000">)</font> <font color="#0000dd">0</font> <font color="#008000">)</font></font></code> <br> <br>  Now actually examples: <br><h4>  Example 1. Output std: vector. </h4><br>  The simplest of examples. <br><br> <code><font color="black">std <font color="#008080">::</font> <font color="#007788">vector</font> <font color="#000080">&lt;</font> <font color="#0000ff">int</font> <font color="#000080">&gt;</font> v <font color="#000080">=</font> boost <font color="#008080">::</font> <font color="#007788">assign</font> <font color="#008080">::</font> <font color="#007788">list_of</font> <font color="#008000">(</font> <font color="#0000dd">0</font> <font color="#008000">)</font> <font color="#008000">(</font> <font color="#0000dd">1</font> <font color="#008000">)</font> <font color="#008000">(</font> <font color="#0000dd">2</font> <font color="#008000">)</font> <font color="#008000">(</font> <font color="#0000dd">3</font> <font color="#008000">)</font> <font color="#008080">;</font> <br> CHECK <font color="#008000">(</font> ToString <font color="#008000">(</font> v <font color="#008000">)</font> <font color="#000080">==</font> L <font color="#FF0000">"[4](0, 1, 2, 3)"</font> <font color="#008000">)</font> <font color="#008080">;</font> <br> std <font color="#008080">::</font> <font color="#007788">wcout</font> <font color="#000080">&lt;&lt;</font> _VAR <font color="#008000">(</font> v <font color="#008000">)</font> <font color="#000080">&lt;&lt;</font> std <font color="#008080">::</font> <font color="#007788">endl</font> <font color="#008080">;</font></font></code> <br> <br><h4>  Example 2. Displaying std: map. </h4><br>  This example is a bit more interesting because it uses 2 functions - for the container and for the std: pair (I remind you that map stores pairs in itself) - this is what we wrote about the output of pairs. <br><br> <code><font color="black">std <font color="#008080">::</font> <font color="#007788">map</font> <font color="#000080">&lt;</font> <font color="#0000ff">int</font> , <font color="#0000ff">int</font> <font color="#000080">&gt;</font> m <font color="#000080">=</font> boost <font color="#008080">::</font> <font color="#007788">assign</font> <font color="#008080">::</font> <font color="#007788">map_list_of</font> <font color="#008000">(</font> <font color="#0000dd">0</font> , <font color="#0000dd">1</font> <font color="#008000">)</font> <font color="#008000">(</font> <font color="#0000dd">2</font> , <font color="#0000dd">3</font> <font color="#008000">)</font> <font color="#008000">(</font> <font color="#0000dd">4</font> , <font color="#0000dd">5</font> <font color="#008000">)</font> <font color="#008080">;</font> <br> CHECK <font color="#008000">(</font> ToString <font color="#008000">(</font> m <font color="#008000">)</font> <font color="#000080">==</font> L <font color="#FF0000">"[3]((0, 1), (2, 3), (4, 5))"</font> <font color="#008000">)</font> <font color="#008080">;</font> <br> std <font color="#008080">::</font> <font color="#007788">wcout</font> <font color="#000080">&lt;&lt;</font> _VAR <font color="#008000">(</font> m <font color="#008000">)</font> <font color="#000080">&lt;&lt;</font> std <font color="#008080">::</font> <font color="#007788">endl</font> <font color="#008080">;</font> <br> <br> <font color="#000080">&lt;</font> h4 <font color="#000080">&gt;</font>  <font color="#800080">3.</font>   std <font color="#008080">::</font> <font color="#007788">map</font> . <font color="#000080">&lt;</font> <font color="#000040">/</font> h4 <font color="#000080">&gt;</font> <br>    .      . <br> <br> <font color="#000080">&lt;</font> code <font color="#0000ff">class</font> <font color="#000080">=</font> <font color="#FF0000">"cpp"</font> <font color="#000080">&gt;</font> <br> std <font color="#008080">::</font> <font color="#007788">map</font> <font color="#000080">&lt;</font> std <font color="#008080">::</font> <font color="#007788">wstring</font> ,  std <font color="#008080">::</font> <font color="#007788">vector</font> <font color="#000080">&lt;</font> <font color="#0000ff">int</font> <font color="#000080">&gt;</font> <font color="#000080">&gt;</font> msv <font color="#000080">=</font> boost <font color="#008080">::</font> <font color="#007788">assign</font> <font color="#008080">::</font> <font color="#007788">list_of</font> <font color="#000080">&lt;</font> std <font color="#008080">::</font> <font color="#007788">pair</font> <font color="#000080">&lt;</font> std <font color="#008080">::</font> <font color="#007788">wstring</font> , std <font color="#008080">::</font> <font color="#007788">vector</font> <font color="#000080">&lt;</font> <font color="#0000ff">int</font> <font color="#000080">&gt;</font> <font color="#000080">&gt;</font> <font color="#000080">&gt;</font> <br> <font color="#008000">(</font> L <font color="#FF0000">"zero"</font> ,    boost <font color="#008080">::</font> <font color="#007788">assign</font> <font color="#008080">::</font> <font color="#007788">list_of</font> <font color="#008000">(</font> <font color="#0000dd">0</font> <font color="#008000">)</font> <font color="#008000">)</font> <br> <font color="#008000">(</font> L <font color="#FF0000">"one"</font> ,        boost <font color="#008080">::</font> <font color="#007788">assign</font> <font color="#008080">::</font> <font color="#007788">list_of</font> <font color="#008000">(</font> <font color="#0000dd">1</font> <font color="#008000">)</font> <font color="#008000">(</font> <font color="#0000dd">2</font> <font color="#008000">)</font> <font color="#008000">)</font> <br> <font color="#008000">(</font> L <font color="#FF0000">"two"</font> ,        boost <font color="#008080">::</font> <font color="#007788">assign</font> <font color="#008080">::</font> <font color="#007788">list_of</font> <font color="#008000">(</font> <font color="#0000dd">2</font> <font color="#008000">)</font> <font color="#008000">(</font> <font color="#0000dd">3</font> <font color="#008000">)</font> <font color="#008000">(</font> <font color="#0000dd">4</font> <font color="#008000">)</font> <font color="#008000">)</font> <br> <font color="#008080">;</font> <br> <br> CHECK <font color="#008000">(</font> ToString <font color="#008000">(</font> msv <font color="#008000">)</font> <font color="#000080">==</font> L <font color="#FF0000">"[3]((one, [2](1, 2)), (two, [3](2, 3, 4)), (zero, [1](0)))"</font> <font color="#008000">)</font> <font color="#008080">;</font> <br> std <font color="#008080">::</font> <font color="#007788">wcout</font> <font color="#000080">&lt;&lt;</font> _VAR <font color="#008000">(</font> msv <font color="#008000">)</font> <font color="#000080">&lt;&lt;</font> std <font color="#008080">::</font> <font color="#007788">endl</font> <font color="#008080">;</font></font></code> <br> <br>  I hope that no one is surprised that the output is different from what is written in the initialization.  If it still surprises someone, then I advise you to remember what a std: map is and how data is stored there. <br><br><h4>  Example 4. Output custom types. </h4><br>  First the code. <br><br> <code><font color="black"><font color="#0000ff">enum</font> RO4_ReplyType <font color="#666666">/// Reply type</font> <br> <font color="#008000">{</font> <br> RO4_RT_Mobile, <font color="#666666">///&lt; Replies go to mobile phone</font> <br> RO4_RT_Email, <font color="#666666">///&lt; Replies go to email address</font> <br> RO4_RT_MobileAndEmail <font color="#666666">///&lt; Replies go to mobile phone and to email address</font> <br> <font color="#008000">}</font> <font color="#008080">;</font> <br> <br> RO4_ReplyType rt <font color="#000080">=</font> RO4_RT_Email <font color="#008080">;</font> <br> CHECK <font color="#008000">(</font> RO4 <font color="#008080">::</font> <font color="#007788">Manip</font> <font color="#008080">::</font> <font color="#007788">ToString</font> <font color="#008000">(</font> rt <font color="#008000">)</font> <font color="#000080">==</font> L <font color="#FF0000">"1"</font> <font color="#008000">)</font> <font color="#008080">;</font></font></code> <br> <br>  Nothing interesting, the enum is cast to an integer type and its value is displayed.  I would not give this banal example if it were not for the possibility of expanding my solution.  Add the following code (again, the macro! Yes, I know, but it's easier for me): <br><br> <code><font color="black"><font color="#666666">/// Output operator for RO4_ReplyType</font> <br> <font color="#0000ff">void</font> ToStream <font color="#008000">(</font> std <font color="#008080">::</font> <font color="#007788">wostream</font> <font color="#000040">&amp;</font> strm, <font color="#0000ff">const</font> RO4_ReplyType <font color="#000040">&amp;</font> val <font color="#008000">)</font> <br> <font color="#008000">{</font> <br> <font color="#339900">#define STR(name)    case name: strm &lt;&lt; L## #name; break</font> <br> <font color="#0000ff">switch</font> <font color="#008000">(</font> val <font color="#008000">)</font> <br> <font color="#008000">{</font> <br> STR <font color="#008000">(</font> RO4_RT_Mobile <font color="#008000">)</font> <font color="#008080">;</font> <br> STR <font color="#008000">(</font> RO4_RT_Email <font color="#008000">)</font> <font color="#008080">;</font> <br> STR <font color="#008000">(</font> RO4_RT_MobileAndEmail <font color="#008000">)</font> <font color="#008080">;</font> <br> <br> <font color="#0000ff">default</font> <font color="#008080">:</font> <br> strm <font color="#000080">&lt;&lt;</font> L <font color="#FF0000">"Unknown value of RO4_ReplyType&lt;"</font> <font color="#000080">&lt;&lt;</font> <font color="#0000ff">static_cast</font> <font color="#000080">&lt;</font> <font color="#0000ff">int</font> <font color="#000080">&gt;</font> <font color="#008000">(</font> val <font color="#008000">)</font> <font color="#000080">&lt;&lt;</font> L <font color="#FF0000">"&gt;"</font> <font color="#008080">;</font> <br> <font color="#008000">}</font> <br> <font color="#339900">#undef STR</font> <br> <font color="#008000">}</font></font></code> <br> <br>  and lo and behold!  The conclusion turns into: <br><br> <code><font color="black">RO4_ReplyType rt <font color="#000080">=</font> RO4_RT_Email <font color="#008080">;</font> <br> CHECK <font color="#008000">(</font> RO4 <font color="#008080">::</font> <font color="#007788">Manip</font> <font color="#008080">::</font> <font color="#007788">ToString</font> <font color="#008000">(</font> rt <font color="#008000">)</font> <font color="#000080">==</font> L <font color="#FF0000">"RO4_RT_Email"</font> <font color="#008000">)</font> <font color="#008080">;</font></font></code> <br> <br>  Those.  This example shows how to expand the possibilities of applying my solution. <br><br><h4>  Afterword. </h4><br>  PS: In a real implementation, everything is wrapped in namespaces.  Full listings (with more pleasant syntax highlighting) here: <br><br>  <a href="http://pastie.org/pastes/787759/">RO4_ToString.h</a> <br>  <a href="http://pastie.org/pastes/787756/">main.cpp</a> </div><p>Source: <a href="https://habr.com/ru/post/81845/">https://habr.com/ru/post/81845/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../81831/index.html">About midi-files and PHP, as a tool for everyday programming with a live example</a></li>
<li><a href="../81832/index.html">Page for happy owners of IE6</a></li>
<li><a href="../81835/index.html">Handy.CMS 3.1 build 2003</a></li>
<li><a href="../81840/index.html">The art of killing dragons</a></li>
<li><a href="../81842/index.html">Recovery of the OS after the ransomware virus</a></li>
<li><a href="../81846/index.html">Great Firewall of All Belarus</a></li>
<li><a href="../81848/index.html">Specification Testing</a></li>
<li><a href="../81849/index.html">Jobs - "This will be the most important thing I've ever done"</a></li>
<li><a href="../81853/index.html">FunGraph.ru - a little humor, the language of statistics</a></li>
<li><a href="../81854/index.html">Simplify Polyline with Douglas-Pecker</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>