<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Sending a message with an attachment by e-mail from the module to Drupal</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It took me recently to do the seemingly simplest thing, namely, with the help of some form on the site to send a letter with an attachment. And it sho...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Sending a message with an attachment by e-mail from the module to Drupal</h1><div class="post__text post__text-html js-mediator-article">  It took me recently to do the seemingly simplest thing, namely, with the help of some form on the site to send a letter with an attachment.  And it should be done on a site built on Drupal ... As it turned out, <a href="http://habrahabr.ru/blogs/drupal/65523/">this</a> post is very correct - you will not find the right recipes, even if you‚Äôre really frightened.  In runet, it‚Äôs generally bad with information, it‚Äôs better in the wild west, but we couldn‚Äôt find anything worthwhile except for <a href="http://thejibe.com/blog/10/1/sending-emails-attachments-using-messaging-framework-drupal">one</a> method that requires installing two pretty sophisticated modules - well, I think it‚Äôs just no gateway ... As in the case With <a href="http://mr-locke.habrahabr.ru/blog/54221/">Joomla</a> , we had to dig the weights of various modules, <a href="http://api.drupal.org/">api.drupal.org</a> and, of course, think out.  The results of reflection I bring to your attention.  Using the example of the simplest module, I will show one of the ways to send a message with an attachment by e-mail. <br><br><a name="habracut"></a><br><br>  For our model example, we assume that users of our site need to be able to send screenshots (or other pictures) to the administrator with small accompanying comments.  The administrator must receive this invaluable information to his e-box in the form of e-mails in HTML format in UTF-8 encoding, the file with the picture must be attached to the letter.  Screenshots must be in jpeg format and weighing no more than 100Kb. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In order not to depart far from the topic topic, I assume that the reader is familiar with the general theory of creating modules for Drupal.  If not, then you can start using, for example, <a href="http://drupaldance.com/blog/10-steps-to-drupal-forms">this</a> article. <br><br>  So, to implement our module (let's call it SendScreen), you need to write a certain amount of code: <br><br><blockquote><code><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> <font color="black">Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; }</font> <br></code> <ol> <li> <code><font color="black"><font color="#cc6633"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML &lt;?php <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { //    <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; //       HTML <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); //      ,    <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); // id    <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); //    <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; //   .     $message... <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; // ...     ,  ... <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; // ...     <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; //    <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; //    <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; } <br></font></code> </li> </ol> <code><a href="http://s-c.me/6413/s"></a> <a href="http://s-c.me/6413/h"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.chunk-split.php"></a> <a href="http://www.php.net/manual/en/function.base64-encode.php"></a> <a href="http://www.php.net/manual/en/function.md5.php"></a> <a href="http://www.php.net/manual/en/function.uniqid.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <a href="http://www.php.net/manual/en/function.implode.php"></a> <font color="black">Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_menu()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_menu() { <font color="#cc6633">$items</font> = <font color="#0000ff">array</font> (); <font color="#cc6633">$items</font> [ <font color="#008000">'sendscreen'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'title'</font> =&gt; t( <font color="#008000">'Send screenshot'</font> ), <font color="#008000">'page callback'</font> =&gt; <font color="#008000">'sendscreen_page'</font> , <font color="#008000">'access arguments'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'access content'</font> ), <font color="#008000">'description'</font> =&gt; t( <font color="#008000">'  '</font> ), <font color="#008000">'type'</font> =&gt; MENU_CALLBACK, ); <font color="#0000ff">return</font> <font color="#cc6633">$items</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_page() { <font color="#0000ff">return</font> drupal_get_form( <font color="#008000">'sendscreen_mainform'</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform() { <font color="#cc6633">$form</font> [ <font color="#008000">'#attributes'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'enctype'</font> =&gt; <font color="#008000">"multipart/form-data"</font> ); <font color="#cc6633">$form</font> [ <font color="#008000">'name'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textfield'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Your name'</font> ), <font color="#008000">'#required'</font> =&gt; TRUE, <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">100</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'note'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'textarea'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Description'</font> ), <font color="#008000">'#required'</font> =&gt; FALSE, <font color="#008000">'#rows'</font> =&gt; <font color="#008000">5</font> , <font color="#008000">'#maxlength'</font> =&gt; <font color="#008000">500</font> , ); <font color="#cc6633">$form</font> [ <font color="#008000">'screenshot'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'file'</font> , <font color="#008000">'#title'</font> =&gt; t( <font color="#008000">'Screenshot'</font> ), <font color="#008000">'#size'</font> =&gt; <font color="#008000">40</font> , <font color="#008000">'#description'</font> =&gt; t( <font color="#008000">'jpeg, 100Kb max.'</font> ), ); <font color="#cc6633">$form</font> [ <font color="#008000">'submit'</font> ] = <font color="#0000ff">array</font> ( <font color="#008000">'#type'</font> =&gt; <font color="#008000">'submit'</font> , <font color="#008000">'#value'</font> =&gt; t( <font color="#008000">'Submit'</font> ), ); <font color="#0000ff">return</font> <font color="#cc6633">$form</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_validate( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#696969">//   </font> <font color="#cc6633">$validators</font> = <font color="#0000ff">array</font> ( <font color="#008000">'file_validate_extensions'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'jpg'</font> ), <font color="#008000">'file_validate_size'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">100</font> * <font color="#008000">1024</font> , <font color="#008000">100</font> * <font color="#008000">1024</font> ), ); <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> , <font color="#cc6633">$validators</font> ); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mainform_submit( <font color="#cc6633">$form</font> , &amp; <font color="#cc6633">$form_state</font> ) { <font color="#cc6633">$params</font> = <font color="#cc6633">$form_state</font> [ <font color="#008000">'values'</font> ]; drupal_mail( <font color="#008000">'sendscreen'</font> , <font color="#008000">'send'</font> , <font color="#008000">'admin@domain.org'</font> , language_default(), <font color="#cc6633">$params</font> ); drupal_set_message(t( <font color="#008000">'  .'</font> )); } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*  hook_mail()</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> sendscreen_mail( <font color="#cc6633">$key</font> , &amp; <font color="#cc6633">$message</font> , <font color="#cc6633">$params</font> ) { <font color="#cc6633">$body</font> = <font color="#008000">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"&gt;\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;html&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;style type=\"text/css\"&gt;'</font> . <font color="#008000">'&lt;/style&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/head&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;p&gt;'</font> . check_plain( <font color="#cc6633">$params</font> [ <font color="#008000">'note'</font> ]) . <font color="#008000">'&lt;/p&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">'&lt;/body&gt;'</font> . <font color="#008000">"\n"</font> . <font color="#008000">'&lt;/html&gt;'</font> . <font color="#008000">"\n"</font> ; <font color="#696969">//       HTML</font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'text/html; charset=UTF-8'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'From'</font> ] = <font color="#008000">'siteuser@domain.org'</font> ; <font color="#cc6633">$message</font> [ <font color="#008000">'subject'</font> ] = t( <font color="#008000">'  @name'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'@name'</font> =&gt; <font color="#cc6633">$params</font> [ <font color="#008000">'name'</font> ])); <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ][] = <font color="#cc6633">$body</font> ; <font color="#cc6633">$msg</font> = _sendscreen_process_attachment( <font color="#cc6633">$message</font> ); <font color="#0000ff">if</font> (! <font color="#0000ff">empty</font> ( <font color="#cc6633">$msg</font> )) { <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ]; <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ]; } } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $file</font> &lt;br/&gt; <font color="#696969">*       </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_add_attachment( <font color="#cc6633">$file</font> ) { <font color="#cc6633">$att</font> = <font color="#008000">"Content-Type: "</font> . <font color="#cc6633">$file</font> -&gt;filemime . <font color="#008000">"; name=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Transfer-Encoding: base64\n"</font> ; <font color="#cc6633">$att</font> .= <font color="#008000">"Content-Disposition: attachment; filename=\""</font> . basename( <font color="#cc6633">$file</font> -&gt;filename) . <font color="#008000">"\"\n\n"</font> ; <font color="#0000ff">if</font> (file_exists( <font color="#cc6633">$file</font> -&gt;filepath)) { <font color="#cc6633">$att</font> .= chunk_split(base64_encode(file_get_contents( <font color="#cc6633">$file</font> -&gt;filepath))); } <font color="#0000ff">return</font> <font color="#cc6633">$att</font> ; } <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">*    </font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param $message</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">* @return</font> &lt;br/&gt; <font color="#696969">*   </font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">function</font> _sendscreen_process_attachment( <font color="#cc6633">$message</font> ) { <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">//      ,   </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$file</font> = file_save_upload( <font color="#008000">'screenshot'</font> )) { <font color="#cc6633">$body</font> = <font color="#008000">''</font> ; <font color="#cc6633">$msg</font> = <font color="#0000ff">array</font> (); <font color="#696969">// id   </font> <font color="#cc6633">$boundary_id</font> = md5(uniqid(time())); <font color="#696969">//   </font> <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ][ <font color="#008000">'Content-Type'</font> ] = <font color="#008000">'multipart/mixed; boundary="'</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">'"'</font> ; <font color="#696969">//   .     $message...</font> <font color="#cc6633">$body</font> = <font color="#008000">"\n--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"Content-Type: text/html; charset=UTF-8; format=flowed;\n\n"</font> ; <font color="#696969">// ...     ,  ...</font> <font color="#cc6633">$body</font> .= implode( <font color="#008000">"\n\n"</font> , <font color="#cc6633">$message</font> [ <font color="#008000">'body'</font> ]); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n\n"</font> ; <font color="#696969">// ...    </font> <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"\n"</font> ; <font color="#cc6633">$body</font> .= _sendscreen_add_attachment( <font color="#cc6633">$file</font> ); <font color="#cc6633">$body</font> .= <font color="#008000">"\n\n"</font> ; <font color="#cc6633">$body</font> .= <font color="#008000">"--"</font> . <font color="#cc6633">$boundary_id</font> . <font color="#008000">"--\n\n"</font> ; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'headers'</font> ] = <font color="#cc6633">$message</font> [ <font color="#008000">'headers'</font> ]; <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'body'</font> ] = <font color="#cc6633">$body</font> ; } <font color="#0000ff">return</font> <font color="#cc6633">$msg</font> ; }</font> <br></code> <br></blockquote><br><br>  I think that the implementation of the main functions used to build the form, there is no need to comment on it in detail, I‚Äôll dwell only on a few points. <br><br>  As can be seen from the code, the built-in drupal function <a href="http://api.drupal.org/api/function/drupal_mail/6">drupal_mail is</a> used to send the message, but it is not suitable for sending messages with attachments and in HTML format, so you have to do it yourself.  To do this, in the implementation of <a href="http://api.drupal.org/api/function/hook_mail/6">hook_mail</a> we need to set the correct headers for the letter in HTML format and set the encoding to UTF-8.  Next, the <i>_sendscreen_process_attachment</i> function is <i>called</i> , which includes a file in the message body and returns a new message body and a new header.  If a file in the form has not been selected, it returns an empty array and <i>$ message</i> remains unchanged. <br><br>  In order to insert a file into a letter, it needs to be encoded so that it can be included in a text letter, as well as add the necessary headers, which is what the <i>_sendscreen_add_attachment</i> function <i>does</i> .  Letters with an attachment are multi-section, in order for email clients to read them correctly, you must specify the identifier of the section boundaries.  To do this, such letters must have a special header in which the <i>boundary</i> identifier is specified in the <i>boundary</i> parameter. <br><br>  Actually, that's all.  In order to try how it works, you can create a file <i>sendscreen.module</i> , copy all the above code into it, also create a file <i>sendscreen.info</i> , for example, with the following contents: <br><br><blockquote> <code><a href="http://s-c.me/6414/s"></a> <a href="http://s-c.me/6414/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  ;  $ Id $ </li><li>  name = SendScreen </li><li>  description = Allow users to send e-mail </li><li>  package = Samples </li><li>  version = 1.0 </li><li>  core = 6.x </li><li>  php = 5.2 </li></ol><br><br></blockquote><br><br>  install the received module on the site and go to <i><a href="http://yourdomain/sendscreen">yourdomain / sendscreen address</a></i> . <br><br>  I hope that this topic will be useful to someone.  And since  I am a beginner drupaller, I fully admit that I missed something, or even did something wrong, so I will be happy for advice and comments. </div><p>Source: <a href="https://habr.com/ru/post/89719/">https://habr.com/ru/post/89719/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../89712/index.html">A little friday or how we prepared illustrations</a></li>
<li><a href="../89713/index.html">Office 2010 - free</a></li>
<li><a href="../89714/index.html">Little about design</a></li>
<li><a href="../89716/index.html">my first startup on habr</a></li>
<li><a href="../89717/index.html">Competition results for the best #codejoke</a></li>
<li><a href="../89720/index.html">How to apply IDisposable and finalizers: 3 simple rules</a></li>
<li><a href="../89721/index.html">Hakintosh iPhone OS launched on HTC Hero</a></li>
<li><a href="../89722/index.html">The second Ukrainian forum of Internet leaders Iforum (report + photos) was held in Kiev</a></li>
<li><a href="../89727/index.html">What can you do in 2 days?</a></li>
<li><a href="../89731/index.html">Quake2 on HTML5, no plugins</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>