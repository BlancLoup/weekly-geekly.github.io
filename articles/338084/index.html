<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ethereum Smart Contracts: writing a simple contract for ICO</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I have received a huge number of requests for help in developing a smart contract for an ICO, and I don‚Äôt have enough time to help everyone....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ethereum Smart Contracts: writing a simple contract for ICO</h1><div class="post__text post__text-html js-mediator-article">  Recently, I have received a huge number of requests for help in developing a smart contract for an ICO, and I don‚Äôt have enough time to help everyone.  Therefore, I decided to write this small post (link to the video at the end of the post), in which I describe a very simple smart contract for a crowdsale, which you can use in your projects. <br><br><img src="https://habrastorage.org/web/8ab/3e7/49b/8ab3e749b3da48f5ae3a03cb08406839.png"><br><a name="habracut"></a><br>  To save time, I wrote a contract in advance.  Let's break it down into steps. <br><br>  Smartcontract is a program written in a programming language.  In our case in the language of Solidity.  To develop simple contracts, I use the online editor and the Remix compiler. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Sign of a good tone is considered to start any program, incl.  and smart contracts, with the indication of the license on which it is distributed.  In our case, this is the GPL.  You can also specify yourself as the author of the contract, of course, if you are not writing a contract for any scam project where you are embarrassed to specify yourself as an author. <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* This file is part of the EasyCrowdsale Contract. The EasyCrowdsale Contract is free software: you can redistribute it and/or modify it under the terms of the GNU lesser General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. The EasyCrowdsale Contract is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU lesser General Public License for more details. You should have received a copy of the GNU lesser General Public License along with the EasyCrowdsale Contract. If not, see &lt;http://www.gnu.org/licenses/&gt;. @author Ilya Svirin &lt;i.svirin@prover.io&gt; */</span></span></code> </pre> <br>  Immediately after comes the line that indicates which version of the compiler should be used.  If this line is not, then the smart contract will not compile. <br><br><pre> <code class="javascript hljs">pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>;</code> </pre><br>  Next comes the source code of the smart contract itself, which I structured as a hierarchy of contracts, each of which implements the complete functionality.  This simplifies the understanding and subsequent use of the code in your contracts. <br><br>  First of all, it should be understood that after downloading a smart contract to an Ethereum virtual machine, you will interact with it on a common basis, like all other users.  It is logical that we, as a project team, would like to be in privileged conditions, which should at least be expressed in the fact that the contract should form precisely on command tokens and, of course, gave us the collected broadcast.  For this, the contract must know its owner and the ‚Äúowned‚Äù contract is responsible for this. <br><br><pre> <code class="javascript hljs">contract owned { address public owner; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">owned</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">payable</span></span></span><span class="hljs-function"> </span></span>{ owner = msg.sender; } modifier onlyOwner { <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(owner == msg.sender); _; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">changeOwner</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">address _owner</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onlyOwner</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span><span class="hljs-function"> </span></span>{ owner = _owner; } }</code> </pre><br>  The "owned" contract contains only one public field "owner", the value of which is initialized in the constructor by the value of the "sender" field of the global structure "msg", thus, initially the owner of the contract becomes the one who implemented it. <br><br>  It is logical to foresee the possibility of changing the owner in case our private key is compromised; for this, the ‚ÄúchangeOwner‚Äù function is provided, which receives the address of the new owner as a parameter.  It should be paid to the modifier ¬´onlyOwner¬ª, which is defined within the same smart contract.  Modifiers are a very convenient design that allows you to group and assign a name to the conditions for calling functions of a smart contract.  The ‚ÄúonlyOwner‚Äù modifier checks that the function is called from the address that is stored in the ‚Äúowner‚Äù field. <br><br>  The ‚Äúowned‚Äù contract is fully operational and extremely simple, but it carries one hidden threat, because by calling the ‚ÄúchangeOwner‚Äù function, we can mistakenly specify a non-existent address, which means we lose control over the contract.  To correct this deficiency, it is enough to enter another field, call it ‚Äúcandidate‚Äù, and when calling the function ‚ÄúchangeOwner‚Äù we will save the new value first to ‚Äúcandidate‚Äù and move it to ‚Äúowner‚Äù as soon as the candidate confirms his entry into the rights by calling the "confirmOwner" function from your address. <br><br>  The next contract in the hierarchy, Crowdsale, is directly responsible for collecting funds and issuing tokens, and inherits the previously owned owned contract. <br><br><pre> <code class="javascript hljs">contract Crowdsale is owned { uint256 public totalSupply; mapping (<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">address</span></span></span><span class="hljs-function"> =&gt;</span></span> uint256) public balanceOf; event Transfer(address indexed <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>, address indexed to, uint256 value); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Crowdsale</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">payable</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">owned</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ totalSupply = <span class="hljs-number"><span class="hljs-number">21000000</span></span>; balanceOf[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>] = <span class="hljs-number"><span class="hljs-number">20000000</span></span>; balanceOf[owner] = totalSupply - balanceOf[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>]; Transfer(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, owner, balanceOf[owner]); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">payable</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(balanceOf[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>); uint256 tokensPerOneEther = <span class="hljs-number"><span class="hljs-number">5000</span></span>; uint256 tokens = tokensPerOneEther * msg.value / <span class="hljs-number"><span class="hljs-number">1000000000000000000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tokens &gt; balanceOf[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>]) { tokens = balanceOf[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>]; uint valueWei = tokens * <span class="hljs-number"><span class="hljs-number">1000000000000000000</span></span> / tokensPerOneEther; msg.sender.transfer(msg.value - valueWei); } <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(tokens &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>); balanceOf[msg.sender] += tokens; balanceOf[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>] -= tokens; Transfer(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, msg.sender, tokens); } }</code> </pre><br>  Special attention should be paid to the following elements of the contract: <br><br><ul><li>  The totalSupply public field, which must contain the total number of tokens issued by the smart contract; </li><li>  Public balanceOf card, which contains information on the balances of all holders of tokens; </li><li>  The Transfer event that should be emitted by the smart contract for each token transfer operation between token holders. </li></ul><br>  All these three elements are one, they are a mandatory part of the ERC20 standard, which must be observed so that the information about our tokens is correctly displayed in the wallets of users and etherscan.io. <br><br>  The designer of the smart contract "Crowdsale" is extremely simple.  First of all, the value of the ‚ÄútotalSupply‚Äù field is initialized.  Our contract issues 21 million tokens, of which 20 million will be immediately transferred to the smart contract balance.  We assume that the tokens from the address of the smart contract are available for sale.  The remaining tokens, in our case 1 million, will be written to the address of the owner of the contract.  Well, at the end of the constructor, the ‚ÄúTransfer‚Äù event is emitted, which is placed on the blockchain and informs contract users that a corresponding number of tokens have been transferred from the balance of the contract to the balance of the contract holder.  It is the emission of this event that allows etherscan.io to correctly display tokens holders and their balances. <br><br>  Well, the most important function of the smart contract is ‚ÄúCrowdsale‚Äù, the so-called fallback function, which is called every time the air arrives at the address of our smart contract.  At the very beginning, a check is made that there is at least some number of tokens for sale on the smart contract balance.  Next, set a fixed price of tokens - 5000 pieces for 1 air.  Then we calculate how many tokens must be sent to the sender.  The number of funds transferred in the transaction is recorded in the ‚Äúvalue‚Äù field of the global structure ‚Äúmsg‚Äù and it is indicated in ‚Äúwei‚Äù, therefore, when determining the number of tokens, we translate ‚Äúwei‚Äù into ‚Äúether‚Äù. <br><br>  Then a check is made that there is a sufficient number of tokens on the balance of the smart contract.  If more tokens are requested than the smartcontract has, then we will transfer all the remaining tokens.  We determine the cost in ‚Äúwei‚Äù of the remaining tokens and return to the sender the over-translated air.  We make sure that the number of purchased tokens is non-zero, after which we record this number of tokens on the balance of the buyer and deduct them from the balance of the smart contract.  At the end, don't forget to emit the Transfer event. <br><br>  This is where the actual implementation of the fundraising functionality is completed, but now we need to make our token operable and implement some more features of the ERC20 standard.  This is done in the ‚ÄúEasyToken‚Äù contract, which is inherited from the previously reviewed ‚ÄúCrowdsale‚Äù contract. <br><br><pre> <code class="javascript hljs">contract EasyToken is Crowdsale { string public standard = <span class="hljs-string"><span class="hljs-string">'Token 0.1'</span></span>; string public name = <span class="hljs-string"><span class="hljs-string">'EasyTokens'</span></span>; string public symbol = <span class="hljs-string"><span class="hljs-string">"ETN"</span></span>; uint8 public decimals = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EasyToken</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">payable</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Crowdsale</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transfer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">address _to, uint256 _value</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(balanceOf[msg.sender] &gt;= _value); balanceOf[msg.sender] -= _value; balanceOf[_to] += _value; Transfer(msg.sender, _to, _value); } }</code> </pre><br>  First of all, we will define 4 public fields, which are now practically not used by any wallets, but for the order we will nevertheless define them.  Here we indicate the full and abbreviated name of the token, as well as the number of fractional characters.  In our case, the token is indivisible, because  the value of the decimals field is set to 0. <br><br>  And finally, the only smart contract function ‚ÄúEasyToken‚Äù for which we created this contract is ‚Äútransfer‚Äù, which is also part of the ERC20 standard and will allow users' wallets to transfer tokens to each other, transfer them to the stock exchange and withdraw them.  The implementation of the function is extremely simple, the sufficiency of the number of tokens on the balance of the sender is checked, after which the balance of the sender decreases, and the balance of the recipient increases by the requested number of tokens.  At the end, the ‚ÄúTransfer‚Äù event is emitted.  Now our token is operable and it remains to do the most important thing - to give the contract holder the opportunity to withdraw the collected airs.  We will do this in the ‚ÄúEasyCrowdsale‚Äù contract. <br><br><pre> <code class="javascript hljs">contract EasyCrowdsale is EasyToken { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EasyCrowdsale</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">payable</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EasyToken</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">withdraw</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onlyOwner</span></span></span><span class="hljs-function"> </span></span>{ owner.transfer(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.balance); } }</code> </pre><br>  The ‚Äúwithdraw‚Äù function has an ‚ÄúonlyOwner‚Äù modifier, i.e.  can only be called by the owner of a smart contract.  The only thing she does is transfer the entire balance of the smart contract to the address of the owner of the smart contract. <br><br>  Despite the fact that the considered smart contract is fully functional and workable, I would not recommend using it in a real project.  Excessive simplification of the contract logic has led to the fact that such a contract does not adequately protect the interests of investors, namely, it does not set the deadline for crowdsale, does not set the minimum collection limit, does not return funds to investors in case the minimum limit is not reached, and also contains a number of known Vulnerabilities at the level of the compiler language Solidity, for example, is subject to the so-called short address attack. <br><br>  Many of these shortcomings are eliminated in the smart contract of our <a href="https://prover.io/">PROVER</a> project.  The PROOF contract is uploaded to Ethereum <a href="https://etherscan.io/address/0x5B5d8A8A732A3c73fF0fB6980880Ef399ecaf72E">at this address</a> along with the source code, which can be found.  You can even check how the contract works, by sending a real broadcast to it, right now we are having Pre-ICO :).  In fact, we will be happy if you join the presale of our PROVER project, which will last until the end of September.  PROVER is a unique technology for verifying the authenticity of video materials based on blockchain and video analytics. <br><br>  Useful links: <br><br><ul><li>  <a href="">The full code of the smartcontract analyzed in this post</a> </li><li>  <a href="https://www.youtube.com/watch%3Fv%3DlKnOxopK6Yc">My video presentation on creating a simple smart contract for ICO</a> </li><li>  <a href="https://github.com/ethereum/EIPs/issues/20">ERC20 Token standard</a> </li><li>  <a href="https://prover.io/">My project PROVER</a> - <b>goes Pre-ICO !!!</b> </li><li>  <a href="https://habrahabr.ru/company/emercoin/blog/334650/">Another post about my project PROVER</a> </li><li>  <a href="https://www.youtube.com/watch%3Fv%3DJhG8ckZ5mpo%26t%3D541s">PROVER Project Video Presentation (eng)</a> </li><li>  <a href="https://habrahabr.ru/post/339102/">Ethereum Smart Contracts: What to do when you make a mistake in a smart contract or migration technique</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/338084/">https://habr.com/ru/post/338084/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338072/index.html">Padding Oracle Attack: cryptography still scares</a></li>
<li><a href="../338074/index.html">Classic 2D quest or how our two years of development went. Part 1</a></li>
<li><a href="../338078/index.html">In the footsteps of cyberdetective</a></li>
<li><a href="../338080/index.html">How to manage enterprise SSH keys</a></li>
<li><a href="../338082/index.html">What's in the black box: what are the costs of the virtual and physical infrastructure</a></li>
<li><a href="../338086/index.html">ASO: ranking in the App Store and Google Play (find 10 differences in algorithms)</a></li>
<li><a href="../338088/index.html">Projections? No thanks</a></li>
<li><a href="../338090/index.html">Something about homegrown</a></li>
<li><a href="../338092/index.html">Joseph "Lick" Liclider: "Intergalactic Computer Network" (1963)</a></li>
<li><a href="../338098/index.html">We pull video from YouTube and distribute via WebRTC in real-time</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>