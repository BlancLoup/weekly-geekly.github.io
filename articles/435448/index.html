<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>About the experience of communicating with the signal generator through QTcpSocket and SCPI</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Intro 
 In the third year I came to practice in one of the enterprises of the domestic rocket and space industry. I was an ambitious trainee and quite...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>About the experience of communicating with the signal generator through QTcpSocket and SCPI</h1><div class="post__text post__text-html js-mediator-article"><h3>  Intro </h3><br>  In the third year I came to practice in one of the enterprises of the domestic rocket and space industry.  I was an ambitious trainee and quite active <s>until I had seen the routine work at a Russian state-owned enterprise</s> and, at my request, was assigned to a department engaged in the development <b>of test equipment</b> (hereafter <b>referred to as KPA</b> ).  By the way, a large part of the development of the <b>CPA</b> is writing a software part for the equipment.  Including, for checking the developed hardware, the department has various <b>monitoring and measuring devices</b> , all of them are connected to a common network.  As a result, as one of my first assignments was to write an application to control the signal generator. <br><br>  This article will be discussed. <br><a name="habracut"></a><br><h3>  Start </h3><br>  All applications in the department are developed using C ++ tools and Qt libraries.  I had experience with this framework, so there were no difficulties on this side.  In addition, Qt has extensive documentation, and you can always <s>copy-paste the code from StackOverflow to</s> consult with the curator. <br><br>  Since all devices are connected to the same network, the question of how to connect to them is also decided very quickly - we use the network part of Qt in the form of QTcpSocket. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The most interesting question arose when I had to decide how to communicate with these devices, how to activate one or another function, or to transfer this or that value.  At the same time, it turned out that everything was rather trivial: there is a protocol for standard commands for programmable tools ‚Äî SCPI.  It allows using standard commands to control any devices that support this standard. <br><br><h3>  Begin to code </h3><br><div class="spoiler">  <b class="spoiler_title">Everything in the header file is standard and uninteresting:</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> SIGGENCONTROL_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> SIGGENCONTROL_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QMainWindow&gt; #include &lt;QTcpSocket&gt; #include &lt;QString&gt; namespace Ui { class sigGenControl; } class sigGenControl : public QMainWindow { Q_OBJECT public: explicit sigGenControl(QWidget *parent = 0); ~sigGenControl(); //      ,      QString host; //= "192.168.1.109"; ip   int port;// = 5025;   void clearErr(); //   bool rfOn; //    bool pset = false; bool hset = false; private: Ui::sigGenControl *ui; QTcpSocket* socket; private slots: //,     .cpp  void connectToHostSlot(); void sendToHostSlot(); void readyReadSlot(); void setFreq(); void setPow(); void activateRF(); void checkErrSlot(); void setPort(); void setHost(); void setDefault(); void dialValChangedSlot(); }; #endif // SIGGENCONTROL_H</span></span></span></span></code> </pre> <br></div></div><br>  The interface was decided to do this: <br><br><img src="https://habrastorage.org/webt/tb/43/ha/tb43harz2kczpsdsfjhc0t-mvci.png"><br><br>  It is quite simple and intuitive.  In two lines, the host and port of the device are specified at the top.  It is also possible to choose standard values, then they will take the following form: <br><br><pre> <code class="cpp hljs">port = <span class="hljs-number"><span class="hljs-number">5025</span></span>; host = <span class="hljs-string"><span class="hljs-string">"192.168.1.109"</span></span>;</code> </pre><br>  Next comes the text field of the log, the response from the device (errors will also come there, if any).  Below are the buttons to connect to the device, send commands, error checking.  In the last three linelines, you can either set your own command and send it to the device, or separately set the frequency and amplitude.  The radio button on the right turns on / off the RF output.  A twist adjusts the frequency when the checkbox is cleared and amplitude when activated. <br><br><h3>  Continue and end </h3><br><div class="spoiler">  <b class="spoiler_title">The most interesting things start in the .cpp file:</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"siggencontrol.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ui_siggencontrol.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"qdebug.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QTime&gt; sigGenControl::sigGenControl(QWidget *parent) : QMainWindow(parent), ui(new Ui::sigGenControl) { ui-&gt;setupUi(this); ui-&gt;history-&gt;setReadOnly(true); ui-&gt;history-&gt;setText("host : not set\nport : not set"); ui-&gt;history-&gt;append(QTime::currentTime().toString() + " : No connection"); socket = new QTcpSocket(this); //     //       -  //    ,       //           connect(ui-&gt;connPb,QPushButton::clicked,this,sigGenControl::connectToHostSlot); connect(ui-&gt;sendToHostPb,QPushButton::clicked,this,sigGenControl::sendToHostSlot); connect(ui-&gt;input,QLineEdit::returnPressed,this,sigGenControl::sendToHostSlot); connect(socket,QTcpSocket::readyRead,this,sigGenControl::readyReadSlot); connect(ui-&gt;freqEdit,QLineEdit::returnPressed,this,sigGenControl::setFreq); connect(ui-&gt;amptdEdit,QLineEdit::returnPressed,this,sigGenControl::setPow); connect(ui-&gt;radioButton,QRadioButton::clicked,this,sigGenControl::activateRF); connect(ui-&gt;errPb,QPushButton::clicked,this,sigGenControl::clearErr); connect(ui-&gt;hostEdit,QLineEdit::returnPressed,this,sigGenControl::setHost); connect(ui-&gt;portEdit,QLineEdit::returnPressed,this,sigGenControl::setPort); connect(ui-&gt;checkBox,QCheckBox::clicked,this,sigGenControl::setDefault); connect(ui-&gt;dial, QDial::valueChanged,this,sigGenControl::dialValChangedSlot); ui-&gt;hist-&gt;setReadOnly(true); QString deactRF = ":OUTP 0\n"; //  SCPI ,        socket-&gt;write(deactRF.toLocal8Bit()); //      this-&gt;rfOn = false; //   ui-&gt;input-&gt;setReadOnly(true); ui-&gt;freqEdit-&gt;setReadOnly(true); ui-&gt;amptdEdit-&gt;setReadOnly(true); ui-&gt;radioButton-&gt;setEnabled(false); ui-&gt;sendToHostPb-&gt;setEnabled(false); ui-&gt;errPb-&gt;setEnabled(false); ui-&gt;connPb-&gt;setDisabled(true); } sigGenControl::~sigGenControl() { delete ui; } void sigGenControl::connectToHostSlot(){ socket-&gt;connectToHost(host,port); //   //     qDebug()    if (socket-&gt;waitForConnected(1000)) qDebug("Connected!"); ui-&gt;history-&gt;append(QTime::currentTime().toString() + " : Connected"); //   ui-&gt;input-&gt;setReadOnly(false); ui-&gt;freqEdit-&gt;setReadOnly(false); ui-&gt;amptdEdit-&gt;setReadOnly(false); ui-&gt;radioButton-&gt;setEnabled(true); ui-&gt;sendToHostPb-&gt;setEnabled(true); ui-&gt;errPb-&gt;setEnabled(true); ui-&gt;input-&gt;setText("*IDN?"); //    } void sigGenControl::sendToHostSlot(){ //     socket-&gt;write(ui-&gt;input-&gt;text().toLocal8Bit()+"\n"); } void sigGenControl::readyReadSlot(){ //     qDebug("ready read!"); QByteArray dataArr; //    dataArr = socket-&gt;readAll(); //   ui-&gt;hist-&gt;append(QTime::currentTime().toString() + " " + dataArr); } void sigGenControl::clearErr(){ // ,   ,  ,   QString errTxt = ":SYST:ERR?\n"; socket-&gt;write(errTxt.toLocal8Bit()); } void sigGenControl::setFreq(){ QString fr = " kHz"; QString cmd = ":FREQ "; //    QString command = cmd+ui-&gt;freqEdit-&gt;text()+fr+"\n"; //  qDebug() &lt;&lt; command; socket-&gt;write(command.toLocal8Bit()); //   } void sigGenControl::setPow(){ QString amp = " dBm"; QString cmd = ":POW "; //    socket-&gt;write(cmd.toLocal8Bit() + ui-&gt;amptdEdit-&gt;text().toLocal8Bit() + amp.toLocal8Bit() + "\n"); //  } void sigGenControl::activateRF(){ //       //   QString actRF = ":OUTP 1\n"; //   QString deactRF = ":OUTP 0\n"; //   if(this-&gt;rfOn == false){ socket-&gt;write(actRF.toLocal8Bit()); rfOn = true; }else{ socket-&gt;write(deactRF.toLocal8Bit()); rfOn = false; } } void sigGenControl::checkErrSlot(){ clearErr(); } void sigGenControl::setHost(){ //   this-&gt;host = ui-&gt;hostEdit-&gt;text(); ui-&gt;history-&gt;append("host: " + host); ui-&gt;checkBox-&gt;setEnabled(true); hset = true; //  if((pset &amp;&amp; hset) == true){ ui-&gt;connPb-&gt;setEnabled(true); } } void sigGenControl::setPort(){ //   this-&gt;port = ui-&gt;portEdit-&gt;text().toInt(); ui-&gt;history-&gt;append("port: " + QString::number(port)); ui-&gt;checkBox-&gt;setEnabled(true); pset = true; //  if((pset &amp;&amp; hset) == true){ ui-&gt;connPb-&gt;setEnabled(true); } } void sigGenControl::setDefault(){ //     port = 5025; host = "192.168.1.109"; ui-&gt;history-&gt;append(QTime::currentTime().toString() + " " + "host: " + host); ui-&gt;history-&gt;append(QTime::currentTime().toString() + " " + "port: " + QString::number(port)); ui-&gt;checkBox-&gt;setDisabled(true); ui-&gt;connPb-&gt;setEnabled(true); ui-&gt;hostEdit-&gt;setText(host); ui-&gt;portEdit-&gt;setText(QString::number(port)); } void sigGenControl::dialValChangedSlot(){ //   ,       qDebug()&lt;&lt; "value : " &lt;&lt; ui-&gt;dial-&gt;value(); if(ui-&gt;amplCheckBox-&gt;isChecked() == false){ //  ,      ui-&gt;dial-&gt;setMinimum(100); ui-&gt;dial-&gt;setMaximum(20000000); QString fr = " kHz"; QString cmd = ":FREQ "; //    QString command = cmd+QString::number(ui-&gt;dial-&gt;value())+fr+"\n"; qDebug() &lt;&lt; command; socket-&gt;write(command.toLocal8Bit()); ui-&gt;label-&gt;setText("FREQUENCY :" + QString::number(ui-&gt;dial-&gt;value()) + " kHz" ); }else if(ui-&gt;amplCheckBox-&gt;isChecked() == true){ //  ,       ui-&gt;dial-&gt;setMinimum(-130); ui-&gt;dial-&gt;setMaximum(15); QString pw = " dBm"; QString cmd = ":POW "; //    QString command = cmd+QString::number(ui-&gt;dial-&gt;value())+pw+"\n"; qDebug() &lt;&lt; command; socket-&gt;write(command.toLocal8Bit()); ui-&gt;label-&gt;setText("AMPLITUDE :" + QString::number(ui-&gt;dial-&gt;value()) + " dBm" ); } }</span></span></span></span></code> </pre> <br></div></div><br><h3>  After reading </h3><br>  I understand that the article may seem divorced from life and reality for a large number of readers, but remote control of instrumentation in the field of engineering is a fairly common topic that brings many benefits and convenience (for example, you do not need to run to the instruments and press buttons) . <br><br>  The rest of this article is informational and entertaining in nature and is aimed more at enthusiasts and at people involved in the development and testing of boards and other hardware.  The rest would just like to talk about their little software development experience for such specific purposes. </div><p>Source: <a href="https://habr.com/ru/post/435448/">https://habr.com/ru/post/435448/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../435432/index.html">New Year, New GitHub: Unlimited Free Private Repositories</a></li>
<li><a href="../435434/index.html">We use annotations in PHP to the maximum</a></li>
<li><a href="../435436/index.html">5 IT infrastructure trends: forecast for 2019</a></li>
<li><a href="../435442/index.html">Funnel change</a></li>
<li><a href="../435446/index.html">Verkhuffa algorithm for an arbitrary even number system</a></li>
<li><a href="../435450/index.html">Happy new year with new MQTT / UDP</a></li>
<li><a href="../435452/index.html">End-to-end testing of microservices with Catcher</a></li>
<li><a href="../435454/index.html">AOP vs Functions</a></li>
<li><a href="../435462/index.html">Testing Node.js projects. Part 1. Anatomy of tests and types of tests</a></li>
<li><a href="../435464/index.html">Testing Node.js projects. Part 2. Evaluation of the effectiveness of tests, continuous integration and analysis of code quality</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>