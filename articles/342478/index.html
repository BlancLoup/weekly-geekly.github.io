<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Integration of physical bodies obtained in the Physics Body Editor into cocos2d-x-scene</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Creating the game on the cocos2d-x engine, I needed a tool for creating physical bodies from arbitrary images. Initially, the search led me to the com...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Integration of physical bodies obtained in the Physics Body Editor into cocos2d-x-scene</h1><div class="post__text post__text-html js-mediator-article">  Creating the game on the cocos2d-x engine, I needed a tool for creating physical bodies from arbitrary images.  Initially, the search led me to the commercial tool PhysicsEditor, but looking at its price, I decided to find something cheaper.  I had to spend quite a lot of time before I came across video tutorials that turned out to be useful for me. <br><br>  This article will describe how to create physical bodies for images in the free, cross-platform Physics Body Editor and integrate them into the cocos2d-x scene. <br><a name="habracut"></a><br>  For the lesson we need an image with a transparent background.  If you do not have the right hand, you can use this. <br><br><img src="https://habrastorage.org/webt/i3/db/p-/i3dbp-nk-gluv8kgpqr-2ods2ak.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Download the Physics Body Editor at <a href="https://code.google.com/archive/p/box2d-editor/downloads">this link</a> . <br><br>  Unpack it and double-click on physics-body-editor.jar.  You must have Java software installed on your system, otherwise the editor will not start. <br><br>  After running the Physics Body Editor, this window should appear. <br><br><img src="https://habrastorage.org/webt/tc/bx/yj/tcbxyj1hd2sui5kbbg2n_s6ktma.png"><br><br>  Click New proect <br><br><img src="https://habrastorage.org/webt/hw/rl/sf/hwrlsf_mgbw7t5s4bra3jcrkvsw.png"><br><br>  At the top, select the folder where the file with the physical body will be stored.  Below we write the name of this file.  I called it pampkin.json.  Click OK. <br><br><img src="https://habrastorage.org/webt/ip/ex/wc/ipexwcdy17a4cpzvjmf_lxhu1wy.png"><br><br>  Now we click New <br><br><img src="https://habrastorage.org/webt/kk/ao/91/kkao918rvhbb_xmop86mjfemfw4.png"><br><br>  In the window that appears, enter the name of the created body, I put the name pampkin.  Then click the button Create body from image. <br><br><img src="https://habrastorage.org/webt/y4/9y/ik/y49yikcn0dv9u1gna1eu-hxdmha.png"><br><br>  Select the image file and click OK. <br><br>  Our image appeared in the editor, as well as the scene menu.  Let me explain what these menu flags mean. <br><br>  With the Creation flag set, each click of the paint on the scene creates a point for our body until a closed loop is obtained.  I created a contour of 5 points.  If you click on the Creation flag, the scene mode will change to Edition. <br><br><img src="https://habrastorage.org/webt/zt/k3/aa/ztk3aaj0cir3q3vx9jf9vxhahae.png"><br><br>  In Edition mode, we can edit the created points.  Just hover the mouse over the point, hold down the left mouse button and without releasing, drag the point to a position that you find more correct.  In this mode, you can also delete selected points by clicking Remove points.  Clicking the Edition flag, we will switch to Test body test mode. <br><br><img src="https://habrastorage.org/webt/-p/-a/1l/-p-a1lblkdnuoidpahvamctgu64.png"><br><br>  In Test mode, holding the left mouse button and pointing the scope in the direction of our body, we can launch a ball into it that bounces off of it.  Clicking on the Test flag, we will again get into Creation mode. <br><br><img src="https://habrastorage.org/webt/pj/7p/fk/pj7pfkluhgpewqls0iwuenppbqg.png"><br><br>  Our body turned out to be completely different.  Therefore, we delete all points by clicking Clear all points. <br><br><img src="https://habrastorage.org/webt/3o/vu/l3/3ovul3recuvjceidbfm6bnrce4s.png"><br><br>  Creating points by hand is not very convenient, since in the Physics Body Editor, this process can be automated.  Click Auto-trace, in the appeared window we leave everything by default and click OK. <br><br><img src="https://habrastorage.org/webt/lf/wz/dz/lfwzdzxqymmmo43h7s7bnnzo1rq.png"><br><br>  And we got such a body. <br><br><img src="https://habrastorage.org/webt/-2/mr/cc/-2mrccqxbxotlerku4abmhjk2b4.png"><br><br>  We edit, if something is not pleasant, we test, and we save by clicking Save. <br><br><img src="https://habrastorage.org/webt/te/uk/qa/teukqa-qhtdtxndch146tf88o2w.png"><br><br>  The physical body for the image is ready. <br><br>  Next we will work with cocos2d-x. <br><br>  To begin, transfer the files with the physical body and the image into the folder with the Resources Resources. <br><br>  Create a new project in cocos2d-x. <br><br>  To download our json file that contains the physical body, we will need to download a special class.  <a href="https://yadi.sk/d/3yv8HNQR3PfNy5">Download it</a> and drop it into the Classes folder. <br><br>  Next, open the CMakeLists.txt file and add the paths to the MyBodyParser.h and MyBodyParser.cpp files.  It should look like this. <br><br><pre><code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(GAME_SRC Classes/AppDelegate.cpp Classes/HelloWorldScene.cpp Classes/MyBodyParser.cpp ${PLATFORM_SPECIFIC_SRC} ) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(GAME_HEADERS Classes/AppDelegate.h Classes/HelloWorldScene.h Classes/MyBodyParser.h ${PLATFORM_SPECIFIC_HEADERS} )</code> </pre> <br>  If you are compiling code for Androyd, then open the Android.mk file and add the path to the MyBodyParser class. <br><br><pre> <code class="cpp hljs">LOCAL_SRC_FILES := hellocpp/main.cpp \ ../../../Classes/AppDelegate.cpp \ ../../../Classes/MyBodyParser.cpp \ ../../../Classes/HelloWorld.cpp</code> </pre><br><br>  Open the HelloWorld.h file and remove such code from there. <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// a selector callback void menuCloseCallback(cocos2d::Ref* pSender);</span></span></code> </pre><br>  Add MyBodyParser class <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"MyBodyParser.h"</span></span></span></span></code> </pre><br>  and such code inside the HelloWorld class. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-comment"><span class="hljs-comment">//          cocos2d::PhysicsWorld *sceneWorld; void SetPhysicsWorld( cocos2d::PhysicsWorld *world ) { sceneWorld = world; };</span></span></code> </pre><br>  Code requiring clarification will contain comments. <br><br>  Open HelloWorld.cpp and remove the menuCloseCallback function we don't need (Ref * pSender). <br><br>  Replace the code from the createScene () function with this. <br><br><pre> <code class="cpp hljs">Scene* HelloWorld::createScene() { <span class="hljs-comment"><span class="hljs-comment">//     auto scene = Scene::createWithPhysics(); //  DEBUGDRAW_ALL,         scene-&gt;getPhysicsWorld()-&gt;setDebugDrawMask( PhysicsWorld::DEBUGDRAW_ALL ); //   auto layer = HelloWorld::create(); //         layer-&gt;SetPhysicsWorld( scene-&gt;getPhysicsWorld() ); //    scene-&gt;addChild( layer ); return scene; }</span></span></code> </pre><br>  Replacing the contents of the bool HelloWorld :: init () function with this. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> HelloWorld::init() { <span class="hljs-comment"><span class="hljs-comment">////////////////////////////// // 1. super init first if ( !Scene::init() ) { return false; } //       auto visibleSize = Director::getInstance()-&gt;getVisibleSize(); //   visibleSize,     ,         3  auto edgeBody = PhysicsBody::createEdgeBox( visibleSize, PHYSICSBODY_MATERIAL_DEFAULT, 3 ); //   ,     auto edgeNode = Node::create(); //       edgeNode-&gt;setPosition( visibleSize.width / 2, visibleSize.height / 2 ); //      edgeNode-&gt;setPhysicsBody( edgeBody ); //     this-&gt;addChild( edgeNode ); //   auto sprite = Sprite::create( "pampkin.png" ); //  -   json- if( MyBodyParser::getInstance()-&gt;parseJsonFile( "pampkin.json" ) ) { //   .   -  (    ),   - ,        . auto spriteBody = MyBodyParser::getInstance()-&gt;bodyFormJson( sprite, "pampkin", PhysicsMaterial( 1.0f, 0.0f, 1.0f ) ); if( spriteBody != nullptr ) { //     sprite-&gt;setPhysicsBody( spriteBody ); } else { CCLOG( "Object.cpp spriteBody is nullptr" ); } } else { CCLOG( "JSON file not found" ); } //      sprite-&gt;setPosition( Vec2( visibleSize.width / 2, visibleSize.height / 2 ) ); this-&gt;addChild( sprite ); return true; }</span></span></code> </pre><br>  Compile, run and get this result. <br><br><img src="https://habrastorage.org/webt/qe/_7/4i/qe_74iwedcvcrkevevzmzg5maou.png"><br><br>  Well, in order to more clearly see the work of physics, you can make our pumpkin rotate. <br><br><pre> <code class="cpp hljs">sprite-&gt;getPhysicsBody()-&gt;setAngularVelocity( <span class="hljs-number"><span class="hljs-number">-10</span></span> );</code> </pre><br>  If you are too lazy to create a body in the editor and insert pieces of the code given above into your project, you can <a href="https://yadi.sk/d/GqR-MRN53PfPfF">download ready-made folders</a> with the Classes and Resources files at this link. <br><br>  Just do not forget to add everything you need to makefile.  I hope this publication will help beginners to quickly get used to physics in cocos2d-x. </div><p>Source: <a href="https://habr.com/ru/post/342478/">https://habr.com/ru/post/342478/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../342466/index.html">Where the technical line with a car is rolling: hakatons in Avito</a></li>
<li><a href="../342468/index.html">Connect (); 2017: live broadcast</a></li>
<li><a href="../342470/index.html">FPConf 2017. Interview with Denis Shevchenko</a></li>
<li><a href="../342474/index.html">New free product Veeam Availability Console for service providers and large companies</a></li>
<li><a href="../342476/index.html">Recommendations for installing InterSystems Cach√© DBMS in product mode</a></li>
<li><a href="../342480/index.html">Increasing data center standards in Asia</a></li>
<li><a href="../342482/index.html">LVM + lilo> GPT + EFI (or why GRUB is so awkward)</a></li>
<li><a href="../342484/index.html">Top 3 announcements with NetApp Insight 2017</a></li>
<li><a href="../342494/index.html">How to be a team leader - my version</a></li>
<li><a href="../342496/index.html">The fundamental error of system engineering</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>