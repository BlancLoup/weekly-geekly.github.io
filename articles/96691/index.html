<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Full Windows service with customizable schedule for 30 lines</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello to all. 

 Recently, I finally decided to read the entire series of articles about Data acquisition. And starting from the first part I found fo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Full Windows service with customizable schedule for 30 lines</h1><div class="post__text post__text-html js-mediator-article">  Hello to all. <br><br>  Recently, I finally decided to read the entire series of articles about Data acquisition.  And starting from the <a href="http://habrahabr.ru/blogs/net/93958/">first part I</a> found for myself a lot of interesting things about windows service. <br>  Just hung the task to write a simple service, which will be scheduled to pull our corporate site.  I think, here it is a chance to consolidate fresh knowledge.  Honestly, I started to fasten all the chips that were written in the article regarding windows service, but I started to run across the jambs.  But it is not about the doorposts. <br>  Another thought occurred to me that surely someone had already done such smart services, and for sure there are ready-made beautiful solutions.  A couple of minutes of searching and what a surprise it was when I found the <a href="http://code.google.com/p/ncron/">NCron</a> project, which gives not only an easy way to create a service, but also: <br><ol><li>  It knows how to install itself and uninstall as windows service. </li><li>  It can perform tasks on a flexible schedule (from simple, every day at 6 am, to more complex, every third day of the quarterly month at 18 hours and 40 minutes) </li><li>  Allows you to configure an unlimited number of tasks to perform. </li><li>  It allows you to easily tie the logging of common frameworks and already has its own simple built-in logging mechanism in the Event Log. </li><li>  It has enough flexibility to use your favorite IoC containers. </li></ol><br>  And something else useful and convenient.  So it‚Äôs not hard to see that this was exactly what I needed.  Does everything with almost no gestures on my part.  Moreover, I will say that services are very often written for just such simple tasks, which this project covers with its head. <br><br><a name="habracut"></a><br>  So how to fasten this miracle. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Create a project </h3><br><br>  First, create a project <b>Console application</b> .  Everything is standard and simple. <br><br><img alt="Picture 1" src="https://habrastorage.org/storage/habraeffect/a9/be/a9be2661b1270ff62f89f8d5581516b9.png"><br><br><h3>  Add Reference to <a href="http://code.google.com/p/ncron/">NCron</a> </h3><br><br><img alt="Picture 3" src="https://habrastorage.org/storage/habraeffect/09/3b/093be52f7a3ae459353bce86f9bca590.png"><br><br><h3>  Slightly change the main method </h3><br><br><blockquote><code><font color="black"><font color="#0000ff">using</font> NCron.Service; <br> <font color="#0000ff">using</font> NCron.Fluent.Crontab; <br> <font color="#0000ff">using</font> NCron.Fluent.Generics; <br> <br> <font color="#0000ff">namespace</font> ScheduledService <br> { <br> <font color="#0000ff">class</font> Program <br> { <br> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Main( <font color="#0000ff">string</font> [] args) <br> { <br> Bootstrap.Init(args, ServiceSetup); <br> } <br> <br> <font color="#0000ff">static</font> <font color="#0000ff">void</font> ServiceSetup(SchedulingService service) <br> { <br> } <br> } <br> }</font></code> </blockquote> <br><br>  There may be a question why the command line arguments are passed, they are needed so that later the service can install itself (you just need to run it with the <code>install</code> parameter).  The <code>ServiceSetup</code> method <code>ServiceSetup</code> be needed later to configure our tasks on a schedule. <br><br><h3>  Create a simple task </h3><br><br>  This is done simply.  Inheriting your class from the <code>CronJob</code> class and overriding the <code>Execute</code> abstract method.  I immediately added a simplified implementation of the query for some link that comes into the constructor of our task. <br><br><blockquote> <code><font color="black"><font color="#0000ff">using</font> NCron; <br> <br> <font color="#0000ff">namespace</font> ScheduledService <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> RequestParameters <br> { <br> <font color="#0000ff">public</font> <font color="#2B91AF">String</font> <font color="#2B91AF">Uri</font> { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> <font color="#0000ff">int</font> Timeout { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> RequestSenderJob : CronJob <br> { <br> <font color="#0000ff">private</font> RequestParameters RequestParameters { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> RequestSenderJob(RequestParameters requestParameters) <br> { <br> RequestParameters = requestParameters; <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> Execute() <br> { <br> WebRequest request = WebRequest.Create(RequestParameters. <font color="#2B91AF">Uri</font> ); <br> request.UseDefaultCredentials = <font color="#0000ff">true</font> ; <br> request.Timeout = RequestParameters.Timeout &gt; 0 ? RequestParameters.Timeout * 1000 : 60*1000; <font color="#008000">//default 1 min</font> &lt;br/&gt; <br> HttpWebResponse response = (HttpWebResponse)request.GetResponse(); <br> response.Close(); <br> } <br> } <br> } <br></font> <br></code> </blockquote><br>  I must say that in case of an error, its description will already be logged in the Event Log, and if necessary, you can connect your favorite library for logging. <br>  Now the task has been created and you just need to configure its launch. <br><br><h3>  Configure task launch </h3><br><br>  This is where the previously created <code>ServiceSetup</code> method <code>ServiceSetup</code> in <code>ServiceSetup</code> , in which we will enter the logic for queuing calls <br><br><blockquote> <code><font color="black"><font color="#0000ff">using</font> NCron.Fluent.Crontab; <br> <font color="#0000ff">using</font> NCron.Service; <br> <br> <font color="#0000ff">namespace</font> ScheduledService <br> { <br> <font color="#0000ff">class</font> Program <br> { <br> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Main( <font color="#0000ff">string</font> [] args) <br> { <br> Bootstrap.Init(args, ServiceSetup); <br> } <br> <br> <font color="#0000ff">static</font> <font color="#0000ff">void</font> ServiceSetup(SchedulingService service) <br> { <br> <font color="#2B91AF">XDocument</font> document = <font color="#2B91AF">XDocument</font> .Load( <font color="#A31515">"Config.xml"</font> ); <br> <font color="#0000ff">var</font> requestTasks = <font color="#0000ff">from</font> task <font color="#0000ff">in</font> document.Root.Elements( <font color="#A31515">"RequestTask"</font> ) <font color="#0000ff">select</font> task; <br> <br> <font color="#0000ff">foreach</font> ( <font color="#2B91AF">XElement</font> requestTask <font color="#0000ff">in</font> requestTasks) <br> { <br> RequestParameters requestParameters = <font color="#0000ff">new</font> RequestParameters <br> { <br> <font color="#2B91AF">Uri</font> = requestTask. <font color="#2B91AF">Attribute</font> ( <font color="#A31515">"RequestUri"</font> ).Value, <br> Timeout = <font color="#0000ff">int</font> .Parse(requestTask. <font color="#2B91AF">Attribute</font> ( <font color="#A31515">"Timeout"</font> ).Value) <br> }; <br> <font color="#2B91AF">String</font> shedule = requestTask. <font color="#2B91AF">Attribute</font> ( <font color="#A31515">"Shedule"</font> ).Value; <br> service.At(shedule).Run(() =&gt; <font color="#0000ff">new</font> RequestSenderJob(requestParameters)); <br> } <br> } <br> <br> } <br> }</font> <br></code> </blockquote><br><br>  For xml file of the form <br><br><blockquote> <code><font color="black">&lt;?xml version= <font color="#A31515">"1.0"</font> encoding= <font color="#A31515">"utf-8"</font> ?&gt; <br> &lt;Config&gt; <br> &lt;RequestTask RequestUri= <font color="#A31515">"http://habrahabr.ru/"</font> Shedule= <font color="#A31515">"0 1 * * *"</font> Timeout= <font color="#A31515">"180"</font> /&gt; <br> &lt;/Config&gt;</font> <br></code> </blockquote><br>  Yes, here you can kick me for not having checked a single variable for <code>null</code> (I did it solely for clarity and simplicity of the example).  But you should be interested in the variable <code>shedule</code> .  It will contain a string describing the schedule by which the task is launched. <br><br><h3>  Schedule setting </h3><br><br>  The schedule for which the task is started is set using the <code>MINUTES HOURS DAYS MONTHS DAYS-OF-WEEK</code> format string. <br>  Here are a couple of examples from the site itself: <br><blockquote> <code><font color="black"><font color="#008000">//    9 .</font> &lt;br/&gt; <br> service.At( <font color="#A31515">"0 9 * * 0"</font> ).Run&lt;EatBaconAndEggs&gt;(); <br> <br> <font color="#008000">//  8  ,     .</font> &lt;br/&gt; <br> service.At( <font color="#A31515">"0 8 1 1,4,7,10 *"</font> ).Run&lt;SubmitVatDeclaration&gt;(); <br> <br> <font color="#008000">//   ,     8  17,    .</font> &lt;br/&gt; <br> service.At( <font color="#A31515">"*/30 8-17 * * 1-5"</font> ).Run&lt;LookAtStackoverflow&gt;(); <br></font> <br></code> </blockquote><br><br>  As you can see from the example, you can set instead of numbers: '*' - select all, 'nm' - interval from m to n, '* / n' - every nth value, well, for dessert, you can list the values ‚Äã‚Äãseparated by commas and group others types of samples, and indeed you can programmatically set your own rules for the schedule. <br><br><h3>  Installation </h3><br><br>  And lastly on how to start our service, in which, by the way, we have not seen a single class related to the service.  For this, I wrote 2 elementary batch file. <br><br>  install.bat <br><blockquote> <code><font color="black">ScheduledService install <br> pause</font> <br></code> </blockquote><br><br>  uninstall.bat <br><blockquote> <code><font color="black">ScheduledService uninstall <br> pause</font> <br></code> </blockquote><br><br>  There is a truth and a more advanced version with parameters so that the service is immediately created with the necessary settings.  You can read about it <a href="http://code.google.com/p/ncron/wiki/Deployment">here</a> . <br><br>  That's basically it. </div><p>Source: <a href="https://habr.com/ru/post/96691/">https://habr.com/ru/post/96691/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../96684/index.html">Making hardcover for favorite books</a></li>
<li><a href="../96685/index.html">Easy way to lose (not acquire) a potential client</a></li>
<li><a href="../96687/index.html">Why connect SSD drives if there is PAMII?</a></li>
<li><a href="../96688/index.html">Chocolate headphones</a></li>
<li><a href="../96690/index.html">We disassemble the new Mac mini</a></li>
<li><a href="../96692/index.html">Social Radio Station (Public Radio or Radio 2.0)</a></li>
<li><a href="../96697/index.html">Conky with a theme for Ubuntu and a handy setting - a nice dashboard</a></li>
<li><a href="../96699/index.html">Programs for remote training (webinars)</a></li>
<li><a href="../96700/index.html">Vuvuzela filter</a></li>
<li><a href="../96701/index.html">BabyBlog.ru fulfills wishes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>