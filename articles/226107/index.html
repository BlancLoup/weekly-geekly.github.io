<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>HTML5 mobile application: error or success. Attempt # 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I continue to develop the embodiment of my dream of developing applications for HTML5 for mobile platforms: I wrote once - it works everywhere and alw...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>HTML5 mobile application: error or success. Attempt # 1</h1><div class="post__text post__text-html js-mediator-article">  I continue to develop the embodiment of my dream of developing applications for HTML5 for mobile platforms: I wrote once - it works everywhere and always.  In the <a href="http://habrahabr.ru/post/185316/">last article</a> I received a not exactly mobile application, rather a mobile site, since there was no work without a network.  I will try to fix it, as well as everyone (almost) will be able to try how it all works on their personal devices. <br><br>  So, we get a small mobile web application that we can run under several mobile platforms, while clicking only a few mouse buttons. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5d1/401/33a/5d140133a71fd9712ed4a94c4868249d.png" alt="image"></div><br><a name="habracut"></a><br>  <i>Small note: The article was written with the aim of consolidating the material studied on the study of new technology.</i>  <i>In connection with the complete lack of real experience in creating applications of this kind, I apologize in advance for any flaws.</i> <i><br></i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  architecture </h2><br>  We implement something simple: <br><ul><li>  routes of the sales agent (the person who goes shopping and orders the goods).  The route is the day of the week. </li><li>  list of outlets (stores) associated with the route. </li><li>  sales outlet orders </li></ul><br><br>  Get the necessary data from the server and save it locally. <br>  <b>The server part</b> is a separate .net MVC application with OData.  In this article, I see no reason to consider the implementation, since the server simply has to send data using the OData protocol. <br>  <b>The client part</b> is a phonegap application with libraries: <a href="http://phonejs.devexpress.com/">PhoneJS</a> and <a href="http://www.breezejs.com/">BreezeJS</a> . <br><br>  So let's get started ... <br><br>  To speed up, we will use the PhoneJS application pattern with the following structure: <br><ul><li>  css </li><li>  js </li><li>  layouts </li><li>  views </li><li>  index.css </li><li>  index.html </li><li>  index.js </li></ul><br>  It seems everything is clear for what.  In the <b>index.html</b> file we add links to the necessary libraries for BreezeJS. <br><br><h2>  Application launch </h2><br>  The application itself is created in the <b>index.js</b> file, and navigation and other service functions are described.  PhoneJS offers us several <i>layouts</i> .  I chose the <i>slideout</i> .  So create an application: <br><pre><code class="javascript hljs">$(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ app = ms.app = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DevExpress.framework.html.HtmlApplication(APP_SETTINGS); app.router.register(<span class="hljs-string"><span class="hljs-string">":view/:item"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">view</span></span>: <span class="hljs-string"><span class="hljs-string">"Home"</span></span>, <span class="hljs-attr"><span class="hljs-attr">item</span></span>: <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> }); ms.app.viewShown.add(onViewShown); ms.app.navigationManager.navigating.add(onNavigate); startApp(!ms.dataservice.initUserData()); setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">"deviceready"</span></span>, onDeviceReady, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"delay"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (device.platform == <span class="hljs-string"><span class="hljs-string">"tizen"</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">"tizenhwkey"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.keyName === <span class="hljs-string"><span class="hljs-string">"back"</span></span>) onBackButton(); }); } }, <span class="hljs-number"><span class="hljs-number">1000</span></span>); });</code> </pre> <br><br>  <b>APP_SETTINGS</b> - application <b>parameters</b> in which we specify navigation and Layout: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="javascript hljs">APP_SETTINGS = { <span class="hljs-attr"><span class="hljs-attr">namespace</span></span>: ms, <span class="hljs-attr"><span class="hljs-attr">navigationType</span></span>: <span class="hljs-string"><span class="hljs-string">"slideout"</span></span>, <span class="hljs-attr"><span class="hljs-attr">navigation</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"Home"</span></span>, <span class="hljs-string"><span class="hljs-string">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Home"</span></span>, <span class="hljs-string"><span class="hljs-string">"action"</span></span>: <span class="hljs-string"><span class="hljs-string">"#Home"</span></span>, <span class="hljs-string"><span class="hljs-string">"icon"</span></span>: <span class="hljs-string"><span class="hljs-string">"home"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"Settings"</span></span>, <span class="hljs-string"><span class="hljs-string">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Settings"</span></span>, <span class="hljs-string"><span class="hljs-string">"action"</span></span>: <span class="hljs-string"><span class="hljs-string">"#Settings"</span></span>, <span class="hljs-string"><span class="hljs-string">"icon"</span></span>: <span class="hljs-string"><span class="hljs-string">"card"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"About"</span></span>, <span class="hljs-string"><span class="hljs-string">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"About"</span></span>, <span class="hljs-string"><span class="hljs-string">"action"</span></span>: <span class="hljs-string"><span class="hljs-string">"#about"</span></span>, <span class="hljs-string"><span class="hljs-string">"icon"</span></span>: <span class="hljs-string"><span class="hljs-string">"info"</span></span> } ] };</code> </pre></div></div><br>  First, I set up the ‚Äúrouting‚Äù and view (default), after which we start the application, and it checks if there is already data in the local storage <b>using the ms.dataservice.initUserData ()</b> function (we will consider a little later).  The function returns true if data is available.  Those.  if we start the first time, then go to the <b>Settings</b> view to get data. <br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startApp</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">needToSynchronize</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (needToSynchronize) ms.app.navigate(<span class="hljs-string"><span class="hljs-string">"Settings/1"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ms.app.navigate(); }</code> </pre><br>  Also, before launching the application, I introduce a small delay - in the future I will make a screensaver. <br><h2>  Work with data </h2><br>  To work with the data, create a separate <b>dataservice.js</b> file: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="javascript hljs">MobileSales.dataservice =<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$, DX, app, undefined</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> DATA_VERSION_KEY = <span class="hljs-string"><span class="hljs-string">"mobilesales-version"</span></span>, DATA_KEY = <span class="hljs-string"><span class="hljs-string">"mobilesales-data"</span></span>, logger = app.logger; serviceName = <span class="hljs-string"><span class="hljs-string">"http://mobsalessrv.azurewebsites.net/odata/"</span></span>; breeze.config.initializeAdapterInstances({ <span class="hljs-attr"><span class="hljs-attr">dataService</span></span>: <span class="hljs-string"><span class="hljs-string">"OData"</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> manager = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> breeze.EntityManager(serviceName); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> store = manager.metadataStore; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> queries = { <span class="hljs-attr"><span class="hljs-attr">Routes</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"Routes"</span></span>, <span class="hljs-attr"><span class="hljs-attr">query</span></span>: breeze.EntityQuery.from(<span class="hljs-string"><span class="hljs-string">"Routes"</span></span>).orderBy(<span class="hljs-string"><span class="hljs-string">"RouteID"</span></span>), }, <span class="hljs-attr"><span class="hljs-attr">Customers</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"Customers"</span></span>, <span class="hljs-attr"><span class="hljs-attr">query</span></span>: breeze.EntityQuery.from(<span class="hljs-string"><span class="hljs-string">"Customers"</span></span>).orderBy(<span class="hljs-string"><span class="hljs-string">"CustomerName"</span></span>), }, <span class="hljs-attr"><span class="hljs-attr">ProductTypes</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"ProductTypes"</span></span>, <span class="hljs-attr"><span class="hljs-attr">query</span></span>: breeze.EntityQuery.from(<span class="hljs-string"><span class="hljs-string">"ProductTypes"</span></span>).orderBy(<span class="hljs-string"><span class="hljs-string">"ProductTypeName"</span></span>), }, <span class="hljs-attr"><span class="hljs-attr">Products</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"Products"</span></span>, <span class="hljs-attr"><span class="hljs-attr">query</span></span>: breeze.EntityQuery.from(<span class="hljs-string"><span class="hljs-string">"Products"</span></span>).orderBy(<span class="hljs-string"><span class="hljs-string">"ProductName"</span></span>), }, <span class="hljs-attr"><span class="hljs-attr">Orders</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"Orders"</span></span>, <span class="hljs-attr"><span class="hljs-attr">query</span></span>: breeze.EntityQuery.from(<span class="hljs-string"><span class="hljs-string">"Orders"</span></span>).orderBy(<span class="hljs-string"><span class="hljs-string">"Date"</span></span>), }, <span class="hljs-attr"><span class="hljs-attr">OrderDetails</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"OrderDetails"</span></span>, <span class="hljs-attr"><span class="hljs-attr">query</span></span>: breeze.EntityQuery.from(<span class="hljs-string"><span class="hljs-string">"OrderDetails"</span></span>), }, }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initUserData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataFromStorage = localStorage.getItem(DATA_KEY); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dataFromStorage) { manager.importEntities(dataFromStorage); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">query</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> manager.executeQuery(query); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRoutes</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> manager.executeQueryLocally(queries.Routes.query); }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCustomers</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> manager.executeQueryLocally(queries.Customers.query); }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getProduct</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">productID</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> query = queries.Products.query.where(<span class="hljs-string"><span class="hljs-string">"ProductID"</span></span>, <span class="hljs-string"><span class="hljs-string">"=="</span></span>, productID); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> manager.executeQueryLocally(query)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOrders</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">customerID</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> query = queries.Orders.query; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> customerID != <span class="hljs-string"><span class="hljs-string">"undefined"</span></span> &amp;&amp; customerID &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) query= query.where(<span class="hljs-string"><span class="hljs-string">"CustomerID"</span></span>, <span class="hljs-string"><span class="hljs-string">"=="</span></span>, customerID); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> manager.executeQueryLocally(query); }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOrderDetails</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">orderID</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> query = queries.OrderDetails.query; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> orderID != <span class="hljs-string"><span class="hljs-string">"undefined"</span></span> &amp;&amp; orderID &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) query = query.where(<span class="hljs-string"><span class="hljs-string">"OrderID"</span></span>, <span class="hljs-string"><span class="hljs-string">"=="</span></span>, orderID); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = manager.executeQueryLocally(query); result.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function">) </span></span>{ item.ProductName = getProduct(item.ProductID()).ProductName; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveDataLocally</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> exportData = manager.exportEntities(); localStorage.setItem(DATA_KEY, exportData); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataservice = { <span class="hljs-attr"><span class="hljs-attr">manager</span></span>: manager, <span class="hljs-attr"><span class="hljs-attr">metadataStore</span></span>: manager.metadataStore, <span class="hljs-attr"><span class="hljs-attr">initUserData</span></span>: initUserData, <span class="hljs-attr"><span class="hljs-attr">queries</span></span>: queries, <span class="hljs-attr"><span class="hljs-attr">loadData</span></span>: loadData, <span class="hljs-attr"><span class="hljs-attr">getRoutes</span></span>: getRoutes, <span class="hljs-attr"><span class="hljs-attr">getCustomers</span></span>: getCustomers, <span class="hljs-attr"><span class="hljs-attr">saveDataLocally</span></span>: saveDataLocally, <span class="hljs-attr"><span class="hljs-attr">getOrders</span></span>: getOrders, <span class="hljs-attr"><span class="hljs-attr">getOrderDetails</span></span>: getOrderDetails, }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dataservice; }(jQuery, DevExpress, MobileSales);</code> </pre></div></div><br>  How to work with breeze read in the last article.  I will dwell only on a few points.  The query object contains a list of requests for data retrieval, I plan to expand it in the future with various parameters, and also generally receive this list from the server, which will allow to manage the data dynamically. <br><br>  Breeze has a great opportunity to save and restore all data locally using <b>manager.exportEntities ()</b> and <b>manager.importEntities (dataFromStorage),</b> respectively.  The <b>initUserData</b> function checks the availability of data in the local storage using the <b>DATA_KEY</b> key and retrieves it.  All other functions of the type <b>getXXX select the</b> necessary entities locally and are used in the necessary types. <br><br>  To download all data from the server, we use a separate view of <b>settings</b> , which has a button for downloading data, a download panel and a list of entities: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-options</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dxView : { name: 'Settings', title: 'Settings' } "</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-options</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dxContent : { targetPlaceholder: 'content' } "</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"actions"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dxButton: { text: 'Synchronize', clickAction: synchData }"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dxLoadPanel: { message: message, visible: loading().length&gt;0 }"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dxList: { items: entityList }"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-options</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dxTemplate : { name: 'item' }"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text: $data.name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"entity-name"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text: $data.status"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"entity-status"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  I completely forgot to tell you that both breeze and Phonejs use the wonderful <a href="http://knockoutjs.com/">knockout</a> library, so it‚Äôs very convenient to group it all together. <br><div class="spoiler">  <b class="spoiler_title">settings.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs">MobileSales.Settings = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">params</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> app = MobileSales, needToSynchonize = params.item===<span class="hljs-string"><span class="hljs-string">"1"</span></span>, self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vm = { <span class="hljs-attr"><span class="hljs-attr">entityList</span></span>: ko.observableArray([]), <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: ko.observableArray(), <span class="hljs-attr"><span class="hljs-attr">viewShowing</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (needToSynchonize) getEntities(); }, <span class="hljs-attr"><span class="hljs-attr">viewShown</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">".dx-active-view .dx-scrollable"</span></span>).data(<span class="hljs-string"><span class="hljs-string">"dxScrollView"</span></span>).scrollTo(<span class="hljs-number"><span class="hljs-number">0</span></span>); }, <span class="hljs-attr"><span class="hljs-attr">synchData</span></span>: getEntities, }; vm.message = ko.computed(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Loading ...(left:"</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loading().length + <span class="hljs-string"><span class="hljs-string">")"</span></span> }, vm); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getEntities</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mapped = $.map(app.dataservice.queries, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function">) </span></span>{ item.status = ko.observable(<span class="hljs-string"><span class="hljs-string">"Loading"</span></span>); vm.loading.push(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); app.dataservice.loadData(item.query).then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ app.logger.log(<span class="hljs-string"><span class="hljs-string">"Loaded data: "</span></span> + item.query.resourceName); item.status(<span class="hljs-string"><span class="hljs-string">"Succeded"</span></span>); app.logger.log(app.dataservice.getRoutes()); vm.loading.pop(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (vm.loading().length === <span class="hljs-number"><span class="hljs-number">0</span></span>) app.dataservice.saveDataLocally(); }).fail(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) </span></span>{ item.status(<span class="hljs-string"><span class="hljs-string">"Error"</span></span>); app.logger.error(<span class="hljs-string"><span class="hljs-string">"Error Loading data"</span></span>); app.logger.log(error); vm.loading.pop(); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> item; }); vm.entityList(mapped); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vm; };</code> </pre></div></div><br>  At the input we take the parameter that is passed in the case of forced synchronization.  All requests to the breeze server are asynchronous, which allows you to make an elegant solution for uploading entities into an <b>entityList</b> .  To do this, we need only one observable array (observableArray) <b>loading</b> . <br>  Let's <b>analyze the getEntities</b> function: we go through all the elements of <b>dataservice.queries</b> , add <b>status</b> to each field and add any value to the <b>vm.loading.push (true)</b> array.  In the handlers for successful execution or error, we update the element status and decrease the <b>loading</b> array.  As a result, we very simply get asynchronous loading of several entities with control completion.  This is how it all looks. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/181/c22/5a1/181c225a1a9d8d85eaa17137596df50d.gif" alt="image"></div><br>  The rest of the program is not very interesting, just displays the data uploaded to the repository, and duplicates the previous article.  If interested, check out the <a href="https://github.com/gfhfk/MobSales">source code</a> . <br>  In the <b>Home</b> view, you can select a sales point on the route of the route, as well as view orders for this point.  This is how it looks like: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/277/d3f/f5c/277d3ff5c19a8083dccb8bb047917a80.gif" alt="image"></div><br><br>  It remains to get a mobile application in a few clicks: <br>  ‚óè Go to <a href="http://build.phonegap.com/">http://build.phonegap.com</a> . <br>  ‚óè Login using GitHub. <br>  ‚óè Add a new application by selecting the desired repository <br>  ‚óè Click the magic button ‚ÄúReady to build‚Äù <br>  ‚óè And we get the application on 5 of 6 platforms (unfortunately I do not have a key on IOS): <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ff8/a8b/902/ff8a8b902b6d268a0705418c917c4e73.png" alt="image"></div><br>  Small specifics: the picture above was taken on PhoneGap version 2.9, by the way, WP version 7 here. When choosing version 3. + we‚Äôll get this message <i>: Blackberry, Symbian, and WebOS are no longer supported as of PhoneGap 3</i> , but for that there is support for WP8 . <br><br>  It remains to add a little tar (maybe a lot): performance.  It is simply impossible to work on old or weak devices - the brake is complete.  But as soon as I took the device with more or less normal parameters, everything worked out.  I agree, this is not a native application, but I don‚Äôt even want to compare - these are different things.  And I am sure that such an approach (Well, in the sense of HTML5 in general) there is a future, and a niche will be found. <br><br>  Links to the application: <br><br>  ‚óè Sources <a href="https://github.com/gfhfk/MobSales">https://github.com/gfhfk/MobSales</a> <br>  ‚óè Test in browser (I tried Chrome and IE11) <a href="http://mobsales.azurewebsites.net/">http://mobsales.azurewebsites.net/</a> . <br>  ‚óè Who is interested in the server part: <a href="http://mobsalessrv.azurewebsites.net/odata/">http://mobsalessrv.azurewebsites.net/odata/</a> <br>  ‚óè the program itself: <br>  Version 3.4 <a href="https://build.phonegap.com/apps/727149">https://build.phonegap.com/apps/727149</a> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fd9/b6e/979/fd9b6e979bbcb1bbe7a0fcfe791c4411.png" alt="image"></div><br>  Who is interested in version 2.9 <a href="https://build.phonegap.com/apps/733422/">https://build.phonegap.com/apps/733422/</a> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f8a/1a0/e5d/f8a1a0e5d5d3beaedbe93c8cc049350d.png" alt="image"></div><br><br>  <b>Note 1</b> : There is a problem with installing the application on Windows Phone through the qr-code, an error occurs.  You need to follow the link from the computer, download the xap and upload it through the Application Deployment Tool.  Likely glitch Phonegap Build. <br>  <b>Note 2</b> : Sometimes, especially when you first start it or when you start it on the emulator, you get this error: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/82d/80e/d8f/82d80ed8f0496e5ee7350b34ae6676d6.png" alt="image"></div><br><br>  The solution to this problem is very simple: <br>  1. Rename the index.html file to main.html. <br>  2. Create a new index.html and insert a piece: <br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!doctype html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>tittle<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.location=</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'./main.html'</span></span></span><span class="javascript">; </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  3. All - there are no more errors (Although with version 2.9 on some devices it still produced). <br>  <b>Note 3</b> : In the WP8 emulator, the application does not start the first time, until it figured out why.  On real devices did not try.  In WP8.1, it did not start at all (I will not understand it yet). <br>  <b>Note 4:</b> Sites are hosted on a free Windows Azhure WebSites, where resources are limited.  Given the habr effect sites can lie, then let me know - I will transfer to a paid one for a while. <br>  I will not write the result, I suggest everyone to test and answer the survey, according to which I will decide what to do next: </div><p>Source: <a href="https://habr.com/ru/post/226107/">https://habr.com/ru/post/226107/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../226091/index.html">The four-color theorem is associated with the magnetic properties of crystals.</a></li>
<li><a href="../226093/index.html">Zero Downtime Upgrade for an application in Microsoft Azure. Part 1: PaaS</a></li>
<li><a href="../226099/index.html">Switch to Sketch. Part 2</a></li>
<li><a href="../226101/index.html">Samsung HackDay # 31 Report and Samsung DevConf14 Announcement</a></li>
<li><a href="../226105/index.html">25-dollar smartphones with Firefox OS will appear already this year</a></li>
<li><a href="../226109/index.html">Firefox 30 release</a></li>
<li><a href="../226111/index.html">Part of the scientific instruments of the Rosetta interplanetary station has entered the working mode</a></li>
<li><a href="../226115/index.html">Astronomers discovered a stellar object in the Small Magellanic Cloud, previously considered a hypothetical</a></li>
<li><a href="../226121/index.html">The supercomputer that passed the Turing test turned out to be a bluff</a></li>
<li><a href="../226123/index.html">Overview of Windows applications to restore order in photo archives</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>