<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Import data online store in 1C: Trade Management</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A friend recently asked for help with the task of importing data from a small online store to 1C: Trade Management 11. Because on the main job I deal ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Import data online store in 1C: Trade Management</h1><div class="post__text post__text-html js-mediator-article">  A friend recently asked for help with the task of importing data from a small online store to 1C: Trade Management 11. Because  on the main job I deal with SharePoint and the .Net stack, I liked the idea of ‚Äã‚Äãexpanding my horizons and trying something new.  The task was set as follows: <br>  - carry out a one-time download of data in 1C, followed by one-way synchronization from 1C to an online store; <br>  - store data is stored in a database on MS SQL Server; <br>  - exporting data from SQL Server and importing into 1C is desirable to implement using standard tools with a minimum of code. <br><br>  This article is based on the study of forums and documentation 1C.  It describes the process of loading data into 1C.  If the topic will be in demand, another time I will write how to set up synchronization from 1C to an online store.  I tried to make the process as detailed as possible, so that people can use it, as well as I who have no experience with 1C.  I hope that it will help save time on this typical task and avoid errors.  Although the article talks about exporting data from SQL Server, it will be useful with other DBMS. <br><a name="habracut"></a><br>  The standard delivery of 1C: Trade Management includes processing Loading data from a tabular document (for those who have not had experience with 1C, I will explain: this is a single file Downloading Data from a TabularDocument.epf, which can be found on the 1C distribution disk), allowing you to download data to various 1C references, for example, from MS Excel file.  We will use this processing for import.  The advantage of using standard functionality out of the box is the savings on the development of your solution.  On the Internet you can find several examples of the use of this treatment.  The main difference of this article will be the description of the import procedure not only for the standard requisites of the goods, but also for the additional requisites that we will create ourselves (see below).  I did not find such an example, but in real scenarios it can be very popular.  For example, we will need an additional requisite for goods for storing an Id of goods on the site, so that later we can synchronize the goods back from 1C to the online store.  It would be possible to write Id into one of the standard details (to use it for purposes other than its intended purpose), but we will take a more correct, albeit more complicated, path. <br><br>  Let's start with a description of the database schema.  We are interested in tables with products and categories.  Each product may fall into several categories, and each category may contain many products.  In addition, each category may have several subcategories, for example, there is a category "Sports Goods" and under them categories for various sports.  For simplicity, we leave only those attributes that we need for example.  Each store has its own set of attributes for goods, but properties such as Name, Price, Article may be available for most.  Therefore, we restrict ourselves to 3 tables: <br><ol><li>  Products </li><li>  Categories </li><li>  ProductCategories - an intermediate table in many-to-many relationships between products and categories </li></ol><br>  Here is the base schema: <br><img src="https://habrastorage.org/storage2/31e/d7d/994/31ed7d994006a146e2a56050047bc558.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First we need to unload the goods in the file from the database.  This is done quite simply in SQL Management Studio: you can execute a query in a file with a fixed column width and then open it as a csv file in Excel.  You can also just copy the results from the table with the results of Management Studio to Excel.  It remains to write the desired request. <br><br>  In the online store, the product may fall into several categories, but in 1C in standard configuration, the products fall into one category (type of nomenclature).  Probably in 1C you can, if you wish, adjust the many-to-many relationship between the nomenclature and the types of nomenclature, but we will limit ourselves to the standard configuration.  Therefore, when exporting for each product, we will take the first category, which does not have a parent category (category 1 level). <br><br>  To write a query, we need to work with hierarchical data in the table of categories.  For such queries in SQL Server there is a special mechanism for generalized table expressions (Common Table Expressions), but we will go in a simpler and more understandable way using User Defined Functions.  First, we define a recursive function for selecting a category of the 1st level according to the given categoryId: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> dbo.get_parent_category(@categoryId <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">256</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> @parentId <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @parentId = (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> ParentCategoryId <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dbo.Category <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> CategoryId = @categoryId) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> @parentId <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> @categoryId <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dbo.get_parent_category(@parentId) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><br>  Then a function that returns the name of the first category of the 1st level for a given product: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> dbo.get_parent_product_category(@productId <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">256</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> @categoryId <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, @parentCategory <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> @categoryName <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">256</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @categoryId = (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> top <span class="hljs-number"><span class="hljs-number">1</span></span> c.CategoryId <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dbo.Product p <span class="hljs-keyword"><span class="hljs-keyword">inner</span></span> <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> dbo.ProductCategory pc <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> p.ProductId = pc.ProductId <span class="hljs-keyword"><span class="hljs-keyword">inner</span></span> <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> dbo.Category c <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> pc.CategoryId = c.CategoryId <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> p.ProductId = @productId) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @parentCategory = dbo.get_parent_category(@categoryId) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dbo.Category <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> CategoryId = @parentCategory) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br>  It remains to write the request itself for the exported goods.  With the functions described, it is simple: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>, Price, Articul, Vendor, dbo.get_parent_product_category(ProductId), ProductId <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Product <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> p.Name</code> </pre><br><br>  Perhaps SQL experts will be able to provide simpler solutions without using custom functions, but for this example, the above solution will suffice. <br><br>  So, we exported the data to Excel.  The next step is import into 1C.  Products in 1C: Trade Management (UT) are stored in the Nomenclature directory.  To begin with, this reference book needs to add additional requisites for storing the Id of the goods in the database of the online store (as already mentioned, this is necessary for the subsequent synchronization of goods from 1C to the online store).  You can do this as follows: open any product in edit mode and select the Additional Details button (inconspicuous icon on top of the form): <br><img src="https://habrastorage.org/storage2/cac/b57/939/cacb57939b489957f8675c362afcdd67.png"><br><br>  In the window that opens, select Add&gt; General Properties&gt; Selection&gt; Create and enter the name of the new requisite, for example, ‚ÄúProduct Id on the site‚Äù: <br><img src="https://habrastorage.org/storage2/69c/98a/81e/69c98a81ed52410318e549438e353533.png"><br><br>  After we added a new attribute to the set, we need to rediscover the product edit form.  The form for editing the attribute should appear on the form: <br><img src="https://habrastorage.org/storage2/5bb/90f/1b8/5bb90f1b839d49a23225080cac27fd5e.png"><br><br>  To start the processing of Loading Data from a Public Document, you need to open 1C in the Normal application mode (by default, 1C UT 11 opens in the Managed application mode).  To switch to the regular application mode in the configurator, select Administration&gt; Users&gt; select a user, and in the edit form on the Other tab, in the Start mode field, install the Normal application.  Also, in the settings for launching the information database, the field Basic mode should be set to Select automatically. <br><br>  Now we open the information database in the Normal application mode and load the processing of Loading Data from the Table Document (File&gt; Open).  In the window that opens, choose to open the Excel file, which we exported from the store database: <br><img src="https://habrastorage.org/storage2/e15/f90/276/e15f902766f82c50b2453238b9668efb.png"><br><br>  Before importing goods, you need to import data into dependent directories, Manufacturers and Types of nomenclature, otherwise these fields will remain empty.  To import manufacturers at the top, select Download Mode = Download to Directory, Directory Type = Manufacturers.  On the Settings tab, set the following values: <br><img src="https://habrastorage.org/storage2/4eb/8e6/0df/4eb8e60df3f23b5aec830fd1301f643c.png"><br><br>  Here it is important to specify the column number and select the Search field (otherwise duplicates will be created).  After clicking on Download manufacturers will be imported into the directory. <br><br>  By analogy, we import data into the Types of the nomenclature directory.  But unlike the manufacturers, in the standard configuration, on the Settings tab, you also need to set the Sales clearance option and the Item type: <br><img src="https://habrastorage.org/storage2/098/d3e/255/098d3e2553e542e0115878bf6bdec2c0.png"><br><br>  Now you can start importing goods.  Set the settings as shown in the following image: <br><img src="https://habrastorage.org/storage2/571/a39/53f/571a3953f344d638ba136f64d76a2118.png"><br><br>  To load data into the additional requisite ‚ÄúId of goods on the site‚Äù, which we created above, we add the following handler to Events&gt; When writing object: <br><pre> Object.AdditionalRequisition.Clean ();

 PropertyId =
 Plans of Types of Characteristics. Additional Details of Details. FindName ("Product Id on the Site", Truth);
         
 Site ID = Object. Additional Details. Add ();
 identifier at site. property = property id;
 identifier on the site. Value = CellTells [6];
 Object.Write ();
</pre><br><br>  After that we load the goods.  If everything is done correctly, the import will be successful and when you open the editing form with one of the products you will see its properties, which should be the same as in excel. <br><br>  There is only one step left - import prices.  This step is highly dependent on the specific configuration and price type.  Of the general steps are the following.  On the processing form, select Loading Mode = Loading to the tabular part, Link = Setting the prices of the item.  Then again click Link again and add a new document: <br><img src="https://habrastorage.org/storage2/fe5/6f7/785/fe56f778575acb9764f3912b98d783ab.png"><br>  After creation, select it (the document should appear in the form reference field), in the Tabular part field, select Products and set the following settings on the Settings tab: <br><img src="https://habrastorage.org/storage2/305/317/43f/30531743fb173dc081d4f8fa1ff82dc2.png"><br>  Here it is important that we indicate from which column prices will be taken at import.  After that you can download prices.  As I already wrote, the process of downloading prices is highly dependent on the specific configuration, so here I will not go into details.  If you are interested in the details, I advise the following article: <a href="http://1c-setup.ru/stati-1s/zagruzka-dannykh-v-spravochnik-nomenklatura-iz-prajs-lista-excel.html">Loading data into the nomenclature reference book from the Excel price list</a> .  I will also note that it may still be necessary to agree on the created document for setting the prices of the nomenclature. <br><br>  Thus, we downloaded data from the online store database in 1C for later use in the account.  I hope that this article will help someone save time and money to perform a similar task.  I do not work with 1C, so if experts find inaccuracies in this article, please treat them condescendingly and consider the article only as a guide for solving a specific applied task. </div><p>Source: <a href="https://habr.com/ru/post/189690/">https://habr.com/ru/post/189690/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../189680/index.html">ActionBar on Android 2.1+ using SupportLibrary</a></li>
<li><a href="../189682/index.html">Gauss machine gun - a real weapon for the boom (and not only)</a></li>
<li><a href="../189684/index.html">Learn English: movies, books, dictionaries</a></li>
<li><a href="../189686/index.html">The petition against the anti-piracy law gained 100 thousand votes!</a></li>
<li><a href="../189688/index.html">Vim 7.4 released</a></li>
<li><a href="../189692/index.html">Starry Sky on Canvas</a></li>
<li><a href="../189696/index.html">Absolute horizontal and vertical centering</a></li>
<li><a href="../189700/index.html">Emotiv Insight - $ 229 Neuro Interface</a></li>
<li><a href="../189702/index.html">External voting service aka like-dislike feature</a></li>
<li><a href="../189706/index.html">Children don't know how to use computers ... And this is why it should bother you.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>