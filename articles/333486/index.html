<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Calls between browsers: WebRTC pitfalls</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="WebRTC, available in modern browsers through the JavaScript API, captures voice and video, transmits them over the network, and plays them in another ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Calls between browsers: WebRTC pitfalls</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/a57/da3/1df/a57da31df0e5466d954a093628754b72.jpg" align="left" width="256">  WebRTC, available in modern browsers through the JavaScript API, captures voice and video, transmits them over the network, and plays them in another browser.  It also can Peer-to-Peer between browsers, Screen Sharing, data transmission by UDP packets and adjusting the bitrate for the channel width.  Very good technology.  And Skype for Web on it can be collected, and <a href="https://www.chromeexperiments.com/experiment/lightsaber-escape">turn the joystick</a> into a lightsaber for playing on a laptop, and make a call from cellular to a web page.  Very good technology.  But raw. <br><br>  In Voximplant, we have been developing many SDKs for calls to our cloud for many years: Android, iOS, <a href="https://unity.voximplant.com/">Unity</a> , React Native.  The honorable place is occupied by the Web SDK, which uses just WebRTC.  With the help of it, <a href="https://habrahabr.ru/company/Voximplant/blog/329444/">CRM receive calls</a> ‚Äúto the web page‚Äù, the buttons ‚Äúcall us from the web site‚Äù and video consultations with doctors work.  Over the years, we stuffed a lot of bumps in using WebRTC, and under the cut, I briefly go through the main points that will not please you if you want to use this great technology. <br><a name="habracut"></a><br><h2>  Several different API versions </h2><br>  For the past few years, WebRTC has been in a state of ‚Äúpermanent beta,‚Äù which gives developers and the standardization committee the opportunity to redo the API as they like.  And they take advantage of this opportunity! <br><br>  A few years ago, the already stabilized API was completely redone: the callbacks were replaced with intermesses, and the flow from the camera and microphone was divided into ‚Äútracks‚Äù.  However, the new API is not fully implemented in all browsers.  For example, Chrome still does not know how to work with tracks. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Unified Plan and Plan B </h2><br>  Before the beginning of the transmission of voice or video, browsers need to agree among themselves on resolution, codecs, bitrates, - the whole story.  For this, WebRTC uses the text protocol SDP (Session Description Protocol) borrowed from telecom.  The developer needs in some way (usually through his own signaling server) to transfer the ‚Äúoffer‚Äù and ‚Äúanswer‚Äù SDP packets between browsers, after which they will try to establish a Peer-to-Peer connection and will be able to transmit video and sound as agreed. <br><br>  The problem is that Chrome has been implementing for many years as an obsolete Plan B, and all other browsers, including Firefox, are implementing the new Unified Plan.  They differ in the coding of multiple streams.  And the video with sound is, for a second, already two streams.  So while you transmit a voice between browsers, then everything is fine.  As soon as you start streaming video, nothing works for you and you need to write an <a href="https://github.com/jitsi/sdp-interop">adapter</a> or use existing polyfiles. <br><br><h2>  Screen Sharing requires a tambourine </h2><br>  Want to do an online webinar service and show your desktop?  Will only work in Firefox.  And for Chrome, you‚Äôll have to make your Add-on, prescribe your site as ‚Äútrusted‚Äù and ask the users to install this addon.  For security reasons, of course. <br><br><h2>  Safari protects users </h2><br>  Most recently, Apple announced support for WebRTC in Safari, so in the fall, the technology will be available in all major browsers: Chrome (desktop and Android), Safari (desktop and iOS), Firefox, Edge.  But the first version will contain <a href="https://webkit.org/blog/7763/a-closer-look-into-webrtc/">many restrictions</a> designed to protect the user from trying to look at his webcam through a browser: <br><br><ul><li>  Access to the camera and microphone from Safari only is blocked for WebView. </li><li>  WebRTC will only work for pages loaded over HTTPS (can be disabled for local debugging). </li><li>  If WebRTC is used in an iframe, then the entire iframe chain must be downloaded from the same site as the web page. </li><li>  The local IP address for the Peer-to-Peer connection is used only if the user has given access to the camera or microphone. </li><li>  The old version of the API, without promises, is available only in debug mode.  So we have to write different code for Chrome and ‚Äúall others‚Äù. </li><li>  The ban on autoplay video will be removed only if the user has already given access to the camera or microphone.  Or if the sound is already playing. </li></ul><br><h2>  How scary is everything in practice? </h2><br>  In fact, with all these nuances it is possible to live.  Hundreds of our clients use WebSDK to solve various problems and everything works for them.  Only <a href="https://habrahabr.ru/users/irbisadm/" class="user_link">irbisadm has</a> gray hair over the last year, as the main WebSDK developer.  A bonus for Habrapamers is the recording of his internal lecture on our WebSDK, which he talked about this Friday.  We can both ask questions in the comments! <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/qwl2GsHoX8E" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  <font color="lightgray">Picture to Kata taken <a href="https://maiii.ru/kreditnoe_donorstvo/podvodnye-kamni/">from here</a></font> . </div><p>Source: <a href="https://habr.com/ru/post/333486/">https://habr.com/ru/post/333486/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../333476/index.html">Tuning typical roles of Windows. Part Two: Terminal Server and Deduplication</a></li>
<li><a href="../333478/index.html">Upgrading Fujitsu ETERNUS DX Entry Storage Systems</a></li>
<li><a href="../333480/index.html">DBMS for 1C Fresh. Quickly. Reliably Is free</a></li>
<li><a href="../333482/index.html">Hazards in measuring productivity</a></li>
<li><a href="../333484/index.html">Setting up the development environment: needlework circle (Part 1)</a></li>
<li><a href="../333488/index.html">Read your product code. Whole</a></li>
<li><a href="../333490/index.html">Machine learning and dark matter search: competition from CERN and Yandex</a></li>
<li><a href="../333492/index.html">Using Neural Networks to Recognize Handwritten Numbers Part 1</a></li>
<li><a href="../333494/index.html">How to test SMS distribution</a></li>
<li><a href="../333496/index.html">Australian government hints at a possible ban on end-to-end encryption</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>