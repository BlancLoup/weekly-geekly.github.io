<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PKCS # 11 Cryptographic Cloud Service: From Myth to Reality</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In 2016, the article ‚ÄúCloud token PKCS # 11 - myth or reality?‚Äù Was published. Half a year has passed and now a cloud (cloud service) has appeared on ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PKCS # 11 Cryptographic Cloud Service: From Myth to Reality</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/38a/7c8/938/38a7c8938dd94d61843617b336937516.png" alt="image" align="left" vspace="5" width="100">  In 2016, the article <a href="https://geektimes.ru/post/281890/">‚ÄúCloud token PKCS # 11 - myth or reality?‚Äù</a> Was published.  Half a year has passed and now a cloud (cloud service) has appeared on the Internet in which anyone can <a href="http://soft.lissi.ru/solution/ls11cloud/">get a personal cloud token</a> PKCS # 11 with the support of Russian cryptography. <br><a name="habracut"></a><br><h3>  <font color="blue">Foreword</font> </h3><br>  Recall that PKCS # 11 (Cryptoki) is a standard developed by RSA Laboratories for interacting with cryptographic tokens, smart cards and other similar devices using a unified software interface that is implemented through libraries. <br><br>  Cryptographic tokens provide both the storage of certificates and key pairs (public and private keys), and the execution of cryptographic operations in accordance with the PKCS # 11 standard. <br><br><img src="https://habrastorage.org/files/e79/f6f/2af/e79f6f2af7834cc7abc5914e4ce190ee.png" alt="image" align="right" vspace="5" width="200">  So, the LS11CLOUD cloud service appeared on the Internet, a cloud implementation of the <a href="https://www.oasis-open.org/committees/tc_home.php%3Fwg_abbrev%3Dpkcs11">PKCS # 11</a> v.2.40 standard, supplemented by the support of Russian cryptographic algorithms in accordance with the specifications developed by the Technical Committee on Standardization ( <a href="http://www.tc26.ru/">TC 26</a> ) "Cryptographic Information Security."  The LS11CLOUD cloud service supports the algorithms of GOST R 34.10-2012, GOST R 34.11-2012, GOST R 34.12-2015 and GOST R 34.13-2015, as well as the associated algorithms and parameters defined by the guidance documents TC 26. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The undoubted advantage of a cloud token is that now the user does not need to carry a token / smart card with him, to take care of his safety.  Having a personal token in the cloud, a user can access it from his home computer, from a laptop, and from a mobile device. <br><br>  Securing a secure remote interaction with a protected personal container of cryptographic objects (token) over an encrypted network channel is carried out using the authentication protocol <a href="http://tc26.ru/methods/recommendation/TK26SESPAKE.pdf">SESPAKE</a> (Security Evaluated Standardized Password-Authenticated Key Exchange) recommended by TC 26. <br><br>  On the user side, the main functionality is provided by the ls11cloud dynamic library with the standard software interface pkcs # 11.  To obtain a personal cloud token, the user must register on the LS11CLOUD cloud service, and then initialize and configure the personal token on the cloud service. <br><br><h3>  <font color="green">User registration on the cloud service</font> </h3><br>  To begin with, we note that the cloud token LS11CLOUD is located at pkcs11.ru and receives requests for port 4444. <br><br>  As already noted, the user is registered on the server and serviced his account using the <i>ls11cloud_config</i> utility: <br><br><pre><code class="bash hljs">bash-4.3$ ./ls11cloud_config LS11CLOUD User Utility usage: ./ls11cloud_config &lt;<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>&gt; [-p &lt;password&gt;] [-n &lt;new password&gt;] Commands: register &lt;host&gt; &lt;port&gt; &lt;id&gt; - register new user on the server duplicate &lt;host&gt; &lt;port&gt; &lt;id&gt; - duplicate user account on other computer change_pswd - change SESPAKE authentication password status - display current configuration data <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> - display server <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> file recreate - re-create token to initial empty state unregister - remove all user files from the server bash-4.3$</code> </pre> <br>  When registering a user, the location of the cloud service (the ‚Äúhost‚Äù field), the port (the ‚Äúport‚Äù field) through which the user communicates with the outside world, and the nickname (the ‚Äúid‚Äù field) of the user are indicated: <br><br><pre> <code class="bash hljs"> bash-4.3$ ls11cloud_config register pkcs11.ru 4444 habrahabr</code> </pre> <br>  For registration from the MS Windows platform, there is a graphical shell with an intuitive LS11CLOUDGUI interface for this utility: <br><br><img src="https://habrastorage.org/files/7b3/63f/b85/7b363fb85c9c497fade651cc125ff20d.png" alt="image"><br><br>  Get the distribution for the user <a href="">here</a> . <br><br>  So, let's start testing the implementation of Russian cryptography in the PKCS # 11 cloud token.  Testing will be conducted in MS Windows. <br><br>  Installing LS11CLOUD_setup.exe includes the generation of the initial value of the random number generator: <br><br><img src="https://habrastorage.org/files/b48/3fc/824/b483fc824133410599e924605c337cbc.png" alt="image"><br><br>  After downloading and installing the LS11CLOUD_setup.exe package, you need to run the ls11cloudgui graphical utility and click the "Registration" button: <br><br><img src="https://habrastorage.org/files/e1f/59a/cd4/e1f59acd475341469aa05b69fa5c4343.png" alt="image"><br><br>  The password is required to create a secure channel (SESPAKE protocol) from the user application to his personal token in the cloud.  A password will be requested each time a user creates a session with a token: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/100/efb/801/100efb80152241749e7afaf53fef6b9a.png" alt="image"></div><br>  In PKCS # 11 terminology, a session begins with the execution of the C_Initialize function and terminated by the execution of the C_Finalize function. <br><br>  If you put a tick in the field ‚ÄúSave password‚Äù, it will be saved in the user‚Äôs configuration file on his computer and will not be requested when the session is established. <br><br>  Upon successful user registration, a new token with a SO-PIN 87654321 will be created for it: <br><br><img src="https://habrastorage.org/files/b83/e12/729/b83e12729c2644e79da0eaf05d360cff.png" alt="image"><br><br><h3>  <font color="green">Token Initialization</font> </h3><br>  After that, it is necessary to initialize the token (set a label, change the SO PIN, set a user PIN, etc.).  To initialize the token, use the <a href="https://habrahabr.ru/post/316328/">p11conf</a> utility, which is included in the installation distribution: <br><br><pre> <code class="bash hljs">bash-4.3$ p11conf usage: p11conf [-hitsmIupPred] -A APIpath [-c slotID -U userPin -S SOPin -n newPin -L label] -h display usage -i display PKCS11 info -t display token info -s display slot info -m display mechanism list -I initialize token -u initialize user PIN -p <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> the user PIN -P <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> the SO PIN -r remove all objects -e enumerate objects -d dump all object attributes bash-4.3$</code> </pre> <br>  For the MS Windows platform, there is a graphical shell with an intuitive P11CONFGUI interface for this utility: <br><br><img src="https://habrastorage.org/files/8c8/608/29c/8c860829c0114f0387e53925aed95567.png" alt="image"><br><br>  To initialize the personal cloud token, just run the utility P11CONGGUI.exe and click the "Initialize" button: <br><br><img src="https://habrastorage.org/files/81d/a59/551/81da59551cb84b72afe356d0f40dbfbe.png" alt="image"><br><br>  After pressing the ‚ÄúOK‚Äù button, the cloud token is ready for operation.  If you want to use the created cloud token on another computer, then, of course, you also need to install on it the package LS11CLOUD_setup.exe.  After that, you need to run the graphical utility ls11cloudgui and click the button "Duplicate token": <br><br><img src="https://habrastorage.org/files/7ff/efb/f2f/7ffefbf2f37340608a4b44eddbd265fa.png" alt="image"><br><br><h3>  <font color="green">Installing the first personal certificate to the cloud token</font> </h3><br>  Now that we have registered in the cloud and created our own personal cloud token in it, we can start using it.  For testing, let's take the <a href="http://soft.lissi.ru/about/news/2016/08/76/">Redfox-52</a> browser and the <a href="http://soft.lissi.ru/about/news/2016/08/76/">Redfoxmail-52</a> email client, which are based on Mozilla Firefox and Mozilla Thunderbird, with support for Russian cryptography on tokens / smartcards PKCS # 11. <br><br>  We will conduct testing on the WIN32 platform. <br><br>  First you need to download and install Redfox-52.  To install the Redfox browser, you need to download the archive <a href="">firefox-52-gost</a> and unpack it. <br><br>  Unzipped Mozilla Firefox folder to move to a convenient place.  Then create a shortcut to the executable file firefox.exe (located inside the Mozilla Firefox folder) and place it in any convenient place. <br><br>  After launching the browser, you need to connect the created cloud token by adding the ls11cloud.dll library to the devices: <br><br><img src="https://habrastorage.org/files/100/656/b89/100656b89c0f4bb5b3a48343a5452574.png" alt="image"><br><br>  Please note that the distribution of the browser for MS Windows is built for the Win32 platform.  Consequently, the ls11cloud.dll library should also be taken for the Win32 platform. <br><br>  Once we have included the cloud token in the number of cryptographic devices with which the browser works, we can begin testing it.  At the first stage it is necessary to obtain at least one personal certificate.  To do this, use the <a href="http://www.soft.lissi.ru:8080/cgi-bin/pub/pki%3Fcmd%3Dclient_csr">services of one of the test CA</a> : <br><br><img src="https://habrastorage.org/files/aa7/f64/f9d/aa7f64f9d4db4dd0b3e5dce5d8e33400.png" alt="image"><br><br>  When you click the "Continue" button, the CA will offer to check the application data, and then select a cryptographic device (token / smart card) to generate a key pair and store a personal certificate: <br><br><img src="https://habrastorage.org/files/676/bb1/c00/676bb1c00f384190beca14a1968c9aa0.png" alt="image"><br><br>  Naturally, a cloud token is selected and after clicking the ‚ÄúContinue‚Äù button you will be offered not only to get a personal certificate generated by your application, but also to install / save the CA root certificate: <br><br><img src="https://habrastorage.org/files/485/5a4/6bf/4855a46bf65d471d97f7e45eecd77705.png" alt="image"><br><br>  You can make sure that the certificate is installed by viewing the browser certificate stores: <br><br><img src="https://habrastorage.org/files/9f0/f40/0fa/9f0f400fa9614cc09d6c2e41565ed11b.png" alt="image"><br><br><h3>  <font color="green">Test HTTPS and PKCS # 12</font> </h3><br>  So, cloud token mechanisms work.  Now let's check the operation of the cloud token in the <a href="https://soft.lissi.ru:9943/">authorized https</a> mode on Russian ciphers: <br><br><img src="https://habrastorage.org/files/c31/dab/6d0/c31dab6d0ff1496f864297aff26e1a50.png" alt="image"><br><br>  To verify the operation of the cloud token on the <a href="http://cryptopro.ru/products/csp/tc26tls">CryptoPro test pages, we will</a> use the previously received test certificate of the CryptoPro center and the test certificate unloaded into the PKCS # 12 container.  First you need to download the <a href="">certificate in the PKCS # 12 format</a> and install it on the cloud token (the password for the PKCS # 12 container is 01234567): <br><br><img src="https://habrastorage.org/files/2d8/12f/6a2/2d812f6a2ee0485d8632c7c47690c100.png" alt="image"><br><br>  As a storage device, you must select a cloud token: <br><br><img src="https://habrastorage.org/files/a57/3f5/689/a573f56896f846b3b6da4b7e9783149b.png" alt="image"><br><br>  Then you will need to enter a PIN for access to the token, password for PKCS # 12.  As a result, the certificate will be on the token: <br><br><img src="https://habrastorage.org/files/d8b/a46/7ac/d8ba467ac3c14a60bb23ec1f5858ebcd.png" alt="image"><br><br>  Do not forget to set the trust level of the CryptoPro CA root certificate: <br><br><img src="https://habrastorage.org/files/2d8/12f/6a2/2d812f6a2ee0485d8632c7c47690c100.png" alt="image"><br><br>  Now you can safely go to the CryptoPro test pages, for example <a href="https://tlsgost-512auth.cryptopro.ru/">, here</a> : <br><br><img src="https://habrastorage.org/files/cb9/57e/de2/cb957ede2deb44d9a74972540381e9b2.png" alt="image"><br><br><h3>  <font color="green">Using a cloud token to organize secure mail correspondence</font> </h3><br>  Now let's see how the cloud token works in the Redfoxmail / Thunderbird mail client. <br>  To install the Mozilla Thunderbird email client on the WIN32 platform, you need to download the <a href="">thunderbird-52.0-gost archive</a> and unpack it.  Unzipped Mozilla Thunderbird folder to shift to a convenient place. <br><br>  Then create a shortcut to the thunderbird.exe executable file (located inside the Mozilla Thunderbird folder) and place them in any convenient place.  After starting the mail client, we connect a cloud token, in the same way as we did for the Redfox browser: <br><br><img src="https://habrastorage.org/files/d2e/9ed/599/d2e9ed5996c346398aa73975c7ae39e9.png" alt="image"><br><br>  After connecting the cloud token, certificates stored on it will be available.  But this may not be enough - you need to install the CA root certificates, on which personal certificates are issued.  That's why we saved the root certificate when releasing: <br><br><img src="https://habrastorage.org/files/af5/ea6/00d/af5ea600d0304616a8ebf85010ba20c5.png" alt="image"><br><br>  Now in the account settings you need to install a certificate that will be used to sign and encrypt emails: <br><br><img src="https://habrastorage.org/files/495/81e/75f/49581e75fd554f0a8ade50432ede149d.png" alt="image"><br><br>  Now you can safely sign your posts: <br><br><img src="https://habrastorage.org/files/30c/9a2/eea/30c9a2eea59b48cf8b204731e8bd3d79.png" alt="image"><br><br>  This message can be received by any <a href="http://soft.lissi.ru/mail">email client with support for Russian cryptography</a> , for example, <a href="https://habrahabr.ru/post/316736/">KMail</a> : <br><br><img src="https://habrastorage.org/files/4d4/b4e/d13/4d4b4ed13d3f4dd4955b8a3d4e7112c6.png" alt="image"><br><br><h3>  <font color="blue">Conclusion</font> </h3><br>  So, we can say that the myth becomes reality.  The main scope of the cloud token LS11CLOUD can be internal corporate document flow, secure mail, banking. <br>  The cloud service LS11CLOUD with its cloud tokens can be very useful for application developers using tokens / smartcards PKCS # 11. <br><br><img src="https://habrastorage.org/files/123/d83/4d8/123d834d8d0f4e8ca4418863139cf7ce.png" alt="image" align="left">  PS I put my personal certificate in a cloud token, <a href="http://soft.lissi.ru/solution/gosuslugi_linux/">connected it to a public services plug-in</a> and paid the tax debt through the <a href="http://gosuslugi.ru/">GOSISLUG portal</a> .  OC - ‚Äã‚ÄãLinux. </div><p>Source: <a href="https://habr.com/ru/post/403563/">https://habr.com/ru/post/403563/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../403553/index.html">Personality and Sound: Hermann Ludwig Helmholtz - from fundamental physics to physiology of hearing and psychoacoustics</a></li>
<li><a href="../403555/index.html">Three medical robots as soft as humans</a></li>
<li><a href="../403557/index.html">Repair: how to get high from the process, not paint</a></li>
<li><a href="../403559/index.html">The history of one device: the path to knowledge control through technical creativity</a></li>
<li><a href="../403561/index.html">Launching the NROL-76 and landing the Falcon-9 stage</a></li>
<li><a href="../403565/index.html">Mains can become a conductor in the 5G era</a></li>
<li><a href="../403567/index.html">Office printing trends in the digital era</a></li>
<li><a href="../403569/index.html">The driving shield Ilona Mask arrived at the pit in the SpaceX parking lot</a></li>
<li><a href="../403571/index.html">In Ethiopia, pirated films are distributed through terminals</a></li>
<li><a href="../403573/index.html">Russian social networks introduce a paid subscription to music</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>