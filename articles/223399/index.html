<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A little cycling under Linux or RSS-aggregator on the knee with your own hands</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Inspired by the article "Google continues to destroy RSS." 

 Some time ago I needed to read several rss feeds. The question for me was relatively new...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A little cycling under Linux or RSS-aggregator on the knee with your own hands</h1><div class="post__text post__text-html js-mediator-article">  Inspired by the article <a href="http://habrahabr.ru/post/222391">"Google continues to destroy RSS."</a> <br><br>  Some time ago I needed to read several rss feeds.  The question for me was relatively new, earlier I had a very occasional rss deal, so I began to study this topic and select a reader from scratch. <br><br>  The results were ... let's say so - not pleasing. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      On cloud services with web interfaces, I have a chronic allergy in half with paranoia, and the subsequent funeral of the googlreeder has once again confirmed that paranoia will not advise the bad.  Yes, and regular changes to familiar interfaces for web services is also not encouraging. <br><br>  Among the locally installed readers there were several pieces that I tried to use, but none of them was chosen as a worker.  Here and annoying little things, like a poorly customizable interface, poor filtering tools or strange conservation logic;  and a more global problem with the fact that one of the tapes that I wanted to watch was Flibustian reviews about books, where the whole tape could easily be updated within a day, and some of the posts would eventually be skipped;  constantly keeping the reader running is not an inspirational option at all.  And besides, the zoo from dissimilar readers on the machine did not want to breed at all. <br><br>  And then, after some time thinking about the imperfections of this world, and formulating the women-women, a file was customarily taken into the hands and a couple of days were devoted to cycling. <br><br><a name="habracut"></a><br><br>  The result has been working successfully for over a year now.  Perhaps, a ready-made recipe will save someone time and effort, although of course, the recipe may not be suitable for everyone, since it was based on the fact that there was already a home server for Centos 6, connected to the Internet around the clock. <br><br>  So, to build my own aggregator of matches and acorns, besides the server itself, I needed additional packages: <br>  <a href="http://rsstool.sourceforge.net/%3Fc%3Drsstool%26f%3D%26output%3Dhtml">rsstool</a> <br>  <a href="https://wiki.archlinux.org/index.php/SSMTP">ssmtp</a> <br>  <a href="http://code.google.com/p/fdupes/">fdupes</a> <br>  ... and also some time and desire to tinker with perl. <br><br>  As a result, a rather primitive script was written, which would not make much sense at all, it would be enough to have the general logic of operation: <br><br>  After launching, the script reads the list of tapes from the text config in the form: <br>  habrahabr # http: //habrahabr.ru/rss - that is, the header that will be used later for working with the tape, the separator "#" and the address of the tape itself.  All this, plus the file names generated by the header for storing intermediate data, is stored in several arrays.  Then we run through these arrays foreach (), in which the following actions are performed: <br><br>  1. Via rsstool, the script downloads the tape itself as a csv with delimiters @, iconv converts the downloaded koi-8 encoding, grep cuts off the header, and all this is saved to a file for freshly downloaded. <br><br><pre><code class="perl hljs">rsstool --wget --csv=@ @url[$i](  http:<span class="hljs-regexp"><span class="hljs-regexp">//habrahabr</span></span>.ru/rss) | iconv -c -f UTF-<span class="hljs-number"><span class="hljs-number">8</span></span> -t KOI8-R| <span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> SITE\@DATE\@URL\@TITLE\@DESC -v &gt;<span class="hljs-regexp"><span class="hljs-regexp">/path_to_rss2email/feed</span></span>_new<span class="hljs-number"><span class="hljs-number">_</span></span>@rssname[$i].rss (  /path_to_rss2email/feed_new_habrahabr.rss)</code> </pre> <br><br>  2 Editing diff to the file with the tape archive and the file with freshly downloaded.  The difference between them, marked "&gt;" and will be required by us the news that appeared since the last download.  This difference is recorded in a separate file, as well as in the archive of the tape - so that on the next download these messages will be marked as already received. <br><br><pre> <code class="perl hljs">diff -iaEbwB --strip-trailing-cr $path_temp/@rssarcfile[$i] (.. /path_to_rss2email/habrahabr.rss) $path_temp/feed_new<span class="hljs-number"><span class="hljs-number">_</span></span>@rssname[$i].rss (.. /path_to_rss2email/feed_new_habrahabr.rss) | <span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> ^\\&gt;\\ &gt;$path_temp/@rssdiffer[$i] (.. /path_to_rss2email/habrahabr.diff)</code> </pre> <br><br>  3. Now you can start to rejoice - we received the file habrahabr.diff with the latest messages of the tape, and now we can do everything with this file.  We do this by reading the file line by line, and then, sorting out the lines of the form: <br><br>  "Habrahabr / Hacked / Thematic / Posts" @ "1399799340" @ " <a href="http://habrahabr.ru/post/222391/">habrahabr.ru/post/222391</a> " @ "Google continues to destroy RSS" @ "This week, namely on May 8, Google has disabled RSS-feed &lt;... cut ...&gt;.  Read more ‚Üí ¬ª <br><br>  ... create files in a separate directory according to the format of RFC2822.  After that, the script continues its work, processing the next tape in the list, or falls asleep for a minute;  in the meantime, the generated letters are processed by the second script launched by cron.  Using fdupes, it deletes in the directory with the RFC2822 files all identical files, except for one ... (Yes, I know, this is a crutch. Yes, it is embarrassing. But the problem is that separate duplicate lines, in spite of everything, are still not cleared diff ' om, surfaced a little later after writing the script, but there was no time to figure it out.) ... and then, using ssmtp, send them to a specially created mailbox. <br><br>  And now, having received the tape to the post office, we can calmly, without suffering from the next bout of creativity of designers and the momentous decisions of managers, read it everywhere, in the same familiar and beloved mail client (the same TheBat !, for example), using when This all the rich tools in the form of filters, sorting, searching and other utilities that will make reading the tape more convenient and efficient. <br><br>  UPD: Having slightly combed and commented out I post the actual scripts.  The first one does the actual downloading of the tapes and creates files with posts for sending to the mail, the second one sends them.  Both run on cron.  Well, plus a piece of config for example. <br><br><div class="spoiler">  <b class="spoiler_title">rsstoemail.pl</b> <div class="spoiler_text"><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#! /usr/bin/perl use MIME::Base64; $path_temp="/home/media/rsstool"; #    / #          -  , url ,     open(config,"&lt;/etc/rss/rsstoemail.conf"); $numb=0; while (!eof(config)) { $strcnf=&lt;config&gt;; $strcnf=~tr/\n//d; (@rss[$numb],@rssname[$numb],@rssfeeds[$numb])=split "#", $strcnf; @rssarcfile[$numb]="@rssname[$numb].rss"; @rssdiffer[$numb]="@rssname[$numb].diff"; $numb=$numb+1; } close config; #          -  , url ,     #       -   foreach $srtname1(@rssarcfile) { if (! -e "$path_temp/$srtname1") { `echo &gt;$path_temp/$srtname1`; } } #       -   #         -  $run=`ps -AH|grep -c rsstoemail.pl`; $run=~tr/\n//d; if ($run ne "1") { exit; } #         -  #    foreach $i(@rss) { #      -  if (@rss[$i] ne "") { $chkdiff=""; #  -    `echo &gt;$path_temp/@rssdiffer[$i]`; printf "run rsstool\n"; #  ,    koi-8,        `/sbin/myscript/rsstool --wget --csv=@ @rssfeeds[$i] | iconv -c -f UTF-8 -t KOI8-R| grep SITE\@DATE\@URL\@TITLE\@DESC -v &gt;$path_temp/feed_new_@rssname[$i].rss`; #      ,     `diff -iaEbwB --strip-trailing-cr $path_temp/@rssarcfile[$i] $path_temp/feed_new_@rssname[$i].rss | grep ^\\&gt;\\ &gt;$path_temp/@rssdiffer[$i]`; #       $chkdiff=`grep \@ $path_temp/@rssdiffer[$i] -c`; $chkdiff=~tr/\n//d; #    -  if ($chkdiff ne "0") { my @toemail = (); my @original = (); #  ,  ,    &gt;   diff #           open(diffopen,"&lt;$path_temp/@rssdiffer[$i]"); while (!eof(diffopen)) { $string = &lt;diffopen&gt;; $string=~s/^(\&gt;\ )//; $string=~tr/\n//d; push (@toemail, $string); push (@original, $string); } close diffopen; #  ,  ,    &gt;   diff #           #    #                 -   $dirr=`date '+%Y-%m-%d-%H_%M_%S'`; $newm=$#toemail+1; printf "$dirr new messages $newm\n"; #                 -   #       foreach $difs(@toemail) { #      #   " $difs=~tr/\"//d; #    $difs=~s/\ $//; $nmf=""; $date=""; $url=""; $bookname=""; $body=""; $resser=""; $ssurl=""; $sndusr=""; #     ($nmf,$date,$url,$bookname,$body)=split '@', $difs; #   ,    #                 if (@rssname[$i] eq "flibusta" or @rssname[$i] eq "librusec") { $body=~m/(.+?)(\ \ )/; $sndusr=$1; $sndusr=~tr/\n//d; } #                 #        url    (    #   proxy.flibusta.net, flibusta.net, www.flibusta.net )    url   if (@rssname[$i] eq "flibusta" or @rssname[$i] eq "flibustanewbooks") { ($resser,$ssurl)=split "\/b\/",$url; $resser=~m/(flibusta.net)/; if ($1 eq "flibusta.net") { $surl="http://flibusta.net/b/$ssurl/download\n"; } else { $surl=$url; } } else { $surl=$url; } #        url    (    #   proxy.flibusta.net, flibusta.net, www.flibusta.net )    url   #            -  -  if (@rssname[$i] eq "flibustanewbooks") { ($book_auth,$book_name,$book_genre)=split "- ",$bookname; $bookname="$book_name - $book_auth - $book_genre"; } #            -  -  #   ,    #     base64        SUBJ: $booknameenc=encode_base64("$bookname my_@rssname[$i]_rss"); $booknameenc=~tr/\n//d; $booknameenc="\=\?KOI8\-R\?B\?$booknameenc\?\="; #     base64        SUBJ: #          sleep 1; $dirr=`date '+%Y-%m-%d-%H_%M_%S'`; #          #             msgrss_2014-05-20-19_26_09       open(fopen,"&gt;&gt;$path_temp/mail/msgrss_$dirr"); print fopen "From\:\ fromemail\@domen\.ru\n"; print fopen "To\:\ toemail\@gmail\.com\n"; print fopen "Subject\: $booknameenc\n"; print fopen "MIME-Version: 1.0\n"; print fopen "Content-Type: multipart/mixed;\n"; print fopen " boundary=\"----------12012917B16D15D68\"\n"; print fopen "------------12012917B16D15D68\n"; print fopen "Content-Type: text/plain; charset=koi8-r\n"; print fopen "Content-Transfer-Encoding: 8bit\n"; print fopen "\n"; print fopen "$nmf\n"; print fopen "$surl\n"; print fopen "$bookname\n"; print fopen "\n"; if ($sndusr ne "") { print fopen "sendbyuser:$sndusr\n"; } print fopen "\n"; print fopen "$body\n"; print fopen "\n"; close fopen; #             msgrss_2014-05-20-09_26_09       } #        #            -    `cp $path_temp/@rssdiffer[$i] $path_temp/arhiv/diffnew\_$dirr`; #         -    `echo &gt;&gt;$path_temp/@rssarcfile[$i]`; #         open(arcrss,"&gt;&gt;$path_temp/@rssarcfile[$i]"); foreach $difffs(@original) { $difffs=~s/^(\&gt;\ )//; $difffs=~tr/\n//d; print arcrss "$difffs\n"; } close(arcrss); #         } } } printf "start send messages\n"; #         if ($hour eq "04" and $min&lt;"30") { foreach $srtname(@rssarcfile) { `uniq -u $path_temp/$srtname &gt;$path_temp/$srtname.tmp`; `mv -f $path_temp/$srtname.tmp $path_temp/$srtname`; } sleep 1000; } #        </span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">rsssendemail.pl</b> <div class="spoiler_text"><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#! /usr/bin/perl #     $path_all="/home/media/rsstool"; #  $path_mail="$path_all/mail"; $path_mail_arhiv="$path_all/mail_arhiv"; $path_arhiv="$path_all/arhiv"; #      _send   @list_dupes=`/sbin/myscript/fdupes -f $path_mail|grep -v send|grep -v \^\$`; #       foreach $fl(@list_dupes) { $fl=~tr/\n//d; `rm -f $fl`; printf "rm dupe $fl\n"; } #       #      _send   @list_files=`ls $path_mail/ |grep -v send`; sleep 5; #       ssmtp      *_send foreach $i(@list_files) { $i=~tr/\n//d; printf "sended $path_mail/$i\n"; `/sbin/myscript/ssmtp toemail\@gmail.com \&lt;$path_mail/$i`; `mv $path_mail/$i $path_mail/$i\_send`; sleep 1; } #       ssmtp      *_send #         @all_files=`ls $path_mail/`; $cont=$#all_files-1000; if ($cont &gt; 0) { printf "bigger 1000 to $cont\n"; for ($y=0; $y&lt;$cont;$y++) { @all_files[$y]=~tr/\n//d; `mv $path_mail/@all_files[$y] $path_mail_arhiv`; printf "@all_files[$y]\n"; } } #        </span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">rsstoemail.conf</b> <div class="spoiler_text"><pre> <code class="perl hljs"><span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-comment"><span class="hljs-comment">#librusec#http://lib.rus.ec/polka/show/all/rss 2#flibusta#http://flibusta.net/polka/show/all/rss 3#nnm#http://nnm.me/rss/ 4#habrahabr#http://habrahabr.ru/rss 5#3dnewssoft#http://www.3dnews.ru/software-news/rss/ 6#3dnewshard#http://www.3dnews.ru/news/rss/ 7#flibustanewbooks#http://flibusta.net/new/rss</span></span></code> </pre><br></div></div><br><br></div><p>Source: <a href="https://habr.com/ru/post/223399/">https://habr.com/ru/post/223399/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../223383/index.html">How to turn Pale Moon into a convenient browser</a></li>
<li><a href="../223385/index.html">Transition from 2 links to service architecture in the SOA paradigm</a></li>
<li><a href="../223387/index.html">Game ‚ÄúLAND‚Äù for DVK-3. Windows Reincarnation</a></li>
<li><a href="../223389/index.html">‚ÄúAyusha‚Äù - a controller on a 6502 processor</a></li>
<li><a href="../223395/index.html">LabView in robotics - creating a SCADA system to control the robot</a></li>
<li><a href="../223401/index.html">The basic principles of setting up the Garbage Collection from scratch</a></li>
<li><a href="../223403/index.html">Imagine Cup 2014: the path to victory</a></li>
<li><a href="../223405/index.html">PL / SQL Web Services Solution</a></li>
<li><a href="../223407/index.html">Convenient basket (and DAS) for HDD / SSD 3.5 "/2.5" from the designer with your own hands</a></li>
<li><a href="../223415/index.html">Intel GPA for Android - we optimize graphics in mobile applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>