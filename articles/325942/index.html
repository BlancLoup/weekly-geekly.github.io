<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Real-time Web application for simple devices</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings Habr! Often it is necessary to engage in the development of software for control devices. As a rule, these are industrial computers with rel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Real-time Web application for simple devices</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/f15/dec/eb7/f15deceb77ac4910af51cea522da5a9a.png"><br><br>  Greetings Habr!  Often it is necessary to engage in the development of software for control devices.  As a rule, these are industrial computers with relatively low hardware and computing resources managed and monitored by client software.  The client part in the form of a separate application has drawbacks: when updating the software of the device itself, it is necessary to update all clients, and the client must be cross-platform for good.  There was an idea to make a client application in the form of a web, and preferably as quickly as possible and not resource-intensive.  I hope these studies will help those who thought about this. <br><a name="habracut"></a><br><h3>  Formulation of the problem </h3><br>  And so, in the presence of a small computer in terms of resources, we will call it a computer (server) that controls the actuators, collects data, and solves the necessary and important tasks.  And they can be several networked.  The computer software is low-level and is written in C ++ and works under the operating system (in my case, Linux).  And you need to manage and monitor all this from the outside through a browser (client). <br><div style="text-align:center;"><img src="https://habrastorage.org/files/1c0/6e9/19d/1c06e919d40d4b63b390366517267f1f.png"></div><br>  <u>And another important point - the server must be able to independently notify the client about events, and not just respond to requests.</u> <br><br>  <i>Note: I do not aim to describe the features of the application and the capabilities of the products used - this is a separate topic.</i>  <i>I want to tell what and what was used and what the result was</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Start </h3><br>  There can be several calculators and they interact with each other over the network - here the framework for the remote call procedure of the <a href="https://zeroc.com/">Ice was found</a> , namely its version for the Internet-things IceE.  From the source code for the desired platform, we collect libraries, read the documentation and the network exchange at the function call level works!  But as it turned out, IceE allows you to work with javascript clients and works through WebSocket.  Well, the solution is found - it remains to try!  And not only javascript, but also there is something else. <br><div style="text-align:center;"><img src="https://habrastorage.org/files/fb5/b0b/a33/fb5b0ba33aa64bfa8b21770f390d0d78.png"></div><br><h3>  IceE at a glance </h3><br>  First you need to describe the interaction we want to get.  For this we use the specialized language slice.  Here is an example of what we will try: <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> once #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Ice/Identity.ice&gt; //  ++  namespace module Remote { //    -  ++   vector&lt;double&gt; sequence&lt;double&gt; Measurement; // interface -       -    () interface CallbackReceiver { //       -   progress-bar void Callback(int num); //       -    void SendData(Measurement m); }; //        interface CallbackSender { //        void AddClient(Ice::Identity ident); }; };</span></span></span></span></code> </pre> <br>  Based on this code, by means of Ice, C ++ classes for the server and javascript code for the web application are generated. <br><br><h3>  Server </h3><br>  The main thing is to implement the remoting class - we inherit it from the previously generated class. <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//Remote::CallbackSender  Ice class ImplCallback: public Remote::CallbackSender { public: ImplCallback(const Ice::CommunicatorPtr&amp; c) : communicator { c } { /*    */ th = std::thread([this]() { int count =0; constexpr int sizeMeasurement=30; /*typedef ::std::vector&lt; ::Ice::Double&gt; Measurement; -   */ Measurement measurement(sizeMeasurement); std::random_device r; std::default_random_engine e1(r()); std::uniform_real_distribution&lt;double&gt; uniform_dist(-10, 10); while(true) { std::this_thread::sleep_for(std::chrono::milliseconds(100)); std::lock_guard&lt;std::mutex&gt; lk(mut); auto it = clients.begin(); auto itend=clients.end(); for(;it!=itend;) { try { /*  -    progress-bar*/ (*it)-&gt;Callback(++count); for(auto&amp; m:measurement) m=uniform_dist(e1); /*  -   */ (*it)-&gt;SendData(measurement); ++it; } catch(const std::exception&amp; ex) { /*  - !*/ clients.erase(it++); } } } }); th.detach(); } /*     */ virtual void AddClient(const Ice::Identity&amp; ident, const Ice::Current&amp; current = ::Ice::Current()) override { cout &lt;&lt; "adding client `" &lt;&lt; communicator-&gt;identityToString(ident) &lt;&lt; "'" &lt;&lt; endl; std::lock_guard&lt;std::mutex&gt; lk(mut); /*        .   */ CallbackReceiverPrx c = CallbackReceiverPrx::uncheckedCast(current.con-&gt;createProxy(ident)); clients.insert(c); } private: /*    */ std::set&lt;Remote::CallbackReceiverPrx&gt; clients; Ice::CommunicatorPtr communicator; std::mutex mut; std::thread th; };</span></span></code> </pre><br>  It remains only to run it all.  Below is a stream function that performs the necessary configuration and launch of the Ice system. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ServerFun</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Ice::CommunicatorPtr ic; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">/* Ice*/</span></span> ic = Ice::initialize(); <span class="hljs-comment"><span class="hljs-comment">/*  WebSocket   20002*/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*      -    */</span></span> Ice::ObjectAdapterPtr adapter2 = ic-&gt;createObjectAdapterWithEndpoints(<span class="hljs-string"><span class="hljs-string">"Callback.Server"</span></span>, <span class="hljs-string"><span class="hljs-string">"ws -p 20002"</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*    ImplCallback     sender*/</span></span> adapter2-&gt;add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImplCallback(ic), ic-&gt;stringToIdentity(<span class="hljs-string"><span class="hljs-string">"sender"</span></span>)); <span class="hljs-comment"><span class="hljs-comment">/*    - !*/</span></span> adapter2-&gt;activate(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::this_thread::sleep_for(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::chrono::seconds(<span class="hljs-number"><span class="hljs-number">1</span></span>)); } ic-&gt;shutdown(); ic-&gt;destroy(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::exception&amp; ex) { <span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; ex.what() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ic) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { ic-&gt;destroy(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Ice::Exception&amp; ex2) { <span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; ex2 &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } } } }</code> </pre><br>  That's the whole server.  Easier to imagine. <br><br><h3>  Customer </h3><br>  To simplify the development of a web application, we use <a href="http://getbootstrap.com/">bootstrap</a> - it contains predefined styles, components, linkers and a lot more.  For data binding and the implementation of the MVC model, apply <a href="https://angularjs.org/">AngularJS</a> .  And I want to draw graphics for clarity of transferring arrays of data - <a href="http://www.humblesoftware.com/flotr2">flotr2</a> will help <a href="http://www.humblesoftware.com/flotr2">us</a> .  We skip the html text - besides the placement of the components and the data binding, there is no interesting information. Now the application's next javascript file: <br><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">"use strict"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> app = angular.module(<span class="hljs-string"><span class="hljs-string">'webApp'</span></span>, []); <span class="hljs-comment"><span class="hljs-comment">// angular    app.controller('webController', function myController($scope) { //   1- 2- 3- $scope.mode = 1; //progress-bar  0  100 $scope.valuenow = 0; //    -  radio html  $scope.mode1 = function() { $scope.mode = 1; } var communicator = Ice.initialize(); //      var CallbackReceiverI = Ice.Class(Remote.CallbackReceiver, { //  progress-bar Callback : function(num, current) { $scope.valuenow = num % 100; $scope.$apply(); }, //     SendData: function(measurement){ var data, graph; var container = document.getElementById('container'); data = []; for (var i = 0; i &lt;measurement.length; ++i) { data.push([ i, measurement[i] ]); } //     flotr2   . if ($scope.mode == 1) { graph = Flotr.draw(container, [ data ], { colors : [ '#C0D800' ], yaxis : { max : 12, min : -12 } }); } //else    ... } }); var proxy2 = communicator.stringToProxy("sender:ws -h localhost -p 20002"); //        AddClient Remote.CallbackSenderPrx.checkedCast(proxy2).then(function(pr2) { communicator.createObjectAdapter("").then(function(adapter) { var r = adapter.addWithUUID(new CallbackReceiverI()); proxy2.ice_getCachedConnection().setAdapter(adapter); pr2.AddClient(r.ice_getIdentity()); //     Heartbeat proxy2.ice_getCachedConnection().setACM(undefined, undefined, Ice.ACMHeartbeat.HeartbeatAlways); }); }); });</span></span></code> </pre><br><h3>  Total </h3><br>  Now we launch the server application and open our html page with the browser and see: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/315/629/8cc/3156298cc44b448690eec0d099dab037.png"></div><br>  Exchange is coming!  Data is being transferred! <br><br>  And so what was used: <br><br><ul><li>  <a href="https://zeroc.com/">Ice</a> </li><li>  <a href="http://getbootstrap.com/">bootstrap</a> </li><li>  <a href="https://angularjs.org/">AngularJS</a> </li><li>  <a href="http://www.humblesoftware.com/flotr2">flotr2</a> </li></ul><br>  As a result, using the specified set of components, it is possible to quickly implement a web application to monitor and control our server, without complicating the server software and performing interaction with the client directly from the code of the main application. <br><br>  I also considered the option of using <a href="https://www.webtoolkit.eu/wt">Wt</a> .  Also a very interesting thing.  But it seems to me that in the solution considered in this article there is more flexibility in the implementation of the client software itself - we can use any means we need for web development.  Yes, and Ice has already been used for network sharing - let it work here. <br><br>  I hope these surveys will help you in solving the tasks! </div><p>Source: <a href="https://habr.com/ru/post/325942/">https://habr.com/ru/post/325942/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325928/index.html">Bash scripts, part 2: loops</a></li>
<li><a href="../325932/index.html">About the dangers of wireless keyboards and mice</a></li>
<li><a href="../325934/index.html">How to bring visitors to the site honest ways and save: a digest of useful materials for beginners</a></li>
<li><a href="../325936/index.html">Development for Sailfish OS: Testing QML code dependent on C ++ in Sailfish OS</a></li>
<li><a href="../325938/index.html">How to survive the scaling and synchronize all the same between data centers</a></li>
<li><a href="../325944/index.html">We invite you to the Imagine Cup: April 15, 2017 will be the Russian final of the competition</a></li>
<li><a href="../325946/index.html">The evolution of CRM-systems</a></li>
<li><a href="../325950/index.html">Android application integration with fiscal printer and card reader</a></li>
<li><a href="../325952/index.html">These mysterious capacitors</a></li>
<li><a href="../325954/index.html">.NET Managed + C unmanaged: what is the price?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>