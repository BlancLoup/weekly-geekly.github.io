<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RedHat / Oracle Linux with NetApp FAS (SAN)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In continuation of the topic of optimizing the host. In the previous article I wrote about Windows and SAN optimization , in this article I would like...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RedHat / Oracle Linux with NetApp FAS (SAN)</h1><div class="post__text post__text-html js-mediator-article">  In continuation of the topic of optimizing the host.  In the previous article I wrote about <a href="http://habrahabr.ru/post/243153/">Windows and SAN optimization</a> , in this article I would like to look at the RedHat / Oracle Linux optimization topic (with and without virtualization) using NetApp <abbr title="Fabric-attached storage">FAS</abbr> in <abbr title="Storage area network">SAN</abbr> . <br><br>  To find and eliminate bottlenecks in such an infrastructure, you need to decide on the components of the infrastructure, among which they should be looked for.  We divide the infrastructure into the following components: <br><br><ul><li>  Host Settings with <abbr title="Storage area network">SAN</abbr> ( <abbr title="Fiber channel">FC</abbr> / <abbr title="Fiber channel over ethernet">FCoE</abbr> ) </li><li>  Host Ethernet network settings for <abbr title="Storage area network over IP">IP SAN</abbr> ( <abbr title="Internet Small Computer System Interface">iSCSI</abbr> ). </li><li>  Actually host with <abbr title="Operating system">OS</abbr> </li><li>  Applications on the host </li><li>  Check for compatibility of drivers and <abbr title="Software">software</abbr> versions </li></ul><br><img src="https://habrastorage.org/files/7b5/ba5/750/7b5ba5750082418983d3618414643ec6.png"><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To search for a bottleneck, a sequential exception technique is usually performed.  I suggest first thing to start with the <abbr title="Storage System">storage system</abbr> .  And move on to the <a href="http://habrahabr.ru/post/243045/">storage system</a> -&gt; Network ( <a href="http://habrahabr.ru/post/243119/">Ethernet</a> / FC) -&gt; <b>Host</b> ( <a href="http://habrahabr.ru/post/243153/">Windows</a> / <b>Linux</b> / <a href="http://habrahabr.ru/post/247833/">VMware ESXi 5.X</a> and <a href="https://habrahabr.ru/post/314778/">ESXi 6.X</a> ) -&gt; Application.  Now we‚Äôll stop at Khost. <br><br><h4>  <a href="https://habr.com/ru/post/245357/">SAN Multipathing</a> </h4><a name="SAN_Multipathing"></a><br>  In the case of connecting <abbr title="Logical unit number">LUNs</abbr> directly to the <abbr title="Operating system">OS</abbr> without virtualization, it is advisable to install the NetApp Host Utility.  In the case of using virtualization with <abbr title="Raw Disk Mapping">RDM</abbr> or <abbr title="Virtual Machine File System">VMFS</abbr> , you need to configure <a href="https://habr.com/ru/post/245357/">Multipathing on the hypervisor</a> . <br><br>  Multipathing should by default use the preferred paths - paths to the <abbr title="Logical unit number">LUN</abbr> through the ports of the controller on which it is located.  Messages in the console <a href="http://blog.aboutnetapp.ru/archives/971">FCP Partner Path Misconfigured</a> will talk about <a href="http://blog.aboutnetapp.ru/archives/631">incorrectly configured</a> <abbr title="Asymmetric Logical Unit Access">ALUA</abbr> or <abbr title="Multipath Input-Output">MPIO</abbr> .  This is an important parameter; you should not ignore it, since there was one real case where the enraged host multipassing driver continuously switched between paths, thus creating large queues in the I / O system.  For details on SAN Booting, see the related article: <a href="https://library.netapp.com/ecmdocs/ECMP1217221/html/GUID-00B5045F-F8A0-4163-AF13-A9464BD86E74.html">Red Hat Enterprise Linux / Oracle Enterprise Linux</a> , <a href="https://linux.netapp.com/node/56">Cent OS</a> , <a href="https://library.netapp.com/ecmdocs/ECMP1217221/html/GUID-CC8795C3-9E21-4EA8-B269-0F203F7AC58B.html">SUSE Linux Enterprise</a> <br><br>  Learn more about <a href="http://habrahabr.ru/post/260107/">zoning</a> recommendations <a href="http://habrahabr.ru/post/260107/">for NetApp in pictures</a> . <br><br><h4>  <a href="https://habr.com/ru/post/245357/">Ethernet</a> </h4><a name="Ethernet"></a><br><h5>  <a href="https://habr.com/ru/post/245357/">Jumbo frames</a> </h5><a name="Jumbo_frames"></a><br>  If <abbr title="Internet Small Computer System Interface">iSCSI</abbr> is used, it is highly recommended to use Jumbo Frames on Ethernet with a speed higher than or equal to 1Gb.  Read more in the article about <a href="http://habrahabr.ru/post/243119/">Ethernet with NetApp FAS</a> .  Do not forget that you need to run ping 28 bytes less when using Jumbo Frames in Linux. <br><pre><code class="bash hljs">ifconfig eth0 mtu 9000 up <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> MTU=9000 &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-eth0 <span class="hljs-comment"><span class="hljs-comment">#ping for MTU 9000 ping -M do -s 8972 [destinationIP]</span></span></code> </pre> <br><br><h5>  <a href="https://habr.com/ru/post/245357/">Flow control</a> </h5><a name="FlowControl"></a><br>  Flow Control is desirable to turn off all the traffic from the server to the storage system with 10GB links.  <a href="https://habrahabr.ru/post/243119/">More details</a> . <br><pre> <code class="bash hljs">ethtool -A eth0 autoneg off ethtool -A eth0 rx off ethtool -A eth0 tx off <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> ethtool -A eth0 autoneg off &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-eth0 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> ethtool -A eth0 rx off &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-eth0 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> ethtool -A eth0 tx off &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-eth0</code> </pre><br><br><h5>  <a href="https://habr.com/ru/post/245357/">ESXi &amp; MTU9000</a> </h5><h5><a name="ESXi_and_MTU9000"></a><br>  In case of using the ESXi environment, do not forget to create the correct network adapter - E1000 for 1GB networks or VMXNET3 if you have a network higher than 1Gb.  E1000 and VMXNET3 support MTU 9000, and the standard Virtual Network Adapter type "Flexible" does not support. <br>  Learn more about <a href="http://habrahabr.ru/post/246871/">optimizing VMware with NetApp FAS</a> . <br><br></h5><h6>  <a href="https://habr.com/ru/post/245357/">Converged network</a> </h6><a name="converged_network"></a><br>  Considering the ‚Äúversatility‚Äù of 10 <abbr title="Gigabit ethernet">GBE</abbr> , when <abbr title="Fiber channel over ethernet">FCoE</abbr> , <abbr title="Network file system">NFS</abbr> , <abbr title="Common Internet File System">CIFS</abbr> , <abbr title="Internet Small Computer System Interface">iSCSI</abbr> can walk at the same time along with such technologies as <abbr title="Cisco Virtual Port Channel">vPC</abbr> and <abbr title="Link Aggregation Control Protocol">LACP</abbr> , as well as the simplicity of servicing Ethernet networks, the <a href="http://habrahabr.ru/post/224869/">protocol and switches favorably distinguish</a> <abbr title="Fiber channel">FC</abbr> ‚ÄúManeuvering‚Äù and saving investments in the event of a change in business needs. <br><br><h5>  <a href="https://habr.com/ru/post/245357/">FC8 vs 10GBE: iSCSI, CIFS, NFS</a> </h5><a name="FC8vs10GBE_iSCSI_CIFS_NFS"></a><br>  Internal tests of NetApp <abbr title="Storage System">storage</abbr> systems (for other <abbr title="Storage System">storage</abbr> vendors this situation may differ) <abbr title="Fiber channel">FC</abbr> 8G and 10 <abbr title="Gigabit ethernet">GBE</abbr> <abbr title="Internet Small Computer System Interface">iSCSI</abbr> , <abbr title="Common Internet File System">CIFS</abbr> and <abbr title="Network file system">NFS</abbr> <i>show almost the same performance and latency</i> typical for <abbr title="Online transaction processing">OLTP</abbr> and server and desktop virtualization, i.e.  for loads with small blocks and random read writing. <br>  I propose to get acquainted with the pack of descriptive similarities, differences and perspectives of <a href="http://habrahabr.ru/post/224869/">Ethernet &amp; FC</a> . <br><br>  In the case when the customer's infrastructure implies two switches, then we can talk about the same complexity of configuring both <abbr title="Storage area network">SAN</abbr> and Ethernet networks.  But for many <abbr title="Storage area network">SAN</abbr> customers, the network is not reduced to two <abbr title="Storage area network">SAN</abbr> switches, where ‚Äúeveryone sees everyone‚Äù, as a rule, the configuration does not end at this point; in this respect, Ethernet maintenance is much easier.  Typically, a customer's <abbr title="Storage area network">SAN</abbr> network is a multitude of switches with redundant links and links to remote sites, which is by no means trivial to maintain.  And if something goes wrong, <a href="http://www.wireshark.org/">Wireshark</a> traffic will not "listen." <br><br>  Modern converged switches, such as the Cisco Nexus 5500, are capable of switching both Ethernet and <abbr title="Fiber channel">FC</abbr> traffic, allowing for greater flexibility in the future thanks to a two-in-one solution. <br><br><h6>  <a href="https://habr.com/ru/post/245357/">Thin provisioning</a> </h6><a name="Thin_Provitioning"></a><br>  In the case of using the "file" protocols <abbr title="Network file system">NFS</abbr> and <abbr title="Common Internet File System">CIFS, it is</abbr> very easy to take advantage of the use of the technology of Thin Provitioning, returning the freed up space inside the file balls.  But in the case of <abbr title="Storage area network">SAN, the</abbr> use of ThinProvitioning leads to the need for constant control over free space plus the release of free space (the <a href="http://habrahabr.ru/post/224869/">mechanism is available for modern OS</a> ) is not "inside" the same <abbr title="Logical unit number">LUN</abbr> , but rather inside the Volume containing this <abbr title="Logical unit number">LUN</abbr> .  I recommend that you read the <a href="http://www.netapp.com/us/system/pdf-reader.aspx%3Fpdfuri%3Dtcm:10-60697-16%26m%3Dtr-4046.pdf">NetApp Thin-Provisioned LUNs on RHEL 6.2 Deployment Guide</a> . <br><br><h5>  <a href="https://habr.com/ru/post/245357/">ESXi Host</a> </h5><a name="ESXi_host"></a><br>  You don‚Äôt have to give the guest <abbr title="Operating system">OS</abbr> all server resources; first, the hypervisor needs to leave at least 4GB of <abbr title="RAM">RAM</abbr> , and secondly, the opposite effect is sometimes observed when adding guest <abbr title="Operating system">OS</abbr> resources, this needs to be selected empirically. <br>  Learn more about <a href="http://habrahabr.ru/post/246871/">the ESXi host settings for NetApp FAS</a> . <br><br><h5>  <a href="https://habr.com/ru/post/245357/">Guest OS and host BareMetal Linux</a> </h5><a name="Host_OS_and_BareMetal"></a><br>  I want to draw your attention to the fact that in most Linux distributions, both as a virtual machine and <abbr title="On bare hardware (without virtualization)">BareMetal,</abbr> the I / O scheduling parameter is set to not suitable for <abbr title="Fabric-attached storage">FAS</abbr> systems, this can lead to high <abbr title="Central processing unit">CPU</abbr> utilization. <br><img src="https://habrastorage.org/files/ca3/a2c/b72/ca3a2cb7213747b382ff23ff835427f0.png" alt="image"><br>  Notice the output of the <i>top</i> command, the high utilization of the <abbr title="Central processing unit">CPU</abbr> caused by the <i>dd</i> process, which in general has to generate load only on the storage system. <br><br><h5>  <a href="https://habr.com/ru/post/245357/">Collecting statistics on the host</a> </h5><a name="Statistics"></a><br><h6>  <a href="https://habr.com/ru/post/245357/">Linux and other Unix-like</a> : </h6><a name="linux_statistics"></a><br>  Now look at the state of the disk subsystem on the host side <br><pre> <code class="bash hljs">iostat -dx 2 Device: rrqm/s wrqm/sr/sw/s rsec/s wsec/s avgrq-sz avgqu-sz await svctm %util sdb 0.00 0.00 0.00 454.00 0.00 464896.00 1024.00 67.42 150.26 2.20 100.00</code> </pre><br>  Note the high <i>await</i> value <i>= 150.26 ms</i> .  These two indirect signs, high utilization of the <abbr title="Central processing unit">CPU</abbr> and high latency, may tell us that it is necessary to more optimally configure the <abbr title="Operating system">OS</abbr> and <abbr title="Storage System">storage</abbr> for interaction.  It is worth checking, for example: the adequacy of the work of multipassing, ALUA, preferred paths and queues on the HBA. <br><br><div class="spoiler">  <b class="spoiler_title">Iostat interpretation</b> <div class="spoiler_text">  Read more <a href="http://cherry.world.edoors.com/Cdx6RbRHlOjQ">here</a> . <br><table><tbody><tr><th>  <b>Iostat</b> </th><th>  <b>Windows analog</b> </th></tr><tr><td>  rrqm / s (The number of merged read requests queued per second.) read I / O per second </td><td>  LogicalDisk (*) \ Disk Transfers / sec = rrqm / s + wrqm / s., For Linux machines add a column rrqm / s, and LogicalDisk (*) \ Disk Transfers / sec skip </td></tr><tr><td>  Wrqm / s (The number of merged write requests, queued per second.) Write I / O per second </td><td>  LogicalDisk (*) \ Disk Transfers / sec = rrqm / s + wrqm / s., For Linux machines add a column wrqm / s, and LogicalDisk (*) \ Disk Transfers / sec skip </td></tr><tr><td>  R / s </td><td>  Disk, reads / sec </td></tr><tr><td>  W / s (device number per second) </td><td>  Disk writes / sec </td></tr><tr><td>  Rsec / s (The number of sectors read per second.) Need to know the size of the sector, usually 512 bytes. </td><td>  Rsec / s * 512 =, "\ LogicalDisk (*) \ Disk, Read Bytes / sec", </td></tr><tr><td>  Wsec / s (The number of sectors written per second.) Need to know the size of the sector, usually 512 bytes. </td><td>  wsec / s * 512 =, "\ LogicalDisk (*) \ Disk Write Bytes / sec", </td></tr><tr><td>  Avgrq-sz (The request size in sectors.) Need to know the size of the sector, usually 512 bytes. </td><td>  avgrq-sz - the average size of the operated block is needed.  Add a column, in Windows it is calculated from other parameters. </td></tr><tr><td>  Avgqu-sz (The number of requests to the device's queue.) </td><td>  "\ LogicalDisk (*) \ Avg., Disk Queue Length".  Separately, according to Read and Write, there is no, but this is enough.  Read-write ratio will be calculated by ‚Äúrrqm / s‚Äù with ‚Äúwrqm / s‚Äù or ‚Äúr / s‚Äù with ‚Äúw / s‚Äù. That is, for Linux, skip:, LogicalDisk (*) \ Avg., Disk Read Queue Length, LogicalDisk (_Total) \ Avg., Disk Write Queue Length. </td></tr><tr><td>  Await (The number of milliseconds required to respond to requests) </td><td>  The average, Latency, in Windows does not produce this value, is calculated from the others, parameters, add a column, the parameter is needed. </td></tr><tr><td>  Svctm (The number of milliseconds spent servicing, requests, from beginning to end) </td><td>  The time to complete the request.  Add a separate column for Linux machines, useful </td></tr><tr><td>  % Util (The percentage of CPU time during which requests were issued) </td><td>  "\ Processor (_total) \%, Processor Time", let the load on the CPU be (add a column), from which the disk subsystem overload is indirectly understandable. </td></tr></tbody></table><br></div></div><br><br><h6>  <a href="https://habr.com/ru/post/245357/">Linux elevator</a> </h6><a name="Linux_elevator"></a><br>  Now about the values ‚Äã‚Äãfor <a href="http://lonesysadmin.net/2008/02/21/elevatornoop/">elevator / scheduler</a> : <br><br>  By default, it is set to <i>cfq</i> or <i>deadline</i> : <br><pre> <code class="bash hljs">cat /sys/block/sda/queue/scheduler noop anticipatory deadline [cfq]</code> </pre><br><br>  It is recommended to set it to <i>noop</i> : <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> noop &gt; /sys/block/sda/queue/scheduler <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /sys/block/sda/queue grep .* * scheduler:[noop] deadline cfq</code> </pre><br>  To make the settings permanent, add ‚Äú <i>elevator = noop</i> ‚Äù to the kernel boot parameters in the <i>/etc/grub.conf</i> file, they will be applied to all block devices.  Or add the appropriate script to <i>/etc/rc.local</i> in order to flexibly set up settings for each individual block device. <br><div class="spoiler">  <b class="spoiler_title">Sample script installation scheduler in noop for sdb</b> <div class="spoiler_text">  Do not forget to change sdb to the name of your block device. <br><pre> <code class="bash hljs">cat /etc/rc.local | grep -iv <span class="hljs-string"><span class="hljs-string">"^exit"</span></span> &gt; /tmp/temp <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -e <span class="hljs-string"><span class="hljs-string">"echo noop &gt; /sys/block/sdb/queue/scheduler\nexit 0"</span></span> &gt;&gt; /tmp/temp cat /tmp/temp &gt; /etc/rc.local; rm /tmp/temp</code> </pre><br></div></div><br><br><h6>  <a href="https://habr.com/ru/post/245357/">Sysctl Settings with Virtual Memory Operation</a> </h6><a name="Sysctl_Virtual_Memory"></a><br>  It should be experienced to find the most optimal values ‚Äã‚Äãof the virtual memory of the <abbr title="Operating system">OS</abbr> - sysctl parameters: <i>vm.dirty_background_ratio</i> , <i>vm.dirty_ratio</i> and <i>vm.swappiness</i> . <br><br><div class="spoiler">  <b class="spoiler_title">Check sysctl values</b> <div class="spoiler_text"><pre> <code class="bash hljs">sysctl -a | grep dirty vm.dirty_background_bytes = 0 vm.dirty_background_ratio = 10 vm.dirty_bytes = 0 vm.dirty_expire_centisecs = 3000 vm.dirty_ratio = 20 vm.dirty_writeback_centisecs = 500 sysctl -a | grep swappiness vm.swappiness = 60</code> </pre><br></div></div><br><br>  So, for one customer, the most optimal values ‚Äã‚Äãfor RedHat enterprice Linux 6 with NetApp <abbr title="Storage System">storage</abbr> systems with <abbr title="Solid state drive">SSD</abbr> cache and <abbr title="Fiber channel">FC</abbr> 8G connection were: <i>vm.dirty_ratio = 2</i> and <i>vm.dirty_background_ratio = 1</i> , which significantly reduced the load on the host <abbr title="Central processing unit">CPU</abbr> .  To check the optimal settings of the Linux host, use the <i>Linux Host Validator and Configurator</i> utility.  When testing the <b>SnapDrive</b> utility for Linux (or other Unix-like) <abbr title="Operating system">OSs,</abbr> use the <i>SnapDrive Configuration Checker for Unix</i> .  Learn more about the selection of optimal parameters <i>vm.dirty *</i> look <a href="http://lonesysadmin.net/2013/12/22/better-linux-disk-caching-performance-vm-dirty_ratio/">here</a> .  In the case of using the Oracle <abbr title="Database">database</abbr> or virtualization, inside such a Linux machine it is recommended to set the value <i>vm.swappiness = 0</i> .  This value will only allow swap to be used when the physical memory actually runs out, which is <a href="http://labite.wordpress.com/2012/08/31/tuning-linux-server-for-oracle-database/">optimal for such tasks</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Set sysctl values</b> <div class="spoiler_text"><pre> <code class="bash hljs">sysctl -w vm.dirty_background_ratio=1 sysctl -w vm.dirty_ratio=2 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> vm.dirty_background_ratio=1 &gt;&gt; /etc/sysctl.conf <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> vm.dirty_ratio=2 &gt;&gt; /etc/sysctl.conf <span class="hljs-comment"><span class="hljs-comment">#for Guest VMs or Oracle DB sysctl -w vm.swappiness=0 echo vm.swappiness=0 &gt;&gt; /etc/sysctl.conf #Reload data from /etc/sysctl.conf sudo sysctl ‚Äìp</span></span></code> </pre><br></div></div><br><br><h6>  <a href="https://habr.com/ru/post/245357/">I / O queue size or length of I / O queue on HBA</a> </h6><a name="HBA_IO_queue_size"></a><br>  The default value is usually <i>128</i> , it must be manually selected.  Increasing the queue length makes sense for random I / O operations that generate many <i>disk seek</i> operations on the disk subsystem.  We change it like this: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> 100000 &gt; /sys/block/[DEVICE]/queue/nr_requests</code> </pre>  Sometimes <a href="http://yoshinorimatsunobu.blogspot.com/2009/04/linux-io-scheduler-queue-size-and.html">changing this parameter may fail to give results</a> , for example, in the case of <i>InnoDB</i> (due to the peculiarities of this application, which itself optimizes the data before it is written) or in case of an increase in the parameter above the default when working with <abbr title="Solid state drive">SSD</abbr> drives (since they do not <i>disk seek</i> operations). <br><br><h5>  <a href="https://habr.com/ru/post/245357/">Guest OS</a> </h5><a name="Guest_OS"></a><br>  In some cases, <abbr title="Virtual Machine File System">VMFS</abbr> shows better performance than <abbr title="Raw Disk Mapping">RDM</abbr> .  So in some tests with <abbr title="Fiber channel">FC</abbr> 4G you can get 300 MByte / sec using <abbr title="Virtual Machine File System">VMFS</abbr> and about 200 MByte / sec with <abbr title="Raw Disk Mapping">RDM</abbr> . <br><br><h6>  <a href="https://habr.com/ru/post/245357/">File system</a> </h6><a name="FS"></a><br>  <abbr title="File system">FS</abbr> can make significant adjustments when testing performance. <br>  The size of the <abbr title="File system">FS</abbr> block should be a multiple of 4KB.  For example, if we run a synthetic load similar to the generated <abbr title="Online transaction processing">OLTP</abbr> , where the size of the operated block is on average 8KB, then we put 8KB.  I also want to note that as a <abbr title="File system">file system</abbr> itself, its implementation for a specific <abbr title="Operating system">OS</abbr> and version can greatly influence the overall performance picture.  So for when writing 10 MB blocks in 100 streams with the dd file command from the <abbr title="Database">database</abbr> on the UFS <abbr title="File system">file system</abbr> located on the <abbr title="Logical unit number">LUN</abbr> , the <abbr title="Fiber channel">FC</abbr> 4G with <abbr title="Fabric-attached storage">FAS</abbr> 2240 <abbr title="Database">data</abbr> <abbr title="Storage System">storage</abbr> and 21 + 2 <abbr title="Serial attached SCSI">SAS</abbr> 600 10k disks in one unit showed a speed of 150 MB / s, while however, the ZFS configuration showed two times more <abbr title="File system">FS</abbr> (approaching the theoretical maximum of the network channel), and the Noatime parameter didn‚Äôt affect the situation at all. <br><br><h6>  <a href="https://habr.com/ru/post/245357/">Noatime on Khost</a> </h6><a name="Noatime"></a><a name="Noatime_on_host"></a><br>  At the file system level, you can configure the parameter when installing <i>noatime</i> and <i>nodiratime</i> , which will not allow updating the access time to files, which often has a very positive effect on performance.  For <abbr title="File system">FSs</abbr> such as UFS, EXT3, and others. One of the customers installing noatime when mounting an ext3 file system on Red Hat Enterprise Linux 6 greatly reduced the load on the host <abbr title="Central processing unit">CPU</abbr> . <br><br><h6>  <a href="https://habr.com/ru/post/245357/">Loading table</a> </h6><a name="MBR"></a><a name="GPT"></a><a name="Boot_record_table"></a><br><br>  For Linux machines, you need to <a href="https://library.netapp.com/ecmdocs/ECMP1196995/html/GUID-7D4DD6E3-DB77-4671-BDA2-E393002E9EB2.html">select the disk geometry</a> when creating a <abbr title="Logical unit number">LUN</abbr> : " <i>linux</i> " (for machines without xen) or " <i>xen</i> " if Linux <abbr title="Logical Volume Manager">LVM</abbr> with Dom0 is installed on this moon. <br><br><h6>  <a href="https://habr.com/ru/post/245357/">Misalignment</a> </h6><a name="Misalignment"></a><br>  For any OS, when creating <abbr title="Logical unit number">LUNs</abbr> , in the storage settings, select the correct geometry.  In the case of an incorrectly specified size of the <abbr title="File system">FS</abbr> block, an incorrectly specified <abbr title="Logical unit number">LUN</abbr> geometry, the <abbr title="Master boot record">MBR</abbr> / <abbr title="GUID Partition Table">GPT</abbr> parameter that is not correctly selected on the host, we will observe at peak loads messages in the NetApp FAS console about a certain " <abbr title="Logical unit number">LUN</abbr> misalignment" event.  Sometimes these messages may appear erroneously, in the case of their rare appearance just ignore them.  You can check this by <a href="http://habrahabr.ru/post/243045/">running the lun stats command on the storage system</a> . <br><br><h6>  <a href="https://habr.com/ru/post/245357/">NetApp Host Utilities</a> </h6><a name="Host_Utilities"></a><br>  Do not ignore this item.  The toolkit <a href="https://library.netapp.com/ecm/ecm_get_file/ECMP1217221">sets the correct delays, queue size</a> for <abbr title="Host bus adapter">HBAs,</abbr> and other settings on the host.  Install Host Utilities <i>after</i> installing the drivers.  Displays the connected <abbr title="Logical unit number">LUNs</abbr> and their detailed information from the <abbr title="Storage System">storage</abbr> side.  The set of utilities is free and can be downloaded from the Netta technical support website.  After installation, run the utility. <br><pre> <code class="bash hljs">host_config &lt;-setup&gt; &lt;-protocol fcp|iscsi|mixed&gt; &lt;-multipath mpxio|dmp|non&gt; [-noalua]</code> </pre><br>  She is to be <br>  <i>/ opt / netapp / santools /</i> <br>  After that, most likely, you <b>will need to restart the host.</b> <br><br><h6>  <a href="https://habr.com/ru/post/245357/">NetApp Linux Forum</a> </h6><a name="NetApp_Linux_Forum"></a><br>  Don't forget to search for more information and ask your questions at <a href="https://linux.netapp.com/forum">https://linux.netapp.com/forum</a> . <br><br><h4>  <a href="https://habr.com/ru/post/245357/">Applications</a> </h4><a name="Apps"></a><br>  Depending on the configuration, protocols, loads, and infrastructure, your applications may have different tuning and fine tuning recommendations.  To do this, contact the Best Practice Guide for the appropriate applications for your configuration.  The most common may be <br><ul><li>  <a href="http://habrahabr.ru/post/230191/">NetApp SnapManager for Oracle &amp; SAN network</a> </li><li>  <a href="http://www.netapp.com/us/system/pdf-reader.aspx%3Fpdfuri%3Dtcm:10-120865-16%26m%3Dtr-4249.pdf">Oracle DB on Clustered ONTAP</a> , <a href="http://www.netapp.com/us/system/pdf-reader.aspx%3Fpdfuri%3Dtcm:10-59709-16%26m%3Dnva-0002.pdf">NetApp for Oracle Database</a> , <a href="http://www.netapp.com/us/system/pdf-reader.aspx%3Fpdfuri%3Dtcm:10-60340-16%26m%3Dtr-3633.pdf">Best Practices for Oracle</a> <a href="http://www.netapp.com/us/system/pdf-reader.aspx%3Fpdfuri%3Dtcm:10-61351-16%26m%3Dtr-3761.pdf">Dataset</a> , <a href="http://www.netapp.com/us/system/pdf-reader.aspx%3Fpdfuri%3Dtcm:10-61351-16%26m%3Dtr-3761.pdf">SnapManager for Oracle</a> </li><li>  <a href="http://www.netapp.com/us/system/pdf-reader.aspx%3Fpdfuri%3Dtcm:10-60848-16%26m%3Dtr-3712.pdf">Oracle VM</a> </li><li>  <a href="http://www.netapp.com/us/system/pdf-reader.aspx%3Fpdfuri%3Dtcm:10-59920-16%26m%3Dtr-3272.pdf">DB2</a> , <a href="http://www.netapp.com/us/system/pdf-reader.aspx%3Fpdfuri%3Dtcm:10-61521-16%26m%3Dtr-3460.pdf">DB2 and FlexClone</a> , <a href="http://www.netapp.com/us/system/pdf-reader.aspx%3Fpdfuri%3Dtcm:10-60443-16%26m%3Dtr-3988.pdf">Deploying an IBM DB2 Multipartition Database</a> </li><li>  <a href="http://www.netapp.com/us/system/pdf-reader.aspx%3Fpdfuri%3Dtcm:10-60997-16%26m%3Dmysqlperformance-5.pdf">Mysql</a> </li><li>  <a href="http://www.netapp.com/us/system/pdf-reader.aspx%3Fpdfuri%3Dtcm:10-61402-16%26m%3Dmysql-wp.pdf">NetApp and MySQL Infrastructure for Web 2.0 / LAMP</a> </li><li>  <a href="http://www.netapp.com/us/system/pdf-reader.aspx%3Fpdfuri%3Dtcm:10-101510-16%26m%3Dtr-4104.pdf">Red Hat Enterprise Linux 6, KVM</a> </li><li>  <a href="http://www.netapp.com/us/system/pdf-reader.aspx%3Fpdfuri%3Dtcm:10-60965-16%26m%3Dtr-3691.pdf">Lotus Domino 8.5 for Linux</a> </li><li>  <a href="http://www.netapp.com/us/system/pdf-reader.aspx%3Fpdfuri%3Dtcm:10-104657-16%26m%3Dtr-3732.pdf">Citrix xenserver</a> </li><li>  <a href="http://www.netapp.com/us/system/pdf-reader.aspx%3Fpdfuri%3Dtcm:10-121372-16%26m%3Dtr-4284.pdf">Deploying Red Hat Enterprise Linux OpenStack Platform 4 on NetApp Clustered Data ONTAP</a> </li><li>  <a href="http://www.netapp.com/us/library/">and etc.</a> </li></ul><br><br><h4>  <a href="https://habr.com/ru/post/245357/">Drivers</a> </h4><a name="drivers"></a><br>  Do not forget to install the drivers for your <abbr title="Host bus adapter">HBA</abbr> adapter (by compiling them for your kernel) before you install the NetApp Host Utility.  Follow the recommended <abbr title="Host bus adapter">HBA</abbr> adapter settings.  Often, you need to change the queue length and timeout for optimal interaction with NetApp.  If you are using VMware ESXi or other virtualization, do not forget to enable <abbr title="N-Port ID Virtualization">NPIV</abbr> if you need to forward virtual <abbr title="Host bus adapter">HBA</abbr> adapters inside the virtual machine.  Some <abbr title="N-Port ID Virtualization">NPIV-</abbr> based adapters can be configured for <abbr title="Quality of service">QoS</abbr> , such as the <a href="http://www.netapp.com/us/system/pdf-reader.aspx%3Fm%3DTR-3800.pdf%26cc%3Dus">Qlogic HBA 8100 series</a> . <br><br><h4>  <a href="http://habrahabr.ru/post/154205/">Compatibility</a> </h4><a name="compatibility"></a><br>  <a href="http://habrahabr.ru/post/154205/">Make</a> extensive <a href="http://habrahabr.ru/post/154205/">use of the compatibility matrix</a> in your practice to reduce potential problems in the <abbr title="Data processing center">data center</abbr> infrastructure. <br><br>  I am sure that over time, I will have something to add to this article on optimizing the Linux host, so look here from time to time. <br><br>  <b>I ask to send messages on errors in the text to the <abbr title="Private message">LAN</abbr> .</b> <br>  <b>Notes and additions on the contrary please in the comments</b> </div><p>Source: <a href="https://habr.com/ru/post/245357/">https://habr.com/ru/post/245357/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../245347/index.html">Do you want to do the job well - first you need tools, or how we helped one head of the IT department to build an effective system for managing employee quality</a></li>
<li><a href="../245349/index.html">We optimize workflow</a></li>
<li><a href="../245351/index.html">Technical aspects of ensuring non-visual availability of Android applications</a></li>
<li><a href="../245353/index.html">SMessage - A simple and predictable event system for Unity.</a></li>
<li><a href="../245355/index.html">Electrofocus on the base of the Arduino Uno debug board, part 2</a></li>
<li><a href="../245361/index.html">5 success stories that would not happen without promises</a></li>
<li><a href="../245363/index.html">Forms in online stores designed by investigators threatened</a></li>
<li><a href="../245365/index.html">How I lost my password from the Android keystore, but then I was able to recover using Jetbrains Idea</a></li>
<li><a href="../245367/index.html">Modern methods of authentication and security of iOS devices</a></li>
<li><a href="../245369/index.html">First look at the Apple Watch SDK</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>