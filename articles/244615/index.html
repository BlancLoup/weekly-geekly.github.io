<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ABAP: Sampling reference values ‚Äã‚Äãby their keys from database tables</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I wrote not so long ago a method for sampling reference values ‚Äã‚Äãby their keys into an internal table by creating a dynamic program. Unfortunately, th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ABAP: Sampling reference values ‚Äã‚Äãby their keys from database tables</h1><div class="post__text post__text-html js-mediator-article">  I wrote not so long ago a method for sampling reference values ‚Äã‚Äãby their keys into an internal table by creating a dynamic program.  Unfortunately, the source code can not be applied, as the authorities have forbidden to do it.  So I confine myself to a general description of the theory. <br><br>  For example, we have an internal table: <br><br><pre><code class="hljs pgsql">DATA: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> it_TABLE occurs <span class="hljs-number"><span class="hljs-number">0</span></span>, BE <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> T001-BUKRS, BENAME <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> T001-BUTXT, <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> it_TABLE .</code> </pre> <br>  In the table, the <b>BE</b> field is filled in and we need to select the <b>BUTXT</b> value from the corresponding <b>BE</b> from <b>T001</b> and fill in the <b>BENAME</b> field.  How to do it "correctly" (ie, with minimal memory and as quickly as possible). <br><a name="habracut"></a><br><ol><li>  Choose unique BE field values; </li><li>  Make FOR ALL ENTRIES of T001; </li><li>  Let's go through the internal table and for each BE we find the corresponding value in the data selected from T001.  (Of course, we use the HASH table to speed up the search) </li></ol>  And this sequence is always the same. <br><div class="spoiler">  <b class="spoiler_title">Here is the code for this process.</b> <div class="spoiler_text"><pre> <code class="hljs delphi">FIELD-SYMBOLS: &lt;wa_Table&gt; like line <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> it_Table . *--      BE TYPES: <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> s_k1, BUKRS <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> T001-BUKRS, <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> s_k1 . DATA: it_k1 <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span> SORTED TABLE <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> s_k1 <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> UNIQUE KEY BUKRS , wa_k1 like line <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> it_k1. LOOP AT it_Table ASSIGNING &lt;wa_Table&gt;. wa_k1-BUKRS = &lt;wa_Table&gt;-BE. INSERT wa_k1 INTO TABLE it_k1. ENDLOOP. *--     T001    TYPES: <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> s_v1, BUKRS <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span> T001-BUKRS, BUTXT <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span> T001-BUTXT, <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> s_v1 . DATA: it_v1 <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span> SORTED TABLE <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> s_v1 <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> NON-UNIQUE KEY BUKRS , wa_v1 like line <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> it_v1. <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> it_k1[] <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> INITIAL. REFRESH it_v1. <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span>. SELECT BUKRS BUTXT FROM T001 INTO CORRESPONDING FIELDS <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> TABLE it_v1 <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> ALL ENTRIES <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> it_k1 WHERE BUKRS = it_k1-BUKRS . ENDIF. *--     LOOP AT it_Table ASSIGNING &lt;wa_Table&gt;. <span class="hljs-keyword"><span class="hljs-keyword">READ</span></span> TABLE it_v1 INTO wa_v1 <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> table key BUKRS = &lt;wa_Table&gt;-BE . <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> sy-subrc = <span class="hljs-number"><span class="hljs-number">0</span></span>. &lt;wa_Table&gt;-BENAME = wa_v1-BUTXT. <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span>. CLEAR &lt;wa_Table&gt;-BENAME. ENDIF. ENDLOOP.</code> </pre></div></div>  And if we always perform the same actions, it means that their description should be reduced to a minimum.  In particular, in this case, we need to specify the table from which to select, the key fields and the fields from which to write data to. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Those.  we have the following small line in which the whole essence of the above code is written: <pre> <code class="hljs cs"> <span class="hljs-string"><span class="hljs-string">'T001{BUKRS=BE}{BUTXT&gt;BENAME}'</span></span></code> </pre><br>  We pass to the method the string specified above + our internal table.  And after calling the method, the BENAME field will be filled with the corresponding values ‚Äã‚Äãfrom T001-BUTXT.  We have reduced our code, besides another programmer it is enough to have a method reference at hand and he will quickly understand what this line is doing.  In this case, the whole algorithm fits into a small line. <br><div class="spoiler">  <b class="spoiler_title">Here is the code generated by my method.</b> <div class="spoiler_text"><pre> <code class="hljs sql"> TYPES: <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> s_k1, BUKRS <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> T001-BUKRS, <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> s_k1 . <span class="hljs-keyword"><span class="hljs-keyword">DATA</span></span>: it_k1 <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span> SORTED <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> s_k1 <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> BUKRS , wa_k1 <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> it_k1. <span class="hljs-keyword"><span class="hljs-keyword">FIELD</span></span>-SYMBOLS: &lt;fs_1_BUKRS&gt; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ANY</span></span>, &lt;fs_1_BUTXT&gt; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ANY</span></span> . <span class="hljs-string"><span class="hljs-string">"--      BE LOOP AT &lt;it_Table&gt; ASSIGNING &lt;wa_Table&gt;. "</span></span><span class="hljs-comment"><span class="hljs-comment">-- ASSIGN COMPONENT 'BE' OF STRUCTURE &lt;wa_Table&gt; TO &lt;fs_1_BUKRS&gt;. wa_k1-BUKRS = &lt;fs_1_BUKRS&gt;. "--     INSERT wa_k1 INTO TABLE it_k1. ENDLOOP. TYPES: BEGIN OF s_v1, BUKRS TYPE T001-BUKRS, BUTXT TYPE T001-BUTXT, END OF s_v1 . DATA: it_v1 TYPE SORTED TABLE OF s_v1 WITH NON-UNIQUE KEY BUKRS , wa_v1 like line of it_v1. *--    T001 IF it_k1[] IS INITIAL. REFRESH it_v1. ELSE. SELECT BUKRS BUTXT FROM T001 INTO CORRESPONDING FIELDS OF TABLE it_v1 FOR ALL ENTRIES in it_k1 WHERE BUKRS = it_k1-BUKRS . ENDIF. FREE it_k1. *--     LOOP AT &lt;it_Table&gt; ASSIGNING &lt;wa_Table&gt;. ASSIGN COMPONENT 'BE' OF STRUCTURE &lt;wa_Table&gt; TO &lt;fs_1_BUKRS&gt;. ASSIGN COMPONENT 'BENAME' OF STRUCTURE &lt;wa_Table&gt; TO &lt;fs_1_BUTXT&gt;. "--   READ TABLE it_v1 INTO wa_v1 with table key BUKRS = &lt;fs_1_BUKRS&gt; . IF sy-subrc = 0. &lt;fs_1_BUTXT&gt; = wa_v1-BUTXT. ELSE. CLEAR: &lt;fs_1_BUTXT&gt; . ENDIF. ENDLOOP. FREE it_v1.</span></span></code> </pre></div></div>  For the full work of the method, we will add the ability to specify constants and system variables (for example, sy-langu is often required for selecting texts).  Also add the ability to specify a list of commands - then we will be able to consistently select data. <br><br>  How it works?  - using dynamic programs.  Those.  the method analyzes the parameters passed through the string, generates a dynamic program and starts it.  The program is added through the ‚ÄúINSERT REPORT l_repid FROM CODE.‚Äù In order not to be limited by the number of programs created. <br><br>  PS I am especially pleased with this method when I have to choose a lot of values, and from time to time in the process of work, the director receives an indication to add a new field for selection. <br><br>  <b>update</b> : the process code was written in the correct form - it turned out 53 lines.  Parameter line + method call = 5 lines.  Those.  the code has been reduced by 10 times and now it is placed within one page.  Which, in my opinion, greatly improves readability. </div><p>Source: <a href="https://habr.com/ru/post/244615/">https://habr.com/ru/post/244615/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../244601/index.html">How to optimize your marketing content strategy to reach more potential customers</a></li>
<li><a href="../244603/index.html">Insidious pue</a></li>
<li><a href="../244605/index.html">The digest of interesting news and materials from the world of PHP No. 52 (November 16 - 30, 2014)</a></li>
<li><a href="../244609/index.html">.NEXT 2014 Moscow: Final schedule, sponsors, stands and a pair of spoilers</a></li>
<li><a href="../244611/index.html">How PayPal Mafia Affects Silicon Valley Success</a></li>
<li><a href="../244619/index.html">Joker 2014 Java conference through the eyes of a speaker from Siberia</a></li>
<li><a href="../244621/index.html">Using the AdDuplex Service for Universal Applications</a></li>
<li><a href="../244623/index.html">non-FlexPod DC: Direct-Attached Storage, One-stop support</a></li>
<li><a href="../244625/index.html">Probabilistic programming</a></li>
<li><a href="../244627/index.html">Ethernet bandwidth measurement</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>