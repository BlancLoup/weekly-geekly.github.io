<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>File system access in MarkLogic Server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="MarkLogic is an application server and any program written in XQuery for it can get access not only to objects stored in the database itself, but also...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>File system access in MarkLogic Server</h1><div class="post__text post__text-html js-mediator-article">  MarkLogic is an application server and any program written in XQuery for it can get access not only to objects stored in the database itself, but also to files located directly on the file system. <br>  The API that provides access to the file system in MarkLogic Server is not so rich, but the available tools are enough to read the data from the file system directly from the XQuery code and save the files to it. <br><a name="habracut"></a><br>  As part of the MarkLogic API, an external file or object is a file or object stored on the file system.  Accordingly, an internal object is an object that is stored in the database itself. <br><br>  Let's consider in more detail the existing API.  The file system access functions are located in the ‚Äúxdmp‚Äù namespace. <br>  And the first function allows you to access the binary () object lying on the file system <br><pre><code class="java hljs">xdmp:external-binary( $path as xs:string, [$starting-location as xs:<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>], [$length as xs:<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>] ) <span class="hljs-function"><span class="hljs-function">as </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">binary</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code> </pre> <br><br>  <b>$ path</b> - the path to the file <br>  <b>$ starting-location</b> - The index of the first byte in the file is 1. Default = 1 <br>  <b>$ length</b> - The number of bytes read. <br>  In this case, the <b>binary ()</b> object is associated with the file in FS and you can always determine if the <b>binary ()</b> object is internal or external. <br>  You must have privileges to access this feature. <br> <code><a href="http://marklogic.com/xdmp/privileges/xdmp-external-binary"></a> marklogic.com/xdmp/privileges/xdmp-external-binary</code> <br>  If the file on the file system does not exist, then the <b>XDMP-MISSINGFILE</b> exception is <b>thrown.</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The following function takes a <b>binary ()</b> file object and returns the path to the file associated with it on the file system. <br><pre> <code class="java hljs">xdmp:external-binary-path( <span class="hljs-function"><span class="hljs-function">$source as </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">binary</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> ) as xs:string?</span></span></code> </pre> <br><br>  The <b>XDMP-ARG</b> exception is thrown if the object passed to the <b>binary ()</b> function is not associated with a file on the file system. <br><br>  The <b>xdmp</b> function <b>: binary-is-external</b> - checks if a <b>binary ()</b> object is an external object (file) <br><pre> <code class="java hljs">xdmp:binary-is-external( <span class="hljs-function"><span class="hljs-function">$source as </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">binary</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> ) as xs:</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span></span></code> </pre> <br><br>  Using the following function, you can get a listing of the directory on the file system. <br><pre> <code class="java hljs">xdmp:filesystem-directory( $pathname as xs:string ) <span class="hljs-function"><span class="hljs-function">as </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">element</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dir:directory)</span></span></span></span></code> </pre> <br><br>  <b>$ pathname</b> - directory of interest <br>  To perform the function, you must have rights <br> <code><a href="http://marklogic.com/xdmp/privileges/xdmp-filesystem-directory"></a> marklogic.com/xdmp/privileges/xdmp-filesystem-directory</code> <br>  Also, the system user must have read access to the specified directory. <br>  Exceptions <b>SVC-DIROPEN</b> or <b>SVC-FILOPEN</b> are thrown out if the user performing the function does not have sufficient rights to do this. <br>  The result of the function is a list of objects located on the FS.  Example <br><pre> <code class="java hljs">xdmp:filesystem-directory( <span class="hljs-string"><span class="hljs-string">"./"</span></span> ) &lt;dir:directory xsi:schemaLocation=<span class="hljs-string"><span class="hljs-string">"http://marklogic.com/xdmp/directory directory.xsd"</span></span> xmlns:dir=<span class="hljs-string"><span class="hljs-string">"http://marklogic.com/xdmp/directory"</span></span> xmlns:xsi=<span class="hljs-string"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span>&gt; &lt;dir:entry&gt; &lt;dir:filename&gt;Admin&lt;/dir:filename&gt; &lt;dir:pathname&gt;./Admin&lt;/dir:pathname&gt; &lt;dir:type&gt;directory&lt;/dir:type&gt; &lt;dir:content-length&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>&lt;/dir:content-length&gt; &lt;dir:last-modified&gt;<span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">05</span></span>-<span class="hljs-number"><span class="hljs-number">02</span></span>T13:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>+<span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>&lt;/dir:last-modified&gt; &lt;/dir:entry&gt; &lt;dir:entry&gt; &lt;dir:filename&gt;LEGALNOTICES.txt&lt;/dir:filename&gt; &lt;dir:pathname&gt;./LEGALNOTICES.txt&lt;/dir:pathname&gt; &lt;dir:type&gt;file&lt;/dir:type&gt; &lt;dir:content-length&gt;<span class="hljs-number"><span class="hljs-number">28343</span></span>&lt;/dir:content-length&gt; &lt;dir:last-modified&gt;<span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">04</span></span>-<span class="hljs-number"><span class="hljs-number">19</span></span>T23:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span>+<span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>&lt;/dir:last-modified&gt; &lt;/dir:entry&gt; ... &lt;/dir:directory&gt;</code> </pre> <br><br>  To read text data from the file system, you can use this function. <br><pre> <code class="java hljs">xdmp:filesystem-file( $pathname as xs:string ) as xs:string</code> </pre> <br><br>  Where <b>$ pathname</b> is the path to the file to be read in XQuery <br>  In order for the read operation to end successfully, it is necessary that the data in the file be in UTF-8 encoding.  Because of this requirement, when reading binary data, this function will throw an exception and MarkLogic will vouch for the data encoding.  To read binary data, use the <b>xdmp</b> function <b>: external-binary</b> . <br>  Privileges are required to perform the function. <br> <code><a href="http://marklogic.com/xdmp/privileges/xdmp-filesystem-file"></a> marklogic.com/xdmp/privileges/xdmp-filesystem-file</code> <br> <br>  You can check whether the file exists on the file system <br><pre> <code class="java hljs">xdmp:filesystem-file-exists( $pathname as xs:string ) as xs:<span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span></code> </pre> <br><br>  Where <b>$ pathname</b> is the path to check <br>  Privileges are required to perform the function. <br> <code><a href="http://marklogic.com/xdmp/privileges/xdmp-filesystem-file-exists"></a> marklogic.com/xdmp/privileges/xdmp-filesystem-file-exists</code> <br> <br>  In order to find out the file size, there is an <b>xdmp</b> function <b>: filesystem-file-length</b> <br><pre> <code class="java hljs">xdmp:filesystem-file-length( $pathname as xs:string ) as xs:unsignedLong?</code> </pre> <br><br>  The function returns an empty sequence if the file does not exist. <br>  Privileges required to perform the function. <br> <code><a href="http://marklogic.com/xdmp/privileges/xdmp-filesystem-file-length"></a> marklogic.com/xdmp/privileges/xdmp-filesystem-file-length</code> <br> <br>  Next, consider the function of saving <br><pre> <code class="java hljs">xdmp:save( $path as xs:string, <span class="hljs-function"><span class="hljs-function">$node as </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">node</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, [$options as </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">node</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">?] ) as empty-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sequence</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code> </pre> <br><br>  This function serializes any (xml, text, bunary) object and saves it to the file system under the specified name in the specified directory. <br>  This function has quite a few options, for example, output-encoding, which specifies the document encoding.  But the existing options of this function are quite specific and in order to simply save the document to the file system, it suffices to execute the following code: <br><br><pre> <code class="java hljs">let $text := text { <span class="hljs-string"><span class="hljs-string">"hello world"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> xdmp:save(<span class="hljs-string"><span class="hljs-string">"greeting.txt"</span></span>, $text)</code> </pre> <br><br>  or for example, you can save a file from DB to the file system <br><br><pre> <code class="java hljs">let $pdf := doc(<span class="hljs-string"><span class="hljs-string">"/mydocs/stuff.pdf"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> xdmp:save(<span class="hljs-string"><span class="hljs-string">"mystuff.pdf"</span></span>, $pdf)</code> </pre> <br><br>  Privileges required to perform the function. <br> <code><a href="http://marklogic.com/xdmp/privileges/xdmp-save"></a> marklogic.com/xdmp/privileges/xdmp-save</code> <br> <br>  MarkLogic Server is primarily storing documents in a database and processing these documents with XQuery queries.  But sometimes you need to read or write the file to the file system, and for this MarkLogic has everything you need.  Of course, these tools are not suitable for complex processing of binary files, image conversions, but they do an excellent job with the tasks set before them. </div><p>Source: <a href="https://habr.com/ru/post/196402/">https://habr.com/ru/post/196402/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../196388/index.html">How Mail.Ru Group Kills AAA-Class MMO Games</a></li>
<li><a href="../196390/index.html">Generalization task</a></li>
<li><a href="../196394/index.html">Mistress of the present - integrated graphics (Intel GPU) 2013 or "mylophone with me!"</a></li>
<li><a href="../196396/index.html">Group editing of resources (documents) using MIGXDB</a></li>
<li><a href="../196400/index.html">Fetish-oriented programming</a></li>
<li><a href="../196404/index.html">Automatic cleaning of old drivers, or squeeze a bit of space from Windows 7</a></li>
<li><a href="../196408/index.html">Free webinar "Creating a business without investment: Studio 3D-modeling and robotics." Lead by Anatoly Garmashov</a></li>
<li><a href="../196416/index.html">We are finishing the Turnigy Accucel 6 charger</a></li>
<li><a href="../196418/index.html">CodeNotes - Clojure Cup 2013 winner</a></li>
<li><a href="../196420/index.html">Oracle DBMS data clustering outside the cluster table</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>