<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We work with smart cards using Python (part 1)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At first, at the time of the idea, in 2014, this article was planned as a single publication, but after working through the material (too lazy forced ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We work with smart cards using Python (part 1)</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/ol/rz/zw/olrzzwhtaqzkvzvoeswkbu3uubg.jpeg" align="left">  At first, at the time of the idea, in 2014, this article was planned as a single publication, but after working through the material (too lazy forced to stretch this process), I realized that it was necessary to divide it into two parts: </p><br><ol><li>  Familiarity with the library and writing / parsing the code of a special command processor that uses it. </li><li>  Using the command processor from part 1 to read the contents of the file from the sim card, which I once picked up on the street (no personal data will not be disclosed).  We learn how to disaccustom Windows to interfere with our interaction with the card, and also, perhaps, we will touch on the topic of choosing (activating) the system application on the card (if my experimental card turns out to be UICC). </li></ol><br><p>  I think the first part will be of more interest to the pros-cards, and the second part will be interesting, first of all, for newcomers to this topic (and will have the <strong>Tutorial</strong> tag). </p><a name="habracut"></a><br><p> Among the many Python libraries that have reviews on Habr√©, I did not find a <a href="http://pyscard.sourceforge.net/">pyscard</a> , a library for interacting with smart cards. <br>  In this article I will try to give a brief description of the main features of the <strong>pyscard</strong> , and for sweet we will write a simple command processor that works with the card through the <abbr title="Application Protocol Data Unit">APDU</abbr> . <br>  Please note that in order to understand how to use this library and the surrounding terminology, familiarity with the <code>ISO 7816-4</code> or, at least, <code>GSM 11.11</code> is required.  It is easier to get official access to the GSM standard by downloading it from <a href="http://www.etsi.org/">the ETSI website</a> , by the way, and ISO 7816-4 (pdf, an old version) is googling, despite the fact that it is at the office.  site want money). </p><br><p>  <strong>Pyscard has</strong> existed since 2007 and is a cross-platform (win / mac / linux) add-on for <a href="https://en.wikipedia.org/wiki/PC/SC">PC / SC API</a> . </p><br><div class="spoiler">  <b class="spoiler_title">my experience of using on platforms, if interested ...</b> <div class="spoiler_text"><p>  My work environment where I use pyscard - Windows7 <br>  I tested the material of this article mainly on mac OS, but I also drove to Windows7, in a virtual machine.  I should note that, unlike <abbr title="Windows xp">XP</abbr> , the "seven" and, probably, the "ten", with the default settings, "puts a stick in the wheels" when working with the card in the reader: </p><br><ol><li>  When placing each card into the reader, this card is considered a Plug &amp; Play device, for which the system ‚Äúlooks for drivers‚Äù. </li><li>  If we wait for the termination of item 1, then the system starts looking for certificates on the card, while communicating with it with its APDUs, these APDUs mix with ours and there are collisions leading to failures in our programs. </li></ol><br><p>  These factors gave me a lot of pain when switching from XP, until I defeated them.  How to do this, I will tell in the second part. </p></div></div><br><p>  Development started under the auspices of one of the leading (and at the time of creation, and now) card market players. <br>  Both Python branches are supported (2 and 3). </p><br><div class="spoiler">  <b class="spoiler_title">My experience with Python versions ...</b> <div class="spoiler_text"><p>  In the work environment, I use a bunch of <strong>pyscard</strong> + Python 2.7, but for the article, it seemed to me correct to use the currently relevant branch of Python (3.6) </p></div></div><br><p>  In my opinion, the <strong>pyscard</strong> library is <strong>not</strong> designed very <em>pythonic</em> and looks more like a port of some Java framework, but this does not diminish its usefulness, at least for me, although the names of the modules look strange, of course. </p><br><p>  The entry point to the library is the <code>smartcard</code> package. </p><br><p>  We should also mention the <code>smartcard.scard</code> package, which is responsible for communicating with the operating system's card API.  If you do not need all the abstractions of the library, but only bare <code>PC/SC</code> , then you are here.  We will not dwell on it in detail. </p><br><p>  Installation of pyscard is possible in the following ways: </p><br><ul><li>  with PyPi ( <code>pip install pyscard</code> ) - suitable for systems configured to build artifacts from sources, <a href="http://www.swig.org/">swig is</a> used (ok for mac and, perhaps, linux) </li><li>  From a binary distribution, which can be <a href="https://ci.appveyor.com/project/LudovicRousseau/pyscard">picked</a> up from <a href="https://ci.appveyor.com/project/LudovicRousseau/pyscard">appveyor</a> or <a href="https://sourceforge.net/projects/pyscard/files/pyscard/">sourceforge</a> (great rolls in Windows) </li></ul><br><p>  <strong>Pyscard</strong> has an informative <a href="https://pyscard.sourceforge.io/user-guide.html">user guide</a> , which is available on the official website, pydoc and examples, so I see no reason to duplicate it all here.  Instead, we: </p><br><ol><li>  Let's look at the typical structure / pattern of the program; </li><li>  Let's take a look at, in my opinion, the most important objects of the library, which should convince to use not a low-level <code>smartcard.scard</code> , but a <code>smartcard</code> ; </li><li>  We illustrate the use of the library with a real example - we will write a command processor (shell) in Python 3.6, where the commands will be straightforward ‚ÄúAPDU in hex‚Äù and the response from the card will be output to the console.  Text <strong>exit</strong> and <strong>atr</strong> commands will also be supported. </li></ol><br><h2 id="tipovoy-shablon-programmy">  Typical program template </h2><br><p>  It‚Äôs time to throw in the portions of the code, otherwise all the boring introductory ‚Äúbububu‚Äù ... </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> smartcard.CardRequest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> CardRequest cardrequest = CardRequest() <span class="hljs-comment"><span class="hljs-comment">#  waitforcard(),       cardservice = cardrequest.waitforcard() #          APDU = [0xA0, 0xA4, 0, 0, 2] #   SELECT  GSM 11.11 # smartcard.CardConnection.CardConnection  - with cardservice.connection as connection: connection.connect() # -     data, sw1, sw2 = connection.transmit(APDU)</span></span></code> </pre> <br><p>  What tasks solves (almost any) program that works with smart cards in the reader?  These are: </p><br><ol><li>  The choice of the reader with whom we will interact </li><li>  Determining the moment when the card will be in this reader </li><li>  Setting the communication channel with the map </li><li>  Checking the card for compliance with our criteria (we may not want to work with every card that the user will give us) </li><li>  Data exchange with the card via APDU </li><li>  Closing the communication channel with the card </li><li>  Determining the moment when the card will be removed from the reader </li></ol><br><p>  I note that the listed problems are solved, for example, by flashing a mobile phone. </p><br><h2 id="vazhneyshie-obekty-paketa-smartcard">  Key objects of the <code>smartcard</code> package </h2><br><p>  In this section, all names are relative to the <code>smartcard</code> package. </p><br><h3 id="podklassy-cardtype">  Subclasses of <code>CardType</code> </h3><br><p>  Allow us to specify the exact type of cards with which our application is going to work.  You can make sure that our application does not even respond to placing a card in the reader that does not suit us. </p><br><blockquote><h4 id="primery">  Examples: </h4><br><ul><li>  <code>CardType.ATRCardType</code> (exists in the library) - filtering cards by <a href="http://en.wikipedia.org/wiki/Answer_to_reset">ATR</a> value.  Our application will only respond to cards with a specific ATR value. </li><li>  <code>USIMCardType</code> (I imagined, it can be implemented) - only USIM are valid cards, inside we check the possibility of choosing a USIM application. </li></ul><br></blockquote><br><h3 id="cardrequest-i-ego-podklassy">  <code>CardRequest</code> and its subclasses </h3><br><p>  Allow you to bring together all the requirements of our application relating to the establishment of communication with the card: </p><br><ul><li>  strictly set the card type (see above) </li><li>  limit the list of valid readers (from those already installed in the system) </li><li>  change the card timeout in the reader </li></ul><br><p>  By default, no restrictions are set in <code>CardRequest</code> . </p><br><h3 id="cardconnection"> <code>CardConnection</code> </h3> <br><p>  The communication channel of our application with the card allows you to send APDUs to the card and receive an answer, the key method here is <code>transmit()</code> .  It is with its help that the direct interaction of our application with the map takes place.  It should be noted that the <code>transmit()</code> method always returns a triplet (tuple) consisting of: </p><br><ul><li>  Response data (contains real data or <code>None</code> , depending on the type of APDU, not all APDUs return data) </li><li>  The first status byte (StatusWord) <code>SW1</code> </li><li>  The second status byte (StatusWord) <code>SW2</code> </li></ul><br><p>  <code>CardConnection</code> is a context manager that adds convenience when using it. </p><br><h3 id="cardconnectiondecorator"> <code>CardConnectionDecorator</code> </h3> <br><p>  The word "decorator" is used here in the same context as in Java, and not in the one to which Python developers are accustomed. <br>  Allows you to <code>CardConnection</code> specific properties to the <code>CardConnection</code> object.  The library provides working decorators with speaking names: <code>ExclusiveConnectCardConnection</code> and <code>ExclusiveTransmitCardConnection</code> .  Personally, I did not feel the effect of using these decorators - if the system (Windows) decided to interpose with its APDUs in our session, then none of these decorators will save, but maybe I did something wrong. </p><br><h3 id="funkciya-systemreaders">  <code>System.readers()</code> function </h3><br><p>  Allows you to get a list of card readers connected to the system and establish a connection with the card in a specific reader. </p><br><h3 id="swerrorchecker-swerrorcheckingchain">  <code>sw.ErrorChecker</code> , <code>sw.ErrorCheckingChain</code> </h3><br><p>  By default, during data exchange between the card and our application, no erroneous values ‚Äã‚Äãof the StatusWord (SW1, SW2) raise exceptions.  This can be changed by <code>ErrorChecker</code> descendants of <code>ErrorChecker</code> , which are: </p><br><ul><li>  merged into <code>sw.ErrorCheckingChain</code> sequence </li><li>  bind to <code>CardConnection</code> and check for errors the result of each call to the <code>transmit()</code> method. <br>  The checkers built into the library allow you to get detailed information about the problem in an exception without having to climb into the specs and look for the necessary values ‚Äã‚Äãof <code>SW1</code> , <code>SW2</code> . </li></ul><br><h3 id="potomki-cardconnectionobserver">  Descendants of <code>CardConnectionObserver</code> </h3><br><p>  Join an instance of <code>CardConnection</code> and receive information about all command APDUs and card responses that pass through the observed connection.  Example of application - maintaining a log of commands and answers from the card. </p><br><p>  Armed with this <em>knowledge</em> , we may well aim at writing a command processor using the described library. </p><br><h2 id="komandnyy-processor-s-apdu-cli">  Command processor with APDU (CLI) </h2><br><p>  I will not dwell on the <a href="https://docs.python.org/2/library/cmd.html">cmd</a> module, which the standard library kindly provides us with, it has already been written about <a href="https://habrahabr.ru/post/175321/">here</a> , I will move on to the implementation. </p><br><p>  The entire source code of the processor is on <a href="https://github.com/brake/python-apducmd">github</a> . <br>  Let's go through the main points, not exchanging trivia. </p><br><h3 id="funkciya-select_reader">  Function <code>select_reader()</code> </h3><br><p>  Returns the first reader connected to the computer or <code>None</code> if there are no connected readers. </p><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">select_reader</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Select the first of available readers. Return smartcard.reader.Reader or None if no readers attached. """</span></span> readers_list = readers() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> readers_list: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> readers_list[<span class="hljs-number"><span class="hljs-number">0</span></span>]</code> </pre> <br><p>  There is a <a href="https://github.com/brake/python-apducmd/blob/c489882da8dc6b68f035d68fdbc3e4b45185ac97/apducmd.py">variant of this function</a> (depends on the msvcrt module, ie, only for Windows), which allows you to select a reader if there are several of them in the computer. </p></div></div><br><h3 id="klass-apdushell">  Class APDUShell </h3><br><p>  This class, in addition to inheriting <code>cmd.Cmd</code> , <del>  implements the interface </del>  has an observer behavior <code>smartcard.CardMonitoring.CardObserver</code> </p><br><h4 id="dannye-ekzemplyara-nashey-obolochki">  Instance data of our shell </h4><br><p>  <strong>reader</strong> - the <strong>reader</strong> to work with. <br>  <strong>card</strong> - the <strong>card</strong> object, we will need to determine the moment of changing the card in the reader. <br>  <strong>connection</strong> ‚Äî APDU transmission channel to the card and receiving the processing result. <br>  <strong>sel_obj</strong> is a string containing the ID of the current object (file or folder) selected by the <code>SELECT</code> command.  This line is changed whenever the SELECT command is executed. <br>  <strong>atr</strong> - here we remember the ATR of the current card so that it can be displayed on the screen without requesting a card every time (such a request resets the state of file selection in the card). <br>  <strong>The card_connection_observer</strong> is an observer that binds to each <strong>connection</strong> , details below. </p><br><h4 id="v-konstruktore">  In the constructor </h4><br><div class="spoiler">  <b class="spoiler_title">Constructor code</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super(APDUShell, self).__init__(completekey=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>) self.reader = select_reader() self._clear_context() self.connection = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.card_connection_observer = ConsoleCardConnectionObserver() CardMonitor().addObserver(self)</code> </pre> </div></div><br><p>  We, in addition to initializing data, add ourselves to the observers. <br>  <code>smartcard.CardMonitoring.CardMonitor</code> - an object that reacts to reader and card interaction events (the card is placed in the reader, the card is removed from the reader) and notifies about these events a <code>smartcard.CardMonitoring.CardObserver</code> , i.e.  us.  This type of alert is configured only once during the life of our shell.  <code>CardMonitor</code> is a <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D0%25B4%25D0%25B8%25D0%25BD%25D0%25BE%25D1%2587%25D0%25BA%25D0%25B0_(%25D1%2588%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)">singleton</a> , so we do not care about the lifetime of its copy. <br>  I also draw attention to the <code>smartcard.CardConnectionObserver.ConsoleCardConnectionObserver</code> instance - this is a ready-made library observer object that monitors the status of the communication channel with the card and prints this state to the console.  We will hang it on every new connection with the map. </p><br><h4 id="update">  update () </h4><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, observable, handlers)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""CardObserver interface implementation"""</span></span> addedcards, removedcards = handlers <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.card <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> self.card <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> removedcards: self._clear_connection() self._clear_context() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> card <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> addedcards: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> str(card.reader) == str(self.reader): self.card = card self._set_up_connection() <span class="hljs-keyword"><span class="hljs-keyword">break</span></span></code> </pre> </div></div><br><p>  This is, in fact, the behavior of <code>smartcard.CardMonitoring.CardObserver</code> .  If our current card is in the <code>removedcards</code> list, then we clear the state of the shell for the current card. <br>  If a new card has appeared in our selected reader (and in the <code>addedcards</code> list at the same time), then we initialize a new shell state for this card. </p><br><h4 id="default">  default () </h4><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">default</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, line)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Process all APDU"""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> self.card <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: apdu = toBytes(line) data, sw1, sw2 = self.connection.transmit(apdu) <span class="hljs-comment"><span class="hljs-comment"># if INS is A4 (SELECT) then catch and save FID if select is successful if apdu[1] != APDUShell.SELECT_COMMAND_INSTRUCTION or sw1 not in APDUShell.SELECT_SUCCESSFUL_SW1: return self.sel_obj = toHexString(apdu[5:], PACK) except (TypeError, CardConnectionException) as e: try: print(e.message.decode(locale.getpreferredencoding())) except AttributeError: print(e.__class__.__name__ + ' (no message given)')</span></span></code> </pre> </div></div><br><p>  Here all hexadecimal APDUs entered by the user are converted into byte lists and sent to the map.  I note that the only thing we do with the result here is to determine if the command sent is not a successful <code>SELECT</code> .  If yes, then we update the ID of the last selected object to print in the invitation to the user. <br>  Our <code>ConsoleCardConnectionObserver</code> does the rest of the routine work of interpreting and displaying the result of the command for the user. </p><br><blockquote>  <strong>Small passing retreat</strong> <br>  I personally don‚Äôt really like how the <code>ConsoleCardConnectionObserver</code> displays the result of the APDU execution - it doesn‚Äôt separate the SW from the resulting data as I would like it to.  I used it only in order not to litter the example code with unimportant details.  However, if anyone is interested, my observer‚Äôs <code>update()</code> method code is <a href="https://github.com/brake/python-apducmd/blob/71cdbe5ccd2451b1f8b47a0b1a567a9bd4455bfa/apducmd.py">in this commit</a> . </blockquote><br><h4 id="_set_up_connection">  _set_up_connection () </h4><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_set_up_connection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Create &amp; configure a new card connection"""</span></span> self.connection = self.card.createConnection() self.connection.addObserver(self.card_connection_observer) self.connection.connect() self.atr = toHexString(self.connection.getATR(), PACK)</code> </pre> </div></div><br><p>  A hard worker who helps us every time the card in the reader changes.  He creates a connection with the card, <code>ConsoleCardConnectionObserver</code> on it, and remembers the ATR card (so that the <strong>atr</strong> command can display it on the screen). </p><br><h4 id="_clear_connection">  _clear_connection () </h4><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_clear_connection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.connection: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.connection.deleteObserver(self.card_connection_observer) self.connection.disconnect() self.connection = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span></code> </pre> </div></div><br><p>  The <code>_set_up_connection()</code> , ‚Äúcleans‚Äù when the card is removed from the reader. </p><br><h3 id="zaklyuchenie">  Conclusion </h3><br><p>  At this stage, we can run our command shell and, depending on the availability of a card reader, get a simple error message (no reader) or see the shell in work (the lucky ones with the reader).  If you have a reader, nothing prevents you from inserting any smart card into it and executing the atr command - it should work, but please do not forget that you are experimenting on your own working SIM and bank cards at your own peril and risk. </p><br><div class="spoiler">  <b class="spoiler_title">Screenshot of our command processor</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/um/we/6o/umwe6odex7h4w0ugvqayw8syxta.png" alt="Screenshot"></p></div></div><br><p>  See you in the second part, I assume that Python will not be there (almost or completely), but there will be APDU and SW. </p><br><hr><br><p>  When preparing the article, I came across a couple of projects that use this library: <br>  <a href="https://bitbucket.org/benallard/webscard/src">https://bitbucket.org/benallard/webscard/src</a> <br>  <a href="https://github.com/mitshell/card">https://github.com/mitshell/card</a> <br>  May be real code examples will be useful. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/346270/">https://habr.com/ru/post/346270/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346260/index.html">Calculations on the video card, manual, easy level</a></li>
<li><a href="../346262/index.html">Apache Ignite vs Oracle DBMS</a></li>
<li><a href="../346264/index.html">Technical Debt Management</a></li>
<li><a href="../346266/index.html">The effect of group polarization and its mathematical modeling</a></li>
<li><a href="../346268/index.html">Physical simulation on the GPU using the compute shader in the Unity3D environment</a></li>
<li><a href="../346272/index.html">"Simple" python programming</a></li>
<li><a href="../346274/index.html">Web installer on pure WINAPI with Hi DPI support and vector logo</a></li>
<li><a href="../346276/index.html">Developing a cool GUI on esp8266 with the uGFX library</a></li>
<li><a href="../346284/index.html">We select passwords using Google Chrome</a></li>
<li><a href="../346286/index.html">We write our own miniature Redis server in Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>