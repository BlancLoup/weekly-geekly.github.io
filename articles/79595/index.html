<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating multi-model forms</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sometimes you need to create a form whose data is associated with several tables. For example, you have two models: Owner and Car. When adding a new O...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating multi-model forms</h1><div class="post__text post__text-html js-mediator-article">  Sometimes you need to create a form whose data is associated with several tables.  For example, you have two models: Owner and Car.  When adding a new Owner, I would like to be able to immediately add a car.  With the advent of Rails 2.3, this has become easier. <br><br><blockquote><code><font color="black"><font color="#008000"><i>#   ()</i></font> &lt;br/&gt; <font color="#9966CC"><b>def</b></font> create&lt;br/&gt; <font color="#0066ff"><b>@owner</b></font> = Owner. <font color="#5A0A0A"><b>new</b></font> <font color="#006600"><b>(</b></font> params <font color="#006600"><b>[</b></font> <font color="#ff3333"><b>:owner</b></font> <font color="#006600"><b>]</b></font> <font color="#006600"><b>)</b></font> &lt;br/&gt; ...&lt;br/&gt; <font color="#9966CC"><b>if</b></font> <font color="#0066ff"><b>@owner</b></font> . <font color="#5A0A0A"><b>save</b></font> &lt;br/&gt; <font color="#0066ff"><b>@car</b></font> = Car. <font color="#5A0A0A"><b>new</b></font> <font color="#006600"><b>(</b></font> params <font color="#006600"><b>[</b></font> <font color="#ff3333"><b>:car</b></font> <font color="#006600"><b>]</b></font> <font color="#006600"><b>)</b></font> &lt;br/&gt; <font color="#9966CC"><b>if</b></font> <font color="#0066ff"><b>@car</b></font> . <font color="#5A0A0A"><b>save</b></font> &lt;br/&gt;  ...&lt;br/&gt; <font color="#9966CC"><b>end</b></font> &lt;br/&gt;&lt;br/&gt; <font color="#008000"><i>#  , Rails 2.3+</i></font> &lt;br/&gt; <font color="#9966CC"><b>def</b></font> create&lt;br/&gt; <font color="#0066ff"><b>@owner</b></font> = Owner. <font color="#5A0A0A"><b>new</b></font> <font color="#006600"><b>(</b></font> params <font color="#006600"><b>[</b></font> <font color="#ff3333"><b>:owner</b></font> <font color="#006600"><b>]</b></font> <font color="#006600"><b>)</b></font> &lt;br/&gt; ...&lt;br/&gt; <font color="#9966CC"><b>end</b></font></font></code> <br> </blockquote><br><a name="habracut"></a>  And the magic in the magic parameter <strong>accepts_nested_attributes_for</strong> , which is <strong>written</strong> in the model and passes additional parameters when creating the object.  All this is created in one line: <br><br><blockquote> <code><font color="black">Owner. <font color="#9900CC">create</font> <font color="#006600"><b>(</b></font> <font color="#ff3333"><b>:name</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">""</font> , <font color="#ff3333"><b>:age</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#006666">40</font> , <font color="#ff3333"><b>:car_attributes</b></font> <font color="#006600"><b>=&gt;</b></font> &lt;br/&gt; <font color="#006600"><b>{</b></font> :model <font color="#006600"><b>=&gt;</b></font> <font color="#996600">"Formula 1"</font> , <font color="#ff3333"><b>:color</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">"red"</font> <font color="#006600"><b>}</b></font> <font color="#006600"><b>)</b></font></font></code> <br> </blockquote>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Thus, we create two entries at once: about the Owner and about the car. <br><br>  Consider another example, in more detail: the <strong>Person</strong> model must be related to itself ‚Äî when adding a person, we will make it possible to ‚Äúadd children‚Äù, which also apply to this model. <br><br><h2>  Step 1: We inform the model about the use of nested attributes </h2><br><br>  The first thing to do for an association is to add the line <strong>accepts_nested_attributes_for</strong> <br><br><blockquote> <code><font color="black">lass Person <font color="#006600"><b>&lt;</b></font> <font color="#6666ff"><b>ActiveRecord::Base</b></font> &lt;br/&gt; <font color="#5A0A0A"><b>validates_presence_of</b></font> <font color="#ff3333"><b>:name</b></font> &lt;br/&gt; <font color="#5A0A0A"><b>has_many</b></font> <font color="#ff3333"><b>:children</b></font> , <font color="#ff3333"><b>:class_name</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">'Person'</font> &lt;br/&gt; accepts_nested_attributes_for <font color="#ff3333"><b>:children</b></font> , <font color="#ff3333"><b>:allow_destroy</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#0000FF"><b>true</b></font> &lt;br/&gt; <font color="#008000"><i>#     has_one   </i></font> &lt;br/&gt; <font color="#9966CC"><b>end</b></font></font></code> <br> </blockquote><br><br>  After that, you can directly create, edit and delete child relationships with the object: <br><blockquote> <code><font color="black"><font color="#008000"><i>#     :</i></font> &lt;br/&gt; <font color="#0066ff"><b>@person</b></font> . <font color="#9900CC">children_attributes</font> = <font color="#006600"><b>[</b></font> <font color="#006600"><b>{</b></font> <font color="#ff3333"><b>:name</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">'Son'</font> <font color="#006600"><b>}</b></font> <font color="#006600"><b>]</b></font> &lt;br/&gt; <font color="#0066ff"><b>@person</b></font> . <font color="#9900CC">children</font> <font color="#008000"><i>#=&gt; [ &lt;#Person: name: 'Son'&gt; ]</i></font> &lt;br/&gt; <font color="#0066ff"><b>@person</b></font> . <font color="#9900CC">children</font> . <font color="#9900CC">clear</font> &lt;br/&gt; <font color="#008000"><i>#     :</i></font> &lt;br/&gt; <font color="#0066ff"><b>@person</b></font> . <font color="#9900CC">children_attributes</font> =&lt;br/&gt; <font color="#006600"><b>[</b></font> <font color="#006600"><b>{</b></font> <font color="#ff3333"><b>:name</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">'Son'</font> <font color="#006600"><b>}</b></font> , <font color="#006600"><b>{</b></font> <font color="#ff3333"><b>:name</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">'Daughter'</font> <font color="#006600"><b>}</b></font> <font color="#006600"><b>]</b></font> &lt;br/&gt; <font color="#0066ff"><b>@person</b></font> . <font color="#5A0A0A"><b>save</b></font> &lt;br/&gt; <font color="#0066ff"><b>@person</b></font> . <font color="#9900CC">children</font> <font color="#008000"><i>#=&gt; [ &lt;#Person: name: 'Son'&gt;, &lt;#Person: name: 'Daughter'&gt; ]</i></font> &lt;br/&gt; <font color="#008000"><i>#   (   id == 1)</i></font> &lt;br/&gt; <font color="#0066ff"><b>@person</b></font> . <font color="#9900CC">children_attributes</font> = <font color="#006600"><b>[</b></font> <font color="#006600"><b>{</b></font> <font color="#ff3333"><b>:id</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#006666">1</font> , <font color="#ff3333"><b>:name</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">'Lad'</font> <font color="#006600"><b>}</b></font> <font color="#006600"><b>]</b></font> &lt;br/&gt; <font color="#0066ff"><b>@person</b></font> . <font color="#5A0A0A"><b>save</b></font> &lt;br/&gt; <font color="#008000"><i>#=&gt;    'Lad'</i></font> &lt;br/&gt; <font color="#008000"><i>#    (id == 2)     :</i></font> &lt;br/&gt; <font color="#0066ff"><b>@person</b></font> . <font color="#9900CC">children_attributes</font> =&lt;br/&gt; <font color="#006600"><b>[</b></font> <font color="#006600"><b>{</b></font> <font color="#ff3333"><b>:id</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#006666">2</font> , <font color="#ff3333"><b>:name</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">'Lassie'</font> <font color="#006600"><b>}</b></font> , <font color="#006600"><b>{</b></font> <font color="#ff3333"><b>:name</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">'Pat'</font> <font color="#006600"><b>}</b></font> <font color="#006600"><b>]</b></font> &lt;br/&gt; <font color="#0066ff"><b>@person</b></font> . <font color="#5A0A0A"><b>save</b></font> &lt;br/&gt; <font color="#008000"><i>#=&gt;    'Lassie',    'Pat'</i></font> &lt;br/&gt; <font color="#008000"><i>#  Pat'a (id = 3),    </i></font> &lt;br/&gt; <font color="#0066ff"><b>@person</b></font> . <font color="#9900CC">children_attributes</font> = <font color="#006600"><b>[</b></font> <font color="#ff3333"><b>:id</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#006666">3</font> , <font color="#996600">'_destroy'</font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">'1'</font> <font color="#006600"><b>}</b></font> <font color="#006600"><b>]</b></font> &lt;br/&gt; <font color="#0066ff"><b>@person</b></font> . <font color="#5A0A0A"><b>save</b></font> &lt;br/&gt; <font color="#008000"><i>#=&gt; Pat  </i></font></font></code> <br> </blockquote><br><br>  To support the creation and editing of objects, we should use an array of hashes when associating one-to-many, or just a hash when associating one-to-one.  If the hash parameter <code><font color="black"><font color="#ff3333"><b>:id</b></font></font></code> not set, a new object will be created. <br><br>  To delete an existing linked object, use the following method: <code><font color="black"><font color="#006600"><b>[</b></font> <font color="#006600"><b>{</b></font> <font color="#ff3333"><b>:id</b></font> <font color="#006600"><b>=&gt;</b></font> pk, <font color="#996600">'_destroy'</font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">'1'</font> <font color="#006600"><b>}</b></font> <font color="#006600"><b>]</b></font></font></code> , where the '_destroy' parameter should be any true value.  Do not forget to set the option <code><font color="black"><font color="#ff3333"><b>:allow_destroy</b></font></font></code> in the model, by default it is turned off. <br><br>  In Rails 2.3.5, the function _destroy was renamed - <b>previously it was called _delete</b> .  Do not forget about it if you work with an outdated version. <br><br>  Perhaps all this looks like a small hack, but soon we will see that working with multi-model forms has actually become easier. <br><br><h2>  Step 2. Create a form with a nested model </h2><br><br>  In the view, simply add the fields_for, and in it we write the fields for this model: <br><blockquote> <code><font color="black"><font color="#006600"><b>&lt;%</b></font> <font color="#5A0A0A"><b>form_for</b></font> <font color="#0066ff"><b>@person</b></font> <font color="#9966CC"><b>do</b></font> <font color="#006600"><b>|</b></font> person_form <font color="#006600"><b>|</b></font> <font color="#006600"><b>%&gt;</b></font> &lt;br/&gt; <font color="#006600"><b>&lt;%</b></font> = person_form. <font color="#9900CC">label</font> <font color="#ff3333"><b>:name</b></font> <font color="#006600"><b>%&gt;</b></font> &lt;br/&gt; <font color="#006600"><b>&lt;%</b></font> = person_form. <font color="#9900CC">text_field</font> <font color="#ff3333"><b>:name</b></font> <font color="#006600"><b>%&gt;</b></font> &lt;br/&gt; <font color="#006600"><b>&lt;%</b></font> person_form. <font color="#5A0A0A"><b>fields_for</b></font> <font color="#ff3333"><b>:children</b></font> <font color="#9966CC"><b>do</b></font> <font color="#006600"><b>|</b></font> child_form <font color="#006600"><b>|</b></font> <font color="#006600"><b>%&gt;</b></font> &lt;br/&gt; <font color="#006600"><b>&lt;%</b></font> = child_form. <font color="#9900CC">label</font> <font color="#ff3333"><b>:name</b></font> <font color="#006600"><b>%&gt;</b></font> &lt;br/&gt; <font color="#006600"><b>&lt;%</b></font> = child_form. <font color="#9900CC">text_field</font> <font color="#ff3333"><b>:name</b></font> <font color="#006600"><b>%&gt;</b></font> &lt;br/&gt; <font color="#006600"><b>&lt;%</b></font> <font color="#9966CC"><b>unless</b></font> child_form. <font color="#9900CC">object</font> . <font color="#9900CC">new_record</font> ? <font color="#006600"><b>%&gt;</b></font> &lt;br/&gt; <font color="#006600"><b>&lt;%</b></font> = child_form. <font color="#5A0A0A"><b>check_box</b></font> <font color="#996600">'_destroy'</font> <font color="#006600"><b>%&gt;</b></font> &lt;br/&gt; <font color="#006600"><b>&lt;%</b></font> = child_form. <font color="#9900CC">label</font> <font color="#996600">'_destroy'</font> , <font color="#996600">'Remove'</font> <font color="#006600"><b>%&gt;</b></font> &lt;br/&gt; <font color="#006600"><b>&lt;%</b></font> <font color="#9966CC"><b>end</b></font> <font color="#006600"><b>%&gt;</b></font> &lt;br/&gt; <font color="#006600"><b>&lt;%</b></font> <font color="#9966CC"><b>end</b></font> <font color="#006600"><b>%&gt;</b></font> &lt;br/&gt; <font color="#006600"><b>&lt;%</b></font> = submit_tag <font color="#006600"><b>%&gt;</b></font> &lt;br/&gt; <font color="#006600"><b>&lt;%</b></font> <font color="#9966CC"><b>end</b></font> <font color="#006600"><b>%&gt;</b></font></font></code> <br> </blockquote><br><br>  The code will create a form with all the required fields, which will go to the RESTful controller, and from there, the <strong>children_attributes</strong> parameters will be imperceptibly transferred to the model.  If at creation of ‚Äúchildren‚Äù errors occur, they will be added to <strong><a href="https://habrahabr.ru/users/person/" class="user_link">person</a> .errors</strong> - in this case the object will not be saved in the database. <br><br>  A few helpful notes: <br><ul><li>  When using <strong>fields_for</strong> with a <code><font color="black"><font color="#ff3333"><b>:has_many</b></font></font></code> connection <code><font color="black"><font color="#ff3333"><b>:has_many</b></font></font></code> you can become a victim of recursion by inadvertently adding several nested models to each other, which are associated by associations </li><li>  If you need to change something in a nested model object, you can access it using <strong>child_form.object</strong> .  In the example above, we used <strong>child_form.object.new_record?</strong>  to determine whether to show the tick "Delete" (for new entries it is not needed) <br></li></ul><br><h2>  Step 3. What to register in the controller? .. Nothing </h2><br><br>  The third step, probably the easiest, because we do everything without violating REST.  The beauty of this decision is that our controllers do not clutter up with an extra code that has a place in the model.  Just look at these creation and update methods: <br><br><blockquote> <code><font color="black"><font color="#9966CC"><b>class</b></font> PersonController <font color="#006600"><b>&lt;</b></font> ApplicationController&lt;br/&gt; <font color="#9966CC"><b>def</b></font> create&lt;br/&gt; <font color="#0066ff"><b>@person</b></font> = Person. <font color="#5A0A0A"><b>new</b></font> <font color="#006600"><b>(</b></font> params <font color="#006600"><b>[</b></font> <font color="#ff3333"><b>:person</b></font> <font color="#006600"><b>]</b></font> <font color="#006600"><b>)</b></font> &lt;br/&gt; <font color="#0066ff"><b>@person</b></font> . <font color="#5A0A0A"><b>save</b></font> ? <font color="#5A0A0A"><b>redirect_to</b></font> <font color="#006600"><b>(</b></font> person_path <font color="#006600"><b>(</b></font> @person <font color="#006600"><b>)</b></font> <font color="#006600"><b>)</b></font> : <font color="#5A0A0A"><b>render</b></font> <font color="#006600"><b>(</b></font> <font color="#ff3333"><b>:action</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#ff3333"><b>:new</b></font> <font color="#006600"><b>)</b></font> &lt;br/&gt; <font color="#9966CC"><b>end</b></font> &lt;br/&gt; <font color="#9966CC"><b>def</b></font> <font color="#5A0A0A"><b>update</b></font> &lt;br/&gt; <font color="#0066ff"><b>@person</b></font> = Person. <font color="#9900CC">find</font> <font color="#006600"><b>(</b></font> params <font color="#006600"><b>[</b></font> <font color="#ff3333"><b>:id</b></font> <font color="#006600"><b>]</b></font> <font color="#006600"><b>)</b></font> &lt;br/&gt; <font color="#0066ff"><b>@person</b></font> . <font color="#9900CC">update_attributes</font> <font color="#006600"><b>(</b></font> params <font color="#006600"><b>[</b></font> <font color="#ff3333"><b>:person</b></font> <font color="#006600"><b>]</b></font> <font color="#006600"><b>)</b></font> ?&lt;br/&gt; <font color="#5A0A0A"><b>redirect_to</b></font> <font color="#006600"><b>(</b></font> person_path <font color="#006600"><b>(</b></font> @person <font color="#006600"><b>)</b></font> <font color="#006600"><b>)</b></font> : <font color="#5A0A0A"><b>render</b></font> <font color="#006600"><b>(</b></font> <font color="#ff3333"><b>:action</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#ff3333"><b>:edit</b></font> <font color="#006600"><b>)</b></font> &lt;br/&gt; <font color="#9966CC"><b>end</b></font> &lt;br/&gt; <font color="#9966CC"><b>end</b></font></font></code> <br> </blockquote><br>  As you can see, everything that we have registered in the model and in the form just works, without unnecessary processing in the controller. <br><br><h2>  Additionally </h2><br><h6>  Show all nested fields </h6><br>  Quite often it is required that nested fields be displayed immediately.  For example, if the user wants to create a new person and at the same time add children. <br><br>  Due to the fact that the <strong><a href="https://habrahabr.ru/users/person/" class="user_link">person being</a></strong> created is just created, the child_form fields will not be displayed.  There are two ways to solve this problem: <br>  - Build a new object in the controller: <br><blockquote> <code><font color="black"><font color="#9966CC"><b>def</b></font> <font color="#5A0A0A"><b>new</b></font> &lt;br/&gt; <font color="#0066ff"><b>@person</b></font> = Person. <font color="#5A0A0A"><b>new</b></font> &lt;br/&gt; <font color="#0066ff"><b>@person</b></font> . <font color="#9900CC">children</font> . <font color="#9900CC">build</font> &lt;br/&gt; <font color="#008000"><i># ...</i></font> &lt;br/&gt; <font color="#9966CC"><b>end</b></font></font></code> <br> </blockquote><br>  - You can add a helper, which does almost the same thing, but is located elsewhere: <br><blockquote> <code><font color="black"><font color="#9966CC"><b>module</b></font> ApplicationHelper&lt;br/&gt; <font color="#9966CC"><b>def</b></font> setup_person <font color="#006600"><b>(</b></font> person <font color="#006600"><b>)</b></font> &lt;br/&gt;  returning <font color="#006600"><b>(</b></font> person <font color="#006600"><b>)</b></font> <font color="#9966CC"><b>do</b></font> <font color="#006600"><b>|</b></font> p <font color="#006600"><b>|</b></font> &lt;br/&gt; <font color="#CC0066"><b>p</b></font> . <font color="#9900CC">children</font> . <font color="#9900CC">build</font> <font color="#9966CC"><b>if</b></font> <font color="#CC0066"><b>p</b></font> . <font color="#9900CC">children</font> . <font color="#9900CC">empty</font> ?&lt;br/&gt; <font color="#9966CC"><b>end</b></font> &lt;br/&gt; <font color="#9966CC"><b>end</b></font> &lt;br/&gt; <font color="#9966CC"><b>end</b></font></font></code> <br> </blockquote><br>  After that, you need to change the <strong>form_for <a href="https://habrahabr.ru/users/person/" class="user_link">person</a></strong> to a slightly different one: <br><blockquote> <code><font color="black"><font color="#006600"><b>&lt;%</b></font> <font color="#5A0A0A"><b>form_for</b></font> setup_person <font color="#006600"><b>(</b></font> @person <font color="#006600"><b>)</b></font> <font color="#9966CC"><b>do</b></font> <font color="#006600"><b>|</b></font> person_form <font color="#006600"><b>|</b></font> <font color="#006600"><b>%&gt;</b></font> &lt;br/&gt; &lt;!-- ... --&gt;&lt;br/&gt; <font color="#006600"><b>&lt;%</b></font> <font color="#9966CC"><b>end</b></font> <font color="#006600"><b>%&gt;</b></font></font></code> <br> </blockquote><br>  Which of these methods to use, everyone decides for himself.  Personally, I like the first one better, the second one to the author of the original article. <br><br><h6>  Specify when we need nested models </h6><br>  If you create a form that has nested fields by default (Person ‚Üí children), then sooner or later someone will try to send the form with empty parameters (no children).  You can make the user get an error - if children are required, and come back.  Or just create an object without children. <br><br>  There is an option for this <code><font color="black"><font color="#ff3333"><b>:reject_if</b></font></font></code> : <br><blockquote> <code><font color="black"><font color="#9966CC"><b>class</b></font> Person <font color="#006600"><b>&lt;</b></font> <font color="#6666ff"><b>ActiveRecord::Base</b></font> &lt;br/&gt; <font color="#5A0A0A"><b>validates_presence_of</b></font> <font color="#ff3333"><b>:name</b></font> &lt;br/&gt; <font color="#5A0A0A"><b>has_many</b></font> <font color="#ff3333"><b>:children</b></font> , <font color="#ff3333"><b>:class_name</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">'Person'</font> &lt;br/&gt; <font color="#008000"><i>#   ,      </i></font> &lt;br/&gt; accepts_nested_attributes_for <font color="#ff3333"><b>:children</b></font> ,&lt;br/&gt; <font color="#ff3333"><b>:reject_if</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#CC0066"><b>proc</b></font> <font color="#006600"><b>{</b></font> <font color="#006600"><b>|</b></font> attrs <font color="#006600"><b>|</b></font> attrs. <font color="#9900CC">all</font> ? <font color="#006600"><b>{</b></font> <font color="#006600"><b>|</b></font> k, v <font color="#006600"><b>|</b></font> v. <font color="#9900CC">blank</font> ? <font color="#006600"><b>}</b></font> <font color="#006600"><b>}</b></font> &lt;br/&gt; <font color="#008000"><i>#   ,   </i></font> &lt;br/&gt; accepts_nested_attributes_for <font color="#ff3333"><b>:children</b></font> , <font color="#ff3333"><b>:reject_if</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#ff3333"><b>:all_blank</b></font> &lt;br/&gt; <font color="#9966CC"><b>end</b></font></font></code> <br> </blockquote><br><blockquote> <code><font color="black"><font color="#008000"><i>#      </i></font> &lt;br/&gt; <font color="#0066ff"><b>@person</b></font> . <font color="#9900CC">children_attributes</font> = <font color="#006600"><b>[</b></font> <font color="#006600"><b>{</b></font> <font color="#ff3333"><b>:name</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">''</font> <font color="#006600"><b>}</b></font> <font color="#006600"><b>]</b></font> &lt;br/&gt; <font color="#0066ff"><b>@person</b></font> . <font color="#5A0A0A"><b>save</b></font> &lt;br/&gt; <font color="#0066ff"><b>@person</b></font> . <font color="#9900CC">children</font> . <font color="#5A0A0A"><b>count</b></font> <font color="#008000"><i>#=&gt; 0</i></font></font></code> <br> </blockquote><br>  This option will also be useful if you have boolean fields in the model, and a checkbox on the form.  If you do not mark it and do not write the child‚Äôs name, only the parameter '0' will be transferred to the controller, and <code><font color="black"><font color="#ff3333"><b>:all_blank</b></font></font></code> will not help <br><br><blockquote> <code><font color="black"><font color="#9966CC"><b>class</b></font> Person <font color="#006600"><b>&lt;</b></font> <font color="#6666ff"><b>ActiveRecord::Base</b></font> &lt;br/&gt; <font color="#5A0A0A"><b>validates_presence_of</b></font> <font color="#ff3333"><b>:name</b></font> , <font color="#ff3333"><b>:bad</b></font> &lt;br/&gt; <font color="#5A0A0A"><b>has_many</b></font> <font color="#ff3333"><b>:children</b></font> , <font color="#ff3333"><b>:class_name</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">'Person'</font> &lt;br/&gt; <font color="#008000"><i>#    ,    ,     </i></font> &lt;br/&gt; accepts_nested_attributes_for <font color="#ff3333"><b>:children</b></font> ,&lt;br/&gt; <font color="#ff3333"><b>:reject_if</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#CC0066"><b>proc</b></font> <font color="#006600"><b>{</b></font> <font color="#006600"><b>|</b></font> attrs <font color="#006600"><b>|</b></font> attrs <font color="#006600"><b>[</b></font> <font color="#996600">'bad'</font> <font color="#006600"><b>]</b></font> == <font color="#996600">'0'</font> <font color="#006600"><b>&amp;&amp;</b></font> attrs <font color="#006600"><b>[</b></font> <font color="#996600">'name'</font> <font color="#006600"><b>]</b></font> . <font color="#9900CC">blank</font> ? <font color="#006600"><b>}</b></font> &lt;br/&gt; &lt;br/&gt; <font color="#008000"><i>#    :reject_if =&gt; proc { |attrs| attrs['name'].blank? }</i></font> &lt;br/&gt; <font color="#008000"><i>#      ,   (. .)</i></font> &lt;br/&gt; <font color="#9966CC"><b>end</b></font></font></code> </blockquote> <br><blockquote> <code><font color="black"><font color="#0066ff"><b>@person</b></font> . <font color="#9900CC">children_attributes</font> = <font color="#006600"><b>[</b></font> <font color="#006600"><b>{</b></font> <font color="#ff3333"><b>:name</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">''</font> , <font color="#ff3333"><b>:bad</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">'0'</font> <font color="#006600"><b>}</b></font> <font color="#006600"><b>]</b></font> &lt;br/&gt; <font color="#0066ff"><b>@person</b></font> . <font color="#5A0A0A"><b>save</b></font> &lt;br/&gt; <font color="#0066ff"><b>@person</b></font> . <font color="#9900CC">children</font> . <font color="#5A0A0A"><b>count</b></font> <font color="#008000"><i>#=&gt; 0</i></font></font></code> </blockquote> <br><h2>  Dynamically loaded fields </h2><br>  If you build a complex form, in which there are a large number of models, and even nested in several levels, then you can simply make several nested forms visible by default.  Although not entirely rational.  A more attractive option is to dynamically add new fields using JavaScript at the user's request. <br><br>  A great example application can be <a href="http://github.com/alloy/complex-form-examples">viewed on GitHub</a> , sponsored by Eloy.  Looking at it, you will understand how the whole system of models and connections between them work. </div><p>Source: <a href="https://habr.com/ru/post/79595/">https://habr.com/ru/post/79595/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../79586/index.html">Coffeescript - Javascript Powered by Ruby</a></li>
<li><a href="../79587/index.html">About Nokia N900: Contacts, rsync and flashlight</a></li>
<li><a href="../79588/index.html">Extension to highlight code</a></li>
<li><a href="../79589/index.html">Microsoft's fight against piracy in China</a></li>
<li><a href="../79592/index.html">Windows 7 and automounting with Ext2IFS</a></li>
<li><a href="../79596/index.html">tUM'09: Russians are coming!</a></li>
<li><a href="../79597/index.html">No zest something in my open source ...</a></li>
<li><a href="../79599/index.html">For the first time in Russia - competition Imagine Cup Embedded Development</a></li>
<li><a href="../79600/index.html">ASP.NET Webcasts</a></li>
<li><a href="../79605/index.html">Combining data from the archive of meteorologists with UN data</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>