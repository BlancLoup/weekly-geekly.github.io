<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How DNSCrypt solved the problem of expired certificates by entering a validity period of 24 hours</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Previously, certificates often expired due to the fact that they needed to be updated manually. People just forgot to do it. With the advent of Let's ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How DNSCrypt solved the problem of expired certificates by entering a validity period of 24 hours</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/3e/zu/06/3ezu06vvjqxtd_brkvpowv0rfha.jpeg"><br><br>  Previously, certificates often expired due to the fact that they needed to be updated manually.  People just forgot to do it.  With the advent of Let's Encrypt and the automatic update procedure, the problem seems to be solved.  But recent <a href="https://habr.com/ru/post/450478/">Firefox history</a> shows that it‚Äôs still relevant.  Unfortunately, certificates continue to expire. <br><br>  If someone missed this story, at midnight on May 4, 2019, almost all Firefox extensions suddenly stopped working. <br><a name="habracut"></a><br>  As it turned out, a massive failure occurred due to the fact that Mozilla has <a href="https://bugzilla.mozilla.org/show_bug.cgi%3Fid%3D1548973">expired certificate</a> that was used to sign extensions.  Therefore, they were marked as "invalid" and did not pass the test ( <a href="https://habr.com/ru/post/451220/">technical details</a> ).  On the forums, it was recommended that you disable the verification of the signatures of extensions in <i>about: config</i> or by transferring the system clock as a workaround. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Mozilla promptly released the patch Firefox 66.0.4, which solves the problem with an invalid certificate, and all the extensions return to their normal form.  The developers recommend installing it and <a href="https://blog.mozilla.org/addons/2019/05/04/update-regarding-add-ons-in-firefox/">not using</a> any workarounds to bypass signature verification, because they may conflict with the patch. <br><br>  Nevertheless, this story once again shows that the expiration of certificates remains an actual problem today. <br><br>  In this regard, it is interesting to look at a rather original way of how the developers of the <a href="https://dnscrypt.info/">DNSCrypt</a> protocol coped with this task.  Their solution can be divided into two parts.  Firstly, these are short-term certificates.  Secondly, warning users about the expiration of the long-term. <br><br><h1>  DNSCrypt </h1><br><img src="https://habrastorage.org/webt/8h/s9/gh/8hs9ghvpin-ertiayryvn9qve70.png" align="left">  DNSCrypt is a DNS traffic encryption protocol.  It protects DNS communications from interceptions and MiTM, and also allows you to bypass blocking at the level of DNS queries. <br><br>  The protocol wraps the DNS traffic between the client and the server into a cryptographic structure, working over UDP and TCP transport protocols.  To use it, both the client and the DNS resolver must support DNSCrypt.  For example, since March 2016, it has been enabled on its DNS servers and in the Yandex browser.  Support was also announced by several other providers, including Google and Cloudflare.  Unfortunately, there are not so many of them (152 public DNS servers are listed on the official website).  But the <a href="https://github.com/jedisct1/dnscrypt-proxy">dnscrypt-proxy</a> program can be installed manually on clients running Linux, Windows and MacOS.  There are <a href="https://dnscrypt.info/implementations">server implementations</a> . <br><br><img src="https://habrastorage.org/webt/e0/_d/tk/e0_dtkyjhanez_16etloysmxhy8.png"><br><br>  How does DNSCrypt work?  In short, the client takes the public key of the selected provider and uses it to verify its certificates.  Already there are short-term public keys for the session and an identifier for the cipher suite.  Customers are recommended to generate a new key for each request, and servers - to change the keys <b>every 24 hours</b> .  When exchanging keys, the X25519 algorithm is used, EdDSA is used for signing, and XSalsa20-Poly1305 or XChaCha20-Poly1305 is used for block encryption. <br><br>  One of the developers of the protocol, Frank Denis, <a href="https://00f.net/2019/05/04/fixing-expired-certificates/">writes</a> that an automatic replacement every 24 hours solved the problem of expired certificates.  In principle, the dnscrypt-proxy reference client accepts certificates with any expiration date, but issues a warning ‚ÄúThe dnscrypt-proxy key period for this server is too long‚Äù if it is valid for more than 24 hours.  At the same time, the Docker image was released, which implemented a quick change of keys (and certificates). <br><br>  First, it is extremely useful for security: if the server is compromised or the key is leaked, then yesterday's traffic cannot be decrypted.  The key has already changed.  Probably, this will be a problem for the execution of the ‚ÄúLaw of Spring‚Äù, which forces providers to keep all traffic, including encrypted traffic.  It is understood that later it will be possible to decrypt it if necessary, by requesting the key from the site.  But in this case, the site simply can not provide it, because it uses short-term keys, deleting old ones. <br><br>  But most importantly, Denis writes, short-term keys force servers to configure automation from day one.  If the server connects to the network, and the key exchange scripts are not configured or do not work, it will be immediately detected. <br><br>  When automation changes keys every few years, you cannot rely on it, and people can forget about the expiration of the certificate.  With a daily change of keys, it will be detected instantly. <br><br>  At the same time, if the automation is set up normally, then it does not matter how often the keys are changed: every year, every quarter or three times a day.  If everything works for more than 24 hours, it will work forever, writes Frank Denis.  According to him, recommending daily key changes in the second version of the protocol, along with a ready-made Docker method that implements this, effectively reduced the number of servers with expired certificates, while at the same time improving security. <br><br>  However, some providers still decided for some technical reasons to establish the certificate validity period of more than 24 hours.  This problem was mostly solved with a few lines of code in dnscrypt-proxy: users receive an informational warning 30 days before the certificate expires, another message with a higher severity level 7 days before the expiration date and a critical message if the certificate has less than 24 hours.  This only applies to certificates that are initially long lasting. <br><br>  Such messages provide users with the opportunity to inform DNS operators about the upcoming certificate expiration, before it is too late. <br><br>  Perhaps, if all Firefox users received such a message, then someone would probably tell the developers and they would not allow the certificate to expire.  ‚ÄúI don‚Äôt remember a single DNSCrypt server from the list of publicly available DNS servers that have expired in the last two or three years,‚Äù writes Frank Denis.  In any case, it is probably better to warn users first, and not to disable extensions without warning. <br><br><hr><br> <a href="https://clck.ru/FiAb5"><img src="https://habrastorage.org/webt/jw/ex/jb/jwexjbpgonbyh_esgg71ncrp-dw.png"><br></a> </div><p>Source: <a href="https://habr.com/ru/post/451506/">https://habr.com/ru/post/451506/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451492/index.html">Seven Unexpected Bash Variables</a></li>
<li><a href="../451498/index.html">Product Design Digest April 2019</a></li>
<li><a href="../4515/index.html">Opinions of bloggers will be announced in ‚ÄúVesti.net‚Äù on TV</a></li>
<li><a href="../451502/index.html">Digital events in Moscow from May 13 to 19</a></li>
<li><a href="../451504/index.html">Pictures on the web 2019</a></li>
<li><a href="../451508/index.html">A Guide for Dummies: Creating DevOps Chains with Open Source Tools</a></li>
<li><a href="../451510/index.html">Some technical lyrics about C ++ Tools from JetBrains, and what's the point about unicorns</a></li>
<li><a href="../451512/index.html">How to disassemble the network protocol mobile MMORPG</a></li>
<li><a href="../451516/index.html">Design Patterns Used in the Spring Framework</a></li>
<li><a href="../451518/index.html">Our reduced mobile websites</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>