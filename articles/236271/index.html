<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>FlexiCapture. Is it as flexible as it is called?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Experience shows that the FlexiCapture product is known to ordinary users outside the company very little (‚ÄúIs this the Unified State Examination?‚Äù), ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>FlexiCapture. Is it as flexible as it is called?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/07b/e96/f0c/07be96f0c49749b68907527afa581856.jpg" align="right">  Experience shows that the FlexiCapture product is known to ordinary users outside the company very little (‚ÄúIs this the Unified State Examination?‚Äù), Despite the fact that it is used in many large organizations.  You can put up with it, considering that the product is not for the end user, but corporate.  And you can periodically talk about it all that will not only be useful to those who are already familiar with it, but also hints to people far from the product that Flex is not just 4 letters in the name. <br><br>  Our partners from the Novosibirsk company <a href="http://www.atapy.ru/">ATAPI Software</a> shared their techniques for handling various complex cases.  This is a set of specific practical advice that we hope will be useful to you.  In addition, each of these stories is similar to a Zen koan ‚Äî it helps to reveal the true nature of FlexiCapture in all its diversity. <br><a name="habracut"></a><br><h4>  When processing custom tables, be as serene as a lotus flower </h4><br>  The main purpose of ABBYY FlexiCapture is to extract certain data from documents and enter them into the information system.  In Russia, most of the documents are unified, so usually it does not cause difficulties.  Unfortunately, this cannot be said about foreign documents ‚Äî say, European invoices ‚Äî and some Russian forms are ‚Äúannealed‚Äù as well as their foreign counterparts.  Often there are cases when the necessary information in the tables is not clearly defined, for example, like this: <br><br><img src="https://habrastorage.org/files/8eb/690/51b/8eb69051b04c443eb4665c8a7e46463d.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here in the table there are two lines with the description of commodity items.  If the automatic method is used to recognize such a document, the item number (the leftmost field) will fall into a separate column and will be recognized correctly, but the quantity and article fields (the third column) will fall into the same column, although in our table these are different fields.  In addition, a lot of unnecessary textual information can get into the columns - this will create problems during verification. <br><br>  You can divide the desired data into separate fields using the functionality of the repeating group.  In Flexilayout Studio we create an element of the type ‚Äúrepeating group‚Äù (Repeating Group).  Each instance of the group will correspond to the row of the table, within the region of which the search is already organized using simple elements (such as Static Text, Character String, Region, etc.).  In turn, the area of ‚Äã‚Äãeach line can also be allocated with the help of a repeating group that precedes the search for information directly. <br><br>  This is perhaps the best solution for such cases.  However, we must not forget that in addition to the actual recognition, we need to bring the data from this not quite standard table to the usual tabular form: <br><br><img src="https://habrastorage.org/files/893/fe2/03a/893fe203a6704a709ae9653afd4ca250.png"><br><br>  Why do you need it?  Verification operators are easier to process data when they are presented in a table.  In addition, it often happens that standard and non-standard tables are sent for verification one after another, and if you make a separate template for each case, it will be difficult for the operator to switch from one way of presenting data to another - therefore he will inevitably start making mistakes. <br><br>  And one moment.  The following example shows that it is not very convenient to represent complex non-standard tables in the form of a repeating group in an interface ‚Äî such a representation takes up a lot of space. <br><br><img src="https://habrastorage.org/files/ef3/49e/0f0/ef349e0f0a764c5a84a73e8dcebf3ef2.png"><img src="https://habrastorage.org/files/3ed/473/892/3ed4738924a14972872dc0bff58f44d3.png"><br><br>  Compare this with the representation of similar data in a table: <br><br><img src="https://habrastorage.org/files/6db/bb1/fd7/6dbbb1fd788c4ea3b15de5c8765286b8.png"><br><br>  As we see, in this form (as a table), data takes up much less space, and the operator has the opportunity to check documents faster - without wasting time scrolling. <br><br>  To speed up the verification process and make it uniform, we use the following approach: <br><br><ul><li>  At the level of flexible description, we search for the necessary data using a repeating group, thus finding the regions of individual rows.  Then, within the region of each line, we extract the required fields. </li><li>  Next, create a dummy table with the same number of rows as in the repeating group.  A dummy table is a table that is superimposed in an arbitrary region, that is, it is present on the data form, but not tied to a specific document image. </li><li>  In the FlexiCapture project, in the document definition settings, we write a simple script rule ‚Äî it will copy the values ‚Äã‚Äãfrom the fields that the system finds in the repeating group into the corresponding columns of the table. </li><li>  The fields themselves on the data form can be hidden, since all information will now be stored and displayed in a table. </li></ul><br><br><h4>  Avoid grazing the tiger by improving tabular data recognition. </h4><br>  When working with tables, a developer's karma is a large number of different text "garbage" in data cells.  For example, we need to extract the numerical value <b>of the OKVED code</b> and the <b>date of entering the information in the Unified State Register</b> of <b>Legal Entities</b> from the following table: <br><br><img src="https://habrastorage.org/files/c82/9bf/938/c829bf93887d4ea796ff045754c991a0.png"><br><br>  If you make a simple table, then a textual description of the type of activity (‚ÄúRenting your own real estate‚Äù) will fall into the code cell, which will need to be deleted either by the developer using a script or manually by the operator each time.  In addition, blots, notes, stamps, signatures, etc. may also fall into the region of the table. <br><br>  To prevent such extra information from interfering with recognition, we can filter these objects at the level of a flexible description ‚Äî set the rules by which the system will automatically find them and ignore them during recognition.  In the case of our example, it will suffice to configure the ‚Äúignore‚Äù of all text objects with Russian letters and brackets. <br><br><img src="https://habrastorage.org/files/8e9/fcf/613/8e9fcf613ddd42319538a3a8753c9df7.png"><br><br>  As you can see in the figure below, in FlexiCapture 10 this field will be excluded from the recognition area (rectangles with gray hatching). <br><br><img src="https://habrastorage.org/files/729/923/111/729923111d094be09996cd6a02e832e0.png"><br><br>  Or you can go from the opposite - first, using the repeating group, find only the data we need (numeric codes), and then exclude all text or other image objects from the ‚ÄúOKVED code‚Äù column that are distinct from the code itself from recognition. <br>  Examples of such approaches are presented in the picture below: on the left we excluded the fixed text of the MACHINE REAMER 600 by the first method, and on the right - all but the numbers by the second method: <br><br><img src="https://habrastorage.org/files/3e6/d78/2b7/3e6d782b76874499b7a90f85acc69513.png"><img src="https://habrastorage.org/files/b6f/fc9/866/b6ffc9866c6a40a5a018bda7240162dd.png"><br><br><h4>  Set up a variation field recognition - let the mirror of the mind separate the beautiful from the not so </h4><br>  It so happens that the format of the same field is very different in the same type of documents.  For example, in foreign invoices can be found as ordinary black text on a white background, and white text on a black background.  We can see a similar situation in the forms of various questionnaires, questionnaires, etc. <br><br><img src="https://habrastorage.org/files/748/9ef/e18/7489efe180d8472bba7afab740bb5c2c.png"><img src="https://habrastorage.org/files/32d/f33/e18/32df33e189c14adea2e9344537f8f151.png"><br><br>  But it also happens that the template is one, but in reality the documents are mixed up for recognition - in some the data is imprinted on the printer, and in others written by a person in the so-called handwritten way. <br><br><img src="https://habrastorage.org/files/5c0/ee9/a2a/5c0ee9a2a4db43839e4490055ea4f747.png"><img src="https://habrastorage.org/files/ee7/00c/56e/ee700c56e56d4746b26ccde214ea1976.png"><br><br>  Not less incidents causes a different data format in the same fields.  If one document contains the date in the format February 23, 2006, and the other - on 24/11/08, the person will understand, and it is advisable for the program to specify different settings for this field. <br><br><img src="https://habrastorage.org/files/b7a/42c/32d/b7a42c32d2ba44eb95eea4d35ebeb8e4.png"><img src="https://habrastorage.org/files/ca6/949/5e0/ca69495e0fa846a99b5391df17ea2de6.png"><br><br>  All of these cases can cause problems with recognition.  ABBYY FlexiCapture allows you to create two separate fields and set them to different recognition settings: inverted or plain text, typed or handwritten, recognition in the common frame or drawing a separate frame for each character.  Then, when processing each document, the operator manually selects the correct option for the field. <br><br>  But you can still slightly improve the recognition process.  The first option is to process documents in different types of packages.  But this is also quite inconvenient, since it is necessary to separate documents at the scanning stage, and the operators may eventually get confused about where to send which document.  Why load the operator with extra work, when the program can cope with this task? <br><br>  We used the following algorithm.  In the place where we should have the desired text, we create three fields: <br><ul><li>  the first is a hidden field from the user that recognizes plain text, </li><li>  the second is also a hidden field that recognizes the text as inverted, </li><li>  the third is the field visible to the user, in which the operator is submitted for verification to one of the recognition results that the system evaluates to be the best. </li></ul><br><br><img src="https://habrastorage.org/files/e2a/a75/4f5/e2aa754f5329439fbfa39081186f839b.png"><br><br>  The system can choose the best result, for example, based on the number of so-called ‚Äúsuspicious characters‚Äù (Suspicious Symbols) - to do this, create a script rule that passes the field value with the least number of ‚Äúsuspicious characters‚Äù as a result of recognition. <br><br>  A similar approach with three fields and the choice of the best recognition option can be used for cases of different markup or typed / handwritten text in one field. <br><br><h4>  How to return everything to a single: the allocation of the fractional part of numbers </h4><br>  It would seem, what problem can be with fractions?  The same numbers and commas.  But sometimes fractional separators are not recognized or disappear during scanning, which can lead to unpleasant consequences.  For example, the total amount in a paper invoice is one, and in the electronic one another (in it there appear a couple of extra zeros).  This happens, for example, when processing documents sent by fax, recognizing old documents or from documents with poor print quality. <br><br><img src="https://habrastorage.org/files/9ce/4a4/a13/9ce4a4a1304c40c0bd0afec0174fa93b.png"><img src="https://habrastorage.org/files/a00/f7a/4e2/a00f7a4e25994bb886eb50c53b1c95f2.png"><br><br>  FlexiCapture is not very difficult to solve this problem. <br><br>  Usually the number of digits in the fractional part varies from 0 to 2. To understand whether there is a separator in the recognized text, we need: <br><ul><li>  Calculate the distance between the last and last but one characters in a string.  To do this, from the x coordinates of the right border of the penultimate character subtract the x coordinate of the left border of the last symbol.  It will be S <sub>1</sub> <img src="https://habrastorage.org/files/b2d/191/e8e/b2d191e8e5ee48eb992d4e5acb4bbbf9.PNG"></li><li>  If the number of characters in a string is two: compare S <sub>1</sub> with a certain coefficient, if S <sub>1 is</sub> greater than this value, then you need to add a separator. </li><li>  If the number of characters in a line is more than two, then it is necessary to calculate the distance S <sub>2</sub> between 2 and 3 characters from the end of the line. </li><li>  Calculate ratios S <sub>1</sub> / S <sub>2</sub> and S <sub>2</sub> / S <sub>1</sub> </li></ul><br>  If one of the relations is greater than the coefficient, for example, 1.5, then insert a separator between the corresponding characters. <br>  This solution was applied in one of our projects in Australia.  Below is an example of the original image and the recognition results - with our "improved" and without it. <br><br><img src="https://habrastorage.org/files/f87/3ce/bcd/f873cebcdb8b487fa4b2669029b843c5.PNG"><br><br>  In the invoice, by the way, the recognition result is quite easy to check by checksum.  If in the recognized document the value of the field "Total" converges with the sum of the table - it means that you can verify the recognition result without operator participation.  Comparison of the amount with figures in the amount in words, if there is one in the document, can also help. <br><br>  To automate the selection of coefficients, it is possible to analyze the average distance between characters in a line, the relationship between height and width of characters, etc., but as a rule, it is easier to choose coefficients experimentally, or by using the ‚Äúspear‚Äù method.  The time you spend on selecting these coefficients is calculated in minutes - while the verification operator can save this time of working hours. <br><br><h4>  Under the gaze of the Buddha and flowers bloom on the iron tree.  What if you need a full text document layer </h4><br>  We already wrote, ABBYY FlexiCapture is needed to extract and save specific data from the fields: numbers, counterparties, etc., the full text of the document, as a rule, does not interest anyone.  But it also happens that it is necessary in one stream to extract data from the fields for some documents and recognize the text entirely for others. <br><br>  The ability to extract the entire text of a document as a text file may be needed, for example, to index the contents of a document in various search engines, both for general use and for internal companies. <br><br>  Such a need has arisen at the Novosibirsk City Hall, which processed the documents of the authorities - orders, decrees and orders.  They needed not only the fields from the ‚Äúheader‚Äù of the document by which the document was indexed in the archive, but also the results of full-text recognition, so that they could then find the document by keyword from the main part. <br><br>  FlexiCapture has long been able to customize the export of recognized documents to PDF with a text layer.  But the reality is that many external information systems are not able to search for PDF documents.  Moreover, as regards the Novosibirsk archive, which has been storing data since the beginning of the 1920s, many of the original paper sources that we saw were rather shabby, faded pages typed on a typewriter.  It can be expected that the results of automatic recognition for such files may not be very high quality.  At the same time, it is the text content of such an archival document, and not its cap, that can be very important.  Therefore, it would be good to have the opportunity in FlexiCapture at the stage of checking important data (in our case, it was the order number, date, etc.) and also check the results of full-text recognition. <br><br>  The solution was found.  In FlexiLayout Studio (we <a href="http://habrahabr.ru/company/abbyy/blog/125851/">have already</a> <a href="http://habrahabr.ru/company/abbyy/blog/130459/">written</a> about this tool for creating flexible descriptions) you can create a flexible description of a document, which will allow, in addition to meaningful structured data, to extract the entire text layer of the document.  This is done very simply - for example, using a repeating group that contains all the lines of a document. <br><br>  If necessary, this text layer can even be checked at the FlexiCapture verification station.  Also, the text can be copied, indexed and exported to text formats.  In the final PDF-document, we get a higher-quality result of recognition of the text layer, since this result will be verified by the operator. <br><br>  Below is a screenshot from the ABBYY FlexiCapture verification page.  As we see, now you can work not only with fields, but with all the text in the document. <br><img src="https://habrastorage.org/files/aa8/fb1/867/aa8fb186762640be96fd3f3c1876fc6b.png"><br><br><h4>  Thank you for your <s>patience</s> , there are only 3 sentences left. </h4><br>  We have brought several engineering lifehacks that we hope will help you in working with our product. <br>  If you have something to add - you have solved some other non-standard problem with FlexiCapture - we will be glad to read about it in the comments. <br><br>  <i>Tatyana Ganzhina, ABBYY Russia</i> <i><br></i>  <i>with the active support of the specialists of ATAPI Software.</i> </div><p>Source: <a href="https://habr.com/ru/post/236271/">https://habr.com/ru/post/236271/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../236253/index.html">I am groot. We do our analytics on events</a></li>
<li><a href="../236255/index.html">Increasing online store sales: 5 steps to create the perfect email newsletter</a></li>
<li><a href="../236263/index.html">The effect of a faulty monitor for text, images and SVG</a></li>
<li><a href="../236265/index.html">"VALS Semester of Code" after "Google Summer of Code", or "Do you have a opensource project? ‚ÄúFree developers are coming to you!‚Äù</a></li>
<li><a href="../236267/index.html">The presentation of the BlackBerry Passport is scheduled for September 24, 2014.</a></li>
<li><a href="../236273/index.html">10 new electronics with # IFA2014 (without smartphones and tablets)</a></li>
<li><a href="../236277/index.html">Apple Watch: what's been waiting for</a></li>
<li><a href="../236279/index.html">Laser in section. How I searched for potassium titanyl phosphate and barium beta-borate among aluminum sawdust</a></li>
<li><a href="../236281/index.html">Do we live inside a computer model?</a></li>
<li><a href="../236283/index.html">And now gmail.com: a database of 5,000,000 addresses has been posted online</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>