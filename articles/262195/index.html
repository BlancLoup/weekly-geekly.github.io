<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Multiboot in wysiwyg editor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The essence of this is that there is an editor (for example: imperavi.com/redactor ) and there is a need to upload many pictures at once. Ideally, a s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Multiboot in wysiwyg editor</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/e96/7b3/fee/e967b3fee644459e8821ed5d86d3ffcf.jpg"><br><br>  The essence of this is that there is an editor (for example: <a href="http://imperavi.com/redactor">imperavi.com/redactor</a> ) and there is a need to upload many pictures at once.  Ideally, a simple drag and drop, but in our case, the editor eats only one picture at a time.  It needs to be corrected. <br><br>  Rummaging through the api editor and not finding anything about multiboot, I began to think how to solve this problem without resorting to some kind of global development, like writing a plugin from scratch.  It will take a lot of time and effort, besides it is pressing up and you need to do it until the evening. <br><a name="habracut"></a><br>  Then we do it differently, remembering the already ready plugin <a href="https://github.com/LPology/Simple-Ajax-Uploader">github.com/LPology/Simple-Ajax-Uploader</a> for multi-loading with the thought that we give the pictures to the multi-loader and then write them to the editor.  No sooner said than done. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We include all the necessary files and initialize the editor. <br><br><pre><code class="javascript hljs">$(<span class="hljs-string"><span class="hljs-string">'.text'</span></span>).redactor();</code> </pre> <br>  We also initialize the Simple Ajax Uploader. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ss.SimpleUpload({ <span class="hljs-attr"><span class="hljs-attr">dropzone</span></span>: <span class="hljs-string"><span class="hljs-string">'dragbox'</span></span>, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'upload/path'</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'file'</span></span>, <span class="hljs-attr"><span class="hljs-attr">multiple</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">responseType</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">onComplete</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filename, response</span></span></span><span class="hljs-function">) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'.redactor-editor'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;p&gt;&lt;img src="'</span></span>+ filename +<span class="hljs-string"><span class="hljs-string">'" /&gt;&lt;/p&gt;'</span></span>); } });</code> </pre><br>  So, what we want, we specified the class for the drop zone ( <i>dropzone: 'dragbox'</i> ) and, of course, designated this place in our html code. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dragbox"</span></span></span><span class="hljs-tag">&gt;</span></span>   + (  ) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Here we will throw photos by dragging.  After that, we wrote to the callback function, that when the download is complete, we want to insert the image at the end of the editor. <br><br><pre> <code class="javascript hljs">onComplete: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filename, response</span></span></span><span class="hljs-function">) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'.redactor-editor'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;p&gt;&lt;img src="'</span></span>+ filename +<span class="hljs-string"><span class="hljs-string">'" /&gt;&lt;/p&gt;'</span></span>); }</code> </pre><br>  On the server we take their ready library and we connect (an example from the documentation). <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-string"><span class="hljs-string">'Uploader.php'</span></span>); $upload_dir = <span class="hljs-string"><span class="hljs-string">'/img_uploads/'</span></span>; $valid_extensions = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'gif'</span></span>, <span class="hljs-string"><span class="hljs-string">'png'</span></span>, <span class="hljs-string"><span class="hljs-string">'jpeg'</span></span>, <span class="hljs-string"><span class="hljs-string">'jpg'</span></span>); $Upload = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileUpload(<span class="hljs-string"><span class="hljs-string">'file'</span></span>); $result = $Upload-&gt;handleUpload($upload_dir, $valid_extensions); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$result) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'success'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-string"><span class="hljs-string">'msg'</span></span> =&gt; $Upload-&gt;getErrorMsg())); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'success'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'file'</span></span> =&gt; $Upload-&gt;getFileName())); }</code> </pre><br>  Images are regularly uploaded to the server and the paths come back, but there was a problem with the editor, it does not accept our html code, constantly clearing it.  In addition, in this way we can not control the place of loading images. <br><br>  Again, go back to the api editor and look for how you can directly influence its contents through api.  It turns out we can, because  find the method we need <a href="http://imperavi.com/redactor/docs/api/insert/">imperavi.com/redactor/docs/api/insert</a> .  Rewrite the callback code to insert images. <br><br>  First of all, we need to provide an internal link to the editor in order to have access to its api.  To do this, we declare a variable in the field of view of both of them. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> redactor;</code> </pre><br>  After that, we place an internal link to the editor in this variable using the callback that is executed when the editor is initialized. <br><br><pre> <code class="javascript hljs">$(<span class="hljs-string"><span class="hljs-string">'.text'</span></span>).redactor({ <span class="hljs-attr"><span class="hljs-attr">initCallback</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ redactor = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } });</code> </pre><br>  Ultimately, using the insert method now available to us, we insert the images into the editor. <br><br><pre> <code class="javascript hljs">onComplete: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filename, response</span></span></span><span class="hljs-function">) </span></span>{ redactor.insert.html(<span class="hljs-string"><span class="hljs-string">'&lt;p&gt;&lt;img src="'</span></span>+response.path+<span class="hljs-string"><span class="hljs-string">'" /&gt;&lt;/p&gt;'</span></span>); }</code> </pre><br>  According to the results, we drag the images into the dragbox field, after which the server processes and returns the path that is successfully inserted into the editor when the download of each image is finished. <br><br><div class="spoiler">  <b class="spoiler_title">Together</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> redactor; $(<span class="hljs-string"><span class="hljs-string">'.text'</span></span>).redactor({ <span class="hljs-attr"><span class="hljs-attr">initCallback</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ redactor = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } }); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ss.SimpleUpload({ <span class="hljs-attr"><span class="hljs-attr">dropzone</span></span>: <span class="hljs-string"><span class="hljs-string">'dragbox'</span></span>, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'upload/path'</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'file'</span></span>, <span class="hljs-attr"><span class="hljs-attr">multiple</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">responseType</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">onComplete</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filename, response</span></span></span><span class="hljs-function">) </span></span>{ redactor.insert.html(<span class="hljs-string"><span class="hljs-string">'&lt;p&gt;&lt;img src="'</span></span>+response.path+<span class="hljs-string"><span class="hljs-string">'" /&gt;&lt;/p&gt;'</span></span>); } });</code> </pre><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/262195/">https://habr.com/ru/post/262195/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262183/index.html">React on ES6 +</a></li>
<li><a href="../262185/index.html">The history of routing in the project MAPS.ME</a></li>
<li><a href="../262187/index.html">Creating a new field type for MS SharePoint using the example of a simple check field</a></li>
<li><a href="../262189/index.html">Malevich</a></li>
<li><a href="../262191/index.html">Teach Hyper-V Server with Veeam B & R to backup yourself</a></li>
<li><a href="../262207/index.html">Telnet and echo - who is right, who is wrong</a></li>
<li><a href="../262211/index.html">Deploying Qt Applications on Windows</a></li>
<li><a href="../262213/index.html">Analysis of tonality in social media in Russian using the RussianSentimentAnalyzer API</a></li>
<li><a href="../262221/index.html">Customize the build of a Flex 4.14 project using flexmojos 7. *</a></li>
<li><a href="../262225/index.html">Using Lisp in Production</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>