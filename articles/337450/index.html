<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CSS immersion: font metrics, line-height and vertical-align</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="line-height and vertical-align are simple CSS properties. So simple that most of us are sure that they understand how they work and how to use them. U...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CSS immersion: font metrics, line-height and vertical-align</h1><div class="post__text post__text-html js-mediator-article"><a href="https://habrahabr.ru/company/pt/blog/337450/"><img src="https://habrastorage.org/getpro/habr/post_images/cc5/6c7/186/cc56c718642f701c3f8739ee7a4453cf.png" alt="image"></a> <br><br>  <code>line-height</code> and <code>vertical-align</code> are simple CSS properties.  So simple that most of us are sure that they understand how they work and how to use them.  Unfortunately, this is not true - in fact, they are probably the most complex properties, since they play an important role in creating a little-known CSS feature called the inline formatting context. <br><br>  For example, <code>line-height</code> can be specified as a length or a dimensionless value, but its default value is <code>normal</code> (standard).  Good, but what does ‚Äústandard‚Äù mean?  Often they write that it is (usually) 1, or maybe 1.2.  Even <a href="https://www.w3.org/TR/CSS2/visudet.html">in the CSS specification there is no clear answer to this question</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We know that the dimensionless line-height value depends on the <code>font-size</code> value, but the problem is that the <code>font-size: 100px</code> looks different for different typefaces.  In this regard, the question arises: will the <code>line-height</code> always be the same or may it differ?  Is this value between 1 and 1.2?  How does <code>vertical-align</code> affect <code>line-height</code> ? <br><br>  Let's delve into not the easiest CSS mechanism ... <a name="habracut"></a><br><br><h2>  Let's start by talking about font-size </h2><br>  Consider this simple HTML code with a <code>p</code> tag containing three <code>span</code> elements, each with its own <code>font-family</code> : <br><br><pre> <code class="css hljs">&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">p</span></span>&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">class</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span>"&gt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">Ba</span></span>&lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span>&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">class</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">b</span></span>"&gt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">Ba</span></span>&lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span>&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">class</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">c</span></span>"&gt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">Ba</span></span>&lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span>&gt; &lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">p</span></span>&gt;</code> </pre> <br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">p</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">100px</span></span> } <span class="hljs-selector-class"><span class="hljs-selector-class">.a</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: Helvetica } <span class="hljs-selector-class"><span class="hljs-selector-class">.b</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: Gruppo } <span class="hljs-selector-class"><span class="hljs-selector-class">.c</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: Catamaran }</code> </pre> <br>  When using the same <code>font-size</code> in different headsets, the height is different: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ff6/963/9ab/ff69639abd00ebd75258a583963df65a.png" alt="image"><br><br>  Even if we are aware of this feature, why doesn't <code>font-size: 100px</code> create <code>font-size: 100px</code> elements?  I measured these values: Helvetica - 115px, Gruppo - 97px and Catamaran - 164px. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c56/3ed/710/c563ed710d244632fc7a734f52f33e7e.png" alt="image"><br><br>  Although at first glance it looks somewhat strange, everything is quite expected - the <b>reason is in the font itself</b> .  How it works: <br><br><ul><li>  The font sets its <a href="http://designwithfontforge.com/en-US/The_EM_Square.html">em-square</a> (it‚Äôs UPM, units per em - units per pin-yard) - a kind of platform within which each character will be drawn.  In this square, relative units are used for measurement, and, as a rule, sizes of 1000 units are taken for it.  Although there are also 1024, 2048 or other number of units. </li><li>  Depending on the number of relative units, font metrics are set, such as the height of the upper and lower drawing elements (ascender / descender), uppercase and lowercase letters.  Some values ‚Äã‚Äãmay go beyond the em square. </li><li>  In the browser, relative units are scaled to the required <code>font-size</code> . </li></ul><br>  Take the Catamaran font and open it in <a href="https://fontforge.github.io/en-US/">FontForge</a> to get the metrics: <br><br><ul><li>  em square is taken as 1000 units; </li><li>  the height of the upper remote elements is 1100 units, and the lower - 540. </li></ul><br>  After several checks, it turned out that browsers on Mac OS use the values ‚Äã‚Äãof HHead Ascent / Descent, and on Windows they use the values ‚Äã‚Äãof Win Ascent / Descent (these values ‚Äã‚Äãmay differ).  In addition, the height of capital letters Capital Height is 680 units, and lowercase X height - 485. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8fa/5fa/46b/8fa5fa46b571db21c79bda208d6263c3.png" alt="image"><br><br>  Thus, the Catamaran font uses 1100 + 540 units in an em square of 1000 units, and therefore with a font-size: 100px, the height is 164px.  This computed height defines the <b>content-area of ‚Äã‚Äãthe element</b> (this term will be used hereafter).  You can think of the content area as the area to which the <code>background</code> property applies. <br><br>  You can also assume that the height of capital letters is 68px (680 units), and lowercase (x-height) - 49px (485 units).  As a result, 1ex = 49px and 1em = 100px, not 164px (fortunately, em depends on the <code>font-size</code> , not on the calculated height). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cb0/5dd/4dc/cb05dd4dc6908e522c0f69392ed1fe87.png" alt="image"><br><br>  Before diving deeper, consider the main points to be faced.  The <code>p</code> element when displayed on the screen may consist of several lines with the appropriate width.  Each line consists of one or several line elements (inline elements) (HTML tags or anonymous line elements for text content) and is called a line box (box-box).  <b>The height of the row container depends on the heights of its children</b> .  That is, the browser calculates the height of each line item, and according to it the height of the container row (from the topmost to the lowest point of its children).  As a result, the height of the container line is always enough to hold all its children (by default). <br><br><blockquote>  Each HTML element is actually a stack of string containers.  If you know the height of all containers in a row, then the height of the element is also known. </blockquote><br>  If you change the above HTML code as follows: <br><br><pre> <code class="css hljs">&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">p</span></span>&gt; <span class="hljs-selector-tag"><span class="hljs-selector-tag">Good</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">design</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">will</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">be</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">better</span></span>. &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">class</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span>"&gt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">Ba</span></span>&lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span>&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">class</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">b</span></span>"&gt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">Ba</span></span>&lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span>&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">class</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">c</span></span>"&gt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">Ba</span></span>&lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span>&gt; <span class="hljs-selector-tag"><span class="hljs-selector-tag">We</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">get</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">make</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">consequence</span></span>. &lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">p</span></span>&gt;</code> </pre> <br>  three row containers will be generated: <br><br><ul><li>  in the first and last will be one anonymous string element (text content); </li><li>  in the second there will be two anonymous lower-case elements and 3 <code>span</code> elements. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/cc5/6c7/186/cc56c718642f701c3f8739ee7a4453cf.png" alt="image"><br><br>  It is clearly seen that the second container of the line is larger than the rest due to the calculated content area of ‚Äã‚Äãits child elements, more precisely, the one that uses the Catamaran font. <br><br>  <b>The tricky point in creating a string container is that, in essence, we can neither see nor manage it through CSS</b> .  Even applying a background to the <code>::first-line</code> does not help display the height of the first line container. <br><br><h2>  line-height: about problems and other issues </h2><br>  Up to this point, I introduced two concepts - the content area and the string container.  If you read carefully, you noticed that the height of the container line is calculated based on the height of its children, but did not say that based on the height of the content area of ‚Äã‚Äãits children.  And this is a big difference. <br><br>  Even if it may seem strange, <b>the line element has two different heights: the height of the content area and the height of the virtual-area</b> (I myself coined the term ‚Äúvirtual area‚Äù because we cannot see this height; in the specification of this term you will not find). <br><br><ul><li>  The height of the content area is determined by the font metrics (as we saw earlier). </li><li>  The virtual-area <code>line-height</code> is the <code>line-height</code> , and this is the height that is used to calculate the height of the line container. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/efe/30b/60d/efe30b60d553cb6237f9c0cbdebb240b.png" alt="image"><br><br>  In addition, what has been said refutes the widespread view that <code>line-height</code> is the distance between baselines.  In CSS, this is not the case. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/030/1a3/79e/0301a379ebf7d2dfcbb995c4a2cfc7fa.png" alt="image"><br><br>  <i>In other editorial programs this may be the distance between the baselines.</i>  <i>For example, in Word and Photoshop this is true.</i>  <i>The main difference is that in CSS this distance is also for the first line.</i> <br><br>  The calculated height difference between the virtual area and the content area is called leading (leading).  One half of the leading is added to the top of the content area, and the second - from the bottom.  Therefore, the content area is always in the center of the virtual area. <br><br>  Depending on the calculated value, the <code>line-height</code> (virtual area) may be equal to, greater than or less than the content area.  If the virtual area is smaller, then the leading value is negative and the row container is visually smaller than its children in height. <br><br>  There are other types of lowercase elements: <br><br><ul><li>  replaceable string elements ( <code>img</code> , <code>input</code> , <code>svg</code> , etc.); </li><li>  <code>inline-block</code> and all <code>inline-*</code> elements; </li><li>  line elements that are involved in a special formatting context (for example, in the flexbox element, all flex components are blockified). </li></ul><br>  For such special string elements, the height is calculated based on their <code>height</code> , <code>margin</code> and <code>border</code> properties.  If <code>auto</code> specified for <code>height</code> , <code>line-height</code> is applied, and the height of the content area is equal to <code>line-height</code> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/924/b68/826/924b688268ae43ff1c6ccda3bec78123.png" alt="image"><br><br>  And yet the problem remains the same: what is the normal value for <code>line-height</code> ?  The answer to this question, as in the case of calculating the content area, must be searched among the font metrics.  So back to FontForge.  The size of the em square for Catamaran is 1000, but we see a lot of values ‚Äã‚Äãfor the upper and lower offset elements: <br><br><ul><li>  Ascent / Descent common values: the height of the top detail is 770, the bottom is 230. Used to create characters (OS / 2 table). </li><li>  Ascent / Descent metrics: the height of the top callout is 1100, the bottom is 540. Used to determine the height of the content area (the ‚Äúhhea‚Äù and ‚ÄúOS / 2‚Äù tables). </li><li>  Line Gap metric (line spacing).  Used to determine <code>line-height: normal</code> , this value is added to the Ascent / Descent metrics (table "hhea"). </li></ul><br>  In our case, the Catamaran font determines that the line spacing is 0 units, and thus the <code>line-height: normal</code> will be equal to the content area, which is 1640 units or 1.64. <br><br>  As a comparison: for the Arial font, the em-square is 2048 units, the height of the outer detail element is 1854, the lower one is 434, the line spacing is 67. Thus, for <code>font-size: 100px</code> the content area is 112px (1117 units), and <code>line-height: norma</code> l - 115px (1150 units or 1.15).  All these metrics are individual for each font and are set by the font designer. <br><br>  Therefore, setting the <code>line-height: 1</code> ineffective.  Let me remind you that dimensionless values ‚Äã‚Äãdepend on the <code>font-size</code> , not on the content area, but the fact that the size of the content area exceeds the size of the virtual area is the cause of many of our problems. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/01f/0ec/3f8/01f0ec3f893c7162af0b6104cfc304e5.png" alt="image"><br><br>  But the reason is not only in <code>line-height: 1</code> .  If it comes to that, out of 1117 fonts installed on my computer (yes, I installed all the fonts from Google Web Fonts), 1059 fonts, that is, 95%, calculated <code>line-height</code> more than 1. In general, their calculated figure <code>line-height</code> ranges from 0.618 to 3.378.  (It did not seem to you - 3,378!) <br><br>  Small details about the calculation of the <code>line-box</code> : <br><br><ul><li>  For lowercase elements, padding and border increase the background area, but not the height of the content area (and not the height of the line container).  Therefore, the content area is not always what is visible on the screen.  There is no effect from <code>margin-top</code> and <code>margin-bottom</code> . </li><li>  For replaceable string elements, <code>inline-block</code> elements and blockified string elements - <code>padding</code> , <code>margin</code> and <code>border</code> increase the <code>height</code> and, therefore, the height of the content area and the row container. </li></ul><br><h2>  vertical-align: the property that controls everything </h2><br>  I have not stopped in detail on the vertical-align property, although it is the main factor for calculating the height of the row container.  You could even say that <code>vertical-align</code> can play a leading role in the string formatting context. <br><br>  Its default value is <code>baseline</code> .  Remember these font metrics, such as the height of the upper and lower detail elements (ascender / descender)?  These values ‚Äã‚Äãdetermine where the baseline is and, therefore, the ratio between the upper and lower parts.  Since the ratio between the upper and lower remote elements is rarely 50/50, this can lead to unexpected results, for example, with elements of the same level. <br><br>  Let's start with this code: <br><br><pre> <code class="css hljs">&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">p</span></span>&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span>&gt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">Ba</span></span>&lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span>&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span>&gt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">Ba</span></span>&lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span>&gt; &lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">p</span></span>&gt;</code> </pre> <br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">p</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: Catamaran; <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">100px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">line-height</span></span>: <span class="hljs-number"><span class="hljs-number">200px</span></span>; }</code> </pre> <br>  A <code>p</code> tag with two single-level <code>span</code> elements that inherit <code>font-family</code> , <code>font-size</code> and fixed <code>line-height</code> .  Baselines are the same, and the height of the container line is equal to their <code>line-height</code> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4a1/82c/d5a/4a182cd5a309f5b689c95ca730c0ae4f.png" alt="image"><br><br>  But what if the second element has a smaller <code>font-size</code> ? <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:last-child</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">50px</span></span>; }</code> </pre> <br>  Strange as it may sound, alignment of the default baseline can lead to an increase in the height (!) Of the row container, as shown in the figure below.  I remind you that the height of the container row is calculated from the topmost to the bottommost point of its children. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d31/0ad/9f4/d310ad9f4882c1466a1cf11dee3f20ab.png" alt="image"><br><br>  This could be an argument in favor of dimensionless <code>line-height</code> values, but sometimes fixed values ‚Äã‚Äãare required to create an ideal vertical rhythm.  Honestly, no matter what you choose, you will always have problems aligning the string. <br><br>  Consider another example.  <code>p</code> tag with <code>line-height: 200px</code> , which contains a single <code>span</code> that inherits its <code>line-height</code> <br><br><pre> <code class="css hljs">&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">p</span></span>&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span>&gt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">Ba</span></span>&lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span>&gt; &lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">p</span></span>&gt;</code> </pre> <br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">p</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">line-height</span></span>: <span class="hljs-number"><span class="hljs-number">200px</span></span>; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: Catamaran; <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">100px</span></span>; }</code> </pre> <br>  What is the height of the container row?  We could assume that 200px, but it is not.  The problem is that <code>p</code> has its own distinct <code>font-family</code> value (by default, this is a serif).  The base lines of the <code>p</code> and <code>span</code> tags are in all likelihood at different heights, and therefore the height of the container row is larger than expected.  This is because browsers perform a calculation, assuming that each container of the line starts with a zero-width character, which is called ‚Äústrut‚Äù in the specification. <br><br>  <i>Invisible symbol with a visible effect.</i> <br><br>  So, we still have the same problem as in the case of single-level elements. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f96/851/b7a/f96851b7a279b35a12dea987bae3bff0.png" alt="image"><br><br>  With the alignment of the baseline, everything is bad, but maybe <code>vertical-align: middle</code> will save us?  As stated in the specification, the <code>middle</code> ‚Äúaligns the container with the vertical midpoint (midpoint) with the baseline of the parent container plus half the x-height of the primary element.‚Äù  The ratio of baselines, as well as x-heights (x-height), can be different, so you can not rely on the <code>middle</code> alignment.  And the worst part is the fact that in most of the <code>middle</code> scenarios, the ‚Äúcenter‚Äù is never truly.  This is influenced by too many factors that cannot be specified via CSS (x-height, the ratio of the upper and lower outliers, etc.). <br><br>  In addition, there are four other values ‚Äã‚Äãthat may be useful in some cases: <br><br><ul><li>  <code>vertical-align: top / bottom</code> - alignment at the top or bottom of the container row; </li><li>  <code>vertical-align: text-top / text-bottom</code> ‚Äî Aligns to the top or bottom of the content area. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/c45/50a/3a0/c4550a3a0387a2dd7fd323bd9e98ccf5.png" alt="image"><br><br>  But be careful: in all cases, the virtual area is aligned, that is, the invisible height.  Consider a simple example using <code>vertical-align: top</code> .  Invisible <code>line-height</code> can give a strange, but expected result. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c72/edc/431/c72edc431fa40ef60a890895a3b7a53d.png" alt="image"><br><br>  Finally, <code>vertical-align</code> also accepts numeric values ‚Äã‚Äãthat shift the container above or below relative to the baseline.  This last option may come in handy. <br><br><h2>  CSS is awesome </h2><br>  We discussed the issue of <code>line-height</code> and <code>vertical-align</code> interaction, but now the question is, can we manage font metrics through CSS?  In short, no.  Although I would really like this.  In any case, I think it is time to have some fun.  Font metrics are constant, so at least we should have something. <br><br>  What if, for example, we need text in the Catamaran font with a height of capital letters of exactly 100px?  It seems to be doable, so let's do some calculations. <br><br>  First of all, we specify all the font metrics as custom CSS properties, and then calculate the <code>font-size</code> , at which the height of capital letters will be 100px. <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">p</span></span> { <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-attribute"><span class="hljs-attribute">--font</span></span>: Catamaran; <span class="hljs-attribute"><span class="hljs-attribute">--fm-capitalHeight</span></span>: <span class="hljs-number"><span class="hljs-number">0.68</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">--fm-descender</span></span>: <span class="hljs-number"><span class="hljs-number">0.54</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">--fm-ascender</span></span>: <span class="hljs-number"><span class="hljs-number">1.1</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">--fm-linegap</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*        */</span></span> <span class="hljs-attribute"><span class="hljs-attribute">--capital-height</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*  font-family */</span></span> <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--font); <span class="hljs-comment"><span class="hljs-comment">/*        ,     */</span></span> <span class="hljs-attribute"><span class="hljs-attribute">--computedFontSize</span></span>: (<span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--capital-height) / <span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--fm-capitalHeight)); <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">calc</span></span>(var(--computedFontSize) * <span class="hljs-number"><span class="hljs-number">1px</span></span>); }</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/a98/593/192/a98593192b4f3ab90d9cabf93d390d63.png" alt="image"><br><br>  Pretty simple, isn't it?  But what if we need the text to be visually centered, and the remaining space is evenly distributed above and below the letter ‚ÄúB‚Äù?  To do this, you must calculate the <code>vertical-align</code> based on the ratio between the upper and lower outweigh elements. <br><br>  First, we calculate the <code>line-height: normal</code> and the height of the content area: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">p</span></span> { ‚Ä¶ <span class="hljs-attribute"><span class="hljs-attribute">--lineheightNormal</span></span>: (<span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--fm-ascender) + <span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--fm-descender) + <span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--fm-linegap)); <span class="hljs-attribute"><span class="hljs-attribute">--contentArea</span></span>: (<span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--lineheightNormal) * <span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--computedFontSize)); }</code> </pre> <br>  Then we need: <br><br><ul><li>  distance from the bottom of a capital letter to the bottom edge; </li><li>  The distance from the top of a capital letter to the top edge. </li></ul><br>  Like that: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">p</span></span> { ‚Ä¶ <span class="hljs-attribute"><span class="hljs-attribute">--distanceBottom</span></span>: (<span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--fm-descender)); <span class="hljs-attribute"><span class="hljs-attribute">--distanceTop</span></span>: (<span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--fm-ascender) - <span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--fm-capitalHeight)); }</code> </pre> <br>  Now we can calculate <code>vertical-align</code> as the difference between these distances, multiplied by the calculated <code>font-size</code> value (This value should be applied to the string child element). <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">p</span></span> { ‚Ä¶ <span class="hljs-attribute"><span class="hljs-attribute">--valign</span></span>: ((<span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--distanceBottom) - <span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--distanceTop)) * <span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--computedFontSize)); } <span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">vertical-align</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">calc</span></span>(var(--valign) * -<span class="hljs-number"><span class="hljs-number">1px</span></span>); }</code> </pre> <br>  And finally, we set the required value for <code>line-height</code> and calculate it, keeping the vertical alignment: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">p</span></span> { ‚Ä¶ <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-attribute"><span class="hljs-attribute">--line-height</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">line-height</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">calc</span></span>(((var(--line-height) * <span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--capital-height)) - <span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--valign)) * <span class="hljs-number"><span class="hljs-number">1px</span></span>); }</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/86b/09b/1ec/86b09b1ecc3a6c745bcb2d096e8edeec.png" alt="image"><br><br>  Now it‚Äôs quite simple to add a graphic element of the same height as the letter ‚ÄúB‚Äù: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">::before</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">content</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>: inline-block; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">calc</span></span>(1px * var(--capital-height)); <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">calc</span></span>(1px * var(--capital-height)); <span class="hljs-attribute"><span class="hljs-attribute">margin-right</span></span>: <span class="hljs-number"><span class="hljs-number">10px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">url</span></span>(<span class="hljs-string"><span class="hljs-string">'https://cdn.pbrd.co/images/yBAKn5bbv.png'</span></span>); <span class="hljs-attribute"><span class="hljs-attribute">background-size</span></span>: cover; }</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/58a/9a7/710/58a9a7710e144601bc632c629983bb6d.png" alt="image"><br><br>  I remind you that this test is shown solely for demonstration, and you should not rely on its results.  There are many reasons for this: <br><br><ul><li>  If the font metrics are not constant, then the calculations in the browser will not be permanent.  ¬Ø („ÉÑ) / ¬Ø </li><li>  If the font is not loaded, the backup font metrics are likely to be different, and working with multiple values ‚Äã‚Äãwill quickly become impossible. </li></ul><br><br><h2>  Let's sum up </h2><br>  Working examples: <br><ul><li>  <a href="http://jsbin.com/hogavos/edit%3Fhtml,css,output">Jsbin</a> </li><li>  <a href="https://gist.github.com/Fost/9e9d575a9bd4bdc1aa610afefda62917">gist</a> </li></ul><br><br>  What we found out: <br><ul><li>  Inline formatting context is really hard to understand. </li><li>  All line elements have two heights: <br><ul><li>  the height of the content area (which depends on the font metrics); </li><li>  the height of the virtual area ( <code>line-height</code> ); </li><li>  None of them can be exactly visualized (unless you are working with development tools and decided to correct this defect, then it would be just wonderful). </li></ul><br></li><li>  <code>line-height: normal</code> depends on the font metrics. </li><li>  due to <code>line-height: n</code> virtual area may become smaller than the content area. </li><li>  you should not rely on <code>vertical-align</code> . </li><li>  The height of the row container is calculated using the <code>line-height</code> and <code>vertical-align</code> properties of its children. </li><li>  We can't just get or set font metrics via CSS. <br></li></ul><br><br>  But I still love CSS :) <br><br><h2>  useful links </h2><br><ul><li>  font metrics: <a href="https://fontforge.github.io/en-US/">FontForge</a> , <a href="http://opentype.js.org/font-inspector.html">opentype.js</a> </li><li>  <a href="http://brunildo.org/test/aspect-lh-table2.html">calculate line-height: normal and some proportions in the browser</a> ; </li><li>  <a href="https://www.w3.org/Style/CSS/Test/Fonts/Ahem/">Ahem</a> is a special font to understand how it works. </li><li>  deeper formal explanation of <a href="http://meyerweb.com/eric/css/inline-format.html">line formatting context</a> </li><li>  Future specification for this topic for help with vertical alignment: <a href="https://drafts.csswg.org/css-line-grid/">Line Grid module</a> </li><li>  font metrics, <a href="https://drafts.css-houdini.org/font-metrics-api-1/">API Level 1</a> , collection of interesting ideas (Houdini) </li></ul></div><p>Source: <a href="https://habr.com/ru/post/337450/">https://habr.com/ru/post/337450/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337438/index.html">‚ÄúAs per the notes!‚Äù Or Machine Learning (Data science) in C # using Accord.NET Framework</a></li>
<li><a href="../337440/index.html">Boat in the anthill</a></li>
<li><a href="../337442/index.html">Cybersecurity: Flipping through Cisco's annual report</a></li>
<li><a href="../337446/index.html">Data masking as a tool to minimize labor costs at the stage of putting new information systems into operation</a></li>
<li><a href="../337448/index.html">Statistics on basic operating systems in images on the Docker Hub</a></li>
<li><a href="../337452/index.html">Record of the webinar ‚ÄúHow expert information and a model for predicting malicious behavior help protect companies‚Äù</a></li>
<li><a href="../337454/index.html">A set of useful tips for the effective use of FreeIPA</a></li>
<li><a href="../337456/index.html">The Internet of Things is Popular: Why We Stop Walking the Dogs</a></li>
<li><a href="../337458/index.html">15 years at ISDEF: the experience of the oldest participant</a></li>
<li><a href="../337460/index.html">How JS works: about the V8 internals and code optimization</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>