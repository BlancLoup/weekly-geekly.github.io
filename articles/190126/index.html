<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The Ruby project is a new LTE router: what's inside and how we designed it</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 
 My job is product development at Yota Devices. We have released a new LTE router, which polished everything to the smallest detail. The devel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The Ruby project is a new LTE router: what's inside and how we designed it</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/60d/bb0/11d/60dbb011d069d5d6dda30d2ca47a1f34.jpg"><br><br>  <b>Hello!</b> <br>  My job is product development at Yota Devices.  We have released a new LTE router, which polished everything to the smallest detail.  The development of iron was carried out in Russia, our low-level software (on top of the Qualcomm SDK), the board together with the manufacturer in Taiwan, the antennas are our Finnish department (our engineers made the antennas of most Nokia tubes). <br><br><img src="https://habrastorage.org/storage2/c5d/e01/163/c5de011634c93cca7b8e66f23d077dfa.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I think you will be interested to know how was the development.  I'll start with a description of the device.  First, it is a router that receives a 4G, 3G or 2G signal and distributes Wi-Fi.  Secondly, Ruby (the so-called device) can be inserted into USB and work like a usual LTE-modem.  Thirdly, the router can work without external power.  Inside there is a battery that allows you to work in the car, in the park, in the country or just distribute the Internet from a backpack while walking. <br><br>  <b>Carefully, under the cut traffic</b> - a lot of photos <a name="habracut"></a><br><br>  Previously, it was the battery that was the most problematic module of the past generation LTE modems and routers.  Usually, the charge lasted for 2-3 hours, which is absolutely unbearable: most modern laptops, all tablets and phones run on battery for much longer.  Therefore, our main and most difficult task was to optimize the power supply of the new device. <br><br>  But I'm running a little ahead.  I‚Äôll come back to the issue of nutrition a little later, but for now let's see what Ruby looks like. <br><br><img src="https://habrastorage.org/storage2/5fd/5e6/12f/5fd5e612f95e2ca09a8cea52be6e7b2b.jpg"><br>  <sup>In the picture a new device - Ruby - and another today's release.</sup> <br><br>  The router is delivered in a strong rigid box with a cable and instructions.  The order of installation corresponds to the order of use: first, the device itself, to take and connect.  The rest is in most cases no longer needed.  But if you suddenly want to read something, then the next layer is the instruction.  Under it is a cable - in case you need to use micro-USB. <br><br><img src="https://habrastorage.org/storage2/e69/09c/798/e6909c79892fe6f3fc718b8e521fdd84.jpg"><br><br>  This is how the device looks stuck in USB.  Now there are 0 network connections, and charging has just begun: <br><br><img src="https://habrastorage.org/storage2/076/e7b/bfb/076e7bbfb0b0b531394e156b20a087b6.jpg"><br><br>  Our USB connector goes into the case: <br><br><img src="https://habrastorage.org/storage2/13d/ef6/615/13def66153a383e3699d935ea9ff15d6.jpg"><br><br>  This is how it looks on the assembled device: <br><br><img src="https://habrastorage.org/storage2/7f6/9d6/a6f/7f69d6a6f2cf0becc15726d71623244e.jpg"><br><br>  And so (below) with an open case.  We love to work through all the little things, so the connector has several features.  First, it hides the SIM compartment.  Secondly, the connector is made of durable metal, so breaking it with your bare hands will not work, you will need large pliers and five minutes of work.  When we developed the design, we imagined that someone would like to play with the connector, opening and closing it twenty times a day for 3 years.  Thirdly, the connector has small protrusions on the edges that will not allow the device to be inserted into the USB port upside down.  And, fourthly, the plastic strap on top protects from accidental grounding on the case (a rare but real case). <br><br><img src="https://habrastorage.org/storage2/c88/7ea/8e4/c887ea8e4807e5c09f655703ca86938d.jpg"><br><br>  If the connector is completely closed, the micro-USB input opens, where you can also connect the cable for charging or accessing the modem directly. <br><br><img src="https://habrastorage.org/storage2/cf0/fa1/a44/cf0fa1a44f7f815dbf2bf64f0091e14d.jpg"><br><br>  From the end of the display with indication (shows the charge, the number of connections and the type of network) plus a three-way switch. <br><br><img src="https://habrastorage.org/storage2/63b/7d4/0bf/63b7d40bf108f0f8cb11133ee36da471.jpg"><br><br>  In the middle position, the device in the hybrid sleep analog is ‚Äúoff‚Äù for the user.  We shift to the left - we receive one Wi-Fi network with the password set earlier, all as on usual routers.  At the same time, a blue dot is visible - it is not only a reminder of the mode, but also a reset. <br><br><img src="https://habrastorage.org/storage2/fa1/d0e/8ef/fa1d0e8ef9cad2a3b0db11bd4109e54b.jpg"><br><br>  We shift to the right - the device creates (or continues to maintain) a private network and opens another one without a password (with a different SSID) for your friends. <br><br>  Now we will get inside. <br><br><img src="https://habrastorage.org/storage2/c11/2e2/7fd/c112e27fdc230f54082c8f3ab2c58bec.jpg"><br><br>  The case, which we will now completely remove, from durable plastic, on top of which - UV-coating to protect against minor scratches.  Here is a device without a case: <br><br><img src="https://habrastorage.org/storage2/8cb/770/f17/8cb770f17a2a5179f6006538478dae64.jpg"><br><br>  But a separate body and end plate.  Over it, too, had to work.  At first we wanted to use durable structural plastic for the strap.  But on the prototype we were convinced that the device could not be assembled so that it immediately created a sense of integrity in the hands.  It turned out, as with some phones from China - try to twist, but it squeaks.  Therefore, we replaced the materials, and now the plank is made of polyamide with fiberglass.  Fits into place like a glove. <br><br><img src="https://habrastorage.org/storage2/e26/107/2f9/e261072f94147a50a402fe581135d559.jpg"><br><br>  The switch is also very cleverly arranged inside.  We have long picked up a scheme that accurately withstands thousands of switching.  Happened. <br><br><img src="https://habrastorage.org/storage2/b22/02d/105/b2202d1058f6defd4566550a2db2a982.jpg"><br><br>  Now back to the disassembled device.  Here is the SIM card compartment: <br><br><img src="https://habrastorage.org/storage2/25d/09c/587/25d09c587a60640dc4d2aa1350366887.jpg"><br><br>  Side - antenna.  By the way, the development of antennas is a separate story.  In Ruby, we have thought them out on our own, drawing on the experience of the best domestic radio engineers and engineers of our Finnish office, who used to make radio electronics for phones all over the world.  In general, the reception and transmission is now much more confident.  Yes, the device works equally well with the signal at any position in space: the radiation pattern is almost even. <br><br><img src="https://habrastorage.org/storage2/1cd/821/ca8/1cd821ca87eee594a3abd23f1211ee59.jpg"><br><br>  Antennas of different ranges in different parts of the body.  Ruby selects the fastest channel available. <br><br>  When switching between 4G and 3G / 2G, the indicator on the lid changes its color with a gradient, which looks very nice.  The photo below shows the LEDs that illuminate the indicator on the cover and connect them on top of the battery.  The black LEDs themselves: <br><br><img src="https://habrastorage.org/storage2/274/e0d/02f/274e0d02f8d856db6c3a84089364c8e0.jpg"><br><br><h4>  Options </h4><br>  <b>Dimensions</b> 97 x 66 x 13 millimeters. <br>  <b>Chipset</b> Qualcomm MDM 9215. <br>  <b>The display</b> is a segmented E-Ink and lightguide on the front side of the device. <br>  <b>Communication</b> : Wi-Fi - 802.11b / g / n, LTE: 800 (B20), 1800 (B3), 2100 (B1), 2600 FDD (B7 - in the Russian Federation only B7 / B20) and 2600 TDD (B38), UMTS : 900/2100 Mhz, GSM: QuadBand (800/900/1800 / 1900MHz). <br>  Battery (2100 mAh) - 10 hours of streaming video, 20 hours of normal surfing, 60 hours of standby, or 39 days of analog hybrid sleep. <br><br><h4>  Battery tests </h4><br>  Often, manufacturers claim battery performance on synthetic tests in the laboratory, where everything is perfect.  We were also interested in real life, so we conducted tests in a regular office in Moscow: <br><br>  <b>- First round.</b> <br>  We took the iPhone 5, set the screen brightness to 70%, turned off Bluetooth, but left 3G and Wi-Fi turned on.  Ruby and iPhone both fully charged and stabilized, then simultaneously removed them from charging.  We turned on Ruby, the iPhone connected to it via Wi-Fi, and then we launched an HD video from Youtube and waited.  The first after 8 hours of the marathon, the smartphone surrendered, at Ruby at that time there was still 12% of the charge, which was enough for another 2 hours of work. <br><br>  After looking at the logs, we realized that the download of the router was incomplete, because the video can be cached, which allows you to quickly download large fragments, and then for a few minutes not actually use the external channel.  This is the standard video consumption profile, but we wanted to look at the behavior of the router with a high load.  Therefore, we have started the second round. <br><br>  <b>- The second round.</b> <br>  We took a live broadcast in HD (it requires a permanent connection and loads the network heavily) and began to watch it on a MacBook Pro with a 13-inch screen.  The laptop gave up after three and a half hours, while the router still had 53% of the charge.  We connected the MacBook to the outlet and ‚Äúfinished off‚Äù the charge of the router - it lasted for 8 hours. <br><br>  <b>- The third round.</b> <br>  The next in the ring came Huawei E5776.  To him and to Ruby, we connected two iPhones, which first called via Skype at each other, and then looked at the cards, Facebook, browsed, and so on.  In general, they did what people usually do in a cafe or car.  Huawei finished work in 10 hours and 30 minutes, using its 3,000 milliamperes.  Ruby lasted 15 hours, using 2100 milliamperes - this very clearly shows the optimization result described below: we can say that Huawei consumed energy by 70% less rationally. <br><br><h4>  What have we done with nutrition? </h4><br>  Walked through all levels of architecture: <br><ul><li>  <b>On the case there is a screen.</b>  <b>It was necessary to reduce its power consumption to a minimum.</b>  Therefore, we put a segmented E-ink (something remotely resembling its ancestor in the Soviet game ‚ÄúWell, wait a minute!‚Äù), Which compared to other modules used so little energy that its consumption could simply be ignored.  Similarly, we worked with all the LEDs, choosing the most economical in terms of consumption options. </li><li>  <b>Then it was necessary to make sure that the power consumption is normally configured.</b>  We use the Qualcomm MDM 9215 chip with our own Linux build, because besides a lot of modifications directly on working with the network, it also has very thoughtful power management. </li><li>  <b>Now there are the most important consumers - radio modules.</b>  To reduce power consumption from them, you need to make sure that when the network is not in use, they turn off.  We developed and patented a number of solutions that allow you to maintain the connection, but almost completely ‚Äúput to sleep‚Äù the iron.  And it gave a huge gain in energy saving.  As far as I know, there are no analogues to such a decision yet, and this is a real reason for pride in domestic developers.  The result - at the driver level with power also figured out. </li><li>  <b>At the user level, we decided to do one more important thing.</b>  Whenever Ruby is connected to the USB port, charging begins.  This means that if you use the device at home or in the office with the power connected, it will be fully charged when you exit to the street. </li></ul><br><br>  The speed of the charge is important.  Sometimes I wake up and after 10-15 minutes I run out of the house, having only had time to brush my teeth.  Therefore, I wanted very much that the router discharged in the evening would not become an unpleasant surprise in the morning (as is sometimes the case with a telephone).  For this, in addition to a high-quality battery, we also installed a smart controller in Ruby, which is usually used only in expensive smartphones. <br><br>  The fact is that usually the device takes 500 milliamperes when charging via USB, and even if the source is ready to give more, the controller does not increase the charge current.  Our circuit is different: the charge starts at 450 mA and the voltage is measured.  The controller then increases the charge current by 100 mA and measures the voltage again.  At the moment when the voltage drops (for example, standard 1A charging, this happens when switching from 900 mA to 950 mA), the controller rolls back to the last step with a stable voltage and stops there.  As a result, the Ruby laptop charges up to 70% in 1 hour.  For me as a user, this means that in those 10-15 minutes after the climb, during which Ruby is connected to USB, I get more than an hour of battery life. <br><br>  I also mentioned above that the device ‚Äúfalls asleep‚Äù when there is a connection to an external channel (for example, 4G), but there are no users on the Wi-Fi network.  So, in this mode, Ruby calmly continues to send beacons, allows you to connect to the network - and at the same time it runs on a full battery for a couple of days.  If the device is turned off, it will switch to the analog hibernate - all the radio will turn off, the processor will go to sleep, but the memory will continue to be powered.  It is necessary for the device to turn on and load in 2-3 seconds, and not in a couple of minutes, as different LTE routers used to be.  In this mode, the device works without recharging for up to 39 days.  Then, with a low charge, the controller turns off the power and the router with the actual 2-3% (on the display - 0% charge) continues to lie for about a year or two without a deep discharge. <br><br>  In general, we should stop here, but we wanted to make a really good device.  And at this stage we were tormented by the following question: what if the user does achieve a deep discharge?  It is clear that our smart controller is able to very accurately take readings from the battery (after all, we need a charge indicator in percent), can turn off the device if the battery is nearing deep discharge, is able to ensure that the next power-on happens only with external power.  But even all this does not exclude the possibility that a deep discharge can happen anyway.  You can forget the device anywhere on the shelf for a couple of months, take it with you on a polar expedition, or <s>survive a nuclear war with it</s> .  And I would not want my device to let me down even in this situation.  Therefore, the battery controller has another emergency mode: when it detects a deep discharge, the first time the power is connected, the trickle charge starts - the minimum charging current that allows the battery to be ‚Äúpulled out‚Äù and reanimated.  That is, the router can be used further. <br><br>  Of course, it was important for us not only to make Ruby work for a long time, but also to make it easy and convenient to charge.  To do this, we immediately got rid of all possible charges - the device simply plugs into a standard USB or, if it is suddenly busy, or you don‚Äôt want to keep the router on the table, it connects via micro USB. <br><br>  When power is applied to the device, it switches to the ‚ÄúI am at home‚Äù mode and distributes Wi-Fi approximately 60 meters in a straight line.  When the external power is turned off, the device distributes Wi-Fi about 5-10 meters in a straight line.  This, by the way, is also part of power management. <br><br><h4>  Younger brother </h4><br>  Everything is simple, we also released a traditional modem + Wi-Fi, only in a new assembly and with a new antenna. <br><br><img src="https://habrastorage.org/storage2/622/362/800/622362800df1ce9d9aaf3aaa6571b86f.jpg"><br><br><img src="https://habrastorage.org/storage2/8ed/fd1/86f/8edfd186f1f0024df87fe7af6452e6e1.jpg"><br><br>  And here is the <a href="http://www.yota.ru/ru/buy/">link</a> to Ruby and the new modem on the Yota site.  The commercial name of the router for this operator is Yota Many (note that this operator already has a SIM card sold, which means you will need a passport when you buy it). <br><br>  I am pleased to answer your questions and, if interested, I will tell you later how we made antennas for new devices - this is a whole separate IT detective story. </div><p>Source: <a href="https://habr.com/ru/post/190126/">https://habr.com/ru/post/190126/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../190114/index.html">Perl6 - Comments, whitespace, parentheses</a></li>
<li><a href="../190116/index.html">In Finland, will discuss the proposed community law on copyright</a></li>
<li><a href="../190120/index.html">KolibriOS Summer of Code has ended</a></li>
<li><a href="../190122/index.html">We use postal codes in our application for the benefit</a></li>
<li><a href="../190124/index.html">New for web designer # 7</a></li>
<li><a href="../190130/index.html">Email Security: Email Encryption</a></li>
<li><a href="../190132/index.html">I will give the library in good hands</a></li>
<li><a href="../190138/index.html">4G on the smartphone. Personal experience</a></li>
<li><a href="../190142/index.html">Meteor 0.6.5 released</a></li>
<li><a href="../190144/index.html">Titanium Cloud Service: sending emails without calling the email dialog</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>