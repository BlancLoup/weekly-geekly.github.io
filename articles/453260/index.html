<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DPI setting features</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article does not consider the full DPI setting and everything together is connected, but the scientific value of the text is minimal. But it desc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DPI setting features</h1><div class="post__text post__text-html js-mediator-article">  This article does not consider the full DPI setting and everything together is connected, but the scientific value of the text is minimal.  But it describes the simplest way to bypass DPI, which many companies have not considered. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/26a/bde/904/26abde9044d04b3aa66680858a755901.jpg" alt="image"><br><a name="habracut"></a><br>  <i>Warning number 1: this article is research in nature, does not encourage anyone to do anything and use.</i>  <i>The idea is based on personal experience, and any coincidences are random.</i> <br><br>  <i>Warning number 2: the article does not reveal the secrets of Atlantis, the search for the Holy Grail and other riddles of the universe, all the material is in the public domain and perhaps more than once was described on Habr√©.</i>  <i><s>(I did not find it, I will be grateful for the link)</s></i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For those who read the warnings begin. <br><br><h3>  What is DPI? </h3><br>  DPI or Deep Packet Inspection is a technology for accumulating statistical data, checking and filtering network packets by analyzing not only packet headers, but also full traffic content at the OSI model levels from the second and higher, which allows detecting and blocking viruses, filtering information that does not meet specified criteria . <br><br>  There are two types of DPI connections that are described by <a href="https://habr.com/ru/users/valdikss/" class="user_link">ValdikSS</a> <a href="https://github.com/ValdikSS/blockcheck/wiki/%25D0%25A2%25D0%25B8%25D0%25BF%25D1%258B-DPI">on github</a> : <br><blockquote>  <b>Passive DPI</b> <br><br>  DPI, connected to the provider network in parallel (not in a section) either through a passive optical splitter, or using traffic mirroring from users.  Such a connection does not slow down the speed of the provider's network in case of insufficient DPI performance, which is why it is used by large providers.  A DPI with this type of connection can technically only detect an attempt to request prohibited content, but not suppress it.  To circumvent this restriction and block access to a banned site, the DPI sends the user who requests a blocked URL a specially crafted HTTP packet with redirection to the provider stub page, as if the response was sent by the requested resource itself (spoofing the sender's IP address and TCP sequence).  Due to the fact that DPI is physically located closer to the user than the requested site, the forged response reaches the user's device faster than the real response from the site. <br><br>  <b>Active DPI</b> <br><br>  Active DPI - A DPI connected to the provider's network in the usual way, like any other network device.  The provider configures the routing so that the DPI receives traffic from users to blocked IP addresses or domains, and the DPI already decides whether to allow or block traffic.  Active DPI can check both outgoing and incoming traffic, however, if a provider uses DPI only to block sites from the registry, most often it is configured to check only outgoing traffic. </blockquote><br>  Not only the efficiency of blocking traffic depends on the type of connection, but also the load on the DPI, so it is possible not to check all the traffic, but only certain: <br><blockquote>  <b>"Normal" DPI</b> <br><br>  By ‚Äúregular‚Äù DPI is meant a DPI that filters a certain type of traffic only on the most common ports for this type.  For example, ‚Äúnormal‚Äù DPI detects and blocks prohibited HTTP traffic only on port 80, HTTPS traffic on port 443. This type of DPI will not track forbidden content if you send a request with a blocked URL to an unblocked IP or a non-standard port. <br><br>  <b>"Full" DPI</b> <br><br>  Unlike the ‚Äúnormal‚Äù DPI, this type of DPI classifies traffic regardless of IP address and port.  Thus, blocked sites will not open, even if you use a proxy server on a completely different port and unlocked IP address. </blockquote><br><h3>  Use of DPI </h3><br>  In order not to reduce the data transfer rate, is it necessary to use a ‚ÄúNormal‚Äù passive DPI, which allows efficiently?  block any?  resources, the default configuration is as follows: <br><br><ul><li>  HTTP filter on port 80 only </li><li>  HTTPS only on port 443 </li><li>  BitTorrent only on ports 6881-6889 </li></ul><br>  But problems begin, if the <b>resource will use a different port in order not to lose users</b> , then you will have to check each packet, for example, you can give: <br><br><ul><li>  HTTP works on port 80 and 8080 </li><li>  HTTPS on port 443 and 8443 </li><li>  BitTorrent on any other band </li></ul><br>  Because of this, you will have to either switch to ‚ÄúActive‚Äù DPI, or use blocking using an additional DNS server. <br><br><h3>  DNS blocking </h3><br>  One way to block access to a resource is to intercept a DNS query using a local DNS server and return the IP address of the ‚Äústub‚Äù to the user, rather than the required resource.  But this does not give a guaranteed result, since it is possible to prevent the substitution of an address: <br><br>  <b>Option 1: Editing the hosts file (for desktop)</b> <br><br>  The hosts file is an integral part of any operating system, which allows you to always use it.  To access a resource, a user needs to: <br><br><ol><li>  Find out the IP address of the required resource </li><li>  Open for editing the hosts file (administrative rights are required) located in: <br><ul><li>  Linux: / etc / hosts </li><li>  Windows:% WinDir% \ System32 \ drivers \ etc \ hosts </li></ul></li><li>  Add a line in the format: &lt;ip-address&gt; &lt;resource name&gt; </li><li>  Save changes </li></ol><br>  The advantage of this method is its complexity and the requirement for administrator rights. <br><br>  <b>Option 2: DoH (DNS over HTTPS) or DoT (DNS over TLS)</b> <br><br>  These methods allow you to protect a DNS request from spoofing by using encryption, but the implementation is not supported by all applications.  Consider the ease of setting up a DoH for Mozilla Firefox version 66 by the user: <br><br><ol><li>  Go to <a href="">about: config</a> in Firefox </li><li>  Confirm that the user assumes all risk. </li><li>  Change the value of the <b>network.trr.mode</b> parameter to: <ul><li>  0 - disable TRR </li><li>  1 - automatic selection </li><li>  2 - enable DoH by default </li></ul></li><li>  Change the <b>network.trr.uri</b> setting by selecting a DNS server <br><ul><li>  Cloudflare DNS: <a href="https://mozilla.cloudflare-dns.com/dns-query">mozilla.cloudflare-dns.com/dns-query</a> </li><li>  Google DNS: <a href="https://dns.google.com/experimental">dns.google.com/experimental</a> </li></ul></li><li>  Change the <b>network.trr.boostrapAddress</b> parameter to: <br><ul><li>  If Cloudflare DNS is selected: 1.1.1.1 </li><li>  If Google DNS is selected: 8.8.8.8 </li></ul></li><li>  Change the value of the <b>network.security.esni.enabled</b> parameter to <b>true</b> </li><li>  Verify proper configuration using <a href="https://www.cloudflare.com/ssl/encrypted-sni/">Cloudflare service</a> </li></ol><br>  Although this method is more complex, it does not require user rights as an administrator, and there are many other ways to protect a DNS query that are not described in this article. <br><br>  <b>Option 3 (for mobile devices):</b> <br><br>  Using the app from Cloudflare for <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.cloudflare.onedotonedotonedotone">Android</a> and <a href="https://itunes.apple.com/us/app/1-1-1-1-faster-internet/id1423538627%3Fmt%3D8">IOS</a> . <br><br><h3>  Testing </h3><br>  To check the lack of access to resources, a domain blocked in the territory of the Russian Federation was temporarily purchased: <br><br><ul><li>  <a href="http://1winu.xyz/">HTTP check + 80 port</a> </li><li>  <a href="http://1winu.xyz:8080/">Check HTTP + 8080 port</a> </li><li>  <a href="https://1winu.xyz/">HTTPS check + port 443</a> </li><li>  <a href="https://1winu.xyz:8443/">HTTPS check + 8443 port</a> </li></ul><br><h3>  Conclusion </h3><br>  I hope this article will be useful and encourage not only administrators to understand the topic in more detail, but also give an understanding that <b>resources will always be on the side of the user, and the search for new solutions should be an integral part for them.</b> <br><br><h4>  useful links </h4><br><ul><li>  <a href="https://habr.com/ru/company/globalsign/blog/427563/">Implementing Encrypted SNI in Firefox</a> </li><li>  <a href="https://habr.com/ru/post/335436/">Autonomous DPI Traversal</a> </li></ul><br><div class="spoiler">  <b class="spoiler_title">Supplement out of article</b> <div class="spoiler_text">  The test on Cloudflare cannot be passed through the Tele2 operator‚Äôs network, and a properly configured DPI blocks access to the test site. <br>  PS So far this is the first provider to correctly block resources. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/453260/">https://habr.com/ru/post/453260/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../453242/index.html">Platform for summer events</a></li>
<li><a href="../453246/index.html">ERP - Continuous Degradation System</a></li>
<li><a href="../453248/index.html">Lunar mission ‚ÄúArtemis‚Äù - the production of the main element of the lunar orbital station ‚ÄúLunar Gateway‚Äù has begun</a></li>
<li><a href="../453256/index.html">SObjectizer-5.6.0: cut to pieces to grow further</a></li>
<li><a href="../453258/index.html">Making a reverb pedal using PT2399 microcircuits (part 1)</a></li>
<li><a href="../453264/index.html">Virtuali-tee: a ‚Äúmedical T-shirt‚Äù that doesn‚Äôt cover but expose</a></li>
<li><a href="../453272/index.html">GitHub Sponsors: a new way to contribute to open source</a></li>
<li><a href="../453274/index.html">Hidden commission Yandex.Money in Samsung Pay</a></li>
<li><a href="../453276/index.html">Arduino and timer interrupts</a></li>
<li><a href="../453278/index.html">Why don't engineers care about monitoring applications?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>