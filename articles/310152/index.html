<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>.Net Core, WCF and ODATA clients</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I wanted to write an article about the use of these technologies in 1C, but then I decided to write for the time being about using WCF, ODATA in .Net ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>.Net Core, WCF and ODATA clients</h1><div class="post__text post__text-html js-mediator-article">  I wanted to write an article about the use of these technologies in 1C, but then I decided to write for the time being about using WCF, ODATA in .Net Core.  Therefore, this article will not be so annoying to all Ruslisch and Kommersant.  .Net Core technology is young and fast growing.  At the same time, it is different from its older brother. <br><br>  In VS 2015 Update 3, there is no ‚ÄúAdd Link to Service‚Äù menu item for the application for .Net Core.  Instead, there is ‚ÄúAdd Connected Services‚Äù.  How to install it, you can see here <a href="https://blogs.msdn.microsoft.com/webdev/2016/06/26/wcf-connected-service-for-net-core-1-0-0-and-asp-net-core-1-0-0-is-now-available/">WCF Connected Service for .NET Core 1.0 and ASP.NET Core 1.0 is now available</a> .  For the experimental service, the Web service of the Central Bank was chosen. Web service <a href="http://www.cbr.ru/scripts/Root.asp%3FPrtId%3DDWS">for obtaining daily data (exchange rates, discount prices of precious metals ...)</a> .  In general, I connected by the manual above.  Got a description of the classes.  But at the same time there is a difference from the big brother. <br><a name="habracut"></a><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DailyInfoSoapClient(DailyInfoSoapClient.EndpointConfiguration.DailyInfoSoap);</code> </pre> <br>  First of all, they left configuration files. <br><br>  So listing: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> EndpointConfiguration { DailyInfoSoap, DailyInfoSoap12, }</code> </pre> <br>  And Designer <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DailyInfoSoapClient</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EndpointConfiguration endpointConfiguration</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DailyInfoSoapClient.GetBindingForEndpoint(endpointConfiguration</span></span></span><span class="hljs-function">), DailyInfoSoapClient.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetEndpointAddress</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">endpointConfiguration</span></span></span><span class="hljs-function">))</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Endpoint.Name = endpointConfiguration.ToString(); ConfigureEndpoint(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Endpoint, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ClientCredentials); }</code> </pre> <br>  And helper methods: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,      .  . static partial void ConfigureEndpoint(System.ServiceModel.Description.ServiceEndpoint serviceEndpoint, System.ServiceModel.Description.ClientCredentials clientCredentials); private static System.ServiceModel.Channels.Binding GetBindingForEndpoint(EndpointConfiguration endpointConfiguration) { if ((endpointConfiguration == EndpointConfiguration.DailyInfoSoap)) { System.ServiceModel.BasicHttpBinding result = new System.ServiceModel.BasicHttpBinding(); result.MaxBufferSize = int.MaxValue; result.ReaderQuotas = System.Xml.XmlDictionaryReaderQuotas.Max; result.MaxReceivedMessageSize = int.MaxValue; result.AllowCookies = true; return result; } if ((endpointConfiguration == EndpointConfiguration.DailyInfoSoap12)) { System.ServiceModel.Channels.CustomBinding result = new System.ServiceModel.Channels.CustomBinding(); System.ServiceModel.Channels.TextMessageEncodingBindingElement textBindingElement = new System.ServiceModel.Channels.TextMessageEncodingBindingElement(); textBindingElement.MessageVersion = System.ServiceModel.Channels.MessageVersion.CreateVersion(System.ServiceModel.EnvelopeVersion.Soap12, System.ServiceModel.Channels.AddressingVersion.None); result.Elements.Add(textBindingElement); System.ServiceModel.Channels.HttpTransportBindingElement httpBindingElement = new System.ServiceModel.Channels.HttpTransportBindingElement(); httpBindingElement.AllowCookies = true; httpBindingElement.MaxBufferSize = int.MaxValue; httpBindingElement.MaxReceivedMessageSize = int.MaxValue; result.Elements.Add(httpBindingElement); return result; } throw new System.InvalidOperationException(string.Format("Could not find endpoint with name \'{0}\'.", endpointConfiguration)); } private static System.ServiceModel.EndpointAddress GetEndpointAddress(EndpointConfiguration endpointConfiguration) { if ((endpointConfiguration == EndpointConfiguration.DailyInfoSoap)) { return new System.ServiceModel.EndpointAddress("http://www.cbr.ru/DailyInfoWebServ/DailyInfo.asmx"); } if ((endpointConfiguration == EndpointConfiguration.DailyInfoSoap12)) { return new System.ServiceModel.EndpointAddress("http://www.cbr.ru/DailyInfoWebServ/DailyInfo.asmx"); } throw new System.InvalidOperationException(string.Format("Could not find endpoint with name \'{0}\'.", endpointConfiguration)); }</span></span></code> </pre> <br>  That is, everything is written in the code. <br><br>  The second feature of .Net Core is that it does not currently have a DataSet.  And System.Data.DataTable is just an empty ad.  Therefore, the method, which in large .Net returns System.Data.DataSet, in the .Net version of Core returns the standard for an incomprehensible description of ArrayOfXElement.  For example this method: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataset = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> client.EnumValutesAsync(<span class="hljs-literal"><span class="hljs-literal">false</span></span>);</code> </pre> <br>  As with DataSet there is a circuit.  I remembered the <a href="http://geekswithblogs.net/.NETonMyMind/archive/2006/05/02/76957.aspx">Accessing XML Schema Information During Document Validation</a> and wanted to read the schema in ExpandoObject.  But in .Net Core there is no XmlSchema yet. <br><br>  We now turn to ODATA.  The technology is similar to WCF.  Use the <a href="http://odata.github.io/odata.net/">OData Client Code Generation Tool</a> .  For example, take a <a href="http://services.odata.org/V4/OData/OData.svc/">service</a> with a version of ODATA V4. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> uri = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-string"><span class="hljs-string">@"http://services.odata.org/V4/OData/OData.svc/"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ODataDemo.DemoService(uri); client.Format.UseJson();</code> </pre> <br>  Who has not worked with ODATA can see examples here - <a href="http://www.asp.net/web-api/overview/odata-support-in-aspnet-web-api/odata-v3/calling-an-odata-service-from-a-net-client">Calling an OData Service From a .NET Client (C #)</a> .  Again, there are features when using ODATA in .Net Core. <br><br>  So harmless method: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> products = client.Products.Expand(p =&gt; p.Supplier); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> products) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"{0}\t{1}\t{2}"</span></span>, p.Name, p.Price, p.Supplier.Name); }</code> </pre><br>  causes an error. <br><br><blockquote>  The required version of the .NET Framework does not allow direct data transfer at the request of the data transmission service.  This is due to the fact that when you transfer to the data service, a synchronous request is automatically sent.  Since this version of the .NET Framework only supports asynchronous operations, you must instead call the BeginExecute and EndExecute methods to get the result of a query that supports enumeration. </blockquote><br>  That is, it requires the following code: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> query = container.Products.Expand(<span class="hljs-string"><span class="hljs-string">"ProductDetail,Categories"</span></span>); System.AsyncCallback OnCustomersQueryComplete = (result =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> product <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> query.EndExecute(result)) { DisplayProduct(product); } }); query.BeginExecute(OnCustomersQueryComplete, query);</code> </pre> <br>  But this is not our approach.  The article <a href="https://blogs.msdn.microsoft.com/writingdata_services/2013/03/04/extending-the-odata-async-extensions-to-dataservicecollectiont-methods/">Extending the OData Async Extensions to DataServiceCollection Methods</a> was found on the Internet <a href="https://blogs.msdn.microsoft.com/writingdata_services/2013/03/04/extending-the-odata-async-extensions-to-dataservicecollectiont-methods/">.</a>  <a href="https://blogs.msdn.microsoft.com/writingdata_services/2013/03/04/extending-the-odata-async-extensions-to-dataservicecollectiont-methods/">This article has sources on</a> <a href="">ODataAsyncExtensions.cs</a> . <br><br>  There is a method: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> Task&lt;IEnumerable&lt;TResult&gt;&gt; ExecuteAsync&lt;TResult&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> DataServiceQuery&lt;TResult&gt; query) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> queryTask = Task.Factory.FromAsync&lt;IEnumerable&lt;TResult&gt;&gt;(query.BeginExecute(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>), (queryAsyncResult) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> results = query.EndExecute(queryAsyncResult); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> results; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> queryTask; }</code> </pre> <br>  But in fact, there is now the usual method in the Microsoft.OData.Client layout of the DataServiceQuery: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Task&lt;IEnumerable&lt;TElement&gt;&gt; ExecuteAsync();</code> </pre> <br>  Therefore, we use it: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> query = container.Products.Expand(<span class="hljs-string"><span class="hljs-string">"Supplier,Categories"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//https://blogs.msdn.microsoft.com/writingdata_services/2013/03/04/extending-the-odata-async-extensions-to-dataservicecollectiont-methods/ //http://odata.github.io/odata.net/#OData-Client-Code-Generation-Tool var result = await query.ExecuteAsync(); foreach (var product in result) { DisplayProduct(product); }</span></span></code> </pre> <br>  About using ODATA 1C services in a large .Net I have an article <a href="http://infostart.ru/public/403524/">Linq to ODATA</a> .  So .Net Core is developing rapidly. <br><br>  At the end of the article I would like to ask for advice.  I did not write about using WCF and ODATA in 1C for the following reasons. <br><br>  <strong>1.</strong> For WCF in 1C there is an analogue, but it does not understand the WS protocols, messages in the Header (although everything changes there).  But I did not find any services with them. <br>  <strong>2.</strong> C ODATA is very convenient to work from .Net.  Of course, you can make a separate assembly with .Net methods or use dynamic compilation, but for the most part, 1C ki do not know C # for the most part. <br><br>  At the moment, 1C nicks are interested in such topics. <br><br>  <a href="http://infostart.ru/public/434771/">1C Messenger for sending messages, files and data exchange between 1C users, web pages, mobile applications a la Skype, WhatsApp</a> <br><br>  <a href="http://infostart.ru/public/466196/">.Net in 1C.</a>  <a href="http://infostart.ru/public/466196/">On the example of using HTTPClient, AngleSharp.</a>  <a href="http://infostart.ru/public/466196/">Convenient parsing of sites using the AngleSharp library, including authorization ala JQuery using CSS selectors.</a>  <a href="http://infostart.ru/public/466196/">Dynamic compilation</a> <br><br>  <a href="http://infostart.ru/public/448668/">Using .Net classes in 1C for beginners</a> <br><br>  So if anyone has components with a wow effect, write, I will be very grateful. </div><p>Source: <a href="https://habr.com/ru/post/310152/">https://habr.com/ru/post/310152/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310142/index.html">The final release of Angular 2</a></li>
<li><a href="../310144/index.html">We raise Owncloud from scratch with dynamic IP and Let's Encrypt. A thousand elephants! *</a></li>
<li><a href="../310146/index.html">Chained together, or add comfort comments Vkontakte</a></li>
<li><a href="../310148/index.html">CUBA Platform: Java RAD open source framework</a></li>
<li><a href="../310150/index.html">4C: Kyiv - Video Game Developers Conference</a></li>
<li><a href="../310156/index.html">GDB was a tough nut to crack.</a></li>
<li><a href="../310158/index.html">Duty of knowledge</a></li>
<li><a href="../310160/index.html">Installing Quartus II on CentOS</a></li>
<li><a href="../310162/index.html">Progrobot: programming language help bot</a></li>
<li><a href="../310164/index.html">Linux debugging tools</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>