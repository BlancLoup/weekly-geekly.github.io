<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Readable test</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction  This article was written as a result of my repeated meetings on viewing code with anti-patterns of writing not very readable tests, not ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Readable test</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4>  This article was written as a result of my repeated meetings on viewing code with anti-patterns of writing not very readable tests, not the last role in which incorrect work with test data plays.  In this article, I will explain the theory of the readable test and show how to achieve the identified characteristics through thoughtful naming and competent application of rendering auxiliary methods. <br><br><h4>  Unit  What it is? </h4>  Unit testing is usually translated into Russian as unit testing.  However, the word ‚Äúmodule‚Äù has a slightly different connotation of color associated with the deployment pattern.  Therefore, in order to avoid unnecessary associations, we will use Anglicism "unit".  Once again, remember what a unit is in terms of unit testing terminology: <br><br><blockquote>  A unit is a piece of code that, in a given environment, gives certain output for certain input data. </blockquote><br><img src="https://habrastorage.org/storage2/a11/00c/e89/a1100ce89180556afdba5f495a5cef3e.png" alt="unit definition"><br>  Note that in addition to the unit itself, all the other components of this definition can be degenerated into an empty set, but the more empty participants in this mess, the less meaning (semantics) is contained in the unit. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Examples </h5>  In order not to be sacrificed to Moloch of abstraction, in the words of Nietzsche, let us look at a couple of examples that vividly demonstrate each of the components of this love square. <br><br><h6>  Empty surroundings </h6>  This is the most common configuration for units written in the style of structural decomposition.  A function that takes arguments and returns a result is an example of a <b>unit</b> that has many arguments as <b>input data</b> and a result as <b>output data</b> .  The connection of the result with the input parameters is the essence of the function.  For example, the function y = sin (x) is a mapping of the set of all real numbers on the interval [-1,1].  For each input x, y is uniquely determined, and the responsibility of the sin (x) function is to ensure this uniqueness.  sin (x) will display these x in these y in any environment for any user, at any time of the year.  He is not interested in the environment. <br><br><h6>  Blank output </h6>  Often, the responsibility of a unit is not just to return something, but to do something with a certain state.  For example, the classic mediator pattern assumes the presence of an object ( <b>unit</b> ), which receives certain events ( <b>input data</b> ) and calls some methods on a set of objects ( <b>environment</b> ).  This object does not return anything to anyone - its responsibility to provide invariants between the set of objects that it is intended to link.  Providing these invariants is his responsibility.  The influence of input events on the environment is the definition of a unit mediator.  A mediator window that activates a section of the dialogue after a click on the radio button is a specific example of units of this configuration. <br><br><h6>  Blank Input </h6>  The necessity of the existence of such units follows from the simple logical conclusion that somewhere the data should still arise, and not be submitted from the outside.  A good example of such a unit is the GetCurrentTime () ( <b>unit</b> ) function, which reads the current time from the system ( <b>environment</b> ) and returns it ( <b>output data</b> ) to the client. <br><br><h6>  void f () </h6>  A function that does not accept anything, returns nothing and does not interact with the environment in any way has little meaning.  This is a certain thing in itself that it is better not to disturb ‚Äî not to use and not to create at all. <br><br><h5>  State and units </h5>  In the light of the above examples and definitions, we look at the void std :: list :: remove (const T &amp; elem) function.  Suppose elem is input.  But what about the environment and the output?  No output - void function.  And the environment then what?  Formally, memory.  But memory is the essence of a lower level than the list.  After all, no one will argue that "removal from the list is the release of memory according to some cunning scheme."  If you try to determine what it means (what semantics it has) ‚Äúremoval from the list‚Äù, then it will sound like this: ‚Äúdeleting an element from the list is changing the state of the list so that it is no longer possible to get this element from the list‚Äù.  So, the definition of the deletion semantics from the list is made <b>on the same level of abstraction</b> as the deletion itself, using another operation from the list interface.  Thus, the list :: remove function itself is <b>not a unit</b> .  The function remove itself, in isolation from everything, cannot be determined (and verified).  The list makes sense only in the totality of operations on it.  That list is a <b>unit</b> .  <b>The input</b> to it is a set of pairs (command, command_arguments), and the output of a pair (query, query_results).  By the way, this STL design corresponds to the principle of CQS (command query separation), in which the methods that change state and return it are separated from each other (this is done, for the sake of safety, to exceptions).  In the general case, however, for a class, the set of output data can also use the results of some of its operations that have input data.  Bad, but possible.  By the way, the question is, what about the environment?  Does std :: list also have environment agnostic?  Not!  You can submit allocator to it!  Working with memory is a list through the alokator.  The list clearly declared its dependence on the environment.  Well done! <br><br><h4>  Readable Tests </h4>  It would seem, what does the theory of unit tests have to do with when they promised to talk about the readability of tests?  The answer is simple: <br><br><blockquote>  The unit test is readable, in which all four components involved in determining a unit: a <b>unit</b> , <b>input and output,</b> and the <b>environment</b> are obvious. </blockquote><br>  Speaking of obviousness, it is meant that an outsider, possessing only the context of the subject area in which the test is written, reading only the test and not being forced to be distracted by finding out the details in another context, can guess the essence of the test and the statements and tests it makes.  If this is not the case, then the test is not readable and needs to be improved - often with the refinement of the interface and design of the unit. <br><br><h4>  Test anatomy </h4>  Before giving specific recommendations, we make some definitions so that there is no ambiguity.  So, the type test written using the <a href="https://code.google.com/p/googletest/">gtest</a> unit testing <a href="https://code.google.com/p/googletest/">framework</a> looks like this: <br><pre><code class="cpp hljs">TEST(Subject, Assertion) { <span class="hljs-comment"><span class="hljs-comment">// Body }</span></span></code> </pre> <br>  or so: <br><pre> <code class="cpp hljs">TEST_F(Subject, Assertion) { <span class="hljs-comment"><span class="hljs-comment">// Body }</span></span></code> </pre><br><h4>  rules </h4><br><h5>  Unit visibility </h5>  <b>Rule:</b> Subject must unequivocally indicate a unit or system under test. <br>  <b>Explanation:</b> Subject must be a noun of the English language (preferably non-composite and short), denoting a unit.  All tests in this file must have this unit with their Subjects, and the mix of TEST and TEST_F macros with the same Subject is prohibited. <br>  <b>Examples:</b> <br><br>  <font color="red">Poorly:</font> <br><pre> <code class="cpp hljs">TEST(GetDiskSignature, ReadsFirstSector) TEST(SetDiskSignature, WritesToFirstSector)</code> </pre><br>  <font color="green">Good:</font> <br><pre> <code class="cpp hljs">TEST(DiskSignature, ResidesOnFirstSector)</code> </pre><br><h5>  Test predicative </h5>  <b>Rule: The</b> Assertion must contain a full statement (a real-time narrative sentence) in English, subject to a meaningful check. <br>  <b>Explanation:</b> From reading the statement, the reader should have some expectation from the test contents.  That is, after reading this Assertion about a given Subject, the reader should have a plan in his head, as if he himself verified this statement.  That is why parasitic words such as ‚Äúcorrectly‚Äù, ‚Äúgood‚Äù, ‚Äúfine‚Äù, ‚Äúwell‚Äù and similar ethical-moral epithets are strictly forbidden as a predicate predicate.  The essence of the test is just to reveal what it means to "correct", "good", etc.  Such words in the predicate are allowed excluded as determinable entities, and not as definitions themselves. <br>  <b>Examples:</b> <br><br>  <font color="red">Poorly:</font> <br><pre> <code class="cpp hljs">TEST(FileCache, IsInitializedCorrectly)</code> </pre><br>  <font color="green">Good:</font> <br><pre> <code class="cpp hljs">TEST(FileCache, IsInitializedAsEmpty)</code> </pre><br><br><h5>  Using Entities from Assertion to Body </h5>  <b>Rule:</b> Identifiers used in the test body should reuse the terms used in the statement. <br>  <b>Explanation:</b> What could be more obvious to the reader when reading a test than literal repetition of the terms from the statement?  If the reader was made some quality promise in Assertion and he had some expectations that he would be in the test, nothing would help him to cling to the used entities as a repetition of the terms from the statement.  Small modifications are allowed, such as changing the case, numbers and even using any short suffixes and prefixes - the human brain (especially Russian) very effectively fights with such transformations of symbols, considering them equivalent to the original symbol.  The more mutations in the term, the harder it is to recognize the reader.  Therefore, even synonyms are not welcome. <br>  <b>Examples:</b> <br><br>  <font color="red">Poorly:</font> <br><pre> <code class="cpp hljs">TEST_F(MRUCache, MovesLastAccessedItemToFront) { Items.Touch(<span class="hljs-string"><span class="hljs-string">"http://facebook.com/"</span></span>); Items.Touch(<span class="hljs-string"><span class="hljs-string">"http://habrahabr.ru/"</span></span>); EXPECT_EQ(<span class="hljs-number"><span class="hljs-number">0</span></span>, Items.GetIndex(<span class="hljs-string"><span class="hljs-string">"http://habrahabr.ru/"</span></span>)); }</code> </pre><br>  <font color="green">Good:</font> <br><pre> <code class="cpp hljs">TEST_F(MRUCache, SetsIndexOfLastTouchedItemToZero) { MRUCache.Touch(Item(<span class="hljs-string"><span class="hljs-string">"http://facebook.com/"</span></span>)); MRUCache.Touch(Item(<span class="hljs-string"><span class="hljs-string">"http://habrahabr.ru/"</span></span>)); EXPECT_EQ(<span class="hljs-number"><span class="hljs-number">0</span></span>, MRUCache.GetIndex(Item(<span class="hljs-string"><span class="hljs-string">"http://habrahabr.ru/"</span></span>))); }</code> </pre><br>  <font color="green">Good:</font> <br><pre> <code class="cpp hljs">TEST_F(MRUCache, MovesLastAccessedItemToFront) { MRUCache.Access(Item(<span class="hljs-string"><span class="hljs-string">"http://facebook.com/"</span></span>)); MRUCache.Access(Item(<span class="hljs-string"><span class="hljs-string">"http://habrahabr.ru/"</span></span>)); EXPECT_EQ(Item(<span class="hljs-string"><span class="hljs-string">"http://habrahabr.ru/"</span></span>), MRUCache.Front()); }</code> </pre><br><br><h5>  Implicitness of test data </h5>  <b>Rule:</b> All test data (both input and output), exactly as the data read from the environment or written in the environment, must be present in the body of the test. <br>  <b>Explanation:</b> When reading, the first thing that a third-party reader clings to is a domain expert - this is familiar data.  The person from the cradle builds his knowledge from the particular to the general, therefore the person perceives the particular specifics best of all else.  It is well-chosen data collected in one context that achieves the greatest expressiveness of the test.  This is such an important aspect of the readable test that anti-patterns of violation of this rule will be placed in a separate article and alternatives to combat them will be shown. <br>  <b>Examples:</b> <br><br>  <font color="red">Poorly:</font> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Common::String SomeUnixPath = GET_WCHAR(<span class="hljs-string"><span class="hljs-string">"/var/log"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SomeUnixPathComponents = <span class="hljs-number"><span class="hljs-number">2</span></span>; ... TEST(UnixPath, ContainsSlashes) { EXPECT_EQ(SomeUnixPathComponents, Paths::Unix(SomeUnixPath).Components()); }</code> </pre><br>  <font color="green">Good:</font> <br><pre> <code class="cpp hljs">Common::<span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Path</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GET_WCHAR(value); } ... TEST(UnixPath, ContainsSlashes) { EXPECT_EQ(<span class="hljs-number"><span class="hljs-number">2</span></span>, Paths::Unix(Path(<span class="hljs-string"><span class="hljs-string">"/var/log"</span></span>)).Components()); }</code> </pre><br><br><h5>  Transparency of test data flow </h5>  <b>Rule:</b> The test body must contain all auxiliary objects participating in the data stream through the unit. <br>  <b>Explanation:</b> When writing unit tests, it is customary to take frequently repeated operations (and this is good) into auxiliary functions with expressive names, but when using the TEST_F macro, there is often a pernicious tendency to use fixture members in these functions without explicitly passing them.  In the end, even though these members eventually get to the unit being tested, they can learn that the test somehow influenced their contents only by going to the auxiliary function and reading its code.  That is, a test for its understanding requires a transition to another context, which is a deterioration of readability.  Therefore, even if the auxiliary function can access the test data in other ways, they must still be explicitly given out of the test body in order to show the data flow and its effect on the unit's behavior. <br>  <b>Examples:</b> <br><br>  <font color="red">Poorly:</font> <br><pre> <code class="cpp hljs">MockFileSystem Files; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> path, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size)</span></span></span><span class="hljs-function"> </span></span>{ ON_CALL(Files, Get(path.c_str()).WillByDefault(Return(File(size))); } ... TEST(FileStatistics, SumsFileSizes) { AddFile(<span class="hljs-string"><span class="hljs-string">"/bin/ls"</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>); AddFile(<span class="hljs-string"><span class="hljs-string">"/bin/bash"</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>); EXPECT_EQ(<span class="hljs-number"><span class="hljs-number">30</span></span>, GetStats(Files, <span class="hljs-string"><span class="hljs-string">"/bin"</span></span>).Size); }</code> </pre><br>  <font color="green">Good:</font> <br><pre> <code class="cpp hljs">MockFileSystem Files; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MockFileSystem&amp; fs, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> path, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size)</span></span></span><span class="hljs-function"> </span></span>{ ON_CALL(fs, Get(path.c_str()).WillByDefault(Return(File(size))); } ... TEST(FileStatistics, SumsFileSizes) { AddFile(Files, <span class="hljs-string"><span class="hljs-string">"/bin/ls"</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>); AddFile(Files, <span class="hljs-string"><span class="hljs-string">"/bin/bash"</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>); EXPECT_EQ(<span class="hljs-number"><span class="hljs-number">10</span></span> + <span class="hljs-number"><span class="hljs-number">20</span></span>, GetStats(Files, <span class="hljs-string"><span class="hljs-string">"/bin"</span></span>).Size); }</code> </pre><br><br><h4>  Conclusion </h4>  This article discusses the theory and practice of writing readable tests.  The above examples do not exhaust the whole range of tricks that make the test better - these are just the husks that I noticed in my tests, just like in other people's viewed tests.  The basic rule is to write a self-sufficient test.  If anything is put into an auxiliary function, then the name of the function itself, exactly like its signatures, should be so obvious that there is no need and desire to watch its implementation.  Take out to hide the irrelevant and name the essential! </div><p>Source: <a href="https://habr.com/ru/post/186666/">https://habr.com/ru/post/186666/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../186656/index.html">Syntax Sugar for PHP</a></li>
<li><a href="../186658/index.html">Heterogeneous Universe</a></li>
<li><a href="../186660/index.html">Is your application slow? This is because our civilization is dying.</a></li>
<li><a href="../186662/index.html">Not for printing. How we ran an iPad magazine</a></li>
<li><a href="../186664/index.html">Lightcoin mining optimization</a></li>
<li><a href="../186668/index.html">How to make even more cool garbage or functional language on the knee from one funny garbage</a></li>
<li><a href="../186670/index.html">Diploma: tanchiki and genetic programming</a></li>
<li><a href="../186672/index.html">Canvas Card</a></li>
<li><a href="../186674/index.html">Using CMAK to automate VPN client connections</a></li>
<li><a href="../186676/index.html">Babbage</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>