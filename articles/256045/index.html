<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SQL Language Tutorial (DDL, DML) on the example of MS SQL Server dialect. Part four</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Previous parts 


- Part One - habrahabr.ru/post/255361 
- Part Two - habrahabr.ru/post/255523 
- Part Three - habrahabr.ru/post/255825 

 In this par...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SQL Language Tutorial (DDL, DML) on the example of MS SQL Server dialect. Part four</h1><div class="post__text post__text-html js-mediator-article"><h2>  Previous parts </h2><br><ul><li>  Part One - <a href="http://habrahabr.ru/post/255361/">habrahabr.ru/post/255361</a> </li><li>  Part Two - <a href="http://habrahabr.ru/post/255523/">habrahabr.ru/post/255523</a> </li><li>  Part Three - <a href="http://habrahabr.ru/post/255825/">habrahabr.ru/post/255825</a> </li></ul><br><br><h2>  In this part we will look at </h2><br>  Multi-query queries: <br><ul><li>  Operations of horizontal joining of tables - JOIN </li><li>  Linking tables with the WHERE condition </li><li>  Vertical operations for combining query results - UNION </li></ul><br>  Working with subqueries: <br><ul><li>  Subqueries in FROM, SELECT blocks </li><li>  Subquery in the APPLY construction </li><li>  Using the WITH clause </li><li>  Subqueries in the WHERE clause: <br><ul><li>  Group comparison - ALL, ANY </li><li>  EXISTS clause </li><li>  IN condition </li></ul></li></ul><br><a name="habracut"></a><br><h2>  Add some new data </h2><br>  For demonstration purposes, add a few departments and positions: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> IDENTITY_INSERT Departments <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> Departments(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>,N<span class="hljs-string"><span class="hljs-string">'  '</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> Departments(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span>(<span class="hljs-number"><span class="hljs-number">5</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> IDENTITY_INSERT Departments <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> IDENTITY_INSERT Positions <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> Positions(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span>(<span class="hljs-number"><span class="hljs-number">5</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> Positions(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span>(<span class="hljs-number"><span class="hljs-number">6</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> Positions(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span>(<span class="hljs-number"><span class="hljs-number">7</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> IDENTITY_INSERT Positions <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span></code> </pre><br><br><h2>  JOIN joins - horizontal data join operations </h2><br>  Here we will greatly benefit from knowledge of the database structure, i.e.  what tables are there in it, what data is stored in these tables and which fields of the table are related to each other.  First of all, always thoroughly study the database structure, since  A normal query can be written only when you know where it is coming from.  Our structure consists of 3 tables Employees, Departments and Positions.  I will give here a diagram from the first part: <br><br><img src="https://habrastorage.org/files/afd/75a/67d/afd75a67da9347dab86bf5051b3d4975.png"><br><br>  <b>If the essence of the RDB is divide and conquer, then the essence of the operations of unions is again to glue together the data, divided into tables.</b>  <b>bring them back to the human form.</b> <br><br>  Simply put, the operations of horizontal joining the table with other tables are used to get the missing data from them.  Recall the example of the weekly report for the director when, when querying from the Employees table, we lacked the ‚ÄúDepartment Name‚Äù field in the Departments table to get the final result. <br><br>  Let's start with the theory.  There are five types of connections: <br><ol><li>  <b>JOIN</b> - left_table JOIN right_table ON conditions_connection </li><li>  <b>LEFT JOIN</b> - left_table LEFT JOIN right_table ON conditions_connection </li><li>  <b>RIGHT JOIN</b> - left_table RIGHT JOIN right_table ON conditions_connection </li><li>  <b>FULL JOIN</b> - left_table FULL JOIN right_table ON conditions_connection </li><li>  <b>CROSS JOIN</b> - left_table CROSS JOIN right_table_ </li></ol><br><table><tbody><tr><th width="150">  Short syntax </th><th width="150">  Full syntax </th><th>  Description (It‚Äôs not always clear to everyone. So, if it‚Äôs not clear, just return here after considering the examples.) </th></tr><tr><td>  JOIN </td><td>  INNER JOIN </td><td>  From the rows of the left table and the right table, only those rows are returned, according to which join conditions are fulfilled. </td></tr><tr><td>  LEFT JOIN </td><td>  LEFT OUTER JOIN </td><td>  All rows of the left_table are returned (keyword LEFT).  Only those rows of the left_table that satisfy the conditions of joining are added to the data of the right_table.  For missing data, NULL values ‚Äã‚Äãare inserted instead of rows in the right_table. </td></tr><tr><td>  RIGHT JOIN </td><td>  RIGHT OUTER JOIN </td><td>  Returns all rows in right_table (keyword RIGHT).  Only those rows of the right_table that satisfy the conditions of joining are added to the data of the left_table.  For missing data, NULL values ‚Äã‚Äãare inserted instead of the left-table rows. </td></tr><tr><td>  FULL JOIN </td><td>  FULL OUTER JOIN </td><td>  All rows from left_table and right_table are returned.  If join_line conditions are met for the left_table and right_table, then they are combined into a single line.  For rows that do not have join_conditions, NULL values ‚Äã‚Äãare inserted in place of the left table or in the place of right table, depending on the data of which table in the row is not available. </td></tr><tr><td>  CROSS JOIN </td><td>  - </td><td>  Combining each row of the left_table with all rows of the right_table.  This type of compound is sometimes called Cartesian product. </td></tr></tbody></table><br>  As the table shows, the full syntax from the short one differs only in the presence of the words INNER or OUTER. <br><br>  Personally, I always use short syntax when writing queries, for the reason: <br><ol><li>  This is shorter and does not litter the query with unnecessary words; </li><li>  According to LEFT, RIGHT, FULL and CROSS, and so it‚Äôs clear what kind of mix it is, just as in the case of JOIN; </li><li>  I consider the words INNER and OUTER in this case to be unnecessary rudiments, which more confuse beginners. </li></ol><br>  But of course, this is my personal preference, maybe someone likes to write long, and he sees this as his charms. <br><br>  Understanding each type of compound is very important, because  from the use of one or another type, the result of the query may differ.  Compare the results of the same query using a different type of connection, just try to see the difference for now and move on (we'll come back here): <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- JOIN  5  SELECT emp.ID,emp.Name,emp.DepartmentID,dep.ID,dep.Name FROM Employees emp JOIN Departments dep ON emp.DepartmentID=dep.ID</span></span></code> </pre><br><table><tbody><tr><th>  ID </th><th>  Name </th><th>  DepartmentID </th><th>  ID </th><th>  Name </th></tr><tr><td>  1000 </td><td>  Ivanov I.I. </td><td>  one </td><td>  one </td><td>  Administration </td></tr><tr><td>  1001 </td><td>  Petrov P.P. </td><td>  3 </td><td>  3 </td><td>  IT </td></tr><tr><td>  1002 </td><td>  Sidorov S.S. </td><td>  2 </td><td>  2 </td><td>  Accounting </td></tr><tr><td>  1003 </td><td>  Andreev A.A. </td><td>  3 </td><td>  3 </td><td>  IT </td></tr><tr><td>  1004 </td><td>  Nikolaev N.N. </td><td>  3 </td><td>  3 </td><td>  IT </td></tr></tbody></table><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- LEFT JOIN  6  SELECT emp.ID,emp.Name,emp.DepartmentID,dep.ID,dep.Name FROM Employees emp LEFT JOIN Departments dep ON emp.DepartmentID=dep.ID</span></span></code> </pre><br><table><tbody><tr><th>  ID </th><th>  Name </th><th>  DepartmentID </th><th>  ID </th><th>  Name </th></tr><tr><td>  1000 </td><td>  Ivanov I.I. </td><td>  one </td><td>  one </td><td>  Administration </td></tr><tr><td>  1001 </td><td>  Petrov P.P. </td><td>  3 </td><td>  3 </td><td>  IT </td></tr><tr><td>  1002 </td><td>  Sidorov S.S. </td><td>  2 </td><td>  2 </td><td>  Accounting </td></tr><tr><td>  1003 </td><td>  Andreev A.A. </td><td>  3 </td><td>  3 </td><td>  IT </td></tr><tr><td>  1004 </td><td>  Nikolaev N.N. </td><td>  3 </td><td>  3 </td><td>  IT </td></tr><tr><td>  1005 </td><td>  Aleksandrov A.A. </td><td>  Null </td><td>  Null </td><td>  Null </td></tr></tbody></table><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- RIGHT JOIN  7  SELECT emp.ID,emp.Name,emp.DepartmentID,dep.ID,dep.Name FROM Employees emp RIGHT JOIN Departments dep ON emp.DepartmentID=dep.ID</span></span></code> </pre><br><table><tbody><tr><th>  ID </th><th>  Name </th><th>  DepartmentID </th><th>  ID </th><th>  Name </th></tr><tr><td>  1000 </td><td>  Ivanov I.I. </td><td>  one </td><td>  one </td><td>  Administration </td></tr><tr><td>  1002 </td><td>  Sidorov S.S. </td><td>  2 </td><td>  2 </td><td>  Accounting </td></tr><tr><td>  1001 </td><td>  Petrov P.P. </td><td>  3 </td><td>  3 </td><td>  IT </td></tr><tr><td>  1003 </td><td>  Andreev A.A. </td><td>  3 </td><td>  3 </td><td>  IT </td></tr><tr><td>  1004 </td><td>  Nikolaev N.N. </td><td>  3 </td><td>  3 </td><td>  IT </td></tr><tr><td>  Null </td><td>  Null </td><td>  Null </td><td>  four </td><td>  Marketing and advertising </td></tr><tr><td>  Null </td><td>  Null </td><td>  Null </td><td>  five </td><td>  Logistics </td></tr></tbody></table><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- FULL JOIN  8  SELECT emp.ID,emp.Name,emp.DepartmentID,dep.ID,dep.Name FROM Employees emp FULL JOIN Departments dep ON emp.DepartmentID=dep.ID</span></span></code> </pre><br><table><tbody><tr><th>  ID </th><th>  Name </th><th>  DepartmentID </th><th>  ID </th><th>  Name </th></tr><tr><td>  1000 </td><td>  Ivanov I.I. </td><td>  one </td><td>  one </td><td>  Administration </td></tr><tr><td>  1001 </td><td>  Petrov P.P. </td><td>  3 </td><td>  3 </td><td>  IT </td></tr><tr><td>  1002 </td><td>  Sidorov S.S. </td><td>  2 </td><td>  2 </td><td>  Accounting </td></tr><tr><td>  1003 </td><td>  Andreev A.A. </td><td>  3 </td><td>  3 </td><td>  IT </td></tr><tr><td>  1004 </td><td>  Nikolaev N.N. </td><td>  3 </td><td>  3 </td><td>  IT </td></tr><tr><td>  1005 </td><td>  Aleksandrov A.A. </td><td>  Null </td><td>  Null </td><td>  Null </td></tr><tr><td>  Null </td><td>  Null </td><td>  Null </td><td>  four </td><td>  Marketing and advertising </td></tr><tr><td>  Null </td><td>  Null </td><td>  Null </td><td>  five </td><td>  Logistics </td></tr></tbody></table><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- CROSS JOIN  30  - (6   Employees) * (5   Departments) SELECT emp.ID,emp.Name,emp.DepartmentID,dep.ID,dep.Name FROM Employees emp CROSS JOIN Departments dep</span></span></code> </pre><br><table><tbody><tr><th>  ID </th><th>  Name </th><th>  DepartmentID </th><th>  ID </th><th>  Name </th></tr><tr><td>  1000 </td><td>  Ivanov I.I. </td><td>  one </td><td>  one </td><td>  Administration </td></tr><tr><td>  1001 </td><td>  Petrov P.P. </td><td>  3 </td><td>  one </td><td>  Administration </td></tr><tr><td>  1002 </td><td>  Sidorov S.S. </td><td>  2 </td><td>  one </td><td>  Administration </td></tr><tr><td>  1003 </td><td>  Andreev A.A. </td><td>  3 </td><td>  one </td><td>  Administration </td></tr><tr><td>  1004 </td><td>  Nikolaev N.N. </td><td>  3 </td><td>  one </td><td>  Administration </td></tr><tr><td>  1005 </td><td>  Aleksandrov A.A. </td><td>  Null </td><td>  one </td><td>  Administration </td></tr><tr><td>  1000 </td><td>  Ivanov I.I. </td><td>  one </td><td>  2 </td><td>  Accounting </td></tr><tr><td>  1001 </td><td>  Petrov P.P. </td><td>  3 </td><td>  2 </td><td>  Accounting </td></tr><tr><td>  1002 </td><td>  Sidorov S.S. </td><td>  2 </td><td>  2 </td><td>  Accounting </td></tr><tr><td>  1003 </td><td>  Andreev A.A. </td><td>  3 </td><td>  2 </td><td>  Accounting </td></tr><tr><td>  1004 </td><td>  Nikolaev N.N. </td><td>  3 </td><td>  2 </td><td>  Accounting </td></tr><tr><td>  1005 </td><td>  Aleksandrov A.A. </td><td>  Null </td><td>  2 </td><td>  Accounting </td></tr><tr><td>  1000 </td><td>  Ivanov I.I. </td><td>  one </td><td>  3 </td><td>  IT </td></tr><tr><td>  1001 </td><td>  Petrov P.P. </td><td>  3 </td><td>  3 </td><td>  IT </td></tr><tr><td>  1002 </td><td>  Sidorov S.S. </td><td>  2 </td><td>  3 </td><td>  IT </td></tr><tr><td>  1003 </td><td>  Andreev A.A. </td><td>  3 </td><td>  3 </td><td>  IT </td></tr><tr><td>  1004 </td><td>  Nikolaev N.N. </td><td>  3 </td><td>  3 </td><td>  IT </td></tr><tr><td>  1005 </td><td>  Aleksandrov A.A. </td><td>  Null </td><td>  3 </td><td>  IT </td></tr><tr><td>  1000 </td><td>  Ivanov I.I. </td><td>  one </td><td>  four </td><td>  Marketing and advertising </td></tr><tr><td>  1001 </td><td>  Petrov P.P. </td><td>  3 </td><td>  four </td><td>  Marketing and advertising </td></tr><tr><td>  1002 </td><td>  Sidorov S.S. </td><td>  2 </td><td>  four </td><td>  Marketing and advertising </td></tr><tr><td>  1003 </td><td>  Andreev A.A. </td><td>  3 </td><td>  four </td><td>  Marketing and advertising </td></tr><tr><td>  1004 </td><td>  Nikolaev N.N. </td><td>  3 </td><td>  four </td><td>  Marketing and advertising </td></tr><tr><td>  1005 </td><td>  Aleksandrov A.A. </td><td>  Null </td><td>  four </td><td>  Marketing and advertising </td></tr><tr><td>  1000 </td><td>  Ivanov I.I. </td><td>  one </td><td>  five </td><td>  Logistics </td></tr><tr><td>  1001 </td><td>  Petrov P.P. </td><td>  3 </td><td>  five </td><td>  Logistics </td></tr><tr><td>  1002 </td><td>  Sidorov S.S. </td><td>  2 </td><td>  five </td><td>  Logistics </td></tr><tr><td>  1003 </td><td>  Andreev A.A. </td><td>  3 </td><td>  five </td><td>  Logistics </td></tr><tr><td>  1004 </td><td>  Nikolaev N.N. </td><td>  3 </td><td>  five </td><td>  Logistics </td></tr><tr><td>  1005 </td><td>  Aleksandrov A.A. </td><td>  Null </td><td>  five </td><td>  Logistics </td></tr></tbody></table><br><br><h2>  It‚Äôs time to think about table aliases </h2><br>  The time has come to recall the pseudonyms of the tables, which I described at the beginning of the second part. <br><br>  In multi-query queries, the pseudonym helps us explicitly specify from which table the field is taken.  Let's look at an example: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> emp.ID,emp.Name,emp.DepartmentID,dep.ID,dep.Name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees emp <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Departments dep <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> emp.DepartmentID=dep.ID</code> </pre><br><br>  In it, the fields with the names ID and Name are in both tables in both Employees and Departments.  And in order to distinguish them, we preface the field name with an alias and a period, i.e.  "Emp.ID", "emp.Name", "dep.ID", "dep.Name". <br><br>  We recall why it is more convenient to use short pseudonyms - because, without pseudonyms, our query would look like this: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> Employees.ID,Employees.Name,Employees.DepartmentID,Departments.ID,Departments.Name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Departments <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> Employees.DepartmentID=Departments.ID</code> </pre><br><br>  For me, it became very long and worse to read, because  field names are visually lost among duplicate table names. <br><br>  In multi-query queries, although you can specify a name without a pseudonym, if the name is not duplicated in the second table, I would recommend always using pseudonyms when connecting, because  nobody guarantees that a field with the same name will not be added to the second table over time, and then your query will simply break, swearing that it cannot understand to which table this field belongs. <br><br>  Only by using pseudonyms can we make the connection of the table with ourselves.  Suppose there is a task to get for each employee, the data of the employee who was accepted right before him (the personnel number differs by one less).  Suppose that our personnel numbers are issued sequentially and without holes, then we can do it in the following way: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> e1.ID EmpID1, e1.Name EmpName1, e2.ID EmpID2, e2.Name EmpName2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees e1 <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Employees e2 <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> e1.ID=e2.ID+<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-comment"><span class="hljs-comment">--    </span></span></code> </pre><br><br>  Those.  here is one table Employees, we gave the alias "e1", and the second "e2". <br><br><h2>  Parse each type of horizontal connection. </h2><br>  For this purpose, we consider 2 small abstract tables, which we call LeftTable and RightTable: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> LeftTable( LCode <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, LDescr <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> RightTable( RCode <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, RDescr <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> LeftTable(LCode,LDescr)<span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">'L-1'</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-string"><span class="hljs-string">'L-2'</span></span>), (<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-string"><span class="hljs-string">'L-3'</span></span>), (<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-string"><span class="hljs-string">'L-5'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> RightTable(RCode,RDescr)<span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-string"><span class="hljs-string">'B-2'</span></span>), (<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-string"><span class="hljs-string">'B-3'</span></span>), (<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-string"><span class="hljs-string">'B-4'</span></span>)</code> </pre><br><br>  Let's see what's in these tables: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> LeftTable</code> </pre><br><table><tbody><tr><th>  LCode </th><th>  Ldescr </th></tr><tr><td>  one </td><td>  L-1 </td></tr><tr><td>  2 </td><td>  L-2 </td></tr><tr><td>  3 </td><td>  L-3 </td></tr><tr><td>  five </td><td>  L-5 </td></tr></tbody></table><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> RightTable</code> </pre><br><table><tbody><tr><th>  RCode </th><th>  RDescr </th></tr><tr><td>  2 </td><td>  B-2 </td></tr><tr><td>  3 </td><td>  B-3 </td></tr><tr><td>  four </td><td>  B-4 </td></tr></tbody></table><br><br><h3>  JOIN </h3><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> l.*,r.* <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> LeftTable l <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> RightTable r <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> l.LCode=r.RCode</code> </pre><br><table><tbody><tr><th>  LCode </th><th>  Ldescr </th><th>  RCode </th><th>  RDescr </th></tr><tr><td>  2 </td><td>  L-2 </td><td>  2 </td><td>  B-2 </td></tr><tr><td>  3 </td><td>  L-3 </td><td>  3 </td><td>  B-3 </td></tr></tbody></table><br>  Here string returns were returned for which the condition was met (l.LCode = r.RCode) <br><br><img src="https://habrastorage.org/files/08e/61a/aea/08e61aaea6f64adb8e921a3c928e2619.png"><br><br><h3>  LEFT JOIN </h3><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> l.*,r.* <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> LeftTable l <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> RightTable r <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> l.LCode=r.RCode</code> </pre><br><table><tbody><tr><th>  LCode </th><th>  Ldescr </th><th>  RCode </th><th>  RDescr </th></tr><tr><td>  one </td><td>  L-1 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2 </td><td>  L-2 </td><td>  2 </td><td>  B-2 </td></tr><tr><td>  3 </td><td>  L-3 </td><td>  3 </td><td>  B-3 </td></tr><tr><td>  five </td><td>  L-5 </td><td>  Null </td><td>  Null </td></tr></tbody></table><br>  Here, all LeftTable strings were returned, which were supplemented with data from the RightTable strings, for which the condition was satisfied (l.LCode = r.RCode) <br><br><img src="https://habrastorage.org/files/4e6/ea1/169/4e6ea1169ceb43e4a331d0641e79d9d6.png"><br><br><h3>  RIGHT JOIN </h3><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> l.*,r.* <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> LeftTable l <span class="hljs-keyword"><span class="hljs-keyword">RIGHT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> RightTable r <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> l.LCode=r.RCode</code> </pre><br><table><tbody><tr><th>  LCode </th><th>  Ldescr </th><th>  RCode </th><th>  RDescr </th></tr><tr><td>  2 </td><td>  L-2 </td><td>  2 </td><td>  B-2 </td></tr><tr><td>  3 </td><td>  L-3 </td><td>  3 </td><td>  B-3 </td></tr><tr><td>  Null </td><td>  Null </td><td>  four </td><td>  B-4 </td></tr></tbody></table><br>  Here all the RightTable strings were returned, which were supplemented with the data strings from the LeftTable, for which the condition was met (l.LCode = r.RCode) <br><br><img src="https://habrastorage.org/files/73c/de0/d16/73cde0d161ad49d99f6422f2666beecd.png"><br><br>  In fact, if we rearrange LeftTable and RightTable in some places, we will get a similar result using the left connection: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> l.*,r.* <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> RightTable r <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> LeftTable l <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> l.LCode=r.RCode</code> </pre><br><table><tbody><tr><th>  LCode </th><th>  Ldescr </th><th>  RCode </th><th>  RDescr </th></tr><tr><td>  2 </td><td>  L-2 </td><td>  2 </td><td>  B-2 </td></tr><tr><td>  3 </td><td>  L-3 </td><td>  3 </td><td>  B-3 </td></tr><tr><td>  Null </td><td>  Null </td><td>  four </td><td>  B-4 </td></tr></tbody></table><br>  I noticed with myself that I use LEFT JOIN more often, i.e.  I first think which table data is important to me, and then I think which table / tables will play the role of a complementary table. <br><br><h3>  FULL JOIN is essentially a simultaneous LEFT JOIN + RIGHT JOIN </h3><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> l.*,r.* <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> LeftTable l <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> RightTable r <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> l.LCode=r.RCode</code> </pre><br><table><tbody><tr><th>  LCode </th><th>  Ldescr </th><th>  RCode </th><th>  RDescr </th></tr><tr><td>  one </td><td>  L-1 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2 </td><td>  L-2 </td><td>  2 </td><td>  B-2 </td></tr><tr><td>  3 </td><td>  L-3 </td><td>  3 </td><td>  B-3 </td></tr><tr><td>  five </td><td>  L-5 </td><td>  Null </td><td>  Null </td></tr><tr><td>  Null </td><td>  Null </td><td>  four </td><td>  B-4 </td></tr></tbody></table><br>  All rows from LeftTable and RightTable are returned.  The strings for which the condition was met (l.LCode = r.RCode) were combined into one string.  Missing in the line data on the left or right side are filled with NULL-values. <br><br><img src="https://habrastorage.org/files/2bb/f93/cb7/2bbf93cb720e4d6998b78fcbb007a92a.png"><br><br><h3>  CROSS JOIN </h3><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> l.*,r.* <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> LeftTable l <span class="hljs-keyword"><span class="hljs-keyword">CROSS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> RightTable r</code> </pre><br><table><tbody><tr><th>  LCode </th><th>  Ldescr </th><th>  RCode </th><th>  RDescr </th></tr><tr><td>  one </td><td>  L-1 </td><td>  2 </td><td>  B-2 </td></tr><tr><td>  2 </td><td>  L-2 </td><td>  2 </td><td>  B-2 </td></tr><tr><td>  3 </td><td>  L-3 </td><td>  2 </td><td>  B-2 </td></tr><tr><td>  five </td><td>  L-5 </td><td>  2 </td><td>  B-2 </td></tr><tr><td>  one </td><td>  L-1 </td><td>  3 </td><td>  B-3 </td></tr><tr><td>  2 </td><td>  L-2 </td><td>  3 </td><td>  B-3 </td></tr><tr><td>  3 </td><td>  L-3 </td><td>  3 </td><td>  B-3 </td></tr><tr><td>  five </td><td>  L-5 </td><td>  3 </td><td>  B-3 </td></tr><tr><td>  one </td><td>  L-1 </td><td>  four </td><td>  B-4 </td></tr><tr><td>  2 </td><td>  L-2 </td><td>  four </td><td>  B-4 </td></tr><tr><td>  3 </td><td>  L-3 </td><td>  four </td><td>  B-4 </td></tr><tr><td>  five </td><td>  L-5 </td><td>  four </td><td>  B-4 </td></tr></tbody></table><br>  Each LeftTable line connects to the data of all RightTable lines. <br><br><img src="https://habrastorage.org/files/42f/daf/ec9/42fdafec90fd4a13a0663d3eee23e2e4.png"><br><br><h2>  Go back to the Employees and Departments tables. </h2><br>  I hope you understand the principle of horizontal joints.  If this is the case, then return to the beginning of the ‚ÄúJOIN-connections - horizontal data-joining operations‚Äù section and try to understand the examples yourself by combining the Employees and Departments tables, and then come back again, discuss it together. <br><br>  Let's try to summarize together for each request: <br><table><tbody><tr><th width="400">  Request </th><th>  Summary </th></tr><tr><td><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- JOIN  5  SELECT emp.ID,emp.Name,emp.DepartmentID,dep.ID,dep.Name FROM Employees emp JOIN Departments dep ON emp.DepartmentID=dep.ID</span></span></code> </pre> </td><td>  In essence, this query will return only employees who have the DepartmentID value. <br>  Those.  we can use this connection in the case when we need data on employees belonging to some department (excluding external correspondents). </td></tr><tr><td><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- LEFT JOIN  6  SELECT emp.ID,emp.Name,emp.DepartmentID,dep.ID,dep.Name FROM Employees emp LEFT JOIN Departments dep ON emp.DepartmentID=dep.ID</span></span></code> </pre> </td><td>  Will return all employees.  For those employees who do not have the DepartmentID specified, the ‚Äúdep.ID‚Äù and ‚Äúdep.Name‚Äù fields will contain NULL. <br>  Remember that NULL values ‚Äã‚Äãcan be processed, for example, with the help of ISNULL (dep. Name, 'out of state'), for example. <br>  This type of connection can be used when it is important for us to obtain data on all employees, for example, to get a list for the calculation of the salary. </td></tr><tr><td><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- RIGHT JOIN  7  SELECT emp.ID,emp.Name,emp.DepartmentID,dep.ID,dep.Name FROM Employees emp RIGHT JOIN Departments dep ON emp.DepartmentID=dep.ID</span></span></code> </pre> </td><td>  Here we got holes on the left, i.e.  there is a department, but there are no employees in this department. <br>  Such a connection can be used, for example, when you need to find out which departments are occupied and who we are and who have not yet been formed.  This information can be used to search and receive new employees from which the department will be formed. </td></tr><tr><td><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- FULL JOIN  8  SELECT emp.ID,emp.Name,emp.DepartmentID,dep.ID,dep.Name FROM Employees emp FULL JOIN Departments dep ON emp.DepartmentID=dep.ID</span></span></code> </pre> </td><td>  This query is important when we need to get all the data on employees and all the data on the existing departments.  Accordingly, we get holes (NULL-values) either by employees or by departments (freelancers). <br>  This request, for example, can be used to check whether all employees are in the right departments, because  maybe some employees who are listed as freelancers simply forgot to specify a department. </td></tr><tr><td><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- CROSS JOIN  30  - (6   Employees) * (5   Departments) SELECT emp.ID,emp.Name,emp.DepartmentID,dep.ID,dep.Name FROM Employees emp CROSS JOIN Departments dep</span></span></code> </pre> </td><td>  In this form, it is even difficult to think of where this can be applied, so I will show the example with CROSS JOIN below. </td></tr></tbody></table><br>  Note that in case of repeating the DepartmentID values ‚Äã‚Äãin the Employees table, each such row was connected to a row from the Departments table with the same ID, that is, the Departments data merged with all the records for which the condition was fulfilled (emp.DepartmentID = dep.ID): <br><br><img src="https://habrastorage.org/files/30e/c9c/a86/30ec9ca86c6b465c838a353597a08f08.png"><br><br>  In our case, everything turned out right, i.e.  we supplemented the Employees table with data from the Departments table.  I specifically drew attention to this, because  there are times when we do not need this behavior.  For the demonstration, we set the task - for each department to bring out the last employee who has been received, if there are no employees, then simply print the name of the department.  Perhaps such a solution suggests itself - just take the previous query and change the connection condition to RIGHT JOIN, plus rearrange the fields in some places: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> dep.ID,dep.Name,emp.ID,emp.Name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees emp <span class="hljs-keyword"><span class="hljs-keyword">RIGHT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Departments dep <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> emp.DepartmentID=dep.ID</code> </pre><br><table><tbody><tr><th>  ID </th><th>  Name </th><th>  ID </th><th>  Name </th></tr><tr><td>  one </td><td>  Administration </td><td>  1000 </td><td>  Ivanov I.I. </td></tr><tr><td>  2 </td><td>  Accounting </td><td>  1002 </td><td>  Sidorov S.S. </td></tr><tr><td>  3 </td><td>  IT </td><td>  1001 </td><td>  Petrov P.P. </td></tr><tr><td>  3 </td><td>  IT </td><td>  1003 </td><td>  Andreev A.A. </td></tr><tr><td>  3 </td><td>  IT </td><td>  1004 </td><td>  Nikolaev N.N. </td></tr><tr><td>  four </td><td>  Marketing and advertising </td><td>  Null </td><td>  Null </td></tr><tr><td>  five </td><td>  Logistics </td><td>  Null </td><td>  Null </td></tr></tbody></table><br>  But for the IT department, we got three lines, when we needed only a line with the last employee we took, i.e.  Nikolayev N.N. <br><br>  A task of this kind can be solved, for example, by using a subquery: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> dep.ID,dep.Name,emp.ID,emp.Name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees emp <span class="hljs-comment"><span class="hljs-comment">/*      ( - MAX(ID))      (GROUP BY DepartmentID) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) MaxEmployeeID <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> DepartmentID ) lastEmp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> emp.ID=lastEmp.MaxEmployeeID <span class="hljs-keyword"><span class="hljs-keyword">RIGHT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Departments dep <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> emp.DepartmentID=dep.ID <span class="hljs-comment"><span class="hljs-comment">--   Departments</span></span></code> </pre><br><table><tbody><tr><th>  ID </th><th>  Name </th><th>  ID </th><th>  Name </th></tr><tr><td>  one </td><td>  Administration </td><td>  1000 </td><td>  Ivanov I.I. </td></tr><tr><td>  2 </td><td>  Accounting </td><td>  1002 </td><td>  Sidorov S.S. </td></tr><tr><td>  3 </td><td>  IT </td><td>  1004 </td><td>  Nikolaev N.N. </td></tr><tr><td>  four </td><td>  Marketing and advertising </td><td>  Null </td><td>  Null </td></tr><tr><td>  five </td><td>  Logistics </td><td>  Null </td><td>  Null </td></tr></tbody></table><br>  With the help of pre-combining Employees with subquery data, we were able to leave only the employees we need to connect to Departments. <br><br>  Here we smoothly turn to the use of subqueries.  I think using them in this form should be clear to you on an intuitive level.  That is, the subquery is substituted into the place of the table and plays its role, nothing complicated.  We will return to the topic of subqueries separately. <br><br>  See separately what the subquery returns: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) MaxEmployeeID <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> DepartmentID</code> </pre><br><table><tbody><tr><th>  MaxEmployeeID </th></tr><tr><td>  1005 </td></tr><tr><td>  1000 </td></tr><tr><td>  1002 </td></tr><tr><td>  1004 </td></tr></tbody></table><br>  Those.  he returned only the identifiers of the last employees he received, in the context of the departments. <br><br>  Connections are performed sequentially from top to bottom, building up like a snowball that rolls down a mountain.  First, the ‚ÄúEmployees emp JOIN (Subquery) lastEmp‚Äù is connected, forming a new output set: <br><br><img src="https://habrastorage.org/files/39e/5f2/510/39e5f25102ca4b4cbb67e760d455b0f2.png"><br><br>  Then comes the combination of the set obtained by ‚ÄúEmployees emp JOIN (Subquery) lastEmp‚Äù (let's call it conditionally ‚ÄúLastResult‚Äù) with Departments, i.e.  ‚ÄúLast Result RIGHT JOIN Departments dep‚Äù: <br><br><img src="https://habrastorage.org/files/30b/a2c/d4f/30ba2cd4f2ef447ba31a7db92ba35d51.png"><br><br><h2>  Independent work to secure the material </h2><br>  If you are a beginner, then you definitely need to work through each JOIN-design, until you understand 100% how each type of connection works and correctly represent the result of what kind will be obtained as a result. <br><br>  To consolidate the material about the JOIN-connection, we will do the following: <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--   LeftTable  RightTable TRUNCATE TABLE LeftTable TRUNCATE TABLE RightTable GO --       INSERT LeftTable(LCode,LDescr)VALUES (1,'L-1'), (2,'L-2a'), (2,'L-2b'), (3,'L-3'), (5,'L-5') INSERT RightTable(RCode,RDescr)VALUES (2,'B-2a'), (2,'B-2b'), (3,'B-3'), (4,'B-4')</span></span></code> </pre><br><br>  Let's see what is in the tables: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> LeftTable</code> </pre><br><table><tbody><tr><th>  LCode </th><th>  Ldescr </th></tr><tr><td>  one </td><td>  L-1 </td></tr><tr><td>  2 </td><td>  L-2a </td></tr><tr><td>  2 </td><td>  L-2b </td></tr><tr><td>  3 </td><td>  L-3 </td></tr><tr><td>  five </td><td>  L-5 </td></tr></tbody></table><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> RightTable</code> </pre><br><table><tbody><tr><th>  RCode </th><th>  RDescr </th></tr><tr><td>  2 </td><td>  B-2a </td></tr><tr><td>  2 </td><td>  B-2b </td></tr><tr><td>  3 </td><td>  B-3 </td></tr><tr><td>  four </td><td>  B-4 </td></tr></tbody></table><br><br>  Now try to figure out for yourself how each line of the query turned out with each type of connection (Excel to help you): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> l.*,r.* <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> LeftTable l <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> RightTable r <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> l.LCode=r.RCode</code> </pre><br><table><tbody><tr><th>  LCode </th><th>  Ldescr </th><th>  RCode </th><th>  RDescr </th></tr><tr><td>  2 </td><td>  L-2a </td><td>  2 </td><td>  B-2a </td></tr><tr><td>  2 </td><td>  L-2a </td><td>  2 </td><td>  B-2b </td></tr><tr><td>  2 </td><td>  L-2b </td><td>  2 </td><td>  B-2a </td></tr><tr><td>  2 </td><td>  L-2b </td><td>  2 </td><td>  B-2b </td></tr><tr><td>  3 </td><td>  L-3 </td><td>  3 </td><td>  B-3 </td></tr></tbody></table><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> l.*,r.* <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> LeftTable l <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> RightTable r <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> l.LCode=r.RCode</code> </pre><br><table><tbody><tr><th>  LCode </th><th>  Ldescr </th><th>  RCode </th><th>  RDescr </th></tr><tr><td>  one </td><td>  L-1 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2 </td><td>  L-2a </td><td>  2 </td><td>  B-2a </td></tr><tr><td>  2 </td><td>  L-2a </td><td>  2 </td><td>  B-2b </td></tr><tr><td>  2 </td><td>  L-2b </td><td>  2 </td><td>  B-2a </td></tr><tr><td>  2 </td><td>  L-2b </td><td>  2 </td><td>  B-2b </td></tr><tr><td>  3 </td><td>  L-3 </td><td>  3 </td><td>  B-3 </td></tr><tr><td>  five </td><td>  L-5 </td><td>  Null </td><td>  Null </td></tr></tbody></table><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> l.*,r.* <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> LeftTable l <span class="hljs-keyword"><span class="hljs-keyword">RIGHT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> RightTable r <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> l.LCode=r.RCode</code> </pre><br><table><tbody><tr><th>  LCode </th><th>  Ldescr </th><th>  RCode </th><th>  RDescr </th></tr><tr><td>  2 </td><td>  L-2a </td><td>  2 </td><td>  B-2a </td></tr><tr><td>  2 </td><td>  L-2b </td><td>  2 </td><td>  B-2a </td></tr><tr><td>  2 </td><td>  L-2a </td><td>  2 </td><td>  B-2b </td></tr><tr><td>  2 </td><td>  L-2b </td><td>  2 </td><td>  B-2b </td></tr><tr><td>  3 </td><td>  L-3 </td><td>  3 </td><td>  B-3 </td></tr><tr><td>  Null </td><td>  Null </td><td>  four </td><td>  B-4 </td></tr></tbody></table><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> l.*,r.* <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> LeftTable l <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> RightTable r <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> l.LCode=r.RCode</code> </pre><br><table><tbody><tr><th>  LCode </th><th>  Ldescr </th><th>  RCode </th><th>  RDescr </th></tr><tr><td>  one </td><td>  L-1 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2 </td><td>  L-2a </td><td>  2 </td><td>  B-2a </td></tr><tr><td>  2 </td><td>  L-2a </td><td>  2 </td><td>  B-2b </td></tr><tr><td>  2 </td><td>  L-2b </td><td>  2 </td><td>  B-2a </td></tr><tr><td>  2 </td><td>  L-2b </td><td>  2 </td><td>  B-2b </td></tr><tr><td>  3 </td><td>  L-3 </td><td>  3 </td><td>  B-3 </td></tr><tr><td>  five </td><td>  L-5 </td><td>  Null </td><td>  Null </td></tr><tr><td>  Null </td><td>  Null </td><td>  four </td><td>  B-4 </td></tr></tbody></table><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> l.*,r.* <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> LeftTable l <span class="hljs-keyword"><span class="hljs-keyword">CROSS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> RightTable r</code> </pre><br><table><tbody><tr><th>  LCode </th><th>  Ldescr </th><th>  RCode </th><th>  RDescr </th></tr><tr><td>  one </td><td>  L-1 </td><td>  2 </td><td>  B-2a </td></tr><tr><td>  2 </td><td>  L-2a </td><td>  2 </td><td>  B-2a </td></tr><tr><td>  2 </td><td>  L-2b </td><td>  2 </td><td>  B-2a </td></tr><tr><td>  3 </td><td>  L-3 </td><td>  2 </td><td>  B-2a </td></tr><tr><td>  five </td><td>  L-5 </td><td>  2 </td><td>  B-2a </td></tr><tr><td>  one </td><td>  L-1 </td><td>  2 </td><td>  B-2b </td></tr><tr><td>  2 </td><td>  L-2a </td><td>  2 </td><td>  B-2b </td></tr><tr><td>  2 </td><td>  L-2b </td><td>  2 </td><td>  B-2b </td></tr><tr><td>  3 </td><td>  L-3 </td><td>  2 </td><td>  B-2b </td></tr><tr><td>  five </td><td>  L-5 </td><td>  2 </td><td>  B-2b </td></tr><tr><td>  one </td><td>  L-1 </td><td>  3 </td><td>  B-3 </td></tr><tr><td>  2 </td><td>  L-2a </td><td>  3 </td><td>  B-3 </td></tr><tr><td>  2 </td><td>  L-2b </td><td>  3 </td><td>  B-3 </td></tr><tr><td>  3 </td><td>  L-3 </td><td>  3 </td><td>  B-3 </td></tr><tr><td>  five </td><td>  L-5 </td><td>  3 </td><td>  B-3 </td></tr><tr><td>  one </td><td>  L-1 </td><td>  four </td><td>  B-4 </td></tr><tr><td>  2 </td><td>  L-2a </td><td>  four </td><td>  B-4 </td></tr><tr><td>  2 </td><td>  L-2b </td><td>  four </td><td>  B-4 </td></tr><tr><td>  3 </td><td>  L-3 </td><td>  four </td><td>  B-4 </td></tr><tr><td>  five </td><td>  L-5 </td><td>  four </td><td>  B-4 </td></tr></tbody></table><br><br><h2>  Once again about JOIN connections </h2><br>  Another example using multiple sequential join operations.  Here, the repetition was not intentional, it turned out - not to throw away the same material.  ;) But nothing "repetition - the mother of learning." <br><br>  If several join operations are used, then they are applied sequentially from top to bottom.  Roughly speaking, after each connection a new set is created and the next connection is already happening with this extended set.  Consider a simple example: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> e.ID, e.Name EmployeeName, p.Name PositionName, d.Name DepartmentName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees e <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Departments d <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> e.DepartmentID=d.ID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Positions p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> e.PositionID=p.ID</code> </pre><br><br>  First of all, we selected all the entries in the Employees table: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> e.* <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees e <span class="hljs-comment"><span class="hljs-comment">-- 1</span></span></code> </pre><br><br>  Next was a connection to the Departments table: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> e.*, <span class="hljs-comment"><span class="hljs-comment">--   Employees d.* --   (e.DepartmentID=d.ID)  Departments FROM Employees e -- 1 LEFT JOIN Departments d ON e.DepartmentID=d.ID -- 2</span></span></code> </pre><br><br>  Next is the connection of this set with the table Positions: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> e.*, <span class="hljs-comment"><span class="hljs-comment">--   Employees d.*, --   (e.DepartmentID=d.ID)  Departments p.* --   (e.PositionID=p.ID)  Positions FROM Employees e -- 1 LEFT JOIN Departments d ON e.DepartmentID=d.ID -- 2 LEFT JOIN Positions p ON e.PositionID=p.ID -- 3</span></span></code> </pre><br><br>  Those.  it looks like this: <br><br><img src="https://habrastorage.org/files/38b/add/e78/38badde78e474befb2c73ba8278c9a4b.png"><br><br>  And last but not least, we are returning the data that we ask to display: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> e.ID, <span class="hljs-comment"><span class="hljs-comment">-- 1.   e.Name EmployeeName, -- 2.   p.Name PositionName, -- 3.   d.Name DepartmentName -- 4.   FROM Employees e LEFT JOIN Departments d ON e.DepartmentID=d.ID LEFT JOIN Positions p ON e.PositionID=p.ID</span></span></code> </pre><br><br>  Accordingly, the WHERE filter and ORDER BY sorting can be applied to all of this resulting set: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> e.ID, <span class="hljs-comment"><span class="hljs-comment">-- 1.   e.Name EmployeeName, -- 2.   p.Name PositionName, -- 3.   d.Name DepartmentName -- 4.   FROM Employees e LEFT JOIN Departments d ON e.DepartmentID=d.ID LEFT JOIN Positions p ON e.PositionID=p.ID WHERE d.ID=3 --     ID  Departments AND p.ID=3 --     ID  Positions ORDER BY e.Name --     Name  Employees</span></span></code> </pre><br><table><tbody><tr><th>  ID </th><th>  EmployeeName </th><th>  PositionName </th><th>  DepartmentName </th></tr><tr><td>  1004 </td><td>  Nikolaev N.N. </td><td>  Programmer </td><td>  IT </td></tr><tr><td>  1001 </td><td>  Petrov P.P. </td><td>  Programmer </td><td>  IT </td></tr></tbody></table><br>  That is, the last set received is the same table over which you can perform a basic query: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span>] _  * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span>  <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span>  <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> _</code> </pre><br><br>  That is, if earlier only one table acted as a source, now we simply substitute our expression for this place: <br><br><pre> <code class="sql hljs">Employees e LEFT JOIN Departments d ON e.DepartmentID=d.ID LEFT JOIN Positions p ON e.PositionID=p.ID</code> </pre><br><br>  As a result, we get the same basic query: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> e.ID, e.Name EmployeeName, p.Name PositionName, d.Name DepartmentName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-comment"><span class="hljs-comment">/*  -  */</span></span> Employees e <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Departments d <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> e.DepartmentID=d.ID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Positions p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> e.PositionID=p.ID <span class="hljs-comment"><span class="hljs-comment">/*  -  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> d.ID=<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.ID=<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> e.Name</code> </pre><br><br>  And now, apply grouping: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ISNULL</span></span>(dep.Name,<span class="hljs-string"><span class="hljs-string">''</span></span>) DepName, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> emp.PositionID) PositionCount, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) EmplCount, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(emp.Salary) SalaryAmount, <span class="hljs-keyword"><span class="hljs-keyword">AVG</span></span>(emp.Salary) SalaryAvg <span class="hljs-comment"><span class="hljs-comment">--     FROM /*  -  */ Employees emp LEFT JOIN Departments dep ON emp.DepartmentID=dep.ID /*  -  */ GROUP BY emp.DepartmentID,dep.Name ORDER BY DepName</span></span></code> </pre><br><br>  You see, we are still spinning around the base structures, now I hope it‚Äôs clear why it‚Äôs very important to understand them first of all. <br><br>  And as we have seen, in a query, a subquery can be in place of any table.  In turn, subqueries can be nested in subqueries.  And all these subqueries are basic constructs too.  That is, the basic design, these are the bricks from which any query is built. <br><br><h2>  CROSS JOIN promised example </h2><br>  Let's use the CROSS JOIN connection to calculate how many employees, in which department, and in which positions.  For each department we will list all existing posts: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> d.Name DepartmentName, p.Name PositionName, e.EmplCount <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Departments d <span class="hljs-keyword"><span class="hljs-keyword">CROSS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Positions p <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> ( <span class="hljs-comment"><span class="hljs-comment">/*           (DepartmentID,PositionID) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> DepartmentID,PositionID,<span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) EmplCount <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> DepartmentID,PositionID ) e <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> e.DepartmentID=d.ID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> e.PositionID=p.ID <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> DepartmentName,PositionName</code> </pre><br><br><img src="https://habrastorage.org/files/02e/b51/cdb/02eb51cdb7494a3eba12ea49eb373389.png"><br><br>  In this case, the connection was first performed using a CROSS JOIN, and then a connection was made to the received set with the data from the subquery using the LEFT JOIN.  Instead of a table in the LEFT JOIN, we used a subquery. <br><br>        ,     ¬´e¬ª.          ,     : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> DepartmentID,PositionID,<span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) EmplCount <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> DepartmentID,PositionID</code> </pre><br><table><tbody><tr><th> DepartmentID </th><th> PositionID </th><th> EmplCount </th></tr><tr><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  2 </td><td>  one </td><td>  one </td></tr><tr><td>  one </td><td>  2 </td><td>  one </td></tr><tr><td>  3 </td><td>  3 </td><td>  2 </td></tr><tr><td>  3 </td><td>  four </td><td>  one </td></tr></tbody></table><br>    ¬´e¬ª     DepartmentID, PositionID  EmplCount.        ,       . ,    , <br>   ,   ,        . <br><br><h2>    WHERE- </h2><br>       JOIN-: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> emp.ID,emp.Name,emp.DepartmentID,dep.ID,dep.Name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees emp <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Departments dep <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> emp.DepartmentID=dep.ID <span class="hljs-comment"><span class="hljs-comment">--    WHERE emp.DepartmentID=3 --   </span></span></code> </pre><br><br>  WHERE-    : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> emp.ID,emp.Name,emp.DepartmentID,dep.ID,dep.Name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees emp, Departments dep <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> emp.DepartmentID=dep.ID <span class="hljs-comment"><span class="hljs-comment">--    AND emp.DepartmentID=3 --   </span></span></code> </pre><br><br>   ,       (emp.DepartmentID=dep.ID)    (emp.DepartmentID=3). <br><br>  ,   CROSS JOIN: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> emp.ID,emp.Name,emp.DepartmentID,dep.ID,dep.Name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees emp <span class="hljs-keyword"><span class="hljs-keyword">CROSS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Departments dep <span class="hljs-comment"><span class="hljs-comment">--   (  ) WHERE emp.DepartmentID=3 --   </span></span></code> </pre><br><br>  WHERE-    : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> emp.ID,emp.Name,emp.DepartmentID,dep.ID,dep.Name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees emp, Departments dep <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> emp.DepartmentID=<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-comment"><span class="hljs-comment">--   </span></span></code> </pre><br><br>  Those.           Employees  Departments.    ? ,  -        ¬´ ,        (emp.DepartmentID=dep.ID)¬ª   ,   ,   .       , ..   CROSS JOIN.  ,     ,    ,    ,   CROSS JOIN. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For the query optimizer, it can be no matter how you implement the connection (using WHERE or JOIN), it can do them exactly the same. </font><font style="vertical-align: inherit;">But for reasons of understanding the code, I would recommend in modern DBMS to try never to make the connection of tables using WHERE conditions. </font><font style="vertical-align: inherit;">To use WHERE conditions for the connection, in the event that the JOIN constructions are implemented in the DBMS, I would now call it the moveton. </font><font style="vertical-align: inherit;">WHERE conditions are used to filter the set, and there is no need to mix the conditions used for the connection with the conditions responsible for filtering. </font><font style="vertical-align: inherit;">But if you have come to the conclusion that you cannot do without implementing a connection via WHERE, then of course the priority for the task is solved and ‚Äúto hell with all foundations‚Äù.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UNION unions - operations of vertical unification of query results </font></font></h2><br>         , .. ,         . <br><br>            : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> Info, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> PositionID) PositionCount, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) EmplCount, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(Salary) SalaryAmount <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> DepartmentID=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-comment"><span class="hljs-comment">--    SELECT '' Info, COUNT(DISTINCT PositionID) PositionCount, COUNT(*) EmplCount, SUM(Salary) SalaryAmount FROM Employees WHERE DepartmentID=2 --    SELECT '' Info, COUNT(DISTINCT PositionID) PositionCount, COUNT(*) EmplCount, SUM(Salary) SalaryAmount FROM Employees WHERE DepartmentID=3 --     SELECT '' Info, COUNT(DISTINCT PositionID) PositionCount, COUNT(*) EmplCount, SUM(Salary) SalaryAmount FROM Employees WHERE DepartmentID IS NULL --       </span></span></code> </pre><br><br>  ,     ,    ,   ,         UNION ALL,          : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> Info, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> PositionID) PositionCount, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) EmplCount, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(Salary) SalaryAmount <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> DepartmentID=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-comment"><span class="hljs-comment">--    UNION ALL SELECT '' Info, COUNT(DISTINCT PositionID) PositionCount, COUNT(*) EmplCount, SUM(Salary) SalaryAmount FROM Employees WHERE DepartmentID=2 --    UNION ALL SELECT '' Info, COUNT(DISTINCT PositionID) PositionCount, COUNT(*) EmplCount, SUM(Salary) SalaryAmount FROM Employees WHERE DepartmentID=3 --     UNION ALL SELECT '' Info, COUNT(DISTINCT PositionID) PositionCount, COUNT(*) EmplCount, SUM(Salary) SalaryAmount FROM Employees WHERE DepartmentID IS NULL --       </span></span></code> </pre><br><br><img src="https://habrastorage.org/files/4f5/ab9/7ef/4f5ab97ef89a48bfbacbaebfaeb97c30.png"><br><br>  Those. UNION ALL   ,       . <br><br>         ,         , ..   ,   ,     .. <br><br><h3>  Some theory </h3><br>  MS SQL     : <br><table><tbody><tr><th width="200">  Operation </th><th>  Description </th></tr><tr><td> UNION ALL </td><td>        . (A+B) </td></tr><tr><td>  UNION </td><td>        . DISTINCT(A+B) </td></tr><tr><td> EXCEPT </td><td>       ,     .  2- . DISTINCT(AB) </td></tr><tr><td> INTERSECT </td><td>      ,    .  2- . DISTINCT(A&amp;B) </td></tr></tbody></table><br>       . <br><br>  2     : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> TopTable( T1 <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, T2 <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> BottomTable( B1 <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, B2 <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> TopTable(T1,T2)<span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">'Text 1'</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">'Text 1'</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-string"><span class="hljs-string">'Text 2'</span></span>), (<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-string"><span class="hljs-string">'Text 3'</span></span>), (<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-string"><span class="hljs-string">'Text 4'</span></span>), (<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-string"><span class="hljs-string">'Text 5'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> BottomTable(B1,B2)<span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-string"><span class="hljs-string">'Text 2'</span></span>), (<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-string"><span class="hljs-string">'Text 3'</span></span>), (<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-string"><span class="hljs-string">'Text 6'</span></span>), (<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-string"><span class="hljs-string">'Text 6'</span></span>)</code> </pre><br><br>   : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> TopTable</code> </pre><br><table><tbody><tr><th> T1 </th><th> T2 </th></tr><tr><td>  one </td><td> Text 1 </td></tr><tr><td>  one </td><td> Text 1 </td></tr><tr><td>  2 </td><td> Text 2 </td></tr><tr><td>  3 </td><td> Text 3 </td></tr><tr><td>  four </td><td> Text 4 </td></tr><tr><td>  five </td><td> Text 5 </td></tr></tbody></table><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> BottomTable</code> </pre><br><table><tbody><tr><th> B1 </th><th> B2 </th></tr><tr><td>  2 </td><td> Text 2 </td></tr><tr><td>  3 </td><td> Text 3 </td></tr><tr><td>  6 </td><td> Text 6 </td></tr><tr><td>  6 </td><td> Text 6 </td></tr></tbody></table><br><br><h3> UNION ALL </h3><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> T1 x,T2 y <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> TopTable <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> ALL <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> B1,B2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> BottomTable</code> </pre><br><br><img src="https://habrastorage.org/files/776/840/547/776840547abf4267b5dbfeab0ffe1ae2.png"><br><br><h3>  UNION </h3><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> T1 x,T2 y <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> TopTable <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> B1,B2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> BottomTable</code> </pre><br><br>   UNION  ,  UNION ALL,     DISTINCT: <br><br><img src="https://habrastorage.org/files/b90/e45/62c/b90e4562cb1d4acab3ab5d09d9872eee.png"><br><br><h3> EXCEPT </h3><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> T1 x,T2 y <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> TopTable <span class="hljs-keyword"><span class="hljs-keyword">EXCEPT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> B1,B2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> BottomTable</code> </pre><br><br><img src="https://habrastorage.org/files/830/ce9/88a/830ce988a272464db7d6c8dfd7af0741.png"><br><br><h3> INTERSECT </h3><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> T1 x,T2 y <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> TopTable <span class="hljs-keyword"><span class="hljs-keyword">INTERSECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> B1,B2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> BottomTable</code> </pre><br><br><img src="https://habrastorage.org/files/de7/899/51d/de789951de1a4e5cb930bdabdc566954.png"><br><br><h2>    UNION- </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">That's basically all that concerns vertical joins, it is much easier than JOIN joins. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Most often, UNION ALL is used in my practice, but other types of vertical unions also find their application. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With several operations vertically merging, it is not guaranteed that they will be performed sequentially from top to bottom. </font><font style="vertical-align: inherit;">Create another table and consider it with an example:</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> NextTable( N1 <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, N2 <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> NextTable(N1,N2)<span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">'Text 1'</span></span>), (<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-string"><span class="hljs-string">'Text 4'</span></span>), (<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-string"><span class="hljs-string">'Text 6'</span></span>)</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> For example, if we write simply: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> T1 x,T2 y <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> TopTable <span class="hljs-keyword"><span class="hljs-keyword">EXCEPT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> B1,B2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> BottomTable <span class="hljs-keyword"><span class="hljs-keyword">INTERSECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> N1,N2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> NextTable</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Then we get: </font></font><br><table><tbody><tr><th>  x </th><th>  y </th></tr><tr><td>  one </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Text 1 </font></font></td></tr><tr><td>  2 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Text 2 </font></font></td></tr><tr><td>  3 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Text 3 </font></font></td></tr><tr><td>  four </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Text 4 </font></font></td></tr><tr><td>  five </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Text 5 </font></font></td></tr></tbody></table><br><br>  Those.    INTERSECT,   EXCEPT.       , ..  -. <br><br>      ,      , ,     ,      ,         ,  ,     EXCEPT,   INTERSECT: <br><br><pre> <code class="sql hljs">( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> T1 x,T2 y <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> TopTable <span class="hljs-keyword"><span class="hljs-keyword">EXCEPT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> B1,B2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> BottomTable ) <span class="hljs-keyword"><span class="hljs-keyword">INTERSECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> N1,N2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> NextTable</code> </pre><br><table><tbody><tr><th>  x </th><th>  y </th></tr><tr><td>  one </td><td> Text 1 </td></tr><tr><td>  four </td><td> Text 4 </td></tr></tbody></table><br>     ,   . <br><br>          ,     : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> x,y <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> T1 x,T2 y <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> TopTable <span class="hljs-keyword"><span class="hljs-keyword">EXCEPT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> B1,B2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> BottomTable ) q <span class="hljs-keyword"><span class="hljs-keyword">INTERSECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> N1,N2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> NextTable</code> </pre><br><br>   ORDER BY     : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> T1 x,T2 y <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> TopTable <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> ALL <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> B1,B2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> BottomTable <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> ALL <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> B1,B2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> BottomTable <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre><br><br>        ,    . <br><br>    UNION-   ,     UNION- . <br><br><blockquote>  <b>Note.</b>   Oracle      ,     EXCEPT,    MINUS. </blockquote><br><br><h2>   </h2><br>      , ..         .               . <br><br>        FROM.  ,        . ,      .       2- : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> q1.x1,q1.y1,q2.x2,q2.y2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> T1 x1,T2 y1 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> TopTable <span class="hljs-keyword"><span class="hljs-keyword">EXCEPT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> B1,B2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> BottomTable ) q1 <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> T1 x2,T2 y2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> TopTable <span class="hljs-keyword"><span class="hljs-keyword">EXCEPT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> N1,N2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> NextTable ) q2 <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> q1.x1=q2.x2</code> </pre><br><br>   , ,      .  Those.  ,     ¬´q1¬ª, ,     ¬´q2¬ª,     JOIN    ¬´q1¬ª  ¬´q2¬ª. <br><br><h2>  WITH </h2><br>           . <br><br>  Compare: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> q1.x1,q1.y1,q2.x2,q2.y2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> T1 x1,T2 y1 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> TopTable <span class="hljs-keyword"><span class="hljs-keyword">EXCEPT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> B1,B2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> BottomTable ) q1 <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> T1 x2,T2 y2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> TopTable <span class="hljs-keyword"><span class="hljs-keyword">EXCEPT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> N1,N2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> NextTable ) q2 <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> q1.x1=q2.x2</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The same is written with WITH: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> q1 <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> T1 x1,T2 y1 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> TopTable <span class="hljs-keyword"><span class="hljs-keyword">EXCEPT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> B1,B2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> BottomTable ), q2 <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> T1 x2,T2 y2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> TopTable <span class="hljs-keyword"><span class="hljs-keyword">EXCEPT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> N1,N2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> NextTable ) <span class="hljs-comment"><span class="hljs-comment">--      SELECT q1.x1,q1.y1,q2.x2,q2.y2 FROM q1 JOIN q2 ON q1.x1=q2.x2</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As you can see, large subqueries are rendered and named in the WITH block, which made it possible to unload the text of the main query and make it understandable. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let us also recall the example from the previous part, where the ViewEmployeesInfo view was used:</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> ViewEmployeesInfo <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> emp.*, <span class="hljs-comment"><span class="hljs-comment">--     Employees dep.Name DepartmentName, --      Name   Departments pos.Name PositionName --     Name   Positions FROM Employees emp LEFT JOIN Departments dep ON emp.DepartmentID=dep.ID LEFT JOIN Positions pos ON emp.PositionID=pos.ID</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And the query that used this presentation: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> DepartmentName, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> PositionID) PositionCount, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) EmplCount, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(Salary) SalaryAmount, <span class="hljs-keyword"><span class="hljs-keyword">AVG</span></span>(Salary) SalaryAvg <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ViewEmployeesInfo emp <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> DepartmentID,DepartmentName <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> DepartmentName</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In essence, WITH allows us to place text from the view directly in the request, i.e. </font><font style="vertical-align: inherit;">the meaning is the same:</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> cteEmployeesInfo <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> emp.*, <span class="hljs-comment"><span class="hljs-comment">--     Employees dep.Name DepartmentName, --      Name   Departments pos.Name PositionName --     Name   Positions FROM Employees emp LEFT JOIN Departments dep ON emp.DepartmentID=dep.ID LEFT JOIN Positions pos ON emp.PositionID=pos.ID ) SELECT DepartmentName, COUNT(DISTINCT PositionID) PositionCount, COUNT(*) EmplCount, SUM(Salary) SalaryAmount, AVG(Salary) SalaryAvg FROM cteEmployeesInfo emp GROUP BY DepartmentID,DepartmentName ORDER BY DepartmentName</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Only in the case of a created view, we can use it from different requests, since </font><font style="vertical-align: inherit;">The view is created at the database level. </font><font style="vertical-align: inherit;">Whereas the subquery issued in the WITH block is visible only within the framework of this query.</font></font><br><br><blockquote> <b> WITH -  CTE-:</b> <br>    (CTE ‚Äî Common Table Expressions)     ,          . CTE   ,       ,     . <br><br>  CTE     ,       . <br></blockquote><br><br>      .         ( ,     Employees ,     ). <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> cteEmpl <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">300</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span> EmpLevel <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ManagerID <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-comment"><span class="hljs-comment">--       UNION ALL SELECT emp.ID,CAST(SPACE(cte.EmpLevel*5)+emp.Name AS nvarchar(300)),cte.EmpLevel+1 FROM Employees emp JOIN cteEmpl cte ON emp.ManagerID=cte.ID ) SELECT * FROM cteEmpl</span></span></code> </pre><br><table><tbody><tr><th>  ID </th><th>  Name </th><th> EmpLevel </th></tr><tr><td>  1000 </td><td>  Ivanov I.I. </td><td>  one </td></tr><tr><td>  1002 </td><td> _____ .. </td><td>  2 </td></tr><tr><td>  1003 </td><td> _____ .. </td><td>  2 </td></tr><tr><td>  1005 </td><td> _____ .. </td><td>  2 </td></tr><tr><td>  1001 </td><td> __________ .. </td><td>  3 </td></tr><tr><td>  1004 </td><td> __________ .. </td><td>  3 </td></tr></tbody></table><br>      . <br><br> ,    ,       .  ,      ,        .              ,    ,       .   ,   ,        . <br><br><h2>     </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's now look at how you can still use subqueries, and also pass parameters to them using an alias from the main query. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here I will no longer go deeply into the explanation, since </font><font style="vertical-align: inherit;">By this stage you should have already learned to think and understand the principle of working with data. </font><font style="vertical-align: inherit;">Be sure to practice, follow the examples and try and understand the result. </font><font style="vertical-align: inherit;">To understand, you need to feel each example itself.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The subquery can be used in the SELECT block </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Let's return to our report: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> DepartmentID, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> PositionID) PositionCount, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) EmplCount, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(Salary) SalaryAmount, <span class="hljs-keyword"><span class="hljs-keyword">AVG</span></span>(Salary) SalaryAvg <span class="hljs-comment"><span class="hljs-comment">--     FROM Employees GROUP BY DepartmentID</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Here the department name can also be obtained using a subquery with the parameter: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-comment"><span class="hljs-comment">/*                 */</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Departments dep <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> dep.ID=emp.DepartmentID) DepartmentName, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> PositionID) PositionCount, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) EmplCount, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(Salary) SalaryAmount, <span class="hljs-keyword"><span class="hljs-keyword">AVG</span></span>(Salary) SalaryAvg <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees emp <span class="hljs-comment"><span class="hljs-comment">--   GROUP BY DepartmentID ORDER BY DepartmentName</span></span></code> </pre><br><br>     (SELECT Name FROM Departments dep WHERE dep.ID=emp.DepartmentID)  4 , ..    emp.DepartmentID <br><br>            .      ,      TOP,  -  ,      . ,     ID   : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>, <span class="hljs-comment"><span class="hljs-comment">--  1 -  ID  (SELECT MAX(ID) FROM Employees emp WHERE emp.DepartmentID=dep.ID) LastEmpID_var1, --  1 -  ID  (SELECT TOP 1 ID FROM Employees emp WHERE emp.DepartmentID=dep.ID ORDER BY ID DESC) LastEmpID_var2, --  2 -    (SELECT TOP 1 Name FROM Employees emp WHERE emp.DepartmentID=dep.ID ORDER BY ID DESC) LastEmpName FROM Departments dep</span></span></code> </pre><br><br>    ?  Since       4  (   ),   12 . <br><br> ,             , ..           , ..           .            . <br><br><h2>    APPLY </h2><br>  MS SQL   : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>, <span class="hljs-comment"><span class="hljs-comment">--  1 -  ID  (SELECT TOP 1 ID FROM Employees emp WHERE emp.DepartmentID=dep.ID ORDER BY ID DESC) LastEmpID, --  2 -    (SELECT TOP 1 Name FROM Employees emp WHERE emp.DepartmentID=dep.ID ORDER BY ID DESC) LastEmpName FROM Departments dep</span></span></code> </pre><br><br>    APPLY,   2  ‚Äì CROSS APPLY  OUTER APPLY. <br><br>  APPLY     ,    ,     ID  Name      : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>, empInfo.LastEmpID, empInfo.LastEmpName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Departments dep <span class="hljs-keyword"><span class="hljs-keyword">CROSS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">APPLY</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> LastEmpID,<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> LastEmpName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees emp <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> emp.DepartmentID=dep.ID <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> emp.ID <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> ) empInfo</code> </pre><br><table><tbody><tr><th>  ID </th><th>  Name </th><th> LastEmpID </th><th> LastEmpName </th></tr><tr><td>  one </td><td>  Administration </td><td>  1000 </td><td>  Ivanov I.I. </td></tr><tr><td>  2 </td><td>  Accounting </td><td>  1002 </td><td>  .. </td></tr><tr><td>  3 </td><td>  IT </td><td>  1004 </td><td>  .. </td></tr></tbody></table><br>    CROSS APPLY        Departments.     ,       . <br><br>  ,       Departments,       OUTER APPLY: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>, empInfo.LastEmpID, empInfo.LastEmpName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Departments dep <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">APPLY</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> LastEmpID,<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> LastEmpName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees emp <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> emp.DepartmentID=dep.ID <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> emp.ID <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> ) empInfo</code> </pre><br><table><tbody><tr><th>  ID </th><th>  Name </th><th> LastEmpID </th><th> LastEmpName </th></tr><tr><td>  one </td><td>  Administration </td><td>  1000 </td><td>  Ivanov I.I. </td></tr><tr><td>  2 </td><td>  Accounting </td><td>  1002 </td><td>  .. </td></tr><tr><td>  3 </td><td>  IT </td><td>  1004 </td><td>  .. </td></tr><tr><td>  four </td><td>    </td><td>  Null </td><td>  Null </td></tr><tr><td>  five </td><td>  Logistics </td><td>  Null </td><td>  Null </td></tr></tbody></table><br>  ,   ,       .          , ..    ,     ,      .       APPLY, ,  ,     ,      . ,     ,       : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> dep.ID,dep.Name,pos.PositionID,pos.PositionName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Departments dep <span class="hljs-keyword"><span class="hljs-keyword">CROSS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">APPLY</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> PositionID,<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> PositionName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Positions ) pos</code> </pre><br><br><h2>     WHERE </h2><br>    ,      : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Departments dep <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees emp <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> emp.DepartmentID=dep.ID)&gt;<span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre><br><br>       ,           , ..         SELECT. <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> EXISTS and NOT EXISTS constructs </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Allow to check whether there are records corresponding to the condition in the subquery: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--         SELECT * FROM Departments dep WHERE EXISTS(SELECT * FROM Employees emp WHERE emp.DepartmentID=dep.ID)</span></span></code> </pre><br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--        SELECT * FROM Departments dep WHERE NOT EXISTS(SELECT * FROM Employees emp WHERE emp.DepartmentID=dep.ID)</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Everything is simple here - EXISTS returns True if the subquery returns at least one row, and False if the subquery does not return rows. </font><font style="vertical-align: inherit;">NOT EXISTS - inversion of the result.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> IN and NOT IN subquery construction </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Before that, we looked at IN with a listing of values. </font><font style="vertical-align: inherit;">You can also use it with a subquery that returns a list of these values:</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--     SELECT * FROM Departments WHERE ID IN(SELECT DISTINCT DepartmentID FROM Employees WHERE DepartmentID IS NOT NULL)</span></span></code> </pre><br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--     SELECT * FROM Departments WHERE ID NOT IN(SELECT DISTINCT DepartmentID FROM Employees WHERE DepartmentID IS NOT NULL)</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note that I excluded the NULL value using the condition (DepartmentID IS NOT NULL) in the subquery. </font><font style="vertical-align: inherit;">NULL values ‚Äã‚Äãin this case are just as dangerous - see this in the description of the IN construct in the second part.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Group comparison operations ALL and ANY </font></font></h3><br>  ,        .         ,      IN  EXISTS. <br><br>  ALL  ANY    ,      ,      . ,    EXISTS    . <br><br>       ,            .     ALL: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>,DepartmentID,Salary <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees e1 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> e1.Salary&gt;ALL( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> e2.Salary <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees e2 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> e2.DepartmentID=e1.DepartmentID <span class="hljs-comment"><span class="hljs-comment">--       AND e2.ID&lt;&gt;e1.ID --        AND e2.Salary IS NOT NULL --  NULL  )</span></span></code> </pre><br><table><tbody><tr><th>  ID </th><th>  Name </th><th> DepartmentID </th><th> Salary </th></tr><tr><td>  1000 </td><td>  Ivanov I.I. </td><td>  one </td><td>  5000 </td></tr><tr><td>  1002 </td><td>  .. </td><td>  2 </td><td> 2500 </td></tr><tr><td>  1003 </td><td>  .. </td><td>  3 </td><td>  2000 </td></tr><tr><td>  1005 </td><td>  .. </td><td>  Null </td><td>  2000 </td></tr></tbody></table><br>     ,  e1.Salary   e2.Salary,   . <br><br>  ,      ,        ?      ‚Äì  ,    ,       . )))     . <br><br>   ,  ,     ALL   NOT EXISTS: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>,DepartmentID,Salary <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees e1 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees e2 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> e2.DepartmentID=e1.DepartmentID <span class="hljs-comment"><span class="hljs-comment">--       AND e2.Salary&gt;e1.Salary --        )</span></span></code> </pre><br><br>  Those.          ¬´               ¬ª. <br><br>     ALL           . <br><br>    ,   ALL   NULL-  ,         .      ALL    AND, ..  (Salary&gt;1000 AND Salary&gt;1500 AND Salary&gt;NULL)  NULL. <br><br>    ANY (  SOME)  -: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>,DepartmentID,Salary <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees e1 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> e1.Salary&gt;<span class="hljs-keyword"><span class="hljs-keyword">ANY</span></span>( <span class="hljs-comment"><span class="hljs-comment">-- ANY = SOME SELECT e2.Salary FROM Employees e2 WHERE e2.DepartmentID=e1.DepartmentID --       AND e2.ID&lt;&gt;e1.ID --        )</span></span></code> </pre><br><table><tbody><tr><th>  ID </th><th>  Name </th><th> DepartmentID </th><th> Salary </th></tr><tr><td>  1003 </td><td>  .. </td><td>  3 </td><td>  2000 </td></tr></tbody></table><br> C  ANY ,    ,        .  Since        ,  -,     ..,           .  Those.    ,          . <br><br>    ,    ANY   EXISTS: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>,DepartmentID,Salary <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees e1 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees e2 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> e2.DepartmentID=e1.DepartmentID <span class="hljs-comment"><span class="hljs-comment">--       AND e2.Salary&lt;e1.Salary --            )</span></span></code> </pre><br><br>    ¬´   -           ¬ª. <br><br>     ,  ANY   ,     . <br><br>  NULL-      , ..     .      ANY    OR, ..  (Salary&gt;1000 OR Salary&gt;1500 OR Salary&gt;NULL)          . <br><br>  ANY     ,       IN: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Departments <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">ANY</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> DepartmentID <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees)</code> </pre><br><br>     ,    .    : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Departments <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> DepartmentID <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees)</code> </pre><br><br>   ALL  ANY      .           ,               .  Those.            ¬´      ¬ª: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees e1 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> e1.Salary&gt;ALL(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> e2.Salary <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees e2 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> e2.ID&lt;&gt;e1.ID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> e2.Salary <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>)</code> </pre><br><br>      ¬´           ¬ª: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees e1 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees e2 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> e2.Salary&gt;e1.Salary)</code> </pre><br><br>    ,   SQL       ,        . <br><br><h2>      </h2><br>         , ,   HAVING,     CASE.  ,      . <br><br>               SELECT, ,    ,    . <br><br>                   .  ,     SELECT  , .. ,   ,     ,       (  -),       .   ,    ,                , ,   . <br><br>   ,   ‚Äì  , ..          .     ,          ,      .     ,     . <br><br><h2>  Conclusion </h2><br>           SELECT.  ,     ,           ,            . <br><br>    ,          SQL,    10 ,    (   Paradox).   ,            SQL    .    ,        ,    -. ,                   -  ,      .   ,  ,         . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the next part, I will discuss in general terms the data modification operators. In general terms, since this information, like knowledge of DDL, is not needed by everyone (mostly IT professionals) - most people learn SQL precisely in order to learn how to sample data using the SELECT statement. I think the next part will be final. All knowledge gained up to this point will also be useful to us in the next part, since for the correct writing of complex structures for data modification, you need to confidently use the constructions of the SELECT operator. For example, before deleting or modifying a group of rows of a table, we must correctly select this data. Therefore, the next part will also contain SELECT constructs and I think it will be of interest to those people who learn SQL precisely because of the SELECT statement.</font></font><br><br>    ,   ,    .            ¬´SQL-EX.RU ‚Äì    SQL¬ª,               ,      .         SQL.               ,     ,     . <br><br>         ,         : <br><ul><li>  OVER,    : <ul><li>   (COUNT, SUM, MIN, MAX, AVG)   GROUP BY; </li><li>  : ROW_NUMBER(),RANK()  DENSE_RANK(); </li><li>  : LAG()  LEAD(),FIRST_VALUE()  LAST_VALUE(); </li></ul></li><li>      : GROUP BY ROLLUP(‚Ä¶), GROUP BY GROUPING SETS(‚Ä¶), ‚Ä¶         : GROUPING_ID()  GROUPING(); </li><li>  PIVOT, UNPIVOT. </li></ul><br>           ¬´ 1 ‚Äì    SELECT¬ª  ¬´ 2 ‚Äì OVER   ¬ª.           ,     MSDN. <br><br>   . <br><br>   ‚Äî <a href="http://habrahabr.ru/post/256169/">habrahabr.ru/post/256169</a> </div><p>Source: <a href="https://habr.com/ru/post/256045/">https://habr.com/ru/post/256045/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../256029/index.html">Report by Alexey Bragin at the Russian Open Source Summit 2015</a></li>
<li><a href="../256033/index.html">Intel Xeon `s rush into the market fault-tolerant RISC-servers, built on the patterns mainframe</a></li>
<li><a href="../256037/index.html">Vulnerability CVE-2015-1635 (MS15-034) is exploited in-the-wild</a></li>
<li><a href="../256039/index.html">Lectures of the Technosphere. 1 semester Methods of using DBMS in Internet applications</a></li>
<li><a href="../256041/index.html">Your routine is our job.</a></li>
<li><a href="../256047/index.html">Phalcon 2 is out</a></li>
<li><a href="../256049/index.html">Complete energy autonomy or how to survive with solar panels in the outback (part 5. Sun Catcher)</a></li>
<li><a href="../256055/index.html">Working with the Mandrill mail service API</a></li>
<li><a href="../256057/index.html">Java 8: Master the new level of abstraction</a></li>
<li><a href="../256059/index.html">GrabDuck: a new look at bookmarks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>