<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Programming under Windows CE using Embedded Visual C ++, Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This post is for real programmers who, instead of the primer, taught the alphabet on the third edition of the C ++ handbook. We will program in Window...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Programming under Windows CE using Embedded Visual C ++, Part 1</h1><div class="post__text post__text-html js-mediator-article">  This post is for real programmers who, instead of the primer, taught the alphabet on the third edition of the C ++ handbook.  We will program in Windows CE in C ++ using Embedded Visual C ++. <br><br>  So, we will need: <br><a name="habracut"></a><br><br>  1. eMbedded Visual C ++ 4.0 (TRT7H-KD36T-FRH8D-6QH8P-VFJHQ) <br>  2. eMbedded Visual C ++ 4.0 service pack 4 <br>  3. ritti.exe <br>  4. Microsoft Pocket PC 2003 SDK.msi <br>  5. Microsoft ActiveSync <br>  6. StandAlone Emulator 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This kit allows you to develop programs that run on all Windows Mobile since 2003. Forget about innovations in Windows Mobile 5 and 6 (unless you need them :).  All of these products are through Google, but install them a little bit.  Emulator is especially annoying, which requires the installation of the following things in the following order: <br><br>  1. netsvwrap.msi <br>  2. standalone_emulator_V1.exe <br>  3. efp.msi <br>  4. emulator_2_0.msi <br><br>  If you are still here - continue! <br><br>  Briefly, the differences between the WinCE API and the Win32 API are as follows: only Unicode, the absence of the current directory (only absolute paths), cumbersome things are trimmed, the presence of features with input. <br><br>  I created a cross-platform product (under WinCE and Win32).  This is how it is done in a nutshell.  Using UNDER_CE to distinguish the platform: <br><br>  <em>#ifdef UNDER_CE</em> <em><br></em>  <em>// here is code for Windows CE only</em> <em><br></em>  <em>#else</em> <em><br></em>  <em>// code for Windows 32 only</em> <em><br></em>  <em>#endif</em> <em><br></em> <br><br>  WinMain is a little different: <br><br>  <em>#ifdef UNDER_CE</em> <em><br></em>  <em>int WINAPI WinMain (HINSTANCE h, HINSTANCE prev, LPTSTR line, int cmd)</em> <em><br></em>  <em>#else</em> <em><br></em>  <em>int WINAPI WinMain (HINSTANCE h, HINSTANCE prev, LPSTR line, int cmd)</em> <em><br></em>  <em>#endif</em> <em><br></em> <br>  The easiest thing to do is both UNICODE projects.  This will simplify the code.  In STL, there is a wonderful wstring class for working with a UNICODE string.  String literals should look like this: <br><br>  <em>_T ("Goodbye, world!")</em> <em><br></em> <br>  _T () is a macro that will turn a string literal into UNICODE or ASCII as needed.  Instead of char we use <em>TCHAR</em> . <br><br>  To make a UNICODE project in Win32, set two preprocessor definitions: _UNICODE and UNICODE.  In Embedded C ++, this will be done by default. <br><br>  Since there is no current directory, all paths are absolute and you have to take care of adding the necessary prefix yourself.  This is how we find where we were launched from: <br><br>  <em>wstring ApplicationPath ()</em> <em><br></em>  <em>{</em> <em><br></em>  <em>TCHAR Path [MAX_PATH + 1] = {0};</em> <em><br></em>  <em>int n = GetModuleFileName (0, Path, MAX_PATH);</em> <em><br></em>  <em>while (--n&gt; 0 &amp;&amp; Path [n]! = _T ('\\') &amp;&amp; Path [n]! = _T ('/'))</em> <em><br></em>  <em>Path [n] = 0;</em> <em><br></em>  <em>return path;</em> <em><br></em>  <em>}</em> <em><br></em> <br>  This is how we pervert, if you need something only under Windows 32: <br><br>  <em>typedef DWORD (WINAPI * FUNC_GetGuiResources) (HANDLE, DWORD);</em> <em><br></em>  <em>FUNC_GetGuiResources f_GetGuiResources = 0;</em> <em><br><br></em>  <em>struct Win2000_Linkage {Win2000_Linkage () {</em> <em><br></em>  <em>#ifndef UNDER_CE</em> <em><br></em>  <em>f_GetGuiResources = (FUNC_GetGuiResources) GetProcAddress (GetModuleHandle (_T ("user32.dll")), "GetGuiResources");</em> <em><br></em>  <em>#endif</em> <em><br></em>  <em>}} Win2000_linkage;</em> <em><br><br></em>  <em>int GetGuiResource (DWORD which)</em> <em><br></em>  <em>{</em> <em><br></em>  <em>#ifndef UNDER_CE</em> <em><br></em>  <em>if (f_GetGuiResources == 0) return 0;</em> <em><br></em>  <em>HANDLE h = OpenProcess (PROCESS_QUERY_INFORMATION, false, GetCurrentProcessId ());</em> <em><br></em>  <em>int n = f_GetGuiResources (h, which);</em> <em><br></em>  <em>CloseHandle (h);</em> <em><br></em>  <em>return n;</em> <em><br></em>  <em>#else</em> <em><br></em>  <em>return 0;</em> <em><br></em>  <em>#endif</em> <em><br></em>  <em>}</em> <em><br></em> <br>  Here is another strange piece of code that apparently appeared due to the absence of a discontinuous line of type composed of points on Win CE: <br><br>  <em>#ifdef UNDER_CE</em> <em><br></em>  <em>#define DASH_STYLE PS_DASH</em> <em><br></em>  <em>#else</em> <em><br></em>  <em>#define DASH_STYLE PS_DOT</em> <em><br></em>  <em>#endif</em> <em><br></em> <br>  Under Win CE, we don‚Äôt have the current cursor position, so you understand.  Therefore, if it is needed, then remember the last event from the mouse and consider this position as the cursor position.  Type: <br><br>  <em>#ifdef UNDER_CE</em> <em><br></em>  <em>POINT mouse = mouse_at;</em> <em><br></em>  <em>#else</em> <em><br></em>  <em>POINT mouse = WhereIsCursor ();</em> <em><br></em>  <em>#endif</em> <em><br></em> <br>  Under Win CE, there is no Arc () primitive (see GDI). <br><br>  But!  But under Win CE there is still something good.  This is good - Chro ... is built into the OS, that is, Oper .., that is, Inernet Explorer!  Fuu, I remembered the name of the same!  Of course, he is a little bit simpler than his older brother, but we don‚Äôt need much - just draw nice HTML text and that's it! <br><br>  First we do: <br><br>  <em>BOOL InitHTMLControl (</em> <em><br></em>  <em>HINSTANCE hinst);</em> <em><br></em> <br>  You can add a control with a WC_HTML class to the window. <br>  And send some HTML into it to display: <br>  <em>SendMessage (hwndHTML, WM_SETTEXT, 0, (LPARAM) "");</em> <em><br></em>  <em>SendMessage (hwndHTML, DTM_ADDTEXTW, FALSE, (LPARAM) TEXT ("Hello"));</em> <em><br></em>  <em>SendMessage (hwndHTML, DTM_ADDTEXTW, FALSE, (LPARAM) TEXT ("World!"));</em> <em><br></em>  <em>SendMessage (hwndHTML, DTM_ENDOFSOURCE, 0, (LPARAM) NULL);</em> <em><br></em> <br>  Under Win 32, richedit controls can be used for similar purposes. <br><br>  Under Win CE, there is no GetPrivateProfileString, so reading and parsing INI files is your prerogative. <br><br>  When loading a DLL under Win32, the function name must be in ANSI.  Although the project and under UNICODE.  Why?  Because! <br><br>  <em>#ifndef UNDER_CE</em> <em><br></em>  <em>string f_name = ANSI (func_name);</em> <em><br></em>  <em>FARPROC f = GetProcAddress (h, f_name.data ());</em> <em><br></em>  <em>#else</em> <em><br></em>  <em>FARPROC f = GetProcAddress (h, func_name);</em> <em><br></em>  <em>#endif</em> <em><br></em> <br>  At the same time, keep these functions: <br><br>  <em>string ANSI (wstring w)</em> <em><br></em>  <em>{</em> <em><br></em>  <em>int l = WideCharToMultiByte (CP_ACP, 0, w.data (), w.size (), NULL, 0, NULL, NULL);</em> <em><br></em>  <em>if (l)</em> <em><br></em>  <em>{</em> <em><br></em>  <em>char * buffer = new char [l + 1];</em> <em><br></em>  <em>l = WideCharToMultiByte (CP_ACP, 0, w.data (), w.size (), buffer, l, NULL, NULL);</em> <em><br></em>  <em>buffer [l] = 0;</em> <em><br></em>  <em>string s (buffer);</em> <em><br></em>  <em>delete [] buffer;</em> <em><br></em>  <em>return s;</em> <em><br></em>  <em>}</em> <em><br></em>  <em>return "";</em> <em><br></em>  <em>}</em> <em><br><br></em>  <em>wstring UniCODE (string w)</em> <em><br></em>  <em>{</em> <em><br></em>  <em>int l = MultiByteToWideChar (CP_ACP, 0, w.data (), w.size (), NULL, 0);</em> <em><br></em>  <em>if (l)</em> <em><br></em>  <em>{</em> <em><br></em>  <em>TCHAR * buffer = new TCHAR [l + 1];</em> <em><br></em>  <em>l = MultiByteToWideChar (CP_ACP, 0, w.data (), w.size (), buffer, l);</em> <em><br></em>  <em>buffer [l] = 0;</em> <em><br></em>  <em>wstring s (buffer);</em> <em><br></em>  <em>delete [] buffer;</em> <em><br></em>  <em>return s;</em> <em><br></em>  <em>}</em> <em><br></em>  <em>return _T ("");</em> <em><br></em>  <em>}</em> <em><br></em> <br>  Here is how the beginning of the h-file looks like for me, which is included in each compiled file first: <br><br>  <em>#pragma warning (disable: 4786)</em> <em><br></em>  <em>#pragma once</em> <em><br><br></em>  <em>#ifndef UNICODE</em> <em><br></em>  <em>#error You must define UNICODE</em> <em><br></em>  <em>#endif</em> <em><br><br></em>  <em>#ifndef _UNICODE</em> <em><br></em>  <em>#error You must define _UNICODE</em> <em><br></em>  <em>#endif</em> <em><br><br></em>  <em>#ifndef WINVER</em> <em><br></em>  <em>#define _WIN32_WINNT 0x0400</em> <em><br></em>  <em>#define WINVER 0x0400</em> <em><br></em>  <em>#endif</em> <em><br><br></em>  <em>#ifndef UNDER_CE</em> <em><br></em>  <em>#include &lt;tchar.h&gt;</em> <em><br></em>  <em>#include &lt;crtdbg.h&gt;</em> <em><br></em>  <em>#define ASSERT (expr) _ASSERT (expr)</em> <em><br></em>  <em>#define IDC_HAND MAKEINTRESOURCE (32649)</em> <em><br></em>  <em>#define GR_GDIOBJECTS 0 / * Count of GDI objects * /</em> <em><br></em>  <em>#define GR_USEROBJECTS 1 / * Count of USER objects * /</em> <em><br></em>  <em>#define WS_NONAVDONEBUTTON 0</em> <em><br></em>  <em>#include &lt;math.h&gt;</em> <em><br></em>  <em>#endif</em> <em><br></em>  <em>#include "windows.h"</em> <em><br></em>  <em>#include #include #include #include #include #include using namespace std;</em> <em><br><br></em>  <em>As you can see, I use STL closely and therefore I load its classes into the default namespace.</em> <em><br><br></em>  <em>So far, if I liked everything in the next part, I‚Äôll tell you about the pop-up keyboard (SIP), determining the screen orientation and its rotation, adjusting to the screen size, determining the DPI and adjusting it, magic passes to appear in the upper right corner of the cross covering the application (and not it is unknown where), the emergence of reminders, etc.</em> <em><br><br></em> </div><p>Source: <a href="https://habr.com/ru/post/39938/">https://habr.com/ru/post/39938/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../39937/index.html">Search</a></li>
<li><a href="../399371/index.html">Another traffic light in the office</a></li>
<li><a href="../399373/index.html">Pain in the hands when working at the computer. Part 1: Tunnel Syndromes - Review and Diagnose Problems</a></li>
<li><a href="../399375/index.html">Nmap scanner as the main tool for movie hackers</a></li>
<li><a href="../399379/index.html">The history of world epidemics, part 2</a></li>
<li><a href="../399381/index.html">New York Times: Facebook will create censorship tools to return to China</a></li>
<li><a href="../399383/index.html">MTI created artificial muscle fibers from nylon</a></li>
<li><a href="../399385/index.html">Electromechanical Designer ROBOTS-XXI</a></li>
<li><a href="../399387/index.html">Homemade smoke machine</a></li>
<li><a href="../399389/index.html">How could an alien spacecraft work?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>