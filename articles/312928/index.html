<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Setting up a dedicated Source server for Linux, part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="- Records Web server setup Configure the game server Turning on Service 
- Web server setup 
- Configure the game server 
- Turning on 
- Service 
- S...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Setting up a dedicated Source server for Linux, part 2</h1><div class="post__text post__text-html js-mediator-article"><ul><li>  Records <br><ul><li>  Web server setup </li><li>  Configure the game server </li><li>  Turning on </li><li>  Service </li></ul></li><li>  SourceTV </li><li>  Accelerating Content Download (Fast Download) <br><ul><li>  Web server setup </li><li>  Configure the game server </li></ul></li><li>  Bots <br><ul><li>  Supported Card </li><li>  User Card <a name="habracut"></a></li></ul></li></ul><br><h1 id="zapisi">  Records </h1><br><p>  Records (Replays) in Team Fortress 2 is an opportunity, on the server side, to create a record of the player‚Äôs last life, and on the client side, to view, edit, save, and publish it.  It is an extension of SourceTV. </p><br><p>  Entries must be explicitly enabled on the server command line, enabled and configured in the configuration file that is executed before loading the map.  In addition, the web server must be pre-configured to deliver records to players. </p><br><h2 id="nastroyka-veb-servera">  Web server setup </h2><br><p>  For clarity, we will add a separate subdomain replay.example.org to the DNS, create the directory /var/www/replay.example.org, and for convenience we will write the logs into separate files and let the user read the game. </p><br><p>  From root, we create directories, set the owner (game: game) and rights ‚Äî to the game user for writing, the rest (the web server) for reading.  You can also make symbolic links for convenience.  This web server will be common to both game servers, but each of them will use separate directories for posting entries. </p><br><pre><code class="dos hljs"># <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> -p /var/www/replay.example.org/{htdocs/server1,htdocs/server2,log} # chown -R game:game /var/www/replay.example.org # chmod -R <span class="hljs-number"><span class="hljs-number">755</span></span> /var/www/replay.example.org # ln -s /var/www/replay.example.org/log /home/game/log/www-replay</code> </pre> <br><p>  In our default configuration, all web server logs are owned by nginx: adm and 640 permissions, that is, they are not available to regular users.  Adjust this for this case: </p><br><pre> <code class="dos hljs"> # touch /var/www/replay.example.org/log/{access,error}.log # chmod <span class="hljs-number"><span class="hljs-number">644</span></span> /var/www/replay.example.org/log/*.log</code> </pre> <br><p>  Thus, the user of the game, our logs will be available for reading.  But only until their first rotation.  We fix this too.  In the /etc/logrotate.d directory we copy the nginx file to srcds-nginx, in it we set the path to the logs and in the <code>create 640 nginx adm</code> fix the access rights mask from 640 to 644: </p><br><div class="spoiler">  <b class="spoiler_title">srcds-nginx</b> <div class="spoiler_text"><pre> <code class="hljs lua">#/etc/logrotate.d/srcds-nginx /var/www/stat.example.org/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/*.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> /var/www/fastdl.example.org/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/*.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> /var/www/replay.example.org/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/*.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> { daily missingok rotate <span class="hljs-number"><span class="hljs-number">52</span></span> compress delaycompress notifempty <span class="hljs-built_in"><span class="hljs-built_in">create</span></span> <span class="hljs-number"><span class="hljs-number">644</span></span> nginx adm sharedscripts postrotate <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -f /var/run/nginx.pid ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> kill -USR1 `cat /var/run/nginx.pid` fi endscript }</code> </pre> </div></div><br><p>  Here we are in the paths for rotation at the same time indicated directories with logs from the statistics server HLstatsX and from the Fast Download server. </p><br><p>  As root, create a web server configuration file, /etc/nginx/conf.d/replay.example.org.conf: </p><br><div class="spoiler">  <b class="spoiler_title">replay.example.org.conf</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"># /etc/nginx/conf.d/replay.example.org.conf <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> { server_name replay.example.org; <span class="hljs-keyword"><span class="hljs-keyword">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; root /var/www/replay.example.org/htdocs; disable_symlinks <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>; autoindex <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>; access_log /var/www/replay.example.org/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">access</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> main; error_log /var/www/replay.example.org/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/error.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> warn; }</code> </pre> </div></div><br><p>  This, of course, is a somewhat simplified version.  Since in our case the web server is located on the same computer as the game servers and shares one channel with them on the Internet, it makes sense to register additional restrictions on the width of the channel for uploading records.  But, unlike the Fast Download settings, there is no need to install additional checks on the referer. </p><br><p>  We set the call to replay.example.org.conf in the main /etc/nginx/nginx.conf file if not yet, then test the configuration and restart nginx. </p><br><pre> <code class="dos hljs"> # nginx -t # systemctl reload nginx</code> </pre> <br><p>  Further we continue as the user of game. </p><br><h2 id="nastroyka-igrovogo-servera">  Configure the game server </h2><br><p>  By default, when resolving records, the servers will try to execute the configuration file ~ / tf2 / tf / cfg / replay.cfg at startup.  Since we include records on both servers, the individual settings of which must be different, as in the previous cases, we prepare individual files for each server. </p><br><p>  In the ~ / tf2 / tf / cfg directory there is a file replay_example.cfg, we study it and create our own.  For the first server, ~ / cfg / replay1.cfg: </p><br><div class="spoiler">  <b class="spoiler_title">replay1.cfg</b> <div class="spoiler_text"><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"*** ~/cfg/replay1.cfg"</span></span> replay_name <span class="hljs-string"><span class="hljs-string">"  "</span></span> replay_local_fileserver_path /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/www/replay.example.org/htdocs/server1 replay_fileserver_offload_enable <span class="hljs-number"><span class="hljs-number">0</span></span> replay_fileserver_host replay.example.org replay_fileserver_path /server1 replay_enable <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> </div></div><br><p>  Here: </p><br><p> <code>replay_name</code> <br>  the name of the special bot to record, as it will be visible in the list of spectators. </p><br><p> <code>replay_local_fileserver_path</code> <br>  directory where the finished files with records will be placed.  It must be individual for each game server and available for reading by a web server. </p><br><p> <code>replay_fileserver_offload_enable</code> <br>  if 1, then the records are uploaded via ftp to another server, which already distributes them themselves via http.  Not our case. </p><br><p>  if 0, then the distribution is handled by a web server on our machine. </p><br><p> <code>replay_fileserver_host</code> <br>  web server name or ip </p><br><p> <code>replay_fileserver_path</code> <br>  the url part is the path to the entries as displayed by the web server. </p><br><p> <code>replay_enable</code> <br>  actually includes records on the server. </p><br><p>  Thus, from the replay_local_fileserver_path, replay_fileserver_host, replay_fileserver_path and replay_fileserver_protocol not mentioned here replay_file_fileserver (= "http") and replay_fileserver_port (= "80") variables, the url of the type " <a href="http://replay.example.org/server1">http://replay.example.org:80/serverpage</a> ", is formed; for downloading records.  And the replay_local_fileserver_path variable sets the actual directory location in the file system and is equal to root from the nginx + replay_fileserver_path configuration file. </p><br><p>  Copy this file to replay2.cfg, fix server1 paths -&gt; server2 </p><br><div class="spoiler">  <b class="spoiler_title">replay2.cfg</b> <div class="spoiler_text"><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"*** ~/cfg/replay2.cfg"</span></span> replay_name <span class="hljs-string"><span class="hljs-string">"My replay bot"</span></span> replay_local_fileserver_path /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/www/replay.example.org/htdocs/server2 replay_fileserver_offload_enable <span class="hljs-number"><span class="hljs-number">0</span></span> replay_fileserver_host replay.example.org replay_fileserver_path /server2 replay_enable <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> </div></div><br><p>  Make links in ~ / tf2 / tf / cfg: </p><br><pre> <code class="bash hljs"> $ ln -s -v ~/cfg/replay{1,2}.cfg ~/tf2/tf/cfg/</code> </pre> <br><p>  It should be borne in mind that these configuration files are executed only during the initial launch of the server, after autoexec.cfg.  When changing cards, they are not involved. </p><br><p>  From more or less useful console variables: </p><br><p> <code>replay_dopublishtest</code> <br>  performs a server (gaming and web) readiness test for records ‚Äî checks the availability of paths in the file system, the name of the web server, and so on. </p><br><p> <code>replay_data_lifespan</code> <br>  sets the number of days (by default, 1 day), after which the records on the server will be marked as "stale", which will allow manual or automatic cleaning to delete them. </p><br><p> <code>replay_docleanup</code> <br>  removes "stale" entries.  With the parameter 'force' removes all entries altogether. </p><br><p> <code>replay_fileserver_autocleanup</code> <br>  the default is 0 - off, starts the automatic cleaning of "stale" records between rounds. </p><br><p> <code>replay_dofileserver_cleanup_on_start</code> <br>  the default is 1 - on, when the server starts, it starts automatic cleaning of "stale" entries, both in ~ / tf2 / tf / replay / server {1,2} and in the web server directory /var/www/replay.example. org / htdocs / server {1,2}. </p><br><p> <code>replay_record_voice</code> <br>  default 1 - on, record voice chat of players. </p><br><p>  The list of actual, in this version of the Steam engine, variables can be viewed by typing in the server console <code>find replay_</code> . </p><br><h2 id="vklyuchenie">  Turning on </h2><br><p>  In the startup scripts of servers start {1,2} .sh, we add to the command line: </p><br><p>  For the first server: </p><br><div class="spoiler">  <b class="spoiler_title">start1.sh</b> <div class="spoiler_text"><pre> <code class="hljs objectivec"><span class="hljs-built_in"><span class="hljs-built_in">CMDLINE</span></span>=<span class="hljs-string"><span class="hljs-string">"... -replay reply1.cfg -replayserverdir server1 \ ...</span></span></code> </pre> </div></div><br><p>  For the second: </p><br><div class="spoiler">  <b class="spoiler_title">start2.sh</b> <div class="spoiler_text"><pre> <code class="hljs objectivec"><span class="hljs-built_in"><span class="hljs-built_in">CMDLINE</span></span>=<span class="hljs-string"><span class="hljs-string">"... -replay reply2.cfg -replayserverdir server2 \ ...</span></span></code> </pre> </div></div><br><p>  Here the "-replay" command includes the recording functions and executes the specified configuration file when the server starts.  The second command, "-replayserverdir" as a parameter takes the name of the directory (from the path ~ / tf2 / tf / replay /), in which each server will accumulate records. </p><br><p>  Everything, you can run the server and try.  In the game client, in the server browser, near the name of our server, a characteristic Records icon will appear next to the VAC shield. </p><br><p>  When recordings are turned on, a bot appears in the server in observer mode, which actually keeps records and at the same time occupies one game slot.  Therefore, the maximum number of players set at the server startup "+ maxplayers 24" is increased by one, that is, in our case it becomes equal to twenty-five (and when you turn on SteamTV - twenty-six). </p><br><p>  In the old tutorials on setting up records, the server command line parameter "-replay_port" is usually specified, but we don‚Äôt mention it because it was canceled back in 2011 - <a href="http://store.steampowered.com/news/6282/">store.steampowered.com/news/6282/</a> </p><br><blockquote>  When using plug-ins that facilitate mass actions on players (including those bundled with SourceMod), you should be careful about the bot records.  In any case, do not accidentally kick it from the server :) </blockquote><br><h2 id="obsluzhivanie">  Service </h2><br><p>  Record files, although small in size, still occupy disk space, both in the replay directory and in / var / www /.  And it happens that, despite the established date of aging in one day (replay_data_lifespan 1) and the included auto-cleaning of these directories (replay_dofileserver_cleanup_on_start 1), old files are not automatically deleted.  Even when manually starting replay_docleanup.  Therefore, for security, we will add a forced cleaning of old records by running <code>crontab -e</code> and adding it to the end: </p><br><div class="spoiler">  <b class="spoiler_title">crontab</b> <div class="spoiler_text"><pre> <code class="hljs ruby"><span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> * * * <span class="hljs-regexp"><span class="hljs-regexp">/usr/bin</span></span><span class="hljs-regexp"><span class="hljs-regexp">/find ~/tf</span></span>2/tf/replay/server{<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}/* -type f -mtime +<span class="hljs-number"><span class="hljs-number">10</span></span> -delete <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> * * * <span class="hljs-regexp"><span class="hljs-regexp">/usr/bin</span></span><span class="hljs-regexp"><span class="hljs-regexp">/find /var</span></span><span class="hljs-regexp"><span class="hljs-regexp">/www/replay</span></span>.example.org/htdocs/server{<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}/* -type f -mtime +<span class="hljs-number"><span class="hljs-number">10</span></span> -delete</code> </pre> </div></div><br><p>  Beforehand, it would be nice to make sure that cron uses a shell that supports the extension of brackets - "{1,2}" </p><br><p>  Reading access.log shows that sometimes players, or rather their gaming clients, when they connect to our server, try to say the recordings of the games they played three weeks ago. </p><br><p>  Another point is to keep in mind that the Records are eating processor time.  An example download is given at the end of the "Bots" section. </p><br><h1 id="sourcetv">  SourceTV </h1><br><p>  Now set up SourceTV.  This is useful for online broadcasts of world championships, when we will host them. </p><br><p>  SourceTV allows viewers, through their Team Fortress 2 clients, to watch the game progress on the server.  When using chains of proxy servers, the size of the audience is practically unlimited, but in this case, when the game will be broadcast only by our game server, it makes sense to limit the number of viewers, since each of them consumes both processor resources and a channel to the Internet. </p><br><p>  Since during the initial setup of the launch of the game servers we have already indicated in the command line "+ tv_port" with our port number for each server, we can immediately go to the configuration files. </p><br><p>  Just as for setting up records, SourceTV must be activated before loading the map, that is, the "tv_enable 1" command must be executed either on the server launch command line or in the autoexec.cfg file.  In addition, it was experimentally established that the "tv_name" command has a similar requirement. </p><br><p>  Since the SourceTV settings of our servers are fixed and we don‚Äôt plan to change with every change of card, we‚Äôll include all of the common in autoexec.cfg, the individual ones in autoexec {1,2} .cfg. </p><br><p>  In ~ / cfg / autoexec.cfg we add general settings: </p><br><div class="spoiler">  <b class="spoiler_title">autoexec.cfg</b> <div class="spoiler_text"><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/... /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ SourceTV /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      tv_title "  !" /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ tv_password "" /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    tv_maxclients 5 /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      tv_maxrate 0 /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   (1)   POV  (0) tv_transmitall 1 /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    tv_delay 20 /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  - tv_allow_camera_man 0 /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/tv_record &lt;filename&gt; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/tv_stoprecord /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   tv_autorecord 1</span></span></code> </pre> </div></div><br><p>  Here: </p><br><p> <code>tv_title</code> <br>  the title in the window of the viewer when viewing the broadcast. </p><br><p> <code>tv_password</code> <br>  password to connect to the broadcast. </p><br><p> <code>tv_maxclients</code> <br>  The maximum number of viewers, from 0 to 255, is 128 by default. If you do not need an online broadcast, but only a recording of the game (tv_record, tv_autorecord), then you can set it to zero. </p><br><p> <code>tv_maxrate</code> <br>  the maximum channel width for each player, by default - 8000 bps, when set to 0 - without restrictions.  The parameter is closely linked with the previous parameter, especially if the server is planned to be fully filled with viewers. </p><br><p> <code>tv_transmitall</code> <br>  by default ("0"), only that which is shown by the SourceTV operator (AI or specially trained person) is transmitted to the audience.  When set to "1", viewers are given all the information about the game, and they can switch between POVs from different players, or even hover above / below the map.  When the parameter is turned on, the required channel width for each viewer increases by two to three times. </p><br><p> <code>tv_delay</code> <br>  broadcast delay to viewers in seconds, default is 30. Used to reduce cheating when the viewer can give hints to the player. </p><br><p> <code>tv_delaymapchange</code> <br>  delay ("1") or not ("0" is the default) to change the card until the broadcast ends (due to the tv_delay delay). </p><br><p> <code>tv_delaymapchange_protect</code> <br>  protects ("1" - by default) or not ("0") from manually changing the card until the round ends. </p><br><p> <code>tv_allow_camera_man</code> <br>  allow ("1" - the default) or not ("0"), observer players become SourceTV operators.  If "0" - then only automatic camera control. </p><br><p> <code>tv_autorecord</code> <br>  when turned on ("1"), all games automatically begin to be recorded in files with names like <code>auto-&lt;YYYYMMDD&gt;-&lt;hhmm&gt;-&lt; &gt;.dem</code> to the ~ / tf2 / tf directory, for example, "auto-20160630-2208-koth_sawmill .dem ". </p><br><blockquote>  When setting a password ("tv_password &lt;password&gt;"), viewers will not be able to connect from the server browser - they will constantly be refused with the message: "Disconnect: Bad spectator password", and in the server console it will be written "Dropped &lt;player&gt; from server (Bad spectator password) ".  To connect, viewers will need to enter the <code>password &lt;&gt;</code> in the console ( <code>~</code> ) of the game, close the console, and then try to connect.  Or immediately enter <code>connect 192.0.2.0:27020; password &lt;&gt;</code> in the console <code>connect 192.0.2.0:27020; password &lt;&gt;</code>  <code>connect 192.0.2.0:27020; password &lt;&gt;</code> . </blockquote><p>  In ~ / cfg / autoexec1.cfg we append to the end: </p><br><div class="spoiler">  <b class="spoiler_title">autoexec1.cfg</b> <div class="spoiler_text"><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/... /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  SourceTV tv_enable 1 /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     tv_name "SourceTV at Public Server No 1"</span></span></code> </pre> </div></div><br><p>  Here: </p><br><p> <code>tv_name</code> <br>  the name of the SourceTV server, as it will be displayed in the server browser, in the "Watch" tab. </p><br><p> <code>tv_enable</code> <br>  includes ("1") or not ("0", the default) SourceTV on the server. </p><br><p>  Similarly, we adjust ~ / cfg / autoexec2.cfg </p><br><div class="spoiler">  <b class="spoiler_title">autoexec2.cfg</b> <div class="spoiler_text"><pre> <code class="hljs objectivec"><span class="hljs-comment"><span class="hljs-comment">//... tv_enable 1 tv_name "SoutceTV at Private Server No 2" tv_autorecord 0</span></span></code> </pre> </div></div><br><p>  But for the second server, we have disabled automatic recording in autoexec2.cfg.  There is a problem when you turn on automatic recording ("tv_autorecord 1") on cards connected from Steam Workshop, whose name looks like "workshop /", or "workshop / .ugc" - that is, in any case contains a slash "/", which leads to a clumsy formation of the file name for tv_autorecord in the <code>auto-&lt;YYYYMMDD&gt;-&lt;hhmm&gt;-&lt; &gt;.dem</code> scheme and swearing in the logs of the form: <br></p><pre> <code class="hljs markdown"> Failed to write file /home/game/tf2/tf/replay/server2/sessions/20160702-074150-workshop/cp<span class="hljs-emphasis"><span class="hljs-emphasis">_orange_</span></span>x3.ugc454299390.dmx Failed to write file /home/game/tf2/tf/replay/server2/blocks/20160702-074150-workshop/cp<span class="hljs-emphasis"><span class="hljs-emphasis">_orange_</span></span>x3.ugc454299390<span class="hljs-emphasis"><span class="hljs-emphasis">_part_</span></span>0.dmx <span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span> <span class="hljs-bullet"><span class="hljs-bullet">* *</span></span> Replay recording shutting down due to publishing error! Recording will begin <span class="hljs-bullet"><span class="hljs-bullet">* at the beginning of the next round, but may fail again. *</span></span> <span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span> ERROR: Publish timed out after 60 seconds.</code> </pre> <br><p>  and, as a result, disabling records.  Alternatively, you can think of a scheme using "tv_record", which allows you to manually specify the file name to write. </p><br><p>  When SourceTV is turned on, a bot appears in the server in observer mode, which is engaged in broadcasting the game and at the same time occupies one game slot.  Therefore, the maximum number of players set at the server startup "+ maxplayers 24" is increased by one, that is, in our case it becomes equal to twenty-five (and when you turn on Replay - twenty-six). </p><br><p>  So, the commands are spelled out, restart the server and see what happens.  Since we also have recordings that also occupy their gaming slot, we see: </p><br><pre> <code class="hljs vbscript"> *** ~/cfg/autoexec.cfg (global) -------------------------------------------------------- sv_pure <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">2.</span></span> -------------------------------------------------------- maxplayers <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> *** ~/cfg/autoexec1.cfg <span class="hljs-built_in"><span class="hljs-built_in">Server</span></span> logging enabled. <span class="hljs-built_in"><span class="hljs-built_in">Server</span></span> logging data <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> file /home/game/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/server1/L1008000.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> maxplayers <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">26</span></span> (extra slot was added <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> SourceTV) ... Cannot verify load <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> invalid steam ID [A:<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>] Cannot verify load <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> invalid steam ID [A:<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>] Recording SourceTV demo <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> auto<span class="hljs-number"><span class="hljs-number">-20161008</span></span><span class="hljs-number"><span class="hljs-number">-1155</span></span>-cp_granary.dem... Connection <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> game coordinator established. *** ~/cfg/server1.cfg ... SourceTV broadcast active. Connection <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> Steam servers successful. <span class="hljs-keyword"><span class="hljs-keyword">Public</span></span> IP <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">192.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>.</code> </pre> <br><p>  So, at the beginning, the maximum number of players on the server was increased from 24 to 25 - this worked out the command-line parameter "-replay", the recordings started.  Then another extra slot was added for SourceTV - it worked "tv_enable 1" from autoexec1.cfg.  We do not pay attention to the abuse about invalid steam ID [A: 1: 0: 1] - these are our recording and broadcasting bots, for which the server has added game slots.  Then the demo was started writing to the file ~ / tf2 / tf / auto-20161008-1155-cp_granary.dem - the "tv_autorecord 1" parameter from autoexec.cfg worked.  Finally, we were told that SourceTV broadcast active. </p><br><p>  It worked.  You can populate any card with bots, connect with the viewer and see how the broadcast looks in different modes tv_transmitall, tv_allow_camera_man. </p><br><p>  It may happen that the slots are added, but about "SourceTV broadcast active."  not a word, and when you enter the <code>tv_status</code> command in the server console, it swears "SourceTV not active.", although <code>tv_enable</code> entered right there says that everything is ok - "tv_enable = 1 (def. 0)".  In this case, you should try to change the map - <code>changelevel &lt; &gt;</code> .  If everything worked after the change, it means that SourceTV didn‚Äôt initially activate until the first map was loaded - you need to look at the settings. </p><br><p>  Commands that may come in handy: </p><br><p> <code>tv_record &lt; &gt;</code> <br>  starts recording saved to file &lt;file name&gt;.  All events are recorded, regardless of what the operator sees. </p><br><p> <code>tv_stoprecord</code> <br>  stops recording. </p><br><p> <code>tv_clients</code> <br>  shows information about connected viewers. </p><br><p> <code>tv_msg</code> <br>  send a message to all viewers (will appear in the middle of the screen). </p><br><p> <code>tv_status</code> <br>  displays a brief information about the status of the server - online time, FPS, number of viewers, channel band used, and the like. </p><br><p>  The list of actual, in this version of the game server, variables can be viewed by typing in the server console <code>find tv_</code> . </p><br><h1 id="uskorenie-skachivaniya-kontenta-fast-download">  Accelerating Content Download (Fast Download) </h1><br><p>  If we use maps, models, sounds that are not included in the standard delivery of Team Fortress 2 and are missing from the Steam Workshop on our servers, then when a new player is connected, he will need to download our gaming materials to his gaming computer (if he has not).  By default, they will be downloaded from our game server - this mode is called Slow Download.  But since the game server is still not a specialized web server, then with frequent installation of new user maps and high load, it would be reasonable to assign the functions on the return of cards (as well as sounds, models, etc.) to a specially trained web server.  Which, by a happy coincidence, we already have.  This functionality is called Fast Download. </p><br><h2 id="nastroyka-veb-servera-1">  Web server setup </h2><br><p>  To use Fast Download, you must specify the web server to use a directory with the structure of subdirectories </p><br><pre> <code class="hljs dos"> <span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>/maps <span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>/materials <span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>/sound ...</code> </pre> <br><p>  where "dir" is the root directory for fast download.  We cannot create it in / home / game - we have a home directory with rwx rights ------, which does not allow the web server to see these files.  Therefore, we will create these directories somewhere outside the user's home directory game. </p><br><p>  To simplify the configuration, we will register a separate subdomain of fastdl.example.org in our DNS, create the directory /var/www/fastdl.example.org, and for convenience we will write the logs into separate files and let the game user read them. </p><br><p>  From root, we create directories, set the owner (game: game) and rights ‚Äî to the game user for writing, the rest (the web server) for reading.  You can also make symbolic links for convenience.  Catalog Fast Download will be common to both game servers. </p><br><pre> <code class="dos hljs"> # <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> -p /var/www/fastdl.example.org/htdocs/{maps,materials,sound} # <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> /var/www/fastdl.example.org/log # chown -R game:game /var/www/fastdl.example.org # chmod -R <span class="hljs-number"><span class="hljs-number">755</span></span> /var/www/fastdl.example.org # ln -s /var/www/fastdl.example.org/htdocs /home/game/fastdl # ln -s /var/www/fastdl.example.org/log /home/game/log/www-fastdl</code> </pre> <br><p>  In our default configuration, all web server logs are owned by nginx: adm and 640 permissions, that is, they are not available to regular users.  Adjust this for this case: </p><br><pre> <code class="dos hljs"> # touch /var/www/fastdl.example.org/log/{access,error}.log # chmod <span class="hljs-number"><span class="hljs-number">644</span></span> /var/www/fastdl.example.org/log/*.log</code> </pre> <br><p>  Thus, the user game, our logs will be available for reading.  But only until their first rotation.  We fix this too.  In the /etc/logrotate.d directory we copy the nginx file to srcds-nginx, in it we set the path to the logs and in the <code>create 640 nginx adm</code> fix the access rights mask from 640 to 644: </p><br><div class="spoiler">  <b class="spoiler_title">srcds-nginx</b> <div class="spoiler_text"><pre> <code class="hljs lua">#/etc/logrotate.d/srcds-nginx /var/www/stat.example.org/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/*.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> /var/www/fastdl.example.org/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/*.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> /var/www/replay.example.org/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/*.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> { daily missingok rotate <span class="hljs-number"><span class="hljs-number">52</span></span> compress delaycompress notifempty <span class="hljs-built_in"><span class="hljs-built_in">create</span></span> <span class="hljs-number"><span class="hljs-number">644</span></span> nginx adm sharedscripts postrotate <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -f /var/run/nginx.pid ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> kill -USR1 `cat /var/run/nginx.pid` fi endscript }</code> </pre> </div></div><br><p>  Here we are in the paths for rotation at the same time indicated directories with logs from the statistics server HLstatsX and from the server with records. </p><br><p>  There is another fun moment to consider.  For most servers, it is unlikely to become relevant, but still.  Nothing prevents the owner of any game server with user cards like ours, not from malice, but to save your traffic, in your Fast Download settings, specify the address of our web server (it is easy to find it - just enter <code>sv_downloadurl</code> in the game console client by connecting to the server). </p><br><p>  You can detect such parasites by referer, with whom maps are downloaded from us.  So, when downloading the map by the game client, at the filing of our game server, a record of the following type appears in the web server log </p><br><pre> <code class="hljs ruby"> <span class="hljs-number"><span class="hljs-number">198.51</span></span>.<span class="hljs-number"><span class="hljs-number">100.0</span></span> <span class="hljs-symbol"><span class="hljs-symbol">http:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/fastdl.example.org - [16/</span></span>Jun/<span class="hljs-number"><span class="hljs-number">2016</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">20</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>08<span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">28</span></span> +<span class="hljs-number"><span class="hljs-number">0600</span></span>] <span class="hljs-string"><span class="hljs-string">"GET /maps/cp_orange_x5.bsp.bz2 HTTP/1.1"</span></span> <span class="hljs-number"><span class="hljs-number">200</span></span> <span class="hljs-number"><span class="hljs-number">2685506</span></span> <span class="hljs-string"><span class="hljs-string">"hl2://192.0.2.0:27015"</span></span> <span class="hljs-string"><span class="hljs-string">"Half-Life 2"</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">453</span></span> <span class="hljs-string"><span class="hljs-string">"-"</span></span></code> </pre> <br><p>  Pay attention to the referer.  We take this into account when setting up. </p><br><p>  So, we are going to set up a web server.  First, we make a determination whether referer downloads our map with the correct one.    /etc/nginx/nginx.conf,   http {},         fastdl.example.org, : </p><br><div class="spoiler"> <b class="spoiler_title">nginx.conf</b> <div class="spoiler_text"><pre> <code class="hljs mel"># /etc/nginx/nginx.conf http { # &lt;...&gt; map $http_referer $bad_client { <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-string"><span class="hljs-string">"hl2://192.0.2.0:27015"</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-string"><span class="hljs-string">"hl2://192.0.2.0:27016"</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } include /etc/nginx/conf.d/fastdl.example.org.conf; }</code> </pre> </div></div><br><p>  It's simple.   $http_referer     ,   $bad_client (    1)   0. </p><br><p>        /etc/nginx/conf.d/fastdl.example.org.conf. </p><br><div class="spoiler"> <b class="spoiler_title">fastdl.example.org.conf</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">#/etc/nginx/conf.d/fastdl.example.org.conf <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> { server_name fastdl.example.org; <span class="hljs-keyword"><span class="hljs-keyword">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; root /var/www/fastdl.example.org/htdocs; disable_symlinks <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>; default_type application/octet-stream; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($bad_client) { #      https://habrahabr.ru/post/<span class="hljs-number"><span class="hljs-number">272261</span></span>/,     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">403</span></span>; } access_log /var/www/fastdl.example.org/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">access</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> main; error_log /var/www/fastdl.example.org/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/error.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> warn; }</code> </pre> </div></div><br><p>    ‚Äî    $bad_client,     . </p><br><p> ,  nginx   valid_referers,     $http_referer,    ,         .  map . </p><br><p>   fastdl.example.org.conf    nginx.conf   ,      nginx. </p><br><pre> <code class="dos hljs"> # nginx -t # systemctl reload nginx</code> </pre> <br><p>     game. </p><br><h2 id="nastroyka-igrovogo-servera-1">    </h2><br><p>     ,         (  bzip2),        (.bsp)     . ,   -     cp_orange_x5 (      ‚Äî    ,          Steam Workshop),   : </p><br><pre> <code class="bash hljs"> $ mv cp_orange_x5.bsp ~/fastdl/maps $ ln -s ~/fastdl/maps/cp_orange_x5.bsp ~/tf2/tf/maps $ bzip2 --compress --keep --verbose --best ~/fastdl/maps/cp_orange_x5.bsp</code> </pre> <br><p>          ~/fastdl/maps,           . , , ,       .      &lt; &gt;.cfg    ~/tf2/tf/cfg (    ~/cfg,    ). </p><br><p>       ~/cfg/autoexec.cfg: </p><br><div class="spoiler"> <b class="spoiler_title">autoexec.cfg</b> <div class="spoiler_text"><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/... /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ Fast Download /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  -,       /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   Fast Download  sv_downloadurl "" sv_downloadurl "http:/</span></span><span class="hljs-regexp"><span class="hljs-regexp">/fastdl.example.org" /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/       (, ). . sv_allowupload 0 /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/       /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    Slow Download.     . sv_allowdownload 1</span></span></code> </pre> </div></div><br><p>    .    ,  .    ,  ,     autoexec.cfg     Fast Download. </p><br><blockquote> -          ‚Äî <code>exec &lt;configfile&gt;</code>   .      Fast Download     ,     autoexec.cfg,    ""      ,      server.cfg.      ,       .      ,       autoexec.cfg :-) </blockquote><p>        SteamApps\common\Team Fortress 2\tf\download\maps\  cp_orange_x5.bsp,   ‚Äî  (     ). </p><br><p>    ,    , ,     Fast Download (      "Downloading maps/cp_orange_x5.bsp.bz2" ‚Äî  .bz2 ): </p><br><p><img src="https://habrastorage.org/files/6dd/aaa/1c9/6ddaaa1c9d4b44f3843bade0a03959ef.png" alt="Fast Download working"></p><br><p> (   _x3,    ). </p><br><p> ,            ,   "  " (cl_downloadfilter mapsonly),     "Map is missing". </p><br><p><img src="https://habrastorage.org/files/a87/0e6/d38/a870e6d38b2649b881ead329044edcbc.png" alt="Allow maps downloading"></p><br><p>      <a href="">http://fastdl.example.org/maps/cp_orange_x5.bsp.bz2</a> ,   "403 Forbidden" ‚Äî    , referer  <code>hl2://192.0.2.0</code> , . </p><br><p>  : </p><br><p>     Fast Download (    sv_downloadurl),     -,      ,       &lt; &gt;.bsp.bz2,    404    ,   .bz2 ‚Äî &lt; &gt;.bsp.       ,            ~/tf2/tf/maps  Slow Download,  ,    . </p><br><p><img src="https://habrastorage.org/files/f5d/642/cb4/f5d642cb4da94e0e8b5255e5abd7bb81.png" alt="Map missing"></p><br><h1 id="boty">  </h1><br><p>  Team Fortress 2     ‚Äî     .       ,        (   sv_cheats 0),      .    ‚Äî "",      (sv_cheats 1). </p><br><p>  <a href="http://wiki.teamfortress.com/wiki/Bot">TF wiki</a> ,          King of the Hill ( <code>koth_*</code> ),  Payload  ( <code>pl_*</code> ), Dustbowl  Gorge,  Capture the Flag ( <code>ctf_*</code> )  Mann Manor ( <code>cp_manor_event</code> ).      ,     .            . ,     .   . </p><br><h2 id="podderzhvaemaya-karta">   </h2><br><p>      koth_sawmill,    by design.      24 . ,  24  ,          .  ,     24,        .      ‚Äî  .   ‚Äî  .    ,  .         ,         ~/cfg/koth_sawmill.cfg: </p><br><div class="spoiler"> <b class="spoiler_title">koth_sawmill.cfg</b> <div class="spoiler_text"><pre> <code class="hljs ruby">echo <span class="hljs-string"><span class="hljs-string">"*** ~/cfg/koth_sawmill.cfg"</span></span> /<span class="hljs-regexp"><span class="hljs-regexp">/    tf_bot_difficulty 3 /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      tf_bot_join_after_player 0 /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   tf_bot_keep_class_after_death 0 /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      tf_bot_quota_mode fill /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      tf_bot_quota 24</span></span></code> </pre> </div></div><br><p>   : </p><br><p> <code>tf_bot_difficulty 3</code> <br>   . 0=easy, 1=normal, 2=hard, 3=expert. </p><br><p> <code>tf_bot_join_after_player 0</code> <br>         (0),      (1),        . </p><br><p> <code>tf_bot_keep_class_after_death 0</code> <br>  ,        (, , ...),     (1)   (0),   . </p><br><p> <code>tf_bot_quota 24</code> <br>    ,     . ,    tf_bot_quota_mode   "fill"  "match",      ,  +maxplayers     . </p><br><p> <code>tf_bot_quota_mode fill</code> <br>     : </p><br><p> "normal" ‚Äî    /     (tf_bot_add / tf_bot_kick) </p><br><p> "fill" ‚Äî      ( +  )  ,   tf_bot_quota </p><br><p> "match" ‚Äî          1:N,  N   tf_bot_quota. </p><br><p> <code>tf_bot_add [] [] [] [] []</code> <br>   ,         (,   ,   maxplayers) </p><br><p> [] ‚Äî Demoman, Engineer, HeavyWeapons, Medic, Pyro, Scout, Soldier, Sniper, Spy </p><br><p> [] ‚Äî red  blue </p><br><p> [] ‚Äî  tf_bot_difficulty,    . 0=easy, 1=normal, 2=hard, 3=expert. </p><br><p>   ,       ~/cfg,     ~/tf2/tf/cfg: </p><br><pre> <code class="bash hljs"> $ ln -s ~/cfg/koth_sawmill.cfg ~/tf2/tf/cfg</code> </pre> <br><p>  ,    ,      : <code>changelevel koth_sawmill</code> .   ,     expert-lvl     tf_bot_difficulty  1 :-) </p><br><h2 id="polzovatelsyakaya-karta">   </h2><br><p>      .    cp_orange_x3. </p><br><p>  koth_sawmill.cfg  cp_orange_x3.cfg,       Steam Workshop: </p><br><pre> <code class="bash hljs"> $ mkdir ~/tf2/tf/cfg/workshop $ cp ~/cfg/koth_sawmill.cfg ~/tf2/tf/cfg/workshop/cp_orange_x3.ugc454299390.cfg</code> </pre> <br><p>    cp_orange_x3.ugc454299390.cfg   echo  ,   . </p><br><p>  .     <code>changelevel workshop/cp_orange_x3.ugc454299390</code> .        ‚Äî  , : </p><br><p><img src="https://habrastorage.org/files/532/a28/8b7/532a288b7a534bd6a18ca4b75b5e700e.jpg" alt=" "></p><br><p>  .    ,  : <code>sv_cheats 1</code> ‚Äî   -   <code>nav_generate</code> ‚Äî    (   &lt; &gt;.nav),     .   ... </p><br><pre> <code class="hljs go"> Generating Navigation Mesh... Sampling walkable space... Sampling walkable space... Sampling walkable space... Creating navigation areas from sampled data... Connecting navigation areas... Merging navigation areas... Created <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> fencetop area <span class="hljs-number"><span class="hljs-number">1781</span></span>(fc537be) between <span class="hljs-number"><span class="hljs-number">3</span></span>(<span class="hljs-number"><span class="hljs-number">1f</span></span>542dcf) and <span class="hljs-number"><span class="hljs-number">49</span></span>(<span class="hljs-number"><span class="hljs-number">274f</span></span>a843) Finding hiding spots...DONE Finding encounter spots...DONE Finding sniper spots...DONE Computing mesh visibility... Computing mesh visibility... <span class="hljs-number"><span class="hljs-number">0</span></span>% Computing mesh visibility... <span class="hljs-number"><span class="hljs-number">1</span></span>% Computing mesh visibility... <span class="hljs-number"><span class="hljs-number">5</span></span>% Computing mesh visibility... <span class="hljs-number"><span class="hljs-number">17</span></span>% Can<span class="hljs-string"><span class="hljs-string">'t compute incursion distances from the Red spawn room(s). &lt;...&gt; Can'</span></span>t compute incursion distances from the Blue spawn room(s). &lt;...&gt; Computing mesh visibility... <span class="hljs-number"><span class="hljs-number">84</span></span>% Optimizing mesh visibility... NavMesh Visibility List Lengths: min = <span class="hljs-number"><span class="hljs-number">12</span></span>, avg = <span class="hljs-number"><span class="hljs-number">104</span></span>, max = <span class="hljs-number"><span class="hljs-number">280</span></span> Computing mesh visibility...DONE Finding earliest occupy times...DONE Start custom... Post custom... Custom game-specific analysis...DONE Generation complete! <span class="hljs-number"><span class="hljs-number">77.8</span></span> seconds elapsed. Navigation <span class="hljs-keyword"><span class="hljs-keyword">map</span></span> <span class="hljs-string"><span class="hljs-string">'/home/game/tf2/tf\maps\workshop/cp_orange_x3.ugc454299390.nav'</span></span> saved. [TF Workshop] Preparing <span class="hljs-keyword"><span class="hljs-keyword">map</span></span> ID <span class="hljs-number"><span class="hljs-number">454299390</span></span> [TF Workshop] Successfully prepared client <span class="hljs-keyword"><span class="hljs-keyword">map</span></span> from workshop [ workshop/cp_orange_x3.ugc454299390 ] ---- Host_Changelevel ----   .</code> </pre> <br><p>     .           "sv_cheats 0"  server2.cfg.   ,  ,   sv_cheats   0,     ‚Äî       ,  . </p><br><p>    ‚Äî    ,      .  ,  ,  .        . </p><br><p>   -         ,        .      <a href="https://developer.valvesoftware.com/wiki/Navigation_Mesh_Commands">Navigation Mesh Commands</a> ,          <a href="http://forums.steampowered.com/forums/showthread.php%3Ft%3D1264447">Steam Users Forum</a> . </p><br><p>   ""  (Puppet bots).         ,  ,   .     .       TF Wiki,     .       <a href="https://youtu.be/Dn9970dxQ2g">https://youtu.be/Dn9970dxQ2g</a> </p><br><p>    ,  ,   ,   .   <em></em> ,    top        Atom N2800: </p><br><p><img src="https://habrastorage.org/files/d3b/f1e/423/d3bf1e423ea24afa970aae098965b2b9.png" alt=" "></p><br><p>    24      (     ,  ),   12,    .  ,        .       ,      ,  7%.   tf_bot_join_after_player 1      . </p><br><p> , ,      ‚Äî   (    ),      (koth_sawmill.cfg  cp_orange_x3.ugc454299390.cfg   )     ,       ,   .  ,         ‚Äî      ,  -      " ",   ,   .nav       . ,        ,     tf_bot_quota 0  server{1,2}.cfg ‚Äî        ,            . </p><br><ul><li> <a href="https://habrahabr.ru/post/312922/"> 1</a> ‚Äî   Steam   Team Fortress 2,  ,  </li><li> <a href="https://habrahabr.ru/post/312934/"> 3</a> ‚Äî  MetaMod  SourceMod,  , ,  Steam  <del>  Quickplay </del></li><li> <a href="https://habrahabr.ru/post/312936/"> 4</a> ‚Äî   HLstatsX </li></ul><p></p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/312928/">https://habr.com/ru/post/312928/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../312918/index.html">Information security in the field of telecom on the example of Megafon</a></li>
<li><a href="../312920/index.html">Entertaining task "Unlucky ticket"</a></li>
<li><a href="../312922/index.html">Setting up a Source Source Server for Linux, Part 1</a></li>
<li><a href="../312924/index.html">On the specifics of the renewal of domain names in international zones</a></li>
<li><a href="../312926/index.html">Launch i2pd in the Docker container on CentOS 7</a></li>
<li><a href="../312930/index.html">What is new in licensing Windows Server 2016 and how can you avoid unnecessary expenses?</a></li>
<li><a href="../312932/index.html">Algorithm of reading books on programming</a></li>
<li><a href="../312934/index.html">Setting up a dedicated Source server for Linux, part 3</a></li>
<li><a href="../312936/index.html">Setting up a Source Source Server for Linux, Part 4</a></li>
<li><a href="../312940/index.html">Free courses, books and other development materials</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>