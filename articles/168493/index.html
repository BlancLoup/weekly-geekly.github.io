<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>7 steps to successfully migrate the SharePoint 2007 portal to SharePoint 2010</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! This is our first material on Habr√©. In it, we are going to talk about our experience in migrating a complex portal using the Database Attach m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>7 steps to successfully migrate the SharePoint 2007 portal to SharePoint 2010</h1><div class="post__text post__text-html js-mediator-article">  Hello!  This is our first material on Habr√©.  In it, we are going to talk about our experience in migrating a complex portal using the Database Attach method.  Enjoy! <br><br><h5>  A little bit about who is likely to be interested in reading this. </h5><br>  Having decided to share our experience of migration of a single portal, we focused primarily on those who do not ask "Why migrate?" Windows Workflow Foundation, Event Handlers, Jobs, Content Types, Future Receivers, various Site, List, etc.  terms and thinks how to make it work in SharePoint 2010. <br><br><a name="habracut"></a><habracut><h5>  Portal History </h5><br>  The article is based on real events, namely on the results of EastBanc Technologies' long-term cooperation with a major airline.  For five years, we have worked with the IT department of the portal on the Virtual Sales Manager project.  This is a non-standard internal corporate portal for MOSS 2007, which automates the routine financial and legal aspects of the sales directorate and, in fact, is the back office of the directorate.  The portal is used by everyone, from the directorate to the cashiers.  It operates several products that automate such processes as the conclusion and termination of the agency agreement, registration and cancellation of the point of sale, etc., a huge number of business processes. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Over the five-year history of development, the project has grown into an effective communication system for the company with its agent network, which includes more than 1,200 contractors. <br><br>  So you can appreciate the scale and scope, here are figures and facts: <br>  The development of the portal began in 2007 and continues to this day. <br><ul><li>  Over 35,000 man-hours were spent on its creation. </li><li>  At various times, 28 people worked on the project. </li><li>  Every day more than 1600 active users work in the system. </li><li>  The size of the portal content base is 80 GB. </li><li>  The geography of users - the whole of the Russian Federation, CIS, South-East Asia, Europe. </li><li>  The system works in all time zones. </li></ul><br><h5>  Why we decided to write about it </h5><br>  Over the past year, we participated in the migration of several portals from the SharePoint 2007 platform to the SharePoint 2010 platform, in particular, in the <a href="http%253A%252F%252Feastbanctech.ru%252Fprojects%253Fp_p_id%253D3%2526p_p_lifecycle%253D0%2526p_p_state%253Dmaximized%2526p_p_mode%253Dview%2526_3_groupId%253D0%2526_3_keywords%253Dalawar%2526_3_struts_action%253D%25252Fsearch%25252Fsearch%2526_3_redirect%253D%25252Fprojects%2526_3_y%253D0%2526_3_x%253D0">migration of the Alawar portal portals</a> and the <a href="http%253A%252F%252Feastbanctech.ru%252Findex%253Fp_p_id%253D3%2526p_p_lifecycle%253D0%2526p_p_state%253Dmaximized%2526p_p_mode%253Dview%2526_3_groupId%253D0%2526_3_keywords%253D%2525D0%25259E%2525D0%2525B1%2525D1%252589%2525D0%2525B5%2525D1%252581%2525D1%252582%2525D0%2525B2%2525D0%2525B5%2525D0%2525BD%2525D0%2525BD%2525D0%2525B0%2525D1%25258F%252520%2525D0%2525BF%2525D1%252580%2525D0%2525B8%2525D0%2525B5%2525D0%2525BC%2525D0%2525BD%2525D0%2525B0%2525D1%25258F%2526_3_struts_action%253D%25252Fsearch%25252Fsearch%2526_3_">public receiving mayor of Novosibirsk</a> . <br><br>  Both portals are remarkable for enhanced functionality, the presence of specialized modules (Windows Workflow Foundation, Even Handlers, Jobs), integration with various BI solutions (Reporting Services, Excel Services, Performance Point). <br><br>  <a href="http://technet.microsoft.com/en-us/sharepoint/ee517214.aspx">In Microsoft's promotional products, the migration procedure looks very simple</a> : <br><ol><li>  We carry out infrastructure planning. </li><li>  Install the portal and configure it. </li><li>  Select the method of updating the portal to 2010. </li><li>  Update and done! </li></ol><br>  In practice, everything was not so simple and not so fast: we were faced with the fact that almost all types of custom solutions require an individual approach to migration.  And if we consider that the preservation of all this non-standard good, acquired by overwork, and minimizing the portal shutdown time (!) Is at the forefront, the task turns out to be quite ambitious. <br><br>  The same specificity (only in larger volumes) was waiting for us on the migration portal for the company, and we again tamed this terrible beast.  And then they decided that we already have such experience, which may seem interesting and useful to the honorable public. <br><br><h5>  Audit or accounting of inventory items </h5><br>  We started with the revision of our many years of work related to the development of VSM-portal.  In its course, we found that: <br><br>  1. In the project there are 16 types of various custom portal extensions: <br><ul><li>  a.  Windows Workflow Foundation - running 21 business processes (for example, canceling sales points, adding volumes of flights under a corporate agreement, a question from a user, etc.).  Some processes run in an amount of 3,000 instances. </li><li>  List templates - 232 pieces </li><li>  Web-sites' templates </li><li>  Main portal </li><li>  News feed </li><li>  BSP Agent Portal </li><li>  Portal Bonus program cashiers </li><li>  Confidential Rates node </li><li>  Agent Assistance Node (Agent Requests) </li><li>  More than 66 Custom Event Receivers and Feature Receivers </li><li>  Designs </li><li>  For the main site </li><li>  For Agent Requests </li><li>  For bsp </li><li>  For Cashier Bonus </li><li>  Jobs (pieces 15) </li><li>  Computed fields (about 80) </li><li>  Custom Actions with custom controls (about 30). </li></ul><br>  2. The project integrates with the following third-party systems: <br><ul><li>  counterparty accounting system; </li><li>  ASIA NEXT software - order ticket outlets, claim work. </li></ul><br>  The migration of each of these types requires its own approach, which we have formed, but more on that later, but first you need: <br><ol><li>  Collect all the sources in one pile and create a new project in VS 2010, place them TFS. </li><li>  Make it all going (as it turned out, it is not so difficult). </li><li>  Create a WSP for roll on the portal. </li><li>  Complete the pre-upgrade check procedure. </li></ol><br>  This is where the most interesting begins: we have a portal in which seemingly compiled sources are installed, but it doesn‚Äôt even open, what further do you ask?  About this further. <br><br><h5>  Infrastructure and approach to migration </h5><br>  After the audit, the crucial moment came - you had to choose the method of migration.  In order to migrate such a complex portal, we decided to create a test platform identical to the original portal and gradually revive all the functionality on it.  We abandoned the idea of ‚Äã‚Äãrunning a backup of the farm, because  Such an approach would entail a lot of additional work on upgrading the system software of the customer‚Äôs farm, and chose the ‚ÄúDatabase Attach‚Äù approach.  Thus, we saved ourselves from the hassle associated with the fact that the new and original portal infrastructure did not match. <br><br>  In accordance with this approach, we have configured encrypted tunnels to the customer's infrastructure through which we connected to complete the test infrastructure on our servers: <br><ul><li>  Active Directory </li><li>  Web services for integration (point 3 from the previous section) </li><li>  Oracle database. </li></ul><br>  At this stage, we worked with various groups of specialists, including administrators and the security service of the portal. <br>  As a result, we received two test sites, each of which consisted of SQL Server 2008 R2 and a web server with SharePoint 2010. At these sites, we deployed the original 80-gigabyte content databases.  Test pads, as we conceived, became an exact copy of the original. <br><br>  So we prepared.  In our hands we had a portal identical to the natural, it was possible to start testing business processes.  Hour is nearing X, it was time to take the first step on the path of migration. <br><br><h5>  First step </h5><br>  Next, we launched a pre-upgrade check.  Thanks to this, we saw a lot of features required for installation.  We connected the content base and recompiled all our DLLs under SharePoint 2010. <br><br>  Te features that were out of the WSP added to the WSP.  We ended up with 16 of them in the end. <br><br>  After the next pre-upgrade check, errors became much smaller, among them - not a single critical one. <br>  In the next step, we added the * .config, * .sitemap files for configuring the workflow and outgoing emails from the ‚ÄúC: \ inetpub \ wwwroot \ wss \ VirtualDirectories \ 80‚Äù folder to the root of the site.  The portal opened, and we were able to see what was supposed to migrate on its own (document libraries, site structure, lists), but, unfortunately, one could only see. <br><br><h5>  Second step </h5><br>  After seeing the portal, we wrote out a check list of what is not working.  We had to make it work.  One can imagine that the checklist was not small, we took every role and made a list of available actions, for example, ‚Äúanonymous user‚Äù, ‚Äúcashier‚Äù, ‚Äúauthorized agent‚Äù, etc. <br><br><h5>  Third step </h5><br>  Primus demanded repair: <br><ol><li>  Custom-fields (caught 45 pieces), which for some reason did not want to be displayed correctly.  We decided that we will fix them as recommended in the manuals for SharePoint 2010, that is, through XSLT transformation.  It worked! </li><li>  Many custom workflows written in Visual Studio and custom pages that used Ajax.  Previously, when moving from page to page, we transferred ViewState.  After migration to SharePoint 2010, it stopped being transmitted.  We have long tried to understand - why?  It turned out that in SharePoint 2010 the Java scripts changed, and therefore when entering a new page, the form replaced the action path.  We solved this task as follows: we wrote on each such page our own additional script, which forbade changing this custom path.  And it all worked! </li><li>  A lot of Windows Workflow Fondation with a lot of different versions of the DLL, which have gradually been added all these years, and as a result, on the eve of the migration, some Workflows had 3-4 versions of the DLL.  In order not to transfer all these DLLs, but to use the functionality from new DLLs, we, first, recompiled them for SharePoint 2010, and, second, we registered the binding of these DLLs in the configurations.  As a result, when the system requested the DLL of one version, the DLL of the other version that we identified was always given to it.  After that, we also managed to avoid many problems: working Workflow continued to work, and the new ones were started as needed, with the correct versions. </li><li>  ASPX pages lists.  After migration, they began to work very slowly.  Here we are at a standstill for a while.  In the end, we decided to review the queries to the SharePoint database with a SQL profiler and find out what goes into the database.  It turned out that SharePoint was trying to pull out all the .aspx pages at a time.  We tried to create a new list and wrote a script that copied the list pages from the old sheet to a new one.  It all worked quickly.  After that we wrote a script that returned all the ASPX pages in the old list to the original version of the site - everything was fixed. </li><li>  Large lists of points of sale.  SharePoint distributed the rights to each element separately.  There were about 15 thousand points of sale for which the rights were distributed separately, so the lists were terribly slow.  They did it like this: they brought a folder for each agent, they distributed rights to this folder and dragged an agent‚Äôs points of sale there.  We reduced the number of rights to the number of agents, and the list began to work significantly faster. </li></ol><br>  The same was with the task list for Workflow. <br><br>  Finally, earned all the sheets. <br><br><h5>  Fourth step (boring routine) </h5><br>  And then within two weeks we went through the site, found out that it falls and repaired all the custom-solutions that require it. <br><br>  For example, it was required to correct: <br><ol><li>  Translation of list views in XSL.  Specifically, we did not translate them, only a few fields.  The rest of the lists we have earned as it should. </li><li>  Job and Handlers.  It was necessary in the job class to override the ‚ÄúHasAdditionalUpdateAccess‚Äù property in order to create the job from the site's UI. </li><li>  JQuery widgets.  Previously, the $ .ajax method simply returned an object, and now began to put it inside the ‚Äúd‚Äù object (there was data ‚Äî data.d became). </li></ol><br><br><h5>  Fifth Step (training) </h5><br>  When it seemed to us that everything was ready, we deployed 2 virtual machines with the old airline base and went all the way anew (in the checklist we described 16 steps that had to be done, we repeated them).  Everything was restored in the condition in which it was required.  It was possible to prepare the infrastructure and ... migration! <br><br><h5>  The sixth step (we prepare infrastructure of the customer) </h5><br>  When preparing the infrastructure, it was desirable for us to keep the old portal in order to return to it in case of failure.  Therefore, a backup of the old infrastructure was made, which took about 4 hours. <br><br>  The task to the puzzle was also added by the fact that we did not have direct access to the infrastructure, and the preparation took place at night, when the technical service did not want to disturb them in case of problems.  Therefore, they resorted to using the remote access system ILO, with which they installed the operating system. <br><br>  On Friday, at 9 o'clock in the evening in Moscow, we turned off the servers, made a backup, killed all the systems and turned on the new ones.  Here the main adventures began: instead of an hour, the system through ILO was set for three hours!  And it took us 7 whole hours to install the three systems, whereas initially we planned to spend no more than two!  With the motto "Do not back off and do not give up" on our lips, we spent a sleepless Friday night. <br><br><h5>  Seventh step (we pressed the switch!) </h5><br>  When, finally, on Saturday at 6 am, everything was established, and we had normal access through a repository desktop, we installed SharePoint 2010 and SQL on the systems, deployed the base, tested it (see Step Five) and connected it.  Already on Saturday afternoon (12 hours after the beginning of the epic), we had a 90% working portal. <br><br><h5>  And everyone was happy </h5><br>  So let's summarize. <br><br>  We spent 4 weeks on preparing the migration, during which everything was done to minimize downtime: a test site was created that was identical to the original portal;  with the help of this site was carried out "training" - test migration;  Based on the test results, a detailed ‚Äúcombat‚Äù migration plan was drawn up. <br><br>  Preparations worked - the migration took place with minimal portal shutdown time!  Namely, the portal did not work for 17 hours, including a 12-hour rearrangement of operating systems and equipment configuration.  All this happened at the weekend and had almost no effect on the work of the agents.  On Monday, the portal acted as usual, we won! <br><br>  Thank you for mastering this epic work.  We will be happy to talk on the topic of migration, answer questions and argue (constructively!). <br><img src="https://habrastorage.org/storage2/024/85b/6e3/02485b6e37783fdf01890ace99af341f.png" alt="image"></habracut></div><p>Source: <a href="https://habr.com/ru/post/168493/">https://habr.com/ru/post/168493/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../168477/index.html">Attributes system</a></li>
<li><a href="../168483/index.html">5 Practical Tips for Using Lithium-Ion Batteries</a></li>
<li><a href="../168485/index.html">The dark side of the code</a></li>
<li><a href="../168487/index.html">Ordinary screen user: who is he?</a></li>
<li><a href="../168491/index.html">How to use the Instruments utility in Xcode</a></li>
<li><a href="../168497/index.html">Returning to the printed</a></li>
<li><a href="../168503/index.html">Kim Jong-un and the mysterious smartphone</a></li>
<li><a href="../168511/index.html">Runetology (184): Oleg Cheltsov, Fotolia project founder</a></li>
<li><a href="../168515/index.html">Squid3 in SSLBump mode with dynamic certificate generation</a></li>
<li><a href="../168517/index.html">Wavelet compression on the fingers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>