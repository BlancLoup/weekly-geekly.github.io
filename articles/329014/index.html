<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automation of load testing of banking software for terminals</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this post we will talk about testing server software, which serves a huge network of bank terminals in Russia and abroad. We cannot disclose the na...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automation of load testing of banking software for terminals</h1><div class="post__text post__text-html js-mediator-article">  In this post we will talk about testing server software, which serves a huge network of bank terminals in Russia and abroad.  We cannot disclose the name of the bank, some lines of configs are hidden. <br><br>  So, we are developing this software using a modern CI / CD approach, which ensures a high speed of delivery of features, hotfixes and releases in production.  At the beginning of the year, we were offered the task of providing load testing of the developed solution and demonstrating to the customer the ability to embed any subtasks and steps into CI / CD. <br><br>  In addition to common words, Wishlist boiled down to the following: it is necessary to provide automatic deployment of software to the load stand, think up an easy way to generate data, implement an automatic and semi-automatic way to start tests, provide tests with an automatic start and stop trigger on an event, connect the mechanics of NT to the task tracker for a short reporting, connect the testing system to the available NT analytics system, create the possibility of ‚Äúpainting‚Äù bad and good releases for further actions in the workflow (roll out or send  Avit report).  The requirements, it must be admitted, are absolutely adequate and understandable. <br><a name="habracut"></a><br><h2>  Automation </h2><br>  Let's start from afar.  We constantly hear the same thing: ‚ÄúIt is impossible to automate load testing of banking and financial software!  We have too many relationships!  We are very complicated! ‚Äù.  This challenge only increased the excitement of solving the problem.  We always wanted to check the complexity of a specific example. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Remember the wonderful picture about testing in the form of a pyramid and a <a href="https://watirmelon.blog/2012/01/31/introducing-the-software-testing-ice-cream-cone/">cone with ice cream</a> ?  Pyramid is when you have a lot of cheap automatic Unit-tests and few expensive UIs.  Horn with ice cream - on the contrary.  The horn is expensive, unwieldy and does not scale, the pyramid is cheap and flexible. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/9e0/692/24e/9e069224edd842b29128e158a2c77bf0.png" width="500"></div><br>  Instead of doing load testing of software at the level of system interactions, in the banking software sector, traditionally everyone tests through UI, as has been the case since all-in-one systems and applications.  It takes a lot of time and effort, which makes the development of banking software slow, poor quality and low-tech.  At Jet Infosystems, we were spared these stereotypes - the developers themselves wrote unit tests on their code, functional testers perfectly programmed UI tests through <a href="http://www.seleniumhq.org/docs/">Selenium</a> + <a href="https://cucumber.io/">Cucumber</a> .  It remains only to build in the process an additional stage of load testing. <br><br><h2>  Infrastructure design </h2><br>  At the very beginning we decided to abandon interconnections that complicate and dilute the answer to the question of how productive and reliable code we are developing.  For example, authorization and issuance of tokens for operations is the functionality of a third-party system, the performance of which within the framework of the task would be redundant.  In addition, we immediately refused to integrate with several back-office systems, making a stub that responds to our system with a certain delay (we all know how dangerous it is to test the system on ultra-fast mocks). <br>  But the most significant change in the testing paradigm is the rejection of the load testing of the UI terminal.  Until now, this seems strange, but before us this server software was load-tested through the UI ATM.  This happened as follows: some average user was emulated, which passed through some kind of scenario pool with a set of middle pauses (picing, think time), and the load tool was forced to create a load that consists of long and ‚Äúcold‚Äù scenarios from several load generators HP Loadrunner, while the resulting load on one node of the API server was only about a hundred (!) Transactions per second.  (Let's leave out the insane picture when thousands of citizens are trying to click on the controls of a single bank terminal).  As a result, practically everything that was not related to the performance of the ATM backend was thrown out of the stand. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/2f7/9c4/a52/2f79c4a520d0456e92f57425f164ce2e.png" width="500"></div><br>  After designing and inspecting the remaining infrastructure, it became approximately clear how the process would be built, what benefits would be received, and it was necessary to start creating the NT process itself. <br><br><h2>  CI / CD process and software </h2><br>  The software code is laid out in the internal git-repository (GitLab).  After committing on a special trigger, Jenkins pulls out the code on the assembly machine and tries to compile a release with a run of all the Unit tests.  After a successful build using scripts, the assembled build is installed in two test environments - NT and FT - and makes a restart of testing.  After lifting the backend, Jenkins runs one after another FT, UI and TFT tests.  Load testing is launched as a separate task, but it‚Äôs worth mentioning separately. <br><br>  As everyone knows, the classic load testing tool consists of three ‚Äúpillars‚Äù: a test data generator, a load generator and an analyzer of the results obtained.  Therefore, we solved the problem in three directions. <br><br>  In order to compile a relevant request to the API and not to rewrite XML each time for a changing specification, we went the other way - we ‚Äúrob‚Äù the TOP-10 of the main payment scenarios at the time of the UI test run.  To do this, we deployed tshark on a test bench, from which dump we collect XML (we will later send it to the API).  This allows you to save a lot of time and effort on the preparation of test data. <br><br>  We used the most popular tool in the <b>Open Source</b> market, JMeter, as a load generator, but <a href="https://yandextank.readthedocs.io/en/latest/">Yandex.Tank</a> was used as a binding <a href="https://yandextank.readthedocs.io/en/latest/">tool</a> for it.  JMeter's capacity to send 100 transactions per second to one node is more than enough, and Tank gives us convenience in automation and several useful features - auto-stop, interactive graphics, the ability to use other load generators without reshaping the NT process, etc. <br><br>  The most difficult part in the design phase of NT is the analytical part.  Since there are no separate solutions on the market to create our analytics for performance testing, we decided to use <a href="https://overload.yandex.net/">Overload from Yandex</a> .  Overload is a service for storing and analyzing load test results.  You create the load from your load generators, and upload the results to the service and watch them there in the form of graphs.  Now the service is in a public beta, and for Jet Infosystems, Yandex has created a pilot private instance. <br><br>  All data from our JMeter comes to Overload in an aggregated form and does not contain any personal information about payments and customers - the user sees only a graphical representation of performance tests. <br><br><h2>  The most interesting </h2><br>  After the build gets to the load stand, a special task for load testing is started via scripts in Jenkins.  The task is configured in the classical way, through shell scripting and parameterization. <br><br>  For example, so you can configure auto stop: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/b35/25a/711/b3525a7116964466958c7dfe2df63f9c.png"></div><br>  This is the Yandex.Tank config: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/49a/3d8/94e/49a3d894ee03432196a7f60610e219a3.png"></div><br>  And this is what the shell script example of starting the whole NT process looks like: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/f4e/ef9/de6/f4eef9de6f674c33aaf7d79a455f035f.png"></div><br>  As you can see, all the settings are quite primitive.  With the automatic launch of the job, the default settings are applied automatically, while manually starting the job, you can configure the shooter with the Jenkins parameters without understanding the documentation and not digging into the Linux machine and sorting out the necessary configs. <br><br>  The ‚ÄúStart by button‚Äù mode for the developer looks like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/3e0/ef6/a36/3e0ef6a36268495489323c9b8694ec33.png"></div><br>  After running the test, you get a link to the Console View Jenkins and Telegram, by clicking on which you can watch the load test in real time: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/297/6ed/e1c/2976ede1cef6414182c84666373d8296.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/web/6cc/2e1/aa7/6cc2e1aa78dc4103b204255e28636d80.png"></div><br>  If the test results are beyond the SLA, the test automatically stops and you receive a report in Telegram, mail and JIRA about problems with the release.  If the result is good, then after the report, the release receives the status of SUCCESS and is ready for deployment to the loaded environment, in production. <br><br>  Screen from Telegram screen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/c62/23f/6de/c6223f6dea134c969198e846503de646.png"></div><br>  And so the bot reports the results to JIRA: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/9ff/07c/4f6/9ff07c4f65a04a639cfef776f9500999.png"></div><br>  As a corporate ‚Äúbun‚Äù from Yandex, we have access to a comparison of tests: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/e85/e72/4f4/e85e724f4d8b4281b73fb1a6e744c9cc.png"></div><br>  and access to the construction of regression reports on KPI-metrics: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/537/30a/87f/53730a87fa4b4ec1a0fac90951328e31.png"></div><br><h2>  Problems and Solutions </h2><br>  This story would be incomplete if we did not describe a few rakes, which came across in the course of their work. <br><br>  Monitoring  Obviously, during load testing, you are obliged to use not only business monitoring tools (transaction validation, queue size, transmission speed), but also system monitoring (processor consumption, memory size, number of disk operations, metrics that you invented yourself, etc.) d.).  Well, when you have all the infrastructure built on Linux - using the integrated telegraf solution over ssh solves this problem - all data is automatically uploaded to the statistics backend and built synchronously with the business metrics aggregates.  But what to do if you have a part of the test environment built on a Windows platform? <br><br>  We discussed various options and came up with this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/94b/f79/1d6/94bf791d600a48e183ca9689218db4a6.png" width="500"></div><br>  In this case, all metrics from servers and load generators are written to InfluxDB by local telegraf agents, and Yandex.Tank monitoring already extracts data from InfluxDB with a simple script and pulls data into Overload.  This approach eliminates the support of the entire zoo of operating systems from Yandex.Tank and avoids the need for a ‚Äúone-to-all‚Äù connection. <br><br>  Having written the simplest script, like: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> inflow <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Client <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: connect = Client(sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: query_string = <span class="hljs-string"><span class="hljs-string">"SELECT LAST("</span></span> + sys.argv[<span class="hljs-number"><span class="hljs-number">4</span></span>] + <span class="hljs-string"><span class="hljs-string">") FROM "</span></span> + sys.argv[<span class="hljs-number"><span class="hljs-number">3</span></span>] + <span class="hljs-string"><span class="hljs-string">" WHERE host='"</span></span> + sys.argv[<span class="hljs-number"><span class="hljs-number">2</span></span>] + <span class="hljs-string"><span class="hljs-string">"';"</span></span> result = connect.query(query_string) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (result[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">"values"</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">"last"</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"Bad request or something wrong with DB. See logs on "</span></span> + sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>] + <span class="hljs-string"><span class="hljs-string">" for details."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ValueError: print(<span class="hljs-string"><span class="hljs-string">"Something wrong with parameters. "</span></span> <span class="hljs-string"><span class="hljs-string">"Usage: python ./influx_picker &lt;http://db_host:port/dbname&gt; &lt;target_host&gt; &lt;group&gt; &lt;metric&gt;"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> IndexError: print(<span class="hljs-string"><span class="hljs-string">"Usage: python ./influx_picker &lt;http://db_host:port/dbname&gt; &lt;target_host&gt; &lt;group&gt; &lt;metric&gt;"</span></span>)</code> </pre> <br>  We can make Yandex.Tank collect Custom-metrics from InfluxDB with this monitoring config: <br><br><pre> <code class="python hljs"> &lt;Monitoring&gt; &lt;Host address=<span class="hljs-string"><span class="hljs-string">"localhost"</span></span> interval=<span class="hljs-string"><span class="hljs-string">"5"</span></span>&gt; &lt;Custom diff=<span class="hljs-string"><span class="hljs-string">"0"</span></span> measure=<span class="hljs-string"><span class="hljs-string">"call"</span></span> label=<span class="hljs-string"><span class="hljs-string">"cpu_sys"</span></span>&gt;python influx_picker.py http://&lt;INFLUXDB_IP&gt;:<span class="hljs-number"><span class="hljs-number">8086</span></span>/target_host target_host cpu usage_system&lt;/Custom&gt; &lt;Custom diff=<span class="hljs-string"><span class="hljs-string">"0"</span></span> measure=<span class="hljs-string"><span class="hljs-string">"call"</span></span> label=<span class="hljs-string"><span class="hljs-string">"cpu_usr"</span></span>&gt;python influx_picker.py http://&lt;INFLUXDB_IP&gt;:<span class="hljs-number"><span class="hljs-number">8086</span></span>/target_host target_host cpu usage_user&lt;/Custom&gt; &lt;Custom diff=<span class="hljs-string"><span class="hljs-string">"0"</span></span> measure=<span class="hljs-string"><span class="hljs-string">"call"</span></span> label=<span class="hljs-string"><span class="hljs-string">"cpu_iowait"</span></span>&gt;python influx_picker.py http://&lt;INFLUXDB_IP&gt;:<span class="hljs-number"><span class="hljs-number">8086</span></span>/target_host target_host cpu usage_iowait&lt;/Custom&gt; &lt;Custom diff=<span class="hljs-string"><span class="hljs-string">"0"</span></span> measure=<span class="hljs-string"><span class="hljs-string">"call"</span></span> label=<span class="hljs-string"><span class="hljs-string">"mem_free_perc"</span></span>&gt;python influx_picker.py http://&lt;INFLUXDB_IP&gt;:<span class="hljs-number"><span class="hljs-number">8086</span></span>/target_host target_host mem available_percent&lt;/Custom&gt; &lt;Custom diff=<span class="hljs-string"><span class="hljs-string">"0"</span></span> measure=<span class="hljs-string"><span class="hljs-string">"call"</span></span> label=<span class="hljs-string"><span class="hljs-string">"mem_used_perc"</span></span>&gt;python influx_picker.py http://&lt;INFLUXDB_IP&gt;:<span class="hljs-number"><span class="hljs-number">8086</span></span>/target_host target_host mem used_percent&lt;/Custom&gt; &lt;Custom diff=<span class="hljs-string"><span class="hljs-string">"0"</span></span> measure=<span class="hljs-string"><span class="hljs-string">"call"</span></span> label=<span class="hljs-string"><span class="hljs-string">"diskio_read"</span></span>&gt;python influx_picker.py http://&lt;INFLUXDB_IP&gt;:<span class="hljs-number"><span class="hljs-number">8086</span></span>/target_host target_host diskio read_bytes&lt;/Custom&gt; &lt;Custom diff=<span class="hljs-string"><span class="hljs-string">"0"</span></span> measure=<span class="hljs-string"><span class="hljs-string">"call"</span></span> label=<span class="hljs-string"><span class="hljs-string">"diskio_write"</span></span>&gt;python influx_picker.py http://&lt;INFLUXDB_IP&gt;:<span class="hljs-number"><span class="hljs-number">8086</span></span>/target_host target_host diskio write_bytes&lt;/Custom&gt; &lt;/Host&gt; &lt;/Monitoring&gt;</code> </pre><br>  As a result, we get the following charts in Overload: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/9e5/611/050/9e5611050e6140c1a5e62be5d8da0342.png"></div><br>  <b>Reporting</b>  We used two types of reporting results. <br><br>  A brief report - a small amount of metainformation with the distribution of times and a message from the autostop plug-in - was sent as a message to the Telegram-chat, to which the developers, the architect, the manager and the testers were signed. <br><br>  The regression report ‚Äî an advanced report, where a comparison with the reference results was added to the brief information ‚Äî was sent as a comment to JIRA. <br><br>  To do this, we used the Groovy script for Telegram and a simple lib (more on <a href="https://pypi.python.org/pypi/jira/">https://pypi.python.org/pypi/jira/</a> ) for connecting with the JIRA API. <br><br><h2>  Conclusion </h2><br>  As you can see, this task is not from the category of Rocket Science, and you could read similar articles <a href="https://habrahabr.ru/company/pt/blog/204224/">here</a> , <a href="https://habrahabr.ru/company/yandex/blog/202446">here,</a> and even <a href="https://events.yandex.ru/lib/talks/1471/">watch the video here</a> .  Under the hood are the usual scripts and services - we just wanted to demonstrate that in fact, by the era of ‚ÄúDevops‚Äù and general automation, the financial sector has been ready for a long time, just need to have the courage and political will to introduce modern and fast processes. <br><br>  What are the benefits we can get from automation? <br><br><ol><li>  The gain in speed of testing: we get the results a maximum of 2 hours after the commit, while with manual testing it takes about a week or two. </li><li>  Power advantage: 3 virtual servers versus about ten physical servers (!). </li><li>  License win: Jmeter vs Loadrunner, Telegraf vs Sitescope / Tivoli and high vendor independence. </li></ol><br>  In the following articles we will tell about our experiments with InfluxDB in terms of performance and engine optimization.  Follow the news! <br><br>  Team load testing company "Jet Infosystems". </div><p>Source: <a href="https://habr.com/ru/post/329014/">https://habr.com/ru/post/329014/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329004/index.html">Redefining javascript: death for</a></li>
<li><a href="../329006/index.html">Non-standard way of teaching a new programming language (translation of the article Sahil Dua)</a></li>
<li><a href="../329008/index.html">Cognitive dissonance and its application in marketing</a></li>
<li><a href="../329010/index.html">Is the impact of speed on site results critical and what can be done about it?</a></li>
<li><a href="../329012/index.html">Attorney Broflowski principle, or do-it-yourself cloud load balancing</a></li>
<li><a href="../329016/index.html">Creating a Match-3 game in Unity</a></li>
<li><a href="../329018/index.html">Why are women programmers much less than men? Infographic survey from "My Circle"</a></li>
<li><a href="../329020/index.html">Successful CIO in 2017: what is he?</a></li>
<li><a href="../329022/index.html">SSL implementation through SAML with an example</a></li>
<li><a href="../329024/index.html">Diagnostic Tools Plugin for Qt Creator</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>