<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>JPEG technology: decision space analysis</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="JPEG images, besides the actual files with the .jpg extension, can be found inside PDF files and TIFF files. 


 JPEG technology stakeholders can prob...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>JPEG technology: decision space analysis</h1><div class="post__text post__text-html js-mediator-article"><p>  JPEG images, besides the actual files with the .jpg extension, can be found inside PDF files and TIFF files. </p><br><p>  <strong>JPEG technology stakeholders</strong> can probably be divided into the following groups: </p><br><ul><li>  camera and scanner developers; </li><li>  photographers (large photos in good resolution with high quality requirements); </li><li>  social networks and CDNs of the imgix type, which distribute flooded fotochki of uncontrolled UGC-origin, quantity and size in a clamped form; </li><li>  webmasters who manage a moderate amount of non-UGC quality-controlled pictures; </li><li>  lovers of scanned paper books and other historical sources; </li></ul><br><p>  The author of this article belongs mainly to the last group, and certainly does not belong to the number of artistic photographers.  This should introduce a certain bias into the narration, which, nevertheless, is useful just to illustrate possible trajectories in the solution space. </p><a name="habracut"></a><br><p>  Briefly about the <strong>process of turning the</strong> original image into JPEG: </p><br><ul><li>  color space transformation and downsampling; </li><li>  The picture is divided into blocks of 8x8 pixels (MCU).  If the size of the picture is not completely divided by 8, then the rest of the square is filled with some pixels, and is simply cut off during decoding; </li><li>  DCT (discrete cosine transform) matrix of 8x8 pixels, which resulted in ‚Äúmore important‚Äù with so.  image quality factors, closer to the upper left corner of the resulting 8x8 matrix, and ‚Äúless important‚Äù closer to the lower right corner;  we have 8x8 = 64 coefficients; </li><li>  quantization: the matrix from the previous paragraph is divided element by element into a quantization matrix (which can be relatively freely chosen for each particular picture; as a result of quantization, a matrix is ‚Äã‚Äãobtained in which elements from the lower right corner are usually zero; </li><li>  coefficient compression (entropy coding, RLE coding and Huffman coding); </li></ul><br><p>  The only operation in which data loss occurs is quantization.  All other operations occur without loss. </p><br><p>  Different stakeholders have different <strong>production cycles</strong> , in which the following phases vary: </p><br><ul><li>  How much computing power and time is available at the time of generating the JPEG file?  for example, a camera vs full-fledged computers; </li><li>  Will the generated jpeg file be the end result?  for example, this is so for the stock image on the website or for the generated thumbnail; </li><li>  Will the generated jpeg file be the de facto source image?  for example, this is the case for scanned book pages; </li><li>  how much space is in the file storage?  there is always not enough space, but sometimes there is very little of it; </li><li>  What is the final technology?  Jpeg file for browser?  Pdf file?  specialized software that is under complete control, such as e-reader? </li><li>  can we determine what the image is?  full color photo or scanned black and white sepia page? </li><li>  How much effort can we spend on checking the quality of the result?  a photographer can sit in a photoshop for hours; CDNs can provide only ‚Äúacceptable‚Äù quality; </li></ul><br><p>  Staying within the standard JPEG format, we <strong>can vary the</strong> following: </p><br><ol><li>  source pixels as part of a human perception model; </li><li>  quantization matrix (and we can separately select a suitable matrix, as well as scale it in accordance with the required JPEG quality); </li><li>  the quantization result matrix, which allows to vary the pixels of the resulting image to some extent within the framework of the human perception model; </li><li>  coefficient compression scheme; </li></ol><br><p>  Going beyond the standard file format, but preserving the basic JPEG encoding model, we can use a non-standard compression ratios scheme, saving storage space (and also to display if we control the end device). </p><br><p>  If the final format is a standard PDF, and our source is scanned book pages, then we can use the technology of separating images into black and white and color parts.  If we control the end device, then we can use another nonstandard ‚Äúformat‚Äù. </p><br><p>  Key point: many of the technologies described here help reduce file size.  It is important to understand that in fact it provides the opportunity <strong>to improve the quality of the</strong> picture, while remaining within the approximate goal of the file size. </p><br><p>  Consider each dimension of the space of possible solutions separately. </p><br><h2 id="ishodnye-pikseli">  Source pixels </h2><br><p>  The JPEG compression technology is based on the <strong>psycho-visual model of vision</strong> : the human eye suffers a loss of high-frequency image details;  a person perceives differences in brightness better than differences in color.  There are standardized metrics for the correctness of reproducing the original image, based on the SSIM (Structural Similarity) formula, which can be calculated automatically and set target values. </p><br><p>  If we can <strong>vary the original pixels</strong> , while remaining within the target values ‚Äã‚Äãof the correctness of reproduction, then we, in principle, can select such pixel values ‚Äã‚Äãthat, after quantization, are compressed better than without such a selection.  We do not know if any software uses such technology. </p><br><h2 id="matricy-kvantizacii">  Quantization matrix </h2><br><p>  Quantization matrices are the main mechanism that ensures the quality of reproduction with an acceptable compression ratio.  There are several standard default matrices, including the one that was created more than 25 years ago based on the analysis of the body of test images created at the same time;  If you use standard matrices, then everything will be more or less in order, if you do not need to bother. <br>  Generally speaking, it would be optimal to generate a separate quantization matrix for each image, analyzing its content.  Camera makers use their patented generation methods.  Adobe Photoshop, they say, is able to analyze an image and select a suitable matrix. </p><br><p>  JPEG compression quality is simply a real coefficient applied to the elements of standard quantization matrices, causing it to discard more and more information. </p><br><p>  An interesting fact: quantization matrices can be used in computer forensics to identify the device with which the photo was taken. </p><br><h2 id="kvantizovannye-dct-koefficienty">  Quantized DCT coefficients </h2><br><p>  Often, files in JPEG format are de facto source materials, because storing images in uncompressed formats is impractical.  Also, sometimes we simply do not have access to the source material on paper, but, for example, there is only a PDF file of unknown origin and of dubious quality.  Therefore, for many applications, it makes sense to work carefully with DCT-coefficients as first-class objects, applying lossless transformations to them whenever possible. </p><br><p>  Work at the level of matrixes of DCT-coefficients allows you to do several transformations with minimal losses (or no loss at all).  Operations that require full transcoding of pixels are not considered here. </p><br><p>  Transformations with minimal losses: </p><br><ul><li>  rotate by 90 and 180 degrees, if the size of the picture is divided completely into 8; </li><li>  cropping the picture, especially if the coordinates of the lines of the cut are completely divided by 8; </li><li>  scaling pictures with a compression ratio of 8 / N, where N = 9 ... 16;  In particular, this means that you can compress images with a factor of 1/2 and 2/3. </li><li>  transfer of a picture from color to gray representation (the color component is thrown out); </li></ul><br><p>  Since we know that the next operation after quantization will be compression, in principle, theoretically, we can slightly vary the coefficients so that they are better compressed, but they are decoded at about the same pixels as the original image.  It is not known if there are implementations using this approach. </p><br><h2 id="shema-szhatiya-koefficientov">  Factor Compression Scheme </h2><br><p>  Standard JPEG supports Huffman coefficient compression as well as arithmetic coding. </p><br><p>  Implementing Huffman compression is often the simplest and most naive;  in particular, the compressor compresses the coefficients, treating them as random data.  If we take into account the fact that these are the coefficients of a two-dimensional matrix that encodes an image, then we can get significantly better results.  The compression of coefficients at this level occurs without loss. </p><br><p>  Another way to improve compression is to encode the file in progressive JPEG.  In this case, coefficients of the same order are grouped together, which usually leads to a decrease in file size.  This is also a lossless compression operation.  In addition, progressive JPEG starts to render faster when downloading a file, which may be a separate additional advantage on the web. </p><br><p>  The second standard compression method is arithmetic coding.  Unfortunately, this method is supported only by specialized tools, in particular, most common browsers do not support it.  This is due to the questionable (in the past) patent status of arithmetic coding.  Simple compression of images with arithmetic coding provides significant savings in size with no losses.  Of course, this method can be used if we control the implementation of the client device, or if the pictures are used only for storage. </p><br><p>  If we are in complete control of the client device, or if we only want to store pictures, then we can use non-standard compression schemes that better use the fact that pictures are the object of compression.  For example, an interesting program PackJPG can compress JPEG without loss by about 20%, but the result is stored in a non-standard format. </p><br><h2 id="razdelenie-sloev-izobrazheniya">  Separation of image layers </h2><br><p>  For some images, especially for scanned printed pages, you can divide the image into a black-and-white (or other palette) layer and ‚Äúspecifying‚Äù the substrate in full-color format.  Both of these layers can be compressed separately in an optimal format.  For example, for PDF, the black and white layer can be compressed using JBIG2, and the color layer can be compressed in JPEG2000, JPEG or PNG. </p><br><p>  A similar technology is used in the DJVU format. </p><br><p>  If we control the client device, then we can do similar transformations, for example by overlaying pictures in HTML. </p><br><div class="spoiler">  <b class="spoiler_title">Links to documents and programs</b> <div class="spoiler_text"><p> <a href="https://en.wikipedia.org/wiki/JPEG">https://en.wikipedia.org/wiki/JPEG</a> is a very good overview.  Some paragraphs become clear only after studying other references. </p><br><p>  <a href="http://www.ijg.org/">http://www.ijg.org/</a> - reference format implementation.  Written on a super-portable C, so it is not highly optimized. </p><br><p>  <a href="http://www.libjpeg-turbo.org/">http://www.libjpeg-turbo.org/</a> - optimized jpeg implementation </p><br><p>  <a href="http://www.libjpeg-turbo.org/About/Jpeg-9">http://www.libjpeg-turbo.org/About/Jpeg-9</a> - IJG + Criticism <a href="http://www.libjpeg-turbo.org/About/SmartScale">http://www.libjpeg-turbo.org/About/SmartScale</a> - criticism of the ambiguous novelty SmartScale </p><br><p>  <a href="http://www.libjpeg-turbo.org/About/Mozjpeg">http://www.libjpeg-turbo.org/About/Mozjpeg</a> - very good technical analysis of Mozjpeg </p><br><p>  <a href="https://github.com/mozilla/mozjpeg">https://github.com/mozilla/mozjpeg</a> - JPEG implementation optimized for specific common use-cases </p><br><p>  <a href="http://jpegclub.org/jpegtran/">http://jpegclub.org/jpegtran/</a> - a utility for converting JPEG files with minimal loss </p><br><p>  <a href="https://linux.die.net/man/1/exiftran">https://linux.die.net/man/1/exiftran</a> is a utility for working with JPEG files rotated using EXIF. </p><br><p>  <a href="https://github.com/ifad/pdfbeads">https://github.com/ifad/pdfbeads</a> - a script for generating PDF files using layer separation </p><br><p>  <a href="https://en.wikipedia.org/wiki/DjVu">https://en.wikipedia.org/wiki/DjVu#Compression</a> - description of the separation of layers in DjVu </p><br><p>  <a href="https://github.com/packjpg">https://github.com/packjpg</a> - a set of libraries and utilities for low-level manipulation of JPEG files </p><br><p>  <a href="http://code.flickr.net/2017/01/05/a-year-without-a-byte/">http://code.flickr.net/2017/01/05/a-year-without-a-byte/</a> - a story about how Flickr optimized storage and distribution of images </p></div></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/322554/">https://habr.com/ru/post/322554/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../322544/index.html">2fa implementation experience on linux with duosecurity</a></li>
<li><a href="../322546/index.html">Teaching without a teacher. How to become a professional without a mentor</a></li>
<li><a href="../322548/index.html">How to add AppIcon and LaunchScreen to React Native App</a></li>
<li><a href="../322550/index.html">Difficult about simple: ESLint in a team</a></li>
<li><a href="../322552/index.html">How much will your mobile game earn?</a></li>
<li><a href="../322558/index.html">Making a living by creating games</a></li>
<li><a href="../322560/index.html">Bridge-domains and virtual-switch in JunOS</a></li>
<li><a href="../322562/index.html">Architecture of the growing project on the example of VKontakte</a></li>
<li><a href="../322564/index.html">Prospects for the development of public data</a></li>
<li><a href="../322566/index.html">Authorization in ASP.NET Core MVC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>