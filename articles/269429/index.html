<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Conveyor production of Android applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many developers are faced with the task of creating customized applications. For example, developing several versions of the same application or chang...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Conveyor production of Android applications</h1><div class="post__text post__text-html js-mediator-article">  Many developers are faced with the task of creating customized applications.  For example, developing several versions of the same application or changing the standard application to the requirements of the customer.  We at Rambler &amp; Co faced this challenge when developing Rambler box office and its branded versions for individual cinemas.  This article will look at the evolution of the architecture of such an application, as well as the tools that simplify our lives. <br><br><img src="https://habrastorage.org/files/66a/7a4/725/66a7a47255d24b7c85a02c885309f40f.PNG"><br><a name="habracut"></a><br><h4>  Formulation of the problem </h4><br>  It is necessary to invent and prepare a base for the quick creation of typical cash register applications.  Each cinema wants separate applications, the application is constantly evolving, bugs are being fixed and new features are being added, which also need to be pulled into the branded versions. <br><br><h5>  Goals and Conversion </h5><br>  Custom applications have a positive effect on conversion.  The main goal of users in the application is to view the schedule of your favorite cinema and purchase tickets.  The presence of applications allows you to reduce the number of clicks from opening to pressing a button to buy a ticket by 2-3 clicks.  And as you know, every click is -N% of users.  There is also the opportunity to convey to users information about promotions and discounts. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Architecture </h4><br>  Changes relate to the UI, the basic entity and functionality remain unchanged.  Filtering sources is not required, is performed by the API. <br><br>  Initially, the task was to make one branded version, development plans were very vague.  The branch by version was via if.  Like that: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TYPE == KASSA1) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TYPE == KASSA2) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>; }</code> </pre> <br>  Or via switch: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (TYPE) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KASSA1: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KASSA2: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>; }</code> </pre><br>  The solution is very bad, many flaws and almost no advantages.  All development in one code base, a huge amount of code, complex debugging and debugging, deployment problem.  The whole range of emotions in one picture: <br><div class="spoiler">  <b class="spoiler_title">IF, IF EVEREWHERE</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/b45/072/a63/b45072a6383b48b4a17a33f18e30d579.jpg"><br></div></div><br><h5>  Flavors </h5><br>  The next branch of evolution was the use of Gradle Flavors + build Types. <br>  Separate versions of applications are created, switching between them occurs in the build types window, configurations can be set in parallel, for example: debug, release, manager, testOrder, and so on.  Each configuration contains its own code and resources.  One of the unpleasant flavors features is complicated code navigation in an inactive branch.  Configuration example: <br><br><pre> <code class="javascript hljs">productFlavors { kassaCinema1 { applicationId <span class="hljs-string"><span class="hljs-string">"ru.rambler.cinema1"</span></span> versionName <span class="hljs-string"><span class="hljs-string">"1.3"</span></span> } kassaCinema2 { applicationId <span class="hljs-string"><span class="hljs-string">"ru.rambler.cinema2"</span></span> versionName <span class="hljs-string"><span class="hljs-string">"1.1"</span></span> } }</code> </pre><br>  Key features: <br><ul><li>  - Selected resources </li><li>  - Separate code </li><li>  - Easy assembly </li></ul><br>  Disadvantages: <br><ul><li>  ‚ÄîNo possibility of checking the correctness of other branches </li><li>  The complexity of navigation with a large number of branches. </li></ul><br>  More details can be found: <a href="http://tools.android.com/tech-docs/new-build-system/user-guide">tools.android.com/tech-docs/new-build-system/user-guide</a> and here: <a href="https://developer.android.com/tools/building/configuring-gradle.html">developer.android.com/tools/building/configuring-gradle.html</a> <br>  For most applications, this functionality should suffice, but because of the possibility of active work in only one branch, as well as inconvenience with a large number of versions, I had to abandon this system in favor of the SDK or android library. <br><br><h5>  "SDK or application - library" </h5><br>  The next step was to transfer the main code to the SDK.  The main application is created as a library, i.e.  in the build gradle we change: <br><br><pre> <code class="javascript hljs">apply plugin: <span class="hljs-string"><span class="hljs-string">'com.android.application'</span></span></code> </pre><br>  on <br><br><pre> <code class="javascript hljs">apply plugin: <span class="hljs-string"><span class="hljs-string">'com.android.library'</span></span></code> </pre><br>  and remove all the excess from the manifest. <br>  It also creates the main implementation, it describes the manifest and connects the library, its code or resources in the main version are not used. <br>  All the logic and the main code is in the library, in the branded versions there is only the design, in rare cases, the individual blocks of code. <br><br><h5>  Implementation </h5><br>  All the logic of branded applications is located in the main factory.  She is responsible for fine-tuning the entire application.  Initialization in Application. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KassaApp</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MainFactory mainFactory; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(); mainFactory = createMainFactory() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> MainFactory </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createMainFactory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MainFactory(); } }</code> </pre><br>  Example Application in a custom application: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomApp</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KassaApp</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> MainFactory </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createMainFactory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomFactory(); } }</code> </pre><br>  Sample basic entity factory: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainFactory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> FragmentManager </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createFragmentManager</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FragmentManager(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UIManager </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createUIManager</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UIManager(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLatLng</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> LocationSettingsManager.getInstance().getLatLngParams(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCustomUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getString(R.string.custom_url); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Place </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCustomPlace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalStateException(getString(R.string.error_illegal)) } }</code> </pre><br>  Change view through managers <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIManager</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasHeaderLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getBoolean(R.bool.config_header_location_enabled); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasPosterSearch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getBoolean(R.bool.config_poster_search_enabled); } }</code> </pre><br>  Usage example: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!uiManager.hasHeaderLocation()) { disableHeaderLocationView(); }</code> </pre><br>  FragmentManager is responsible for working with fragments. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FragmentManager</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Fragment </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOneCinemaFragment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalStateException(getString(R.string.error_illegal)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Fragment </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNavNowFragment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NavNowFragment(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Fragment </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNavSupportFragment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NavSupportFragment(); } }</code> </pre><br>  When adding elements specific to all typical movie theaters, we add them to the main project. <br>  When adding atypical elements, we use the substitution of fragments <br><br><h5>  Webview </h5><br>  In case the customer wants to be able to dynamically change information in the application, we add a webView with embedded links.  A separate fragment is responsible for working with webView, simply replacing the link. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"custom_url_news"</span></span></span><span class="hljs-tag">&gt;</span></span>http://cinema1.ru/news/<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Content and page layout remains for the customer. <br><br><div class="spoiler">  <b class="spoiler_title">An example of a menu with 4 elements is webView (movie bars, advertising, room rental, promotions).</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/76a/cf9/bc8/76acf9bc897442a2a953a8808217dc5e.png"><br></div></div><br><br><h4>  Design </h4><br>  The design in this process is one of the most labor-intensive moments, by agreement the design is drawn according to the example of the main version, one-in-one.  All elements are delivered in the same format, with the same file names, the same arrangement of elements.  As a result, you just need to copy the res-drawable directory.  The same situation with colors and fonts. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">color</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"kassa_main_color"</span></span></span><span class="hljs-tag">&gt;</span></span>#1aa0f0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">color</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">color</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"kassa_delimiter"</span></span></span><span class="hljs-tag">&gt;</span></span>#bbe2f9<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">color</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">color</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"kassa_clickable"</span></span></span><span class="hljs-tag">&gt;</span></span>#E3E3E3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">color</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">color</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_color_active"</span></span></span><span class="hljs-tag">&gt;</span></span>#1aa0f0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">color</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">color</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_color_pressed"</span></span></span><span class="hljs-tag">&gt;</span></span>#bbe2f9<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">color</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  All information on the cinema is stored in the resources: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"support_custom_email "</span></span></span><span class="hljs-tag">&gt;</span></span>cinema1@cinema1.ru<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"app_name"</span></span></span><span class="hljs-tag">&gt;</span></span>Cinema 1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"support_custom_phone"</span></span></span><span class="hljs-tag">&gt;</span></span>+7 495 777 77 77<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Similarly stored information about the visibility of elements, design and so on. <br><br><div class="spoiler">  <b class="spoiler_title">An example of changing an application with only resources</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/5c7/3c4/75b/5c73c475b940476d9cca9c8858b53861.png"><br><br></div></div><br><br><h4>  Application wizard. </h4><br>  As you can see, all settings for a separate cinema (in the absence of separate fragments) are transferred to the resource files.  The design is also replaced at the level of images and resources. <br>  This allows you to create applications for individual cinemas using a wizard (a regular application) that will take a sample of the project, overwrite the settings of keys, colors, names and other information, put it in the correct directory and add it to the overall project.  We will only need to compile the project and put it in Google Play (although even this can be automated). <br><br><h4>  Testing </h4><br>  For autotests Robolectric is used, for UI - espresso. <br>  Fabric.io (ex Crashlytics) is used for testing.  Plugin for android Studio is used for integration into the application.  Fill to server using the gradle command.  Settings for testing: <br><br><pre> <code class="javascript hljs">ext.betaDistributionReleaseNotes=‚ÄùRelease Notes <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> build.‚Äù ext.betaDistributionEmails=<span class="hljs-string"><span class="hljs-string">"BetaUser@y.com, BetaUser2@y.com"</span></span> ext.betaDistributionGroupAliases=‚Äùmy-best-testers‚Äù</code> </pre><br>  Tests for applications are performed automatically on Jenkins; if tests pass successfully, the build automatically goes to the fabric.  For more information about the testing tools, you can read here: <br>  <a href="http://habrahabr.ru/company/rambler-co/blog/266837/">habrahabr.ru/company/rambler-co/blog/266837</a> <br>  Analysis of code coverage by tests and success <br><br><h4>  Publish to Google play </h4><br>  With a large number of applications, publication takes quite a long time.  Currently, apps are being published manually, but the possibility of using the Publishing API <a href="https://developers.google.com/android-publisher">developers.google.com/android-publisher is being considered</a> .  According to the developers, this api allows you to: <br><ul><li>  ‚ÄîDownload new versions </li><li>  Change application status (alpha, beta) </li><li>  ‚ÄîChange application information </li></ul><br><h4>  Conclusion </h4><br>  In this article, we talked about the development of the Rambler box office architecture, from if-s to the full-fledged application creation wizard.  Selecting the main code in the library or sdk, using the wizard, making changes using resources and adapting the design simplify the creation of branded applications. <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/269429/">https://habr.com/ru/post/269429/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269417/index.html">Introduction to RxJava: Why Rx?</a></li>
<li><a href="../269419/index.html">Why Mobile First?</a></li>
<li><a href="../269423/index.html">Linux containers at home: why and how</a></li>
<li><a href="../269425/index.html">Code hiding and refactoring areas</a></li>
<li><a href="../269427/index.html">Introduction to RapidMiner</a></li>
<li><a href="../269431/index.html">Pivoting Everywhere - Local Area Network Techniques</a></li>
<li><a href="../269435/index.html">Hot on the heels of DroidCon Moscow 2015</a></li>
<li><a href="../269439/index.html">Notifications on different platforms, what are they? Bonus on smart watches Moto 360</a></li>
<li><a href="../269447/index.html">Section about client programming on HighLoad ++</a></li>
<li><a href="../269449/index.html">Setting the correct time on the site and server</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>