<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Telephone Directory</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Phone Directory for Active Directory 


 For those who do not want to read the article, immediately repository on github . 

 And the rest under the c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Telephone Directory</h1><div class="post__text post__text-html js-mediator-article"><h2>  Phone Directory for Active Directory </h2><br><img src="https://habrastorage.org/files/157/0d1/27f/1570d127f60649578b7039717d99b094.png"><br><br>  For those who do not want to read the article, immediately repository on <a href="https://github.com/titulus/Telephone-Directory">github</a> . <br><br>  And the rest under the cut is waiting for an incoherent and meaningless story about how I <s>came to such a life</s> , with the help of node-webkit, wrote the application that <i>I waited for the year</i> . <a name="habracut"></a><br>  Throughout my <s>adult life</s> as a sysadmin career, I have admired MS's Active Directory.  And as soon as such an opportunity appeared, I implemented it at the enterprise where I work. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And it started ... I began to integrate everything I reach, with AD.  Proxy authentication, employee database for ACS, Anti-Virus, etc.  And I did not have enough for the happiness of a <u>telephone directory</u> that would take all the data from the database AD.  Already half a year I now and again torment Google on this topic, but the results are not comforting. <br><br>  Basic requirements for such a directory: <br><ol><li>  separate <b>portable</b> application.  <i>Every time I bumped into a web-based directory I thought, ‚Äúif I‚Äôve already raised a server for this, I‚Äôll make a full-fledged corporate portal there, and now I need only a small directory.</i> </li><li>  free </li><li>  The simplest and most convenient to use.  <i>He always seemed to me just a table with sorting and searching</i> </li></ol><br><br>  From the entire zoo of this software that I discovered, there are several types: <br><ul><li>  <b>Cumbersome</b> : Any corporate portals <a href="http://www.jomportal.ru/">jomportal</a> , <a href="http://www.onlyoffice.com/">onlyoffice</a> ... </li><li>  <b>Paid</b> : Basically, what you need <a href="http://www.dovestones.com/active-directory-phone-book/">from dovestones</a> , <a href="http://ithicos.com/active-directory-tools/web-white-pages-phonebook.html">from ithicos</a> ... </li><li>  <b>Having a <u>fatal flaw</u></b> : <a href="http://www.gourami.eu/active-directory-telephone-book/">from gourami</a> (dumb, did not start, also frimium), <a href="http://dmtsoft.ru/bn/702/as/oneaticleshablon">from dmtsoft</a> (one of the best, about its shortcomings just below.), Or a thousand all kinds of VB scripts generating HTML file. </li></ul>  <sub>I saw once again a server version in php, although I did not find it when writing an article.</sub>  <sub>It can be attributed to the 3rd group, as the server requirement for me is a disadvantage.</sub> <div class="spoiler">  <b class="spoiler_title">Regarding the reference from dmsoft</b> <div class="spoiler_text">  He looks like this <br><img src="https://habrastorage.org/files/51e/3c3/fab/51e3c3fab4444c6fbc80a3fe020dcc20.png"><br>  And there is no way at least to make the phone more column wide by default.  And to customize the interface every time you start is terribly annoying. </div></div><br>  Nothing foreshadowed <s>troubles</s> solving this problem, but the day before yesterday I found out about <a href="http://nwjs.io/">node-webkit</a> ! <br><img src="https://habrastorage.org/files/3b9/e80/273/3b9e80273e8f4bdc8edacb56dbd2aa01.gif"><br>  The ability to write a desktop application in a familiar language - what could be better?  My joy knew no bounds. <br>  But here's the bad luck ... At home, a small child, constantly demanding attention, and at work <i>suddenly</i> work.  Coding categorically once and nowhere. <br>  But fate was favorable to me - the child <i>decided to sleep on</i> Sunday afternoon.  My wife, apparently remembering my enthusiastic cries about how cool the node-webkit is, and having solved my secret desires, in response to the question ‚Äúwhat do we do while the child sleeps?‚Äù <br><img src="https://habrastorage.org/files/f54/ddb/f5b/f54ddbf5bd8e4404ad1742babddbdeb4.gif"><br>  replied "okay ... go program already" <br><br><h3>  Episode 1: March to the prototype </h3><br>  So.  I have 1.5 - 2 hours to master the new technology <i>(even two, since I also did not know the nodejs)</i> and write with its help software that for some reason none of the programmers have yet written . <br><br>  First of all, I asked Google about the connection of nodejs with ActiveDirectory.  He prompted two modules: <a href="https://github.com/gheeres/node-activedirectory">node-activedirectory</a> and <a href="http://ldapjs.org/">ldapjs</a> .  Understand that what time was not, so the choice fell on the first. <div class="spoiler">  <b class="spoiler_title">CODE</b> <div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ActiveDirectory = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'activedirectory'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ad = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActiveDirectory(<span class="hljs-string"><span class="hljs-string">'ldap://example.com'</span></span>, <span class="hljs-string"><span class="hljs-string">'dc=example,dc=com'</span></span>, <span class="hljs-string"><span class="hljs-string">'superadmin'</span></span>, <span class="hljs-string"><span class="hljs-string">'pass'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> groupName = <span class="hljs-string"><span class="hljs-string">'Employees'</span></span>; ad.getUsersForGroup(groupName, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, users</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'ERROR: '</span></span> +<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(err)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (! users) <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Group: '</span></span> + groupName + <span class="hljs-string"><span class="hljs-string">' not found.'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(users); } });</code> </pre> <br>  By the way about <pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> groupName = <span class="hljs-string"><span class="hljs-string">'Employees'</span></span>;</code> </pre>  <b>EMPLOYEES</b> - a group that includes all current employees <br></div></div><div class="spoiler">  <b class="spoiler_title">RESULT</b> <div class="spoiler_text"><pre> <code class="bash hljs">ERROR: {<span class="hljs-string"><span class="hljs-string">"dn"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span>,<span class="hljs-string"><span class="hljs-string">"code"</span></span>:49,<span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"InvalidCredentialsError"</span></span>,<span class="hljs-string"><span class="hljs-string">"message"</span></span>:<span class="hljs-string"><span class="hljs-string">"80090308: LdapErr: DSID-0C0903A9, comment: AcceptSecurityContext error, data 52e, v1db0\u0000"</span></span>}</code> </pre>  well .... </div></div><br>  Attempting to poke the second module led to the same result, but for more time.  Mana smoking, kicking the familiar nodejs nickname and crazy luck still gave the result: for some reason, the superradmin domain is not authenticated, but the powerless juzverev created for the sake of the guest Internet has <u>worked</u> ! <blockquote>  HOORAY <br><img src="https://habrastorage.org/files/591/071/e9a/591071e9a7e142a492f37684cdc47c17.png"></blockquote><br><br>  There is no time for the proceedings with the rights - we drove on. <br><ol><li>  <a href="https://github.com/titulus/Telephone-Directory">git init</a> </li><li>  <a href="https://ru.wikipedia.org/wiki/WTFPL">License</a> </li><li>  dirty debugging hack <pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'nw.gui'</span></span>).Window.get().showDevTools();</code> </pre></li><li>  copy-paste old code </li></ol><blockquote>  Voila <br><img src="https://habrastorage.org/files/408/249/0da/4082490da0614b5c8ce58519faee2106.png"></blockquote><br>  You can start creating magic ... But it's been almost an hour.  A child can wake up at any moment.  There is no time for magic - we take everything ready. <br>  Fast googling gave a great script to work with the <a href="http://www.scriptiny.com/2009/11/advanced-javascript-table-sorter/">TinyTable</a> table.  I copy it all with an example to me. <br><div class="spoiler">  <b class="spoiler_title">A little bit of code</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ad = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActiveDirectory(credentials.dn, credentials.dc, credentials.user, credentials.pass, {<span class="hljs-attr"><span class="hljs-attr">attributes</span></span>: {<span class="hljs-attr"><span class="hljs-attr">user</span></span>: [ <span class="hljs-string"><span class="hljs-string">'cn'</span></span>, <span class="hljs-string"><span class="hljs-string">'telephonenumber'</span></span>, <span class="hljs-string"><span class="hljs-string">'mail'</span></span> ]}}); <span class="hljs-comment"><span class="hljs-comment">//            function users2table (users) { tablehtml = ''; for (i in users) { var user = users[i]; console.log(user); tablehtml+='&lt;tr&gt;'; tablehtml+= '&lt;td&gt;'+user.cn+'&lt;/td&gt;' tablehtml+= '&lt;td&gt;'+user.telephoneNumber+'&lt;/td&gt;' tablehtml+= '&lt;td&gt;'+user.mail+'&lt;/td&gt;' tablehtml+='&lt;/tr&gt;' } console.log(tablehtml); $('#table tbody').html(tablehtml); sorter.init(); }</span></span></code> </pre></div></div><blockquote>  Tadam <br><img src="https://habrastorage.org/files/e36/64e/524/e3664e52430c4a469b73567f2c8744b2.png"></blockquote>  From the crib came the joyful cry. <br><br><h3>  Episode 2: Morning Coffee </h3><br>  At <b>6:50</b> am, I have about 20 minutes ... <br><br><ol><li>  We remove the address bar and call the window <div class="spoiler">  <b class="spoiler_title">package.json</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">"window"</span></span>: { <span class="hljs-string"><span class="hljs-string">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Telephone Directory"</span></span>, <span class="hljs-string"><span class="hljs-string">"toolbar"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre></div></div></li><li>  Autofocus on the search field <div class="spoiler">  <b class="spoiler_title">users2table</b> <div class="spoiler_text"><pre> <code class="javascript hljs">$(<span class="hljs-string"><span class="hljs-string">'#query'</span></span>).focus();</code> </pre></div></div></li><li>  we add a department to the table, <i>or rather, we pick up not just anything, but only the full name, phone, email, department</i> <div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ad = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActiveDirectory(credentials.dn, credentials.dc, credentials.user, credentials.pass, {<span class="hljs-attr"><span class="hljs-attr">attributes</span></span>: {<span class="hljs-attr"><span class="hljs-attr">user</span></span>: [ <span class="hljs-string"><span class="hljs-string">'cn'</span></span>, <span class="hljs-string"><span class="hljs-string">'telephonenumber'</span></span>, <span class="hljs-string"><span class="hljs-string">'mail'</span></span>, <span class="hljs-string"><span class="hljs-string">'department'</span></span>]}});</code> </pre><pre> <code class="javascript hljs">tablehtml+= <span class="hljs-string"><span class="hljs-string">'&lt;td&gt;'</span></span>+user.department+<span class="hljs-string"><span class="hljs-string">'&lt;/td&gt;'</span></span></code> </pre></div></div></li><li>  And open the window to full screen, so as not to sweat about the size <div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'nw.gui'</span></span>).Window.get().maximize();</code> </pre></div></div></li></ol><blockquote>  Already very well <br><img src="https://habrastorage.org/files/722/863/b7b/722863b7b29f47908b137ff3d4fb3371.png"></blockquote>  But already <b>half</b> past <b>seven</b> and I have to run. <br><br><h3>  Episode 3: Directing the mafet </h3><br>  During lunch, I returned to the code again. <br>  First of all, I added a feature that I was considering all the way to work - caching.  For each time, waiting for the download (even if only a few seconds) looking at the empty window is annoying. <br><div class="spoiler">  <b class="spoiler_title">CODE</b> <div class="spoiler_text">  in the event of receiving a response from ldap changed it: <pre> <code class="javascript hljs">users2table(users);</code> </pre>  on this: <pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> localusers = localStorage.users; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ldapusers = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(users); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (localusers != ldapusers) {localStorage.users = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(users)} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'users didn\'t changed'</span></span>)}; users2table(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(localStorage.users));</code> </pre><br>  as well as added to an empty space in the script loading from localstorage if not empty <pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (localStorage.users) users2table(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(localStorage.users));</code> </pre></div></div><br>  Fixed a couple of bugs, combed, added <i>mailto</i> links for emails ... In principle, everything. <blockquote>  READY! <br><img src="https://habrastorage.org/files/538/888/1c9/5388881c9346474ba27bcc781cc095aa.png"></blockquote>  Just lunch is over. <br>  But this functionality already fully covers all my plans, so I stopped at this point for now. <br><br><h3>  Installation </h3><br><ol><li>  put <a href="http://nwjs.io/">node-webkit</a> </li><li>  download <a href="https://github.com/titulus/Telephone-Directory/releases">release</a> </li><li>  place the file <b>private.js</b> <div class="spoiler">  <b class="spoiler_title">content</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">dn</span></span>:<span class="hljs-string"><span class="hljs-string">"ldap://example.com"</span></span> ,<span class="hljs-attr"><span class="hljs-attr">dc</span></span>:<span class="hljs-string"><span class="hljs-string">"dc=example,dc=com"</span></span> ,<span class="hljs-attr"><span class="hljs-attr">user</span></span>:<span class="hljs-string"><span class="hljs-string">"user"</span></span> ,<span class="hljs-attr"><span class="hljs-attr">pass</span></span>:<span class="hljs-string"><span class="hljs-string">"pass"</span></span> };</code> </pre></div></div></li><li>  run <pre> <code class="javascript hljs">path\to\nodewebkit\nw.exe path\to\telephone-directory</code> </pre></li></ol><br><br><h3>  Spread </h3><br><ol><li>  Pack the telephone-directory in .zip </li><li>  Rename the archive to .nw </li><li>  Little magic <pre> <code class="javascript hljs">copy /b path\to\nodewebkit\nw.exe+path\to\telephone-directory telephone-directory.exe</code> </pre></li><li>  Exit all other files from node-webkit except nw.exe to the directory with telephone-directory.exe </li></ol><br>  It should turn out like this: <br><img src="https://habrastorage.org/files/c55/375/390/c553753903fc416c8ed2ed6c7392d3a0.png"><br>  All - you can upload to a network drive or distribute as you like <br><br><h4>  PS </h4>  The code was written in a hurry, so it does not shine with beauty.  Many things can and should be improved.  But without the help of the community, I can hardly do anything more than what is already there.  For what already is - works and fully satisfies the requirements - and more is not needed. <br><br><h4>  Pps </h4>  The application is designed for an office with about 100 employees <i>(like the one in which I work)</i> .  With less, AD is hardly used.  And with more, some kind of code optimization may be required, but the building portal or something like that is probably already used. <br><br><h4>  PPPS </h4>  <u>The code is <b>45</b> lines</u> , so I am sure that even for system administrators who do not know JS, fitting the project to fit their needs is not difficult. </div><p>Source: <a href="https://habr.com/ru/post/251955/">https://habr.com/ru/post/251955/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../251943/index.html">Localization of Android applications using Google Sheets</a></li>
<li><a href="../251945/index.html">Combat use of the C # compiler for WEB Forms</a></li>
<li><a href="../251947/index.html">Introducing a series of technical webinars</a></li>
<li><a href="../251949/index.html">Dell PowerEdge Solutions for Movie Content Provider</a></li>
<li><a href="../251951/index.html">Weekly assembly Vivaldi 1.0.118.2</a></li>
<li><a href="../251957/index.html">Video about programming Atmel microcontrollers</a></li>
<li><a href="../251959/index.html">Network Technologies SDN - Software Defined Networking</a></li>
<li><a href="../251961/index.html">Unreal Engine is now free</a></li>
<li><a href="../251963/index.html">(Video report) Overview of Extreme Networks network equipment updates</a></li>
<li><a href="../251965/index.html">How JavaScript Grid Works with the OData Protocol</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>