<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Basics of caching. How? When? What for?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It's about caching in the web, or rather how and where to start. I often see how web developers who have no experience with caching, when starting to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Basics of caching. How? When? What for?</h1><div class="post__text post__text-html js-mediator-article">  It's about caching in the web, or rather how and where to start.  I often see how web developers who have no experience with caching, when starting to work, do everything wrong, and then they think why they don't get fresh data (they sometimes think that it cannot be otherwise) or why the server load has not decreased. <br><br>  Of course, everything depends on the task, that is, the approach will be different everywhere.  I will tell on the example of a news site in which cases you need caching and in which you do not need it, and of course, with examples. <br><br>  Continued <a href="http://reket.habrahabr.ru/blog/89122/">Basics of caching.</a>  <a href="http://reket.habrahabr.ru/blog/89122/">Practice</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><h4>  Do we need to use caching? </h4><br>  Before we start caching everything, do we need to define it?  It may be needed in two cases: <br>  - Reduced server load.  Everything is clear here, the server is <strike>choking and</strike> unable to cope with the task. <br>  - Reduced page generation time.  There are cases when data processing before output takes a lot of time.  Instead of processing them each time, you can process them once and put them in the cache.  As a result, data from the cache will be given instantly. <br><br><h4>  Where to begin? </h4><br>  And so, we realized that you need caching like air.  But how to determine the places that need it, and who definitely do not need it?  Let's consider, as an example, an ordinary news site.  In most cases, the database becomes the bottleneck, so we need to cache the samples.  What are our most visited pages? <br>  - Home, its components are a lot of blocks (latest news, popular for the last week, the most commented news, recent news comments, etc.). <br>  - View the news itself, and there and comments to it. <br>  - For an authorized user, a system of private messages is available, in this case we have to make a request to the database on each page, checking whether there are new messages, and if so, inform the user. <br><br>  What we need to cache, we realized, and what is not necessary?  Although there is probably a question whether to cache?  For example, a list of private messages.  In our case, we don‚Äôt need to cache it, since the site‚Äôs specialization is news, users only view them when they receive new messages, which is rare. <br><br><h4>  Getting to the theory </h4><br>  There are several caching tactics: <br>  - Obsolescence (for a certain time). <br>  - Disability (forever and if necessary, kill him yourself). <br>  - Combining (for a certain time, but also if necessary, we kill him). <br><br>  When using obsolescence, the time at which the data will be cached is selected depending on the frequency with which this data is updated and the level of importance for obtaining actual data.  We have identified the places with which we will work, so let's proceed. <br><br>  <u>Home page</u> <br>  Due to the fact that on this page we have a lot of blocks, we get a lot of queries to the database.  It would be possible to cache the contents of the main page as a whole, and update it once every 10 minutes, but since our blocks have different refresh rates, they will have to be cached separately.  Consider each block. <br>  - Latest news.  Cache it forever, kill when adding news to the site. <br>  - Popular news for the last week.  We cache for a day. <br>  - The most commented news.  Cache for an hour. <br>  - Recent comments on the news.  Cache forever, kill when adding a new comment.  If new comments appear very quickly, we cach the block for one minute. <br><br>  <u>View news</u> <br>  Here the stage of caching is divided into two parts - the news itself and comments to it. <br><br>  a) <em>News</em> .  Imagine that the news is made up by bb-codes, and the conversion process to html is time-consuming and sometimes even lengthy (regular expressions are also about how much CPU time is consumed), which means we have to convert and cache the finished html once.  We cache the news forever, and kill the cache when changing / deleting the news.  But what if we have a view counter you ask?  Everything is very simple, it would be possible to constantly update the cache of the news itself, but this trick is risky as there is a possibility of data integrity violation.  To do this, we will create a cache of views.  When viewing the news, we will have a request to the database by updating the number of views, as well as the cache increment of views.  Here we also cache forever, delete news when deleting. <br><br>  b) <em>Comments</em> .  We also use bb-codes in comments, here we also store ready-made comment html, but we cache a serialized array of comments, for which I‚Äôll say a little further.  Cache forever, delete the cache when adding a new comment / editing or deleting any comment to this news / deleting the news itself.  And what if we have several pages of comments?  We keep all comments in one cache, and before direct output we beat them onto pages. <br><br>  <u>Check for new messages</u> <br>  Here it is necessary to think carefully before choosing the tactics of caching, since it is selected for the type of load.  Consider several options: <br>  a) <em>Few users, permanent.</em>  Cache forever. <br>  b) <em>Many users, permanent.</em>  It depends on what is more expensive to us, memory (for the cache) or a decrease in the load from the database.  If there is a lot of memory and we don‚Äôt feel sorry for it, we will cache it forever, otherwise during the session. <br>  c) <em>Any number of users unique.</em>  Cache for the duration of the session. <br><br>  The check cache for new messages is always deleted when a new message is received and when a user is deleted. <br><br>  At this the theory ends, and the practice is yours. <br><br>  <strong>Ps.</strong>  I hope those who want to get acquainted with caching, but do not know where to start, will be useful.  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/87624/">https://habr.com/ru/post/87624/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../87608/index.html">Riot for Farmer</a></li>
<li><a href="../87615/index.html">CAPTCHA hackers earned $ 25 million</a></li>
<li><a href="../87618/index.html">How to make a round loupe without Canvas, SVG and VML</a></li>
<li><a href="../87620/index.html">MongoDB vs MySQL (vs Cassandra): And now a little more correct answer</a></li>
<li><a href="../87623/index.html">3D printing and other rapid prototyping systems</a></li>
<li><a href="../87626/index.html">BenQ V2410</a></li>
<li><a href="../87627/index.html">Spain legalized file sharing and peer networks</a></li>
<li><a href="../87630/index.html">Adventures of Gigabyte in Russia</a></li>
<li><a href="../87631/index.html">Tied up</a></li>
<li><a href="../87632/index.html">uTorrent on guard online viewing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>