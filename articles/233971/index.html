<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OpenVPN Installation and Setup Guide</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When we got employees working remotely, we had to think about how to provide them with secure access to our hosting servers, virtual dedicated servers...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OpenVPN Installation and Setup Guide</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/files/0d6/23c/2e2/0d623c2e27f049978261da731a4d3270.jpg"></p><br><br><p>  When we got employees working remotely, we had to think about how to provide them with secure access to our hosting servers, virtual dedicated servers of the Virtual Dedicated Server (VDS) developers, support and maintenance sites for development and other resources. </p><br><br><p>  For security reasons, access to these resources is restricted by using a firewall (firewall) on ports and IP addresses.  Daily reconfiguration of access with a change in dynamic IP of employees can hardly be called a reasonable solution. </p>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>  The way out was found rather quickly - this is the use of Virtual Private Network (VPN) technology and its free implementation of OpenVPN.  This implementation is available for almost all common platforms, including tablets and smartphones.  The history of the development of OpenVPN dates back 12 years (OpenVPN Technologies, Inc. was created by Francis Dinha and James Yona in 2002), so this is a reliable and time-tested solution. </p><br><br><p>  In our company, the VPN network allowed us to provide employees with secure access to the VDS, which plays the role of the OpenVPN server.  And already for the fixed IP of this server access to other resources of the company was allowed.  Along the way, a Squid proxy was installed on the OpenVPN server, which solved all the problems of employee access from dynamic IP to protected resources of the company. </p><br><br><p>  The subject of OpenVPN devoted numerous articles and posts on the forums.  However, the necessary information I had to collect in parts from different places.  Along the way, I had to deal with numerous terms and technologies.  VDS based on FreeBSD and Debian Linux were used as OpenVPN servers, and FreeBSD, Debian Linux, Ubuntu and Microsoft Windows workstations were used as clients. </p><br><br><p>  I hope that this article will be useful to those who first encountered the need to create a VPN or already use it to solve those or problems, as well as those who are looking for a replacement for commercial VPN implementations. </p><br><a name="habracut"></a><br><br><p>  Thank you for your comments and suggestions on the content of the article. </p><br><br><h2>  Table of contents </h2><br><ul><li>  <a href="https://habr.com/ru/post/233971/">Some theory</a> </li><li>  <a href="https://habr.com/ru/post/233971/">Components of the OpenVPN network</a> </li><li>  <a href="https://habr.com/ru/post/233971/">Preparing equipment for installing OpenVPN</a> </li><li>  <a href="https://habr.com/ru/post/233971/">Creation of CA certification center</a> </li><li>  <a href="https://habr.com/ru/post/233971/">Installing the Easy-RSA utility</a> </li><li>  <a href="https://habr.com/ru/post/233971/">Creating an OpenVPN server</a> </li><li>  <a href="https://habr.com/ru/post/233971/">Installing and running the OpenVPN client software</a> </li><li>  <a href="https://habr.com/ru/post/233971/">Installing Squid Proxy</a> </li><li>  <a href="https://habr.com/ru/post/233971/">Installation Features on FreeBSD</a> </li><li>  <a href="https://habr.com/ru/post/233971/">Peculiarities of installing the OpenVPN client in Microsoft Windows</a> </li><li>  <a href="https://habr.com/ru/post/233971/">useful links</a> </li></ul><br><br><a name="ancTheory"></a><h2>  Some theory </h2><br><p>  If earlier, to create a secure data transmission channel, large companies and organizations had to lay (or rent) cables and protect them from physical access by intruders, now this is not necessary.  With VPN, you can create secure virtual channels working through a secure "tunnel" on the Internet.  Such a solution can afford any, even a very small company. </p><br><br><p>  Of course, if there are increased requirements for data protection, you need to apply certified tools and contact specialists.  However, the level of protection provided by OpenVPN allows this technology to be used for many commercial applications. </p><br><br><p><img src="https://habrastorage.org/files/dcd/b3e/e94/dcdb3ee945d742fb975777860bfdec14.png"></p><br><br><p>  Why is a VPN called virtual and private? </p><br><br><p>  It is virtual because the network nodes are not connected by physical lines, but by virtual connections that are created by the software (software) VPN. </p><br><br><p>  The VPN is private, because only the nodes of the company that created this network can connect to it, and not everyone.  Each VPN node should have VPN software running.  There should also be keys and certificates that provide nodes access to the VPN and cryptographic protection of transmitted data. </p><br><br><p>  Thus, the VPN network can combine resources (servers and workstations) of the company into a single secure virtual network created on the basis of the Internet.  And now the employees working remotely (from home or from another country) will be located in the general network of their company.  VPN is also suitable for consolidating geographically separated offices of the company. </p><br><br><h3>  Network communication </h3><br><p>  OpenVPN software transmits data over the network using UDP or TCP protocols using the TUN / TAP driver.  The UDP protocol and the TUN driver allow you to connect to clients located behind NAT to the OpenVPN server. </p><br><br><p>  For OpenVPN, you can select an arbitrary port, which allows you to overcome the limitations of the firewall through which access from the local area network to the Internet (if such restrictions are set). </p><br><br><h3>  Security and Encryption </h3><br><p>  Security and encryption in OpenVPN is provided by the OpenSSL library and the Transport Layer Security Protocol (TLS).  Instead of OpenSSL in new versions of OpenVPN, you can use the PolarSSL library.  The TLS protocol is an enhancement to the Secure Sockets Layers (SSL) secure data transfer protocol. </p><br><br><p>  OpenSSL can use symmetric and asymmetric cryptography. </p><br><br><p>  In the first case, before beginning the transfer of data to all network nodes, it is necessary to place the same secret key.  This raises the problem of securely transmitting this key over an insecure Internet. </p><br><br><p>  In the second case, each participant sharing data has two keys - public (public) and private (secret). </p><br><br><p>  The public key is used to encrypt data, and the private key is used to decrypt.  The basis of encryption is rather complicated math.  The public key encryption algorithm selected in SSL / TLS allows decryption only with a private key. </p><br><br><p>  The private key is secret and must remain within the node on which it was created.  The public key must be transmitted to the participants of the data exchange. </p><br><br><p>  For secure data transfer, it is necessary to identify the parties involved in the data exchange.  Otherwise, you can become a victim of the so-called "mediator attack" (Man in the Middle, MITM).  During such an attack, the attacker connects to the data channel and listens on it.  It can also interfere, delete or change data. </p><br><br><p>  To provide authentication (user authentication), TLS uses a public key infrastructure (Public Key Infrastructure, PKI) and asymmetric cryptography. </p><br><br><p>  It is necessary to realize that decrypting data without having a private key is also possible, for example, using the sequential brute force method.  Although this method requires large computational resources, it is only a matter of time when the data can be decrypted. </p><br><br><p>  Although the key size affects the complexity of the decryption, no key can guarantee complete data security.  In addition, there is the possibility of stealing already decrypted data and keys due to vulnerabilities and bookmarks in the operating system or application software, as well as in the hardware of servers and workstations. </p><br><br><p>  Data encryption increases traffic and slows down data exchange.  The greater the key length used to encrypt data, the harder it will be to pick it up, but the more noticeable is the slowing down of data exchange. </p><br><br><h3>  Certificates and CA certification center </h3><br><p>  As we already said, with asymmetric cryptography, the public key is used to encrypt data, and the private key is used to decrypt.  To avoid a fake public key, some third party must reassure him.  As a result of this procedure, a so-called <b>public key certificate is created</b> . </p><br><br><p>  The certificate must be certified by a trusted organization.  This organization plays the role of a Certification authority (CA). </p><br><br><p>  If a public key is created for public use, a commercial or government organization with an indisputable reputation should act as a certification center.  This organization publishes its own public key, accessible to all. </p><br><br><p>  There are quite a few commercial organizations that issue certificates, for example, for creating HTTPS sites, for digitally signing email messages or documents, for instant messaging systems such as Jabber.  These certificates are issued for a limited time and cost money. </p><br><br><p>  But for a VPN created for your company, you can create your own CA <b>certificate authority</b> and issue so-called <b>self</b> - <b>signed certificates</b> .  Of course, the credibility of such certificates will not go beyond the scope of your company, but firstly, this will be quite enough, and secondly, self-signed certificates are completely free. </p><br><br><p> Self-signed certificates will play the role of public keys with which the nodes of your OpenVPN network will encrypt data.  To decrypt data, private keys will be used. </p><br><br><p>  Certificates are created in accordance with the X.509 standard.  This standard defines data formats and procedures for the distribution of public keys using certificates signed with electronic signatures. </p><br><br><p>  An X.509 certificate is a public key containing data such as the subject owning the certificate, the node name, the validity period, the algorithm and the signature value of the certificate, and so on.  The certificate must be signed with the Certification authority (CA) private key. </p><br><br><p>  When our workstation node connects to a remote node (server) using the TLS protocol, the server sends it an X.509 certificate.  Our site has the public key of the CA authorization center that signed this certificate.  This key is used to verify the signature. </p><br><br><p>  Thus, there is a way to check the remote node (server) to which our node is going to connect in order to exclude the MITM "proxy" attacks. </p><br><br><h3>  Certificate Revocation List </h3><br><p>  Sometimes it is necessary to block access of individual nodes to the company's VPN network, for example, to block access to a workstation of a dismissed employee. </p><br><br><p>  To simplify this procedure, OpenVPN provides a certificate revocation list (Certificate Revocation List, CRL) and simple tools to manage this list. </p><br><br><p>  The CRL is created in the CA authorization center and then copied to the OpenVPN server.  After making changes to the CRL list, it must be re-copied to the OpenVPN server. </p><br><br><h3>  Diffie-Hellman file </h3><br><p>  The Diffie-Hellman (Diffie-Hellman) file is needed to implement a protocol of the same name that allows using an insecure channel to obtain a shared secret key.  This key will be further used for secure data exchange using symmetric encryption algorithms. </p><br><br><p>  When applied to the OpenVPN, the Diffie-Hellman file is needed to protect the traffic from decryption if the keys were stolen.  This refers to the traffic that was recorded and saved before the theft of keys. </p><br><br><p>  The Diffie-Hellman file is created on the OpenVPN server. </p><br><br><h3>  HMAC static key </h3><br><p>  The static key (hash code) of message authentication (Hash-based Message Authentication Code (HMAC)) provides authentication of information transmitted between the parties.  This key is created on the OpenVPN server for the purpose of additional protection against DoS-attacks and flood. </p><br><br><a name="ancComponents"></a><h2>  Components of the OpenVPN network </h2><br><p>  Before we move from theory to practice, we list the main components of the OpenVPN network and the objects with which we will have to deal. </p><br><br><p>  <b>CA</b> <b>Certification</b> <b>Authority</b> </p><br><br><p>  Issues certificates at the request of the nodes of the VPN network, signed by a certificate of the certification authority.  Provides VPN nodes to their own certificate to verify the certifier.  Manages CRL certificate revocation list. </p><br><br><p>  <b>OpenVPN server</b> </p><br><br><p>  The OpenVPN server software creates a tunnel inside an unsecured network, for example, the Internet.  This tunnel provides secure encrypted traffic between nodes that are participants in data exchange on the OpenVPN network. </p><br><br><p>  <b>OpenVPN Client</b> </p><br><br><p>  The OpenVPN client software is installed on all nodes that require a secure data channel with the OpenVPN server.  With appropriate configuration of the OpenVPN server, it is possible to securely transfer data between OpenVPN clients, and not only between clients and the OpenVPN server. </p><br><br><p>  <b>Certificates (public keys) X.509</b> </p><br><br><p>  X.509 certificates are public keys certified by a CA certificate authority.  They are used to encrypt data.  The fact of certifying the certificate by the CA certifying authority allows identifying the party transmitting the encrypted data. </p><br><br><p>  The certificate request file is created on the network nodes, then it is transferred to the certification authority node and signed there.  The resulting signed certificate is transferred back to the OpenVPN network node that requested it. </p><br><br><p>  <b>Private keys</b> </p><br><br><p>  Private keys are secret.  They should be created and stored on each node of the OpenVPN network, designed to decrypt data, and should never be transmitted over the network. </p><br><br><p>  Private keys are created on the OpenVPN network nodes simultaneously with the certificate request file. </p><br><br><p>  <b>CRL certificate revocation list</b> </p><br><br><p>  Contains a list of certificates that have lost confidence.  It is created and edited on the CA certificate authority node.  To disconnect a node from the network, it is enough to register its certificate in the CRL list. </p><br><br><p>  After creation and each change, the CRL list is transferred to the OpenVPN servers. </p><br><br><p>  <b>Diffie-Hellman file</b> </p><br><br><p>  It is used to exclude the decryption of traffic recorded before this abduction in case of theft of keys.  It is created on the OpenVPN server. </p><br><br><p>  <b>HMAC static key</b> </p><br><br><p>  It is used to authenticate the transmitted information.  Provides protection against DoS-attacks and flooding.  It is created on the OpenVPN server. </p><br><br><a name="ancHardware"></a><h2>  Preparing equipment for installing OpenVPN </h2><br><p>  If you are setting up a VPN for the first time, it‚Äôs best to experiment on VDS virtual machines.  These can be VDSs created locally on your computer or on a server on your network, or rented from a provider.  Before renting a VDS, ask if the TUN / TAP driver is supported.  Some providers require an extra charge to connect TUN / TAP. </p><br><br><p>  In fig.  1. we showed the stand scheme on which we will install the components and nodes of OpenVPN (the names and IP addresses of the hosts may be different). </p><br><br><p><img src="https://habrastorage.org/files/5b2/730/0f3/5b27300f38224a79a112d370e0410048.jpg"></p><br><p>  <b>Fig.</b>  <b>1. Stand for learning OpenVPN.</b> </p><br><br><p>  Here are three nodes (host), each of which will require a separate VDS: </p><br><br><ul><li>  OpenVPN server (vpnsrv, 192.168.0.54); </li><li>  OpenVPN client (vpnclient, 192.168.0.55); </li><li>  CA Certification Authority (ca, 192.168.0.53) </li></ul><br><p>  Hosts of the client and the VPN server are connected by a normal, insecure channel.  In the case of a layout, this could be a local area network, in real life, an Internet channel.  The OpenVPN software creates a channel in this network, indicated in fig.  1 in red, inside which a secure encrypted channel is installed (indicated in green). </p><br><br><p>  In the layout, the CA certifier's host can be connected to your local network.  For real work, the CA host needs to be disconnected from the network, and the exchange of certificates and keys should be carried out using, for example, a USB flash drive. </p><br><br><p>  If security requirements are increased, the CA host must be placed in a secure room ‚Äî the information on this machine allows you to create access keys to your VPN network. </p><br><br><p>  We installed OpenVPN servers in Debian Linux and FreeBSD OS, OpenVPN clients in Debian Linux, FreeBSD and Microsoft Windows. </p><br><br><p>  The main part of the article is devoted to the installation of OpenVPN components for Debian Linux.  Next, we look at the installation features for FreeBSD and Microsoft Windows. </p><br><br><p>  If possible, on the OpenVPN network nodes, use newer OS versions.  Before you start working with OpenVPN, upgrade your Linux packages: </p><br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># apt-get update # apt-get upgrade</span></span></code> </pre> <br><p>  Install the zip package on all nodes if it has not been installed before: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># aptitude install zip</span></span></code> </pre><br><p>  This package will be needed to unpack the archive of the Easy-RSA utility, with which we will create keys and certificates. </p><br><br><p>  On all nodes, configure the update and time synchronization. </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># apt-get install ntpdate # apt-get install -y ntp # /etc/init.d/ntp stop # ntpdate pool.ntp.org # /etc/init.d/ntp start</span></span></code> </pre><br><p>  Time synchronization is necessary because  Certificates have a validity period.  If the clock, for example, on the host of the CA CA and the OpenVPN server are not synchronous, it may happen that the certificate issued by the certification authority will not be valid on the OpenVPN network nodes due to date or time restrictions. </p><br><br><p>  We will begin further work with the preparation of the CA certification center host.  Then, install the OpenVPN server and client hosts. </p><br><br><a name="ancCA"></a><h2>  Creation of CA certification center </h2><br><p>  As we have already said, the task of the CA certification center is the issuance of signed certificates for the server and OpenVPN clients. </p><br><br><p>  To obtain a certificate, a server or client on its host generates a certificate request file.  This request file is sent to the CA host, which creates a certificate and signs it.  Next, the signed certificate is transmitted to the requesting host. </p><br><br><p>  Simultaneously with the certificate request, a private key is created.  Private keys are created for all OpenVPN network nodes: for CA authorization center, for server and all OpenVPN clients. </p><br><br><p>  For security, key files should never leave the nodes where they were created.  You can exchange only requests for certificates and certificates, private keys can not be exchanged and there is no need. </p><br><br><p>  In fig.  2 shows the process of obtaining a signed certificate for an OpenVPN server. </p><br><br><p><img src="https://habrastorage.org/files/966/23a/66b/96623a66bb5b4f8a952057e54375635b.jpg"></p><br><p>  <b>Fig.</b>  <b>2. Obtaining a certificate for the</b> <b>OpenVPN</b> <b>server</b> </p><br><br><p>  The OpenVPN server creates its private key and certificate request file.  The request file is transmitted to the certification authority, for example, on a USB flash drive. </p><br><br><p>  Based on the request, the certificate authority creates a signed certificate, which is then required to be transferred to the OpenVPN server, also on a USB flash drive. </p><br><br><p>  If there are no special requirements for security or you are only learning OpenVPN, you can connect the certification authority machine to the network and send requests and certificates, for example, using SFTP or SCP utilities.  You can even combine the functions of a CA and, for example, an OpenVPN server in the same host. </p><br><br><p>  Similarly, you need to obtain certificates for all client nodes (Fig. 3). </p><br><br><p><img src="https://habrastorage.org/files/f56/4be/572/f564be57237d428ba15cf0f2fd4ae93d.jpg"></p><br><p>  <b>Fig.</b>  <b>3. Obtaining a certificate for an</b> <b>OpenVPN</b> <b>client</b> </p><br><br><a name="ancEasyRSA"></a><h2>  Installing the Easy-RSA utility </h2><br><p>  All operations for creating keys and certificates can be performed using the openssl utility.  However, it is easier to use the Easy-RSA program, specially created for this purpose, which uses openssl to perform actions with keys and certificates. </p><br><br><p>  Earlier, the Easy-RSA utility was supplied with OpenVPN, but now it is a <a href="https://github.com/OpenVPN/easy-rsa">separate project</a> . </p><br><br><p>  All operations with the certification center and certificates can (and should) be carried out on behalf of an unprivileged user. </p><br><br><p>  Create a user with a name, for example, ca, and go to his home directory: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># adduser ca # su ca $ cd</span></span></code> </pre><br><p>  Download the program distribution utility wget. </p><br><br><pre> <code class="bash hljs">$ wget https://github.com/OpenVPN/easy-rsa/archive/master.zip</code> </pre><br><p>  After downloading, unzip the master.zip archive: </p><br><br><pre> <code class="bash hljs">$ unzip master.zip</code> </pre><br><p>  In tab.  1 lists the files and directories included in the Easy-RSA distribution. </p><br><br><p>  <b>Table 1. The composition of the distribution Easy-RSA.</b> </p><br><table border="1"><tbody><tr><td width="177"><p>  <b>File or directory</b> </p></td><td width="461"><p>  <b>Description</b> </p></td></tr><tr><td width="177"><p>  COPYING </p></td><td width="461"><p>  License Information </p></td></tr><tr><td width="177"><p>  Changelog </p></td><td width="461"><p>  Change log </p></td></tr><tr><td width="177"><p>  Licensing </p></td><td width="461"><p>  Directory with license text file </p></td></tr><tr><td width="177"><p>  README </p></td><td width="461"><p>  Brief information about the program Easy-RSA </p></td></tr><tr><td width="177"><p>  README.quickstart.md </p></td><td width="461"><p>  Easy-RSA Quick Start Guide </p></td></tr><tr><td width="177"><p>  Build </p></td><td width="461"><p>  Script to create a distribution </p></td></tr><tr><td width="177"><p>  Distro </p></td><td width="461"><p>  This directory contains files for Windows. </p></td></tr><tr><td width="177"><p>  Doc </p></td><td width="461"><p>  Easy-RSA Documentation </p></td></tr><tr><td width="177"><p>  easyrsa3 </p></td><td width="461"><p>  Directory with the program Easy-RSA </p></td></tr><tr><td width="177"><p>  release-keys </p></td><td width="461"><p>  GPG Key ID Key Used to Sign Distribution </p></td></tr></tbody></table><br><p>  We recommend that you read the README.quickstart.md file, as well as the files from the Doc folder.  To create keys and certificates, go to the easyrsa3 directory, where the Easy-RSA executable file is located. </p><br><br><h3>  Creating PKI Public Key Infrastructure </h3><br><p>  In the first step, create a public key infrastructure (Public Key Infrastructure, PKI): </p><br><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /home/ca/easy-rsa-master/easyrsa3 $ ./easyrsa init-pki</code> </pre><br><p>  You will see the message: </p><br><br><pre> <code class="bash hljs">init-pki complete; you may now create a CA or requests. Your newly created PKI dir is: /home/ca/easy-rsa-master/easyrsa3/pki</code> </pre><br><p>  As a result of the init-pki command, the directory / home / ca / ‚Äã‚Äãeasy-rsa-master / easyrsa3 / pki was created, where the PKI public key infrastructure is located. </p><br><br><p>  In the second step, use the build-ca command to create a CA certificate authority: </p><br><br><pre> <code class="bash hljs">$ ./easyrsa build-ca</code> </pre><br><p>  In response to this command, you will be prompted to enter a password and the so-called Common Name: </p><br><br><pre> <code class="bash hljs">Generating a 2048 bit RSA private key .....+++ ................................................................+++ writing new private key to <span class="hljs-string"><span class="hljs-string">'/home/ca/easy-rsa-master/easyrsa3/pki/private/ca.key'</span></span> Enter PEM pass phrase:******** Verifying - Enter PEM pass phrase:******** ----You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter <span class="hljs-string"><span class="hljs-string">'.'</span></span>, the field will be left blank. ----- Common Name (eg: your user, host, or server name) [Easy-RSA CA]:ca.mydomain.ru&gt; CA creation complete and you may now import and sign cert requests. Your new CA certificate file <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> publishing is at: /home/ca/easy-rsa-master/easyrsa3/pki/ca.crt</code> </pre><br><br><p>  The password will protect the private key of the certification authority created in the PEM (Privacy Enhancement for Internet Electronic Mail) format.  This password will be required each time you sign certificates for OpenVPN servers and clients in the certification authority. </p><br><br><p>  To get rid of the need to enter a password, you can set the nopass option when running the build-ca command: </p><br><br><pre> <code class="bash hljs">$ ./easyrsa build-ca nopass</code> </pre><br><p>  Note that an attacker can easily use a stolen key created without a password. </p><br><br><p>  For Common Name, specify, for example, the domain name allocated for the CA certification authority, the username or host name of the CA server. </p><br><br><p>  For the certification authority, the build-ca command will create two files: </p><br><br><pre> <code class="bash hljs">/home/ca/easy-rsa-master/easyrsa3/pki/private/ca.key /home/ca/easy-rsa-master/easyrsa3/pki/ca.crt</code> </pre><br><br><p><img src="https://habrastorage.org/files/4f0/453/fc2/4f0453fc2bd4497da8ce945e97005fdf.jpg"></p><br><br><p>  The ca.key file is a private CA center key, it is <b>secret</b> and cannot be transferred to other nodes of your network. </p><br><br><p>  The certificate file of the ca.crt certifying center, on the contrary, is open, and it will be needed on the nodes of OpenVPN servers and clients.  Write the ca.crt file to a USB flash drive to transfer to other nodes. </p><br><br><p><img src="https://habrastorage.org/files/997/7f7/72c/9977f772c13d4e88bf97abee02a7d37f.jpg"></p><br><br><p>  Mount USB flash drive, you can, for example, like this: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># fdisk -l # mkdir /mnt/flash # mount -t vfat /dev/sdb1 /mnt/flash</span></span></code> </pre><br><p>  Here we assume that the USB flash drive has become a device / dev / sdb1, and its file system is FAT32. </p><br><br><p>  Copy the CA certificate file: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cp /home/ca/easy-rsa-master/easyrsa3/pki/ca.crt /mnt/flash/ca.crt</span></span></code> </pre><br><p>  To work with a USB flash drive with the NTFS file system, first install the ntfs-3g package: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># aptitude install ntfs-3g</span></span></code> </pre><br><p>  Mount the disk as follows: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mount -t ntfs-3g /dev/sdb1 /mnt/flash</span></span></code> </pre><br><p>  After copying is complete, unmount the USB drive: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># umount /mnt/flash</span></span></code> </pre><br><br><h3>  Creating a certificate revocation list </h3><br><p>  If an employee leaves, you need to block his access to the company's VPN network.  OpenVPN provides a CRL certificate revocation list specifically for this purpose.  Create it with this command: </p><br><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /home/ca/easy-rsa-master/easyrsa3 $ ./easyrsa gen-crl</code> </pre><br><p>  You will be asked for a password to access the private key ca.key of the certification authority.  The certificate revocation list will be created in the file /home/ca/easy-rsa-master/easyrsa3/pki/crl.pem. </p><br><br><p>  Copy this file to a USB flash drive: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cp /home/ca/easy-rsa-master/easyrsa3/pki/crl.pem /mnt/flash</span></span></code> </pre><br><br><p><img src="https://habrastorage.org/files/884/451/ee8/884451ee85a1425dbd693f3c5b73dd90.jpg"></p><br><br><p>  If you need to block a previously issued certificate, use the following command: </p><br><br><pre> <code class="bash hljs">$ ./easyrsa revoke developer5</code> </pre><br><p>  Here we revoked the certificate for a developer5 client.  Next, you need to copy the new CRL file to the OpenVPN server and restart the OpenVPN daemon. </p><br><br><h3>  PKI files and directories created </h3><br><p>  In tab.  2 we have provided a brief description of some of the PKI files and directories created as a result of our actions. </p><br><br><p>  <b>Table 2. PKI directory structure.</b> </p><br><table border="1"><tbody><tr><td width="177"><p>  <b>File or directory</b> </p></td><td width="461"><p>  <b>Description</b> </p></td></tr><tr><td width="177"><p>  ca.crt </p></td><td width="461"><p>  Certificate of CA certification center, not secret </p></td></tr><tr><td width="177"><p>  crl.pem </p></td><td width="461"><p>  CRL certificate revocation list </p></td></tr><tr><td width="177"><p>  issued </p></td><td width="461"><p>  Directory with certificates created by CA authorization center, not secret </p></td></tr><tr><td width="177"><p>  private </p></td><td width="461"><p>  Directory with <b>secret</b> private keys </p></td></tr><tr><td width="177"><p>  Reqs </p></td><td width="461"><p>  Directory of certificate requests, not secret </p></td></tr></tbody></table><br><br><h3>  Easy-RSA Help </h3><br><p>  Run the Easy-RSA utility without parameters: </p><br><br><pre> <code class="bash hljs">$ ./easyrsa</code> </pre><br><p>  A list of all utility commands will appear on the screen, along with the full path to the program and to the PKI. </p><br><p>  To get help on the desired command, add the help option.  For example, you can get help on the build-ca command: </p><br><br><pre> <code class="bash hljs">$ ./easyrsa <span class="hljs-built_in"><span class="hljs-built_in">help</span></span> build-ca</code> </pre><br><br><a name="ancOpenVPNServer"></a><h2>  Creating an OpenVPN server </h2><br><p>  The process of creating an OpenVPN server involves installing the openvpn package, preparing configuration files, keys, and certificates. </p><br><br><h3>  Installing the openvpn package </h3><br><p>  Install the OpenVPN server package as follows: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># apt-get install openvpn</span></span></code> </pre><br><br><h3>  Preparing configuration files </h3><br><p>  Configuration files, certificates and keys should be placed in the / etc / openvpn directory, which will be created automatically during the installation of the openvpn package. </p><br><br><p>  First of all, let's prepare the openssl.cnf and server.conf configuration files.  The first of these files defines the OpenSSL configuration, the second the OpenVPN server configuration. </p><br><br><p>  Included with the Easy-RSA utility is an example OpenSSL configuration file (assuming we installed the utility in the home directory of the user ca): </p><br><br><pre> <code class="bash hljs">/home/ca/easy-rsa-master/easyrsa3/openssl-1.0.cnf</code> </pre><br><p>  We, however, recommend using a simplified version of this file from our article to begin with. </p><br><br><p>  The openssl.cnf file contains the absolute path to the directory with keys and certificates that you just created. </p><br><br><div class="spoiler">  <b class="spoiler_title">Contents of openssl.cnf</b> <div class="spoiler_text"><pre> <code class="bash hljs">[ ca ] default_ca = CA_default [ CA_default ] dir = /etc/openvpn crl_dir = <span class="hljs-variable"><span class="hljs-variable">$dir</span></span> database = <span class="hljs-variable"><span class="hljs-variable">$dir</span></span>/index.txt new_certs_dir = <span class="hljs-variable"><span class="hljs-variable">$dir</span></span> certificate = <span class="hljs-variable"><span class="hljs-variable">$dir</span></span>/ca.crt serial = <span class="hljs-variable"><span class="hljs-variable">$dir</span></span> crl = <span class="hljs-variable"><span class="hljs-variable">$dir</span></span>/crl.pem private_key = <span class="hljs-variable"><span class="hljs-variable">$dir</span></span>/server.key RANDFILE = <span class="hljs-variable"><span class="hljs-variable">$dir</span></span>/.rand default_days = 3650 default_crl_days = 365 default_md = md5 unique_subject = yes policy = policy_any x509_extensions = user_extensions [ policy_any ] organizationName = match organizationalUnitName = optional commonName = supplied [ req ] default_bits = 2048 default_keyfile = privkey.pem distinguished_name = req_distinguished_name x509_extensions = CA_extensions [ req_distinguished_name ] organizationName = Organization Name (must match CA) organizationName_default = Company organizationalUnitName = Location Name commonName = Common User or Org Name commonName_max = 64 [ user_extensions ] basicConstraints = CA:FALSE [ CA_extensions ] basicConstraints = CA:TRUE default_days = 3650 [ server ] basicConstraints = CA:FALSE nsCertType = server</code> </pre><br></div></div><br><p>  An example of the openvpn.conf file of the OpenVPN server configuration is on the project site at <a href="http://openvpn.net/index.php/open-source/documentation/howto.html">openvpn.net/index.php/open-source/documentation/howto.html#server</a> .  We suggest starting with an abbreviated version of this file from our article. </p><br><br><div class="spoiler">  <b class="spoiler_title">Contents of the server.conf file</b> <div class="spoiler_text"><pre> <code class="bash hljs">port 1194 proto udp dev tun user openvpn group openvpn <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /etc/openvpn persist-key persist-tun tls-server tls-timeout 120 dh /etc/openvpn/dh.pem ca /etc/openvpn/ca.crt cert /etc/openvpn/vpn-server.crt key /etc/openvpn/server.key crl-verify /etc/openvpn/crl.pem tls-auth /etc/openvpn/ta.key 0 server 10.15.0.0 255.255.255.0 client-config-dir /etc/openvpn/ccd client-to-client topology subnet max-clients 5 push <span class="hljs-string"><span class="hljs-string">"dhcp-option DNS 10.15.0.1"</span></span> route 10.15.0.0 255.255.255.0 comp-lzo keepalive 10 120 status /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/openvpn/openvpn-status.log 1 status-version 3 <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>-append /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/openvpn/openvpn-server.log verb 3 mute 20</code> </pre><br></div></div><br><p>  To start the OpenVPN server successfully, you need to create directories, certificates and keys that are referenced in the openssl.cnf and server.conf files, as well as the openvpn user. </p><br><br><p>  Create a directory for the OpenVPN server log: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mkdir /var/log/openvpn/</span></span></code> </pre><br><p>  Create a directory for client configurations (not yet used): </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mkdir /etc/openvpn/ccd</span></span></code> </pre><br><br><h3>  Preparing the certificate and key for the OpenVPN server </h3><br><p>  In addition to openssl.cnf and openvpn.conf in the / etc / openvpn / directory, we will need the files listed in table.  3 </p><br><br><p>  <b>Table 3. Files for the OpenVPN server.</b> </p><br><table border="1"><tbody><tr><td width="140"><p>  <b>File</b> </p></td><td width="499"><p>  <b>Description</b> </p></td></tr><tr><td width="140"><p>  dh.pem </p></td><td width="499"><p>  Diffie-Hellman file to protect traffic from decryption </p></td></tr><tr><td width="140"><p>  ca.crt </p></td><td width="499"><p>  CA Certificate Authority Certificate </p></td></tr><tr><td width="140"><p>  server.crt </p></td><td width="499"><p>  OpenVPN Server Certificate </p></td></tr><tr><td width="140"><p>  server.key </p></td><td width="499"><p>  OpenVPN server private key, <b>secret</b> </p></td></tr><tr><td width="140"><p>  crl.pem </p></td><td width="499"><p>  CRL certificate revocation list </p></td></tr><tr><td width="140"><p>  ta.key </p></td><td width="499"><p>  HMAC key for additional protection against DoS attacks and flood </p></td></tr></tbody></table><br><p>  First of all, we will create a private key and a certificate request file for the OpenVPN server, and will also receive a signed certificate by the created request in the CA certificate authority.  As a result, we will have server.crt and server.key files.  Next, we will deal with the other files listed in Table.  3 </p><br><br><p>  To create a certificate request and private key for the OpenVPN server, we need to install the Easy-RSA program on the OpenVPN server, in the same way as we did for the CA certificate authority. </p><br><br><p>  Installation of Easy-RSA, generation of the OpenVPN server's private key and certificate request will be done on behalf of the vpnoperator user, who does not have administrator privileges.  Add this user before starting work: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># adduser vpnoperator</span></span></code> </pre><br><p>  First of all, we install the Easy-RSA utility on the OpenVPN server and start the initialization of the PKI public key infrastructure: </p><br><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /home/vpnoperator $ wget https://github.com/OpenVPN/easy-rsa/archive/master.zip $ unzip master.zip $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /home/vpnoperator/easy-rsa-master/easyrsa3 $ ./easyrsa init-pki</code> </pre><br><p>  After successful PKI initialization, a message will appear in the console: </p><br><br><pre> <code class="bash hljs">init-pki complete; you may now create a CA or requests. Your newly created PKI dir is: /home/vpnoperator/easy-rsa-master/easyrsa3/pki</code> </pre><br><p>  Since our OpenVPN server will not play the role of certification authority, after the initial PKI initialization we will not create a CA with the build-ca command. </p><br><br><p>  The PKI infrastructure will be created in the / home / vpnoperator / easy-rsa-master / easyrsa3 / pki directory. </p><br><br><p>  At the next stage, we will receive a request for a certificate and private key of the OpenVPN server: </p><br><br><pre> <code class="bash hljs">$ ./easyrsa gen-req server</code> </pre><br><p>  This command will create the server.req request file and the server.key private key.  During the generation process, you will be asked for a password, as well as the Common Name name for the OpenVPN server: </p><br><br><pre> <code class="bash hljs">Generating a 2048 bit RSA private key ...............................................................................................................+++ ....................................+++ writing new private key to <span class="hljs-string"><span class="hljs-string">'/home/vpnoperator/easy-rsa-master/easyrsa3/pki/private/server.key'</span></span> Enter PEM pass phrase:****** Verifying - Enter PEM pass phrase:****** ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter <span class="hljs-string"><span class="hljs-string">'.'</span></span>, the field will be left blank. ----- Common Name (eg: your user, host, or server name) [server]: vpn-server Keypair and certificate request completed. Your files are: req: /home/vpnoperator/easy-rsa-master/easyrsa3/pki/reqs/server.req key: /home/vpnoperator/easy-rsa-master/easyrsa3/pki/private/server.key</code> </pre><br><p>  The first of these files we need to transfer to the server of the CA authorization center, it is not secret.  The second file is a <b>secret one</b> , and it should not leave the limits of the OpenVPN server. </p><br><br><p>  As we have already said, it is safest to transfer a certificate request via a USB flash drive so as not to connect the CA server to the network: </p><br><br><p><img src="https://habrastorage.org/files/5aa/2c8/2c9/5aa2c82c94ae4116b306f81b214c3fc0.jpg"></p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># fdisk -l # mkdir /mnt/flash # mount -t vfat /dev/sdb1 /mnt/flash # cp /home/vpnoperator/easy-rsa-master/easyrsa3/pki/reqs/server.req /mnt/flash/server.req # umount /mnt/flash</span></span></code> </pre><br><p>  Note that when generating a private key, a password was requested.  This password provides protection if the private key is compromised (stolen by an attacker).  The password of the OpenVPN private key will be requested from the console each time the server boots and OpenVPN starts. </p><br><br><p>  But what if you do not have access to the OpenVPN server console or is this access difficult?  This can happen, for example, if you created an OpenVPN server on the basis of a VDS leased from a provider that does not provide console access. </p><br><br><p>  In this situation, you can create a private key without a password using the nopass option: </p><br><br><pre> <code class="bash hljs">$ ./easyrsa gen-req server nopass</code> </pre><br><p>  So, you have created the OpenVPN server private key and certificate request. </p><br><br><p>  Mount the USB flash drive on the CA certifier's host, and then import the PKI as user ca on your behalf: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mount -t vfat /dev/sdb1 /mnt/flash # su ca $ cd /home/ca/easy-rsa-master/easyrsa3 $ ./easyrsa import-req /mnt/flash/server.req vpn-server</span></span></code> </pre><br><p>  Here we have the abbreviated name of the certificate request as "vpn-server".  This abbreviated name will be used in further operations with the certificate. </p><br><br><p>  After successful import of the request, you will see the following message: </p><br><br><pre> <code class="bash hljs">The request has been successfully imported with a short name of: vpn-server You may now use this name to perform signing operations on this request.</code> </pre><br><p>  If there are no errors, sign the certificate request: </p><br><br><pre> <code class="bash hljs">./easyrsa sign-req server vpn-server</code> </pre><br><p>  In the process of creating a signed certificate, confirmation will be requested (answer yes with it), as well as the password of the private key of the CA authorization center: </p><br><br><pre> <code class="bash hljs">You are about to sign the following certificate. Please check over the details shown below <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> accuracy. Note that this request has not been cryptographically verified. Please be sure it came from a trusted <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> or that you have verified the request checksum with the sender. Request subject, to be signed as a server certificate <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> 3650 days: subject= commonName = server Type the word <span class="hljs-string"><span class="hljs-string">'yes'</span></span> to <span class="hljs-built_in"><span class="hljs-built_in">continue</span></span>, or any other input to abort. Confirm request details: yes Using configuration from /home/ca/easy-rsa-master/easyrsa3/openssl-1.0.cnf Enter pass phrase <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> /home/ca/easy-rsa-master/easyrsa3/pki/private/ca.key:****** Check that the request matches the signature Signature ok The Subject<span class="hljs-string"><span class="hljs-string">'s Distinguished Name is as follows commonName :ASN.1 12:'</span></span>server<span class="hljs-string"><span class="hljs-string">' Certificate is to be certified until Jun 26 15:48:25 2024 GMT (3650 days) Write out database with 1 new entries Data Base Updated Certificate created at: /home/ca/easy-rsa-master/easyrsa3/pki/issued/vpn-server.crt</span></span></code> </pre><br><p>  Now the certificate has been received, and it is located on the server of the certification authority in the file home / ca / ‚Äã‚Äãeasy-rsa-master / easyrsa3 / pki / issued / vpn-server.crt.  We need to transfer this file to the OpenVPN server. </p><br><br><p><img src="https://habrastorage.org/files/f8e/ab1/a1d/f8eab1a1df9848658836d5a1275933f2.jpg"></p><br><br><p>  Copy the certificate file /ca/easy-rsa-master/easyrsa3/pki/issued/vpn-server.crt from the server of the certification authority to a file on the OpenVPN server /home/vpnoperator/vpn-server.crt via a USB flash disk: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cp /home/ca/easy-rsa-master/easyrsa3/pki/issued/vpn-server.crt /mnt/flash/</span></span></code> </pre><br><br><p>  Then mount the USB drive on VDS OpenVPN and copy the CA certificate ca.crt files, crl.pem certificate revocation list and OpenVPN server vpn-server.crt certificate to the / etc / openvpn directory: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mount -t vfat /dev/sdb1 /mnt/flash # cp /mnt/flash/ca.crt /etc/openvpn # cp /mnt/flash/crl.pem /etc/openvpn # cp /mnt/flash/vpn-server.crt /etc/openvpn # umount /mnt/flash</span></span></code> </pre><br><p>  Copy the private key file from the usr / home / vpnoperator / easy-rsa-master / easyrsa3 / pki / private / directory to the / etc / openvpn / directory: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cp /home/vpnoperator/easy-rsa-master/easyrsa3/pki/private/server.key /etc/openvpn</span></span></code> </pre><br><br><h3>  Generating a Diffie-Hellman File </h3><br><p>  Create Diffie-Hellman keys with the following command: </p><br><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /home/vpnoperator/easy-rsa-master/easyrsa3 $ ./easyrsa gen-dh</code> </pre><br><p>  The gen-dh command has been working for quite a while.  Upon completion, you will see the message: </p><br><br><pre> <code class="bash hljs">DH parameters of size 2048 created at /home/vpnoperator/easy-rsa-master/easyrsa3/pki/dh.pem</code> </pre><br><p>  Copy the file / home / vpnoperator / easy-rsa-master / easyrsa3 / pki / dh.pem to the / etc / openvpn / directory: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cp /home/vpnoperator/easy-rsa-master/easyrsa3/pki/dh.pem /etc/openvpn</span></span></code> </pre><br><br><h3>  Creating a static HMAC key </h3><br><p>  To create an HMAC key, use the openvpn command with the --genkey and --secret options: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cd /etc/openvpn # openvpn --genkey --secret ta.key</span></span></code> </pre><br><br><p><img src="https://habrastorage.org/files/1d3/7b7/401/1d37b7401d9d4056827ed1b05d08d61f.jpg"></p><br><br><p>  Write the ta.key file to a USB drive: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cp /etc/openvpn/ta.key /mnt/flash</span></span></code> </pre><br><br><h3>  Revision of files before running OpenVPN </h3><br><p>  So, we received a signed OpenVPN server certificate, a CA certificate authority certificate itself, a certificate revocation list from the certification authority, created a Diffie-Hellman file and an HMAC key. </p><br><br><p>  Before starting the OpenVPN daemon, we need in the / etc / openvpn / directory for Linux or / usr / local / etc / openvpn / for FreeBSD the following files: </p><br><ul><li>  openssl.cnf - OpenSSL configuration file; </li><li>  server.conf - server configuration file OpenVPN; </li><li>  ca.crt - certificate of certification center; </li><li>  vpn-server.crt - certificate of the OpenVPN server; </li><li>  server.key - private key of the OpenVPN server, <b>secret</b> ; </li><li>  crl.pem - certificate revocation list; </li><li>  dh.pem - Diffie-Hellman file to protect the traffic from decryption; </li><li>  ta.key - HMAC key for extra protection against DoS attacks and flood </li></ul><br><br><h3>  Add openvpn user </h3><br><p>  Add an unprivileged user and the openvpn group, on behalf of which the OpenVPN server daemon will run: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># adduser --system --no-create-home --home /nonexistent --disabled-login --group openvpn</span></span></code> </pre><br><br><h3>  Run OpenVPN daemon </h3><br><p>  Start the OpenVPN daemon with the following command: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /etc/init.d/openvpn start</span></span></code> </pre><br><br><h3>  Checking the startup result of the OpenVPN daemon </h3><br><p>  If the OpenVPN server started without errors, verify with the help of the ifconfig command that the TUN interface appeared: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ifconfig ... tun0 Link encap:UNSPEC HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00 inet addr:10.15.0.1 PtP:10.15.0.1 Mask:255.255.255.0 UP POINTOPOINT RUNNING NOARP MULTICAST MTU:1500 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:100 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B)</span></span></code> </pre><br><p>  As we have said, using TUN / TAP on leased VDS may require additional charges. </p><br><br><p>  If everything is good, then the IP interface has the IP address 10.15.0.1.  This is the address of the OpenVPN server in our secure tunnel specified in the server.conf configuration file. </p><br><br><p>  After checking for the presence of the TUN interface, make sure that OpenVPN has taken port 1194: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># netstat -ltupn | grep 1194</span></span></code> </pre><br><p>  If the daemon started normally and port 1194 is occupied by the OpenVPN server, you can proceed to the installation of the OpenVPN client described in the next section of the article.  If errors occur, review the /var/log/openvpn/openvpn-server.log log. </p><br><br><p>  When installing OpenVPN on Linux with new kernels, starting from 2.6, the TUN interface may not appear.  An error appears in the logs: </p><br><br><pre> <code class="bash hljs">Loading kernel module <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a network device with CAP_SYS_MODULE (deprecated). Use CAP_NET_ADMIN and <span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> netdev-tun instead</code> </pre><br><p>  To get rid of the problem, add the following line to the /etc/modprobe.d/dist.conf file: </p><br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> netdev-tun tun</code> </pre><br><p>  If there is no such file, it should be created.  After making changes to the /etc/modprobe.d/dist.conf file, restart the OS. </p><br><br><p>       verb   server.conf.  verb     0  11,   11   ,      1.    verb  0,          ,  . </p><br><br><p>      ,  5  . </p><br><br><a name="ancOpenVPNClient"></a><h2>      OpenVPN </h2><br><p>    OpenVPN     OpenVPN.     .        . </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># apt-get install openvpn</span></span></code> </pre><br><br><h3>    </h3><br><p>  ,        /etc/openvpn. </p><br><p>     openssl.cnf  server.conf. </p><br><br><p>  openssl.cnf,   OpenSSL,    ,     OpenVPN.    server.conf   OpenVPN,        . </p><br><br><div class="spoiler"> <b class="spoiler_title">  server.conf   OpenVPN</b> <div class="spoiler_text"><pre> <code class="bash hljs">dev tun proto udp remote 192.168.0.54 1194 client resolv-retry infinite ca <span class="hljs-string"><span class="hljs-string">"/etc/openvpn/ca.crt"</span></span> cert <span class="hljs-string"><span class="hljs-string">"/etc/openvpn/developer1.crt"</span></span> key <span class="hljs-string"><span class="hljs-string">"/etc/openvpn/client.key"</span></span> tls-auth <span class="hljs-string"><span class="hljs-string">"/etc/openvpn/ta.key"</span></span> 1 remote-cert-tls server persist-key persist-tun comp-lzo verb 3 status /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/openvpn/openvpn-status.log 1 status-version 3 <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>-append /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/openvpn/openvpn-client.log</code> </pre><br></div></div><br><p>     remote,     IP  OpenVPN: </p><br><br><pre> <code class="bash hljs">remote 192.168.0.54 1194</code> </pre><br><p>       IP   OpenVPN,   OpenVPN    . </p><br><br><p>      OpenVPN: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mkdir /var/log/openvpn/</span></span></code> </pre><br><br><h3>     PKI </h3><br><p>     OpenVPN (      )     developer1    Easy-RSA   <a href="https://github.com/OpenVPN/easy-rsa">github.com/OpenVPN/easy-rsa</a> . </p><br><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /home/developer1 $ wget https://github.com/OpenVPN/easy-rsa/archive/master.zip $ unzip master.zip</code> </pre><br><p>      PKI: </p><br><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /home/developer1/easy-rsa-master/easyrsa3 $ ./easyrsa init-pki</code> </pre><br><p>      PKI: </p><br><br><pre> <code class="bash hljs">/home/developer1/easy-rsa-master/easyrsa3/pki</code> </pre><br><br><h3>       OpenVPN </h3><br><p>           developer1: </p><br><br><pre> <code class="bash hljs">$ ./easyrsa gen-req client nopass</code> </pre><br><p>     Common Name          : </p><br><br><pre> <code class="bash hljs">Generating a 2048 bit RSA private key ..............................................................................................+sftp++ ................................+++ writing new private key to <span class="hljs-string"><span class="hljs-string">'/home/developer1/easy-rsa-master/easyrsa3/pki/private/client.key'</span></span> ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter <span class="hljs-string"><span class="hljs-string">'.'</span></span>, the field will be left blank. ----- Common Name (eg: your user, host, or server name) [client]:developer1 Keypair and certificate request completed. Your files are: req: /home/developer1/easy-rsa-master/easyrsa3/pki/reqs/client.req key: /home/developer1/easy-rsa-master/easyrsa3/pki/private/client.key</code> </pre><br><p>       ,     ,    nopass: </p><br><br><pre> <code class="bash hljs">$ ./easyrsa gen-req client</code> </pre><br><p>   , ,              OpenVPN. </p><br><br><p>        /home/developer1/easy-rsa-master/easyrsa3/pki/reqs/client.req     CA     /home/ca/client.req. </p><br><br><p>     USB -,   CA    . </p><br><br><p><img src="https://habrastorage.org/files/b50/fbd/009/b50fbd0092f845d8873d6f50ee4034b8.jpg"></p><br><br><p>    USB : </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mkdir /mnt/flash # mount -t vfat /dev/sdb1 /mnt/flash # cp /home/developer1/easy-rsa-master/easyrsa3/pki/reqs/client.req /mnt/flash # umount /mnt/flash</span></span></code> </pre><br><p>    PKI,      developer1: </p><br><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /home/ca/easy-rsa-master/easyrsa3 $ ./easyrsa import-req /mnt/flash/client.req developer1</code> </pre><br><p>      : </p><br><br><pre> <code class="bash hljs">$ ./easyrsa sign-req client developer1</code> </pre><br><p>        CA   : </p><br><br><pre> <code class="bash hljs">/home/ca/easy-rsa-master/easyrsa3/pki/issued/developer1.crt</code> </pre><br><p>   developer1.crt  USB -,       OpenVPN. </p><br><br><p><img src="https://habrastorage.org/files/a65/99e/79e/a6599e79e8e14fb798e978a754c2cafa.jpg"></p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cp /home/ca/easy-rsa-master/easyrsa3/pki/issued/developer1.crt /mnt/flash # umount /mnt/flash</span></span></code> </pre><br><p>      /etc/openvpn: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mount -t vfat /dev/sdb1 /mnt/flash # cp /mnt/flash/developer1.crt /etc/openvpn</span></span></code> </pre><br><br><p> ,          client.key    developer1.crt,    CA. </p><br><br><p>      /etc/openvpn: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cp /home/developer1/easy-rsa-master/easyrsa3/pki/private/client.key /etc/openvpn</span></span></code> </pre><br><p>    /etc/openvpn  VPN  ,   USB : </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cp /mnt/flash/ca.crt /etc/openvpn # cp /mnt/flash/ta.key /etc/openvpn</span></span></code> </pre><br><p> ,   ca.crt  crl.pem       CA,   ta.key ‚Äî    OpenVPN. </p><br><br><h3>   OpenVPN </h3><br><p>    : </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /etc/init.d/openvpn start</span></span></code> </pre><br><p>      ,    /var/log/openvpn/openvpn-client.log </p><br><br><p>   ,      ,    TUN,  ,         OpenVPN. </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ifconfig ... tun0 Link encap:UNSPEC HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00 inet addr:10.15.0.2 PtP:10.15.0.2 Mask:255.255.255.0 UP POINTOPOINT RUNNING NOARP MULTICAST MTU:1500 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:100 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B)</span></span></code> </pre><br><p>  ,   OpenVPN    ping   10.15.0.1: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ping 10.15.0.1</span></span></code> </pre><br><br><a name="ancSquid"></a><h2>  - Squid </h2><br><p> ,     VPN,  ,  ,    VDS  OpenVPN    .            -,    OpenVPN.          IP     ,        IP  OpenVPN. </p><br><br><p>   -        Squid,   ,  ,   Web-   . , ,      . </p><br><br><p>  Squid     : </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># apt-get install squid3</span></span></code> </pre><br><p>      /etc/squid3     squid.conf  ,   . ,         . </p><br><br><p>  ,    squid.conf  : </p><br><br><pre> <code class="bash hljs">http_access deny all</code> </pre><br><p>    : </p><br><br><pre> <code class="bash hljs">acl allowed_hosts src 10.15.0.0/24 http_access allow allowed_hosts http_access deny manager</code> </pre><br><p>        Squid    OpenVPN. </p><br><br><p>      -   SSL,    : </p><br><br><pre> <code class="bash hljs">acl SSL_ports port 443</code> </pre><br><p> ,      7195: </p><br><br><pre> <code class="bash hljs">acl SSL_ports port 443 7195</code> </pre><br><p> ,    squid.conf     10.0.0.0/8.      : </p><br><br><pre> <code class="bash hljs">acl localnet src 10.0.0.0/8 <span class="hljs-comment"><span class="hljs-comment"># RFC1918 possible internal network</span></span></code> </pre><br><p>       Squid: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /etc/init.d/squid3 restart</span></span></code> </pre><br><p>  Squid   ,  -   .     /var/log/squid3.   access.log  cache.log. </p><br><br><p>     Squid     10.15.0.1,  3128.    ,         OpenVPN.    , ,   2ip.ru, myip.ru  ,  IP- . </p><br><br><a name="ancFreeBSD"></a><h2>    FreeBSD </h2><br><p>      FreeBSD: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># portsnap fetch # portsnap extract</span></span></code> </pre><br><p>          OpenVPN.    : </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ntpdate 1.pool.ntp.org</span></span></code> </pre><br><p>        cron.       ntpd. </p><br><br><h3>   Easy-RSA </h3><br><br><p>      fetch: </p><br><br><pre> <code class="bash hljs">$ fetch --no-verify-peer https://github.com/OpenVPN/easy-rsa/archive/master.zip</code> </pre><br><p>  --no-verify-peer    ,      digicert.com  FreeBSD  10.0. FreeBSD  9.2    ,     . </p><br><br><p>       Easy-RSA   FreeBSD         Debian Linux. </p><br><br><h3>     OpenVPN </h3><br><p>   OpenVPN      OpenVPN    : </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># d /usr/ports/security/openvpn # make install clean</span></span></code> </pre><br><br><h3>   OpenVPN </h3><br><br><p>    OpenVPN      FreeBSD     /usr/local/etc/openvpn. </p><br><p>   : </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mkdir /usr/local/etc/openvpn</span></span></code> </pre><br><p>   openssl.cnf  server.conf     /usr/local/etc/openvpn. </p><br><br><div class="spoiler"> <b class="spoiler_title"> openssl.cnf</b> <div class="spoiler_text"><pre> <code class="bash hljs">[ ca ] default_ca = CA_default [ CA_default ] dir = /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/etc/openvpn crl_dir = <span class="hljs-variable"><span class="hljs-variable">$dir2</span></span> database = <span class="hljs-variable"><span class="hljs-variable">$dir</span></span>/index.txt new_certs_dir = <span class="hljs-variable"><span class="hljs-variable">$dir</span></span> certificate = <span class="hljs-variable"><span class="hljs-variable">$dir</span></span>/ca.crt serial = <span class="hljs-variable"><span class="hljs-variable">$dir</span></span> crl = <span class="hljs-variable"><span class="hljs-variable">$dir</span></span>/crl.pem private_key = <span class="hljs-variable"><span class="hljs-variable">$dir</span></span>/server.key RANDFILE = <span class="hljs-variable"><span class="hljs-variable">$dir</span></span>/.rand default_days = 3650 default_crl_days = 365 default_md = md5 unique_subject = yes policy = policy_any x509_extensions = user_extensions [ policy_any ] organizationName = match organizationalUnitName = optional commonName = supplied [ req ] default_bits = 2048 default_keyfile = privkey.pem distinguished_name = req_distinguished_name x509_extensions = CA_extensions [ req_distinguished_name ] organizationName = Organization Name (must match CA) organizationName_default = Company organizationalUnitName = Location Name commonName = Common User or Org Name commonName_max = 64 [ user_extensions ] basicConstraints = CA:FALSE [ CA_extensions ] basicConstraints = CA:TRUE default_days = 3650 [ server ] basicConstraints = CA:FALSE nsCertType = server</code> </pre><br></div></div><br><br><div class="spoiler"> <b class="spoiler_title">  server.conf   OpenVPN</b> <div class="spoiler_text"><pre> <code class="bash hljs">port 1194 proto udp dev tun user openvpn group openvpn <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/etc/openvpn persist-key persist-tun tls-server tls-timeout 120 dh /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/etc/openvpn/dh.pem ca /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/etc/openvpn/ca.crt cert /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/etc/openvpn/server.crt key /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/etc/openvpn/server.key crl-verify /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/etc/openvpn/crl.pem tls-auth /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/etc/openvpn/ta.key 0 server 10.15.0.0 255.255.255.0 client-config-dir /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/etc/openvpn/ccd client-to-client topology subnet max-clients 5 push <span class="hljs-string"><span class="hljs-string">"dhcp-option DNS 10.15.0.1"</span></span> route 10.15.0.0 255.255.255.0 comp-lzo keepalive 10 120 status /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/openvpn/openvpn-status.log 1 status-version 3 <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>-append /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/openvpn/openvpn-server.log verb 3 mute 20</code> </pre><br></div></div><br><br><div class="spoiler"> <b class="spoiler_title">  server.conf   OpenVPN</b> <div class="spoiler_text"><pre> <code class="bash hljs">dev tun proto udp remote 192.168.0.54 1194 client resolv-retry infinite ca <span class="hljs-string"><span class="hljs-string">"/usr/local/etc/openvpn/ca.crt"</span></span> cert <span class="hljs-string"><span class="hljs-string">"/usr/local/etc/openvpn/developer1.crt"</span></span> key <span class="hljs-string"><span class="hljs-string">"/usr/local/etc/openvpn/client.key"</span></span> tls-auth <span class="hljs-string"><span class="hljs-string">"/usr/local/etc/openvpn/ta.key"</span></span> 1 <span class="hljs-comment"><span class="hljs-comment">#ns-cert-type server remote-cert-tls server #ifconfig 10.15.0.0 255.255.255.0 persist-key persist-tun comp-lzo verb 3 status /var/log/openvpn/openvpn-status.log 1 status-version 3 log-append /var/log/openvpn/openvpn-client.log</span></span></code> </pre><br></div></div><br><p>     : </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mkdir /usr/local/etc/openvpn/ccd</span></span></code> </pre><br><br><h3>    PKI </h3><br><p>    OpenVPN  Easy-RSA       PKI: </p><br><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /home/vpnoperator $ fetch https://github.com/OpenVPN/easy-rsa/archive/master.zip $ unzip master.zip $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /home/vpnoperator/easy-rsa-master/easyrsa3 $ ./easyrsa init-pki</code> </pre><br><p>              USB -.        : </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ls /dev/da* # mount_msdosfs /dev/da1s1 /mnt # umount /mnt</span></span></code> </pre><br><p>  ,   USB -   /dev/da1s1. </p><br><br><h3>   openvpn </h3><br><p>    adduser   openvpn.   Shell     nologin. </p><br><br><h3>   OpenVPN </h3><br><p>       OpenVPN: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mkdir /var/log/openvpn</span></span></code> </pre><br><p>    /etc/rc.conf : </p><br><br><pre> <code class="bash hljs">openvpn_enable=<span class="hljs-string"><span class="hljs-string">"YES"</span></span> openvpn_configfile=<span class="hljs-string"><span class="hljs-string">"/usr/local/etc/openvpn/server.conf"</span></span></code> </pre><br><p>         OpenVPN. </p><br><br><p>   OpenVPN: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /usr/local/etc/rc.d/openvpn start</span></span></code> </pre><br><p>        OpenVPN    TUN.       ifconfig: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ifconfig ... tun0: flags=8051&lt;UP,POINTOPOINT,RUNNING,MULTICAST&gt; metric 0 mtu 1500 options=80000&lt;LINKSTATE&gt; inet6 fe80::20c:29ff:fe28:d4be%tun0 prefixlen 64 scopeid 0x3 inet 10.15.0.1 --&gt; 10.15.0.1 netmask 0xffffff00 nd6 options=21&lt;PERFORMNUD,AUTO_LINKLOCAL&gt; Opened by PID 493</span></span></code> </pre><br><p> ,    OpenVPN   1194: </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># sockstat | grep 1194</span></span></code> </pre><br><p>     ,  .          OpenVPN. </p><br><br><h3>  SQUID </h3><br><p>    FreeBSD    Squid  : </p><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cd /usr/ports/www/squid33 # make install clean</span></span></code> </pre><br><p>   Squid    /usr/local/etc/squid/   squid.conf.       ,       Debian Linux. </p><br><br><p>      /etc/rc.conf : </p><br><br><pre> <code class="bash hljs">squid_enable=<span class="hljs-string"><span class="hljs-string">"YES"</span></span></code> </pre><br><p>   Squid,   : </p><br><br><pre> <code class="bash hljs">/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/etc/rc.d/squid start</code> </pre><br><br><a name="ancWindows"></a><h2>    OpenVPN  Microsoft Windows </h2><br><p>   ,        Microsoft Windows,      OpenVPN    OpenVPN-GUI.  OpenVPN-GUI   <a href="http://openvpn.net/index.php/open-source/downloads.html"></a> . </p><br><br><h3>  OpenVPN-GUI </h3><br><br><p>    Windows Installer (64-bit)  Windows Installer (32-bit)        Microsoft Windows.         .  ,        C:\Program Files\OpenVPN\config. </p><br><br><p>   C:\Program Files\OpenVPN\easy-rsa    Easy-RSA  Windows. </p><br><br><p>     Easy-RSA  Windows     C:\Program Files\OpenVPN\easy-rsa\README.txt </p><br><br><p>   ,         Microsoft Windows,     USB -     CA.         ,  ,  USB -,    Microsoft Windows. </p><br><br><h3>     </h3><br><p>       . </p><br><br><p>  ,     .      Microsoft Windows   <a href="https://code.google.com/p/conemu-maximus5/">   ConEmu-Maximus5</a> . </p><br><br><p>  ,    Easy-RSA   : </p><br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> C:\Program Files\OpenVPN\easy-rsa init-config.bat clean-all</code> </pre><br><p>      C:\Program Files\OpenVPN\easy-rsa\keys   vars.bat. </p><br><br><p>    vars.bat   ,  ,     KEY_COUNTRY   KEY_PROVINCE,   KEY_CITY,  KEY_ORG,    KEY_EMAIL    KEY_OU: </p><br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> KEY_COUNTRY=RU <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> KEY_PROVINCE=RU <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> KEY_CITY=Moscow <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> KEY_ORG=IT-Company <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> KEY_EMAIL=develop@itcompany.ru <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> KEY_CN=changeme <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> KEY_NAME=changeme <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> KEY_OU=IT</code> </pre><br><p>        : </p><br><br><pre> <code class="bash hljs">vars build-ca build-key client</code> </pre><br><p>   ,  ,          OpenVPN  Debian Linux  FreeBSD. </p><br><br><p>     C:\Program Files\OpenVPN\easy-rsa\keys      client.csr,  client.crt      client.key. </p><br><br><p>        ‚Äî   client.csr    client.key.  client.crt     Microsoft Windows,   build-ca,         OpenVPN.   ,     CA. </p><br><br><h3>      CA </h3><br><p>     client.csr  USB -       ,  ,       OpenVPN   Debian Linux.     USB -,      Microsoft Windows. </p><br><br><h3>     OpenVPN </h3><br><p>     OpenVPN   C:\Program Files\OpenVPN\config.       ovpn.    : </p><br><br><pre> <code class="bash hljs">client dev tun proto udp remote 192.168.0.54 1194 tls-client ca <span class="hljs-string"><span class="hljs-string">"key/ca.crt"</span></span> cert <span class="hljs-string"><span class="hljs-string">"key/developer-w1.crt"</span></span> key <span class="hljs-string"><span class="hljs-string">"key/client.key"</span></span> tls-auth <span class="hljs-string"><span class="hljs-string">"key/ta.key"</span></span> 1 comp-lzo tun-mtu 1500 mssfix 1450 verb 3</code> </pre><br><p>  ,      C:\Program Files\OpenVPN\config\key  : </p><br><ul><li> ca.crt ‚Äî    CA; </li><li> developer-w1.crt ‚Äî   Microsoft Windows,    CA; </li><li> client.key ‚Äî    Microsoft Windows; </li><li> ta.key ‚Äî  HMAC     DoS-  ,    OpenVPN </li></ul><br><br><h3>  OpenVPN-GUI </h3><br><p>  OpenVPN-GUI    Windows     (    OpenVPN-GUI   ).     (  ¬´¬ª,    System Tray)   OpenVPN-GUI      . </p><br><br><p>           ,      C:\Program Files\OpenVPN\config.    ,     ,     . </p><br><br><p>          .  ,   VPN .         ,     OpenVPN.            . </p><br><br><p>    OpenVPN,   OpenVPN-GUI         <b></b> . </p><br><br><a name="ancLinks"></a><h4>  useful links </h4><br><p> <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25BE%25D1%2582%25D0%25BE%25D0%25BA%25D0%25BE%25D0%25BB_%25D0%2594%25D0%25B8%25D1%2584%25D1%2584%25D0%25B8_%25E2%2580%2594_%25D0%25A5%25D0%25B5%25D0%25BB%25D0%25BB%25D0%25BC%25D0%25B0%25D0%25BD%25D0%25B0">  ‚Äî </a> </p><br><p> <a href="http://ru.wikipedia.org/wiki/HMAC">HMAC</a> </p><br><p>  <a href="http://ru.wikipedia.org/wiki/%25D8%25E8%25F4%25F0%25EE%25E2%25E0%25ED%25E8%25E5">Encryption</a> </p><br><p> <a href="http://ru.wikipedia.org/wiki/X.509">X.509</a> </p><br><p> <a href="http://habrahabr.ru/post/197744/">OpenVPN:    Windows</a> </p><br><p> <a href="http://ru.wikipedia.org/wiki/%25D0%25A6%25D0%25B5%25D0%25BD%25D1%2582%25D1%2580_%25D1%2581%25D0%25B5%25D1%2580%25D1%2582%25D0%25B8%25D1%2584%25D0%25B8%25D0%25BA%25D0%25B0%25D1%2586%25D0%25B8%25D0%25B8">    </a> (Certification authority, CA) </p></div><p>Source: <a href="https://habr.com/ru/post/233971/">https://habr.com/ru/post/233971/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../233957/index.html">An authorization module for a site using the Wargaming.net Public API</a></li>
<li><a href="../233961/index.html">Copying partitions on a hard disk using GNU / Linux: how to manage a bootable USB flash drive where Acronis was previously needed</a></li>
<li><a href="../233963/index.html">Experience replacing Microsoft Outlook with Mozilla Thunderbird with Exchange Server</a></li>
<li><a href="../233967/index.html">LEO fitness system will become a personal trainer for those who do not have it</a></li>
<li><a href="../233969/index.html">Market analysts and project managers</a></li>
<li><a href="../233973/index.html">Use liquibase plugin for maven</a></li>
<li><a href="../233975/index.html">How not to get lost on the comet Churyumov-Gerasimenko</a></li>
<li><a href="../233977/index.html">On the question of the legality of parallel imports in Russia</a></li>
<li><a href="../233979/index.html">Master's degree in Norway</a></li>
<li><a href="../233981/index.html">New Cisco Security Courses</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>