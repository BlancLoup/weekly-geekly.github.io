<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Show version and haiku, but not only: we are looking for all the hidden Junos commands</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 This article is about the hidden commands of the Junos operating system. Those who worked with Juniper equipment running the Junos OS (this ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Show version and haiku, but not only: we are looking for all the hidden Junos commands</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br><br>  This article is about the hidden commands of the Junos operating system.  Those who worked with Juniper equipment running the Junos OS (this includes the MX, SRX, EX, QFX, T, J, and many others) probably know that there are undocumented commands in the system besides the ‚Äúofficial‚Äù (documented) commands.  Their peculiarity is that they are not visible in the command line interface by contextual help (this is when you enter a question mark) and autofilling does not work for them, that is, the command needs to be known and entered completely (all letters).  Apparently, the most famous <s>(and the most useless)</s> of such teams is show version and haiku, which gives out the Japanese triads about the life of network engineers. <br><br>  Hidden commands, in fact, a lot.  Nowhere does the vendor list their full list, but, for example, there is a sticky <a href="http://forums.juniper.net/t5/SRX-Services-Gateway/Junos-Hidden-Commands/td-p/151772">topic</a> on the official Juniper forum with a rather large set.  So the manufacturer does not object to the use of such commands by us, there is simply no guarantee given to them - it can work, and it can also put your equipment. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this article, I will talk about how you can get a list of all the hidden commands of the operating mode Junos, within some initial branch.  The method is based on a fairly simple observation, but by Google I was unable to find evidence that the question was previously put in this form.  An example Python script is attached. <br><br><a name="habracut"></a><br><br><h4>  Idea </h4><br>  The basic idea of ‚Äã‚Äãthe approach is very simple, but in order to understand it, it is still good to have access to the CLI of a Junos device. <br><br>  Consider, for example, the show version command.  If we enter "show version a" (at the end - always press Enter), then the output of the command is: <br><pre><code class="tex hljs">lab@jsrxA-1&gt; show version a ^ syntax error.</code> </pre> <br>  And if "show version with", then <br><pre> <code class="tex hljs">lab@jsrxA-1&gt; show version c ^ syntax error, expecting &lt;command&gt;.</code> </pre><br>  In the first case, there is a hidden continuation (and haiku), in the second - no.  As you can see, the CLI reaction in the presence of hidden continuation differs in two aspects: <br><ul><li>  "Syntax error." Instead of "syntax error, expecting‚Äπ command ‚Ä∫."; </li><li>  the cap (aka circumflex) stands under the next position of the line. </li></ul><br>  Accordingly, turning over the letters one by one (albeit manually, but better automated), we can find hidden commands - Junos himself suggests them, although not as clearly as with ordinary commands! <br><br><h4>  Preliminary notes </h4><br>  Before writing the script, I must warn readers that the hidden commands were hidden by the developer for a reason.  Some of them can disrupt the device, damage the file system, etc.  Therefore, even one at a time, they should be used with great care.  In our case, when a brute force search is being done, this warning is raised to such a degree that in no case should such a script be run on the equipment processing user traffic.  After all, we go through all the commands, among which may include file delete, request system zeroize, restart routing, and much more.  So, play only with non-connected pieces of hardware that are not pathetic to kill, but better with virtual SRX (aka Firefly Perimeter). <br><br>  It should also be clarified that although Junos has a very convenient and advanced XML-based API, its use for this task is not possible, since our approach to finding commands is based on the features of the CLI.  Therefore, we will open the usual telnet session, give commands and parse the text output. <br><br>  In this article, I will limit myself to finding the commands of the operational mode.  There is also a configuration, and in it, too, a lot of interesting things are hidden (the same commit full).  Search for hidden commands there can be carried out similarly. <br><br><h4>  Algorithm </h4><br>  So, starting with a certain command (commandStart in the script), we will bypass all possible options for the commands, adding each time a character (from the alphabet array) and typing Enter.  The output sent by Junos in response may be as follows: <br><ol><li>  Swearing about "syntax error." (And at the same time the hat indicates the presence of the continuation of the command) - a sign of the presence of a hidden-command, we go further, adding new characters. </li><li>  Swearing about "syntax error, expecting‚Äπ command ‚Ä∫." - <br>  here it is necessary to analyze the position of the cap.  If it is on the current letter, as above in the ‚Äúshow version c‚Äù example, then we don‚Äôt go further, there are no hidden commands. <br>  If she points to the continuation of the command, like this: <br><pre> <code class="tex hljs">lab@jsrxA-1&gt; show version and ^ syntax error, expecting &lt;command&gt;.</code> </pre><br>  then in this case the team has a continuation and it is necessary to sort out further (the command here may be hidden or not, depending on the background). <br></li><li>  Just the output of the command, without swearing about syntax errors, but possibly with a scolding about ambiguous input, for example, like this: <br><pre> <code class="tex hljs">lab@jlab-Firefly-3&gt; show chassis cluster i ^ 'i' is ambiguous. Possible completions: interfaces Display chassis cluster interfaces ip-monitoring Display IP monitoring related information</code> </pre><br>  In this case, the search should be continued, because  there may be a hidden command (in this case, show chassis cluster information). <br></li></ol><br>  It is also necessary to take into account that the conclusions of some commands may take several screens, which leads to the issuance of the invitation "--- (more) ---".  In this case, just helmet space. <br><br><h4>  Script </h4><br>  Actually, here it is (or on <a href="https://github.com/pklimai/junos_hidden_commands">github</a> ). <br><div class="spoiler">  <b class="spoiler_title">Script (Python 3)</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> telnetlib <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> re HOST = <span class="hljs-string"><span class="hljs-string">"192.168.65.161"</span></span> user = <span class="hljs-string"><span class="hljs-string">"lab"</span></span> password = <span class="hljs-string"><span class="hljs-string">"lab123"</span></span> commandStart = <span class="hljs-string"><span class="hljs-string">"show version "</span></span> <span class="hljs-comment"><span class="hljs-comment"># note space at the end alphabet = "abcdefghijklmnopqrstuvwxyz-1234567890." PAUSE = 3 def SearchCommands (cmd, on_hidden_now=False): for nChar in range(0, len(alphabet)): char = str(alphabet[nChar]) tn.write(cmd.encode('ascii') + char.encode('ascii') + b"\n") totData="" finished = False while (not finished): inpData = tn.read_until(prompt.encode('ascii'), PAUSE) totData = totData + inpData.decode('ascii') if "---(more" in inpData.decode('ascii'): tn.write(b" ") else: finished = True cmdNext = cmd + str(char) synt_error_exp_cmd = False synt_error_period = False if "syntax error, expecting &lt;command&gt;." in totData: synt_error_exp_cmd = True if "syntax error." in totData: synt_error_period = True if not (synt_error_exp_cmd or synt_error_period): # normal output or ambiguity if on_hidden_now: print("hidden command &gt;&gt; " + cmdNext) else: SearchCommands(cmdNext, on_hidden_now) # ie False else: l = re.findall(' *\^', totData) lenToHat = len(l[len(l)-1]) if synt_error_period: if lenToHat &gt; lenPrompt + len(cmdNext): SearchCommands(cmdNext, True) # Hidden command in progress if synt_error_exp_cmd: if (lenToHat == 2 + lenPrompt + len(cmdNext)): if on_hidden_now: print("hidden command &gt;&gt; " + cmdNext + " (incomplete)") # else: print("Entering: " + cmdNext) SearchCommands(cmdNext+" ", on_hidden_now) if lenToHat &gt; 2 + lenPrompt + len(cmdNext): SearchCommands(cmdNext, on_hidden_now) tn = telnetlib.Telnet(HOST) tn.read_until(b"login: ") tn.write(user.encode('ascii') + b"\n") tn.read_until(b"Password:") tn.write(password.encode('ascii') + b"\n") loginText = tn.read_until(b"&gt; ").decode('ascii') prompt = re.search(".*@.*", loginText).group() print("Working with prompt = " + prompt) lenPrompt = len(prompt) SearchCommands(commandStart)</span></span></code> </pre><br></div></div><br>  Examples of work: <br><div class="spoiler">  <b class="spoiler_title">Run for show version</b> <div class="spoiler_text">  hidden command &gt;&gt; show version and (incomplete) <br>  hidden command &gt;&gt; show version and blame <br>  hidden command &gt;&gt; show version and haiku <br>  hidden command &gt;&gt; show version extensive <br>  hidden command &gt;&gt; show version forwarding-context <br>  hidden command &gt;&gt; show version invoke-on (incomplete) <br>  hidden command &gt;&gt; show version invoke-on a <br>  hidden command &gt;&gt; show version invoke-on o <br>  hidden command &gt;&gt; show version no-forwarding <br>  hidden command &gt;&gt; show version scc-dont-forward <br>  hidden command &gt;&gt; show version sdk <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Run for show chassis</b> <div class="spoiler_text">  hidden command &gt;&gt; show chassis accurate-statistics <br>  hidden command &gt;&gt; show chassis beacon <br>  hidden command &gt;&gt; show chassis broadcom <br>  hidden command &gt;&gt; show chassis cfeb <br>  hidden command &gt;&gt; show chassis cip <br>  hidden command &gt;&gt; show chassis clocks <br>  hidden command &gt;&gt; show chassis cluster ethernet-switching (incomplete) <br>  hidden command &gt;&gt; show chassis cluster information <br>  hidden command &gt;&gt; show chassis cluster ip-monitoring (incomplete) <br>  hidden command &gt;&gt; show chassis craft-interface <br>  hidden command &gt;&gt; show chassis customer-id <br>  hidden command &gt;&gt; show chassis ethernet-switch <br>  hidden command &gt;&gt; show chassis fabric (incomplete) <br>  hidden command &gt;&gt; show chassis fchip <br>  hidden command &gt;&gt; show chassis feb <br>  hidden command &gt;&gt; show chassis fpc-feb-connectivity <br>  hidden command &gt;&gt; show chassis hsl (incomplete) <br>  hidden command &gt;&gt; show chassis hsr <br>  hidden command &gt;&gt; show chassis hss (incomplete) <br>  hidden command &gt;&gt; show chassis hst <br>  hidden command &gt;&gt; show chassis in-service-upgrade <br>  hidden command &gt;&gt; show chassis ioc-npc-connectivity <br>  hidden command &gt;&gt; show chassis lccs <br>  hidden command &gt;&gt; show chassis message-statistics (incomplete) <br>  hidden command &gt;&gt; show chassis message-statistics i <br>  hidden command &gt;&gt; show chassis network-services <br>  hidden command &gt;&gt; show chassis nonstop-upgrade <br>  hidden command &gt;&gt; show chassis power-budget-statistics <br>  hidden command &gt;&gt; show chassis psd <br>  hidden command &gt;&gt; show chassis redundancy (incomplete) <br>  hidden command &gt;&gt; show chassis redundant-power-system <br>  hidden command &gt;&gt; show chassis scb <br>  hidden command &gt;&gt; show chassis sfm <br>  hidden command &gt;&gt; show chassis sibs <br>  hidden command &gt;&gt; show chassis spmb <br>  hidden command &gt;&gt; show chassis ssb <br>  hidden command &gt;&gt; show chassis synchronization <br>  hidden command &gt;&gt; show chassis tfeb <br>  hidden command &gt;&gt; show chassis timers <br>  hidden command &gt;&gt; show chassis usb (incomplete) <br>  hidden command &gt;&gt; show chassis zones <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Run for show security idp branch (on SRX240)</b> <div class="spoiler_text">  hidden command &gt;&gt; show security idp active-policy <br>  hidden command &gt;&gt; show security idp application-ddos (incomplete) <br>  hidden command &gt;&gt; show security idp application-identification (incomplete) <br>  hidden command &gt;&gt; show security idp detector (incomplete) <br>  hidden command &gt;&gt; show security idp detector a <br>  hidden command &gt;&gt; show security idp detector c <br>  hidden command &gt;&gt; show security idp detector p <br>  hidden command &gt;&gt; show security idp ips-cache <br>  hidden command &gt;&gt; show security idp logical-system (incomplete) <br></div></div><br>  As you can see, the script marks some commands as incomplete - those that are supposed to continue.  If the continuation of the Junos command is no longer hidden, such a command is then also found in the script, but is issued in abbreviated form (show chassis message-statistics i - this is show chassis message-statistics ipc). <br><br>  The goal of processing the script with all possible errors and situations was not set, so if you have interface lines containing a synax error line to which the script responds, or if the logging is enabled in the terminal, the operation logic may be violated. <br><br>  Another problem is commands that accept any name as input, for example, show interfaces AnyInterfaceNameIsOKHere (if there is no such interface, an error is generated, other similar commands may not issue anything).  For obvious reasons, the script, when set to show interfaces, crashes with an error of maximum recursion depth exceeded.  But the search with commandStart = "show interfaces ge-0/0/0" works fine: <br><div class="spoiler">  <b class="spoiler_title">Run for show interfaces ge-0/0/0</b> <div class="spoiler_text">  hidden command &gt;&gt; show interfaces ge-0/0/0 forwarding-context <br>  hidden command &gt;&gt; show interfaces ge-0/0/0 ifd-index <br>  hidden command &gt;&gt; show interfaces ge-0/0/0 ifl-index <br>  hidden command &gt;&gt; show interfaces ge-0/0/0 instance <br>  hidden command &gt;&gt; show interfaces ge-0/0/0 no-forwarding <br>  hidden command &gt;&gt; show interfaces ge-0/0/0 scc-dont-forward <br></div></div><br><br><h4>  Conclusion </h4><br>  It should be understood that a significant part of the hidden-commands are hidden due to the fact that they are not supported (or have no meaning) on ‚Äã‚Äãthis equipment or in this version of software.  Many of them are useless, however, among them there are also ‚Äúnuggets‚Äù (for example, show chassis cluster information).  Since I work as a Juniper instructor, quite often I hear a question from students - where to get a list of all hidden teams.  So now I will refer everyone to this article.  I hope that some benefit from this recipe will be to someone. </div><p>Source: <a href="https://habr.com/ru/post/251245/">https://habr.com/ru/post/251245/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../251235/index.html">Anthology of Paul Graham</a></li>
<li><a href="../251237/index.html">Diffusion of innovations, part two</a></li>
<li><a href="../251239/index.html">Course program and materials on Scala</a></li>
<li><a href="../251241/index.html">Computer edition of publishing house Peter</a></li>
<li><a href="../251243/index.html">We protect private keys from theft from VPS</a></li>
<li><a href="../251247/index.html">The digest of interesting materials for the mobile developer # 91 (February 16-23)</a></li>
<li><a href="../251251/index.html">Today a free webinar will take place - Training of managers, managers and auditors for certification in the field of information security</a></li>
<li><a href="../251255/index.html">The digest of interesting materials from the world of Drupal # 5</a></li>
<li><a href="../251257/index.html">Disadvantages of Wordpress - the technical side</a></li>
<li><a href="../251259/index.html">Reading old articles Habra with pictures</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>