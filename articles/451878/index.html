<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Live streaming stereo video to VR glasses (Oculus Go)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We will not do a lengthy introductory part, let's get straight to the point. 

 So, there is a stereo camera that can transmit H264 video using differ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Live streaming stereo video to VR glasses (Oculus Go)</h1><div class="post__text post__text-html js-mediator-article">  We will not do a lengthy introductory part, let's get straight to the point. <br><br>  So, there is a stereo camera that can transmit H264 video using different protocols.  There are glasses Oculus Go.  How to watch stereo live stream from camera in VR glasses?  Preferably, with minimal delay and locally, so Youtube and other RTMP video services disappear. <br><br>  Looking ahead, that's what happened.  At the beginning - playback of a previously recorded video file from the stereo, then playback of the live stream from StereoPi (MPEG-TS via UDP). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/MLPNXmZI8-8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br><blockquote>  The stereo camera that I use is StereoPi, so I will give specific examples with reference to it.  In fact, this is a common raspberry, but with two cameras, so you can try the described examples on a regular raspberry, if you really want to.  True, you will need to install the firmware from StereoPi. </blockquote>  First of all, there was an attempt to make a regular Android application that plays the stream from the camera to full screen, and pour it into the oculus using the sideloading method (via adb). <br><br>  After some tinkering with the manifest, the glasses agreed to consider this application native.  It appeared in the ‚ÄúUnknown Sources‚Äù in the library, it started, showed everything it needed, but there was a problem ‚Äî the head movements were not taken into account, the video from the camera was just stupidly displayed on the full screen with glasses.  The stereo effect was, yes, but it was enough to move my head a little as Moscow started to go crazy, which caused very, very uncomfortable sensations. <br><br>  If that, here are the .apk applications: <a href="http://forum.stereopi.com/download/file.php%3Fid%3D7%26sid%3D029e39d979450d7718ff699881b0b919">StereoPi for Oculus Go</a> At the same time in the archive and adb lies, so you can immediately try to fill in the glasses.  Just commanding <br><br><pre><code class="bash hljs">adb install StereoPi.apk</code> </pre> <br>  After that we go to the Library -&gt; Unknown sources, the application com.virt2real.stereopi should appear there <br><br><img src="https://habrastorage.org/webt/q6/gi/zf/q6gizfqbbj_cftbnek3l8aqupno.png"><br><br>  We launch and, if StereoPi is in the same local network as the glasses, we immediately see the stereo image from the camera. <br><br>  But this is garbage ... I would like a normal native app for oculus for watching videos.  So that there was a fixed screen and so as not to storm when moving your head.  I am not yet ready to master Unity for oculi, so I had an idea to try to use the video player applications already in the Oculus store.  I usually watch 3D movies in the <a href="https://skybox.xyz/">Skybox</a> , so I tried to use it. <br><br>  In addition to the usual viewing of media files from a built-in flash drive and from network devices, an interesting item ‚ÄúAirscreen‚Äù was found in the Skybox.  It turned out that you can install the Skybox application on a computer with Windows (well, or on a Mac), feed video files to it, and then it becomes possible to watch these video files with glasses.  Those.  the Windows application is a video server, and the glasses are the client.  I did not find the communication protocol anywhere, so I had to uncover tcpdump. <br><br>  After a brief excavation, it turned out that Skybox uses UDP broadcast messages to find the server in LAN.  The message looks like this: <br><br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:<span class="hljs-string"><span class="hljs-string">"search"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"project"</span></span>:<span class="hljs-string"><span class="hljs-string">"direwolf"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceId"</span></span>:<span class="hljs-string"><span class="hljs-string">"66a86b57-b292-3957-9fc9-4041d5e1f841"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceType"</span></span>:<span class="hljs-string"><span class="hljs-string">"vr"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"udpPort"</span></span>:<span class="hljs-string"><span class="hljs-string">"6881"</span></span>}</code> </pre> <br><br>  All messages in JSON, very convenient. <br><br>  To this message we need to send a response to the sender‚Äôs host and the port specified in the message, i.e.  6881 <br><br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"udp"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-attr"><span class="hljs-attr">"project"</span></span>:<span class="hljs-string"><span class="hljs-string">"direwolf server"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:<span class="hljs-string"><span class="hljs-string">"searchResult"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceId"</span></span>:<span class="hljs-string"><span class="hljs-string">"66a86b57-b292-3957-9fc9-4041d5e1f841"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"computerId"</span></span>:<span class="hljs-string"><span class="hljs-string">"53709de962eba2f9695c8a926562486c"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"computerName"</span></span>:<span class="hljs-string"><span class="hljs-string">"STEREO-PI"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"ip"</span></span>:<span class="hljs-string"><span class="hljs-string">"192.168.1.51"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"ips"</span></span>:[<span class="hljs-string"><span class="hljs-string">"192.168.1.51"</span></span>],<span class="hljs-attr"><span class="hljs-attr">"port"</span></span>:<span class="hljs-number"><span class="hljs-number">6888</span></span>}</code> </pre><br>  Here we indicate our host and port on which we are running WebSockets server.  All further communication will go through the web sockets. <br><br>  For example, the very first message via web sockets will look something like this: <br><br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:<span class="hljs-string"><span class="hljs-string">"addDevice"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceId"</span></span>:<span class="hljs-string"><span class="hljs-string">"66a86b57-b292-3957-9fc9-4041d5e1f841"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceName"</span></span>:<span class="hljs-string"><span class="hljs-string">"Oculus Pacific"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceType"</span></span>:<span class="hljs-string"><span class="hljs-string">"vr"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"showLoginCode"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>}</code> </pre> <br>  We answer it: <br><br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:<span class="hljs-string"><span class="hljs-string">"addDevice"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceId"</span></span>:<span class="hljs-string"><span class="hljs-string">"66a86b57-b292-3957-9fc9-4041d5e1f841"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceName"</span></span>:<span class="hljs-string"><span class="hljs-string">"Oculus Pacific"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceType"</span></span>:<span class="hljs-string"><span class="hljs-string">"vr"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"showLoginCode"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>}</code> </pre> <br>  And after that in the Skybox with glasses we will see our StereoPi.  Next will be a bunch of requests for which you need to send answers.  Playlist content, for example. <br><br><div class="spoiler">  <b class="spoiler_title">Skybox Playlist Example</b> <div class="spoiler_text">  [{id: 'livestream-rtsp', <br>  name: 'Live Stream RTSP', <br>  duration: 0, <br>  size: 0, <br>  url: 'rtsp: //192.168.1.51: 554 / h264', <br>  thumbnail: 'http://192.168.1.51/thumbnail/livestream.png', <br>  thumbnailWidth: 186, <br>  thumbnailHeight: 120, <br>  lastModified: 1, <br>  defaultVRSetting: 1, <br>  userVRSetting: 2, <br>  width: 1280, <br>  height: 720, <br>  orientDegree: '0', <br>  subtitles: [], <br>  ratioTypeFor2DScreen: 'default', <br>  rotationFor2DScreen: 0, <br>  exists: true <br>  isBadMedia: false, <br>  addedTime: 1}, <br>  {id: 'livestream-mpegts', <br>  name: 'Live Stream MPEG-TS', <br>  duration: 0, <br>  size: 0, <br>  url: 'udp: // @: 3001', <br>  thumbnail: 'http://192.168.1.51/thumbnail/livestream.png', <br>  thumbnailWidth: 186, <br>  thumbnailHeight: 120, <br>  lastModified: 1, <br>  defaultVRSetting: 1, <br>  userVRSetting: 2, <br>  width: 1280, <br>  height: 720, <br>  orientDegree: '0', <br>  subtitles: [], <br>  ratioTypeFor2DScreen: 'default', <br>  rotationFor2DScreen: 0, <br>  exists: true <br>  isBadMedia: false, <br>  addedTime: 1}] <br></div></div><br>  This is especially interesting because  In the playlist that forms the Windows application, the cherished abbreviation RTSP was discovered.  It turned out that the server application streams video files via RTSP, which is already suitable for live streaming video, which we need.  More precisely, it turned out that ‚ÄúRTSP‚Äù is in the playlist, but the links to the video files are regular http.  Those.  the server application still gives the files via HTTP, and this does not suit us.  At this moment I was already upset, but I thought, why not try to give a link in the playlist in a format in which VLC usually understands, that is,  rtsp: //192.168.1.51: 554 / h264 And cheers, Skybox began to play the video stream from the RTSP server on the stereo.  The delay is very big, about 20 seconds, so we pick further.  We try to feed a UDP stream to MPEG-TS.  Again, VLC usually eats it via the link udp: // @: 3001, for Skybox I tried to specify in the same way.  Then it remains only to send the MPEG-TS stream to the points host and the specified UDP port.  For this, GStreamer is involved: <br><br><pre> <code class="bash hljs">raspivid -3d sbs -w 1280 -h 720 -o - | gst-launch-1.0 -q fdsrc ! h264parse ! mpegtsmux alignment=7 name=muxer ! rndbuffersize max=1316 min=1316 ! multiudpsink clients=<span class="hljs-string"><span class="hljs-string">"192.168.1.60:3001"</span></span> sync=<span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br>  In the skybox we click on the element of the ‚ÄúLive Stream MPEG-TS‚Äù playlist and voila, we see the live MPEG-TS stream on the big screen in a virtual cinema.  The delay is much less than with RTSP, 2-3 seconds, but still much more than in my simple application, which receives a raw H264 stream via UDP (there is usually a delay of 100-150 ms at 720p resolution). <br><br>  Then I came up against a dead end, while I still can‚Äôt reduce the delay.  Perhaps you need to disable buffering in the Skybox itself, I will try to write to the developers, they can make the ‚ÄúDisable buffering‚Äù option :-) <br><br><h3>  Finally </h3><br>  In general, if suddenly, for some reason, you suddenly needed to watch a live video stream in oculus or other VR glasses (Skybox is available on many platforms like) - you can try the method I described.  I do not know whether it will ride with other stereo cameras, but with StereoPi checked, plows. <br><br><h3>  Links </h3><br>  <a href="https://github.com/virt2real/skybox-server">Skybox server sources</a> <br>  <a href="http://forum.stereopi.com/viewtopic.php%3Ff%3D10%26t%3D20">Discussion forum thread</a> <br><br>  Thanks to everybody, you're free. <br><br>  Oh yeah, I almost forgot.  If suddenly someone can help with the native application under the oculus (so that approximately how the Skybox looked) - write in a personal, we will discuss the details. </div><p>Source: <a href="https://habr.com/ru/post/451878/">https://habr.com/ru/post/451878/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451866/index.html">Choose the closest nodes in the network</a></li>
<li><a href="../451870/index.html">Modern C ++ features that all programmers need to be aware of</a></li>
<li><a href="../451872/index.html">Python - an assistant in finding cheap air tickets for those who love to travel</a></li>
<li><a href="../451874/index.html">Top SEO Trends at Google</a></li>
<li><a href="../451876/index.html">Data Center in Frankfurt: Telehouse data center</a></li>
<li><a href="../45188/index.html">Oddities with Yandex</a></li>
<li><a href="../451880/index.html">DevPRO'19: View from Wrike's booth</a></li>
<li><a href="../451884/index.html">Seven years of working as a developer: what lessons have I learned</a></li>
<li><a href="../451886/index.html">Use of discrete mathematics in testing</a></li>
<li><a href="../451890/index.html">Delegating the reverse zone subnet less than / 24 in BIND. How it works</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>