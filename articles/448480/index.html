<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Docker user</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Andrei Kopylov , our technical director, loves, actively uses and promotes Docker. In the new article, he explains how to create users in Docker. Corr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Docker user</h1><div class="post__text post__text-html js-mediator-article"><p>  <a href="https://habr.com/ru/users/aak74/posts/">Andrei Kopylov</a> , our technical director, loves, actively uses and promotes Docker.  In the new article, he explains how to create users in Docker.  Correct work with them, why users cannot be left with root rights and how to solve the problem of mismatch of identifiers in the Dockerfile. </p><a name="habracut"></a><br><p>  All processes in the container will work as root, unless you specify it in a special way.  This seems very convenient, because this user has no restrictions.  That is why working under the root is wrong in terms of security.  If no one in their right mind works with root rights on the local computer, then many start processes under the root in containers. </p><br><p>  There are always bugs that will allow the malware to get out of the container and get to the host computer.  Assuming the worst, we must ensure that the processes inside the container are started from the user who does not have any rights on the host machine. </p><br><h2>  Create user </h2><br><p>  Creating a user in a container is no different from creating it in Linux distributions.  However, teams may differ for different basic images. </p><br><p>  For debian-based distributions in Dockerfile, you need to add: </p><br><br><pre><code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">RUN</span></span> groupadd --gid <span class="hljs-number"><span class="hljs-number">2000</span></span> node \ &amp;&amp; useradd --uid <span class="hljs-number"><span class="hljs-number">2000</span></span> --gid node --shell /bin/bash --create-home node</code> </pre> <br><p>  For alpine: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">RUN</span></span> addgroup -g <span class="hljs-number"><span class="hljs-number">2000</span></span> node \ &amp;&amp; adduser -u <span class="hljs-number"><span class="hljs-number">2000</span></span> -G node -s /bin/sh -D node</code> </pre><br><h2>  Run processes from user </h2><br><p>  To start all subsequent processes from a user with UID 2000, run: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">USER</span></span> <span class="hljs-number"><span class="hljs-number">2000</span></span></code> </pre> <br><p>  To run all subsequent processes from the node user, run: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">USER</span></span> node</code> </pre> <br><p>  Read more in the <a href="https://docs.docker.com/engine/reference/builder/">documentation</a> . </p><br><h2>  Mounting volumes </h2><br><p>  When mounting volumes inside a container, ensure that the user can read and / or write files.  For this, the UID (GID) of the user in the container and the user outside the container that has the appropriate rights to access the file must match.  At the same time, user names do not matter. </p><br><p>  Often on a Linux computer, the user has a UID and GID of 1000. These identifiers are assigned to the first user of the computer. </p><br><p>  Finding your IDs is simple: </p><br><pre> <code class="nginx hljs">id</code> </pre> <br><p>  You will receive comprehensive information about your user. <br>  Replace 2000 of the examples with your ID and everything will be fine. </p><br><h2>  Assign user UID and GID </h2><br><p>  If the user is created earlier, but you need to change the identifiers, you can do it like this: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">RUN</span></span> usermod -u <span class="hljs-number"><span class="hljs-number">1000</span></span> node \ &amp;&amp; groupmod -g <span class="hljs-number"><span class="hljs-number">1000</span></span> node</code> </pre><br><p>  If you are using the base alpine image, then you need to install the shadow package: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">RUN</span></span> apk add ‚Äî<span class="hljs-literal"><span class="hljs-literal">no</span></span>-cache shadow</code> </pre> <br><h2>  Passing the user ID inside the container when building the image </h2><br><p>  If your identifier and the identifiers of all people who work on the project are the same, then it is enough to indicate this identifier in the Dockerfile.  However, user IDs often do not match. </p><br><p>  How to implement the desired is not immediately clear.  For me it was the most difficult in the process of mastering docker.  Many docker users do not think that there are different stages in the life of the image.  At first the image is collected for this purpose using Dockerfile.  When starting the container from the Dockerfile image, it is no longer used. </p><br><p>  Creation of users should occur when building an image.  The same applies to the definition of the user from which the processes are started.  This means that we somehow have to pass a UID (GID) inside the container. </p><br><p>  To use external variables in Dockerfile, the directives <a href="https://docs.docker.com/engine/reference/builder/">ENV</a> and <a href="https://docs.docker.com/engine/reference/builder/">ARG are used</a> .  Detailed comparison of directives <a href="https://vsupalov.com/docker-arg-env-variable-guide/">here</a> . </p><br><p>  Dockerfile </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">ARG</span></span> UID=<span class="hljs-number"><span class="hljs-number">1000</span></span> ARG GID=<span class="hljs-number"><span class="hljs-number">1000</span></span> ENV UID=<span class="hljs-variable"><span class="hljs-variable">${UID}</span></span> ENV GID=<span class="hljs-variable"><span class="hljs-variable">${GID}</span></span> RUN usermod -u <span class="hljs-variable"><span class="hljs-variable">$UID</span></span> node \ &amp;&amp; groupmod -g <span class="hljs-variable"><span class="hljs-variable">$GID</span></span> node</code> </pre><br><p>  You can pass arguments through docker-compose like this: </p><br><p>  docker-compose </p><br><pre> <code class="nginx hljs">build: context: ./src/<span class="hljs-attribute"><span class="hljs-attribute">backend</span></span> args: UID: <span class="hljs-number"><span class="hljs-number">1000</span></span> GID: <span class="hljs-number"><span class="hljs-number">1000</span></span></code> </pre><br><p>  PS To master all the wisdom of docker, it‚Äôs not enough to read documentation or articles.  You need to practice a lot, you need to feel the docker. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/448480/">https://habr.com/ru/post/448480/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448470/index.html">Content marketing in the USA, Latin America and Asia: useful tips, links and tools for budget promotion</a></li>
<li><a href="../448472/index.html">How PROCESS_DUP_HANDLE turns into PROCESS_ALL_ACCESS</a></li>
<li><a href="../448474/index.html">We are looking for memory leaks in Python applications</a></li>
<li><a href="../448476/index.html">Expanding WDS Functionality: Adding Download Capability to UEFI</a></li>
<li><a href="../448478/index.html">Moon mission "Bereshit" - the preliminary cause of the accident was announced</a></li>
<li><a href="../448482/index.html">Factory testing of modular data center</a></li>
<li><a href="../448484/index.html">Aboriginal microbes</a></li>
<li><a href="../448486/index.html">‚ÄúIn November of 2018, we accidentally fell into spam on all fronts.‚Äù How I saved mailing with the company with a million base</a></li>
<li><a href="../448488/index.html">Fear and Loathing DevSecOps</a></li>
<li><a href="../448498/index.html">"Russia 404": How much is left to live free Internet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>