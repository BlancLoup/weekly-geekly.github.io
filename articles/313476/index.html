<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simplify Excel binary search - Double VLOOKUP Trick implementation using UDF</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I ‚Äôll add another one to Habr's articles on Binary Search . It will be a question of custom implementation, it can be useful to everyone who often use...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simplify Excel binary search - Double VLOOKUP Trick implementation using UDF</h1><div class="post__text post__text-html js-mediator-article">  I <a href="https://habrahabr.ru/post/146228/">‚Äôll add</a> another one to Habr's articles on <a href="https://habrahabr.ru/post/146228/">Binary Search</a> .  It will be a question of custom implementation, it can be useful to everyone who often uses in the work of CDF to compare large lists or to search for data in large arrays. <br><a name="habracut"></a><br><h3>  Prehistory </h3><br>  It all started with the fact that I discovered the so-called.  Double-TRUE VLOOKUP trick (double-use trick of VPR and TRUE in the 4th parameter).  A detailed description of the algorithm can be found in the article by Charles Williams "Why 2 VLOOKUPS are better than 1 VLOOKUP" (at the end of the article). <br><br>  Understanding the principle of operation and discovering that this approach can be <b>thousands of</b> times faster than normal linear search (CDF with the 4th parameter FALSE), I began to think over options to reveal its capabilities.  In the course of implementation, we got several suitable tools for contextual advertising, one of which I still continue to improve, and has already devoted a couple of articles to the project on Habr√©.  Pulp fiction is recommended to SEO specialists and specialists in contextual advertising (I‚Äôll just make a reservation, the links in the articles are already outdated versions, the latest version is conditionally 6.0, links to download all versions, including the latest, will be at the end of this article): <br><br>  " <a href="https://habrahabr.ru/company/realweb/blog/264591/">Analysis of large semantic nuclei, or" Robot Recognizer "</a> <br>  " <a href="https://habrahabr.ru/company/realweb/blog/265375/">Lemmatization in Excel, or" Robot Recognizer 3.0</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, despite the incredible speed of these files (incredible for Excel), their creation required the use of the same incredibly long mega-formulas as one of the components of the macro (the last of the above articles gives an example - a formula of 3215 characters).  And the culprit is the complex syntax of the function. <br><br>  If you get a hand with its use, it ceases to seem complicated, but inexperienced users, for whom this approach is intended, are unlikely to want to understand it. <br><br>  The syntax is: <br><blockquote>  If (CDF (required; array; 1; TRUE) &lt;required; ""; CDF (required; array; n; TRUE)) </blockquote><br>  where n is the ordinal number of the column from which we want to return the value opposite the desired key. <br><br>  Instead of ‚ÄúTRUE‚Äù in the 4th parameter, you can use ‚Äú1‚Äù for the nominal reduction of the length of the formulas, this does not change their essence. <br><br>  If you announce the progress of the formula, the following will be: <br><br>  ‚ÄúIf a binary search for a key in the first column of an array returns a value <b>smaller</b> than the key itself, we return an empty string.  Otherwise, we return the result of a binary search for a key with an offset n ". <br><br>  The approach is used to return <b>no</b> values ‚Äã‚Äãif the required key is not in the array, because  Often, if the desired is not found - we <b>do not need a</b> lower value.  So to say, all or nothing.  In short, this is the essence of the "trick". <br><br>  Let me remind you that at stake is a speed increase of three to four-digit numbers.  If we approach purely mathematically, on a 2 ^ 20 string array, a regular binary search will do ~ 10 calculations, the formula above will be about 20, while a linear search will be ~ 500.000, i.e.  the formula increment is higher by 25,000 times.  If the bare numbers are not impressive, a more eloquent equivalent comparison is 1 second versus ~ 7 hours. <br><br>  In practice, the increase is not so significant (at the end of the article there is a link to an article where different methods were compared).  This is largely due to the CPU time spent on additional procedures that the program performs (for example, writing values ‚Äã‚Äãto cells).  BUT the increase is still critical (~ 4000 times). <br><br>  But at the same time we have a complex, completely non-usable syntax.  Not all mortals were given CDF, what to speak of combinations of 2 CDF with IF. <br><br>  I solved the question with complex syntax with the help of VBA - I wrote UDF (user-defined function, user function), which hides our conditional constructions under the hood, leaving us with the usual syntax of well-known CDF. <br><br>  UDF Code: <br><br><pre><code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">Public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> (a, b <span class="hljs-keyword"><span class="hljs-keyword">As Range</span></span>, c <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-type"><span class="hljs-type">Integer</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> String <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> Application.VLookup(a, b.<span class="hljs-keyword"><span class="hljs-keyword">Columns</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) = a <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span>  = Application.VLookup(a, b, c, <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Else</span></span>  = "" <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span></code> </pre> <br>  To use the function in your Excel file, you need to add a module to the current workbook, in which you add the above code, or download an example file in the <a href="https://yadi.sk/d/qTrj3_a3xXW3n">link</a> , in which it is already done for you. <br><br>  The function accepts 3 parameters as input, the syntax is similar to the usual CDF, except for the 4th parameter, since  it is not needed: <i>(required; array; column number)</i> . <br><br>  So, at the output, we got a function with the usual syntax and the usual behavior, but with a speed that is tens to hundreds to thousands of times faster than the usual CDF, depending on the length of the array.  With the only limitation - the function works correctly only on an array sorted from the smallest to the largest.  Often, the last moment is not an insurmountable obstacle. <br><br>  Use, comment.  I would be happy to improve the algorithm and similar implementation ideas. <br>  I am working on optimizing the search in Python, currently I have not found a standard dictionary search faster, I will be happy for comments on this part. <br><br><h3>  Links </h3><br>  ¬ª <a href="https://fastexcel.wordpress.com/2012/03/29/vlookup-tricks-why-2-vlookups-are-better-than-1-vlookup/">Article about the double CDF trick" Why 2 CDF is better than 1 "</a> <br>  ¬ª <a href="http://analystcave.com/excel-vlookup-vs-index-match-vs-sql-performance/">Comparison of different search methods, including the‚Äú double trick ‚Äùtrick</a> <br>  ¬ª <a href="https://yadi.sk/d/eiCPN-YQozHmH">The latest version of the" Robot Recognizer "and all previous</a> , and some other tools for contextual advertising, including the subject of this article, on one link. </div><p>Source: <a href="https://habr.com/ru/post/313476/">https://habr.com/ru/post/313476/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../313464/index.html">ODBC Firebird Postgresql, execution of requests in Powershell</a></li>
<li><a href="../313466/index.html">The opening of a mobile development studio from scratch in St. Petersburg - 3.5 years later. Reincarnation. Part 1</a></li>
<li><a href="../313468/index.html">AVA - Futuristic JavaScript library for testing.</a></li>
<li><a href="../313472/index.html">Slideshow without JS</a></li>
<li><a href="../313474/index.html">Short and simple about the complex - the service "8-800" (Freephone)</a></li>
<li><a href="../313478/index.html">GPU in the clouds</a></li>
<li><a href="../313480/index.html">Grandstream IP phones and Avaya Aura PBX</a></li>
<li><a href="../313482/index.html">Creating a blog engine with Phoenix and Elixir / Part 2. Authorization</a></li>
<li><a href="../313484/index.html">Recall all: Java JET conference. April 25, 2016. Report number 2</a></li>
<li><a href="../313486/index.html">Another way to display strings in Go</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>