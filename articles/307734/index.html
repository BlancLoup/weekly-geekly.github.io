<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Systematic vulnerability of sites created on CMS 1C-Bitrix</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="To write about the systematic vulnerabilities of sites created on commercial CMS, pushed the post , which described the risks of hacking "protected" C...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Systematic vulnerability of sites created on CMS 1C-Bitrix</h1><div class="post__text post__text-html js-mediator-article">  To write about the systematic vulnerabilities of sites created on commercial CMS, pushed the <a href="https://habrahabr.ru/company/bitrix/blog/305704/">post</a> , which described the risks of hacking "protected" CMS. <br><br>  This article focuses on the compromise of resources due to the "human factor", and the topic of exploiting the vulnerabilities of sites and web attacks was overlooked by the existence of "invulnerable" CMS.  The assumption of the existence of "invulnerable" CMS may have a right to exist, as an example, the security of the finished online store out of the box on the CMS 1C-Bitrix is ‚Äã‚Äãvery high, and it is unlikely to find more or less serious vulnerabilities in the "boxed version" code . <br><br>  Another thing is the security of the final product created on such a CMS, and most importantly, the systematics of the manifestation of high-level vulnerabilities in these sites.  Based on our site security practices (InSafety), as well as the statistics we collect for platform vulnerabilities (CMS), at least fifty percent of the sites created on the 1C-Beatrix platform with personal user accounts have the option of using stored Xss attacks. <br><a name="habracut"></a><br><blockquote>  <b>Platform:</b> CMS 1C-Bitrix 15.0 and higher <br>  <b>Security</b> Risk <b>:</b> Stored XSS Attack <br>  <b>Systematics:</b> at least 50% of sites with personal user accounts </blockquote><br>  The vulnerability of the code, which allows the exploitation of XSS attack, is inadequate filtering of the data of the fields of the registration information form of the user's personal account of the resource, which are transmitted to the database. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Example</b> <br><br>  The developer saves data, for example, the username from $ _REQUEST, via the Bitrix API, they are not completely filtered, and tags are saved.  For example, we pass a string in the form field ‚Äúname‚Äù of the site user‚Äôs PK: <br><br><pre><code class="html hljs xml">test"&gt;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'#'</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'http://insafety.org/img/xss2.jpg'</span></span></span><span class="hljs-tag">/&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span></code> </pre> <br><div style="text-align:center;"><img src="http://insafety.org/bx/pic0.jpg" alt="image"></div><br>  Data is transmitted via normal input to $ _POST ['name'] and then to $ USER-&gt; Update, for example, like this: <br><br><pre> <code class="php hljs">$USER-&gt;Update($USER-&gt;GetID(),<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'NAME'</span></span> =&gt; $_POST[<span class="hljs-string"><span class="hljs-string">'name'</span></span>], ));</code> </pre> <br>  The HTML code will not be sanitized and will be stored in the username "as is".  Screenshot admin site: <br><br><div style="text-align:center;"><img src="http://insafety.org/bx/pic2.jpg" alt="image"></div><br>  Result: <br><br><div style="text-align:center;"><img src="http://insafety.org/bx/pic3.jpg" alt="image"></div><br><br>  <b>This example clearly demonstrates the presence of a security threat.</b> <br><br>  In the proposed demonstration of the existence of a threat, the introduction of HTML code was shown, rather than JS, which suggests a typical XSS attack.  This is due to the fact that most sites developed on the CMS 1C-Bitrix, an attempt to implement JS-code will block the proactive protection filter. <br><br>  The introduction of most of the syntax tags of HTML code, proactive protection CMS 1C-Bitrix is ‚Äã‚Äãnot filtered.  Such a demonstration of the detection of code vulnerabilities is absolutely safe and intuitive.  In the case when the 1C-Bitrix proactive protection filter is disabled for some reason, the code vulnerability described above allows exploiting stored XSS attacks in a ‚Äúclassic‚Äù implementation. <br><br>  The level of security threat to the site from the introduction of any (whether JS or HTML) unauthorized code, as well as its output without proper filtering, is extremely high. <br><br>  <u>For obvious reasons, this article does not offer options for real-life attack, both with the proactive filter turned on and off.</u> <br><br><h3>  XSS attack protection </h3><br>  Protecting your site from the possibility of using XSS attacks is quite simple.  To do this, filter the input and output data by escaping characters and converting special characters into HTML entities.  In php this can be done using the functions htmlspecialchars (), htmlentities (), strip_tags (). <br><br>  <b>Example:</b> <br><br><pre> <code class="php hljs">$name = strip_tags($_POST[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]); $name = htmlentities($_POST[<span class="hljs-string"><span class="hljs-string">'name'</span></span>], ENT_QUOTES, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); $name = htmlspecialchars($_POST[<span class="hljs-string"><span class="hljs-string">'name'</span></span>], ENT_QUOTES);</code> </pre> <br>  In addition, the encoding of the site pages should be explicitly indicated: <br><br><pre> <code class="php hljs">Header(<span class="hljs-string"><span class="hljs-string">"Content-Type: text/html; charset=utf-8"</span></span>);</code> </pre> <br>  There are many ways to protect against XSS attacks, for example, there are options for banning quotes and parentheses (filtering data by blacklist) at the web server configuration level. <br><br>  Example for NGINX: (write to configuration file) <br><br><pre> <code class="html hljs xml">location / { if ($args ~* '^.*(<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">|</span></span></span><span class="hljs-tag">&gt;</span></span>|").*'){ return 403; } if ($args ~* '^.*(%3C|%3E|%22).*'){ return 403; } }</code> </pre> <br>  For the Apache web server, this will be an entry in the .htaccess file: <br><br><pre> <code class="html hljs xml">RewriteEngine on RewriteCond %{HTTP_USER_AGENT} (<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">|</span></span></span><span class="hljs-tag">&gt;</span></span>|"|%3C|%3E|%22) [NC,OR] RewriteRule ^{}</code> </pre> <br>  Filtering data on the blacklist is applicable not for all sites.  To use this method of protection against attacks, you should be very careful because you can block legal requests. <br><br><h3>  Conclusion </h3><br>  The above security threat to a web application is the most popular and well-known attack.  About XSS attacks and protection against them, written thousands of articles and publications. <br><br>  In the practice of our company, vulnerability to XSS attacks on user personal accounts was discovered in the fall of 2015.  In the spring of 2016, our statistics on vulnerable sites on the CMS 1C-Bitrix clearly indicated that the attack could be exploited by more than 50% of the studied sites.  In April 2016, realizing that the code vulnerability in this section is systemic in nature, we passed all the information about the security risk to the Bitrix company.  Employees of the Bitrix company took the information, informing in feedback that they had taken action, correcting the documentation for the system.  <b>Despite the measures taken, the above-described security risk for sites on 1C-Bitrix remains extremely relevant today.</b> <br><br>  I hope that this information will be useful for developers and owners of sites created on the 1C-Bitrix platform. <br><br>  <i>It should be understood that experiments with the security of other sites, not to mention the exploitation of an attack for criminal purposes, may entail criminal liability.</i>  <i>All information on the threat to the security of sites, in this post, is provided in order to increase the overall level of IS of end products on the 1C-Bitrix platform.</i> </div><p>Source: <a href="https://habr.com/ru/post/307734/">https://habr.com/ru/post/307734/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307720/index.html">Elixir: What does OOP look like in a functional language?</a></li>
<li><a href="../307722/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ223 (August 8 - 14, 2016)</a></li>
<li><a href="../307724/index.html">N + 5 useful books</a></li>
<li><a href="../307726/index.html">Create a multilanguage blog using OctoberCMS - Part 2</a></li>
<li><a href="../307732/index.html">Barcode Recognition and QR Codes in UWP Applications</a></li>
<li><a href="../307736/index.html">What the IT manager needs to know or learn the light, and you have to pay for the light</a></li>
<li><a href="../307738/index.html">How trading on the exchange actually works, and how it can be improved: A simple algorithm (part 4)</a></li>
<li><a href="../307740/index.html">10 proven ways to reduce productivity</a></li>
<li><a href="../307744/index.html">Development of a simple chat on Socket.IO [2016] \ Node.js</a></li>
<li><a href="../307746/index.html">MongoDB as a logger for OSSIM</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>