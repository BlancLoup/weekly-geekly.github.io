<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Spam protection at 8800 in FreePBX</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings, asteriskers and sympathizers! Yesterday night, at a popular asterisk forum, I came across the question: how can you ‚Äúquickly‚Äù protect your ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Spam protection at 8800 in FreePBX</h1><div class="post__text post__text-html js-mediator-article">  Greetings, asteriskers and sympathizers!  Yesterday night, at a popular asterisk forum, I came across the question: how can you ‚Äúquickly‚Äù protect your 8800 number from a technique that is often used by competitors - by dialing a number to trigger the billing number? <br><a name="habracut"></a><br>  The operator of numbers 8800, whom I advise my clients, takes 2.42 rubles per minute with per-minute billing, and 2.89 rubles per minute with per-second.  With a second, of course, everything is easier, but also unpleasant.  In one minute you can make at least 10 calls, which will be written off from the balance of the owner of the number almost 15 rubles.  In an hour it will be 900 rubles, and this if in one stream.  In general, the problem is obvious. <br><br>  The solution was found simple, by tradition, everything is done from the FreePBX webmoney.  We will need the Smart Routes module, which I mentioned in the <a href="https://habrahabr.ru/post/306766/">previous publication</a> , and you can download it there. <br><br>  The logic is simple - we look for the last calls from the current number in the CDR, and if there are more than X in Y minutes, we reset the call. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The request in the module is simple: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(<span class="hljs-string"><span class="hljs-string">`calldate`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">`cdr`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> (<span class="hljs-string"><span class="hljs-string">`src`</span></span>=<span class="hljs-string"><span class="hljs-string">'${CALLERID(number)}'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (<span class="hljs-string"><span class="hljs-string">`calldate`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOW</span></span>() - <span class="hljs-built_in"><span class="hljs-built_in">INTERVAL</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MINUTE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOW</span></span>())</code> </pre> <br>  As you can see, the interval is specified here, in the request.  The query will select the number of calls from the current number in the last 5 minutes and display them in the resulting field in one line. <br><br>  We need to set the Match Type in LESSER, by coincidence - go to the point we need, set Failover, for example, in Terminate =&gt; Hangup.  It is in this field that the number of allowed calls from the current number for the interval specified in the request is configured. <br><br>  Default Destination is also reset. <br><br>  It looks like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0c8/87b/6f1/0c887b6f11b0646caafb0112a9055050.jpg" alt="image"><br><br>  It remains to send calls to the Smart Routes module in the incoming rules and that's it! <br>  Good luck and fewer inadequate people on your way. </div><p>Source: <a href="https://habr.com/ru/post/309348/">https://habr.com/ru/post/309348/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../309338/index.html">Future is now: what will happen on JavaDay Kharkiv 2016, September 17</a></li>
<li><a href="../309340/index.html">.Net Core, 1C, dynamic compilation, Scripting API</a></li>
<li><a href="../309342/index.html">We invite you on October 19, Moscow to the IX conference "Embedded Technologies 2016. Industrial Internet of Things"</a></li>
<li><a href="../309344/index.html">Contact Service Desk. Where do customers care more: in IT services or repair of air conditioners?</a></li>
<li><a href="../309346/index.html">IT news. August</a></li>
<li><a href="../309350/index.html">Ecosystem R as a tool for automating business tasks</a></li>
<li><a href="../309352/index.html">Internet on magnets 4 - Divide the magnet into pieces</a></li>
<li><a href="../309354/index.html">History of Programming Languages: Jumble and JavaScript Consolidation</a></li>
<li><a href="../309356/index.html">Agile or Lean: Aha aha, what's the difference?</a></li>
<li><a href="../309360/index.html">Igor Ilyunin: ‚ÄúThe customer asked to assemble a team that he did not find in Silicon Valley‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>