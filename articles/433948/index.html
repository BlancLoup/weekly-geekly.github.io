<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make payment for services more convenient: the experience of an IaaS provider</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of the important issues when working with the services of an IaaS provider is the convenience of payment. From the first day of the start of our p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make payment for services more convenient: the experience of an IaaS provider</h1><div class="post__text post__text-html js-mediator-article">  One of the important issues when working with the services of an IaaS provider is the convenience of payment.  From the first day of the start of our project, we tried to simplify the process of making payments using bank cards and continue to improve this mechanism.  Today we decided to talk about where we started and share our experiences. <br><br> <a href="https://habr.com/company/1cloud/blog/433948/"><img src="https://habrastorage.org/webt/iy/6k/pv/iy6kpvrzewuk4mudc9nkfwiadu8.jpeg"></a> <a name="habracut"></a><br>  <font color="#A9A9A9"><i>/ Flickr / <a href="https://www.flickr.com/photos/muhammad_ashiq/14281152542/">Muhammad Ashiq</a> / <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC BY-SA</a></i></font> <br><br><h2>  Background question </h2><br>  We have <a href="https://1cloud.ru/%3Futm_source%3Dhabrahabr%26utm_medium%3Dcpm%26utm_campaign%3Dgate%26utm_content%3Dsite">been</a> providing IaaS services since <a href="https://1cloud.ru/%3Futm_source%3Dhabrahabr%26utm_medium%3Dcpm%26utm_campaign%3Dgate%26utm_content%3Dsite">1cloud</a> .  During this time we <a href="https://1cloud.ru/blog/iaas-easy-pay%3Futm_source%3Dhabrahabr%26utm_medium%3Dcpm%26utm_campaign%3Dgate%26utm_content%3Dblog">managed to work</a> with a large number of payment gateways.  One of the first was "Money Online".  We worked with him for two years, and then began to connect alternative services in case of potential technical difficulties. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Alternatively, they considered PayPal and Robokassa.  As a result, both platforms were connected, although with <a href="https://habr.com/company/1cloud/blog/294184/">this there were certain difficulties</a> .  In the first case, in order to import the client ID into the payment form, we had to adjust the CSS rules and modify the standard elements on the web page.  In the situation with Robokassa, a number of requests to the API did not match its description, but with the help of technical support, the situation was also resolved.  We did not stop at these solutions and considered other options that potential partners offered us. <br><br>  So, we started working with the PayMaster payment system (it replaced ‚ÄúMoney Online‚Äù), which offered us favorable terms for the commission and a convenient API.  For a long time, this payment gateway acted as the main one.  However, recently we decided to redesign the usability of our service and simplify the process of payment for bank card services for individuals.  In order for UX to meet our requirements, we integrated another payment gateway - CloudPayments. <br><br><h2>  How can you improve the UX payment process? </h2><br>  We work on the prepay model.  The client replenishes his account in his personal account, and then funds are debited from this account as IaaS services are consumed (debit is made every ten minutes). <br><br>  To replenish the balance with a credit card, in the case of PayMaster, the client had to go through a four-step process: <br><br><ol><li>  Enter the amount to pay in the form in the control panel, click "Pay" and go to the payment gateway page. </li><li>  Specify a phone number or email address to receive a check and click Continue. </li><li>  Enter the card details and press the ‚ÄúPay‚Äù button again. </li><li>  Specify the transaction confirmation code sent by the bank as part of the 3D Secure procedure. </li></ol><blockquote>  <i><b>Disclaimer:</b> the algorithm described above concerns payments by bank cards that individuals make.</i>  <i>Legal entities pay for the services of the IaaS provider for the invoices.</i>  <i>While improving usability, we refined the mechanisms of automatic billing of such invoices, but we will not consider them as part of this material, since legal entities do not interact with the payment gateway.</i> </blockquote><br>  We decided to simplify the payment process for users and, in general, to improve the appearance and usability of forms for filling in bank card data.  To do this, we have identified for ourselves two tasks, which we describe below. <br><br><h5>  Task 1: exclude the transition to the payment gateway page </h5><br>  As we noted above, when a user paid for our services, he had to go to the payment gateway site to fill out the card details.  So a person had to press a lot of confirmation buttons and wait for the loading of pages with information about the account replenishment. <br><br>  At the same time, another problem arose - after the user deposited money into the account, he remained on the payment gateway page until he clicked on a special link to return to 1cloud.ru.  This complicated the work with our control panel, for example, if after the payment the user wanted to add capacity to his IT infrastructure. <br><br><blockquote>  <i>‚ÄúAccording to analysts, only a handful of clients followed the link and returned to our site,‚Äù says <b>Sergey Belkin</b> , head of development at 1cloud.ru.</i>  <i>- This was partly due to the fact that the client had to click the ‚ÄúReturn to online store‚Äù link.</i>  <i>This is despite the fact that our service is not an online store. ‚Äù</i> </blockquote><br>  In addition, we wanted to reduce the number of user-filled fields to a minimum, leaving only those that are really necessary for the operation.  To accomplish this task, we chose the CloudPayments payment gateway, whose employees initially attracted our attention with quick and complete technical support responses. <br><br>  In addition, this payment gateway had a representative office in Kazakhstan.  This made it possible to implement a new payment method for our hosting service <a href="https://oblako.kz/">oblako.kz</a> .  Otherwise, all our transfers from Kazakhstan to Russia (or vice versa) would be subject to an additional commission. <br><br>  CloudPayments suggested using a special <a href="https://cloudpayments.ru/wiki/integration/products/Checkout">chekout script</a> .  It allows you to implement the payment form directly in our control panel and transfer the completed data to the payment gateway, without saving them on our side. <br><br>  To implement the script, we had to go through a <a href="https://ru.wikipedia.org/wiki/PCI_DSS">PCI DSS</a> security scan at one of the accredited organizations - such was the requirement of CloudPayments.  Scanning is needed to confirm technical compliance with the standard and eliminate the possibility of theft of user data while filling out forms on the site. <br><br>  The PCI DSS compliance audit was conducted by ARinteg.  We sent them a request in which we indicated a desire to undergo an audit, filled out a questionnaire and set a date for the inspection.  On the ARinteg side, preparation for scanning takes about half a day (that is, you can scan almost immediately), but we took an additional four to five days to thoroughly prepare our infrastructure. <br><br>  Scanning lasted about 15 hours, although it happens that the test takes several days.  ARinteg specialists checked for SSL and protection against requests-injections and other vulnerabilities on our site. <br><br>  We did not pass the initial test, and we were given a list of problems that needed to be fixed.  All of them were insignificant, for example, there was a post-method that was used when the user evaluated our step-by-step instructions on the site.  We have eliminated all comments, and the second audit attempt was successful.  Then we could go to the implementation of the chekout script. <br><br>  The script is registered on our website, collects card data from this form and makes a cryptogram of them for payment through the API CloudPayments.  It looks like this: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.createCryptogram = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = checkout.createCryptogramPacket(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.success) { <span class="hljs-comment"><span class="hljs-comment">//   alert(result.packet); } else { //     ,  `result.messages` : // { name: "      ", cardNumber: "  " } //  `name`, `cardNumber`    `&lt;input ... data-cp="cardNumber"&gt;` for (var msgName in result.messages) { alert(result.messages[msgName]); } } }; $(function () { /*  checkout */ checkout = new cp.Checkout( // public id    "test_api_00000000000000000000001", // ,     document.getElementById("paymentFormSample")); });</span></span></code> </pre> <br>  The form itself for entering bank card data looks like this: <br><br><img src="https://habrastorage.org/webt/yi/vl/yt/yivlyttyhrz8mgmikdhnr9_8mys.png"><br><br>  During the implementation of the script and the form, we managed to reduce the number of user-filled fields to a minimum.  Left only those that are really necessary for the operation.  For example, removed the field "Name" and "Last Name".  As representatives of the payment gateway explained to us, banks do not check this data (only the card number, date and CVV are important), so we decided to drop them and simplify the whole process. <br><br>  Additionally, we have made more visual information about our <a href="https://1cloud.ru/conditions/paymentrule%3Futm_source%3Dhabrahabr%26utm_medium%3Dcpm%26utm_campaign%3Dgate%26utm_content%3Dsite">discount program</a> : in case of a one-time account replenishment in the amount of 5 thousand rubles, 10% of it is credited as bonuses, from 10,000 rubles - 20%, more than 100,000 rubles - 25%.  We also added the ability to save map data for users.  All this information is stored on the side of the payment gateway CloudPayments in encrypted form. <br><br><h5>  Task 2: implement auto payment </h5><br>  This is a payment that occurs automatically on some condition.  Very often this feature is used by subscription services.  However, most payment gateways offer only the option when automatic replenishment occurs on a schedule (on a given date).  It is also important for us that the opportunity to replenish the account is automatically available at any time when the client has run out of funds on the account (as we work on prepay).  Therefore, for the implementation of autopay, we used the method that is used when paying with a ‚Äúmemorized‚Äù card (by time token). <br><br>  It works as follows: after the first successful payment made by the user, the gateway generates its token for the ‚Äúservice card‚Äù pair and sends it in the postback response.  This token is saved, and when you pay again, it is transferred, and not the card data.  It turns out that we are sending a request to the gateway, in which we indicate our API key (the identifier that the request came from 1cloud), the token and the amount.  The gateway checks whether such a token was created, and if everything is in order, it processes the payment for the specified amount. <br><br>  The date when it is necessary to make an auto payment is calculated dynamically based on the current consumption of services by the user and the balance of funds in the account.  Suppose a client has a thousand rubles on his balance, and he has consumed two rubles over the last ten-minute interval.  It is clear that the approximate date of zeroing will come in five hundred ten-minute intervals - this is approximately 34 days.  Thus, we can make an auto payment several days before the end of the funds.  The client chooses the size of the auto payment. <br><br><h2>  What's next </h2><br>  Now we are testing these solutions and evaluating the results of implementation.  According to a vote held among customers, most are pretty changeable.  We will further study the feedback on the work of the system, analyze the data and, if necessary, make adjustments. <br><br><h5>  PS Fresh materials from our corporate blog: </h5><br><ul><li>  <a href="https://1cloud.ru/blog/devops-v-razrabotke-oblaka-1cloud%3Futm_source%3Dhabrahabr%26utm_medium%3Dcpm%26utm_campaign%3Dgate%26utm_content%3Dblog">DevOps in the cloud service on the example of 1cloud.ru</a> </li><li>  <a href="https://1cloud.ru/blog/chto-takoe-elektronno-cifrovaya-podpis%3Futm_source%3Dhabrahabr%26utm_medium%3Dcpm%26utm_campaign%3Dgate%26utm_content%3Dblog">What you need to know about digital signatures</a> </li><li>  <a href="https://1cloud.ru/blog/minimizazia-it-riskov%3Futm_source%3Dhabrahabr%26utm_medium%3Dcpm%26utm_campaign%3Dgate%26utm_content%3Dblog">Risk minimization: how not to lose your data</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/433948/">https://habr.com/ru/post/433948/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../433936/index.html">Looking for a hi-tech gift for a child? Think of a playground, not an arena</a></li>
<li><a href="../433938/index.html">How Yandex and Google sum up the year</a></li>
<li><a href="../433940/index.html">How much does Review in AppStore cost</a></li>
<li><a href="../433944/index.html">Destructive exceptions</a></li>
<li><a href="../433946/index.html">Crib for artificial intelligence - throw away too much, teach the main thing. Technique processing training sequences</a></li>
<li><a href="../433952/index.html">10 reasons to choose a solution for SAP HANA from HPE. Part 2</a></li>
<li><a href="../433954/index.html">Eight audio technologies and audio gadgets that will get into the TECnology hall of fame in 2019</a></li>
<li><a href="../433956/index.html">Modders have attracted AI to improve textures in games</a></li>
<li><a href="../433958/index.html">TDD applications on Spring Boot: working with a database</a></li>
<li><a href="../433964/index.html">ECMAScript Modules in Node.js: New Plan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>