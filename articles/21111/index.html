<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cross Domain XMLHttpRequest</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="An important component of AJAX technology is XMLHttpRequest. This object allows you to make HTTP requests to the server without the need to reload the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cross Domain XMLHttpRequest</h1><div class="post__text post__text-html js-mediator-article"> An important component of AJAX technology is XMLHttpRequest.  This object allows you to make HTTP requests to the server without the need to reload the page. <a name="habracut"></a><br><br>  Usually, working with XMLHttpRequest is as follows: <br>  1. Creating an instance of the XMLHttpRequest object <br>  2. Setting an event handler that occurs when the state of an object changes (onreadystatechange) <br>  3. Opening a connection (open) and sending a request (send) <br><br>  Unfortunately, XMLHttpRequest only works with files that are in the same domain as the page using XMLHttpRequest.  That is, a request can be made only to addresses with the same domain, protocol and port as the current page.  This is done for security purposes and creates problems if you need to get data / content from another site. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Recently, this problem arose in front of me, a very simple solution was chosen, which will be discussed further. <br><br>  Proxy!  A simple and intuitive method for cross-domain queries.  The essence of the method is as follows: <br><br>  1. XMLHttpRequest accesses the PHP script on its domain, passing it the request method, address and parameters <br>  2. PHP script, in turn, acts as a proxy.  That is, it makes a request based on the parameters passed to it and returns the response of another JS server to the script <br><br>  PHP script, which is a proxy for cross-domain query, is based on CURL. <br><br>  This is actually the proxy.php script itself: <br> <code>&lt;?php <br> header("Content-Type: text/xml; charset=windows-1251"); <br> //   <br> $method = (empty($_GET['method'])) ? 1 : $_GET['method']; <br> $url = $_GET['url']; <br> $url = (empty($_GET['url'])) ? die("no url") : $_GET['url']; <br> $params = $_GET['params']; <br> //     <br> $allowed = array(1 =&gt; "~http:\/\/(www\.)?habrahabr\.ru\/~", 2 =&gt; "~http:\/\/(www\.)?el\-egoisto\.com\/~"); <br> $count = count($allowed); <br> for ($i = 1; $i &lt;= $count; $i++) <br> { <br> if (preg_match($allowed[$i],$url)) <br> { <br> //     -   <br> $ch = curl_init(); <br> switch ($method) <br> { <br> case 1: <br> // GET  <br> curl_setopt($ch, CURLOPT_URL, $url."?".$params); <br> break; <br> case 2: <br> // POST  <br> curl_setopt($ch, CURLOPT_URL, $url); <br> curl_setopt($ch, CURLOPT_POST, 1); <br> curl_setopt($ch, CURLOPT_POSTFIELDS, $params); <br> break; <br> } <br> curl_setopt($ch, CURLOPT_HEADER, 0); <br> $response = curl_exec($ch); <br> $header_size = curl_getinfo($ch,CURLINFO_HEADER_SIZE); <br> $xml = substr($response,$header_size); <br> echo $xml; <br> curl_close($ch); <br> exit(); <br> } <br> } <br> ?&gt; <br></code> <br>  XMLHttpRequest refers to it and sends 3 parameters: <br>  1. method - 1 for GET request and 2 for POST <br>  2. url - request address <br>  3. params - request parameters <br><br>  The PHP script checks for the presence of input parameters, checks whether it is allowed to send a request to the url (regexp array $ allowed) and actually sends the request and returns the response of the remote server. <br><br>  From JS, this PHP script is used like this: <br><br>  There are 2 functions for working with XMLHttpRequest - CreateReq and GetData.  The first creates an instance of the object, and the second sets the handler and sends the request. <br> <code>function CreateReq() <br> { <br> var req = null; <br> if (window.XMLHttpRequest) <br> { <br> try <br> { <br> req = new XMLHttpRequest(); <br> } <br> catch(e) <br> { <br> req = null; <br> } <br> } <br> else if (window.ActiveXObject) <br> { <br> try <br> { <br> req = new ActiveXObject("Msxml2.XMLHTTP"); <br> } <br> catch(e) <br> { <br> try <br> { <br> req = new ActiveXObject("Microsoft.XMLHTTP"); <br> } <br> catch(e) <br> { <br> req = null; <br> } <br> } <br> } <br> return req; <br> } <br> <br> function GetData(url,callback) <br> { <br> req = new CreateReq; <br> <br> if(req != null) <br> { <br> req.onreadystatechange = callback; <br> req.open('GET', url, true); <br> req.send(null); <br> } <br> else alert(" .."); <br> } <br></code> <br><br>  Let's consider sending a GET request using the example of obtaining karma and strength from Habr :) <br><br> <code>function GetHabraMe() <br> { <br> GetData("/proxy.php?method=1&amp;url="+encodeURIComponent("http://habrahabr.ru/api/profile/lordeg"),GetHabraCallback); <br> } <br> <br> function GetHabraCallback() <br> { <br> if(req.readyState == 4) <br> { <br> if(req.status == 200) <br> { <br> var xmlDoc = req.responseXML; <br> var karma = xmlDoc.getElementsByTagName("karma").item(0).firstChild.data; <br> var rating = xmlDoc.getElementsByTagName("rating").item(0).firstChild.data; <br> var place = document.getElementById("data"); <br> if(place != null) <br> { <br> place.innerHTML = ": "+karma+"&lt;br&gt;: "+rating+"; <br> } <br> } <br> } <br> return false; <br> } <br></code> <br><br>  GetHabraMe will send a GET request to <a href="http://habrahabr.ru/api/profile/lordeg">habrahabr.ru/api/profile/lordeg</a> using proxy.php and the result will ‚Äúreturn‚Äù to the element with id ‚Äúdata‚Äù. <br><br>  Sending a POST request is almost the same: <br><br> <code>function GetPings() <br> { <br> var d_topic = document.getElementById("topic"); <br> if (d_topic.innerHTML == " ") <br> { <br> GetData("/proxy.php?method=2&amp;url="+encodeURIComponent("http://el-egoisto.com/frontend.php")+"¬∂ms="+encodeURIComponent("func=recent&amp;owner=9&amp;id=1&amp;cutoff=48"),GetMyLastPingsCallback); <br> } <br> } <br></code> <br>  You can see the implementation in ‚Äúcombat conditions‚Äù here - <a href="http://lord-phoenix.com/">lord-phoenix.com</a> (‚Äúcurrent music‚Äù and ‚ÄúHabralordeg‚Äù links) :) <br>  I do not pretend to originality, I just decided to issue a solution to the problem that arose before me in the form of a topic in a blog.  Maybe someone will come in handy with my experience. <br><br>  Materials on the topic: <br>  1. <a href="httprequest.ru/">xmlhttprequest.ru</a> <br>  2. <a href="http://ru.wikipedia.org/wiki/XMLHttpRequest">en.wikipedia.org/wiki/XMLHttpRequest</a> <br>  3. <a href="http://ru.wikipedia.org/wiki/AJAX">en.wikipedia.org/wiki/AJAX</a> <br>  4. <a href="http://ru.wikipedia.org/wiki/CURL">ru.wikipedia.org/wiki/CURL</a> </div><p>Source: <a href="https://habr.com/ru/post/21111/">https://habr.com/ru/post/21111/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../211100/index.html">Tame ZoG (Part 1: The Wolves and the Goat)</a></li>
<li><a href="../211102/index.html">Twitter enters into a patent agreement with IBM</a></li>
<li><a href="../211104/index.html">Raspberry Pi and a cup of Java, please! (Part 2)</a></li>
<li><a href="../211106/index.html">Managerial tools: 4-phase algorithm for solving problems with people or ‚ÄúWhat do you want if you are such a crap manager?‚Äù</a></li>
<li><a href="../211108/index.html">Vim croquet</a></li>
<li><a href="../211112/index.html">Server E3-1230v3 3.30GHz / 8 GB ECC / 2x 1 TB WD RE4 / 10 TB at low prices + modular server order</a></li>
<li><a href="../211116/index.html">Monetizing Twitter'a - a new solution</a></li>
<li><a href="../211118/index.html">PHP: The Right Way</a></li>
<li><a href="../21112/index.html">Astrophysicist made "home supercomputer" of 16 game consoles</a></li>
<li><a href="../211120/index.html">Collective Intelligence in Number Theory</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>