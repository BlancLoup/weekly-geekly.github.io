<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Developing Action-able Slack Applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From the translator: we publish for you an article by Tomomi Imura on how to develop an application integrated with Slack 

 Actions is what allows Sl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Developing Action-able Slack Applications</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/ca0/857/93d/ca085793d555da41e3362e86f4ac612a.png"><br><br>  <b>From the translator: we</b> publish for you <a href="https://medium.com/slack-developer-blog/tutorial-developing-an-action-able-app-4d5455d585b6">an article by</a> Tomomi Imura on how to develop an application integrated with Slack <br><br>  Actions is what allows Slack users to interact with your application with messages: report a problem with a bug, send a request to helpdesk, or do something else.  This feature is similar to built-in features like commenting or sharing. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This tutorial will guide you through the entire process of creating a live application. <br><a name="habracut"></a><br><blockquote>  <b>Skillbox recommends:</b> Two-year hands-on course <a href="https://iamwebdev.skillbox.ru/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DWEBDEVPRO%26utm_content%3Darticles%26utm_term%3Dappforslack">‚ÄúI am a PRO Web developer</a> . <a href="https://iamwebdev.skillbox.ru/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DWEBDEVPRO%26utm_content%3Darticles%26utm_term%3Dappforslack">‚Äù</a> <br><br>  <b>We remind:</b> <i>for all readers of "Habr" - a discount of 10,000 rubles when recording for any Skillbox course on the promotional code "Habr".</i> </blockquote><br>  Tutorial will be useful for anyone who would like to learn the Slack API.  When developing an application, Node.js is used, so if you want to repeat what the conversation is about, set it up. <br><br>  With the finished project can be found on <a href="https://github.com/slackapi/template-action-and-dialog">GitHub</a> , with a simplified version of it - on the <a href="https://glitch.com/~slack-clipit-simplified">Glitch</a> . <br><br>  <b>ClipIt!</b>  <b>for slack</b> <br><br>  We will develop the Slack-app for the imaginary application ClipIt!  Let's imagine that we manage a web service that allows you to ‚Äúlay‚Äù a part of a web page, saving it to a database.  Users can access the stored content from a mobile device or PC, the service is multiplatform.  And ClipIt!  allows you to attach text in a Slack message environment using Action. <br><br>  Here is a gif showing the principle of the application. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8d5/8f7/0a2/8d58f70a20f5791bec6ff2efc6b921cc.gif"><br><br>  But the user interaction algorithm with ClipIt!  from Slack: <br><br><ul><li>  The user hovers over the message and selects Clip the message in the drop-down menu. </li><li>  A dialogue opens that gives more options. </li><li>  The user confirms the action. </li><li>  ClipIt!  for Slack, it exports the message to the ClipIt! database. </li><li>  ClipIt!  for Slack sends the DM user with confirmation. </li></ul><br><h3>  Configure the application </h3><br>  Log in to your Slack account and create an application using <a href="https://api.slack.com/apps%3Fnew_app_token%3D1%3Fcvosrc%3Dblog.medium.medium_fy19-q411-making_apps_actionable%26cvo_creative%3D%26utm_medium%3Dblog%26utm_source%3Dmedium%26utm_campaign%3Dcd_blog_medium_all_en_developers_ob-null_cr-_ym-">this link</a> .  Enter its name and scope. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7e6/c94/9f8/7e6c949f8433d60da49b46ec74b7177a.png"><br><br>  Click Create App, then Basic Information, scroll to App Credentials. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/244/fd0/cd0/244fd0cd041582e3049ba33ffd597d73.png"><br><br>  After that, open Signing Secret and copy the code to use as the environment variable SLACK_SIGNING_SECRET in your .env file in the root Node.  I will explain what this is and how to use all this, in the ‚ÄúVerification of Requests‚Äù section below. <br><br>  SLACK_SIGNING_SECRET = 15770a ... <br><br>  Scroll a little lower to fill in the Display Information with your application icon and description. <br><br>  Now enable Interactivity in Interactive Components.  By doing this, you will see more fields on the page. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4c0/bb8/7ac/4c0bb87ac72c79d750a831049ce414e3.png"><br><br>  It's time to enter the Request URL ‚Äî this is the address to which Slack sends the relevant data when the user launches an action. <br><br>  This should be the URL of your server running the application code.  For example, if you put it all in Glitch, your URL would look something like <a href="https://example.glitch.me/actions">example.glitch.me/actions</a> .  If you are using tunneling, working with services like ngrok, then use the service URL (for example, <a href="https://example.ngrok.io/">example.ngrok.io</a> , and then add / actions). <br><br>  Once you have entered the Request URL, scroll down to Actions and click Create New Action.  Fill the form: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/800/7b0/f06/8007b0f06583bcbf20417943986ae42a.png"><br><br>  Click Create, then Save Changes. <br><br>  Next, go to the Bot Users.  Click Add a Bot User and name the application bot. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ad8/034/b23/ad8034b2305374171c5059080eec8b41.png"><br><br>  Now click on Add Bot User and save. <br><br>  The next step is to go to OAuth &amp; Permissions and click Install App to Workspace.  After the installation is completed, the page will return you to OAuth &amp; Permission with access tokens.  Copy the bot token and save it all in an .env file. <br><br>  SLACK_ACCESS_TOKEN = xoxb-214 ... <br><br>  In addition, Scopes will need to be activated on the same page.  When you do this, make sure that both bot and command are highlighted. <br><br>  Now, when all the settings are ready, we start creating - we write the application. <br><br><h3>  Create application </h3><br>  As mentioned above, when creating an application, Node.js and ExpressJS are used.  In order to work with all this, we install ExpressJS dependencies, bodyParser, and one more thing.  So, I use the axios HTTP request client along with qs. <br><br>  $ npm install express body-parser axios qs dotenv - save <br><br>  Let's start with the most important.  We will change the code later when we add more functions.  First create the index.js file.  In this file, we register listening by the server of the corresponding port: <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* Snippet 1 */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'dotenv'</span></span>).config(); <span class="hljs-comment"><span class="hljs-comment">// To grab env vers from the .env file const express = require('express'); const bodyParser = require('body-parser'); const axios = require('axios'); const qs = require('qs'); const app = express(); // The next two lines will be modified later app.use(bodyParser.json()); app.use(bodyParser.urlencoded({ extended: true })); const server = app.listen(5000); // port</span></span></code> </pre> <br>  Before proceeding, let's take a look at the diagram describing the principles of operation of everything we are talking about. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/873/887/d5c/873887d5c4df62c27b41b1d752eeb5ab.png"><br><br>  Each thread is initialized when the user executes actions located in the message menu.  As soon as the message_action event is triggered, Slack sends the payload application to the request URL that was previously registered. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e83/fa1/941/e83fa1941e9933d237af7e5a3f70589b.png"><br><br>  Endpoint can be written as follows: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* Snippet 2 */</span></span> app.post(<span class="hljs-string"><span class="hljs-string">'/actions'</span></span>, (req, res) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> payload = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(req.body.payload); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {type, user, submission} = payload; <span class="hljs-comment"><span class="hljs-comment">// Verifying the request. I'll explain this later in this tutorial! if (!signature.isVerified(req)) { res.sendStatus(404); return; } if(type === 'message_action') { // open a dialog! } else if (type === 'dialog_submission') { // dialog is submitted } });</span></span></code> </pre> <br>  If the event type is message_action, the application opens a dialog. <br><br>  Then we add the code that defines the structure of the content of the dialogue, opening it in the Slack client using the dialog.open method: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* Snippet 2.1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dialogData = { <span class="hljs-attr"><span class="hljs-attr">token</span></span>: process.env.SLACK_ACCESS_TOKEN, <span class="hljs-attr"><span class="hljs-attr">trigger_id</span></span>: payload.trigger_id, <span class="hljs-attr"><span class="hljs-attr">dialog</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify({ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">'Save it to ClipIt!'</span></span>, <span class="hljs-attr"><span class="hljs-attr">callback_id</span></span>: <span class="hljs-string"><span class="hljs-string">'clipit'</span></span>, <span class="hljs-attr"><span class="hljs-attr">submit_label</span></span>: <span class="hljs-string"><span class="hljs-string">'ClipIt'</span></span>, <span class="hljs-attr"><span class="hljs-attr">elements</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'Message Text'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'textarea'</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: payload.message.text }, { <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'Importance'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'select'</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'importance'</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">'Medium '</span></span>, <span class="hljs-attr"><span class="hljs-attr">options</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'High'</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">'High '</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'Medium'</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">'Medium '</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'Low'</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">'Low Ô∏è'</span></span> } ], }, ] }) }; <span class="hljs-comment"><span class="hljs-comment">// open the dialog by calling the dialogs.open method and sending the payload axios.post('https://slack.com/api/dialog.open', qs.stringify(dialogData)) .then((result) =&gt; { if(result.data.error) { res.sendStatus(500); } else { res.sendStatus(200); } }) .catch((err) =&gt; { res.sendStatus(500); });</span></span></code> </pre> <br>  Here we use the axios module to perform a POST request to Slack;  after this, the dialog.open method opens the dialog, sending HTTP status 200. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/278/4ac/208/2784ac20848dbc55377795d9b4ab7f24.png"><br><br>  Endpoint is also activated if the dialog is initiated by the user.  In snippet 2 code, you need to respond with an empty HTTP 200 request so that Slack knows that the view has been received. <br><br>  Finally, we send the user a confirmation message using the chat.postMessage method. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* Snippet 2.2 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (type === <span class="hljs-string"><span class="hljs-string">'dialog_submission'</span></span>) { res.send(<span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Save the data in DB db.set(user.id, submission); // this is a pseudo-code! // DM the user a confirmation message const attachments = [ { title: 'Message clipped!', title_link: `http://example.com/${user.id}/clip`, fields: [ { title: 'Message', value: submission.message }, { title: 'Importance', value: submission.importance, short: true }, ], }, ]; const message = { token: process.env.SLACK_ACCESS_TOKEN, channel: user.id, as_user: true, // DM will be sent by the bot attachments: JSON.stringify(attachments) }; }</span></span></code> </pre> <br>  Now let's run the code and see how the application works in integration with Slack.  If all is well, perform the last step. <br><br><h3>  Request verification </h3><br>  Now let's take care of the security of the application and add verification requests.  Always verify any requests from Slack before taking them to work. <br><br>  For this we return to snippet 1, which is located at the very top.  Replace the place where there is a comment // The next two lines will be modified later, with this: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* Snippet 3 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rawBodyBuffer = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res, buf, encoding</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (buf &amp;&amp; buf.length) { req.rawBody = buf.toString(encoding || <span class="hljs-string"><span class="hljs-string">'utf8'</span></span>); } }; app.use(bodyParser.urlencoded({<span class="hljs-attr"><span class="hljs-attr">verify</span></span>: rawBodyBuffer, <span class="hljs-attr"><span class="hljs-attr">extended</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> })); app.use(bodyParser.json({ <span class="hljs-attr"><span class="hljs-attr">verify</span></span>: rawBodyBuffer }));</code> </pre> <br>  I already connected the cryptography to <strong>verifySignature.js</strong> , so just add the function to the beginning of index.js: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> signature = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./verifySignature'</span></span>);</code> </pre> <br>  Now we perform verification: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!signature.isVerified(req)) { <span class="hljs-comment"><span class="hljs-comment">// when the request is NOT coming from Slack! res.sendStatus(404); // a good idea to just make it ‚Äúnot found‚Äù to the potential attacker! return; }</span></span></code> </pre> <br>  I recommend verifying requests each time your application receives them from Slack. <br><br>  We run the code again, and if everything works as it should, we can celebrate success!  Congratulations! <br><br><blockquote><ul><li>  Online course <a href="https://skillbox.ru/frontend-developer/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DFRENDEV%26utm_content%3Darticles%26utm_term%3Dappforslack">"Profession frontend-developer"</a> </li><li>  Practical course <a href="https://skillbox.ru/agima/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DAGIMA%26utm_content%3Darticles%26utm_term%3Dappforslack">"Mobile Developer PRO"</a> . </li><li>  Practical annual course <a href="https://skillbox.ru/php/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DPHPDEV%26utm_content%3Darticles%26utm_term%3Dappforslack">"PHP developer from 0 to PRO"</a> . </li></ul></blockquote></div><p>Source: <a href="https://habr.com/ru/post/431346/">https://habr.com/ru/post/431346/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../431334/index.html">Huawei: Protection of the control plane</a></li>
<li><a href="../431338/index.html">The book "DNA. The history of the genetic revolution "</a></li>
<li><a href="../431340/index.html">His fleet of 11 polygons, nothing to do with the present</a></li>
<li><a href="../431342/index.html">Used car loan for 1 minute</a></li>
<li><a href="../431344/index.html">Built-in acoustics: what it is and how it works</a></li>
<li><a href="../431348/index.html">Anycubic Photon: A Mini-Review of an Affordable Photopolymer 3D Printer</a></li>
<li><a href="../431350/index.html">Plans for the development of a line of processors from Baikal Electronics</a></li>
<li><a href="../431354/index.html">The first video codec on machine learning radically surpassed all existing codecs, including H.265 and VP9</a></li>
<li><a href="../431360/index.html">We explain backdoor in event-stream</a></li>
<li><a href="../431362/index.html">How a designer get rid of his routine and keep his interest in his work</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>