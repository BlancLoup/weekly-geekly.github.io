<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Some interesting MySQL features</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the not too distant past, I had to dig a little bit into the MySQL source code, and figure out some aspects of its work. In the course of working w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Some interesting MySQL features</h1><div class="post__text post__text-html js-mediator-article">  In the not too distant past, I had to dig a little bit into the MySQL source code, and figure out some aspects of its work.  In the course of working with a spatula, and experiments, I came across some very interesting features, some of which are just fun, and in the case of some, it is very interesting to understand what the programmer was guided by, who made the decision to do this. <br><br>  Let's start with such an interesting type as ENUM. <br><br><pre><code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> enums(a ENUM(<span class="hljs-string"><span class="hljs-string">'c'</span></span>, <span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-string"><span class="hljs-string">'b'</span></span>), b <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>(a)); Query OK, 0 rows affected (0.36 sec) mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> enums <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span>(<span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-string"><span class="hljs-string">'b'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-string"><span class="hljs-string">'c'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); Query OK, 3 rows affected (0.05 sec) Records: 3 Duplicates: 0 Warnings: 0</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, we have a table, it has two columns.  In the first, <b><i>a</i></b> , type ENUM, in the second, <b><i>b</i></b> , INT.  In the table there are three lines, for all three, the value of <b><i>b</i></b> is 1. It is interesting, what are the minimum and maximum elements in column <b><i>a</i></b> ? <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MIN</span></span>(a), <span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>(a) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> enums; +<span class="hljs-comment"><span class="hljs-comment">--------+--------+ | MIN(a) | MAX(a) | +--------+--------+ | c | b | +--------+--------+ 1 row in set (0.00 sec)</span></span></code> </pre><br><br>  It seems strange, it would be reasonable if the smallest were 'a', and the biggest - 'c'. <br>  And what if you select the minimum and maximum only among those lines where b = 1?  That is, among all the lines? <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MIN</span></span>(a), <span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>(a) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> enums <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> b = <span class="hljs-number"><span class="hljs-number">1</span></span>; +<span class="hljs-comment"><span class="hljs-comment">--------+--------+ | MIN(a) | MAX(a) | +--------+--------+ | a | c | +--------+--------+ 1 row in set (0.00 sec)</span></span></code> </pre><br><br>  This is how we forced MySQL to change its opinion on how to compare fields in ENUM, simply by adding a predicate. <br>  The answer to this behavior is that in the first case MySQL uses an index, and in the second it does not.  This, of course, does not explain why MySQL compares ENUMs differently for sorting in the index, and in the usual comparison. <br><br>  The second example is simpler and more concise: <br><br><pre> <code class="sql hljs">mysql&gt; (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> moo <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; +<span class="hljs-comment"><span class="hljs-comment">------+ | a | +------+ | 1 | | 2 | +------+ 2 rows in set (0.00 sec)</span></span></code> </pre><br><br>  When I showed this query to my colleague who is developing the SQL parser, his question was not ‚Äúwhy this query returns two lines‚Äù, but ‚Äúhow to write the SQL parser so that such a query is valid, without writing a rule specifically permitting such a request. " <br><br>  Interestingly, not every SELECT in brackets will work, in particular, UNION in brackets is a syntax error: <br><br><pre> <code class="sql hljs">mysql&gt; (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> moo <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> ALL <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> hru) <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; ERROR 1064 (42000): You have an error in your SQL syntax; <span class="hljs-keyword"><span class="hljs-keyword">check</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">manual</span></span> that corresponds <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> your MySQL <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">right</span></span> syntax <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> near <span class="hljs-string"><span class="hljs-string">'UNION ALL SELECT * FROM hru) LIMIT 2'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">at</span></span> line <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br><br>  Some more interesting examples under the cut <a name="habracut"></a><br><br>  In general, it is not necessary to go far with an example of strange behavior with UNION and LIMIT: <br><br><pre> <code class="sql hljs">mysql&gt; -&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> moo <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> ALL -&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> hru <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; +<span class="hljs-comment"><span class="hljs-comment">---+ | 1 | +---+ | 1 | +---+ 1 row in set (0.00 sec)</span></span></code> </pre><br><br>  Suddenly, only one row returned, although both tables are not empty.  Because the second LIMIT belongs to the entire request, not just the right side of the UNION. <br><br>  Here we need to talk about such things as the shift-reduce conflict.  In modern open source databases, the parser is often written in bison.  Such a parser is a so-called L1 parser, which means that the parser must understand the purpose of the next token, looking no further than one token ahead.  For example, in the query above, looking at the word LIMIT, the parser cannot understand whether this LIMIT belongs to the second request, or to the whole UNION.  When the rules are written in such a way that situations are possible in which it is impossible to understand the purpose of the token by looking only at the next token, this is called a shift-reduce conflict.  In this case, the parser will choose a solution based on a specific set of rules.  This is very bad, because it leads to the fact that quite normal queries lead to errors.  What if in the previous query I want to make LIMIT to both the second SELECT and UNION? <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> moo -&gt; <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> ALL -&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> hru <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; ERROR 1064 (42000): You have an error in your SQL syntax; <span class="hljs-keyword"><span class="hljs-keyword">check</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">manual</span></span> that corresponds <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> your MySQL <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">right</span></span> syntax <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> near <span class="hljs-string"><span class="hljs-string">'LIMIT 2'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">at</span></span> line <span class="hljs-number"><span class="hljs-number">4</span></span></code> </pre><br><br>  This cannot be done because of the shift-reduce conflict.  Looking at the first LIMIT parser does not yet know that there will be a second ahead, and mistakenly believes that the first limit applies to the entire request. <br>  In PostgreSQL, there is no shift-reduce conflicts at all.  Specifically, this situation is resolved there due to the fact that LIMIT can only be in UNION, but not in the SELECTs that it unites. <br>  In MySQL, there are more than 160 such conflicts. This is amazing, because it means that there are 160 places where the parser may not correctly understand what is wanted of it. <br><br>  A good example of such a conflict is connections.  As you know, MySQL supports CROSS JOINs, which have no predicate, and INNER JOINs, which have a predicate.  Generally speaking, CROSS JOIN and INNER JOIN are two different things, but in MySQL they are synonyms.  That is, INNER JOIN may not have a predicate, while CROSS JOIN may have it.  In particular, this leads to an interesting error: <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> -&gt; moo -&gt; <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> -&gt; hru -&gt; <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> -&gt; baa -&gt; <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> hru.a = baa.a -&gt; <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> moo.a = hru.a -&gt; ; ERROR 1064 (42000): You have an error in your SQL syntax; <span class="hljs-keyword"><span class="hljs-keyword">check</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">manual</span></span> that corresponds <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> your MySQL <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">right</span></span> syntax <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> near <span class="hljs-string"><span class="hljs-string">'ON moo.a = hru.a'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">at</span></span> line <span class="hljs-number"><span class="hljs-number">8</span></span></code> </pre><br><br>  At the moment when the parser sees the first ON, it still does not know that the second is waiting for it in front of it, and faces a choice: either it is ON for hru and baa, or hru and baa are connected without a predicate, and the current ON is ON for moo and the result of the connection of hru and baa.  The parser erroneously chooses the second, which leads to an absolutely unnecessary error in this situation.  If INNER JOIN is replaced with LEFT JOIN, for which the variant without a predicate does not exist, the query will be executed: <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> -&gt; moo -&gt; <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> -&gt; hru -&gt; <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> -&gt; baa -&gt; <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> hru.a = baa.a -&gt; <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> moo.a = hru.a -&gt; ; +<span class="hljs-comment"><span class="hljs-comment">------+------+------+------+ | a | a | b | a | +------+------+------+------+ | 1 | 1 | 1 | 1 | | 2 | 2 | 2 | 2 | +------+------+------+------+ 2 rows in set (0.00 sec)</span></span></code> </pre> <br><br>  The most interesting thing here is that in Bison you need to specify the number of shift-reduce conflicts directly in the code, otherwise the code will not compile.  That is, at some point in time, one of the MySQL programmers made CROSS JOIN and INNER JOIN synonymous, which in itself makes no sense, after which he tried to compile the code, and he did not compile with a compilation error warning that the parser was no longer will be able to parse certain requests.  To which the programmer, instead of doing everything right, found a constant indicating the number of errors in the parser, and incremented it. <br><br>  Although, if we talk about what interesting decisions sometimes programmers in MySQL make, it is best to recall this story: <br>  <a href="http://bugs.mysql.com/bug.php%3Fid%3D27877">http://bugs.mysql.com/bug.php?id=27877</a> <br>  In it, one of the programmers deliberately made in the default collation for utf8 the letter 's' equal to the symbol '√ü'.  This is very ironic, because the only language in which it would even remotely make sense is German, but it is this change that makes this collation completely inapplicable to the German language, because now the lines that are completely different from each other become are equal. <br>  This change was not only useless, it also made the transition process from 5.0 to 5.1 for databases with utf8 strings in German very painful, because the unique indexes suddenly began to contain duplicate elements. <br><br>  Speaking of collations, I still like this example very much: <br><br>  Suppose we have a table with three rows with different collations: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> strings( swedish <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_swedish_ci, spanish <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_spanish_ci, <span class="hljs-keyword"><span class="hljs-keyword">bin</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_bin );</code> </pre><br><br>  Let's execute such request: <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> strings <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> swedish &gt; <span class="hljs-keyword"><span class="hljs-keyword">bin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> swedish &lt; spanish; ERROR 1267 (HY000): Illegal mix of collations (utf8_swedish_ci,IMPLICIT) and (utf8_spanish_ci,IMPLICIT) for operation '&lt;'</code> </pre><br><br>  MySQL reasonably complains that it is impossible to compare swedish and spanish, because it is not clear how to compare them. <br>  Let's write a completely identical query: <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> strings <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> swedish <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> spanish; Empty <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> (<span class="hljs-number"><span class="hljs-number">0.00</span></span> sec)</code> </pre><br><br>  Suddenly, the request became valid, although it still has to compare the swedish and spanish string.  And if I want the opposite? <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> strings <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> swedish <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> spanish <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>; ERROR 1270 (HY000): Illegal mix of collations (utf8_swedish_ci,IMPLICIT), (utf8_spanish_ci,IMPLICIT), (utf8_bin,IMPLICIT) for operation 'between'</code> </pre><br><br>  And vice versa is impossible. <br>  If you delve into the code, you can understand that in MySQL BETWEEN is implemented in a completely strange way: if the first or second paramert have binary collation, then all strings will be compared as binary, and collation will be ignored.  But if the third argument has a binary collation, then the same logic does not apply. <br><br>  Speaking of how strangely the functions work in MySQL, let's finish this article with the most beautiful example. <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LEAST</span></span>(<span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>); +<span class="hljs-comment"><span class="hljs-comment">--------------+ | LEAST(9, 11) | +--------------+ | 9 | +--------------+ 1 row in set (0.00 sec)</span></span></code> </pre><br><br>  There are no surprises <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LEAST</span></span>(<span class="hljs-string"><span class="hljs-string">"9"</span></span>, <span class="hljs-string"><span class="hljs-string">"11"</span></span>); +<span class="hljs-comment"><span class="hljs-comment">------------------+ | LEAST("9", "11") | +------------------+ | 11 | +------------------+ 1 row in set (0.00 sec)</span></span></code> </pre><br><br>  This is also reasonable, line 11 is less than 9. What if 11 are added to 11? <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LEAST</span></span>(<span class="hljs-string"><span class="hljs-string">"9"</span></span>, <span class="hljs-string"><span class="hljs-string">"11"</span></span>) + <span class="hljs-keyword"><span class="hljs-keyword">LEAST</span></span>(<span class="hljs-string"><span class="hljs-string">"9"</span></span>, <span class="hljs-string"><span class="hljs-string">"11"</span></span>); +<span class="hljs-comment"><span class="hljs-comment">-------------------------------------+ | LEAST("9", "11") + LEAST("9", "11") | +-------------------------------------+ | 18 | +-------------------------------------+ 1 row in set (0.00 sec)</span></span></code> </pre><br><br>  Of course, 18. It turns out, the function returns a different value depending on the context!  Is it possible to force the same LEAST to return three different values ‚Äã‚Äãdepending on the context?  Turns out yes <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LEAST</span></span>(<span class="hljs-string"><span class="hljs-string">"9e1"</span></span>, <span class="hljs-string"><span class="hljs-string">"110"</span></span>); +<span class="hljs-comment"><span class="hljs-comment">---------------------+ | LEAST("9e1", "110") | +---------------------+ | 110 | +---------------------+ 1 row in set (0.00 sec) mysql&gt; SELECT LEAST("9e1", "110") + 0; +-------------------------+ | LEAST("9e1", "110") + 0 | +-------------------------+ | 90 | +-------------------------+ 1 row in set (0.00 sec) mysql&gt; SELECT LEAST("9e1", "110") &amp; -1; +--------------------------+ | LEAST("9e1", "110") &amp; -1 | +--------------------------+ | 9 | +--------------------------+ 1 row in set, 1 warning (0.00 sec) mysql&gt; SHOW WARNINGS; +---------+------+------------------------------------------+ | Level | Code | Message | +---------+------+------------------------------------------+ | Warning | 1292 | Truncated incorrect INTEGER value: '9e1' | +---------+------+------------------------------------------+ 1 row in set (0.00 sec)</span></span></code> </pre><br><br>  Although here it must be said that in one case we met a warning.  But we still managed to force the same operator with the same arguments to return three different values. <br><br>  To make an even more amazing discovery, you need to get acquainted with the function NULLIF.  This function takes two arguments, and returns NULL if they are equal, or the value of the first argument if they are not equal.  Putting aside the question of why such a function exists at all, let's look at the result of the following two queries: <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULLIF</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">LEAST</span></span>(<span class="hljs-string"><span class="hljs-string">"9"</span></span>, <span class="hljs-string"><span class="hljs-string">"11"</span></span>), <span class="hljs-string"><span class="hljs-string">"11"</span></span>) + <span class="hljs-number"><span class="hljs-number">0</span></span>; +<span class="hljs-comment"><span class="hljs-comment">------------------------------------+ | NULLIF(LEAST("9", "11"), "11") + 0 | +------------------------------------+ | NULL | +------------------------------------+ 1 row in set (0.00 sec) mysql&gt; SELECT NULLIF(LEAST("9", "11"), "12") + 0; +------------------------------------+ | NULLIF(LEAST("9", "11"), "12") + 0 | +------------------------------------+ | 9 | +------------------------------------+ 1 row in set (0.00 sec)</span></span></code> </pre><br><br>  In the first case, we got NULL, which means that LEAST is really equal to the string "11".  In the second case, in the same query, with the same types of arguments, but with a different constant in NULLIF, we got the value 9!  That is, with exactly the same types of parameters, in the first case LEAST returned ‚Äú11‚Äù, and in the second - 9. <br>  But you can do even better: <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULLIF</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">LEAST</span></span>(<span class="hljs-string"><span class="hljs-string">"9"</span></span>, <span class="hljs-string"><span class="hljs-string">"11"</span></span>), <span class="hljs-string"><span class="hljs-string">"9"</span></span>) + <span class="hljs-number"><span class="hljs-number">0</span></span>; +<span class="hljs-comment"><span class="hljs-comment">-----------------------------------+ | NULLIF(LEAST("9", "11"), "9") + 0 | +-----------------------------------+ | 9 | +-----------------------------------+ 1 row in set (0.00 sec)</span></span></code> </pre><br><br>  In this query, LEAST returned something different from the string "9" (otherwise NULLIF would return NULL), but it returned the string "9" at the same time! <br>  If you look at the code, then this is really what happens.  LEAST is performed twice, the first time comparing the parameters as strings, and the second time as integers. </div><p>Source: <a href="https://habr.com/ru/post/246339/">https://habr.com/ru/post/246339/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../246315/index.html">TeamCity 9.0: import projects, settings in VCS, background cleaning and pandas</a></li>
<li><a href="../246317/index.html">Processing NBA data for 30 years using MongoDB Aggregation</a></li>
<li><a href="../246325/index.html">Overview of graph compression algorithms</a></li>
<li><a href="../246329/index.html">New Year's draw</a></li>
<li><a href="../246331/index.html">Expressive JavaScript: Project: Experience Sharing Website</a></li>
<li><a href="../246341/index.html">IPv6, miredo, dynamic DNS AAAA</a></li>
<li><a href="../246349/index.html">Yeoman for newbies</a></li>
<li><a href="../246351/index.html">Universal messaging between pages in extensions</a></li>
<li><a href="../246353/index.html">Implementation via URL: www.site.ru/?jn=xxxxxxxx</a></li>
<li><a href="../246355/index.html">Skype for Android is not working! How did I handle this?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>