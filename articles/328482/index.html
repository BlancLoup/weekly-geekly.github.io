<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using C ++ Modules in Visual Studio 2017</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What's new? 
 The Visual C ++ team is pleased to announce that in Visual Studio 2017, the quality of the implementation of C ++ modules has been signi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using C ++ Modules in Visual Studio 2017</h1><div class="post__text post__text-html js-mediator-article"><h2>  What's new? </h2><br>  The Visual C ++ team is pleased to announce that in Visual Studio 2017, the quality of the implementation <a href="https://blogs.msdn.microsoft.com/vcblog/2015/12/03/c-modules-in-vs-2015-update-1/">of C ++ modules has</a> been significantly improved <a href="https://blogs.msdn.microsoft.com/vcblog/2015/12/03/c-modules-in-vs-2015-update-1/">according to the technical specifications</a> ;  We also added the ability to connect the <a href="https://blogs.msdn.microsoft.com/vcblog/2017/05/05/cpp-modules-in-visual-studio-2017/">Standard C ++ Library through module interfaces</a> .  These interfaces, like the support of the modules by the compiler, are experimental designs and will be developed in accordance with the standardization process. <br><a name="habracut"></a><br><h2>  Beginning of work </h2><br>  Standard Library module support is implemented in Visual Studio since version 2017 RTM.  This feature is currently optional and disabled by default.  In future versions, the modules will be installed automatically along with the headers of the Standard Library.  You only need to select this option when installing or upgrading C ++ support. <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/78a/21f/e81/78a21fe8113754973691f90207d71e1e.png" alt="Picture 5"></p><br><br>  If you have already installed VS 2017, but have not installed the modules, this is easy to fix.  Just run the installer again and select the appropriate components. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p><img src="https://habrastorage.org/getpro/habr/post_images/44b/fdf/e5a/44bfdfe5ad1d5567e8af2c986a4bf8eb.png" alt="Picture 23"></p><br><h2>  Verification of installation </h2><br>  To check if your copy of VS 2017 is configured to support modules, compile and run the program below (name it, for example, <i>test-vs2017-slm.cxx</i> ) from the developer‚Äôs command line.  Since the modules are currently an experimental function, their support is still very poorly implemented in the VS environment. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.core; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; v { <span class="hljs-string"><span class="hljs-string">"Plato"</span></span>, <span class="hljs-string"><span class="hljs-string">"Descartes"</span></span>, <span class="hljs-string"><span class="hljs-string">"Bacon"</span></span> }; copy(v.begin(), v.end(), ostream_iterator&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;(<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span>, <span class="hljs-string"><span class="hljs-string">"\n"</span></span>)); }</code> </pre> <br>  When compiling this code with the command <br><br><pre> <code class="cpp hljs">cl /experimental:<span class="hljs-keyword"><span class="hljs-keyword">module</span></span> /EHsc /MD /<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>:c++latest test-vs2017-slm.cxx</code> </pre> <br>  the output should be an executable file ( <i>test-vs2017-slm.exe</i> ), which at startup prints the words "Plato", "Descartes" and "Bacon" - each in a separate line. <br><br><h2>  Compiler key for connecting Standard Library modules </h2><br>  You need to add the <i>/ MD</i> switch when compiling the source file to connect the Standard Library modules.  <a href="https://docs.microsoft.com/en-us/cpp/c-runtime-library/crt-library-features">The / MD key initializes the C runtime dynamic library (CRT)</a> .  In debug mode, use the <i>/ MDd switch</i> . <br><br>  If you forgot to specify the <i>/ MD</i> key (or <i>/ MDd</i> in debug mode), the linker will issue a series of warnings and an <a href="https://docs.microsoft.com/en-us/cpp/error-messages/tool-errors/linker-tools-error-lnk2019">LNK2019</a> link <a href="https://docs.microsoft.com/en-us/cpp/error-messages/tool-errors/linker-tools-error-lnk2019">error</a> , indicating that there are unresolved external characters. <br><br>  No other keys are required to use the Standard Library modules.  These modules can only be used for use with the Universal CRT Library (UCRT) DLL import libraries. <br><br><h2>  Connecting Standard Library modules from VS development environment </h2><br>  If you want to use the development environment instead of the command line, configure your project to use the experimental modules according to the following instructions. <br><br>  1. Open the project Properties window: <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/080/adc/9cf/080adc9cfcbf5270db1f9a9f6cd44c13.png" alt="Picture 10"></p><br>  2. Go to the ‚ÄúConfiguration Properties‚Äù -&gt; C / C ++ -&gt; ‚ÄúCode Generation‚Äù section and make sure that you have selected the Multithreaded Debug DLL or Multithreaded DLL library (for debug and release modes, respectively) .  These libraries are selected by default for new projects, so if you didn‚Äôt change anything, no problems should arise. <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/df1/c5a/326/df1c5a3266f2a2a7f4f67c2acbe7fa2f.png" alt="Picture 22"></p><br>  3. Go to the ‚ÄúConfiguration Properties‚Äù section -&gt; C / C ++ -&gt; ‚ÄúLanguage‚Äù and make sure that support for the C ++ 17 standard is enabled.  If this is not the case, select from the drop-down list the C ++ 17 standard or the latest C ++ standard project (C ++ Latest Draft Standard) for the configurations you plan to use. <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/2de/ee8/184/2deee818459afc0ab5959f82a18caafe.png" alt="Picture 15"></p><br>  4. Enter the command <i>/ experimental: module / module: stdIfcDir "$ (VCToolsInstallDir_150) ifc \ $ (PlatformTarget)</i> " in the section "Configuration Properties‚Äù -&gt; C / C ++ -&gt; ‚ÄúCommand Line‚Äù (Command Line), to enable module support for the current project.  Please note that this step will be abolished in future versions of VS 2017: the environment itself will indicate the location of the module files (specified by the <i>/ module</i> parameter <i>: stdIfcDir</i> ) when the C ++ modules support option is enabled. <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a6e/be4/d24/a6ebe4d2465ecc53ec8ae551c21f1e47.png" alt="Picture 17"></p><br><br>  After these actions, the build and launch of the test program should be successful - the program will print the names of the three philosophers. <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0a0/fa4/b28/0a0fa4b28a6fc34f57449d99f1e1e381.png" alt="Picture 20"></p><br><h2>  Modifying module export syntax </h2><br>  At the congress of the C ++ Standardization Committee in November 2016, it was decided to change the syntax of the export of modules (see <a href="http://www.open-std.org/JTC1/SC22/WG21/docs/papers/2016/p0500r0.pdf">Module Problem N1</a> ). <br><br>  It was: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">module</span></span> Bank;</code> </pre> <br>  It became: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Bank;</code> </pre> <br>  The current version of Visual C ++ takes into account this change, but also allows using the old syntax, warning about the transition to the obsolete version.  The C ++ committee is considering the possibility of assigning the old syntax a new value that is incompatible with the old one.  We encourage you to use the new syntax;  support for the old syntax will be discontinued in order to comply with the draft technical specification for the modules according to the ISO C ++ committee amendments. <br><br><h2>  Modules of the Standard Library (experimental function) </h2><br>  A key innovation in the VS2017 RTM version is support for connecting the Standard C ++ Library through modules.  This is an experimental tool, described in the C ++ proposal for <a href="http://www.open-std.org/JTC1/SC22/WG21/docs/papers/2017/p0581r0.pdf">Standard Library Modules</a> .  In the current version, the modules are organized as follows: <br><br><ul><li>  <i>std.regex</i> provides access to the contents of the <i>&lt;regex&gt;</i> header </li><li>  <i>std.filesystem</i> provides access to the contents of the header <i>&lt;experimental / filesystem&gt;</i> </li><li>  <i>std.memory</i> provides access to the contents of the <i>&lt;memory&gt;</i> header </li><li>  <i>std.threading</i> provides access to the contents of the headers <i>&lt;atomic&gt;, &lt;condition_variable&gt;, &lt;future&gt;, &lt;mutex&gt;, &lt;shared_mutex&gt;, &lt;thread&gt;</i> </li><li>  <i>std.core</i> provides access to the other contents of the Standard C ++ Library </li></ul><br>  To use these modules in your program, simply type in the top level of the source file the <i>import M</i> instruction, where <i>M</i> is the name of the module from the list above.  See <a href="https://blogs.msdn.microsoft.com/vcblog/2017/05/05/cpp-modules-in-visual-studio-2017/">test example</a> . <br><br>  If you want to use modules to include non-Standard Library headers, you can generate Standard Library modules using the <i>/ module: name</i> keys (see the <a href="https://blogs.msdn.microsoft.com/vcblog/2015/12/03/c-modules-in-vs-2015-update-1/">original note on C ++ modules</a> ) and <i>/ module: export</i> .  If your project depends on other libraries and you want to try to collect code without any headers at all, you can pack headers from such libraries in the same way. <br><br>  The new versions of VS will be more consistent with the proposal for modules of the Standard Library. <br><br><h2>  Call to action </h2><br>  Download Visual Studio 2017 and try out the modules with your C ++ projects and programs.  For starters, you can simply replace all <i>#include</i> standard headers for containers and algorithms with <i>import std.core</i> in the source files and add the <i>/ experimental:</i> compilation keys <i>: module</i> and <i>/ MD</i> or <i>/ MDd</i> (in debug mode) to the build definition.  Tell us about the results. <br><br><h2>  Finally </h2><br>  As always, we welcome your feedback.  <a href="">Send</a> your comments to <a href="">visualcpp@microsoft.com</a> or <a href="">post</a> on Twitter <a href="https://twitter.com/visualc">@visualc</a> or on the <a href="https://www.facebook.com/Microsoft-Visual-Cpp-222043184527264/">Microsoft Visual Cpp</a> Facebook page. <br><br>  Other issues related to using the MSVC environment in VS 2017 can be reported using the <a href="https://docs.microsoft.com/en-us/visualstudio/ide/how-to-report-a-problem-with-visual-studio-2017">Report a Problem</a> feature from the installer or from Visual Studio itself.  Leave your suggestions on the <a href="https://visualstudio.uservoice.com/forums/121579-visual-studio-2015/category/30937-languages-c">UserVoice</a> website.  Thank! </div><p>Source: <a href="https://habr.com/ru/post/328482/">https://habr.com/ru/post/328482/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328468/index.html">A selection of pieces based on artificial intelligence for personal use (1/3)</a></li>
<li><a href="../328472/index.html">Which map is faster, and is there an alternative to Judy</a></li>
<li><a href="../328474/index.html">DNA Security - Security built into the network infrastructure</a></li>
<li><a href="../328476/index.html">Hi, SaaS | Automate startup marketing?</a></li>
<li><a href="../328478/index.html">Add to Chromium selector: focus-within</a></li>
<li><a href="../328484/index.html">Datacenter performance in your pocket</a></li>
<li><a href="../328486/index.html">Ansible and telnet: when you can not, but really want</a></li>
<li><a href="../328490/index.html">How to remove your IP from the black list of Gmail</a></li>
<li><a href="../328492/index.html">How not to mess with the design. Instructions for dummies for 5 minutes</a></li>
<li><a href="../328494/index.html">Optical novelties from Ubiquiti</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>