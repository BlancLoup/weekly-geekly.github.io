<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to design and write a full program</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=""Instructions for creating a functional application", part 1. 

 ‚ÄúIt seems to me that I understand functional programming at a basic level, and I even...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to design and write a full program</h1><div class="post__text post__text-html js-mediator-article">  <em>"Instructions for creating a functional application", part 1.</em> <br><br>  <b>‚ÄúIt seems to me that I understand functional programming at a basic level, and I even wrote simple programs, but how can I create a full-fledged application, with real data, error handling, and so on?‚Äù</b> <br><br>  This is a very common question, so I decided that in this series of articles I will describe the instruction covering design, validation, error handling, persistence, dependency management, code organization, and so on. <br><a name="habracut"></a><br>  First, a few comments and cautions: <br><ul><li>  I will describe only one script, and not the entire application.  I hope it will be obvious how to extend the code if necessary. <br></li><li>  This is intentionally a very simple instruction without special tricks and advanced technology, focused on in-line data processing.  But if you are a beginner, I think it will be useful for you to have a sequence of simple steps that you can repeat and get the expected result.  I do not claim that this is the only sure way.  Different scenarios will require different approaches, and of course with the growth of your own expertise you may find that this instruction is too simple and limited. <br></li><li>  To facilitate the transition from object-oriented design, I will try to use familiar concepts such as ‚Äútemplates‚Äù, ‚Äúservices‚Äù, ‚Äúdependency injection‚Äù, etc., as well as explain how they relate to the functional approach. <br></li><li>  The instruction is also intentionally made to some extent imperative, i.e.  an explicit step-by-step process is used.  I hope this approach will ease the transition from OOP to FP. <br></li><li>  For simplicity (and the ability to use F # script), I will install a stub on the entire infrastructure and shy away from interacting with the UI directly. <br></li></ul><br><h2>  Overview </h2><br>  An overview of what I plan to describe in this series of articles: <br><ul><li>  <b>Script conversion to function.</b>  In the first article, we will look at a simple script and see how it can be implemented using a functional approach. <br></li><li>  <a href="http://fsharpforfunandprofit.com/posts/recipe-part2/"><b>Combining small functions.</b></a>  In the next article, we will discuss a simple metaphor about combining small functions into larger ones. <br></li><li>  <b>Designing using types and error types.</b>  In the third article, we will create the types necessary for the script and discuss special types for error handling. <br></li><li>  <b>Configure and manage dependencies.</b>  In this article we will talk about how to link all the functions. <br></li><li>  <b>Validation.</b>  In this article, we will discuss various ways to implement checks and transform from a dangerous outside world into a warm, fluffy world of type safety. <br></li><li>  <b>Infrastructure.</b>  In this article, we will discuss the various components of the infrastructure, such as logging, working with external code, etc. <br></li><li>  <b>Item Level</b>  In this article, we will discuss how subject-oriented design works in a functional world. <br></li><li>  <b>Presentation level</b>  In this article we will discuss how to display the results and errors in the UI. <br></li><li>  <b>Work with changing requirements.</b>  In this article we will discuss what to do with changing requirements and how they affect the code. <br></li></ul><br><h2>  Let's get started </h2><br>  Let's take a very simple example, namely, updating some customer information through a web service. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And so, our basic requirements are: <br><ul><li>  The user sends some data (user ID, name and mailbox address). <br></li><li>  We check the correctness of the name and address of the box. <br></li><li>  The name and address of the mailbox is updated in the database in the corresponding user record. <br></li><li>  If the mailbox address is changed, send a verification letter to this address. <br></li><li>  We display the result of the operation to the user. <br></li></ul><br>  This is a common data processing script.  Here there is a specific request that runs the script, after which the data from the request "flow" through the system, being processed at each step.  I use this script as an example because it is distributed in corporate software. <br><br>  Here is a diagram of the process components: <br><img src="https://habrastorage.org/getpro/habr/post_images/1fb/01c/877/1fb01c87762c6cb06b43a08caa660e24.png"><br><br>  But this description is only a successful version of events.  Reality is never so simple!  What happens if the user ID is not found in the database, or the mailing address is incorrect, or is there an error in the database? <br><br>  Let's change the diagram and mark everything that could go wrong. <br><img src="https://habrastorage.org/getpro/habr/post_images/7fd/7f1/0da/7fd7f10da0f103a65c603336c8683dd4.png"><br><br>  As you can see, at each step of the script errors may occur for various reasons.  One of the goals of the series of these articles is to explain how to manage errors elegantly. <br><br><h2>  Functional thinking </h2><br>  Now that we have understood the stages of our scenario, how to implement it with the help of the functional approach? <br><br>  First we turn to the differences between the original scenario and functional thinking. <br><br>  In a script, we usually mean a request-response model.  The request is sent, the answer comes back.  If something went wrong, then the flow of actions is completed and the answer comes "ahead of time" (note of the translator: It is solely about the process, not about the time spent.). <br><br>  What I mean, you can see in the diagram of a simplified version of the script. <br><img src="https://habrastorage.org/getpro/habr/post_images/542/6e0/75c/5426e075c69f53532662c1328817fb19.png"><br><br>  But in the functional model, the function is a black box with input and output, like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/64c/ebb/a92/64cebba928a0375c47a44c10b1617c15.png"><br><br>  How can we adapt our script to such a model? <br><br><h3>  Unidirectional flow </h3><br>  First, you need to realize that the functional data flow is only forward.  You cannot return "ahead of time". <br><br>  In our case, this means that all errors must be transmitted before the end of the script along an alternative path. <br><img src="https://habrastorage.org/getpro/habr/post_images/706/352/855/706352855be435766365da0e1593264b.png"><br><br>  As soon as we do this, we will have the opportunity to turn the entire stream into a single function ‚Äî the black box: <br><img src="https://habrastorage.org/getpro/habr/post_images/525/4e0/39d/5254e039d3572f3361c36be9916448d5.png"><br><br>  Of course, if you look inside this large function, you will find that it is made from (‚Äúis composition‚Äù in terms of functional methodology) smaller functions, one for each stage of the scenario, connected in series. <br><img src="https://habrastorage.org/getpro/habr/post_images/6c4/814/cf6/6c4814cf602b02cad65bf3c57813e41a.png"><br><br><h3>  Error management </h3><br>  The last diagram shows one successful exit and three exits for errors.  This is a problem, since functions can only have one output, not four! <br><br>  What can we do about it? <br><br>  The answer is to use the <a href="https://msdn.microsoft.com/ru-ru/library/dd233226(v%3Dvs.120).aspx">Merge</a> type, where each option represents one of the possible exits.  Then the function will actually have only one way out. <br><br>  Here is an example of a possible type definition for outputting a result: <br><pre><code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UseCaseResult</span></span></span><span class="hljs-class"> </span></span>=    | <span class="hljs-type"><span class="hljs-type">Success</span></span>    | <span class="hljs-type"><span class="hljs-type">ValidationError</span></span>    | <span class="hljs-type"><span class="hljs-type">UpdateError</span></span>    | <span class="hljs-type"><span class="hljs-type">SmtpError</span></span></code> </pre> <br>  And here is a reworked chart showing a single exit with four different options included in it: <br><img src="https://habrastorage.org/getpro/habr/post_images/327/ec2/f19/327ec2f1949b2d982135167b3c0abafd.png"><br><br><h3>  Simplify Error Management </h3><br>  This solves the problem, but the presence of an error for each step is a fragile and poorly reusable design.  Can we do better? <br><br>  Yes!  We really only need two methods.  One for a successful case and another for all erroneous: <br><pre> <code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UseCaseResult</span></span></span><span class="hljs-class"> </span></span>=   | <span class="hljs-type"><span class="hljs-type">Success</span></span>   | <span class="hljs-type"><span class="hljs-type">Failure</span></span></code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/68e/b19/6cc/68eb196cc1c800eda6dcd3a7a0c9063e.png"><br><br>  This type is very versatile and will work with any process!  Actually, you will soon see that to work with this type we can make a good library of useful functions, which is suitable for any scripts. <br><br>  One more thing - as a result, which the function returns, there is no data at all, only the status of success / failure.  We need to correct something so that the result of the function contains the actual successful or failed object.  We will declare successful and failed types as <a href="https://msdn.microsoft.com/ru-ru/library/dd233215.aspx">generic</a> (using type parameters). <br><br>  Finally, our final, universal version: <br><pre> <code class="hljs vhdl"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Result&lt;<span class="hljs-symbol"><span class="hljs-symbol">'TSuccess</span></span>,<span class="hljs-symbol"><span class="hljs-symbol">'TFailure</span></span>&gt; =   | Success <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'TSuccess</span></span>   | <span class="hljs-literal"><span class="hljs-literal">Failure</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'TFailure</span></span></code> </pre> <br>  In fact, in the F # library there is already a similar type.  It is called <a href="https://msdn.microsoft.com/ru-ru/library/ee353439.aspx">Choice</a> .  For clarity, I will continue to use the Result type created earlier in this and subsequent articles.  We will return to this issue when we come to more serious problems. <br><br>  Now, once again looking at the scenario with separate steps, we will see that we must combine the errors of each step into a single ‚Äúfailed‚Äù path. <br><img src="https://habrastorage.org/getpro/habr/post_images/481/411/085/4814110856670954b6c371745954296b.png"><br><br>  How to do this is the topic of the next article. <br><br><h2>  Summary and guidelines </h2><br>  So, we have the following provisions to the instructions: <br><br>  <em>Methodical instructions</em> <br><ul><li>  Each script is equivalent to an elementary function. <br></li><li>  The return type of the scenario function is a <a href="https://msdn.microsoft.com/ru-ru/library/dd233226(v%3Dvs.120).aspx">combination</a> with two options: Success and Failure. <br></li><li>  A scenario function is built from a series of small functions that represent individual steps in a data stream. <br></li><li>  Errors of all stages are combined into a single path of errors. <br></li></ul></div><p>Source: <a href="https://habr.com/ru/post/263035/">https://habr.com/ru/post/263035/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263021/index.html">Reflection in Cach√©</a></li>
<li><a href="../263025/index.html">Pro model, logic, OOP, development and the rest</a></li>
<li><a href="../263027/index.html">The principle of separation of responsibility and ORM</a></li>
<li><a href="../263031/index.html">How to make the browser cache not as useless as usual</a></li>
<li><a href="../263033/index.html">Forget about DAO, use the Repository</a></li>
<li><a href="../263041/index.html">$ mol_time - working with dates and time correctly</a></li>
<li><a href="../263043/index.html">Open Source Virtualization: Report on Innovations and Approaches to Virtualization of Corporate Infrastructure</a></li>
<li><a href="../263045/index.html">What did antivirus think about in the past?</a></li>
<li><a href="../263047/index.html">A selection of current and useful materials on Ruby # 1: articles, reports, podcasts, gems</a></li>
<li><a href="../263051/index.html">Federal Business Intensive Development Program GenerationS has selected IBM Cloud to create an online platform</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>