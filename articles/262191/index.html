<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Teach Hyper-V Server with Veeam B & R to backup yourself</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Veeam's slogan is ‚ÄúIt Just Works!‚Äù. And it is. But not quite: when using Backup & Replication on the Hyper-V Server (the one that is free), you can on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Teach Hyper-V Server with Veeam B & R to backup yourself</h1><div class="post__text post__text-html js-mediator-article">  Veeam's slogan is ‚ÄúIt Just Works!‚Äù.  And it is.  But not quite: when using Backup &amp; Replication on the Hyper-V Server (the one that is free), you can only work on-host / off-host.  When you start the management console, the system swears at the absence of registered classes. <br><br><img src="https://habrastorage.org/files/a07/5dc/c8e/a075dcc8e0fd4d70976bfa6bcdd08774.png" alt="image"><br><br>  On the Veeam forum, every 10 posts about launching on Hyper-V Server, the answer is always the same - use as an off-host, i.e.  Connect to the server from another full machine. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It haunted me for several months.  Why keep another VM or load an existing VM with unnecessary services?  And if I don't have a VM on Windows, what then? <br><br>  Those who share my thoughts, please under the cat.  There, I‚Äôll tell you how to get Hyper-V to back up your VMs yourself using a PowerShell script. <br><a name="habracut"></a><br>  The entire configuration process is divided into 3 stages: <br>  1) Installing Veeam B &amp; R v8 FREE and the current patch on Hyper-V Server, adding host <br>  2) Register Snap (Snapin) <br>  3) Editing the backup script for yourself and working with the Windows scheduler <br><br><h3>  Correct installation </h3><br>  The Veeam B &amp; R installation is standard, without any special moments.  <a href="http://www.veeam.com/virtual-machine-backup-solution-free.html">Download</a> , run, mark all components for installation.  After that we put the services of integration and transport.  By default, they are located in <i>c: \ Program Files \ Veeam \ Backup and Replication \ Backup \ Packages \</i> . <br><br>  Next - the <a href="http://www.veeam.com/kb2024">current patch</a> (at the time of writing - 2b).  And here are 2 pitfalls.  Firstly, the patch is just not put, swears on active tasks, etc.  And secondly, after its installation, it is MANDATORY to start the console, from which Component Updater will start, which will continue the update.  If you just install the patch, when you run the script, you will be prompted to update the integration components and terminate the task. <br><br>  So, the sequence of actions when updating: <br><br>  1) Connect to the Hyper-V Server ‚ÄúServices‚Äù from another machine with the corresponding rights, set all Veeam services to the ‚ÄúDisabled‚Äù launch type.  Of course, you can stop the service and other methods, use the one that is closer to you. <br>  2) Reboot the server. <br>  3) Download the patch to the server, open the command line and install the patch in Unattended mode ( <a href="http://helpcenter.veeam.com/backup/80/vsphere/update2_unattended.html">here you can read more</a> ): <br><br>  Unpacking the patch and installing. <br><br>  In my case, the command looks like this: <br><br><pre><code class="hljs tex">C:<span class="hljs-tag"><span class="hljs-tag">\</span></span>2b.exe /q /c /t:C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Temp</span></span></span></span> C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Temp</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HotFixRunner</span></span></span></span>.exe noreboot log C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Logs</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">veeam</span></span></span></span>.log VBR_AUTO_UPGRADE=1</code> </pre> <br>  General view of the commands: <br><br><pre> <code class="hljs perl">%PatchFullPath% <span class="hljs-regexp"><span class="hljs-regexp">/q /c</span></span> /t:%TempFolderPath% %PathToHotFixRunner.exe% silent noreboot <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> %PathToLogFile% VBR_AUTO_UPGRADE=<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  I do not advise using the <i>silent</i> key, it will save you from a long reading of the logs. <br><br>  The components will be automatically updated the next time you start the Veeam Backup Service. <br><br>  4) In "Services", we set the launch type "Automatic" to all Veeam services and DO NOT START. <br>  5) Reboot the server. <br>  6) Make the addition of the host machine, i.e.  myself. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">add</span></span>-vbrhvhost -<span class="hljs-type"><span class="hljs-type">name</span></span> "*server_name*" -<span class="hljs-keyword"><span class="hljs-keyword">user</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">DOMAIN</span></span>\account* -<span class="hljs-keyword"><span class="hljs-keyword">password</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">password</span></span>*</code> </pre> <br>  The arguments are intuitive. <br>  7) We check that the addition has passed normally. <br><br><pre> <code class="hljs swift"><span class="hljs-built_in"><span class="hljs-built_in">find</span></span>-vbrhventity -server <span class="hljs-string"><span class="hljs-string">"*server_name*"</span></span></code> </pre> <br>  In response, we get a list of VMs on this server. <br><br>  Done, go further. <br><br><h3>  Registering a Veeam PSSnapin snap-in </h3><br>  As luck would have it, a snap-in to manage from PowerShell is not registered in the system itself, it needs to be done manually: <br>  1) We check, suddenly I'm wrong and the tooling works. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-pssnapin ‚Äìregistered</code> </pre> <br>  <i>Note dated 12/09/2015: when installing Update 3, snap-ins are registered automatically.</i> <br>  2) No, it does not work.  Begin the registration process. <br>  Connect the installutil cmdlet: <br><br><pre> <code class="hljs tex">set-alias installutil <span class="hljs-formula"><span class="hljs-formula">$env:windir</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">Microsoft</span></span></span></span></span><span class="hljs-formula">.NET</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">Framework</span></span></span></span></span><span class="hljs-formula">64</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">v</span></span></span></span></span><span class="hljs-formula">4.0.30319</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">installutil</span></span></span></span></span><span class="hljs-formula">.exe</span></span></code> </pre> <br>  Registering a snap: <br><br><pre> <code class="hljs tex">installutil "c:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Program</span></span></span></span> Files<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Veeam</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Backup</span></span></span></span> and Replication<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Backup</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Veeam</span></span></span></span>.Backup.PowerShell.dll"</code> </pre> <br>  In this example, the path to the default snap-in.  Please note that the snap-in is 64-bit, therefore <u>Framework64</u> . <br>  3) Check the registration. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-pssnapin ‚Äìregistered</code> </pre> <br>  All is well, now you can go to the script. <br><br><h3>  Script and Scheduler </h3><br>  The script already flashed in the previous <a href="http://habrahabr.ru/post/261573/">topic about Veeam</a> , though in the comments and without a description. <br>  <a href="http://www.veeam.com/blog/veeam-backup-free-edition-now-with-powershell.html">Here you can read</a> who wrote it and how to use it, as well as <a href="">download</a> . <br><br>  Edit the script for yourself and configure the Windows scheduler.  The task is trivial and does not require a description. <br>  I note only that the script is extremely convenient, the message in the mail falls very informative. <br><br>  The task of VM backup using Hyper-V server has been solved.  Perhaps, this approach may seem meaningless to someone, but for me personally it was a matter of principle.  For this, allow me to bow out. </div><p>Source: <a href="https://habr.com/ru/post/262191/">https://habr.com/ru/post/262191/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262181/index.html">Using potential fields in real-time strategy scenarios</a></li>
<li><a href="../262183/index.html">React on ES6 +</a></li>
<li><a href="../262185/index.html">The history of routing in the project MAPS.ME</a></li>
<li><a href="../262187/index.html">Creating a new field type for MS SharePoint using the example of a simple check field</a></li>
<li><a href="../262189/index.html">Malevich</a></li>
<li><a href="../262195/index.html">Multiboot in wysiwyg editor</a></li>
<li><a href="../262207/index.html">Telnet and echo - who is right, who is wrong</a></li>
<li><a href="../262211/index.html">Deploying Qt Applications on Windows</a></li>
<li><a href="../262213/index.html">Analysis of tonality in social media in Russian using the RussianSentimentAnalyzer API</a></li>
<li><a href="../262221/index.html">Customize the build of a Flex 4.14 project using flexmojos 7. *</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>