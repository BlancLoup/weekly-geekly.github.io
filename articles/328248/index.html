<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write a script to synchronize folders with Google Drive, plus learn to use the Google Drive API</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, we will look at the basic tools for working with the Google Drive REST API, implement the "direct" and "reverse" synchronization of a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write a script to synchronize folders with Google Drive, plus learn to use the Google Drive API</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/3c2/3cd/794/3c23cd794b1c49198fee926f1e330a7b.jpg" width="60%" height="60%"></div><br><p>  In this article, we will look at the basic tools for working with the Google Drive REST API, implement the "direct" and "reverse" synchronization of a folder on a computer with a folder in the Google Cloud Cloud, and at the same time find out what difficulties may arise when working with Google Docs via the Disk API and how import and export them correctly so that (almost) no one is hurt. </p><a name="habracut"></a><br><h2 id="liricheskoe-vstuplenie">  Lyrical introduction </h2><br><p>  One day, when I woke up early in the morning, I suddenly discovered a lack of productivity (and automation) in everyday life.  The first "under the knife optimization" hit the working folder with useful books, projects, documents and funny pictures of cats.  Usually, all my stormy activities take place at my home computer, but sometimes it is necessary to act outside the limits of a cozy room, and I want everything familiar to be at hand, including current projects.  In such cases, flash drives come to the rescue, but this is the last century and not stylish, I want everything to be reliably available from any cloud (if you have internet access, of course).  As an example of such a cloud in this case will be Google Disk. </p><br><p>  But since changes occur every day, something is added, something flies into the basket, and there is no desire to follow it manually, synchronization must be set up.  On Windows and MacOS there is a special software approximately for such purposes.  I spend most of my time on Ubuntu, and there is no official Linux client and is not expected.  And in general it does not seem very convenient.  I would like to have a universal method for solving this problem, preferably cross-platform, without throwing all the files into a special folder.  The search for ready-made solutions did not lead to anything, not one option suited me completely.  I decided that it would be best to write a script in Python myself and hang it up to cron (or run it myself and manually).  In addition, there was no tutorial on this topic in Habr at a cursory search, so it may be useful to someone in the future. </p><br><hr><br><h1 id="poluchaem-neobhodimye-dannye-vklyuchaem-drive-api-i-poluchaem-neobhodimye-klyuchi">  Get the necessary data ("turn on" the Drive API and get the necessary keys) </h1><br><p>  After completing a few simple steps, after 5 minutes you will already have a test application in your hands with access to the Drive API. </p><br><p>  Before embarking on an exciting journey, be sure to take with you: </p><br><ul><li>  Python version 2.6 or higher (in my case it was Python 3 which I advise you). </li><li>  Batch pip manager </li><li>  Internet access and web browser. </li><li>  Google account and Google Drive work. </li></ul><br><p>  This must be taken seriously, because if at least one of these conditions is violated, then nothing will come of it. </p><br><p>  The procedure is as follows: </p><br><p>  1) Follow the <a href="https://console.developers.google.com/flows/enableapi%3Fapiid%3Ddrive">link</a> to create our project and automatically enable the Drive API.  Click Continue, then Go to credentials <br>  2) On the Add cridentials to your page page, click the Cancel button. <br>  3) On the page, select the OAuth consent screen tab.  Select the desired Email and enter the Product name, click Save. <br>  4) In the Credentials tab, select Create credentials, then Oauth client ID. <br>  5) Select the Other type, enter the sonorous name and click Create. <br>  6) In the field of our "project" click on the button on the right to download the json file.  Save it to the folder with the future script, for convenience, rename to client_secret.json </p><br><div class="spoiler">  <b class="spoiler_title">The whole process in pictures for clarity</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/a6f/d36/c9f/a6fd36c9f09e4632960f26a88fc14808.png"><br><hr><br><img src="https://habrastorage.org/files/200/4ef/496/2004ef496a1741cdb5a1c3092196dc2f.png"><br><hr><br><img src="https://habrastorage.org/files/5ba/491/d65/5ba491d65e7343d697f7fde43a51447e.png"><br><hr><br><img src="https://habrastorage.org/files/8a9/f44/fc6/8a9f44fc66794c50b206df4bc8cbbb8e.png"><br><hr><br><img src="https://habrastorage.org/files/f12/461/a73/f12461a731a34f85be612ebd1e6d5dc4.png"></div></div><br><p>  Next, perform the actions already on the computer </p><br><p>  1 - Installing dependencies <br>  Install the Google Client Library Library </p><br><pre><code class="hljs sql">sudo pip <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> <span class="hljs-comment"><span class="hljs-comment">--upgrade google-api-python-client</span></span></code> </pre> <br><p>  Or look at the <a href="https://developers.google.com/api-client-library/python/start/installation">link</a> if you have any questions. </p><br><p>  2 - Create our initial script <br>  Create a python script next to the file that was jabbed in .json and save the sample code for the test: </p><br><div class="spoiler">  <b class="spoiler_title">Source</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> __future__ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> print_function <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> httplib2 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> apiclient <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> discovery <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> oauth2client <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> client <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> oauth2client <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tools <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> oauth2client.file <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Storage</span></span> try: <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> argparse flags = argparse.ArgumentParser(parents=[tools.argparser]).parse_args() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ImportError: flags = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> # <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> modifying these scopes, <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> your previously saved credentials # at ~/.credentials/drive-python-quickstart.json SCOPES = <span class="hljs-string"><span class="hljs-string">'https://www.googleapis.com/auth/drive.metadata.readonly'</span></span> CLIENT_SECRET_FILE = <span class="hljs-string"><span class="hljs-string">'client_secret.json'</span></span> APPLICATION_NAME = <span class="hljs-string"><span class="hljs-string">'Drive API Python Quickstart'</span></span> def get_credentials(): home_dir = os.path.expanduser(<span class="hljs-string"><span class="hljs-string">'~'</span></span>) credential_dir = os.path.<span class="hljs-keyword"><span class="hljs-keyword">join</span></span>(home_dir, <span class="hljs-string"><span class="hljs-string">'.credentials'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> os.path.<span class="hljs-keyword"><span class="hljs-keyword">exists</span></span>(credential_dir): os.makedirs(credential_dir) credential_path = os.path.<span class="hljs-keyword"><span class="hljs-keyword">join</span></span>(credential_dir, <span class="hljs-string"><span class="hljs-string">'drive-python-quickstart.json'</span></span>) store = <span class="hljs-keyword"><span class="hljs-keyword">Storage</span></span>(credential_path) credentials = store.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> credentials <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> credentials.invalid: flow = client.flow_from_clientsecrets(CLIENT_SECRET_FILE, SCOPES) flow.user_agent = APPLICATION_NAME <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> flags: credentials = tools.run_flow(flow, store, flags) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: # Needed <span class="hljs-keyword"><span class="hljs-keyword">only</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> compatibility <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Python <span class="hljs-number"><span class="hljs-number">2.6</span></span> credentials = tools.run(flow, store) print(<span class="hljs-string"><span class="hljs-string">'Storing credentials to '</span></span> + credential_path) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> credentials def main(): credentials = get_credentials() http = credentials.authorize(httplib2.Http()) service = discovery.build(<span class="hljs-string"><span class="hljs-string">'drive'</span></span>, <span class="hljs-string"><span class="hljs-string">'v3'</span></span>, http=http) results = service.files().list( pageSize=<span class="hljs-number"><span class="hljs-number">10</span></span>,fields="nextPageToken, files(id, name)").<span class="hljs-keyword"><span class="hljs-keyword">execute</span></span>() items = results.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'files'</span></span>, []) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> items: print(<span class="hljs-string"><span class="hljs-string">'No files found.'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: print(<span class="hljs-string"><span class="hljs-string">'Files:'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> items: print(<span class="hljs-string"><span class="hljs-string">'{0} ({1})'</span></span>.format(item[<span class="hljs-string"><span class="hljs-string">'name'</span></span>], item[<span class="hljs-string"><span class="hljs-string">'id'</span></span>])) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: main()</code> </pre> </div></div><br><p>  When you first start it, it will try to open the tab in the browser and ask you to log in to your Google account and agree with the rights issued. </p><br><p>  In general, everything is simple and clear, but if you briefly run </p><br><ul><li>  The get_credentials function creates / gets a .json authorization file for authorization through the API. <br></li><li>  scopes are our access rights (in the future we will put the biggest ones because we trust ourselves) </li><li>  service gives us access to a Google Drive account </li><li>  Further appeal to api, take a list of files (limited to 10 pieces) and display the data. </li></ul><br><p>  You can even run and see how it displays the names and id of the first ten files and folders in the root directory. </p><br><p>  <em>In general, this is almost a complete coypaste <a href="https://developers.google.com/drive/v3/web/quickstart/python">from the official quickstart-tutorial</a> , so if you have any problems, look there.</em> </p><br><hr><br><h1 id="nemnogo-pro-google-drive-api">  A bit about Google Drive API </h1><br><div style="text-align:center;"><img src="https://habrastorage.org/web/363/cac/4c3/363cac4c37c64e43adf0d9aff6b17796.jpg" width="60%" height="60%"></div><br><p>  <a href="https://developers.google.com/drive/v3/reference/">Basic documentation</a> , if that suddenly. </p><br><p>  Actually let's get acquainted with the API closer. </p><br><p>  The structure of the Drive REST API is a collection of "resources" (orig. Resources types), each of which has its own methods. </p><br><p>  In total, the "resources" about (), files () and possibly comments () are interesting.  All the rest can be viewed, again, in the <a href="https://developers.google.com/drive/v3/reference/">documentation</a> , and if you need them, then the work with them will be similar (most likely).  We will consider really useful things. </p><br><p>  First of all, for the seed, let's see what we can learn about our Disk through the methods about () (which is logical).  Fortunately, everything is simple and there is only one get () method. </p><br><p>  Request example </p><br><pre> <code class="python hljs"> about_example = drive_service.about(fields=<span class="hljs-string"><span class="hljs-string">'user, storageQuota, exportFormats, importFormats'</span></span>).get(<span class="hljs-string"><span class="hljs-string">''</span></span>)</code> </pre> <br><p>  There are many parameters here, I will tell you about those that seemed to me important or interesting. </p><br><p>  The importFormats and exportFormats options contain information in which formats you can convert the file when it is downloaded and downloaded, respectively.  This information may be important in the case of working with files of the Google Docs format, more on this below. </p><br><p>  StorageQuota can tell, which is logical, about the amount of used and remaining free space in the cloud. </p><br><p>  user contains several fields, for example displayName, photoLink and emailAddress (the values ‚Äã‚Äãare clear from the name) </p><br><p>  At the output we get a JSON structure with this data. </p><br><div class="spoiler">  <b class="spoiler_title">Sample response, including exportFormats and importFormats</b> <div class="spoiler_text"><p>  { <br>  "user": { <br>  "kind": "drive # user", <br>  "displayName": "First Name Last Name", <br>  "photoLink": " <a href="">http://i.imgur.com/hgXLjzr.png</a> ", <br>  "me": true <br>  "permissionId": "id number", <br>  "emailAddress": "youremail@gmail.com" <br>  }, <br>  "storageQuota": { <br>  "limit": "16106127360", <br>  "usage": "2920407530", <br>  "usageInDrive": "1590570002", <br>  "usageInDriveTrash": "54316729" <br>  }, <br>  "importFormats": { <br>  "application / x-vnd.oasis.opendocument.presentation": [ <br>  "application / vnd.google-apps.presentation" <br>  ], <br>  "text / tab-separated-values": [ <br>  "application / vnd.google-apps.spreadsheet" <br>  ], <br>  "image / jpeg": [ <br>  "application / vnd.google-apps.document" <br>  ], <br>  "image / bmp": [ <br>  "application / vnd.google-apps.document" <br>  ], <br>  "image / gif": [ <br>  "application / vnd.google-apps.document" <br>  ], <br>  "application / vnd.ms-excel.sheet.macroenabled.12": [ <br>  "application / vnd.google-apps.spreadsheet" <br>  ], <br>  "application / vnd.openxmlformats-officedocument.wordprocessingml.template": [ <br>  "application / vnd.google-apps.document" <br>  ], <br>  "application / vnd.ms-powerpoint.presentation.macroenabled.12": [ <br>  "application / vnd.google-apps.presentation" <br>  ], <br>  "application / vnd.ms-word.template.macroenabled.12": [ <br>  "application / vnd.google-apps.document" <br>  ], <br>  "application / vnd.openxmlformats-officedocument.wordprocessingml.document": [ <br>  "application / vnd.google-apps.document" <br>  ], <br>  "image / pjpeg": [ <br>  "application / vnd.google-apps.document" <br>  ], <br>  "application / vnd.google-apps.script + text / plain": [ <br>  "application / vnd.google-apps.script" <br>  ], <br>  "application / vnd.ms-excel": [ <br>  "application / vnd.google-apps.spreadsheet" <br>  ], <br>  "application / vnd.sun.xml.writer": [ <br>  "application / vnd.google-apps.document" <br>  ], <br>  "application / vnd.ms-word.document.macroenabled.12": [ <br>  "application / vnd.google-apps.document" <br>  ], <br>  "application / vnd.ms-powerpoint.slideshow.macroenabled.12": [ <br>  "application / vnd.google-apps.presentation" <br>  ], <br>  "text / rtf": [ <br>  "application / vnd.google-apps.document" <br>  ], <br>  "text / plain": [ <br>  "application / vnd.google-apps.document" <br>  ], <br>  "application / vnd.oasis.opendocument.spreadsheet": [ <br>  "application / vnd.google-apps.spreadsheet" <br>  ], <br>  "application / x-vnd.oasis.opendocument.spreadsheet": [ <br>  "application / vnd.google-apps.spreadsheet" <br>  ], <br>  "image / png": [ <br>  "application / vnd.google-apps.document" <br>  ], <br>  "application / x-vnd.oasis.opendocument.text": [ <br>  "application / vnd.google-apps.document" <br>  ], <br>  "application / msword": [ <br>  "application / vnd.google-apps.document" <br>  ], <br>  "application / pdf": [ <br>  "application / vnd.google-apps.document" <br>  ], <br>  "application / json": [ <br>  "application / vnd.google-apps.script" <br>  ], <br>  "application / x-msmetafile": [ <br>  "application / vnd.google-apps.drawing" <br>  ], <br>  "application / vnd.openxmlformats-officedocument.spreadsheetml.template": [ <br>  "application / vnd.google-apps.spreadsheet" <br>  ], <br>  "application / vnd.ms-powerpoint": [ <br>  "application / vnd.google-apps.presentation" <br>  ], <br>  "application / vnd.ms-excel.template.macroenabled.12": [ <br>  "application / vnd.google-apps.spreadsheet" <br>  ], <br>  "image / x-bmp": [ <br>  "application / vnd.google-apps.document" <br>  ], <br>  "application / rtf": [ <br>  "application / vnd.google-apps.document" <br>  ], <br>  "application / vnd.openxmlformats-officedocument.presentationml.template": [ <br>  "application / vnd.google-apps.presentation" <br>  ], <br>  "image / x-png": [ <br>  "application / vnd.google-apps.document" <br>  ], <br>  "text / html": [ <br>  "application / vnd.google-apps.document" <br>  ], <br>  "application / vnd.oasis.opendocument.text": [ <br>  "application / vnd.google-apps.document" <br>  ], <br>  "application / vnd.openxmlformats-officedocument.presentationml.presentation": [ <br>  "application / vnd.google-apps.presentation" <br>  ], <br>  "application / vnd.openxmlformats-officedocument.spreadsheetml.sum": [ <br>  "application / vnd.google-apps.spreadsheet" <br>  ], <br>  "application / vnd.google-apps.script + json": [ <br>  "application / vnd.google-apps.script" <br>  ], <br>  "application / vnd.openxmlformats-officedocument.presentationml.slideshow": [ <br>  "application / vnd.google-apps.presentation" <br>  ], <br>  "application / vnd.ms-powerpoint.template.macroenabled.12": [ <br>  "application / vnd.google-apps.presentation" <br>  ], <br>  "text / csv": [ <br>  "application / vnd.google-apps.spreadsheet" <br>  ], <br>  "application / vnd.oasis.opendocument.presentation": [ <br>  "application / vnd.google-apps.presentation" <br>  ], <br>  "image / jpg": [ <br>  "application / vnd.google-apps.document" <br>  ], <br>  "text / richtext": [ <br>  "application / vnd.google-apps.document" <br>  ] <br>  }, <br>  "exportFormats": { <br>  "application / vnd.google-apps.form": [ <br>  "application / zip" <br>  ], <br>  "application / vnd.google-apps.document": [ <br>  "application / rtf", <br>  "application / vnd.oasis.opendocument.text", <br>  "text / html", <br>  "application / pdf", <br>  "application / epub + zip", <br>  "application / zip", <br>  "application / vnd.openxmlformats-officedocument.wordprocessingml.document", <br>  "text / plain" <br>  ], <br>  "application / vnd.google-apps.drawing": [ <br>  "image / svg + xml", <br>  "image / png", <br>  "application / pdf", <br>  "image / jpeg" <br>  ], <br>  "application / vnd.google-apps.spreadsheet": [ <br>  "application / x-vnd.oasis.opendocument.spreadsheet", <br>  "text / tab-separated-values", <br>  "application / pdf", <br>  "application / vnd.openxmlformats-officedocument.spreadsheetml.sl", <br>  "text / csv", <br>  "application / zip", <br>  "application / vnd.oasis.opendocument.spreadsheet" <br>  ], <br>  "application / vnd.google-apps.script": [ <br>  "application / vnd.google-apps.script + json" <br>  ], <br>  "application / vnd.google-apps.presentation": [ <br>  "application / vnd.oasis.opendocument.presentation", <br>  "application / pdf", <br>  "application / vnd.openxmlformats-officedocument.presentationml.presentation", <br>  "text / plain" <br>  ] <br>  } <br>  } </p></div></div><br><p>  The "resource" .files (which we mainly will use) also have a large number of methods, consider the main ones. </p><br><p>  The files (). List () method is already a little familiar, but let's take a closer look. </p><br><p>  The .list () method allows you to find files and folders (using specific queries). </p><br><p>  Request example </p><br><pre> <code class="hljs vhdl"> list_example = drive_service.files().list(q=<span class="hljs-symbol"><span class="hljs-symbol">'fullText</span></span> contains <span class="hljs-string"><span class="hljs-string">"important"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> trashed = <span class="hljs-literal"><span class="hljs-literal">true</span></span>', fileds=<span class="hljs-symbol"><span class="hljs-symbol">'files</span></span>(id, name)')</code> </pre> <br><p>  Here we used such an important parameter as q - a special kind of query that allows us to select only the information we need from the entire stream. </p><br><p>  It works in a logical semi-natural language, various parameters can be considered, queries look like this </p><br><pre> <code class="python hljs"> q = <span class="hljs-string"><span class="hljs-string">'name = "Habrahabr"'</span></span> q = <span class="hljs-string"><span class="hljs-string">'fullText contains "some text"'</span></span> q = <span class="hljs-string"><span class="hljs-string">'"idexample123" in parents'</span></span></code> </pre> <br><p>  Read more about how to wield it <a href="https://developers.google.com/drive/v3/web/search-parameters">here</a> . </p><br><p>  The fileds item regulates what kind of information about the files we want to receive (so that requests are executed faster).  This concerns any request. </p><br><p>  <em>You can also see the basic examples of work - <a href="https://developers.google.com/drive/v3/web/manage-uploads">downloading files</a> and <a href="https://developers.google.com/drive/v3/web/manage-downloads">downloading files</a> .</em>  <em>I did not consider them separately, because then they will be used "in combat conditions", which is more useful.</em> </p><br><hr><br><h1 id="ishodnaya-zagruzka-faylov">  Initial file upload </h1><br><p>  However, enough of the theory, let's move on to the fun part (for the sake of this, we have gathered here). </p><br><p>  In order to synchronize a folder on a computer with a folder in the cloud, you first need to have something to synchronize both there and there.  In principle, you can download the folder manually through the browser, but in this case, you can manually update the files separately, do not come here at all.  So we will load the folder with a couple of lines of code, magic and crutches. </p><br><blockquote>  If you still download the folder manually / already have one on the disk and do not want to change anything, just go to the next item (just note - in our particular case, the folder is created directly in the root directory of Google Drive, so bear this in mind, you may need a little bit of tinkering). </blockquote><p>  Write a function that will load our folder to disk </p><br><div class="spoiler">  <b class="spoiler_title">Function code</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">folder_upload</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(service)</span></span></span><span class="hljs-function">:</span></span> parents_id = {} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> root, _, files <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.walk(FULL_PATH, topdown=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>): last_dir = root.split(<span class="hljs-string"><span class="hljs-string">'/'</span></span>)[<span class="hljs-number"><span class="hljs-number">-1</span></span>] pre_last_dir = root.split(<span class="hljs-string"><span class="hljs-string">'/'</span></span>)[<span class="hljs-number"><span class="hljs-number">-2</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pre_last_dir <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> parents_id.keys(): pre_last_dir = [] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: pre_last_dir = parents_id[pre_last_dir] folder_metadata = {<span class="hljs-string"><span class="hljs-string">'name'</span></span>: last_dir, <span class="hljs-string"><span class="hljs-string">'parents'</span></span>: [pre_last_dir], <span class="hljs-string"><span class="hljs-string">'mimeType'</span></span>: <span class="hljs-string"><span class="hljs-string">'application/vnd.google-apps.folder'</span></span>} create_folder = service.files().create(body=folder_metadata, fields=<span class="hljs-string"><span class="hljs-string">'id'</span></span>).execute() folder_id = create_folder.get(<span class="hljs-string"><span class="hljs-string">'id'</span></span>, []) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> name <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files: file_metadata = {<span class="hljs-string"><span class="hljs-string">'name'</span></span>: name, <span class="hljs-string"><span class="hljs-string">'parents'</span></span>: [folder_id]} media = MediaFileUpload( os.path.join(root, name), mimetype=mimetypes.MimeTypes().guess_type(name)[<span class="hljs-number"><span class="hljs-number">0</span></span>]) service.files().create(body=file_metadata, media_body=media, fields=<span class="hljs-string"><span class="hljs-string">'id'</span></span>).execute() parents_id[last_dir] = folder_id <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parents_id</code> </pre> </div></div><br><p>  Let us analyze in order, although everything is quite simple here. </p><br><p>  FULL_PATH is a global variable containing the full path to the desired folder. </p><br><p>  We "run through" our folder from the top to the bottom.  For each new folder, we create its twin brother on google disk, save its id to the dictionary (key - name, value - id), and load all the found files into the appropriate folder.  At the end we return this dictionary. </p><br><p>  True, as in the joke, there is one nuance.  To download a file to disk, you need to specify its mimeType (specification for encoding information, do not ask, I do not know).  To simplify the work with this case, we will use a ready-made solution (in fact, it simply assumes the appropriate mimeType extension, if I understood correctly from the documentation). </p><br><p>  So if you have any tricky files or files without an extension, consult a specialist before using the program (be careful). </p><br><hr><br><h1 id="sinhroniziruem-izmeneniya-s-kompyutera-v-oblako">  Sync changes from computer to cloud </h1><br><div style="text-align:center;"><img src="https://habrastorage.org/web/30e/8c4/056/30e8c405677348a6872ef5926a5fd6ed.jpg" width="60%" height="60%"></div><br><p>  We downloaded the folder, did some changes, deleted something, added something, just edited something, we should now make these changes affect our cloud copy. </p><br><p>  Obviously, you do not really want to delete and reload just like that, so "we will go another way." </p><br><p>  Let's create for this a separate python script, load the necessary libraries.  To analyze file changes, you need to obtain a tree of files and folders on the Disk and local storage, then to compare them and transfer these changes there or back. </p><br><p>  There is no built-in way to get an entire tree of folders and files in a fairly rich api feature (well, or I didn‚Äôt find it, and then I collected the bike for nothing). </p><br><p>  And if not, then write it yourself! </p><br><div class="spoiler">  <b class="spoiler_title">Function code upload files to Google Drive</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_tree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(folder_name, tree_list, root, parents_id, service)</span></span></span><span class="hljs-function">:</span></span> folder_id = parents_id[folder_name] results = service.files().list( pageSize=<span class="hljs-number"><span class="hljs-number">100</span></span>, q=(<span class="hljs-string"><span class="hljs-string">"%r in parents and \ mimeType = 'application/vnd.google-apps.folder'and \ trashed != True"</span></span> % folder_id)).execute() items = results.get(<span class="hljs-string"><span class="hljs-string">'files'</span></span>, []) root += folder_name + os.path.sep <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> items: parents_id[item[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]] = item[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] tree_list.append(root + item[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]) folder_id = [i[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> items <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i[<span class="hljs-string"><span class="hljs-string">'name'</span></span>] == item[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]][<span class="hljs-number"><span class="hljs-number">0</span></span>] folder_name = item[<span class="hljs-string"><span class="hljs-string">'name'</span></span>] get_tree(folder_name, tree_list, root, parents_id, service)</code> </pre></div></div><br><p>  We will analyze in more detail. <br>  A lot of parameters are input <br>  folder_name is the original name of our folder <br>  folder_id - initial folder id <br>  tree_list is a list of our paths, initially empty [] <br>  root - intermediate directory path ... which are then stored in tree_list <br>  parents_id - dictionary containing pairs {folder name - its value} </p><br><p>  We make the original request for the contents of the folder with id = folder_id (and even those that are not in the basket *), tear out those folders that are (because now we are only interested in ways). </p><br><p>  We save the names and id of these folders into the parents_id dictionary, in the root line we note the fact that we are going down the folder hierarchy, and for each new folder we meet recursively run get_tree with the parameters of this folder already. </p><br><p>  Thus recursively descend through all the folders and get their way. </p><br><p>  // <em>Note1: Google Disk has some kind of special file system (which is probably logical), which has its own laws and rules.</em>  <em>For example, two folders or two files with the same name can be side by side in the same directory, because their identifiers are unique to their files - id.</em>  <em>In addition, the same file can be simultaneously in two different places on the disk (if I understood everything correctly).</em>  <em>Probably this knowledge could be used for more optimized synchronization, build a database next to the script and check it, but this is already overfitting and completely unnecessary.</em>  <em>Just a note.</em> </p><br><p>  // <em>Note2: all my examples, and even the final script are made with one negligent assumption, it is considered that there are no more than 1000 files in the folder (and so it will come down!).</em>  <em>In my case, this is always true, I trust myself.</em>  <em>Therefore, it is so crudely and unwisely written.</em>  <em>The problem is fixed easily and in a couple of lines using nextPageToken, as shown in the paragraph above.</em>  <em>I think it will be easy for you to do it yourself (well, or my hands will ever reach).</em> </p><br><p>  Sample code using the nextPageToken is also provided in a <a href="https://developers.google.com/drive/v3/web/search-parameters">special instruction</a> . </p><br><p>  Ok, got the folders that are on the disk, now let's do the same <br>  with a folder on the computer (this is already made easier) </p><br><pre> <code class="python hljs"> os_tree_list = [] root_len = len(full_path.split(os.path.sep)[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">-2</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> root, dirs, files <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.walk(full_path, topdown=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> name <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> dirs: var_path = <span class="hljs-string"><span class="hljs-string">'/'</span></span>.join(root.split(<span class="hljs-string"><span class="hljs-string">'/'</span></span>)[root_len+<span class="hljs-number"><span class="hljs-number">1</span></span>:]) os_tree_list.append(os.path.join(var_path, name))</code> </pre> <br><p>  Here, in essence, only one trick is the transformation of a full path into a relative one.  The rest is pretty simple. </p><br><p>  Now we have tree_list and os_tree_list, which we intend to compare. </p><br><p>  Examples of what these lists look like. </p><br><pre> <code class="python hljs"> os_tree_list = [Example/Example1, Example/Example1/Example2, Example/Example1/Example3] tree_list = [Example/Example1/, Example/Example1/Example4, Example/Example1/Example4/Example5]</code> </pre> <br><p>  For further action, we divide the folders into three groups. </p><br><pre> <code class="python hljs"> remove_folders = list(set(tree_list).difference(set(os_tree_list))) upload_folders = list(set(os_tree_list).difference(set(tree_list))) exact_folders = list(set(os_tree_list).intersection(set(tree_list)))</code> </pre> <br><p>  As is obvious from the name of variables, remove_folders are those folders that are old or accidentally added here and need to be deleted, upload_folders are new folders that need to be downloaded, and exact_folders are folders that are both on the computer and in the cloud. </p><br><p>  Let's start with a simple one ‚Äî downloads of folders and folders contained in them, since we are already a little familiar with this. </p><br><div class="spoiler">  <b class="spoiler_title">Upload Folders to Disk</b> <div class="spoiler_text"><pre> <code class="python hljs">upload_folders = sorted(upload_folders, key=by_lines) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> folder_dir <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> upload_folders: var = os.path.join(full_path.split(os.path.sep)[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">-1</span></span>]) + os.path.sep variable = var + folder_dir last_dir = folder_dir.split(os.path.sep)[<span class="hljs-number"><span class="hljs-number">-1</span></span>] pre_last_dir = folder_dir.split(os.path.sep)[<span class="hljs-number"><span class="hljs-number">-2</span></span>] files = [f <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.listdir(variable) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> os.path.isfile(os.path.join(variable, f))] folder_metadata = {<span class="hljs-string"><span class="hljs-string">'name'</span></span>: last_dir, <span class="hljs-string"><span class="hljs-string">'parents'</span></span>: [parents_id[pre_last_dir]], <span class="hljs-string"><span class="hljs-string">'mimeType'</span></span>: <span class="hljs-string"><span class="hljs-string">'application/vnd.google-apps.folder'</span></span>} create_folder = service.files().create( body=folder_metadata, fields=<span class="hljs-string"><span class="hljs-string">'id'</span></span>).execute() folder_id = create_folder.get(<span class="hljs-string"><span class="hljs-string">'id'</span></span>, []) parents_id[last_dir] = folder_id <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> os_file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files: some_metadata = {<span class="hljs-string"><span class="hljs-string">'name'</span></span>: os_file, <span class="hljs-string"><span class="hljs-string">'parents'</span></span>: [folder_id]} os_file_mimetype = mimetypes.MimeTypes().guess_type( os.path.join(variable, os_file))[<span class="hljs-number"><span class="hljs-number">0</span></span>] media = MediaFileUpload(os.path.join(variable, os_file), mimetype=os_file_mimetype) upload_this = service.files().create(body=some_metadata, media_body=media, fields=<span class="hljs-string"><span class="hljs-string">'id'</span></span>).execute() upload_this = upload_this.get(<span class="hljs-string"><span class="hljs-string">'id'</span></span>, [])</code> </pre> </div></div><br><p>  Before the start of the action, we sorted our list with folder ‚Äúaddresses‚Äù for convenience according to the number of subdirectories (or even slashes '\') to load the folders and their contents as you dive deep into the hierarchical tree (thus avoiding possible dangers like this) no, and it is not clear where she will throw him at all "). </p><br><p>  We create this folder on the disk in the appropriate place for it, with the indication of its "parent" (this is what pre_last_dir is for). </p><br><p>  By analogy with the folders, we look at the files in the directory and check their presence in the same folder on the disk. </p><br><p>  We take all the files from this folder and load in turn according to a known script. </p><br><p>  Further slightly more interesting, we will go over the files and check them for <del>  treason </del>  changes. </p><br><p>  Now it was necessary to compare the files present on both sides of the barricades, and, if necessary, update their contents on the Disk. </p><br><p>  For this, the files have a special method .update (), but not everything is so simple. </p><br><p>  The initial version suggested not updating, but deleting - downloading a new version of the file (the update () method did not start up on the first attempt, I panicked and decided that it was too tricky and replaced it with the familiar and native upload ()). </p><br><p>  It‚Äôs good that I decided to test it again, and it all worked, I had only to specify mimeType correctly, once again I remind you - be more careful with it. </p><br><p>  By the way, the speed gain on the eye was not noticeable, quite the contrary, but no approximate measurements were made, so this is not accurate. </p><br><p>  Then it was worth finding out whether it makes sense to update the file at all, otherwise if every time all these files are downloaded (in whole or in part) it will not be comme il faut. </p><br><p>  The very first idea that came to mind was this - checking by the date of the last modification, the benefit for the file is that it is easy to remove this parameter (the modifiedTime parameter). </p><br><p>  And everything seems to be nothing, on standard checks everything worked like a clock.  But inquisitive minds have probably already understood what the fatal omission here is.  Yes, of course, if we just drop a file from another folder with the same name, but different content, then the change date will be old, and the file will be completely different (one of the options, you can probably think of many more situations like this).  So it was necessary to come up with a new way to check (no less ingenious, but more effective).  As a result, absolutely independently, without anyone's help, an option was invented to check not <em>only the</em> change date, but the file hashes (well, who ever thought that the files on the disk have the md5Checksum parameter).  As a result, the logic has not changed much, and the result is good. </p><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> folder_dir <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> exact_folders: var = (os.path.sep).join(full_path.split( os.path.sep)[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">-1</span></span>]) + os.path.sep variable = var + folder_dir last_dir = folder_dir.split(os.path.sep)[<span class="hljs-number"><span class="hljs-number">-1</span></span>] <span class="hljs-comment"><span class="hljs-comment"># print(last_dir, folder_dir) os_files = [f for f in os.listdir(variable) if os.path.isfile(os.path.join(variable, f))] results = service.files().list( pageSize=1000, q=('%r in parents and \ mimeType!="application/vnd.google-apps.folder" and \ trashed != True' % parents_id[last_dir]), fields="files(id, name, mimeType, \ modifiedTime, md5Checksum)").execute() items = results.get('files', []) refresh_files = [f for f in items if f['name'] in os_files] remove_files = [f for f in items if f['name'] not in os_files] upload_files = [f for f in os_files if f not in [j['name']for j in items]] # Check files that exist both on Drive and on PC for drive_file in refresh_files: file_dir = os.path.join(variable, drive_file['name']) file_time = os.path.getmtime(file_dir) mtime = [f['modifiedTime'] for f in items if f['name'] == drive_file['name']][0] mtime = datetime.datetime.strptime( mtime[:-2], "%Y-%m-%dT%H:%M:%S.%f") drive_time = time.mktime(mtime.timetuple()) # print(drive_file['name']) # if file['mimeType'] in GOOGLE_MIME_TYPES.keys(): # print(file['name'], file['mimeType']) # print() os_file_md5 = hashlib.md5(open(file_dir, 'rb').read()).hexdigest() if 'md5Checksum' in drive_file.keys(): # print(1, file['md5Checksum']) drive_md5 = drive_file['md5Checksum'] # print(2, os_file_md5) else: # print('No hash') drive_md5 = None # print(drive_md5 != os_file_md5) if (file_time &gt; drive_time) or (drive_md5 != os_file_md5): file_id = [f['id'] for f in items if f['name'] == drive_file['name']][0] file_mime = [f['mimeType'] for f in items if f['name'] == drive_file['name']][0] # File's new content. # file_mime = mimetypes.MimeTypes().guess_type(file_dir)[0] file_metadata = {'name': drive_file['name'], 'parents': [parents_id[last_dir]]} # media_body = MediaFileUpload(file_dir, mimetype=filemime) media_body = MediaFileUpload(file_dir, mimetype=file_mime) # print('I am HERE, ', ) service.files().update(fileId=file_id, media_body=media_body, fields='id').execute()</span></span></code> </pre></div></div><br><p>  ,    , ,    "" (  ,    ) ‚Äî . </p><br><br><p>    (   ) ‚Äî    </p><br><pre> <code class="hljs lua"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> folder_dir <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> remove_folders: var = (<span class="hljs-built_in"><span class="hljs-built_in">os</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">path</span></span>.sep).join(full_path.split(<span class="hljs-built_in"><span class="hljs-built_in">os</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">path</span></span>.sep)[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">-1</span></span>]) + <span class="hljs-built_in"><span class="hljs-built_in">os</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">path</span></span>.sep variable = var + folder_dir last_dir = folder_dir.split(<span class="hljs-string"><span class="hljs-string">'/'</span></span>)[<span class="hljs-number"><span class="hljs-number">-1</span></span>] folder_id = parents_id[last_dir] service.files().delete(fileId=folder_id).<span class="hljs-built_in"><span class="hljs-built_in">execute</span></span>()</code> </pre> <br><p>      . </p><br><p>    .  Nearly. </p><br><p> <em>:   -&gt;  -&gt;        .     ,     " " ‚Äî "  " ( - ). ,        ,   .   ,      ,               ( ,           , "   ")</em> </p><br><hr><br><h1 id="punkt-3---obratnaya-sinhronizaciya">  3 ‚Äî   </h1><br><div style="text-align:center;"><img src="https://habrastorage.org/web/d6d/564/d93/d6d564d9317a4e828df452d821e2c172.jpg" width="60%" height="60%"></div><br><p>    Google  -&gt; .       ,            ,         ( )   . </p><br><p>      ,    ,   (,    ). </p><br><p>       : </p><br><pre> <code class="hljs pgsql">file_id = <span class="hljs-string"><span class="hljs-string">'idexample'</span></span> request = drive_service.files().get_media(fileId=file_id) fh = io.BytesIO() downloader = MediaIoBaseDownload(fh, request) done = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> done <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>: status, done = downloader.next_chunk() print "Download %d%%." % <span class="hljs-type"><span class="hljs-type">int</span></span>(status.progress() * <span class="hljs-number"><span class="hljs-number">100</span></span>)</code> </pre> <br><p>     .        " " (   ,    ‚Äî  ,   ,  ).               Google Docs.     . </p><br><p> -,        : </p><br><pre> <code class="hljs pgsql">file_id = <span class="hljs-string"><span class="hljs-string">'idexample'</span></span> request = drive_service.files().export_media(fileId=file_id, mimeType=<span class="hljs-string"><span class="hljs-string">'application/pdf'</span></span>) fh = io.BytesIO() downloader = MediaIoBaseDownload(fh, request) done = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> done <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>: status, done = downloader.next_chunk() print "Download %d%%." % <span class="hljs-type"><span class="hljs-type">int</span></span>(status.progress() * <span class="hljs-number"><span class="hljs-number">100</span></span>)</code> </pre> <br><p> -,         mimeType.      Google Docs          (       about().get(fields='exportFormats')  ,    Google    .doc ). </p><br><p>             ,       ,    ()[]. </p><br><p> C          ,   .   <em></em>         pdf ,      (     ). </p><br><p>     ( )   , .     ( ),         ,    linux gui    (    ). </p><br><p>         Google Docs,     ""   . </p><br><p> <em>:  io.BytesIO()    FileIO(path_to_file, 'wb'),     ,  .</em> </p><br><hr><br><h2 id="epopeya-s-google-docs">   Google Docs </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/web/14a/f40/405/14af40405fda43e1aa9a831d4bfdf704.jpg" width="60%" height="60%"></div><br><p>      ? </p><br><p>  ‚Äî     .     . </p><br><p>    ‚Äî   "" ,     Google Docs.             ,       ( Microsoft, OpenOffice  pdf   ). </p><br><p>           ,          . </p><br><p> <em>,        ,           .        ,          .</em> </p><br><p>       : </p><br><p> 1)          ,       ,   PDF    .     ,  . </p><br><p> 2)         Microsoft  (   ..,    )   ?         ,   ‚Äî    (         .update()),     ,      id      .       ,      ,   . </p><br><p>            .    (     ) </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#f - ,    ,  id,      mimeType  . if f['mimeType'] in GoogleMimeTypes.keys(): print('File APPLICATION!!! ', f['name'], f['mimeType']) # request = service.files().get_media(fileId=file_id) request = service.files().export_media(fileId=file_id, mimeType = GoogleMimeTypes[f['mimeType']]) fh = io.FileIO(os.path.join(variable, f['name']), 'wb') downloader = MediaIoBaseDownload(fh, request) done = False while done is False: status, done = downloader.next_chunk() print("Download %d%%." % int(status.progress() * 100), GoogleMimeTypes[f['mimeType']]) else: print('Good File ', f['name'], f['mimeType']) request = service.files().get_media(fileId=file_id) fh = io.FileIO(os.path.join(variable, f['name']), 'wb') downloader = MediaIoBaseDownload(fh, request) done = False while done is False: status, done = downloader.next_chunk() print("Download %d%%." % int(status.progress() * 100))</span></span></code> </pre> <br><p>         /  (       ) </p><br><p> 1)     ,         ( -         pdf). <br> 2)   mimeType  .  Google  (   )  ,        .          (    xml ,       ),           . <br> 3)        -.   ,  Google Docs      Drawings, Forms    ,      .   ‚Äî Google Drawings,      "--" (    exportFormats  importFormats).                    . </p><br><p>     :   Google Docs     .ext ,     Microsoft.    ()                .          -&gt; ,     - Google Doc ,         Office  (       ,        , ). </p><br><p>     . </p><br><hr><br><h2 id="punkt-pro-analogi">    </h2><br><p> ,       "      ".    ,    .     ,        (      grive),      , -     , -        -   , -  - .       .   . </p><br><hr><br><h2 id="zaklyuchenie"> e </h2><br><p>    . </p><br><p> -   ""  -  .     .       ,            Google Docs ,    ,           .   ,"   ",     .      . </p><br><p>     ,      ,       . </p><br><p>  ,   ,      . </p><br><p>    <a href="https://github.com/i-love-cats1/Google-Drive-sync"> </a> . </p><br><p> <strong> ,  :</strong> </p><br><p> 1) <a href="https://developers.google.com/drive/v3/reference/">,  API</a> ,      <br> 2) <a href="https://developers.google.com/drive/v3/web/quickstart/python"> quickstart-</a> <br> 3) <a href="https://github.com/i-love-cats1/Google-Drive-sync">   </a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/328248/">https://habr.com/ru/post/328248/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328238/index.html">Multi-agent smart home</a></li>
<li><a href="../328240/index.html">What is there with JEP-303 or invent invokedynamic</a></li>
<li><a href="../328242/index.html">Getting rid of Auto Layout</a></li>
<li><a href="../328244/index.html">Magic constants in algorithms</a></li>
<li><a href="../328246/index.html">Ethereum smart contracts: we structure tokens as stocks</a></li>
<li><a href="../328250/index.html">5 of the "hottest" non-fiction novelties for March-April 2017</a></li>
<li><a href="../328252/index.html">How do we save half a million rubles a month with Slack</a></li>
<li><a href="../328256/index.html">DevOps in Enterprise and Finance. Is there life on Mars</a></li>
<li><a href="../328264/index.html">Making Space Invaders on Love2d and Lua</a></li>
<li><a href="../328266/index.html">As I wrote my logger. Debriefing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>