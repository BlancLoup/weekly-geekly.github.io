<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Zigbee for the little ones. Post number 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About a month ago, Atmel ATZB-S1-256-3-0-C modules based on an ATmega256RFR2 chip, combining a 2.4Mhz transceiver, an AVX microcontroller with 256 kil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Zigbee for the little ones. Post number 1</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/6b5/709/abe/6b5709abefed48aa94a40f1b2c51616b.jpg" alt="image" align="left"><br>  About a month ago, Atmel ATZB-S1-256-3-0-C modules based on an ATmega256RFR2 chip, combining a 2.4Mhz transceiver, an AVX microcontroller with 256 kilobytes of memory, and even a chip antenna, were at my disposal.  Atmel promised in turn out of the box Zigbee support for these modules and it was decided to build our mesh on them. <br><br>  If someone doesn‚Äôt understand, using these modules, it is relatively easy to build an IoT mesh network by adding only buttons, lights, sensors and batteries to the modules.  The main microprocessor is already in place, even with an oscillator from the transceiver. <br><br>  Sounds pretty simple, right?  In practice, everything turned out to be much more prosaic.  The main problem was the underestimation of the technological complexity of the atmelevsky Zigbee stack, the Zigbee standard itself, and the reassessment of its own capabilities.  The fact is that I myself have not programmed in C for a long time, I switched to Matlab and Python a long time ago, put all the pointers and other tools for managing resources and processes in the nightstand and threw out the key.  Well ... well, in the world of ambition, many pleasant surprises awaited me. <br><a name="habracut"></a><br>  I rolled up the shorter sleeves, uncovered the modules, soldered the batteries, installed AtmelStudio, sat down to program, got up three days later with the understanding that I still haven‚Äôt gotten into anything.  The feeling is unpleasant, but there is nothing to do, the project will not finish itself and something must be done.  The first step to correcting the error was to switch to another microcontroller which was also present in the project - STM32 which was a lot of tutorials on the Internet and which allowed me to more smoothly integrate into the world of embedded.  About STM32, I also wrote a similar series of posts which, I think, describes in some detail the work with this microcontroller for quite beginners.  This series of posts - ‚ÄúZigbee for the youngest‚Äù will be relatively advanced compared to the STM32 series, as I see it, but still I will try to chew and present the material in a rather structured way that would work out as accessible as possible and you could repeat the experiment at home. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Standard zigbee </h4><br>  In this part we will try to figure out what is Zigbee.  Let's look at the standard in general, see what Zigbee application profiles are, clusters and endpoints.  In the next part, we dive into the technical details of the frame, and security in Zigbee (you can not even read it yet, but return when they are needed).  After reviewing the protocol, we proceed directly to the Atmel and programming modules. <br><br><h4>  Introduction </h4><br>  So who is Mr.  Zigbee? <br><br>  <b>First of all.</b>  ZigBee is a specification of top-level network protocols ‚Äî the APS application-level (eng. Application support sublayer) and NWK network layer ‚Äî using lower-level services ‚Äî the MAC access layer and the PHY physical layer, regulated by the IEEE 802.15.4 standard. <br><br>  If in simple terms, Wikipedia, in my opinion, is very succinctly expressed on the account of this: ‚ÄúCooperation between IEEE 802.15.4 and ZigBee is similar to what happened between IEEE 802.11 and the Wi-Fi alliance.‚Äù <br><br>  And if you chew, then everything works together like this: <br><br>  APS (Zigbee) &lt;---&gt; NWK (Zigbee) &lt;---&gt; MAC (IEEE 802.15.4) &lt;---&gt; PHY (IEEE 802.15.4) <br><br>  1. PHY - physical layer.  Physical level  It is responsible for the transmission and reception of bits by our transceiver. <br>  2. MAC - media access control.  Sub-level access control environment.  For ease of remembering, you can focus on the addressing mechanism.  Everyone has heard about the MAC address here it appears in this sublevel.  The sub-level is responsible for the bit being sent or received not just like that, but to a specific address on the network. <br>  3. NWK - network layer.  Network management level  Responsible for packet transmission on the network ‚Äî includes forwarding, routing, etc. protocols. <br>  4. APS - application support sublayer.  Commands called directly from the application for transfer to the network. <br><br>  <b>Secondly.</b>  Zigbee also includes (among the things that are important for understanding) an application standardization mechanism that includes application profiles and libraries of standard clusters.  ( <b>Remember this tweet!</b> ) <br><br><h4>  Application Standardization Mechanism </h4><br>  From this part we have to take a few basic concepts: <br><br><ul><li>  Zigbee application profiles </li><li>  Endpoints </li><li>  ZCL - clusters </li><li>  Server-clent separation </li></ul><br>  So we start with the <b>profiles</b> .  Zigbee application profile is primarily a class that combines different devices into one application area.  For example, in Zigbee there are the following standard profiles: <br><br>  Profile ID Profile Name <br>  0101 Industrial Plant Monitoring (IPM) <br>  0104 Home Automation (HA) <br>  0105 Commercial Building Automation (CBA) <br>  0107 Telecom Applications (TA) <br>  0108 Personal Home &amp; Hospital Care (PHHC) <br>  0109 Advanced Metering Initiative (AMI) <br><br>  Profiles are primarily needed to ensure that devices from one manufacturer work with devices from another manufacturer in the general field of application.  It is interesting that devices can be multi-profile and some kind of light bulb can be, for example, certified both as (HA) and as (CBA).  Profiles are not limited to standard ones and a device manufacturer can invent their own.  Also, messages in Zigbee are transmitted within a single profile using a profile id - that is, the application is delimited not only in the code, in certification, logically and but also on the communication channel. <br><br>  Standard profiles come up with standard device types, for example, for (HA), the following lighting devices exist: <br><br><img src="https://habrastorage.org/files/b48/89b/29a/b4889b29a5314ba2877e62bf9c7ae71a.png"><br><br>  It is important to note that this separation is functional and not physical, that is, one embedded control panel can be both ‚ÄúDimmer Switch‚Äù and ‚ÄúOn / Off Light Switch‚Äù.  How does she do it?  With a concept called <b>endpoints</b> .  In our iron-weed device we can ‚Äúregister‚Äù several endpoints, each of which will do its own thing and will not even know about the others.  Thus, several virtual devices are combined on the same physical one. <br><br>  Well, for dessert, Zigbee provides special libraries ZCL - <b>clusters</b> that should be great to help us implement various devices.  Clusters are functional building blocks that perform some simple functions from which you can create a whole working device.  For example, a standard device called "Dimmer Switch" uses libraries / clusters: <br><br><img src="https://habrastorage.org/files/060/9e2/c5a/0609e2c5a39444029e9e369ced4ea8ae.png"><br><br>  But what is it?  This is a plane!  No, it's a bird!  No, this is a <s>superman</s> distinction between <b>server and client</b> .  The last basic concept that we will address today is the distinction between server / client in the code and functionality of the device.  The server is usually where the information / commands come together and the client is the one who sends, so the ‚ÄúDimmer Switch‚Äù is basically the client (sends commands) and the light bulb is the server (executes commands).  Note also that the same ‚ÄúDimmer Switch‚Äù device has a server side that is apparently responsible for the identification setting in this very switch.  Almost all standard devices have something on both parts on both server and client.  We also note from the example above that clusters can have both server and client functionality. <br><br>  All this distinction and standardization in theory should be great help in software development. <br><br>  <b>Example:</b> <br>  Manufacturer Zingbao ltd produces for Philips ltd a system consisting of a light bulb, a motion sensor and an Internet portal for them.  This system of course works and is certified as Zigbee (HA).  By the way, this means that the light in the system is able to do what the Color Dimmable Light (HA) device should do, namely, to accept commands of color and light-power, the sensor should be able to do what is required by Occupancy Sensor (HA), etc.  Therefore, all parts of the system contain the code of this profile According to its function.  Next, bulbs with sensors and Internet access from Philips are delivered to the office of a large Internet company Booble.  Noticing this, enterprising Chinese hackers write their Zigbee <b>profile</b> ‚ÄúI want to know your secrets‚Äù (IWNYS) and negotiate with Zigbao ltd or its employee on an extraordinary update of the system.  After the update, motion sensors, in addition to indicating movement, start transmitting conversations as well (since the sensor is based on a microphone, and the Spy senor <b>device is</b> added to the firmware based on hacker <b>clusters</b> Big boss detector, Speech transmitter, Secret encoder and of course registered as an additional <b>endpoint</b> in the motion sensor) from the office of the head of Booble through the profile (IWNYS) without any connection with (HA).  For example, a standard (HA) can perfectly coexist with a company profile (IWNYS).  Well, for completeness, the system works fine with Osram bulbs that are also certified as (HA) and installed in Booble. <br><br>  Well, sort of all for today.  I remind you that in the next part we will go through the technical part of the protocol - the structure of the frame and the settings and security.  If anyone is bored, this part can be skipped for now.  In the following sections, we will proceed directly to launching Zigbee on ATmega modules and parsing the Atmel bitcloud SDK - package for working with Zigbee and ATmega modules. </div><p>Source: <a href="https://habr.com/ru/post/266529/">https://habr.com/ru/post/266529/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../266515/index.html">CRM work protocol in a medical institution</a></li>
<li><a href="../266517/index.html">‚ÄúSweet‚Äù programming, or How to select a label from a can of jam in Mathematica?</a></li>
<li><a href="../266519/index.html">Intel Broadwell Xeon E3-1200 v4 - all you need to know about the new line of Xeon and eDRAM</a></li>
<li><a href="../266521/index.html">Release Phalcon 2.1.0 beta 1</a></li>
<li><a href="../266527/index.html">One customer, two premises, four providers and eight connections</a></li>
<li><a href="../266533/index.html">A variety of network security tests: a review of IXIA solutions</a></li>
<li><a href="../266537/index.html">How to stop freezing in the data center?</a></li>
<li><a href="../266539/index.html">Indoor navigation - from idea to working prototype</a></li>
<li><a href="../266541/index.html">As one of the operators increased the capacity of 3G in a densely populated district of Minsk, not forgetting about the coming on the heels of LTE</a></li>
<li><a href="../266545/index.html">Installation programs - how much do they influence the product or company image?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>