<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Java socket framework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day to all. I develop online 3d game, java platform was chosen. For 3d, the jmonkeyengine engine was chosen. And as the server side, I decided to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Java socket framework</h1><div class="post__text post__text-html js-mediator-article">  Good day to all.  I develop online 3d game, java platform was chosen.  For 3d, the jmonkeyengine engine was chosen.  And as the server side, I decided to write a simple p2p framework, MVC with the implementation of views on the client. <br><a name="habracut"></a><br><br>  Updated blog with examples and documentation: <br>  <a href="https://java-framework-jsocket.blogspot.com/">java-framework-jsocket.blogspot.com</a> <br><br>  <b>Where it may come in handy:</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1. Server for mobile services. <br>  2. Any multi-user applications where you need p2p. <br>  3. Online games. <br>  4. Torrent if desired. <br><br>  <b>Diagram:</b> <br><img src="https://habrastorage.org/getpro/habr/post_images/947/d0c/071/947d0c07163110b07a210a8ce130a573.jpg" alt="image"><br><br>  <b>Principle of operation:</b> <br><br>  1. The client sends to the server a message that lists the variables and what task to call. <br>  2. The message hits the inbox queue. <br>  3. The router starts the desired task with these variables. <br>  4. In the task we send the answer to the user. <br><br>  <b>Additional features:</b> <br><br>  1. Configure the client and server ports. <br>  2. Database models. <br>  3. Validation of incoming messages. <br>  4. User rights. <br>  5. Modules. <br>  6. Session mechanism. <br>  7. Teams. <br>  8. Change protocol tcp / udp. <br><br>  <b>Instructions, examples and documentation</b> <br><br>  ‚Üí <a href="http://jsockframework.blogspot.com/">http://jsockframework.blogspot.com/</a> <br>  ‚Üí <a href="https://github.com/nnpa/jsock/">https://github.com/nnpa/jsock/</a> <br>  ‚Üí <a href="https://www.youtube.com/playlist%3Flist%3DPLURYMl31iZR4Oi234nodt4cV6GMYV8NJ5">youtube</a> <br>  ‚Üí <a href="https://github.com/nnpa/jsock/blob/master/doc/jsock.doc">jsock.doc</a> <br><br>  <b>Example of sending and receiving messages</b> <br><br>  Customer: <br><br><pre><code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//client /* * jsock framework https://github.com/nnpa/jsock open source * Each line should be prefixed with * */ package jsock.tests; import java.io.IOException; import java.io.InputStream; import java.io.PrintWriter; import java.net.InetAddress; import java.net.ServerSocket; import java.net.Socket; import java.net.UnknownHostException; import java.util.Iterator; import java.util.Scanner; import java.util.logging.Level; import java.util.logging.Logger; import conf.JConfig; import org.json.simple.JSONArray; import org.json.simple.JSONObject; import org.json.simple.parser.JSONParser; import org.json.simple.parser.ParseException; /** * * @author padaboo IB Aleksandrov jetananas@yandex.ru */ public class JClientTCPTest { public static void main(String[] args) throws UnknownHostException, IOException, ClassNotFoundException, InterruptedException{ JClientTCPTest tcpTest = new JClientTCPTest(); tcpTest.test(); } public void test(){ Sender sender = new Sender(); sender.start(); Receiver receiver = new Receiver(); receiver.start(); } class Sender extends Thread{ @Override public void run(){ try { InetAddress host = InetAddress.getLocalHost(); Socket socket = null; String message; for(int i=1; i&lt;10;i++){ message = "{\"task\":\"JTestTask\",\"message\":\"test"+i+"\"}"; socket = new Socket(host.getHostName(), JConfig.server_port); //InputStream inStream = socket.getInputStream(); PrintWriter socketOut; socketOut = new PrintWriter(socket.getOutputStream(), true); socketOut.println(message); socket.close(); System.out.println("Send: "+i); Thread.sleep(100); } } catch ( IOException | InterruptedException ex) { Logger.getLogger(JClientTCPTest.class.getName()).log(Level.SEVERE, null, ex); } } } class Receiver extends Thread{ JSONObject jsonObj; JSONParser parser; @Override public void run(){ try { ServerSocket serverSocket = new ServerSocket(JConfig.client_port); String data = ""; while(true){ data = ""; Socket socket = serverSocket.accept(); InputStream inStream = socket.getInputStream(); Scanner scanner = new Scanner(inStream); while(scanner.hasNextLine()){ data += scanner.nextLine(); } System.out.println(data); } } catch (IOException ex) { Logger.getLogger(JClientTCPTest.class.getName()).log(Level.SEVERE, null, ex); } } } }</span></span></code> </pre> <br>  Server: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> tasks; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> jsock.message.JInMessages; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> jsock.message.JOutMessages; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> jsock.task.JClientTask; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> models.Users; <span class="hljs-comment"><span class="hljs-comment">/** * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@author</span></span></span><span class="hljs-comment"> padaboo IB Aleksandrov jetananas@yandex.ru */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JTestTask</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JClientTask</span></span></span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JTestTask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JInMessages message)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(message); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> String[][] rules(){ String[][] rules = { {<span class="hljs-string"><span class="hljs-string">"require"</span></span>,<span class="hljs-string"><span class="hljs-string">"message"</span></span>} }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rules; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rights</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//String rigths = "user,admin"; String rigths = "guest"; return rigths; } @Override public void action(){ String message = this.message.json.get("message").toString(); System.out.println(message); String outString = "{\"message\":\"Test\"}"; JOutMessages outMessage = new JOutMessages(this.message.ip,outString); outMessage.insert(); } }</span></span></code> </pre><br>  1. The client sends to the json server a string with the name of the task being called. <br>  2. The task retrieves the variables from the message and sends the response. <br><br>  <b>Task</b> <br><br>  The task must be created in the tasks folder and inherited from JClientTask.  In the constructor, the JInMessages class with the incoming message must be passed.  The methods rules, rights, action must be implemented.  The rules describe the validation rules for variables; you can write your own validation rules.  In rights, listing the rights of users who have the right to trigger an action. <br>  in action the main code. <br><br>  <b>Retrieving variables</b> <br><br><pre> <code class="java hljs"> String message = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.message.json.get(<span class="hljs-string"><span class="hljs-string">"message"</span></span>).toString();</code> </pre> <br>  <b>Response and queuing line</b> <br><br><pre> <code class="java hljs">String outString = <span class="hljs-string"><span class="hljs-string">"{\"message\":\"Test\"}"</span></span>; JOutMessages outMessage = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JOutMessages(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.message.ip,outString); outMessage.insert();</code> </pre> <br>  Instead of ip, you can put any ip that listens to the socket and waits for the json string. <br><br>  <b>Models</b> <br><br>  After installing the framework, according to the instructions there will be 2 tables in the database: Users, Session.  Examples of use are in folders with tasks. <br><br>  All models must be created in the models folder, inherited from DBQuery in which the connection to the database and the main methods are implemented.  In the model class the logic of interaction with the database should be implemented. <br><br>  <b>User rights</b> <br><br>  1. Rights must be described in tasks in the rights method: guest, user, admin.  Unauthorized user has guest rights.  The registered user is assigned user, these values ‚Äã‚Äãare stored in the database in the rights table. <br><br>  <b>Example: authorization by token, model, right</b> <br><br>  <b>Getting a token</b> <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ String email = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.message.json.get(<span class="hljs-string"><span class="hljs-string">"email"</span></span>).toString(); String password = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.message.json.get(<span class="hljs-string"><span class="hljs-string">"password"</span></span>).toString(); Users users = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Users(); <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> isAuth = users.authorization(email,password); String outString; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(isAuth){ String token = users.getToken(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> userId = users.id; String ip = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.message.ip; <span class="hljs-comment"><span class="hljs-comment">//System.out.println(insertQuery); Session session = new Session(); session.setToken(userId, token,ip); outString = "{\"token\":\"" + token +"\"}"; }else{ outString = "{\"error\":\"Incorrect login or password \"}"; } JOutMessages outMessage = new JOutMessages(this.message.ip,outString); outMessage.insert(); }</span></span></code> </pre><br>  1. In the right we specify the expected variables: email, password. <br>  2. Create the Users model, call the authorization method. <br>  3. Create a session model - we get a token. <br>  4. We send the answer. <br>  5. Save the token on the client. <br><br>  <b>An example of checking rights and sending messages to a specific ip</b> <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * get ip from session and send to open socket **/</span></span> System.out.println(<span class="hljs-string"><span class="hljs-string">"user_id: "</span></span> + webUser.id + <span class="hljs-string"><span class="hljs-string">" email: "</span></span> + webUser.email + <span class="hljs-string"><span class="hljs-string">" rights: "</span></span>+ webUser.rights); Session session = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Session(); session.findByUserID(<span class="hljs-number"><span class="hljs-number">12</span></span>); String ip = session.ip; <span class="hljs-comment"><span class="hljs-comment">//all users //session connection String outString = "{\"ip_message\":\"send to user by session id\"}"; JOutMessages outMessage = new JOutMessages(ip,outString); outMessage.insert(); }</span></span></code> </pre><br>  1. In the rights we specify user. <br>  2. In the expected variables token <br><br>  After calling a task with a token and non-guest rights.  The user is searched in the database in the Session table, the user model is created by user_id - which is available in the task in the webUser variable. <br><br>  You can send messages to all clients by user_id in Session or by connection in the JConnections class. <br><br>  An example of registration can be viewed in the tasks class. JRegistrationTask.  All tests are in the folder / tests /.  More detailed examples can be found on the links at the beginning of the message. <br><br>  UPD: Framework updated bugs fixed, new features added <br>  UPD: I started writing a tutorial: <a href="https://jsock-framework-tutorial.blogspot.com/2019/02/jsock-framework.html">jsock-framework-tutorial.blogspot.com/2019/02/jsock-framework.html</a> </div><p>Source: <a href="https://habr.com/ru/post/318782/">https://habr.com/ru/post/318782/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../318772/index.html">Pimcore licensing FAQ</a></li>
<li><a href="../318774/index.html">About recovery. Is RAID on a VPS SSD advisable in case of dedicated drives? Analog server until February for free</a></li>
<li><a href="../318776/index.html">Stylish Python code, or learning to use Flake8</a></li>
<li><a href="../318778/index.html">PHPixie Cache: PSR-6, PSR-16 and some interesting features</a></li>
<li><a href="../318780/index.html">Approaches to design in virtual reality</a></li>
<li><a href="../318784/index.html">Can your code reason?</a></li>
<li><a href="../318786/index.html">Competitiveness: Cooperativeness</a></li>
<li><a href="../318788/index.html">42% of people who do not buy your product</a></li>
<li><a href="../318790/index.html">Creating a blog engine with Phoenix and Elixir / Part 7. Add comments / New Year's announcement in the conclusion</a></li>
<li><a href="../318792/index.html">FBI, CIA and Obama against PHP script</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>