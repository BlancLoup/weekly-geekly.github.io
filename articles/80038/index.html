<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What does UserAgent eat</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="To begin with, of course, it was worth telling why they are eating this very ‚Äúuser agent‚Äù. Well, or, in general, to start with the fact that this is a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What does UserAgent eat</h1><div class="post__text post__text-html js-mediator-article"><br><img title="ua" alt="msdn_ua" src="http://img199.imageshack.us/img199/2189/image1kj.jpg"><br><br>  To begin with, of course, it was worth telling why they are eating this very ‚Äúuser agent‚Äù.  Well, or, in general, to start with the fact that this is an agent.  (By the way, no one knows any Slavic-Orthodox translation of this term?) But hoping that the habr user either already knows and uses the <a href="http://ru.wikipedia.org/wiki/User_Agent">useragent</a> or does not need it, I would not want to dwell on the <a href="http://www.developershome.com/wap/detection/detection.asp%3Fpage%3DuserAgentHeader">prefaces</a> .  And so, my advice - use useragent with regular expressions! <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Of course, you tend to regularly use expressions,% username%, but they are different for the soul, and I'm about regex.  One of the main tasks in my work is to correctly identify the capabilities of the device and the end-user browser.  Since we focus on mobile devices (cell phones), I will take them as an example.  Unlike users of ordinary computers, users of mobile devices are severely and severely limited in screen resolution, browser capabilities, etc.  We have a small database compiled and automatically updated with <a href="http://en.wikipedia.org/wiki/UAProf">UAProf</a> and <a href="http://en.wikipedia.org/wiki/Wurfl">Wurfl</a> .  But agent headers (useragent headers) are constantly changing and the number of differences is constantly increasing.  About how to do a search for the next device by checking the agent one-to-one is out of the question, but how to look for the same.  Therefore, we began to deal with the useragent device and what can be squeezed out of it. <br><br><h3>  Ingredients </h3><br>  Standards and format - as usual nobody observes them.  <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html">The</a> useragent <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html">format</a> varies from manufacturer to manufacturer and from series to series.  In addition, most mobile operators like to rewrite titles. <br>  The main blocks should be such: <br>  device / version browser / version (supported standards and technologies). <br><img src="http://i.msdn.microsoft.com/ms537503.aboutuseragent_fig01(en-us,VS.85).gif" alt="msdn_ua"><br>  The first example of the <strong>sonyericssonk530i / r6bc browser / netfront / 3.3 profile / midp-2.0 configuration / cldc-1.1</strong> tells us that no brackets can be expected, and the second example <strong>mozilla / 5.0 (symbianos / 9.4; u; series60 / 5.0 nokia5800d- 1 / 21.0.025; profile / midp-2.1 configuration / cldc-1.1) applewebkit / 413 (khtml, like gecko) safari / 413</strong> gently hints that no one will follow the order.  But it is still important for me to know that different agents appear on the same device, for example nokia n95: <br><ul><li>  mozilla / 5.0 (symbianos / 9.2; u; series60 / 3.1 nokian95 / 12.0.013; profile / midp-2.0 configuration / cldc-1.1) applewebkit / 413 (khtml, like gecko) safari / 413 </li><li>  mozilla / 5.0 (symbianos / 9.2; u; series60 / 3.1 nokian95 / 31.0.017; profile / midp-2.0 configuration / cldc-1.1) applewebkit / 413 (khtml, like gecko) safari / 413 [en-us] </li><li>  mozilla / 5.0 (symbianos / 9.2; u; series60 / 3.1 nokian95 / 30.0.015; profile / midp-2.0 configuration / cldc-1.1) </li><li>  mozilla / 5.0 (symbianos / 9.2; u; series60 / 3.1 nokian95_8gb / 30.0.018; profile / midp-2.0 configuration / cldc-1.1) applewebkit / 413 </li><li>  mozilla / 5.0 series60;  nokian95; </li></ul><br><br><h3>  Recipe </h3><br>  However, as you can see, some kind of logic exists.  After the slash (/) comes the version - the dynamic part, which does not play a special role.  Be sure to have an indication of the browser.  Separation of tokens with a space and / or a semicolon.  Twisting the logs, we found a lot of garbage in the agent headers, so the standardization and allocation of segments was the first step.  Such utility turned out here: <br><ol><li> Choose what is really useragent: <code>([[(]?[a-z0-9._+;]\s?[/\-;:\\,*\s]*[)\]]?\s?)*</code> </li><li>  Define the browser token: <code>((iemobile|kbrowser)\s[0-9.]+)|((up(\.link)?|netfront|obigo|opera\s?(mini|mobile)?|deckit|safari|(apple)?webkit|mozilla|openwave)/[0-9\.az\-]+\+?)|(browser/[az\-0-9]+/?[0-9\.az\-]+)|([az\.-]+browser[az\.-]*(/[0-9\.az\-]+)?)</code> </li><li>  Define the profile and configuration: <code>(((profile|configuration|java(platform)?)/[az]+-?)|((cldc|midp|wap)[\s\-]?))[0-9\.-az]+</code> </li><li>  Language: <code>((?&lt;=[\s;\[\(])[az]{2}[\s-][az]{2}(?=[\s;\]\)]))|\[([az]{2,3}[\-_\s]?)+\]</code> </li><li>  Version: <code>[\s;/]+(v(er)?[\s.]*)?[0-9]+\.[0-9\.]+([az]{1,2}[0-9\.]*)?</code> </li><li>  Sometimes indicate the screen size in pixels: <code>[0-9]{3}x[0-9]{3}</code> </li></ol><br>  Naturally, a hundred percent result did not work out, but a run through 30,000 useragents showed that the correct segments were highlighted at 97%.  So the result is quite decent.  But we did not have enough.  Some things need to be checked on the database and there is all the same variation and diversity of models and agents.  A simple and intuitive idea appeared - search by model.  That is, despite the fact that there are more than a dozen different useragents for the same 95th Nokia, nokian95 is present in each version.  The task would be trivial if it were necessary to identify / search only the same model (let‚Äôs say, find out the iPhone or not).  But then if-else would be enough.  Life is more complicated and there is simply no universal standard for defining a model. <br><br><h3>  Dessert </h3><br>  We went from the opposite - we will clean the useragent from those tokens that we have learned to define. <br>  Using the same expressions (with easy changes) I erase the useragent blocks one by one (pseudo-code <code>while useragent ismatch replace match with string.empty</code> ).  It turns out the rest of the unknown to me in advance pieces, some of which are rubbish, and some one - a model.  The simplest solution was to split the balance into separate tokens - <code>Split(' ', '/', ';')</code> and search for a token with the manufacturer.  We are looking for which part contains one of the following lines: <br><br> <code>"nokia", "motorola", "mot-", "moto-", "motorazr", "sonyericsson", "samsung", "sec-", "sgh-", "lg-", "lge", "lg", "sie-", "siemens","ipod", "iphone" ,"ipaq", "spv", "i-mate", "mobilephone", "htc", "vodafone", "palm", "rover", "gigabyte", "asus", "alcatel", "mitsu", "verizon", "apple".</code> <br> <br><br>  Now, from the above different long useragents of the n95, I only have nokian95 and nokian95_8gb, respectively.  Here are some more examples of complete useragents and cleanup results: <br><ul><li>  samsung-sgh-f480 / f480jihh2 shp / vpp / r5 netfront / 3.4 qtv5.3 smm-mms / 1.2.0 profile / midp-2.0 configuration / cldc-1.1 <br>  = <strong>samsung-sgh-f480</strong> </li><li>  sonyericssonw705 / r1ea browser / netfront / 3.4 profile / midp-2.1 configuration / cldc-1.1 javaplatform / jp-8.4.2 <br>  = <strong>sonyericssonw705</strong> </li><li>  lg-kc910q browser / teleca-q7.1 mms / lg-mms-v1.0 / 1.2 mediaplayer / lgplayer / 1.0 java / asvm / 1.1 profile / midp-2.1 configuration / cldc-1.1 <br>  = <strong>lg-kc910q</strong> </li><li>  mozilla / 5.0 (symbianos / 9.3; u; series60 / 3.2 nokia6210navigator / 03.25; profile / midp-2.1 configuration / cldc-1.1) applewebkit / 413 (khtml, like gecko) safari / 413 <br>  = <strong>nokia6210navigator</strong> </li><li>  sgh-z370 / 1.0 netfront / 3.3 profile / midp-2.0 configuration / cldc-1.1 <br>  = <strong>sgh-z370</strong> </li><li>  vodafone / 1.0 / sex1i / r2aa mozilla / 4.0 (compatible; msie 6.0; windows ce; iemobile 7.11) up.link/6.3.1.20.0 profile / midp-2.0 configuration / cldc-1.1 <br>  = <strong>vodafone sex1i</strong> </li></ul><br><br><h3>  On the road </h3><br>  In addition to the browser, you may be interested in the WAP token (WAP 1.0 for short = WML, WAP 2.0 = XHTML).  The mmp (multimedia mobile processor) version should indicate support for audio / video codecs - 1.0 audio mp3 only, and 2.0 supports 3gp video.  Most of the <code>ip(hone|od).*?os\s*(v(er(sion)?)?)?[\s.]*([0-9._]+|[az]+)</code> operating system and version - relevant for the iPhone: <code>ip(hone|od).*?os\s*(v(er(sion)?)?)?[\s.]*([0-9._]+|[az]+)</code> <br><br><h3>  Enjoy your meal </h3><br>  Check on the database and fit (finetunning) led to 99% of the result.  This is certainly an obvious overfitting, but it was one of the goals (maximum accuracy in a certain audience and region).  By the way, the above regexs are more abstract and should give greater error due to their universality. <br></div><p>Source: <a href="https://habr.com/ru/post/80038/">https://habr.com/ru/post/80038/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../80031/index.html">Colin McRae DiRT 2: caution!</a></li>
<li><a href="../80032/index.html">Tomorrow on YouTube - Porn Day</a></li>
<li><a href="../80034/index.html">Lenovo Skylight: lightweight smartbook based on Qualcomm Snapdragon</a></li>
<li><a href="../80035/index.html">Dell XPS M1210 disassembly</a></li>
<li><a href="../80036/index.html">The optimal length and composition of the password</a></li>
<li><a href="../80045/index.html">Lyceum from Revolance</a></li>
<li><a href="../80046/index.html">Lenovo Skylight - the first serial smartbook</a></li>
<li><a href="../80050/index.html">Will Intel have to remove from the compiler a function that deliberately delivers bad code for AMD processors?</a></li>
<li><a href="../80051/index.html">December FireForge.net Review</a></li>
<li><a href="../80052/index.html">Nexus One. The presentation has begun</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>