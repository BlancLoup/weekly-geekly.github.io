<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we transferred 400 stores to electronic cash registers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, my name is Svetlana, I am a leading analyst in retail M.Video. If you had to implement electronic cash registers in offline business, then you can...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we transferred 400 stores to electronic cash registers</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/cac/46d/2f6/cac46d2f69fd404b80614a07f80f0364.jpg"><br><br>  Hi, my name is Svetlana, I am a leading analyst in retail M.Video.  If you had to implement electronic cash registers in offline business, then you can perfectly imagine the non-triviality of the task.  And if there are several hundred stores across the country, then the project turns into a task with many unknowns.  And today I want to talk about our experience in implementing electronic cash registers, and from the point of view of the analyst and project manager.  And my colleagues will describe the technical details in one of the upcoming publications. <br><br>  So, in November 2016, we learned that the introduction of the FZ-54 is coming: by the summer of 2017, we will have to change all the ticket offices in our stores with new ones.  All ticket offices are about 2.5 thousand in all regions of the country: from Vladivostok to Kaliningrad.  Do you know how I was assigned the task? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      ‚ÄúChanges have appeared in the Russian Federation: federal law 54 - cloud fiscalization!  We must comply.  And we started to implement the directive. <br><a name="habracut"></a><br><h2>  Input data </h2><br>  At the end of October 2016, we knew that Rosneft had already introduced new cash registers, and the tax office was even pleased with the result.  But how did this happen, in what form it was introduced - nobody knew the details.  Googling, we realized that no one on the market yet really knows what to do.  They did not know much: there is a new format of fiscal data, a document of 100 pages, in which tags are written that must be transferred to the CRF and the tax.  There are operators of fiscal data - certified organizations, at least one of which we will have to enter into an agreement, which means: tender, long meal of choice, and before that there is no test platform.  And the procedure for registering and re-registering cash desks is changing: now you don‚Äôt have to carry KCP into tax, you can do everything remotely through the personal account of the taxpayer.  The remaining information was inconsistent and vague. <br><br>  There was no doubt only in one thing: we will definitely have to do this, as well as to modernize the cash register fleet, because instead of the EKLZ (electronic control tape protected) there appears a fiscal drive. <br><br><h2>  Transition to new offices </h2><br>  An urgent project team was created consisting of managers, analysts and several technical specialists who were engaged in the selection of cash registers. <br><br>  There were two options: <br><br><ul><li>  buy new certified cash registers (and at that time there were not so many companies that already certified KCP); </li><li>  make custom cash registers: remove the EKLZ from the old ones, drill a couple of holes, push in a couple of wires and connect a fiscal drive. </li></ul><br>  As a result, we decided not to fence the collective farm with the alteration of cash desks, but to purchase new ones.  They chose the company Atol, which became for us a supplier of cash registers and a new partner. <br><br><h2>  How was the implementation </h2><br>  Strategically, the team decided that we would tighten it with the introduction of the FZ-54 to the last, but then we would skip the implementation phase on the FFD version 1.0, re-register from 1.0 to 1.05, and launch immediately on version 1.05.  As life has shown, the decision was erroneous and cost us almost a month of wasted time. <br><br>  At first there was chaos: the format of fiscal data that needs to be transferred to the tax data changed every two days.  We developed something, legislative requirements were updated, and we began to refine what we did yesterday.  And so several times. <br><br><img src="https://habrastorage.org/web/bf2/876/fe5/bf2876fe54504e78a85fa0d5736558c3.jpg"><br><br>  The second difficulty was that our software was written on Oracle, while Atol had no compatible firmware at that time.  Therefore, I had to simultaneously write a shell for CCT, which provided interaction between the cash registers and our software.  This work was the most difficult, because it was actually done by touch, by trial and error.  In essence, they invented the bicycle. <br><br>  In the end, a separate service was developed that is installed at each cashier‚Äôs workplace and interacts with CCP, receiving and transmitting data. <br><br>  A lot of time and effort was spent in trying to match our numerous forms of payment and discount cards, advances, bonus and virtual rubles with various tags: credit, advance, prepayment, advance credit.  The puzzle did not agree how much we did not consult with financiers and methodologists. <br><br>  A separate wish of the company was to preserve the appearance of the cash voucher, in which we have additional characteristics for each product and a breakdown of the discount in the context of the applied shares and discount funds.  And this completely ruled out the option of using a check template from CCV.  We undertook to develop a new template in which we combined the requirements of the company and legislation.  The interests of both sides were respected, but the check was twice as long, and the expense of the cash register subsequently increased significantly. <br><br><h2>  Gift card problems </h2><br>  Another of the bikes became gift cards.  How to transfer data on them to the tax?  When a customer buys a gift card, we deposit money on it ‚Äî an advance payment ‚Äî which is then spent on the purchase of goods ‚Äî an advance credit.  That is, the turnover of one amount of money is carried out twice, and according to the new law ‚Äúevery check must be fiscalized‚Äù, in this situation we had to pay tax twice: the first time - when the card was sold with money credited to it, the second time - when we received this card use in payment.  However, in FFD 1.0 there was no breakdown into loans, advances, repayments of advances and other payments. <br><br>  This was provided in later versions of FFD, starting from 1.05.  That is why we chose it at the start of the project, but ... the format was not approved by the tax authority, there was no explanation for using the format, and therefore the CCP firmware was not ready to support 1.05 even in the test loop. <br><br>  Time passed, but did not become clearer.  The approval date of FFD 1.05 was aggressively shifted, and the deadline was pressed.  A new round of coordination with the financiers, the cash group, and methodologists began.  It was decided to show the amount of payment with gift cards as a discount from the purchase.  But as soon as the revision was completed and the presentation was held, the tax explanation came that it was absolutely impossible to do this.  And having sighed heavily, the team went out together on the weekend and once again swapped the wheels of the bicycle. <br><br><h2>  Additions to the law and confrontations with tax </h2><br>  As I have already said, it cost us to solve some problem, as explanations to the law appeared.  We had to redo it all the time.  But initially we were faced with the fact that lawmakers and tax authorities simply did not have answers to the many questions that had arisen from business.  As a result, the Akit working group emerged, which brought together KCP producers, business and tax specialists. <br><br>  At each meeting, the tax authorities told how it should be from their point of view, then they were puzzled by our questions, they understood that business processes were a little wider than they imagined based on the experience of Rosneft, and took a pause to think.  And when they returned with the answers and other companies started asking clarifying questions, everyone understood that we were again at a deadlock, new questions arose, and the tax office again left to think.  The process was painful, and this was a burden from November to March. <br><br>  And in March, we lost patience when we learned that we would soon start losing stores, if we did not launch the project in the near future, and began to implement, based on the criteria that were at that time. <br><br><h2>  Checks in the online store </h2><br>  In parallel, the second group worked on the implementation of the FZ-54 in online stores.  If earlier checks for online purchases were made their way only if the goods were delivered by courier with a mobile cash desk, then according to the new law, it was required for each purchase to transfer the check to the OFD, tax and client when paying by card on the site, Yandex.Money and other types of electronic payments. <br><br>  Previously, in these cases, the check itself was not.  The purchase was displayed on the company's accounts and was based on the tax base, but this was only visible at the level of our accounting, which independently reduced the calculations to the tax.  And therefore we had no cash registers for online stores.  It was necessary to ride the bike again. <br><br>  In the end, we decided to set up exactly the same cash registers for online stores as in retail.  And in order for the cash departments to physically manage to process all orders, check printing modules were removed from them, since one check is printed for 5-7 seconds.  Then we decided to use the Atol solution: the so-called trusses for parallelizing the work of the cash register and load balancing.  Today Atol has a complete ready-made solution for online stores, but we proceeded from what was on the market at that time. <br><br><h2>  Better sooner than ever </h2><br>  We did the right thing by running in parallel all the work on introducing electronic cash desks: some together with KKT producers thought over how we switch all the stores to the new format, while others were already involved in the procurement of new cash registers and fiscal drives.  Many other companies attended to the purchase later and simply did not have time to get new cash registers by the time the law came into force, because the manufacturers did not have time to physically meet the demand that had arisen at once. <br><br>  In our difficult quest there were two very important dates: <br><br><ul><li>  February 1, 2017 - starting from this day it was forbidden to register old-style cash registers. </li><li>  July 1, 2017 - on this fateful day, all the cash registers had to work on the new software. </li></ul><br>  The period from February 1 to July 1 was very tense.  First of all, we didn‚Äôt have software for new cash registers yet.  However, the box office too.  And after February 1, it was already planned to open several stores. <br><br>  Until February 1, we tried to read: we bought cash desks from the EKLZ and tried to register them in advance, before opening the stores.  But to do this without the address of the store and the lease agreement was impossible.  Therefore, we either asked to move the opening date closer to July 1, or thought up some tricks.  For example, in some stores, they still put cash registers in advance at the address of a nearby store, knowing that we would end up with fines, but at least there were registered cash desks where you can open a store.  And paying the fine for the mismatch of the address was much easier than not opening the store on time or trading with non-certified cash registers. <br><br>  Add to this one more factor: from February 1 to July 1, the part of the cash desks of four hundred stores was about to expire.  All the stores had to be carried out through the inventory, identify the date of expiry of the validity period of the EKLZ at each cash desk, and, if possible, replace them before the law entered into force. <br><br>  Before the New Year, the replacement process went off with a bang, we painlessly replaced the EKLZ at a part of the cash registers with new ones.  Many other companies have been doing the same.  Although it was legal, the tax quickly realized what was happening, and covered this shop.  Now it was possible to change the ECDS or the cash desk itself only for a serious reason: if the cash desk is broken or the period of the EKLZ has come to an end. <br><br>  Then the letters went to the financial directorate to the tax authorities in the regions, private contracts with the TEC, in especially difficult cases, they even thought of resorting to cash consolation: in the shops of ‚Äúaccidentally‚Äù dropping something heavy or shed hot tea in the shops. <br><br>  Deadlines were running out, we did not have time to finish the cash software.  We understood that from the middle of April in a number of stores a part of cash desks will be decommissioned, but there is no swing fund.  It would seem that there is a terrible thing: there are four cash registers in the store, one has been removed, three are left, you can work.  But in one far from perfect moment in one of the large stores with 12 cash registers out of order 8. The remaining four were categorically not enough for timely customer service.  Hour X from July 1 shifted to April. <br><br>  And it soon became clear that in March three stores would stand completely, if not replace cash registers and introduce new requirements of the Federal Law No. 54 in these stores. <br><br><img src="https://habrastorage.org/web/ff5/a2e/1e0/ff5a2e1e0ad84a07a8df6db571b5ee98.jpg"><br><br><h2>  Avral and his team </h2><br>  And we switched to the 24 x 7 mode of operation. All the new cash registers coming from the suppliers went first to distant regions of the country, and the Moscow stores put at the end of the line.  At the same time, it was necessary to solve the problem of remote registration of cash registers, because it was no longer possible to do this centrally, as part of the cash registers was going full speed to the regions.  It only remained to give the initiative in the hands of the directors of the stores, so that they independently take care of the registration.  But for this, each director needed to issue a cryptographic key, because registering a cash register is a serious matter, it‚Äôs not up to you to create an account in the messenger. <br><br>  Additionally, it turned out that the cash registers, already sent to the regions, had an old firmware - after all, the procurement contract was concluded about when th, and since then a lot of water and firmware has flowed.  And to register all devices now need to reflash. <br><br>  It was necessary to create a team of heroes of technical support who, in the mode of achievement, traveled to the branches and reflashed the newly arrived ticket offices.  In order not to occupy the operating cash desks, registration was performed at the workplace of the senior cashier.  To do this, it was necessary to quickly retool, reconfigure ports, install the necessary software.  Registered devices lined up in a row, connected to the network and registered.  It happened that there were not enough cables, and they had to be taken directly from the shop windows. <br><br>  There was a catastrophic shortage of people and time, we practically paralyzed the work of the technical support of the stores, while we and the engineers were debugging the process of reflashing and registration.  On the go, instructions and schedules for arrival of specialists and transition of stores to new cash registers were drawn up and changed.  Employees themselves coped with the last procedure in some branches, and in others employees categorically refused to dive under the tables, pull out wires, remove old cash desks, install and connect new ones. <br><br><h2>  Cleaner in the server room </h2><br>  The crisis has receded, the stores are provided with new cash registers, checks make their way.  And suddenly it turned out that at some points information about checks is not sent to the tax office.  Began to understand the field.  In one store, someone walked, stumbled over a network cable, and he flew out of the connector.  In another store, the network equipment is under-configured, in the third one there is just an unstable network connection, and in the fourth something else.  But as a result, checks have not been sent for a couple of days.  Of course, all the information is stored on the fiscal drive, and as soon as the connection appears, everything will be left to the fiscal data operator. <br><br>  But if the cash desk does not transfer anything to the tax office for 30 days, then it is automatically blocked for sales. <br><br>  When there were not many stores that had switched to the new cash registers, we looked after them with the whole team, like babies in a manger, and it was possible to manually monitor unclosed cash shifts every day.  And when the number of cash registers amounts to many hundreds, you will not follow all of them.  We had to urgently refine the software: if at the end of the day the data is not sent to the fiscal operator, our cashiers receive a notification so that they can contact technical support. <br><br>  From this point on, tech support began to ‚Äúlove‚Äù us even more. <br><br><img src="https://habrastorage.org/web/2fa/5df/6d4/2fa5df6d46274696aeea01c4f366a9a6.jpg"><br><br><h2>  What have we come to and where are we going </h2><br>  Now we have all the stores transferred to new cash registers.  So far, we are working only with Atols, although this is totally contrary to our anti-monopoly policy.  The ‚ÄúStrokes‚Äù taken off the register were inventoried: those who are more than 5 years old were disposed of, and the more recent ones were tested and prepared for modernization.  We will write software for them, we will call the TEC specialists, they will insert fiscal drives and seal them, this will be a reserve fund.  We have already learned from bitter experience, when our previous supplier simply did not communicate with us on the delivery of new cash registers at the end of last year, although the supply contract was still in force.  In addition, cash registers can break (they themselves, honestly!), They have to be repaired or changed. <br><br>  The current version of the format of fiscal data 1.0 is valid until January 1, 2019, so we will soon begin work on the transition to version 1.05.  There are more tags in it, in particular, there is a description of the commission of goods, the concept of separation of forms of payments and much more that we need.  This will allow you to use a larger number of filters in your tax reports. <br><br>  Today we have only two forms of payment: cash and electronic means of payment.  The second category includes advances, loans, bank cards, Yandex.Money, Kiwi wallets and so on.  Therefore, to understand at the level of the operator of fiscal data, what is what - just mission impossible.  And this complicates the netting with the tax. <br><br>  By law, if a client wants to receive a check in electronic form, then we must send either an SMS or an email with the key parameters of this check.  Everything is simple with the mail, we can send a very beautiful picture of the check, and it looks like a real paper check.  But the same SMS is a very expensive pleasure.  If you send too much information, you will have to pay not for one message, but for several, so we decided to send only 5 fiscal signs that uniquely identify the check.  Also, these signs are sewn into a QR code that is printed on the check. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/2b7/20a/78b/2b720a78b3bd437195dad53400fcff9f.jpeg"></div><br><br>  So if you wish, any person can immediately get all the information on the check by scanning the code or typing 5 fiscal signs of the check manually in the mobile application of the tax service ‚ÄúCheck Checks‚Äù.  By the way, the scheme works so far that is not perfect. <br><br>  We have not yet implemented sending SMS on our own, because the introduction of this feature requires a large amount of work to create a sending service at the cash desks, implement monitoring of timely sending, and forced re-sending in case of failure. <br><br>  But this is all waiting for us to come. <br><br>  And now, turning back, I see that even in such a task ‚Äî with many unknowns, with sharply shifting deadlines, with equipment and partners changing on the move ‚Äî it is possible to observe quality and deadlines, perform quick and competent implementation.  There are no unsolvable tasks if people are ready to work and go to the goal set for them!  I am proud of the result of the work we have done!  This experience is invaluable for all participants. </div><p>Source: <a href="https://habr.com/ru/post/338472/">https://habr.com/ru/post/338472/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338454/index.html">The book "ASP.NET Core. Application Development"</a></li>
<li><a href="../338460/index.html">Automate penetration testing with apt2</a></li>
<li><a href="../338462/index.html">JavaScript scope and closures</a></li>
<li><a href="../338468/index.html">Do you need financial data?</a></li>
<li><a href="../338470/index.html">Recommendations on Avito</a></li>
<li><a href="../338478/index.html">"Invisible design": we design together with cars</a></li>
<li><a href="../338480/index.html">Kali Linux: filtering traffic using netfilter</a></li>
<li><a href="../338482/index.html">Comodo Group reports a fourfold increase in the number of cyber threats</a></li>
<li><a href="../338484/index.html">Fujitsu will build a supercomputer for the study of artificial intelligence</a></li>
<li><a href="../338488/index.html">IT Championship "Racing Heroes", or the first project LANIT on the military ground "Alabino"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>