<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>New look at javascript injection</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently I ran into the following task - there is a JavaScript object actions with a bunch of methods, in each of which the following variables should...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>New look at javascript injection</h1><div class="post__text post__text-html js-mediator-article">  Recently I ran into the following task - there is a JavaScript object actions with a bunch of methods, in each of which the following variables should be defined: <br><br><blockquote><pre> var persik = this,     
       actions = persik.actions,      
       next = (persik.dom. possibleOther whatTo.name of thisMethod.next)? 
           persik.dom. possible Else what else.This MethodName.next: function () {return false}; 
</pre></blockquote><br><br>  But I really didn‚Äôt want to define them, because firstly, the code is noticeably weary, and secondly, the actions object was created for future users of my Persik framework, and as it is supposed, everyone will be able not only to use ready-made actions methods, but also define their own. <a name="habracut"></a>  You can of course write in the documentation ‚Äúguys, please insert these lines at the beginning of each method you create,‚Äù or not create any variables at all and write this instead (although there may be problems with this in some cases), write instead .actions, and instead of calling next () blurt out something like: <br>  if (this.dom. possibleOtherThatTo.name of ThisMethod.next) this.dom.possibleOtherThatTo.name of ThisMethod.next (); <br>  But all this is terribly not beautiful and wrong, and I decided to take a different path.  The idea is simple - when initializing the framework, go through all the methods of the actions object, use toString () to get each method as a string, impudently insert the necessary lines of variable definitions there, make a function again with eval () and replace the existing method with a modified one.  I will not give the source code of the search methods within the actions in my framework so as not to bore the public, but the modification of the methods looks like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote><pre> _rewriteFunc: function (func, funcName, variablesStr) {     
       var funcArr = func.toString (). split ('{');     
       variablesStr = variablesStr.replace (/ \ [funcName \] / g, funcName);     
       funcArr [1] = variablesStr + funcArr [1];               
       var resultFunc = funcArr.join ('{');     
       eval ('var a =' + resultFunc);         
       return a; 
 },
</pre></blockquote><br><br>  Here, func is the actually modified method, the name of this method is passed to funcName, and all parents are considered, i.e.  the same this.dom. is possible Else what else.ThisMethod name, and variablesStr contains a string with variables that we define.  In my case, this is' var persik = this;  var actions = persik.actions;  var next = ([funcName] .next)?  [funcName] .next: function () {return false};  '.  The function described above replaces all '[funcName]' with funcName in variablesStr, inserts variablesStr into resultFunc after the first '{' character, collects the function from the string again and returns it.  The object of actions, on which all the above-mentioned perversions are made, can be found here: <a href="">nikitaeremin.com/js/action.js</a> <br><br>  This technique has a number of disadvantages: <br>  - the variables persik, actions and next are created in all methods of the actions object, although in some methods they may remain unclaimed; <br>  - the source code of JavaScript changes, and if errors occur during the runtime period, FireBug will not swear at all on the lines that actually caused the error, although the cause of the error is correct; <br>  - other minuses to me now will tell habraskobschestvennost :) <br><br>  I do not think that the trick described above is applicable to a wide range of tasks, this article is more likely for general development, but if someone wants to share ideas about other areas of application of such injections, write to soap: nikitaeremin [at] gmail.com </div><p>Source: <a href="https://habr.com/ru/post/52256/">https://habr.com/ru/post/52256/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../52247/index.html">Tear off his head!</a></li>
<li><a href="../52248/index.html">Service - refuse ICQ</a></li>
<li><a href="../52251/index.html">Instead of body armor</a></li>
<li><a href="../52253/index.html">Help me choose a conceptual approach to the blog and its design. Business lynch from habrapovateley.</a></li>
<li><a href="../52254/index.html">New employee of the London Museum of Science</a></li>
<li><a href="../52257/index.html">Futuristic Tokyoflash Aluminum LED Watch</a></li>
<li><a href="../52258/index.html">About the diacritical marks</a></li>
<li><a href="../52259/index.html">A little task for webmasters</a></li>
<li><a href="../52262/index.html">Testing OpenID support from Windows Live ID</a></li>
<li><a href="../52263/index.html">TV program at hand</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>