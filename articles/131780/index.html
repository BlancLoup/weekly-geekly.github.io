<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing a web server in Common Lisp part two</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the last article we started developing our web server. We continue with the file util.lisp. This package will contain all our support functions for...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing a web server in Common Lisp part two</h1><div class="post__text post__text-html js-mediator-article">  In the <a href="http://habrahabr.ru/blogs/lisp/131586/">last article</a> we started developing our web server.  We continue with the file util.lisp.  This package will contain all our support functions for processing requests.  First, let's declare the variable * line *, we will need it in the future. <a name="habracut"></a><pre><code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defvar</span></span> *new-line* (<span class="hljs-name"><span class="hljs-name">concatenate</span></span> 'string (<span class="hljs-name"><span class="hljs-name">string</span></span> #\Return) (<span class="hljs-name"><span class="hljs-name">string</span></span> #\Newline)))</code> </pre> <br>  We also need a function that will read the bytes from the stream in utf-8 and convert them to a string using the <b>trivial-utf-8</b> function <b>: utf-8-bytes-to-string</b> . <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defun</span></span> read-utf-8-string (<span class="hljs-name"><span class="hljs-name">stream</span></span> <span class="hljs-symbol"><span class="hljs-symbol">&amp;optional</span></span> (<span class="hljs-name"><span class="hljs-name">end</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>)) (<span class="hljs-name"><span class="hljs-name">let</span></span> ((<span class="hljs-name"><span class="hljs-name">byte</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>) (<span class="hljs-name"><span class="hljs-name">buffer</span></span> (<span class="hljs-name"><span class="hljs-name">make-array</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:fill-pointer</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:adjustable</span></span> <span class="hljs-literal"><span class="hljs-literal">t</span></span>))) (<span class="hljs-name"><span class="hljs-name">handler-case</span></span> (<span class="hljs-name"><span class="hljs-name">loop</span></span> do (<span class="hljs-name"><span class="hljs-name">setq</span></span> byte (<span class="hljs-name"><span class="hljs-name">read-byte</span></span> stream)) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">/=</span></span> byte end) (<span class="hljs-name"><span class="hljs-name">vector-push-extend</span></span> byte buffer)) while (<span class="hljs-name"><span class="hljs-name">/=</span></span> byte end)) (<span class="hljs-name"><span class="hljs-name">end-of-file</span></span> ())) (<span class="hljs-name"><span class="hljs-name">trivial-utf-8</span></span><span class="hljs-symbol"><span class="hljs-symbol">:utf-8-bytes-to-string</span></span> buffer)))</code> </pre>  All we do is just read the bytes before we hit the byte with the value end and convert the resulting byte array to a string.  You can write this function in a different way (more efficiently), but I have such an option.  If you have good ideas I will be glad to see them in the comments.  Declare another function <pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defun</span></span> response-write (<span class="hljs-name"><span class="hljs-name">text</span></span> stream) (<span class="hljs-name"><span class="hljs-name">trivial-utf-8</span></span><span class="hljs-symbol"><span class="hljs-symbol">:write-utf-8-bytes</span></span> text stream))</code> </pre>  She will help us write answers to the client in the same format (utf-8) <br><br>  Our web server will be able to handle only GET requests.  If it is interesting to someone, he can write processing POST requests, but for now we still limit ourselves to GET requests.  A typical HTTP GET request looks like this. <br><pre> <code class="hljs tex">GET /path/to/a/resource?param1=paramvalue1¬∂m1=paramvalu2 HTTP/1.1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span></span> HeaderName: HeaderValue <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span></span> .... HeaderName: HeaderValue <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span></span> <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span></span></code> </pre>  The first thing we do is find out what type of request we came to the web server. <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defun</span></span> parse-request (<span class="hljs-name"><span class="hljs-name">stream</span></span>) (<span class="hljs-name"><span class="hljs-name">let</span></span> ((<span class="hljs-name"><span class="hljs-name">header</span></span> (<span class="hljs-name"><span class="hljs-name">read-utf-8-string</span></span> stream <span class="hljs-number"><span class="hljs-number">10</span></span>))) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">eq</span></span> (<span class="hljs-name"><span class="hljs-name">length</span></span> header) <span class="hljs-number"><span class="hljs-number">0</span></span>) '() (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">equal</span></span> (<span class="hljs-name"><span class="hljs-name">subseq</span></span> header <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-string"><span class="hljs-string">"POST"</span></span>) (<span class="hljs-name"><span class="hljs-name">parse-post-header</span></span> header stream) (<span class="hljs-name"><span class="hljs-name">parse-get-header</span></span> header stream)))))</code> </pre><br>  For POST requests, we are not going to do anything, so we‚Äôll write a simple function <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defun</span></span> parse-post-header (<span class="hljs-name"><span class="hljs-name">header</span></span> stream) (<span class="hljs-name"><span class="hljs-name">cons</span></span> <span class="hljs-string"><span class="hljs-string">"POST"</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>))</code> </pre><br>  For a GET request, we need to get the path of the requested resource and all other headers. <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defun</span></span> parse-get-header (<span class="hljs-name"><span class="hljs-name">header</span></span> stream) (<span class="hljs-name"><span class="hljs-name">cons</span></span> <span class="hljs-string"><span class="hljs-string">"GET"</span></span> (<span class="hljs-name"><span class="hljs-name">cons</span></span> (<span class="hljs-name"><span class="hljs-name">parse-path</span></span> (<span class="hljs-name"><span class="hljs-name">subseq</span></span> header (<span class="hljs-name"><span class="hljs-name">position</span></span> #\/ header) (<span class="hljs-name"><span class="hljs-name">position</span></span> #\Space header <span class="hljs-symbol"><span class="hljs-symbol">:from-end</span></span> <span class="hljs-literal"><span class="hljs-literal">t</span></span>))) (<span class="hljs-name"><span class="hljs-name">parse-headers</span></span> stream))))</code> </pre>  To do this, we will use the <b>parse-path</b> and <b>parse-headers</b> functions. <br><br>  Let's start with <b>parse-path</b> <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defun</span></span> parse-path (<span class="hljs-name"><span class="hljs-name">path</span></span>) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">position</span></span> #\? path) (<span class="hljs-name"><span class="hljs-name">cons</span></span> (<span class="hljs-name"><span class="hljs-name">subseq</span></span> path <span class="hljs-number"><span class="hljs-number">0</span></span> (<span class="hljs-name"><span class="hljs-name">position</span></span> #\? path)) (<span class="hljs-name"><span class="hljs-name">parse-params</span></span> (<span class="hljs-name"><span class="hljs-name">subseq</span></span> path (<span class="hljs-number"><span class="hljs-number">1</span></span>+ (<span class="hljs-name"><span class="hljs-name">position</span></span> #\? path))))) (<span class="hljs-name"><span class="hljs-name">cons</span></span> path <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)))</code> </pre>  As you can see here we are separating the path from the parameters and parsing the parameters separately with the <b>parse-params</b> function. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Before we start parsing the parameters, we need another auxiliary function to convert the characters used in the parameters in hexadecimal form into their immediate values. <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defun</span></span> http-char (<span class="hljs-name"><span class="hljs-name">c1</span></span> c2 <span class="hljs-symbol"><span class="hljs-symbol">&amp;optional</span></span> (<span class="hljs-name"><span class="hljs-name">default</span></span> #\Space)) (<span class="hljs-name"><span class="hljs-name">let</span></span> ((<span class="hljs-name"><span class="hljs-name">code</span></span> (<span class="hljs-name"><span class="hljs-name">parse-integer</span></span> (<span class="hljs-name"><span class="hljs-name">coerce</span></span> (<span class="hljs-name"><span class="hljs-name">list</span></span> c1 c2) 'string) <span class="hljs-symbol"><span class="hljs-symbol">:radix</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:junk-allowed</span></span> <span class="hljs-literal"><span class="hljs-literal">t</span></span>))) (<span class="hljs-name"><span class="hljs-name">if</span></span> code (<span class="hljs-name"><span class="hljs-name">code-char</span></span> code) default)))</code> </pre>  This function can be called <b>http-char-decode</b> <br><br>  It now remains to turn our parameters into alist. <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defun</span></span> parse-params (<span class="hljs-name"><span class="hljs-name">s</span></span>) (<span class="hljs-name"><span class="hljs-name">let</span></span> ((<span class="hljs-name"><span class="hljs-name">params</span></span> (<span class="hljs-name"><span class="hljs-name">decode-params</span></span> s))) (<span class="hljs-name"><span class="hljs-name">remove-duplicates</span></span> params <span class="hljs-symbol"><span class="hljs-symbol">:test</span></span> (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">x1</span></span> x2) (<span class="hljs-name"><span class="hljs-name">equal</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> x1) (<span class="hljs-name"><span class="hljs-name">car</span></span> x2))) <span class="hljs-symbol"><span class="hljs-symbol">:from-end</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>))) (<span class="hljs-name"><span class="hljs-name">defun</span></span> decode-params (<span class="hljs-name"><span class="hljs-name">s</span></span>) (<span class="hljs-name"><span class="hljs-name">let</span></span> ((<span class="hljs-name"><span class="hljs-name">p1</span></span> (<span class="hljs-name"><span class="hljs-name">position</span></span> #\&amp; s))) (<span class="hljs-name"><span class="hljs-name">if</span></span> p1 (<span class="hljs-name"><span class="hljs-name">cons</span></span> (<span class="hljs-name"><span class="hljs-name">decode-kv</span></span> (<span class="hljs-name"><span class="hljs-name">subseq</span></span> s <span class="hljs-number"><span class="hljs-number">0</span></span> p1)) (<span class="hljs-name"><span class="hljs-name">parse-params</span></span> (<span class="hljs-name"><span class="hljs-name">subseq</span></span> s (<span class="hljs-number"><span class="hljs-number">1</span></span>+ p1)))) (<span class="hljs-name"><span class="hljs-name">list</span></span> (<span class="hljs-name"><span class="hljs-name">decode-kv</span></span> s))))) (<span class="hljs-name"><span class="hljs-name">defun</span></span> decode-kv (<span class="hljs-name"><span class="hljs-name">s</span></span>) (<span class="hljs-name"><span class="hljs-name">let</span></span> ((<span class="hljs-name"><span class="hljs-name">p1</span></span> (<span class="hljs-name"><span class="hljs-name">position</span></span> #\= s))) (<span class="hljs-name"><span class="hljs-name">if</span></span> p1 (<span class="hljs-name"><span class="hljs-name">cons</span></span> (<span class="hljs-name"><span class="hljs-name">decode-param</span></span> (<span class="hljs-name"><span class="hljs-name">subseq</span></span> s <span class="hljs-number"><span class="hljs-number">0</span></span> p1)) (<span class="hljs-name"><span class="hljs-name">decode-param</span></span> (<span class="hljs-name"><span class="hljs-name">subseq</span></span> s (<span class="hljs-number"><span class="hljs-number">1</span></span>+ p1)))) (<span class="hljs-name"><span class="hljs-name">cons</span></span> (<span class="hljs-name"><span class="hljs-name">decode-param</span></span> s) <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)))) (<span class="hljs-name"><span class="hljs-name">defun</span></span> decode-param (<span class="hljs-name"><span class="hljs-name">s</span></span>) (<span class="hljs-name"><span class="hljs-name">labels</span></span> ((<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>st) (<span class="hljs-name"><span class="hljs-name">when</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>st (<span class="hljs-name"><span class="hljs-name">case</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>st) (<span class="hljs-name"><span class="hljs-name">#</span></span>\% (<span class="hljs-name"><span class="hljs-name">cons</span></span> (<span class="hljs-name"><span class="hljs-name">http-char</span></span> (<span class="hljs-name"><span class="hljs-name">cadr</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>st) (<span class="hljs-name"><span class="hljs-name">caddr</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>st)) (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">cdddr</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>st)))) (<span class="hljs-name"><span class="hljs-name">#</span></span>\+ (<span class="hljs-name"><span class="hljs-name">cons</span></span> #\Space (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">cdr</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>st)))) (<span class="hljs-name"><span class="hljs-name">otherwise</span></span> (<span class="hljs-name"><span class="hljs-name">cons</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>st) (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">cdr</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>st)))))))) (<span class="hljs-name"><span class="hljs-name">coerce</span></span> (<span class="hljs-name"><span class="hljs-name">f</span></span> (<span class="hljs-name"><span class="hljs-name">coerce</span></span> s 'list)) 'string)))</code> </pre>  As you can see, we use <b>decode-params</b> for this, which in turn calls recursively <b>parse-params</b> again by first parsing the name = value parameter using <b>decode-kv</b> .  At the end, the <b>decode-param</b> helper function is <b>used</b> to separate the special http characters and convert them using http-char to return the already converted data. <br><br>  Our <b>parse-params is</b> ready, it remains to write the function <b>parse-headers</b> , everything is much simpler here <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defun</span></span> parse-headers (<span class="hljs-name"><span class="hljs-name">stream</span></span>) (<span class="hljs-name"><span class="hljs-name">let</span></span> ((<span class="hljs-name"><span class="hljs-name">headers</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) (<span class="hljs-name"><span class="hljs-name">header</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) (<span class="hljs-name"><span class="hljs-name">loop</span></span> do (<span class="hljs-name"><span class="hljs-name">setq</span></span> header (<span class="hljs-name"><span class="hljs-name">read-utf-8-string</span></span> stream <span class="hljs-number"><span class="hljs-number">10</span></span>)) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">&gt;</span></span> (<span class="hljs-name"><span class="hljs-name">length</span></span> header) <span class="hljs-number"><span class="hljs-number">2</span></span>) (<span class="hljs-name"><span class="hljs-name">setq</span></span> headers (<span class="hljs-name"><span class="hljs-name">cons</span></span> (<span class="hljs-name"><span class="hljs-name">parse-header</span></span> header) headers))) while (<span class="hljs-name"><span class="hljs-name">&gt;</span></span> (<span class="hljs-name"><span class="hljs-name">length</span></span> header) <span class="hljs-number"><span class="hljs-number">2</span></span>)) (<span class="hljs-name"><span class="hljs-name">reverse</span></span> headers))) (<span class="hljs-name"><span class="hljs-name">defun</span></span> parse-header (<span class="hljs-name"><span class="hljs-name">header</span></span>) (<span class="hljs-name"><span class="hljs-name">let</span></span> ((<span class="hljs-name"><span class="hljs-name">pos</span></span> (<span class="hljs-name"><span class="hljs-name">position</span></span> #\: header))) (<span class="hljs-name"><span class="hljs-name">if</span></span> pos (<span class="hljs-name"><span class="hljs-name">cons</span></span> (<span class="hljs-name"><span class="hljs-name">string-downcase</span></span> (<span class="hljs-name"><span class="hljs-name">subseq</span></span> header <span class="hljs-number"><span class="hljs-number">0</span></span> pos)) (<span class="hljs-name"><span class="hljs-name">string-trim</span></span> (<span class="hljs-name"><span class="hljs-name">concatenate</span></span> 'string (<span class="hljs-name"><span class="hljs-name">string</span></span> #\Space) (<span class="hljs-name"><span class="hljs-name">string</span></span> #\Return)) (<span class="hljs-name"><span class="hljs-name">subseq</span></span> header (<span class="hljs-number"><span class="hljs-number">1</span></span>+ pos)))))))</code> </pre>  We first take a string using (read-utf-8-string stream 10), where 10 is the value of \ n in ASCII and if it is more than two characters, parse it with the help of parse-header.  As a result, we obtain the alist of all headers. <br><br>  At this <b>parse-get-header is</b> ready and should return a type structure <br><pre> <code class="lisp hljs">'(<span class="hljs-string"><span class="hljs-string">"GET"</span></span> (<span class="hljs-string"><span class="hljs-string">"path/to/file"</span></span> ((<span class="hljs-string"><span class="hljs-string">"param1"</span></span> . <span class="hljs-string"><span class="hljs-string">"value1"</span></span>) (<span class="hljs-string"><span class="hljs-string">"param2"</span></span> . <span class="hljs-string"><span class="hljs-string">"value2"</span></span>))) ((<span class="hljs-string"><span class="hljs-string">"header1"</span></span> . <span class="hljs-string"><span class="hljs-string">"value1"</span></span>) (<span class="hljs-string"><span class="hljs-string">"header2"</span></span> . <span class="hljs-string"><span class="hljs-string">"value2"</span></span>)))</code> </pre><br>  For convenience of working with this structure, add two auxiliary functions. <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defun</span></span> get-param (<span class="hljs-name"><span class="hljs-name">name</span></span> request) (<span class="hljs-name"><span class="hljs-name">cdr</span></span> (<span class="hljs-name"><span class="hljs-name">assoc</span></span> name (<span class="hljs-name"><span class="hljs-name">cdadr</span></span> request) <span class="hljs-symbol"><span class="hljs-symbol">:test</span></span> #'equal))) (<span class="hljs-name"><span class="hljs-name">defun</span></span> get-header (<span class="hljs-name"><span class="hljs-name">name</span></span> request) (<span class="hljs-name"><span class="hljs-name">cdr</span></span> (<span class="hljs-name"><span class="hljs-name">assoc</span></span> (<span class="hljs-name"><span class="hljs-name">string-downcase</span></span> name) (<span class="hljs-name"><span class="hljs-name">cddr</span></span> request) <span class="hljs-symbol"><span class="hljs-symbol">:test</span></span> #'equal)))</code> </pre><br>  Now that we have a request, we can send a response to the client.  A typical answer looks like this. <br><pre> <code class="hljs tex">HTTP/1.1 200 OK HeaderName: HeaderValue <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span></span> .... HeaderName: HeaderValue <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span></span> <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span></span> Data</code> </pre><br>  Let's write a couple of auxiliary functions that will help us with the answers. <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defun</span></span> http-response (<span class="hljs-name"><span class="hljs-name">code</span></span> headers stream) (<span class="hljs-name"><span class="hljs-name">response-write</span></span> (<span class="hljs-name"><span class="hljs-name">concatenate</span></span> 'string <span class="hljs-string"><span class="hljs-string">"HTTP/1.1 "</span></span> code *new-line*) stream) (<span class="hljs-name"><span class="hljs-name">mapcar</span></span> (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">header</span></span>) (<span class="hljs-name"><span class="hljs-name">response-write</span></span> (<span class="hljs-name"><span class="hljs-name">concatenate</span></span> 'string (<span class="hljs-name"><span class="hljs-name">car</span></span> header) <span class="hljs-string"><span class="hljs-string">": "</span></span> (<span class="hljs-name"><span class="hljs-name">cdr</span></span> header) *new-line*) stream)) headers) (<span class="hljs-name"><span class="hljs-name">response-write</span></span> *new-line* stream)) (<span class="hljs-name"><span class="hljs-name">defun</span></span> http-404-not-found (<span class="hljs-name"><span class="hljs-name">message</span></span> stream) (<span class="hljs-name"><span class="hljs-name">http-response</span></span> <span class="hljs-string"><span class="hljs-string">"404 Not Found"</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> stream) (<span class="hljs-name"><span class="hljs-name">response-write</span></span> message stream))</code> </pre>  As you can see here, everything is also simple. <br><br>  It now remains to write a function that will give us files from the <b>web</b> directory. <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defun</span></span> file-response (<span class="hljs-name"><span class="hljs-name">filename</span></span> type request stream) (<span class="hljs-name"><span class="hljs-name">handler-case</span></span> (<span class="hljs-name"><span class="hljs-name">with-open-file</span></span> (<span class="hljs-name"><span class="hljs-name">in</span></span> (<span class="hljs-name"><span class="hljs-name">concatenate</span></span> 'string <span class="hljs-string"><span class="hljs-string">"web/"</span></span> filename) <span class="hljs-symbol"><span class="hljs-symbol">:element-type</span></span> '(unsigned-byte <span class="hljs-number"><span class="hljs-number">8</span></span>)) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">equal</span></span> (<span class="hljs-name"><span class="hljs-name">get-header</span></span> <span class="hljs-string"><span class="hljs-string">"if-modified-since"</span></span> request) (<span class="hljs-name"><span class="hljs-name">format-timestring</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> (<span class="hljs-name"><span class="hljs-name">universal-to-timestamp</span></span> (<span class="hljs-name"><span class="hljs-name">file-write-date</span></span> in)) <span class="hljs-symbol"><span class="hljs-symbol">:format</span></span> +asctime-format+)) (<span class="hljs-name"><span class="hljs-name">http-response</span></span> <span class="hljs-string"><span class="hljs-string">"304 Not Modified"</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> stream) (<span class="hljs-name"><span class="hljs-name">progn</span></span> (<span class="hljs-name"><span class="hljs-name">http-response</span></span> <span class="hljs-string"><span class="hljs-string">"200 OK"</span></span> (<span class="hljs-name"><span class="hljs-name">cons</span></span> (<span class="hljs-name"><span class="hljs-name">cons</span></span> <span class="hljs-string"><span class="hljs-string">"Last-Modified"</span></span> (<span class="hljs-name"><span class="hljs-name">format-timestring</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> (<span class="hljs-name"><span class="hljs-name">universal-to-timestamp</span></span> (<span class="hljs-name"><span class="hljs-name">file-write-date</span></span> in)) <span class="hljs-symbol"><span class="hljs-symbol">:format</span></span> +asctime-format+)) (<span class="hljs-name"><span class="hljs-name">cons</span></span> (<span class="hljs-name"><span class="hljs-name">cons</span></span> <span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span> type) <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) stream) (<span class="hljs-name"><span class="hljs-name">let</span></span> ((<span class="hljs-name"><span class="hljs-name">buf</span></span> (<span class="hljs-name"><span class="hljs-name">make-array</span></span> <span class="hljs-number"><span class="hljs-number">4096</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:element-type</span></span> (<span class="hljs-name"><span class="hljs-name">stream-element-type</span></span> in)))) (<span class="hljs-name"><span class="hljs-name">loop</span></span> for pos = (<span class="hljs-name"><span class="hljs-name">read-sequence</span></span> buf in) while (<span class="hljs-name"><span class="hljs-name">plusp</span></span> pos) do (<span class="hljs-name"><span class="hljs-name">write-sequence</span></span> buf stream <span class="hljs-symbol"><span class="hljs-symbol">:end</span></span> pos))) ))) (<span class="hljs-name"><span class="hljs-name">file-error</span></span> () (<span class="hljs-name"><span class="hljs-name">http-404-not-found</span></span> <span class="hljs-string"><span class="hljs-string">"404 File Not Found"</span></span> stream) )))</code> </pre>  This will allow our web server to return files such as images and html pages.  At the same time, we also return the Last-Modified header with the date of the last modification of the file.  If we receive a request for the same file a second time with the if-modified-since header, we will time the date with the last file modification date.  If the date has not changed, this means that the web browser has the latest version of the file in its cache, so we simply return the code 304 Not Modified <br><br>  Now we‚Äôll write the second <b>html-template</b> function that will take any text file from the <b>web</b> directory and replace values ‚Äã‚Äãof the type $ {name} with the values ‚Äã‚Äãspecified in the alist list with the same names.  A kind of primitive template engine <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defun</span></span> html-template (<span class="hljs-name"><span class="hljs-name">filename</span></span> type params request stream) (<span class="hljs-name"><span class="hljs-name">handler-case</span></span> (<span class="hljs-name"><span class="hljs-name">with-open-file</span></span> (<span class="hljs-name"><span class="hljs-name">in</span></span> (<span class="hljs-name"><span class="hljs-name">concatenate</span></span> 'string <span class="hljs-string"><span class="hljs-string">"web/"</span></span> filename) <span class="hljs-symbol"><span class="hljs-symbol">:element-type</span></span> '(unsigned-byte <span class="hljs-number"><span class="hljs-number">8</span></span>)) (<span class="hljs-name"><span class="hljs-name">loop</span></span> for line = (<span class="hljs-name"><span class="hljs-name">read-utf-8-string</span></span> in <span class="hljs-number"><span class="hljs-number">10</span></span>) while (<span class="hljs-name"><span class="hljs-name">and</span></span> line (<span class="hljs-name"><span class="hljs-name">&gt;</span></span> (<span class="hljs-name"><span class="hljs-name">length</span></span> line) <span class="hljs-number"><span class="hljs-number">0</span></span>)) do (<span class="hljs-name"><span class="hljs-name">progn</span></span> (<span class="hljs-name"><span class="hljs-name">mapcar</span></span> (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">i</span></span>) (<span class="hljs-name"><span class="hljs-name">let*</span></span> ((<span class="hljs-name"><span class="hljs-name">key</span></span> (<span class="hljs-name"><span class="hljs-name">concatenate</span></span> 'string <span class="hljs-string"><span class="hljs-string">"${"</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> i) <span class="hljs-string"><span class="hljs-string">"}"</span></span>))) (<span class="hljs-name"><span class="hljs-name">loop</span></span> for pos = (<span class="hljs-name"><span class="hljs-name">search</span></span> key line) while pos do (<span class="hljs-name"><span class="hljs-name">setq</span></span> line (<span class="hljs-name"><span class="hljs-name">concatenate</span></span> 'string (<span class="hljs-name"><span class="hljs-name">subseq</span></span> line <span class="hljs-number"><span class="hljs-number">0</span></span> pos) (<span class="hljs-name"><span class="hljs-name">cdr</span></span> i) (<span class="hljs-name"><span class="hljs-name">subseq</span></span> line (<span class="hljs-name"><span class="hljs-name">+</span></span> pos (<span class="hljs-name"><span class="hljs-name">length</span></span> key))))) ) )) params) (<span class="hljs-name"><span class="hljs-name">response-write</span></span> line stream) (<span class="hljs-name"><span class="hljs-name">response-write</span></span> (<span class="hljs-name"><span class="hljs-name">string</span></span> #\Return) stream)) ) ) (<span class="hljs-name"><span class="hljs-name">file-error</span></span> () (<span class="hljs-name"><span class="hljs-name">http-404-not-found</span></span> <span class="hljs-string"><span class="hljs-string">"404 File Not Found"</span></span> stream) )))</code> </pre><br>  On this our <b>util.lisp is</b> almost ready, it remains only to write functions for logs.  Let's start with the <b>cl-log</b> configuration in the <b>log.lisp</b> file <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">setf</span></span> (<span class="hljs-name"><span class="hljs-name">log-manager</span></span>) (<span class="hljs-name"><span class="hljs-name">make-instance</span></span> 'log-manager <span class="hljs-symbol"><span class="hljs-symbol">:message-class</span></span> 'formatted-message)) (<span class="hljs-name"><span class="hljs-name">start-messenger</span></span> 'text-file-messenger <span class="hljs-symbol"><span class="hljs-symbol">:filename</span></span> <span class="hljs-string"><span class="hljs-string">"log/web.log"</span></span>) (<span class="hljs-name"><span class="hljs-name">defmethod</span></span> format-message ((<span class="hljs-name"><span class="hljs-name">self</span></span> formatted-message)) (<span class="hljs-name"><span class="hljs-name">format</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-string"><span class="hljs-string">"~a ~a ~?~&amp;"</span></span> (<span class="hljs-name"><span class="hljs-name">local-time</span></span><span class="hljs-symbol"><span class="hljs-symbol">:format-timestring</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> (<span class="hljs-name"><span class="hljs-name">local-time</span></span><span class="hljs-symbol"><span class="hljs-symbol">:universal-to-timestamp</span></span> (<span class="hljs-name"><span class="hljs-name">timestamp-universal-time</span></span> (<span class="hljs-name"><span class="hljs-name">message-timestamp</span></span> self)))) (<span class="hljs-name"><span class="hljs-name">message-category</span></span> self) (<span class="hljs-name"><span class="hljs-name">message-description</span></span> self) (<span class="hljs-name"><span class="hljs-name">message-arguments</span></span> self)))</code> </pre>  Everything is standard here, the only thing that we changed is the format-message where we just print the date in formatted form. <br><br>  Now we will add to util.lisp a logging function that will log messages in a separate stream, but no more than once per second.  That will remove the burden of logging directly <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defvar</span></span> *log-queue-lock* (<span class="hljs-name"><span class="hljs-name">bt</span></span><span class="hljs-symbol"><span class="hljs-symbol">:make-lock</span></span>)) (<span class="hljs-name"><span class="hljs-name">defvar</span></span> *log-queue-cond* (<span class="hljs-name"><span class="hljs-name">bt</span></span><span class="hljs-symbol"><span class="hljs-symbol">:make-condition-variable</span></span>)) (<span class="hljs-name"><span class="hljs-name">defvar</span></span> *log-queue-cond-lock* (<span class="hljs-name"><span class="hljs-name">bt</span></span><span class="hljs-symbol"><span class="hljs-symbol">:make-lock</span></span>)) (<span class="hljs-name"><span class="hljs-name">defvar</span></span> *log-queue* <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) (<span class="hljs-name"><span class="hljs-name">defvar</span></span> *log-queue-time* (<span class="hljs-name"><span class="hljs-name">get-universal-time</span></span>)) (<span class="hljs-name"><span class="hljs-name">defun</span></span> log-worker () (<span class="hljs-name"><span class="hljs-name">bt</span></span><span class="hljs-symbol"><span class="hljs-symbol">:with-lock-held</span></span> (<span class="hljs-name"><span class="hljs-name">*log-queue-lock*</span></span>) (<span class="hljs-name"><span class="hljs-name">progn</span></span> (<span class="hljs-name"><span class="hljs-name">mapcar</span></span> (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">i</span></span>) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">cdr</span></span> i) (<span class="hljs-name"><span class="hljs-name">cl-log</span></span><span class="hljs-symbol"><span class="hljs-symbol">:log-message</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> i) (<span class="hljs-name"><span class="hljs-name">cdr</span></span> i)))) (<span class="hljs-name"><span class="hljs-name">reverse</span></span> *log-queue*)) (<span class="hljs-name"><span class="hljs-name">setq</span></span> *log-queue* <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) )) (<span class="hljs-name"><span class="hljs-name">bt</span></span><span class="hljs-symbol"><span class="hljs-symbol">:with-lock-held</span></span> (<span class="hljs-name"><span class="hljs-name">*log-queue-cond-lock*</span></span>) (<span class="hljs-name"><span class="hljs-name">bt</span></span><span class="hljs-symbol"><span class="hljs-symbol">:condition-wait</span></span> *log-queue-cond* *log-queue-cond-lock*) ) (<span class="hljs-name"><span class="hljs-name">log-worker</span></span>)) (<span class="hljs-name"><span class="hljs-name">bt</span></span><span class="hljs-symbol"><span class="hljs-symbol">:make-thread</span></span> #'log-worker <span class="hljs-symbol"><span class="hljs-symbol">:name</span></span> <span class="hljs-string"><span class="hljs-string">"log-worker"</span></span>)</code> </pre><br>  For this we will use the auxiliary logging functions. <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defun</span></span> log-info (<span class="hljs-name"><span class="hljs-name">message</span></span>) (<span class="hljs-name"><span class="hljs-name">bt</span></span><span class="hljs-symbol"><span class="hljs-symbol">:with-lock-held</span></span> (<span class="hljs-name"><span class="hljs-name">*log-queue-lock*</span></span>) (<span class="hljs-name"><span class="hljs-name">progn</span></span> (<span class="hljs-name"><span class="hljs-name">push</span></span> (<span class="hljs-name"><span class="hljs-name">cons</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:info</span></span> message) *log-queue*) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">&gt;</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> (<span class="hljs-name"><span class="hljs-name">get-universal-time</span></span>) *log-queue-time*) <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-name"><span class="hljs-name">bt</span></span><span class="hljs-symbol"><span class="hljs-symbol">:condition-notify</span></span> *log-queue-cond*)) ))) (<span class="hljs-name"><span class="hljs-name">defun</span></span> log-warning (<span class="hljs-name"><span class="hljs-name">message</span></span>) (<span class="hljs-name"><span class="hljs-name">bt</span></span><span class="hljs-symbol"><span class="hljs-symbol">:with-lock-held</span></span> (<span class="hljs-name"><span class="hljs-name">*log-queue-lock*</span></span>) (<span class="hljs-name"><span class="hljs-name">progn</span></span> (<span class="hljs-name"><span class="hljs-name">push</span></span> (<span class="hljs-name"><span class="hljs-name">cons</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:warning</span></span> message) *log-queue*) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">&gt;</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> (<span class="hljs-name"><span class="hljs-name">get-universal-time</span></span>) *log-queue-time*) <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-name"><span class="hljs-name">bt</span></span><span class="hljs-symbol"><span class="hljs-symbol">:condition-notify</span></span> *log-queue-cond*)) ))) (<span class="hljs-name"><span class="hljs-name">defun</span></span> log-error (<span class="hljs-name"><span class="hljs-name">message</span></span>) (<span class="hljs-name"><span class="hljs-name">bt</span></span><span class="hljs-symbol"><span class="hljs-symbol">:with-lock-held</span></span> (<span class="hljs-name"><span class="hljs-name">*log-queue-lock*</span></span>) (<span class="hljs-name"><span class="hljs-name">progn</span></span> (<span class="hljs-name"><span class="hljs-name">push</span></span> (<span class="hljs-name"><span class="hljs-name">cons</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:error</span></span> message) *log-queue*) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">&gt;</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> (<span class="hljs-name"><span class="hljs-name">get-universal-time</span></span>) *log-queue-time*) <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-name"><span class="hljs-name">bt</span></span><span class="hljs-symbol"><span class="hljs-symbol">:condition-notify</span></span> *log-queue-cond*)) )))</code> </pre><br>  It remains to add to the handler.lisp <b>process-request</b> and try our functions. <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defun</span></span> process-request (<span class="hljs-name"><span class="hljs-name">request</span></span> stream) (<span class="hljs-name"><span class="hljs-name">let</span></span> ((<span class="hljs-name"><span class="hljs-name">path</span></span> (<span class="hljs-name"><span class="hljs-name">caadr</span></span> request))) (<span class="hljs-name"><span class="hljs-name">cond</span></span> ((<span class="hljs-name"><span class="hljs-name">equal</span></span> path <span class="hljs-string"><span class="hljs-string">"/logo.jpg"</span></span>) (<span class="hljs-name"><span class="hljs-name">myweb</span></span>.util<span class="hljs-symbol"><span class="hljs-symbol">:file-response</span></span> <span class="hljs-string"><span class="hljs-string">"logo.jpg"</span></span> <span class="hljs-string"><span class="hljs-string">"image/jpeg"</span></span> request stream)) (<span class="hljs-name"><span class="hljs-name">t</span></span> (<span class="hljs-name"><span class="hljs-name">process-index</span></span> request stream))))) (<span class="hljs-name"><span class="hljs-name">defun</span></span> process-index (<span class="hljs-name"><span class="hljs-name">request</span></span> stream) (<span class="hljs-name"><span class="hljs-name">let</span></span> ((<span class="hljs-name"><span class="hljs-name">name</span></span> (<span class="hljs-name"><span class="hljs-name">myweb</span></span>.util<span class="hljs-symbol"><span class="hljs-symbol">:get-param</span></span> <span class="hljs-string"><span class="hljs-string">"name"</span></span> request))) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">and</span></span> name (<span class="hljs-name"><span class="hljs-name">&gt;</span></span> (<span class="hljs-name"><span class="hljs-name">length</span></span> name) <span class="hljs-number"><span class="hljs-number">0</span></span>)) (<span class="hljs-name"><span class="hljs-name">myweb</span></span>.util<span class="hljs-symbol"><span class="hljs-symbol">:html-template</span></span> <span class="hljs-string"><span class="hljs-string">"index.html"</span></span> <span class="hljs-string"><span class="hljs-string">"text/html;encoding=UTF-8"</span></span> `((<span class="hljs-string"><span class="hljs-string">"name"</span></span> . ,name)) request stream) (<span class="hljs-name"><span class="hljs-name">myweb</span></span>.util<span class="hljs-symbol"><span class="hljs-symbol">:html-template</span></span> <span class="hljs-string"><span class="hljs-string">"name.html"</span></span> <span class="hljs-string"><span class="hljs-string">"text/html;encoding=UTF-8"</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> request stream) )))</code> </pre><br>  Create an <b>index.html</b> file in the <b>web</b> folder. <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>myweb<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">image</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"logo.jpg"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Hello ${name}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  And the file <b>name.html</b> <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>myweb<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">image</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"logo.jpg"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>Hello stranger. What's your name?<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"GET"</span></span></span><span class="hljs-tag">&gt;</span></span> Name: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Submit"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  And do not forget to put there a beautiful <b>logo.jpg</b> <br><br>  Start the web server using (myweb: start-http "localhost" 8080) and go to the browser on <a href="http://localhost/">localhost</a> : 8080 <br><br>  Thanks for attention </div><p>Source: <a href="https://habr.com/ru/post/131780/">https://habr.com/ru/post/131780/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../131768/index.html">Nine words about # habrarapati</a></li>
<li><a href="../131770/index.html">The seventh habrakstrecha: report on the Boston Mass Challenge</a></li>
<li><a href="../131773/index.html">Yandex OAuth authorization in iOS</a></li>
<li><a href="../131776/index.html">How to close the project Microsoft Courier</a></li>
<li><a href="../131777/index.html">Excursiopedia.com - search and book tours around the world</a></li>
<li><a href="../131782/index.html">If i were a musician</a></li>
<li><a href="../131783/index.html">The new version of Garageband - even more freedom for creativity</a></li>
<li><a href="../131784/index.html">Three startups that we learned about last winter</a></li>
<li><a href="../131788/index.html">CSS 4: what's new?</a></li>
<li><a href="../131790/index.html">Mithgol freaks out on the main</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>