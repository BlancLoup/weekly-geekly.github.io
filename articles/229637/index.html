<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Attempt to create a useful application for Pebble</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings, habrazhiteli! 

 Recently, I became the proud owner of Pebble smart watches. In functional terms, my expectations were fully met, only I bo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Attempt to create a useful application for Pebble</h1><div class="post__text post__text-html js-mediator-article">  Greetings, habrazhiteli! <br><br>  Recently, I became the proud owner of Pebble smart watches.  In functional terms, my expectations were fully met, only I bought them not only for the sake of using ready-made software, which allows pretty much to simplify / automate life.  For me, a very interesting side was the development for this gadget itself. <br><a name="habracut"></a><br>  Having played enough with examples from the official repository, having tested the cloud-based IDE, it was decided to do something really useful.  Considering the fact that the clock itself does not bring much benefit and you get the main benefit only after integrating it with the phone, it was decided to implement the yet-another-one notifier.  A quick search on Google Play, plus a brute-force search for useful notification options, led me to the idea of ‚Äã‚Äãmonitoring the battery level in a mobile phone.  I do not know how anyone, but I often forget to charge the phone on time and I hope that another source of kicks about this will be the way. <br><br>  <b>The architecture is rather trivial:</b> <br>  1) Service that runs in the background and is subscribed to notifications about changes in battery level. <br>  2) Simple UI, the purpose of which is the ON / OFF service. <br>  3) Notifier sending from phone to watch a warning that the charge is too low. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Here are some implementation details:</b> <br>  To begin with, I‚Äôll make a reservation that the Pebble API is just one java class that can be downloaded from the link [3]. <br><br>  1) In order not to make the application annoying, I chose the following approach in the notifications: <i>notify starting from charge level 25% every 5% (ie 25%, 20% ... and so on up to 5%)</i> .  To subscribe to receive system messages (including a change in the level of charge), we need a BroadcastReceiver. <br>  My looks like this: <br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BroadcastReceiver batteryInfoReceiver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BroadcastReceiver() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context c, Intent i)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    int currentLevel = i.getIntExtra("level", 0); //         if((currentLevel &lt;= 25) &amp;&amp; (currentLevel % 5 == 0) &amp;&amp; isPebbleConnected()) { Intent message = pebbleKit.getPebbleNotificationIntent( getString(R.string.msgWarningLabel), getString(R.string.msgWarningText) + currentLevel + "%" ); sendBroadcast(message); } } };</span></span></code> </pre> <br>  This receiver must be registered as follows: <br><pre> <code class="java hljs"> registerReceiver(batteryInfoReceiver, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IntentFilter(Intent.ACTION_BATTERY_CHANGED));</code> </pre><br>  2) But the actual way to send a message to the clock: <br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Intent </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPebbleNotificationIntent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String title, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String body)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Intent notificationIntent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(<span class="hljs-string"><span class="hljs-string">"com.getpebble.action.SEND_NOTIFICATION"</span></span>); Map&lt;String, String&gt; data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;String, String&gt;() {{ put(<span class="hljs-string"><span class="hljs-string">"title"</span></span>, title); put(<span class="hljs-string"><span class="hljs-string">"body"</span></span>, body); }}; <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> JSONObject notificationPack = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JSONObject(data); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String notificationData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JSONArray().put(notificationPack).toString(); notificationIntent.putExtra(<span class="hljs-string"><span class="hljs-string">"messageType"</span></span>, <span class="hljs-string"><span class="hljs-string">"PEBBLE_ALERT"</span></span>); notificationIntent.putExtra(<span class="hljs-string"><span class="hljs-string">"sender"</span></span>, <span class="hljs-string"><span class="hljs-string">"BatteryMonitor"</span></span>); notificationIntent.putExtra(<span class="hljs-string"><span class="hljs-string">"notificationData"</span></span>, notificationData); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> notificationIntent; }</code> </pre><br>  3) There is also a little user interface consisting of an icon in the status bar and the main screen of the application, where you can see the service status (everything is very simple, I will not give the code), as well as the connection status of the clock, everything is again implemented using BroadcastReceiver: <br><pre> <code class="java hljs"> PebbleKit.registerPebbleConnectedReceiver(ui.getApplicationContext(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BroadcastReceiver() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ ui.pebbleConnected(); } }); PebbleKit.registerPebbleDisconnectedReceiver(ui.getApplicationContext(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BroadcastReceiver() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ ui.pebbleDisconnected(); } });</code> </pre><br>  <b>Result:</b> <br>  I will be brief, and I will follow the proverb - better to see once ... <br><table><tbody><tr><td><div style="text-align:center;"><img src="//habrastorage.org/files/293/85a/b10/29385ab10f3840bc80363ff46b20ea78.png" width="250"></div><br></td><td><div style="text-align:center;"><img src="//habrastorage.org/files/941/464/b4d/941464b4d483419c8558bf7a71fb9e6b.png" width="250"></div><br></td></tr><tr><td><div style="text-align:center;"><img src="//habrastorage.org/files/7b5/b15/6c3/7b5b156c30c64ab39e3a488b84d1901c.png" width="250"></div><br></td><td><div style="text-align:center;"><img src="//habrastorage.org/files/b62/4be/835/b624be835a0b478097106203cb9a609b.png" width="250"></div><br></td></tr></tbody></table><br>  <b>Summarizing:</b> <br>  1) A couple of hours of Java coding, which allowed us to stretch our brains and recall the basic components of the Android application. <br>  2) Photoshop, a little mess with the design of the application and resources - we develop creative, as well as fine motor skills. <br>  3) A ready-made app on Google Play - positive emotions and good mood (until the criticism has fallen down) is priceless! <br><br>  That's all.  On this I will probably finish and go to come up with Appendix_‚Ññ2.  Also I will be happy reviews / criticism / advice. <br>  Who cares, below there are links to the application itself, the source code and some useful articles / resources used in the development. <br><br>  Thanks for reading. <br><br>  <b>Useful links:</b> <br>  1) <a href="https://github.com/ice-pro/Phone-Battery-Status-in-Pebble">github.com/ice-pro/Phone-Battery-Status-in-Pebble</a> - a repository with the source code of the program <br>  2) <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.x_lab.ice.PhoneBatteryMonitorForPebble">play.google.com/store/apps/details?id=com.x_lab.ice.PhoneBatteryMonitorForPebble</a> - the actual application in Google Play <br>  3) <a href="https://cloudpebble.net/ide/">cloudpebble.net/ide</a> - cloud development environment <br>  4) <a href="https://developer.getpebble.com/2/getting-started/linux/">developer.getpebble.com/2/getting-started/linux</a> - Pebble SDK <br>  5) <a href="https://github.com/pebble/pebble-sdk-examples">github.com/pebble/pebble-sdk-examples</a> - examples of working with Pebble SDK <br>  6) <a href="http://developer.android.com/guide/topics/ui/notifiers/notifications.html">developer.android.com/guide/topics/ui/notifiers/notifications.html</a> - implementation of notifications <br>  7) <a href="http://developer.android.com/training/monitoring-device-state/battery-monitoring.html">developer.android.com/training/monitoring-device-state/battery-monitoring.html</a> - battery level <br>  8) <a href="http://developer.android.com/reference/android/app/Service.html">developer.android.com/reference/android/app/Service.html</a> - services on Android <br>  9) <a href="http://www.tutorialspoint.com/android/android_broadcast_receivers.htm">www.tutorialspoint.com/android/android_broadcast_receivers.htm</a> - BroadcastReceiver </div><p>Source: <a href="https://habr.com/ru/post/229637/">https://habr.com/ru/post/229637/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229627/index.html">The third book "Simple Science"</a></li>
<li><a href="../229629/index.html">5 practical examples for studying the React framework</a></li>
<li><a href="../229631/index.html">Signerbox - authentication via DSTU 4145</a></li>
<li><a href="../229633/index.html">Windows "Threshold": Microsoft's plan to conquer users of Windows 7</a></li>
<li><a href="../229635/index.html">Box Overview leaves from Habr: postmortem</a></li>
<li><a href="../229639/index.html">Rosetta Flash - SWF encoding for calling from JSONP</a></li>
<li><a href="../229643/index.html">Raise our Vertcoin P2Pool * node with merged thru and flops</a></li>
<li><a href="../229645/index.html">LG G Watch: a complete review of iFixit (and 9 out of 10 on the repair scale)</a></li>
<li><a href="../229647/index.html">Baby Monitor from Android smartphone</a></li>
<li><a href="../229649/index.html">Useful materials for mobile developer # 61 (July 7-13)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>