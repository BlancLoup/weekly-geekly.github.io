<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Development add-on for MODx Revolution. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Habrahabr has already written a lot about creating components for the MODx Revolution, but in my opinion there is still no comprehensive manual in Rus...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Development add-on for MODx Revolution. Part 1</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/807949ed/025308c2/34239fc0/ebea32c9.png"><br>  Habrahabr has already written a lot about creating components for the MODx Revolution, but in my opinion there is still no comprehensive manual in Russian.  A lot of gaps and not very accurate information.  But such a guide is <a href="http://rtfm.modx.com/display/revolution20/Developing%2Ban%2BExtra%2Bin%2BMODX%2BRevolution">in the official documentation</a> in English.  I think in this case, amateur to anything :).  Although a real programmer should not have problems with English, I think reading Russian for the majority is more pleasant.  I decided to make a free translation of this fundamental, in my opinion, part of the documentation.  I offer you the first part.  I hope to have enough patience to finish this work, and maybe someone will help me with this.  Do not worry that a lot of text, it seems difficult only at first glance. <br><br><h5>  Overview </h5><br>  In this lesson you will learn about the development of a simple add-on ‚ÄúDoodles‚Äù (blanks) that uses a custom database table to store objects called ‚ÄúDoodles‚Äù that have a name and description.  We will create a snippet that will display a list that is formatted through a chunk, its own administration page (component) using ExtJS (part 2), and also make a script for packing into a package (part) - part 3. It will also be i18n- compatible, i.e.  have files to translate into different languages.  By the way, this package can be <a href="http://modx.com/extras/package/doodles">downloaded</a> and thoroughly studied. <a name="habracut"></a><br><br><h5>  Creating a directory structure </h5><br>  So, I created the folder <b>/ www / doodles /</b> on my local server.  I have this folder at <b>http: // localhost / doodles /</b> .  Our directory structure looks like this: <br><img src="https://habrastorage.org/storage1/a55860c5/c51d7040/a99ea15a/9206e4fd.png" align="left">  Note a few things.  First, we have 3 main directories: <b>core /</b> , <b>assets /</b> and <b>_build /</b> .  Usually MODx Revo add-ons are divided into two directories: <b>core / components / myextra /</b> and <b>assets / components / myextra /</b> .  The <b>assets / components /</b> directory contains only web-specific files ‚Äî JavaScript, CSS, and so on.  These are files that are publicly available on the Internet.  All PHP files will be in the <b>core / components /</b> directory.  The <b>core /</b> directory can be moved out of the webroot for additional security.  These directories will be packed into our component's transport package in order to be able to quickly install from the ‚ÄúPackage Management‚Äù section of the administrative part of the site.  The <b>_build /</b> directory will not be packaged in a transport package.  It is needed only at the stage of creating this package.  This will be discussed in the last part of the lesson. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the <b>assets /</b> folder we will have only one PHP file - <b>connector.php</b> .  This file will allow us to have access to the processors of our user management page (Custom Manager Page - CMP).  More on that later. <br><br>  In the <b>core / components / doodles</b> / directory, create several directories: <br>  <i>controllers</i> - controllers for CMP; <br>  <i>docs</i> - contains only changelog, readme and license files; <br>  <i>elements</i> - all our snippets, plugins, chunks, etc .; <br>  <i>lexicon</i> - all i18n language files; <br>  <i>model</i> - our classes, as well as the XML schema file for our user database tables; <br>  <i>processors</i> are all our processors for CMP. <br><br><h5>  Creating a Snippet </h5><br>  Create a snippet file: <b>/www/doodles/core/components/doodles/elements/snippets/snippet.doodles.php</b> .  Add a few lines of code to the file: <br><br><pre><code class="php hljs">$doodles = $modx-&gt;getService(<span class="hljs-string"><span class="hljs-string">'doodles'</span></span>,<span class="hljs-string"><span class="hljs-string">'Doodles'</span></span>,$modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'doodles.core_path'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>,$modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'core_path'</span></span>).<span class="hljs-string"><span class="hljs-string">'components/doodles/'</span></span>).<span class="hljs-string"><span class="hljs-string">'model/doodles/'</span></span>,$scriptProperties); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!($doodles <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Doodles)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>;</code> </pre> <br>  Oh!  What it is?  This is where the magic happens.  Let's break down every part.  First, we have a call to the getService () method.  We divide this line into several parts for easier reading: <br><br><pre> <code class="php hljs">$defaultDoodlesCorePath = $modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'core_path'</span></span>).<span class="hljs-string"><span class="hljs-string">'components/doodles/'</span></span>; $doodlesCorePath = $modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'doodles.core_path'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>,$defaultDoodlesCorePath); $doodles = $modx-&gt;getService(<span class="hljs-string"><span class="hljs-string">'doodles'</span></span>,<span class="hljs-string"><span class="hljs-string">'Doodles'</span></span>,$doodlesCorePath.<span class="hljs-string"><span class="hljs-string">'model/doodles/'</span></span>,$scriptProperties);</code> </pre> <br>  Well, what is <b>$ modx-&gt; getOption ()</b> ?  With this method you can find out our system settings.  <b>$ modx-&gt; getService ()</b> loads the class, creates an object instance, if it exists, and sets it to <b>$ modx-&gt; doodles</b> , in this case (the first parameter passed to the method).  Read more <a href="http://rtfm.modx.com/display/revolution20/modX.getService">here</a> . <br><br><h5>  Creating path settings </h5><br>  In the control system, go to ‚ÄúSystem‚Äù -&gt; ‚ÄúSystem Settings‚Äù.  Create two new parameters with the appropriate values: <br>  <i>doodles.core_path</i> - {core_path} components / doodles / <br>  <i>doodles.assets_url</i> - {assets_path} components / doodles / <br><br><h5>  Creating a base class </h5><br>  Create a class file <b>/www/doodles/core/components/doodles/model/doodles/doodles.class.php</b> .  This class will be useful to us because in it we can define some basic paths, as well as methods that we will use in our component. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Doodles</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $modx; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $config = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(modX &amp;$modx,array $config = array</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;modx =&amp; $modx; $basePath = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'doodles.core_path'</span></span>,$config,<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'core_path'</span></span>).<span class="hljs-string"><span class="hljs-string">'components/doodles/'</span></span>); $assetsUrl = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'doodles.assets_url'</span></span>,$config,<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'assets_url'</span></span>).<span class="hljs-string"><span class="hljs-string">'components/doodles/'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;config = array_merge(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'basePath'</span></span> =&gt; $basePath, <span class="hljs-string"><span class="hljs-string">'corePath'</span></span> =&gt; $basePath, <span class="hljs-string"><span class="hljs-string">'modelPath'</span></span> =&gt; $basePath.<span class="hljs-string"><span class="hljs-string">'model/'</span></span>, <span class="hljs-string"><span class="hljs-string">'processorsPath'</span></span> =&gt; $basePath.<span class="hljs-string"><span class="hljs-string">'processors/'</span></span>, <span class="hljs-string"><span class="hljs-string">'chunksPath'</span></span> =&gt; $basePath.<span class="hljs-string"><span class="hljs-string">'elements/chunks/'</span></span>, <span class="hljs-string"><span class="hljs-string">'jsUrl'</span></span> =&gt; $assetsUrl.<span class="hljs-string"><span class="hljs-string">'js/'</span></span>, <span class="hljs-string"><span class="hljs-string">'cssUrl'</span></span> =&gt; $assetsUrl.<span class="hljs-string"><span class="hljs-string">'css/'</span></span>, <span class="hljs-string"><span class="hljs-string">'assetsUrl'</span></span> =&gt; $assetsUrl, <span class="hljs-string"><span class="hljs-string">'connectorUrl'</span></span> =&gt; $assetsUrl.<span class="hljs-string"><span class="hljs-string">'connector.php'</span></span>, ),$config); } }</code> </pre> <br><br>  Now back to our snippet.  Add a few properties: <br><br><pre> <code class="php hljs">$dood = $modx-&gt;getService(<span class="hljs-string"><span class="hljs-string">'doodles'</span></span>,<span class="hljs-string"><span class="hljs-string">'Doodles'</span></span>,$modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'doodles.core_path'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>,$modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'core_path'</span></span>).<span class="hljs-string"><span class="hljs-string">'components/doodles/'</span></span>).<span class="hljs-string"><span class="hljs-string">'model/doodles/'</span></span>,$scriptProperties); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!($dood <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Doodles)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* setup default properties */</span></span> $tpl = $modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'tpl'</span></span>,$scriptProperties,<span class="hljs-string"><span class="hljs-string">'rowTpl'</span></span>); $sort = $modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'sort'</span></span>,$scriptProperties,<span class="hljs-string"><span class="hljs-string">'name'</span></span>); $dir = $modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'dir'</span></span>,$scriptProperties,<span class="hljs-string"><span class="hljs-string">'ASC'</span></span>); $output = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $output;</code> </pre> <br><br>  Cool.  Now we want to use <a href="http://rtfm.modx.com/display/xPDO20/Home">xPDO</a> for database queries to capture our records ... oh.  We have not yet made an xPDO model for them.  We have to do it. <br><br><h5>  Creating a model </h5><br>  xPDO does database abstraction into pretty OOP query methods.  He is currently starting to maintain multiple databases.  In addition, it allows you to turn your database strings into good, clean classes and make it all very short lines of code.  But first we need to build this model using xPDO schemes. <br><br>  Create an XML file <b>/www/doodles/core/components/doodles/model/schema/doodles.mysql.schema.xml</b> .  Put this into it: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">model</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"doodles"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">baseClass</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"xPDOObject"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">platform</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"mysql"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">defaultEngine</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MyISAM"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">object</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Doodle"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">table</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"doodles"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">extends</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"xPDOSimpleObject"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dbtype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"varchar"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">precision</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"255"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">phptype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">null</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">default</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"description"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dbtype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">phptype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">null</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">default</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"createdon"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dbtype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"datetime"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">phptype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"datetime"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">null</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"createdby"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dbtype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"int"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">precision</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">attributes</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"unsigned"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">phptype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"integer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">null</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">default</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"editedon"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dbtype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"datetime"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">phptype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"datetime"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">null</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"editedby"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dbtype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"int"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">precision</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">attributes</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"unsigned"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">phptype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"integer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">null</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">default</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">aggregate</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">alias</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CreatedBy"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"modUser"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">local</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"createdby"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">foreign</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"id"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cardinality</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"one"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">owner</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"foreign"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">aggregate</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">alias</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"EditedBy"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"modUser"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">local</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"editedby"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">foreign</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"id"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cardinality</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"one"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">owner</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"foreign"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">object</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">model</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  We will understand what it all means.  First line: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">model</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"doodles"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">baseClass</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"xPDOObject"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">platform</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"mysql"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">defaultEngine</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MyISAM"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  contains the name of our package - "doodles".  She also says that our base class will be ‚ÄúxPDOObject‚Äù, and that this scheme is made for MySQL.  She also says that MyISAM is our default MySQL storage system.  Further properties of the database table are set.  You do not need to create a field with an identifier, since  it is always created by the xPDOSimpleObject object and sets the auto-increment. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">aggregate</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">alias</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CreatedBy"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"modUser"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">local</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"createdby"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">foreign</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"id"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cardinality</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"one"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">owner</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"foreign"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">aggregate</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">alias</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"EditedBy"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"modUser"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">local</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"editedby"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">foreign</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"id"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cardinality</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"one"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">owner</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"foreign"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br><br>  This creates a link to other xPDO objects (in this case, the user object). <br><br><h5>  Script parsing scheme </h5><br>  Now it's time to pay attention to our <b>_build /</b> directory.  Let's create a file in it <b>/www/doodles/_build/build.config.php</b> with the following content: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> define(<span class="hljs-string"><span class="hljs-string">'MODX_BASE_PATH'</span></span>, <span class="hljs-string"><span class="hljs-string">'../'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'MODX_CORE_PATH'</span></span>, MODX_BASE_PATH . <span class="hljs-string"><span class="hljs-string">'core/'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'MODX_MANAGER_PATH'</span></span>, MODX_BASE_PATH . <span class="hljs-string"><span class="hljs-string">'manager/'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'MODX_CONNECTORS_PATH'</span></span>, MODX_BASE_PATH . <span class="hljs-string"><span class="hljs-string">'connectors/'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'MODX_ASSETS_PATH'</span></span>, MODX_BASE_PATH . <span class="hljs-string"><span class="hljs-string">'assets/'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'MODX_BASE_URL'</span></span>,<span class="hljs-string"><span class="hljs-string">'/modx/'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'MODX_CORE_URL'</span></span>, MODX_BASE_URL . <span class="hljs-string"><span class="hljs-string">'core/'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'MODX_MANAGER_URL'</span></span>, MODX_BASE_URL . <span class="hljs-string"><span class="hljs-string">'manager/'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'MODX_CONNECTORS_URL'</span></span>, MODX_BASE_URL . <span class="hljs-string"><span class="hljs-string">'connectors/'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'MODX_ASSETS_URL'</span></span>, MODX_BASE_URL . <span class="hljs-string"><span class="hljs-string">'assets/'</span></span>);</code> </pre> <br><br>  Check the correctness of all paths for your case.  Now we will create the script itself, which will analyze our XML schema and create its PHP representation.  Create the file <b>/www/doodles/_build/build.schema.php</b> : <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> dirname(<span class="hljs-keyword"><span class="hljs-keyword">__FILE__</span></span>).<span class="hljs-string"><span class="hljs-string">'/build.config.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">include_once</span></span> MODX_CORE_PATH . <span class="hljs-string"><span class="hljs-string">'model/modx/modx.class.php'</span></span>; $modx= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> modX(); $modx-&gt;initialize(<span class="hljs-string"><span class="hljs-string">'mgr'</span></span>); $modx-&gt;loadClass(<span class="hljs-string"><span class="hljs-string">'transport.modPackageBuilder'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;pre&gt;'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* used for nice formatting of log messages */</span></span> $modx-&gt;setLogLevel(modX::LOG_LEVEL_INFO); $modx-&gt;setLogTarget(<span class="hljs-string"><span class="hljs-string">'ECHO'</span></span>); $root = dirname(dirname(<span class="hljs-keyword"><span class="hljs-keyword">__FILE__</span></span>)).<span class="hljs-string"><span class="hljs-string">'/'</span></span>; $sources = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'model'</span></span> =&gt; $root.<span class="hljs-string"><span class="hljs-string">'core/components/doodles/model/'</span></span>, <span class="hljs-string"><span class="hljs-string">'schema_file'</span></span> =&gt; $root.<span class="hljs-string"><span class="hljs-string">'core/components/doodles/model/schema/doodles.mysql.schema.xml'</span></span>, ); $manager= $modx-&gt;getManager(); $generator= $manager-&gt;getGenerator(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_dir($sources[<span class="hljs-string"><span class="hljs-string">'model'</span></span>])) { $modx-&gt;log(modX::LOG_LEVEL_ERROR,<span class="hljs-string"><span class="hljs-string">'Model directory not found!'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file_exists($sources[<span class="hljs-string"><span class="hljs-string">'schema_file'</span></span>])) { $modx-&gt;log(modX::LOG_LEVEL_ERROR,<span class="hljs-string"><span class="hljs-string">'Schema file not found!'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(); } $generator-&gt;parseSchema($sources[<span class="hljs-string"><span class="hljs-string">'schema_file'</span></span>],$sources[<span class="hljs-string"><span class="hljs-string">'model'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'.'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>();</code> </pre> <br><br>  Now you can run the <b>_build / build.schema.php file</b> .  I do this by downloading in a web browser: <b>http: //localhost/doodles/_build/build.schema.php</b> .  After this, class files and maps will be generated. <br><img src="http://habrastorage.org/storage1/6f009add/36e8f716/46ee30dc/1c41fc6f.png"><br><br>  Now let's make a small adjustment to our Doodles base class (/www/doodles/core/components/doodles/model/doodles/doodles.class.php).  Add the following line to array constructor immediately after array_merge: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;modx-&gt;addPackage(<span class="hljs-string"><span class="hljs-string">'doodles'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;config[<span class="hljs-string"><span class="hljs-string">'modelPath'</span></span>]);</code> </pre> <br>  This tells xPDO that we want to add an xPDO ‚Äúdoodles‚Äù package, which will allow us to query our user table. <br><br><h5>  Snippet include </h5><br>  Earlier we created a snippet.  To use it, you can now create a snippet in the management system and paste the code from the file <b>doodles / elements / snippets / snippet.doodles.php</b> .  But the code of such a snippet may not be convenient to edit.  To fix this you can create a simple universal ‚Äúinclude‚Äù snippet.  Let's go to the control system ‚ÄúElements‚Äù -&gt; ‚ÄúSnippety‚Äù -&gt; ‚ÄúNew snippet‚Äù. <br><br>  <b>Snippet name:</b> <br>  include <br><br>  <b>Snippet code (php):</b> <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $file;</code> </pre> <br><br>  Now on any page or in any template you can make such a snippet call: <br><pre> <code class="html hljs xml">[[!include? &amp;file=`[[++doodles.core_path]]elements/snippets/snippet.doodles.php`]]</code> </pre> <br><br><h5>  Creating database queries </h5><br>  First, we need to create a table.  To do this, simply add the following lines to our snippet before returning a value (return): <br><pre> <code class="php hljs">$m = $modx-&gt;getManager(); $created = $m-&gt;createObjectContainer(<span class="hljs-string"><span class="hljs-string">'Doodle'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $created ? <span class="hljs-string"><span class="hljs-string">' .'</span></span> : <span class="hljs-string"><span class="hljs-string">'  .'</span></span>;</code> </pre> <br><br>  Now, if you run our snippet, the Doodles table will be automatically created in the database.  After that, you can delete this code, and better do it like this: <br><pre> <code class="php hljs">$tablexists = $modx-&gt;query(<span class="hljs-string"><span class="hljs-string">"SELECT COUNT(*) FROM information_schema.tables WHERE table_schema = '"</span></span>.$modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'dbname'</span></span>).<span class="hljs-string"><span class="hljs-string">"' AND table_name = '"</span></span>.$modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'table_prefix'</span></span>).<span class="hljs-string"><span class="hljs-string">"doodles'"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!$tablexists-&gt;fetch(PDO::FETCH_COLUMN)){ $m = $modx-&gt;getManager(); $created = $m-&gt;createObjectContainer(<span class="hljs-string"><span class="hljs-string">'Doodle'</span></span>); }</code> </pre> <br><br>  Now add the following lines to the snippet: <br><pre> <code class="php hljs">$doodles = $modx-&gt;getCollection(<span class="hljs-string"><span class="hljs-string">'Doodle'</span></span>); $output = count($doodles);</code> </pre> <br><br>  At the exit you should see "0", because  the table is still empty. <br><br>  Create a couple of lines in the table (for example, using phpMyAdmin) and you will see how the snippet prints their number.  You can also create rows in a table like this: <br><pre> <code class="php hljs">$doodle = $modx-&gt;newObject(<span class="hljs-string"><span class="hljs-string">'Doodle'</span></span>); $doodle-&gt;fromArray(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'TestDoodle'</span></span>, <span class="hljs-string"><span class="hljs-string">'description'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'A test doodle'</span></span> )); $doodle-&gt;save();</code> </pre> <br><br>  Do not forget to delete this code. <br><br>  Fine!  Custom database query works!  Let's make it more difficult.  We can use <a href="http://rtfm.modx.com/display/xPDO20/xPDOQuery">xPDOQuery</a> xPDO to create some fairly complex queries.  For now, let's just add the sort commands: <br><br><pre> <code class="php hljs">$c = $modx-&gt;newQuery(<span class="hljs-string"><span class="hljs-string">'Doodle'</span></span>); $c-&gt;sortby($sort,$dir); $doodles = $modx-&gt;getCollection(<span class="hljs-string"><span class="hljs-string">'Doodle'</span></span>,$c);</code> </pre> <br><br>  Sorting takes place in the $ sort field in the order $ dir.  The value of these variables we defined above.  In a call to the snippet, it will look like this: <br><pre> <code class="hljs json">[[!include? &amp;file=`[[++doodles.core_path]]elements/snippets/snippet.doodles.php`&amp;sort=`name`&amp;dir=`DESC`]]</code> </pre> <br><br><h5>  DoCles class getChunk method </h5><br>  Add a couple of helper methods to the base class: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getChunk</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name,$properties = array</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ $chunk = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;chunks[$name])) { $chunk = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_getTplChunk($name); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($chunk)) { $chunk = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;modx-&gt;getObject(<span class="hljs-string"><span class="hljs-string">'modChunk'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; $name)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($chunk == <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;chunks[$name] = $chunk-&gt;getContent(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $o = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;chunks[$name]; $chunk = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;modx-&gt;newObject(<span class="hljs-string"><span class="hljs-string">'modChunk'</span></span>); $chunk-&gt;setContent($o); } $chunk-&gt;setCacheable(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $chunk-&gt;process($properties); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_getTplChunk</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name,$postfix = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'.chunk.tpl'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ $chunk = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $f = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;config[<span class="hljs-string"><span class="hljs-string">'chunksPath'</span></span>].strtolower($name).$postfix; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file_exists($f)) { $o = file_get_contents($f); $chunk = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;modx-&gt;newObject(<span class="hljs-string"><span class="hljs-string">'modChunk'</span></span>); $chunk-&gt;set(<span class="hljs-string"><span class="hljs-string">'name'</span></span>,$name); $chunk-&gt;setContent($o); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $chunk; }</code> </pre> <br><br>  So far, all you need to know is that these methods will look for chunks in your <b>/ www / doodles / core / components / doodles / elements / chunks /</b> directory. <br><br>  Create a file <b>/www/doodles/core/components/doodles/elements/chunks/rowtpl.chunk.tpl</b> with something like this: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span>[[+name]]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span> - [[+description]]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  In our snippet add the following lines: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($doodles <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $doodle) { $doodleArray = $doodle-&gt;toArray(); $output .= $dood-&gt;getChunk($tpl,$doodleArray); }</code> </pre> <br><br>  The complete snippet code is: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $dood = $modx-&gt;getService(<span class="hljs-string"><span class="hljs-string">'doodles'</span></span>,<span class="hljs-string"><span class="hljs-string">'Doodles'</span></span>,$modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'doodles.core_path'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>,$modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'core_path'</span></span>).<span class="hljs-string"><span class="hljs-string">'components/doodles/'</span></span>).<span class="hljs-string"><span class="hljs-string">'model/doodles/'</span></span>,$scriptProperties); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!($dood <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Doodles)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* setup default properties */</span></span> $tpl = $modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'tpl'</span></span>,$scriptProperties,<span class="hljs-string"><span class="hljs-string">'rowTpl'</span></span>); $sort = $modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'sort'</span></span>,$scriptProperties,<span class="hljs-string"><span class="hljs-string">'name'</span></span>); $dir = $modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'dir'</span></span>,$scriptProperties,<span class="hljs-string"><span class="hljs-string">'ASC'</span></span>); $output = <span class="hljs-string"><span class="hljs-string">''</span></span>; $tablexists = $modx-&gt;query(<span class="hljs-string"><span class="hljs-string">"SELECT COUNT(*) FROM information_schema.tables WHERE table_schema = '"</span></span>.$modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'dbname'</span></span>).<span class="hljs-string"><span class="hljs-string">"' AND table_name = '"</span></span>.$modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'table_prefix'</span></span>).<span class="hljs-string"><span class="hljs-string">"doodles'"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!$tablexists-&gt;fetch(PDO::FETCH_COLUMN)){ $m = $modx-&gt;getManager(); $created = $m-&gt;createObjectContainer(<span class="hljs-string"><span class="hljs-string">'Doodle'</span></span>); } $c = $modx-&gt;newQuery(<span class="hljs-string"><span class="hljs-string">'Doodle'</span></span>); $c-&gt;sortby($sort,$dir); $doodles = $modx-&gt;getCollection(<span class="hljs-string"><span class="hljs-string">'Doodle'</span></span>,$c); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($doodles <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $doodle) { $doodleArray = $doodle-&gt;toArray(); $output .= $dood-&gt;getChunk($tpl,$doodleArray); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $output;</code> </pre><br><br>  At the output we will see a list of our test data from the table: <br><img src="http://habrastorage.org/storage1/ec0618b5/83a58cd5/5bc54cbb/7c08d674.png"><br><br>  So, we loaded the base class in the paths created in the system settings, retrieved the xPDO package from the user database table and derived it from the template using the chunk. <br><br>  The <a href="http://rtfm.modx.com/display/revolution20/Developing%2Ban%2BExtra%2Bin%2BMODX%2BRevolution%252C%2BPart%2BII">next part of</a> this lesson describes how to create an administrative page (component).  About it on Habr√© recently <a href="http://habrahabr.ru/blogs/modx/126635/">told a</a> good <a href="http://habrahabr.ru/users/bezumkin/" class="user_link">bezumkin</a> .  In the <a href="http://rtfm.modx.com/display/revolution20/Developing%2Ban%2BExtra%2Bin%2BMODX%2BRevolution%252C%2BPart%2BIII">third part</a> , in my opinion no one has written yet, maybe I‚Äôll make a translation soon.  It tells about the packaging of the entire component in the package, which can be easily installed through the "Package Management" section in the management system. </div><p>Source: <a href="https://habr.com/ru/post/127722/">https://habr.com/ru/post/127722/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../127715/index.html">Favorite client from Russian Post</a></li>
<li><a href="../127716/index.html">JQuery, Ajax and communication with users</a></li>
<li><a href="../127719/index.html">We are in Russia for more than 10 thousand people!</a></li>
<li><a href="../127720/index.html">Newsletter Layout FAQ</a></li>
<li><a href="../127721/index.html">How do you feel about ITS? (Water cooling system)</a></li>
<li><a href="../127724/index.html">Which email client / web interface do you use?</a></li>
<li><a href="../127726/index.html">Apple HIG Translation, take two</a></li>
<li><a href="../127727/index.html">Yes, Virginia, Scala is complicated!</a></li>
<li><a href="../127728/index.html">Head tracking with Kinect and display on a 3D TV</a></li>
<li><a href="../127729/index.html">Google closes about 10 minor areas of work of the company (addition)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>