<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Is multiprocessing possible in UEFI?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="According to the Unified Extensible Firmware Interface specification, the software environment that provides initialization procedures before the oper...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Is multiprocessing possible in UEFI?</h1><div class="post__text post__text-html js-mediator-article">  According to the Unified Extensible Firmware Interface specification, the software environment that provides initialization procedures before the operating system loads does not support multi-thread processing.  The main reason is the single-stream UEFI ideology and, as a result, the non-reentrantness of the UEFI API service procedures.  At the same time, a number of tasks not related to calling service functions (for example, testing RAM) not only allow parallel execution by several program threads, but also receive an increase in performance from such a hike. <br><a name="habracut"></a><br>  <i>Note</i> : A few years ago, experiments on initializing a multiprocessor platform in a 16-bit MS-DOS environment were conducted in our laboratory, using direct programming of hardware resources, in particular, Local APIC interrupt controllers.  A successful technical experience, however, turned out to be somewhat similar to a joke about a trainer who taught the dog to play the violin, and the audience, as it turned out, does not go to the circus to listen to the violin concerto ... <br><br>  The presence in UEFI firmware of a documented set of service functions called <b>EFI_MP_SERVICES_PROTOCOL</b> suggests that the fate of multi-threaded processing under UEFI will be somewhat different.  Let us consider in more detail one of the functions of this protocol. <br><br><h2>  Running AP: how to do it </h2><br>  Consider a set of parameters and principles of using one of the main functions of <i>StartupThisAP</i> , which provides for launching an AP (Application Processors) multiprocessor system and coordinating their work by the BSP (Bootstrap Processor). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/f3b/10c/5a5/f3b10c5a5251894cfa846404c87e6845.png" alt="  StartupThisAP   UEFI Platform Initialization Specification" title="Description of the StartupThisAP function in the UEFI Platform Initialization Specification document"><br>  <i>Description of the StartupThisAP function in the UEFI Platform Initialization Specification document.</i>  <i>Volume 2. Driver Execution Environment Core Interface.</i>  <i>Version 1.3.</i> <br><br>  The function allows you to run an arbitrary procedure on a given logical processor of the multiprocessor platform.  The object of control is <i>logical processors</i> , for example, in a system with two 8-core processors that support <a href="http://habrahabr.ru/post/248359/" title="Once again about Hyper-Threading">Hyper-Threading technology</a> , the number of logical processors will be 2 * 8 * 2 = 32. To request the number of processors, use the <i>GetNumberOfProcessors</i> function, an example of which is described in the description <a href="http://jelezo.com.ua/programmy/identifikaciya_smp-vozmozhnostej.html" title="Identifying SMP Capabilities">SMP Detect utilities</a> . <br><br>  So, the StartupThisAP function takes 7 parameters. <br><br><ol><li>  <b>EFI_MP_SERVICES_PROTOCOL</b> - pointer to the interface unit of the called protocol, returned by the EFI_Locate_Protocol function. </li><li>  <b>EFI_AP_PROCEDURE</b> is a pointer to the procedure that the AP processor must perform.  The procedure must be previously prepared in memory in accordance with the rules for the current mode of operation of the processor, for example, Microsoft x64 calling convention is used for UEFI x64. </li><li>  <b>ProcessorNumber</b> is the number of the processor to start, counting from 0. </li><li>  <b>WaitEvent</b> - the number (handle) of the event reserved by the calling procedure.  The called procedure generates this event to report the success of the routine on the AP processor or the expiration of the timeout.  A special case - the zero value of this parameter means that the BSP processor running the procedure on the AP processor must wait for the procedure to complete before returning from the function.  No events are generated.  This mode is called Blocking Mode. </li><li>  <b>TimeoutInMicroseconds</b> - timeout value in microseconds, which determines the waiting time for completion of the procedure running on the AP processor.  When the timeout expires, the procedure is forced to end with error generation.  The zero value of this parameter means the absence of restrictions on the execution time of the procedure (endless waiting). </li><li>  <b>ProcedureArgument</b> is a parameter passed to a procedure launched on the AP processor.  A value of zero means no parameter passing. </li><li>  <b>Finished</b> - a pointer to the variable set by the UEFI firmware to TRUE if the procedure started on the AP was successfully completed before the timeout expired.  Zero value means not to use such a variable. </li></ol><br>  After execution, the function returns the UEFI status in the RAX register. <br><br><h2>  Summary </h2><br>  It can be stated that, compared to the Legacy BIOS, the UEFI firmware greatly simplifies the task of the system programmer when initializing a multiprocessor platform.  The transfer of interprocessor interrupts, known as IPI or Inter Processor Interrupts, as well as the transfer of the AP processor to a UEFI context compatible mode, can be accomplished not using direct hardware programming, but using service functions.  An exception may be tasks whereby multiprocessor support platform resources are an independent object of research or diagnostics. <br><br><h2>  application </h2><br><ul><li>  <a href="">SMP Detect utility</a> ; </li><li>  <a href="">The source code of the SMP Detect utility (ZIP archive)</a> . </li></ul><br><br>  UPD.  The picture was replaced: initially by mistake was the structure of the interface block EFI_MP_SERVICES_PROTOCOL </div><p>Source: <a href="https://habr.com/ru/post/269851/">https://habr.com/ru/post/269851/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269833/index.html">Google is going to combine Chrome OS and Android</a></li>
<li><a href="../269835/index.html">Isolation of virtual servers in apache2 - ugidctl</a></li>
<li><a href="../269839/index.html">Organization of development and operation of large projects</a></li>
<li><a href="../269845/index.html">Intel distributes its libraries</a></li>
<li><a href="../269849/index.html">PostgreSQL 9.5: what's new? Part 3. GROUPING SETS, CUBE, ROLLUP</a></li>
<li><a href="../269853/index.html">Seven HTTP / 2 Implementation Tips</a></li>
<li><a href="../269857/index.html">News Digest for iOS Developers</a></li>
<li><a href="../269859/index.html">Meeting with Jon von Tachner in Moscow</a></li>
<li><a href="../269861/index.html">Top 10 Systems Scaling Errors</a></li>
<li><a href="../269863/index.html">Duke, take out the trash! - Part 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>