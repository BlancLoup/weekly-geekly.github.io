<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>State space in problems of designing optimal control systems</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 The study of the control system in the time domain using state variables has been widely used recently due to the simplicity of the ana...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>State space in problems of designing optimal control systems</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/rd/mz/m3/rdmzm3gyembc3ai5s7gaubbkonk.png"></div><br><h3>  Introduction </h3><br>  The study of the control system in the time domain using state variables has been widely used recently due to the simplicity of the analysis. <br><br>  The state of the system corresponds to a point in a certain Euclidean space, and the system behavior in time is characterized by the trajectory described by this point. <br><br>  At the same time, the mathematical apparatus includes ready-made solutions for analog and discrete LQR and DLQR controllers, Kalman filter, and all this with the use of matrices and vectors, which allows you to write the equations of the control system in a generalized form, obtaining additional information when solving them. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The purpose of this publication is to consider solving the problems of designing optimal control systems using the state space description method using Python software. <br><a name="habracut"></a><br><h3>  Theory briefly </h3><br>  A vector-matrix record of a linear dynamic object model taking into account the measurement equation takes the form: <br><br><img src="https://habrastorage.org/webt/tu/m6/tv/tum6tvyd1axizdeprtut0pyukdg.png">  (one) <br><br>  If the matrices A (t), B (t) and C (t) do not depend on time, then the object is called an object with constant coefficients, or a stationary object.  Otherwise, the object will be non-stationary. <br><br>  In the presence of errors in measurement, the output (adjustable) signals are given by the linearized matrix equation: <br><br><img src="https://habrastorage.org/webt/cc/gy/nl/ccgynlhs0dnqrwpr_lifygxzlme.png">  (2) <br><br>  where y (t) is the vector of regulated (measured) values;  C (t) is the coupling matrix of the measurement vector with the state vector;  v (t) is the vector of measurement errors (interference). <br><br>  The structure of a linear continuous system that implements equations (1) and (2) is shown in the figure: <br><br><img src="https://habrastorage.org/webt/17/ld/s_/17lds_oazil8fhq0u0km_hldcto.png"><br><br>  This structure corresponds to a mathematical model of an object constructed in the state space of its input x (t), u (t), output y (t), and internal, or phase coordinates x (t). <br><br>  For example, consider the mathematical model of a DC motor with independent excitation from permanent magnets.  The system of equations of the electric and mechanical parts of the engine for the case in question will look like this: <br><br><img src="https://habrastorage.org/webt/te/qp/09/teqp09zyxvsfqseosjrftkrewbm.png">  (3) <br><br>  The first equation reflects the relationship between the variables in the anchor chain, the second the mechanical equilibrium conditions.  As the generalized coordinates, we choose the armature current <b>I</b> and the armature rotation frequency <b>œâ</b> . <br><br>  The control is the voltage at the anchor <b>U</b> , the disturbance is the moment of resistance of the load <b>Mc</b> .  The parameters of the model are the resistance and inductance of the circuit and anchor, denoted respectively by <b>R</b> , and <b>L</b> , as well as the reduced moment of inertia <b>J</b> and the design constants ce and cm (in the SI system: <b>Ce = cm</b> ). <br><br>  Solving the original system with respect to the first derivatives, we obtain the equations of the engine in the state space. <br><br><img src="https://habrastorage.org/webt/q1/vu/tp/q1vutpl1sdmtwo0dkucn6aw21ks.png">  (four) <br><br>  In the matrix form of equation (4) will take the form (1): <br><br><img src="https://habrastorage.org/webt/wp/ww/se/wpwwsezxm4ctijdnk-qecar-yic.png">  (five) <br><br>  where is the vector of generalized coordinates <img src="https://habrastorage.org/webt/ij/ak/wp/ijakwpls3wrhjronyhliw8jwguu.png">  , the vector of controls <b>U = u</b> (in the case under consideration it is a scalar), the vector (scalar) of perturbations <b>Mc = f</b> .  Matrix model: <br><br><img src="https://habrastorage.org/webt/ci/kx/ae/cikxaeteyjptpgromddl7rli56e.png">  (6) <br><br>  If the rotational speed is chosen as an adjustable value, the measurement equation will be written as: <br><br><img src="https://habrastorage.org/webt/il/lk/8c/illk8c7wd5-eqm3p-talu45fj-e.png">  (7) <br><br>  and the measurement matrix will take the form: <br><br>  <b>C = (0 1)</b> <br><br>  Form the engine model in Python.  To do this, we first set specific values ‚Äã‚Äãfor the motor parameters: U = 110 V;  R = 0.2 Ohm;  L = 0.006 H;  J = 0.1 kg / m2; Ce = Cm = 1.3 V / C and we find the values ‚Äã‚Äãof the coefficient of the object matrices from (6). <br><br><h3>  Development of a program that generates a model engine with checking matrices for observability and controllability: </h3><br><br>  When developing the program, the special function <b>def matrix_rank was used</b> to determine the rank of the matrix and the functions listed in the table: <br><br><img src="https://habrastorage.org/webt/13/xr/6t/13xr6ttmonklwfqtow6a2scjquq.png"><br><br><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- coding: utf8 -*- from numpy import* from control.matlab import * from numpy.linalg import svd from numpy import sum,where import matplotlib.pyplot as plt def matrix_rank(a, tol=1e-8): s = svd(a, compute_uv=0) return sum( where( s&gt;tol, 1, 0) ) u=110 #   J=.1 #   c=1.3; #   R=.2; L=.006 #      A=matrix([[-R/L ,-c/L],[ c/J ,0]]) print ('  : \n %s'%A) B=matrix([[1/L],[0]]) print (' B : \n %s '%B) C=matrix([[0, 1]]) print (' C : \n %s '%C) D=0 print (' D : \n %s '%D) sd=ss(A,B,C,D) #      wd=tf(sd) #     print ('   : \n %s '%wd) a=ctrb(A,B) print('    : %s'%matrix_rank(a, tol=1e-8)) a=obsv(A,C) print('  : %s'%matrix_rank(a, tol=1e-8)) y,x=step(wd) #    plt.plot(x,y,"b") plt.title('   ') plt.ylabel('    /') plt.xlabel(' ') plt.grid(True) plt.show()</span></span></code> </pre> <br>  <b>The results of the program:</b> <br><br>  Matrix A: <br>  [[-33.33333333 -216.66666667] <br>  [13. 0.]] <br>  Matrix B: <br>  [[166.66666667] <br>  [0.]] <br>  Matrix C: <br>  [[0 1]] <br>  Scalar D: <br>  0 <br>  Engine transfer function: <br>  2167 / (s ^ 2 + 33.33 s + 2817) <br>  Rank matrix manageability: 2 <br>  Rank Observability Matrix: 2 <br><br><img src="https://habrastorage.org/webt/td/i9/on/tdi9ontqd85yu4xcbvzuydk3xzu.png"><br><br>  <b>Findings:</b> <br><br>  1. Using the example of a dc motor with independent magnetic excitation, a technique for designing control in the state space is considered; <br><br>  2. As a result of the program, the transfer function, transient response, as well as the ranks of the controllability and observability matrices are obtained.  The ranks coincide with the dimensions of the state space, which confirms the controllability and observability of the model. <br><br><h3>  An example of designing an optimal control system with a discrete dlqr controller and full feedback </h3><br>  <b>Definitions and terminology</b> <br><br>  Linear quadratic regulator (Linear quadratic regulator, LQR) - in the management theory one of the types of optimal regulators using quadratic quality functionality. <br><br>  The problem in which the system is described by linear differential equations, and the quality indicator is a quadratic functional, is called a linear-quadratic control problem. <br><br>  Linear quadratic regulators (LQR) and linear quadratic Gaussian regulators (LQG) are widely used. <br><br>  <b>Getting to the practical solution of the problem, you should always remember the limitations</b> <b><br></b> <br><br>  To synthesize an optimal discrete controller of linear stationary systems, we need a function to solve the Bellman equation. There is no such function in the Python Control Systems library [1], but you can use the function to solve the Riccati equation given in publication [2]: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dlqr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A,B,Q,R)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Solve the discrete time lqr controller. x[k+1] = A x[k] + B u[k] cost = sum x[k].T*Q*x[k] + u[k].T*R*u[k] """</span></span> <span class="hljs-comment"><span class="hljs-comment">#ref Bertsekas, p.151 #first, try to solve the ricatti equation X = np.matrix(scipy.linalg.solve_discrete_are(A, B, Q, R)) #compute the LQR gain K = np.matrix(scipy.linalg.inv(BT*X*B+R)*(BT*X*A)) eigVals, eigVecs = scipy.linalg.eig(AB*K) return K, X, eigVals</span></span></code> </pre><br>  But we must also take into account the restrictions on the synthesis of the optimal regulator, given in [3]: <br><br><ul><li>  the system defined by matrices (A, B) must be stabilized; </li><li>  the inequalities S&gt; 0, Q - N / R ‚Äì NT&gt; 0, the pair of matrices (Q - N / R ‚Äì NT, <br>  A - B / R ‚Äì BT) should not have observable modes with eigenvalues ‚Äã‚Äãat <br>  real axis. </li></ul><br>  After digging into an extensive and not unambiguous theory, which, for obvious reasons, I do not cite, the problem was solved, and all the answers can be read directly in the comments to the code. <br><br>  The block diagram of the regulator of the control system with feedback on all state variables is shown in the figure: <br><br><img src="https://habrastorage.org/webt/3n/jw/mb/3njwmbr7edkpuuh0jg1jlhfko7c.png"><br><br>  For each initial state x0, the optimal linear controller generates the optimal program control u * (x, k) and the optimal trajectory x * (k). <br><br><h3>  Program forming optimal control model with dlqr controller </h3><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> scipy.linalg <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> matplotlib.pyplot <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> plt <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dlqr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A,B,Q,R)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#     x[k+1] = A x[k] + B u[k] P= matrix(scipy.linalg.solve_discrete_are(A, B, Q, R)) #  DLQR K = matrix(scipy.linalg.inv(BT*P*B+R)*(BT*P*A)) E, E1 = scipy.linalg.eig(AB*K) return K, P, E """ """ A=matrix([[1, 0],[ -2 ,1]]) B=matrix([[1, 0],[1, 0]]).T """  """ Q=matrix([[0.5, 0],[0, 0.5]]) R=matrix([[0.5,0],[0, 0.5]]) T =100#   SS=0.5#   N =int(T/SS)#   K, P, E=dlqr(A,B,Q,R)#   print("K= \n%s"%K) print("P= \n%s"%P) print("E= \n%s"%E) x = zeros([2, N]) u= zeros([2, N-1]) x [0,0]=2 x [1,0]=1 for i in arange(0,N-2): u[:, i]= dot(- K,x[:, i]) x[:, i+1]=dot(A,x[:, i])+dot(B,u[:, i]) x1= x[0,:] x2= x[1,:] t = arange(0,T,SS) t1=arange(0.5,T,SS) plt.subplot(221) plt.plot(t, x1, 'b') plt.grid(True) plt.subplot(222) plt.plot(t, x2, 'g') plt.grid(True) plt.subplot(223) plt.plot(t1, u[0,:], 'y') plt.grid(True) plt.subplot(224) plt.plot(t1, u[1,:], 'r') plt.grid(True) plt.show()</span></span></code> </pre><br>  <b>Calculation results:</b> <br><br>  K = <br>  [[0.82287566 -0.17712434] <br>  [0.82287566 -0.17712434]] <br>  P = <br>  [[3.73431348 -1.41143783] <br>  [-1.41143783 1.16143783]] <br>  E = <br>  [0.17712434 + 0.17712434j 0.17712434-0.17712434j] <br><br>  <b>Dynamics of states and controls: x1, x2, u1, u2.</b> <br><br><img src="https://habrastorage.org/webt/dh/ms/u_/dhmsu_iamzczxdqyjtk8mqwtjsk.png"><br><br><h3>  Conclusion </h3><br>  Separate optimal control problems according to the above can be solved using Python tools, combining the capabilities of the Python Control Systems libraries, SciPy, NumPy, which certainly contributes to the popularization of Python, given that previously such problems could be solved only in paid mathematical packages. <br><br><h3>  Links </h3><br><ol><li>  <a href="https://web.math.princeton.edu/~cwrowley/python-control/index.html">Python Control Systems Library.</a> </li><li>  <a href="http://www.mwm.im/lqr-controllers-with-python/">Mark Wilfried Mueller LQR Controllers with Python.</a> </li><li>  <a href="http://matlab.exponenta.ru/controlsystem/book1/5.php">E.V. Nikulchev.</a>  <a href="http://matlab.exponenta.ru/controlsystem/book1/5.php">Manual "Control System Toolbox"</a> <br></li></ol></div><p>Source: <a href="https://habr.com/ru/post/353318/">https://habr.com/ru/post/353318/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../353308/index.html">Mail.Ru Mail will hold the first ML-hakaton SmartMail Hack 2018</a></li>
<li><a href="../353310/index.html">IT courses: what remains behind the scenes</a></li>
<li><a href="../353312/index.html">TDD wrong?</a></li>
<li><a href="../353314/index.html">SOC for intermediate. We understand what we are protecting, or how to make an inventory of infrastructure</a></li>
<li><a href="../353316/index.html">How to set up various notifications about problems with the site</a></li>
<li><a href="../353320/index.html">Vulnerability found in Vesta CP hosting control panel</a></li>
<li><a href="../353322/index.html">Visualizing Process Connections in Linux</a></li>
<li><a href="../353324/index.html">How is information security operational management center (SOC-center) built today?</a></li>
<li><a href="../353328/index.html">How to use getDerivedStateFromProps in React 16.3 (py subtitles)</a></li>
<li><a href="../353332/index.html">Own validations of fields for Rules in one class</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>