<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create a PDF viewer for a couple of hours</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We haven't written about Qt for a long time, so let's do something simple but powerful. The framework has been created for more than ten years ago (so...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create a PDF viewer for a couple of hours</h1><div class="post__text post__text-html js-mediator-article">  We haven't written about Qt for a long time, so let's do something simple but powerful.  The framework has been created for more than ten years ago (soon and 20), but still continues to delight and surprise us thanks to the efforts of the Qt community. <br><br>  I want to give an example of developing an application with a little effort spent at the interface between desktop application creation and web programming. <br><br>  A few weeks ago, I was looking for a way to convert specific PDF documents into images, taking into account the possibility of automation and scripting in the future.  Of course, there is an old-timer - the ImageMagic package with the convert utility, but unfortunately I was faced with the fact that this tool is not as good as I expected on these files ‚Äî it doesn‚Äôt render many files correctly and that wasn‚Äôt happy at all ‚Äî many of the illustrations were corrupted. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I began to look for other tools and although there are a lot of different utilities, but each has its own characteristics, so I never chose which one to use. <br><br>  Instead, I had an idea, can Qt as a rather mature technology help me?  In Qt, it is very easy to create a PDF document using QPrinter, but what about the reverse functionality - to make an image from a PDF page?  But there is another well-developed technology - PDF.js. <br><br>  Is it possible to combine these two technologies?  Of course!  Qt has a QWebEngineView component.  Let's demonstrate in the code: <br><a name="habracut"></a><br>  Quickly based on QMainWindow: <br><br><pre><code class="hljs cs">m_webView = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QWebEngineView(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); m_webView-&gt;load(url); setCentralWidget(m_webView);</code> </pre> <br>  The result will be a window with a web page inside.  Now it's the PDF.js turn.  The project has a fairly large amount of code, but it is possible to build a compact (minified) version that can be easily embedded in the website.  Build example: <br><br><pre> <code class="bash hljs">$ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git://github.com/mozilla/pdf.js.git $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> pdf.js $ brew install npm $ npm install -g gulp-cli $ npm install $ gulp minified</code> </pre><br>  The result will be the ‚Äúcompiled‚Äù version of pdf.js in the build / minified folder, which we copy into our project.  Install the starting URL on the local minified / web / viewer.html file <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">auto</span></span> url = QUrl::fromLocalFile(app_path+<span class="hljs-string"><span class="hljs-string">"/minified/web/viewer.html"</span></span>);</code> </pre><br>  Build and run: <br><img src="https://habrastorage.org/getpro/habr/post_images/bdd/b44/f7e/bddb44f7e5911c45f0a5b274d6dbd154.png" alt="image"><br>  It works fine, the approach is correct, but it shows the default PDF file.  How can I transfer the file name to javascript?  Qt has another great QWebChannel module for this.  The idea is that on the C ++ / Qt side, a QWebChannel object is created and it is set up by the channel for the download web page.  With this channel, we can register objects that will be available already inside the JavaScript code.  Q_PROPERTY properties will be visible from JavaScript: <br><br><pre> <code class="hljs php">auto url = QUrl::fromLocalFile(app_path+<span class="hljs-string"><span class="hljs-string">"/minified/web/viewer.html"</span></span>); m_communicator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Communicator(this); m_communicator-&gt;setUrl(pdf_path); m_webView = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QWebEngineView(this); QWebChannel * channel = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QWebChannel(this); channel-&gt;registerObject(QStringLiteral(<span class="hljs-string"><span class="hljs-string">"communicator"</span></span>), m_communicator); m_webView-&gt;page()-&gt;setWebChannel(channel); m_webView-&gt;load(url); setCentralWidget(m_webView);</code> </pre><br>  The code above allows you to access a communicator from JavaScript.  Now you need to make changes to viewer.html / viewer.js, add a standard qwebchannel.js to make communication work - quite simple: <br><br>  For viewer.html, simply add the inclusion of qwebchannel.js.  For viewer.js, we add QWebChannel initialization and get from the channel the name of the file that will be used instead of the default file: <br><br>  Code: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> DEFAULT_URL = <span class="hljs-string"><span class="hljs-string">'compressed.tracemonkey-pldi-09.pdf'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QWebChannel(qt.webChannelTransport ,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">channel</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> comm = channel.objects.communicator; DEFAULT_URL = comm.url; ...</code> </pre><br>  Here's how it works: Before loading the page, the web channel is attached and the communicator object is registered.  Then, when the viewer.html is loaded for the first time, the QWebChannel JS class is determined.  After determining the DEFAULT_URL, a JS QWebChannel object is created and as soon as the communication is established, the attached js function will be called which reads the URL from the communicator object.  The new URL will be used instead of the sample file.  In the same way, you can transfer the rendered page as an image from JavaScript to C ++ / Qt part of the application. <br><br>  Having finished changes to PDF.js, just rebuild minified: <br><br><pre> <code class="bash hljs">$ gulp minified</code> </pre><br>  Copy the minified version to the project folder.  Let's finish getting the list of files from the command line arguments and so on. <br><img src="https://habrastorage.org/getpro/habr/post_images/8d4/1d4/ee6/8d41d4ee6f2a5a62a424bf58ba0a4a30.png" alt="image"><br>  Done, desktop desktop application PDF viewer for a couple of hours. <br><br>  ‚Üí <a href="https://github.com/yshurik/qpdfjs">GitHub</a> </div><p>Source: <a href="https://habr.com/ru/post/329628/">https://habr.com/ru/post/329628/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329616/index.html">Release of 3CX V15.5 RC and the new Call Flow Designer Beta (formerly 3CX VAD)</a></li>
<li><a href="../329618/index.html">How to build the infrastructure of the building. class c using servers Dell R730xd E5-2650 v4 worth 9000 euros for a penny?</a></li>
<li><a href="../329622/index.html">Creating a web application on Go in 2017. Part 4</a></li>
<li><a href="../329624/index.html">The story of the move from Odessa to Russia</a></li>
<li><a href="../329626/index.html">Answers to topical questions of young web studios / digital agencies</a></li>
<li><a href="../329632/index.html">How to start working with Emer blockchain</a></li>
<li><a href="../329634/index.html">The digest of interesting materials for the mobile # 205 developer (May 22-28)</a></li>
<li><a href="../329636/index.html">Neural networks in number detection</a></li>
<li><a href="../329638/index.html">Acquaintance with IaaS-provider: what we write on Habr√© and in our blog</a></li>
<li><a href="../329642/index.html">IBM Cognos Analytics Software integration with IBM Power. Useful tips and solutions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>