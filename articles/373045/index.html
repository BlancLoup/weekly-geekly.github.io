<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Me a telegram</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As the attentive reader remembers, there is a controller in my home that automates some commonplace processes like blinking light, which no doubt is n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Me a telegram</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/387/60b/59a/38760b59acef4b9a8e66b9687f81ed2f.png"><br><br>  As the attentive reader remembers, there <a href="https://geektimes.ru/post/258350/">is a controller</a> in my home that automates some commonplace processes like blinking light, which no doubt is necessary for every Arduino based controller. <br><br>  But that is not the problem.  And the fact that I chose to receive notifications about various events by e-mail, because it was the easiest way at the very beginning.  Now, I was tortured periodically to scrape a bunch of statuses from the mailbox (this is optional, but it‚Äôs necessary for the order), and I thought that since there is such an excellent Telegram, then why not use his talents for his own purposes. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The following are my existential experiences on the crossover of PushingBox, IFTTT and Telegram with <s>blue tape</s> to get a low-budget (and equally insane) notification system. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Tl / dr</b> <div class="spoiler_text">  Dear friends!  No, I do not have a home server.  And no, I do not plan to install a server to service the Arduino Uno notification system.  Only if completely squeezed. </div></div><br>  First, a few words about the previous configuration.  In ancient times, in one of the sleeves of a distant galaxy free mail servers were allowed to send mail via SMTP via HTTP.  That is, the Arduino Uno board in a duet with an Ethernet shield worked quite easily with this task. <br><br>  Then they all switched to HTTPS / SSL together (I hope I set out correctly) and had to invent something else, since Arduino Uno is no longer capable of HTTPS.  The <a href="https://www.pushingbox.com/">solution to the</a> situation was the <a href="https://www.pushingbox.com/">PushingBox</a> notification <a href="https://www.pushingbox.com/">service</a> , which receives the usual HTTP-request from Arduino Uno, and uses its parameters to send a notification letter (PushingBox can send letters itself). <br><br>  By the way, I liked this thing even more - it works much faster than communicating with a POP / SMTP server. <br><br>  Even better, PushingBox can also perform HTTPS requests.  And, therefore, is friends with modern web services.  Actually, I was already thinking about the topic that I probably need to make my Telegram bot and try to make friends with PushingBox, when I saw that Telegram was already working successfully with the automation service <a href="https://ifttt.com/">IFTTT</a> . <br><br>  And then I could not resist.  The fact is that IFTTT is as interesting to me as it is useless.  Those.  99.9% of its capabilities I simply have nowhere to use: in social networks it is inactive, I do not buy smart glasses, boring, in a word, personality. <br><br>  So I decided, of course, to give IFTTT a chance. <br><br>  For arbitrary interactions with the outside world, IFTTT <a href="https://ifttt.com/maker">has a Maker service</a> that can send and receive HTTP requests.  For the problem being solved, of course, the second is more relevant. <br><br>  Further, to work with Telegram, IFTTT <a href="https://ifttt.com/telegram">generally has a specialized service</a> that allows you to send messages, pictures, music to a chat or group.  The most important thing for me is the ability to send a message in a private chat.  I don‚Äôt need anybody to read the statuses. <br><br>  It remains only to link everything: <br><br>  Arduino ‚Üí PushingBox ‚Üí IFTTT ‚Üí Telegram <br><br>  Sending a request with a notification to PushingBox for me personally looks something like this (of course, there are more statuses and, of course, Ethernet initialization has been added): <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Ethernet.h&gt; #include &lt;avr/pgmspace.h&gt; //  PROGMEM char servermail[] = "api.pushingbox.com"; // PushingBox //    PROGMEM const char statusString_0[] PROGMEM = "Room_softlight_ON"; const char statusString_1[] PROGMEM = "Kitchen_softlight_ON"; const char statusString_2[] PROGMEM = "Humidifier_ON"; //      PROGMEM const char * const statusString[] = { statusString_0, statusString_1, statusString_2, }; char statusStringBuf[40]; //      void sendMail(byte statusStringN) { mail.stop(); if (mail.connect(servermail, 80)) { strcpy_P(statusStringBuf, (char*)pgm_read_word(&amp;(statusString[statusStringN]))); mail.print("GET /pushingbox?devid=_PUSHINGBOX&amp;status="); mail.print(statusStringBuf); mail.println(" HTTP/1.1"); mail.print("Host: "); mail.println(servermail); mail.println("User-Agent: Arduino"); mail.println(); } delay(1000); mail.stop(); }</span></span></span></span></code> </pre> <br>  As it is easy to see, the notification is transmitted in the &amp; status parameter, which should then be manipulated within PushingBox.  To do this, first click My Services and add the Custom URL service with the necessary parameters (they are indicated in the IFTTT campaign) and a memorable name. <br><br>  Time: <br><br><img src="https://habrastorage.org/files/d89/91a/b13/d8991ab132374d6684d065e56945bfd8.jpg"><br><br>  Two: <br><br><img src="https://habrastorage.org/files/ccc/e3f/082/ccce3f082e8c411fb8cc00fb965a7f02.jpg"><br><br>  Three: <br><br><img src="https://habrastorage.org/files/3c1/b68/431/3c1b684313514c39b1832c03de4bbd65.jpg"><br><br>  Then you need to add a script that will use this service.  And this is where the contents of the &amp; status parameter come in handy, which in PushingBox is assigned to the almost the same variable $ status $.  In general, any parameter passed to PushingBox is transformed into a variable of the same name, fringed with the icons of our box. <br><br><img src="https://habrastorage.org/files/362/c4a/9d7/362c4a9d74b7465aa4123bee682c4dff.jpg"><br><br>  So, click on My Scenarios, where after entering the name you need to add an action.  For an action related to IFTTT, you will need to know the authorization key, which is displayed <a href="https://ifttt.com/services/maker/settings">on the Maker service settings page in IFTTT</a> (you need to log in and / or register with IFTTT to see): <br><br><img src="https://habrastorage.org/files/9c0/9a5/95a/9c09a595a35b4367b8e2ed1bd5f9cdcd.jpg"><br><br>  So, after clicking Add an Action, you should select the Custom URL service created earlier in PushingBox, and in the Data parameter specify the remainder of the string that should be sent to IFTTT to trigger the condition. <br><br><img src="https://habrastorage.org/files/26f/a86/270/26fa8627034d4efe8f3ad2788c13a37f.jpg"><br><br>  For example, according to the IFTTT instruction, the request should look like this: <br><br><pre> <code class="cpp hljs">https:<span class="hljs-comment"><span class="hljs-comment">//maker.ifttt.com/trigger/{event}/with/key/_</span></span></code> </pre> <br>  From this already (when adding a service) there is a <b><a href="https://maker.ifttt.com/trigger/">maker.ifttt.com/trigger in PushingBox</a></b> , so it remains to add the event {event} and the final part with the authorization key. <br><br>  So the following combination of characters is boldly entered into the Data field mentioned above: <br><br><pre> <code class="cpp hljs">$status$/with/key/_</code> </pre> <br>  I repeat once again, in this case, $ status $ is not something unshakable.  Your variable can be called anything.  But in the framework of this example, I will stick to this terminology. <br><br>  So, PushingBox and IFTTT are related.  It remains to become attached to the Telegram, and then begins the burden.  The fact is that IFTTT (as opposed to PushingBox) responds to specific conditions and performs specific actions.  He cannot be told to transfer all incoming requests that are suitable for the conditions, immediately to Telegram. <br><br>  No, you need to add a processing rule for each condition.  Therefore, the procedure described below will have to be repeated by the number of required notifications. <br><br>  So go to IFTTT: <br><br>  1) Add a new applet with the Maker service - Receive a web request <br><br><img src="https://habrastorage.org/files/8c2/43e/21e/8c243e21e29948feb34ce433236dbed2.jpg"><br><br><img src="https://habrastorage.org/files/20e/ed0/423/20eed0423a5b411e934537de9ac4f171.jpg"><br><br><img src="https://habrastorage.org/files/139/8d6/3e3/1398d63e38bc4c13acf534d60b0e4afe.jpg"><br><br>  2) In the Event name field, specify the parameter that is passed through the $ status $ variable from the PushingBox.  In my case, this, for example, could be Humidifier_ON (or Intercom_unarmed).  Accurate to the letter and register. <br><br><img src="https://habrastorage.org/files/b22/51f/7ae/b2251f7ae1a94c09a1ed26be45cb4ae4.jpg"><br><br><img src="https://habrastorage.org/files/225/4f5/87a/2254f587a3834edf962156bab3608b33.jpg"><br><br>  3) Click on Create trigger and select the Telegram service for the condition triggering action.  When using the service for the first time, it will be necessary to authorize the IFTTT bot, but this is not a problem. <br><br>  Authorization: <br><br><img src="https://habrastorage.org/files/4db/ae1/ff7/4dbae1ff7c214e739f0c280f09eeaf15.png"><br><br>  Service selection: <br><br><img src="https://habrastorage.org/files/13f/b62/853/13fb62853aa54dbb9b2d6c8823de3f2b.jpg"><br><br>  4) As an action - Send message.  Here, the default parameters will already be specified - the address (chat or group) and a preformatted message.  If the message suits you, you can use it or collect something of your own from modifiers.  In general, I replaced the entire text with a more understandable explanation of what happened. <br><br><img src="https://habrastorage.org/files/d63/a9a/1a6/d63a9a1a6f324ffb9f0e20383295100d.jpg"><br><br><img src="https://habrastorage.org/files/64c/8be/a98/64c8bea9866544238a28a6058ec0714b.jpg"><br><br>  Those.  instead of say <br><br><pre> <code class="cpp hljs">What: {{EventName}}&lt;br&gt; When: {{OccurredAt}}&lt;br&gt; Extra Data: {{Value1}}, {{Value2}}, {{Value3}},</code> </pre><br>  In the case of the Humidifier_ON, I wrote ‚ÄúHumidifier on‚Äù (and in the case of the intercom, as in the screenshot - ‚ÄúOn-door speakerphone: unlocked‚Äù).  This is the message I will receive from the IFTTT bot when the specified condition is triggered. <br><br><img src="https://habrastorage.org/files/22e/89d/d3f/22e89dd3ff7b4119bd7b108b1aedb8d4.jpg"><br><br>  Done: <br><br><img src="https://habrastorage.org/files/723/ef7/2a9/723ef72a9f084e6b98ff770c5cbe1d3a.jpg"><br><br>  And all these torments only in order to finally see: <br><br><img src="https://habrastorage.org/files/c25/c4b/5a1/c25c4b5a1d2140c59a69cb5069767210.png"><br><br>  No, I do not argue.  It would be possible to replace the Arduino with something more advanced.  Or screw in there an ESP8266, for which there is already a TelegramBot library, which allows you to send messages to Telegram directly, without intermediaries like PushingBox or IFTTT. <br><br>  Maybe I‚Äôll do just that if PushingBox and IFTTT disappear, like AltaVista and Yahoo! .. But for now my position is firm: it‚Äôs easier for me to write a few lines of code or to configure software than to take a soldering iron in my hands. <br><br>  Sorry. <br><br>  But I believe that you are better than me, and you will surely do something more impressive.  In the meantime, if you have more thoughts and comments, then I and the readers will be very grateful for everything. </div><p>Source: <a href="https://habr.com/ru/post/373045/">https://habr.com/ru/post/373045/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../373035/index.html">Astronomers refined the location of the source of repetitive fast radio bursts</a></li>
<li><a href="../373037/index.html">Intel introduced a credit card-sized computer</a></li>
<li><a href="../373039/index.html">Browsers: time to sum up 2016</a></li>
<li><a href="../373041/index.html">Part of the games on Steam will rise in price due to the "tax on Google"</a></li>
<li><a href="../373043/index.html">Setting up Mac OS voice commands to run arbitrary code</a></li>
<li><a href="../373047/index.html">Pleasant trifles</a></li>
<li><a href="../373049/index.html">BT and MediaTek Announce Collaboration on Wireless Home Solutions</a></li>
<li><a href="../373051/index.html">Astronomers have surrendered the sky under construction</a></li>
<li><a href="../373053/index.html">Harvard CS50 course in Russian: sixteenth lecture</a></li>
<li><a href="../373055/index.html">21 companies using blockchain for authentication and identity management</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>