<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Play bash'im together</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Playing bash with multiplayer support, myth or reality? 



 The truth is somewhere here . Exposure text below. 

 The first article I. BASH'im top 
 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Play bash'im together</h1><div class="post__text post__text-html js-mediator-article">  Playing bash with multiplayer support, myth or reality? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4ed/c0c/1fe/4edc0c1fe18d8841e72feb454090673e.png" alt="image"><br><br>  The truth is somewhere <a href="https://github.com/vaniacer/piu-piu-SH">here</a> .  Exposure text below. <br><a name="habracut"></a><br>  The first article <a href="https://habrahabr.ru/post/335960">I. BASH'im top</a> <br>  The second article <a href="https://habrahabr.ru/post/335960">I. BASH'im further</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The implementation of multiplayer did not give me rest.  But I understood that the game would slow down in a co-op.  Therefore, there was a lot of work to increase productivity.  I turned the sprites this way and that and thought: ‚ÄúWhat if the coordinates of the sprite (the control markup characters \ e [$ {Y}; $ {X} H) are placed directly in the sprite?  And display the whole sprite at once in one team, not in pieces in a loop. ‚Äù  All the sprites had to be redone) Now the sprite is a sprite (O_o) and a function of the form (on the example of someone else's): <br><br><pre><code class="bash hljs">alien=(<span class="hljs-string"><span class="hljs-string">'Z___ '</span></span> <span class="hljs-string"><span class="hljs-string">'( ) '</span></span> <span class="hljs-string"><span class="hljs-string">'Z`¬Ø¬¥ '</span></span>) alienH=<span class="hljs-variable"><span class="hljs-variable">${#alien[*]}</span></span> alienW=<span class="hljs-variable"><span class="hljs-variable">${#alien[1]}</span></span> CM1=<span class="hljs-variable"><span class="hljs-variable">$DIM</span></span><span class="hljs-variable"><span class="hljs-variable">$BLK</span></span> CM2=<span class="hljs-variable"><span class="hljs-variable">$BLD</span></span><span class="hljs-variable"><span class="hljs-variable">$BLK</span></span> alien_color=(<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SKY</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$CM1</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$CM2</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$CM1</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SKY</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$CM1</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$red</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$red</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$red</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$CM1</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SKY</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SKY</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$CM1</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$CM1</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$CM1</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SKY</span></span></span><span class="hljs-string">"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> sprite_alien { hight=<span class="hljs-variable"><span class="hljs-variable">$alienH</span></span> width=<span class="hljs-variable"><span class="hljs-variable">$alienW</span></span> color=(<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${alien_color[@]}</span></span></span><span class="hljs-string">"</span></span>) target=(<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$OX</span></span></span><span class="hljs-string"> $[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$OY</span></span></span><span class="hljs-string">+1]"</span></span> <span class="hljs-string"><span class="hljs-string">"$[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$OX</span></span></span><span class="hljs-string">+1] $[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$OY</span></span></span><span class="hljs-string">+1]"</span></span>) CM1=<span class="hljs-variable"><span class="hljs-variable">$SKY</span></span><span class="hljs-variable"><span class="hljs-variable">$DIM</span></span><span class="hljs-variable"><span class="hljs-variable">$BLK</span></span> CM2=<span class="hljs-variable"><span class="hljs-variable">$BLD</span></span><span class="hljs-variable"><span class="hljs-variable">$BLK</span></span> sprite=(<span class="hljs-string"><span class="hljs-string">"\e[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$OY</span></span></span><span class="hljs-string">;$[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$OX</span></span></span><span class="hljs-string">+1]H</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CM1}</span></span></span><span class="hljs-string">_</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CM2}</span></span></span><span class="hljs-string">_</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CM1}</span></span></span><span class="hljs-string">_</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SKY</span></span></span><span class="hljs-string"> "</span></span> <span class="hljs-string"><span class="hljs-string">"\e[$[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$OY</span></span></span><span class="hljs-string">+1];</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${OX}</span></span></span><span class="hljs-string">H</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CM1}</span></span></span><span class="hljs-string">(</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${red}</span></span></span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${small[$L]}</span></span></span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CM1}</span></span></span><span class="hljs-string">)</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${SKY}</span></span></span><span class="hljs-string"> "</span></span> <span class="hljs-string"><span class="hljs-string">"\e[$[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$OY</span></span></span><span class="hljs-string">+2];$[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$OX</span></span></span><span class="hljs-string">+1]H"</span></span><span class="hljs-variable"><span class="hljs-variable">${CM1}</span></span><span class="hljs-string"><span class="hljs-string">'`¬Ø¬¥ '</span></span><span class="hljs-variable"><span class="hljs-variable">${SKY}</span></span>) sprite2=(<span class="hljs-string"><span class="hljs-string">'Z___ '</span></span> <span class="hljs-string"><span class="hljs-string">"(</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${small[$L]}</span></span></span><span class="hljs-string">) "</span></span> <span class="hljs-string"><span class="hljs-string">'Z`¬Ø¬¥ '</span></span>) }</code> </pre> <br>  The <i>sprite_alien</i> function sets variables: <i>hight</i> - the height of the sprite (number of lines), <i>width</i> - the width of the sprite (the number of characters in the widest element of the sprite) and the array <i>color</i> - character-by-character coloring required for character-by-character output.  In the <i>sprite</i> array, a <i>sprite is</i> generated for the ‚Äúfast‚Äù mode, the control characters of coordinates and colors are inserted.  The <i>target</i> array specifies the coordinates of the collisions of this sprite (absent from the background objects).  <i>Sprite2 is</i> required for ‚Äúslow‚Äù character-by-character output, which is implemented by the functions: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    function cut_in () { for ((h=0; h&lt;$hight; h++)); do spr= for ((c=0; c&lt;$cuter; c++)); do color2=(${color[$h]}) symbol=${sprite2[$h]:$c:1} symbol=${symbol//'\'/'\\'} symbol=${symbol//'Z'/"\e[$[$OY+$h];$[$OX+$c+1]H"} spr+="${color2[$c]}$symbol" done sprite[$h]="$SKY\e[$[$OY+$h];${OX}H$spr" done } #    function cut_out () { for ((h=0; h&lt;$hight; h++)); do spr=; stp=1 for ((w=$[1-$OX]; w&lt;$width; w++)); do ((stp++)) color2=(${color[$h]}) symbol="${sprite2[$h]:$w:1}" symbol=${symbol//'\'/'\\'} symbol=${symbol//'Z'/"\e[$[$OY+$h];${stp}H"} spr+="${color2[$w]}$symbol" done sprite[$h]="\e[$[$OY+$h];1H$spr" done }</span></span></code> </pre><br>  The symbol ‚ÄúZ‚Äù plays the role of a mask, now sprites can be with ‚Äúholes‚Äù inside.  The output of these functions is an array of <i>sprite</i> .  Objects are still processed and drawn with the <i>mover</i> function <i>,</i> which, however, has undergone some changes: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mover</span></span></span></span> () { timer=<span class="hljs-variable"><span class="hljs-variable">$1</span></span> <span class="hljs-comment"><span class="hljs-comment">#      case $type:"$HX $HY" in #    'alien':${target[0]}| 'alien':${target[1]}| 'alien':${target[2]}) erase_obj $i $hight ((life--)) ((frags++)) ((enumber--)) OBJ+=("$OX $OY 0 boom") return;; #    'gunup':${target[0]}| 'gunup':${target[1]}| 'gunup':${target[2]}) erase_obj $i $hight; [[ ${G} -lt 5 ]] &amp;&amp; ((G++)) return;; #   'ammo':${target[0]}| 'ammo':${target[1]}| 'ammo':${target[2]}) erase_obj $i $hight; ((ammo+=100)) return;; #   'life':${target[0]}| 'life':${target[1]}| 'life':${target[2]}) erase_obj $i $hight; ((life++)) return;; #    'bfire':${target[0]}| 'bfire':${target[1]}| 'bfire':${target[2]}) erase_obj $i $hight; ((life--)) return;; #       'boss':${target[0]}| 'boss':${target[1]}| 'boss':${target[2]}) ((life--)); ((bhealth-=10)) return;; esac #   (  )   case $type in 'alien' | 'boss') for (( t=0; t&lt;$NP; t++ )); do PI=(${PIU[$t]}) PX=${PI[0]} PY=${PI[1]} #     case "$PX $PY" in # hit by bullet #     target ${target[0]}|${target[1]}|${target[2]}|${target[3]}|${target[4]}|${target[5]}) case $type in 'alien') case $[RANDOM % $rnd] in 0) OBJ+=("$OX $OY 0 ${bonuses[$[RANDOM % ${#bonuses[@]}]]}");; esac # get bonus ((enumber--)) erase_obj $i $hight remove_piu $t OBJ+=("$OX $OY 0 boom") return;; 'boss' ) remove_piu $t ((bhealth--)) continue;; esac esac done esac # print [[ $cuter -lt $width ]] &amp;&amp; cut_in # ,  [[ $OX -le 1 ]] &amp;&amp; cut_out # ,  [[ $OX -le -$width ]] &amp;&amp; { # ,    remove_obj $i case $type in 'alien') ((enumber--));; esac; return } || printf "${sprite[*]}" #   ,  #   case $timer in 0) ((OX--)); ((cuter++)); OBJ[$i]="$OX $OY $cuter $type";; esac }</span></span></code> </pre><br>  Handling collisions with a new method also had a positive effect on performance.  In the main loop, processing objects looks like this: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#-{ Move\check\print all flying to hero objects }----------- NO=${#OBJ[@]}; for (( i=0; i&lt;$NO; i++ )); do OI=(${OBJ[$i]}) OX=${OI[0]} OY=${OI[1]} cuter=${OI[2]} type=${OI[3]} case $type in #----------+---------------+------------+-----+----------+ # OBJ type | sprite maker |sprite mover|timer| comment | #----------+---------------+------------+-----+----------+ 'tree1' ) sprite_tree1 ; mover $Q ;; # 'tree2' ) sprite_tree2 ; mover $W ;; # Trees 'tree3' ) sprite_tree3 ; mover $E ;; # 'cloud1') sprite_cloud1; mover $Q ;; # 'cloud2') sprite_cloud2; mover $W ;; # Clouds 'cloud3') sprite_cloud3; mover $E ;; # 'boss' ) sprite_boss ; mover 1 ;; # Boss 'alien' ) sprite_alien ; mover 0 ;; # Aliens 'bfire' ) sprite_bfire ; mover 0 ;; # Boss' plasma shot 'ammo' ) sprite_ammob ; mover 0 ;; # Ammo bonus 'life' ) sprite_lifep ; mover 0 ;; # Life bonus 'gunup' ) sprite_gunup ; mover 0 ;; # Gun powerup bonus #  'boom' ) sprite_boom;; esac; done</span></span></code> </pre><br>  What happened to squeeze in the end?  For comparison, the old method: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ce4/469/923/ce4469923d1b2bde9df7249bd300352a.gif" alt="image"><br><br>  New method: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/12f/fef/cc3/12ffefcc37f315f3b7b2b1edca0b6241.gif" alt="image"><br><br>  Double increase in FPS, not bad.  By the way, for the measurement function is used <i>fps_counter</i> which initially looked like this: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> fps_counter { cur_sec=$(date +<span class="hljs-string"><span class="hljs-string">'%s'</span></span>) [[ <span class="hljs-variable"><span class="hljs-variable">$cur_sec</span></span> -gt <span class="hljs-variable"><span class="hljs-variable">$sec</span></span> ]] &amp;&amp; { FPS=<span class="hljs-variable"><span class="hljs-variable">$FPSC</span></span> [[ <span class="hljs-variable"><span class="hljs-variable">$FPS</span></span> -gt <span class="hljs-variable"><span class="hljs-variable">$FPSM</span></span> ]] &amp;&amp; FPSM=<span class="hljs-variable"><span class="hljs-variable">$FPS</span></span> [[ <span class="hljs-variable"><span class="hljs-variable">$FPS</span></span> -lt <span class="hljs-variable"><span class="hljs-variable">$FPSL</span></span> ]] &amp;&amp; FPSL=<span class="hljs-variable"><span class="hljs-variable">$FPS</span></span> sec=<span class="hljs-variable"><span class="hljs-variable">$cur_sec</span></span> FPSC=0 } || ((FPSC++)) }</code> </pre><br>  <i>Date was</i> used, but this method of measuring performance noticeably reduced this very performance.  I was prompted by another option, use <i>printf</i> : <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> fps_counter { <span class="hljs-comment"><span class="hljs-comment">#Needs bash 4.2 printf -v cur_sec '%(%s)T\n' -1 [[ $cur_sec -gt $sec ]] &amp;&amp; { FPS=$FPSC [[ $FPS -gt $FPSM ]] &amp;&amp; FPSM=$FPS [[ $FPS -lt $FPSL ]] &amp;&amp; FPSL=$FPS sec=$cur_sec FPSC=0 } || ((FPSC++)) }</span></span></code> </pre><br>  It turned out much nicer.  Thank you, Alexander!  I decided to use the performance boost for mining the anonymous cryptocurrency <i>Monero</i> and made the appropriate tab to the game.  Let's see how the FPS has changed: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ce4/469/923/ce4469923d1b2bde9df7249bd300352a.gif" alt="image"><br><br>  At the level of the old method, as if nothing has changed, great, no one will notice anything! <br><br>  This is a joke, of course, although this trend is planned, beware.  Not stopping on my laurels, I began to think and guess how to raise the FPS even higher.  I developed the first idea and decided not to display the sprites separately, but to draw them into the <i>screen</i> array, and then draw ALL at once with one command!  It was not necessary to <i>redo</i> much, in the <i>mover</i> function output via <i>printf</i> <br><br><pre> <code class="bash hljs"> <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${sprite[*]}</span></span></span><span class="hljs-string">"</span></span></code> </pre><br>  replaced by apend <i>screen</i> array <br><br><pre> <code class="bash hljs"> screen+=(<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${sprite[*]}</span></span></span><span class="hljs-string">"</span></span>)</code> </pre><br>  The rest of the drawers in the loop also switched to the <i>screen</i> and at the end of the loop added <br><br><pre> <code class="bash hljs"> <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${screen[*]}</span></span></span><span class="hljs-string">"</span></span></code> </pre><br>  Waiting for a 10-fold increase in performance, I quickly launched a new version: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d22/178/2c0/d221782c06202c996ff3f7fafc16b636.gif" alt="image"><br><br>  But the increase was not as breathtaking as I expected (I forgot to turn off mining)), however, this modest step in increasing productivity was a huge leap on the way to multiplayer.  This method turned out to be extremely convenient for drawing a picture from a client, the client immediately receives a ready frame from the server and draws it!  Multiplayer is almost ready, practically. <br><br>  Additional FPS went into the business.  The new engine allowed to increase the number of background objects.  There are more trees, and the clouds in the fall cover the whole sky and the sun is almost invisible (as in the real world). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/896/0ae/ae6/8960aeae63e7d84b9e383208143f9df3.gif" alt="image"><br><br>  It's time to do multiplayer.  What do you need for multiplayer?  It is necessary to transfer data between the computers involved in the game.  What data?  You can transfer all changes back and forth, but there are a lot of problems synchronizing all objects on the client and server.  Therefore, you need to send only the necessary minimum, perform all calculations on the server, giving the client the finished result.  I did not invent a bicycle here, the idea was borrowed from modern games, most of which work that way.  My client sends the server its address and port so that the server knows who to answer.  Configuration options: the symbol of the airplane and the color of the airplane \ symbol.  Handles the pressing of the WASDP buttons and sends the coordinates of the airplane, as well as the fact of pressing the trigger.  Here is the client line: <br><br><pre> <code class="bash hljs"> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${caddr[0]}</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cport</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HS</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SC</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HC</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$X</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$Y</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$PIU</span></span></span><span class="hljs-string">"</span></span></code> </pre><br>  The server, on the basis of this information, adds a second airplane to the game, performs all calculations, draws a picture and sends the finished picture to the client.  Thus, at both terminals we get the same picture. <br>  How to transmit?  Bash doesn‚Äôt know how to listen to the port (or I don‚Äôt know how to do it on the bash), so I had to use the <i>netcat</i> utility in the common people <i>nc</i> . <br><br><div class="spoiler">  <b class="spoiler_title">Small lyrical digression</b> <div class="spoiler_text">  <i>Netcat is</i> generally a very useful utility.  There were already a lot of articles about him, but how I use it daily: <br><br><pre> <code class="bash hljs">Host gate <span class="hljs-comment"><span class="hljs-comment">#     HostName 192.168.1.1 User user Host some_host #       HostName 192.168.0.1 User user ProxyCommand ssh gate nc %h %p</span></span></code> </pre><br>  As part of <i>ProxyCommand'a</i> in the config <i>~ / .ssh / config</i> , very convenient.  Hmm, this time is really small.  Add a few words.  Having stumbled somewhere on these your Internet on information about changing the command line prompt, I decided to do something of my own.  The result is such a <a href="https://github.com/vaniacer/info-bar">project</a> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd3/f0c/30d/fd3f0c30dc2209dabe7c57dc53e18e13.png" alt="image"><br><br>  The command line is maximized and the necessary information: working directory, time, date and funny emoticons, which are randomly generated each time, are located on the top and are separated by lines.  It turned out very convenient.  And one more hand-made article for convenience, I called it a spiner, then this word was not yet abusive.  What for?  Um, I was somewhat puzzled by the lack of, for example, the <i>cp</i> command of the progress <i>bar</i> , you are copying a large file and looking into the void.  In a black hole, I would even say.  It turned out such a script.  It is screwed with an alias like this: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> cp=<span class="hljs-string"><span class="hljs-string">"~/SCR/spiner cp"</span></span></code> </pre><br>  It runs the <i>cp</i> command with the specified arguments in the background, and while it is executed it shows a cool animation: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/632/a19/e35/632a19e35d01b586bd4f104cbb80033f.gif" alt="image"><br><br>  Separately, an interesting point: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/007/456/324/0074563244b6ce4482b54fd47b983769.gif" alt="image"><br><br>  This, uh, eyes, they are knocking against each other like this, uh, here) Not a progress bar of course, but also interesting. <br></div></div><br>  Here is what the client looks like: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> PIU=; client_read until nc <span class="hljs-variable"><span class="hljs-variable">$saddr</span></span> <span class="hljs-variable"><span class="hljs-variable">$sport</span></span> 2&gt; /dev/null &lt;&lt;&lt; \ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${caddr[0]}</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cport</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HS</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SC</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HC</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$X</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$Y</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$PIU</span></span></span><span class="hljs-string">"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> client_read; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> client_read screen=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(nc -l $cport)</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-variable"><span class="hljs-variable">$screen</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">'win'</span></span>| <span class="hljs-string"><span class="hljs-string">'lose'</span></span>) client=; game_type=<span class="hljs-string"><span class="hljs-string">'single'</span></span>; mess <span class="hljs-variable"><span class="hljs-variable">$screen</span></span>;; <span class="hljs-keyword"><span class="hljs-keyword">esac</span></span> <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$screen</span></span></span><span class="hljs-string">"</span></span> client_read <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre><br>  Yes, that's all) The <i>client_read</i> function is a button poll: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> client_read { <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -t<span class="hljs-variable"><span class="hljs-variable">$spd</span></span> -n1 input &amp;&gt; /dev/null; input=<span class="hljs-variable"><span class="hljs-variable">${input:0:1}</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-variable"><span class="hljs-variable">$input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">'w'</span></span>|<span class="hljs-string"><span class="hljs-string">'W'</span></span>) [[ <span class="hljs-variable"><span class="hljs-variable">$Y</span></span> -gt 1 ]] &amp;&amp; ((Y--));; <span class="hljs-string"><span class="hljs-string">'a'</span></span>|<span class="hljs-string"><span class="hljs-string">'A'</span></span>) [[ <span class="hljs-variable"><span class="hljs-variable">$X</span></span> -gt 1 ]] &amp;&amp; ((X--));; <span class="hljs-string"><span class="hljs-string">'s'</span></span>|<span class="hljs-string"><span class="hljs-string">'S'</span></span>) [[ <span class="hljs-variable"><span class="hljs-variable">$Y</span></span> -lt <span class="hljs-variable"><span class="hljs-variable">$heroendy</span></span> ]] &amp;&amp; ((Y++));; <span class="hljs-string"><span class="hljs-string">'d'</span></span>|<span class="hljs-string"><span class="hljs-string">'D'</span></span>) [[ <span class="hljs-variable"><span class="hljs-variable">$X</span></span> -lt <span class="hljs-variable"><span class="hljs-variable">$heroendx</span></span> ]] &amp;&amp; ((X++));; <span class="hljs-string"><span class="hljs-string">'p'</span></span>|<span class="hljs-string"><span class="hljs-string">'P'</span></span>) PIU=<span class="hljs-string"><span class="hljs-string">"piu"</span></span>;; <span class="hljs-keyword"><span class="hljs-keyword">esac</span></span> }</code> </pre><br>  Why did you need to make <i>read</i> into a separate function and perform several times?  The survey is performed with a delay of 0.0001 seconds, however, for the co-op mode, it was necessary to increase the waiting time to 0.001, i.e.  <i>read</i> is performed with the <i>-t0.001</i> parameter, data transfer to the server takes much longer.  The client does not know whether the port is open on the server or not; he simply ‚Äúknocks‚Äù until he is ‚Äúopened‚Äù.  And the player all this time presses the buttons and yells: ‚ÄúWhy does he not fly ?!  I pressed !!! 111 .... "It turns out the effect of non-working buttons.  Therefore, a poll has been added to the body of the <i>until</i> loop and several more times in the main loop, so for sure) Then the client waits for the result from the server, reading to the <i>screen</i> variable, this is also a big delay, but, unfortunately, it can not be diluted. <br><br>  But as it turned out later, this effect was present on my computer due to the fact that I was running both the client and the server (on the same computer).  In the end, I left the original value of <i>$ spd</i> in multiplayer mode and changed the client‚Äôs work.  The client now sends only <i>$ input</i> .  Here's what it looks like: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> client_read { <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -t<span class="hljs-variable"><span class="hljs-variable">$spd</span></span> -s -n1 input &amp;&gt; /dev/null } <span class="hljs-comment"><span class="hljs-comment">#----{ Initialisation }---- [[ $server ]] &amp;&amp; { XY 2 1 $SKY$RED"${game_type^} mode. Waiting for client..." CLD=80 TRE=70 clnt=($(nc -l $sport)) caddr=${clnt[0]} cport=${clnt[1]} HC2=${clnt[2]} HS2=${clnt[3]} SC2=${clnt[4]} } [[ $client ]] &amp;&amp; { sender $saddr $sport "${caddr[0]} $cport $HC $HS $SC" ':' XY 2 1 $SKY$RED"Waiting for server..." #===={ Main game loop client mode}==== while true; do client_read sender $saddr $sport $input client_read screen="$(nc -l $cport)" case $screen in 'win'| 'lose') client=; cors='single'; mess $screen;; esac printf "$screen" done</span></span></code> </pre><br>  What happens on the server?  The function <i>sprite_hero2</i> opens the port and waits for information from the client.  And on the basis of the information received, a second player's sprite is created, and bullets are added, if necessary.  The bullets are added to the common <i>PIU</i> array in order not to perform additional collision checks.  To determine who should be credited frags, the bullet record has been expanded, an index of 1 or 2, the first or second player, respectively, has been added.  And in the <i>mover'e</i> added verification of the owner when the <i>bullet</i> hit the stranger: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-variable"><span class="hljs-variable">$owner</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 1) ((frags++));; 2) ((frags2++));; <span class="hljs-keyword"><span class="hljs-keyword">esac</span></span></code> </pre><br>  <i>Sprite_hero2</i> function: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> sprite_hero2 { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> $(nc -l <span class="hljs-variable"><span class="hljs-variable">$sport</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">'w'</span></span>|<span class="hljs-string"><span class="hljs-string">'W'</span></span>) [[ <span class="hljs-variable"><span class="hljs-variable">$Y2</span></span> -gt 1 ]] &amp;&amp; ((Y2--));; <span class="hljs-string"><span class="hljs-string">'a'</span></span>|<span class="hljs-string"><span class="hljs-string">'A'</span></span>) [[ <span class="hljs-variable"><span class="hljs-variable">$X2</span></span> -gt 1 ]] &amp;&amp; ((X2--));; <span class="hljs-string"><span class="hljs-string">'s'</span></span>|<span class="hljs-string"><span class="hljs-string">'S'</span></span>) [[ <span class="hljs-variable"><span class="hljs-variable">$Y2</span></span> -lt <span class="hljs-variable"><span class="hljs-variable">$heroendy</span></span> ]] &amp;&amp; ((Y2++));; <span class="hljs-string"><span class="hljs-string">'d'</span></span>|<span class="hljs-string"><span class="hljs-string">'D'</span></span>) [[ <span class="hljs-variable"><span class="hljs-variable">$X2</span></span> -lt <span class="hljs-variable"><span class="hljs-variable">$heroendx</span></span> ]] &amp;&amp; ((X2++));; <span class="hljs-string"><span class="hljs-string">'p'</span></span>|<span class="hljs-string"><span class="hljs-string">'P'</span></span>) [[ <span class="hljs-variable"><span class="hljs-variable">$ammo2</span></span> -ge <span class="hljs-variable"><span class="hljs-variable">$G2</span></span> &amp;&amp; <span class="hljs-variable"><span class="hljs-variable">$CD2</span></span> -eq 0 ]] &amp;&amp; { CD2=7; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-variable"><span class="hljs-variable">$G2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 1) PIU+=(<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HX2</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HY2</span></span></span><span class="hljs-string"> 2"</span></span>);; 2) PIU+=(<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HX2</span></span></span><span class="hljs-string"> $[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HY2</span></span></span><span class="hljs-string">+1] 2"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HX2</span></span></span><span class="hljs-string"> $[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HY2</span></span></span><span class="hljs-string">-1] 2"</span></span>);; 3) PIU+=(<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HX2</span></span></span><span class="hljs-string"> $[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HY2</span></span></span><span class="hljs-string">+1] 2"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HX2</span></span></span><span class="hljs-string"> $[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HY2</span></span></span><span class="hljs-string">-1] 2"</span></span> <span class="hljs-string"><span class="hljs-string">"$[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HX2</span></span></span><span class="hljs-string">+1] </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HY2</span></span></span><span class="hljs-string"> 2"</span></span>);; 4) PIU+=(<span class="hljs-string"><span class="hljs-string">"$[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HX2</span></span></span><span class="hljs-string">+1] $[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HY2</span></span></span><span class="hljs-string">+1] 2"</span></span> <span class="hljs-string"><span class="hljs-string">"$[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HX2</span></span></span><span class="hljs-string">+1] $[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HY2</span></span></span><span class="hljs-string">-1] 2"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HX2</span></span></span><span class="hljs-string"> $[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HY2</span></span></span><span class="hljs-string">+2] 2"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HX2</span></span></span><span class="hljs-string"> $[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HY2</span></span></span><span class="hljs-string">-2] 2"</span></span>);; 5) PIU+=(<span class="hljs-string"><span class="hljs-string">"$[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HX2</span></span></span><span class="hljs-string">+1] $[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HY2</span></span></span><span class="hljs-string">+1] 2"</span></span> <span class="hljs-string"><span class="hljs-string">"$[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HX2</span></span></span><span class="hljs-string">+1] $[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HY2</span></span></span><span class="hljs-string">-1] 2"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HX2</span></span></span><span class="hljs-string"> $[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HY2</span></span></span><span class="hljs-string">+2] 2"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HX2</span></span></span><span class="hljs-string"> $[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HY2</span></span></span><span class="hljs-string">-2] 2"</span></span> <span class="hljs-string"><span class="hljs-string">"$[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HX2</span></span></span><span class="hljs-string">+2] </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HY2</span></span></span><span class="hljs-string"> 2"</span></span>);; <span class="hljs-keyword"><span class="hljs-keyword">esac</span></span>; ((ammo2-=<span class="hljs-variable"><span class="hljs-variable">$G2</span></span>)); };; <span class="hljs-keyword"><span class="hljs-keyword">esac</span></span> CM4=<span class="hljs-variable"><span class="hljs-variable">$DIM</span></span><span class="hljs-variable"><span class="hljs-variable">$HC2</span></span>; CM5=<span class="hljs-variable"><span class="hljs-variable">$SKY</span></span><span class="hljs-variable"><span class="hljs-variable">$HC2</span></span> CM6=<span class="hljs-variable"><span class="hljs-variable">$BLD</span></span><span class="hljs-variable"><span class="hljs-variable">$HC2</span></span>; CM7=<span class="hljs-variable"><span class="hljs-variable">$SKY</span></span><span class="hljs-variable"><span class="hljs-variable">$SC2</span></span><span class="hljs-variable"><span class="hljs-variable">$HS2</span></span><span class="hljs-variable"><span class="hljs-variable">$HC2</span></span><span class="hljs-variable"><span class="hljs-variable">$BLD</span></span> CM8=<span class="hljs-variable"><span class="hljs-variable">$DIM</span></span><span class="hljs-variable"><span class="hljs-variable">$UND</span></span>; CM9=<span class="hljs-variable"><span class="hljs-variable">$SKY</span></span><span class="hljs-variable"><span class="hljs-variable">$HC2</span></span><span class="hljs-variable"><span class="hljs-variable">$BLD</span></span> sprite=( <span class="hljs-string"><span class="hljs-string">"\e[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$Y2</span></span></span><span class="hljs-string">;</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${X2}</span></span></span><span class="hljs-string">H"</span></span><span class="hljs-variable"><span class="hljs-variable">${SKY}</span></span><span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-string"><span class="hljs-string">"\e[$[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$Y2</span></span></span><span class="hljs-string">+1];</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${X2}</span></span></span><span class="hljs-string">H"</span></span><span class="hljs-variable"><span class="hljs-variable">${CM5}</span></span><span class="hljs-string"><span class="hljs-string">' __ '</span></span><span class="hljs-variable"><span class="hljs-variable">${SKY}</span></span> <span class="hljs-string"><span class="hljs-string">"\e[$[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$Y2</span></span></span><span class="hljs-string">+2];</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${X2}</span></span></span><span class="hljs-string">H"</span></span><span class="hljs-variable"><span class="hljs-variable">${CM4}</span></span><span class="hljs-string"><span class="hljs-string">" |</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CM7}</span></span></span><span class="hljs-string">„Äµ</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CM5}</span></span></span><span class="hljs-string">____ "</span></span><span class="hljs-variable"><span class="hljs-variable">${SKY}</span></span> <span class="hljs-string"><span class="hljs-string">"\e[$[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$Y2</span></span></span><span class="hljs-string">+3];</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${X2}</span></span></span><span class="hljs-string">H"</span></span><span class="hljs-variable"><span class="hljs-variable">${CM4}</span></span><span class="hljs-string"><span class="hljs-string">" \_| </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CM6}</span></span></span><span class="hljs-string">/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CM8}</span></span></span><span class="hljs-string"> ¬∞</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CM9}</span></span></span><span class="hljs-string">)</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${blk}</span></span></span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${gun[$G2]}</span></span></span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${SKY}</span></span></span><span class="hljs-string"> "</span></span> <span class="hljs-string"><span class="hljs-string">"\e[$[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$Y2</span></span></span><span class="hljs-string">+4];</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${X2}</span></span></span><span class="hljs-string">H"</span></span><span class="hljs-variable"><span class="hljs-variable">${CM4}</span></span><span class="hljs-string"><span class="hljs-string">" |</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${BLD}</span></span></span><span class="hljs-string">/ "</span></span><span class="hljs-variable"><span class="hljs-variable">${SKY}</span></span> <span class="hljs-string"><span class="hljs-string">"\e[$[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$Y2</span></span></span><span class="hljs-string">+5];</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${X2}</span></span></span><span class="hljs-string">H"</span></span><span class="hljs-variable"><span class="hljs-variable">${SKY}</span></span><span class="hljs-string"><span class="hljs-string">' '</span></span>) screen+=(<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${sprite[*]}</span></span></span><span class="hljs-string">"</span></span>) }</code> </pre><br>  At the end of the main loop, the server draws a picture of itself and sends it to the client. <br><br><pre> <code class="bash hljs">[[ <span class="hljs-variable"><span class="hljs-variable">$life</span></span> -gt 0 ]] \ &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${screen[*]}</span></span></span><span class="hljs-string">"</span></span> \ || { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-variable"><span class="hljs-variable">$make_once</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>) XY 1 1 <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$DEF</span></span></span><span class="hljs-string">"</span></span>; clear sprite_lose; <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${sprite[*]}</span></span></span><span class="hljs-string">"</span></span> OBJ+=(<span class="hljs-string"><span class="hljs-string">" </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$X</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$Y</span></span></span><span class="hljs-string"> 0 boom"</span></span> <span class="hljs-string"><span class="hljs-string">"$[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$X</span></span></span><span class="hljs-string">+1] $[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$Y</span></span></span><span class="hljs-string">+1] 0 boom"</span></span> <span class="hljs-string"><span class="hljs-string">"$[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$X</span></span></span><span class="hljs-string">+2] $[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$Y</span></span></span><span class="hljs-string">+2] 0 boom"</span></span>) make_once=<span class="hljs-keyword"><span class="hljs-keyword">done</span></span>;; <span class="hljs-keyword"><span class="hljs-keyword">esac</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-variable"><span class="hljs-variable">$server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>) [[ <span class="hljs-variable"><span class="hljs-variable">$life2</span></span> -le 0 ]] &amp;&amp; { sender <span class="hljs-variable"><span class="hljs-variable">$caddr</span></span> <span class="hljs-variable"><span class="hljs-variable">$cport</span></span> <span class="hljs-string"><span class="hljs-string">'lose'</span></span> server_read server=; Y2=; cors=<span class="hljs-string"><span class="hljs-string">'single'</span></span> OBJ+=(<span class="hljs-string"><span class="hljs-string">" </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$X2</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$Y2</span></span></span><span class="hljs-string"> 0 boom"</span></span> <span class="hljs-string"><span class="hljs-string">"$[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$X2</span></span></span><span class="hljs-string">+1] $[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$Y2</span></span></span><span class="hljs-string">+1] 0 boom"</span></span> <span class="hljs-string"><span class="hljs-string">"$[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$X2</span></span></span><span class="hljs-string">+2] $[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$Y2</span></span></span><span class="hljs-string">+2] 0 boom"</span></span>) } [[ <span class="hljs-variable"><span class="hljs-variable">$life2</span></span> -gt 0 &amp;&amp; <span class="hljs-variable"><span class="hljs-variable">$bhealth</span></span> -le 0 ]] &amp;&amp; { sender <span class="hljs-variable"><span class="hljs-variable">$caddr</span></span> <span class="hljs-variable"><span class="hljs-variable">$cport</span></span> <span class="hljs-string"><span class="hljs-string">'win'</span></span> server_read cors=<span class="hljs-string"><span class="hljs-string">'single'</span></span> server= };; *) [[ <span class="hljs-variable"><span class="hljs-variable">$bhealth</span></span> -le 0 ]] &amp;&amp; mess win [[ <span class="hljs-variable"><span class="hljs-variable">$life</span></span> -le 0 ]] &amp;&amp; mess lose;; <span class="hljs-keyword"><span class="hljs-keyword">esac</span></span> [[ <span class="hljs-variable"><span class="hljs-variable">$server</span></span> ]] &amp;&amp; sender <span class="hljs-variable"><span class="hljs-variable">$caddr</span></span> <span class="hljs-variable"><span class="hljs-variable">$cport</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${screen[*]}</span></span></span><span class="hljs-string">"</span></span> server_read</code> </pre><br>  To handle the death of one of the players, type checks are added: <br><br><pre> <code class="bash hljs">[[ <span class="hljs-variable"><span class="hljs-variable">$life</span></span> -gt 0 ]] &amp;&amp; ...</code> </pre><br>  If the client is the first to die, the message ‚Äúlose‚Äù is sent instead of the picture, and the server goes into single mode, and the client draws a ‚Äúgame over‚Äù.  Therefore, the new Boss is trying to kill the client first, to make life easier for the server (sorry).  But if the server dies first, the client should be given a chance, the data exchange continues, but the server instead of the picture draws a gamover and transfers the picture to the client.  As a result, we get: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/848/fa2/491/848fa24918b8f9462f715f1a7dd1573e.gif" alt="image"><br><br>  Having worked a bit, I added the duel mode: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/535/1d9/855/5351d9855468ec2d482d49af891ec619.gif" alt="image"><br><br>  And it was necessary to check how it affected the co-op regime ... But I did not do that and as a result I got an interesting effect.  Airplane of the second player flew backwards and shot, sorry, from the <s>ass</s> tail) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8f9/77b/698/8f977b6982547a79a54004a332a05513.gif" alt="image"><br><br>  Corrected kosyachek with winter trees, exposing them: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/235/6ef/5c1/2356ef5c1bbb9eb4d4939012cbc7575a.gif" alt="image"><br><br>  Well, let's fly further!  It will be necessary to work on optimization.  But in general, it turned out quite well. <br><br>  Piu, piu, piu!) </div><p>Source: <a href="https://habr.com/ru/post/339268/">https://habr.com/ru/post/339268/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339250/index.html">Identify hidden data dependencies to improve the quality of the forecast in machine learning</a></li>
<li><a href="../339252/index.html">Octopus Deploy. Improving the world in a bloody enterprise</a></li>
<li><a href="../339258/index.html">English subtitles with Leo</a></li>
<li><a href="../339262/index.html">Trends and forecasts: which specialists will be snapped up in the near future?</a></li>
<li><a href="../339264/index.html">Introduction to reverse engineering with Radare2</a></li>
<li><a href="../339270/index.html">Wi-Fi is over: calculate offenders wireless</a></li>
<li><a href="../339272/index.html">Why do I need the flexibility of Python if I am forbidden to use it?</a></li>
<li><a href="../339274/index.html">Trillion Markets, or have time to do in 10 years</a></li>
<li><a href="../339276/index.html">How to accept payments in a mobile application: tokenization, NFC, optical scanning and other buns in one SDK</a></li>
<li><a href="../339278/index.html">Technical composition of process diagrams</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>