<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with Facebook API from UWP applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="People, as a rule, creatures are very forgetful. In order not to force users to remember a new password when registering with your UWP application, yo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with Facebook API from UWP applications</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/b1a/e04/42c/b1ae0442cad649738a114ef4e685a9a9.jpg"></div><br>  People, as a rule, creatures are very forgetful.  In order not to force users to remember a new password when registering with your UWP application, you can use third-party platform accounts.  At the same time, you can, without forcing you to fill in long questionnaires, to gain access to any useful information and user characteristics.  The fact that the publication of content on social networks increases the conversion even I will not mention, it is understandable.  If you want to figure out how to work with the most popular network in the world from the C # / XAML applications of UWP, without smoking manuals, then welcome under cat. <br><a name="habracut"></a><br><h4>  Linking a Facebook app with a UWP app </h4><br>  In order for the UWP application to work with the Facevook API, you need to create a Facebook application.  This is done through the portal <a href="https://developers.facebook.com/apps/">https://developers.facebook.com/apps/</a> by pressing the button "+ Add a new application" <br><br><img src="https://habrastorage.org/files/825/15b/c94/82515bc94bff4b48bf7efdbf9f2f7946.PNG"><br><br>  We fill in the fields of the application name and contact address, and also classify the application by selecting a category. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/e21/0ca/456/e210ca4568a348c2b7d8e21ecb3c51a9.PNG"><br><br>  Next we need the login feature via facebook <br><br><img src="https://habrastorage.org/files/79d/b8f/22e/79db8f22ee754e19901aa774be28be0d.PNG"><br><br>  We build switches in such a way that at a minimum <b>OAuth client authorization, OAuth</b> <b>web authorization,</b> and <b>OAuth authorization built into the browser</b> are enabled <br><br><img src="https://habrastorage.org/files/561/fb1/498/561fb149856b45308eca6f9291c21fd8.PNG"><br><br>  and select the platform by clicking on the <b>platform settings</b> <br><br><img src="https://habrastorage.org/files/99a/dfe/bca/99adfebca2394882bc794967f22f237f.PNG"><br><br>  Get the window: <br><br><img src="https://habrastorage.org/files/515/df1/c4f/515df1c4f51a4ef3bd72ad359b11743b.PNG"><br><br>  in which we select <b>Application for Windows</b> <br><br>  Now you can make some settings, but they are not critical.  But then you will need the application ID facebook. <br><br><img src="https://habrastorage.org/files/7ae/ad6/c5e/7aead6c5e31e4761abf36a14e6561593.PNG"><br><br>  What we really need to fill out is a bit lower: <br><br><img src="https://habrastorage.org/files/387/126/512/3871265124244208b462b46fae332282.PNG"><br><br>  The value of the Windows Store Security Identifier (SID) can be obtained in various ways. <br>  A simpler way is from code using: <br><br><pre><code class="cs hljs">WebAuthenticationBroker.GetCurrentApplicationCallbackUri().ToString();</code> </pre> <br>  This line will return us <b>ms-app: // SID</b> (ms-app: // will need to be removed) <br><br>  The second method requires the application to be associated with the Store.  In this case, you can go to <a href="https://developer.microsoft.com/dashboard/overview">the control panel</a> , then go to App management of the application and select App identity.  Value PackageSID this is what you need. <br><br><img src="https://habrastorage.org/files/3a4/a71/441/3a4a7144191840b78dbc8c0ba9ae203c.PNG"><br><br><h4>  Working with the Facebook API using the Windows SDK for Facebook </h4><br>  We use the library from Microsoft with the difficult to pronounce abbreviated name <a href="https://github.com/Microsoft/winsdkfb">winsdkfb</a> .  The full name is much easier to pronounce - Windows SDK for Facebook.  This is the most convenient way to use the Facebook API from UWP apps.  You can download and install it with <a href="https://www.nuget.org/packages/winsdkfb">NuGet</a> <br><br>  In C #, the XAML page code will add a namespace <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> winsdkfb;</code> </pre><br>  The authentication code is: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] requested_permissions = {<span class="hljs-string"><span class="hljs-string">"public_profile"</span></span>, <span class="hljs-string"><span class="hljs-string">"email"</span></span>, <span class="hljs-string"><span class="hljs-string">"user_friends"</span></span>}; FBSession session = FBSession.ActiveSession; session.WinAppId = WebAuthenticationBroker.GetCurrentApplicationCallbackUri().ToString(); session.FBAppId = <span class="hljs-string"><span class="hljs-string">"229583744102151"</span></span>; FBPermissions permissions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FBPermissions(requested_permissions); FBResult result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> session.LoginAsync(permissions); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.Succeeded) { <span class="hljs-comment"><span class="hljs-comment">//    -   } else { //       facebook }</span></span></code> </pre><br>  The first line sets the permissions that the application will have access to.  In the example, 3 permissions are mentioned, for which facebook does not request additional user confirmations. <br>  The full list is available at the link <a href="https://developers.facebook.com/docs/facebook-login/permissions/">Permissions Help: ‚ÄúLogin via Facebook‚Äù</a> <br>  The two parameters you need to set for the connection are the already mentioned SID and the identifier of the created facebook application. <br><br>  As a result, we get the following built-in window: <br><br><img src="https://habrastorage.org/files/8ea/fcc/93b/8eafcc93bfca49d6ba34dba0f53fad83.PNG"><br><br>  Knowing how to enter, you need to know how to exit.  This can be done using similar code: <br><br><pre> <code class="cs hljs"> FBSession sess = FBSession.ActiveSession; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> sess.LogoutAsync();</code> </pre><br>  Simple user data can be obtained from the session.User object. <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> username = session.User.Name; <span class="hljs-comment"><span class="hljs-comment">//   string locale = session.User.Locale; //  </span></span></code> </pre><br>  What can be done useful?  For example, you can add to your application the ability to post a message with the result / record of the game or an invitation to join <br><br><pre> <code class="cs hljs"> PropertySet parameters = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertySet(); parameters.Add(<span class="hljs-string"><span class="hljs-string">"title"</span></span>, <span class="hljs-string"><span class="hljs-string">" MP3"</span></span>); parameters.Add(<span class="hljs-string"><span class="hljs-string">"link"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://www.microsoft.com/ru-ru/store/p/-mp3/9wzdncrdkwgv"</span></span>); parameters.Add(<span class="hljs-string"><span class="hljs-string">"description"</span></span>, <span class="hljs-string"><span class="hljs-string">"  -    "</span></span>); parameters.Add(<span class="hljs-string"><span class="hljs-string">"message"</span></span>, <span class="hljs-string"><span class="hljs-string">"    "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> path = <span class="hljs-string"><span class="hljs-string">"/"</span></span> + session.User.Id + <span class="hljs-string"><span class="hljs-string">"/feed"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> factory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FBJsonClassFactory(s =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JsonConvert.DeserializeObject&lt;FBReturnObject&gt;(s); }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> singleValue = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FBSingleValue(path, parameters, factory); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fbresult = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> singleValue.PostAsync(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fbresult.Succeeded) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> response = fbresult.Object <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> FBReturnObject; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     }</span></span></code> </pre><br>  This snippet is executed if if (result.Succeeded) returns true (that is, after successful authentication).  It uses the popular JSON parser called NewtonSoft.JSON, which needs to be installed from <a href="https://www.nuget.org/packages/newtonsoft.json/">NuGet</a> . <br><br>  In addition, it is necessary that the following class be present in the project, which characterizes the result of the operation: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FBReturnObject</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Post_Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br>  There is an option to place a message in the ribbon, while displaying a dialog box in which the user can add a comment.  The code is a bit simpler: <br><br><pre> <code class="cs hljs"> PropertySet parameters = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertySet(); parameters.Add(<span class="hljs-string"><span class="hljs-string">"title"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); parameters.Add(<span class="hljs-string"><span class="hljs-string">"link"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://www.microsoft.com/ru-RU/store/p/take-a-test/9wzdncrdkwgx"</span></span>); parameters.Add(<span class="hljs-string"><span class="hljs-string">"description"</span></span>, <span class="hljs-string"><span class="hljs-string">"    "</span></span>); parameters.Add(<span class="hljs-string"><span class="hljs-string">"message"</span></span>, <span class="hljs-string"><span class="hljs-string">"     "</span></span>); FBResult fbresult = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> session.ShowFeedDialogAsync(parameters); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fbresult.Succeeded) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> response = fbresult.Object <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> FBReturnObject; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     }</span></span></code> </pre><br>  Using the following small snippet, a user can send a link to one of his friends and add a message to it: <br><br><pre> <code class="cs hljs"> PropertySet parameters = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertySet(); parameters.Add(<span class="hljs-string"><span class="hljs-string">"link"</span></span>, <span class="hljs-string"><span class="hljs-string">"http://www.habrahabr.ru"</span></span>); FBResult fbresult = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> session.ShowSendDialogAsync(parameters);</code> </pre><br>  Examples of applications using winsdkfb are on <a href="https://github.com/Microsoft/winsdkfb/tree/master/samples">GitHub</a> , but for C # there is only one example so far and that is not very clear. <br><br>  More or less normal documentation is <a href="http://microsoft.github.io/winsdkfb/index.html">under the link</a> <br>  In particular, besides the already considered ways of interacting with fb, the following possibilities are considered: uploading photos / videos, sending invitations to friends (only for games), like some object or link. </div><p>Source: <a href="https://habr.com/ru/post/307026/">https://habr.com/ru/post/307026/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307016/index.html">Fairy Tales Ransomwhere: Cerber on the rise</a></li>
<li><a href="../307018/index.html">Sprute.js. Another isomorphic JavaScript framework</a></li>
<li><a href="../307020/index.html">Squid + Dansguardian + c-icap + ClamAV based on CentOS 7</a></li>
<li><a href="../307022/index.html">Cheburashka and torrents (fairy tale)</a></li>
<li><a href="../307024/index.html">Deep Learning - what to do, whom to beat</a></li>
<li><a href="../307028/index.html">Budget "data center" at Nutanix CE</a></li>
<li><a href="../307032/index.html">Installing any software using WSUS - 2</a></li>
<li><a href="../307034/index.html">Conditional dependency injection in ASP.NET Core. Part 2</a></li>
<li><a href="../307038/index.html">Activity tracking using the phone and MATLAB</a></li>
<li><a href="../307040/index.html">Why OOP is not encapsulation, inheritance and polymorphism, or how I learned not to worry and fell in love with markup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>