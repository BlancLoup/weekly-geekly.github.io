<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>If you can not leave a comment, but really want, you can</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Yes, I faced this problem when I visited the next Landing page, which supposedly sold me a first-class product. But after the courier's visit, you rea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>If you can not leave a comment, but really want, you can</h1><div class="post__text post__text-html js-mediator-article">  Yes, I faced this problem when I visited the next Landing page, which supposedly sold me a first-class product.  But after the courier's visit, you realize that you were bred, and you can‚Äôt give any feedback or warn the others.  At that moment, the thought of an extension for the browser, which would allow to leave comments, notes, reviews or read someone else‚Äôs, directly to the visited site, came to my head. <br><br><img src="https://habrastorage.org/files/94b/eeb/477/94beeb4775164d899c0c20a244f7cd97.gif"><br><br>  The name of all this is <i>CommentAll</i> .  If it is still interesting - I ask under cat.  Even if you are <b>not interested</b> , still look under the cut, it may be too early to draw conclusions, and to leave your angry comment is always welcome. <br><a name="habracut"></a><br><h4>  How it was </h4><br>  I chose just a gift to his wife, stumbled upon a website selling a night projector, projecting a star galaxy on the ceiling.  I was shocked - his presentation on the site bought me.  Returning to the site after twisting in the hands of what the courier brought and finding no resemblance to what is advertised on the site, I saw only static comments and a form that sends my review to nowhere. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It was possible to participate only in a mocking survey, here he is: <br>  ‚Ä¢ We are delighted, now we sleep like in a fairy tale. <br>  ‚Ä¢ Original gift, thank you! <br>  ‚Ä¢ It's great that you work around the clock. <br>  ‚Ä¢ Be sure to buy! <br>  ‚Ä¢ Ordered, satisfied, thank you very much <br><br>  In the end, it hurt all of me, and the goal appeared so easy not to leave it.  The idea of ‚Äã‚Äãthe <i>Commentall</i> extension is to provide an opportunity for Internet users to communicate directly on websites, without going anywhere, to warn other network users about the possible placement of dangerous content, sometimes not accurate or even false information, i.e.  even where the author himself did not provide for the possibility of commenting or found it superfluous. <br><br>  Instead of a thousand words about the principle of the expansion itself, I propose to watch a short minute video: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/cwuN-0sjlHE%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700191,15700253&amp;usg=ALkJrhgTPqMA_7BL-SNB41ev666XiMtmTA" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  Little about the technical side of the project </h4><br>  The extension is written for WebKit browsers, such as <a href="https://chrome.google.com/webstore/detail/commentall/pmckekkahjbhdifpdeoojnommfgnecjp">Google Chrome</a> (+ its derivatives <a href="https://chrome.google.com/webstore/detail/commentall/pmckekkahjbhdifpdeoojnommfgnecjp">Yandeks.Brouser</a> , <a href="https://chrome.google.com/webstore/detail/commentall/pmckekkahjbhdifpdeoojnommfgnecjp">Amigo</a> , etc.), under <a href="https://addons.opera.com/ru/extensions/details/commentall/">Opera a</a> separate release, because Opera has its own extension store, and different from the rest of <a href="https://addons.mozilla.org/ru/firefox/addon/commentall/">Firefox</a> , under all The rest is not yet, under IE, I do not even know whether it is worth it. <br><br>  The main difficulty encountered was that modern browsers do not allow cross-domain queries.  And with regard to extensions, most of the methods found on the network, such as JSONP, CORS, did not work or could not be applied.  The solution came from the extension itself - in WebKit browsers they consist of the ‚Äúmain‚Äù part and the so-called ‚Äúbackground‚Äù.  And it turns out that all requests that pass in the background, the browser skips.  It remains to tie all this together.  It turns out such a chain: <br><br><img src="https://habrastorage.org/files/1bf/b2d/8b9/1bfb2d8b95d9408289804f579cd31197.png"><br><br>  Those.  for all requests, a wrapper was needed as a function that took the request parameters in the background, formed the request itself and at the end called CallBack.  I found the only working <a href="https://gist.github.com/romannurik/192538">solution</a> on the Internet - from romannurik and slightly modified it (for processing POST requests). <br><br><div class="spoiler">  <b class="spoiler_title">part of the - Xhrproxy.js</b> <div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> XHR_PROXY_PORT_NAME_ = <span class="hljs-string"><span class="hljs-string">'XHRProxy_'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupXHRProxy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ chrome.extension.onConnect.addListener(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">port</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (port.name != XHR_PROXY_PORT_NAME_) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; port.onMessage.addListener(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">xhrOptions</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); xhr.open(xhrOptions.method || <span class="hljs-string"><span class="hljs-string">"GET"</span></span>, xhrOptions.url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( xhrOptions.method==<span class="hljs-string"><span class="hljs-string">'POST'</span></span> ) { xhr.setRequestHeader(<span class="hljs-string"><span class="hljs-string">"Content-type"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>); xhr.setRequestHeader(<span class="hljs-string"><span class="hljs-string">"Content-length"</span></span>, xhrOptions.params.length); xhr.setRequestHeader(<span class="hljs-string"><span class="hljs-string">"Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"close"</span></span>); } xhr.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.readyState == <span class="hljs-number"><span class="hljs-number">4</span></span>) { port.postMessage({ <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.status, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseText, <span class="hljs-attr"><span class="hljs-attr">xhr</span></span>: xhr, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: xhrOptions.url, <span class="hljs-attr"><span class="hljs-attr">post_data</span></span>:xhrOptions.params }); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( xhrOptions.method==<span class="hljs-string"><span class="hljs-string">'POST'</span></span> ) { xhr.send(xhrOptions.params); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ xhr.send(); } }); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">proxyXHR</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">xhrOptions</span></span></span><span class="hljs-function">) </span></span>{ xhrOptions = xhrOptions || {}; xhrOptions.onComplete = xhrOptions.onComplete || <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{}; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> port = chrome.extension.connect({<span class="hljs-attr"><span class="hljs-attr">name</span></span>: XHR_PROXY_PORT_NAME_}); port.onMessage.addListener(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">msg</span></span></span><span class="hljs-function">) </span></span>{ xhrOptions.onComplete(msg.status, msg.data, msg.xhr, msg.url, msg.post_data); }); port.postMessage(xhrOptions); } setupXHRProxy();</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">An example of a call from the extension itself:</b> <div class="spoiler_text"><pre> <code class="javascript hljs">proxyXHR({ <span class="hljs-attr"><span class="hljs-attr">method</span></span> : <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">url</span></span> : url, <span class="hljs-attr"><span class="hljs-attr">params</span></span> : post_data, <span class="hljs-attr"><span class="hljs-attr">onComplete</span></span> : CommentAll.loadComment });</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">and in the manifest.json file</b> <div class="spoiler_text"><pre> <code class="javascript hljs"> <span class="hljs-string"><span class="hljs-string">"background"</span></span>: { <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: [<span class="hljs-string"><span class="hljs-string">"includes/xhrproxy.js"</span></span>] }</code> </pre><br></div></div><br>  If anyone has better solutions, I will be glad to hear, adequate criticism is only welcome.  If the topic of developing extensions is interesting, then I will write a sequel. <br><br><h4>  PS </h4><br>  For the convenience of commenting, social authorization for Vkontakte, Facebook and Twitter has been introduced.  But the comment can be left anonymously.  Yes, of course, there is also a slight restriction due to the expansion of a small audience so far - comments and notes will be visible only to those who also have an extension.  In the future, expansion of the expansion functionality is planned (sorry for the tautology), but in fact other possibilities are already open to it. <br><br>  Here are just approximate uses: <br>  ‚Ä¢ When viewing ads (for example, selling a car or an apartment), leaving a note after calling or inspecting the object (or see an existing review) <br>  ‚Ä¢ When working with two or more people on the same content, editing or discussing it on the spot, so as not to get confused. <br>  ‚Ä¢ When it is necessary not to advertise the fact of correspondence, while communicating on non-popular sites. <br>  ‚Ä¢ Use for quests, revelations, and maybe something else. <br>  I just wanted to add that there is no advertising or other monetization in the extension.  I almost forgot to warn, a self-written filter of obscene vocabulary works, transforming the mat into synonyms, and sometimes even antonyms. <br><br>  And <b>only</b> for those who read the article from the very beginning this <b>exceptional</b> survey. </div><p>Source: <a href="https://habr.com/ru/post/252457/">https://habr.com/ru/post/252457/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../252447/index.html">Overview of the video on Go c FOSDEM 2015</a></li>
<li><a href="../252449/index.html">Freemium vs. Free: why we got rid of the free subscription</a></li>
<li><a href="../252451/index.html">Perl 6 command line interaction from MAIN function</a></li>
<li><a href="../252453/index.html">Making the code cleaner: Special vsnprintf () extensions in the Linux kernel</a></li>
<li><a href="../252455/index.html">Go and Protocol Buffers practice (or quick start, for those who are not familiar yet)</a></li>
<li><a href="../252459/index.html">Lectures Technopark. Master class by Vladislav Biryukov "E-education: instructions for use"</a></li>
<li><a href="../252461/index.html">Automate and speed up the process of setting up cloud servers with Ansible. Part 5: local_action, conditions, cycles and roles</a></li>
<li><a href="../252467/index.html">Object class or class objects?</a></li>
<li><a href="../252473/index.html">Adapt BDD for development on 1C together with cucumber and 1Script</a></li>
<li><a href="../252475/index.html">Personal data of users of Rozetka.ua in public access</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>