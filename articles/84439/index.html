<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Python Web Preference</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not for the first decade, there has been a dispute between architects of desktop applications on the subject of which approach, statefull or stateless...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Python Web Preference</h1><div class="post__text post__text-html js-mediator-article">  Not for the first decade, there has been a dispute between architects of desktop applications on the subject of which approach, statefull or stateless, is preferable, and in what cases. <br>  Now we are witnessing a certain trend in the delivery of positions by statefull apologists.  Not least the blame for not even the web, but banal HTTP, which deservedly occupied the niche of the ‚Äúuniversal protocol for everything‚Äù.  Moreover, the possibility of transferring a cookie has very little effect on its stateless nature. <br><br>  But what HTTP can offer us, if necessary, to create an interactive application on the web?  In order to achieve the ‚Äúreactivity‚Äù of an offline statefull application, the classic version with constant polling of the server state with short AJAX timer requests is not enough.  HTML5 brings us WebSockets technology designed to solve this problem.  But you need to work "here and now" on all browsers released in the current millennium. <br><br>  Comet comes to the rescue, with which we have attempted to implement a browser-based Russian preference with an instant reaction to events. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, get acquainted.  Club of intellectual games "Trelyazh" <br>  <a href="http://trellis-club.com/">trellis-club.com</a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f95/fab/17b/f95fab17b1455a5e7bd3b1b79eded80e.jpg" alt="Trellis"><br><a name="habracut"></a><br><br><h2>  Choosing a framework </h2><br>  Two candidates were casting for the role of a low-level asynchronous library for the project. <br>  Twisted and Tornado.  Both have their pros and cons, the totality of which won the Tornado.  It is significantly inferior to its opponent in features, and most unpleasantly, it doesn‚Äôt know how to make asynchronous requests to the database out of the box, but ... sane html-templates, resource managers, built-in authorization tools on openid servers, impressive performance, very convenient and simple interface for the application programmer to move the bowl to the other side. <br><br><h2>  The problem with the number of simultaneously open connections </h2><br>  Looking at the simple and understandable examples from the Tornado delivery, it becomes clear how to write interactive things very quickly, such as the simplest chat.  One would like to immediately make several independent connections listening to different types of events.  But, unfortunately, the reality is that such a scheme does not work.  This is due to old browsers that cannot handle more than two AJAX requests at the same time. <br><br>  In other words, if we want to make something more complicated than a banal chat, we <em>will have to</em> come up with and implement our high-level message delivery protocol that runs on top of JSON. <br><br><h2>  Authorization and Authentication </h2><br>  Novice developers often confuse these two concepts.  But between them there is a fundamental difference.  Roughly speaking, authentication is the procedure for determining whether this user is who he claims to be, and authorization, respectively, is a procedure for granting those or other rights to a user who has already passed the authentication procedure. <br><br>  In the current server version, authorization is eliminated as unnecessary.  All players are equal and not divided into any classes. <br><br>  Authentication is completely at the mercy of the OpenID protocol.  The tornado includes authentication classes via Facebook, Gmail, and other popular services.  There is no problem to add access to the authentication services of the same LiveJournal. <br><br>  In addition to simplifying the login for players (the tedious registration procedure with inventing passwords, and confirmation of email simply becomes unnecessary), this scheme is more secure for players.  The administration will not know any passwords of players, and at the same time, the server is not threatened by the invasion of anonymous vandals. <br><br><h2>  Game cycle </h2><br>  The general scheme is as follows.  An interactive page makes a long AJAX request.  The server for each game table holds a pool of these requests and waits for events.  An event can be anything.  The player clicked on the card, wrote a chat message, a timeout occurred, the bullet count changed, and so on. When an event enters the queue, the server closes the connections of all listeners with the answer to what exactly happened.  The client page accepts the message and decides what to do next.  She can take data from the message and redraw some of her parts, can make a ‚Äúshort‚Äù AJAX request for additional data, can redirect to another page, but in the end she again sends a ‚Äúlong‚Äù AJAX request that is waiting for the next event, and the cycle resumes. <br><br>  It often happens that several events occurred on the server at once, and for performance reasons, our protocol should be able to send events not only one by one, but several at once in one request.  For example, the player made a move, this move was the last, and you need to immediately calculate the game.  In this case, the server will send both events to all table listeners in one iteration. <br><br><h2>  Web site </h2><br>  In addition to directly playing tables, the project needs a website with a home page, rules, blogs, forums, statistics and other things.  It was decided not to separate the gaming room and the website into independent entities, and to integrate the website into the server integrally. <br><br>  Given that with such an organization, the site has access to all operational server caches (including players' caches online), this gives certain performance advantages and simplifies the task of programming the functionality of the site as much as possible. <br><br><h2>  Database </h2><br>  In single-threaded non-blocking servers, it is very important that there are no long-term synchronous operations when generating a response.  Connecting to a database and synchronously waiting for SQL queries to complete is a very time-consuming operation. <br><br>  This is usually bypassed using asynchronous database requests.  Of the popular drivers, this mode of operation is supported, for example, by psycopg2.  You can go ahead and use the services of "adult" ORM like SQL Alchemy, which can add a layer of asynchrony for almost any driver. <br><br>  The alternative is to use a minimum database.  Game processes occur entirely in the memory of the server.  All statistics for viewing is cached wherever possible.  Information about the played game is reset to the database after calculation only once.  Sessions in the generally accepted understanding of web applications in the database are generally not needed with this model of building a server.  The main page of the website does not create a single sql query.  Everything is taken from operational caches. <br><br>  Thus, we keep the simplicity of synchronous programming, reduce the list of dependencies, and DDOS protection is an added bonus.  Requests from non-logged players in principle do not have access to resources capable of generating SQL queries. <br><br><h2>  Total information </h2><br>  In addition to the operational data of each table, the server stores data that should be accessible from any module.  This, for example, a general list of players online, caches of the last viewed games, database pool, and so on.  Data of this kind is collected in one module.  It would seem that here it is.  Finally, the Singleton pattern will find at least some use.  But not everything is so simple.  Firstly, timeouts from the threading system module are actively used inside the server.  This means that all our caches <em>must</em> be thread-safe.  That is, calls that change their contents will have to be wrapped in safe sections.  On the other hand, we need an easy-to-use test mode in which the common data module should work quite differently.  Therefore, Singleton goes where it belongs, and Facade comes to its position. <br><br><h2>  Timeouts </h2><br>  The timeout system is significantly simplified compared to existing native clients.  The player presses the "set the table" button. At the same time, the table immediately goes into the "convention" state.  All players in this room are sent an appropriate message, and they immediately see that the table status has changed.  A covering box with jquery-ui means a dialog box in which it can select game conventions and the timer ticks on top.  The default is 2 minutes.  If the covering party hasn‚Äôt decided what it wants to play for, the window closes and the table returns to ‚Äúfree‚Äù status without any consequences for the player. <br><br>  After the table is created, it goes into endless waiting for players.  Players can come to the table, watch the conventions, sit at the table, get up from the table (in this case the place is vacated).  If the last player rose from the table, then the table is completely vacated, and you can set another game on it. <br><br>  But as soon as the last player sat down at the table (third or fourth, depending on how many people laid the table), the game starts immediately without any warnings.  For any player action a specific time is allotted (its amount determines the table setting. By default, 5 minutes).  If a player moves away or thinks for a very long time, he is penalized and the game closes.  There are no player waiting modes or party transfers in the current version of the server.  Any problems with communication or over time lie entirely on the shoulders of the player, who must be in turn, by all means. <br><br><h2>  Lovers of foul play </h2><br>  The only restriction is: One and the same player cannot sit at the same table twice.  No more restrictions.  If he has time to play at two, and more tables at the same time, then this is his right. <br><br>  The ‚Äúproblem of cash‚Äù, widely known in narrow circles, is not solved by technical means (who needs it, they know about anonymous proxies, and it‚Äôs not a problem to raise several virtual machines).  In this case, deanonymity, auditing, the system of reviews and rating of players is very important.  When you play not with impersonal nicknames, but with real people who have a first and last name (provided by open-id consumer, and it is impossible to change them on the server), everything becomes much easier in this regard. <br><br><h2>  What's next? </h2><br>  At the moment the server is in the status of BETA-testing. <br>  Located at <a href="http://trellis-club.com/">trellis-club.com</a> <br><br>  Pleasant and addictive game. </div><p>Source: <a href="https://habr.com/ru/post/84439/">https://habr.com/ru/post/84439/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../84431/index.html">Habraluchuschenie: highlighting the color comments of the author topic</a></li>
<li><a href="../84433/index.html">New update for Memo "on air"</a></li>
<li><a href="../84434/index.html">Vancouver Olympics Design</a></li>
<li><a href="../84437/index.html">An alternative to Bird's Eye appeared in Google Maps</a></li>
<li><a href="../84438/index.html">Office Package Usage Statistics</a></li>
<li><a href="../84441/index.html">Interface Windows Phone 7: Microsoft beat Apple</a></li>
<li><a href="../84445/index.html">Robots paint graffiti</a></li>
<li><a href="../84446/index.html">New from HTC: Legend, Desire, HD mini. Upd: promo videos</a></li>
<li><a href="../84447/index.html">Polaroid returns</a></li>
<li><a href="../84448/index.html">Night Planetarium - a galaxy on the wall</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>