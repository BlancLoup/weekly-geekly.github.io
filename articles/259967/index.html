<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>gb - dependency management for Go</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The lack of a native dependency and version manager in Go is one of the most frequent points in language criticism. In this article, we will look at t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>gb - dependency management for Go</h1><div class="post__text post__text-html js-mediator-article">  The lack of a native dependency and version manager in Go is one of the most frequent points in language criticism.  In this article, we will look at the problem in more detail and get acquainted with the new project, with the concise name gb, which is gaining popularity in the Go community and promises to soon become the de facto standard for managing dependencies and versions in Go. <br><br><img src="https://habrastorage.org/files/90c/2fd/dc1/90c2fddc123a4df6a145fac5bf93284a.png"><br>  <i>(Credit orig.photo: Nathan Youngman)</i> <br><br>  First, let's see what all the fuss is about and why Go didn‚Äôt initially have an advanced dependency manager. <br><a name="habracut"></a><br><h4>  What is dependency management? </h4><br>  What is meant by the ‚Äúadvanced‚Äù dependency manager and what tasks it should solve.  After all, but in Go, simple dependency management is present. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In Go, there is a standard ‚Äúgo get‚Äù command, which is enough to indicate the name of the project on, say, Github, so that the project code is installed, assembled, and ready for use.  ‚ÄúGo get‚Äù always downloads the latest version, from the master branch, and the general consensus for open-source libraries is not to break backward compatibility at any cost.  This is written in the FAQ, and in the vast majority of cases of third-party libraries, this rule is observed. <br><br>  Depending on your previous experience, you may reject such an idea in the bud, or foresee that this scheme will not be viable very soon, but so far, after 3 years of Go 1 existence, this scheme works and is even used in production in large companies, although initially and more designed for an open-source ecosystem.  I will say this - this is a question of the ratio of complexity and risks that developers are willing to take on. <br><br>  But moving from the open-source world to the world of commercial development, immediately there is a need to ensure that the code of a specific revision will always be compiled and produce the same result, and not depend on external factors.  External factors can be understood as new, breaking compatibility, changes in third-party libraries, and turning off the Internet or the fall of Github. <br><img src="https://habrastorage.org/files/f4a/0f2/ac0/f4a0f2ac097840d1902df355d3faa9d6.png"><br><br>  This problem is solved in two ways, which often go together - <b>versioning</b> dependencies ( <i>versioning</i> ) and <b>vendoring</b> ( <i>vendoring</i> ) - by including a third-party code in your code base.  The first allows you to ensure that new commits to a third-party library do not break your build, and the second is that even when the Internet is down, all the code needed for building will be available for building locally. <br><br>  Actually, this is the answer to the question of what advanced dependency management is - a tool that includes everything needed for versioning and vendoring dependencies. <br><br><h4>  Why is this not in Go? </h4><br>  The short answer is <b>because it's damn hard to make everyone happy</b> .  Not that difficult - this is impossible if you want to make the most convenient tool suitable for all cases that happen in real practice. <br><br>  The authors of Go initially recognized the complexity of the problem, and honestly refused to impose a solution on everyone, suggesting options.  This question is well stated in the <a href="https://golang.org/doc/faq">official FAQ</a> and the answer is as follows: <br><blockquote>  Versioning is a source of considerable complexity, especially in large code bases, and we do not know of such a solution, which, on the scale of the whole variety of possible situations, would work well enough for everyone. </blockquote><br>  Fair enough, agree. <br><br>  Further, the FAQ gives recommendations on how and what to do, and how Google solves this problem in its case (again, emphasizing that ‚Äúwhat is suitable for us may not be suitable for you‚Äù).  And if there is an ‚Äúideal solution‚Äù, then the community has all the cards on hand to create and offer it as standard for Go. <br><br>  As practice has shown, there is no universal solution for everyone.  But the zoo of solutions for different cases and the constant discussion of the issue led to a fairly good consensus on what would put an end to the controversy about advanced dependency management in Go. <br><br><h4>  A brief history of attempts to solve the problem. </h4><br>  The entire zoo of solutions comes down to utilities that solve the issue of either versioning, or vendoring, or both.  The range of solutions is wide - from simple Makefile-c with the replacement of GOPATH and git-self-modules to rewriting of paths in imports and full-fledged all-in-one utilities, the most popular of which is <a href="https://github.com/tools/godep">Godep</a> . <br><br>  But all of them are in essence wrappers over the standard go get and go build commands.  And it was this that was the source of the major inconsistencies.  Workflow when working with go get / build works great, if you write an open-source project, everything is simple and convenient.  But if you write a separate working project that doesn‚Äôt even intersect with your open-source activity at all, then all versioning / vendoring solutions become a thorn in the heel and deprive of certain amenities and add complexity.  Everything becomes more confusing if you try to mix both scenarios. <br><br>  The realization of these two main different development scenarios (open-source vs private closed project) led to the understanding that different scenarios require different solutions.  And not so long ago, <a href="http://dave.cheney.net/">Dave Cheney</a> (one of the Go-contributors and in general, a notable Go-popularizer) proposed to clearly separate these two scenarios, creating a separate tool for the second, which would be similar to the standard go get / build, but originally created for with a project-oriented source tree, with a clear separation between ‚Äúown code‚Äù and ‚Äúdependencies‚Äù. <br><br><h4>  gb - project-based build tool </h4><br><img src="https://habrastorage.org/files/676/b42/d68/676b42d68fa64a8895cbdeecaf8e63e0.png"><br><br>  The main theses underlying gb are: <br><ul><li>  a separate utility replacing the standard go get / build / test </li><li>  everything is determined by the directory structure </li><li>  no special description files </li><li>  no code changes (including import rewrites) </li><li>  clear separation of code into ‚Äúproject‚Äù and ‚Äúdependency‚Äù </li></ul><br>  If you were scared on the phrase ‚Äúreplaces the standard go get / build / test‚Äù, then this is a normal reaction :) In fact, the project for gb can be absolutely easy to use with the standard go build / test, but gb build will allow you not to bother on the way to delivered packages. <br><br>  Now in order. <br><br>  <b>A separate utility replacing the standard go get / build / test</b> <br>  This is exactly the case, and you will have to put one more command in your working system.  This is done simply: <br><pre><code class="bash hljs">go get github.com/constabulary/gb/...</code> </pre> <br>  <b>Everything is determined by the directory structure.</b> <br>  By ‚Äúeverything‚Äù is meant the fact that gb can work with this project.  The rule here is simple - there should be a folder src / in the directory.  And this is enough to start working with gb. <br><br>  Often, when Go is used for only one project, the ‚ÄúGOPATH per project‚Äù approach is recommended - in fact, you are asked to change your GOPATH to the path to this project and work in it.  gb implements something like this, just not touching your system GOPATH.  Slightly more below. <br><br>  <b>No special description files.</b> <br>  Modern projects already consist of a dozen .dot files with various manifests and descriptions.  Another such file needed to build a project would be too, and not in Go-style. <br><br>  <b>No code changes</b> <br>  The project code always remains the way it was written.  There are no <i>import</i> overwrites in the <i>import</i> style of <i>github.com/user/pkg -&gt; import "vendor / github.com / user / pkg"</i> 'is not and will not be. <br><br>  <b>Clear separation of code into ‚Äúproject‚Äù and ‚Äúdependency‚Äù</b> <br>  Returning to the point about the directory structure, gb treats everything that is in <b>src /</b> as the code of your project.  All dependent packages are installed in the <b>vendor /</b> directory and it is from there that the code is taken when building with gb. <br><br><h4>  Usage example </h4><br>  The best way to understand a tool is to use it. <br><img src="https://habrastorage.org/files/159/2be/479/1592be4793764dff850d0be9ebb24fdd.png"><br>  First, create a new project, ~ / demoproject.  The directory does not matter, even in / tmp.  When working with gb, you can forget about your standard GOPATH in general. <br><pre> <code class="bash hljs">mkdir ~/demoproject &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> !$ mkdir -p src/myserver cat &gt; src/myserver/main.go &lt;&lt;END package main import ( <span class="hljs-string"><span class="hljs-string">"github.com/labstack/echo"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> ) func hello(c *echo.Context) error { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> c.String(http.StatusOK, <span class="hljs-string"><span class="hljs-string">"Hello, World!\n"</span></span>) } func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span></span>() { e := echo.New() e.Get(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, hello) e.Run(<span class="hljs-string"><span class="hljs-string">":1323"</span></span>) } END</code> </pre><br><br>  The project tree here looks like this: <br><pre> <code class="bash hljs">$ tree $(<span class="hljs-built_in"><span class="hljs-built_in">pwd</span></span>) /Users/user/demoproject ‚îî‚îÄ‚îÄ src ‚îî‚îÄ‚îÄ myserver ‚îî‚îÄ‚îÄ main.go</code> </pre><br>  Run the build with the command: <br><pre> <code class="bash hljs">$ gb build</code> </pre> <br>  gb build should generate an error stating that the dependency ( <i>github.com/labstack/echo</i> ) was not found: <br><pre> <code class="bash hljs">FATAL <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> <span class="hljs-string"><span class="hljs-string">"build"</span></span> failed: failed to resolve import path <span class="hljs-string"><span class="hljs-string">"myserver"</span></span>: cannot find package <span class="hljs-string"><span class="hljs-string">"github.com/labstack/echo"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> any of: /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/go/src/github.com/labstack/<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> (from <span class="hljs-variable"><span class="hljs-variable">$GOROOT</span></span>) /Users/user/demoproject/src/github.com/labstack/<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> (from <span class="hljs-variable"><span class="hljs-variable">$GOPATH</span></span>) /Users/user/demoproject/vendor/src/github.com/labstack/<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span></code> </pre><br>  If you look closely, you can see that gb is looking for a dependent package first in GOROOT (as the stdlib packages are there), then in GOPATH, which is defined for this project (demoproject / src), and, lastly, in demoproject / vendor .  Since the package is nowhere to be found, we get an error.  You can pull the package with your hands in the vendor (and do not forget to delete the folder. Git), but gb has a functional for this: <b>gb vendor</b> . <br><pre> <code class="bash hljs">$ gb vendor fetch github.com/labstack/<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Cloning into <span class="hljs-string"><span class="hljs-string">'/var/folders/qp/6bvmky410dn8p1yhn3b19yxr0000gn/T/gb-vendor-097548747'</span></span>... remote: Counting objects: 1531, <span class="hljs-keyword"><span class="hljs-keyword">done</span></span>. remote: Compressing objects: 100% (45/45), <span class="hljs-keyword"><span class="hljs-keyword">done</span></span>. remote: Total 1531 (delta 12), reused 0 (delta 0), pack-reused 1482 Receiving objects: 100% (1531/1531), 317.40 KiB | 191.00 KiB/s, <span class="hljs-keyword"><span class="hljs-keyword">done</span></span>. Resolving deltas: 100% (911/911), <span class="hljs-keyword"><span class="hljs-keyword">done</span></span>. Checking connectivity... <span class="hljs-keyword"><span class="hljs-keyword">done</span></span>.</code> </pre> <br>  Check the project directory structure: <br><pre> <code class="bash hljs">$ tree -L 6 $(<span class="hljs-built_in"><span class="hljs-built_in">pwd</span></span>) /Users/user/demoproject ‚îú‚îÄ‚îÄ src ‚îÇ  ‚îî‚îÄ‚îÄ myserver ‚îÇ  ‚îî‚îÄ‚îÄ main.go ‚îî‚îÄ‚îÄ vendor ‚îú‚îÄ‚îÄ manifest ‚îî‚îÄ‚îÄ src ‚îî‚îÄ‚îÄ github.com ‚îî‚îÄ‚îÄ labstack ‚îî‚îÄ‚îÄ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> ‚îú‚îÄ‚îÄ LICENSE ‚îú‚îÄ‚îÄ README.md ‚îú‚îÄ‚îÄ context.go ‚îú‚îÄ‚îÄ context_test.go ‚îú‚îÄ‚îÄ echo.go ‚îú‚îÄ‚îÄ echo_test.go ‚îú‚îÄ‚îÄ examples ‚îú‚îÄ‚îÄ group.go ‚îú‚îÄ‚îÄ group_test.go ‚îú‚îÄ‚îÄ middleware ‚îú‚îÄ‚îÄ response.go ‚îú‚îÄ‚îÄ response_test.go ‚îú‚îÄ‚îÄ router.go ‚îú‚îÄ‚îÄ router_test.go ‚îî‚îÄ‚îÄ website 10 directories, 14 files</code> </pre><br>  The manifest file contains all the information about the versions of dependencies: <br>  $ cat vendor / manifest <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"version"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"dependencies"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"importpath"</span></span>: <span class="hljs-string"><span class="hljs-string">"github.com/labstack/echo"</span></span>, <span class="hljs-string"><span class="hljs-string">"repository"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://github.com/labstack/echo"</span></span>, <span class="hljs-string"><span class="hljs-string">"revision"</span></span>: <span class="hljs-string"><span class="hljs-string">"1ac5425ec48d1301d35a5b9a520326d8fca7e036"</span></span>, <span class="hljs-string"><span class="hljs-string">"branch"</span></span>: <span class="hljs-string"><span class="hljs-string">"master"</span></span> } ] }</code> </pre><br>  Repeat gb vendor fetch for the remaining dependencies and now try to collect the code: <br><pre> <code class="bash hljs">$ gb build github.com/bradfitz/http2/hpack github.com/labstack/gommon/color github.com/mattn/go-colorable golang.org/x/net/websocket github.com/bradfitz/http2 github.com/labstack/<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> myserver $ tree bin/ bin/ ‚îî‚îÄ‚îÄ myserver 0 directories, 1 file</code> </pre> <br><br>  The binary is placed, as in the usual scenario of working in one GOPATH in the bin / directory. <br><br>  Now the whole directory can be safely entered into the version control system, and here you, as the project owner, decide - you want to leave only versioning, or vendor dependencies too, or manage everything, and manage the versions manually.  In your hands the freedom of choice. <br><ul><li>  only versioning: add vendor / src to .gitignore </li><li>  vendoring only: add vendor / manifest to .gitignore </li><li>  and versioning and vendoring: leave .gitignore unchanged </li></ul><br>  In the case of versioning-only, any developer from your team, after having cloned the repository on his machine, should run: <br><pre> <code class="bash hljs">$ gb vendor update -all</code> </pre> <br>  to get a 1-in-1 dependency tree for building a project. <br><br>  In general, this description should be enough to understand the principles of gb and the approach to solving the issue of versioning and vending. <br><br><h4>  Afterword </h4><br>  The gb project is still in an early stage of development and acceptance by the community, but judging by the reaction of the latter and the stormy support, this is a very good decision. <br>  The project has a lot of open issues in the tracker, but they quickly close and the project is actively developing. <br><br>  For not yet great personal experience of use - there are still difficulties with cross-platform build.  The rest is still normal flight. <br><br><h4>  Links </h4><br>  Official website: <a href="http://getgb.io/">getgb.io</a> <br>  Github repository: <a href="https://github.com/constabulary/gb">github.com/constabulary/gb</a> <br>  Blog post from the author: <a href="http://dave.cheney.net/2015/06/09/gb-a-project-based-build-tool-for-the-go-programming-language">dave.cheney.net/2015/06/09/gb-a-project-based-build-tool-for-the-go-programming-language</a> <br>  Design rationale: <a href="http://getgb.io/rationale/">getgb.io/rationale</a> <br>  Theory of operation: <a href="http://getgb.io/theory/">getgb.io/theory</a> </div><p>Source: <a href="https://habr.com/ru/post/259967/">https://habr.com/ru/post/259967/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259947/index.html">Oberon is dead, long live Oberon! Work environment ETH Oberon</a></li>
<li><a href="../259951/index.html">WWDC15. The first day. Keynote</a></li>
<li><a href="../259953/index.html">Connect any site to PushAll via RSS. Converter feeds to push notifications</a></li>
<li><a href="../259955/index.html">Laravel 5.1</a></li>
<li><a href="../259961/index.html">Survey on search resources</a></li>
<li><a href="../259971/index.html">Microsoft TechDay 2015 Live Broadcast</a></li>
<li><a href="../259973/index.html">FlyElephant invites to the VI conference of experts in the field of web and mobile technologies WebCamp 2015</a></li>
<li><a href="../259975/index.html">WWDC15. Second day. Details</a></li>
<li><a href="../259981/index.html">My approach to setting up the economy of the game: spreadsheets</a></li>
<li><a href="../259983/index.html">Google Developers Launchpad - everything you need for a successful launch</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>