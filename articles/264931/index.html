<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Low Cost 10GbE Cluster Infrastructure</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At HOSTKEY, we are regularly faced with the need to organize VLANs at a speed of 10 Gbit for virtualization clusters - our own and client ones. This t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Low Cost 10GbE Cluster Infrastructure</h1><div class="post__text post__text-html js-mediator-article">  At <a href="http://www.hostkey.ru/">HOSTKEY, we are</a> regularly faced with the need to organize VLANs at a speed of 10 Gbit for virtualization clusters - our own and client ones.  This technology is necessary for interfacing with storage systems, for backing up, for accessing a database and for providing live migration of virtual machines.  The question always arises - how to do it reliably and at minimal cost? <br><img src="https://habrastorage.org/files/e6c/176/f8e/e6c176f8e03e437f9940603838098803.jpg" align="right" width="40%"><br>  Until recently, the minimum costs for such a solution were substantial.  The smallest 10GbE switch was 24 ports, and the simplest card was the Intel X520 for $ 500.  The budget for the port was about 700-1000 dollars, and the entrance ticket was very high. <br><br>  Progress does not stand still, at the beginning of 2015 a new class of 10GbE devices appeared for reasonable money from a warehouse in Moscow and under warranty. <br>  Since we regularly build dedicated servers and private clouds on their base at HOSTKEY, we want to share our experience. <br><br>  So, our Client has 5 machines in a cluster and he needs 10GbE VLAN - there are 2 filers, one backup machine and several nodes.  On gigabit, everything is slow and I don't want to put gigabit four ports in the timing in the machines.  It should be 10GbE and the budget is limited.  Sounds familiar, doesn't it? <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Choosing 10GbE controllers </h4><br>  We select network cards for servers - to make new ones, from stock and warranty.  There are three options, and they are all on PCIe x8: <br><img width="300" align="right" src="https://habrastorage.org/files/b70/acd/6a8/b70acd6a84a344969004e3265d0a15f6.jpg"><br>  1) Old proven <a href="http://ark.intel.com/ru/products/39776/Intel-Ethernet-Converged-Network-Adapter-X520-DA2"><b>Intel X520-DA2</b></a> . <br>  2 SFP + ports, 5 years on the market.  The price is about <a href="http://www.regard.ru/catalog/tovar98767.htm">30,000 rubles</a> (~ $ 450).  Please note that you need to take the modules for 15,000 rubles each or order them at NAG indicating that they should be requested for this model - otherwise it will not see them.  The same applies to DAC (copper cables with direct connection to SFP + interfaces - maybe someone doesn‚Äôt know), we also thought that everyone was suitable and had to go to the second round. <br><br>  2) Newbie <a href="https://www.asus.com/Commericial-Servers-Workstations/PEB10G578111S/"><b>Asus PEB-10G / 57811-1S</b></a> <img width="300" align="right" src="https://habrastorage.org/files/e6c/176/f8e/e6c176f8e03e437f9940603838098803.jpg"><br>  1 or 2 SFP + ports on the BCM 57811S chipset. <br>  For the first time we noticed them on sale in the spring.  Issue price of <a href="http://www.regard.ru/catalog/tovar170688.htm">10,000</a> rubles apiece with one port and <a href="http://www.regard.ru/catalog/tovar170887.htm">16,000</a> for a 2-port PEB-10G / 57840-2S.  Any modules, the controller does not matter.  The scarf is surprisingly small, slightly larger than the palm.  Please note - there are no drivers for VmWare in the box (we will try to solve this problem in one of the following posts). <br><br><img width="300" align="right" src="https://habrastorage.org/files/3ef/e87/cdd/3efe87cdd46b4c339f5f15b406ca4142.jpg"><br>  3) New <a href="http://www.qlogic.com/Products/adapters/Pages/IntelligentEthernetAdapters.aspx"><b>Qlogic QLE3440-CU-CK</b></a> <br>  One or two ports on SFP + under DAC, as we were looking for. <br>  One-port version was able to buy for <a href="http://www.xcom-shop.ru/qlogic_qle3440-cu-ck_450151.html">16 000</a> rubles.  On Amazon, the price for the QLE3440-CU-CK is 250 bucks, i.e.  This is not a stock at the old price - nove.  All drivers are in place, including ESXI.  Card slightly larger.  DAC / SFP + modules do not need special sewing - it is omnivorous. <br><br><h4>  <b>Choosing a 10GbE Switch</b> </h4><br>  Now we need to choose a switch, we need something for 8-12 ports with management at the L2 level without any special bells and whistles.  Nexus and Extreme are not considered, not the same size.  Again, we are looking for something new and from stock.  Old Melanoks with Ebay, Tsiski on xenpack is not considered, although many do. <br>  The choice is even more modest: <br><img src="https://habrastorage.org/files/505/426/b66/505426b661084618bd2e726ff0565c69.png" width="400" align="right"><br>  1) <a href="http://www.netgear.ru/business/products/switches/10-gigabit/XS708E.aspx">Netgear XS708E</a> for 8 copper ports, the price is <a href="http://www.regard.ru/catalog/tovar129715.htm">72,000</a> rubles in Regard and other places.  L2 is, everything is controlled.  We do not have copper ports on the maps, in this case we will have to take something else. <br><br><img src="https://habrastorage.org/files/e5a/0d1/597/e5a0d1597c6c46b0b93f8274ae277945.png" align="right" width="400"><br>  2) <a href="http://www.netgear.ru/business/products/switches/10-gigabit/XS712T.aspx">Netgear XS712T-100NES</a> for 12 copper ports, the price is <a href="http://www.regard.ru/catalog/tovar133762.htm">142,000</a> rubles in Regard. <br><br>  3) <a href="http://shop.nag.ru/catalog/00001.Kommutatory/04963.SNR/15959.SNR-S2970-12X">SNR-S2970-12X</a> - 12 port switch from NAG. <img src="https://habrastorage.org/files/a28/52f/99e/a2852f99ed8147959ed52fa3ce41dd0c.jpg" align="right" width="400"><br>  It has 12 SFP + ports, 8 simply gigabit ports and full control in L2.  The price is about 100,000 rubles, i.e.  8333 rubles for 10G port and another 8 gigabit for free - we will also collect the management VLAN on it.  We read the forum and the <a href="http://forum.nag.ru/forum/index.php%3Fshowtopic%3D102778">branch with the discussion of the</a> device - for us this is good for the cluster, but it definitely will not work for the reference switch of the data center level. <br><br>  We like DAC more, they have a delay of 0.3 ¬µs versus 2-3 ¬µs for 10GBase-T.  At the level of network aggregation of data centers, this is not so important, and nothing is more important for connecting filers than a small delay. <br>  We ask colleagues about operating experience and order in NAG.ru, after a few days the switch is already on the table in Moscow.  The switch interface is simple, there is a web interface, an IOS-shaped CLI and everything is managed via SNMP.  We do not need anything more complicated than cutting VLANs and putting in monitoring in CACTI, although it has much more functions.  It can shape, it can make trunks, it can clamp MAC on ports, it can do port mirror on 1 / 10G, tint QOS traffic and everything else that stuck L2 switch in 2015. <br><br><h5>  <b>SNR-S2970-12X web interface snapshots:</b> </h5><br>  First screen: <br><img width="70%" src="https://habrastorage.org/files/8ca/fb3/d0d/8cafb3d0d78346a68623870e05564626.png"><br><br>  Port Management: <br><img width="70%" src="https://habrastorage.org/files/4c7/6d5/d01/4c76d5d010eb462694153c4742237db0.png"><br><br>  MAC addresses: <br><img width="70%" src="https://habrastorage.org/files/ac0/f23/96e/ac0f2396e06943bda1308f14d3493732.png"><br><br>  Port Configuration: <br><img width="70%" src="https://habrastorage.org/files/663/73d/ae9/66373dae9d3e46d3959c3a26b2867295.png"><br><br>  Configuring shaping and pps limits: <br><img width="70%" src="https://habrastorage.org/files/de7/879/f3e/de7879f3e70e4b54adfbbf2ce5e2ee79.png"><br><br>  Port mirroring control: <br><img width="70%" src="https://habrastorage.org/files/924/de3/7c9/924de37c9ed542548a63d4bdaa06b732.png"><br><br>  VLAN and trunk management: <br><img width="70%" src="https://habrastorage.org/files/f4b/0fd/422/f4b0fd42208f49e0b9c774c0afc6989a.png"><br><br><h4>  Testing </h4><br><br>  We are assembling a stand of two servers and a switch ‚Äî two cars on s1366, a super micra and an intel.  We put the cards, put them on the SSD servers of Windows Server 2012 (as the client needs) and connect all this DAC to each other.  For reference (as they love here) DAC cable for 2 meters costs about <a href="http://shop.nag.ru/catalog/01889.SFP-GBIC-XFP-SFP-X2-XENPAK-QSFP-CFP-moduli/01891.Moduli-SFP/08635.SNR-SFPDA-2">2000</a> rubles. <br><br><img src="https://habrastorage.org/files/c06/b65/049/c06b65049557405884b25f4ce1080926.jpg" height="200"><img src="https://habrastorage.org/files/e51/7ba/e35/e517bae358dc4713a005a47ad91d89cf.jpg" height="200"><br><br>  Drivers get up without problems, everything starts up almost immediately.  No mistakes, everything works out of the box.  Qlogic can make virtual adapters of itself, it‚Äôs convenient for interface virtualization in a cluster ‚Äî for example, one for heartbeat, one for iscsi, one for live migration, one for the Internet, and one for managing all of this.  With Qlogic, everything can be parsed at the level of virtual adapters. <br><br><h5>  Iperf </h5><br>  <a href="https://iperf.fr/">IPERF</a> in all modes shows 8.5 Gbit for Asus and about 8 Gbit for Qlogic.  We tried in a different number of threads, turned off offload, twisted the size of the jumbo-frame - the difference is within the statistical error. <br>  <b>ASUS:</b> <br><img width="70%" src="https://habrastorage.org/files/527/2a5/ba8/5272a5ba801f4998885fdf59b005e5ae.png"><br><br>  <b>Qlogic:</b> <br><img width="70%" src="https://habrastorage.org/files/aca/bf3/f2a/acabf3f2a004482ba32abe2a2888ba58.png"><br><br>  Turning servers straight into each other - the same numbers, the switch does not introduce a delay.  It‚Äôs as simple as that - just swap the cable from the switch to the server and everything turns on. <br><br><h5>  <b>10G controllers and PCIe bus width</b> </h5><br>  Please note - we initially noticed that Asus does not accelerate above 6 Gigabits.  It turned out that in Intel's mother one of the eighth-size slots is actually four lanes.  Rearranged in PCIe with eight lanes - it became immediately 8.5 Gbit.  At such speeds, this is already important, rests on any narrow neck. <br><img src="https://habrastorage.org/files/1f9/2e8/fe1/1f92e8fe1ebb4e09966fad7d4b333712.png" width="70%"><br><br><img src="https://habrastorage.org/files/41c/f2c/9eb/41cf2c9eb99e4851a098a398bb2f1211.png" align="right"><h5>  SMB file transfer </h5><br>  We test the work of the usual SMB-balls in Windows - without any special problems, the post is not about that.  First, we get a speed of about 300MB of transfer - SSD via SATA2 no longer pulls.  There is no SATA3 on the mother, so we install the <a href="https://www.softperfect.com/products/ramdisk/">RAM Disk</a> and upload everything there.  We distribute Tom over the network and the picture changes immediately - 609MB per second.  4.7 GB installation image is copied in less than 8 seconds.  Judging by the fact that there is a flat shelf on the chart, we are somewhere in the constraint, and this is not a network.  We will not understand anymore, 600MB per second is more than enough - a typical 10GB virtual machine can now be migrated in 16 seconds from the node to the node. <br><br><h4>  findings </h4><br><br>  What happens is that everything works, quickly and simply.  The transfer rate in this solution is about 8.5 Gbit / s - for most tasks it is more than enough.  To create a 10G network infrastructure for a cluster of 10 cars, you need only 200,000 rubles or $ 3,000, the amount is more than lifting.  If to complete with dual-port boards and two switches for a reserve, the issue price is 360,000 rubles, or about 5,500 dollars. <br><br>  We at <a href="http://www.hostkey.ru/">HOSTKEY</a> specialize in renting for customers of large custom dedicated servers and clusters based on them.  10GbE port for organizing a VLAN on a dedicated server will cost only 2100 rubles per month.  If switching on 10G Ethernet is done without a switch, for example, two servers look into one file with a two-port card - this will add only 1,200‚Äì1,600 rubles per server per month.  Please note that it is difficult to simultaneously put a 10G controller and a hardware RAID controller in a single-processor 1U server.  In dual-processor machines, there is usually a WIO option when putting two cards on top of each other through a riser or one board is placed in front, as in HP DL160 or Dellach. <br><br><h4>  <b>About HOSTKEY</b> </h4><br> <a href="http://www.hostkey.ru/"><img src="https://habrastorage.org/files/aed/bfd/f5f/aedbfdf5fa0e4a9cbdc55fd15a8bd089.png" align="right"></a>  HOSTKEY leases dedicated servers for rent in Moscow and the Netherlands since 2008.  The total fleet of own servers now amounts to 1,300 physical machines on 5 sites.  We work in TierIII-certified Moscow data center <a href="http://datapro.ru/aviamotornaya">Datapro</a> Aviamotornaya, Datalayn <a href="http://www.dtln.ru/tsod-nord/gallery">Nord</a> and on several simpler sites.  In the Netherlands, racks are rented at <a href="http://serverius.nl/">Serverius.nl</a> , the servers there are all our own - no one is selling out.  In these data centers we <a href="http://www.hostkey.ru/collocation/">place</a> our clients <a href="http://www.hostkey.ru/collocation/">on the</a> server colos and provide dedicated servers with all the network infrastructure.  Prices are reasonable, we do everything to reduce our costs and offer customers economically viable conditions in this difficult time.  If you need something special - contact us, we will always help. <br><br>  <b>Promo code for 10% discount until the end of August 2015 for readers - HABR170815</b> </div><p>Source: <a href="https://habr.com/ru/post/264931/">https://habr.com/ru/post/264931/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264919/index.html">Java bytecode "Hello world"</a></li>
<li><a href="../264921/index.html">What problems do we face when introducing and operating Microsoft Exchange and how to solve them effectively?</a></li>
<li><a href="../264923/index.html">Joint editing. Part 1</a></li>
<li><a href="../264927/index.html">Automate MS SQL backup configuration using .NET application</a></li>
<li><a href="../264929/index.html">What can SED outside the office: the automation of the treasury</a></li>
<li><a href="../264933/index.html">UX-strategy in practice. Part 3 - Platform Thinking</a></li>
<li><a href="../264935/index.html">Last 2 days of sales of Early Bird MBLTdev conference tickets</a></li>
<li><a href="../264937/index.html">Improving communication between the client and the UX: how to avoid a damaged phone</a></li>
<li><a href="../264941/index.html">Objectives of the entrance exam at ShAD 2014</a></li>
<li><a href="../264943/index.html">Introducing Hub 1.0 - a connector for command products JetBrains</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>