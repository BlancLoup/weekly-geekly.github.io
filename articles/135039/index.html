<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Highstock based dynamic graphics</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. I represent one of the leading dance online radio stations in Russia - FreshBeat Radio . 

 We, like Internet radio, have one huge advantage ov...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Highstock based dynamic graphics</h1><div class="post__text post__text-html js-mediator-article">  Hello.  I represent one of the leading dance online radio stations in Russia - <a href="http://freshbeat.ru/">FreshBeat Radio</a> . <br><br>  We, like Internet radio, have one huge advantage over FM broadcasting.  We do not need to conduct expensive market research to find out the number of listeners, their location, duration and frequency of listening. <br><br>  We constantly have access to a huge amount of statistical data that can and should be used in order to further match our target audience.  Before analyzing the data by listeners, they need to be collected and systematized so that it is convenient to work with them. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this article, I will tell you how to visualize it and periodically update it with the help of Highstock.  On Habrahabr, there have already been several articles about this set of tools, but they all described working only with static data. <a name="habracut"></a><br><br><h4>  Data collection </h4><br>  In our case, all the necessary information is processed by the php script, which parses the standard icecast page with all the necessary data and forms an array of values ‚Äã‚Äã(for each of the audio streams, you need to get a number of listeners). <br><br>  Because  we are only interested in the value on the Y axis, we have chosen the simplest simple format that Highstock accepts.  For dynamic graphics, it is meaningless to transmit the value of X, since  we use the current time as the value for the new point. <br>  At the output of the php script, we get the data in JSON format: <br><pre><code class="php hljs">[<span class="hljs-number"><span class="hljs-number">214</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">13</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">35</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">65</span></span>,<span class="hljs-number"><span class="hljs-number">97</span></span>]</code> </pre> <br><br><h4>  Data retrieval </h4><br>  Immediately after loading the page you need to get data and set up a schedule.  We send ajax request, in the callback function we create a series of points (graphics) for each stream.  Each of them is filled with the first point, and we hide all graphs, except for the total (the sum of all streams).  As the value of X, we set the current time in the Unix timestamp format. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> seriesOptions=[], data=[], chart; $(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $.getJSON(<span class="hljs-string"><span class="hljs-string">'protected/live_values.php'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">lst</span></span></span><span class="hljs-function">) </span></span>{ time = (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).getTime()+<span class="hljs-number"><span class="hljs-number">14400000</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  (utc+4) //  data.push({x:time, y:lst[0]}); seriesOptions[0] = { name: '/all', data: data }; data=[]; //  ,   for (i=1; i&lt;9; i++) { data.push({x:time, y:lst[i]}); seriesOptions[i] = { name: 'series '+i, data: data, visible: false }; data=[]; }; createChart(); }); });</span></span></code> </pre> <br><br><h4>  Plotting </h4><br>  After that we create and customize graphs based on the data obtained.  Basically, these settings hide extra items.  I will show only the main ones: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createChart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ chart = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Highcharts.StockChart({ <span class="hljs-attr"><span class="hljs-attr">series</span></span>: seriesOptions, <span class="hljs-comment"><span class="hljs-comment">//   title: {text: 'Live Statistics Viewer v0.8'}, //     30  xAxis: {maxZoom: 30000}, //   plotOptions: {line: {step: true}},</span></span></code> </pre><br>  We form a hint view when hovering over a point on the graph.  Hide everything except the time and number of listeners.  We slightly increase the text. <br><pre> <code class="javascript hljs">tooltip: { <span class="hljs-attr"><span class="hljs-attr">yDecimals</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">xDateFormat</span></span>: <span class="hljs-string"><span class="hljs-string">'%H:%M:%S'</span></span>, <span class="hljs-attr"><span class="hljs-attr">headerFormat</span></span>: <span class="hljs-string"><span class="hljs-string">'&lt;span style="font-size: 12px"&gt;{point.key}&lt;/span&gt;'</span></span>, <span class="hljs-attr"><span class="hljs-attr">pointFormat</span></span>: <span class="hljs-string"><span class="hljs-string">'&lt;span style="color:{series.color}"&gt;{series.name}&lt;/span&gt;: &lt;b&gt;{point.y}&lt;/b&gt;'</span></span> },</code> </pre> <br>  Also format the zoom graph selector.  Years and months are not needed, we leave only 3 periods, the maximum is 15 minutes. <br><pre> <code class="javascript hljs">rangeSelector: { <span class="hljs-attr"><span class="hljs-attr">buttons</span></span>: [ {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'minute'</span></span>, <span class="hljs-attr"><span class="hljs-attr">count</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">'1m'</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'minute'</span></span>, <span class="hljs-attr"><span class="hljs-attr">count</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">'5m'</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'minute'</span></span>, <span class="hljs-attr"><span class="hljs-attr">count</span></span>: <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">'15m'</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'all'</span></span>, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">'All'</span></span>} ], <span class="hljs-attr"><span class="hljs-attr">selected</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> },</code> </pre> <br>  To switch charts necessarily need a legend.  In the settings indicate the position, orientation and indents between the elements. <br><pre> <code class="javascript hljs">legend: { <span class="hljs-attr"><span class="hljs-attr">enabled</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">layout</span></span>: <span class="hljs-string"><span class="hljs-string">'vertical'</span></span>, <span class="hljs-attr"><span class="hljs-attr">align</span></span>: <span class="hljs-string"><span class="hljs-string">'right'</span></span>, <span class="hljs-attr"><span class="hljs-attr">verticalAlign</span></span>: <span class="hljs-string"><span class="hljs-string">'top'</span></span>, <span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-number"><span class="hljs-number">-10</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-attr"><span class="hljs-attr">itemStyle</span></span>: {<span class="hljs-attr"><span class="hljs-attr">padding</span></span>: <span class="hljs-string"><span class="hljs-string">'10px'</span></span>} },</code> </pre> <br>  In Highstock there is the possibility of exporting to a picture or printing graphs.  We leave only the printing and export in png: <br><pre> <code class="javascript hljs">exporting: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'image/png'</span></span>, <span class="hljs-attr"><span class="hljs-attr">buttons</span></span>: { <span class="hljs-attr"><span class="hljs-attr">exportButton</span></span>: { <span class="hljs-attr"><span class="hljs-attr">menuItems</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">onclick</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.exportChart(); } } } }</code> </pre> <br><br><h4>  Dynamic point addition </h4><br>  Finally, the most important thing.  Specify the function that will add points, and set its call interval in milliseconds.  The graphics are updated very quickly, even though every 50 ms.  Immediately specify the name of the div, in which the graphics will be displayed. <br><br><pre> <code class="javascript hljs">chart: { <span class="hljs-attr"><span class="hljs-attr">renderTo</span></span>: <span class="hljs-string"><span class="hljs-string">'containerlive'</span></span>, <span class="hljs-attr"><span class="hljs-attr">zoomType</span></span>: <span class="hljs-string"><span class="hljs-string">'x'</span></span>, <span class="hljs-attr"><span class="hljs-attr">events</span></span>: { <span class="hljs-attr"><span class="hljs-attr">load</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ setInterval(load, <span class="hljs-number"><span class="hljs-number">50</span></span>); } } } }); };</code> </pre> <br>  This function sends the same ajax request as in the initialization of the graphs.  The parameters for the addPoint method are the current time and the number of listeners for each stream.  If it is necessary to shift the graph after reaching a certain number of points, then change the last value in the addPoint method to true. <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $.getJSON(<span class="hljs-string"><span class="hljs-string">'protected/live_values.php'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">lst</span></span></span><span class="hljs-function">) </span></span>{ x = (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).getTime()+<span class="hljs-number"><span class="hljs-number">14400000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;<span class="hljs-number"><span class="hljs-number">9</span></span>; i++) chart.series[i].addPoint([x, lst[i]], <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }); };</code> </pre> <br><br><h4>  That's all </h4><br>  To display the graphics on the html page, we connect our js script, jquery, highstock itself and the export module to it.  Well, create a div with id equal to the one that was specified when setting up the schedule. <br><br><h4>  Result </h4><br>  The schedule was updated in about an hour: <br><img src="http://habrastorage.org/storage2/f20/c41/72e/f20c4172eb58f378b85e27d50696a5db.png"><br>  Several charts: <br><img src="http://habrastorage.org/storage2/655/8f1/104/6558f110466448cca9ae44cfe37155b6.png"><br><br>  <a href="http://www.highcharts.com/products/highstock">Highstock is a</a> very powerful thing, but rather capricious.  For example, the latest version 1.1.0 does not work correctly in chrome, even on the official site.  Therefore, in my project, I still use version 1.0.2.  Also, regardless of the version, there may be problems with the transfer of a large array of objects, the graphics may simply not be built. </div><p>Source: <a href="https://habr.com/ru/post/135039/">https://habr.com/ru/post/135039/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135032/index.html">DeSopa: Firefox extension to bypass SOPA</a></li>
<li><a href="../135033/index.html">Hyperburg - a three-dimensional version of the game "Carcassonne"</a></li>
<li><a href="../135035/index.html">Playing SDL is doubly easy</a></li>
<li><a href="../135036/index.html">We get access to the methods of Api Vkontakte without the user's knowledge</a></li>
<li><a href="../135037/index.html">Successful Kanban in a small team</a></li>
<li><a href="../135040/index.html">By DDoS-attack - ready!</a></li>
<li><a href="../135041/index.html">How love of music helped find vulnerabilities in Flash</a></li>
<li><a href="../135042/index.html">Redis, hiredis, libev and multithread. Part 2</a></li>
<li><a href="../135043/index.html">Android + Arduino + 4 wheels</a></li>
<li><a href="../135044/index.html">D programming language</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>