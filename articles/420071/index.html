<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Different prices for warehouses in multistore. Revision 1C-Bitrix</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Were online store and b2b platform from one company on the system 1c-Bitrix. The company grew and appeared its own warehouses and added warehouses of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Different prices for warehouses in multistore. Revision 1C-Bitrix</h1><div class="post__text post__text-html js-mediator-article">  Were online store and b2b platform from one company on the system 1c-Bitrix.  The company grew and appeared its own warehouses and added warehouses of partners that needed to be displayed.  There was a need to display balances in several warehouses. <br><br>  And what Bitrix says to us: Please go to the Business editorial board and everything will be fine and immediately.  They went to the editorial office and it turned out that multi-value and multi-warehouse in 1C-Bitrix live a separate life.  The first is needed to display different prices for different groups of users, and the second to display balances in different warehouses. <br><br>  We needed to withdraw the balances with its price for each warehouse, since the price of the partners and ours may differ by the same position.  It turned out that there was no staff of such a functional. <br><a name="habracut"></a><br>  It was here that the idea to remake the standard templates came up and on the site side to make a warehouse-price bundle. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The first thing I had to do was remake the catalog.section and catalog.element templates.  They included the catalog.store.amount component: <br><br>  1. For a product card, a list of warehouses with prices was displayed. <br><br><div class="spoiler">  <b class="spoiler_title">Code snippet</b> <div class="spoiler_text"><pre><code class="hljs ruby"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($arResult[<span class="hljs-string"><span class="hljs-string">'CATALOG_QUANTITY'</span></span>]!=<span class="hljs-number"><span class="hljs-number">0</span></span>){ <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>         $APPLICATION-&gt;IncludeComponent(<span class="hljs-string"><span class="hljs-string">"bitrix:catalog.store.amount"</span></span>,<span class="hljs-string"><span class="hljs-string">"finnit_buy"</span></span>, array(<span class="hljs-string"><span class="hljs-string">"ELEMENT_ID"</span></span> =&gt; $arResult[<span class="hljs-string"><span class="hljs-string">"ID"</span></span>] /<span class="hljs-regexp"><span class="hljs-regexp">/  ID </span></span></code> </pre> <br></div></div><br>  2. For the list of products through a component, only one price was selected (either the lowest price or the minimum delivery time) <br><br><div class="spoiler">  <b class="spoiler_title">Code snippet</b> <div class="spoiler_text"><pre> <code class="hljs php">$APPLICATION-&gt;IncludeComponent( <span class="hljs-string"><span class="hljs-string">"bitrix:catalog.store.amount"</span></span>, <span class="hljs-string"><span class="hljs-string">"finnit_1sk"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">"ELEMENT_ID"</span></span> =&gt; $arElement[<span class="hljs-string"><span class="hljs-string">"ID"</span></span>]<span class="hljs-comment"><span class="hljs-comment">//  ID </span></span></code> </pre> <br></div></div><br>  So for each type of its own template was created, in addition to this, several more templates were created.  For example, a template for a quick purchase in which the optimal warehouse is displayed with the price for making a purchase. <br><br>  The work on the catalog.store.amount component went in 3 stages. <br><br>  1. Manual comparison in the warehouse code - price (conveniently with a small number of warehouses).  In this case, the code is written indicating the type of price for a particular warehouse. <br><br><div class="spoiler">  <b class="spoiler_title">Code snippet</b> <div class="spoiler_text"><pre> <code class="hljs ruby"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($arProperty[<span class="hljs-string"><span class="hljs-string">'ID'</span></span>] == <span class="hljs-number"><span class="hljs-number">29</span></span>){<span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   $db_res = CPrice::GetList( array(), array(<span class="hljs-string"><span class="hljs-string">"PRODUCT_ID"</span></span> =&gt; $arParams[<span class="hljs-string"><span class="hljs-string">'ELEMENT_ID'</span></span>],<span class="hljs-string"><span class="hljs-string">"CATALOG_GROUP_ID"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'28'</span></span>)); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> -      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($ar_res = $db_res-&gt;Fetch()){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($min_price &gt; (ceil(($ar_res[<span class="hljs-string"><span class="hljs-string">"PRICE"</span></span>] + ($ar_res[<span class="hljs-string"><span class="hljs-string">"PRICE"</span></span>]/<span class="hljs-number"><span class="hljs-number">100</span></span>))/<span class="hljs-number"><span class="hljs-number">10</span></span>)* <span class="hljs-number"><span class="hljs-number">10</span></span>)) $min_price = ceil(($ar_res[<span class="hljs-string"><span class="hljs-string">"PRICE"</span></span>] + ($ar_res[<span class="hljs-string"><span class="hljs-string">"PRICE"</span></span>]/<span class="hljs-number"><span class="hljs-number">100</span></span>))/<span class="hljs-number"><span class="hljs-number">10</span></span>)* <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>            $amount = $arProperty[<span class="hljs-string"><span class="hljs-string">"AMOUNT"</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     $title = $arProperty[<span class="hljs-string"><span class="hljs-string">"ID"</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     ,      <span class="hljs-number"><span class="hljs-number">1</span></span>        -      ID,     . }</code> </pre> <br></div></div><br>  2. After the warehouses began to be connected, the first option turned out to be unsuitable and it was decided to keep the warehouse-price bundles in a separate information block. <br><br><div class="spoiler">  <b class="spoiler_title">screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/mh/t4/y-/mht4y-9jxbxgqvz9idjqe_et7nu.jpeg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Code snippet</b> <div class="spoiler_text"><pre> <code class="hljs bash">&lt;?//      <span class="hljs-variable"><span class="hljs-variable">$arSelectEquals</span></span> = Array(<span class="hljs-string"><span class="hljs-string">"ID"</span></span>, <span class="hljs-string"><span class="hljs-string">"IBLOCK_ID"</span></span>); <span class="hljs-variable"><span class="hljs-variable">$arFilterEquals</span></span> = Array(<span class="hljs-string"><span class="hljs-string">"IBLOCK_ID"</span></span>=&gt;18); //ID   <span class="hljs-variable"><span class="hljs-variable">$equals</span></span> = CIBlockElement::GetList(Array(), <span class="hljs-variable"><span class="hljs-variable">$arFilterEquals</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, Array(), <span class="hljs-variable"><span class="hljs-variable">$arSelectEquals</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-variable"><span class="hljs-variable">$equal</span></span> = <span class="hljs-variable"><span class="hljs-variable">$equals</span></span>-&gt;GetNextElement()){ <span class="hljs-variable"><span class="hljs-variable">$arPropsEquals</span></span> = <span class="hljs-variable"><span class="hljs-variable">$equal</span></span>-&gt;GetProperties(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">$arProperty</span></span>[<span class="hljs-string"><span class="hljs-string">"ID"</span></span>] == <span class="hljs-variable"><span class="hljs-variable">$arPropsEquals</span></span>[<span class="hljs-string"><span class="hljs-string">"SKLAD_ID"</span></span>][<span class="hljs-string"><span class="hljs-string">"VALUE"</span></span>]){//    <span class="hljs-variable"><span class="hljs-variable">$db_res</span></span> = CPrice::GetList( array(), array(<span class="hljs-string"><span class="hljs-string">"PRODUCT_ID"</span></span> =&gt; <span class="hljs-variable"><span class="hljs-variable">$arParams</span></span>[<span class="hljs-string"><span class="hljs-string">'ELEMENT_ID'</span></span>],<span class="hljs-string"><span class="hljs-string">"CATALOG_GROUP_ID"</span></span> =&gt; <span class="hljs-variable"><span class="hljs-variable">$arPropsEquals</span></span>[<span class="hljs-string"><span class="hljs-string">"PRICE_ID"</span></span>][<span class="hljs-string"><span class="hljs-string">"VALUE"</span></span>])); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">$ar_res</span></span> = <span class="hljs-variable"><span class="hljs-variable">$db_res</span></span>-&gt;Fetch()){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isset(<span class="hljs-variable"><span class="hljs-variable">$ar_res</span></span>[<span class="hljs-string"><span class="hljs-string">"PRICE"</span></span>])){ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> GetMessage(<span class="hljs-string"><span class="hljs-string">'FINN_PRICE_MANAGER'</span></span>);//     }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ //       <span class="hljs-variable"><span class="hljs-variable">$pricen</span></span> = ceil( <span class="hljs-variable"><span class="hljs-variable">$ar_res</span></span>[<span class="hljs-string"><span class="hljs-string">"PRICE"</span></span>] );//      <span class="hljs-variable"><span class="hljs-variable">$price_id</span></span> = <span class="hljs-variable"><span class="hljs-variable">$ar_res</span></span>[<span class="hljs-string"><span class="hljs-string">"CATALOG_GROUP_ID"</span></span>];//      <span class="hljs-variable"><span class="hljs-variable">$price_name</span></span> = <span class="hljs-variable"><span class="hljs-variable">$ar_res</span></span>[<span class="hljs-string"><span class="hljs-string">"CATALOG_GROUP_NAME"</span></span>];//      } //<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> number_format( <span class="hljs-variable"><span class="hljs-variable">$pricen</span></span>, 0, <span class="hljs-string"><span class="hljs-string">','</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span> ); <span class="hljs-variable"><span class="hljs-variable">$torgId</span></span> = <span class="hljs-variable"><span class="hljs-variable">$ar_res</span></span>[<span class="hljs-string"><span class="hljs-string">"ID"</span></span>]; //      <span class="hljs-variable"><span class="hljs-variable">$torgGId</span></span> = <span class="hljs-variable"><span class="hljs-variable">$ar_res</span></span>[<span class="hljs-string"><span class="hljs-string">"CATALOG_GROUP_ID"</span></span>];//      } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{}} } ?&gt;</code> </pre> <br></div></div><br>  Thus, a sufficiently large volume of warehouses can be maintained. <br><br>  3. Using custom fields directly in warehouses for comparison with price types. <br><br>  This option was not originally considered.  And only after the store opened alongside Chelyabinsk, it was also necessary in St. Petersburg to indicate the delivery time of the goods depending on the warehouse, for this purpose they used custom fields in the warehouses. <br><br><div class="spoiler">  <b class="spoiler_title">Screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/_l/a6/d3/_la6d32_6-71-ntjl2aq3bq3wow.jpeg"><br></div></div><br>  I consider this option the most optimal.  And at the moment, several templates have already been transferred to the same version of the comparison of warehouses and prices. <br><br>  PS If you know a more suitable option - write in the comments, I will be grateful. <br><br>  PPS If you have any comments or questions, please write - I will answer. </div><p>Source: <a href="https://habr.com/ru/post/420071/">https://habr.com/ru/post/420071/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../420061/index.html">Evaluate processes in a development team based on objective data.</a></li>
<li><a href="../420063/index.html">"Holy" Timlid and his followers</a></li>
<li><a href="../420065/index.html">Communications as a performance zone</a></li>
<li><a href="../420067/index.html">From the closed caste to Servant Leadership: the evolution of the team leader on Booking.com</a></li>
<li><a href="../420069/index.html">Richard Hamming: Chapter 20. Modeling - III</a></li>
<li><a href="../420073/index.html">The art of driving: a review of the best reports with Teamlead Conf 2018. Part 2</a></li>
<li><a href="../420075/index.html">This ingenious map explains how everything in physics fits together.</a></li>
<li><a href="../420077/index.html">New online trading opportunities</a></li>
<li><a href="../420079/index.html">Creating an interactive grass in the Unreal Engine</a></li>
<li><a href="../420081/index.html">Installing Archlinux with full system and LVM encryption on LUKS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>