<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Preparation for programming ESP8266 on micropython</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Micropython is a Python 3 implementation written in C that is optimized for microcontrollers. Nodemcu v1.0 - the most convenient board with an ESP8266...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Preparation for programming ESP8266 on micropython</h1><div class="post__text post__text-html js-mediator-article">  Micropython is a Python 3 implementation written in C that is optimized for microcontrollers.  Nodemcu v1.0 - the most convenient board with an ESP8266 microcontroller and support for Wi-Fi.  The combination of it and micropython is the power, speed and ease of writing.  Since this is my first experience with micropython (and with <abbr title="microcontroller">MK</abbr> in principle), I was faced with a number of nuances, the solutions to which I want to share with the reader.  Examples will be for MacOS, however they are easily adaptable for Linux and Windows. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c1d/ff2/8de/c1dff28de91ac801ed51e23edb51c902.jpg" alt="image" height="360" width="360"></div><br><a name="habracut"></a><br><h2>  Driver </h2><br>  First you need to install the driver.  It's easy, I will not stop here.  For MacOS, I used <a href="https://github.com/adrianmihalko/ch340g-ch34g-ch34x-mac-os-x-driver">ch340g-ch34g-ch34x-mac-os-x-driver</a> <br><br><h2>  Firmware </h2><br>  Now you need to upload the micropython firmware to your ESP8266.  The process is described in detail and qualitatively in the micropython <a href="https://docs.micropython.org/en/latest/esp8266/esp8266/tutorial/intro.html">documentation</a> for ESP8266, so I will only briefly highlight the main points. <br><br>  Download the firmware <a href="http://micropython.org/download">here</a> .  I recommend the last stable build. <br>  Install esptool: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="bash hljs">pip install esptool</code> </pre> <br>  Pip is a python package management system.  If you do not have pip or python in general, you must first install them. <br><br>  Next, clear the flash memory device: <br><br><pre> <code class="bash hljs">esptool.py --port /dev/ttyUSB0 erase_flash</code> </pre> <br>  And flashing: <br><br><pre> <code class="bash hljs">esptool.py --port /dev/ttyUSB0 --baud 115200 write_flash --flash_size=detect 0 esp8266-20170108-v1.8.7.bin</code> </pre> <br>  Port <code>/dev/ttyUSB0</code> needs to be replaced with your own.  For MacOS, you can simply substitute <code>/dev/$(ls /dev | grep cu.wchusbserial)</code> and the desired port will be automatically <code>/dev/$(ls /dev | grep cu.wchusbserial)</code> . <br>  For example: <br><br><pre> <code class="bash hljs">esptool.py --port /dev/$(ls /dev | grep cu.wchusbserial) erase_flash</code> </pre> <br>  Pay attention, I use baud rate 115200 as standard for esp. <br><br><h2>  REPL </h2><br>  Great, now our microcontroller is equipped with a micropython, which means that you can connect to it and execute commands in the <a href="https://docs.micropython.org/en/latest/esp8266/esp8266/tutorial/repl.html">REPL</a> (Read Evaluate Print Loop).  In fact, this is an analogue of the command line interpreter of classical Python.  You can connect via the serial port or via WiFi.  Detailed usage information is available <a href="https://docs.micropython.org/en/latest/esp8266/esp8266/tutorial/repl.html">here</a> , and I will provide it with a few comments. <br><br>  For MacOS it is convenient to use picocom: <br><br><pre> <code class="bash hljs">picocom /dev/$(ls /dev | grep cu.wchusbserial) -b115200</code> </pre> <br>  After executing the command, the console will go online. <br>  To exit use Control-A, then Control-X (without pressing Control). <br>  The author of the utility actively responds to issues on the githab, for someone it can play an important role.  Also, starting from version 3, a non-interactive mode has been added, which allows picocom to be used in writing its own scripts. <br><br>  You can also use screen: <br><br><pre> <code class="bash hljs">screen /dev/$(ls /dev | grep cu.wchusbserial) 115200</code> </pre> <br>  To exit: Control-A, Control- \ <br><br>  Before the transition to programming, I recommend to complete the <a href="https://docs.micropython.org/en/latest/esp8266/esp8266/tutorial/index.html">tutorial</a> completely, it will take only a few hours, and the benefits will be tangible. <br><br><h2>  IDE </h2><br>  They played with the REPL, the diode blinked, TCP sockets were used.  What's next?  A quick way to deliver our esp code is required.  We will not write everything through the REPL.  IDE comes to mind immediately.  So I downloaded <a href="http://esp8266.ru/esplorer-latest/%3Ff%3DESPlorer.zip">ESPlorer 0.2.0-rc6</a> .  Support for micropython is in active development and, as I understand it, was added quite recently, in rc3.  After some time spent in this IDE, I ran into a number of bugs that prevent you from properly writing files to flash and executing code.  I wrote an <a href="https://github.com/4refr0nt/ESPlorer/issues/67">issue</a> on the githab and put off ESPlorer until better times.  For Windows, there are several alternatives: <a href="http://espcut.com/index.html">espcut</a> , <a href="https://github.com/jungervin/EsPy">EsPy</a> . <br><br>  I decided to write the code in Sublime - everything is simple and clear.  And how to deliver it to MK? <br>  Fortunately, there is a wonderful ampy utility and it does just what we need - it allows you to send files through a serial connection.  It also allows you to execute files and create / delete folders. <br><br>  For ease of use, I wrote a simple script that is a wrapper for ampy. <br>  He can do only two things: <br><br><ol><li>  If called with the -f option, then it transfers to the MK all Python files that are in the same folder as the script. </li><li>  If called without parameters, all arguments are passed directly to ampy (eliminating the need to constantly specify the port in ampy). </li></ol><br>  The script is available <a href="https://github.com/alexzaitsev/ampyw">on github</a> .  Put it in the folder where your code is. <br>  To see the help, just call the script with no arguments. <br><br>  ESP8266 is mainly used for simple tasks, so these simple tools will be quite enough. <br><br><h2>  Results </h2><br>  So, we crafted our esp8266, set up the necessary software for communicating with the MK, and secured ourselves a quick and convenient development using ampy and ampyw, which gives us independence from IDE.  Now all that is required of you is to write the code and create the device of your dreams! <br><cut></cut></div><p>Source: <a href="https://habr.com/ru/post/345912/">https://habr.com/ru/post/345912/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345900/index.html">Study of technical and social characteristics of mining pools</a></li>
<li><a href="../345904/index.html">Programming a random number generator on Ethereum</a></li>
<li><a href="../345906/index.html">Attribution using the Markov chain</a></li>
<li><a href="../345908/index.html">What to do on holidays: write robots for trading on the exchange in the scripting language TradeScript</a></li>
<li><a href="../345910/index.html">Securely sign Android builds from Jenkins</a></li>
<li><a href="../345916/index.html">First-hand: how was the year on Habr√©</a></li>
<li><a href="../345920/index.html">Security Week 52: Telegram and the Rat King, the next miners, large-scale bruteforce Wordpress</a></li>
<li><a href="../345922/index.html">Oxymoron or how to implement 7 directed MicrosoftAD protocol authentication, 2 of which are LDAP and 2 Authorizations</a></li>
<li><a href="../345926/index.html">Empathic mapping: when and how to use it?</a></li>
<li><a href="../345928/index.html">Checks and plans of Roskomnadzor for 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>