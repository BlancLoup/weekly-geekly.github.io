<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Himself service screenshots</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It all started with ... 
 A few years ago, I just started to get acquainted with web-programming, and one of my first ‚Äúprojects‚Äù was site catalogs. Th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Himself service screenshots</h1><div class="post__text post__text-html js-mediator-article"><h4>  It all started with ... </h4><br>  A few years ago, I just started to get acquainted with web-programming, and one of my first ‚Äúprojects‚Äù was site catalogs.  The development was carried out for themselves, in order to improve the experience.  But since  similar sites darkness, wanted to make something special.  I decided that each site in the directory will be presented with a screenshot.  I did not know how to automate all this, because at first I took all the screenshots with my hands and filled them in like ready files. <br><br>  As time went on, the project was ‚Äúcovered with dust‚Äù, there was no time to deal with it, but about a year ago a new ‚Äúwave of creativity‚Äù rolled over and I wanted to solve the ‚Äúproblem of the autoscript‚Äù. <br><br>  The first thing that came to mind was ready-made screenshot services that provide an API.  But, having gone through some (I don‚Äôt remember the name now), I realized that this was not for me: the opportunities were rather curtailed, sometimes it took a long time to wait for the ‚Äúqueue‚Äù, sometimes the sites on the screens looked rather poor.  But the main problem was that all this had to work asynchronously and I could not understand from the script - whether the service gave me a temporary picture-stub, or a ready-made screenshot of the site. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So I decided to make my own ‚Äúbicycle‚Äù. <br><a name="habracut"></a><br><h4>  Tool selection </h4><br>  To begin with, it was necessary to find a utility that can take screenshots, working in linux from the command line (the site is spinning on my ubuntu server, because there are no X).  A colleague helped me by giving a link to <a href="http://cutycapt.sourceforge.net/">CutyCapt</a> . <br><br>  CutyCapt is a small cross-platform utility (running from the command line) to create a screenshot of a web page and save it in various vector and raster formats, including SVG, PDF, PS, PNG, JPEG, TIFF, GIF, BM P (translation of the original description from official site). <br><br>  In order not to engage in copy-paste from the <a href="http://cutycapt.sourceforge.net/">official site,</a> I‚Äôll just say that everything is already described there: installation, dependencies, startup parameters, example, and method of use in the absence of an X server (via xvfb-run). <br><br><h4>  Coding </h4><br>  So, with the tool decided.  Let's go back to the site.  I saw it this way: the administrator on the description page has a ‚Äúmake a screenshot‚Äù button, which, through an AJAX request, invokes a script that creates a picture, performs the necessary processing with it (resize / crop / sketch), etc. <br>  No sooner said than done.  I will give a part of the code of my PHP script (leaving the most basic): <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?PHP</span></span> <span class="hljs-comment"><span class="hljs-comment">//  -    URL ,     //      (  id),   - $url = 'http://habrahabr.ru'; // ""   //       $tmpfname = tempnam('/tmp', 'catalog') . '.jpg'; //       $url = escapeshellarg($url); //    //    CutyCapt    .  , url   ,    -    //  "xvfb-run"    $cmd = sprintf('xvfb-run --server-args="-screen 0, 1024x768x24" //C//CutyCapt --min-width=1280 --url=%s --out=\'%s\'', $url, $tmpfname); //  exec($cmd); // ,    if (file_exists($tmpfname)) { // ,    0  (    ) if (filesize($tmpfname) &gt; 1) { //         $tmpfname ,    //      ,  ,    ,   ..... // , ,  phpthumb (phpthumb.gxdlabs.com)   $f = date("ymd_his", time()).".jpg"; //    if (copy($tmpfname, IMAGES_DIR.$f)) { if (file_exists(IMAGES_DIR.$f)) { try{ $thumb = PhpThumbFactory::create(IMAGES_DIR.$f); //  jpg $thumb-&gt;setOptions( array('jpegQuality' =&gt; 90) ); //   $thumb-&gt;resize(800); //    800x800px $thumb-&gt;crop(0, 0, 800, 800); $thumb-&gt;save(IMAGES_DIR.$f); //  $thumb-&gt;resize(200)-&gt;crop(0,0,200,150); $thumb-&gt;save(IMAGES_DIR.'t_'.$f); } catch(exception $e) { //  ... } //       ,  . } } } //    unlink($tmpfname); } //       json -   /   </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br>  Oh yeah, I would like to share information about the "pitfalls": <br><ol><li>  Sometimes CutyCapt took a long time to screen, but never completed its work; </li><li>  Sometimes did 0-byte screenshots </li><li>  Sometimes it crashed with an error on some flash-sites.  I had to sacrifice them and just remove the flash-plugin from the system.  Now, just on the screenshots in place of the flush is empty, but there are no more departures because of the flush. </li></ol><br><br>  <b>Literature:</b> <br>  <a href="http://cutycapt.sourceforge.net/">CutyCapt official website</a> <br>  <a href="http://www.php.net/">Php.net</a> <br><br>  PS If it seems to someone that I have written little about CutyCapt, say - I will add an article (it just seemed to me that everything was clearly described on the site) </div><p>Source: <a href="https://habr.com/ru/post/111188/">https://habr.com/ru/post/111188/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../111182/index.html">Products phantoms (Vaporware) for 11 years. Article One - 1999</a></li>
<li><a href="../111183/index.html">Tuning rubber text field</a></li>
<li><a href="../111185/index.html">Firefox has shifted IE from first place in Europe</a></li>
<li><a href="../111186/index.html">Create your file system in Windows OS on .Net</a></li>
<li><a href="../111187/index.html">Direct Fuzzy Inference</a></li>
<li><a href="../111189/index.html">Do you know JAVA,% username%?</a></li>
<li><a href="../111191/index.html">Micro-framework Robotlegs. Overview of injecting methods</a></li>
<li><a href="../111192/index.html">School website</a></li>
<li><a href="../111193/index.html">Introduction to Sencha Touch 1.0</a></li>
<li><a href="../111194/index.html">Samsung has developed DDR4 memory modules, which are 40% more energy efficient than DDR3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>