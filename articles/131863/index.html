<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>.NET: Creating an extensible plug-in system to monitor and manage servers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, I want to tell you about the project, which, in my opinion, is very interesting and, perhaps, useful to someone. 

 The task was to make the sy...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>.NET: Creating an extensible plug-in system to monitor and manage servers</h1><div class="post__text post__text-html js-mediator-article">  Hello, I want to tell you about the project, which, in my opinion, is very interesting and, perhaps, useful to someone. <br><br>  The task was to make the system extensible plugins, which will be written by different people.  Plugins should collect information from servers (performance, versions of installed programs, database selections), or make some changes (restarting services, etc.).  Communication with servers must be carried out using TCP protocol and a specific port.  Results should be displayed on the HTML page.  There are many servers and in different cities, the connection is very bad, the servers are not very productive, the software can be updated up to 10 times a day, in general, we need total control over their performance. <br><br><h5></h5><h4>  After the reasoning it was decided: </h4><br><ul><li>  create a service and install it on each server; </li><li>  the service should listen to the port on requests from browsers; </li><li>  plug-ins should be added and updated also from browsers at the server address (eg http: //10.14.3.160/); </li><li>  plugins should return information in JSON markup if the result is an object, and HTML if the result is text; </li><li>  The plugin is called by adding its name to the server address (http://10.14.3.160/pluginname) and the parameters are passed in the same way (http://10.14.3.160/pluginName?p1=5&amp;p2=8&amp;p3=somevalue); </li><li>  reduce information on HTML pages using JavaScript and jQuery; </li><li>  write system to .Net 2.0, since only this version is installed on all servers.  C # language. </li></ul><br><a name="habracut"></a><br><h5>  Development began with a description of the interface IPlugin: </h5>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Interface</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IPlugin</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Version { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Author { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Data</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Dictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; query</span></span></span><span class="hljs-function">)</span></span>; } }</code> </pre> <br><br>  Where Data () function which service on request of the browser will call.  And the query will contain the parameters. <br><br><h5>  The next step is to create the service: </h5><br><ul><li>  When the service starts, we look for DLL files (plug-ins) in the application folder, and check if they implement the IPlugin interface.  If so, add to the list of plugins. </li><li>  Listen to the port </li><li>  If there is a request and it does not contain a body, we process the url address.  If the address contains a subdirectory, we look for a plugin with the same name, call its Data () function and in it transfer the parameters received from the browser, wait for the result.  If the function returns the text (type string), then it is passed to the browser, if not, then converted to JSON markup, and also passed to the browser.  If the address does not contain a subdirectory, we transfer to the browser a page with a list of plug-ins and a button for uploading a new one to the server. </li><li>  If there is a request, but it contains a body, we check if the plug-in can send us  If so, save it in the application folder, and add or replace it in the list of plugins. </li><li>  We continue to listen to the port. </li></ul><br><br><h5>  Implementations of this algorithm </h5><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> HostServer : IDisposable { private Thread mThread; private HttpListener listener; private static string sVersion { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } private static string sName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } private static string sIPAdress { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } private static List&lt;IPlugin&gt; sPlugins { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> HostServer(<span class="hljs-type"><span class="hljs-type">int</span></span> port) { sVersion = "0.6"; sName = "ISHOST"; sIPAdress = "http://" + <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Net.Dns.GetHostEntry(<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Net.Dns.GetHostName()).AddressList[<span class="hljs-number"><span class="hljs-number">0</span></span>].ToString() + ":" + port.ToString() + "/"; LoadPlugins(); listener = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HttpListener(); listener.Prefixes.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(sIPAdress); } private static <span class="hljs-type"><span class="hljs-type">void</span></span> LoadPlugins() { try { sPlugins = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;IPlugin&gt;(); string folder = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.AppDomain.CurrentDomain.BaseDirectory; string[] files = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.IO.Directory.GetFiles(folder, "*.dll"); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (string file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files) { IPlugin plugin = IsPlugin(file); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (plugin != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) sPlugins.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(plugin); } } catch (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> e) { ToLog(e.Message); } } private static IPlugin IsPlugin(byte[] file) { try { <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Reflection.Assembly assembly = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Reflection.Assembly.<span class="hljs-keyword"><span class="hljs-keyword">Load</span></span>(file); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> assembly.GetTypes()) { <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> iface = <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>.GetInterface("Interface.IPlugin"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (iface != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { IPlugin plugin = (IPlugin)Activator.CreateInstance(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> plugin; } } } catch (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> e) { ToLog(e.Message); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } private static IPlugin IsPlugin(string file_url) { try { byte[] b = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.IO.File.ReadAllBytes(file_url); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> IsPlugin(b); } catch (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> e) { ToLog(e.Message); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Start</span></span>() { mThread = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Thread(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ThreadStart(delegate() { try { listener.<span class="hljs-keyword"><span class="hljs-keyword">Start</span></span>(); ToLog("Started on " + sIPAdress); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { IAsyncResult result = listener.BeginGetContext(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> AsyncCallback(ListenerCallback), listener); result.AsyncWaitHandle.WaitOne(); } } catch (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> e) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.GetType() != typeof(ObjectDisposedException)) ToLog(e.Message); } })); mThread.<span class="hljs-keyword"><span class="hljs-keyword">Start</span></span>(); } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> Stop() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (listener != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) listener.<span class="hljs-keyword"><span class="hljs-keyword">Close</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mThread != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) mThread.<span class="hljs-keyword"><span class="hljs-keyword">Join</span></span>(<span class="hljs-number"><span class="hljs-number">10000</span></span>); ToLog("Stoped"); } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static <span class="hljs-type"><span class="hljs-type">void</span></span> ListenerCallback(IAsyncResult result) { try { HttpListener listener = (HttpListener)result.AsyncState; HttpListenerContext context = listener.EndGetContext(result); HttpListenerRequest request = context.Request; HttpListenerResponse response = context.Response; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.IO.Stream output = response.OutputStream) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (request.HasEntityBody) { SaveNewPlugin(request.InputStream, response, output); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { string ans = string.Empty; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (IPlugin plugin <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sPlugins) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (request.Url.LocalPath.Replace("/", "").ToLower().StartsWith(plugin.Name.ToLower())) { // <span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> Parameters <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> url <span class="hljs-keyword"><span class="hljs-keyword">Dictionary</span></span>&lt;string, string&gt; query = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Dictionary</span></span>&lt;string, string&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; request.QueryString.Keys.Count; i++) { string pName = request.QueryString.Keys[i]; string pValue = <span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.UTF8.GetString(request.ContentEncoding.GetBytes(request.QueryString[pName])); query.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(pName, pValue); } //<span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> data <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> plugin try { <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> data = plugin.Data(query); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data.GetType() == typeof(string)) { ans = (string)data; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { //Convert data <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-type"><span class="hljs-type">JSON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ans = request.QueryString["callback"] + "(" + ConvertToJSON(data) + ")"; } } catch (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> e) { ans = e.Message; } break; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (string.IsNullOrEmpty(ans)) { ans = GetMainPage(); } //Send data <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> SendMessage(response, output, ans); output.Flush(); output.<span class="hljs-keyword"><span class="hljs-keyword">Close</span></span>(); } } } catch (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> e) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.GetType() != typeof(ObjectDisposedException)) ToLog(e.Message); } } private static string GetMainPage() { StringBuilder sb = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StringBuilder(); sb.Append("&lt;html&gt;"); sb.Append("&lt;head&gt;"); sb.Append("&lt;title&gt;ISHOST " + sVersion + "&lt;/title&gt;"); sb.Append("&lt;/head&gt;"); sb.Append("&lt;body&gt;"); sb.Append("&lt;table cellpadding=\"<span class="hljs-number"><span class="hljs-number">10</span></span>px\"&gt;"); sb.Append("&lt;thead&gt;"); sb.Append("&lt;tr&gt;"); sb.Append("&lt;td&gt;"); sb.Append("&lt;b&gt;NAME&lt;/b&gt;"); sb.Append("&lt;/td&gt;"); sb.Append("&lt;td&gt;"); sb.Append("&lt;b&gt;VERSION&lt;/b&gt;"); sb.Append("&lt;/td&gt;"); sb.Append("&lt;td&gt;"); sb.Append("&lt;b&gt;AUTHOR&lt;/b&gt;"); sb.Append("&lt;/td&gt;"); sb.Append("&lt;/tr&gt;"); sb.Append("&lt;/thead&gt;"); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (IPlugin plugin <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sPlugins) { sb.Append("&lt;tr&gt;"); sb.Append("&lt;td&gt;"); sb.Append(plugin.Name); sb.Append("&lt;/td&gt;"); sb.Append("&lt;td&gt;"); sb.Append(plugin.<span class="hljs-keyword"><span class="hljs-keyword">Version</span></span>); sb.Append("&lt;/td&gt;"); sb.Append("&lt;td&gt;"); sb.Append(plugin.Author); sb.Append("&lt;/td&gt;"); sb.Append("&lt;/tr&gt;"); } sb.Append("&lt;/table&gt;"); sb.Append("&lt;div&gt;"); sb.Append("&lt;form action=\"" + sIPAdress + "\" enctype=\"multipart/form-data\" method=\"post\"&gt;"); sb.Append("&lt;input type=\"file\" name=\"somename\" size=\"chars\"&gt;"); sb.Append("&lt;input type=\"submit\" value=\"Send\"&gt;"); sb.Append("&lt;/form&gt;"); sb.Append("&lt;/div&gt;"); sb.Append("&lt;/body&gt;"); sb.Append("&lt;/html&gt;"); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sb.ToString(); } private static <span class="hljs-type"><span class="hljs-type">void</span></span> SendMessage(HttpListenerResponse response, Stream output, string ans) { byte[] buffer = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.UTF8.GetBytes(ans); response.ContentLength64 = buffer.Length; output.<span class="hljs-keyword"><span class="hljs-keyword">Write</span></span>(buffer, <span class="hljs-number"><span class="hljs-number">0</span></span>, buffer.Length); } private static string ConvertToJSON(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> data) { string result = string.Empty; try { result = JsonConvert.SerializeObject(data, Formatting.Indented); } catch (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> e) { ToLog(e.Message); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } static <span class="hljs-type"><span class="hljs-type">void</span></span> ToLog(string <span class="hljs-type"><span class="hljs-type">text</span></span>) { try { string folder = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.AppDomain.CurrentDomain.BaseDirectory; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (StreamWriter sw = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StreamWriter(folder + @"\Log.txt", <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)) { sw.WriteLine(<span class="hljs-type"><span class="hljs-type">text</span></span>+ " : " + DateTime.Now); } } catch { } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> Dispose() { Stop(); } }</code> </pre><br><br>  One note to update the plug-ins (DLL) without restarting the service, I read the bytes from the dll file, and did not load the file into memory.  Then read bytes checked for interface implementation.  This method seemed to me better than the time-consuming unloading from the memory of an open dll. <br>  Converting objects into JSON markup was done using the Newtonsoft library. <br><br><h5>  Service code for listening to the port. </h5><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span>: <span class="hljs-title"><span class="hljs-title">ServiceBase</span></span> { HostServer server; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Program</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ServiceName = <span class="hljs-string"><span class="hljs-string">"ISHOST"</span></span>; server = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HostServer(<span class="hljs-number"><span class="hljs-number">28555</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { server.Start(); <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnStart(args); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { server.Stop(); <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnStop(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { System.ServiceProcess.ServiceBase.Run(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Program()); } }</code> </pre><br><br><h5>  Service installer </h5><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">RunInstaller(true)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ISHOSTInstaller</span></span> : <span class="hljs-title"><span class="hljs-title">Installer</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ISHOSTInstaller</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> processInstaller = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServiceProcessInstaller(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> serviceInstaller = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServiceInstaller(); processInstaller.Account = ServiceAccount.LocalSystem; serviceInstaller.DisplayName = <span class="hljs-string"><span class="hljs-string">"ISHOST"</span></span>; serviceInstaller.StartType = ServiceStartMode.Automatic; serviceInstaller.ServiceName = <span class="hljs-string"><span class="hljs-string">"ISHOST"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Installers.Add(processInstaller); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Installers.Add(serviceInstaller); } }</code> </pre><br><br>  After installing the service on the server using the InstallUtil.exe utility (InstallUtil ISHOST.exe), go to the server address <a href="http://10.14.3.160/">10.14.3.160</a> : 28555.  We will open a page of this type: <br><img src="https://habrastorage.org/getpro/habr/post_images/24e/196/556/24e196556a4ab4d17967e309732790d3.png" alt="image"><br><br><h5>  Create a plugin </h5><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TestPlugin</span></span> : <span class="hljs-title"><span class="hljs-title">IPlugin</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Author { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Yura"</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"TestPlugin"</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Version { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"0.1"</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Data</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Dictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; query</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;h1&gt;HELLO&lt;/h1&gt;"</span></span>; } }</code> </pre><br>  After compiling, go back to the browser, and select the TestPlugin.dll plugin: <br><img src="https://habrastorage.org/getpro/habr/post_images/443/85b/ba7/44385bba7e48abaec3da4cbd7e9808ed.png" alt="image"><br><br><h5>  After clicking the ‚ÄúSend‚Äù button. </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/626/e0e/282/626e0e282cdcf429b0997c503ecd7825.png" alt="image"><br><br><h5>  Call TestPlugin plugin </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/950/f05/cd4/950f05cd42b70ecc2bd040c4f41169fe.png" alt="image"><br><br>  In the next article I will write how to collect information using JavaScript and jQuery, as well as lay out the source code. <br>  I look forward to your comments. </div><p>Source: <a href="https://habr.com/ru/post/131863/">https://habr.com/ru/post/131863/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../131855/index.html">Development of electronic, interactive magazine for iPad</a></li>
<li><a href="../131856/index.html">Twenty Facts About Beeline Home Internet</a></li>
<li><a href="../131857/index.html">Video review of the set-top box on Android - iconBIT Toucan W</a></li>
<li><a href="../131861/index.html">Officially presented tablets Xoom 2 and Xoom 2 Media Edition</a></li>
<li><a href="../131862/index.html">Handling large amounts of incoming mail based on a KANA Response solution</a></li>
<li><a href="../131865/index.html">HP competition - part two, positive</a></li>
<li><a href="../131866/index.html">Sergey Arkhipenkov - Theory and Practice of Adaptive Project Management</a></li>
<li><a href="../131867/index.html">Providers appointed extreme</a></li>
<li><a href="../131868/index.html">Owners of Wi-Fi equipment are charged with GLONASS</a></li>
<li><a href="../131869/index.html">Correction and modification of MySQL encodings</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>