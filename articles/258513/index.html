<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I once hacked an online casino</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Inspired by the story of Chikey about how he again ‚Äúbroke the Internet‚Äù, Egor stopped breaking everything, deal with some business , decided to tell o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I once hacked an online casino</h1><div class="post__text post__text-html js-mediator-article">  Inspired by the story of <a href="https://habrahabr.ru/users/chikey/" class="user_link">Chikey</a> about <a href="https://habr.com/post/258449/">how he again ‚Äúbroke the Internet‚Äù,</a> <s>Egor stopped breaking everything, deal with some business</s> , decided to tell one story with a fairly well-known online casino.  The name of this "organization" I do not call, because  50 percent sure that they either did not fix it at all, or made it more crooked than it was before. <br><br>  The story is very similar to the hacking of Egor, except that it is not exactly a race, or rather, not a race condition in its pure form.  I do not know how it will be completely, I am more a practitioner than a theorist.  Let's call it ‚Äúconditional race condition‚Äù - although the oil is oily, it reflects the essence correctly. <br><br>  One evening, the <s>family fell asleep, there was only one murkiness in the box, our losers again</s> had nothing to do, I decided to score on the open source, I wanted to break something.  And what to break <s>(when Egor broke everything)</s> , if not a bank or a casino (ego, the need to sometimes feel like a cool guy, everything is in general).  It was one of the first online casinos, which I then liked in search. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It is no secret that they save on programmers, testers, etc.  all or almost all.  I sometimes do audits, and by the nature of this activity sometimes you see that hair is on end.  But here is the casino!  With the possibility of withdrawing (won) evergreens, etc.  Those.  the office should seem to correspond. <br><br>  I got an account, and let's go ... <br><a name="habracut"></a><br><h3>  Actually hacking </h3><br>  As it turned out - here, too, saved considerably. <br><br>  At first I decided to throw myself some ‚Äúvirtual‚Äù money.  Virtual currency is not displayed there (pure play - to practice).  It was possible through paypal (10ct = 10V $), once a day through the captcha (20V $). <br><br>  When scrolling through the ‚Äúpurchase‚Äù page (loading it several times), I found a token linked to a time (modulo 180 increment is noticeable), which starts with a captcha after clicking ‚ÄúOrder‚Äù.  Probably, the date for the time of ‚Äúpurchase‚Äù was written to the base for my account (so that means only once a day), but for us it is now unnecessarily. <br><br>  I wanted to try a clean race first (I'm not so stupid as to believe about 3 minutes, well, or 1.5 minutes if I use the formula with offset), but I had doubts that there was not even a few milliseconds, i.e.  with high probability this token was probably also marked as used in DB, so that means ‚Äúuntil tomorrow‚Äù (by the way, it turned out later). <br><br>  As a result, I decided to start trying right away from my ‚Äúconditional race‚Äù.  Suppose that the token is written to the int-th database (of the unixtime type, i.e., an integer), because they assume that the next token will be issued only after 3 minutes (although it is usually still with some kind of offset, so that at the border, its validity has expired).  Those.  I think we have something like: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> user_order (usrid <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, token <span class="hljs-built_in"><span class="hljs-built_in">bigint</span></span>, lasttoken <span class="hljs-built_in"><span class="hljs-built_in">bigint</span></span>, lastorder datetime, ...)</code> </pre> <br>  Here is a bit of technology: I do not like things like Greasemonkey and to, although sometimes I use it.  But I do not like (there is little such as Yegor).  A lot can be done from the dev console of firefox, but in trifles.  I also quite rarely ‚Äúwork‚Äù.  I have my own (well, almost) plugin that expands the ‚Äúfull-fledged‚Äù tickle interpreter (tcl) from api to javascript of the current window.  Type greasemonkey, only on the tickle.  Conveniently creepy. <br><br>  In general, the tickle-jail script for ‚Äúhacking‚Äù looked like this: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> tok [js form.ordertoken.value] <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> i 0 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> cntr 0 time { <span class="hljs-comment"><span class="hljs-comment">##     -    : elm duplicate -overwrite form[expr $i % 5] form ##   "float"      (0-4) ... js { var f = form[expr $i % 5]; f.target = '_tmp_win_[expr $i % 5]'; f.ordertoken.value = f.ordertoken.value + '.' + '[format %05d [incr cntr]]'; f.submit(); } ##  ,    ... update; after 5 incr i } 10</span></span></code> </pre><br>  Those.  for each new dubbed form, we make the value of the ordertoken as a floating point number. <br>  We have the following in javascript: <br><br><pre> <code class="javascript hljs"> ... var f = form0; f.target = <span class="hljs-string"><span class="hljs-string">'_tmp_win_0'</span></span>; f.ordertoken.value = f.ordertoken.value + <span class="hljs-string"><span class="hljs-string">'.'</span></span> + <span class="hljs-string"><span class="hljs-string">'00001'</span></span>; f.submit(); ... var f = form1; f.target = <span class="hljs-string"><span class="hljs-string">'_tmp_win_1'</span></span>; f.ordertoken.value = f.ordertoken.value + <span class="hljs-string"><span class="hljs-string">'.'</span></span> + <span class="hljs-string"><span class="hljs-string">'00002'</span></span>; f.submit(); ...</code> </pre><br>  The quick-witted reader has probably understood what is going on. <br><br>  The following SQL-statement will be legally executed if we have autoconversion and the float is cut to (big) int without an overflow error, and the condition is positive (since the comparison will be made in float): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> user_order <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> lasttoken = <span class="hljs-number"><span class="hljs-number">1432254060.00007</span></span>, lastorder = <span class="hljs-keyword"><span class="hljs-keyword">now</span></span>(), vmoney = vmoney + <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> lasttoken != <span class="hljs-number"><span class="hljs-number">1432254060.00007</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> ...</code> </pre><br>  What did they check there, affected rows or just if begin ... end in a transaction, and whether it is SQL at all, I don‚Äôt know, but once again running the script, I‚Äôve become a ‚Äúvirtual‚Äù millionaire!  Well, that is, <code>time casino-virt-order 50000</code> . <br><div class="spoiler">  <b class="spoiler_title">Explanation under the spoiler</b> <div class="spoiler_text">  Roughly speaking, <i>an</i> integer T1 is saved somewhere (like int or bigint), for example, 180. <br>  And then it is compared with the number T2, which is transmitted from the outside and is changed by us to <i>a floating point number</i> (say float) 180.01. <br>  If the comparison of T1 with T2 occurs <i>integer</i> (in int), they are equal, if like a float (which happens if you do not keep track of some algorithms or systems or do not explicitly indicate), then they are different! <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(<span class="hljs-number"><span class="hljs-number">180</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(<span class="hljs-number"><span class="hljs-number">180.01</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(<span class="hljs-number"><span class="hljs-number">180</span></span>) != <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(<span class="hljs-number"><span class="hljs-number">180.01</span></span>)</code> </pre>  After comparison, the T2 token is legal, and, just as important, the T2 token has not yet been used - the balance of money increases (payment takes place), and T2 rewrites T1 (the token is used), while it is truncated to whole if there is no precision overflow.  those.  180 again. And the standard flight is all over and over again.  Until the token becomes obsolete, well, or until time passes ... <br>  The constant increase in the float-token (as in my script), allows you to ‚Äúprevent‚Äù a situation where the token is still not stored integerly, but checking it in the token‚Äôs ‚Äúlegality‚Äù formula is performed integrally but checking ‚Äútoken used‚Äù for any reason like float. <br></div></div><br>  How long do you think the site went on with the real payment ?!  Day (and that is because already very much wanted to). <br>  There, of course, there was no <code>time casino-real-order 50000</code> , and I think that they would have noticed it once or twice.  Well, some kind of monitoring of funds (cheating, etc.) should still be.  Albeit with ten thousand customers.  But 50‚Äì20 I did it once (i.e. by paying ‚Äúonly‚Äù 20 ever-growing ones, because at that time it was the lowest possible payment). <br><br>  In fairness, I must say that I naturally closed this account without withdrawing funds, returning only my invested money. <br><br><h3>  Morality </h3><br>  There seems to be nothing to discuss.  The only thing I can add is that the clean race condition did not work there, I checked (the second parallel call issued ‚Äúalready used‚Äù).  But judging by the "professionalism" of the guys - it was more like fool protection (like F5 after requisition, etc.). <br><br>  Another interesting moment, when the token became outdated (+ 180), it did not work anymore because of the verification of the date of the last ‚Äúpayment‚Äù of the type <code>lastorder &lt; now() + '1 day'</code> .  But for some reason, not with the "same" token.  I think that the sore one was not. <br>  Although it should be added that the token was completely honestly marked as used (i.e., a transaction with a table lock or isolation level of the serializable type).  The new token itself cannot be generated either (probably it should be in their database for an account).  Or maybe just issuing a new token depended on the <code>lastorder</code> . <br><br>  And yes, the captcha was apparently bound in the same way to the token + something else in the form.  Or ‚Äúrace‚Äù worked for her, I had no need to search for it. <br><br>  By the way, everything else, from SQL-Injection to various tricks with exploits known to me on that platform, looked pretty solid, but somehow it was still semi-professional or something, i.e. there was nothing to complain about (some things aren‚Äôt already years dtsat how). <br><br>  Yes, one more thing: this is a casino, i.e.  a person not constrained by means has any advantage over his rivals, all other things being equal.  At the very least can afford to risk more.  In general, if I played there, I could have ‚Äúalmost‚Äù legally won a lot of money from other clients of this casino, ‚Äúdeceiving‚Äù the company itself for a much smaller amount.  Plus, at least the interests of the clients of this platform <s>for selecting funds from the public</s> would be affected.  I do not think that the casino did not understand this when they tried to deal with me. <br><br><h3>  "Showdown" with me - a villainous hacker </h3><br>  I don't even want to tell. <br><br>  I, as usual, at first laid out to them only the results of the "exploit" - i.e.  Here is the account, it has a virtual milen of money.  The account was created the day before yesterday, well, and a hint - they say I‚Äôll tell you how it is after donation.  About breaking with real money, I first kept silent at all (another account is another donate).  I am not poor, but any work must be paid.  Naturally "repented", i.e.  ‚ÄúPurely from sporting interest‚Äù and ‚Äúof course never (give a tooth) will not apply.‚Äù <br><br>  Result: <br><ul><li>  a real attempt to make of me a malicious opener of casinos; </li><li>  after a while, there are already ‚Äúrequests‚Äù to say ‚Äúhow‚Äù (i.e., about a miracle, they didn‚Äôt even find accesslog!)  Requests alternate with threats (to <i>immediately provide everything, and we will think about what to do with you</i> ). </li><li>  after a completely frank hint "work must be paid for," an attempt to make me a blackmailer (I already thought of connecting a lawyer's friend); </li><li>  as a result, he politely sent them away, again pledging not to use to the detriment and ignoring in the future all attempts at blunt ‚Äúpressure‚Äù. </li></ul><br>  What is funny, after the account was closed, already with real money (previously only their 20 euros were withdrawn) for some time still received letters from them, they say, ‚Äútake the money‚Äù ... I wanted to answer them first - spend on charity, but they are not mine .  So they are probably there ... <br><br>  People, do not save all the same on the pros.  We, the pros, are worth the money that we pay. <br><br>  [UPD # 1] Here the moralists came along, like, ‚ÄúThey didn‚Äôt ask you to check their site.  Let me do something good to you too, and ask for money ‚Äùor is it‚Äú Extortion, ‚Äùetc. <br>  I will answer immediately to all who wish to postebatsya for my conscience: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><ul><li>  then let me not give you money (yes I have rights), but at the same time I will say - ‚Äúthis is something good, <i>definitely</i> leave it anyway, <i>without money,</i> and I <i>will sue</i> you <i>in court</i> anyway‚Äù. </li><li>  my personal attitude to the ‚Äúclient‚Äù will depend on him, at least on the tone, how it will be said. </li><li>  I spent a lot of time writing a post, and I don‚Äôt have the slightest desire to listen to the nagging of another troll about my moral qualities, for which only people who really know me can speak. </li><li>  Sites <s>such as "about cats" of</s> social projects or from the opera "open-source" are always served out of turn, with a completely different attitude and absolutely free. <br>  But not people who earn money, while saving them on their customers and their safety.  Especially if they threaten me or are rude. </li><li>  Receiving is my hobby, let me implement it, independently assessing the moral aspects of the issue.  I do not earn on it and even usually do not earn extra money.  I myself consider myself a law-abiding citizen, and I will remain so, the opinion of the trolls on this side of the issue does not affect this in any way. </li></ul></div></div>  Since  I can‚Äôt ban in my post on Habr√©, I‚Äôll just ask for it humanly: please leave me your opinion on my moral qualities.  You will save both your and my time. <br>  The desire to share with people "knowledge" and the time spent on the post while overpowering the desire to remove the hell out of this post in the drafts, but the balance is clearly broken. <br>  Constructive and opinions on the topic of the article, i.e.  I will listen to the discussion of the technical side of the question with great pleasure (and there will be free time and I will answer). </div><p>Source: <a href="https://habr.com/ru/post/258513/">https://habr.com/ru/post/258513/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../258501/index.html">Free functional test webinar from TestCafe</a></li>
<li><a href="../258503/index.html">Useful Wordpress plugins. OptionTree - site settings page</a></li>
<li><a href="../258505/index.html">Branch model and git module management for a large project</a></li>
<li><a href="../258507/index.html">Transistor amplifier class A do it yourself</a></li>
<li><a href="../258509/index.html">‚ÄúWhispering‚Äù neighbor through chanspy [FreePBX]</a></li>
<li><a href="../258515/index.html">How I wrote a simple application for Android / iOS</a></li>
<li><a href="../258519/index.html">A new way of fraud has appeared: domain pseudo-registrars</a></li>
<li><a href="../258527/index.html">Building and Installing MongoDB from Source</a></li>
<li><a href="../258529/index.html">Semat? Nice to meet you</a></li>
<li><a href="../258531/index.html">RU-CENTER brazenly lies when organizing the registration of "VIP" domains in the "zone" RU.NET</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>