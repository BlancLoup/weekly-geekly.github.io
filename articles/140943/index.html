<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Search for inaccurate matches, search for input errors</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 

 Our company has its own CRM and periodically data about certain organizations with an exact address are added to this system, and the main...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Search for inaccurate matches, search for input errors</h1><div class="post__text post__text-html js-mediator-article"><h4>  Foreword </h4><br><br>  Our company has its own CRM and periodically data about certain organizations with an exact address are added to this system, and the main thing is that these addresses are essentially unique, that is, there should not be several organizations in the system at the same address (specificity, in fact, but controlled by chelfak *).  Recently, KLADR was bolted into the system, but it could not be a panacea, because  KLADR has a lot of inaccuracies, many of us.  items were left without house numbers, etc.  etc., although these addresses are in reality (data are provided by company employees and they are reliable).  In general, the input address left in free form with a hint from KLADr.  At once I want to say that we refused the combination of fields, since  the variety of abbreviations of abbreviations did not promise anything good, moreover, an address on the similarity was quite permissive (‚ÄúOloloshskoe sh. 5km‚Äù, ‚ÄúShopping center Veselchak U‚Äù or even ‚ÄúCentral Market‚Äù).  And finally, the main enemy of the programmer is chelfuck, which implies illiteracy and typos to a sticky keyboard and typos.  The rest is under the cut ... <br><a name="habracut"></a><br><br><h4>  What we have </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We have on the one hand: the database filled with certain addresses in one field with another hurrying to report to the employee system with all the consequences.  I wanted to secure data from duplicates as much as possible and it was decided to display a warning to the user about possible duplication of the record. <br><br><h4>  Solution to the problem </h4><br><br>  I tried to comment on the algorithm as accurately as possible, so I‚Äôll manage with a brief description. <br><br><ul><li>  Take the source code and remove the "extra" </li><li>  We break the words in the address into the so-called syllables </li><li>  We do the same with the input data. </li><li>  We check the coincidence of syllables in percent </li><li>  We make an additional check on the numbers in the address to discard, because  even a mistakenly printed street, but with a different house number or building, should no longer be considered a duplicate </li><li>  Verdict after comparison </li><li>  We give similar matches if found </li><li>  We take from the shelf pie </li></ul><br><br><h4>  How does it work </h4><br><br>  Next, just the code: <br><br><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearAddr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($addr)</span></span></span><span class="hljs-function"> </span></span>{ $associate = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">" "</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-comment"><span class="hljs-comment">//    "." =&gt; "", "." =&gt; "", "." =&gt; "", "." =&gt; "", "." =&gt; "", "." =&gt; "", "." =&gt; "", "." =&gt; "", "-." =&gt; "", "-" =&gt; "", "-." =&gt; "", "-" =&gt; "", "-." =&gt; "", "-" =&gt; "", "." =&gt; "", "" =&gt; "", ".-" =&gt; "", "." =&gt; "", "" =&gt; "", "." =&gt; "", "." =&gt; "", "." =&gt; "", "." =&gt; "", "." =&gt; "", "-." =&gt; "", "-" =&gt; "", "-" =&gt; "", "-." =&gt; "", "1-" =&gt; "", "2-" =&gt; "", "3-" =&gt; "", "4-" =&gt; "", "5-" =&gt; "", "6-" =&gt; "", "7-" =&gt; "", "8-" =&gt; "", "9-" =&gt; "", "1-" =&gt; "", "2-" =&gt; "", "3-" =&gt; "", "4-" =&gt; "", "5-" =&gt; "", "6-" =&gt; "", "7-" =&gt; "", "8-" =&gt; "", "9-" =&gt; "" ); $clrd_addr = strtolower(strtr($addr, $associate)); return $clrd_addr; } function getNums($search) { preg_match_all("/[0-9]*/", $search, $matches); $matches = array_diff($matches[0], array("")); //     $matches return $matches; } function getMatchAdress($addr_string, &amp;$Addr_array) { if(!isset($addr_string) || strlen($addr_string) &lt; 1) return false; $list = array(); $nums = getNums($addr_string); //       $addr_string = clearAddr(preg_replace("/[0-9]*/", "", $addr_string)); //     $word_parts = explode("\n", chunk_split(trim($addr_string), 2)); //       2  array_pop($word_parts); //     foreach($Addr_array as $row) { $word_match = 0; $last_pos = 0; //    $clr_row = clearAddr($row); $row_nums = getNums($row); //   ..    foreach($word_parts as $syllable) { $match_in = strpos($clr_row, strtolower(trim($syllable)), $last_pos); //  -   //        if($match_in &gt; -1 &amp;&amp; $match_in &lt; $last_pos + 4) { $last_pos = $match_in + strlen(trim($syllable)); $word_match++; } } $all_percents = count($word_parts); //      $found_percents = $word_match; //    $match_perc = round($found_percents * 100 / $all_percents); //    $max_point = 70; //    //         if($match_perc &gt;= $max_point) { if(!empty($nums)) { //      foreach($nums as $num) { if(in_array($num, $row_nums)) $list[] = $row; } } else { //    $list[] = $row; } } } return $list; }</span></span></code> </pre> <br><br><h4>  What it looks like </h4><br><br>  What is in the database: <br><br> <code>. , .40 <br> . , .14 <br> 4-  ., .1 <br> . , .15 <br>  ., .6 <br> . ., .48 <br> ... <br> ... <br> ... <br> . , .31/22 <br> . , .23, . 41 <br> . -, .11 <br> - , .39, .1 <br> 4-  ., .4 <br>  , .2 <br></code> <br><br>  We give at the entrance: Doryninsiy <br><br>  At the exit with us: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [<span class="hljs-number"><span class="hljs-number">0</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>-  ., <span class="hljs-number"><span class="hljs-number">.1</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>-  ., <span class="hljs-number"><span class="hljs-number">.4</span></span> )</code> </pre><br><br>  If the search query was Doryninsy d.1, then we would see only the zero key. <br><br>  PROFIT!, Thanks for standing. </div><p>Source: <a href="https://habr.com/ru/post/140943/">https://habr.com/ru/post/140943/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140938/index.html">How I got the key to Diablo III Beta</a></li>
<li><a href="../140939/index.html">The answer to Python vs Ruby</a></li>
<li><a href="../140940/index.html">Multi-threaded file upload in S3</a></li>
<li><a href="../140941/index.html">Wifi on the ring line of the Moscow metro - rapid test</a></li>
<li><a href="../140942/index.html">XBOX 360 xk3y. Part 1 - Overview, features and equipment</a></li>
<li><a href="../140944/index.html">Automate the social activity of your Internet startup using ifttt.com</a></li>
<li><a href="../140945/index.html">Feedback on your site in a new way. Now also free</a></li>
<li><a href="../140946/index.html">Review of the Asus Zenbook UX31E Ultrabook</a></li>
<li><a href="../140949/index.html">New Evernote website for developers</a></li>
<li><a href="../140950/index.html">We released diafan.CMS 5.0</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>