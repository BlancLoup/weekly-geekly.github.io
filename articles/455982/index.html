<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>It's time to replace GIF with AV1 video</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It is now the year 2019, and it‚Äôs time for us to make a decision on the GIF GIFs take up a huge amount of space (usually several megabytes in size!) W...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>It's time to replace GIF with AV1 video</h1><div class="post__text post__text-html js-mediator-article"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/65b/a48/3fe/65ba483fe7d3bf590fffc3353d4f874a.gif"></div><br><p>  It is now the year 2019, and it‚Äôs time for us to make a decision on the GIF  GIFs take up a huge amount of space (usually several megabytes in size!) Which, if you are a web developer, completely contradicts your desires!  As a web developer, you want to minimize the things that users need to download in order for the site to load quickly.  For the same reason, you minimize JavaScript, optimize PNG, JPEG, and sometimes convert <a href="https://developers.google.com/speed/webp/">JPEG to WebP</a> .  But what to do with the old man GIF? </p><a name="habracut"></a><br><h2>  Where we go, we will not need GIFs! </h2><br><p>  If your goal is to improve the download speed of the site, then you need to get rid of GIF!  But how then do animated pictures?  The answer is video.  And in most cases, you will get better quality and space savings of 50-90%!  In life, most things have their pros and cons.  When you replace the GIF with video, you will most often not find the minuses. </p><br><h2>  Down with all gifs! </h2><br><p>  Fortunately, replacing the GIF with video has been commonplace in recent years, so all the necessary tools are already running.  In this post, I will not reinvent the wheel, but only slightly improve the existing solutions.  So, here's the gist: </p><br><ol><li>  Take a GIF and convert it to video </li><li>  Encode video using H.264 or VP9, ‚Äã‚Äãi.e.  compress it and pack it into an MP4 or WebM container </li><li> Replace <code>&lt;img&gt;</code> with animated GIF with <code>&lt;video&gt;</code> with movie </li><li>  Turn on silent autoplay and loop to achieve the GIF effect. </li></ol><br><p>  <a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/replace-animated-gifs-with-video/">Google has good documentation describing the process.</a> </p><br><h2>  It is now 2019 </h2><br><p>  It's 2019 now.  Progress is moving forward, and we must keep up with it.  So far, we have had two codec options, which are widely supported in all browsers and video encoding tools: </p><br><ol><li>  <strong>H.264</strong> - Introduced in 2003 and most widely used today. </li><li>  <strong>VP9</strong> - appeared in 2013 and achieved an improvement in compression by almost 50% compared to H.264, although <a href="https://www.reddit.com/r/AV1/comments/bjzqly/its_time_to_replace_gifs_with_av1_video/emcohnq/">as they say here,</a> not everything and not always so rosy </li></ol><br><p>  <strong>Note:</strong> Although the H.265 standard is the next version of H.264 and is able to compete with VP9, ‚Äã‚ÄãI do not consider it due to weak browser support, as shown at <a href="https://caniuse.com/">https://caniuse.com/#feat=hevc</a> .  Licensing costs are the main reason why H.265 did not become as common as H.264 and for which the Alliance of Open Media consortium works with a codec without deductions - from AV1. </p><br><p>  Remember that our goal is to reduce huge GIFs to the smallest possible size in order to speed up the download.  It would have been a strange year in 2019 if we didn‚Äôt have a new standard for video compression in our arsenal.  But it is called AV1.  With AV1, you can <a href="http://compression.ru//video/codec_comparison/hevc_2017/MSU_HEVC_comparison_2017_P5_HQ_encoders.pdf">achieve an approximately 30% improvement in compression over VP9</a> .  Lepote!  :) </p><br><h2>  AV1 at your service since 2019! </h2><br><h4>  On desktops </h4><br><p>  Recently, support for decoding AV1 video has been added to desktop versions of <a href="https://developers.google.com/web/updates/2018/09/chrome-70-media-updates">Google Chrome 70</a> and <a href="https://medium.com/mozilla-tech/mozilla-celebrates-release-of-free-high-quality-video-compression-technology-av1-in-firefox-65-7c95f2b7e56">Mozilla Firefox 65</a> .  Right now, support in Firefox is buggy and can cause disruptions, but things should change with the addition of the <a href="https://bugzilla.mozilla.org/show_bug.cgi%3Fid%3D1533742">decoder dav1d</a> already in Firefox 67 <i>( <a href="https://habr.com/ru/company/Voximplant/blog/456072/">already out, and support has appeared</a> - note transl.)</i> .  For details about the new version read - <a href="http://www.jbkempf.com//blog/post/2019/dav1d-0.3-release%253A-even-faster!">dav1d 0.3.0 release: even faster!</a> </p><br><h4>  On smartphones </h4><br><p>  For smartphones, hardware support is currently lacking due to the lack of appropriate decoders.  You can do software decoding, although this will lead to an increase in battery consumption.  The first mobile SOC with support for hardware decoding AV1 will appear in 2020. </p><br><h4>  And then the readers of the article are ‚Äúso if the mobiles do not support normally, then why use AV1?‚Äù </h4><br><p>  AV1 is a fairly new codec, and we are at the very beginning of its adaptation.  Think of this article as a stage ‚Äúas long as you are cooking, people are catching up.‚Äù  Support on desktops in itself will already speed up websites for a part of the audience.  And the old codecs can be used as a fallback script when AV1 is not supported on the target device.  But as users move to devices with AV1 support, everything will be ready.  To achieve this, we need to create a video tag, as shown below, which will allow the browser to choose the preferred format - <strong>AV1</strong> - &gt;&gt; <strong>VP9</strong> - &gt;&gt; <strong>H.264</strong> .  Well, if the user has a completely old device or a navigator that does not support video at all <em>(which is unlikely to steal from H264)</em> , then he will simply see the GIF </p><br><pre> <code class="plaintext hljs">&lt;video style="display:block; margin: 0 auto;" autoplay loop muted playsinline poster="RollingCredits.jpg"&gt; &lt;source src="media/RollingCredits.av1.mp4" type="video/mp4"&gt; &lt;source src="media/RollingCredits.vp9.webm" type="video/webm"&gt; &lt;source src="media/RollingCredits.x264.mp4" type="video/mp4"&gt; &lt;img src="media/RollingCredits.gif"&gt; &lt;/video&gt;</code> </pre> <br><h2>  Create AV1 </h2><br><p>  Create a video in AV1 is easy.  <a href="https://ffmpeg.org/download.html">Download the latest ffmpeg build for your system from here</a> and use the commands below.  We use 2 passes to reach the target bitrate.  For this, we will run ffmpeg twice.  The first time we write the result in a non-existent file.  This will create the log that is needed for the second run of ffmpeg. </p><br><pre> <code class="plaintext hljs"># Linux or Mac ##  1 ffmpeg -i input.mp4 -c:v libaom-av1 -b:v 200k -filter:v scale=720:-1 -strict experimental -cpu-used 1 -tile-columns 2 -row-mt 1 -threads 8 -pass 1 -f mp4 /dev/null &amp;&amp; \ ##  2 ffmpeg -i input.mp4 -pix_fmt yuv420p -movflags faststart -c:v libaom-av1 -b:v 200k -filter:v scale=720:-1 -strict experimental -cpu-used 1 -tile-columns 2 -row-mt 1 -threads 8 -pass 2 output.mp4 # Windows ##  1 ffmpeg.exe -i input.mp4 -c:v libaom-av1 -b:v 200k -filter:v scale=720:-1 -strict experimental -cpu-used 1 -tile-columns 2 -row-mt 1 -threads 8 -pass 1 -f mp4 NUL &amp;&amp; ^ ##  2 ffmpeg.exe -i input.mp4 -pix_fmt yuv420p -movflags faststart -c:v libaom-av1 -b:v 200k -filter:v scale=720:-1 -strict experimental -cpu-used 1 -tile-columns 2 -row-mt 1 -threads 8 -pass 2 output.mp4</code> </pre> <br><p>  Here is the decoding of the parameters: </p><br><pre> <code class="plaintext hljs">-i -  . -pix_fmt -   4:2:0       .     ,  4:2:0  . -c:v -   ,    - AV1.&lt;br /&gt; -b:v ‚Äì  ,    . -filter:v scale -   ffmpeg     .   X:-1   ffmpeg    X,   . -strict experimental -  , .. AV1   . -cpu-used -   ,          .   0-4.   ,    , ,  ,   . -tile-columns -    .  AV1     ,         . -row-mt ‚Äì ,    ,        . -threads -  . -pass -    . -f -     .    , .. MP4   . -movflags faststart -    ,      .         .</code> </pre><br><h2>  Creating a GIF </h2><br><p>  To create a GIF, I used the command below.  To reduce the size, I scaled the GIF to 720px in width and 12 fps instead of the original 24 fps video. </p><br><pre> <code class="plaintext hljs">./ffmpeg -i /mnt/c/Users/kasing/Desktop/ToS.mov -ss 00:08:08 -t 12 -filter_complex "[0:v] fps=12,scale=720:-1" -y scene2.gif</code> </pre> <br><h2>  Test results </h2><br><p>  Better to see once than read a hundred times, right?  Let's make sure AV1 is the right choice for our purposes.  I took the free Tears Of Steel video, available here <a href="https://mango.blender.org/">https://mango.blender.org/</a> , and converted it using about the same bit rate for AV1, VP9, ‚Äã‚ÄãH.264 codecs.  The results are below, so you can compare them yourself. </p><br><p>  <strong>Note 1:</strong> If the file below does not load, it may be time for you to upgrade your browser.  I would recommend Chromium-based browser, for example, Chrome, Vivaldi, Brave or Opera.  Here is the latest information on AV1 support <a href="https://caniuse.com/">https://caniuse.com/#feat=av1</a> </p><br><p>  <strong>Note 2:</strong> For Firefox 66 in Linux, you will need to set the <code>media.av1.enabled</code> flag to <code>true</code> in <code>about:config</code> </p><br><p>  <strong>Note 3:</strong> I decided not to include the usual GIFs below because of their large size and the amount of data that might be required to load this page!  (What would be ironic, because this page is about reducing the amount of data on the page :)).  But you can see the final GIFs here <a href="https://github.com/singhkays/its-time-replace-gifs-with-av1-video/blob/master/GIFs">https://github.com/singhkays/its-time-replace-gifs-with-av1-video/blob/master/GIFs</a> </p><br><p>  <strong>Translator's note:</strong> Habr does not allow you to enable autoplay and loop the file, so only the quality will be evaluated.  You can see how live animated images will look like in the <a href="https://www.singhkays.com/blog/its-time-replace-gifs-with-av1-video/">original article</a> . </p><br><h3>  Scene 1 @ 200 Kbps </h3><br><p>  There is a lot of movement, which is especially sensitive at low bitrates.  Immediately you can see how bad H.264 on this bitrate squares are immediately visible.  VP9 improves the situation a bit, but the squares are still visible.  AV1 clearly wins, delivering an apparently better picture. </p><br><br><h4>  H.264 </h4><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Your browser does not support HTML5 video. <source src="https://www.singhkays.com/blog/its-time-replace-gifs-with-av1-video/media/scene1/x264_200k.mp4" type="video/mp4"></video></div></div></div><br><h4>  VP9 </h4><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Your browser does not support HTML5 video. <source src="https://www.singhkays.com/blog/its-time-replace-gifs-with-av1-video/media/scene1/vp9_200k.mp4" type="video/mp4"></video></div></div></div><br><h4>  AV1 </h4><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Your browser does not support HTML5 video. <source src="https://www.singhkays.com/blog/its-time-replace-gifs-with-av1-video/media/scene1/av1_200k.mp4" type="video/mp4"></video></div></div></div><br><h3>  Scene 2 @ 200 Kbps </h3><br><p>  There are a lot of translucent CGI content.  The results do not differ as much as last time, but in general AV1 looks better. </p><br><br><h4>  H.264 </h4><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Your browser does not support HTML5 video. <source src="https://www.singhkays.com/blog/its-time-replace-gifs-with-av1-video/media/scene2/x264_200k.mp4" type="video/mp4"></video></div></div></div><br><h4>  VP9 </h4><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Your browser does not support HTML5 video. <source src="https://www.singhkays.com/blog/its-time-replace-gifs-with-av1-video/media/scene2/vp9_200k.mp4" type="video/mp4"></video></div></div></div><br><h4>  AV1 </h4><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Your browser does not support HTML5 video. <source src="https://www.singhkays.com/blog/its-time-replace-gifs-with-av1-video/media/scene2/av1_200k.mp4" type="video/mp4"></video></div></div></div><br><h3>  Scene 3 @ 100 Kbps </h3><br><p>  In this scene, we twist the bitrate down to 100 Kbps and the results are consistent.  AV1 keeps leadership at low bitrates! </p>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  H.264 </h4><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Your browser does not support HTML5 video. <source src="https://www.singhkays.com/blog/its-time-replace-gifs-with-av1-video/media/scene3/x264_100k.mp4" type="video/mp4"></video></div></div></div><br><h4>  VP9 </h4><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Your browser does not support HTML5 video. <source src="https://www.singhkays.com/blog/its-time-replace-gifs-with-av1-video/media/scene3/vp9_100k.mp4" type="video/mp4"></video></div></div></div><br><h4>  AV1 </h4><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Your browser does not support HTML5 video. <source src="https://www.singhkays.com/blog/its-time-replace-gifs-with-av1-video/media/scene3/av1_100k.mp4" type="video/mp4"></video></div></div></div><br><h2>  Cherry on the cake </h2><br><p>  To finish the article, having felt the amount of saved traffic compared to GIF - the total size of all videos is higher ... <strong>1.62 MB !!</strong>  Right.  Some fucking 1,708,032 bytes!  For comparison, here is the size of the video GIF and AV1 for each of the scenes. </p><br><div class="scrollable-table"><table><tbody><tr><th></th><th>  Gif </th><th>  AV1 </th></tr><tr><td>  Scene 1 </td><td>  11.7 MB </td><td>  0.33 MB </td></tr><tr><td>  Scene 2 </td><td>  7.27 MB </td><td>  0.18 MB </td></tr><tr><td>  Scene 3 </td><td>  5.62 MB </td><td>  0.088 MB </td></tr></tbody></table></div><br><p>  <strong>Just amazing!</strong>  <strong>Is not it?</strong> </p><br><p>  <strong>Note:</strong> The sizes of the VP9 and H264 files are not given, since they practically do not differ from AV1 due to the use of the same bit rate.  It would be redundant to add two more columns with the same size, only to emphasize that these codecs provide much better quality than GIF with much smaller file sizes. </p></div><p>Source: <a href="https://habr.com/ru/post/455982/">https://habr.com/ru/post/455982/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../455970/index.html">Everything you wanted to know about SwiftUI, but were afraid to ask</a></li>
<li><a href="../455972/index.html">Slurm: the caterpillar turned into a butterfly</a></li>
<li><a href="../455976/index.html">Cabinets, modules or units - what to choose for power management in the data center?</a></li>
<li><a href="../455978/index.html">Lambda: from C ++ 11 to C ++ 20. Part 2</a></li>
<li><a href="../455980/index.html">iOS Digest number 7 (May 31 - June 13)</a></li>
<li><a href="../455986/index.html">Why should an IT person take out the brain?</a></li>
<li><a href="../455990/index.html">KTT in server solutions - what does it look like?</a></li>
<li><a href="../455994/index.html">The evolution of the most popular tool of any developer</a></li>
<li><a href="../455996/index.html">Digital transformation of advertising in online retail. In the footsteps of "Video Analytics in Retail"</a></li>
<li><a href="../456/index.html">The second round - myself</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>