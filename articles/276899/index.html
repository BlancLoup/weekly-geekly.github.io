<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ryo CDR: another asterisk CDR viewer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For an asterisk, probably, only the lazy one did not write the cdr viewer. There are plenty of such solutions: asterisk cdr viewer , agcdr , asterisk ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ryo CDR: another asterisk CDR viewer</h1><div class="post__text post__text-html js-mediator-article">  For an asterisk, probably, only the lazy one did not write the cdr viewer.  There are plenty of such solutions: <a href="https://code.google.com/archive/p/asterisk-cdr-viewer/">asterisk cdr viewer</a> , <a href="https://github.com/stuartford/agcdr">agcdr</a> , <a href="http://prog-it.github.io/Asterisk-CDR-Viewer-Mod/">asterisk cdr viewer mod</a> ( <a href="https://habrahabr.ru/post/212815/">article</a> on Habr√©), <a href="http://www.cdr-stats.org/">cdr-stats</a> and many more that I don‚Äôt know. <br><br>  But the functionality of cool filters, sorting groups was not required, but you just need to view the data on calls for the day, the ability to listen to the recording of the conversation and password protection.  So that the business aunt, sitting in the back seat of the car, while her husband, driving around the evening traffic jams, drove her home, could take a tablet and see the data on the calls of his employees and quickly listen to the recordings of conversations. <br><br>  Not long after searching the githabu, I stumbled upon a <a href="https://github.com/ipoddubny/webcdr">webcdr</a> .  I processed it a bit with a file: I removed the extra, added http basic authorization and got the necessary cdr viewer option.  With familiar aunty web interface in the style of Twitter Bootstrap.  Auntie happy. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/412/803/689/4128036895484d7c8b58f6eea49918df.png" alt="image"><br><br>  Next, some details. <br><br><a name="habracut"></a><br><br>  <strong>Ryo CDR</strong> <br><br>  On our host with Ubuntu 14 there is asterisk 11, the mysql 5.6 database.  Asterisk records conversations, data on calls adds to the database.  We also need the installed node.js, npm, and bower. <br><br>  <strong>Installation</strong> <br><br><pre><code class="bash hljs">wget https://github.com/antirek/ryocdr/archive/v0.0.11.tar.gz tar -xzf v0.0.11.tar.gz <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ryocdr-0.0.11 npm install bower install //   --allow-root,    root npm run build</code> </pre> <br><br>  <strong>Configuration file</strong> <br><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">tz</span></span>:<span class="hljs-string"><span class="hljs-string">"+0400"</span></span>, <span class="hljs-attr"><span class="hljs-attr">port</span></span>: <span class="hljs-number"><span class="hljs-number">9030</span></span>, <span class="hljs-comment"><span class="hljs-comment">//  - Ryo CDR recordspath:"/var/records", //     db: { client: "mysql", connection: { host: "127.0.0.1", user: "user", password: "password", database: "cdr", charset:"utf8" } }, cdr: { table: "cdr" }, auth: true, //  basic   username: 'admin', password: 'password' };</span></span></code> </pre><br><br>  <strong>Launch</strong> <br><br>  Run app.js <br><br><pre> <code class="bash hljs">node app.js</code> </pre><br><br>  Or use the manager pm2 <br><br><pre> <code class="bash hljs">pm2 start app.js  --name <span class="hljs-string"><span class="hljs-string">"ryocdr-app"</span></span></code> </pre><br><br>  Also, the path to the configuration file can be specified via the environment variable RYOCDR_CONFIG, then the application will use the specified config, and not located in the local directory.  This, for example, is convenient when you use the Ryo CDR in a docker container. <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> RYOCDR=/etc/ryocdr/config</code> </pre><br><br>  <strong>Keeping paths to the database records</strong> <br><br>  The path to the record file is stored in the database field record.  For example, we might have such a dialplan (lua): <br><br><pre> <code class="lua hljs"> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> basePath = <span class="hljs-string"><span class="hljs-string">'/var/records'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-built_in"><span class="hljs-built_in">date</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">os</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">date</span></span>(<span class="hljs-string"><span class="hljs-string">"*t"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> uniqueid = channel.UNIQUEID:get(); <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> fname = <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(<span class="hljs-string"><span class="hljs-string">"%s_%s-%s-%s_%s:%s:%s"</span></span>, uniqueid, <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>.year, <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>.month, <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>.day, <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>.hour, <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">min</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>.sec); <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> WAV = <span class="hljs-string"><span class="hljs-string">"/wav/"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> MP3 = <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(<span class="hljs-string"><span class="hljs-string">"/mp3/%s-%s-%s/"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>.year, <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>.month, <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>.day); <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> recordCommand = <span class="hljs-string"><span class="hljs-string">"/usr/bin/nice -n 19 mkdir -p %s &amp;&amp; /usr/bin/lame -b 16 --silent %s%s.wav %s%s.mp3"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> options = <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(recordCommand, basePath..MP3, basePath..WAV, fname, basePath..MP3, fname); app.mixmonitor(<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(<span class="hljs-string"><span class="hljs-string">"%s%s.wav,b,%s"</span></span>, basePath..WAV, fname, options)); channel[<span class="hljs-string"><span class="hljs-string">"CDR(record)"</span></span>]:set(<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(<span class="hljs-string"><span class="hljs-string">"%s%s.mp3"</span></span>, MP3, fname));</code> </pre><br><br>  Those.  the file is recorded by mixmonitor in wav, converted by the command to mp3, and the path of the converted file in the folder with mp3-shki is saved in the database by the CDR dialplan application. <br><br>  In the Ryo CDR configuration file, you can specify the base location of the conversation records in the recordspath parameter.  And in the database itself, store only the path relative to this base path. <br><br>  <strong>DB structure CDR</strong> <br><br>  The structure of the cdr table is traditional, supplemented by a record field for conversation records ( <a href="">table structure</a> ). <br><br>  <strong>Ryo CDR installation video</strong> <br><br>  Beware, video without boomy about installation, but with music. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Ky_DRTdtqSU%3Ffeature%3Doembed&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh6Y336DECPjZN3rCknYlZU4O0mwg" frameborder="0" allowfullscreen=""></iframe><br><br>  Perhaps someone else will come in handy.  Bugs, suggestions, constructive criticism - please report. <br><br>  <strong>Links</strong> <br>  Ryo CDR: <a href="https://github.com/antirek/ryocdr">https://github.com/antirek/ryocdr</a> <br><br>  PS Special thanks to Ivan for webcdr, I had to adapt a little for my needs. <br><br>  PPS One of the aunt's requests was voice control of listening to the recordings of conversations: ‚ÄúSo this is normal, the next one, to squander, flush, so normal, the next one‚Äù.  WebAudio should try to add. </div><p>Source: <a href="https://habr.com/ru/post/276899/">https://habr.com/ru/post/276899/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../276889/index.html">Trojan Remtasu is a tool for hacking Facebook</a></li>
<li><a href="../276891/index.html">Online course "Introduction to theoretical computer science" by Alexander Hanievich Shen</a></li>
<li><a href="../276893/index.html">Rocker Gestures and other new items in the weekly assembly Vivaldi 1.0.390.3</a></li>
<li><a href="../276895/index.html">Schizoid programming language of self-learning algorithms "Author"</a></li>
<li><a href="../276897/index.html">Remote debugging javascript with VS2015. Part 2</a></li>
<li><a href="../276901/index.html">Daily releases are not so scary</a></li>
<li><a href="../276905/index.html">Go and Protocol Buffers, acceleration</a></li>
<li><a href="../276909/index.html">Microsoft will share information about Windows 10 updates</a></li>
<li><a href="../276913/index.html">Fallback actions in ES6 Promise</a></li>
<li><a href="../276915/index.html">Bypassing the DPI provider on the OpenWrt router using only busybox</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>