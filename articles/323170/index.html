<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I set up new utilities for working with electronic signature in Linux</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Let's talk a little about the means of electronic signature (EP) using domestic GOST-algorithms in Linux. Despite the fact that various tools and inte...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I set up new utilities for working with electronic signature in Linux</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/890/f32/4a1/890f324a10d3481481b3de31ae8f3e0f.jpg"><br><br>  Let's talk a little about the means of electronic signature (EP) using domestic GOST-algorithms in Linux.  Despite the fact that various tools and interfaces for working with ES in Linux are even better developed than in Windows, using them is not so easy. <br><br>  This state of affairs has remained the last few years.  But since the end of 2016, the situation has changed for the better.  Two products appeared at once that allow you to work with an electronic signature according to the GOST standard and encrypt without using the console - these are Rosa Crypto Tool and Trusted eSign.  Both of these cryptographic products use CryptoPro CSP for Linux.  Therefore, before turning to the description of the products themselves, let's talk a bit about CryptoPro CSP. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      CryptoPro CSP for Linux is an ambiguous product.  On the one hand, this is one of the most common and powerful certified tools for working with cryptography in both Windows and Linux.  On the other hand, it is not so easy for an ordinary person to use its interfaces, even in Windows.  And in Linux, only the console interface is available.  I hope that CryptoPro is aware of this situation, and in the future we are waiting for new beautiful and convenient interfaces for both Windows and Linux. <br><br>  To set up we need: <br><br><ul><li>  Favorite Linux distribution.  I used Ubuntu Linux 16.04 LTS and ROSA Fresh GNOME R8; </li><li>  Certified version of CryptoPro CSP 4.0 R2 for Windows, UNIX and macOS; </li><li>  Rutoken EDS 2.0. </li></ul><br><h3>  Setting "CryptoPro" CSP </h3><br>  Despite the fact that there are some quite good articles on setting up CryptoPro CSP under Linux (for example, <a href="https://www.altlinux.org/%25D0%259A%25D1%2580%25D0%25B8%25D0%25BF%25D1%2582%25D0%25BE%25D0%259F%25D1%2580%25D0%25BE">here</a> or <a href="http://estmnenie.com/cryptopro-csp-3-linux-how-to.html">here</a> ), I will describe my version here.  The main reason is that most of the instructions are written for the Crypto Pro CSP version 3.x.  And the modern version of CryptoPro CSP 4.0 is not 100% compatible with 3.x.  An additional reason is always nice to have full instructions for setting up in one place, and not to switch from one window to another. <br><br>  Getting Started. <br><br>  Download CryptoPro CSP for Linux from the official site of CryptoPro - <a href="http://www.cryptopro.ru/downloads">www.cryptopro.ru/downloads</a> <br><br>  Unpacking CryptoPro CSP for Linux: <br><br><pre><code class="bash hljs">tar -zxf ./linux-amd64_deb.tgz</code> </pre> <br>  Next we have 2 options - automatic installation and manual installation.  Automatic installation is started with the command: <br><br><pre> <code class="bash hljs">sudo ./install.sh</code> </pre> <br>  or <br><br><pre> <code class="bash hljs">sudo ./install_gui.sh</code> </pre> <br>  Here we must pay tribute to the developers of "CryptoPro" - automatic installation for most distributions work out successfully.  Although there are nuances.  For example, if you are missing some packages, the installation will be completed successfully, although some functionality will not work. <br><br>  If something went wrong, or for one reason or another you want to use the installation in manual mode, then you need to do: <br><br><pre> <code class="bash hljs">dpkg -i ./cprocsp-curl-64_4.0.0-4_amd64.deb lsb-cprocsp-base_4.0.0-4_all.deb lsb-cprocsp-capilite-64_4.0.0-4_amd64.deb lsb-cprocsp-kc1-64_4.0.0-4_amd64.deb lsb-cprocsp-rdr-64_4.0.0-4_amd64.deb</code> </pre> <br>  To install packages in ROSA, use <b>urpmi</b> , instead of <b>dpkg -i</b> . <br><br>  Install the license for CryptoPro CSP for Linux and check that everything works fine: <br><br><pre> <code class="bash hljs">cpconfig -license -<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> &lt;_&gt; cpconfig -license ‚Äìview</code> </pre> <br>  We should get something like: <br><br><pre> <code class="bash hljs">License validity: XXXXX-XXXXX-XXXXX-XXXXX-XXXXX Expires: 3 month(s) 2 day(s) License <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: Server.</code> </pre> <br><h3>  Setup of work with Rutoken EDS 2.0 </h3><br>  We make a small digression.  To work with electronic signature and encryption, we can not do without key pairs and certificates.  Secure storage of private keys is one of the main security factors.  But mankind has not yet invented more reliable means of storage than a token or a smart card.  I will use Rutoken EDS 2.0, which has a certificate of the FSB and supports the work of both new and old guests. <br><br><img src="https://habrastorage.org/files/182/5c7/633/1825c76335f44e4ea260b4fe7b668f55.jpg"><br><br>  To work with tokens in Linux, there are a lot of different tools and drivers.  To describe all of these tools will need a separate article.  Therefore, I will not describe in detail how it works, and why we need these particular packages. <br><br>  Install packages to work with Rutoken EDS 2.0: <br><br><pre> <code class="bash hljs">apt-get install libpcsclite1 pcscd libccid</code> </pre> <br>  We also need to install CryptoPro CSP packages to support the work with tokens: <br><br><pre> <code class="bash hljs">dpkg -i ./cprocsp-rdr-gui-gtk-64_4.0.0-4_amd64.deb ./cprocsp-rdr-rutoken-64_4.0.0-4_amd64.deb ./cprocsp-rdr-pcsc-64_4.0.0-4_amd64.deb ./lsb-cprocsp-pkcs11-64_4.0.0-4_amd64.deb</code> </pre> <br><br><h3>  We get a test certificate </h3><br>  Before you go directly to the work with the signature, you need to generate a key pair and create an electronic signature certificate.  If you already have Rutoken with the CryptoPro container, then this part can be safely skipped. <br><br>  We use the test center of the CryptoPro company at: <a href="https://www.cryptopro.ru/certsrv/">https://www.cryptopro.ru/certsrv/</a> <br>  Create a certificate request with default settings. <br><br><img src="https://habrastorage.org/files/32c/57b/878/32c57b878a9f41f7910043e8fd74910f.png"><br><br>  Verify that the certificate was received successfully. <br><br>  To make sure that CryptoPro CSP saw the token successfully, we run: <br><br><pre> <code class="bash hljs">list_pcsc</code> </pre> <br>  We should get something like: <br><br><pre> <code class="bash hljs">Aktiv Rutoken ECP 00 00</code> </pre> <br>  Now we check that the certificate on the token is seen successfully: <br><br><pre> <code class="bash hljs">csptest -keyset -enum_cont -verifyc -fq</code> </pre> <br>  We get: <br><br><pre> <code class="bash hljs">CSP (Type:80) v4.0.9014 KC1 Release Ver:4.0.9842 OS:Linux CPU:AMD64 FastCode:READY:AVX. AcquireContext: OK. HCRYPTPROV: 13476867 \\.\Aktiv Rutoken ECP 00 00\822506788-dfcd-54c9-3a5e-e0a82a2d7f0 OK. Total: SYS: 0,020 sec USR: 0,160 sec UTC: 0,870 sec [ErrorCode: 0x00000000]</code> </pre> <br>  We write information about this certificate in the CryptoPro certificate store: <br><br><pre> <code class="bash hljs">csptestf -absorb -cert -pattern <span class="hljs-string"><span class="hljs-string">'rutoken'</span></span> Match: SCARD\rutoken_ecp_351d6671\0A00\62AC OK. Total: SYS: 0,010 sec USR: 0,140 sec UTC: 1,040 sec [ErrorCode: 0x00000000]</code> </pre> <br>  Check that the certificate has been successfully stored in the repository: <br><br><pre> <code class="bash hljs">certmgr -list -cert -store uMy Certmgr 1.0 (c) <span class="hljs-string"><span class="hljs-string">"CryptoPro"</span></span>, 2007-2010. program <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> managing certificates, CRLs and stores ============================================================================= 1------- Issuer : E=support@cryptopro.ru, C=RU, L=Moscow, O=CRYPTO-PRO LLC, CN=CRYPTO-PRO Test Center 2 Subject : CN=Trusted eSign Test Serial : 0x120019F5D4E16D75F520A0299B00000019F5D4 SHA1 Hash : 0x016f443df01187d5500aff311ece5ea199ff863e SubjKeyID : 204e94f63c68595e4c521357cf1d9279bff6f6e5 Signature Algorithm :   34.11/34.10-2001 PublicKey Algorithm :   34.10-2001 (512 bits) Not valid before : 22/02/2017 10:53:16 UTC Not valid after : 22/05/2017 11:03:16 UTC PrivateKey Link : Yes Container : SCARD\rutoken_ecp_351d6671\0A00\62AC Provider Name : Crypto-Pro GOST R 34.10-2012 KC1 CSP Provider Info : ProvType: 80, KeySpec: 1, Flags: 0x0 CA cert URL : http://testca.cryptopro.ru/CertEnroll/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>-ca-2014_CRYPTO-PRO%20Test%20Center%202.crt OCSP URL : http://testca.cryptopro.ru/ocsp/ocsp.srf CDP : http://testca.cryptopro.ru/CertEnroll/CRYPTO-PRO%20Test%20Center%202.crl Extended Key Usage : 1.3.6.1.5.5.7.3.2 ============================================================================= [ErrorCode: 0x00000000]</code> </pre> <br>  This completes the basic setup, and we can begin to sign or encrypt files using various means.  We turn to why this article was conceived. <br><br><h3>  Signed by means of CryptoPro CSP </h3><br>  CryptoPro CSP includes the csptestf utility, which allows you to perform various cryptographic operations.  As I wrote above, this utility has 2 drawbacks: <br><br><ul><li>  Lack of good documentation; </li><li>  No graphical user interface. </li></ul><br>  You can sign with the command: <br><br><pre> <code class="bash hljs">csptestf ‚Äìsfsign ‚Äìsign ‚Äì<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt; &gt; -out &lt; &gt; -my <span class="hljs-string"><span class="hljs-string">'Trusted eSign Test'</span></span> ‚Äìdetached ‚Äìalg GOST94_256</code> </pre> <br>  Here, <br>  my is the parameter in which you need to specify the Common Name part of the certificate for signing; <br>  detached - allows you to create a detached signature; <br>  alg GOST94_256 - sets the hash algorithm that will be used when creating the signature. <br><br>  You can get more detailed information on the possible parameters by running the command: <br><br><pre> <code class="bash hljs">csptestf ‚Äìsfsign</code> </pre> <br>  Such an interface is great for a trained user or to automate script operations. <br><br>  Now let's talk about utilities that make life easier for ordinary users when working with signature and encryption in Linux. <br><br><h3>  Rosa Crypto Tool </h3><br>  As the name suggests, this is a utility for working with electronic signature and encryption for the ROSA Linux distribution.  The utility is currently available in the Rosa Linux and Alt Linux repositories. <br><br>  This utility is developed by one person - Mikhail Voznesensky.  It has a simple, but user-friendly interface.  At the moment, the utility is in active development - since November 2016, I managed to test three versions.  The latest version available at the time of writing is 0.2.2.  Now the utility only supports working with CryptoPro CSP for Linux, however, support for other crypto-providers will be added soon. <br><br>  What's inside?  The utility is written in Python using PyQt4 for a graphical interface. <br><br>  You can install it using the "Program Management" in Rosa Linux. <br><br><img src="https://habrastorage.org/files/f09/e6b/290/f09e6b290228419c91904d3878b55213.png"><br><br>  Insert the token and run the utility. <br><br><img src="https://habrastorage.org/files/c96/20f/732/c9620f732f68433c8beb1e31fb474a3a.png"><br><br>  We see that the token was determined successfully and our certificate was found. <br><br>  The program interface is so simple that it does not make sense to describe and show all its functions in the article.  Let's just sign the file. <br><br>  Select the file and click ‚ÄúSign the file‚Äù.  We get this warning. <br><br><img src="https://habrastorage.org/files/893/1f9/fe4/8931f9fe4de14f5f9d212ae12cdd026c.png"><br><br>  Click "OK" and get information that the file was signed successfully. <br><br><img src="https://habrastorage.org/files/f86/711/801/f86711801fff4631a66707e6814f1cad.png"><br><br>  The main advantage of this utility is that it is completely free, in contrast to our next product. <br><br>  Compared to using CryptoPro CSP from the console: <br><br>  + Much easier to use; <br>  - There are no different signature options. <br><br>  The source code of the program is available in the public repository on ABF: <br>  <a href="https://abf.io/uxteam/rosa-crypto-tool-devel">abf.io/uxteam/rosa-crypto-tool-devel</a> <br>  The version control system used by the SEC IT ROSA is integrated into the build environment and is based on Git.  You can easily use any git client. <br><br>  I hope the developers of other domestic Linux distributions, such as Astra Linux, GosLinux and others, will add rosa-crypto-tool packages to their distributions. <br><br><h3>  Trust eSign </h3><br>  The second product we‚Äôll talk about is Trusted eSign from Digital Technologies.  It is known in the Russian market of information security as a developer of tools for working with signature and encryption for the Windows operating system - "CryptoARM". <br><br>  The main thing is not to confuse this product with Trusted.eSign - web-service for working with the signature of the same company. <br><br>  Finding a product on the websites of Digital Technologies is not easy.  A small description is in the store <a href="http://www.cryptoarm.ru/shop/trusted_esign">http://www.cryptoarm.ru/shop/trusted_esign</a> , the product can also be downloaded in the section ‚ÄúDownload Center‚Äù on the site trusted.ru - <a href="https://trusted.ru/support/downloads/%3Fproduct%3D133">https://trusted.ru/support/downloads/?product= 133</a> <br><br>  Unfortunately, the product is currently available only as a deb package for 64-bit systems.  What is the reason for such a restriction is not clear.  Let's hope that in the near future the company will release the rpm package, as well as versions for 32-bit Linux distributions. <br><br>  We download the deb-package from the official site and install it with the command: <br><br><pre> <code class="bash hljs">dpkg ‚Äìi ./trustedesign-x64.deb</code> </pre> <br>  Launch Trusted eSign. <br><br><img src="https://habrastorage.org/files/f03/421/858/f034218583774c18857d0feb587beeb3.png"><br><br>  It is immediately evident that the development was not without a designer.  No sarcasm.  All actions are done simply and logically, and the appearance pleases the eye.  Unfortunately, most of the tools and programs in the field of information security from Russian developers are developed without the involvement of UX-specialists and designers and make their users suffer and cry with bloody tears.  It seems that other means of information security simply can not be.  ‚ÄúDigital technologies‚Äù refute this.  Payment for beauty and convenience - the need to pay for a license. <br><br>  But back to the signature. <br><br>  Select the section ‚ÄúElectronic Signature‚Äù: <br><br><img src="https://habrastorage.org/files/8da/854/2f3/8da8542f3e9e47388576bd12746dca8f.png"><br><br>  Choose "Certificate for signature": <br><br><img src="https://habrastorage.org/files/969/0c0/358/9690c03586ee424e911fcc842f71cc48.png"><br><br>  Select the files for the signature and click "Sign": <br><br><img src="https://habrastorage.org/files/b92/5f8/567/b925f8567900483da81f3c8872a33861.png"><br><br>  What is under the hood?  I will quote from the site: ‚ÄúThe application is created on a modern Electron engine, the OpenSSL library is used to invoke cryptographic operations.  Compatible with CryptoPro CSP 4.0 and supports all the cryptographic algorithms implemented in it. For those who are not yet aware of Electron, this is a framework for creating desktop applications on the node.js platform. <br><br>  Compare Trusted eSign with Rosa crypto tool: <br><br>  + More convenient and beautiful interface <br>  - Paid license <br><br><h3>  Summary </h3><br>  Summarize.  In late 2016 - early 2017, there has been a good progress in the means of working with electronic signatures for Linux.  Information security begins to turn its face to the user, and every year less and less action is required for such a simple action as signing or encrypting a file using domestic algorithms. <br><br>  I would like to further note this development of domestic products, given the current trend to replace Windows with Linux in state and municipal organizations.  As part of this trend, the use of cryptographic information protection tools for Linux becomes relevant.  Good and convenient products of Russian developers will help government organizations and structures to work normally and meet the requirements for import substitution. <br><br>  Such a development can not but rejoice, especially when it happens under Linux. <br><br><h3>  PS </h3><br>  Surely there are quite a few users, especially Linux users, who believe that console utilities are enough.  As well as information security specialists, who believe that design and convenience are an excess of information security.  But I can not agree with them.  Console utilities are undoubtedly ideal for automation.  But for most users it‚Äôs more convenient to work with graphical interfaces.  Even in Linux. </div><p>Source: <a href="https://habr.com/ru/post/323170/">https://habr.com/ru/post/323170/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323158/index.html">RandLib. Library of probability distributions in C ++ 17</a></li>
<li><a href="../323160/index.html">Why do I need Refresh Token if there is Access Token?</a></li>
<li><a href="../323162/index.html">Virtualization and Cloud Performance Testing</a></li>
<li><a href="../323164/index.html">Modern javascript or how to make your redux module ready for reuse</a></li>
<li><a href="../323168/index.html">How to write your own program for the controller ROBO TX</a></li>
<li><a href="../323172/index.html">Our servers and hacker attack on US Democrats: the continuation of the story</a></li>
<li><a href="../323176/index.html">Deploying multi-user WebRTC broadcasts from a webcam via a server in 3 minutes</a></li>
<li><a href="../323178/index.html">FixPrice Agile or SCRUM via F‚Ä¶ ira</a></li>
<li><a href="../323180/index.html">Internationalization (i18n) in Angular 2</a></li>
<li><a href="../323182/index.html">Copyleft at risk: does Github lose GPL compatibility?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>