<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>VP8, x264 and libtheora codecs comparison</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A month ago, Google discovered the specifications of the VP8 format, which should become the main video format on the web. VP8 is free of patents, unl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>VP8, x264 and libtheora codecs comparison</h1><div class="post__text post__text-html js-mediator-article">  A month ago, Google discovered the specifications of the VP8 format, which should become the main video format on the web.  VP8 is free of patents, unlike H.264, and according to the developers, it must outperform its competitor in quality.  A <a href="http://www.on2.com/image.php%3Fblob_id%3D519">promising schedule</a> has been hanging on the On2 website for a long time.  When the codec appeared in the public domain, I wondered if they had fulfilled the promise. <br><br>  Those comparisons that appeared on the network after the release were rather superficial.  Jason Garrett-Glaser, the developer of x264, is also preparing his subjective comparison of a large number of codecs, where VP8 will also be presented, but he has not yet published it. <br><br><img alt="Picture to attract attention" src="http://i7.fastpic.ru/big/2010/0619/f9/f0b2fec623426f3736e4688b690635f9.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So I undertook to make my own small objective comparison. <br><a name="habracut"></a><br>  I started to make a comparison in the same week that VP8 was released, so all coders are about a month old. <br><br><h1>  Comparison participants </h1><br><h2>  VP8 </h2><br>  The reference coder, version dated May 18, 2010, was assembled in VS2008 in the Release configuration. <br><br><h2>  x264 </h2><br>  A representative of the H.264 family will be the x264 version of r1602 codec.  I think many have already heard about him: it is free, widely available and is one of the most advanced.  Since VP8 is declared as a web-optimized codec, it is reasonable to compare it with the Baseline-profile x264.  But I also measured the data on the x264 High-profile to get the full picture. <br>  The main differences of the baseline profile are the absence of b-frames and arithmetic coding.  VP8 has no B-frames either, but there is arithmetic coding.  More details about H.264 profiles can be found <a title="H.264 Profiles" href="http://en.wikipedia.org/wiki/H.264/MPEG-4_AVC">in Wikipedia</a> . <br><br><h2>  libtheora </h2><br>  It is interesting to see how much we have played with another completely open codec.  So in comparison, a new build of Ogg Theora is involved.  Now there is a development of a new version of the coder, which was called Ptalarbvorm, and a demo appeared on the network.  Build version ptalarbvorm-svn17230.  MediaInfo recognizes it as libtheora 1.1+ 20100314 (Ptalarbvorm). <br><br>  For decoding the results of Theors and x264, I used the AviSynth plugin FFMpegSource2 version 2-2.13.  For decoding, the VP8 is a reference decoder. <br><br><h2>  Codec Presets </h2><br>  All codecs have an I-frame interval of 250. Settings are set for a more flexible rate control.  For x264, the number of reference frames put three, since it is no longer supported by competitors.  VP8 is configured in accordance with the recommendations from the site <a href="http://www.webmproject.org/">webmproject.org</a> . <br><br>  <strong>x264 High Profile:</strong> <br> <code>--keyint 250 --bframes 4 --b-adapt 2 --b-pyramid normal --ref 3 --rc-lookahead 50 --no-psy --partitions all --8x8dct --direct auto --me umh --subme 8 --trellis 2 --no-fast-pskip</code> <br> <br>  <strong>x264 Baseline Profile:</strong> <br> <code>--keyint 250 --bframes 0 --ref 3 --rc-lookahead 50 --no-psy --partitions all --direct auto --me umh --subme 8 --trellis 2 --no-fast-pskip --no-cabac --profile baseline</code> <br> <br>  <strong>VP8:</strong> <br> <code>--good --end-usage=0 --undershoot-pct=100 -p 2 --kf-max-dist=250 --drop-frame=0 --resize-allowed=0 --static-thresh=0 --profile=0 --auto-alt-ref=1 --lag-in-frames=16</code> <br> <br>  <strong>libtheora:</strong> <br> <code>--soft-target --two-pass -k 250 -z 0</code> <br> <br><h1>  Video sequences </h1><br>  For comparison, I took four video sequences, two of them in SD and two in HD. <br><br><h2>  Toys and calendar </h2><br><img src="http://i7.fastpic.ru/big/2010/0619/ad/6940d7cc832e1fc2253f734ebae603ad.jpg"><br>  640x352, 250 frames <br>  Smooth movement, many details and complex textures.  I liked this video in the previous comparison, I decided to use it in this too. <br><br><h2>  Big buck bunny </h2><br><img src="http://i7.fastpic.ru/big/2010/0619/4d/8b1655527439bb2001611395780a4c4d.jpg"><br>  704x480, 926 frames <br>  Fragment of the cartoon Big buck bunny, three-dimensional animation.  I most often met this video on demos of various open codecs and could not pass by =) The source is anamorphic, that is, the proproctions are slightly distorted. <br><br><h2>  Battle </h2><br><img src="http://i7.fastpic.ru/big/2010/0619/9a/56bcde47107779185dc03145022ab29a.jpg"><br>  1280x544, 586 frames <br>  Fragment from movie Terminator.  Very dynamic video, a lot of movement, frequent scene changes. <br><br><h2>  Old town cross </h2><br><img src="http://i7.fastpic.ru/big/2010/0619/49/2c7a7803260890eec59293ca9eea4e49.jpg"><br>  1280x720,500 frames <br>  Video with smooth motion.  A large number of parts, but there is a uniform area (sky).  There is also a small grain. <br><br><h1>  Comparison method </h1><br>  Instead of measuring on one bitrate, like last time, now I decided to make several measurements on different bitrates.  And the data on all measurements can be presented on a single graph as a broken line.  I selected the range of the bitrate for several samples based on the visual quality of the results. <br>  Coding was carried out in two passes with a given bit rate.  Bitrate is naturally variable.  VP8 does not have a quality-based mode, if that. <br>  For quality assessment, I used <a href="http://en.wikipedia.org/wiki/SSIM">the SSIM metric</a> .  As practice shows, it is closer to the results of visual comparison than PSNR.  To measure SSIM used <a href="http://www.compression.ru/video/quality_measure/video_measurement_tool.html">MSU Video Quality Measurement Tool</a> . <br>  By the way, x264 has a parameter - tune ssim, which allows to slightly improve the SSIM, while PSNR.  I did not include this parameter, since I initially wanted to count both metrics.  But he did not, because the amount of work doubles, and the utility is small - the results are usually very similar. <br>  The deviation of the bitrate at this time is taken into account due to the fact that the points on the graph were plotted in accordance with the actual shown bitrate.  On some graphs you may notice that the points are not exactly on the mark. <br><br><h1>  results </h1><br>  VP8 was between two x264 profiles, and Theora was far behind them.  So that you can see the difference in x264 and VP8 results on graphs, Teori had to leave only two or three measurements at the highest bitrates. <br>  I give separate screenshots to the results with separate links, as a bunch of pictures will only litter the article.  Yes, and consider them, switching between tabs, it is still more convenient. <br><br><h2>  Toys and calendar </h2><br><img src="http://i7.fastpic.ru/big/2010/0619/ea/6f0a3809a212008535af35001a0e23ea.png"><br>  Here, the x264 and VP8 results are visually slightly different.  VP8 preserved textures better than x264 Baseline Profile, and x264 High Profile managed it even slightly better.  At Theory's picture is very blurred. <br>  Screenshots: <a href="">Source</a> <a href="">Theora</a> <a href="">VP8</a> <a href="">x264 BP</a> <a href="">x264 HP</a> <br><br><h2>  Big buck bunny </h2><br><img src="http://i7.fastpic.ru/big/2010/0619/4e/1c6c953984abc1136ff4f17435f6824e.png"><br>  Here, visually, the VP8 was not much better than the x264 BP.  They have a different picture on different scenes.  SSIM VP8 was still higher.  x264 HP is noticeably better.  Theor is noticeably worse. <br><br>  An example of a typical situation: <br>  Screenshots: <a href="">Source</a> <a href="">Theora</a> <a href="">VP8</a> <a href="">x264 BP</a> <a href="">x264 HP</a> <br><br>  An example of a scene where VP8 is clearly visible from x264 BP. <br>  Screenshots: <a href="">Source</a> <a href="">Theora</a> <a href="">VP8</a> <a href="">x264 BP</a> <a href="">x264 HP</a> <br><br>  VP8 also has problems with video bitrate distribution (albeit two pass encoding).  For example, the scene itself is static, only the rabbit moved, for which it was very badly hurt.  Here even Theora looks better.  Such things are found as an exception, but they do. <br>  Screenshots: <a href="">Source</a> <a href="">Theora</a> <a href="">VP8</a> <a href="">x264 BP</a> <a href="">x264 HP</a> <br><br><h2>  Battle </h2><br><img src="http://i7.fastpic.ru/big/2010/0619/9a/c330caaa01ee138418f329ea196ae29a.png"><br>  Despite the higher SSIM performance of all codecs, the results on this video are visually worse than others.  Basically, the VP8 picture is less blurred than that of the x264 BP. <br>  Screenshots: <a href="">Source</a> <a href="">Theora</a> <a href="">VP8</a> <a href="">x264 BP</a> <a href="">x264 HP</a> <br><br>  And here's another example when VP8 badly fucked up the scene. <br>  Screenshots: <a href="">Source</a> <a href="">Theora</a> <a href="">VP8</a> <a href="">x264 BP</a> <a href="">x264 HP</a> <br><br><h2>  Old town cross </h2><br><img src="http://i7.fastpic.ru/big/2010/0619/27/5506ceb8faf5eae640c6f82c51308d27.png"><br>  In this video, the visual differences are barely noticeable.  The grain is washed away everywhere, the roof tiles are covered.  The main differences in how roughly / accurately transferred small parts.  Well, Theora blurred everything. <br>  Screenshots: <a href="">Source</a> <a href="">Theora</a> <a href="">VP8</a> <a href="">x264 BP</a> <a href="">x264 HP</a> <br><br><h1>  Relative bitrate </h1><br>  Figures and pictures are interesting and entertaining.  But there is still a purely practical question: the ratio size / quality.  There is an easy way to estimate it: cross the graphs of the results with a horizontal line fixing SSIM and see the bitrate at the intersection points.  Yes, this is only a rough estimate, but it is quite informative.  It reflects the picture of what is happening, and on other videos of the same type, the results will still be slightly different. <br>  As the SSIM level on each chart, I took the highest x264 BP result.  For 100% on the graph of the relative bitrate took the result of the VP8. <br><img src="http://i7.fastpic.ru/big/2010/0619/ec/c596c8878c06f59957cc46e09d05d1ec.png"><br>  The graphs show that the bitrate (and, as a result, the file size) for x264 BP is greater than that of VP8, by 12-39 percent.  At the same time on the "real" video with scene changes x264 BP lost less.  Win x264 HP versus VP8 ranged from 16 to 33 percent. <br>  I also note that here the bill goes on interest, and not on times, as was <a href="">the case with Theora</a> . <br><br><h1>  Coding rate </h1><br>  I give the coding time of all the sequences on which the test was performed. <br><br>  x264 High Profile: 20 minutes 12 seconds <br>  x264 Baseline Profile: 10 minutes 21 seconds <br>  VP8: 83 minutes 59 seconds <br>  Theora: 21 minutes 59 seconds <br><br>  Configuration: Intel Core2Duo T6670 2.2 GHz, 3 GB RAM <br><br>  Here VP8 got a huge head start.  I did not customize it for the rest, as this is an alpha version.  True, the encoder has already been optimized, including through SIMD instructions. <br>  The gap could be compensated by increasing the x264 parameters --ref, --bframes, --me-range and --subme.  Thereby slightly improve the quality.  But I left the settings that I usually use, for practical reasons.  At the same time I received an approximate guideline for VP8 in time. <br><br>  x264 worked in two threads, Theora can only in one, VP8 also worked in one thread, as the developers recommend the <code>  = (  CPU ‚Äì 1)</code> .  But even with perfect multithreading, the VP8 would have been four times slower than x264 BP.  Are you ready to wait an hour instead of fifteen minutes, or four days instead of one? <br><br>  I do not know how to measure the decoding speed correctly.  In a good way, you need to test several different decoders on several hardware configurations.  Including on mobile devices.  And this is a separate big job, for which technical resources are also needed.  Perhaps such measurements will appear after the VP8 gets more widespread.  In the meantime, there is only x264 developer data for which VP8 is noticeably inferior.  And I believe his results more than the promises of On2 and Google marketers. <br><br><h1>  Thinking out loud </h1><br>  If we consider VP8 as a codec for the web, then it is quite a success.  The quality of the results is comparable to the codecs of the H.264 standard, in terms of licenses and patents, everyone is satisfied, and thanks to Google it will receive quite wide support.  Youtube is a great launch pad.  Chrome, Opera, Firefox - this is a decent share of the browser market.  Plus, Adobe promises to add WebM support to Flash by the end of the year, with an installation base of about 90%.  And plus Chrome frame for users of IE.  On mobile devices, too, at first through Flash, then there will be hardware support.  It is not clear, however, what to expect from Apple with their iPhone. <br><br>  On the technical side of this comparison, VP8‚Äôs problems with the rate control are visible.  Spoiled scenes are a consequence of the improper distribution of bits throughout the video.  Despite the fact that the video was encoded in two passes.  And you need to significantly reduce the coding time.  It is clear that this is only alpha, the codec will be refined. <br><br>  As for patent purity, the question is still open.  It will be visible in a year or two whether the claims will appear, and if they do, how they will be resolved.  And I do not understand the general panic around the royalty-free H.264 until 2016.  But MPEG-LA should extend it, why destroy a large user base.  The development companies have enough money - due to the devices they sell. <br><br>  By the way, VP8 is unlikely to move H.264 anywhere other than the web.  In other areas, freedom from patents is not a decisive advantage, so users of torrents and the media industry are unlikely to change anything.  Although at torrents.ru there were cranks who suggested that Teoro rip DVD rips, as they believed that it was superior in quality to H.264.  Also, manufacturers of various video recording devices (video cameras, cameras, telephones, etc.) are unlikely to bother with the new format and, accordingly, hardware support for VP8 encoding.  Digital TV is also unlikely to switch to VP8, otherwise everyone will have to change TVs (or STB), and television companies, in addition, will have coding equipment (also a matter of hardware support). <br><br>  And although the H.264 standard was adopted in 2003, it continues to evolve.  In 2007 and 2009, two extensions of the format were adopted: <a href="http://en.wikipedia.org/wiki/Scalable_Video_Coding">Scalable Video Coding</a> and <a href="http://en.wikipedia.org/wiki/Multiview_Video_Coding">Multiview Video Coding</a> .  I'm not sure that we will see the wide use of the first one soon, but the second one may well go to the masses in the coming years, as 3D video becomes more and more common.  And here VP8 also turns out to be a catch-up. <br><br><h1>  findings </h1><br>  VP8 format is quite suitable for the web.  It is much better than Ogg Theora and is comparable to H.264 in size / quality.  Questions about patent purity and decoding speed remain open.  Whether the format will be distributed is a question of commercial and political success rather than technical success. <br><br><h1>  Materials </h1><br>  I post the original video and coding results. <br>  Result VP8 I have without a container, raw stream.  If someone correctly smoothes it into a matryoshka and shares it with people, it will be great. <br>  <a href="http://narod.ru/disk/22044153000/encoded.rar.html">Coding results</a> <br>  <a href="http://narod.ru/disk/22046985000/source.rar.html">Source video</a> </div><p>Source: <a href="https://habr.com/ru/post/96888/">https://habr.com/ru/post/96888/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../96878/index.html">Intel will help Skolkovo to create an innovative laboratory</a></li>
<li><a href="../96879/index.html">The story of one exploit or ‚Äúendless‚Äù 0-day: CVE-2010-1297</a></li>
<li><a href="../96880/index.html">We write the simplest torrent tracker on php</a></li>
<li><a href="../96884/index.html">Create CHM with search and index</a></li>
<li><a href="../96887/index.html">How I updated Linux Mint</a></li>
<li><a href="../96889/index.html">MTS and the Moscow Metro presented a new way to pay for the subway using a mobile phone</a></li>
<li><a href="../96892/index.html">ITunes podcasts on mobile devices</a></li>
<li><a href="../96895/index.html">New things and promotion policy</a></li>
<li><a href="../96896/index.html">How I ruined the SSD in two months</a></li>
<li><a href="../96898/index.html">Command line in Google services</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>