<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Determination of the number of floors of the house by its photos without machine learning</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will give, in my opinion, an interesting solution to the problem of computer recognition of objects in an image without the use of t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Determination of the number of floors of the house by its photos without machine learning</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/cj/m6/ap/cjm6ap1__gr044luewh6bnieg90.png"></p><br><p>  In this article I will give, in my opinion, an interesting solution to the problem of computer recognition of objects in an image without the use of training. </p><a name="habracut"></a><br><p>  Task: having a photo of a multi-storey building try to determine the number of floors in it. </p><br><p>  A good estimate for the number of floors can give the number of windows on the vertical of the house.  Windows, balconies and other objects are good characteristics of the floors (especially in residential buildings).  I will consider it houses, whose images are easy to find on the network.  One important limitation should be noted in advance: the house on the image must be shown completely vertically in order to be able to visually detect all the floors. </p><br><p>  The task is rationally divided into two stages: </p><br><ol><li>  Search for a vertical "bar" of windows to be counted.  Two subtasks: first, you need to look for the windows in the area of ‚Äã‚Äãthe image occupied by the house, secondly, there are a lot of windows in the houses, to analyze them all does not make sense.  It is necessary to distinguish among them the vertical sequence that is best suited for subsequent analysis. </li><li>  Determination of the number of floors (windows, or other characteristic objects) on the selected section of the house. </li></ol><br><p>  This article is mainly devoted to the first step of the solution.  The second step is still under development, but I will also give some results of its solution. </p><br><h2 id="shag-1-poisk-oblasti-s-oknami">  Step 1. Search for a region with windows </h2><br><p>  The basic idea is that a series of well-distinguishable objects (such as windows) arranged in a row on a house create a periodic sequence of pixel brightness.  That is the sequence you need to find.  Below are the main steps of the algorithm. </p><br><p>  First we translate the image into grayscale and scale it (I used 400x600px pictures) <br><img src="https://habrastorage.org/webt/u0/et/u1/u0etu1wqvivumyejtlrnabusalq.png" alt="image"><br>  <em>Fig.1 Original b / w image</em> </p><br><p>  Next in the loop: </p><br><ol><li>  The choice on the image is relatively narrow (40px) strip to the full height (Fig.2, the bottom image without dots) </li><li>  Averaging the brightness across the width of the strip.  It turns out the line w of the distribution of the averaged brightness over the height of the house (Figure 2 upper graph).  It has a clearly visible periodic structure, characteristic of the site where there are windows.  Shadowed windows are less distinguishable, but this does not hurt. </li><li>  Calculates the difference dw of the values ‚Äã‚Äãof w and w shifted by the distance sh.  The search method is used to find such a shift value sh in order to achieve the maximum reduction in the median of the differences dw (Fig. 2, the lower graph). <br><img src="https://habrastorage.org/webt/9h/-a/vu/9h-avuydpoc8snu7eebt0dro2ny.png" alt="image"><br><img src="https://habrastorage.org/webt/9f/l5/im/9fl5imoofp3wriyh9clqraz_zga.png" alt="image"><br>  <em>Fig.2 "Strip" windows</em> </li></ol><br><p>  However, it is not enough to find the band of the image on which it was possible to lower the median most of all.  The fact is that areas with greenery or the sky, at small shear values, can give a greater decrease than windows.  But if we construct the dependence of the median value on the shift value for the bands with and without windows, then we can see a key difference: at the shift values ‚Äã‚Äãclose to the height of floors, the chart with windows has well-marked extremes.  Thus, it is necessary to measure not the absolute achievable level of the median, but its maximum decrease from the maximum in the process of increasing the shift for each window.  This is the key point. </p><br><table><thead><tr><th>  no windows </th><th>  with windows </th></tr></thead><tbody><tr><td><img src="https://habrastorage.org/webt/yt/xa/6z/ytxa6zixd0e_zwzd64wecqc2ilg.png" alt="image"></td><td><img src="https://habrastorage.org/webt/5h/op/o7/5hopo7xr4ngt33e7ypwikb7y9ou.png" alt="image"></td></tr></tbody></table><br><p>  <em>Fig.3 Change in the median averaged brightness in with increasing shift</em> </p><br><p>  Below is the python3 code with comments. </p><br><pre><code class="hljs pgsql">image = Image.<span class="hljs-keyword"><span class="hljs-keyword">open</span></span>("raf_data/32.jpg").resize((<span class="hljs-number"><span class="hljs-number">600</span></span>,<span class="hljs-number"><span class="hljs-number">400</span></span>)) # . img = np.<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(image.convert("L"), dtype=<span class="hljs-type"><span class="hljs-type">float</span></span>)/<span class="hljs-number"><span class="hljs-number">255</span></span> SEARCH_WIDTH = <span class="hljs-number"><span class="hljs-number">40</span></span> #    x_opt = [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>] #    :      sh_range = range(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>) #    kmax = <span class="hljs-number"><span class="hljs-number">0</span></span> #       <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, img.shape[<span class="hljs-number"><span class="hljs-number">1</span></span>]-SEARCH_WIDTH, <span class="hljs-type"><span class="hljs-type">int</span></span>(SEARCH_WIDTH/<span class="hljs-number"><span class="hljs-number">2</span></span>)): amax = <span class="hljs-number"><span class="hljs-number">0</span></span> amin = <span class="hljs-number"><span class="hljs-number">1</span></span> #      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> sh <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sh_range: #    w = img[:,x:x+SEARCH_WIDTH].mean(axis=<span class="hljs-number"><span class="hljs-number">1</span></span>) aim = (pd.DataFrame(w)-pd.DataFrame(w).shift(sh))[sh:].abs().median().<span class="hljs-keyword"><span class="hljs-keyword">values</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>] #    aim    sh <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> aim&gt;amax: amax = aim amin = amax <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> aim&lt;amin: amin = aim aim_k = amax/amin <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> aim_k&gt;kmax: x_opt = [x, sh, w] kmax = aim_k print(<span class="hljs-string"><span class="hljs-string">' : {0},  : {1}'</span></span>.format(x_opt[<span class="hljs-number"><span class="hljs-number">0</span></span>], x_opt[<span class="hljs-number"><span class="hljs-number">1</span></span>]))</code> </pre> <br><p>  In Fig.2 the points are placed at the distance of the found shift.  As you can see, they mark each window well.  Those.  we already know the height of the floor! <br>  The considered algorithm not bad finds regular zones on the facades of the most different residential buildings (Fig.4). <br><img src="https://habrastorage.org/webt/xh/vl/h5/xhvlh5ukzlxnwpi5iugar7f2x4u.png" alt="image"><br><img src="https://habrastorage.org/webt/nk/lg/oa/nklgoakyvddkiunj1l-wqyr0npu.png" alt="image"><br><img src="https://habrastorage.org/webt/5f/ty/vb/5ftyvboxmvu_klg5mozu9x07w0a.png" alt="image"><br>  <em>Fig.4 Example</em> </p><br><h2 id="shag-2-podschyot-chisla-etazhey">  Step 2. Counting the number of floors </h2><br><p>  At this step, the main difficulties begin.  Further actions may be as follows: </p><br><ol><li>  Evaluate the height of the house by analyzing the curve of differences in average brightness or using machine learning).  Divide the height of the house by the height of the floor and get the number of floors. </li><li>  In the window found in the first step, search for objects that look like windows and count them directly, for example, by special points. </li></ol><br><p>  It seems natural to try the first method first: once the height of the floors is known, it remains to determine the height of the house.  However, schemes similar to those given in step 1 turn out to be poorly suitable for determining the height of the house, taking into account all possible boundaries and transitions.  In some cases, it is possible to get good examples of work, but for a consistently good result, we need approaches using machine learning. </p><br><p><img src="https://habrastorage.org/webt/qq/8c/eg/qq8ceg0kmzuzhxqfshishxoiyac.png" alt="image"><br>  <em>Fig.5 Determining the height of the house using a random forest</em> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/422867/">https://habr.com/ru/post/422867/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../422857/index.html">Implementing your IoC container</a></li>
<li><a href="../422859/index.html">The Ministry of Communications offered to switch to SIM cards with encryption from the FSB</a></li>
<li><a href="../422861/index.html">About building JDK 8 on Ubuntu, the quality of Hotspot code, and why everything is felled in C ++</a></li>
<li><a href="../422863/index.html">Tribes, guilds, build train and no TDD: how does mobile development work in Uber, Spotify, Odnoklassniki and Avito</a></li>
<li><a href="../422865/index.html">Java Enterprise open lesson "CDI in action"</a></li>
<li><a href="../422869/index.html">We master new programming languages, based on the already studied</a></li>
<li><a href="../422871/index.html">Identifying content profiles in VK</a></li>
<li><a href="../422873/index.html">Pizza ala-semi-supervised</a></li>
<li><a href="../422875/index.html">Why you should not rent a VPS / VDS for 200 rubles or how to choose a virtual server</a></li>
<li><a href="../422877/index.html">"Is This IoT?" - learn not to call the Internet of Things everything</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>