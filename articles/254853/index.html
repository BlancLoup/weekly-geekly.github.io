<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we fulfilled the requirement of Roskomnadzor with benefit for business</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The other day we received a letter from Roskomnadzor. It was said there that they even got their hands on our company. 

 "In order to assess the poss...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we fulfilled the requirement of Roskomnadzor with benefit for business</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/4b9/f09/a6e/4b9f09a6e0124c36b310ed33e0789e9d.jpg"><br><br>  The other day we received a letter from Roskomnadzor.  It was said there that they even got their hands on our company. <a name="habracut"></a><br><br><blockquote>  "In order to assess the possible need of technical means of control, I ask you to inform by the date of March 20, 2015 the number of filtering nodes that restrict access from your access networks to individuals and legal entities to Internet sites containing information the distribution of which is prohibited in the Russian Federation ". <br>  <b>Excerpt from the official letter from Roskomnadzor</b> . </blockquote><br>  So, the essence of the message is to enable the RKN to count all our traffic filtering points and make sure that they are controlled by the ‚Äúgreat switch‚Äù - the law 139 .  If someone does not know what they are talking about, then under the spoiler there is a brief help on the topic of locks. <br><div class="spoiler">  <b class="spoiler_title">Spoiler</b> <div class="spoiler_text">  In short, the law implies the following: <br><ul><li>  Any provider must monitor the source of the ‚Äúblack lists‚Äù URL and block traffic to all the addresses listed there.  How exactly - it says very streamlined, so who where. </li><li>  Check for "updates" should be at least 3 times a day.  Though with hands, at least automatically, the main thing is with a given frequency. </li><li>  To monitor the execution of the law, some monitoring devices are installed on the equipment of the provider.  We haven't got ours yet, so it's still unknown here. </li><li>  For non-compliance with the law - a fine. </li></ul><br>  If you want to absorb more letters, then here's the text of the law in its original form: <a href="http://graph.document.kremlin.ru/page.aspx%3F1%3B1621853">graph.document.kremlin.ru/page.aspx?1;1621853</a> <br></div></div><br>  On the technical side, the law requires the telecom operator (to some extent, IT-GRAD, being a <a href="http://www.it-grad.ru/">cloud provider</a> , is also a telecom operator) to implement on its own the blocking of all kinds of content prohibited for distribution in the territory of the Russian Federation.  Of course, a simple ‚Äúyes, a clerk, we'll do everything!‚Äù Roskomnadzor is not enough - they also install separate devices for checking the performance of the operator. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A couple of years ago, after the adoption of Law <b>139 FZ,</b> such a requirement was a toothache for any Internet service provider, because many even had no normal DPI, where you could simply add blocking functionality.  Then we were just engaged in the study of the services of DDoS protection and DPI filtering for users of our cloud, so that we knew the main players in the market for protection and blocking.  I will not bore you with a long and painful history of choosing a specific solution, but simply give you a comparative table of the capabilities of the filtering systems popular in the market.  Price was also not the last factor, but here we omit this parameter. <br><table border="1" cellspacing="1" cellpadding="1"><tbody><tr><td></td><td>  <b><nobr>Skydns</nobr></b> </td><td>  <b><nobr>Carbon</nobr></b> </td><td>  <b><nobr>Perimeter-F</nobr></b> </td><td>  <b><nobr>Scat</nobr></b> </td></tr><tr><td>  The ability to download the registry from the site of the ILV EDS </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td>  Ability to add lists with regional locks </td><td>  + </td><td>  + </td><td>  - </td><td>  + </td></tr><tr><td>  The scheme of implementation of the solution on the equipment provider </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td>  Add.  individual client filtering services and billing integration, whitelisting </td><td>  + </td><td>  + </td><td>  - </td><td>  + </td></tr><tr><td>  Monitoring scheme </td><td>  - </td><td>  + </td><td>  - </td><td>  + </td></tr></tbody></table><br>  But according to the law, blocking interested us all the same in the second place.  Therefore, we were looking not just for ‚Äúbig scissors‚Äù, but for some kind of multifunctional device.  His fragile silicon shoulders had to bear the heavy burden of DdoS filtering and speed control of the channel.  By comparing the specifications and testing in the fields, we selected the product SCAT from <a href="http://www.vasexperts.ru/">VAS Experts</a> .  By the way, the piece of hardware (or rather, the hardware-software complex) turned out to be quite interesting: <br><ul><li>  filtering by the registry of prohibited sites; </li><li>  collection and analysis of statistics on protocols and directions; </li><li>  traffic prioritization depending on the protocol; </li><li>  distribution of the access channel between subscribers with notifications; </li><li>  protection against DOS and DDOS attacks; </li><li>  Lawful interception - traffic interception; </li><li>  write http requests; </li><li>  SORM prefilter. </li></ul><br><h2>  What and how to block </h2><br>  Technical aspects of locks have already been discussed on Habr√© more than once, and they all revolve around DPI- and IP-locks.  I hope <a href="http://habrahabr.ru/users/schors/">schors</a> do not mind if I copy his picture: <br><br><img src="https://habrastorage.org/files/04f/e6a/31e/04fe6a31e9604742832aa8757c81bc07.png"><br><br>  You can block sites according to state lists in different ways ( <a href="http://habrahabr.ru/post/231615/">here</a> was a useful article with an overview of possible ways to block sites), and here the selected piece of hardware pleased with the support of such options: <br><ul><li>  HTTP proxy filtering, including Opera Mini; </li><li>  the ability to take into account or not take into account the port number (i.e., block <a href="http://www.example.com/">www.example.com</a> and <a href="http://www.example.com/">www.example.com</a> : 8080 together or separately); </li><li>  no dependence on the change of the site IP address; </li><li>  Encapsulation of VLAN, QinQ, MPLS is supported; </li><li>  asymmetric traffic routes can be used, including processing only outgoing; </li><li>  works with mirrored traffic. </li></ul><br>  Of course, the easiest option would be to take the path of blocking all traffic for an unwanted IP.  That is, we take the URL from the registry, convert the name to IP and redirect to the page with the ‚Äúletter of happiness.‚Äù <br><br>  But we decided to be more humane, besides the piece of hardware with DPI has already arrived at the warehouse.  Thus, at both exchange points there is a server-filter with DPI, which automatically loads up-to-date lists from the RKN and scans all passing packets for the forbidden address.  If hit - forward the client to the page with an explanation of what and why. <br><br>  Here, by the way, there is a nuance with HTTPS.  The encrypted packet can not be so easy to "open" and view the content, so this traffic has to be blocked by a bunch of IP-port, regardless of the real URL.  Rough method, but there is no better solution yet.  The blessing in the registry still appear mainly HTTP-addresses. <br><br><h2>  But what is useful? </h2><br><img src="https://habrastorage.org/files/88d/a66/4ca/88da664ca9dc47b98cc8f818c6d76688.jpg"><br><br>  You remember that the goal was not just blocking sites, but also the DDoS protection feature useful for customers. <br><br>  For DdoS attacks, the attacker prepares a large network of remotely controlled computers (BOTNET) and he does not need to hide the IP address of each of them.  You can simply simulate the actions of legitimate users of the site, but due to the large number of participants, even such actions will cause a greater load on the site and lead to a denial of service. <br><br>  Usually, the most resource-intensive requests are selected to minimize the number of computers involved in the attack - after all, their IP addresses will be exposed after the action. <br><br>  To protect against DDoS attacks, various behavioral strategies are commonly used that determine abnormalities in the user's normal behavior.  In the established DPI, the simple and effective, like a bayonet, approach is used instead: the use of a captcha page, on which a <s>person must prove that he is not a robot, it</s> is determined whether the user of the system is a person or a computer. <br><br>  Taking all this into account, we connected ‚ÄúSCAT‚Äù in the recommended bypass mode, as in the picture. <br><br><img src="https://habrastorage.org/files/6b7/b29/301/6b7b2930181145a78e5834001ab2c2dc.jpg"><br><br>  A separate web cluster in our own cloud was used as a check on the ‚Äúhumanity‚Äù of suspicious users. <br><br>  Protection works as follows: <br><ol><li>  When the threshold value is exceeded (comfortable for the site, the number of requests per second) protection is activated. </li><li>  Only users from the white list are allowed to work with the site.  All the others are redirected to the ‚Äúhumanity‚Äù check page.  This page is located on a separate server on the Internet capable of withstanding any size <b>BOTNET</b> load. </li><li>  Users who have passed the test are added to the white list, and then nothing limits them. </li><li>  The ‚Äúbots‚Äù that have not passed the test (or the poor) will not advance further than the detecting page without any load on the attacked site. </li></ol><br><h2>  What is the result </h2><br>  The result was a rare example of catching both birds with one stone at a time, since the option to protect against DDoS is expectedly popular with our customers. <br><br>  As they say in one wise quotation, ‚Äúif you cannot defeat an enemy, make him your friend.‚Äù  If we, as an operator, cannot avoid the installation of a ‚Äúgreat switch‚Äù, we would like to do it with minimal costs and a headache.  In addition, Russian software manufacturers offer quite workable solutions with DPI for reasonable money.  Import substitution in action - there is even a choice. </div><p>Source: <a href="https://habr.com/ru/post/254853/">https://habr.com/ru/post/254853/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../254841/index.html">Building analytical expressions ... for any objects - from the Pythagorean theorem to the pink panther and Sir Isaac Newton in Wolfram Language (Mathematica)</a></li>
<li><a href="../254843/index.html">Lectures Technopark. Term 3 Design of high-load systems</a></li>
<li><a href="../254845/index.html">Overview of the new version of EOS for SharePoint 2013: design and usability</a></li>
<li><a href="../254847/index.html">Installing FAMP on pfsense</a></li>
<li><a href="../254849/index.html">As we say</a></li>
<li><a href="../254855/index.html">Static code analysis</a></li>
<li><a href="../254857/index.html">The story of the unofficial application what3words for BlackBerry</a></li>
<li><a href="../254859/index.html">Dell has released a secure data center for the military</a></li>
<li><a href="../254861/index.html">Writing a script for arranging elements in a circle for Eagle CAD</a></li>
<li><a href="../254863/index.html">Analysis of the shopping cart using MS Excel and MS SQL Server</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>