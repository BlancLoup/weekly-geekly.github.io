<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Google WebFonts and FontFaceObserver. Use third-party fonts on your website</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="WebFonts. Story 
 WebFonts is a technology for using third-party fonts on your web page. One example: 



 If we start from the beginning, the font ta...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Google WebFonts and FontFaceObserver. Use third-party fonts on your website</h1><div class="post__text post__text-html js-mediator-article"><h3>  WebFonts.  Story </h3><br>  WebFonts is a technology for using third-party fonts on your web page.  One example: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0c3/ea6/c16/0c3ea6c16b9746304dba6e6daca1673f.png"><br><br>  If we start from the beginning, the font tag was introduced in 1995, and already in 1996, the program definition was written in CSS.  Starting with CSS 2.0, font loading and synthesis was introduced in browsers, but nonetheless still popular, and now old and irrelevant IE had no support for font loading, which prevented the rapid development of font use on its website. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the modern Internet, web fonts are a long-established thing.  On different sites, we can use all sorts of fonts, which, in turn, are not included in the delivery of one or another operating system, but there is an undesirable side effect, which we will talk about today. <br><a name="habracut"></a><br><h3>  File formats </h3><br>  To connect the fonts, software insertion into CSS is used, the so-called @-rule.  So, in the simplest form, @ font-face is such a declaration.  It looks like this: <br><br><pre><code class="css hljs"><span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">font-face</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">src</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">url</span></span>(<span class="hljs-string"><span class="hljs-string">'//'</span></span>); } <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">p</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: <span class="hljs-string"><span class="hljs-string">' '</span></span>, Arial; }</code> </pre> <br>  TTF or OTF - familiar to us font file, but loaded from the server while viewing the site; <br><br>  WOFF is an unprotected archive of OTF or TTF source code, perhaps the most important format supported by most popular browsers, and files in WOFF are usually 2‚Äì2.5 times lighter than the original ones; <br><br>  EOT - the TTT OpenType-implemented archive with protection mechanisms is needed to support older Internet Explorer browsers (since IE8, besides TrueType curves, PostScript is also supported); <br><br>  SVG - to support the Safari browser. <br><br>  Fonts prepared for the introduction (@ font-face) on the site today should be in several formats at once.  You understand that there are some discrepancies, just as there is more than one type of operating system.  There are a lot of font formats, but a specific one will work only in a specific browser.  As for these very formats, which is why so many of them need to be specified when connecting, they are needed for cross-browser support of the site. <br><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">font-face</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: <span class="hljs-string"><span class="hljs-string">'__'</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">src</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">url</span></span>(<span class="hljs-string"><span class="hljs-string">'__.eot'</span></span>); <span class="hljs-attribute"><span class="hljs-attribute">src</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">url</span></span>(<span class="hljs-string"><span class="hljs-string">'__.eot?#iefix'</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(<span class="hljs-string"><span class="hljs-string">'embedded-opentype'</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">url</span></span>(<span class="hljs-string"><span class="hljs-string">'__.woff'</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(<span class="hljs-string"><span class="hljs-string">'woff'</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">url</span></span>(<span class="hljs-string"><span class="hljs-string">'__.ttf'</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(<span class="hljs-string"><span class="hljs-string">'truetype'</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">url</span></span>(<span class="hljs-string"><span class="hljs-string">'__.svg#DSNoteRegular'</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(<span class="hljs-string"><span class="hljs-string">'svg'</span></span>); <span class="hljs-attribute"><span class="hljs-attribute">font-weight</span></span>: normal; <span class="hljs-attribute"><span class="hljs-attribute">font-style</span></span>: normal; }</code> </pre><br>  If you want to use encrypted code instead of a file, in this case base64 comes to our rescue, which works on the same principle with images, but is not processed for old IE. <br><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">font-face</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: <span class="hljs-string"><span class="hljs-string">'__'</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">src</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">url</span></span>(<span class="hljs-string"><span class="hljs-string">'__.eot'</span></span>); } @<span class="hljs-keyword"><span class="hljs-keyword">font-face</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: <span class="hljs-string"><span class="hljs-string">'__'</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">src</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">url</span></span>(data:font/woff;charset=utf-8;base64,) <span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(<span class="hljs-string"><span class="hljs-string">'woff'</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">url</span></span>(data:font/truetype;charset=utf-8;base64,) <span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(<span class="hljs-string"><span class="hljs-string">'truetype'</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">url</span></span>(<span class="hljs-string"><span class="hljs-string">'__.svg#__'</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(<span class="hljs-string"><span class="hljs-string">'svg'</span></span>); <span class="hljs-attribute"><span class="hljs-attribute">font-weight</span></span>: normal; <span class="hljs-attribute"><span class="hljs-attribute">font-style</span></span>: normal; }</code> </pre><br><h3>  Embedded OpenType? </h3><br>  As you can see, the plug-in fonts for IE have a line with this parameter: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">src</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">url</span></span>('__<span class="hljs-selector-class"><span class="hljs-selector-class">.eot</span></span>?<span class="hljs-selector-id"><span class="hljs-selector-id">#iefix</span></span>') <span class="hljs-selector-tag"><span class="hljs-selector-tag">format</span></span>('<span class="hljs-selector-tag"><span class="hljs-selector-tag">embedded-opentype</span></span>')</code> </pre><br>  In the classic version, we had to specify with you exactly like this: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">src</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">url</span></span>('__<span class="hljs-selector-class"><span class="hljs-selector-class">.eot</span></span>') <span class="hljs-selector-tag"><span class="hljs-selector-tag">format</span></span>('<span class="hljs-selector-tag"><span class="hljs-selector-tag">embedded-opentype</span></span>')</code> </pre><br>  But when adding the character "?"  after the font format, we force the browser not to read the following statement - format ('embedded-opentype').  Internet Explorer supports embedding fonts through the so-called proprietary Embedded OpenType standard, starting with version IE 4.0.  It uses a digital rights management method to prevent copying fonts that are licensed. <br><br><h3>  What if the font is not supported in the browser? </h3><br>  Long ago, workarounds, so-called "crutches" for displaying a particular font, were invented.  There are cases when the font was designed only in SVG format, or only in TTF format. <br><br>  1. In ancient times, the developers connected the image, which in turn was the text typed in the visual editor.  However, now it is considered a bad form, because the support is quite difficult (you need to open the editor again to change the text of the picture), respectively, the user can not copy the text from the image. <br><br>  2. Also common was the use of flash-solutions. <br><br>  3. Another solution is to use Javascript to replace text with VML (for Internet Explorer) or SVG (for all other browsers). <br><br><h3>  What other problems may arise? </h3><br>  The browser will try to synchronize the loading of the font, it will try to hide the text, that is, make it invisible until the font has been loaded.  This effect is called FOIT, the ‚Äúwhite flash‚Äù effect. <br><br>  One of the web developers Bram Stein published an article about how he corrected the situation by writing his own implementation of the polyfile.  Below is an example of a similar problem and its solutions. <br><br><h3>  Flash effect </h3><br>  The effect of FOIT in browsers such as Safari, Chrome, Opera, Firefox tends to hide the text for a maximum of 30 seconds before refusing to get the font, after which the default font is set. <br><br>  An example of how the font is loaded: <br><br><img src="https://habrastorage.org/files/ce1/0c0/584/ce10c0584763493c9ed2cc9445246d9f.png"><br><br>  And yet, 2.7 seconds is a long time! <br><br><h3>  What can be done? </h3><br>  Initially, the approach was to include the conversion of font files to URIs so that those fonts could be included directly in the font family definitions in the CSS file.  By loading this CSS file in an asynchronous way, you can ensure that the browser immediately renders the text in the page using custom fonts, and the new fonts are applied as soon as the CSS is loaded. <br><br>  However, in any experiment there is a side effect. <br><br>  Initially, Bram Stein used a custom font, but after its font was loaded, a ‚Äúflicker‚Äù occurred, in the example at 0.7 second: <br><br><img src="https://habrastorage.org/files/caa/fbb/65d/caafbb65d7e14ff49c47cf9542697634.png"><br><br>  In short, flickering occurs when the browser tries to display the font from the font-family and apply it in html.  The font defined in the @ font-face declaration that was not yet loaded. <br><br>  Bram Stein showed how to connect fonts correctly, he developed a script, an alternative from google for asynchronous loading of fonts, this is a script - FontFaceObserver. <br><br><h3>  We try </h3><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/wUU9kQRJI5Q%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhEiXbzd1vsLh87bEkELzDW3oKP1A" frameborder="0" allowfullscreen=""></iframe><br><br><h3>  Analysis </h3><br>  <u>Standard connection from Google</u> <br><br>  Honestly speaking, using more than one font on the site can specifically slow down the loading speed of the site page, thereby increasing the overall load time.  The Google Fonts API allows you to quickly add a font to a site using a font generator, thereby quickly designing your site.  However, remember the effect of FOIT.  Total download time is 322 ms. <br><br><img src="https://habrastorage.org/files/6eb/b6e/b61/6ebb6eb6115a49e4a70bea7a8462743d.png"><br><br>  <u>Google Web Font Loader</u> <br><br>  Web Font Loader is a JavaScript library for advanced work with the API, a library that gives us more control over font loading than the standard Google Fonts API.  The script allows us to use multiple fonts, loading them sequentially or asynchronously.  Unlike the standard connection, text with standard fonts is shown on weak connections until the font is loaded. <br>  Total load time: 1132 ms <br><br><img src="https://habrastorage.org/files/674/955/99b/67495599ba084e6696b08b185163b618.png"><br><br>  <u>FontFaceObserver</u> <br><br>  FontFaceObserver is a JavaScript library (5kb), the so-called subloader compatible with any web font service.  The script allows you to notify us about whether the font is loaded or not, allows you to track the event after loading and before loading the font.  Total load time: 159 ms <br><br><img src="https://habrastorage.org/files/5a9/545/ba3/5a9545ba36904486a413af76d424cac6.png"><br><br>  Script usage: <br>  [ <a href="https://github.com/bramstein/fontfaceobserver">Documentation (eng)</a> ] <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> @</span><span class="hljs-keyword"><span class="css"><span class="hljs-keyword">import</span></span></span><span class="css"> url(http://fonts.googleapis.com/css?family=_&amp;subset=cyrillic,latin); </span><span class="hljs-comment"><span class="css"><span class="hljs-comment">/*   ,         */</span></span></span><span class="css"> </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">body</span></span></span><span class="css"> {</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">font-family</span></span></span><span class="css">: sans-serif;} </span><span class="hljs-comment"><span class="css"><span class="hljs-comment">/*   */</span></span></span><span class="css"> </span><span class="hljs-selector-class"><span class="css"><span class="hljs-selector-class">.fontOneLoad</span></span></span><span class="css"> </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">body</span></span></span><span class="css"> { </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">font-family</span></span></span><span class="css">: </span><span class="hljs-string"><span class="css"><span class="hljs-string">'_'</span></span></span><span class="css">, cursive; } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'js/fontfaceobserver.js'</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">//  var fontOneLoad = new FontFaceObserver('_', {}); fontOneLoad .check() .then(function () { // ,    //    html document.documentElement.className += " fontOneLoad"; }); </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/258731/">https://habr.com/ru/post/258731/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../258721/index.html">Checking open source UEFI for Intel Galileo with PVS-Studio</a></li>
<li><a href="../258723/index.html">Entity Framework and performance, second attempt</a></li>
<li><a href="../258725/index.html">How Valera took a trainee team and started teaching him how to design</a></li>
<li><a href="../258727/index.html">Project "Oberon 2013"</a></li>
<li><a href="../258729/index.html">Registration is now open for the third annual championship for developers of the Russian Developers Cup</a></li>
<li><a href="../258735/index.html">Secure SSL / TLS Russian Internet Banking</a></li>
<li><a href="../258739/index.html">Twelve Factor App - The Twelve-Factor App</a></li>
<li><a href="../258745/index.html">New data center Rackspace in the UK: photo tour and features of the new DC</a></li>
<li><a href="../258751/index.html">DevOps Zoo or like 500px serves more than 500TB images</a></li>
<li><a href="../258753/index.html">"Under the hood" Netflix: An analysis of world cinema</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>