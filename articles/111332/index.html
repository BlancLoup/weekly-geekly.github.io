<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The emulator of the game "life" in the GLSL language</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For a start, a small educational program: one , two , three . 

 Probably many at least once in their life wrote an emulator of the game "life". 
 May...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The emulator of the game "life" in the GLSL language</h1><div class="post__text post__text-html js-mediator-article">  For a start, a small educational program: <a href="http://habrahabr.ru/blogs/python/111247/">one</a> , <a href="http://ru.wikipedia.org/wiki/%25D0%2596%25D0%25B8%25D0%25B7%25D0%25BD%25D1%258C_(%25D0%25B8%25D0%25B3%25D1%2580%25D0%25B0)">two</a> , <a href="http://habrahabr.ru/blogs/games/63848/">three</a> . <br><br>  Probably many at least once in their life wrote an emulator of the game "life". <br>  Maybe for learning programming, maybe for interest, experiments ... <br>  In any case, implementation in many popular programming languages ‚Äã‚Äãis a simple exercise for learning this language. <br><br>  But today we will try to implement such an emulator using a video card, since the algorithm of the game itself is well implemented using parallel computing. <br>  We use OpenGL, respectively, the language of shaders - GLSL.  The main program will be written in C ++ <br><a name="habracut"></a><br><h4>  Introduction </h4><br>  So let's get started. <br>  To begin with, let us remember how the ‚Äúchange of generations‚Äù takes place in this game. <br>  For each cell, we look at the number of its living neighbors.  If it is 3 and the original cell is empty, then the cell comes to life.  If the source cell is alive, but the number of neighbors is not equal to 2 or 3, then it dies. <br>  Obviously, for each cell, you can check these conditions separately; you only need to know its state and the state of 8 neighbors in the previous step.  In addition, the transition to the next generation occurs ‚Äúsimultaneously‚Äù, so in the simplest implementations two two-dimensional arrays are used for this purpose. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      There is certainly an option with one array - to mark the cells, which will come to life and die, and then make changes to the data in the array.  In this implementation, we will use two framebuffers, each with a texture (= on a two-dimensional array). <br>  The variant with one array does not work, for example, because when rendering it is impossible to assign the same texture to read and write.  In addition, this method requires two passes through the array. <br>  So, let's not bother, and implement a simple option.  Video memory is a lot now :) <br><br><h4>  Initialization </h4><br><h5>  Creating a framebuffer and texture </h5><br>  First, create two framebuffers and add each one by texture. <br>  Single buffer initialization code: <br><br> <code>glGenFramebuffersEXT(1,&amp;FrameBufferID); <br> glGenTextures(1,?ColorBufferID); <br> glBindFramebufferEXT(GL_FRAMEBUFFER_EXT, FrameBufferID ); <br> glBindTexture(GL_TEXTURE_2D,ColorBufferID); <br> glTexImage2D(GL_TEXTURE_2D,0,4,SizeX,SizeY,0,RGBA,GL_UNSIGNED_BYTE,0); <br> glFramebufferTexture2DEXT(GL_FRAMEBUFFER_EXT,GL_COLOR_ATTACHMENT0_EXT,GL_TEXTURE_2D,ColorBufferID,0); <br> glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST ); <br> glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST ); <br> glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT); <br> glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT); <br> glBindTexture(GL_TEXTURE_2D,0); <br> glDisable(GL_DEPTH_TEST); <br> glEnable(GL_TEXTURE_2D); <br> glBindFramebufferEXT(GL_FRAMEBUFFER_EXT, 0); <br></code> <br><br>  Here we created a framebuffer and a texture, then with the help of glTexImage2D we set the size and format of the texture (you could of course create a one-component texture for this purpose, and render it to the shader by rendering the color pixel to the screen, but for simplicity the same texture and output, so immediately set this format). <br>  The following function glFramebufferTexture2DEXT attaches a texture to the framebuffer. <br>  Next, we configure the texture parameters - Nearest-filtering in order to avoid errors in the shader when reading from the neighboring texture pixels. <br><br><h5>  Closed field </h5><br>  As is well known, very often in computer implementations of the ‚Äúlife‚Äù emulator, a toroidal field is used,  the left edge closes at the right, and the top edge at the bottom. <br>  Here, this feature of the field gives us GL_REPEAT - when trying to read a value from a texture, its value will be received from the other side, i.e.  exactly what you need. <br><br><h5>  Editing field cells </h5><br>  Using the glTexSubImage2D function, you can easily change the data in the texture.  We agree to assume that the cell is ‚Äúalive‚Äù, then all the components of RGBA will be equal to 255, otherwise they will all be equal to 0. <br>  Then the code changes one pixel of the texture: <br><br> <code>unsigned char buf[4]={val,val,val,val}; // val is 0 or 255 <br> glBindTexture(GL_TEXTURE_2D,ColorBufferID); <br> glTexSubImage2D(GL_TEXTURE_2D,0,x,y,1,1,GL_RGBA,GL_UNSIGNED_BYTE,buf); <br> glBindTexture(GL_TEXTURE_2D,0); <br></code> <br><br><h5>  Loading shaders </h5><br>  I will not give here the shader load code, since  in this case they are downloaded in the most usual way. <br>  You can read about the use of shaders and framebuffers <a href="http://steps3d.narod.ru/articles.html">here.</a> <br><br><h4>  Main part </h4><br>  Actually, for what everything was written. <br>  Here, for simplicity, there is one rendering pass to the texture. <br>  Accordingly, it is necessary to alternate two buffers in turn - from one we read, to the other we write. <br><br> <code>glBindFramebufferEXT(GL_FRAMEBUFFER_EXT, FrameBufferID ); <br> glUseProgram ( ProgramObject ); <br> float szx=sizex; <br> float szy=sizey; <br> glUniform1f( glGetUniformLocation (ProgramObject, "SizeX" ) , szx); <br> glUniform1f( glGetUniformLocation (ProgramObject, "SizeY" ) , szy); <br> <br> glBindTexture(GL_TEXTURE_2D,ColorTextureID_2); //     <br> glUniform1i( glGetUniformLocation (ProgramObject, "SourceTexture" ) , 0); <br> <br> glViewport(0, 0, szx,szy); <br> <br> glMatrixMode ( GL_PROJECTION ); <br> glLoadIdentity (); <br> glOrtho ( 0, width, 0, height, -1, 1 ); <br> glMatrixMode ( GL_MODELVIEW ); <br> glLoadIdentity (); <br> DrawQuad(0,0,szx,szy,-1.0); <br> <br> glBindTexture(GL_TEXTURE_2D,0); <br> <br> glUseProgram ( 0 ); <br> glBindFramebufferEXT(GL_FRAMEBUFFER_EXT, 0 ); <br></code> <br><br>  DrawQuad function (we use FFP only for simplicity, in a good way, of course, we need to create a vertex buffer, etc.) <br><br> <code>void DrawQuad (float x,float y, float w, float h ,float z) <br> { <br> glBegin ( GL_QUADS ); <br> glTexCoord2f ( 0, 0 ); <br> glVertex3f ( x, y ,z); <br> <br> glTexCoord2f ( 1, 0 ); <br> glVertex3f ( x+w, y ,z); <br> <br> glTexCoord2f ( 1, 1 ); <br> glVertex3f ( x+w, y+h ,z); <br> <br> glTexCoord2f ( 0, 1 ); <br> glVertex3f ( x, y+h ,z); <br> glEnd (); <br> } <br></code> <br><br>  In this piece of code, we first assign the framebuffer and shader as current, transfer the field dimensions and texture from the other framebuffer to the shader as the source code.  Next, draw a rectangle on the whole screen, which causes the launch of the shader for all points of the test.  As a result, the current framebuffer in the texture will contain the state of the field in the next generation of "life." <br><br><h4>  And of course, the shader code! </h4><br><br>  In the vertex shader, we don‚Äôt do anything special, we don‚Äôt need a vertex transformation. <br> <code>void main(void) <br> { <br> gl_Position=ftransform(); //    <br> gl_TexCoord[0] = gl_MultiTexCoord0; //       <br> } <br></code> <br><br>  Fragment shader: <br> <code>uniform sampler2D SourceTexture; <br> <br> uniform float SizeX; <br> uniform float SizeY; <br> <br> void main(void) <br> { <br> float deltax = 1.0/SizeX; <br> float deltay = 1.0/SizeY; <br> float Sum = texture2D(SourceTexture,gl_TexCoord[0].st+vec2( deltax, deltay)).r + <br> texture2D(SourceTexture,gl_TexCoord[0].st+vec2(-deltax, deltay)).r + <br> texture2D(SourceTexture,gl_TexCoord[0].st+vec2(-deltax,-deltay)).r + <br> texture2D(SourceTexture,gl_TexCoord[0].st+vec2( deltax,-deltay)).r + <br> texture2D(SourceTexture,gl_TexCoord[0].st+vec2( 0, deltay)).r + <br> texture2D(SourceTexture,gl_TexCoord[0].st+vec2( 0,-deltay)).r + <br> texture2D(SourceTexture,gl_TexCoord[0].st+vec2(-deltax, 0)).r + <br> texture2D(SourceTexture,gl_TexCoord[0].st+vec2( deltax, 0)).r ; <br> float center =texture2D(SourceTexture,gl_TexCoord[0].st).r; <br> float koef=0.0; <br> <br> if(center&gt;0.5) //   -  ,  ,   <br> { <br> if(Sum&gt;3.5 || Sum&lt;1.5)koef=0.0;else koef=1.0; //        ,   <br> } <br> else <br> { <br> if(Sum&gt;2.5 &amp;&amp; Sum&lt;3.5)koef=1.0; //  Sum==3,   <br> } <br> gl_FragColor=vec4(1.0,1.0,1.0,1.0)*koef; <br> } <br></code> <br><br><h4>  Source </h4><br>  The program was written and launched only under Linux (Ubuntu 10.10). <br>  The SDL library is used to initialize the OpenGL context. <br>  So, compiling in Windows is most likely possible. <br>  If someone collects and puts it somewhere, thank you very much. <br>  In the file with the settings you can change the screen resolution, field size and the initial state of the field. <br><br>  <a href="http://narod.ru/disk/2930622001/LifeSim.zip.html">narod.ru/disk/2930622001/LifeSim.zip.html</a> </div><p>Source: <a href="https://habr.com/ru/post/111332/">https://habr.com/ru/post/111332/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../111327/index.html">Electronic documentation in schools (ACS RNO)</a></li>
<li><a href="../111328/index.html">Two beauties</a></li>
<li><a href="../111329/index.html">Computer in the car "cheap" or CarPC "Siberian"</a></li>
<li><a href="../111330/index.html">Removing .NET programs from registration using the example of BEM</a></li>
<li><a href="../111331/index.html">Rake tutorial</a></li>
<li><a href="../111333/index.html">Electronic forms via Microsoft InfoPath</a></li>
<li><a href="../111336/index.html">Anti-interference coding using various codes</a></li>
<li><a href="../111338/index.html">Online cinema</a></li>
<li><a href="../111339/index.html">Screenshot of a video player without black holes</a></li>
<li><a href="../111341/index.html">Review of Huawei E960 3G router</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>