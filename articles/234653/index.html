<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Optimize Linux for the desktop and games</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I want to share almost 10 years of experience using Linux on a home computer. During this time I spent a lot of experiments on the ke...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Optimize Linux for the desktop and games</h1><div class="post__text post__text-html js-mediator-article">  In this article, I want to share almost 10 years of experience using Linux on a home computer.  During this time I spent a lot of experiments on the kernel, tried various configurations for different applications and now I want to systematize all this into a long post with recommendations on how to squeeze the maximum out of linux and achieve excellent performance without having to buy powerful hardware. <br><br>  Personally, I think the part where I wrote about kernel tuning is still a bit out of date and modern hardware already gives a priori the necessary performance for normal operation, but, as I was able to notice recently, games don't care, even now, there are problems, even on powerful hardware . <br><br>  Although I promised that after reading this article, it will be possible to play Metro 2033 on a calculator (no joke, this will not happen), yet it will start with a recommendation to buy something from iron, if you don‚Äôt already have it. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  1. Buy an SSD if you don't already have one </h4><br>  For some reason, many people are skeptical of SSD, although this is the first and most important component of a computer that is going to work quickly. <br><br>  Seriously, everything that is described further in the article will give you some gain in performance and response time, but any, <b>even the cheapest SSD, will reduce the launch time of most programs to 0</b> , which, visually, will be very noticeable.  In almost any computer (and server), the main brake is always a disk subsystem and no HDD will ever give you the desired search speed (which, in an SSD, tends to 0 ms).  For all the time of communication with computers and their upgrade, only the transition to SSD has given a significant increase in the speed of work and response.  Remember how slow the floppy disks are, what a great search time they have?  Something like this perceived hard drive after SSD. <br><br>  So if you don‚Äôt have an SSD, then it makes no sense to continue, your computer (even if equipped with 12-core Xeon) will still work slowly, so go shopping. <br><br>  Regarding reliability: there is a myth that SSDs die a year later.  We owe its birth to the first SSD on SandForce chips.  Naturally, any new SSD from the store is at least more reliable and durable than modern hard drives, so you shouldn‚Äôt worry about it at all.  I bought my SSD 2 years ago used, at that time it was in use for a year.  Now he has 11,681 hours of use and 10% resource utilization, so with the same usage regime, I will have enough for another 27 years.  I think by this time the data storage technology has already changed several times.  So again, reliability problems are more than contrived. <br><br>  More details about the myths SSD comrade Vadim Sterkin wrote <a href="http://www.outsidethebox.ms/14432/">in his blog</a> .  True, his blog is about Windows, but essentially it does not change.  I strongly advise you to read, very interesting. <br><br>  In Ubuntu 14.04, SSDs work out of the box, the discard option is automatically registered in fstab, except that <b>nothing else needs to be done</b> . <br>  In other distributions, you need to check if the partition has this option on the SSD.  It is worth mentioning that this option only supports ext4.  For other filesystems, you will have to use fstrim from the scheduler. <br><br><h4>  2. Partition table </h4><br>  Do not divide discs into partitions. <br><br>  For a home computer, it is pointless and harmful.  On the SSD you should have one partition for the root, there you will have the system and all the data stored.  On the HDD (if needed) you should have one partition with a mount point in / mnt (I have / mnt / data), where large, under-used data (movies, music, games) will be stored.  DO NOT need to make the HDD mount point / home, since in / home 99% of the programs store their data and constantly refer to them, therefore / home must be on the SSD. <br><br>  I repeat briefly: on the SSD you should have everything that the system constantly refers to (writes / reads)! <br><br>  Do not listen to harmful advice on the removal of such data on the HDD, as already mentioned, the problem of wear SSD is not, it is a myth, and a large number of recording cycles does not affect the durability of SSD.  Once again I refer to the article by Vadim Sterkin, there it is all described in more detail and supported by explanations. <br><br>  About the SWAP section: you do not need it.  If you do not have enough RAM, then OOM-killer will nail resource-intensive applications, if this happens then purchase additional RAM, since its price does not bite much.  Using swap as a memory expander <b>slows down the computer considerably</b> .  There are many opinions that without SWAP there will be some problems, but IMHO, the roots of these conversations are growing from Win9x and today they are already myths, I personally did not notice any problems from rejecting SWAP.  As proof: on the VPS now rarely see the connected SWAP and work the same somehow! <br>  You don't need suspend-to-disk either, because a cold start with an SSD is faster than restoring from hibernation from an HDD, so use suspend-to-ram or turn off the computer completely.  The only advantage of a swap is the ability to go into a hybrid hibernation, this is when the system prepares for suspend-to-disk, but performs suspend-to-ram, so later, if everything is good, there is a simple way out of hibernation, and if a power failure occurs then the system will recover from the disk. <br><br>  I use the ext4 file system everywhere, since with others I couldn‚Äôt get a noticeable difference in performance, and ext4 is the most common, plus there are utilities for data recovery (but don‚Äôt rely on them, but make backups).  When creating, use -T largefile or largefile4. <br><br><h4>  3. Use the 64-bit kernel </h4><br>  Little depends on the performance of the RAM, FPS in games will not increase from it and applications will not start faster.  The use of 64-bit applications also does not give any gain for ordinary tasks, only for very specific mathematical calculations and archiving operations.  Also, using the 64 core is not required to address more than 4 GB of memory, PAE allows you to address up to 64 GB of memory on a 32-bit system. <br><br>  But using a 64-bit kernel, applications can address more than 4 GB of memory, which is quite useful, because otherwise there can be a situation when the OOM-killer nails programs, although there is still enough RAM.  Also, on a 64-bit system, you can immediately address all physical memory, while on 32-bit everything above ~ 800 MB must be constantly re-installed, which somewhat reduces the speed of page exchange, although, as I said, this does not particularly affect the speed of work. <br><br>  I also noticed the effect that the OOM-killer can nail processes that seem to have not yet taken 4 GB.  I had this with some games.  The problem was solved by the transition to 64 bits.  So, without a 64-bit kernel, it's nowhere, even though it adds a small overhead to memory usage. <br><br><h4>  4. Use the pf-kernel patch </h4><br>  pf-kernel is a set of patches for the linux kernel, compiled by a Ukrainian Alexander Natalenko ( <a href="http://habrahabr.ru/users/pfactum/" class="user_link">pfactum</a> ) aimed at improving the desktop experience of linux systems. <br><br>  It consists of: <br><br><ul><li>  Patchset <a href="http://ck.kolivas.org/patches/">-ck with BFS</a> </li><li>  <a href="http://algo.ing.unimo.it/people/paolo/disk_sched/patches/">BFQ I / O scheduler</a> </li><li>  <a href="http://www.tuxonice.net/">Tuxonice</a> </li><li>  <a href="http://kerneldedup.org/projects/uksm/">UKSM</a> </li></ul><br>  The most useful patches are BFS and BFQ, about which there is already a lot written.  BFQ is struggling with the problem of system brakes during large disk operations (the famous bug 12309, which is corrected according to the documents, but continues to plague in fact), BFS is a planning process that is more suitable for desktop work than those in the kernel.  For example, CFS, which is used by default, allows a situation where 2 processes that require real-time priority will be executed on one core, while other cores are engaged in low-priority tasks.  Naturally, this behavior leads to global brakes.  But "an honest planner."  BFS is not so ‚Äúhonest‚Äù, but it is much more close to the realities of desktop computers with a small (large is 4096) number of cores. <br><br>  To install, I download the necessary kernel version without kernel stabilization patches from kernel.org and impose a pf-kernel on it.  In general, it looks like this: <br><br><pre><code class="bash">cd /usr/src
wget ftp://ftp.kernel.org/pub/linux/kernel/v3.x/linux-3.12.tar.xz
tar -xf linux-3.12.tar.xz
cd linux-3.12
wget https://pf.natalenko.name/sources/3.12/patch-3.12.4-pf.bz2
bunzip2 patch-3.12.4-pf.bz2
patch -p1 &lt; patch-3.12.4-pf
</code></pre><br>
   ,      ,     .  , ,    ,      ,    !<br>
<br>
, ,  htop   Dota 2 + The Sims 3 (multiseat):<br>
<br>
<img src="http://alpha.hstor.org/files/08a/30b/41b/08a30b41b4e84d24a7a335db8c30f2eb.png" alt="image"><br>
<br>
          25% ( 5-    load-average)  CPU   . , ,    :(<br>
<br>
<h4>5.  !</h4><br>
        ,    linux      .<br>
<br>
   <i>make xconfig</i><br>
<br>
       <br>
<br>
<b> preemption,       dynticks!</b><br>
<br>
!  ,     BFS  ¬´ ¬ª     .       ‚Äî ,         preemption    .<br>
<br>
 ,      ,        preemption   ,  ,       .  ,  ,  100% CPU,     -          .   ,   WinXP   ,        XP   , ,  ,    ,     reset.    ,          .<br>
<br>
   ,              ,          ,   .<br>
<br>
    <i>Processor type and features</i>     <i>Preemption Model</i>  <i>No Forced Preemption (Server)</i>.    ¬´ocasional longer delays are possible¬ª         BFS   .     ,    ¬´raw processing power¬ª.<br>
<br>
,   ,   <i>Processor family</i>   .<br>
<br>
,    <i>Timer frequency</i>  <i>300 HZ</i>. 100    ,      (   ),    . , 300      25  30,      ,         (  .  ,        + vsync).<br>
<br>
      , ,    hot-plug  cpu  ,         ( -      ).<br>
<br>
     ,       ,       <i>CPU Frequency scaling</i> .<br>
<br>
   .   ,     ,         ¬´¬ª       .    <i>General setup -&gt; Timers subsystem</i>    <i>Timer tick handling</i>  <i>Periodic timer ticks (constant rate, no dynticks)</i>. <br>
<br>
 BFQ<br>
<br>
  BFQ           .<br>
<br>
 <i>Enable the block layer -&gt; IO Schedulers</i>   <i>BFQ I/O scheduler</i>  <i>BFQ hierarchical scheduling support</i>,   <i>Default I/O scheduler</i> , , <i>BFQ</i>.<br>
<br>
<h4>6. Prelink</h4><br>
       ,        .      <a href="http://habrahabr.ru/post/108454/"></a>  <a href="http://habrahabr.ru/users/peter23/" class="user_link">peter23</a>.<br>
<br>
<h4>7. </h4><br>
 ,     ‚Äî        ¬´¬ª  .   ,    ,          -    nVidia,       -. <br>
<br>
       Geekbench 3  Steam  <a href="http://www.geeks3d.com/gputest/">gputest</a>,    :<br>
<br>
<a href="http://browser.primatelabs.com/geekbench3/588620">3.14-pf</a>:<br>
Single-Core Score 2421<br>
Multi-Core Score 8209<br>
gputest: 3720 pts, 62 FPS<br>
<br>
<a href="http://browser.primatelabs.com/geekbench3/588638">3.13-generic</a>:<br>
Single-Core Score 2646<br>
Multi-Core Score 8414<br>
gputest: 3713 pts, 61 FPS<br>
<br>
<a href="http://browser.primatelabs.com/geekbench3/588651">Windows:</a><br>
Single-Core Score 2572<br>
Multi-Core Score 8242<br>
gputest: 3634 pts, 60 FPS<br>
<br>
 , -  ¬´¬ª    CPU   ,    GPU ‚Äî .        ,       .   ,      3.16, ,   .      ,   Windows  ,   3D .</div><p>Source: <a href="https://habr.com/ru/post/234653/">https://habr.com/ru/post/234653/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../234641/index.html">How will the sanctions affect the Russian online advertising market?</a></li>
<li><a href="../234645/index.html">Build a coworking in the Crimea. Part Two: Presentation and Idea Verification</a></li>
<li><a href="../234647/index.html">Management. A quick guide for beginner managers and experienced subordinates</a></li>
<li><a href="../234649/index.html">The deadline for applications for the Stepic Challenge contest has been extended until September 20</a></li>
<li><a href="../234651/index.html">How is mounted BS on the tower and in the mall</a></li>
<li><a href="../234655/index.html">How we tracked marriage in the real world and debugged the production of board games</a></li>
<li><a href="../234657/index.html">Looking for black holes and supernovae with the Black Holes web app.</a></li>
<li><a href="../234659/index.html">EU has banned some e-commerce tricks</a></li>
<li><a href="../234661/index.html">BitTorrent Sync 1.4 Released</a></li>
<li><a href="../234663/index.html">How I shamefully deactivated the botnet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>