<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with Workflow in Cisco UCS Director</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this post, I will review the process of creating a standard user request to deploy a virtual machine through Workflow (in contrast to the method th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with Workflow in Cisco UCS Director</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/3a9/055/477/3a905547789f8dbdaad7cbebf5d18cc3.jpg" alt="image"><br><br>  In this post, I will review the process of creating a standard user request to deploy a virtual machine through Workflow (in contrast to the method that was described in the <a href="http://habrahabr.ru/company/it-grad/blog/226473">Self-Service</a> post <a href="http://habrahabr.ru/company/it-grad/blog/226473">using Cisco UCS Director</a> ).  Below, we will get acquainted with the concept of Workflow, see the interface of the Workflow editor and create our first Task. <a name="habracut"></a><br><br>  A workflow, in accordance with the Cisco UCS Director Orchestration Guide, consists of two or more tasks, united by a common execution logic.  Workflow determines the order of tasks.  In other words, Workflow is a set of interconnected elements that perform a specific set of actions in accordance with a given logic.  Moreover, the logic can be determined by the system administrator. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Cisco USCD provides the administrator with two key elements for creating and working with workflow: <br><ul><li>  Workflow UI designer (graphical user interface for editing, see image below); </li><li>  A set of standard (typical) tasks (more than 400). </li></ul><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/a4b/87a/fd9/a4b87afd904ba53b2472aae8926d0006.png" alt="Workflow designer" title="Workflow designer"></a> <br><br>  The Workflow Designer interface is very simple, I would even say primitive.  What I personally like very much, because there are no extra elements, usually overloading the working area of ‚Äã‚Äãthe screen. <br><br>  On the left is the ‚ÄúAvailable Task‚Äù area, where all the built-in typical tasks are grouped.  There is also a search bar.  The central part of the window is occupied by the working area where the Task'i are located.  At the top there are several buttons that allow you to perform a number of actions, including launching the execution of the created Workflow directly from the editor, which is very useful for debugging. <br><br><h4>  Typical tasks </h4><br>  A typical task is a predefined set of atomic actions grouped in a single object.  At the entrance of such a task, you can submit a set of specific resources (including through previously defined policies).  At the output, a task can transfer certain information for another task (for example, the parameters of the virtual machine being created).  Further in the post I will use two typical tasks to create Workflow, which will determine the user's actions to create a virtual machine. <br><br>  Tasks communicate with each other in the workspace.  For each task, you can determine which task will be performed further in case of its successful execution, as well as in case of unsuccessful one.  For this you can use beautiful red and green arrows (JavaScript taxis :-)).  Thus, it is possible to determine the logic of the branching of the task, and a fairly clear picture is obtained. <br><br>  UCSD allows you to display a complete list of all tasks with a detailed description of each of them and a sample code.  To do this, in the Policies -&gt; Orchestration -&gt; Workflow menu, select the Task Library command and say Submit.  For example, below is a description of the standard VMWare Host Power Action task. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/da8/444/9c9/da84449c91f467c1c725495b4ba1ca95.png" alt="VMWare Host Power Action" title="VMWare Host Power Action"></a> <br><br>  In addition, typical tasks perform the functions of statistics collection and discovery of physical and virtual infrastructure objects, the so-called ‚ÄúCollect Inventory Task‚Äù. <br><br><h4>  Work with Workflow </h4><br>  In order to get to the Workflow section you need to go to the Policies -&gt; Orchestration -&gt; Workflow menu. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/5e2/17b/3ec/5e217b3ec78feaef7a3b78af5539470d.png" alt="Policies -> Orchestration - > Workflow" title="Policies -> Orchestration -> Workflow"></a> <br><br>  All existing workflows are grouped in directories.  The UCSD package already includes a set of standard Workflow, for example, in the System directory you can see the following: <br><ul><li>  VMWare OVF Deployment; </li><li>  VMWare VM Provision; </li><li>  VMWare Clone VM. </li></ul><br><br>  With Workflow, as with other UCSD objects, you can perform a number of standard operations, such as: <br><ul><li>  Editing; </li><li>  Export / import and export as a template; </li><li>  Cloning; </li><li>  Schedule their implementation using a sheduler; </li><li>  Lock or unlock. </li></ul><br><br><h4>  Deploying (provisioning) a virtual machine using Workflow </h4><br>  Enough theory, let's create our first workflow, with which users can deploy a virtual machine on the self-service portal.  To do this, go to the Policies -&gt; Orchestration -&gt; Workflows menu and click on the Add Workflow button.  A window appears, <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/884/edf/9d4/884edf9d48ab226b7786340230a90f46.png" alt="Add Workflow" title="Add workflow"></a> <br><br>  in which you need to specify the unique name of the Workflow - my_first_wf, the execution context (in our case Any) and select the directory in which our Workflow will be saved - IT-GRAD_TEST. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/eca/019/7ae/eca0197ae79b6e4d1656da790626b85d.png" alt="Workflow Details" title="Workflow Details"></a> <br><br>  Click Next.  Go to the "Add User Inputs" window.  Here we can determine what data Workflow will request from the user at the beginning of its execution.  In fact, ‚ÄúWorkflow User Inputs‚Äù is a typical task that will be executed during the work of our Workflow.  We will not create any additional tasks yet. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/ea9/019/2fd/ea90192fd0bf2b7db5a099b666d59622.png" alt="Workflow User Inputs" title="Workflow User Inputs"></a> <br><br>  Click Submit.  We get in the catalog IT-GRAD_TEST a new Workflow.  If you look closely at its status, you can see that the Validation Status = Failed is checked.  This is due to the fact that we have not yet defined any tasks. <br><br>  Go ahead.  We edit our WF.  You can enter the editor either by double-clicking on Workflow, or selecting it from the list to give the command Edit Workflow, or to give the command Workflow Designer. <br><br>  <i><em>Those who will somehow work with the UCSD interface will quickly notice that often the same operation can be performed in several ways.</em></i> <br><br>  Open WF Designer <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/f53/fd0/76d/f53fd076d5b6c284960c8841b9be3f5e.png" alt="Workflow Designer" title="Workflow Designer"></a> <br><br>  And we define a set of tasks that must be performed when creating a virtual machine.  Immediately I will clarify that I will use the typical task. <br><br>  First of all, we need to determine the composition of the resources created by the VM.  This can be done using a standard task - Resource Allocation.  To do this, in the search bar, type <i>allocate</i> and at the very bottom we see the task we need <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/3ba/880/b56/3ba880b563c3eb4feb554e0eda06c4f4.png" alt="  " title="Defining a set of tasks"></a> <br><br>  Mouse over dragging task in the working field <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/50f/ef5/e84/50fef5e8492c5f7929e1cf10bd596e41.png" alt=" " title="Working field"></a> <br><br>  The task setting window appears, where we can define the name of the task.  In the Task Details list, the attributes are defined, the values ‚Äã‚Äãof which will be transferred to the next task after the execution of the current task.  The list of these fields is important, since we will have to define all of them (or their part) in our next task. <br><br>  Click Next <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/dd1/1c9/cee/dd11c9ceed3ef16db586de7188c91bf8.png" alt="  " title="Customization window"></a> <br><br>  In the window that appears, we can connect the User Input and Task Input Attributes.  In Russian, this means that we can specify certain values ‚Äã‚Äãfor the task attributes, which will either be entered by the user, or they will be transferred from the previous task after its execution.  For example, we can explicitly indicate exactly how we will deploy the VM Deployment Options virtual machine ‚Äî based on a Template or based on an existing virtual machine.  If we explicitly define the way a virtual machine is deployed, the user will not have to specify it when prompted by the self-service portal (he simply will not have a choice).  You also need to understand that those attributes of tasks that are labeled Mandatory, UCSD will require to determine in any case. <br><br>  Leave everything unchanged and click Next. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/ec3/546/6c5/ec35466c54319107f5c5651d44097934.png" alt="     " title="Specifying specific values ‚Äã‚Äãfor task attributes"></a> <br><br>  In the Task Inputs window, we see that we need to define the VM deployment options, the directory and the vDC in which the created VM will be placed.  We set the necessary values ‚Äã‚Äãand we press on Submit. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/dc4/b2d/a01/dc4b2da013ad55dfe08016f047f4ded9.png" alt="Task Inputs" title="Task inputs"></a> <br><br>  As you can see, our new task machine is defined as a start machine and has two options for completion.  We will need to include all subsequent tasks in our Workflow manually. <br><br>  Now we need to add the following task, which will deploy the virtual user.  It is called VM provision. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/c1b/762/21f/c1b76221f25a3ec9630280c687116fa9.png" alt="Task VM provision" title="Task VM provision"></a> <br><br>  Interestingly, this task is placed in the Cloupia Tasks directory, unlike the previous one.  We transfer it to the working field. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/08b/7c9/4d2/08b7c94d2b49be4131665e3510f785a6.png" alt="Task VM provision" title="Task VM provision"></a> <br><br>  Name Taska leave unchanged.  Note that the VM Provision task only returns the value of the VM_ID attribute.  Click Next. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/597/042/148/59704214846e9c9b06ef21763b69d907.png" alt="Task VM provision" title="Task VM provision"></a> <br><br>  The procedure for setting the User Inputs of this task, I will try to describe in more detail.  Remember, I mentioned in the Resource Allocation task description that it outputs a set of attribute values ‚Äã‚Äãthat can be passed to the next task?  Now we will do it.  For example, let's zapapim the Select Host attribute for the transferred value from the Resource Allocation ‚ÄúALLOCATED_HOST‚Äù value.  Do the same for attribute attributes from ‚ÄúSelect Datastore‚Äù to ‚ÄúSelect Additional IPv6 Address‚Äù. <br><br>  It should look something like this: <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/ee2/7ee/d04/ee27eed043f49017b1df7d9f7c528d54.png" alt=" User Inputs" title="Configure User Inputs"></a> <br><br>  The attributes for the last three tasks ‚ÄúNumber of vCPUs‚Äù, ‚ÄúMemory‚Äù, ‚ÄúDisk‚Äù, which determine the number of virtual processors, the amount of VM memory and the size of the VM disk, respectively, can be left unchanged.  You can determine them in the next step.  And you can define them through separate User Inputs Workflow.  I will demonstrate how this can be done using the Disk Size Selector task. <br><br>  To define its attribute, click on the Manage Workflow User Inputs button in the upper part of the window and get to the Workflow User Inputs definition window. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/fc9/d4e/f46/fc9d4ef46fffeaa4e1a5c80cfff2c2ba.png" alt="  Workflow User Inputs" title="Workflow User Inputs Definition Window"></a> <br><br>  Push "+" <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/db8/150/2d6/db81502d6c31f044ba45bf34c7f04936.png" alt="  " title="Add new attribute"></a> <br><br>  Set the label and click on Select <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/27a/05b/516/27a05b516f6056625269eb2bddd2f2e6.png" alt="  " title="Add new attribute"></a> <br><br>  And we get into the window of choice of typical tasks.  We drive in the search bar "disk" and select Task Disk Size Selector. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/381/5ab/f56/3815abf565cdf1da5c8fc3cff18d0daf.png" alt=" Disk Size Selector" title="Task Disk Size Selector"></a> <br><br>  Further we can set restrictions for value of attributes of typical task.  To do this, click Admin Input Filter and determine the allowed disk size using a regular expression.  In our case, I want to limit the user's choice to 20 GB and 60 GB disks. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/255/d85/7f9/255d857f98f7f45e7df097a08d860cd8.png" alt="   " title="Attribute Value Restrictions"></a> <br><br>  A detailed description of the filter syntax can be found in the Filter Criteria section of the Syntax for Admin Input Filter in the Cisco UCS Director Orchestration Guide. <br><br>  Click Submit and again get to the User Input Mapping window.  For Disk podtaska choose the created Workflow User Inputs ‚ÄúDisk size‚Äù.  This completes the User Input Mapping settings. <br><br>  Click Next <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/2d3/516/8cf/2d35168cf52a7b5cce12ba4f9683b2c1.png" alt="User Input Mapping" title="User Input Mapping"></a> <br><br>  Please note that we again need to specify the VM Deployment Type, select a directory and vDC.  In addition, we can set a new virtual machine name and redefine the number of vCPUs and memory. <br><br>  Click Submit <br><br>  Now we need to associate the created task with other elements of our Workflow.  To do this, we need to hover the mouse on the created task and display the drop-down list for the green field On success.  In the drop-down list, select Complete (success).  For RescaLe Allocation task, we specify VMProvosoin_175 in the same list.  As a result, we obtain the following: <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/c43/667/d21/c43667d2138f627957dbeb83ad0d3942.png" alt="     Workflow" title="A bunch of task with other elements of Workflow"></a> <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/027/213/2e3/0272132e3df7cd375924445a3fe28ae8.png" alt="     Workflow" title="A bunch of task with other elements of Workflow"></a> <br><br>  And do not forget to specify what VM Provision TASK should do in case of failure. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/615/d8f/883/615d8f883a3346e73081db5b89e55035.png" alt="     Workflow" title="A bunch of task with other elements of Workflow"></a> <br><br>  That's all.  To be sure, you can click on the Validate Workflow button and, if there are no errors, click Close. <br><br><h4>  Creating a new directory </h4><br>  As I wrote in the post ‚ÄúSelf-Service with Cisco UCS Director: How to give users the opportunity to create virtual servers by themselves‚Äù, in order for users to create a virtual machine on the self-service portal, we need a directory.  In the above-mentioned post, a catalog of the type Standard was created, now we will create a directory with the Advanced type. <br><br>  To do this, go to the Policies -&gt; Catalogs menu and give the Add command. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/03d/41a/3c3/03d41a3c3ab44857adb005760b48ca8a.png" alt="Policies -> Catalogs" title="Policies -> Catalogs"></a> <br><br>  Set the name CentOS_vm_wf, type Advanced for the new catalog and select our favorite group Cust1.  Click Next. <br><br>  In comparison with the catalog in the ‚ÄúSelf-service using Cisco UCS Director we created in the post: how to enable users to create virtual servers by themselves‚Äù, there are very few settings for the Advanced type directory.  In the next window, we will indicate our new Workflow and that's it.  To do this, click on the button Select <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/d88/3ac/a4b/d883aca4b4612b837a0846a0b50970fe.png" alt=" Workflow" title="Adding Workflow"></a> <br><br>  Put a tick in front of our Workflow, again click Select, then Next and Submit.  Catalog created. <br><br><h4>  Request to create a virtual machine </h4><br>  Log in to the self-service portal as a user belonging to the Cust1 group, and launch the process of creating a new VM based on our new catalog. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/547/834/ce4/547834ce4ed9be81f9158003825cbe39.png" alt="    " title="Request to create a virtual machine"></a> <br><br>  Remember that the values ‚Äã‚Äãfor such parameters as, for example, the number of vCPUs or the amount of memory we set at the stage of creating Workflow, and the user was given the choice of the size of the VM disk <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/c97/c22/148/c97c2214806034b29ae8fb7c26558224.png" alt="    " title="Request to create a virtual machine"></a> <br><br>  Let's set the size we need and presses Next, then Submit. <br><br>  Let's look at the progress of our query, as we see the car is already unfolding :-) <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/23a/09e/ec1/23a09eec1ab7c8b6eb6478bdafb13544.png" alt="  " title="Query progress"></a> <br><br>  That's all.  I tried to tell about the most important and interesting functionality of Cisco UCSD as easy and clear as possible. </div><p>Source: <a href="https://habr.com/ru/post/229081/">https://habr.com/ru/post/229081/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229069/index.html">Linux Foundation introduced the first release of the OS for the car</a></li>
<li><a href="../229071/index.html">We give animation life</a></li>
<li><a href="../229073/index.html">Cisco telemetry telemetry against cyber threats</a></li>
<li><a href="../229077/index.html">NASA funds the development of plasma "parachutes"</a></li>
<li><a href="../229079/index.html">Review epitaph of Samsung Gear Live</a></li>
<li><a href="../229083/index.html">How to manage cloud resources with Python? We raise clusters on demand through several lines of code</a></li>
<li><a href="../229085/index.html">How Software Engineering differs from Computer Science</a></li>
<li><a href="../229087/index.html">Engineers and linguists once again entered into dialogue</a></li>
<li><a href="../229091/index.html">Transmission from the depths of the sea: 800 km long NEPTUNE channel holds the Internet to the bottom of the ocean</a></li>
<li><a href="../229093/index.html">Voice over LTE - call without fallback with a very fast call. How we did it</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>