<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PowerShell, dump my experience</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 


 This article is addressed to those who have already become familiar with the basics of PowerShell, run some scripts with stack exchan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PowerShell, dump my experience</h1><div class="post__text post__text-html js-mediator-article"><h2 id="vvedenie">  Introduction </h2><br><p>  This article is addressed to those who have already become familiar with the basics of PowerShell, run some scripts with stack exchange, and probably have their own text file with certain snippets that facilitate everyday work.  The purpose of writing it is to reduce entropy, increase readability and maintainability of the PowerShell code used in your company and, as a result, increase the productivity of the administrator working with it. </p><br><p><img src="https://habrastorage.org/webt/go/9u/yw/go9uywfoytxpgrxmggcvf2bfi8e.png" alt="kdpv"></p><br><p>  At my previous place of work, I, due to the specifics of the tasks and the imperfection of the world, have greatly pumped my skills with PowerShell.  After the change of work, this kind of load has greatly decreased, and everything that was just about at the fingertips began to sink deeper under the experience of solving new problems on new technologies.  From this article claims to be only what he declares himself, revealing a list of topics that in my opinion would be useful to me about 7 years ago, when my acquaintance with this tool was just beginning. </p><a name="habracut"></a><br><p>  If you don‚Äôt understand why PowerShell is an object-oriented shell, what bonuses come from it and why it is necessary at all, despite the cries of haters, I will advise you a good book that quickly introduces this medium - <a href="http://www.bhv.ru/books/book.php%3Fid%3D184521">Popov Andrei Vladimirovich, Introduction to Windows PowerShell</a> .  Yes, it is about the old version of PS, yes, the language has gained some extensions and improvements, but this book is good because describing the early stage of development of this environment involuntarily focuses only on fundamental things.  The syntactic sugar, which overgrown with the environment, I think you quickly understand without understanding how the concept itself works.  Reading this book will take you literally a couple of evenings, come back after reading. </p><br><p><img src="https://habrastorage.org/webt/g9/ea/h9/g9eah9nfoao7gukeochjqasi2ne.jpeg" alt="popov"></p><br><p>  The book is also available on the author‚Äôs website, although I‚Äôm not sure how licensed the use is: <a href="https://andpop.ru/courses/winscript/books/posh_popov.pdf">https://andpop.ru/courses/winscript/books/posh_popov.pdf</a> </p><br><h2 id="stayl-gaydy">  Style Guides </h2><br><p>  Making the scripts according to the style guides is a good practice in all cases of its use, there can hardly be two opinions.  Some ecosystems have taken care of this at the level of native tilling, from the obvious, pep8 comes to mind in the Python community and go fmt in Golang.  These are invaluable time-saving tools that unfortunately are missing in the standard PowerShell delivery, and that doesn‚Äôt transfer the problem to your head.  The only way to solve the problem of uniform code formatting at the moment is to generate reflexes by repeatedly writing code that satisfies the style guide (actually, no). </p><br><p>  Due to the lack of officially approved and described in detail by Microsoft, the Stylguides were born in the community at the time of PowerShell v3 and have since developed in an open form on the github: <a href="https://github.com/PoshCode/PowerShellPracticeAndStyle">PowerShell</a> PracticeAndStyle.  This is a worthwhile repository for anyone who has ever used the "Save" button in PowerShell ise. </p><br><p>  If you try to make a squeeze, it will probably be reduced to the following points: </p><br><ul><li>  PowerShell uses PascalCase to name variables, cmdlets, module names, and almost everything, with the exception of operators; </li><li> Operators of the language, such as <code>if</code> , <code>switch</code> , <code>break</code> , <code>process</code> , <code>-match</code> are written in lowercase letters; </li><li>  Braces are placed in the <a href="https://en.wikipedia.org/wiki/Indentation_style">only correct way</a> , otherwise called the style of Kernighan and Richie, leading his story from the book <a href="https://en.wikipedia.org/wiki/The_C_Programming_Language">The C Programming Language</a> ; </li><li>  Do not use aliases anywhere other than an interactive console session, do not write any <code>ps | ? processname -eq firefox | %{$ws=0}{$ws+=$_.workingset}{$ws/1MB}</code> <code>ps | ? processname -eq firefox | %{$ws=0}{$ws+=$_.workingset}{$ws/1MB}</code>  <code>ps | ? processname -eq firefox | %{$ws=0}{$ws+=$_.workingset}{$ws/1MB}</code> ; </li><li>  Specify explicitly the names of the parameters, the <a href="https://docs.microsoft.com/ru-ru/PowerShell/scripting/whats-new/breaking-changes-ps6%3Fview%3DPowerShell-6">behavior of the cmdlets and their signature can change</a> , plus to this, a person unfamiliar with a particular cmdlet will add context; </li><li>  Make out the parameters for calling scripts, but do not write a function inside the script and with the last line call this function with the need to change the values ‚Äã‚Äãof global variables instead of specifying parameters; </li><li>  Specify [CmdletBinding ()] - this will give your- <code>-Verbose</code> and <code>-Debug</code> flags and <a href="https://4sysops.com/archives/PowerShell-advanced-functions-the-cmdletbinding-and-parameter-attribute/">many other useful features</a> .  Despite the firmness of the position of some purists in the community, I am not in favor of indicating this attribute in simple inline functions and filters consisting of literal several lines; </li><li>  Write a comment-based help: one sentence, a link to a ticket, an example of a call; </li><li>  Specify the required version of PowerShell in the <code>#requires</code> section; </li><li>  Use <code>Set-StrictMode -Version Latest</code> <a href="https://docs.microsoft.com/en-us/PowerShell/module/microsoft.PowerShell.core/set-strictmode">to help you avoid the problems described below</a> ; </li><li>  Handle errors; </li><li>  Do not rush to rewrite everything on PowerShell.  PowerShell is first and foremost a shell and calling binaries is its direct task.  There is nothing wrong with using robocopy in a script, it is not rsync, of course, but also very good. </li></ul><br><h2 id="comment-based-help">  Comment Based Help </h2><br><p>  Below is an example of how to issue help script.  The script frames the image by bringing it to the square and performs a resize, I think you have a task to make avatars for users (except for turning according to exif).  In the <code>.EXAMPLE</code> section <code>.EXAMPLE</code> is an example of use, try it.  Because PowerShell is executed by the common language runtime, the same as other dotnet languages, it has the ability to use the full power of the dotnet libraries: </p><br><pre> <code class="plaintext hljs">&lt;# .SYNOPSIS Resize-Image resizes an image file .DESCRIPTION This function uses the native .NET API to crop a square and resize an image file .PARAMETER InputFile Specify the path to the image .PARAMETER OutputFile Specify the path to the resized image .PARAMETER SquareHeight Define the size of the side of the square of the cropped image. .PARAMETER Quality Jpeg compression ratio .EXAMPLE Resize the image to a specific size: .\Resize-Image.ps1 -InputFile "C:\userpic.jpg" -OutputFile "C:\userpic-400.jpg"-SquareHeight 400 #&gt; # requires -version 3 [CmdletBinding()] Param( [Parameter( Mandatory )] [string]$InputFile, [Parameter( Mandatory )] [string]$OutputFile, [Parameter( Mandatory )] [int32]$SquareHeight, [ValidateRange( 1, 100 )] [int]$Quality = 85 ) # Add System.Drawing assembly Add-Type -AssemblyName System.Drawing # Open image file $Image = [System.Drawing.Image]::FromFile( $InputFile ) # Calculate the offset for centering the image $SquareSide = if ( $Image.Height -lt $Image.Width ) { $Image.Height $Offset = 0 } else { $Image.Width $Offset = ( $Image.Height - $Image.Width ) / 2 } # Create empty square canvas for the new image $SquareImage = New-Object System.Drawing.Bitmap( $SquareSide, $SquareSide ) $SquareImage.SetResolution( $Image.HorizontalResolution, $Image.VerticalResolution ) # Draw new image on the empty canvas $Canvas = [System.Drawing.Graphics]::FromImage( $SquareImage ) $Canvas.DrawImage( $Image, 0, -$Offset ) # Resize image $ResultImage = New-Object System.Drawing.Bitmap( $SquareHeight, $SquareHeight ) $Canvas = [System.Drawing.Graphics]::FromImage( $ResultImage ) $Canvas.DrawImage( $SquareImage, 0, 0, $SquareHeight, $SquareHeight ) $ImageCodecInfo = [System.Drawing.Imaging.ImageCodecInfo]::GetImageEncoders() | Where-Object MimeType -eq 'image/jpeg' # https://msdn.microsoft.com/ru-ru/library/hwkztaft(v=vs.110).aspx $EncoderQuality = [System.Drawing.Imaging.Encoder]::Quality $EncoderParameters = New-Object System.Drawing.Imaging.EncoderParameters( 1 ) $EncoderParameters.Param[0] = New-Object System.Drawing.Imaging.EncoderParameter( $EncoderQuality, $Quality ) # Save the image $ResultImage.Save( $OutputFile, $ImageCodecInfo, $EncoderParameters )</code> </pre> <br><p>  The script above begins with a multi-line comment <code>&lt;# ... #&gt;</code> , in the event that this comment comes first and contains certain keywords, PowerShell will guess to automatically build help for the script.  This kind of help is literally called - a <a href="https://docs.microsoft.com/en-us/PowerShell/module/microsoft.PowerShell.core/about/about_comment_based_help">reference based on a comment</a> : </p><br><p><img src="https://habrastorage.org/webt/9y/tw/d3/9ytwd3hlr6yb5nsobqqor_bjshw.png" alt="help"></p><br><p>  Moreover, when calling the script, hints on parameters will work, be it a PowerShell console, be it a code editor: </p><br><p><img src="https://habrastorage.org/webt/tr/ha/qg/trhaqga49fwvjphbl6i_cporowa.png" alt="inline help"></p><br><p>  Once again I will draw attention to the fact that she should not be neglected.  If you do not know what to write there, write something, go to the cooler and on return you will have an understanding of what needs to be changed in the written.  It works.  You shouldn't fanatically fill in all the keywords, PowerShell is designed to be self-documenting and if you gave meaningful and full names to the parameters, a short sentence in the <code>.SYNOPIS</code> section and one example will be enough. </p><br><h2 id="strict-mode">  Strict mode </h2><br><p>  PowerShell, like many other scripting languages, has dynamic typing.  There are many supporters of this type of typing: writing simple but powerful high-level logic is a matter of a couple of minutes, but when your decision starts to creep up to a thousand lines, you will definitely encounter the fragility of this approach. </p><br><p>  The auto-output of types at the testing stage, the formed array in the place where you always received a set of elements, will surely enclose a pig if it receives one element and now in the following condition, instead of checking the number of elements you will receive the number of characters or another attribute, depending on item type  The script logic will break, while the execution environment will pretend that everything is fine. </p><br><p>  Setting a strict mode helps to avoid some of this kind of problem, but it also requires a bit more code from you, like initializing variables and explicit casting. </p><br><p>  This mode is enabled by the <code>Set-StrictMode -Version Latest</code> cmdlet, although there are other options for "strictness", my choice is to use the latter. </p><br><p>  In the example below, strict mode catches a call to a non-existent property.  Since there is only one element inside the folder, the type of <code>$Input</code> as a result of execution will be <code>FileInfo</code> , and not the expected array of corresponding elements: </p><br><p><img src="https://habrastorage.org/webt/fk/q-/jk/fkq-jkrdldogwcwyiwkwspskseq.png" alt="strict"></p><br><p>  To avoid such a problem, the result of running the cmdlet should explicitly result in an array: </p><br><pre> <code class="plaintext hljs">$Items = @( Get-ChildItem C:\Users\snd3r\Nextcloud )</code> </pre> <br><p>  Make it a rule to always set strict mode, this will allow you to avoid unexpected results of executing your scripts. </p><br><h2 id="obrabotka-oshibok">  Error processing </h2><br><h3 id="erroractionpreference">  ErrorActionPreference </h3><br><p>  Looking through other people's scripts, for example on a githaba, I often see either a complete disregard for the error handling mechanism, or the explicit inclusion of the silent continuation mode in case of an error.  The issue of error handling is certainly not the easiest to program in general and in scripts in particular, but it definitely does not deserve ignoring.  By default, PowerShell in case of an error displays it and continues to work (I simplified the concept a bit, but below will be a link to a git book on this topic).  This is convenient if you urgently need to extend the update of a program that is widely used in the domain to all machines, without waiting for it to spill over to all sccm deployment points or spread in another way used by you.  It is unpleasant to interrupt and restart the process in case one of the machines is turned off, this is true. </p><br><p>  On the other hand, if you are doing a complex backup of a system consisting of more than one data file of more than one part of an information system, you need to be sure that your backup is consistent and that all the necessary data sets have been copied without errors. </p><br><p>  To change the behavior of cmdlets in the event of an error, there is a global variable <code>$ErrorActionPreference</code> , with the following list of possible values: <a href="https://docs.microsoft.com/en-us/PowerShell/module/microsoft.PowerShell.core/about/about_preference_variables">Stop, Inquire, Continue, Suspend, SilentlyContinue</a> . </p><br><p>  I recommend always using the <code>Stop</code> value when the number of scripts or their complexity ceases to remain on the stack in the head, it is better to be sure that in any unforeseen situation the script will stop its work and not break the firewood "quietly", having completed the execution "successfully." </p><br><p>  In addition to stopping the script, if something went wrong, there is another prerequisite for its use - the handling of exceptional situations.  There is a <code>try/catch</code> construct for this, but it only works if the error causes the execution to stop.  The stop must not be enabled at the level of the entire script, <code>ErrorAction</code> can be set at the cmdlet level by the parameter </p><br><pre> <code class="plaintext hljs">Get-ChildItem 'C:\System Volume Information\' -ErrorAction 'Stop'</code> </pre> <br><p>  Actually, this possibility defines two logical strategies: resolve all errors "by default" and set the <code>ErrorAction</code> only for critical places where they should be processed;  or include at the level of the entire script by setting the value of a global variable and set <code>-ErrorAction 'Continue'</code> on non-critical operations.  I always choose the second option, I do not rush to impose it on you, I recommend only once to sort out this issue and use this useful tool. </p><br><h3 id="trycatch">  try / catch </h3><br><p>  In the error handler, you can match by the type of exception and operate with the flow of execution, or, for example, add a little more information.  Although using the <code>try/catch/throw/trap</code> you can build the entire flow of script execution, you should categorically avoid this, since this way of operating with the execution is not only considered an extreme antipattern, from the category of "goto-noodles", It also drains performance a lot. </p><br><pre> <code class="plaintext hljs">#requires -version 3 $ErrorActionPreference = 'Stop' #   ,    , #          $Logger = Get-Logger "$PSScriptRoot\Log.txt" #    trap { $Logger.AddErrorRecord( $_ ) exit 1 } #    $count = 1; while ( $true ) { try { #   $StorageServers = @( Get-ADGroupMember -Identity StorageServers | Select-Object -Expand Name ) } catch [System.Management.Automation.CommandNotFoundException] { #      ,         throw " Get-ADGroupMember ,    Active Directory module for PowerShell; $( $_.Exception.Message )" } catch [System.TimeoutException] { #             if ( $count -le 3 ) { $count++; Start-Sleep -S 10; continue } #             throw "     -   ,   $count ; $( $_.Exception.Message )" } #         break }</code> </pre> <br><p>  It is worth noting the operator <code>trap</code> - this is a global error trap.  She catches everything that has not been processed at lower levels, or is thrown out of the exception handler due to the impossibility of correcting the situation on her own. </p><br><p>  In addition to the object-oriented exception approach described above, PowerShell also provides more familiar concepts that are compatible with other "classic" shells, such as error streams, return codes, and variables accumulating errors.  All this is certainly convenient, sometimes without alternative, but beyond the scope of this, generally overview, topic.  Fortunately, there is a <a href="https://devops-collective-inc.gitbook.io/the-big-book-of-powershell-error-handling/">good open book on github</a> on this topic. </p><br><p>  The logger code that I use when there is no certainty that PowerShell 5 will be in the system (where you can describe the logger class more conveniently), try it, it can be useful to you because of its simplicity and brevity, you will surely add additional methods. : </p><br><pre> <code class="plaintext hljs">#   " ",   PowerShell v3 function Get-Logger { [CmdletBinding()] param ( [Parameter( Mandatory = $true )] [string] $LogPath, [string] $TimeFormat = 'yyyy-MM-dd HH:mm:ss' ) $LogsDir = [System.IO.Path]::GetDirectoryName( $LogPath ) New-Item $LogsDir -ItemType Directory -Force | Out-Null New-Item $LogPath -ItemType File -Force | Out-Null $Logger = [PSCustomObject]@{ LogPath = $LogPath TimeFormat = $TimeFormat } Add-Member -InputObject $Logger -MemberType ScriptMethod AddErrorRecord -Value { param( [Parameter( Mandatory = $true )] [string]$String ) "$( Get-Date -Format 'yyyy-MM-dd HH:mm:ss' ) [Error] $String" | Out-File $this.LogPath -Append } return $Logger }</code> </pre> <br><p>  I repeat the idea - do not ignore error handling.  It will save your time and nerves in the long run. <br>  Do not think that the execution of the script in spite of everything is good.  Well - it's time to fall without breaking the wood. </p><br><h2 id="instrumenty">  Instruments </h2><br><p>  It‚Äôs definitely worth starting an improvement on tools for working with PowerShell from a console emulator.  I have often heard from supporters of alternative OS that the console in windows is bad and that it is not a console at all, but dos and so on.  Few people could adequately formulate their claims to this effect, but if someone succeeded, then in fact it turned out that all problems could be solved.  More about the terminals and the new console in windows on the Habr√© already, <a href="https://habr.com/ru/post/420853/">everything is more than ok</a> . </p><br><p>  The first step is to install Conemu or its Cmder assembly, which is not particularly important, since in my opinion it‚Äôs worth running through the settings anyway.  I usually choose the cmder in the minimum configuration, without the gita and other binaries that I set myself, although I have been configuring my own config for pure Conemu for several years.  This is really the best terminal emulator for windows, allowing you to split the screen (for tmux / screen fans), create tabs and enable the quake-style console mode: </p><br><h3 id="conemu">  Conemu </h3><br><p><img src="https://habrastorage.org/webt/ag/2w/hy/ag2whyp2okkhyroygpuzjkdamis.png" alt="cmder"></p><br><p>  The next step I recommend to put the modules: <a href="https://github.com/JanDeDobbeleer/oh-my-posh">oh-my-posh</a> , <a href="https://github.com/dahlbyk/posh-git">posh-git</a> and <a href="https://github.com/lzybkr/PSReadLine">PSReadLine</a> .  The first two will make promt more pleasant by adding information about the current session, the status of the last command executed, the privilege indicator and the status of the git repository in the current location.  PSReadLine pumps up proms heavily by adding for example a search through the history of commands entered (CRTL + R) and handy hints for cmdlets on CRTL + Space: </p><br><p><img src="https://habrastorage.org/webt/eg/w6/f2/egw6f2sa43hgi3dhwn_hhgxbesa.gif" alt="readline"></p><br><p>  And yes, now the console can be cleared with CTRL + L, and forget about <code>cls</code> . </p><br><h3 id="visual-studio-code">  Visual studio code </h3><br><p>  Editor.  All the worst that I can say about PowerShell belongs exclusively to PowerShell ISE, those who have seen the first version with three panels will hardly forget this experience.  The different terminal coding, lack of basic features of the editor, such as automatic indent, auto-closing brackets, code formatting, and a whole set of antipatterns generated by it about which I will not tell you (just in case) are all about ISE. </p><br><p>  Do not use it, use Visual Studio Code with the PowerShell extension - there‚Äôs everything you want (within reasonable limits, of course).  And do not forget that in PoweShell up to the sixth version (PowerShell Core 6.0) the encoding for scripts is UTF8 BOM, otherwise the Russian language will break. </p><br><p><img src="https://habrastorage.org/webt/dd/c0/pa/ddc0paj-xbx5tysllsrmzlxnugi.png" alt="vscode"></p><br><p>  In addition to syntax highlighting, method hints, and script debugging capabilities, the plugin installs a linter that will also help you follow established practices in the community, for example, in one click (on a light bulb), expand the abbreviations.  In fact, this is a normal module that can be <a href="https://github.com/PowerShell/PSScriptAnalyzer">installed</a> independently, for example, adding it to your script signature <a href="https://github.com/PowerShell/PSScriptAnalyzer">pipe</a> : <a href="https://github.com/PowerShell/PSScriptAnalyzer">PSScriptAnalyzer</a> </p><br><p><img src="https://habrastorage.org/webt/mj/x7/ov/mjx7ovrtephqcdctuiptdu_tff4.png" alt="PSScriptAnalyzer"></p><br><p>  You can set the code formatting options in the extension settings, for all settings (and the editor and extensions) there is a search: <code>File - Preferences - Settings</code> : </p><br><p><img src="https://habrastorage.org/webt/ia/xr/km/iaxrkmgjcpcf4wck1ocb7kfp9ym.png" alt="Otbs"></p><br><p>  In order to get a new conpty console, you <a href="https://code.visualstudio.com/updates/v1_31">should set the flag in the settings</a> ; later, this advice will probably be irrelevant. </p><br><p>  It is worth remembering that any action in VS Code can be performed from the control center called by the combination CTRL + Shift + P. Format the piece of code <a href="https://t.me/PowerShellrus">inserted from the chat</a> , sort the lines alphabetically, change the index from spaces to tabs and so on, all this in the control center. </p><br><p>  For example, enable the full screen and the editor layout in the center: </p><br><p><img src="https://habrastorage.org/webt/3z/w9/-a/3zw9-avzniwjgooxfa1dvzi9kfc.png" alt="layout"></p><br><h3 id="source-control-git-svn">  Source Control;  Git svn </h3><br><p>  Often, Windows system administrators have a conflict resolution phobia in version control systems, probably from the fact that if a representative of this set uses git, it is often one and does not encounter any problems of this kind.  With vscode, conflict resolution is literally reduced to mouse clicks on those parts of the code that need to be left or replaced. </p><br><p><img src="https://habrastorage.org/webt/ft/fd/8f/ftfd8f1ylxofsckzu6v1uujok1e.png" alt="merge"></p><br><p>  Here these inscriptions between 303 and 304 lines are clickable, you should click on all such that appear in the document in case of conflict, commit commit changes and send the changes to the server.  U - Convenience. </p><br><p>  About how to work with version control systems is available and with pictures <a href="https://code.visualstudio.com/docs/editor/versioncontrol">written in the vscode dock</a> , run your eyes to the end there briefly and well. </p><br><h3 id="snippets">  Snippets </h3><br><p>  <a href="">Snippets</a> - a kind of macros / templates to speed up the writing of code.  Definitely a must see. </p><br><p>  Quick object creation: </p><br><p><img src="https://habrastorage.org/webt/yi/wp/om/yiwpomlohxird5oovnutj4hc7ec.gif" alt="customobject"></p><br><p>  Fish for comment-based help: </p><br><p><img src="https://habrastorage.org/webt/ol/jn/37/oljn37jxzabxa9h4yqquuh98s9i.gif" alt="help"></p><br><p>  In the event that the cmdlet needs to pass a large number of parameters, it makes sense to <a href="https://docs.microsoft.com/en-us/PowerShell/module/microsoft.PowerShell.core/about/about_splatting">use splatting</a> . <br>  Here is a snippet for it: </p><br><p><img src="https://habrastorage.org/webt/lx/y_/ek/lxy_ekyxsjsuiad66yzqqfoxzta.gif" alt="splatting"></p><br><p>  View all available snippets available by Ctrl + Alt + J: </p><br><p><img src="https://habrastorage.org/webt/0p/jm/k_/0pjmk_nms2ejlugtcsxvp1vjhea.gif" alt="snippets"></p><br><p>  If after this you have a desire to continue to improve your environment, but you haven‚Äôt heard about <a href="https://github.com/janikvonrotz/awesome-PowerShell">wasp-sheets yet, then here you are</a> .  Also, if you have your own set of extensions that you can use when writing PowerShell scripts, I will be glad to see their list in the comments. </p><br><h2 id="proizvoditelnost">  Performance </h2><br><p>  The topic of performance is not as simple as it may seem at first glance.  On the one hand, premature optimizations can greatly reduce readability and maintainability of the code, saving 300ms of script execution time, the usual time of which can be ten minutes, their use in this case is certainly destructive.  On the other hand, there are several fairly simple techniques that increase both the readability of the code and the speed of its work, which are quite appropriate to use on an ongoing basis.  Below I will talk about some of them, in case if the performance is all for you, and readability takes a back seat due to the severe time constraints of service downtime during the service, I recommend referring to the <a href="https://docs.microsoft.com/ru-ru/windows-server/administration/performance-tuning/PowerShell/script-authoring-considerations">relevant</a> literature. </p><br><h3 id="pipeline-i-foreach">  Pipeline and foreach </h3><br><p>  The easiest and always working way to increase productivity is to avoid using the pipes.  Because of type safety and convenience of operation, PowerShell skips elements through the pipe and wraps each of them into an object.  In dotnet languages, this behavior <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/types/boxing-and-unboxing">is called boxing</a> .  Boxing is good, it guarantees security, but it has its own price, which sometimes makes no sense to pay. </p><br><p>  The first step is to improve performance and, in my opinion, you can increase readability by removing all applications from the <code>Foreach-Object</code> and replacing it with the foreach operator.  You can be embarrassed by the fact that they are actually two different entities, because <code>foreach</code> is an alias for <code>Foreach-Object</code> - in practice, the main difference is that <code>foreach</code> does not take values ‚Äã‚Äãfrom the pipeline, while it works by experience up to three times faster. </p><br><p>  Imagine the task: we need to process a large log to form some of its derivative, for example, select and lead to a different format a number of records in it: </p><br><pre> <code class="plaintext hljs">Get-Content D:\temp\SomeHeavy.log | Select-String '328117'</code> </pre> <br><p>        ‚Äî       ,      .         ‚Äî ,        ,    <code>Get-Content</code> .                  <code>string</code>  ,    ,            .    ‚Äî      ,         : </p><br><blockquote> When reading from and writing to binary files, use the AsByteStream parameter and a value of 0 for the ReadCount parameter. A ReadCount value of 0 reads the entire file in a single read operation. The default ReadCount value, 1, reads one byte in each read operation and converts each byte into a separate object, which causes errors when you use the Set-Content cmdlet to write the bytes to a file unless you use AsByteStream <br><br> <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-content">https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-content</a> </blockquote><br><pre> <code class="plaintext hljs">Get-Content D:\temp\SomeHeavy.log -ReadCount 0 | Select-String '328117'</code> </pre> <br><p>                : </p><br><p><img src="https://habrastorage.org/webt/t2/bg/hw/t2bghwyeop1gofgu_tapyqimp3o.png" alt="readcount"></p><br><p>        ,          .    <code>Select-String</code>          ‚Äî       .                ,          <code>Select-String</code> .      ,      <code>Select-String</code>       ,        ,             : </p><br><pre> <code class="plaintext hljs">foreach ( $line in ( Get-Content D:\temp\SomeHeavy.log -ReadCount 0 )) { if ( $line -match '328117' ) { $line } }</code> </pre> <br><p>        30 , -   30%,           ,         ,        , - ,   (     ;-).      ,     .         ,    <code>-match</code> ;   ‚Äî     .                ,      ‚Äî               ‚Äî   -   ,    . </p><br><p>   ‚Äî -   ,   " "              : </p><br><pre> <code class="plaintext hljs">foreach ( $line in ( Get-Content D:\temp\SomeHeavy.log -ReadCount 0 )) { if ( $line -match '328117' ) { "$( Get-Date -UFormat '%d.%m.%Y %H:%M:%S') $line" | Out-File D:\temp\Result.log -Append } }</code> </pre> <br><p>     <code>Measure-Command</code> : </p><br><pre> <code class="plaintext hljs">Hours : 2 Minutes : 20 Seconds : 9 Milliseconds : 101</code> </pre> <br><p>   .   ,           ,          ,      .    ,    PowerShell           ,    ,       ‚Äî        .         ,    ,            ‚Äî <a href="https://docs.microsoft.com/ru-ru/dotnet/api/system.text.stringbuilder">StringBuilder</a> .                 ,            ,           .          ,                     . </p><br><pre> <code class="plaintext hljs">$StringBuilder = New-Object System.Text.StringBuilder foreach ( $line in ( Get-Content D:\temp\SomeHeavy.log -ReadCount 0 )) { if ( $line -match '328117' ) { $null = $StringBuilder.AppendLine( "$( Get-Date -UFormat '%d.%m.%Y %H:%M:%S') $line" ) } } Out-File -InputObject $StringBuilder.ToString() -FilePath D:\temp\Result.log -Append -Encoding UTF8</code> </pre> <br><p>      5 ,      : </p><br><pre> <code class="plaintext hljs">Hours : 0 Minutes : 5 Seconds : 37 Milliseconds : 150</code> </pre> <br><p>    <code>Out-File -InputObject</code> ,    ,       .          ‚Äî        <a href="https://learn-powershell.net/2013/05/07/tips-on-implementing-pipeline-support/">   </a>    .              ‚Äî  <code>Get-Help</code>     <code>-Full</code> ,         <code>Accept pipeline input? true (ByValue)</code> : </p><br><pre> <code class="plaintext hljs">-InputObject &lt;psobject&gt; Required? false Position? Named Accept pipeline input? true (ByValue) Parameter set name (All) Aliases None Dynamic? false</code> </pre> <br><p>    PowerShell     : </p><br><p><img src="https://habrastorage.org/webt/8d/zl/r-/8dzlr-yjpt13avpi_wjibzdpnxs.png" alt="taskmgr"></p><br><p>    <code>StringBuilder</code>                           : </p><br><p><img src="https://habrastorage.org/webt/lc/4j/1c/lc4j1c3-um9jozjohlauurwzo3a.png" alt="stringbuilder alloc"></p><br><p>    ,    ,  3  3.        dotnet-      ‚Äî <a href="https://docs.microsoft.com/ru-ru/dotnet/api/system.io.streamreader">StreamReader</a> . </p><br><pre> <code class="plaintext hljs">$StringBuilder = New-Object System.Text.StringBuilder $StreamReader = New-Object System.IO.StreamReader 'D:\temp\SomeHeavy.log' while ( $line = $StreamReader.ReadLine()) { if ( $line -match '328117' ) { $null = $StringBuilder.AppendLine( "$( Get-Date -UFormat '%d.%m.%Y %H:%M:%S') $line" ) } } $StreamReader.Dispose() Out-File -InputObject $StringBuilder.ToString() -FilePath C:\temp\Result.log -Append -Encoding UTF8</code> </pre> <br><pre> <code class="plaintext hljs">Hours : 0 Minutes : 5 Seconds : 33 Milliseconds : 657</code> </pre> <br><p>      ,       .               ,     ,       ,    ,          2.        ,          : </p><br><p><img src="https://habrastorage.org/webt/wr/ka/_w/wrka_wcvj1idodxx_37ka8wnhmm.png" alt="streamreader"></p><br><p>        ‚Äî      "",   ‚Äî  <code>StringBuilder</code> ‚Äî ""       .   ,      (  100)           .       ‚Äî       90%    (        ,     ): </p><br><pre> <code class="plaintext hljs">$BufferSize = 104857600 $StringBuilder = New-Object System.Text.StringBuilder $BufferSize $StreamReader = New-Object System.IO.StreamReader 'C:\temp\SomeHeavy.log' while ( $line = $StreamReader.ReadLine()) { if ( $line -match '1443' ) { #      if ( $StringBuilder.Length -gt ( $BufferSize - ( $BufferSize * 0.1 ))) { Out-File -InputObject $StringBuilder.ToString() -FilePath C:\temp\Result.log -Append -Encoding UTF8 $StringBuilder.Clear() } $null = $StringBuilder.AppendLine( "$( Get-Date -UFormat '%d.%m.%Y %H:%M:%S') $line" ) } } Out-File -InputObject $StringBuilder.ToString() -FilePath C:\temp\Result.log -Append -Encoding UTF8 $StreamReader.Dispose()</code> </pre> <br><pre> <code class="plaintext hljs">Hours : 0 Minutes : 5 Seconds : 53 Milliseconds : 417</code> </pre> <br><p>     1      : </p><br><p><img src="https://habrastorage.org/webt/rg/ro/f6/rgrof6lxdcrx96urvmxuflcbdbc.png" alt="streamreader with dump"></p><br><p>              ,                 .     ,      ,        <a href="https://docs.microsoft.com/ru-ru/dotnet/api/system.io.streamwriter">StreamWriter</a> ,   ,   ;-)      ,        ,    . </p><br><p> -     ‚Äî     ,        .    ,     ‚Äî  .  <code>Select-String</code>  <code>Out-File</code>    ,        <code>OutOfMemoryException</code> ,    ‚Äî    . </p><br><h3 id="nativnye-binarniki">   </h3><br><p> ,      PowerShell         ,         ‚Äî ,  : PowerShell ‚Äî          ,     . </p><br><p>  ,       <code>StringBuilder</code>     <code>dir</code> ‚Äî          (  ).          : </p><br><pre> <code class="plaintext hljs">$CurrentPath = ( Get-Location ).Path + '\' $StringBuilder = New-Object System.Text.StringBuilder foreach ( $Line in ( &amp;cmd /c dir /b /s /ad )) { $null = $StringBuilder.AppendLine( $Line.Replace( $CurrentPath, '.' )) } $StringBuilder.ToString()</code> </pre> <br><pre> <code class="plaintext hljs">Hours : 0 Minutes : 0 Seconds : 3 Milliseconds : 9</code> </pre> <br><pre> <code class="plaintext hljs">$StringBuilder = New-Object System.Text.StringBuilder foreach ( $Line in ( Get-ChildItem -File -Recurse | Resolve-Path -Relative )) { $null = $StringBuilder.AppendLine( $Line ) } $StringBuilder.ToString()</code> </pre> <br><pre> <code class="plaintext hljs">Hours : 0 Minutes : 0 Seconds : 16 Milliseconds : 337</code> </pre> <br><p>     $null ‚Äî     .  ,    ‚Äî    <code>Out-Null</code> ;  ,    (   <code>$null</code> )     ,   . </p><br><pre> <code class="plaintext hljs"># : $null = $StringBuilder.AppendLine( $Line ) # : $StringBuilder.AppendLine( $Line ) | Out-Null</code> </pre> <br><p>           ,          ,  .      <code>Compare-Object</code> ,      ,      ,       .            robocopy.exe,      (   PowerShell 5),      : </p><br><pre> <code class="plaintext hljs">class Robocopy { [String]$RobocopyPath Robocopy () { $this.RobocopyPath = Join-Path $env:SystemRoot 'System32\Robocopy.exe' if ( -not ( Test-Path $this.RobocopyPath -PathType Leaf )) { throw '    ' } } [void]CopyFile ( [String]$SourceFile, [String]$DestinationFolder ) { $this.CopyFile( $SourceFile, $DestinationFolder, $false ) } [void]CopyFile ( [String]$SourceFile, [String]$DestinationFolder, [bool]$Archive ) { $FileName = [IO.Path]::GetFileName( $SourceFile ) $FolderName = [IO.Path]::GetDirectoryName( $SourceFile ) $Arguments = @( '/R:0', '/NP', '/NC', '/NS', '/NJH', '/NJS', '/NDL' ) if ( $Archive ) { $Arguments += $( '/A+:a' ) } $ErrorFlag = $false &amp;$this.RobocopyPath $FolderName $DestinationFolder $FileName $Arguments | Foreach-Object { if ( $ErrorFlag ) { $ErrorFlag = $false throw "$_ $ErrorString" } else { if ( $_ -match '(?&lt;=\(0x[\da-f]{8}\))(?&lt;text&gt;(.+$))' ) { $ErrorFlag = $true $ErrorString = $matches.text } else { $Logger.AddRecord( $_.Trim()) } } } if ( $LASTEXITCODE -eq 8 ) { throw 'Some files or directories could not be copied' } if ( $LASTEXITCODE -eq 16 ) { throw 'Robocopy did not copy any files. Check the command line parameters and verify that Robocopy has enough rights to write to the destination folder.' } } [void]SyncFolders ( [String]$SourceFolder, [String]$DestinationFolder ) { $this.SyncFolders( $SourceFolder, $DestinationFolder, '*.*', '', $false ) } [void]SyncFolders ( [String]$SourceFolder, [String]$DestinationFolder, [Bool]$Archive ) { $this.SyncFolders( $SourceFolder, $DestinationFolder, '*.*', '', $Archive ) } [void]SyncFolders ( [String]$SourceFolder, [String]$DestinationFolder, [String]$Include ) { $this.SyncFolders( $SourceFolder, $DestinationFolder, $Include, '', $false ) } [void]SyncFolders ( [String]$SourceFolder, [String]$DestinationFolder, [String]$Include, [Bool]$Archive ) { $this.SyncFolders( $SourceFolder, $DestinationFolder, $Include, '', $Archive ) } [void]SyncFolders ( [String]$SourceFolder, [String]$DestinationFolder, [String]$Include, [String]$Exclude ) { $this.SyncFolders( $SourceFolder, $DestinationFolder, $Include, $Exclude, $false ) } [void]SyncFolders ( [String]$SourceFolder, [String]$DestinationFolder, [String]$Include, [String]$Exclude, [Bool]$Archive ) { $Arguments = @( '/MIR', '/R:0', '/NP', '/NC', '/NS', '/NJH', '/NJS', '/NDL' ) if ( $Exclude ) { $Arguments += $( '/XF' ) $Arguments += $Exclude.Split(' ') } if ( $Archive ) { $Arguments += $( '/A+:a' ) } $ErrorFlag = $false &amp;$this.RobocopyPath $SourceFolder $DestinationFolder $Include $Arguments | Foreach-Object { if ( $ErrorFlag ) { $ErrorFlag = $false throw "$_ $ErrorString" } else { if ( $_ -match '(?&lt;=\(0x[\da-f]{8}\))(?&lt;text&gt;(.+$))' ) { $ErrorFlag = $true $ErrorString = $matches.text } else { $Logger.AddRecord( $_.Trim()) } } } if ( $LASTEXITCODE -eq 8 ) { throw 'Some files or directories could not be copied' } if ( $LASTEXITCODE -eq 16 ) { throw 'Robocopy did not copy any files. Check the command line parameters and verify that Robocopy has enough rights to write to the destination folder.' } } }</code> </pre> <br><p>                ,             (      ),         ‚Äî    . </p><br><p>   ,   :        <code>Foreach-Object</code> !?  ,             :    <code>foreach</code> ,  <code>Foreach-Object</code>          ‚Äî   ,   , ,   ,      .       . </p><br><p>       ,     : </p><br><pre> <code class="plaintext hljs">$Robocopy = New-Object Robocopy #    $Robocopy.CopyFile( $Source, $Dest ) #   $Robocopy.SyncFolders( $SourceDir, $DestDir ) #    .xml     $Robocopy.SyncFolders( $SourceDir, $DestDir , '*.xml', $true ) #     *.zip *.tmp *.log     $Robocopy.SyncFolders( $SourceDir, $DestDir, '*.*', '*.zip *.tmp *.log', $true )</code> </pre> <br><h3 id="poslevkusie">  Aftertaste </h3><br><p>        ‚Äî           ,       ,            ;   ,        ,   ,     : </p><br><ul><li><p>   <code>foreach</code>   <code>Foreach-Object</code>  ; </p><br></li><li><p>   ; </p><br></li><li><p> /  ,   ; </p><br></li><li><p>  <code>StringBuilder</code>    ; </p><br></li><li><p>      ,   - ; </p><br></li><li><p>      ( ""    ); </p><br></li></ul><br><p>     :    -   ,  ,    . </p><br><h2 id="jobs">  Jobs </h2><br><p>  ,     ,        ,    ,      ,        ,     .            .      ,      IO,               . </p><br><div class="spoiler"> <b class="spoiler_title">    ssd</b> <div class="spoiler_text"><p>       Windows Server 2019  Hyper-V  ssd (    hdd): </p><br><p><img src="https://habrastorage.org/webt/mo/eu/jf/moeujfnupkxphhi7uso_hjbzsys.jpeg" alt="2019ssd"></p></div></div><br><p>    PowerShell       ( <code>Get-Command *-Job</code> ),    <a href="https://sergeyvasin.net/2013/01/05/using-windows-PowerShell-jobs/"> </a> . </p><br><p>      ,  ,  ,     : </p><br><pre> <code class="plaintext hljs">$Job = Start-Job -ScriptBlock { Write-Output 'Good night' Start-Sleep -S 10 Write-Output 'Good morning' } $Job | Wait-Job | Receive-Job Remove-Job $Job</code> </pre> <br><p>          ,         ‚Äî       ,    .             <a href="https://xaegr.wordpress.com/2011/07/12/threadping/">     </a> . </p><br><p>      ,      : </p><br><p><img src="https://habrastorage.org/webt/gc/um/r-/gcumr-9xsk2fh5c5m7epk1eozqg.png" alt="jobs"><br> <a href="https://xaegr.wordpress.com/2011/07/12/threadping/">https://xaegr.wordpress.com/2011/07/12/threadping/</a> </p><br><p> ,      ,   ‚Äî     ,                 .  , ,     (50  ‚Äî  50 ): </p><br><p><img src="https://habrastorage.org/webt/3f/pg/xg/3fpgxg51u9augjj9iua05wm6fgi.png" alt="job dies"></p><br><p>           .    ,  ‚Äî            ,        .     ‚Äî           ,    . </p><br><p>   ,           , ,              - . </p><br><h2 id="runspaces"> Runspaces </h2><br><p>                  ‚Äî <a href="https://devblogs.microsoft.com/scripting/beginning-use-of-PowerShell-runspaces-part-1/">Beginning Use of PowerShell Runspaces: Part 1</a> . ,  ‚Äî    PowerShell        ,        .             (,    PowerShell ),       :      <a href="https://github.com/proxb/PoshRSJob">       (  )</a>       .        ,            . </p><br><p>          <a href="https://ru.wikipedia.org/wiki/Windows_Presentation_Foundation">WPF </a> ,              PowerShell,     .      <a href="https://docs.microsoft.com/ru-ru/dotnet/api/system.collections.hashtable.synchronized"> </a> ‚Äî      ,   .    ‚Äî            ,         "" .     . </p><br><p>       ,      <a href="https://devblogs.microsoft.com/scripting/beginning-use-of-PowerShell-runspaces-part-3/">           </a> . </p><br><p><img src="https://habrastorage.org/webt/cx/pp/7v/cxpp7vozkcxdsl_ibdyva0_z3wi.gif" alt="wpf"></p><br><pre> <code class="plaintext hljs">#     $GUISyncHash = [hashtable]::Synchronized(@{}) &lt;# WPF  #&gt; $GUISyncHash.FormXAML = [xml](@" &lt;Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" Title="Sample WPF Form" Height="510" Width="410" ResizeMode="NoResize"&gt; &lt;Grid&gt; &lt;Label Content=" " HorizontalAlignment="Left" Margin="10,10,0,0" VerticalAlignment="Top" Height="37" Width="374" FontSize="18"/&gt; &lt;Label Content="" HorizontalAlignment="Left" Margin="16,64,0,0" VerticalAlignment="Top" Height="26" Width="48"/&gt; &lt;TextBox x:Name="BackupPath" HorizontalAlignment="Left" Height="23" Margin="69,68,0,0" TextWrapping="Wrap" Text="" VerticalAlignment="Top" Width="300"/&gt; &lt;Label Content="" HorizontalAlignment="Left" Margin="16,103,0,0" VerticalAlignment="Top" Height="26" Width="35"/&gt; &lt;TextBox x:Name="RestorePath" HorizontalAlignment="Left" Height="23" Margin="69,107,0,0" TextWrapping="Wrap" Text="" VerticalAlignment="Top" Width="300"/&gt; &lt;Button x:Name="FirstButton" Content="‚àö" HorizontalAlignment="Left" Margin="357,68,0,0" VerticalAlignment="Top" Width="23" Height="23"/&gt; &lt;Button x:Name="SecondButton" Content="‚àö" HorizontalAlignment="Left" Margin="357,107,0,0" VerticalAlignment="Top" Width="23" Height="23"/&gt; &lt;CheckBox x:Name="Check" Content="  " HorizontalAlignment="Left" Margin="16,146,0,0" VerticalAlignment="Top" RenderTransformOrigin="-0.113,-0.267" Width="172"/&gt; &lt;Button x:Name="Go" Content="Go" HorizontalAlignment="Left" Margin="298,173,0,0" VerticalAlignment="Top" Width="82" Height="26"/&gt; &lt;ComboBox x:Name="Droplist" HorizontalAlignment="Left" Margin="16,173,0,0" VerticalAlignment="Top" Width="172" Height="26"/&gt; &lt;ListBox x:Name="ListBox" HorizontalAlignment="Left" Height="250" Margin="16,210,0,0" VerticalAlignment="Top" Width="364"/&gt; &lt;/Grid&gt; &lt;/Window&gt; "@) &lt;#   #&gt; $GUISyncHash.GUIThread = { $GUISyncHash.Window = [Windows.Markup.XamlReader]::Load(( New-Object System.Xml.XmlNodeReader $GUISyncHash.FormXAML )) $GUISyncHash.Check = $GUISyncHash.Window.FindName( "Check" ) $GUISyncHash.GO = $GUISyncHash.Window.FindName( "Go" ) $GUISyncHash.ListBox = $GUISyncHash.Window.FindName( "ListBox" ) $GUISyncHash.BackupPath = $GUISyncHash.Window.FindName( "BackupPath" ) $GUISyncHash.RestorePath = $GUISyncHash.Window.FindName( "RestorePath" ) $GUISyncHash.FirstButton = $GUISyncHash.Window.FindName( "FirstButton" ) $GUISyncHash.SecondButton = $GUISyncHash.Window.FindName( "SecondButton" ) $GUISyncHash.Droplist = $GUISyncHash.Window.FindName( "Droplist" ) $GUISyncHash.Window.Add_SourceInitialized({ $GUISyncHash.GO.IsEnabled = $true }) $GUISyncHash.FirstButton.Add_Click( { $GUISyncHash.ListBox.Items.Add( 'Click FirstButton' ) }) $GUISyncHash.SecondButton.Add_Click( { $GUISyncHash.ListBox.Items.Add( 'Click SecondButton' ) }) $GUISyncHash.GO.Add_Click( { $GUISyncHash.ListBox.Items.Add( 'Click GO' ) }) $GUISyncHash.Window.Add_Closed( { Stop-Process -Id $PID -Force }) $null = $GUISyncHash.Window.ShowDialog() } $Runspace = @{} $Runspace.Runspace = [RunspaceFactory]::CreateRunspace() $Runspace.Runspace.ApartmentState = "STA" $Runspace.Runspace.ThreadOptions = "ReuseThread" $Runspace.Runspace.Open() $Runspace.psCmd = { Add-Type -AssemblyName PresentationCore, PresentationFramework, WindowsBase }.GetPowerShell() $Runspace.Runspace.SessionStateProxy.SetVariable( 'GUISyncHash', $GUISyncHash ) $Runspace.psCmd.Runspace = $Runspace.Runspace $Runspace.Handle = $Runspace.psCmd.AddScript( $GUISyncHash.GUIThread ).BeginInvoke() Start-Sleep -S 1 $GUISyncHash.ListBox.Dispatcher.Invoke( "Normal", [action] { $GUISyncHash.ListBox.Items.Add( '' ) }) $GUISyncHash.ListBox.Dispatcher.Invoke( "Normal", [action] { $GUISyncHash.ListBox.Items.Add( '  ' ) }) foreach ( $item in 1..5 ) { $GUISyncHash.Droplist.Dispatcher.Invoke( "Normal", [action] { $GUISyncHash.Droplist.Items.Add( $item ) $GUISyncHash.Droplist.SelectedIndex = 0 }) } $GUISyncHash.ListBox.Dispatcher.Invoke( "Normal", [action] { $GUISyncHash.ListBox.Items.Add( 'While ( $true ) { Start-Sleep -S 10 }' ) }) while ( $true ) { Start-Sleep -S 10 }</code> </pre> <br><p>      WPF       github,       ,       smart : <a href="https://github.com/snd3r/GetDiskSmart/">https://github.com/snd3r/GetDiskSmart/</a> .          ,    MVVM: </p><br><p><img src="https://habrastorage.org/webt/ke/-1/mb/ke-1mbcf2zuyg6crqt70zx4aoqw.png" alt="binging"></p><br><p>        Visual Studio,            Community Edition                 ,          xaml-  wpf ‚Äî <a href="https://github.com/punker76/kaxaml">https://github.com/punker76/kaxaml</a> </p><br><p><img src="https://habrastorage.org/webt/wf/wd/j1/wfwdj1mhk_f8bml8clv3n6sv02a.png" alt="kaxaml"></p><br><h2 id="vmesto-zaklyucheniya">  Instead of conclusion </h2><br><p> PowerShell ‚Äî        Windows-.   ,      <a href="https://docs.microsoft.com/en-us/PowerShell/module/microsoft.PowerShell.core/functions/get-verb">  </a> ,           ,            . </p><br><p>      ,                ,   "PowerShell,  ",   .           ,        ‚Äî     ,      .                 .          ,  -    , -                . </p><br><p>          ‚Äî    . </p><br><p><img src="https://habrastorage.org/webt/fd/qg/_1/fdqg_1uamuh8rc66ahep2utydeo.png" alt="calm"></p><br><p> PS <a href="https://habr.com/ru/users/boomburum/" class="user_link">Boomburum</a> ,    2019   powershell ‚Äî  . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/443256/">https://habr.com/ru/post/443256/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../443244/index.html">Analysis of tasks. Binpoisk_1</a></li>
<li><a href="../443246/index.html">How we reinvented the IP PBX Askozia, after the project was sold and closed by the developer</a></li>
<li><a href="../443248/index.html">PRP and HSR seamless redundancy protocols</a></li>
<li><a href="../443250/index.html">Homemade garbage collector for OpenJDK</a></li>
<li><a href="../443252/index.html">Modular bot ants with memory</a></li>
<li><a href="../443258/index.html">Gotify - open source project for delivering notifications and sending messages to the server</a></li>
<li><a href="../443260/index.html">Migrate to Zimbra without risking your business using a common domain</a></li>
<li><a href="../443262/index.html">Bad advice: how to write technical documentation? Part Three and Last</a></li>
<li><a href="../443264/index.html">He says and shows: is the rhetoric of popular Ukrainian politicians different?</a></li>
<li><a href="../443268/index.html">Post mortem: follow middleware or how we broke comments</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>