<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implementing Search Using RxJava</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article will discuss the optimal and compact implementation of search using RxJava for Android, eliminating unnecessary results and reducing the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implementing Search Using RxJava</h1><div class="post__text post__text-html js-mediator-article">  This article will discuss the optimal and compact implementation of search using RxJava for Android, eliminating unnecessary results and reducing the number of useless network calls. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/674/a2f/486/674a2f486dd8a4b265e7b8e3bf68d0cf.png" alt="Sample search"><br>  The original was written on October 16, 2017. Translation is free. <br><a name="habracut"></a><br>  Currently, most of the applications that we use daily provide the ability to quickly search.  Therefore, the implementation of the search is an important task.  We, as developers, it is important to implement the search in the best way. <br><br>  Consider how to implement search in the best way using RxJava.  <b>Do not forget, in RxJava there are operators for everything</b> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I personally believe that you can solve any problem very easily with RxJava, which can be very difficult without RxJava.  RxJava is a great technology. <br><br>  Take a look at the elements of RxJava, which we will use to implement the search: <br><br><ul><li>  <b>Publish Subject:</b> If you have not encountered this operator, take a look at <a href="https://blog.mindorks.com/understanding-rxjava-subject-publish-replay-behavior-and-async-subject-224d663d452f">this article.</a> </li><li>  <b>Filter</b> </li><li>  <b>Debounce</b> </li><li>  <b>DistinctUntilChanged</b> </li><li>  <b>Switchmap</b> </li></ul><br><h2>  Let's start </h2><br>  First you need to make SearchView observable.  Let's make it using PublishSubject.  I am using SearchView from Android.  View can be any, with functionality as at EditText.  To implement observable, you need to implement a listener to change the text in the field. <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RxSearchObservable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Observable&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fromView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SearchView searchView)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> PublishSubject&lt;String&gt; subject = PublishSubject.create(); searchView.setOnQueryTextListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SearchView.OnQueryTextListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onQueryTextSubmit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String s)</span></span></span><span class="hljs-function"> </span></span>{ subject.onComplete(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onQueryTextChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String text)</span></span></span><span class="hljs-function"> </span></span>{ subject.onNext(text); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> subject; }</code> </pre> <blockquote>  Note from <a href="https://habrahabr.ru/users/constorvar/" class="user_link">ConstOrVar</a> : <br>  Observable for SearchView will not work correctly.  You subscribe to it in onCreate (), but when an onQueryTextSubmit () is triggered, a reply will occur, since onComplete will be called.  It turns out that the second search will not work.  In order for the second search to work, you need to get rid of subject.onComplete (); <br></blockquote><blockquote>  A note from <a href="https://habrahabr.ru/users/scrobot/" class="user_link">Scrobot</a> and <a href="https://habrahabr.ru/users/bfs/" class="user_link">BFS</a> : <br>  You should not use a Subject, it exists only for 1 goal: to combine the imperative style with the jet.  Better to use Observable.create ().  The search is exactly the case when you need to think about Backpressure, and since almost everyone today uses RxJava2, then this problem is solved there with the help of Flowable, and it is better to register this case for it. <br></blockquote>  Next, you need to call the created method and add operator calls, as in the example below. <br><br><pre> <code class="java hljs">RxSearchObservable.fromView(searchView) .debounce(<span class="hljs-number"><span class="hljs-number">300</span></span>, TimeUnit.MILLISECONDS) .filter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Predicate&lt;String&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String text)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (text.isEmpty()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } }) .distinctUntilChanged() .switchMap(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Function&lt;String, ObservableSource&lt;String&gt;&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ObservableSource&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String query)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dataFromNetwork(query); } }) .subscribeOn(Schedulers.io()) .observeOn(AndroidSchedulers.mainThread()) .subscribe(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Consumer&lt;String&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accept</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String result)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ textViewResult.setText(result); } });</code> </pre><br>  <b>Now let's discuss why these operators are used and how they work together</b> . <br><br><h3>  Debounce </h3><br>  Time parameters are transferred to this operator.  In this case, it catches text input events by the user, for example, ‚Äúa‚Äù, ‚Äúab‚Äù, ‚Äúabc‚Äù.  Typing often happens very quickly and is fraught with a large number of network calls.  But the user is usually interested only in the results for "abc".  So, you need to discard the execution of queries for "a", "ab".  Operator debounce to the rescue.  It expects user inactivity during the time passed in the parameter.  If any input is made during the wait, the wait counter will be reset, the countdown will start again, the previous transmitted result, for example, ‚Äúa‚Äù will be discarded.  Thus, the debounce operator sends further along the chain only those elements that survived without invoking new events for the specified waiting time. <br><img src="https://habrastorage.org/getpro/habr/post_images/f46/0e7/1d1/f460e71d1bbdd51dd0e5414d268c0761.png" alt="debounce example image"><br><br><h3>  Filter </h3><br>  This operator is used to screen out unwanted lines, for example, empty lines, to avoid unnecessary network calls. <br><br><h3>  DistinctUntilChanged </h3><br>  This operator is used to avoid duplicate network calls.  For example, the last search query was ‚Äúabc‚Äù, then the user deleted ‚Äúc‚Äù and re-entered ‚Äúc‚Äù.  The result is ‚Äúabc‚Äù again.  If the network call is already in process with the same parameter, then the distinctUntilChanged operator will not allow performing the same call again.  Thus, the distinctUntilChanged operator filters out elements that are repeated <b>successively</b> passed to it. <br><img src="https://habrastorage.org/getpro/habr/post_images/f6d/1bf/a65/f6d1bfa65fe9c957bd1987a27916e523.png" alt="distinctUntilChanged example image"><br><br><h3>  Switchmap </h3><br>  In this example, this operator is used to exclude network calls, the results of which no longer need to be shown to the user.  For example, the last search query was ‚Äúab‚Äù and there is a working network call for this query, but the user enters ‚Äúabc‚Äù at this time.  The result for ‚Äúab‚Äù is no longer needed, only the result for ‚Äúabc‚Äù is needed.  SwitchMap to the rescue.  It passes on the results of only the last query, ignoring the rest. <br><br>  Javadoc describes <code>switchMap</code> as follows: <br><br>  <i>Returns a new <code>Observable</code> , applying the passed function to each <code>Observable</code> element received, but passing on elements created only by the last <code>Observable</code> received.</i> <br><br>  <b>We did it!</b>  Just imagine how difficult it would be to implement a search without RxJava. <br><br>  If you want to see a complete example, take a look at the following <a href="https://github.com/amitshekhariitbhu/RxJava2-Android-Samples">project</a> . </div><p>Source: <a href="https://habr.com/ru/post/345278/">https://habr.com/ru/post/345278/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345266/index.html">Organization of musical accompaniment of the trading hall</a></li>
<li><a href="../345268/index.html">What to recognize on mobile platforms?</a></li>
<li><a href="../345270/index.html">Networks for the smallest. Part fourteen. Package path</a></li>
<li><a href="../345274/index.html">How I wrote my own ERP system and what came of it</a></li>
<li><a href="../345276/index.html">One ordinary funny monday</a></li>
<li><a href="../345282/index.html">Devops in a bloody enterprise</a></li>
<li><a href="../345284/index.html">Selection of resources for a job seeker programmer</a></li>
<li><a href="../345286/index.html">Severe Siberian and Kazakh microelectronics 2017: Verilog, ASIC and FPGA in Tomsk, Novosibirsk and Astana</a></li>
<li><a href="../345290/index.html">HDD performance doubled: Multi Actuator technology</a></li>
<li><a href="../345294/index.html">From tanks to nuclear power plants: looking back at Heisenbug 2017 Moscow</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>