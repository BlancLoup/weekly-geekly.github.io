<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GNU / Linux and the device on Rockchip 2918</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="First, a little background. A small continuation of the story with the media player GV2B, which I described earlier that / m . Let me remind you that ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GNU / Linux and the device on Rockchip 2918</h1><div class="post__text post__text-html js-mediator-article">  First, a little background.  A small continuation of the story with the media player GV2B, which I described earlier <a href="http://habrahabr.ru/post/145601/">that / m</a> .  Let me remind you that initially the box was <b>not</b> bought as an Android set-top box, but as a more powerful replacement for the Raspberry Pi, for which I left a request in April, but that will arrive only in August.  And GV2B was in my hands 8 days after ordering, for only $ 100 and with a full set of cables (which is only $ 5 more expensive than a Raspberry Pi set with charging, cords and a case). <br>  The reassurance of the spiteful critics from my previous post, that Youtube and other applications installed from Play, earned great, and the device found no more flaws. <br><br>  Most recently, a <a href="http://habrahabr.ru/post/146436/">couple of</a> <a href="http://habrahabr.ru/post/145930">topics</a> appeared, which described how Puppy Linux, Arch Linux and Ubuntu were installed on an ARM device.  This is a unique feature of Allwinner A10, which is hard to underestimate, but still the system is physically run from an SD card, rather than a built-in flash.  I began to work more actively on the issue, and came across as many as three ways to flash something into the flash memory of the device, which is encouraging and possibly opens a loophole for uploading full-fledged GNU / Linux.  It is presumptuous to note that this is already the next step for the banal launch of a slightly doped image from an SD card. <br><br><h4>  purpose </h4><br>  - Install the Linux kernel on the device.  Preferably the newest.  Or the newest of those that contains all the drivers specific to the device; <br>  - Put GNU; <br>  - Set the desktop environment; <br>  - Make a backup so that the device can be returned to its original state, if something goes wrong; <br>  - Good fun with a difficult task (comparable to installing the first versions of USB downloaders on the Wii and passing NetHack or Dwarf Fortress). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Facilities </h4><br>  GV-2B device from an unknown Chinese <a href="http://www.enybox.com/En">manufacturer</a> , based on Rockchip 2918 (abbreviated RK29) (CPU ARM Cortex A8 1GHz + Vivante GC800 600MHz GPU), with 4GB of flash memory, 512MB of RAM and a fair amount of connectors. <br>  16GB SD card class 10. <br>  PC with Arch Linux. <br>  Keyboard. <br>  Monitor. <br>  HDMI-DVI cable for connecting a monitor. <br>  A bunch of USB cords, adapters and so forth. <br><br><h4>  Caution and self-flagellation </h4><br>  Surely many of the readers would have done what is described in the topic, or at least some particular part, faster and better, but I did not find any mention of such a feat in the network.  The topic contains a lot of practice and quite a bit of theory, only the most necessary to understand what is being said and what is happening (I admit honestly, I and the theory itself in the described areas are clearly not enough).  From an academic point of view, pulls on a three-hour laboratory work.  I also want to say that I am doing all this for the first time, if we exclude the connection of a disk with Ubuntu pre-installed on a desktop computer to a PC104 x86-compatible single-board. <br><a name="habracut"></a><br><h3>  Device selection </h3><br>  In the <a href="http://www.enybox.com/En/product/class/%3F119.html">model number G, there are</a> about twenty different devices, on different processors, with different numbers of connectors, but about the same functionality. <br><br>  At first, I was killed about not taking the device on the Allwinner A10, but after reading a few reviews about the <a href="http://habrahabr.ru/post/145930/">openness of the</a> kernel sources to it, I realized that the situation with Rockchip is not much worse. <br><br>  There was an option to order a device of the same model range, but already with the Cortex A9, namely AmLogic 8726-M, but it does not have any significant advantages over the Rockchip 2918, and with the initial code for the latest chips, judging by <a href="http://openlinux.amlogic.com/wiki/index.php/OpenLinux/Platform_Info">the AmLogic website</a> , everything also sadly <br><br><h3>  Methods </h3><br>  So, three ways were found to update the firmware of the device (the contents of that 4GB flash memory). <br><br>  <a href="http://www.maxq.com.my/index.php/support/media-player-1635/firmware-update-24542/category/16-maxq-r7">The first</a> - from the manufacturer using one of the OEM models of the GV line, did not work, and it‚Äôs good, because their firmware is meant for a slightly different device, to which there are three USB ports, and the difference between them is so serious that the firmware usually turns into device conversion in brick <br><br>  Two left.  The second, from the hacker with <a href="http://androidforums.com/google-tv/506298-rk2918-android-tv-box-4x-usb-rooted-firmware-manual.html">AndroidForums</a> , is that you need to make an additional, second reset button inside the box, while holding it to hold the power button for a few seconds.  This method has opened interesting features, namely the Android system recovery utility v1.3.37 menu (obviously <a href="http://ru.wikipedia.org/wiki/Leet">1337</a> ), offering a choice: <br>  - Reboot system now <br>  - Factory reset <br>  - SYSTEM recover <br>  - Update from SDCARD <br>  - Update from uDisk <br>  - Factory test <br><br><img src="https://habrastorage.org/storage2/71b/5f1/3fe/71b5f13fe3ef78d50a16340160b1c7ca.jpg"><br><br>  To my great regret, the keyboard, being connected to the device, and working perfectly well after loading Android, had no effect on the system recovery menu, and of the three buttons on the board (power, reset, reset), only one acted on the menu - the first reset, which either led him to the selection of the default active item Reboot system now, or else it just worked for its intended purpose.  The rest of the cursor buttons, unfortunately, did not move.  The way was precisely to fill the firmware from the SD memory card, which did not work. <br><br>  Having formatted the SD card in fat32, I uploaded to it with difficulty downloaded from the file dump (god, have they not heard of Dropbox?) The downloaded update for Android.  With a normal boot, Android cursed that there was an incorrect update.img on the SD card.  But I still didn‚Äôt hurry to upload it, because backups are made not only by cowards, and it often happened on the forums that uploading one or another update.img, which I earned from one author, on a similar device led to a transformation into a brick from another author. <br><br>  The third <s>son of the</s> <a href="http://androidforums.com/google-tv/505559-flashing-android-tv-box-one-four-usb.html">way</a> was closer to what I was going to do.  It consisted in connecting the device to a computer using a USB cable. <br><img src="https://habrastorage.org/storage2/38a/faa/d17/38afaad17e9dc309437f3ef5b7f370cc.jpg"><br>  At first, I was very embarrassed by the fact that in the system recovery mode the device was not detected from the computer at all, despite the fact that I connected all the necessary wires where necessary (and not even where I sent the opposite power of 4.57V and 5.08V via USB, which fortunately It did not have any consequences).  As it turned out later, this is the way it should be, because they have their own protocol there, and the difference with the connection of external media is significant. <br><img src="https://habrastorage.org/storage2/907/764/098/907764098e723978abfe2d7f2ef785bf.jpg"><br>  Under Windows, the Rockchip Flasher tool program was discovered, which the language doesn‚Äôt turn out to be called wonderful, because it‚Äôs done terribly and the only thing that it can do is flash new update.img.  But I had to not only flash, but also download the existing one, in case something suddenly happened, so I had to give up the work of Chinese programmers. <br><br>  With the legs, by the way, you need to be careful. <br><img src="https://habrastorage.org/storage2/9ec/236/3f2/9ec2363f2879965fad19c0137fd0ac6e.jpg"><br><br><h3>  Backup </h3><br>  I want to save everything that is stored in flash memory to be able to restore everything to the original version, if that goes wrong.  For this there are several different methods. <br><br>  <a href="http://matrixrewriter.com/android/">Titanium Backup</a> .  Android application with which you can take a snapshot of system partitions and copy it to an SD card.  Everything is good, but the device needs to be ruled for this (get administrative privatization).  In order to root the device on Android 2.3.1, Universal Androot is no longer suitable, and its author offers the choice to use <a href="http://unrevoked.com/">Unrevoked</a> , which is only suitable for HTC phones, or <a href="http://forum.xda-developers.com/showthread.php%3Ft%3D803682">SuperOneClick</a> , which seems to be all good, but in order to root the device It requires connecting it to a Windows computer.  Everything is good, but it downloads the firmware, adds some files there and uploads it back.  Change the firmware in order to make a backup copy of it - this is insanity. <br><br>  It remained to take advantage of the <a href="http://developer.android.com/tools/help/adb.html">Android Debug Bridge</a> from the Android SDK, which is not a fact that would work with this particular device, and pulling a considerable amount of dependencies, which I did not want at all.  Everything else to collect all this was necessary from the source (read AUR for Arch Linux). <br><br>  Having already become sad, I suddenly discovered the wonderful utility <a href="https://github.com/OlegKyiashko/RK29kitchen">RK29kitchen</a> , announced <a href="http://4pda.ru/forum/lofiversion/index.php%3Ft337784-0.html">here,</a> which, judging by the description, absorbed a number of other equally remarkable utilities from the authors, which disassembled the clever protocol of communication of devices via USB, and a little less cunning file with the partition table. <br><br><h4>  Launch </h4><br>  It turned out not so easy.  It turns out that the device should not be in system recovery mode, but in the off state, but always with the power connected.  The problem is that it tries to turn on as soon as it feels that it is connected via USB.  But you can cope with this.  Holding both reset buttons for 5 seconds, let go first, then after 3 seconds, and the internal one.  I start and try to be patient. <br><pre><code class="hljs sql">$ ./flashdump.sh <span class="hljs-keyword"><span class="hljs-keyword">Check</span></span> that your tablet <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the firmware flash <span class="hljs-keyword"><span class="hljs-keyword">mode</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> connected <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> computer rkflashtool: info: <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> claimed rkflashtool: info: reading flash <span class="hljs-keyword"><span class="hljs-keyword">memory</span></span> <span class="hljs-keyword"><span class="hljs-keyword">at</span></span> <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span> <span class="hljs-number"><span class="hljs-number">0x00000100</span></span> unpacking...OK Dumping misc (rkflashtool29 r <span class="hljs-number"><span class="hljs-number">0x00002000</span></span> <span class="hljs-number"><span class="hljs-number">0x00002000</span></span> ) Dumping kernel (rkflashtool29 r <span class="hljs-number"><span class="hljs-number">0x00004000</span></span> <span class="hljs-number"><span class="hljs-number">0x00004000</span></span> ) Dumping boot (rkflashtool29 r <span class="hljs-number"><span class="hljs-number">0x00008000</span></span> <span class="hljs-number"><span class="hljs-number">0x00002000</span></span> ) Dumping <span class="hljs-keyword"><span class="hljs-keyword">recovery</span></span> (rkflashtool29 r <span class="hljs-number"><span class="hljs-number">0x0000a000</span></span> <span class="hljs-number"><span class="hljs-number">0x00004000</span></span> ) Dumping <span class="hljs-keyword"><span class="hljs-keyword">system</span></span> (rkflashtool29 r <span class="hljs-number"><span class="hljs-number">0x0000e000</span></span> <span class="hljs-number"><span class="hljs-number">0x00080000</span></span> ) Dumping <span class="hljs-keyword"><span class="hljs-keyword">backup</span></span> (rkflashtool29 r <span class="hljs-number"><span class="hljs-number">0x0008e000</span></span> <span class="hljs-number"><span class="hljs-number">0x00082000</span></span> )</code> </pre> <br>  A little confused by the fact that the source flashdump'a says: <br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">rkflashtool29</span></span> r <span class="hljs-number"><span class="hljs-number">0</span></span> 0x200</code> </pre><br>  And in the output: <br><pre> <code class="hljs pgsql">reading flash memory at <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span> <span class="hljs-number"><span class="hljs-number">0x00000100</span></span></code> </pre><br>  It is not entirely clear from which offset parm.img is read. <br><br>  So, 5-10 minutes and the <s>golden key</s> I have a flash memory image entirely and separately of all sections: <br><pre> <code class="hljs mel">$ <span class="hljs-keyword"><span class="hljs-keyword">ls</span></span> -l flashdump/Image/ <span class="hljs-number"><span class="hljs-number">4194304</span></span> Jun <span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">15</span></span> boot.img <span class="hljs-number"><span class="hljs-number">8388608</span></span> Jun <span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">15</span></span> kernel.img <span class="hljs-number"><span class="hljs-number">4194304</span></span> Jun <span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">14</span></span> misc.img <span class="hljs-number"><span class="hljs-number">8388608</span></span> Jun <span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">16</span></span> recovery.img <span class="hljs-number"><span class="hljs-number">268435456</span></span> Jun <span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-keyword"><span class="hljs-keyword">system</span></span>.img $ <span class="hljs-keyword"><span class="hljs-keyword">ls</span></span> -l flashdump <span class="hljs-number"><span class="hljs-number">272629760</span></span> Jun <span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span> backup.img <span class="hljs-number"><span class="hljs-number">4096</span></span> Jun <span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">16</span></span> Image <span class="hljs-number"><span class="hljs-number">583</span></span> Jun <span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">13</span></span> parameter <span class="hljs-number"><span class="hljs-number">262144</span></span> Jun <span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">13</span></span> parm.img</code> </pre><br>  What happened?  If you dig in the forums and source files of RK29kitchen, it becomes clear that I just read the contents of the flash memory of the device, starting with the partition table, which we have been disassembled on the shelves and recorded in the parameter text file, and using it, we recorded it separately. <br>  It was <a href="http://www.freaktab.com/showthread.php%3F287-RockChip-ROM-Building-Tips-and-Tricks-by-Finless">here</a> that an incredible amount of information was found that relates specifically to updating the flash memory of devices on the RK2918.  All described devices are tablets, and connecting them to a computer for updating is somewhat easier (given the built-in microUSB port, also known as USB OTG). <br><br>  This is how the parameter file looks like: <br><pre> <code class="hljs mel">FIRMWARE_VER:<span class="hljs-number"><span class="hljs-number">1.2</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> MACHINE_MODEL:SUNVEK MACHINE_ID:<span class="hljs-number"><span class="hljs-number">007</span></span> MANUFACTURER:rock-chips MAGIC: <span class="hljs-number"><span class="hljs-number">0x5041524B</span></span> ATAG: <span class="hljs-number"><span class="hljs-number">0x60000800</span></span> MACHINE: <span class="hljs-number"><span class="hljs-number">2929</span></span> CHECK_MASK: <span class="hljs-number"><span class="hljs-number">0x80</span></span> KERNEL_IMG: <span class="hljs-number"><span class="hljs-number">0x60408000</span></span> CMDLINE: console=ttyS1,<span class="hljs-number"><span class="hljs-number">115200</span></span>n8n androidboot.console=ttyS1 init=/init initrd=<span class="hljs-number"><span class="hljs-number">0x62000000</span></span>,<span class="hljs-number"><span class="hljs-number">0x300000</span></span> mtdparts=rk29xxnand:<span class="hljs-number"><span class="hljs-number">0x00002000</span></span>@0x00002000(misc),<span class="hljs-number"><span class="hljs-number">0x00004000</span></span>@0x00004000(kernel),<span class="hljs-number"><span class="hljs-number">0x00002000</span></span>@0x00008000(boot),<span class="hljs-number"><span class="hljs-number">0x00004000</span></span>@0x0000A000(recovery),<span class="hljs-number"><span class="hljs-number">0x00080000</span></span>@0x0000E000(<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>),<span class="hljs-number"><span class="hljs-number">0x00082000</span></span>@0x0008E000(backup),<span class="hljs-number"><span class="hljs-number">0x0003a000</span></span>@0x00110000(cache),<span class="hljs-number"><span class="hljs-number">0x00100000</span></span>@0x0014a000(userdata),<span class="hljs-number"><span class="hljs-number">0x00002000</span></span>@0x0024a000(kpanic),-@0x0024c000(user)</code> </pre><br>  The last line using the hexadecimal system contains the lengths, the beginning of the sections, and in brackets their names.  A required section is missing in which the partition table itself is actually stored.  I'll try to decipher. <br><br>  The size of the parameter block read is 0x200 (from the source files RK29kitchen), this is 512, and the file size is 262144 bytes.  It turns out that the size of the conditional block is 262144/512, that is, 512 bytes, which is confirmed by the documentation for rkflashtool. <br>  What occupies the memory between 0x200 and 0x2000, and this is as much as 3.75MB is a mystery. <br><br><table><tbody><tr><td>  parameter (partition table) </td><td>  256KB </td></tr><tr><td>  misc </td><td>  4MB </td></tr><tr><td>  kernel </td><td>  8MB </td></tr><tr><td>  boot </td><td>  4MB </td></tr><tr><td>  recovery </td><td>  8MB </td></tr><tr><td>  system </td><td>  256MB </td></tr><tr><td>  backup </td><td>  260MB </td></tr><tr><td>  cache </td><td>  116MB </td></tr><tr><td>  userdata </td><td>  512MB </td></tr><tr><td>  kpanic </td><td>  4MB </td></tr><tr><td>  user </td><td>  all remaining space </td></tr></tbody></table><br><h3>  Preparation </h3><br>  Now I have in my hands a set of img files, disk images that I downloaded.  I wonder what's inside.  I know from earlier knowledge that they make <a href="http://ru.wikipedia.org/wiki/Cramfs">cramfs</a> in flash format for writing files that are not meant to change (such as the OS kernel), but some particularly tricky Chinese manage to add more headers and <a href="http://ru.wikipedia.org/wiki/Cramfs">footers</a> to these images, then use gzip, apparently trying to make it difficult to read his own and create his own images. <br><br>  It was this miracle, called cra <b>p</b> fs, that I saw: <br><pre> <code class="hljs pgsql">$ sudo mount -t cramfs Image/boot.img /media/cramfs mount: wrong fs <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>, bad <span class="hljs-keyword"><span class="hljs-keyword">option</span></span>, bad superblock <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> /dev/loop0 $ dmesg |tail [<span class="hljs-number"><span class="hljs-number">41549.071136</span></span>] cramfs: wrong magic</code> </pre><br>  When trying to connect with the same RK29kitchen, the result is about the same: <br><pre> <code class="hljs pgsql">/sbin/e2fsck: Bad magic number <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> super-block <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> trying <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-keyword"><span class="hljs-keyword">system</span></span>.img</code> </pre><br>  It is necessary to trim the first 8 bytes from the img file: <br><pre> <code class="hljs pgsql">$ dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=boot.img <span class="hljs-keyword"><span class="hljs-keyword">of</span></span>=bootimg.gz skip=<span class="hljs-number"><span class="hljs-number">8</span></span> bs=<span class="hljs-number"><span class="hljs-number">8</span></span> count=<span class="hljs-number"><span class="hljs-number">20000000</span></span> <span class="hljs-number"><span class="hljs-number">524280</span></span>+<span class="hljs-number"><span class="hljs-number">0</span></span> records <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">524280</span></span>+<span class="hljs-number"><span class="hljs-number">0</span></span> records <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-number"><span class="hljs-number">4194296</span></span> bytes (<span class="hljs-number"><span class="hljs-number">4.2</span></span> MB) copied, <span class="hljs-number"><span class="hljs-number">4.41275</span></span> s, <span class="hljs-number"><span class="hljs-number">950</span></span> kB/s</code> </pre><br>  Fine.  I came across the same case, when files are packed with gzip, and then the ridiculous header and basement are added to them, in which there is a CRC and, probably, something else. <br><br>  Further more interesting: <br><pre> <code class="hljs kotlin">$ mkdir myboot $ cd myboot $ gunzip &lt; ../bootimg.gz | sudo cpio -i --make-directories $ ls <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> dev init_battery.sh <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.rc proc sbin system ueventd.rc <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.prop <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.goldfish.rc <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.rk29board.rc rk29xxnand_ko.ko sys ueventd.goldfish.rc ueventd.rk29board.rc</code> </pre><br>  There are a bunch of files inside, it‚Äôs not too clear, necessary or not.  To collect this case in the reverse order, you need to be even more careful, you need to reset the dates on the files: <br><pre> <code class="hljs swift">$ <span class="hljs-built_in"><span class="hljs-built_in">find</span></span> . -exec touch -d <span class="hljs-string"><span class="hljs-string">"1970-01-01 01:00"</span></span> {} \; $ <span class="hljs-built_in"><span class="hljs-built_in">find</span></span> . ! -name <span class="hljs-string"><span class="hljs-string">"."</span></span> | <span class="hljs-built_in"><span class="hljs-built_in">sort</span></span> | cpio -oa -<span class="hljs-type"><span class="hljs-type">H</span></span> newc | gzip -n &gt;../customboot.gz $ cd .. $ rkcrc -k customboot.gz customboot.img</code> </pre><br><br>  For assembly of images cpio is traditionally used.  Compared to the more popular tar, cpio has a number of advantages <a href="http://stackoverflow.com/a/4293196/202914">that</a> I don‚Äôt want to delve into in this topic. <br><br>  And here, in my hands is a customboot.img assembled with my own hands, which can be poured back into the device. <br>  With kernel.img, this preparation does not work. <br><br>  But what happened with system.img: <br><pre> <code class="hljs mel">$ sudo mount -t cramfs <span class="hljs-keyword"><span class="hljs-keyword">system</span></span>.img /media/cramfs $ <span class="hljs-keyword"><span class="hljs-keyword">ls</span></span> /media/cramfs/ app bin build.prop etc fonts framework lib media tts usr xbin</code> </pre><br>  The Android app files were found in the app folder (the archive of the executable file).  That is, you can add there any new programs or delete those that are, including some annoying and annoying.  In bin, you can add su and busybox, which as I understand it, is enough to root the device.  In etc change the configuration.  And so on.  In theory.  In practice, you have to tinker a little with the fact that in the mounted image of cramfs you just can‚Äôt write anything down. <br><br>  Well, it was possible to dissect something. <br><br><h3>  New image </h3><br>  It would be great, of course, to try booting from the SD card by uploading an image carefully prepared by someone, but the RK29 doesn‚Äôt have such a possibility, so you have to create an image and flash it directly into the flash memory of the device.  I hope that there is a backup. <br><br>  The images prepared in the previous paragraph were all in different formats, namely: <br>  boot.img was in the cra <b>p</b> fs format, and the rest, which are already loaded after it, are more digestible.  From here I will assume that dances with a tambourine are coming only with this boot.img, and with the rest of the images everything will be more or less trivial. <br><br>  I will refresh the memory, I will write what sections are needed to install Linux. <br>  / Root section.  It contains an important / boot folder containing a kernel image.  / boot can be made a separate partition, on the other, not journaling, file system (as it is used only when booting and updating the kernel).  But for simplicity, you can keep it in the root section.  Another important folder, / home, contains user data, and it's nice to allocate a separate section for it.  Swap, is needed for virtual memory for devices with less than 1GB of memory, but it is at least unwise to use the built-in flash memory with a limited read-write cycle for this, it‚Äôs better to pick up an external SD card for this purpose.  / usr stores files common to all users.  / var, stores logs, and it would also be more logical to store them on an external SD card. <br><br>  So, in order to work less, I will make an image consisting of three sections: <br>  / boot, 16MB with file system cra <b>p</b> fs <br>  /, ~ 4GB remaining space for root file system <br>  We will not create a / home, we will live as long as root, and how we will mount an external SD card, so we will also mount it <br>  / swap will also be mounted on the external flash card <br><br>  I downloaded and unpacked the latest open source kernel, which is sharpened for Rockchip 2918, from odys.de.  Kernel version 2.6 saddened.  Archlinux ARM kernel cross-compilation instructions made you feel like a dumbass, and upset the list of supported devices.  Yoctoproject is slightly confused.  The abundance of Linaro assemblies and, again, a limited list of supported devices, as well as a considerable number of bugs, even on supported devices, confused.  Already started glancing towards <a href="http://www.linuxfromscratch.org/">LFS</a> .  Is there really no universal thing that would have run out of poltychka on more or less standard equipment based on the Cortex A8 / A9?  Uffff. <br><br>  I haven‚Äôt left a choice, I‚Äôll have to cross-compile the kernel from the sources and build the images myself.  I downloaded the linux-linaro-3.5-rc3-2012.06.tar.bz2 source code and the cross-compilation toolkit gcc-linaro-arm-linux-gnueabihf-2012.06-20120625_linux.tar.bz2.  The only shame is that a device-specific .config file is needed for compilation, which Linaro does not have for RK2918.  Fortunately, in the previously mentioned odys kernel there are Rockchip-specific files, and they were also found in the newer <a href="https://github.com/DJNoXD/rockchip-kernel-rk2918">source code</a> from easypix.eu.  I copied them to the source from Linaro, namely: <br>  - folder arch / arm / mach-rk29 <br>  - 50KB arch / arm / configs / rk29_ddr3sdk_defconfig with a huge number of device-specific options <br>  - last line from arch / arm / tools / mach-types <br>  - section ARCH_RK29 from arch / arm / Kconfig <br>  - mkkrnlimg from the source root <br><br><h4>  Cross compiling kernel </h4><br><br><h5>  3.5.0-rc3 by Linaro </h5><br><pre> <code class="hljs ruby">$ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- rk29_ddr3sdk_defconfig $ PATH=$PATH<span class="hljs-symbol"><span class="hljs-symbol">:~/linaro/gcc-linaro-arm-linux-gnueabihf-</span></span><span class="hljs-number"><span class="hljs-number">2012.06</span></span>-<span class="hljs-number"><span class="hljs-number">20120625_</span></span>linux/bin $ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- uImage ... kernel/cgroup.<span class="hljs-symbol"><span class="hljs-symbol">c:</span></span><span class="hljs-number"><span class="hljs-number">470</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">error:</span></span> <span class="hljs-string"><span class="hljs-string">'saved_link'</span></span> undeclared (first use <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> this function) ... <span class="hljs-symbol"><span class="hljs-symbol">make:</span></span> *** [kernel] Error <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre><br>  Pretty cute, but fixable.  It turns out that someone carefully erased two lines and a comment.  I remember, this is called memory optimization and refactoring, but this time it does not suit me, and I will have to return it to the place: <br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> __put_css_set(struct css_set *cg, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> taskexit) { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cg_cgroup_link</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">link</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cg_cgroup_link</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">saved_link</span></span></span><span class="hljs-class">;</span></span></code> </pre><br>  It worked.  Interestingly, stable builds from Linaro generally try to compile, how do compile errors get through? <br><br>  Another mistake: <br><pre> <code class="hljs vhdl">fs/yaffs2/yaffs_vfs.c:<span class="hljs-number"><span class="hljs-number">46</span></span>:<span class="hljs-number"><span class="hljs-number">28</span></span>: fatal <span class="hljs-literal"><span class="hljs-literal">error</span></span>: linux/smp_lock.h: No such <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> directory</code> </pre><br>  The file was found in the source code from odys, but another error occurred, as well as a dozen others: <br><pre> <code class="hljs rust">fs/yaffs2/yaffs_vfs.c:<span class="hljs-number"><span class="hljs-number">317</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>: error: assignment of read-only member <span class="hljs-symbol"><span class="hljs-symbol">'i_nlink</span></span>' ... fs/yaffs2/yaffs_vfs.c:<span class="hljs-number"><span class="hljs-number">1995</span></span>:<span class="hljs-number"><span class="hljs-number">9</span></span>: error: ?<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mtd_info</span></span></span></span>? has no member named ?sync? fs/yaffs2/yaffs_vfs.c:<span class="hljs-number"><span class="hljs-number">1996</span></span>:<span class="hljs-number"><span class="hljs-number">6</span></span>: error: ?<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mtd_info</span></span></span></span>? has no member named ?sync? fs/yaffs2/yaffs_vfs.c:<span class="hljs-number"><span class="hljs-number">2097</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>: error: ?<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mtd_info</span></span></span></span>? has no member named ?erase ...</code> </pre><br>  Exclude yaffs2 from the build?  Edit C code in which I do not understand anything?  I coped with the first error, then I found a <a href="https://groups.google.com/forum/%3Ffromgroups">patch</a> that did not help a bit, and I had to fix it at random, focusing on inode.c.  There were errors with the struct mtd, and I must say that in the kernel version from Android 3.4, <a href="">everything is the same</a> , and it has come that there‚Äôs no hope of waiting.  It has come that day of early morning is wiser.  But the desire to remove all the lines related to YAFFS from .config and continue was stronger.  Then you can use UBIFS, or in extreme cases even ext3, not intended for flash media. <br><br>  The award was fast: <br><pre> <code class="hljs pgsql">Image <span class="hljs-type"><span class="hljs-type">Name</span></span>: Linux<span class="hljs-number"><span class="hljs-number">-3.5</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>-rc3 Created: Tue Jul <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">35</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span> <span class="hljs-number"><span class="hljs-number">2012</span></span> Image <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>: ARM Linux Kernel Image (uncompressed) Data Size: <span class="hljs-number"><span class="hljs-number">2258064</span></span> Bytes = <span class="hljs-number"><span class="hljs-number">2205.14</span></span> kB = <span class="hljs-number"><span class="hljs-number">2.15</span></span> MB <span class="hljs-keyword"><span class="hljs-keyword">Load</span></span> Address: fffffff2 Entry <span class="hljs-type"><span class="hljs-type">Point</span></span>: fffffff2 echo <span class="hljs-string"><span class="hljs-string">' Image arch/arm/boot/uImage is ready'</span></span> Image arch/arm/boot/uImage <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> ready</code> </pre><br>  Go ahead: <br><pre> <code class="hljs matlab">$ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- modules ... CC drivers/media/video/gspca/gspca_main.<span class="hljs-built_in"><span class="hljs-built_in">mod</span></span>.o LD [M] drivers/media/video/gspca/gspca_main.ko CC drivers/scsi/scsi_wait_scan.<span class="hljs-built_in"><span class="hljs-built_in">mod</span></span>.o LD [M] drivers/scsi/scsi_wait_scan.ko</code> </pre><br>  Everything went well, and only alerted that nothing specific was compiled RK29, and it is very suspicious.  uImage is received. <br><br><h5>  3.0.8+ from easypix.eu </h5><br>  In any spare case I decided to try to collect the source code from easypix.eu.  Here you can clearly see that the source code for RK29 is compiled.  There is no YAFFS in .config, nor is UBIFS.  There are only read-only cramfs, which is suitable for / boot, but not at all suitable for the root partition.  Build falls on: <br><pre> <code class="hljs vhdl"> CC drivers/net/wireless/bcm4329/wl_iw.o drivers/net/wireless/bcm4329/wl_iw.c: <span class="hljs-keyword"><span class="hljs-keyword">In</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'wl_iw_set_pmksa</span></span>': drivers/net/wireless/bcm4329/wl_iw.c:<span class="hljs-number"><span class="hljs-number">5069</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span>: <span class="hljs-literal"><span class="hljs-literal">error</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> subscript <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> above <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> bounds [-Werror=<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>-bounds]</code> </pre><br>  Fixed .config, removed the BCM4329 WiFi module from there and added all possible file systems for flash memory.  I did not understand whether the driver RTL8192 would be compiled, but that‚Äôs ok.  I continue and come to success: <br><pre> <code class="hljs pgsql"> OBJCOPY arch/arm/boot/Image Kernel: arch/arm/boot/Image <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> ready UIMAGE arch/arm/boot/uImage Image <span class="hljs-type"><span class="hljs-type">Name</span></span>: Linux<span class="hljs-number"><span class="hljs-number">-3.0</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span>+ Created: Thu Jul <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span> <span class="hljs-number"><span class="hljs-number">2012</span></span> Image <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>: ARM Linux Kernel Image (uncompressed) Data Size: <span class="hljs-number"><span class="hljs-number">7028772</span></span> Bytes = <span class="hljs-number"><span class="hljs-number">6864.04</span></span> kB = <span class="hljs-number"><span class="hljs-number">6.70</span></span> MB <span class="hljs-keyword"><span class="hljs-keyword">Load</span></span> Address: <span class="hljs-number"><span class="hljs-number">60408000</span></span> Entry <span class="hljs-type"><span class="hljs-type">Point</span></span>: <span class="hljs-number"><span class="hljs-number">60408000</span></span> Image: arch/arm/boot/uImage <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> ready</code> </pre><br><br><h5>  Monster </h5><br>  Dr. Frankenstein challenges nature and will cross the last nucleus with the remains that the easypix threw us. <br><br>  It is <a href="https://wiki.linaro.org/Platform/DevPlatform/Hwpacks">tempting</a> to create a <a href="https://wiki.linaro.org/Platform/DevPlatform/Hwpacks">HWpack</a> for Linaro, but there is no experience in this matter, the desire to support alone - too.  So we take the latest kernel from <a href="">Linaro git</a> and will gradually roll on it what is needed for normal operation of the RK29. <br><br>  So, now .config and Kconfig from easypix.eu.  I realized that last time I forgot to add a line to arch / arm / Kconfig: <br><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">source</span></span> <span class="hljs-string"><span class="hljs-string">"arch/arm/mach-rk29/Kconfig"</span></span></code> </pre><br><br>  and in the Makefile: <br><pre> <code class="hljs mel">machine-$(CONFIG_ARCH_RK29) := rk29 &lt;<span class="hljs-keyword"><span class="hljs-keyword">source</span></span>&gt;  : &lt;<span class="hljs-keyword"><span class="hljs-keyword">source</span></span>&gt; $ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- rk29_ddr3sdk_defconfig</code> </pre><br><br>  added the following to .config: <br><pre> <code class="hljs">CONFIG_MSDOS_FS=y CONFIG_VFAT_FS=y CONFIG_TMPFS=y CONFIG_UBIFS_FS=y CONFIG_UBIFS_FS_ADVANCED_COMPR=y</code> </pre><br>  But that's not all.  Searching for 'rk29' in source code gave 10707 matches in 358 files to be played, among them audio drivers, codecs, Makefiles, Kconfigs, scattered evenly throughout the project. <br><br>  I leave it behind the scenes of this topic.  As soon as it works out, I will definitely update the topic and post the source code and the results.  If you want to join my impulse - write. <br><br><h3>  Distributive </h3><br>  As you know, <a href="http://www.gnu.org/gnu/gnu-linux-faq.html">you will not be fed up with the core</a> , and GNU is supposed to submit to it.  <a href="http://www.linuxfromscratch.org/lfs/view/stable/prologue/package-choices.html">It</a> describes what and why you need to turn the kernel into a full-fledged operating system. <br><br>  Ideally, you want Arch Linux, and as it is written on their website, you can take the distribution for any other device and just add your kernel.  I already have a kernel, so it remains to unpack the downloaded ArchLinuxARM-am33x-latest.tar.gz, remove / boot from it, marveling at how big the self-made kernel is (almost 7MB) compared to the kernel for BeagleBone (2.7MB).  The root folder, from which I am going to make an image of the root partition, occupies about 421MB, 10% of which occupy the kernel sources that are completely unnecessary in my situation (linux-3.2.18-1). <br><br><h3>  Build and Fill </h3><br><br><h4>  Training </h4><br>  So, I have two folders, boot and root, of which I need to make two images, the first in cra <b>p</b> fs, and the second in some file system familiar to the kernel and, preferably, intended for flash memory.  The choice of the file system for the root partition is extensive, since the kernel from easypix.eu came together with support for both JFFS2, and UBIFS, and EXT [2 | 3 | 4], and VFAT and MSDOS.  On the network, they praise YAFFS2, it is a little faster than UBIFS and uses slightly less RAM, but the build again gave errors when trying to connect it to .config, so let it be UBIFS. <br><br>  In addition to collecting images, you need to create a new partition table and an entry point into the kernel, namely the parameter file, which takes 256K of memory at the beginning of flash memory, which I quoted at the beginning of the topic. <br><br>  KERNEL_IMG, coincides with what the kernel issued at the end of the build, so there is no need to change.  CHECK_MASK is the same for all the images I have seen, I don‚Äôt touch either.  The rest of the lines, too, except for CMDLINE, containing the table of MTD partitions and loading arguments. <br>  The site U-Boot <a href="http://www.denx.de/wiki/DULG/UBootCmdGroupFlash">says</a> that the MTD partition table can be set in a simplified form, but I will not risk it, and I will be as close to the original as possible. <br><br>  So, the memory in the device is distributed as follows: <br>  256KB per parameters file <br>  16MB on / boot (in case you suddenly want to reload only the kernel, but it will outgrow 8MB) <br>  residue on / <br><br>  It looks like this: <br><pre> <code class="hljs perl">mtdparts=rk29xxnand:<span class="hljs-number"><span class="hljs-number">0x00008000</span></span>@0x00002000(kernel),-@0x0000a000(<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>)</code> </pre><br>  Before: <br><pre> <code class="hljs swift"><span class="hljs-type"><span class="hljs-type">CMDLINE</span></span>: console=ttyS1,115200n8n androidboot.console=ttyS1 <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>=/<span class="hljs-keyword"><span class="hljs-keyword">init</span></span> initrd=<span class="hljs-number"><span class="hljs-number">0x62000000</span></span>,<span class="hljs-number"><span class="hljs-number">0x300000</span></span> mtdparts=...</code> </pre><br>  It seems to be in the Linux kernel, starting with 3.0, the console began to be called differently, tty01, etc., but leave it as it is. <br>  we will not need androidboot.console and init.  I decided not to do the initrd (a disk in memory that is used to assemble and dynamically load modules), perhaps in vain.  It is necessary to establish the location of the root partition by sticking to it in the desired mtd partition (numbering starting from 0).  You also need to specify the file system type for the root partition. <br><br>  The total is: <br><pre> <code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">CMDLINE:</span></span> console=ttyS1,<span class="hljs-number"><span class="hljs-number">115200</span></span>n8n root=<span class="hljs-regexp"><span class="hljs-regexp">/dev/mtdblock</span></span>1 rootfstype=ubifs noinitrd mtdparts=<span class="hljs-symbol"><span class="hljs-symbol">rk29xxnand:</span></span><span class="hljs-number"><span class="hljs-number">0x00008000</span></span>@0x00002000(kernel),-@0x0000a000(root)</code> </pre><br><br><h4>  Assembly </h4><br><br><h5>  MTD partition table and kernel startup options </h5><br>  I launch mkkrnlimg from RK29kitchen: <br><pre> <code class="hljs vhdl">$ mkkrnlimg -a <span class="hljs-keyword"><span class="hljs-keyword">parameter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parameter</span></span>.img F535BA01 $ ls -l <span class="hljs-number"><span class="hljs-number">316</span></span> Jul <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parameter</span></span> <span class="hljs-number"><span class="hljs-number">328</span></span> Jul <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parameter</span></span>.img</code> </pre><br>  It is embarrassing that the original parm.img, extracted from the device, has a size of 256KB, and the content there is already in five different places.  And then only at the beginning of the file.  Most likely, the Chinese were insured in case U-Boot would try to load this data at another memory offset, and filled it with an additional offset of + 16KB, + 32KB, + 48KB and + 64KB.  It is possible that the remaining 3.75MB, which, judging by the partition table, are not occupied with anything, also contain the same piece. <br>  They differ by only 12 bytes, 8 of which are added to the beginning.  Alas, a comparison with the original parm.img showed that mkkrnlimg adds <pre> <code class="hljs">KRNL&lt;</code> </pre>  and 0x01, and in parm.img it was <pre> <code class="hljs">PARMG</code> </pre>  and 0x02. <br>  The hex editor from mc helps, and I correct the title to be like the original. <br><br><h5>  Core </h5><br><br><pre> <code class="hljs xml">$ mkkrnlimg -a uImage kernel.img 7DDF79C6 $ ls -l 7139328 Jul 5 22:49 uImage 7139340 Jul 10 20:42 kernel.img <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag">&gt;</span></span>    12 , 8   ,  ,  4  . ,    boot.img (  8,  gzip'  cpio)   . <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h5</span></span></span><span class="hljs-tag">&gt;</span></span>  UBIFS<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h5</span></span></span><span class="hljs-tag">&gt;</span></span>     ,    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.linux-mtd.infradead.org/faq/ubifs.html#L_mkfubifs"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> ( ), <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://lists.infradead.org/pipermail/linux-mtd/2008-April/021189.html"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span>. ,      erase       NAND  .        Samsung 201 K9GBG08U0A SCB0,  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://gxwy.en.alibaba.com/product/530746803-213362683/IC_Samsung_Nand_Flash_Flash_Memory_K9GBG08U0A_SCBO.html"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span>  4,  erase   128+4,    2.        UBIFS     UBI   ubinize.cfg: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag">&gt;</span></span> [ubifs] mode=ubi image=ubifs.img vol_id=0 vol_size=4000MiB vol_type=dynamic vol_name=rootfs vol_flags=autoresize</code> </pre><br><br><pre> <code class="hljs ruby">$ mkfs.ubifs -q -r ~<span class="hljs-regexp"><span class="hljs-regexp">/gv2b/root</span></span> -m <span class="hljs-number"><span class="hljs-number">2048</span></span> -e <span class="hljs-number"><span class="hljs-number">131072</span></span> -c <span class="hljs-number"><span class="hljs-number">32767</span></span> -o ubifs.img $ ubinize -o ubi.img -m <span class="hljs-number"><span class="hljs-number">2048</span></span> -p <span class="hljs-number"><span class="hljs-number">128</span></span>KiB ubinize.cfg $ ls -l <span class="hljs-number"><span class="hljs-number">221904896</span></span> Jul <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">14</span></span> ubifs.img <span class="hljs-number"><span class="hljs-number">229376000</span></span> Jul <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">17</span></span> ubi.img</code> </pre><br>  UBIFS supports data compression, and I limited the size of a 4GB volume to a similar physical media size, not sure if this is the right solution. <br><br><h4>  Firmware </h4><br>  It is a little embarrassing that it is desirable to use a <a href="http://www.linux-mtd.infradead.org/doc/ubi.html">special algorithm</a> for recording UBI images. <br><br>  The parameters of the initial position and size to rkflashtool are specified in blocks of 512 bytes in size. <br>  The image of the parameter.img partition table is written in five different offsets, like in Chinese.  The rest is according to the partition table. <br><pre> <code class="hljs ruby">$ rkflashtool29 w <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> &lt; parameter.img $ rkflashtool29 w <span class="hljs-number"><span class="hljs-number">0x00000020</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> &lt; parameter.img $ rkflashtool29 w <span class="hljs-number"><span class="hljs-number">0x00000040</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> &lt; parameter.img $ rkflashtool29 w <span class="hljs-number"><span class="hljs-number">0x00000060</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> &lt; parameter.img $ rkflashtool29 w <span class="hljs-number"><span class="hljs-number">0x00000080</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> &lt; parameter.img $ rkflashtool29 w <span class="hljs-number"><span class="hljs-number">0x00002000</span></span> <span class="hljs-number"><span class="hljs-number">0x00008000</span></span> &lt; kernel.img $ rkflashtool29 w <span class="hljs-number"><span class="hljs-number">0x0000a000</span></span> <span class="hljs-number"><span class="hljs-number">0x0006d600</span></span> &lt; ubi.img &lt;source&gt;    ,       <span class="hljs-number"><span class="hljs-number">4</span></span>     ,        ,  <span class="hljs-number"><span class="hljs-number">50</span></span> .         .       : &lt;source&gt; $ rkflashtool29 b</code> </pre><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Trial and error method </font></font></h3><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> First start </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first launch was not that not successful, but I‚Äôll just say that it‚Äôs a failure. </font><font style="vertical-align: inherit;">The device did not turn on the diode, did not react to pressing the buttons, and did not issue anything via HDMI. </font><font style="vertical-align: inherit;">Very well, that still made a backup. </font><font style="vertical-align: inherit;">Very well, the device is still able to receive data. </font><font style="vertical-align: inherit;">Restore to original state:</font></font><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">rkflashtool29</span></span> w <span class="hljs-number"><span class="hljs-number">0</span></span> 0x00082000 &lt; backup.img</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The device continues to not work. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I launch ./menu.sh from RK29kitchen, change the size of the / system partition in the backup and flash it. </font><font style="vertical-align: inherit;">The device turns on, and shows the string "Loading ...", but does not go further.</font></font> Already not bad.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> I restore the original backup, after the second reboot, Android is still loaded in its original form. </font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What did i do so and what is wrong </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After digging into the source code of RK29kitchen and on the forum where </font><font style="vertical-align: inherit;">rkflashtool was </font></font><a href="http://forum.xda-developers.com/archive/index.php/t-1286305.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">announced</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , it turned out that I was not in vain attributing this image to five different shifts, and that it was necessary (90.flash.sh). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The parameter.img file contains ‚ÄúPARM‚Äù in the first four bytes, and the next two that I mistakenly copied from the original parm.img are the length of the parameter file, 583 bytes. This explains why nothing was loaded (the MTD partition table was not defined and U-Boot could not load the kernel), but does not explain why the light did not light up. Instead of trying on a hex editor, the rkcrc utility was found, which makes an image from the parameter file with the correct headers and a total size of 16KB, launched with the "-p" option. The "-k" option is used to create images with the tag "KRNL".</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rummaged in the original backup.img. </font><font style="vertical-align: inherit;">It is not clear whether it was worth changing the partition table so radically, it is clearly readable in the file that dimensions, offsets and order (sections should go in order of offset) can be changed, and new sections can be created, but the names of sections cannot be changed. </font><font style="vertical-align: inherit;">Who exactly sets such a restriction is not clear, but most likely a bootloader (U-Boot?).</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It was also found that RK29xxLoader (L) _V2.08.bin is used (the binary version 2.04 clearly goes a little further), while versions 2.12, 2.14 and 2.18 are also found in the list of bootloaders RK29kitchen, and in Nextbook, in general, used 2.20. </font><font style="vertical-align: inherit;">How to update the bootloader located on the NOR flash memory (which is only 1MB or so), and whether it is worth doing it is not clear. </font><font style="vertical-align: inherit;">In addition to the bootloader, there is also a package-file, containing a lot of interesting information.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Attempt number two, panic and discouragement </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> I repeat the whole procedure of the firmware, but now with the correct parameter.img. </font></font> Does not work.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Restoring back. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At some point, foolishly instead of taking advantage of RK29kitchen, I recorded backup.img right at offset 0. Then I restored the backup, once again took the dump and redundant backups of the wipers. Updating the firmware from the backup at some point did not work. There was a panic from the fact that it seemed to me that I had erased that initial backup, with the correct backup.img. I wrote a script to restore from individual images, but it did not help. At least the light when the device turns on. But for HDMI there is no signal. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I thought about extundelete, but realizing that it would require chroot and umount, I abandoned this idea in fear of bogging down the system not only on an inexpensive Chinese device.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I stitched all possible firmware, from gbox (a bit of another device with only three USB ports), from the author of the firmware method, found </font></font><a href="http://4pda.ru/forum/lofiversion/index.php%3Ft295852-50.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nothing helped. </font><font style="vertical-align: inherit;">Anyway, brick, sometimes with the LED when turned on, and sometimes completely without. </font><font style="vertical-align: inherit;">It was early morning, and once again I decided that the evening of early morning was wiser. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And how I was right. </font><font style="vertical-align: inherit;">Connecting the device to the monitor, it turned out that everything works.</font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Conclusions and Surveys </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This experience, although not very pleasant, led me to the following conclusions and discoveries on the network: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- the device needs time to reformat partitions after the firmware </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- some firmware have a bootloader, sometimes 2.08, sometimes 2.14. </font><font style="vertical-align: inherit;">Where to flash it is not clear. </font><font style="vertical-align: inherit;">The author of RK29kitchen could not get an answer to this question </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- the mysterious package-file may be located in the mysterious space between the parameters and the kernel, and it is also possible that there is also a bootloader and no less mysterious HWDEF describing the device parameters </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From one of the firmware:</font></font><br><pre> <code class="hljs vhdl">HWDEF <span class="hljs-number"><span class="hljs-number">0</span></span>x00000800 <span class="hljs-number"><span class="hljs-number">0</span></span>x0000031B <span class="hljs-keyword"><span class="hljs-keyword">package</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>x00001000 <span class="hljs-number"><span class="hljs-number">0</span></span>x00000216 RK29xxLoader(L)_V2.<span class="hljs-number"><span class="hljs-number">08</span></span>.bin <span class="hljs-number"><span class="hljs-number">0</span></span>x00001800 <span class="hljs-number"><span class="hljs-number">0</span></span>x000225BE <span class="hljs-keyword"><span class="hljs-keyword">parameter</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>x00024000 <span class="hljs-number"><span class="hljs-number">0</span></span>x00000251</code> </pre><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Attempt number three </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First of all, I made a complete dump of all 4GB of flash memory. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I try to fill the kernel from the backup, unpacking it and packing it again. </font><font style="vertical-align: inherit;">If it does not work, it means that something is wrong. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I unpack, pack and flash:</font></font><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">mkkrnlimg</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">kernel</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.img</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">kernelimg</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mkkrnlimg</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-a</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">kernelimg</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">kernel2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.img</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">rkflashtool29</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">w</span></span> 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">x00004000</span></span> 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">x00004000</span></span> &lt; <span class="hljs-selector-tag"><span class="hljs-selector-tag">kernel2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.img</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reboot - it works. </font><font style="vertical-align: inherit;">The same trick with self-generated uImage does not work. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Even when unpacking using RK29kitchen of the original kernel.img, it was found that inside the image the signature differs from the standard </font></font><a href="http://www.linux-m32r.org/public/codefestweek2008/takata/qemu-0.9.1/html/HTML/S/380.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">version of U-Boot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 27 05 19 56. All the various kernel images from different firmware have the same header:</font></font><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">D3</span></span> F0 <span class="hljs-number"><span class="hljs-number">21</span></span> E3 <span class="hljs-number"><span class="hljs-number">10</span></span> 9F <span class="hljs-number"><span class="hljs-number">10</span></span> EE xx xx <span class="hljs-number"><span class="hljs-number">00</span></span> EB <span class="hljs-number"><span class="hljs-number">05</span></span> A0 B0 E1 xx xx <span class="hljs-number"><span class="hljs-number">00</span></span> 0A</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first thought - in the image walked XOR'om. I check, but, unfortunately, 8 and 16 bit do not fit, and 32 bit for the fourth quartet gives out too large a number to be the size of the image, and that in the third quartet, which should be time, too much matches between different images. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The search query for "D3 F0 21 E3" shows very few results, and among them even less interesting. Here in </font></font><a href="http://www.androidiani.com/forum/mediacom-smartpad-810c/81148-good-news-6.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> thread of the Italian forum it is stated that the sources from Odys do not create the correct image, in contrast to </font></font><a href="https://bitbucket.org/paulobrien/android_kernel_andypad/src"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">these</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kernel sources from Anypad.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And it is possible that the problem is in using my mkkrnlimg from RK29kitchen, because the source from Odys and easypix comes with (by the way, the same) mrkrnlimg, which is very different in size and can convert only in one direction. No, the images created by all three utilities are no different. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I collect the core from Anypad. It is 2.6, but it is interesting to see what title the uImage will have. I got rid of the same error with the bcm4329 module.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I accidentally noticed that in my .config file the output to the LCD panel was turned on, and the DEFAULT_OUT_HDMI option was turned off. This is a huge puncture. I wouldn‚Äôt have been surprised if Linux had booted, but hadn‚Äôt shown anything via HDMI, and I wouldn‚Äôt have known that it had booted. A related DEFAULT_OUT_HDMI problem was found in rk29_fb.c, there was no hdmi_get_default_resolution function, and in the source files from easypix either. I had to write it by touch, putting down more than a dozen parameters. In the structure that this function fills in, there is an amusing parameter of swapping the RGB color channels. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The image was assembled, but in it the same ill-fated standard "27 05". And then I looked around, and in the same directory I noticed the image Image, and in it lies the long-awaited title "D3 F0". I looked at the results of assembling the easypix core - and there it is.</font></font> A pleasant surprise. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can not ignore such an interesting thing as zImage, a self-extracting archive with a kernel image. For the sake of interest, I collected zImage and, the difference in size is impressive. For the partition with the core, 8MB would obviously be enough, with a large margin. By the way, it is almost twice as different from the so-called ‚ÄúzImage‚Äù (which is actually just an Image) extracted from the image of the device core (5.8MB).</font></font><br><pre> <code class="hljs ruby">$ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- zImage $ ls -l arch/arm/boot <span class="hljs-number"><span class="hljs-number">7135268</span></span> Jul <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">03</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">37</span></span> Image <span class="hljs-number"><span class="hljs-number">7139328</span></span> Jul <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">41</span></span> uImage <span class="hljs-number"><span class="hljs-number">3408472</span></span> Jul <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">20</span></span> zImage</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Well, now in the resulting image it remains only to add headers and flash. </font><font style="vertical-align: inherit;">I want to note that rkcrc -k and mkkrnlimg -a give the same result. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I flashed it, turned it on - the diode is off. </font><font style="vertical-align: inherit;">Something does not come out with the core. </font><font style="vertical-align: inherit;">I corrected the header bytes diverging from the original (which, of course, before the CRC), added headers, flashed it ‚Äî it doesn't work. </font><font style="vertical-align: inherit;">He returned the old core to its place. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The thought crept in to look at the / kpanic section, </font></font><a href="http://ru.wikipedia.org/wiki/Kernel_panic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for good reason</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> it was highlighted. </font><font style="vertical-align: inherit;">I downloaded, but alas, there is only something related to the panic of the regular kernel 2.6.32.27. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desperate to flash your core.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Attempt number 4 </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Well, since the kernel could not be flashed, it may be possible to flash everything else, leaving only the kernel. Since it was not possible to take a raid, I will take small steps. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A small </font></font><a href="http://www.androidenea.com/2009/06/android-boot-process-from-power-on.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">excursion</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> into the theory. How is Android loading on the device? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. When turned on from NOR memory (directly, since it supports execute-in-place), the bootloader, U-Boot, starts. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. U-Boot loads the MTD partition table and loads the Linux kernel from the image into memory. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Linux initializes the device drivers, mounts partitions, etc., and then starts init from /. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. init ... is </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">not interesting anymore, because this is Android's init, and just in its place I would like to write my own, from Arch Linux.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">init is at the root, and in the Arch Linux distribution it is in / sbin. There is nothing else left but to copy it to the root. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the original Android, the init file is not in the system section, but in the boot. That is, this particular boot partition is mounted to the root, and the system is mounted to / system. So leave.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the original boot section is rk29xxnand_ko.ko, the module, obviously, designed to work with NAND flash memory. The remaining modules are located in /lib/modules/3.2.18-1/kernel, and links to them are written in /lib/modules/3.2.18-1/modules.order. Packed with gzip, the accompanying ko, I put it on the other modules related to nand in kernel / drivers / mtd / nand, put root.root rights on it, and write it in modules.order and modules.dep. It is unlikely that this will help the kernel find the required module, but it is not possible to force depmod to delve into ELFs of another architecture and find dependencies. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The original kernel does not know anything about UBIFS, so the image created earlier will have to be left aside, and I will be collecting with the help of cpio, gzip and mkkrnlimg:</font></font><br><pre> <code class="hljs swift">$ <span class="hljs-built_in"><span class="hljs-built_in">find</span></span> . -exec touch -d <span class="hljs-string"><span class="hljs-string">"1970-01-01 01:00"</span></span> {} \; $ <span class="hljs-built_in"><span class="hljs-built_in">find</span></span> . ! -name <span class="hljs-string"><span class="hljs-string">"."</span></span> | <span class="hljs-built_in"><span class="hljs-built_in">sort</span></span> | sudo cpio -oa -<span class="hljs-type"><span class="hljs-type">H</span></span> newc | gzip -n &gt;../boot.gz $ cd .. $ mkkrnlimg -a boot.gz boot.img $ ls -l boot.img <span class="hljs-number"><span class="hljs-number">155166888</span></span> <span class="hljs-type"><span class="hljs-type">Jul</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span> boot.img</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Alas, the boot partition is a bit small, and you have to tweak the parameters slightly, expanding it and moving the rest of the sections, for ease of editing, expand it to 512MB (0x00100000): </font></font><br><pre> <code class="hljs perl">CMDLINE: console=ttyS1,<span class="hljs-number"><span class="hljs-number">115200</span></span>n8n androidboot.console=ttyS1 init=<span class="hljs-regexp"><span class="hljs-regexp">/sbin/init</span></span> initrd=<span class="hljs-number"><span class="hljs-number">0x62000000</span></span>,<span class="hljs-number"><span class="hljs-number">0x300000</span></span> mtdparts=rk29xxnand:<span class="hljs-number"><span class="hljs-number">0x00002000</span></span>@0x00002000(misc),<span class="hljs-number"><span class="hljs-number">0x00004000</span></span>@0x00004000(kernel),<span class="hljs-number"><span class="hljs-number">0x00082000</span></span>@0x00008000(boot),<span class="hljs-number"><span class="hljs-number">0x00004000</span></span>@0x0008A000(recovery),<span class="hljs-number"><span class="hljs-number">0x00080000</span></span>@0x0008E000(<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>),<span class="hljs-number"><span class="hljs-number">0x00082000</span></span>@0x0010E000(backup),<span class="hljs-number"><span class="hljs-number">0x0003a000</span></span>@0x00190000(cache),<span class="hljs-number"><span class="hljs-number">0x00100000</span></span>@0x001ca000(userdata),<span class="hljs-number"><span class="hljs-number">0x00002000</span></span>@0x002ca000(kpanic),-@0x002cc000(user)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the same time, there was also a path to the init file, corrected it also on / sbin / init. </font><font style="vertical-align: inherit;">Package:</font></font><br><pre> <code class="hljs ruby">$ rkcrc -p parameter parmnew.img $ ls -l <span class="hljs-number"><span class="hljs-number">16384</span></span> Jul <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">13</span></span> parmnew.img</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By the way, the cache, kpanic and userdata sections are used to erase the first 256KB, and not to touch the user section at all, as I learned from the RK29kitchen sources, but the sections following the system excite me a little. </font><font style="vertical-align: inherit;">Sections misc and kernel do not change. </font><font style="vertical-align: inherit;">In the boot I upload Arch Linux, I rub the rest entirely.</font></font><br><pre> <code class="hljs ruby">$ rkflashtool29 w <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> &lt; parmnew.img $ rkflashtool29 w <span class="hljs-number"><span class="hljs-number">0x00000020</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> &lt; parmnew.img $ rkflashtool29 w <span class="hljs-number"><span class="hljs-number">0x00000040</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> &lt; parmnew.img $ rkflashtool29 w <span class="hljs-number"><span class="hljs-number">0x00000060</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> &lt; parmnew.img $ rkflashtool29 w <span class="hljs-number"><span class="hljs-number">0x00000080</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> &lt; parmnew.img $ rkflashtool29 w <span class="hljs-number"><span class="hljs-number">0x00008000</span></span> <span class="hljs-number"><span class="hljs-number">0x00082000</span></span> &lt; boot.img $ rkflashtool29 e <span class="hljs-number"><span class="hljs-number">0x0008a000</span></span> <span class="hljs-number"><span class="hljs-number">0x006f6000</span></span> $ rkflashtool29 b</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I was a little sad at the size of boot.img and further offset for erasing. I wonder how many similar errors I have already made? Maybe a non-native kernel would start up normally? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After the restart, it takes about 10 seconds, then the LED lights up. And, lo and behold! A penguin appeared in the upper left corner of the screen, hung for about ten minutes, and then a dark blue background remained, and nothing else happened. On subsequent downloads, the penguin appears almost instantly. A connected keyboard has no effect. The kpanic is clean (nothing but 00 and FF).</font></font><br><img src="http://habrastorage.org/storage2/07c/0b7/67d/07c0b767da79fec81be11ec99fa84ea2.jpg"><br><br><h3>  Conclusion </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You need to be a good specialist at a high level so that without documentation and source codes you can cope with such a device, and this specialist is clearly not me. </font><font style="vertical-align: inherit;">Either the device is absolutely not what you need. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I really wanted to lay out the images that I had, upload screenshots and a short video with some new 3D game, but no luck. </font><font style="vertical-align: inherit;">Agree, bad experience is also an experience.</font></font><br><br><h3>  Links </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> I present an abbreviated list of the interesting things that I read, which for some reason did not fall into the links to the topic itself. </font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Firmware, images, iron </font></font></h4><br> <a href="http://androidforums.com/google-tv/505559-flashing-android-tv-box-one-four-usb.html">androidforums.com/google-tv/505559-flashing-android-tv-box-one-four-usb.html</a> <br> <a href="http://androidforums.com/google-tv/506298-rk2918-android-tv-box-4x-usb-rooted-firmware-manual.html">androidforums.com/google-tv/506298-rk2918-android-tv-box-4x-usb-rooted-firmware-manual.html</a> <br> <a href="http://androidforums.com/google-tv/413090-r-box-rockchip-2918-google-tv-3.html">androidforums.com/google-tv/413090-r-box-rockchip-2918-google-tv-3.html</a> <br><br> <a href="https://sites.google.com/site/rk2918tools">sites.google.com/site/rk2918tools</a> <br><br> <a href="http://thomaspolasek.blogspot.com/2012/04/arch-linux-lxde-w-xorg-mouse-keyboard_16.html">thomaspolasek.blogspot.com/2012/04/arch-linux-lxde-w-xorg-mouse-keyboard_16.html</a> <br><br> <a href="http://cxem.net/comp/comp70.php">cxem.net/comp/comp70.php</a> <br> <a href="https://github.com/OlegKyiashko/RK29kitchen">github.com/OlegKyiashko/RK29kitchen</a> <br><br> <a href="http://4pda.ru/forum/lofiversion/index.php%3Ft337784-50.html">4pda.ru/forum/lofiversion/index.php?t337784-50.html</a> <br> <a href="http://4pda.ru/forum/index.php%3Fshowtopic%3D319345">4pda.ru/forum/index.php?showtopic=319345</a> <br> <a href="http://4pda.ru/forum/index.php%3Fshowtopic%3D313261">4pda.ru/forum/index.php?showtopic=313261</a> <br><br> <a href="http://forum.xda-developers.com/showthread.php%3Ft%3D1286305">forum.xda-developers.com/showthread.php?t=1286305</a> <br><br> <a href="http://www.androidtablets.net/forum/rockchip-rk2818-tablets/21291-problems-getting-image-dumped-rkdump.html">www.androidtablets.net/forum/rockchip-rk2818-tablets/21291-problems-getting-image-dumped-rkdump.html</a> <br> <a href="http://www.androidtablets.net/forum/rockchip-based/439-how-unpack-repack-custom-firmwares-rockchip-rk28xx.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.androidtablets.net/forum/rockchip-based/439-how-unpack-repack-custom-firmwares-rockchip-rk28xx.html </font></font></a> <br><br> <a href="http://www.freaktab.com/showthread.php%3F287-RockChip-ROM-Building-Tips-and-Tricks-by-Finless"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.freaktab.com/showthread.php?287-RockChip-ROM-Building-Tips-and -by--Tricks finless </font></font></a> <br> <a href="http://www.freaktab.com/showthread.php%3F401-Dumping-ROM-using-ADB-guide"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.freaktab.com/showthread.php?401-Dumping-ROM-using-ADB-guide </font></font></a> <br><br> <a href="http://www.arctablet.com/wiki/index.php/Rockchip_2918_devices_MTD_partitions_mapping"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.arctablet.com/wiki/index.php/Rockchip_2918_devices_MTD_partitions_mapping </font></font></a> <br><br> <a href="http://yanzicjustnubie.wordpress.com/2011/09/10/linux-installer-easy-way-to-install-debianubuntu-on-android/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yanzicjustnubie.wordpress.com/2011/09/ 10 / linux-installer-easy-way-to-install-debianubuntu-on-android</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> chroot linux on android </font></font><br> <a href="http://wiki.debian.org/DebianInstaller/Arm/OtherPlatforms"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wiki.debian.org/DebianInstaller/Arm/OtherPlatforms </font></font></a> <br> <a href="http://www.arm.com/community/software-enablement/linux.php"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.arm.com/community/software-enablement/linux.php </font></font></a> <br> <a href="http://code.google.com/p/beagleboard/wiki/LinuxBootDiskFormat"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code .google.com / p / beagleboard / wiki / LinuxBootDiskFormat </font></font></a> <br><br> <a href="http://www.yoctoproject.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.yoctoproject.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - build custom linux distro</font></font><br> <a href="http://www.freaktab.com/showthread.php%3F1053-RK2918-set-top-box-linux-installation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.freaktab.com/showthread.php?1053-RK2918-set-top-box-linux-installation </font></font></a> <br> <a href="https://github.com/wendal/teclast_tools"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/wendal/teclast_tools </font></font></a> <br> <a href="https://wiki.archlinux.org/index.php/Partitioning"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wiki.archlinux.org/index.php/Partitioning#Partitions_in_a_GNU.2FUnix_system </font></font></a> <br> <a href="http://www.google.com/search%3Fq%3Drockchips%2Bconfidential%2B2918"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A wonderful search query</font></font></a> <br><br><h4>  Other </h4><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Of particular note is </font></font><a href="http://www.cnx-software.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.cnx-software.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , an interesting site about everything related to ARM.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Another interesting iron </font></font></h4><br><br> <a href="http://www.cnx-software.com/2012/06/26/list-of-39-low-cost-linux-friendly-boards-and-products"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selection with prices </font></font></a> <br> <a href="http://olimex.com/dev/index.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">olimex.com/dev/index.html </font></font></a> <br> <a href="http://rhombus-tech.net/allwinner_a10/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rhombus-tech.net/allwinner_a10 </font></font></a> <br> <a href="http://www.hardkernel.com/renewal_2011/products/prdt_info.php%3Fg_code%3DG133999328931"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.hardkernel.com/renewal_2011/products/prdt_info.php?g_code=G133999328931 </font></font></a> <br> <a href="http://www.technexion.com/index.php/products/development-kits/infernopack"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.technexion.com/index.php/products/development- kits / infernopack </font></font></a> <br> <a href="http://www.advantech.com/products/ROM-1210/mod_D5882807-78CE-4A64-AADA-FAEAA099F2CB.aspx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.advantech.com/products/ROM-1210/mod_D5882807-78CE-4A64-AADA-FAEAA099F2CB.aspx </font></font></a> <br> <a href="http://www.sigmadesigns.com/products.php%3Fid%3D38"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.sigmadesigns.com/products.php?id=38 </font></font></a> <br> <a href="http://www.renesas.com/press/news/2012/news20120110.jsp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.renesas.com/press/news/2012 /news20120110.jsp</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And the </font></font><a href="http://www.renesas.com/press/news/2012/news20120110_s.jsp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prototype of</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> all these HDMI sticks on the processor is the line above. </font></font><br> <a href="http://www.cnx-software.com/2012/07/10/ippea-tv-android-4-0-3-hdmi-stick-based-on-ingenic-jz4770-mips-sells-for-50-usd"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.cnx-software.com/2012/07/10/ippea-tv-android-4-0-3-hdmi-stick-based-on-ingenic-jz4770-mips-sells-for-50-usd</font></font></a> <br><br> <a href="http://www.uplaytablet.com/compare-soc-cpus-used-in-ainol-elf-aurora-ii-amlogic-8726-mx-wopad-i7-i8-rock-chip-rk-2918-and-wopad-a10-allwinner-a10/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.uplaytablet.com/compare-soc-cpus-used-in-ainol-elf-aurora-ii-amlogic-8726-mx-wopad-i7-i8-rock-chip-rk-2918-and-wopad-a10- allwinner-a10 </font></font></a> <br> <a href="http://rhombus-tech.net/evaluated_cpus/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rhombus-tech.net/evaluated_cpus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - overview of various processors for use in compact devices </font></font><br><br> <a href="http://en.qi-hardware.com/wiki/Main_Page"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en.qi-hardware.com/wiki/Main_Page </font></font></a> <br><br> <a href="http://www.wits-tech.com/pages/board-en.jsp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.wits-tech.com/pages/board-en.jsp </font></font></a> <br> <a href="http://www.pineriver.cn/eshowProDetail.asp%3FProID%3D1527"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.pineriver.cn /eshowProDetail.asp?ProID=1527 </font></font></a> <br> <a href="http://www.calao-systems.com/articles.php%3Flng%3Den%26pg%3D6186"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.calao-systems.com/articles.php?lng=en&amp;pg=6186 </font></font></a> <br><br> <a href="http://www.st.com/internet/mcu/product/251211.jsp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.st.com/internet/mcu/product/251211.jsp </font></font></a> <br> <a href="http://www.st.com/internet/evalboard/product/253211.jsp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.st.com/internet/evalboard/ product / 253211.jsp</font></font></a> <br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Installing GNU / Linux on hardware </font></font></h4><br><br> <a href="http://archlinuxarm.org/forum/viewtopic.php%3Ff%3D27%26t%3D2709"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">archlinuxarm.org/forum/viewtopic.php?f=27&amp;t=2709</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mele A1000 Archlinux </font></font><br> <a href="http://rhombus-tech.net/allwinner_a10/hacking_the_mele_a1000/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rhombus-tech.net/allwinner_a10/hacking_the_mele_a1000 </font></font></a> <br> <a href="http://www.cnx-software.com/2012/06/13/hardware-packs-for-allwinner-a10-devices-and-easier-method-to-create-a-bootable-ubuntu-12-04-sd-card/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.cnx-software.com/2012/06/13/hardware-packs-for-allwinner-a10 -devices-and-easier-method-to-create-a-bootable-ubuntu-12-04-sd-card </font></font></a> <br> <a href="http://gitorious.org/ac100/abootimg/blobs/master/README"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gitorious.org/ac100/abootimg/blobs/master/README</font></font></a> </div><p>Source: <a href="https://habr.com/ru/post/147793/">https://habr.com/ru/post/147793/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../147787/index.html">Be creative! Or MCC from Raspberry Pi</a></li>
<li><a href="../147788/index.html">Google has started shipping tablets Nexus 7</a></li>
<li><a href="../147789/index.html">The challenge of the competition ICFPC-2012: the robot and Œª</a></li>
<li><a href="../147790/index.html">1532 days without code changes</a></li>
<li><a href="../147791/index.html">And if you compare the level of development of the communities of Habrahabr and Russian (!) Wikipedia, it turns out:</a></li>
<li><a href="../147795/index.html">What are you striving for in your IT career? (Assume the same income of all options)</a></li>
<li><a href="../147796/index.html">We consider Pi in parallel. Part 1</a></li>
<li><a href="../147797/index.html">If your life depends on the doctor, let it be a military doctor</a></li>
<li><a href="../147798/index.html">ICFPC 2012 with crowdsourcing and neural networks</a></li>
<li><a href="../147799/index.html">XNA Draw: improving the graphics of the game</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>