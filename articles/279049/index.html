<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Checking the status of antivirus in the corporate network using VBScript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 
 It all started with the fact that the purchased corporate solution for auditing systems did not provide the necessary information on the an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Checking the status of antivirus in the corporate network using VBScript</h1><div class="post__text post__text-html js-mediator-article"><h4>  Foreword </h4><br>  It all started with the fact that the purchased corporate solution for auditing systems did not provide the necessary information on the antivirus product used, and it worked too long, and the control panel used by the antivirus company leaves much to be desired.  It was decided to use the ‚Äúcrutch‚Äù to collect information about antivirus programs in the domain. <br><br>  <i>The following script handles the status states of only the antiviruses used in our corporate network.</i> <br><a name="habracut"></a><br><h4>  What exactly is needed and how to do it? </h4><br>  First of all, it was determined what to get from the antivirus and how to do it in a short period of time from the entire domain. <br><br>  It was necessary to receive: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1) Name of the installed anti-virus <br>  2) Is the antivirus active? <br>  3) Are the bases updated on it? <br><br>  Actually the method was found instantly - use <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa394582%2528v%3Dvs.85%2529.aspx">WMI</a> (Windows Management Instrumentation). <br><br>  I had to immerse myself in the study of the very structure of WMI on a PC, this was helped by a wonderful set of <a href="https://www.microsoft.com/en-us/download/details.aspx%3Fid%3D24045">WMI Tools</a> utilities. <br><br>  After that, it was necessary to decide how to interact with WMI, without hesitation, I decided to write a script in VBScript. <br><br><h4>  Debriefing </h4><br>  The script processes 3,500 hosts in approximately 1 hour.  Actually the script code itself: <br><br><div class="spoiler">  <b class="spoiler_title">Script code</b> <div class="spoiler_text"><pre><code class="vbscript hljs">WScript.Interactive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> compid = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">On</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Resume</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> objDomain = <span class="hljs-built_in"><span class="hljs-built_in">GetObject</span></span>(<span class="hljs-string"><span class="hljs-string">"LDAP://DOMAIN/OU=Workstations,DC=DOMAIN"</span></span>) comps = <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> objDomainItem <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> objDomain <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> objDomainItem.objectClass = <span class="hljs-string"><span class="hljs-string">"Computer"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> idxLast = <span class="hljs-built_in"><span class="hljs-built_in">UBound</span></span> (comps) <span class="hljs-keyword"><span class="hljs-keyword">ReDim</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Preserve</span></span> comps(idxLast + <span class="hljs-number"><span class="hljs-number">1</span></span>) comps(idxLast + <span class="hljs-number"><span class="hljs-number">1</span></span>) = objDomainItem.dNSHostName <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> objFS = <span class="hljs-built_in"><span class="hljs-built_in">CreateObject</span></span>(<span class="hljs-string"><span class="hljs-string">"Scripting.FileSystemObject"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> objNewFile = objFS.CreateTextFile(<span class="hljs-string"><span class="hljs-string">"C:\TEMP\AV_Check\Reports\AV_Status_Scan_is_Running.WAIT"</span></span>) a = <span class="hljs-string"><span class="hljs-string">"&lt;style&gt;"</span></span> a = a&amp; <span class="hljs-string"><span class="hljs-string">"@import ""TableFilter/filtergrid.css"";"</span></span> a = a&amp; <span class="hljs-string"><span class="hljs-string">"BODY{background-color:Lavender ;}"</span></span> a = a&amp; <span class="hljs-string"><span class="hljs-string">"TABLE{font-size: 10pt; font-family: arial;}"</span></span> a = a&amp; <span class="hljs-string"><span class="hljs-string">"TH{background-color: buttonface; }"</span></span> a = a&amp; <span class="hljs-string"><span class="hljs-string">"&lt;/style&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;html&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;head&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;script language=""javascript"" type=""text/javascript"" src=""TableFilter/tablefilter.js""&gt;&lt;/script&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;title&gt;AntiVirus status information&lt;/title&gt;"</span></span> objNewFile.WriteLine a &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/head&gt;&lt;body&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;h2&gt;AVSI -- Date: "</span></span> &amp; <span class="hljs-built_in"><span class="hljs-built_in">Now</span></span>() &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/h2&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;script type=""text/javascript""&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"var tableToExcel = (function() {"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" var uri = 'data:application/vnd.ms-excel;base64,'"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" , template = '&lt;html xmlns:o=""urn:schemas-microsoft-com:office:office"" xmlns:x=""urn:schemas-microsoft-com:office:excel""&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;table&gt;{table}&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;'"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" , base64 = function(s) { return window.btoa(unescape(encodeURIComponent(s))) }"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" , format = function(s, c) { return s.replace(/{(\w+)}/g, function(m, p) { return c[p]; }) }"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"return function(table, name) {"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" if (!table.nodeType) table = document.getElementById(table)"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" var ctx = {worksheet: name || 'Worksheet', table: table.innerHTML}"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" window.location.href = uri + base64(format(template, ctx))"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"}"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"})()"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;/script&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;input type=""button"" onclick=""tableToExcel('table1', 'Export data')"" value=""Export data to Excel""&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;table id=""table1"" BORDER=""1"" width=""100%""&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;tr&gt;&lt;th width=""2%""&gt;id&lt;/th&gt;&lt;th&gt;Computer&lt;/th&gt;&lt;th&gt;AV Name&lt;/th&gt;&lt;th&gt;AV Status&lt;/th&gt;&lt;th&gt;AV Bases&lt;/th&gt;&lt;th&gt;Host Status&lt;/th&gt;&lt;/tr&gt;"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> comp <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> comps compid = compid + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> WshShell = WScript.<span class="hljs-built_in"><span class="hljs-built_in">CreateObject</span></span>(<span class="hljs-string"><span class="hljs-string">"WScript.Shell"</span></span>) Ping = WshShell.Run(<span class="hljs-string"><span class="hljs-string">"ping -n 1 "</span></span> &amp; comp, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-literal"><span class="hljs-literal">True</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Case</span></span> Ping <span class="hljs-keyword"><span class="hljs-keyword">Case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">On</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Resume</span></span> <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> oWMI = <span class="hljs-built_in"><span class="hljs-built_in">GetObject</span></span>(<span class="hljs-string"><span class="hljs-string">"winmgmts:\\"</span></span> &amp; comp &amp; <span class="hljs-string"><span class="hljs-string">"\root\SecurityCenter2"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">On</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Resume</span></span> <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> colAVItems = oWMI.ExecQuery(<span class="hljs-string"><span class="hljs-string">"Select * from AntiVirusProduct"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> colAVItems.count = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;tr&gt;&lt;th&gt;"</span></span> &amp; compid &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;"</span></span> &amp; comp &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;&lt;font color=""red""&gt;No AntiViruses found&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""red""&gt;Disabled&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""red""&gt;NOT Up to Date&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""green""&gt;Online&lt;/font&gt;&lt;/th&gt;&lt;/tr&gt;"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ElseIf</span></span> colAVItems.count = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Each</span></span> AntiVirus <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> colAVItems <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> (AntiVirus.displayName) &lt;&gt; <span class="hljs-string"><span class="hljs-string">"Windows Defender"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> AVStatus = <span class="hljs-built_in"><span class="hljs-built_in">hex</span></span>(AntiVirus.ProductState) <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> (AVStatus = <span class="hljs-string"><span class="hljs-string">"61000"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> (AVStatus = <span class="hljs-string"><span class="hljs-string">"51000"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> (AVStatus = <span class="hljs-string"><span class="hljs-string">"41000"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;tr&gt;&lt;th&gt;"</span></span> &amp; compid &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;"</span></span> &amp; comp &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;"</span></span> &amp; AntiVirus.displayName &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;&lt;font color=""green""&gt;Active&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""green""&gt;Up to Date&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""green""&gt;Online&lt;/font&gt;&lt;/th&gt;&lt;/tr&gt;"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ElseIf</span></span> (AVStatus = <span class="hljs-string"><span class="hljs-string">"41010"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> (AVStatus = <span class="hljs-string"><span class="hljs-string">"61010"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> (AVStatus = <span class="hljs-string"><span class="hljs-string">"51010"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;tr&gt;&lt;th&gt;"</span></span> &amp; compid &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;"</span></span> &amp; comp &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;"</span></span> &amp; AntiVirus.displayName &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;&lt;font color=""green""&gt;Active&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""red""&gt;NOT Up to Date&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""green""&gt;Online&lt;/font&gt;&lt;/th&gt;&lt;/tr&gt;"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ElseIf</span></span> (AVStatus = <span class="hljs-string"><span class="hljs-string">"60000"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> (AVStatus = <span class="hljs-string"><span class="hljs-string">"50000"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> (AVStatus = <span class="hljs-string"><span class="hljs-string">"40000"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;tr&gt;&lt;th&gt;"</span></span> &amp; compid &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;"</span></span> &amp; comp &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;"</span></span> &amp; AntiVirus.displayName &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;&lt;font color=""red""&gt;On Access scanning disabled!&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""green""&gt;Up to Date&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""green""&gt;Online&lt;/font&gt;&lt;/th&gt;&lt;/tr&gt;"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Else</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;tr&gt;&lt;th&gt;"</span></span> &amp; compid &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;"</span></span> &amp; comp &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;"</span></span> &amp; AntiVirus.displayName &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;&lt;font color=""purple""&gt;Unknown&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""purple""&gt;Unknown&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""green""&gt;Online&lt;/font&gt;&lt;/th&gt;&lt;/tr&gt;"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;tr&gt;&lt;th&gt;"</span></span> &amp; compid &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;"</span></span> &amp; comp &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;&lt;font color=""purple""&gt;Unknown&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""purple""&gt;Unknown&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""purple""&gt;Unknown&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""red""&gt;Offline&lt;/font&gt;&lt;/th&gt;&lt;/tr&gt;"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;/table&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;script language=""javascript"" type=""text/javascript""&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"//&lt;![CDATA["</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"var tableFilters = {"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" sort_select: true,"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" loader: true,"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" rows_counter: true,"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" col_2: ""select"","</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" col_3: ""select"","</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" col_4: ""select"","</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" col_5: ""select"","</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" on_change: true,"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" display_all_text: "" [ Show all ] "","</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" alternate_rows: true,"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"}"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"setFilterGrid( ""table1"",tableFilters);"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"//]]&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;/script&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;h2&gt;End of scan: "</span></span> &amp; <span class="hljs-built_in"><span class="hljs-built_in">Now</span></span>() &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/h2&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;/body&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;/html&gt;"</span></span> objNewFile.Close objFS.MoveFile <span class="hljs-string"><span class="hljs-string">"C:\TEMP\AV_Check\Reports\AV_Status_Scan_is_Running.WAIT"</span></span>, <span class="hljs-string"><span class="hljs-string">"C:\TEMP\AV_Check\Reports\AV_Status_"</span></span> &amp; <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span> &amp; <span class="hljs-string"><span class="hljs-string">"_"</span></span> &amp; <span class="hljs-built_in"><span class="hljs-built_in">Hour</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">Now</span></span>()) &amp; <span class="hljs-string"><span class="hljs-string">"."</span></span> &amp; <span class="hljs-built_in"><span class="hljs-built_in">Minute</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">Now</span></span>()) &amp; <span class="hljs-string"><span class="hljs-string">".htm"</span></span></code> </pre> <br></div></div><br>  What actually happens?  And that's exactly what happens: <br><br>  1) We connect to the domain and go to the Workstations directory: <br><br><div class="spoiler">  <b class="spoiler_title">Connecting to a domain using LDAP</b> <div class="spoiler_text"><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> objDomain = <span class="hljs-built_in"><span class="hljs-built_in">GetObject</span></span>(<span class="hljs-string"><span class="hljs-string">"LDAP://DOMAIN/OU=Workstations,DC=DOMAIN"</span></span>)</code> </pre><br></div></div><br>  2) Create an empty array in which users' PCs with the appropriate Computer class will be added: <br><br><div class="spoiler">  <b class="spoiler_title">Creating and populating an array</b> <div class="spoiler_text"><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> objDomainItem <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> objDomain <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> objDomainItem.objectClass = <span class="hljs-string"><span class="hljs-string">"Computer"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> idxLast = <span class="hljs-built_in"><span class="hljs-built_in">UBound</span></span> (comps) <span class="hljs-keyword"><span class="hljs-keyword">ReDim</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Preserve</span></span> comps(idxLast + <span class="hljs-number"><span class="hljs-number">1</span></span>) comps(idxLast + <span class="hljs-number"><span class="hljs-number">1</span></span>) = objDomainItem.dNSHostName <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">next</span></span></code> </pre><br></div></div><br>  3) Create a report file.  It was decided to form the report in the .htm format and accordingly form the page in the script itself: <br><br><div class="spoiler">  <b class="spoiler_title">Formation htm page</b> <div class="spoiler_text"><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> objFS = <span class="hljs-built_in"><span class="hljs-built_in">CreateObject</span></span>(<span class="hljs-string"><span class="hljs-string">"Scripting.FileSystemObject"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> objNewFile = objFS.CreateTextFile(<span class="hljs-string"><span class="hljs-string">"C:\TEMP\AV_Check\Reports\AV_Status_Scan_is_Running.WAIT"</span></span>) a = <span class="hljs-string"><span class="hljs-string">"&lt;style&gt;"</span></span> a = a&amp; <span class="hljs-string"><span class="hljs-string">"@import ""TableFilter/filtergrid.css"";"</span></span> a = a&amp; <span class="hljs-string"><span class="hljs-string">"BODY{background-color:Lavender ;}"</span></span> a = a&amp; <span class="hljs-string"><span class="hljs-string">"TABLE{font-size: 10pt; font-family: arial;}"</span></span> a = a&amp; <span class="hljs-string"><span class="hljs-string">"TH{background-color: buttonface; }"</span></span> a = a&amp; <span class="hljs-string"><span class="hljs-string">"&lt;/style&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;html&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;head&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;script language=""javascript"" type=""text/javascript"" src=""TableFilter/tablefilter.js""&gt;&lt;/script&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;title&gt;AntiVirus status information&lt;/title&gt;"</span></span> objNewFile.WriteLine a &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/head&gt;&lt;body&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;h2&gt;AVSI -- Date: "</span></span> &amp; <span class="hljs-built_in"><span class="hljs-built_in">Now</span></span>() &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/h2&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;script type=""text/javascript""&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"var tableToExcel = (function() {"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" var uri = 'data:application/vnd.ms-excel;base64,'"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" , template = '&lt;html xmlns:o=""urn:schemas-microsoft-com:office:office"" xmlns:x=""urn:schemas-microsoft-com:office:excel""&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;table&gt;{table}&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;'"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" , base64 = function(s) { return window.btoa(unescape(encodeURIComponent(s))) }"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" , format = function(s, c) { return s.replace(/{(\w+)}/g, function(m, p) { return c[p]; }) }"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"return function(table, name) {"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" if (!table.nodeType) table = document.getElementById(table)"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" var ctx = {worksheet: name || 'Worksheet', table: table.innerHTML}"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" window.location.href = uri + base64(format(template, ctx))"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"}"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"})()"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;/script&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;input type=""button"" onclick=""tableToExcel('table1', 'Export data')"" value=""Export data to Excel""&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;table id=""table1"" BORDER=""1"" width=""100%""&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;tr&gt;&lt;th width=""2%""&gt;id&lt;/th&gt;&lt;th&gt;Computer&lt;/th&gt;&lt;th&gt;AV Name&lt;/th&gt;&lt;th&gt;AV Status&lt;/th&gt;&lt;th&gt;AV Bases&lt;/th&gt;&lt;th&gt;Host Status&lt;/th&gt;&lt;/tr&gt;"</span></span> { ... } objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;/table&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;script language=""javascript"" type=""text/javascript""&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"//&lt;![CDATA["</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"var tableFilters = {"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" sort_select: true,"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" loader: true,"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" rows_counter: true,"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" col_2: ""select"","</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" col_3: ""select"","</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" col_4: ""select"","</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" col_5: ""select"","</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" on_change: true,"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" display_all_text: "" [ Show all ] "","</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">" alternate_rows: true,"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"}"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"setFilterGrid( ""table1"",tableFilters);"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"//]]&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;/script&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;h2&gt;End of scan: "</span></span> &amp; <span class="hljs-built_in"><span class="hljs-built_in">Now</span></span>() &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/h2&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;/body&gt;"</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;/html&gt;"</span></span> objNewFile.Close</code> </pre><br></div></div><br>  For convenience, the <a href="http://tablefilter.free.fr/">HTML Table Filter Generator</a> was used, which generates filters upon completion of the script on the generated table with the fields id, Computer, AV Name, AV Status, AV Bases. <br><br>  Also added is a button for uploading a table to Excel, which I found on some forum (to be honest with it, I didn‚Äôt even bother with it and left it as it is, it works crookedly and, as practice has shown, only under FireFox). <br><br>  4) The array we have formed and is stored in memory, now consider the filling of the report table.  First of all, we set the counter to assign an id to each host in the array.  After that we call the Shell script to check the availability of the host by sending a 1 icmp package to it.  We create conditions for processing the response, Case 0 - the host is available and execute the data collection script to populate the table, Case 1 - output to the table the information that the host is not available: <br><br><div class="spoiler">  <b class="spoiler_title">Host availability check</b> <div class="spoiler_text"><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> comp <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> comps compid = compid + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> WshShell = WScript.<span class="hljs-built_in"><span class="hljs-built_in">CreateObject</span></span>(<span class="hljs-string"><span class="hljs-string">"WScript.Shell"</span></span>) Ping = WshShell.Run(<span class="hljs-string"><span class="hljs-string">"ping -n 1 "</span></span> &amp; comp, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-literal"><span class="hljs-literal">True</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Case</span></span> Ping <span class="hljs-keyword"><span class="hljs-keyword">Case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> { ... } <span class="hljs-keyword"><span class="hljs-keyword">Case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;tr&gt;&lt;th&gt;"</span></span> &amp; compid &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;"</span></span> &amp; comp &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;&lt;font color=""purple""&gt;Unknown&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""purple""&gt;Unknown&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""purple""&gt;Unknown&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""red""&gt;Offline&lt;/font&gt;&lt;/th&gt;&lt;/tr&gt;"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span></code> </pre><br></div></div><br>  5) Check whether we have errors, and if there is, then just go to the next host.  Information on Antivirus, Anti-Spyware, and Firewalls in WMI is stored in the \ root \ SecurityCenter2 directory, so we connect to it and create a WQL query, which actually pulls out the information we need about the product.  We check if there is an antivirus on the host at all, and if there is, then we check if it is not Windows Defender, and even if it is, then just ignore it.  Each antivirus has its own status code, I found out about it on the <a href="http://neophob.com/2010/03/wmi-query-windows-securitycenter2/">forum</a> : <br><br><div class="spoiler">  <b class="spoiler_title">Checking the status of the Anti-Virus and filling the table</b> <div class="spoiler_text"><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">On</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Resume</span></span> <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> oWMI = <span class="hljs-built_in"><span class="hljs-built_in">GetObject</span></span>(<span class="hljs-string"><span class="hljs-string">"winmgmts:\\"</span></span> &amp; comp &amp; <span class="hljs-string"><span class="hljs-string">"\root\SecurityCenter2"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">On</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Resume</span></span> <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> colAVItems = oWMI.ExecQuery(<span class="hljs-string"><span class="hljs-string">"Select * from AntiVirusProduct"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> colAVItems.count = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;tr&gt;&lt;th&gt;"</span></span> &amp; compid &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;"</span></span> &amp; comp &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;&lt;font color=""red""&gt;No AntiViruses found&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""red""&gt;Disabled&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""red""&gt;NOT Up to Date&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""green""&gt;Online&lt;/font&gt;&lt;/th&gt;&lt;/tr&gt;"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ElseIf</span></span> colAVItems.count = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Each</span></span> AntiVirus <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> colAVItems <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> (AntiVirus.displayName) &lt;&gt; <span class="hljs-string"><span class="hljs-string">"Windows Defender"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> AVStatus = <span class="hljs-built_in"><span class="hljs-built_in">hex</span></span>(AntiVirus.ProductState) <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> (AVStatus = <span class="hljs-string"><span class="hljs-string">"61000"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> (AVStatus = <span class="hljs-string"><span class="hljs-string">"51000"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> (AVStatus = <span class="hljs-string"><span class="hljs-string">"41000"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;tr&gt;&lt;th&gt;"</span></span> &amp; compid &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;"</span></span> &amp; comp &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;"</span></span> &amp; AntiVirus.displayName &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;&lt;font color=""green""&gt;Active&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""green""&gt;Up to Date&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""green""&gt;Online&lt;/font&gt;&lt;/th&gt;&lt;/tr&gt;"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ElseIf</span></span> (AVStatus = <span class="hljs-string"><span class="hljs-string">"41010"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> (AVStatus = <span class="hljs-string"><span class="hljs-string">"61010"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> (AVStatus = <span class="hljs-string"><span class="hljs-string">"51010"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;tr&gt;&lt;th&gt;"</span></span> &amp; compid &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;"</span></span> &amp; comp &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;"</span></span> &amp; AntiVirus.displayName &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;&lt;font color=""green""&gt;Active&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""red""&gt;NOT Up to Date&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""green""&gt;Online&lt;/font&gt;&lt;/th&gt;&lt;/tr&gt;"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ElseIf</span></span> (AVStatus = <span class="hljs-string"><span class="hljs-string">"60000"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> (AVStatus = <span class="hljs-string"><span class="hljs-string">"50000"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> (AVStatus = <span class="hljs-string"><span class="hljs-string">"40000"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;tr&gt;&lt;th&gt;"</span></span> &amp; compid &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;"</span></span> &amp; comp &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;"</span></span> &amp; AntiVirus.displayName &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;&lt;font color=""red""&gt;On Access scanning disabled!&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""green""&gt;Up to Date&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""green""&gt;Online&lt;/font&gt;&lt;/th&gt;&lt;/tr&gt;"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Else</span></span> objNewFile.WriteLine <span class="hljs-string"><span class="hljs-string">"&lt;tr&gt;&lt;th&gt;"</span></span> &amp; compid &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;"</span></span> &amp; comp &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;"</span></span> &amp; AntiVirus.displayName &amp; <span class="hljs-string"><span class="hljs-string">"&lt;/th&gt;&lt;th&gt;&lt;font color=""purple""&gt;Unknown&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""purple""&gt;Unknown&lt;/font&gt;&lt;/th&gt;&lt;th&gt;&lt;font color=""green""&gt;Online&lt;/font&gt;&lt;/th&gt;&lt;/tr&gt;"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span></code> </pre><br></div></div><br><h4>  Bonus </h4><br>  Well, as a bonus code in Python.  It creates a text file that can be used for uploading to Excel (in the form of a tab delimiter).  Unfortunately, I didn‚Äôt manage to unload the list of hosts through LDAP, and when using a large list, the script crashes, maybe someone will refine it for their needs: <br><br><div class="spoiler">  <b class="spoiler_title">Code itself</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> wmi <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> codecs <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'Comp_list.txt'</span></span>,<span class="hljs-string"><span class="hljs-string">'r'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> list: file = codecs.open(<span class="hljs-string"><span class="hljs-string">'text.txt'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>, <span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>) file.write(<span class="hljs-string"><span class="hljs-string">"Computer"</span></span> + <span class="hljs-string"><span class="hljs-string">" AV Name"</span></span> + <span class="hljs-string"><span class="hljs-string">" Host Status"</span></span> + <span class="hljs-string"><span class="hljs-string">" AV Status"</span></span> + <span class="hljs-string"><span class="hljs-string">" AV Bases\n"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> comp <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> list: response = os.system(<span class="hljs-string"><span class="hljs-string">"ping -n 1 "</span></span> + comp) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> response == <span class="hljs-number"><span class="hljs-number">0</span></span>: path = <span class="hljs-string"><span class="hljs-string">'//%s/root/SecurityCenter2'</span></span> % comp c = wmi.WMI(moniker=path) wql = <span class="hljs-string"><span class="hljs-string">"Select * from AntiVirusProduct"</span></span> wql = c.query(wql) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> wql == []: file.write(comp + <span class="hljs-string"><span class="hljs-string">" no AntiVirus found"</span></span> + <span class="hljs-string"><span class="hljs-string">" Online"</span></span> + <span class="hljs-string"><span class="hljs-string">" Unknown"</span></span> + <span class="hljs-string"><span class="hljs-string">" Unknown\n"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> AntiVirus <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> wql: ProductState_in_hex = str(hex(AntiVirus.ProductState)) check_install = ProductState_in_hex[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>] check_state = ProductState_in_hex[<span class="hljs-number"><span class="hljs-number">3</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span>] check_updates = ProductState_in_hex[<span class="hljs-number"><span class="hljs-number">5</span></span>:<span class="hljs-number"><span class="hljs-number">7</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> check_state == <span class="hljs-string"><span class="hljs-string">"10"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> check_updates == <span class="hljs-string"><span class="hljs-string">"00"</span></span>: file.write(comp + <span class="hljs-string"><span class="hljs-string">" "</span></span> + AntiVirus.displayName + <span class="hljs-string"><span class="hljs-string">" Online"</span></span> + <span class="hljs-string"><span class="hljs-string">" Active"</span></span> + <span class="hljs-string"><span class="hljs-string">" Up to Date\n"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> check_state == <span class="hljs-string"><span class="hljs-string">"10"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> check_updates == <span class="hljs-string"><span class="hljs-string">"10"</span></span>: file.write(comp + <span class="hljs-string"><span class="hljs-string">" "</span></span> + AntiVirus.displayName + <span class="hljs-string"><span class="hljs-string">" Online"</span></span> + <span class="hljs-string"><span class="hljs-string">" Active"</span></span> + <span class="hljs-string"><span class="hljs-string">" NOT Up to Date\n"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> check_state == <span class="hljs-string"><span class="hljs-string">"00"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> check_updates == <span class="hljs-string"><span class="hljs-string">"00"</span></span>: file.write(comp + <span class="hljs-string"><span class="hljs-string">" "</span></span> + AntiVirus.displayName + <span class="hljs-string"><span class="hljs-string">" Online"</span></span> + <span class="hljs-string"><span class="hljs-string">" On Access scanning disabled!"</span></span> + <span class="hljs-string"><span class="hljs-string">" Up to Date\n"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> check_state == <span class="hljs-string"><span class="hljs-string">"00"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> check_updates == <span class="hljs-string"><span class="hljs-string">"00"</span></span>: file.write(comp + <span class="hljs-string"><span class="hljs-string">" "</span></span> + AntiVirus.displayName + <span class="hljs-string"><span class="hljs-string">" Online"</span></span> + <span class="hljs-string"><span class="hljs-string">" On Access scanning disabled!"</span></span> + <span class="hljs-string"><span class="hljs-string">" NOT Up to Date\n"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: file.write(comp + <span class="hljs-string"><span class="hljs-string">" "</span></span> + AntiVirus.displayName + <span class="hljs-string"><span class="hljs-string">" Online"</span></span> + <span class="hljs-string"><span class="hljs-string">" Unknown state\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" "</span></span> + check_install) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: file.write(comp + <span class="hljs-string"><span class="hljs-string">" Unknown"</span></span> + <span class="hljs-string"><span class="hljs-string">" Offline"</span></span> + <span class="hljs-string"><span class="hljs-string">" Unknown"</span></span> + <span class="hljs-string"><span class="hljs-string">" Unknown\n"</span></span>) file.close()</code> </pre><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/279049/">https://habr.com/ru/post/279049/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../279037/index.html">Tasktop now officially introduced in Russia</a></li>
<li><a href="../279041/index.html">Updated online courses Mail.Ru Group and interviews with their creators</a></li>
<li><a href="../279043/index.html">How to make friends JMS Serializer and LiipImagineBundle</a></li>
<li><a href="../279045/index.html">I am writing a TreeView on Angular 2</a></li>
<li><a href="../279047/index.html">Badoo switched to PHP7 and saved $ 1M</a></li>
<li><a href="../279051/index.html">Sieve called Adobe Flash</a></li>
<li><a href="../279053/index.html">PUE celebrates its 10th anniversary. What a sad gift has the IT community prepared for him?</a></li>
<li><a href="../279055/index.html">West Game Development Forum: Create, Share, Improve</a></li>
<li><a href="../279059/index.html">Svezhak for iOS developers - Digest MBLTdev</a></li>
<li><a href="../279061/index.html">Icy Rocks Test for Android: it's time for a real test</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>