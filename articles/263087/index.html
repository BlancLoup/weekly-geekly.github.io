<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>IOS development testing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Content: 


- Development through testing - what is it? 
- Three laws TDD 
- Application examples 
- Advantages and disadvantages 
- Literature and li...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>IOS development testing</h1><div class="post__text post__text-html js-mediator-article"><h4>  <b>Content:</b> </h4><br><ul><li>  Development through testing - what is it? </li><li>  Three laws TDD </li><li>  Application examples </li><li>  Advantages and disadvantages </li><li>  Literature and links </li></ul><br><br><h4>  <b>Development through testing - what is it?</b> </h4><br><blockquote>  Development through testing (Test-driven development) is a software development technique that defines development through writing tests.  In essence, you need to perform three simple repeating steps: <br>  - Write a test for the new functionality that needs to be added; <br>  - Write the code that will pass the test; <br>  - To refactor new and old code. <br><br>  <a href="http://martinfowler.com/bliki/TestDrivenDevelopment.html">Martin fowler</a> </blockquote>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/ecd/be6/686/ecdbe66867f245008fb0db3d12d54222.png"><br><a name="habracut"></a><br><br><h4>  <b>Three laws TDD</b> </h4><br>  Now, many people know that TDD requires us to write tests first, before writing production code.  But this rule is only the tip of the iceberg.  I suggest you consider the following three laws: <br><ol><li>  Production code is not written before there is an idle test for it; </li><li>  No more unit test code is written than enough for its error.  And non-compilability is a mistake; </li><li>  No more production code is written than enough to pass the current non-working test. </li></ol><br>  These three laws keep the programmer in a cycle that lasts about a minute.  Tests and production code are written simultaneously, with tests just a few seconds ahead of the production code. <br>  If we work this way, we will write dozens of tests a day, hundreds every month, thousands every year.  If we work this way, then our tests will fully cover our production code. <br><br><h4>  <b>Application examples</b> </h4><br><h5>  Example 1. Sorting model objects </h5><br>  Consider the simplest example of writing a method for sorting model objects (events).  First, we write the interface of the new method (it takes a chaotic array of objects as input, and returns accordingly sorted): <br><br>  Test Method Interface: <br><br><pre><code class="objectivec hljs">- (<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *)sortEvents:(<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *)events</code> </pre> <br>  Next, write the test: <br>  We use the given, when, then notation to divide the test into three logical blocks: <br><ul><li>  creation of the environment, test preconditions; </li><li>  performing an action, calling a test method; </li><li>  testing the functionality of the tested. </li></ul><br>  Test: <br><br><pre> <code class="objectivec hljs"> - (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testSortEvents { <span class="hljs-comment"><span class="hljs-comment">// given id firstEvent = [self mockEventWithClass:kCinemaEventType name:@""]; id secondEvent = [self mockEventWithClass:kCinemaEventType name:@""]; id thirdEvent = [self mockEventWithClass:kPerfomanceEventType name:@""]; id fourthEvent = [self mockEventWithClass:kPerfomanceEventType name:@""]; NSArray *correctSortedArray = @[firstEvent, secondEvent, thirdEvent, fourthEvent]; NSArray *incorrectSortedArray = @[thirdEvent, secondEvent, fourthEvent, firstEvent]; // when NSArray *sortedWithTestingMethodArray = [self.service sortEvents:incorrectSortedArray]; // then XCTAssertEqualObjects(correctSortedArray, sortedWithTestingMethodArray, @"   "); }</span></span></code> </pre><br>  Only after we make sure that the test fails, we write the implementation of the method: <br><br>  Method implementation: <br><br><pre> <code class="objectivec hljs"> - (<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *)sortEvents:(<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *)events { <span class="hljs-comment"><span class="hljs-comment">//   ( ,  ,    ) NSMutableArray *cinemaEvents = [[NSMutableArray alloc] init]; NSMutableArray *otherEvents = [[NSMutableArray alloc] init]; for (Event *event in events) { if ([event.type isEqualToString:kCinemaEventType]) { [cinemaEvents addObject:event]; } else { [otherEvents addObject:event]; } } NSComparisonResult (^sortBlock)(Event *firstEvent, Event *secondEvent) = ^NSComparisonResult(Event *firstEvent, Event *secondEvent) { return [firstEvent.type compare:secondEvent.type options:NSNumericSearch]; }; [cinemaEvents sortUsingComparator:sortBlock]; [otherEvents sortUsingComparator:sortBlock]; return [cinemaEvents arrayByAddingObjectsFromArray:otherEvents]; }</span></span></code> </pre><br>  After writing the implementation of the method, we check that all tests, including our new one, are successfully executed.  If necessary, we refactor the written code.  It is important to understand that refactoring can be carried out only from a green state to a green one, i.e.  when all tests are successfully completed. <br><br>  A very important feature of TDD is the inverse of responsibility.  In the classical approach to software development, the programmer, after writing the code, conducts the testing himself, drives the code in the debugger, and checks the operation of all if-s.  In TDD, the tests confirm the performance of the code. <br><br><img src="https://habrastorage.org/files/5a1/59a/a2a/5a159aa2acd549f0a8debf2cccbf720b.png"><br><br><h5>  Example 2. Mapper </h5><br>  Consider the second example - the mapper server output in the model objects. <br><br>  Mapper must meet the following requirements: <br>  1) map objects (unexpectedly) <br>  2) handle the output curve (Null, wrong data type, wrong output structure) <br>  3) to ensure the consistency of the data (checking the required fields) <br><br>  We write the interface of the test method, it will be synchronous: <br><br>  Test Method Interface: <br><br><pre> <code class="objectivec hljs"> - (<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *)mapEvents:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)responseObject</code> </pre><br>  Next, we write the first test, verifying the positive scenario, i.e.  mapping objects with adequate issuance.  We do not write all the tests at once, do not try to cover all the requirements that the mapper must meet, and write a single test for the simplest implementation: <br><br>  Test: <br><br><pre> <code class="objectivec hljs"> - (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testMapEventsResponseSuccessful { <span class="hljs-comment"><span class="hljs-comment">// given NSDictionary *responseObject = @{@"event" : @[@{@"type" : @1, @"name" : @"test", @"description" : @"test"}]}; // when NSArray *events = [self.mapper mapEvents:responseObject]; // then Event *event = events[0]; [self checkObject:event forKeyExistence:@[@"type", @"name", @"description"]]; }</span></span></code> </pre><br>  To check the object for the presence of the required fields, use the helper method on KVC: <br><br><pre> <code class="objectivec hljs"> - (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)checkObject:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)object forKeyExistence:(<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *)keys { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> keys) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (![object valueForKey:key]) { <span class="hljs-built_in"><span class="hljs-built_in">XCTFail</span></span>(<span class="hljs-string"><span class="hljs-string">@"     - %@"</span></span>, key); } } }</code> </pre><br>  Next, we write the simplest implementation of the method that meets our test and verify that the test will be successfully passed.  In this case, the mapper uses a RESTKit mapping engine under the hood, but we consider our method as a black box, its implementation may change in the future.  But the requirements in most cases will remain that way. <br><br>  Method implementation: <br><br><pre> <code class="objectivec hljs"> - (<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *)mapEvents:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)responseObject { <span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *mappingsDictionary = @{kEventResponseKey : [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> eventResponseMapping]}; RKMappingResult *mappingResult = [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> mapResponseObject:responseObject withMappingsDictionary:mappingsDictionary]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mappingResult) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [mappingResult array]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> @[]; }</code> </pre><br>  Well, after writing the simplest implementation, we add another test for the mapper, which checks that the mapper takes into account the mandatory nature of some fields in the output, in our case it will be the id field, which is not in the test.  The test task is to make sure that there is no crash, and the method will return an empty array after the mapping. <br><br>  Test: <br><br><pre> <code class="objectivec hljs"> - (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testMapEventsResponseWithMissingMandatoryFields { <span class="hljs-comment"><span class="hljs-comment">// given NSDictionary *responseObject = @{kEventResponseKey : @[@{@"name" : @"test"}]}; // when NSArray *events = [self.mapper mapEvents:responseObject]; // then XCTAssertFalse([events count]); }</span></span></code> </pre><br>  Further we expand our method, we add in it check on obligatory some fields. <br><br>  Method implementation: <br><br><pre> <code class="objectivec hljs"> - (<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *)mapEvents:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)responseObject { <span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *mappingsDictionary = @{kEventResponseKey : [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> eventResponseMapping]}; RKMappingResult *mappingResult = [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> mapResponseObject:responseObject withMappingsDictionary:mappingsDictionary]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mappingResult) { <span class="hljs-comment"><span class="hljs-comment">//      NSArray *events = [self checkMandatoryFields:[mappingResult array]]; return events; } return @[]; }</span></span></code> </pre><br>  Based on the initial requirements, our mapper should behave correctly if there are null s in the output, we write a test that checks: <br><br><pre> <code class="objectivec hljs"> - (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testMapEventsResponseWithNulls { <span class="hljs-comment"><span class="hljs-comment">// given NSDictionary *responseObject = @{kEventResponseKey : @[@{@"type" : @1, @"name" : [NSNull null], @"description" : [NSNull null]}]}; // when NSArray *events = [self.mapper mapEvents:responseObject]; // then Event *event = events[0]; XCTAssertNotNil(event.type, @""); XCTAssertNil(event.name, @""); }</span></span></code> </pre><br>  After writing and running the test, we see that it runs immediately immediately.  Yes, this also happens, the existing code may already meet the new requirements.  In this situation, we, of course, do not remove this test, because  his task in the future, with a possible change in the implementation of the mapper, is to check the correctness of his work.  Next, add a test for the wrong data type, instead of a number - a string.  Mapping RestKit engine is able to cope with this, so the test will again turn green. <br><br><pre> <code class="objectivec hljs"> - (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testMapEventsResponseWithWrongType { <span class="hljs-comment"><span class="hljs-comment">// given NSDictionary *responseObject = @{kEventResponseKey : @[@{@"type" : @"123"}]}; // when NSArray *events = [self.mapper mapEvents:responseObject]; // then Event *event = events[0]; XCTAssertTrue([event.type isEqual:@123]); }</span></span></code> </pre><br><br><h5>  Example 3. Event Receive Service </h5><br>  Consider a service for obtaining model objects (events), the protocol will contain the following methods: <br><br><pre> <code class="objectivec hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventService</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSObject</span></span></span><span class="hljs-class"> - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instancetype</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initWithClient</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Client</span></span></span><span class="hljs-class">&gt;)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">client</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mapper</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mapper</span></span></span><span class="hljs-class">&gt;)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mapper</span></span></span><span class="hljs-class">; - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSArray</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">obtainEventsForType</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventType</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">eventType</span></span></span><span class="hljs-class">; - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">updateEventsForType</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventType</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">eventType</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">success</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SuccessBlock</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">success</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">failure</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ErrorBlock</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">failure</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  The service will work with CoreData, so for testing we will need to initialize the CoreData stack in memory.  We use the MagicalRecord library for working with CoreData, do not forget to call [MagicalRecord cleanUp] in teardown.  A network client and mapper are injected into our service, so we pass mocks to the initializer. <br><br><pre> <code class="objectivec hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventServiceTests</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XCTestCase</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">strong</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventService</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">eventService</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">strong</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Client</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clientMock</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">strong</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mapper</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mapperMock</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implementation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventServiceTests</span></span></span><span class="hljs-class"> - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">setUp</span></span></span><span class="hljs-class"> </span></span>{ [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> setUp]; [MagicalRecord setDefaultModelFromClass:[<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>]]; [MagicalRecord setupCoreDataStackWithInMemoryStore]; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.clientMock = OCMProtocolMock(<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@protocol</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Client</span></span></span><span class="hljs-class">)); </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mapperMock</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OCMProtocolMock</span></span></span><span class="hljs-class">(@</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">protocol</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mapper</span></span></span><span class="hljs-class">)); </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">eventService</span></span></span><span class="hljs-class"> = [[</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventService</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">alloc</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initWithClient</span></span></span><span class="hljs-class">:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clientMock</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mapper</span></span></span><span class="hljs-class">:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mapperMock</span></span></span><span class="hljs-class">]; } - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tearDown</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.eventService = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.clientMock = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mapperMock = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; [MagicalRecord cleanUp]; [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> tearDown]; }</code> </pre><br>  Add a test for the method of obtain - synchronous retrieval of objects from the database: <br><br><pre> <code class="objectivec hljs"> - (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testObtainEventsForType { <span class="hljs-comment"><span class="hljs-comment">// given Event *event = [Event MR_createEntity]; event.eventType = EventTypeCinema; // when NSArray *events = [self.eventService obtainEventsForType:EventTypeCinema]; // then XCTAssertEqualObjects(event, [events firstObject]); }</span></span></code> </pre><br>  Implementation of the method of obtaining and service initializer: <br><br><pre> <code class="objectivec hljs"> - (<span class="hljs-keyword"><span class="hljs-keyword">instancetype</span></span>)initWithClient:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>&lt;Client&gt;)client mapper:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>&lt;Mapper&gt;)mapper { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> = [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> init]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { _client = client; _mapper = mapper; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; } - (<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *)obtainEventsForType:(EventType)eventType { <span class="hljs-built_in"><span class="hljs-built_in">NSPredicate</span></span> *predicate = [<span class="hljs-built_in"><span class="hljs-built_in">NSPredicate</span></span> predicateWithFormat:<span class="hljs-string"><span class="hljs-string">@"eventType = %d"</span></span>, eventType]; <span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *events = [Event MR_findAllWithPredicate:predicate]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> events; }</code> </pre><br>  We add a test for the update method - it queries the server for events using the client, then mappits the model and saves it to the database.  We stabilize the client so that it always returns the success block.  We check that our service will contact the mapper and call the success block: <br><br><pre> <code class="objectivec hljs"> - (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testUpdateEventsForTypeSuccessful { <span class="hljs-comment"><span class="hljs-comment">// given XCTestExpectation *expectation = [self expectationWithDescription:@"Callback"]; OCMStub([self.clientMock requestEventsForType:EventTypeCinema success:OCMOCK_ANY failure:OCMOCK_ANY).andDo(^(NSInvocation *invocation) { SuccessBlock block; [invocation getArgument:&amp;block atIndex:3]; block(); }); // when [self.eventService updateEventsForType:EventTypeCinema success:^{ [expectation fulfill]; } failure:^(NSError *error) { }]; // then [self waitForExpectationsWithTimeout:DefaultTestExpectationTimeout handler:nil]; OCMVerify([self.mapperMock mapEvents:OCMOCK_ANY forType:EventTypeCinema mappingContext:OCMOCK_ANY]); }</span></span></code> </pre><br>  We write a test on the script of the update method error, we are stopping the client so that it returns an error: <br><br><pre> <code class="objectivec hljs"> - (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)testUpdateEventsForTypeFailure { <span class="hljs-comment"><span class="hljs-comment">// given XCTestExpectation *expectation = [self expectationWithDescription:@"Callback"]; NSError *clientError = [NSError errorWithDomain:@"" code:1 userInfo:nil]; OCMStub([self.clientMock requestEventsForType:EventTypeCinema success:OCMOCK_ANY failure:OCMOCK_ANY).andDo(^(NSInvocation *invocation) { ErrorBlock block; [invocation getArgument:&amp;block atIndex:4]; block(error); }); // when [self.eventService updateEventsForType:EventTypeCinema success:^{ } failure:^(NSError *error) { XCTAssertEqual(clientError, error) [expectation fulfill]; }]; // then [self waitForExpectationsWithTimeout:DefaultTestExpectationTimeout handler:nil]; }</span></span></code> </pre><br>  Implementation of the update method: <br><br><pre> <code class="objectivec hljs"> - (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)updateEventsForType:(EventType)eventType success:(SuccessBlock)success failure:(ErrorBlock)failure { @weakify(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>); [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.client requestEventsForType:eventType success:^(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span> responseObject) { @strongify(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">NSManagedObjectContext</span></span> *context = [<span class="hljs-built_in"><span class="hljs-built_in">NSManagedObjectContext</span></span> MR_rootSavingContext]; <span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *events = [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mapper mapEvents:responseObject forType:eventType mappingContext:context]; [context MR_saveToPersistentStoreAndWait]; success(); } failure:^(<span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> *error) { failure(error); }]; }</code> </pre><br><h4>  <b>Advantages and disadvantages</b> </h4><br><h5>  Benefits </h5><br><ul><li>  <b>Thinking through the interface before implementation</b> <br>  One of the main advantages, TDD makes the programmer, first of all, think over the work of the new functionality in detail, and then write it. <br><br></li><li>  <b>Less debugging</b> <br>  A high percentage of code coverage allows us to find a bug much faster without spending long hours in the debugger. <br><br></li><li>  <b>Confidence when changing</b> <br>  I think that many people have come across a situation where we changed the code in one place, but something broke in a completely different unexpected place.  Of course, it is important to understand that this is a sign of bad code design.  The test coverage gives you confidence when changing or refactoring the existing code, because when an emergency situation occurs, the tests catch it immediately. <br><br></li><li>  <b>Less mistakes</b> <br>  It is achieved at the expense of a combination of other advantages of TDD, first of all, due to thinking through the implementation in advance and covering the tests. <br><br></li><li>  <b>Test documentation</b> <br>  Tests are part of the project documentation, the existing code base.  Often, when a new developer arrives at a project, it is easier to deal with the code on a specific example, and the test is the simplest example of using the code.  As a result, with full coverage of the code with tests, we get essentially extensive practical documentation of the code. <br><br></li><li>  <b>Modularity</b> <br>  The need to test absolutely all branches of code execution, all if-s forces us to write modularly, because we simply cannot test the almighty method that does 10 things at once in several threads.  We strive to ensure that each class, each method does its own small part of the overall work.  (Following the principle of single responsibility). <br><br></li><li>  <b>Full tests</b> <br>  I believe that many have written tests, but not all of them wrote on TDD and the difference is actually noticeable.  In the case of writing tests after implementation, we can very likely not take into account all the scenarios for executing the method, and eventually get defective tests.  We believe that our method works, because the test works, but in fact, all ifs are not covered in tests, and this is not possible with TDD, because if cannot appear in the code without a test. </li></ul><br><br><h5>  disadvantages </h5><br><ul><li>  <b>Application complexity (data security, UI, database)</b> <br>  Of course, we often come across the fact that some things are difficult or impossible to test.  Sometimes it is difficult to imagine how some module will work. <br><br></li><li>  <b>More time</b> <br>  When you start writing on TDD - development time may increase up to several times.  But, literally in a few months, it will be difficult to write without him.  In the future, if you have experience writing tests and using TDD, development time will decrease.  This will especially be felt at a distance, on long-lived projects. <br><br></li><li>  <b>False sense of reliability, test error</b> <br>  It is possible that we have misunderstood the original requirements.  As a result, we get an error in the code, in the test and in the understanding.  And most importantly, we are sure that everything works, because the tests are lit in green.  This is a rather dangerous situation and it can result in a large temporary loss. <br><br></li><li>  <b>Test support</b> <br>  The code base with the full coverage of the code with the tests almost doubles.  And it is important to understand that all this code needs to be maintained, refactored and documented. </li></ul><br><br><img src="https://habrastorage.org/files/82b/e19/eed/82be19eed59543119f1b6c1b13dfe929.png"><br><br><blockquote>  Development through testing encourages simple design and inspires confidence. <br>  TDD encourages simple designs and inspires confidence. <br><br>  Kent Beck <br></blockquote><br><h4>  <b>Literature and links</b> </h4><br>  <a href="https://books.google.co.uk/books/about/Test_driven_Development.html%3Fid%3DgFgnde_vwMAC">Kent Beck - Test-Driven Development: By example</a> <br>  <a href="https://books.google.co.uk/books%3Fid%3DdwSfGQAACAAJ%26dq%3DRobert%2BC.%2BMartin%2B%25E2%2580%2593%2BClean%2Bcode%26hl%3Den%26sa%3DX%26ved%3D0CDUQ6AEwAWoVChMIlNictofnxgIVpO9yCh3OXQ7M">Robert C. Martin - Clean code</a> <br>  <a href="http://www.objc.io/issue-15/">www.objc.io/issue-15</a> <br>  <a href="https://en.wikipedia.org/wiki/Test-driven_development">en.wikipedia.org/wiki/Test-driven_development</a> <br>  <a href="http://qualitycoding.org/objective-c-tdd/">qualitycoding.org/objective-c-tdd</a> <br>  <a href="http://agiledata.org/essays/tdd.html">agiledata.org/essays/tdd.html#WhatIsTDD</a> <br>  <a href="http://www.basilv.com/psd/blog/2009/test-driven-development-benefits-limitations-and-techniques">www.basilv.com/psd/blog/2009/test-driven-development-benefits-limitations-and-techniques</a> <br>  <a href="http://martinfowler.com/articles/is-tdd-dead/">martinfowler.com/articles/is-tdd-dead</a> <br>  <a href="http://habrahabr.ru/post/206828/">habrahabr.ru/post/206828</a> <br>  <a href="http://habrahabr.ru/post/216923/">habrahabr.ru/post/216923</a> <br>  <a href="http://iosunittesting.com/">iosunittesting.com</a> </div><p>Source: <a href="https://habr.com/ru/post/263087/">https://habr.com/ru/post/263087/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263077/index.html">Under the hood of ATM software</a></li>
<li><a href="../263079/index.html">6 things I would like to know before developing my first Android application</a></li>
<li><a href="../263081/index.html">We clean the home Internet from very annoying ads (Ad's blocker for OpenWRT)</a></li>
<li><a href="../263083/index.html">Build docker containers with docker containers</a></li>
<li><a href="../263085/index.html">Site security audit through the eyes of the customer</a></li>
<li><a href="../263089/index.html">Automatic search for routers with standard passwords</a></li>
<li><a href="../263091/index.html">Pacemaker-based HA-Cluster for LXC and Docker container virtualization</a></li>
<li><a href="../263093/index.html">Crackme Chiwaka1 study</a></li>
<li><a href="../263097/index.html">Event-oriented Python backtesting step by step. Part 1</a></li>
<li><a href="../263099/index.html">Skype turned to people?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>