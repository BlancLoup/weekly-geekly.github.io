<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>When in the accounting replaced the printer. "We must all reconnect"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If such an application in your service desk system causes a twitching eye and a drop in tone, then you probably have not yet set up a convenient centr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>When in the accounting replaced the printer. "We must all reconnect"</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/z3/qs/ad/z3qsadwuqxsnrfftkxqd1hph8gy.jpeg"></p><br><p>  If such an application in your service desk system causes a twitching eye and a drop in tone, then you probably have not yet set up a convenient centralized management of printers.  It is time to correct this discrepancy. </p><br><p>  The article is more likely for those who do not have this spherical corporate in a vacuum, with virtual printers, attaching a print pass to the HP M8xx, or even Ricoh Pro 8xxx.  As usual, we stock up on scripts, GPO and once again scripts. <a name="habracut"></a></p><br><h1 id="sobiraem-printery-v-odnu-tochku-podklyucheniya">  We collect printers in one point of connection </h1><br><p>  As a first measure to make life easier, I recommend having a print server where you can deploy all the printers in your organization.  Ideally, this is a separate virtual machine, where all printers are networked and displayed in a separate VLAN with access only from the print server.  If it is impossible to use a network printer, then as a last resort it is possible to turn a computer with a USB \ LPT printer into a print server.  For example, using the <a href="https://sourceforge.net/projects/rawprintserver/">rawprintserver</a> utility. </p><br><p>  In addition to the ease of maintenance, the configuration with a single print server will allow you to easily implement ‚Äúknee-shaped‚Äù print reports by disassembling the Microsoft-Windows-PrintService / Operational magazine.  I hope that with the solution of this problem will help our material ‚Äú <a href="https://habrahabr.ru/company/pc-administrator/">Verify logs as we want - analysis of logs in Windows systems‚Äù</a> , and as an example I will offer the following PowerShell script: </p><br><pre><code class="hljs perl">$events = Get-WinEvent -FilterHashtable @{LogName = <span class="hljs-string"><span class="hljs-string">"Microsoft-Windows-PrintService/Operational"</span></span>; ID = <span class="hljs-number"><span class="hljs-number">307</span></span>} | <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>{ New-Object PSobject -Property @{ Time_Created = $_.TimeCreated Document_Number = $_.Properties[<span class="hljs-number"><span class="hljs-number">0</span></span>].value Document_Name = $_.Properties[<span class="hljs-number"><span class="hljs-number">1</span></span>].value UserID = $_.Properties[<span class="hljs-number"><span class="hljs-number">2</span></span>].value Printer = $_.Properties[<span class="hljs-number"><span class="hljs-number">4</span></span>].value PagesCount = $_.Properties[<span class="hljs-number"><span class="hljs-number">7</span></span>].value } } $events | <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> userid, printer ,pagescount</code> </pre> <br><p><img src="https://habrastorage.org/webt/fb/vr/2x/fbvr2xmy_h3cjhv4gofjneatir8.jpeg"><br>  <em>The result of the script.</em> </p><br><p>  In addition, it is possible to do some work on optimizing the speed of a single print server, merging printers into a cluster.  In general, have fun whatever you like - at least monitor the printers via SNMP and notify employees in advance about the ending cartridges. </p><br><p>  Let's move on to connecting printers to users: the options are intricate and not very. </p><br><h1 id="podklyuchaem-printery-pri-vhode">  We connect printers at the entrance </h1><br><p>  Using logon scripts is an old and proven tool that works always and everywhere.  When a user logs in, a script is triggered that connects the desired printer and sets it by default - everything is simple and stable.  On cmd, the script will be: </p><br><pre> <code class="bash hljs">rundll32 printui.dll,PrintUIEntry /<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> /n\\servername\printername /y</code> </pre> <br><p>  You can read more about the cmd command for working with printers in the <a href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/rundll32-printui">Microsoft documentation</a> . </p><br><p>  Lovers of vbs will have to use objects, and the printer connection will look like this: </p><br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">On</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Resume</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> WshNetwork = <span class="hljs-built_in"><span class="hljs-built_in">CreateObject</span></span>(<span class="hljs-string"><span class="hljs-string">"WScript.Network"</span></span>) WshNetwork.AddWindowsPrinterConnection <span class="hljs-string"><span class="hljs-string">"\\servername\printername"</span></span> WshNetwork.SetDefaultPrinter <span class="hljs-string"><span class="hljs-string">"\\servername\printername"</span></span></code> </pre> <br><p>  Similarly, the problem is solved on PowerShell: </p><br><pre> <code class="hljs php">$net = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>-object -com wscript.network $net.AddWindowsPrinterConnection(<span class="hljs-string"><span class="hljs-string">"\\servername\printername"</span></span>) $net.SetDefaultPrinter(<span class="hljs-string"><span class="hljs-string">"\\servername\printername"</span></span>)</code> </pre> <br><p>  You can <a href="https://technet.microsoft.com/en-us/library/s6wt333f(v%3Dvs.84).aspx">read</a> about the features of the <strong>Wscript.Network</strong> com-interface in TechNet's <a href="https://technet.microsoft.com/en-us/library/s6wt333f(v%3Dvs.84).aspx">WshNetwork Object</a> , and about managing printers with PowerShell in the documentation of PowerShell <a href="https://docs.microsoft.com/en-us/powershell/scripting/getting-started/cookbooks/working-with-printers%3Fview%3Dpowershell-6">Working with Printers</a> . </p><br><p>  If everything is straightforward with a printer connection, as long as the driver is on the computer, then selectively connecting printers will require architectural keenness.  Let me give you a couple of options that met in the vast admin activities. </p><br><p>  Each printer has its own security group.  Only she is allowed to print on the printer in its properties.  Each security group has its own logon script and its own group policy with a security filter. </p><br><p><img src="https://habrastorage.org/webt/7a/ck/pl/7ackplyfzy8eyakfnxyucwzi0_k.jpeg"><br>  <em>Need more group policies.</em> </p><br><p>  The option is not bad, but when you add a new printer, you have to create a new security group, a new group policy, and a new script to connect.  Of course, this can be automated not without the help of our material <a href="https://habrahabr.ru/company/pc-administrator/blog/351152/">‚ÄúImmersion in templates and taming Windows GPO</a> ‚Äù, but the solution still looks far from elegant. </p><br><p>  Another option is to create a single script that checks any attribute of a user or computer and, depending on it, connects the desired printer.  The attribute can be a location, a description, or even membership in a security group. </p><br><p>  The correspondence between the attribute and the name of the printer is either hard-coded in the body of the script, or is written in an external data source, such as a text file or even a SQL table.  This option is slightly easier to maintain - in which case you need to edit only one script or an external data source. </p><br><div class="spoiler">  <b class="spoiler_title">Under the spoiler I will give a version of a similar script on vbs.</b> <div class="spoiler_text"><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> WshShell = WScript.<span class="hljs-built_in"><span class="hljs-built_in">CreateObject</span></span>(<span class="hljs-string"><span class="hljs-string">"WScript.Shell"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> objSysInfo = <span class="hljs-built_in"><span class="hljs-built_in">CreateObject</span></span>(<span class="hljs-string"><span class="hljs-string">"ADSystemInfo"</span></span>) strComputer = <span class="hljs-string"><span class="hljs-string">"."</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> oReg=<span class="hljs-built_in"><span class="hljs-built_in">GetObject</span></span>(<span class="hljs-string"><span class="hljs-string">"winmgmts:{impersonationLevel=impersonate}!\\"</span></span> &amp; strComputer &amp; <span class="hljs-string"><span class="hljs-string">"\root\default:StdRegProv"</span></span>) strUserDN = objSysInfo.userName <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> UserObj = <span class="hljs-built_in"><span class="hljs-built_in">GetObject</span></span>(<span class="hljs-string"><span class="hljs-string">"LDAP://"</span></span> &amp; strUserDN) <span class="hljs-comment"><span class="hljs-comment">'      ' iGroup = 0 For Each GroupObj In UserObj.Groups iGroup = iGroup + 1 Redim Preserve strArrayUserGroups(iGroup) strArrayUserGroups(iGroup) = Replace(GroupObj.Name, "CN=", "") Next '    ' For i = 1 To iGroup AddPrintersByGroup strArrayUserGroups(i) Next Function AddPrintersByGroup (strGroup) Set WshNetwork = CreateObject("WScript.Network") Select Case strGroup Case "Add Printer HP2055BUH2" WshNetwork.AddWindowsPrinterConnection "\\servername\HP2055BUH2" WshNetwork.SetDefaultPrinter "\\servername\HP2055BUH2" Case "Add Printer HP2055HR" WshNetwork.AddWindowsPrinterConnection "\\servername\HP2055HR" WshNetwork.SetDefaultPrinter "\\servername\HP2055HR" ... End Select End Function</span></span></code> </pre> </div></div><br><h1 id="luchshe-politik-dlya-podklyucheniya-printerov-mogut-byt-tolko-drugie-politiki">  Better policies for connecting printers can only be other policies </h1><br><p>  With the advent of Group Policy Preferences or group policy preferences, it has become possible to do without scripts at all.  Indeed, the connection to printers can be configured in the section ‚ÄúUser Configuration - Settings - Control Panel - Printers‚Äù. </p><br><p><img src="https://habrastorage.org/webt/b6/pf/6y/b6pf6yqr3tvhrvzuccxeqt9sh50.jpeg"><br>  <em>Connect to a new or old printer.</em> </p><br><p>  It is not necessary to set policies on the number of printers in the domain using the Targeting tool on the General Settings tab.  In fact, this tool resembles wmi-filters in group policy, only it has previously created a ready-made set of options besides filters. </p><br><p><img src="https://habrastorage.org/webt/si/ys/gx/siysgxetbz7qzg_worwnqc7ct1q.jpeg"><br>  <em>Possible targeting options.</em> </p><br><p>  A good option would be to configure the filter by security group.  Then it will be enough to create the required number of security groups, configure permissions to printers on the print server, and bring these printers into the group policy. </p><br><p>  When automating add-changes, you can use the fact that the group policy preferences settings themselves are located in the Group Policy folder in the Preference subfolder.  In the case of printers, this will be the xml file Printers.xml in the subfolder Printers. </p><br><p><img src="https://habrastorage.org/webt/oc/d0/av/ocd0avu1wykafmq1thbb-khqgpo.png"><br>  <em>The physical location of the printer settings.</em> </p><br><p>  If you open it, you can see that the xml structure is quite simple: </p><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Printers</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">clsid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{1F577D12-3D1B-471e-A1B7-060317597B9C}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SharedPrinter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">clsid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{9A5E9697-9095-436d-A0EE-4D128FDFBCE5}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HP2055BUH2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">status</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HP2055BUH2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">image</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bypassErrors</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">changed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2018-03-21 13:47:25"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{9E6F08F9-1C6B-49EB-A985-25A722ADD9C1}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Properties</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"U"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">comment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"\\servername\HP2055BUH2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">location</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">default</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">skipLocal</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">deleteAll</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">persistent</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">deleteMaps</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">port</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Filters</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FilterGroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Domainname\Printer_Add_2055_Buh"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">localGroup</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">primaryGroup</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">userContext</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">sid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">not</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bool</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AND"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Filters</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SharedPrinter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Printers</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  And if you want, you can carefully add \ change parameters manually or by scripts.  Of course, reinventing the wheel and crawling with unwashed hands in xml is fun and entertaining, but it is not necessary at all - in the TechNet script gallery there is already a ready-made <a href="https://gallery.technet.microsoft.com/Script-to-Add-Printers-in-ce8c13cf">Add-Printer-IN-GPO</a> script that will add printers to group policy targeting security groups. </p><br><p>  At the end of the article I will tell you about one interesting way that I once had to implement. </p><br><h1 id="v-kopilku-strannyh-sposobov-podklyucheniya--naznachennye-zadaniya">  In the piggy bank of strange ways to connect - scheduled tasks </h1><br><p>  The customer received a task - to create a tool to automatically connect printers to the user.  At the same time, the reaction time should be minimal and no relogs are unacceptable, so the classic options like logon scripts and group policies immediately shallow. </p><br><p>  The nuance was that users worked on terminal servers in the farm and without a farm.  Needle on fiction is tricky, so I had to remember possible options for running commands on a remote computer under different sessions - some of the options are described in our article <a href="https://habrahabr.ru/company/pc-administrator/blog/342428/">‚Äú1000 ++ way to run commands on a remote computer</a> ‚Äù.  The best was the option with assigned tasks. </p><br><p>  Since I love batch files and use them when I can do without using PowerShell, I used only cmd to solve the problem. </p><br><p>  The main problem was the need to run commands to connect the printer directly to the user's session, and not knowing his password, the usual methods are not very effective.  Just for this, I used the opportunity to set the username when creating a scheduled task with this command: </p><br><pre> <code class="bash hljs">schtasks /create /S computername /SC ONCE /ST 00:00 /RU domain\username /TN taskname /tr <span class="hljs-string"><span class="hljs-string">"rundll32 printui.dll,PrintUIEntry /in /nPrintername"</span></span></code> </pre> <br><p>  The second problem was to find the computer on which the user is working at the time of the call.  I used the <strong>qwinsta</strong> utility and a list of possible computers in a text file.  Of course, there are other ways - for example, taking the name of a computer from an Active Directory attribute or from a text file.  But this procedure will require additional logon scripts.  As an example of implementation, I can advise <a href="https://community.spiceworks.com/how_to/34096-show-user-s-logged-on-computer-name-in-active-directory">how to:</a> </p><br><p>  As a result, a script appeared that takes the name of the user and the connected printer as a parameter.  Next to the script you need to put a text file with a list of servers on which the user can work. </p><br><div class="spoiler">  <b class="spoiler_title">Full listing script under the spoiler.</b> <div class="spoiler_text"><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off rem     ... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> /F %%i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (servers.txt) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ( rem    qwinsta /SERVER %%i | find <span class="hljs-string"><span class="hljs-string">"%1"</span></span> &amp;&amp; call :subroutine %%i %1 %2 ) GOTO :EOF :subroutine rem C   schtasks /create /S %1 /SC ONCE /ST 00:00 /RU domain\%2 /TN printer_%2 /tr <span class="hljs-string"><span class="hljs-string">"rundll32 printui.dll,PrintUIEntry /in /n%3"</span></span> rem   schtasks /run /S %1 /TN printer_%2 rem   schtasks /delete /S %1 /TN printer_%2 /F GOTO :EOF</code> </pre> </div></div><br><p>  Of course, there are companies where users themselves are able to connect to the desired printer, select it by default and not pull the IT service for this.  Unfortunately, not all are so advanced. </p><br><p>  I suggest in the comments to share how things are with network printers and their management in your organizations. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/352102/">https://habr.com/ru/post/352102/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../352090/index.html">Alan Kay: How I would teach Computer Science 101</a></li>
<li><a href="../352092/index.html">Sample code organization for a complex Angular project</a></li>
<li><a href="../352096/index.html">Windows clean WinAPI. Or just about the difficult</a></li>
<li><a href="../352098/index.html">What is the difference between product and product? Opinions of managers of Yandex services</a></li>
<li><a href="../352100/index.html">Wesbos tells how to use the new React Context API (subtitles)</a></li>
<li><a href="../352104/index.html">Aether Management Console: How to Deploy Corporate Security</a></li>
<li><a href="../352106/index.html">Some nuances of moving to Cyprus</a></li>
<li><a href="../352108/index.html">The book "Mental Hospital in the hands of patients. Alan Cooper on Interfaces ¬ª</a></li>
<li><a href="../352110/index.html">Fintech-digest: Russians will be able to take a credit by voice timbre, PayPal goes to China, arrest of Cobalt leader</a></li>
<li><a href="../352112/index.html">How to create a great encyclopedia for the employee</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>