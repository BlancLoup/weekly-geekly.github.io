<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creeping muck, or about problems with a single database of a single application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today I want to voice one problem that a developer encounters as soon as work with a database is in his field of vision. The saddest thing is that I d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creeping muck, or about problems with a single database of a single application</h1><div class="post__text post__text-html js-mediator-article"><img src="http://www.englishrussia.com/forum/files/blank_facepalm_224.gif" align="left">  Today I want to voice one problem that a developer encounters as soon as work with a database is in his field of vision.  The saddest thing is that I do not know how to solve it correctly, and what to do.  Rather, I know what, but it does not help me and will not help.  I think that you too. <br>  Below there will be a long introductory, according to the results of which, I have no doubt, you can tell a lot about interesting things about me that will be enough for several 7-B forms and referrals for life-long compulsory treatment, but you can finish it. <br><a name="habracut"></a><br><h4>  This is an Enterprise, Baby </h4><br>  At the entrance we have software, a product with a complex business logic and a well-developed data scheme: there is a lot of data (tens of gigabytes), there is a certain order in the relations between them.  A certain number of customers are <s>completely perversely</s> using business logic and data logic, and in fact expose various requirements to it. <br><br>  ‚ÄúDifferent requirements‚Äù also means that all of them (customers) need different data.  In their right mind, no one will use different databases for different clients, because this is <s>brain damage</s> , so all the data somehow lies in the same database.  In addition to differing data, a different UI is also needed - determined by the client, by roles, a dozen other parameters of logic and the moon phase. <br><br><img src="http://www.talkingtext.com/wordpress_en/wp-content/uploads/2008/04/googleproduct.jpg" align="right">  The first such offspring is fucking fields in the database by themselves.  Have you ever seen a typical ‚Äúdata entry window for starting a business process‚Äù?  Yes, yes it is right, be it amiss.  10 bookmarks, 100 fields on each.  Each of them somehow (ahtung, magic!) Gets into the database, each of them was added during the long years of the program's operation - some by themselves, some - for analytics.  They are added and added, until no one remembers why it was needed: a new field was needed - we added it everywhere, added it to the report, changed the analytics.  It is good if the analytics counts as one sum / count / group_by. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      B first of all, it turns out that the job of adding a new field to the table consists mainly of <br>  - ‚Äúadd to database, add to table, add to objects, add to UI‚Äù. <br>  - Attack another porridge in analytics / app workflow. <br><br>  Taking into account the fact that, for example, sql is not subject to compilation, you need to be very careful to update the relevant in all places where necessary.  In practice, ‚Äúbe careful‚Äù means that after the first compilation and deployment with a probability of 99%, the system will not work.  Most likely, after the second ones too, there will be drops, errors, etc.  It is possible to control it to some extent with the help of autotests;  but it is stifling morally. <br><br>  And finally, the second offense consists in this: you need to add two fields - 2 times more work.  5 fields - ... well, you understand. <br><br>  Gradually, this crap spreads throughout the application;  after a year or two, the application becomes subject to only one task - to figure out which fields and where to load / save / update.  Something like this: <a href="http://govnokod.ru/1071">govnokod.ru/1071</a> <br><br><h4>  How could this happen to me?  How to live now? </h4><br>  Making it inheritance (Active Record and not only) - will not work, more often than not it is simply impossible to build a hierarchy without getting crazy about finding the right relationships.  If we score on the correctness of the object model, we will get crutches, expressed in the fact that in each place it is necessary to check whether we are working with the type of object - and work differently.  We come to the option that after ‚Äúadd to objects‚Äù we will also have to deal with the hierarchy.  In addition, my personal subconscious mind against inheritance in this place. <br><br>  If you try to spread the model nicely, for example, in the Entity Attribute Value, then you get a complete ass with queries: <br>  - writing them manually is even worse than simply understanding what is happening. <br>  - performance crashes into the pipe: the DBMS server is enthusiastically busy with join, and the rest is ugly idle. <br><br>  Another tested option is to forget about objects, and use metadata.  This means that inside the target database another database is created with metadata, in which information about the structure and composition of tables and other facilities is duplicated.  For them, a special editor is started, a layer of mega-abstraction is formed (on dynamic storage and view).  With each server response containing data, metadata is also sent to the client from this data. <br><br>  In addition to redundancy in data and schema, here we are waiting for a hell of updating the database, as well as the fact that the metadata itself also needs to work in a relational manner, which is extremely harmful for the developer's sensitive psyche: to understand recursion, you need to understand recursion.  Attempts to squeeze some more or less complex UI behavior there are doomed to a heroic failure and a combinatorial explosion of the amount of metadata that need to be understood / remembered (Do you know how we made a notification in the system about changing fields? fields and compared with cached values, setting flags. As soon as an exception was thrown - and the previous developer even considered NullReference as a normal business case - the flow flew into the crust, and the alerts stopped coming. Do not rush to throw  I galoshes, I removed it as soon as he heard. But the sediment remained, yes).  And the ‚Äúupdate this - update those‚Äù cycles have not gone anywhere.  Fail. <br>  And there is also the desynchronization of metadata and logic code.  And there is also a DBA at the customer, for whom the update becomes <s>oh-oh-oh with sausage</s> playing Russian roulette. <br><br><img src="http://i073.radikal.ru/0908/fe/ed2363ae5b00.png" align="left">  And one more tested version (advanced) - self-written ORM + own object system.  The hell with the fact that it is poorly adapted to work with relational data, we are still awaited by an ambush with updating the database schema.  Yes, and the code becomes nasty - you need to sit and implement objects on top of objects again.  From the writing of this very little joy is added.  Well, if it is - just a directory.  And if this is a lookup table or a segment of an ontological classifier?  And the most interesting thing is how to deal with reports? <br>  In search of truth, we have reached the point that when the application server starts by describing metadata, the code generator issues families of objects, through Aggregation Root which work with them.  And when you connect, the library is passed to the connection, which contains the generated tools.  Tin as it is, in short. <br>  I generally keep quiet about the business logic of validation, process, etc., there is something terrible with scripts in ‚ÄúCustomSharp‚Äù (this is the language for <s>confusing the</s> description of business logic). <br><br><h4>  Misadventure </h4><br>  I think that it is no longer a secret to you that in practice I tried and accompanied all the described options, and I didn‚Äôt like any of them;  however, with the last one, the zaparok was a little less, but still swallowed and continue to scoop the crap with unclean buckets. <br><br>  So what to do?  There is a feeling that I am sitting in a boat that is full of holes and that floats through the swamp, and in my hands are two tin walking circles that I can row to the shore, and I can scoop up all the water.  Both should be done very quickly, and deal with priorities. <br><br>  PS If we wrote in some magic languages, then each use case / script / process could be pulled out into a separate module that could monitor the data, load on demand, contain editors and attributes for mapping, and be combined when loading with the rest of these modules, both in the code and through the data, communicate with the database and transparently make structure updates.  In this magical language, you can safely change the configuration of the system and sell it to a new customer - the core is the same, filling data / logic is different. <br><br>  Does anyone know about such a magic language or system?  SAP / MDM does not offer, this is a <s>brand of epic</s> pure <s>power</s> brand for the sake of a brand, almost unwearable.  And do not pull me 1C or SAP in the foreseeable future :) <br><br>  How, how are you fighting this damn trash with your hands? <br><br></div><p>Source: <a href="https://habr.com/ru/post/68337/">https://habr.com/ru/post/68337/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../68326/index.html">In the near future, two new navigation applications will become available for Android using DWA - ‚ÄúAugmented Reality for Driving‚Äù</a></li>
<li><a href="../68330/index.html">OpenGL ES 2.0 to iPhone 3G S Basics</a></li>
<li><a href="../68332/index.html">About ¬µTP in new versions of ¬µTorrent: what is it, how, why?</a></li>
<li><a href="../68334/index.html">Architectural tools in Visual Studio 2010</a></li>
<li><a href="../68335/index.html">ngxv8</a></li>
<li><a href="../68338/index.html">Airsoft: A little bit about everything</a></li>
<li><a href="../68341/index.html">Git on fingers (for transferring from SVN)</a></li>
<li><a href="../68345/index.html">Regular expression quantifiers</a></li>
<li><a href="../68347/index.html">Time to envy Australian students (Digital Education Revolution - a laptop for learning)</a></li>
<li><a href="../68348/index.html">Full review of Snow Leopard. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>