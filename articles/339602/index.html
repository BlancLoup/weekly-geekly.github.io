<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Service control panel. Part 1: Introduction</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 


 My name is Maxim and I am the developer of the front end of the Miran service control panel. In this series of articles, I will tell ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Service control panel. Part 1: Introduction</h1><div class="post__text post__text-html js-mediator-article"><h3>  Introduction </h3><br><p>  My name is Maxim and I am the developer of the front end of the Miran service control panel.  In this series of articles, I will tell you how the system is evolving and what's new to expect in the near future.  Welcome under cat. </p><a name="habracut"></a><br><h3>  The era of dinosaurs. </h3><br><p><img src="https://habrastorage.org/webt/59/da/49/59da493ceb9ea177815263.jpeg" alt="image"></p><br><p>  The old panel, or panel_v1, is based on the Django side of the backend + TastyPie as an API + AngularJS in the frontend.  The choice was based on good documentation and the ability to do a small file to bring the framework to the state we need.  A bunch of Django and Tastypie provided all the necessary tools for our requests, and AngularJS was quite convenient for displaying data. </p><br><p>  As you know, the requirements are constantly expanding and when they began to exceed the capabilities of the panel, it was decided to completely change the architecture and evolution of the technology stack.  The ‚Äúinventory‚Äù of the code was carried out and after that the work on it was frozen and limited to only minimal changes.  And we got the opportunity to choose what will be the new control panel. </p><br><h3 id="muki-vybora">  Flour choice </h3><br><p><img src="https://habrastorage.org/webt/59/da/4a/59da4a07cd0eb290584786.jpeg" alt="image"></p><br><p>  The main issue was the choice of architecture.  Taking into account the existing experience of panel_v1 and the possibility of tastypie, we decided to develop the idea and break the entire panel into parts, link it through api and manage all parts individually.  Therefore, the choice was microservices.  After all, it is extremely convenient to have small modules that perform strictly their task and when changing their work?  changes in their work is enough to update the interfaces for the rest of microservices. </p><br><p>  The decision is made, super.  For the backend there will be enough lightweight but powerful Flask, the frontend will move to the new Angular2.  It seems everything looks good, but how can they communicate? <br>  It requires an API that is flexible enough and suitable for the backend and frontend with minimal changes.  Moreover, it will need to be opened to customers, which means you will not be able to do without detailed documentation with examples of use.  This is where we became thoughtful. </p><br><h3 id="ozarenie">  Insight </h3><br><p><img src="https://habrastorage.org/webt/59/da/49/59da493d4bcb9790543784.png" alt="image"></p><br><p>  The solution to our problem was the OpenAPI specification in the implementation of Swagger.  Here is a quick list of Swagger features: </p><br><ul><li>  Single API description file for backend and frontend. </li><li>  Work with yaml and json formats. </li><li>  A python connexion package that runs with an API specification file and builds routes based on it. </li><li>  With the help of swagger ui, all documentation is stored in the description of the methods of the API itself, so there is no need for any additional tools.  There is a question: What does the method do and what data does it require to enter?  - Welcome to ui!  You can also perform a query and look at the result.  As they say, it's better to see once than to hear 100 times. </li><li>  Strict control of incoming data.  For example, let's take the standard situation - when the user fills out some form, then a number of checks occur: <br>  - at first simple validation on the frontend side; <br>  - further connexion in accordance with the specification file checks incoming data from the frontend; <br>  - and only then the backend can additionally perform any specific check. <br>  It is this multi-step control over the entered data that insures the user against an error. </li><li>  Specifically for the frontend: the swagger-codegen utility, which takes the specification file as input and provides all the necessary services for Angular2.  And both in the form of Javascript and Typescript (in fact, the list of available languages ‚Äã‚Äãis more extensive and can be found <a href="https://github.com/swagger-api/swagger-codegen/tree/master/modules/swagger-codegen/src/main/java/io/swagger/codegen/languages">here</a> ). </li><li>  Non dull UI wallpapers: <br><img src="https://habrastorage.org/webt/59/da/49/59da493c5fa20994283256.png" alt="image"><br>  Considering all these points, we got a single source for all changes. <br>  Need to add functionality?  Fine!  First, the description is entered in the specification file, then the logic is described in the backend, after which api is rebuilt with new methods for the frontend and it remains to use these methods. <br>  Is there a need to change the returned data from a method?  Easily!  We fixed the changes to the specification file, changed the backend according to it, reassembled the api for the frontend and minimally fixed the affected methods. <br>  As a result, all routing, all requests and responses to them are described in one file.  And the backend and the frontend work in concert. </li></ul><br><h3 id="vsyo-ne-tak-odnoznachno">  It's not so simple </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/da/49/59da493c5760d301567968.jpeg"></div><br><p>  But everything does not happen smoothly.  Below is a short list of pitfalls that we encountered. </p><br><h4 id="fayl-specifikacii">  Specification file </h4><br><p>  By default, the specification file can be split and stored, for example, definitions (an object containing a description of the data circulating in operations) separately and access it via a link.  But this option did not work because of connexion.  The current version of the package does not provide for this feature (sincerely I hope that in the next versions it will be added).  For now it was necessary to get out as follows: all objects of entities (definitions, paths, responses, etc.) are selected in files and collected by means of grunt.  The result was a set of tasks that can be easily added and changed.  In my opinion, this option is better than finding the desired line among ~ 2500 lines of the final file. <br>  Here is an excerpt from the task for the client part: </p><br><ol><li>  Cleaning before assembly <br><pre><code class="coffeescript hljs">clean: client: [ <span class="hljs-string"><span class="hljs-string">'&lt;%= client_interim_dir %&gt;'</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;%= client_root %&gt;/definitions.yml'</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;%= client_root %&gt;/paths.yml'</span></span> ]</code> </pre> </li><li><p>  Add indents </p><br><pre> <code class="coffeescript hljs">indent: client_common_definitions: src: [<span class="hljs-string"><span class="hljs-string">'&lt;%= client_common %&gt;/definitions/*.yml'</span></span>] dest: <span class="hljs-string"><span class="hljs-string">'&lt;%= client_interim_dir %&gt;/common/definitions/'</span></span> options: style: <span class="hljs-string"><span class="hljs-string">'space'</span></span> size: <span class="hljs-number"><span class="hljs-number">2</span></span> change: <span class="hljs-number"><span class="hljs-number">1</span></span> client_dedic_definitions: src: [<span class="hljs-string"><span class="hljs-string">'&lt;%= client_dedic_project %&gt;/definitions/*.yml'</span></span>] dest: <span class="hljs-string"><span class="hljs-string">'&lt;%= client_interim_dir %&gt;/dedic/definitions/'</span></span> options: style: <span class="hljs-string"><span class="hljs-string">'space'</span></span> size: <span class="hljs-number"><span class="hljs-number">2</span></span> change: <span class="hljs-number"><span class="hljs-number">1</span></span> client_common_paths: src: [<span class="hljs-string"><span class="hljs-string">'&lt;%= client_common %&gt;/paths/*.yml'</span></span>] dest: <span class="hljs-string"><span class="hljs-string">'&lt;%= client_interim_dir %&gt;/common/paths/'</span></span> options: style: <span class="hljs-string"><span class="hljs-string">'space'</span></span> size: <span class="hljs-number"><span class="hljs-number">2</span></span> change: <span class="hljs-number"><span class="hljs-number">1</span></span> client_dedic_paths: src: [<span class="hljs-string"><span class="hljs-string">'&lt;%= client_dedic_project %&gt;/paths/*.yml'</span></span>] dest: <span class="hljs-string"><span class="hljs-string">'&lt;%= client_interim_dir %&gt;/dedic/paths/'</span></span> options: style: <span class="hljs-string"><span class="hljs-string">'space'</span></span> size: <span class="hljs-number"><span class="hljs-number">2</span></span> change: <span class="hljs-number"><span class="hljs-number">1</span></span> client_misc: src: [ <span class="hljs-string"><span class="hljs-string">'&lt;%= client_root %&gt;/projects.yml'</span></span> ] dest: <span class="hljs-string"><span class="hljs-string">'&lt;%= client_interim_dir %&gt;/'</span></span> options: style: <span class="hljs-string"><span class="hljs-string">'space'</span></span> size: <span class="hljs-number"><span class="hljs-number">2</span></span> change: <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br></li><li><p>  ‚ÄúGluing‚Äù intermediate and final files </p><br><pre> <code class="coffeescript hljs">concat: client_common_definitions: src: [<span class="hljs-string"><span class="hljs-string">'&lt;%= client_interim_dir %&gt;/common/definitions/*.yml'</span></span>] dest: <span class="hljs-string"><span class="hljs-string">'&lt;%= client_interim_dir %&gt;/common_definitions.yml'</span></span> client_dedic_definitions: src: [<span class="hljs-string"><span class="hljs-string">'&lt;%= client_interim_dir %&gt;/dedic/definitions/*.yml'</span></span>] dest: <span class="hljs-string"><span class="hljs-string">'&lt;%= client_interim_dir %&gt;/dedic_definitions.yml'</span></span> client_common_paths: src: [<span class="hljs-string"><span class="hljs-string">'&lt;%= client_interim_dir %&gt;/common/paths/*.yml'</span></span>] dest: <span class="hljs-string"><span class="hljs-string">'&lt;%= client_interim_dir %&gt;/common_paths.yml'</span></span> client_dedic_paths: src: [<span class="hljs-string"><span class="hljs-string">'&lt;%= client_interim_dir %&gt;/dedic/paths/*.yml'</span></span>] dest: <span class="hljs-string"><span class="hljs-string">'&lt;%= client_interim_dir %&gt;/dedic_paths.yml'</span></span> client_misc_paths: src: [ <span class="hljs-string"><span class="hljs-string">'&lt;%= client_interim_dir %&gt;/common_paths.yml'</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;%= client_interim_dir %&gt;/projects.yml'</span></span> ] dest: <span class="hljs-string"><span class="hljs-string">'&lt;%= client_interim_dir %&gt;/common_paths.yml'</span></span> client_target_paths: src: [ <span class="hljs-string"><span class="hljs-string">'&lt;%= client_root %&gt;/paths_header.yml'</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;%= client_interim_dir %&gt;/common_paths.yml'</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;%= client_interim_dir %&gt;/dedic_paths.yml'</span></span> ] dest: <span class="hljs-string"><span class="hljs-string">'&lt;%= client_root %&gt;/paths.yml'</span></span> client_target_definitions: src: [ <span class="hljs-string"><span class="hljs-string">'&lt;%= client_root %&gt;/definitions_header.yml'</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;%= client_interim_dir %&gt;/common_definitions.yml'</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;%= client_interim_dir %&gt;/dedic_definitions.yml'</span></span> ] dest: <span class="hljs-string"><span class="hljs-string">'&lt;%= client_root %&gt;/definitions.yml'</span></span> client_swagger: src: [ <span class="hljs-string"><span class="hljs-string">'&lt;%= client_root %&gt;/info.yml'</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;%= client_root %&gt;/tags.yml'</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;%= client_root %&gt;/security.yml'</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;%= client_root %&gt;/definitions.yml'</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;%= client_root %&gt;/parameters.yml'</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;%= client_root %&gt;/responses.yml'</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;%= client_root %&gt;/paths.yml'</span></span> ] dest: <span class="hljs-string"><span class="hljs-string">'&lt;%= client_output_path %&gt;/client_swagger.yaml'</span></span></code> </pre> <br></li></ol><br><h4 id="sborka-api-prosloyki-dlya-frontenda">  Build api-layer for the frontend </h4><br><p>  This problem was discovered at the moment when I investigated how swagger-codegen can perform the assembly.  There are two options: provide a specification file or download it.  And here we decided to collect from the file, since the API service can refuse and this will affect the work of the frontend.  Therefore, we chose the finished file.  The repository was connected as git submodule, which ensured constant relevance.  The algorithm is the following: </p><br><ol><li>  Update dependent repository: <br><pre> <code class="bash hljs">git submodule update</code> </pre> </li><li>  Run the Grunt build task: <br><pre> <code class="bash hljs">grunt compile</code> </pre> </li><li>  Run swagger-codegen with the resulting file. </li></ol><br><p>  But the detail pops up that the input swagger-codegen accepts JSON.  And we have YAML.  And then we realized that we guessed with Grunt.  By connecting the plug YAML to JSON pants turning ... Ugh.  YAML turns into JSON.  And we get the required specification file. </p><br><h4 id="problema-imen">  Name problem </h4><br><p>  This was affected by the settings of swagger-codegen when naming methods and variables in typescript.  For example, the property name is ‚Äútotal_count‚Äù.  Without compilation settings, the typescript variable name became totalCount.  While trying to solve this problem, it was found that it is possible to send an additional settings file in JSON format along with the configuration file.  And this line: </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"modelPropertyNaming"</span></span>: <span class="hljs-string"><span class="hljs-string">"original"</span></span> }</code> </pre> <br><p>  leaves names without change. </p><br><p>  In the next issue, I will tell you how the thorny path of developing the frontend began and how we managed to optimize the loading of the panel.  Thanks for attention!) </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/339602/">https://habr.com/ru/post/339602/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339586/index.html">Red arrows of extra reality</a></li>
<li><a href="../339590/index.html">Webpack and addictions</a></li>
<li><a href="../339592/index.html">Functional F #, which slowly appears in C #</a></li>
<li><a href="../339594/index.html">Expansion of analytical capabilities of the linear programming method with Python tools</a></li>
<li><a href="../339596/index.html">The history of hacking all the games in Telegram</a></li>
<li><a href="../339606/index.html">Railway-oriented programming. Functional style error handling</a></li>
<li><a href="../339608/index.html">The digest of interesting materials for the mobile developer # 224 (October 2 - October 8)</a></li>
<li><a href="../339610/index.html">Translation of two articles: ‚ÄúHow to commit changes to a Docker image‚Äù and ‚ÄúGuide for Moving Docker Containers‚Äù</a></li>
<li><a href="../339612/index.html">PGP offline key storage strategies</a></li>
<li><a href="../339614/index.html">Migrating business critical applications to the cloud: VMware tools overview</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>