<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Solving the STOP 7B error when replacing a disk system controller. The use of virtual machines in data recovery</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Disclaimer: it was not possible to establish the exact model of servers and controllers after years of age, so there will be reservations in the text ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Solving the STOP 7B error when replacing a disk system controller. The use of virtual machines in data recovery</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/habraeffect/d3/34/d33416288f7dd1c80882a5c07fd4d45e.jpg" alt="image"><br>  Disclaimer: it was not possible to establish the exact model of servers and controllers after years of age, so there will be reservations in the text when mentioning the model and, of course, errors in the details are possible.  Essentially, this does not change - the procedure for overcoming the lack of a new controller driver without the Recovery Console and the "deep" knowledge of Windows 2003 is described below. Probably, more optimal ways of solving this problem are possible than using a virtual machine. <br><br>  <b>Problem</b> : The controller broke, two SCSI disks fell out, and then the entire server died.  It was an HP Proliant, supposedly a Proliant DL380 G3 with a Smartarray 6i controller.  By morning, you need to get Exchange to work and several domains that are spinning on the server. <br><a name="habracut"></a><br>  They lifted the disks, made sector-based images, made an image of the entire raid.  The data was restored from the image, but the customer also wants to restore the server to work.  There is no server with the same RAID controller, there is no time to search - it is a controller of several domains, not all domains have BDC.  Plus Exchange is spinning in the same place.  By morning, everything must be put into operation - several offices of people will come and will not be able to work.  There is another server with another controller - Smartarray P410 on SAS disks.  We will try to make it work on it.  We fill the full image of the array onto the new RAID on the new controller in the hope that the drivers are compatible, but the system does not want to boot - crashes with the <b>STOP 0x0000007B INACCESSIBLE_BOOT_DEVICE error</b> .  Recovery Console no.  How to embed it in an idle server is not clear.  We tried HP SmartStart in the hope that it will install the drivers in the new system, but it did not help. <br><br>  In the process, we tried to start the server in a virtual environment - it works, but slowly and sadly - in the morning users will tumble down it.  Tried to make a backup-restore from a virtual machine to a new one using ntbackup.  Backup until the morning is not done - slowly.  We thought about the image of Akronis, but there is not a single PCI in the new server, and all the PCIe controllers available at hand do not want to work in the new server, respectively, there is no possibility to mount the image on the disk from which they wanted to restore this image to a new RAID. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We are trying to install a new controller driver in VMware (this is an sfx archive).  He says that such equipment is not in the system.  We unpack the archive and try to install the driver through the right-click menu in the right-click menu, load, does not help - STOP 7B.  We start to dig the driver itself, or rather the inf file, after having studied the <a href="https://msdn.microsoft.com/en-us/library/aa376957(v%3Dvs.85).aspx">InstallHinfSection Function</a> .  There is no section in Default or something like that, which is probably why the right-click installation did not help.  We start to try all the sections in a row with the team <br><br><pre><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNDLL32</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.EXE</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SETUPAPI</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.DLL</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">InstallHinfSection</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">DefaultInstall</span></span> 4 <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>:\<span class="hljs-selector-tag"><span class="hljs-selector-tag">WINDOWS</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">INF</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">SHELL</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.INF</span></span></code> </pre> <br>  where DefaultInstall is the section name, 4 is ‚ÄúIf a reboot is necessary, ask for user permission before rebooting‚Äù.  I was particularly interested in the sections that mentioned something like copying and installing the driver. <br><br><pre> <code class="hljs mel">[HpCISSs2_Inst.ntx86] CopyFiles = @HpCISSs2.sys [HpCISSs2_Service_Inst] ServiceType = %SERVICE_KERNEL_DRIVER% StartType = %SERVICE_BOOT_START% ErrorControl = %SERVICE_ERROR_NORMAL% ServiceBinary = %12%\HpCISSs2.sys LoadOrderGroup = SCSI Miniport AddReg = pnpsafe_pci_addreg AddReg = boot_ctrl_addreg AddReg = disk_timeout_addreg</code> </pre><br>  after the successful command was executed, the offer to reboot was received, an image was made and the system was loaded.  Users successfully earned in the morning, and then DC and Exchange replicas were made to the new servers, but the customers did this themselves. <br><br>  Practical benefits for the masses <br>  Suppose you changed the motherboard after a breakdown of the old one - you can safely try to put a disk in it after the driver is installed.  To do this, you need VMware, Winhex (to disable and enable the boot sector - it helps to avoid damage to NTFS if it is opened at the same time as the host and guest systems) and new drivers.  It may be worthwhile, over time, to describe this process step by step and in a separate article. <br><br>  This order is <a href="https://www.datarc.ru/cases/vosstanovlenie-raid5-hp-smartarray-i-vosstanovlenie-rabotosposobnosti-sistemy-posle-oshibki-stop-7b-inaccessible_boot_device.html">described on our website</a> in the data recovery case section.  Another case is the <a href="https://www.datarc.ru/cases/raid_5_3xscsi_36gb_ibm_xseries_342_novell_nwfs.html">virtualization of the old Novell server after a controller failure</a> . <br><br>  <b>UPDATE</b> practical benefits for the masses: <a href="https://habrahabr.ru/users/mafet/" class="user_link">mafet</a> rightly noted that in the same way (via RUNDLL32.EXE SETUPAPI.DLL, InstallHinfSection) you can add drivers for the new system before migrating to it </div><p>Source: <a href="https://habr.com/ru/post/116556/">https://habr.com/ru/post/116556/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../116549/index.html">Microsoft is suing Google in Europe</a></li>
<li><a href="../116550/index.html">Super button for Munchkin</a></li>
<li><a href="../116551/index.html">Once again on the topic of classifications of users of different operating systems</a></li>
<li><a href="../116553/index.html">Welcome to Moscow, the capital of the Russian Federation!</a></li>
<li><a href="../116555/index.html">New features for expanding Evernote for Google Chrome</a></li>
<li><a href="../116557/index.html">Start of navigation</a></li>
<li><a href="../116558/index.html">Tips for beginning poultry farmers: how to buy Parrot AR.Drone</a></li>
<li><a href="../116559/index.html">Video review compact and inexpensive tablet Archos 70 IT</a></li>
<li><a href="../116560/index.html">FPV</a></li>
<li><a href="../116561/index.html">The official VKontakte app for iPhone</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>