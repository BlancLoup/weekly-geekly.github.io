<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We prepare expansion under Chrome, we decorate Habr</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="To make the extension sufficiently minimal knowledge of Javasctipt, HTML and CSS. Let's add on Habr load the next page, as well as a systematic check ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We prepare expansion under Chrome, we decorate Habr</h1><div class="post__text post__text-html js-mediator-article">  To make the extension sufficiently minimal knowledge of Javasctipt, HTML and CSS.  Let's add on Habr load the next page, as well as a systematic check of new posts on the current.  Something like <a href="https://twitter.com/">twitter</a> . <br><br>  Fully-ready extension can be <a href="https://chrome.google.com/webstore/detail/glaccbllkhielccdhfbbpilnlbemgaji">installed</a> and tested in work through the Chrome Web Store, and here we will figure out how to write the basic code from scratch (the full one takes only 6 KB). <br><br><img width="522" height="173" src="https://habrastorage.org/getpro/habr/post_images/90c/98b/110/90c98b1105e53f99cbdd376cf4b44c43.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  First you need to create a separate folder of our extensions and put the manifest.json file into it with the following content: <br><br><pre><code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Habrahabr Demo"</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span>:<span class="hljs-string"><span class="hljs-string">"0.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>:<span class="hljs-string"><span class="hljs-string">"Demo plugin"</span></span>, <span class="hljs-string"><span class="hljs-string">"content_scripts"</span></span>:[ { <span class="hljs-string"><span class="hljs-string">"matches"</span></span>:[<span class="hljs-string"><span class="hljs-string">"http://habrahabr.ru/*"</span></span>], <span class="hljs-string"><span class="hljs-string">"css"</span></span>:[<span class="hljs-string"><span class="hljs-string">"style.css"</span></span>], <span class="hljs-string"><span class="hljs-string">"js"</span></span>:[<span class="hljs-string"><span class="hljs-string">"jquery.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"script.js"</span></span>] } ] }</code> </pre> <br>  The extension will only be activated on habrahabr.ru.  It will load the style.css, script.js and jQuery library from its folder.  Chrome will complain about the absence of these files, so we‚Äôll put empty style.css and script.js alongside, and also download the most recent jquery (which is always located at <a href="">http://code.jquery.com/jquery.js</a> ) and also put in folder. <br><br>  Now connect our extension.  Go to the chrome extensions settings (chrome: // settings / extensions), tick the ‚ÄúDeveloper mode‚Äù box and click ‚ÄúLoad unpacked extension ...‚Äù to specify the location of the folder with our files.  Module added: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/73a/1e9/4f5/73a1e94f59ce2b7ecd41df6ec4478d87.png" alt="image"><br><br>  Reboot Habr, make sure that everything really works.  More precisely, nothing, of course, will not change.  To check, we‚Äôll add something like this to style.css: <br><br><pre> <code class="css hljs"><span class="hljs-selector-id"><span class="hljs-selector-id">#layout</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">max-width</span></span>: none <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; }</code> </pre><br>  And in script.js, let's say: <br><br><pre> <code class="javascript hljs">$(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> username = $(<span class="hljs-string"><span class="hljs-string">"#header .username"</span></span>).text(); $(<span class="hljs-string"><span class="hljs-string">"#header .bottom"</span></span>).append( <span class="hljs-string"><span class="hljs-string">'&lt;a href="/users/'</span></span> + username + <span class="hljs-string"><span class="hljs-string">'/topics/"&gt;&lt;/a&gt;'</span></span>+ <span class="hljs-string"><span class="hljs-string">'&lt;a href="/users/'</span></span> + username + <span class="hljs-string"><span class="hljs-string">'/qa/questions/"&gt;&lt;/a&gt;'</span></span>+ <span class="hljs-string"><span class="hljs-string">'&lt;a href="/users/'</span></span> + username + <span class="hljs-string"><span class="hljs-string">'/comments/"&gt;&lt;/a&gt;'</span></span> ); });</code> </pre><br>  Reload the extension by clicking on the Reload link (it opens with a triangle to the left of the extension icon).  Then restart Habr and make sure that the layout has become rubber, and under the nickname added new links (if you are registered). <br><br>  Get down to AJAX loading.  To begin with, let's add a click handler to the ‚ÄúThere‚Äù link: <br><br><pre> <code class="javascript hljs">$(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).on(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, <span class="hljs-string"><span class="hljs-string">"#next_page"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> nextPrevBlock = $(<span class="hljs-string"><span class="hljs-string">".next-prev"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    / var href = $(this).attr("href"); //    $.ajax({ url:href, success:function (response) { $(".posts").append($(response).find(".posts").html()); //      $(".page-nav").html($(".page-nav", response).html()); //    //   stopTrackingScrollToBottom = false; //     } }); return false; //     });</span></span></code> </pre><br>  Now when you click on the link, posts from the new page will be added to posts on the current one (again, do not forget to restart the extension and Habr).  It is considered to be a good form to show the loading indicator, here we omit it, for the sake of simplicity. <br><br>  Next, we do so that the link presses itself when we scroll to the bottom of the page. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stopTrackingScrollToBottom = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; $(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>).scroll(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>).scrollTop() + <span class="hljs-number"><span class="hljs-number">10</span></span> &gt;= ($(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).height() - ($(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>).height()))) { <span class="hljs-comment"><span class="hljs-comment">//  10     if (stopTrackingScrollToBottom == false) { //        stopTrackingScrollToBottom = true; //        $("#next_page").click(); //     :) } } if ($(window).scrollTop() == 0) { //     checkForNewPosts(); } });</span></span></code> </pre><br><br>  And at the same time laid the beginning of the second part of the script - call checkForNewPosts () when scrolling to the top of the page.  The function should check for the presence of new posts on the current page and report the badge: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkForNewPosts</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">andLoadThem</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($(<span class="hljs-string"><span class="hljs-string">".posts"</span></span>).length == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//      ,  return; } $(".posts").prepend('&lt;div class="new-posts-ajax"&gt;&lt;img src="http://isbeauty.ru/images/icon_ajax_loader.gif"/&gt;&lt;/div&gt;'); $.ajax({ url:window.location.href, success:function (response) { $(".new-posts-ajax").remove(); //              var newPosts = getPostIds(response).diff(getPostIds()); Tinycon.setBubble(newPosts.length); } }); } Array.prototype.diff = function (a) { return this.filter(function (i) { return !(a.indexOf(i) &gt; -1); }); }; function getPostIds(where) { var postIds = []; $(".post", where).each(function () { var postId = $(this).attr("id"); postIds.push(postId); }); return postIds; }</span></span></code> </pre><br><br>  There is no result yet because Tinycon.setBubble () does not exist.  It should exhibit a badge on a favicon and is implemented in the Tinycon library.  To connect it download tinycon.js from <a href="https://github.com/tommoor/tinycon">github</a> , put it in the extensions folder and do not forget to connect tinycon.js to manifest.json. <br><br>  To check that the badge works, let's go to <a href="http://habrahabr.ru/posts/top/daily/">http://habrahabr.ru/posts/top/daily/</a> (in general, it is better to train on the top pages, they seem to be cached and do not create a large load).  Open the code inspect (F12), delete a couple of divs inside &lt;div class = "posts"&gt; ... &lt;/ div&gt; and scroll to the top of the page.  Badge should show the number of missing topics. <br><br>  Let's also make this check happen regularly, once a minute: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> MAX_CHECKS_FOR_NEW_POSTS = <span class="hljs-number"><span class="hljs-number">60</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     ,        var CHECK_FOR_NEW_POSTS_EACH = 60; //       $(function () { window.checkNewPostsTimer = setInterval(function () { MAX_CHECKS_FOR_NEW_POSTS--; if (MAX_CHECKS_FOR_NEW_POSTS &lt;= 0) { // self-destroy timer clearInterval(window.checkNewPostsTimer); } else { checkForNewPosts(); } }, CHECK_FOR_NEW_POSTS_EACH * 1000); });</span></span></code> </pre><br><br>  Not so much code left, but this will finish.  The aesthetic side of the issue is not covered, as well as the opportunity to reload the found new posts, to cancel the automatic reloading of the next page (by the button and by &lt;Esc&gt;).  All this is implemented in the finished extension, and the source code is available after <a href="https://chrome.google.com/webstore/detail/glaccbllkhielccdhfbbpilnlbemgaji">installation</a> somewhere in the folder: <br>  C: \ Users \% USERNAME% \ AppData \ Local \ Google \ Chrome \ User Data \ Default \ Extensions \ glaccbllkhielccdhfbbpilnlbemgaji <br>  (if not there, look for the glaccbllkhielccdhfbbpilnlbemgaji folder somewhere else). <br><br>  It remains to lay out the extension for public access.  To do this, you need to get a private key file, it is required to upload this and new versions of your extension in the future.  In the settings of extensions click the button ‚ÄúPack extension‚Äù, specify the path to the folder and leave the path to the key blank: <br><br><img src="http://dl.dropbox.com/u/15243470/habr/habrajaxpaging/Image3.png" alt="image"><br><br>  After packing, chrome will create the file DemoExtension.crx and DemoExtension.pem, the last one you need to rename to key.pem and drop it into the extension folder (do not lose it, otherwise you will not be able to update this extension).  After that, the entire extension folder needs to be archived in DemoExtension.zip and uploaded to your <a href="https://chrome.google.com/webstore/developer/dashboard">control panel</a> .  A CRX file is not involved at all. <br><br>  After uploading the archive you will need to fill in the personal data of the extension and you can publish it.  A public extension in the Chrome Web Store can be made after a one-time donation to the $ 5 corporation, but this is not necessary, you can put DemoExtension.crx (not zip) earlier, even on Dropbox, Chrome will install it after confirming security. <br><br>  Here is the module that is uploaded in the Web Store: <br><br><img src="http://dl.dropbox.com/u/15243470/habr/habrajaxpaging/Image4.png" alt="image"><br><br>  This extension does not add buttons to the panel, neither dialog boxes, nor items in the context menu, it has no settings, but you yourself will figure out how to do it all. <br><br>  Now go ahead, make websites better, more convenient, more beautiful!  :) </div><p>Source: <a href="https://habr.com/ru/post/143421/">https://habr.com/ru/post/143421/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../143416/index.html">Trend that changes everything</a></li>
<li><a href="../143417/index.html">May 7 in Tomsk or with the past Radio Day!</a></li>
<li><a href="../143418/index.html">Second Scala Conference in Petersburg</a></li>
<li><a href="../143419/index.html">UA Web Challenge 2012 Report</a></li>
<li><a href="../143420/index.html">Improved Youtube Stabilization</a></li>
<li><a href="../143422/index.html">New iPad vs Acer Iconia Tab and BlackBerry PlayBook</a></li>
<li><a href="../143424/index.html">IOS development as a lottery: 59% do not discourage costs</a></li>
<li><a href="../143426/index.html">Draw Something loses users, the cost of "Zing" falls</a></li>
<li><a href="../143427/index.html">Logitech Performance Mouse MX Mouse Review</a></li>
<li><a href="../143428/index.html">The most important decisions are non-technical.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>