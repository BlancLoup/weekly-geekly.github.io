<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Yet another cool story about bash prompt</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I am a programmer. At least it is written in the workbook. Almost all of my work time I spend in the console and text editor. I really like bash. I li...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Yet another cool story about bash prompt</h1><div class="post__text post__text-html js-mediator-article">  I am a programmer.  At least it is written in the workbook.  Almost all of my work time I spend in the console and text editor.  I really like bash.  I lived in zsh for almost a year, listening to the advice of my many colleagues and acquaintances, but in the end I returned to bash and didn‚Äôt regret it. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/933/105/857/9331058571559846555153470168c544.png"></div><br><br>  Zsh is beautiful, pleasant, damn functional, but, I confess honestly, I could not cope with all its many settings.  I want to work, not fight with my working environment.  A simple example: a couple of times due to the zsh autocompletion, I deleted all the directories and files in the current directory - zsh just put a space between the autocompleted directory and the star I entered (I wanted to delete everything in the selected folder).  Remember that <a href="http://habrahabr.ru/post/122020/">epic bug</a> with a space and the removal of the / usr directory?  I had the same thing.  Thanks to the gita, helped out again. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      However, it's not about zsh - if I were a little smarter, I would definitely cope with it, and everything would be fine, but we, severe programmers, will use bash and vim, and glamorous zsh and textmate will leave to hipsters and other mods;) <br><br>  I will not write anything original and universal solution, I will not give, but I always liked to read configs and descriptions of other people, and if they were accompanied by interesting pictures, so I generally re-read these articles several times.  I hope you will be interested too. <a name="habracut"></a><br><br>  If suddenly something from what I have written can be solved more simply, or there is already a described functionality in the bash - write in the comments.  Well, just in case, my where I live: <br><pre><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">GNU</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bash</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">version</span></span> 4<span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.28</span></span>(2)<span class="hljs-selector-tag"><span class="hljs-selector-tag">-release</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">i386-apple-darwin11</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>)</code> </pre> <br><br><br><h3>  Add line feed before prompt </h3><br><br>  So, the first thing that I come across every day and what I don‚Äôt like in bash is the commands that do not complete their output with a line break at the end.  Here is a simple example (emulation of this behavior): <br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/6f3/7fe/ca5/6f37feca502f912c65b04a5a92cb1736.png"></div><br>  Of course, nothing terrible happened, but the same zsh correctly handles this situation, and we will teach bash such a trick. <br><br>  To do this, we need to look at the cursor position at each output of the command line prompt (PS1), and if the cursor is not on the first character in the line, output a line break ("\ n" character).  The position of the cursor can be determined using the escape sequence: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -en <span class="hljs-string"><span class="hljs-string">"\033[6n"</span></span> &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -sdR CURPOS</code> </pre><br>  As a result, the CURPOS variable will contain something like this: "^ [[4; 12R", where 4 is the line number and 12 is the number of the character in the line.  Add the appropriate code to our bash config (~ / .bashrc or ~ / .bash_profile): <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># setup color variables color_is_on= color_red= color_green= color_yellow= color_blue= color_white= color_gray= color_bg_red= color_off= if [ -x /usr/bin/tput ] &amp;&amp; tput setaf 1 &gt;&amp;/dev/null; then color_is_on=true color_red="\[$(/usr/bin/tput setaf 1)\]" color_green="\[$(/usr/bin/tput setaf 2)\]" color_yellow="\[$(/usr/bin/tput setaf 3)\]" color_blue="\[$(/usr/bin/tput setaf 6)\]" color_white="\[$(/usr/bin/tput setaf 7)\]" color_gray="\[$(/usr/bin/tput setaf 8)\]" color_off="\[$(/usr/bin/tput sgr0)\]" color_error="$(/usr/bin/tput setab 1)$(/usr/bin/tput setaf 7)" color_error_off="$(/usr/bin/tput sgr0)" fi function prompt_command { # get cursor position and add new line if we're not in first column exec &lt; /dev/tty local OLDSTTY=$(stty -g) stty raw -echo min 0 echo -en "\033[6n" &gt; /dev/tty &amp;&amp; read -sdR CURPOS stty $OLDSTTY [[ ${CURPOS##*;} -gt 1 ]] &amp;&amp; echo "${color_error}‚Üµ${color_error_off}" } PROMPT_COMMAND=prompt_command</span></span></code> </pre><br>  <b>CM.</b>  <b>Update</b> <br>  PROMPT_COMMAND is a function that is called whenever the command prompt is drawn.  Here, a small hack was used, peeped by me in a <a href="http://stackoverflow.com/a/2575525/1164595">comment on stackoverflow</a> , without this hack the value of the $ CURPOS variable in some cases was displayed on the screen.  Do not pay attention to a bunch of flowers - below they will all be useful to us.  The result of our config: <br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/9f4/dbf/4ca/9f4dbf4caca8942ac2d10c2fc4fd9208.png"></div><br>  A red background was added specifically to distinguish this symbol from what the command can output.  And, yes, it's the 21st century, so we use the utf-local locale.  In the case of obsolete locales.  The symbol "‚Üµ" will most likely have to be replaced with something simpler, for example, the symbol "%", as in zsh. <br><br><h3>  Display the status of the git repository </h3><br><br>  When working with git from the console (just don‚Äôt need to talk about gui - we‚Äôre the harsh developers of the old school!) It‚Äôs convenient to see the current branch of the git and the general state of the repository - are there any modified files or everything is closed.  Already at this stage, I came to the conclusion that it would be more convenient for me to work with the command line prompt consisting of two lines - the first line displays information about the current environment (user, server, working directory, information about the repository, and generally everything we want ), and in the second line - the command that we enter.  The first time was unusual, but now I am not ready to go back to the previous scheme. In order to add information about the program, we can use the specially trained function "__git_ps1", which appears along with the bash-completion for the program: <br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/07f/442/4f5/07f4424f5688f3c1d947221b923b14a0.png"></div><br>  or write your own ‚Äúcrutch‚Äù.  I went the second way, because  The __git_ps1 function did not satisfy me.  Firstly, I wanted to see not only the name of the branch, but also the state of the repository, also highlighting this state with different colors.  Secondly, I use the <a href="https://github.com/dreadatour/dotfiles">git repository</a> to synchronize my configs between different machines / servers, and I want to see the status of this repository only in the home directory, but not in all subfolders, regardless of their depth. <br><br>  Actually, the function reading the state of the gita is as follows: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># get git status function parse_git_status { # clear git variables GIT_BRANCH= GIT_DIRTY= # exit if no git found in system local GIT_BIN=$(which git 2&gt;/dev/null) [[ -z $GIT_BIN ]] &amp;&amp; return # check we are in git repo local CUR_DIR=$PWD while [ ! -d ${CUR_DIR}/.git ] &amp;&amp; [ ! $CUR_DIR = "/" ]; do CUR_DIR=${CUR_DIR%/*}; done [[ ! -d ${CUR_DIR}/.git ]] &amp;&amp; return # 'git repo for dotfiles' fix: show git status only in home dir and other git repos [[ $CUR_DIR == $HOME ]] &amp;&amp; [[ $PWD != $HOME ]] &amp;&amp; return # get git branch GIT_BRANCH=$($GIT_BIN symbolic-ref HEAD 2&gt;/dev/null) [[ -z $GIT_BRANCH ]] &amp;&amp; return GIT_BRANCH=${GIT_BRANCH#refs/heads/} # get git status local GIT_STATUS=$($GIT_BIN status --porcelain 2&gt;/dev/null) [[ -n $GIT_STATUS ]] &amp;&amp; GIT_DIRTY=true }</span></span></code> </pre><br>  Previously, I still parsed and separately displayed modified (modified) files, files that are in the index for a commit (cached), and files that do not belong to the repository (untracked), but over time I realized that this is too much information for me.  Actually, the function is simple: we see that git is generally in the system, check that we are in the gitovy repository, recursively bypassing all directories up to the root of the file system and looking for the folder ".git", we get the name of the current branch and see if there is any any uncommitted files.  Add a call to this function in our prompt_command and build the invitation: <br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> prompt_command { <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> PS1_GIT= <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> PWDNAME=<span class="hljs-variable"><span class="hljs-variable">$PWD</span></span> ... <span class="hljs-comment"><span class="hljs-comment"># beautify working firectory name if [ $HOME == $PWD ]; then PWDNAME="~" elif [ $HOME == ${PWD:0:${#HOME}} ]; then PWDNAME="~${PWD:${#HOME}}" fi # parse git status and get git variables parse_git_status # build b/w prompt for git [[ ! -z $GIT_BRANCH ]] &amp;&amp; PS1_GIT=" (git: ${GIT_BRANCH})" local color_user= if $color_is_on; then # set user color case `id -u` in 0) color_user=$color_red ;; *) color_user=$color_green ;; esac # build git status for prompt if [ ! -z $GIT_BRANCH ]; then if [ -z $GIT_DIRTY ]; then PS1_GIT=" (git: ${color_green}${GIT_BRANCH}${color_off})" else PS1_GIT=" (git: ${color_red}${GIT_BRANCH}${color_off})" fi fi fi # set new color prompt PS1="${color_user}${USER}${color_off}@${color_yellow}${HOSTNAME}${color_off}:${color_white}${PWDNAME}${color_off}${PS1_GIT}\n‚ûú " }</span></span></code> </pre><br>  Here's what it looks like in the end: <br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/260/415/2aa/2604152aa9d9f1dd6e2d69a3b6779fb7.png"></div><br>  A couple of words about the variable PWDNAME.  Yes, I know that you can write "\ w" and everything will be the same, but in my function "prompt_command" the terminal title is also set: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># set title echo -ne "\033]0;${USER}@${HOSTNAME}:${PWDNAME}"; echo -ne "\007"</span></span></code> </pre><br>  and there already "\ w" does not work. <br><br><h3>  Show the name of the python virtual environment. </h3><br><br>  Recently, the main language in which I write is Python.  For him there is a very handy thing called <a href="http://www.virtualenv.org/">virtualenv</a> .  I will not go into details - this is the topic of a separate article, but it is also extremely convenient to see the current virtual environment in the bash console. <br><br>  Actually the virtualenv script adds the name of the current venv to the bash invitation, but it looks very ugly: <br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/f1c/bf2/092/f1cbf209237044ec7757b38e73ed66ae.png"></div><br>  We prohibit vertualenv from interfering with our command line prompt: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> VIRTUAL_ENV_DISABLE_PROMPT=1</code> </pre><br>  And we derive the name venv ourselves, the way we like it: <br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> prompt_command { <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> PS1_VENV= ... [[ ! -z <span class="hljs-variable"><span class="hljs-variable">$VIRTUAL_ENV</span></span> ]] &amp;&amp; PS1_VENV=<span class="hljs-string"><span class="hljs-string">" (venv: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${VIRTUAL_ENV#$WORKON_HOME}</span></span></span><span class="hljs-string">)"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-variable"><span class="hljs-variable">$color_is_on</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> ... <span class="hljs-comment"><span class="hljs-comment"># build python venv status for prompt [[ ! -z $VIRTUAL_ENV ]] &amp;&amp; PS1_VENV=" (venv: ${color_blue}${VIRTUAL_ENV#$WORKON_HOME}${color_off})" fi # set new color prompt PS1="${color_user}${USER}${color_off}@${color_yellow}${HOSTNAME}${color_off}:${color_white}\w${color_off}${PS1_GIT}${PS1_VENV}\n‚ûú " }</span></span></code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/69a/547/ef2/69a547ef280be8fc27b7169d8eaca377.png"></div><br>  Actually, everything is quite banal. <br><br><h3>  Separate the teams visually from each other </h3><br><br>  With a fairly active work with the terminal, the input commands and the result of their execution merge with each other, especially when there is a color in the output: <br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/e37/5a9/99a/e375a999a45087d915a56f9691c95f14.png"></div><br>  Of course, the example is not quite indicative, but everyone who worked in the console understands what I mean. <br><br>  I decided to display a horizontal line in each invitation for the entire width of the terminal and this idea proved itself - it became much more convenient to use the console: <br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/db0/2fa/605/db02fa60523fef1bc2974f4502f46f59.png"></div><br>  Here is how I do it: <br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> prompt_command { ... <span class="hljs-comment"><span class="hljs-comment"># build b/w prompt for git and vertial env [[ ! -z $GIT_BRANCH ]] &amp;&amp; PS1_GIT=" (git: ${GIT_BRANCH})" [[ ! -z $VIRTUAL_ENV ]] &amp;&amp; PS1_VENV=" (venv: ${VIRTUAL_ENV#$WORKON_HOME})" # calculate fillsize local fillsize=$(($COLUMNS-$(printf "${USER}@${HOSTNAME}:${PWDNAME}${PS1_GIT}${PS1_VENV} " | wc -c | tr -d " "))) local FILL=$color_gray while [ $fillsize -gt 0 ]; do FILL="${FILL}‚îÄ"; fillsize=$(($fillsize-1)); done FILL="${FILL}${color_off}" ... # set new color prompt PS1="${color_user}${USER}${color_off}@${color_yellow}${HOSTNAME}${color_off}:${color_white}${PWDNAME}${color_off}${PS1_GIT}${PS1_VENV} ${FILL}\n‚ûú " }</span></span></code> </pre><br>  First, we find the length of the invitation string without a color, subtract it from the terminal width ($ COLUMNS variable) and make a string of that length consisting of the ASCII graphics character "‚îÄ" (again, if the locale is not Unicode, you can use any other character). <br><br><h3>  More colors </h3><br>  If the terminal supports 256 colors, it is not necessary to be limited to the standard ones: <br><pre> <code class="bash hljs">color_pink=<span class="hljs-string"><span class="hljs-string">"\[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(/usr/bin/tput setaf 99)</span></span></span><span class="hljs-string">\]"</span></span></code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/29a/9f7/556/29a9f75564948265380b5f026383bdf5.png"></div><br>  But for compatibility with legacy terminals, it is better to avoid this. <br><br><h3>  Afterword or ‚ÄúCool story, bro!‚Äù </h3><br><br>  The work environment should be comfortable, no matter what you use.  Bash can be cozy - you just need to try.  By the way, another reason why I do not use zsh is its absence on some servers that I go to and the inability to put it there. <br><br>  I really want to hear comments, as well as examples of setting up your terminal, despite the fact that there is a wagon on the Internet, and everyone who discovers various shells for the first (well, second) turns to customize the command line prompt. .  And, yes, ShG, I know;) I did not find the terminus under the poppy normal = (Sadness .. <br><br>  To save space, I do not cite all my config entirely - those who wish can look at it here: <a href="https://github.com/dreadatour/dotfiles">github.com/dreadatour/dotfiles</a> ( <a href="https://github.com/dreadatour/dotfiles/blob/master/.bash_profile">.bash_profile</a> file). <br><br>  <b>UPD</b> : Here is the code: <br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> prompt_command { <span class="hljs-comment"><span class="hljs-comment"># get cursor position and add new line if we're not in first column exec &lt; /dev/tty local OLDSTTY=$(stty -g) stty raw -echo min 0 echo -en "\033[6n" &gt; /dev/tty &amp;&amp; read -sdR CURPOS stty $OLDSTTY [[ ${CURPOS##*;} -gt 1 ]] &amp;&amp; echo "${color_error}‚Üµ${color_error_off}" } PROMPT_COMMAND=prompt_command</span></span></code> </pre><br>  breaks ssh.  Returned to the old version, without a hack, looking for what the problem is: <br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> prompt_command { <span class="hljs-comment"><span class="hljs-comment"># get cursor position and add new line if we're not in first column echo -en "\033[6n" &amp;&amp; read -sdR CURPOS [[ ${CURPOS##*;} -gt 1 ]] &amp;&amp; echo "${color_error}‚Üµ${color_error_off}" } PROMPT_COMMAND=prompt_command</span></span></code> </pre><br><br>  <b>UPD2</b> : Thank you all for the comments, - fixed the bugs, improved the code.  Now the prompt_command function looks like this: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># setup color variables color_is_on= color_red= color_green= color_yellow= color_blue= color_white= color_gray= color_bg_red= color_off= color_user= if [ -x /usr/bin/tput ] &amp;&amp; tput setaf 1 &gt;&amp;/dev/null; then color_is_on=true color_red="\[$(/usr/bin/tput setaf 1)\]" color_green="\[$(/usr/bin/tput setaf 2)\]" color_yellow="\[$(/usr/bin/tput setaf 3)\]" color_blue="\[$(/usr/bin/tput setaf 6)\]" color_white="\[$(/usr/bin/tput setaf 7)\]" color_gray="\[$(/usr/bin/tput setaf 8)\]" color_off="\[$(/usr/bin/tput sgr0)\]" color_error="$(/usr/bin/tput setab 1)$(/usr/bin/tput setaf 7)" color_error_off="$(/usr/bin/tput sgr0)" # set user color case `id -u` in 0) color_user=$color_red ;; *) color_user=$color_green ;; esac fi # some kind of optimization - check if git installed only on config load PS1_GIT_BIN=$(which git 2&gt;/dev/null) function prompt_command { local PS1_GIT= local PS1_VENV= local GIT_BRANCH= local GIT_DIRTY= local PWDNAME=$PWD # beautify working directory name if [[ "${HOME}" == "${PWD}" ]]; then PWDNAME="~" elif [[ "${HOME}" == "${PWD:0:${#HOME}}" ]]; then PWDNAME="~${PWD:${#HOME}}" fi # parse git status and get git variables if [[ ! -z $PS1_GIT_BIN ]]; then # check we are in git repo local CUR_DIR=$PWD while [[ ! -d "${CUR_DIR}/.git" ]] &amp;&amp; [[ ! "${CUR_DIR}" == "/" ]] &amp;&amp; [[ ! "${CUR_DIR}" == "~" ]] &amp;&amp; [[ ! "${CUR_DIR}" == "" ]]; do CUR_DIR=${CUR_DIR%/*}; done if [[ -d "${CUR_DIR}/.git" ]]; then # 'git repo for dotfiles' fix: show git status only in home dir and other git repos if [[ "${CUR_DIR}" != "${HOME}" ]] || [[ "${PWD}" == "${HOME}" ]]; then # get git branch GIT_BRANCH=$($PS1_GIT_BIN symbolic-ref HEAD 2&gt;/dev/null) if [[ ! -z $GIT_BRANCH ]]; then GIT_BRANCH=${GIT_BRANCH#refs/heads/} # get git status local GIT_STATUS=$($PS1_GIT_BIN status --porcelain 2&gt;/dev/null) [[ -n $GIT_STATUS ]] &amp;&amp; GIT_DIRTY=1 fi fi fi fi # build b/w prompt for git and virtual env [[ ! -z $GIT_BRANCH ]] &amp;&amp; PS1_GIT=" (git: ${GIT_BRANCH})" [[ ! -z $VIRTUAL_ENV ]] &amp;&amp; PS1_VENV=" (venv: ${VIRTUAL_ENV#$WORKON_HOME})" # calculate prompt length local PS1_length=$((${#USER}+${#HOSTNAME}+${#PWDNAME}+${#PS1_GIT}+${#PS1_VENV}+3)) local FILL= # if length is greater, than terminal width if [[ $PS1_length -gt $COLUMNS ]]; then # strip working directory name PWDNAME="...${PWDNAME:$(($PS1_length-$COLUMNS+3))}" else # else calculate fillsize local fillsize=$(($COLUMNS-$PS1_length)) FILL=$color_gray while [[ $fillsize -gt 0 ]]; do FILL="${FILL}‚îÄ"; fillsize=$(($fillsize-1)); done FILL="${FILL}${color_off}" fi if $color_is_on; then # build git status for prompt if [[ ! -z $GIT_BRANCH ]]; then if [[ -z $GIT_DIRTY ]]; then PS1_GIT=" (git: ${color_green}${GIT_BRANCH}${color_off})" else PS1_GIT=" (git: ${color_red}${GIT_BRANCH}${color_off})" fi fi # build python venv status for prompt [[ ! -z $VIRTUAL_ENV ]] &amp;&amp; PS1_VENV=" (venv: ${color_blue}${VIRTUAL_ENV#$WORKON_HOME}${color_off})" fi # set new color prompt PS1="${color_user}${USER}${color_off}@${color_yellow}${HOSTNAME}${color_off}:${color_white}${PWDNAME}${color_off}${PS1_GIT}${PS1_VENV} ${FILL}\n‚ûú " # get cursor position and add new line if we're not in first column # cool'n'dirty trick (http://stackoverflow.com/a/2575525/1164595) # XXX </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">FIXME:</span></span></span><span class="hljs-comment"> this hack broke ssh =( # exec &lt; /dev/tty # local OLDSTTY=$(stty -g) # stty raw -echo min 0 # echo -en "\033[6n" &gt; /dev/tty &amp;&amp; read -sdR CURPOS # stty $OLDSTTY echo -en "\033[6n" &amp;&amp; read -sdR CURPOS [[ ${CURPOS##*;} -gt 1 ]] &amp;&amp; echo "${color_error}‚Üµ${color_error_off}" # set title echo -ne "\033]0;${USER}@${HOSTNAME}:${PWDNAME}"; echo -ne "\007" } # set prompt command (title update and color prompt) PROMPT_COMMAND=prompt_command # set new b/w prompt (will be overwritten in 'prompt_command' later for color prompt) PS1='\u@\h:\w\$ '</span></span></code> </pre><br></div></div><br></div><p>Source: <a href="https://habr.com/ru/post/145008/">https://habr.com/ru/post/145008/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../145003/index.html">Rolling elements ("spoilers"): a relatively new alternative to habrakatu</a></li>
<li><a href="../145004/index.html">DPC Megaphone in the suburbs (Dmitrov)</a></li>
<li><a href="../145005/index.html">Court decision: Google does not violate Oracle copyright on Java API</a></li>
<li><a href="../145006/index.html">How NeoBook was born</a></li>
<li><a href="../145007/index.html">Cut F-1 machine</a></li>
<li><a href="../145009/index.html">Webinar: What are regular expressions?</a></li>
<li><a href="../145010/index.html">Humble Indie Bundle V has started - pay as much as you want for indie games</a></li>
<li><a href="../145011/index.html">Herrmann Dominanz Instrument (HDI). Part III</a></li>
<li><a href="../145012/index.html">Effective reading</a></li>
<li><a href="../145014/index.html">IT R & D Cream (Edition 10) - Fun Technology Park</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>