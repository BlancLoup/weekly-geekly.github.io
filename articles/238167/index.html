<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to get control of Virtual Machine Sprawl: 7 useful reports in the Veeam Availability Suite</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=""Do you see a gopher?" Not? And he is! " 
 A similar situation is quite possible with the uncontrolled growth of the number of virtual machines (Virtu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to get control of Virtual Machine Sprawl: 7 useful reports in the Veeam Availability Suite</h1><div class="post__text post__text-html js-mediator-article"><h5>  <b><i>"Do you see a gopher?"</i></b>  <b><i>Not?</i></b>  <b><i>And he is! "</i></b> </h5><br>  A similar situation is quite possible with the uncontrolled growth of the number of virtual machines (Virtual Machine Sprawl) - until a certain point we do not believe that such a problem exists in our infrastructure, but in fact it exists, it just does not show itself in full size. <br><br><h5>  <b><i>And what is the matter?</i></b> </h5><br>  The problem of an uncontrolled increase in the number of virtual machines is quite typical for rapidly growing virtual infrastructures.  It all starts with the very reasonable desire of one or another division of the company to work with its specialized applications on dedicated servers.  Of course, thanks to virtualization, they get this opportunity.  And now, dear readers, employees of the IT industry, developers and testers, think for at least approximately, how many virtual machines have you captured, say, over the past six months?  And how many of them were forgotten and forgotten after a successful release? <br><br>  It turns out that the more virtualization penetrates into the work environment and helps to solve production problems, the more ‚Äúvirtual waste‚Äù appears in this very environment (as, indeed, in almost any production).  This is what leads to the problem of the uncontrolled growth of the number of virtual machines (VM sprawl). <br><a name="habracut"></a><br><h5>  <b><i>Machines are virtual and money is real.</i></b> </h5><br>  ‚ÄúDrawn‚Äù machines continue to consume resources: even being inactive, they take up space in the storage system, some of them are distracted by the processor - and yet these resources are sometimes not enough for the operation of important and necessary applications!  It is likely that as a result, the company will have to spend a serious amount on additional storage.  For the case of a data center in 1000 virtual machines, the possible financial losses from VM Sprawl are estimated at several tens of thousands of dollars per year (see the <a href="http://www.vmware.com/resources/techresources/10339">VMware article</a> ). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In addition, ‚Äúvirtual garbage‚Äù carries a threat to information security, since forgotten ‚Äúvirtual machines‚Äù may fall out of regular maintenance processes: installing patches, updating anti-virus databases, changing group policies, etc. <br><br><h5>  <b><i>Is it possible to somehow deal with VM sprawl?</i></b> </h5><br>  The answer is yes.  For example, the Veeam Availability Suite, in particular, its component Veeam ONE, includes more than 80 reports on VMware and Hyper-V infrastructures, as well as on the Veeam backup infrastructure.  Among them are those that allow to reveal the <s>hidden threat of</s> signs of uncontrolled growth of the number of virtual machines and provide recommendations for effective planning and allocation of resources.  About them will be discussed below. <br><img src="https://habrastorage.org/files/377/04b/cd9/37704bcd97f64351a519dde33309d680.png"><br><br><h5>  <b><i>‚ÄúEverything has gone somewhere, nothing is left ...‚Äù</i></b> </h5><br>  To assess the current situation, we will use the capabilities of the Veeam Availability Suite, designed to plan and forecast the use of storage, memory and processor resources. <br><br>  Let's take a look at <b>Capacity Planning</b> Dashboards, and lack of space (or memory, or both) will make you think hard - do you need to make an urgent request for purchasing additional storage right now or can you still ‚Äúlive until tomorrow‚Äù? <br><img src="https://habrastorage.org/files/218/d6d/81c/218d6d81c6d1498186820a4f47e7ddaa.png"><br><br><h5>  <b><i>"Calm, only calm!"</i></b> </h5><br>  Let's <s>not get depressed</s> see how instead of ‚Äúknocking out‚Äù additional funding, you can, on the contrary, help the company save money by following 5 simple steps to rationalize the use of existing resources. <br><br><h5>  <b><i>Step number 1 Calculate the "zombies"</i></b> </h5><br>  Let us call them so for brevity - although they don‚Äôt ‚Äúdevour the brain‚Äù, they ‚Äú <s>take it out</s> ‚Äù consume disk space and other vital infrastructure resources.  These are virtual machines that are completely or almost not at all used, it is not clear why, as opposed to useful and in demand. <br>  <b>a)</b> Run the <b>Idle VMs</b> report and get a list of such virtual machines, and here we decide what to do with them: turn off, reduce the resources allocated to them or give them to other tasks.  Before launching the report, do not forget to specify the parameters: <br>  - for what period of time we want to see the data <br>  - exactly which values ‚Äã‚Äãwill be considered as a resource utilization threshold (processor, memory, disk space, network) <br>  - how much time (in% of the selected interval) the car must spend in the Idle state to get into the report <br><img src="https://habrastorage.org/files/14a/4bb/788/14a4bb788f1e4ece8257789605dc9d4b.png"><br><br>  <b>b)</b> To search for virtual machine templates, use the <b>Idle Templates</b> report, and as the report parameter set the time of the last use of the template. <br><br>  At the exit, we get a list of "orphan" objects with an indication of the size and location - these templates can be deleted or migrated to a larger space. <br><img src="https://habrastorage.org/files/ede/fce/6f0/edefce6f01f14232a24a5eae0d0db70e.png"><br><br>  <b>c)</b> Using the <b>Inefficient Datastore Usage</b> report on inefficiently used disk space, <b>we</b> investigate ‚Äúzombies‚Äù (barely living virtual machines) - we immediately see where these machines are located, when they were last used and how much space they took. <br><img src="https://habrastorage.org/files/d89/3d9/61a/d893d961aa554c1c834b1900e3b71825.png"><br><br><h5>  <b><i>Step number 2.</i></b>  <b><i>Find extra backups</i></b> </h5><br>  What if the <b>Capacity Planning for Backup Repository</b> report shows that a place in the backup repository is running out? <br><br>  We recommend that you check if any machines are included in multiple backup jobs at once.  To do this, run the <b>VMs Backed Up by Multiple Jobs</b> report and see who and where the backups of such machines are stored. <br><img src="https://habrastorage.org/files/dca/171/c0d/dca171c0de0742d7849bcdf95f5f5253.png"><br><br><h5>  <b><i>Step number 3 Remove the "garbage"</i></b> </h5><br>  The accumulating "garbage" is a side effect of the life of the virtual infrastructure, that is, a multitude of changes occurring in it every day.  Temporary virtual machine files and configuration files can continue to exist on the storage system after the parent objects have been deleted - and this is an additional expense of disk space. <br><br>  Here the report <b>Garbage Files</b> helps - it determines which objects are no longer used, and where are the corresponding files, "waste". <br><img src="https://habrastorage.org/files/273/2f9/968/2732f99684494689be503de325d593ca.png"><br><br><h5>  <b><i>Step # 4 Apply categorization</i></b> </h5><br>  A useful option of the Veeam Availability Suite is also the ability to group infrastructure objects using business criteria.  What is it and how will it help defeat the uncontrolled increase in the number of cars?  Everything is very simple - for virtual machines we specify their ‚Äúorganizational data‚Äù: which department uses, on which project, in what capacity, etc., etc.  If necessary, select the appropriate category in the view and perform a mass operation. <br><br>  Suppose the R &amp; D department involved a number of virtual machines to work on the <i>Temp</i> project ‚Äî after the completion of the project, we review the list of these machines and delete unnecessary ones. <br><img src="https://habrastorage.org/files/354/f04/35c/354f0435c6e342918495b2d6af46e729.png"><br><br><h5>  <b><i>Step number 5 Find unnecessary snapshots</i></b> </h5><br>  It would seem, what have the snapshots, if we are talking about saving resources, redundant virtual machines and the like?  In fact, an excessive amount of snapshots also negatively affects the infrastructure, so we recommend including this step in the process of dealing with the VM sprawl problem. <br><br>  Consider a situation where snapshot ‚Äúdrops out‚Äù of the virtual machine snapshot chain - this can happen when the host crashes, fails when snapshots are consolidated or if the backup is not correctly created.  Such an orphaned snapshot, however, continues to occupy disk space. <br><br>  By the way, <a href="http://kb.vmware.com/kb/1025279">VMware recommends</a> monitoring the length of the snapshot chain of a virtual machine: it should consist of no more than 3 snapshots, the usage time of each should be no more than 3 days. <br><br>  Let's try to build our own <b>Custom Infrastructure</b> report, specifying a virtual machine and a virtual disk as an object type, and properties that are of interest to snapshots as properties we are interested in.  To do this, in the <b>Select Columns</b> dialog, select <b>Name, VMDK file, Virtual Disk: Label, Snapshot: File name, Snapshot: File size</b> . <br><br>  Then set the <b>Custom Filter</b> value <b>filter</b> as an expression: <i>VMDK file - Contains - 0000</i> . <br><img src="https://habrastorage.org/files/f3d/1fc/252/f3d1fc2525524a2bbb2e1fe423d36eff.png"><br><br>  At the output, we get a list of "orphan" snapshots detected in our VMware-infrastructure. <br><img src="https://habrastorage.org/files/7ad/0be/699/7ad0be69901448d3915c584753a1ac50.png"><br><br>  <i>For more detailed instructions on generating such a report, welcome to the Veeam Knowledge Base: <a href="http://www.veeam.com/kb1757">KB1757: Using Veeam ONE Reporter for Detecting Orphaned Snapshots in VMware</a></i> . <br><br>  It is also useful to monitor the age of snapshots, for which we use the <b>Active Snapshots</b> report.  It shows which snapshots are the largest and which ones are the oldest (most likely, you will hardly need to roll back the virtual machine to such an old state). <br><img src="https://habrastorage.org/files/f8a/52c/379/f8a52c37902847b1912c786e3d9e0916.png"><br><br><h5>  <b><i>In conclusion, useful advice</i></b> </h5><br>  In order to simplify the task of dealing with VM sprawl, I advise you to create a special folder for the above-mentioned reports in Veeam ONE Reporter, name it, say, <b>VM Sprawl Control</b> , and put the whole ‚Äúmagnificent seven‚Äù in it.  When you first generate a report, you need to remember to specify the required parameters and threshold values ‚Äã‚Äã(where they exist), and then you can set up automatic generation of the entire report folder on a schedule and delivery by mail (see the first picture at the beginning of this article). <br><br><h5>  <b><i>Additional links:</i></b> </h5><br><ul><li>  <a href="http://www.veeam.com/deduplication-vmware-backup-sprawl.html">Top 7 VMware Management Challenges</a> Article </li><li>  <a href="http://www.veeam.com/ru/one-vmware-hyper-v-monitoring-reporting.html">Overview of all the monitoring and reporting functions of the Veeam Availability Suite</a> </li><li>  A rough estimate of the cost of VM Sprawl can be found in the VMware document <a href="http://www.vmware.com/resources/techresources/10339">‚ÄúControlling Virtual Machine Sprawl‚Äù</a> </li><li>  <a href="http://www.veeam.com/blog/5-hints-to-control-vm-sprawl-with-veeam-availability-suite.html">Original post in English.</a>  <a href="http://www.veeam.com/blog/5-hints-to-control-vm-sprawl-with-veeam-availability-suite.html">lang</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/238167/">https://habr.com/ru/post/238167/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../238157/index.html">TicketEasy - two tickets in the first row</a></li>
<li><a href="../238159/index.html">Probabilistic law of the distribution of the duration of the session of the satellite with a ground object</a></li>
<li><a href="../238161/index.html">Is it possible to consider the intellect artificial in the film "Superiority"</a></li>
<li><a href="../238163/index.html">Almost complete ruby ‚Äã‚Äãgems writing guide</a></li>
<li><a href="../238165/index.html">"Roskomnadzor" entered "Habrahabr" in the register of information dissemination organizers</a></li>
<li><a href="../238169/index.html">Startup Guide, Part 6: Too Little Investment - How Much? And too much?</a></li>
<li><a href="../238171/index.html">Understanding Monads with Javascript</a></li>
<li><a href="../238173/index.html">Google Play Books are now available in Ukraine, Estonia, Latvia and Lithuania.</a></li>
<li><a href="../238175/index.html">The term of transfer of servers with personal data to Russia is reduced</a></li>
<li><a href="../238179/index.html">How do we write a web service for a billion users</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>