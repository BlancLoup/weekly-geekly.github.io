<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unit Tests in ABAP. Part Three Every kind of fuss</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is focused on ABAP developers in SAP ERP systems. It contains many platform-specific points that are of little interest or even controver...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unit Tests in ABAP. Part Three Every kind of fuss</h1><div class="post__text post__text-html js-mediator-article">  <i>This article is focused on ABAP developers in SAP ERP systems.</i>  <i>It contains many platform-specific points that are of little interest or even controversial for developers using other platforms.</i> <br><br>  This is the third part of the publication.  You can read the beginning here: <br>  <a href="http://habrahabr.ru/post/273427/">Unit Tests in ABAP.</a>  <a href="http://habrahabr.ru/post/273427/">Part one.</a>  <a href="http://habrahabr.ru/post/273427/">First test</a> <br>  <a href="http://habrahabr.ru/post/273569/">Unit Tests in ABAP.</a>  <a href="http://habrahabr.ru/post/273569/">Part two.</a>  <a href="http://habrahabr.ru/post/273569/">Rake</a> <br><br><h2>  We will be measured </h2><br>  It is believed that the main metric of quality tests is the coating.  On the development web, you can often find formulations in the ‚Äúfull coverage‚Äù style.  As a rule, the full coverage is understood as a certain absolute in 100.00%. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The percentage of coverage is a dubious figure, just as dubious as the ‚Äúaverage hospital temperature‚Äù.  The percentage of coverage for the project is the average coverage of its parts.  That is: Module-1 has a coverage of 80%, Module-2 has a coating of 20%, on average, coverage will be 50%, assuming that the modules are approximately equal in content.  Is it true that 80% is four times better than 20%? <br><a name="habracut"></a><br>  The average is different.  ABAP UNIT has three different coverage metrics: <br><br><ul><li>  on procedures (procedure coverage) </li><li>  statement statements </li><li>  by branch (branch coverage) </li></ul><br>  For example, there is a class, function group, or subroutine pool: <br><br><pre><code class="hljs swift">form do_something. <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = a. d = b. endform. form do_something_else. <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a &gt; b. <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = a. d = a. <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = b. d = b. <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> d &gt; <span class="hljs-number"><span class="hljs-number">1000</span></span>. d = <span class="hljs-number"><span class="hljs-number">1000</span></span>. endif. endif. endform. form do_nothing. <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = d = <span class="hljs-number"><span class="hljs-number">0</span></span>. endif. endform.</code> </pre> <br>  <i>Nb.</i>  <i>A subroutine pool is easier to demonstrate than a group of functions or a class with methods.</i>  <i>A subroutine pool is described by a significantly smaller number of letters than a class.</i>  <i>Parameters are beyond definitions.</i>  <i>As part of this small demonstration, there is no significant difference.</i>  <i>And in general: all variables are fictional, any coincidences with the productive code are random</i> . <br><br>  And suppose we wrote one simple test for each subroutine, function, method.  For all subroutines we will use the values ‚Äã‚Äã[A = 7, B = 77]. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> lcl_test definition <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> testing duration short risk <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> harmless. private section. methods: setup. methods: do_something <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> testing. methods: do_something_else <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> testing. methods: do_nothing <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> testing. endclass. <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> lcl_test implementation. <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> setup. a = <span class="hljs-number"><span class="hljs-number">7.</span></span> b = <span class="hljs-number"><span class="hljs-number">77.</span></span> endmethod. <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> do_something. <span class="hljs-keyword"><span class="hljs-keyword">perform</span></span> do_something. endmethod. <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> do_something_else. <span class="hljs-keyword"><span class="hljs-keyword">perform</span></span> do_something_else. endmethod. <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> do_nothing. <span class="hljs-keyword"><span class="hljs-keyword">perform</span></span> do_nothing. endmethod. endclass.</code> </pre><br>  <i>NB: Let there be a general initialization for the time being, and let us check the result</i> . <br><br><h4>  Procedure coverage </h4><br>  This is the easiest case, you can count on the fingers.  Coverage for procedures will be 100% = (1 + 1 + 1) / (1 + 1 + 1) * 100. <br><br><h4>  Statement coverage </h4><br>  And if for the same procedures we count the number of instructions? <br><br>  Each procedure contains a different number of instructions.  And with the given input parameters, not all instructions will be called: <br><br><ul><li>  DO_SOMETHING: fulfilled three instructions from three </li><li>  DO_SOMETHING_ELSE: completed five instructions out of eight </li><li>  DO_NOTHING: completed two instructions out of three </li></ul><br>  The instructions are considered simple: the usual instructions, the procedure itself is considered an instruction, the condition is considered an instruction.  The ENDIF condition termination construct is not considered an instruction, because it only determines the place of transition, but is not related to any calculations or actions. <br><br>  If we calculate the metric according to the instructions, then it will be 71% = (3 + 5 + 2) / (3 + 8 + 3) * 100. <br><br>  Consider the work of a metric on DO_SOMETHING_ELSE.  ABAP development tools can color source lines according to metrics: <br><br><img src="https://habrastorage.org/files/670/a1f/dc8/670a1fdc8ed949378fd7eea5ea4f1578.png"><br><br>  Visually, quickly, clearly.  Just amazing, did not even expect this from ABAP. <br><br>  From this coloring it becomes obvious that if we took other initial parameters, the percentage of coverage could be different.  In the case of [A = 77, B = 7]: <br><br><img src="https://habrastorage.org/files/733/c84/ee8/733c84ee8ee94976b0e8458ba3642e7c.png"><br><br>  In this case, it becomes obvious that full coverage on this metric can only be achieved using more than one test scenario.  For example, with two tests [A = 77, B = 7] and [A = 7, B = 7777], everything will turn green: <br><br><img src="https://habrastorage.org/files/98e/d7e/75b/98ed7e75bee349abacf7dd927db309e2.png"><br><br>  Thus, the metric goes 100%.  You can calm down for a while. <br><br><h4>  Branch coverage </h4><br>  This metric works a little harder.  It takes all the instructions that can cause branching, and checks them for the fact that each such instruction is executed in both directions. <br><br>  Let's look at the base of the last example: <br><br>  The first instruction [IF A&gt; B] on two tests worked two times: once with TRUE [A = 77, B = 7] and once with FALSE [A = 7, B = 7777]. <br><br>  But the second instruction [IF D&gt; 1000] worked only once for TRUE [A = 7, B = 7777]. <br><br>  The function call itself is considered an unconditional unit, plus the first IF gives two of the two, the second IF gives only one of the two.  So our metric will be equal to 80% = (1 + 2 + 1) / (1 + 2 + 2) * 100. <br><br>  And here it already comes out that for one function the two tests are not enough, but you need three.  To the previous two, you can also add a script [A = 7, B = 77], so that the second IF works on FALSE. <br><br>  After adding the third script, the metric for this function is 100%. <br><br>  And what about DO_NOTHING, you ask?  There is no such test that the metric for branches or instructions is 100%.  Obviously, the function requires refactoring, without which it will not be possible to reach the full coverage.  This function should either be removed, or it should be converted from DO_NOTHING to DO_SOMETHING_COMPLETELY_DIFFERENT. <br><br><h4>  One hundred percent! </h4><br>  It is a pity you can not write more tests and get more than 100%. <br><br>  It is clear that the metrics of Procedure coverage is less revealing in details.  It is possible to look closely at it only at the early stages, if the code is many and there are almost no tests yet.  But which of the two remaining metrics look after?  If the first metric just shows how widely you have covered the functionality, the latter show how well you have covered it. <br><br>  As you noticed, you can get 100% of the instructions, but it will not be 100% of the branches.  But not the other way around (or I can‚Äôt think of such an example).  If you already received 100% of the branches, it means you went to all the back streets and all the instructions worked.  But it may seem to someone that the metric on branches gives less exponential weights on average, since it ignores one of the obvious weights, the number of lines of code, that is, the number of instructions. <br><br>  BTW: Yes, an empty procedure gives 100% performance! <br><br><h2>  Persuasion is persuasion </h2><br><br>  For ABAP Unit work it does not matter: <br><br><ul><li>  how many test classes do you have at all; </li><li>  what is the name of the test class; </li><li>  where it is located; </li><li>  as his methods are called. </li></ul><br>  The main thing is that the local class: <br><br><ul><li>  was available; </li><li>  had the nickname ‚Äúfor testing‚Äù; </li><li>  had methods called ‚Äúfor testing‚Äù. </li></ul><br>  But, on the other hand, even the names of variables are also not a random set of letters. <br><br>  Consequently, we should have some general conditional agreement on each item, which facilitates the general perception of the picture.  Like a naming or formatting convention. <br><br><h4>  What? </h4><br>  Test classes should be exactly as much as needed.  At a minimum, each large object (group of functions, program, class) should have one test class, more. <br><br>  If you have a simple group of several related functions, then one class is enough for it.  But if in your group there are six packs of loosely coupled functions, then the question here should rather be ‚ÄúHow many groups of functions should there be?‚Äù, And this is a topic for a completely different conversation. <br><br>  After correctly answering this question, you can take the SETUP method as a criterion for divisibility.  Such a method in the class should be one, it is automatically called before each test method. <br><br>  Each script should give a separate test method, the name of the method should be directly derived from the code being tested. <br><br><h4>  Where? </h4><br>  One of the principles of unit testing: a test class should test only the code in the jurisdiction of which it is located.  And although the tests can be anywhere in the source code, it is worthwhile to separate the working functionality from the tests. <br><br>  Here is a wizard for groups of functions that creates a separate include program using a predefined pattern: for example: LZFI_BTET99 for the function group ZFI_BTE.  I do not see anything wrong with this, I must take it as a model and continue in the same vein. <br><br>  Also in programs of the type REPORT: write tests strictly in one separate include-program, with a name by pattern. <br><br>  However, I can not forbid anyone to write everything mixed: the code, its test, the code, its test ... <br><br><h4>  When? </h4><br>  You cannot run the full cycle of unit tests every five minutes.  But, at least, before releasing the request, it is necessary to run the test of the involved objects. <br><br><h2>  Summarize </h2><br>  Just a pack of abstracts to summarize: <br><br><ul><li>  You can live with it. </li><li>  The test code is more productive code. </li><li>  In many cases, TDD approaches are justified and recommended for use. </li><li>  A review of the existing productive code without tests causes a significant strain on the brain convolutions. </li><li>  If you try to cover the already written code with tests, then often you can‚Äôt do without refactoring.  And refactoring is a slightly different and more difficult task than the test coverage itself.  Refactoring can be postponed until you do something else with the code. </li><li>  If you have a productive code that does not change for years, then it should be covered with tests in the last place. </li><li>  The code may remain uncovered due to a closed loop: You cannot do the right tests, because you first need to do a serious refactoring, and it is not recommended to do refactoring until there are no tests. </li><li>  In some cases, test coverage fails.  It happens.  Humble yourself. </li><li>  For some metrics, counting the completeness of coverage is much easier to achieve 100% than for others.  This does not mean that it should be done as it is easier. </li><li>  I did not notice the tests in the standard system code, and if they were, then they would be forbidden to perform. </li></ul><br>  In the bustle, do not forget the main thing: tests are not an end in themselves.  Everything must be of benefit. <br><br>  The real real benefit of the tests will be only in those moments when, over time, the tests will fail, when someone completes this functionality. <br><br>  Because the ability to properly fall - the best way to avoid injury.  If this is true for karatekas and cyclists, then it will also be useful for programmers.  It is better to fall down, badly pedaling, than to fall down, while pedaling well.  The ability to properly fall more important than the correct equipment. <br><br>  And right now, you can only extract indirect benefits: <br><br><ul><li>  Tests document usage scenarios </li><li>  Tests help identify places that need attention (refactoring) </li><li>  Tests help to perform basic checks on sites that are difficult to test manually. </li></ul><br>  For today, until we meet again. </div><p>Source: <a href="https://habr.com/ru/post/274181/">https://habr.com/ru/post/274181/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../274171/index.html">Kaggle and Titanic - another solution using Python</a></li>
<li><a href="../274173/index.html">Underground carders market. Translation of the book "KingPIN". Chapter 29. ‚ÄúOne Plat and Six Classics‚Äù</a></li>
<li><a href="../274175/index.html">Fourier transform boundedness or why you should trust your hearing</a></li>
<li><a href="../274177/index.html">12 best overseas developer conferences in 2016</a></li>
<li><a href="../274179/index.html">OpenOCD, GDB and (strongly) remote debugging</a></li>
<li><a href="../274183/index.html">How I searched (and found) the difference in two byte-identical files.</a></li>
<li><a href="../274185/index.html">Diagnosing and fixing memory leaks in TypeScript applications</a></li>
<li><a href="../274187/index.html">Development Environment: Redmine + Git + ownCloud</a></li>
<li><a href="../274189/index.html">Does your site have problems with Google?</a></li>
<li><a href="../274191/index.html">New Year's check .NET Core Libraries (CoreFX)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>