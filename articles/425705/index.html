<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Replication from Percona Server for MySQL to PostgreSQL using the pg_chameleon tool</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Replication is one of the well-known functions that allow you to create an identical copy of the database. It is supported in virtually any relational...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Replication from Percona Server for MySQL to PostgreSQL using the pg_chameleon tool</h1><div class="post__text post__text-html js-mediator-article"><p>  Replication is one of the well-known functions that allow you to create an identical copy of the database.  It is supported in virtually any relational database management system (RDBMS).  The ability to replicate provides significant benefits, especially high availability and load sharing.  But what if replication is required between two databases (DB) with different structure, such as MySQL and PostgreSQL?  Is it possible to continuously replicate changes from a MySQL database to a PostgreSQL database?  The answer to this question is the replication tool <a href="http://www.pgchameleon.org/">pg_chameleon</a> . </p><br><p><img src="http://telegramfor.me/ext_img/catops/757" alt="image"></p><a name="habracut"></a><br><p>  For continuous replication of changes, pg_chameleon uses the MySQL replication library, which allows you to get logical copies of rows from a MySQL database that are converted to a jsonb object.  The pl / pgsql function in Postgres decodes the jsonb object and reproduces the changes in the Postgres database.  To configure this type of replication, the binlog_format variable for the MySQL database must be ROW (string). </p><br><h3 id="neskolko-momentov-kotorye-sleduet-znat-do-nastroyki-etogo-instrumenta">  A few things to know before setting up this tool: </h3><br><ol><li>  Tables that need to be replicated must have a primary key. </li><li>  The tool works on PostgreSQL versions above 9.5 and MySQL systems above 5.5 </li><li>  To set up such replication, the binlog_format variable must be set to ROW. </li><li>  Python version must be higher than 3.3 </li></ol><br><p>  When replication starts, pg_chameleon receives data from MySQL in CSV format with grouping into groups of a certain length in order to avoid memory overload.  This data is reset to Postgres with the COPY command (copy).  If the copy fails, the INSERT (paste) command is executed, which can slow down the process.  If the INSERT command fails, the string is lost. </p><br><p>  To replicate changes from MySQL, pg_chameleon simulates the behavior of a replica (slave) of MySQL.  This creates a schema in Postgres, performs initial data loading, connects to the MySQL replication protocol, copies of rows are stored in the Postgres table.  At the same time, the corresponding Postgres functions provide decoding of strings and making changes.  This is similar to storing transfer logs in Postgres tables and applying them to the Postgres schema.  Creating a Postgres database schema using any data description languages ‚Äã‚Äãis not required.  For tables specified during replication setup, the pg_chameleon tool does this automatically.  If you need to convert any types in a specific way, you can specify this in the configuration file. </p><br><p>  The following is an exercise that can be experimented with.  Use the suggested options if it fully meets your requirements.  We carried out such tests on CentOS Linux OS version 7.4. </p><br><h2 id="podgotovka-sredy">  Environment preparation </h2><br><h3 id="nastroyte-sistemu-percona-server-for-mysql">  Configure Percona Server for MySQL </h3><br><p>  Install MySQL version 5.7 and add the appropriate parameters for replication. </p><br><p>  In this exercise, I installed Percona Server for MySQL version 5.7 using the YUM repository. </p><br><pre><code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> <span class="hljs-keyword"><span class="hljs-keyword">http</span></span>://www.percona.com/downloads/percona-<span class="hljs-keyword"><span class="hljs-keyword">release</span></span>/redhat/<span class="hljs-number"><span class="hljs-number">0.1</span></span><span class="hljs-number"><span class="hljs-number">-6</span></span>/percona-<span class="hljs-keyword"><span class="hljs-keyword">release</span></span><span class="hljs-number"><span class="hljs-number">-0.1</span></span><span class="hljs-number"><span class="hljs-number">-6.</span></span>noarch.rpm yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> Percona-<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span><span class="hljs-number"><span class="hljs-number">-57</span></span> echo <span class="hljs-string"><span class="hljs-string">"mysql ALL=(ALL) NOPASSWD: ALL"</span></span> &gt;&gt; /etc/sudoers usermod -s /<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/bash mysql sudo su - mysql</code> </pre> <br><p>  Pg_chameleon requires configuration of the following parameters in the my.cnf file (file with MySQL server parameters).  You can add the following parameters to the /etc/my.cnf file </p><br><pre> <code class="hljs pgsql">binlog_format= <span class="hljs-keyword"><span class="hljs-keyword">ROW</span></span> binlog_row_image=<span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">log</span></span>-bin = mysql-bin <span class="hljs-keyword"><span class="hljs-keyword">server</span></span>-id = <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><p>  Now, after including the above parameters in the my.cnf file, start the MySQL server. </p><br><pre> <code class="hljs pgsql">$ service mysql <span class="hljs-keyword"><span class="hljs-keyword">start</span></span></code> </pre> <br><p>  Obtain a temporary password for the root account from the mysqld.log file and reset the root password using the mysqladmin command. </p><br><pre> <code class="hljs pgsql">$ grep "temporary" /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/mysqld.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> $ mysqladmin -u root -p <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> <span class="hljs-string"><span class="hljs-string">'Secret123!'</span></span></code> </pre> <br><p>  Now connect to your own MySQL database instance and create a sample schema / tables.  I also created an emp table for validation. </p><br><pre> <code class="hljs ruby">$ wget <span class="hljs-symbol"><span class="hljs-symbol">http:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/downloads.mysql.com/docs</span></span><span class="hljs-regexp"><span class="hljs-regexp">/sakila-db.tar.gz $ tar -xzf sakila-db.tar.gz $ mysql -uroot -pSecret123! &lt; sakila-db/sakila</span></span>-schema.sql $ mysql -uroot -pSecret123! &lt; sakila-db/sakila-data.sql $ mysql -uroot -pSecret123! sakila -e <span class="hljs-string"><span class="hljs-string">"create table emp (id int PRIMARY KEY, first_name varchar(20), last_name varchar(20))"</span></span></code> </pre> <br><p>  Create a user to configure replication using the pg_chameleon tool and grant it permissions by following the steps below. </p><br><pre> <code class="hljs sql">$ mysql -uroot -p <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> <span class="hljs-string"><span class="hljs-string">'usr_replica'</span></span>@<span class="hljs-string"><span class="hljs-string">'%'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">identified</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-string"><span class="hljs-string">'Secret123!'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">GRANT</span></span> ALL <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> sakila.* <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> <span class="hljs-string"><span class="hljs-string">'usr_replica'</span></span>@<span class="hljs-string"><span class="hljs-string">'%'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">GRANT</span></span> RELOAD, <span class="hljs-keyword"><span class="hljs-keyword">REPLICATION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CLIENT</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">REPLICATION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SLAVE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> *.* <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> <span class="hljs-string"><span class="hljs-string">'usr_replica'</span></span>@<span class="hljs-string"><span class="hljs-string">'%'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">FLUSH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRIVILEGES</span></span>;</code> </pre> <br><p>  When creating a user on the MySQL server ('usr_replica' @ '%'), it may be necessary to replace the ‚Äú%‚Äù symbol with the corresponding IP address or host name of the server that pg_chameleon is running on. </p><br><h3 id="nastroyte-postgresql">  Configure PostgreSQL </h3><br><p>  Install PostgreSQL and run a copy of the database. </p><br><p>  To install PostgreSQL version 10.x, follow these steps. </p><br><pre> <code class="hljs pgsql">yum install https://yum.postgresql.org/<span class="hljs-number"><span class="hljs-number">10</span></span>/redhat/rhel<span class="hljs-number"><span class="hljs-number">-7.4</span></span>-x86_64/pgdg-centos10<span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-2.</span></span>noarch.rpm yum install postgresql10* su - postgres $/usr/pgsql<span class="hljs-number"><span class="hljs-number">-10</span></span>/bin/initdb $ /usr/pgsql<span class="hljs-number"><span class="hljs-number">-10</span></span>/bin/pg_ctl -D /var/lib/pgsql/<span class="hljs-number"><span class="hljs-number">10</span></span>/data <span class="hljs-keyword"><span class="hljs-keyword">start</span></span></code> </pre> <br><p>  As you can see from the following logs, you need to create a user in PostgreSQL, with which pg_chameleon will be able to write the changed data to PostgreSQL.  Also create a target database. </p><br><pre> <code class="hljs pgsql">postgres=# <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">USER</span></span> usr_replica <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ENCRYPTED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PASSWORD</span></span> <span class="hljs-string"><span class="hljs-string">'secret'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROLE</span></span> postgres=# <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> db_replica <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OWNER</span></span> usr_replica; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span></code> </pre> <br><h2 id="etapy-ustanovki-i-nastroyki-replikacii-s-ispolzovaniem-pg_chameleon">  Steps for installing and configuring replication using pg_chameleon </h2><br><p>  <b>Step 1.</b> In this exercise, I installed the Python language interpreter version 3.6 and pg_chameleon version 2.0.8 by performing the following steps.  If you already have the necessary version of the Python interpreter installed, you can skip the steps to install it.  We can create a virtual environment if the OS does not include Python version 3.x by default. </p><br><pre> <code class="hljs bash">yum install gcc openssl-devel bzip2-devel wget <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /usr/src wget https://www.python.org/ftp/python/3.6.6/Python-3.6.6.tgz tar xzf Python-3.6.6.tgz <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> Python-3.6.6 ./configure --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-optimizations make altinstall python3.6 -m venv venv <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> venv/bin/activate pip install pip --upgrade pip install pg_chameleon</code> </pre> <br><p>  <b>Step 2.</b> This tool requires a configuration file that stores information about the source and target servers, and a folder for storing logs.  To make the pg_chameleon tool create a configuration file template and corresponding folders, use the following command. </p><br><pre> <code class="hljs ruby">$ chameleon set_configuration_files</code> </pre> <br><p>  When executing this command, the following results are displayed.  They show that this command has created several folders and files in the place from which you started it. </p><br><pre> <code class="hljs pgsql">creating directory /var/lib/pgsql/.pg_chameleon creating directory /var/lib/pgsql/.pg_chameleon/<span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span>/ creating directory /var/lib/pgsql/.pg_chameleon/logs/ creating directory /var/lib/pgsql/.pg_chameleon/pid/ copying <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> example <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> /var/lib/pgsql/.pg_chameleon/<span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span>//config-example.yml</code> </pre> <br><p>  Copy the sample configuration file to another file, say, default.yml </p><br><pre> <code class="hljs pgsql">$ cd .pg_chameleon/<span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span>/ $ cp config-example.yml <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.yml</code> </pre> <br><p>  This is what my default.yml file looks like after including all the necessary parameters.  In this file, you can optionally specify data type conversion, tables that should be skipped during replication, and data manipulation language events that should be ignored for the selected list of tables. </p><br><pre> <code class="hljs kotlin">--- #global settings pid_dir: <span class="hljs-string"><span class="hljs-string">'~/.pg_chameleon/pid/'</span></span> log_dir: <span class="hljs-string"><span class="hljs-string">'~/.pg_chameleon/logs/'</span></span> log_dest: file log_level: info log_days_keep: <span class="hljs-number"><span class="hljs-number">10</span></span> rollbar_key: <span class="hljs-string"><span class="hljs-string">''</span></span> rollbar_env: <span class="hljs-string"><span class="hljs-string">''</span></span> # type_override allows the user to <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> type conversion into a different one. type_override: <span class="hljs-string"><span class="hljs-string">"tinyint(1)"</span></span>: override_to: boolean override_tables: - <span class="hljs-string"><span class="hljs-string">"*"</span></span> #postgres destination connection pg_conn: host: <span class="hljs-string"><span class="hljs-string">"localhost"</span></span> port: <span class="hljs-string"><span class="hljs-string">"5432"</span></span> user: <span class="hljs-string"><span class="hljs-string">"usr_replica"</span></span> password: <span class="hljs-string"><span class="hljs-string">"secret"</span></span> database: <span class="hljs-string"><span class="hljs-string">"db_replica"</span></span> charset: <span class="hljs-string"><span class="hljs-string">"utf8"</span></span> sources: mysql: db_conn: host: <span class="hljs-string"><span class="hljs-string">"localhost"</span></span> port: <span class="hljs-string"><span class="hljs-string">"3306"</span></span> user: <span class="hljs-string"><span class="hljs-string">"usr_replica"</span></span> password: <span class="hljs-string"><span class="hljs-string">"Secret123!"</span></span> charset: <span class="hljs-string"><span class="hljs-string">'utf8'</span></span> connect_timeout: <span class="hljs-number"><span class="hljs-number">10</span></span> schema_mappings: sakila: sch_sakila limit_tables: # - delphis_mediterranea.foo skip_tables: # - delphis_mediterranea.bar grant_select_to: - usr_readonly lock_timeout: <span class="hljs-string"><span class="hljs-string">"120s"</span></span> my_server_id: <span class="hljs-number"><span class="hljs-number">100</span></span> replica_batch_size: <span class="hljs-number"><span class="hljs-number">10000</span></span> replay_max_rows: <span class="hljs-number"><span class="hljs-number">10000</span></span> batch_retention: <span class="hljs-string"><span class="hljs-string">'1 day'</span></span> copy_max_memory: <span class="hljs-string"><span class="hljs-string">"300M"</span></span> copy_mode: <span class="hljs-string"><span class="hljs-string">'file'</span></span> out_dir: /tmp sleep_loop: <span class="hljs-number"><span class="hljs-number">1</span></span> on_error_replay: <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> on_error_read: <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> auto_maintenance: <span class="hljs-string"><span class="hljs-string">"disabled"</span></span> gtid_enable: No type: mysql skip_events: insert: # - delphis_mediterranea.foo #skips inserts on the table delphis_mediterranea.foo delete: # - delphis_mediterranea #skips deletes on schema delphis_mediterranea update:</code> </pre> <br><p>  <b>Step 3.</b> Create a replica (target database) using the command: </p><br><pre> <code class="hljs pgsql">$ chameleon create_replica_schema <span class="hljs-comment"><span class="hljs-comment">--debug</span></span></code> </pre> <br><p>  The above command creates the schema and nine tables in the PostgreSQL database specified in the .pg_chameleon / configuration / default.yml file.  These tables are required to manage replication from the source database to the target database.  The same can be seen in the next journal. </p><br><pre> <code class="hljs pgsql">db_replica=# \dn List <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">schemas</span></span> <span class="hljs-type"><span class="hljs-type">Name</span></span> | <span class="hljs-keyword"><span class="hljs-keyword">Owner</span></span> <span class="hljs-comment"><span class="hljs-comment">---------------+------------- public | postgres sch_chameleon | target_user (2 rows) db_replica=# \dt sch_chameleon.t_* List of relations Schema | Name | Type | Owner ---------------+------------------+-------+------------- sch_chameleon | t_batch_events | table | target_user sch_chameleon | t_discarded_rows | table | target_user sch_chameleon | t_error_log | table | target_user sch_chameleon | t_last_received | table | target_user sch_chameleon | t_last_replayed | table | target_user sch_chameleon | t_log_replica | table | target_user sch_chameleon | t_replica_batch | table | target_user sch_chameleon | t_replica_tables | table | target_user sch_chameleon | t_sources | table | target_user (9 rows)</span></span></code> </pre> <br><p>  <b>Step 4.</b> Add the source database data to pg_chameleon using the following command.  Specify the name of the source database as specified in the configuration file.  In this example, the source database name is mysql, and the target is Postgres database, defined as pg_conn. </p><br><pre> <code class="hljs mel">$ chameleon add_source --config <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">source</span></span> mysql --debug</code> </pre> <br><p>  After executing this command, you will see that the source database data is added to the t_sources table. </p><br><pre> <code class="hljs smalltalk">db_replica=# select * from sch_chameleon.t_sources; -[ <span class="hljs-type"><span class="hljs-type">RECORD</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> ]-------+---------------------------------------------- i_id_source | <span class="hljs-number"><span class="hljs-number">1</span></span> t_source | mysql jsb_schema_mappings | {<span class="hljs-comment"><span class="hljs-comment">"sakila"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"sch_sakila"</span></span>} enm_status | ready t_binlog_name | i_binlog_position | b_consistent | t b_paused | f b_maintenance | f ts_last_maintenance | enm_source_type | mysql v_log_table | {t_log_replica_mysql_1,t_log_replica_mysql_2} <span class="hljs-string"><span class="hljs-string">$ </span></span>chameleon show_status --config default <span class="hljs-type"><span class="hljs-type">Source</span></span> id <span class="hljs-type"><span class="hljs-type">Source</span></span> name <span class="hljs-type"><span class="hljs-type">Type</span></span> <span class="hljs-type"><span class="hljs-type">Status</span></span> <span class="hljs-type"><span class="hljs-type">Consistent</span></span> <span class="hljs-type"><span class="hljs-type">Read</span></span> lag <span class="hljs-type"><span class="hljs-type">Last</span></span> read <span class="hljs-type"><span class="hljs-type">Replay</span></span> lag <span class="hljs-type"><span class="hljs-type">Last</span></span> replay ----------- ------------- ------ -------- ------------ ---------- ----------- ------------ ------------- <span class="hljs-number"><span class="hljs-number">1</span></span> mysql mysql ready <span class="hljs-type"><span class="hljs-type">Yes</span></span> <span class="hljs-type"><span class="hljs-type">N</span></span>/<span class="hljs-type"><span class="hljs-type">AN</span></span>/<span class="hljs-type"><span class="hljs-type">A</span></span></code> </pre> <br><p>  <b>Step 5.</b> Initialize the replica (target database) using the following command.  Specify the source database from which changes are replicated to the PostgreSQL database. </p><br><pre> <code class="hljs mel">$ chameleon init_replica --config <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">source</span></span> mysql --debug</code> </pre> <br><p>  Initialization includes the following tasks on the MySQL server (source). </p><br><ol><li>  Clear the table cache and set a read-only lock </li><li>  Get the coordinates of the source database </li><li>  Copy the data </li><li>  Unlock </li></ol><br><p>  The above command automatically creates a schema of the target Postgres database. <br>  In the default.yml file, we mentioned the following schema mappings (schema_mappings). </p><br><pre> <code class="hljs">schema_mappings: sakila: sch_sakila</code> </pre> <br><p>  A new scott scheme is now created in the target database db_replica. </p><br><pre> <code class="hljs pgsql">db_replica=# \dn List <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">schemas</span></span> <span class="hljs-type"><span class="hljs-type">Name</span></span> | <span class="hljs-keyword"><span class="hljs-keyword">Owner</span></span> <span class="hljs-comment"><span class="hljs-comment">---------------+------------- public | postgres sch_chameleon | usr_replica sch_sakila | usr_replica (3 rows)</span></span></code> </pre> <br><p>  <b>Step 6.</b> Now start replication using the following command. </p><br><pre> <code class="hljs mel">$ chameleon start_replica --config <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">source</span></span> mysql</code> </pre> <br><p>  <b>Step 7:</b> Check replication status and errors using the following commands. </p><br><pre> <code class="hljs ruby">$ chameleon show_status --config default $ chameleon show_errors</code> </pre> <br><p>  Here is the state of replication: </p><br><pre> <code class="hljs delphi">$ chameleon show_status --source mysql Source id Source <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> Status Consistent <span class="hljs-keyword"><span class="hljs-keyword">Read</span></span> lag Last <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> Replay lag Last replay ----------- ------------- ------ -------- ------------ ---------- ----------- ------------ ------------- <span class="hljs-number"><span class="hljs-number">1</span></span> mysql mysql running No N/AN/A == Schema mappings == Origin schema Destination schema --------------- -------------------- sakila sch_sakila == Replica status == --------------------- --- Tables <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> replicated <span class="hljs-number"><span class="hljs-number">0</span></span> Tables replicated <span class="hljs-number"><span class="hljs-number">17</span></span> All tables <span class="hljs-number"><span class="hljs-number">17</span></span> Last maintenance N/A Next maintenance N/A Replayed rows Replayed DDL Skipped rows</code> </pre> <br><p>  Now you can see that the changes are constantly replicated from the MySQL database to the PostgreSQL database. </p><br><p>  <b>Step 8.</b> To verify, you can insert an entry into the MySQL database table that we created to verify replication in the Postgres database. </p><br><pre> <code class="hljs pgsql">$ mysql -u root -pSecret123! -e "INSERT INTO sakila.emp VALUES (1,'avinash','vallarapu')" mysql: [<span class="hljs-built_in"><span class="hljs-built_in">Warning</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">Using</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> the command <span class="hljs-type"><span class="hljs-type">line</span></span> interface can be insecure. $ psql -d db_replica -c "select * from sch_sakila.emp" id | first_name | last_name <span class="hljs-comment"><span class="hljs-comment">----+------------+----------- 1 | avinash | vallarapu (1 row)</span></span></code> </pre> <br><p>  The above log shows that the record inserted into the MySQL table was replicated to the table in the Postgres database. </p><br><p>  You can also add multiple source databases for replication to a Postgres target database. </p><br><p>  <a href="http://www.pgchameleon.org/documents/"><strong>Link</strong></a> </p><br><p>  From this documentation you can get information about the many additional features available in pg_chameleon. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/425705/">https://habr.com/ru/post/425705/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../425693/index.html">Search VPS 5 years! 70 hosters give discounts from 10 to 80%</a></li>
<li><a href="../425695/index.html">Reports about the battle of CI and CD, orchestration and secrets of OpenStack</a></li>
<li><a href="../425697/index.html">KotlinConf 2018 - keyout and first videos</a></li>
<li><a href="../425701/index.html">IoT Security Week 38: vulnerabilities in MikroTik, D-Link and TP-Link routers</a></li>
<li><a href="../425703/index.html">Kafka in Wargaming: a blitz</a></li>
<li><a href="../425707/index.html">Notification system from the console to Telegram</a></li>
<li><a href="../425709/index.html">We made a memo for the Chinese who came to you</a></li>
<li><a href="../425711/index.html">Losses in mismatched line</a></li>
<li><a href="../425713/index.html">Integration of HTML engine in native Windows application - choice and architecture</a></li>
<li><a href="../425715/index.html">Educational program in chemistry: acid reversing of microcircuits (how to expose a crystal of a microcircuit for its subsequent photographing)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>