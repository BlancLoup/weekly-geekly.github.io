<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Morrowind speedran planning using simulated annealing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Well, you and sleepyards, even yesterday‚Äôs storm did not wake you. They say we have already sailed to Morrowind. We will be released and allowed us to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Morrowind speedran planning using simulated annealing</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8b8/5d0/5d5/8b85d05d5f42076105e76a415ddc1685.png" alt="image"></div><br><blockquote>  Well, you and sleepyards, even yesterday‚Äôs storm did not wake you.  They say we have already sailed to Morrowind.  We will be released and allowed us to make a speedran, that's for sure! </blockquote><br><h2>  Introduction </h2><br>  There is the <a href="https://www.youtube.com/watch%3Fv%3DKBNxxM6AuW8">famous speedrow of the</a> main quest Morrowind, in which, in essence, the player moves to the end of the game, uses several scrolls and spells, and then kills the boss. <br><br>  However, there is no category of speedranes Morrowind, in which the player seeks to become the head of all factions.  Despite the love of critics and a great storyline, most of the quests of Morrowind are in the tasks ‚Äúbring a thing‚Äù or ‚Äúkill this type‚Äù, and there are not so many quests in which something else is needed.  But planning such a speedran route can still be extremely interesting for the following reasons: <br><a name="habracut"></a><br><ul><li>  There are 10 factions in Morrowind that can be entered into (Mages / Thieves / Fighters Guild, Imperial Cult, Imperial Legion, Temple of the Tribunal and Great Houses: Hlaalu, Redoran, Telvanni).  During the passage of the player can become a member of only one Great House, but still remains 8 factions. </li><li>  Transportation system  This is not just a matter of quickly moving to the right places that a player in Skyrim or Oblivion used.  It is also traveling using various means of transportation, including boats, caravans and teleportation spells, which <a href="https://kimonote.com/%40mildbyte/project-morrowind-part-1-410/">I investigated earlier</a> .  Walking is very actively used, and it is extremely important to manage the quest lines of the factions in order to avoid unnecessary travel to different cities. </li><li>  There are many ways to become the head of the faction.  In the quest lines of the factions, a rank enhancement system is used, in which new quest lines are opened when a character gains an increase in rank in the faction.  Raising depends not only on reputation points (which are given for completing quests), but also on player skills and attributes. </li><li>  The tasks of some quests can be completed in advance or performed in another way.  For example, if a quest-giving character wants a player to kill someone, then someone can often be killed before the quest begins, and in this case, the outstanding quest character will still give the player a reward.  However, sometimes this does not work and the player is inaccessible reputation points needed to open further quest lines.  Likewise, in most ‚Äúbring item‚Äù quests, the issuing quest tells you where the player can get the item, but he doesn‚Äôt care if it was purchased at a nearby store a few minutes ago. </li></ul><br>  Given all these features, the task can be very difficult.  On the way to the chosen goal of the quest, the player can pick up another quest or pick up an item that at some point may be necessary for the quest of another faction, of which he is not even a member.  What seems to be an effective route through all the quests of one faction may slow down the route when playing the game for all factions, because there may be points on this route that you still need to visit to complete the quests of other factions, and so on. <br><br>  In other words, planning an effective route with the passage for all factions will be an interesting task about automated data processing. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Note on Morrowind skill and level requirements </h2><br>  There are a couple of factions, the last quest of which can be completed immediately, but the result will be just a journal entry reporting that the player‚Äôs character is now the head of the faction (and this increase does not affect the character‚Äôs parameters).  I decided that instead I want to get to the top in the most honest way. <br><br>  Unlike Skyrim and Oblivion, the increase in Morrowind factions requires the player to have certain skills with a certain level.  Morrowind has 27 skills and each faction has 6 so-called ‚Äúpreferred skills.‚Äù  To become the head of the faction, the player must have a very high level of one of these skills (approximately 80-90 out of 100) and two of them - at an average level (approximately 30-35). <br><br>  In addition, Morrowind characters have 7 attributes, each of which "controls" several skills.  Attributes also affect rank enhancement in fractions. <br><br>  This is sad news for us, because in the speedran we will not have enough time to develop character skills.  However, the good news is that skills teachers are scattered around Morrowind who can, for a fee, instantly enhance these skills.  Sad news - these teachers will not be able to raise skills higher than the attributes that control them.  Increasing the levels requires increasing the levels, and this task in Morrowind has a <a href="http://en.uesp.net/wiki/Morrowind:Level">very long history</a> .  I will tell you about the strategy of raising the levels later. <br><br><h2>  Different routes for individual factions </h2><br>  I quickly got tired of pulling out the quests from the game files (because most of the quests are managed and updated with a multitude of interactive conditions and in-game scripts), so instead I used the <a href="http://en.uesp.net/wiki/Morrowind:Quests">Morrowind UESP quest page</a> and manually created several spreadsheets for each faction I entered into the quests given their reputation and their approximate requirements. <br><br>  Here is an example of one of these spreadsheets: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/47b/0f8/958/47b0f8958dc527df193c38abb80bdcb5.png"></div><br>  The complexity of the Morrowind factions is already clear from this table.  There are two intended ways to reach the top of the Mages Guild: gain enough reputation and skills to become a Master Wizard, complete all <a href="http://en.uesp.net/wiki/Morrowind:Edwinna_Elbert">Edwin Elbert</a> quests and challenge the Archmage to a duel, or complete all <a href="http://en.uesp.net/wiki/Morrowind:Skink-in-Tree%2527s-Shade">Skink-in-Shadow-Tree</a> quests and receive a letter from the management telling you the removal of the current Archmage.  Later I found another way - to reach the rank of the Wizard (one rank lower than the Master Wizard), and then talk to the Archmage about the duel, which turns out to be faster. <br><br>  In addition, there are many different ways to complete the quest.  In the last three quests of Edwinna Elbert, where the player is required to bring her gnome artifacts, it is actually not necessary to go to places recommended by her: you can get artifacts in other places or even buy them. <br><br><h3>  Generating all possible routes to pass the faction </h3><br>  ... turned out to be a challenge.  The first attempt was to encode each quest in the YAML file as a set of prerequisites and items / actions required to perform.  Here is an example: <br><br><pre><code class="cpp hljs">edwinna_2: giver: edwinna elbert prerequisites: rank: Conjurer quest: Chimarvamidium <span class="hljs-number"><span class="hljs-number">2</span></span> quests: - Dwemer Tube: rep: <span class="hljs-number"><span class="hljs-number">5</span></span> completion: items: misc_dwrv_artifact60 - Nchuleftingth: rep: <span class="hljs-number"><span class="hljs-number">10</span></span> completion: go_person: anes vendu ...</code> </pre> <br>  This is how the beginning of Edwinna Elbert‚Äôs quest line is coded - the <a href="http://en.uesp.net/wiki/Morrowind:Dwemer_Tube_from_Arkngthunch-Sturdumz">Dwemer pipe from Arkngtunch-Sturdumts</a> , which requires the player to become a Conjurer in the Guild and complete Edwinna‚Äôs previous quest.  To complete this quest, the player must have a tube in his inventory (I used the item's in-game ID).  Completing the quest gives the player 5 faction reputation points. <br><br>  The quest line is continued by the <a href="http://en.uesp.net/wiki/Morrowind:Nchuleftingth_Expedition">expedition to Nchuleftingt</a> , and in order to complete this quest, the player needs to get to a certain NPC (an archaeologist who, as it turns out, was dead).  Unlike the previous quest, this action (moving to the character and interacting with it) requires the player to start the quest first. <br><br>  Considering all this, we can generate a multitude of all possible ways of guild passing by using breadth-first search: <br><br><ul><li>  the set of all sequences of the passage of the guild S = empty </li><li>  perform: <br><ul><li>  for each sequence in S: <br><ul><li>  if she is already completing the guild, then ignore </li><li>  otherwise, get all possible next quests that can be completed in this sequence: <br><ul><li>  where the quest prerequisites are met (for example, the previous / necessary quest in the quest line is completed) </li><li>  where is enough reputation to start a new quest line </li></ul></li><li>  add each of these possible quests to the sequence to create several new sequences </li><li>  replace current sequence with new generated ones </li></ul></li></ul></li><li>  continue until S stops changing </li></ul><br><h3>  Combinatorial explosions, combinatorial explosions everywhere </h3><br>  What could go wrong?  Well, firstly, there is a problem with the order.  If a player juggles with two parallel quest lines from different quest issuing characters, each possible intersection is taken into account, which leads to a combinatorial explosion.  Secondly, routes are generated that are absolutely definitely worse than existing routes.  For example, if the passage of a certain guild requires us to complete only quests A, B, D, and E, then there is no point in generating route A, B, C, D, E: performing D will require additional time anyway. <br><br>  Therefore, I performed the pruning, making sure that during the generation we did not consider the sequence, if there is a superset of an already existing sequence of quests.  This reduced the number of routes generated (in fact, subsets) to 300 manageable ones. <br><br>  Is it good?  Well, not really.  Here only those sets of quests that can be completed are taken into account.  There is no consideration of the order in which these quests can be completed (which would probably give us millions of permutations), the order of actions for completing a specific quest (for example, to complete a quest you may need to kill someone, but it may happen before how the player‚Äôs character learns about the quest) and alternate routes (for example, getting the desired item from another place or completing an additional task to get more faction reputation points). <br><br>  But even worse is that it was generating a route for only one faction.  It will be necessary to process 7 more factions (besides, I will need to choose the Great House, the passage of which is the fastest), and even they will not have many ways to pass, simply going through all the possible routes for all factions will definitely become unjustified. <br><br>  In addition, this method will not allow me to encode the features of some guilds.  For example, the guild of legal killers <a href="http://en.uesp.net/wiki/Morrowind:Morag_Tong">Morag Tong</a> has several quest givers around the world, each of whom can give the player his next contract.  Moreover, the reputation required for the last quest line to be opened can be obtained not only by fulfilling murder contracts, but also by collecting <a href="http://en.uesp.net/wiki/Morrowind:Threads_of_the_Webspinner">certain items</a> scattered around the world, giving approximately the same reputation as the contract.  These items can often be found in the dungeons, which the player must attend for other guilds, and may be.  that the execution of such quests to collect items can generally be faster. <br><br><h2>  Attempt 2: dependency graph of individual quests </h2><br>  Therefore, I abandoned the idea of ‚Äã‚Äãcombining all possible routes from all the guilds, and instead experimented to find out if there are obvious fast routes for most of the guilds.  It turned out that they exist, and instead of solving millions of examples of the traveling salesman problem, I decided to choose only one.  The solution is still impossible, but less impossible. <br><br><h3>  Overview of the fastest routes for a specific faction </h3><br>  The introductory quest line <a href="http://en.uesp.net/wiki/Morrowind:Mages_Guild">of the Mages Guild</a> can be completed in a matter of minutes and get 22 points of reputation, and Edwinna‚Äôs quests can be completed on the way to the locations of other quests that are likely to be visited anyway.  These two quest givers can bring player character points that exceed the 70 reputation points needed to challenge the Archmage (at this stage I hadn‚Äôt considered learning skills). <br><br>  <a href="http://en.uesp.net/wiki/Morrowind:Fighters_Guild">The guild of fighters</a> can be completed by completing all the quests of one quest giver (most of which are connected with killing gangsters in approximately one area; this task can be accomplished even before the quest begins), a couple from another quest giver and going to the last quest line (which has a <a href="http://en.uesp.net/wiki/Morrowind:Elith-Pal_Mine">quest that requires bringing items to some wilderness</a> , but the alternative ending requires much more reputation points). <br><br>  The <a href="http://en.uesp.net/wiki/Morrowind:Thieves_Guild">Thieves Guild</a> has several conflicts with the Fighters Guild, so two quest lines need to be carefully taken into account.  Almost all quests in the Thieves Guild need to be completed (since some of the Soldiers Guild quests diminish the reputation of the Thieves Guild), but the good news is that they have one common antagonist, therefore, after reaching a certain reputation in the Thieves Guild, passing the Mages Guild boosts the character rank to master affairs. <br><br>  <a href="http://en.uesp.net/wiki/Morrowind:Morag_Tong">Morag Tong</a> , in fact, can be completed in one step: after the first contract required to enter the Guild, the player collects enough Sanguin artifacts to skip all the contracts and go directly to the last quest line, and the location of the last boss is visited twice in the quests of others guilds. <br><br>  <a href="http://en.uesp.net/wiki/Morrowind:Tribunal_Temple">The Temple of the Tribunal</a> begins with an obligatory pilgrimage with visits to several points on the game map.  There are several more pilgrimages in the quest line, and some of them can be done without even joining a faction. <br><br>  The quest line of the <a href="http://en.uesp.net/wiki/Morrowind:Imperial_Legion">Imperial Legion</a> is performed in a <a href="http://en.uesp.net/wiki/Morrowind:General_Darius">single city</a> and requires the player to visit a place that he already visits in the quest line of Edwinna Elbert in the Mages Guild.  In addition, <a href="http://en.uesp.net/wiki/Morrowind:Rescue_Madura_Seran">one quest</a> gives an additional reputation at the Temple, which allows you to skip one of his quest. <br><br>  The <a href="http://en.uesp.net/wiki/Morrowind:Imperial_Cult">Imperial Cult</a> has three quest lines.  In one of them, a fundraiser is required, therefore, as in real life, a player can simply give the quest giver money on the spot and not solicit it from others.  In the other, you need to collect several powerful artifacts and visit a couple of places visited in the quest lines of other guilds. <br><br>  After reviewing the quest lines of the Great Houses, I settled on <a href="http://en.uesp.net/wiki/Morrowind:House_Hlaalu">House Hlaalu</a> .  The quest line of <a href="http://en.uesp.net/wiki/Morrowind:House_Redoran">House Redoran is</a> much longer, and the main action of <a href="http://en.uesp.net/wiki/Morrowind:House_Telvanni">House Telvanni</a> takes place in the eastern part of the game map, which usually does not need to be visited for other quests.  In addition, the <a href="http://en.uesp.net/wiki/Morrowind:Duke_Vedam_Dren">last quest line Hlaalu</a> , which leads to becoming the Chairman of the Council, can be started with a lower rank. <br><br><h3>  Quest Dependency Graph </h3><br>  Now that I had the only route for each guild, instead of coding each requirement and location of the quest in the graph, I chose a simpler method.  Each node in the quest dependency graph will be something that can be completed relatively quickly and what is happening in one location.  This can be a quest, a series of quests, or an action to clear a dungeon involved in several future quests. <br><br>  The node contains two elements: the location of this node in the game (for example, the quest giver's in-game ID or NPC in a location that the player must clear or find a specific item) and nodes that the player must perform before the current one. <br><br>  For example: <br><br><pre> <code class="cpp hljs">#     mg_ajira_1: giver: ajira #      ,      ( ,  #     ,  ,   ) mg_edwinna_1: #    Almsivi/Divine giver: edwinna elbert prerequisites: - mg_ajira_1 mg_edwinna_2: giver: edwinna elbert prerequisites: - mg_edwinna_1 - mg_edwinna_nchuleftingth - mg_edwinna_scarab_plans - mg_edwinna_airship_plans #  ,      mg_edwinna_nchuleftingth: giver: anes vendu #        mg_edwinna_scarab_plans: giver: Khargol gro-Boguk #         mg_edwinna_airship_plans: giver: lugrub gro-ogdum #        ,        mg_master: giver: trebonius artorius prerequisites: - mg_edwinna_2</code> </pre> <br>  In this case, the Dwemer drawings that Edwinna needs can be taken even before the start of the quest line and transmit them all at the same time. <br><br>  When part of the quest is communicating with someone, I coded it as several nodes depending on each other: <br><br><pre> <code class="cpp hljs">fg_eydis_1_start: #         giver: eydis fire-eye fg_eydis_1_do: giver: drarayne thelas #    prerequisites: - fg_eydis_1_start fg_eydis_1_end: #   giver: eydis fire-eye prerequisites: - fg_eydis_1_do</code> </pre> <br>  Here is the final quest dependency graph: <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/83d/aac/a4f/83daaca4f1dbda4e264826ae0a489ed5.png"></a> </div><br>  This is much better than fussing with reputation points and quest prerequisites.  Any <a href="https://en.wikipedia.org/wiki/Topological_sorting">topological sorting of</a> this dependency graph will be the correct route through the quests of the game (assuming that I correctly coded all the dependencies).  Since each node has a fixed geographic location, I can use the pathfinding algorithm and the data from <a href="https://kimonote.com/%40mildbyte/project-morrowind-part-3-392/">my previous project</a> to find the time required for each specific route that satisfies this dependency graph (using teleportation and public transport). <br><br>  However, there is still a problem: there are many possible topological sorts of a given graph, and their calculation is <a href="https://en.wikipedia.org/wiki/Sharp-P-complete"># P-complete</a> . <br><br>  This is a common case of the traveling salesman problem: if we need to find the shortest route here, visiting all the nodes subject to multiple dependencies (for example, we cannot visit A ‚Äã‚Äãuntil we have visited C), then in the traveling salesman problem we need to visit all the nodes without dependencies.  The presence of dependencies reduces the search space (in the most extreme case, the dependency graph is a direct one, that is, there is only one possible route), but it does not reduce it sufficiently. <br><br>  Therefore, I had to develop approximations in order to turn this graph and the time matrix of moving between its nodes into a reasonably good route. <br><br><h2>  Generation of displacement time matrix </h2><br>  Here we will talk about two graphs: the first is the dependency graph of quests described above, and the second is the displacement graph, which I generated in <a href="https://kimonote.com/%40mildbyte/project-morrowind-part-3-392/">a previous article</a> . <br><br>  At this stage, the dependency graph contains about 110 geographically distant nodes, so the first step is to create a matrix of the fastest routes and travel time between every two of these nodes, because the final route will, of course, be used to move between some two points. <br><br>  For this, I used the Dijkstra algorithm: since it is an algorithm for finding the shortest path from a single point, if I run it for one geographic node in the quest dependency graph, I will get the shortest routes (in the movement graph) to all the other points.  Therefore, it was enough for me to do it a hundred times. <br><br>  However, there is a problem: the movement graph contains about 6,500 vertices and 16,000 teleportation edges (that is, moving by public transport or using Almsivi / Divine Intervention spells: this number does not include the edges of physical movements between points in one cell).  It took about 10 minutes to execute the Dijkstra algorithm for one starting point, so I would spend about a day on generating the displacement time matrix. <br><br>  Therefore, I decided to truncate the displacement graph a little by combining the vertices located in the same cell.  For each cell (internal or external), I replaced all the vertices in it with one vertex with averaged coordinates, and then recalculated the costs of moving between them: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coalesce_cells</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(vertices, edges)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#           ( ) vertices_map = defaultdict(list) for v in vertices: vertices_map[v.cell].append(v) #       average_vertices = {} for cell, vs in vertices_map.items(): coords = tuple(sum(v.coords[i] for v in vs) / float(len(vs)) for i in range(3)) average_vertices[cell] = Location(coords=coords, cell_id=vs[0].cell_id, cell=vs[0].cell) new_vertices = set([average_vertices[v.cell] for v in vertices]) #     ,     grouped_edges = defaultdict(lambda: defaultdict(list)) for v1 in edges: av1 = average_vertices[v1.cell] for v2 in edges[v1]: av2 = average_vertices[v2.cell] #      grouped_edges[av1][av2].append((edges[v1][v2][0], get_distance(av1.coords, v1.coords) / WALKING_SPEED + edges[v1][v2][1] + get_distance(v2.coords, av2.coords) / WALKING_SPEED)) new_edges = defaultdict(dict) for av1 in grouped_edges: for av2 in grouped_edges[av1]: #           new_edges[av1][av2] = min(grouped_edges[av1][av2], key=lambda md: md[1]) return new_vertices, new_edges</span></span></code> </pre> <br>  Due to this truncation, the displacement graph narrowed down to about 800 vertices and 2,200 teleportation edges, and I successfully managed to create a matrix of the shortest travel time between any two nodes in the dependency graph. <br><br>  Here is one of the things that can be done with such a distance matrix: use the clustering algorithm to visualize the groups into which the points important for the quests are ordered (click on image to enlarge). <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/d35/eb2/c03/d35eb2c0351e433c041d37b0eeb82c58.png"></a> </div><br>  For example, on the upper left side of this heat map, there is an NPC group located on a number of remote islands in the north of the game map.  It is difficult to get to them and it takes a lot of time, so it is worth ordering our quests in such a way that we have to get here only once. <br><br><h2>  Annealing Simulation (Genetic Algorithm?) </h2><br>  Suppose we have a candidate route, which is one of the topological sorts of the dependency graph.  We can see how much this route takes by simply summing the cost of moving between successive nodes using our cost matrix. <br><br>  How do we find the best route?  Simple brute force does not help here.  I decided to do something a little less stupid: take the route and randomly mix it.  Of course, the resulting route may be less effective than it was before.  But imagine that we will do this for tens of thousands of randomly generated routes, save the part that turned out to be the most effective, and then again mix the best routes again.  Gradually, we will come to a decent route, if not the most optimal one. <br><br>  As a result, I used the following algorithm: <br><br><ul><li>  Let's start with a pool of candidate routes: take a simple topological sort and repeat it 20,000 times </li><li>  We continue until it bothers, then we stop optimization: <br><ul><li>  sort the routes by their total time, saving the best 1000 routes </li><li>  for each remaining route: <br><ul><li>  we generate from it 20 candidate routes: <br><ul><li>  choose a random point of the route and move it to a random number of steps up or down </li><li>  we check whether the requirements of the dependency graph are satisfied; if not, then we repeat again </li><li>  perform such permutations 30 times </li></ul></li></ul></li><li>  in the pool now 20,000 routes again, we repeat </li></ul></li></ul><br>  Of course, you can experiment with constants, and the termination condition can be determined better.  Someone calls this a genetic algorithm (in which we simulate evolution and random mutations in the genetic pool), others - imitation annealing (in which the magnitude of random movements decreases with time until we arrive at a solution pool).  The ‚Äúgenetic algorithm‚Äù sounds more interesting, so I mentioned it in this paragraph. <br><br>  I left the program to work at night and in the morning I saw a route that seemed suitable for passing the game. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5b8/7c4/792/5b87c4792d11fb57caeae4b10e85b9a3.png"></div><br>  The travel time here is derived from in-game distances, given that the minimum walking speed is approximately equal to 100 game units per second.  Of course, there are potions and spells that increase walking speed.  In addition, it does not take into account the time spent on the menu or the killing of those who must kill the player. <br><br>  In general, at some points the optimizer pleasantly surprised me. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/04e/e0a/684/04ee0a6846c5e690c32f54c6e8a7a145.png"></div><br>  I have written a handy program that takes graph nodes and expands them into a movement plan using Almsivi / Divine Intervention spells and public transport.  For example, in this fragment, the route planner correctly set up progress in the quest faction line, so that all six tasks in the remote southwestern corner of the map can be completed in one go (lines 592-618). <br><br>  However, this route has some problems: <br><br><ul><li>  It does not take into account the use of spells Mark / Recall.  These spells are very powerful: Recall teleports the player to the point where the last spell Mark was pronounced. </li><li>  It does not take into account skills training for moving between faction quests. </li></ul><br><h2>  Learning skills </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raising the rank of Morrowind factions requires not only completing quests, but also learning skills. I have already mentioned that although it is possible to pay to learn a skill, it cannot be raised above its controlling attribute. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attribute values ‚Äã‚Äãcan only be increased when elevated. As the main skills, a player‚Äôs character has 5 of 27 skills (which allow him to increase their level faster and give a +25 bonus to these skills at the beginning of the game) and 5 side skills (which also allow them to increase their level faster, although not so quickly , as in the main, and also give a bonus of +10 to these skills). The character raises the level when he scores 10 points on the main or side skill.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And here everything starts to get weird. When increasing the level, the player chooses 3 attributes, the level of which he wants to increase. The amount of increase depends on the skills the player has learned. For example, if he got 10 points in Alchemy (managed by Intellect), then if Intellect is selected when the level rises, it will increase not by 1, but by 5 points. However, if a player has raised a level by learning 1 point in Long Blades (controlled by the Force) and 9 points in Alchemy, he will receive a 4x multiplier for Intelligence and 1x for Strength.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Also, the player can learn skills that are not basic or side to get enough points to increase the attribute multiplier. </font><font style="vertical-align: inherit;">Suppose a player also learns 1 point in Security (managed by Intellect), which is not his primary or secondary skill. </font><font style="vertical-align: inherit;">It will not be counted in the 10 points needed to increase the level, but is taken into account in the calculation of the attribute multiplier. </font><font style="vertical-align: inherit;">Therefore, the player will be able to increase his Intelligence by 5. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Therefore, I needed to tactically choose the basic / side skills of my character, as well as his race (which gives bonuses to certain skills and attributes) in order to quickly achieve the requirements of each faction.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Overview of factions and skill levels required </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Below is a list of the skill levels required by each faction so that the player can become the head of the faction. </font><font style="vertical-align: inherit;">It is worth considering that he does not necessarily meet the skill requirements for the highest rank in the faction, because most factions stop checking the player‚Äôs parameters during their last quest lines and simply raise the player to the highest rank after the quest line is completed.</font></font><br><br><ul><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mages Guild</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Change, Destruction, Alchemy, Enchantment, Illusion, Mysticism. </font><font style="vertical-align: inherit;">One skill not less than 70, two not less than 25, Intellect and Will power not less than 33.</font></font></li><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guild of Fighters</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Sekirs, Long Blades, Blunt Weapons, Heavy Armor, Blacksmith, Protection; </font><font style="vertical-align: inherit;">70/25/25, Strength and Endurance 33.</font></font></li><li> <strong> </strong> : ,  ,  , , , ; 80/30/30,    34. </li><li> <strong> </strong> : ,  , , , ,  ; 80/30/30,    34. </li><li> <strong> </strong> : , , ,  ,  , ; 80/30/30.    34. </li><li> <strong> </strong> : ,  , , , ,  ; 90/35/35.     35. </li><li> <strong> </strong> : ,  ,  ,  ,  , ; 70/25/25.    33. </li><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">House of Hlaalu</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Eloquence, Trade, Accuracy, Short Blades, Light Armor, Security; </font><font style="vertical-align: inherit;">70/25/25. </font><font style="vertical-align: inherit;">Speed ‚Äã‚Äãand Dexterity 33.</font></font></li></ul><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Character planning </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With all this in mind, I decided to choose Alchemy, Blunt Weapon and Accuracy as high-level skills. </font><font style="vertical-align: inherit;">Alchemy (basic skill for the Mages Guild) can quickly learn how to create potions. </font><font style="vertical-align: inherit;">A crushing weapon is a common skill for 4 factions (Guild of Fighters, Temple, Imperial Cult and Imperial Legion) and should increase to 90. Accuracy is associated with the other 3 factions (Thieves Guild, Morag Tong and House Hlaalu) and rises to 80.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Other skills must be chosen partially in order to cover the remaining, weaker requirements, and partly because training them increases Strength or Dexterity to 90 or 80 (otherwise it will be impossible to learn Doubling Weapon or Accuracy). Therefore, I decided to pump a character starting with a high Strength and with a bonus to Blunt Weapons, and also to learn Long Blades to increase Strength (and to meet the requirements of secondary skills for the Guild of Fighters / Imperial Legion). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For Dexterity, I will be trained in Defense, Light Armor, and Stealth. All of them are controlled by Dexterity and training them to the required levels will lead to the Dexterity increase so that it will allow me to learn Accuracy to 80.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enchantment and Mysticism meet the secondary requirements of the Temple, the Mages Guild, and the Imperial Legion. </font></font><br><br> <a href="https://morrowind.jpbetley.com/%3Fsex%3Dfemale%26amp%3Brace%3Dnord%26amp%3Bbirthsign%3DSteed%26amp%3Bspecialization%3Dmagic%26amp%3Bfavored%3Dstrength%26amp%3Bfavored%3Dagility%26amp%3Bmajor%3Dmysticism%26amp%3Bmajor%3Dblunt-weapon%26amp%3Bmajor%3Dmarksman%26amp%3Bmajor%3Dalchemy%26amp%3Bmajor%3Denchant%26amp%3Bminor%3Dlong-blade%26amp%3Bminor%3Dsneak%26amp%3Bminor%3Dblock%26amp%3Bminor%3Dspeechcraft%26amp%3Bminor%3Dlight-armor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here is the final character scheme</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">She begins with the following basic and side skills:</font></font><br><br><ul><li>  Major: <br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Alchemy: 35. To raise it to 70 using potions (the main skill for the Mages Guild, a secondary skill for the Temple). </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Grant Weapons: 40. To raise them to 90 (basic skill for the Fighters Guild, the Imperial Legion, the Imperial Cult, and the Temple). </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Accuracy: 30. To raise her to 80 (the main skill of the Thieves Guild, Morag Tong and House Hlaalu). </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mysticism: 35, no need to learn (secondary skill for the Mages Guild, the Temple and the Imperial cult). </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Enchantment: 35, no need to learn (secondary skill for the Mages Guild and Imperial Cult). </font></font></li></ul></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adverse: </font></font><br><ul><li>  : 25.    45      (       ). </li><li> : 15.    30 (       ) </li><li> : 15.    30 (       ). </li><li> : 15.    25      (    ). </li><li>  : 15.    30 (    ,     ). </li></ul></li></ul><br><h3>       </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I decided not to load the data from Morrowind teachers to be embedded in the route planner. Instead, I found the </font></font><a href="http://en.uesp.net/wiki/Morrowind:Master_Trainers"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">best teachers of</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Crushing Weapons and Accuracy (because these are the only skills that allow the player to reach the required level), as well as </font></font><a href="http://en.uesp.net/wiki/Morrowind:Blunt_Weapon_Trainers"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">second</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -rate </font><a href="http://en.uesp.net/wiki/Morrowind:Blunt_Weapon_Trainers"><font style="vertical-align: inherit;">teachers,</font></a><font style="vertical-align: inherit;"> and tried to figure out the people with whom the player‚Äôs character would still meet on his way. So funny coincidences came to light, for example, </font></font><a href="http://en.uesp.net/wiki/Morrowind:Alveleg"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alveleg</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , who needs to be killed as part of the quest of the Fighters Guild, but who can also train the player in Defense, Stealth and Accuracy to fairly high levels. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Then I added a few extra nodes to the dependency graph to reflect the new learning sessions:</font></font><br><br><pre> <code class="cpp hljs">#   training_alveleg: #             (<span class="hljs-number"><span class="hljs-number">45</span></span>),  (<span class="hljs-number"><span class="hljs-number">42</span></span>)   (<span class="hljs-number"><span class="hljs-number">38</span></span>) description: <span class="hljs-function"><span class="hljs-function">Train Block </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x10</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(up to </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">25</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, Sneak </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x15</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(up to </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">30</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, Marksman </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x15</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(up to </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">45</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, should get Agi 60 giver: alveleg training_bolnor: description: Train Light Armor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x15</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(up to </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">30</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, Marksman </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x5</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(up to </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">50</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, should get Agility 70 giver: bolnor andrani prerequisites: - training_alveleg training_eydis: description: Train Long Blade </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x20</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(up to </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">40</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, Blunt </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x30</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(up to </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">70</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, Strength 85 giver: eydis fire-eye training_ernse: description: Train Blunt </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x20</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(up to </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">90</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> giver: ernse llervu prerequisites: - training_eydis training_missun: description: Train Marksman </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x30</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(up to </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">80</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> giver: missun akin prerequisites: - training_bolnor training_falvel: description: Train Mercantile </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x10</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(should get Personality </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">35</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> giver: falvel arenim</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Then they should become prerequisites for some later quests in the quest lines of the factions: </font></font><br><br><pre> <code class="cpp hljs">tt_tharer_1: description: Get <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> hand in all Tharer Rotheloth quests giver: tharer rotheloth prerequisites: - tt_7graces_vivec - tt_7graces_gnisis - tt_7graces_kummu - tt_7graces_gg - tt_cure_lette - tt_mount_kand - tt_mawia - tt_kill_raxle_berne - training_eydis # Curate (<span class="hljs-number"><span class="hljs-number">50</span></span> blunt) to hand in Galom Daeus quest</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In some cases, the requirements I add are more stringent. </font><font style="vertical-align: inherit;">For example, a player may ascend to a Fighter Master Guild with a Crush Weapon skill of 80, but this depends on the Crush Training Training Node node at 90. The reason for this is that I don‚Äôt want to visit a Master Crush Master teacher more than once: if we visit her, we train for Crusher weapons to the maximum necessary level.</font></font><br><br><h2>  Conclusion </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In the next article, we will try to add Mark and Recall spells to the route, as well as discuss some of the many Morrowind tricks and glitches that can help us during speedran. </font></font></div><p>Source: <a href="https://habr.com/ru/post/354204/">https://habr.com/ru/post/354204/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354192/index.html">Moscow SPA ‚Ññ4: summary, video, presentations, photo report</a></li>
<li><a href="../354194/index.html">Building a network for data storage systems of the small and medium business sector Part 2. Practical issues of organizing small infrastructures</a></li>
<li><a href="../354196/index.html">Creating the main menu of the game</a></li>
<li><a href="../354198/index.html">How to transfer a polymorphic object to the STL algorithm</a></li>
<li><a href="../354200/index.html">Unified Scalable Remuneration System: Our Experience</a></li>
<li><a href="../354206/index.html">Start with full stack and not regret: from senior developer to head of department for six years</a></li>
<li><a href="../354208/index.html">Learn OpenGL. Lesson 5.4 - Omnidirectional Shadow Maps</a></li>
<li><a href="../354210/index.html">The announcement of the mitap ThinkPHP # 16 in Kharkov</a></li>
<li><a href="../354214/index.html">Payment Management Privat24 from Google-tables</a></li>
<li><a href="../354216/index.html">Forbes: Alibaba and Uber have become the most profitable companies for investors</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>