<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Setting up a modern Puppet server from scratch</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I rethought the procedure for installing a new Puppet server from scratch on Ubuntu 12.04, including all modern whistles and fakes. As a res...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Setting up a modern Puppet server from scratch</h1><div class="post__text post__text-html js-mediator-article">  Recently, I rethought the procedure for installing a new Puppet server from scratch on Ubuntu 12.04, including all modern whistles and fakes.  As a result, I got this guide. <br><br>  First we need a clean Ubuntu with a working network and a configured DNS. <br><br>  As a result, we should get: <br><ul><li>  Installed everywhere Puppet 3rd version </li><li>  Configs in git shared repositories </li><li>  <a href="https://github.com/adrienthebo/r10k">R10k</a> managed dynamic environments </li><li>  PuppetDB support </li><li>  Hiera support </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This manual is quite long, because  All settings are made manually so that later you can easily use the result and adjust it for yourself.  The only exception is PuppetDB, which is easier to install through Puppet Labs' own module, rather than manually. <br><br>  It is assumed that all commands will be executed from the root user on the Puppet server, unless otherwise specified. <br><a name="habracut"></a><br><br><h2>  Install Puppet </h2><br>  Add Puppet Labs repository by installing their package: <br><pre><code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">source</span></span> /etc/lsb-release wget https://apt.puppetlabs.com/puppetlabs-release-<span class="hljs-variable"><span class="hljs-variable">$DISTRIB_CODENAME</span></span>.deb dpkg -i puppetlabs-release-<span class="hljs-variable"><span class="hljs-variable">$DISTRIB_CODENAME</span></span>.deb rm puppetlabs-release-<span class="hljs-variable"><span class="hljs-variable">$DISTRIB_CODENAME</span></span>.deb</code> </pre> <br>  Install Puppet and Puppet Master: <br><pre> <code class="bash hljs">apt-get update apt-get install puppet puppetmaster</code> </pre><br>  <i>Note from the translator: documentation Puppet Labs <a href="http://docs.puppetlabs.com/guides/install_puppet/install_debian_ubuntu.html">recommends</a> installing puppetmaster-passenger.</i> <br><br><h2>  Puppet Setup </h2><br>  Create a directory in which your environment settings will be located and give the <code>puppet</code> group write permissions: <br><pre> <code class="bash hljs">mkdir /etc/puppet/environments chgrp puppet /etc/puppet/environments chmod 2775 /etc/puppet/environment</code> </pre><br>  We will never edit the contents of this directory directly, it will be done for us by <code>r10k</code> via git hook, which we will configure later. <br><br>  Now you need to make some settings in the <code>/etc/puppet/puppet.conf</code> file.  Here is a good example from which you can start: <br><pre> <code class="hljs ruby">[main] environment = production confdir = <span class="hljs-regexp"><span class="hljs-regexp">/etc/puppet</span></span> logdir = <span class="hljs-regexp"><span class="hljs-regexp">/var/log</span></span><span class="hljs-regexp"><span class="hljs-regexp">/puppet vardir = /var</span></span><span class="hljs-regexp"><span class="hljs-regexp">/lib/puppet</span></span> ssldir = $vardir/ssl rundir = <span class="hljs-regexp"><span class="hljs-regexp">/var/run</span></span><span class="hljs-regexp"><span class="hljs-regexp">/puppet factpath = $vardir/lib</span></span><span class="hljs-regexp"><span class="hljs-regexp">/facter templatedir = $confdir/templates</span></span> pluginsync = <span class="hljs-literal"><span class="hljs-literal">true</span></span> [agent] environment = production report = <span class="hljs-literal"><span class="hljs-literal">true</span></span> show_diff = <span class="hljs-literal"><span class="hljs-literal">true</span></span> [master] environment = production manifest = $confdir/environments/$environment/manifests/site.pp modulepath = $confdir/environments/$environment/<span class="hljs-symbol"><span class="hljs-symbol">modules:</span></span>$confdir/environments/$environment/site <span class="hljs-comment"><span class="hljs-comment"># Passenger ssl_client_header = SSL_CLIENT_S_DN ssl_client_verify_header = SSL_CLIENT_VERIFY</span></span></code> </pre><br>  <i>Note from the translator: since version 3.6, the variables <code>manifest</code> / <code>modulepath</code> / <code>config_version</code> <a href="http://docs.puppetlabs.com/puppet/3.6/reference/release_notes.html">are deprecated in favor of the environments</a> .</i> <br><br>  If you have not yet configured the definition of the name " <code>puppet</code> " in DNS, you can add <code>server = your.server.com</code> to the <code>[main]</code> section. <br><br><h2>  Hiera setting </h2><br>  Hiera also requires some configuration.  Create the <code>/etc/puppet/hiera.yaml</code> file: <br><pre> <code class="ruby hljs">--- <span class="hljs-symbol"><span class="hljs-symbol">:hierarchy</span></span>: - <span class="hljs-string"><span class="hljs-string">"nodes/%{::fqdn}"</span></span> - <span class="hljs-string"><span class="hljs-string">"manufacturers/%{::manufacturer}"</span></span> - <span class="hljs-string"><span class="hljs-string">"virtual/%{::virtual}"</span></span> - common <span class="hljs-symbol"><span class="hljs-symbol">:backends</span></span>: - yaml <span class="hljs-symbol"><span class="hljs-symbol">:yaml</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">:datadir</span></span>: <span class="hljs-string"><span class="hljs-string">"/etc/puppet/environments/%{::environment}/hieradata"</span></span></code> </pre><br>  In order to make Hiera debugging a little easier and to avoid confusion in the future, I prefer to replace the file <code>/etc/hiera.yaml</code> (which Puppet is not even aware of) with a symbolic link to <code>/etc/puppet/hiera.yaml</code> : <br><pre> <code class="bash hljs">ln -sf /etc/puppet/hiera.yaml /etc/hiera.yaml</code> </pre><br><br><h2>  Puppet Health Check </h2><br>  Now is the time to restart the Puppet Master service: <br><pre> <code class="bash hljs">/etc/init.d/puppetmaster restart</code> </pre><br>  Check the performance of the Puppet agent: <br><pre> <code class="bash hljs">puppet agent --<span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre><br>  As a result, you should get something similar: <br><pre> <code class="ruby hljs"><span class="hljs-symbol"><span class="hljs-symbol">Info:</span></span> Retrieving plugin <span class="hljs-symbol"><span class="hljs-symbol">Error:</span></span> /File[<span class="hljs-regexp"><span class="hljs-regexp">/var/lib</span></span><span class="hljs-regexp"><span class="hljs-regexp">/puppet/lib</span></span>]: Could <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-symbol"><span class="hljs-symbol">evaluate:</span></span> Could <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> retrieve information from environment production source(s) <span class="hljs-symbol"><span class="hljs-symbol">puppet:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/testpm.qix.no/plugins</span></span> <span class="hljs-symbol"><span class="hljs-symbol">Info:</span></span> Caching catalog <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> testpm.qix.no <span class="hljs-symbol"><span class="hljs-symbol">Info:</span></span> Applying configuration version <span class="hljs-string"><span class="hljs-string">'1384949455'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">Info:</span></span> Creating state file /var/lib/puppet/state/state.yaml <span class="hljs-symbol"><span class="hljs-symbol">Notice:</span></span> Finished catalog run <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">03</span></span> seconds</code> </pre><br>  The only error can be ignored, because  we still have no configs or plugins. <br>  Before continuing, make sure that this command works.  Problems at this stage are most likely related to DNS. <br><br><h2>  Install r10k </h2><br>  Matchless <a href="http://somethingsinistral.net/">Adrien Thebo</a> created the same matchless utility for managing dynamic Puppet environments and efficiently using external modules ‚Äî whether you found them on <a href="https://forge.puppetlabs.com/">Puppet Forge</a> or store them in your own repository. <br>  More information can be found on the <a href="https://github.com/adrienthebo/r10k">GitHub</a> page.  To install, execute the following commands: <br><pre> <code class="bash hljs">apt-get install rubygems gem install r10k</code> </pre><br><br><h2>  R10k setup </h2><br>  You need to create a <code>r10k</code> directory in which <code>r10k</code> will store copies of the modules: <br><pre> <code class="bash hljs">mkdir /var/cache/r10k chgrp puppet /var/cache/r10k chmod 2775 /var/cache/r10k</code> </pre><br>  And of course, <code>r10k</code> has its own settings file.  Create <code>/etc/r10k.yaml</code> with the following contents: <br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># location for cached repos :cachedir: '/var/cache/r10k' # git repositories containing environments :sources: :base: remote: '/srv/puppet.git' basedir: '/etc/puppet/environments' # purge non-existing environments found here :purgedirs: - '/etc/puppet/environments'</span></span></code> </pre><br><br><h2>  Git install </h2><br>  Unfortunately, the version of git that comes with Ubuntu 12.04 is subject to <a href="https://git.kernel.org/cgit/git/git.git/commit/%3Fid%3D45d4fdc2dc74c657a9c2e95bf04aed539fdcb0a4">this bug</a> , which sets incorrect permissions (0755) for all new Puppet environments.  It does not allow to share repositories between multiple users. <br><br>  Add a PPA from the git support team: <br><pre> <code class="bash hljs">apt-get install python-software-properties add-apt-repository ppa:git-core/ppa</code> </pre><br>  Install the latest stable version of git: <br><pre> <code class="bash hljs">apt-get update apt-get install git</code> </pre><br><br><h2>  Creating a git repository </h2><br>  Now create a new git repository that will become the main source of Puppet configuration for your server. <br>  All your administrators will work with this repository, and <code>r10k</code> will be updated from it to automatically create (or delete) Puppet environments. <br>  Create a new repository in <code>/srv/puppet.git</code> : <br><pre> <code class="bash hljs">git init --bare --shared=group /srv/puppet.git chgrp -R puppet /srv/puppet.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /srv/puppet.git git symbolic-ref HEAD refs/heads/production</code> </pre><br>  Please note that this repository has three distinctive features: <br><ol><li>  he is <i>bare;</i> </li><li>  it is <i>shared;</i> </li><li>  branch <i>master</i> renamed to <i>production.</i> </li></ol><br><br><h2>  Setting access rights </h2><br>  It's time to start setting up Puppet in the git repository. <br>  You should not work with the git repository as root, so add your user to the <code>puppet</code> group that will be used to restrict access to the repository: <br><pre> <code class="bash hljs">adduser &lt;myuser&gt; puppet</code> </pre><br>  Check it out for the changes to take effect. <br>  Check the group membership again by running this command from a regular user: <br><pre> <code class="bash hljs">id | grep puppet</code> </pre><br><br><h2>  Creating a git hook </h2><br>  Continue to work under your normal user. <br>  Create a file <code>/srv/puppet.git/hooks/post-receive</code> , which will run <code>r10k</code> on each push into the repository: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash umask 0002 while read oldrev newrev ref do branch=$(echo $ref | cut -d/ -f3) echo echo "--&gt; Deploying ${branch}..." echo r10k deploy environment $branch -p # sometimes r10k gets permissions wrong too find /etc/puppet/environments/$branch/modules -type d -exec chmod 2775 {} \; 2&gt; /dev/null find /etc/puppet/environments/$branch/modules -type f -exec chmod 664 {} \; 2&gt; /dev/null done</span></span></code> </pre><br>  Do not forget to make the script executable: <br><pre> <code class="bash hljs">chmod 0775 /srv/puppet.git/hooks/post-receive</code> </pre><br><br><h2>  Creating the first environment </h2><br>  Go to the home directory as your normal user and clone the empty repository: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> /srv/puppet.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> puppet</code> </pre><br>  Create several necessary directories: <br><pre> <code class="bash hljs">mkdir -p hieradata/nodes manifests site</code> </pre><br>  We do not create the <code>modules</code> folder, because  It will be controlled through <code>r10k</code> .  Local modules (i.e., modules exclusively for this puppet master server) will be located in the <code>site</code> directory. <br>  Now let's get down to setting up <code>r10k</code> .  Create a <code>Puppetfile</code> file in the repository root with the following contents: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Puppet Forge mod 'puppetlabs/ntp', '3.0.0-rc1' mod 'puppetlabs/puppetdb', '3.0.0' mod 'puppetlabs/stdlib', '4.1.0' mod 'puppetlabs/concat', '1.0.0' mod 'puppetlabs/inifile', '1.0.0' mod 'puppetlabs/postgresql', '3.2.0' mod 'puppetlabs/firewall', '0.4.2' # A module from your own git server #mod 'custom', # :git =&gt; 'git://git.mydomain.com/custom.git', # :ref =&gt; '1.0'</span></span></code> </pre><br>  The <code>Puppetfile</code> file <code>Puppetfile</code> was first proposed by Tim Sharpe for use with <a href="https://github.com/rodjek/librarian-puppet">librarian-puppet</a> , so use it as a source for documentation. <br>  Two important points about <code>Puppetfile</code> : <br><ul><li>  Unlike the <code>puppet module</code> command, <code>r10k</code> does not support automatic dependency handling (for version 1.1.0).  You must enable all dependencies manually. </li><li>  You can refer to git commits by replacing tags with git hashes.  For testing, you can even switch a branch by setting <code>ref</code> to something like <code>master</code> , but this is probably not a good idea in a combat environment. </li></ul><br><br>  Now we will configure two modules by connecting them via <code>Hiera</code> . <br>  All hosts must have an <code>ntp</code> module, so create a file <code>hieradata/common.yaml</code> with the following contents: <br><pre> <code class="ruby hljs">--- <span class="hljs-symbol"><span class="hljs-symbol">classes:</span></span> - ntp ntp::<span class="hljs-symbol"><span class="hljs-symbol">servers:</span></span> - <span class="hljs-number"><span class="hljs-number">0</span></span>.pool.ntp.org - <span class="hljs-number"><span class="hljs-number">1</span></span>.pool.ntp.org - <span class="hljs-number"><span class="hljs-number">2</span></span>.pool.ntp.org - <span class="hljs-number"><span class="hljs-number">3</span></span>.pool.ntp.org</code> </pre><br><br>  Our puppet master server requires the puppetdb module, so create the file <code>hieradata/nodes/$(hostname -f).yaml</code> and add the necessary class with default settings to it: <br><pre> <code class="ruby hljs">--- <span class="hljs-symbol"><span class="hljs-symbol">classes:</span></span> - puppetdb - puppetdb::master::config</code> </pre><br>  Finally, create a very simple manifest <code>manifests/site.pp</code> that will include all the classes we defined in <code>Hiera</code> : <br><pre> <code class="ruby hljs">hiera_include(<span class="hljs-string"><span class="hljs-string">'classes'</span></span>)</code> </pre><br><br><h2>  Commit and push </h2><br>  Stay in the git repository - it's time to commit and push the first version of the <i>production</i> environment. <br>  Due to the fact that git does not allow saving empty directories, and so far we have no local modules, add a dummy file to the <code>site</code> directory: <br><pre> <code class="bash hljs">touch site/.keep</code> </pre><br>  Make sure you have the right branch, add all the files and commit and push: <br><pre> <code class="bash hljs">git checkout -b production git add * git commit -a -m <span class="hljs-string"><span class="hljs-string">"initital commit"</span></span> git push -u origin production</code> </pre><br><br>  As a result, you should get something like this: <br><pre> <code class="bash hljs">Counting objects: 11, <span class="hljs-keyword"><span class="hljs-keyword">done</span></span>. Compressing objects: 100% (5/5), <span class="hljs-keyword"><span class="hljs-keyword">done</span></span>. Writing objects: 100% (11/11), 867 bytes | 0 bytes/s, <span class="hljs-keyword"><span class="hljs-keyword">done</span></span>. Total 11 (delta 0), reused 0 (delta 0) remote: remote: --&gt; Deploying production... remote: To /srv/puppet.git * [new branch] production -&gt; production Branch production <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> up to track remote branch production from origin.</code> </pre><br>  Notice the message <code>--&gt; Deploying production...</code> , which means that our git hook worked. <br>  You can also verify that the <code>/etc/puppet/environments/production</code> directory has been created and the contents of its <code>modules</code> folder contain the Puppet Forge modules that we listed in the <code>Puppetfile</code> . <br><br><h2>  Running puppet </h2><br>  Switch back to <code>root</code> and start the agent puppet: <br><pre> <code class="bash hljs">puppet agent --<span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre><br>  You should get several screens of black and green text output describing the progress of installation and configuration of NTP and PuppetDB services, including the PostgreSQL database required for PuppetDB. <br>  Verify that the services are running: <br><pre> <code class="bash hljs">/etc/init.d/ntp status /etc/init.d/puppetdb status</code> </pre><br><br><h2>  Check PuppetDB </h2><br>  Run puppet again to populate postgresql with: <br><pre> <code class="bash hljs">puppet agent --<span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre><br>  After that, run the following command: <br><pre> <code class="bash hljs">puppet node status $(hostname -f)</code> </pre><br>  You should get something like this: <br><pre> <code class="bash hljs">testpm.qix.no Currently active Last catalog: 2013-11-20T13:22:05.036Z Last facts: 2013-11-20T13:22:00.437Z</code> </pre><br>  Helpful hint: try the following command to see all the information about your host that puppetdb stores in formatted json: <br><pre> <code class="bash hljs">puppet node find $(hostname -f) | python -mjson.tool</code> </pre><br>  Now puppetdb is fully configured and you can use <a href="http://docs.puppetlabs.com/puppet/latest/reference/lang_exported.html">resource exports</a> for things like ssh key distribution across all hosts. <br><br><h2>  Hiera check </h2><br>  If you have reached this step, it means that Hiera is already working, but it may be necessary for you during development to test Hiera from the command line. <br>  I hope you followed my advice and made /etc/hiera.yaml a symbolic link to /etc/puppet/hiera.yaml.  Then the following command will list all the classes that will be applied to the current host in the production environment: <br><pre> <code class="bash hljs">hiera -a classes ::environment=production ::fqdn=$(hostname -f)</code> </pre><br>  As a result, you should get: <br><pre> <code class="bash hljs">[<span class="hljs-string"><span class="hljs-string">"puppetdb"</span></span>, <span class="hljs-string"><span class="hljs-string">"puppetdb::master::config"</span></span>, <span class="hljs-string"><span class="hljs-string">"ntp"</span></span>]</code> </pre><br><br><h2>  Work Process with Puppet Master </h2><br>  Creating branches in git does not require much effort, so the development process will look like this: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#        git checkout -b new_feature vim somefile git add somefile git commit -m "best feature ever" #   ==   git push --set-upstream origin new_feature #   (       ,   ?) puppet agent --test --noop --environment new_feature puppet agent --test --environment new_feature # diff and merge git checkout production git diff ..new_feature git diff --name-only new_feature git merge new_feature #     production git push #    git branch -d new_feature #     ==   git push origin :new_feature</span></span></code> </pre><br><br><h2>  The process of working with modules </h2><br>  If you are working on a module that you want to use on several Puppet Master servers (but do not give it out), one way to do this is to put it on the internal git server and set up the branch you are working on in <code>Puppetfile</code> : <br><pre> <code class="ruby hljs">mod <span class="hljs-string"><span class="hljs-string">'my_app'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:git</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'git://git.mydomain.com/my_app.git'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:ref</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'master'</span></span></code> </pre><br>  This module will be updated under the last commit in the <code>master</code> branch every time you make a push repository <code>/srv/puppet.git</code> .  What if you didn't make any changes to this repository?  In that case, simply execute <code>r10k</code> explicitly.  This command will update all modules in all environments: <br><pre> <code class="bash hljs">r10k deploy environment -p</code> </pre><br>  To update only the <i>testing</i> environment: <br><pre> <code class="bash hljs">r10k deploy environment testing -p</code> </pre><br>  The only problem with running <code>r10k</code> in this way is that the rights in <code>/etc/puppet/environments</code> can go, which leads to problems in the shared repository.  To avoid this, create the <code>/usr/local/bin/deploy</code> script and give it execution rights: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh umask 0002 r10k deploy environment $1 -p find /etc/puppet/environments -mindepth 1 -type d -exec chmod 2775 {} \; find /etc/puppet/environments -type f -exec chmod 0664 {} \;</span></span></code> </pre><br>  Now, when updating modules that are configured for a specific branch, you can run the commands: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#       deploy #       deploy testing</span></span></code> </pre><br>  After finishing work on your module, do not forget to create a tag for it: <br><pre> <code class="bash hljs">git tag -a 1.0 -m <span class="hljs-string"><span class="hljs-string">"finally no error messages"</span></span> git push --tags</code> </pre><br>  ... and update your Puppetfile to refer to the tag name, not the branch name.  A little later, you will be grateful for this. <br><br><h2>  Conclusion </h2><br>  You should now have a solid and modern (well, for a while) basic Puppet configuration.  Good luck! <br><br><h2>  I recommend reading </h2><br><ul><li>  <a href="http://puppetlabs.com/blog/git-workflow-and-puppet-environments">The process of working with git and Puppet environments</a> (Puppet Labs) </li><li>  <a href="http://somethingsinistral.net/blog/rethinking-puppet-deployment/">Rethinking Puppet Deployment</a> (Adrien Thebo) </li></ul><br><br><h3>  Translator supplements </h3><br>  I set up a <a href="https://github.com/sitaramc/gitolite">gitolite</a> + <a href="http://gitlist.org/">gitlist</a> bundle on my Puppet Master.  All the repositories are in gitolite, the changes can be conveniently viewed in the browser ( <a href="https://about.gitlab.com/">gitlab</a> seemed too monstrous with a lot of dependencies and unnecessary functionality in my case).  The / etc / puppet directory also lies in a separate git repository ( <code>environments</code> added to <code>.gitignore</code> ) <br>  For monitoring reports, I use <a href="https://github.com/spotify/puppetexplorer">puppetexplorer</a> , a very user-friendly interface for PuppetDB that works on the client side (written in <code>AngularJS</code> and <code>CoffeeScript</code> ). <br><br>  References: <br><ul><li>  <a href="http://terrarum.net/blog/puppet-infrastructure-with-r10k.html">Puppet Infrastructure with r10k</a> </li><li>  <a href="http://puppetspecialist.nl/MPIpres/">Manageable Puppet infrastructure</a> </li><li>  <a href="http://www.olindata.com/blog/2014/01/puppet-management-gui-comparison">Puppet Management GUI Comparison</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/229867/">https://habr.com/ru/post/229867/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229853/index.html">Building Reliable Web Applications with React: Part 2, Optimization with Browserify</a></li>
<li><a href="../229857/index.html">Android Wear: What went wrong?</a></li>
<li><a href="../229859/index.html">Report from Dribbble Meetup 2014 in Moscow</a></li>
<li><a href="../229861/index.html">"Test Zone" Beeline: go to the tight lock, dress warmer at the gym and turn off the phones</a></li>
<li><a href="../229863/index.html">Sentri: Home Security System for Geeks</a></li>
<li><a href="../229869/index.html">Using Rainmeter Skin in Enterprise</a></li>
<li><a href="../229873/index.html">Continuous Integration in 10 lines of code or why BuildBot, Jenkins, TeamCity and the like are needed</a></li>
<li><a href="../229875/index.html">New VDI service from SFCLOUD set</a></li>
<li><a href="../229877/index.html">Experience using AR.Drone 2.0 in conjunction with Windows</a></li>
<li><a href="../229879/index.html">Syringe - declarative IoC Container for PHP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>