<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DDoS attack bypassing Qrator. How to protect yourself?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are services that protect us from DDoS attacks. They work on the proxy principle: their IP is registered in the DNS, they filter traffic and pro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DDoS attack bypassing Qrator. How to protect yourself?</h1><div class="post__text post__text-html js-mediator-article">  There are services that protect us from DDoS attacks.  They work on the proxy principle: their IP is registered in the DNS, they filter traffic and proxy to your server.  All of them strongly recommend hiding your IP and in public access give only the IP proxy defender.  It is a sound approach, sufficient for successful protection.  And I will tell on what you can pierce and how to protect against this. <br><a name="habracut"></a><br><h4>  Outgoing mail </h4><br>  Let's register in such a service and get a registration letter from him in the mail.  Open the source of the letter and see: <br><br><pre><code class="bash hljs">Received: from mxfront8j.mail.yandex.net ([127.0.0.1]) by mxfront8j.mail.yandex.net with LMTP id c0MIOzBI <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> &lt;mymail@yandex.ru&gt;; Sun, 10 May 2015 15:58:47 +0300 Received: from srv1.example.com (srv1.example.com [xxx.xx.xx.xxx]) by mxfront8j.mail.yandex.net (nwsmtp/Yandex) with ESMTPS id FpRuMcFeJH-wksakWfe; Sun, 10 May 2015 15:58:46 +0300 (using TLSv1 with cipher AES128-SHA (128/128 bits)) (Client certificate not present) Received: from srv1.example.com (localhost [127.0.0.1]) by srv1.example.com (8.14.3/8.14.3/Debian-5+lenny1) with ESMTP id t4ACvd6T026304 <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> &lt;mymail@yandex.ru&gt;; Sun, 10 May 2015 15:57:39 +0300 Received: (from www-data@localhost) by srv1.example.com (8.14.3/8.14.3/Submit) id t4ACvdQX026302; Sun, 10 May 2015 15:57:39 +0300</code> </pre> <br>  Well, we found the car in the subnet of this server in real DC, and not a proxy.  Here it is: srv1.example.com, xxx.xx.xx.xxx.  Most likely this machine is in the same DC and on the same subnet as the www server.  Typically, such projects do not have large networks, no more than / 24.  Let's scan the mesh and find all the machines with an open 80 / tcp port.  Noob is great, there is a list of machines - let's go to each browser.  On a machine with the address xxx.xx.xx.xxy, a redirect to <a href="http://www.example.com/">www.example.com</a> happened to us - this is the same machine, they redirected us to the proxy of the defender. <br><br>  Now we can safely attack this car.  The channel on the machine is unlikely to be more than 1GB, but there are motherboards where network cards with 4 interfaces are built in at once.  So the attack will be with a margin of - 4GB.  We will not make an attack on the application, or an attack on nginx - you can simply fill the channel with traffic.  Moreover, the fact that we fill only the incoming direction to the server is not terrible.  Requests from users are also inbound.  Is it a lot of 4 GB for DDoS attacks?  Let's count.  In Moscow, many people have a good Internet connection at home - 40 MB minimum.  4 GB / 40 MB = 100 machines.  These are only 100 machines with a bot - such a botnet can be organized fairly quickly (if there is an appropriate skill), and for a person who is constantly engaged in DDoS, this is not a problem at all.  Modern botnets are thousands of infected machines. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  How to protect? </h5><br>  A simple solution is to have a mail machine outside the DC and outside the combat subnet, which will work as a mail relay and cut off all the ‚ÄúReceived‚Äù that it has.  This is not difficult to do, in the same postfix there is a content_filter option where you can specify an SMTP proxy for content filtering.  In any language, you can easily write smtp-proxy, which will cut off all the excess in the letter.  I don‚Äôt know the finished tools, to be honest, but for me the task to write smtp-proxy in python or ruby ‚Äã‚Äãis a task for several hours. <br><br><h4>  Steal DNS zone </h4><br>  Less accessible, but also a real way.  Having dragged off the DNS zone, we will find in it the names of the machines and IP addresses - usually the technical names of the machines are kept right in the same zone.  Something like srv1.example.com IN A xxx.xx.xx.xxx. <br><br>  It is quite simple to protect - all technical DNS s are placed in a separate subdomain and are protected more carefully.  srv1.servers.example.com - something like this. <br><br><h4>  Indirect attack </h4><br>  It is not difficult to conclude that a site without statics does not work.  Usually services for protection against DDoS take money for traffic, so static from the main domain is transferred to the CDN.  Covering up with CDN traffic is a very difficult task, because of its distribution.  But you can see what kind of static is still on the site.  ABOUT!  Banners are shown from the left service and he is not sitting behind a proxy defender - this is just luck.  You can fill the channel to the banner system: js will not load, DOM Ready will not happen - if there are a lot of js on the site - it is almost impossible to use it. <br><br>  This is not a universal way, but it can roll where the site without js does not work in principle.  Protection against this is also the most stupid - asynchronous js to banners.  I could not - well, okay. <br><br><h4>  Financial attack </h4><br>  Here we found an interesting file on the CDN: <a href="">cdn-1.example.com/static/video/hardporn.flv</a> .  It weighs as much as 140 MB.  We remember that proxy defenders take money for traffic.  And from where CDN will take this file?  In the simple case of <a href="">www.example.com/static/video/hardporn.flv</a> .  Check and make sure that it is given.  So that's great.  In the simple case, we need a very small botnet, which will simply download this file for a couple of days - without much of a burden, without attracting the attention of the proxy defender.  Of course, this will be an excess of prepaid traffic and the site owner‚Äôs company will have to be very sad. <br><br>  You can tweak such an attack a bit - find the XSS and plug in an html5 video with autoplay and display: none.  Outwardly, nothing changes, but each user pulls a lot of traffic to him.  Each user, unlike a botnet, is not filtered. <br><br>  In general, financial attacks are the most dangerous for binz.  Either the business pays for the huge traffic so that the site works (and pulls even more traffic), or it does not pay and the service lays down. <br><br>  Protection from such is simple to stupidity - return 403 from statics to everyone except the CDN. <br><br><h4>  Mobile API Attack </h4><br>  If the site also has a mobile application - it is now fashionable, it means a modern site.  Having a mobile application, usually the site still has a mobile API.  By installing the application and gathering tcpdump traffic (well, it's not difficult to raise wifi point-to-point on your PC), you can find api-mobile.example.com.  Perhaps because of the desire to save, he, too, will not be for a proxy defender, but look directly at the server.  Well, the IP we needed was burned. <br><br>  Protection, as you understand, is simple - API traffic must go through a proxy defender. <br><br><h4>  Conclusion </h4><br>  All the above methods are simple.  They do not require deep research of the site - just poke into it, do not even require to get a shell on it.  Not all methods are real on all sites, but on most sites, at least one way will work. <br><br>  Protection against DDoS attacks through service defenders is good, it justifies itself financially and technically.  There remains a task for the site admins - but do not sleep your IP! </div><p>Source: <a href="https://habr.com/ru/post/260393/">https://habr.com/ru/post/260393/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260373/index.html">Logging anything in Perl</a></li>
<li><a href="../260381/index.html">Report on ReactOS at RIF + OSDAY 2015 in Innopolis</a></li>
<li><a href="../260387/index.html">Complete CROC cloud translation to Violin Memory's All-Flash data storage.</a></li>
<li><a href="../260389/index.html">"Ajar data" / Notes on the traces of the open data board on June 15</a></li>
<li><a href="../260391/index.html">Blend4Web vs Unity. Battle of the Internet</a></li>
<li><a href="../260397/index.html">SQA Days-17: with the best memories - to the next conference</a></li>
<li><a href="../260403/index.html">The main thing is to sit shoe. How 3D-technology helps to choose shoes by foot</a></li>
<li><a href="../260407/index.html">Experience using Object Change Notification in Oracle</a></li>
<li><a href="../260409/index.html">Sale of books at a discount of 50% and 30%</a></li>
<li><a href="../260411/index.html">Transformice story: indie game with 60 million users</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>