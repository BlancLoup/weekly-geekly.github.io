<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Testing Java table from hamcrest</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the course of writing functional tests, I often had to check the correctness of the data in various tables. The tables were found on web pages, dat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Testing Java table from hamcrest</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/461/56b/c75/46156bc75a8a16d032f8356a1ad5baf0.jpg" align="right">  In the course of writing functional tests, I often had to check the correctness of the data in various tables.  The tables were found on web pages, databases, or even excel files.  In any case, it was necessary to verify that their contents correspond to the given, that is, what is created in the test script. <br><br>  This post is about how to record such checks using the hamcrest library and why. <a name="habracut"></a><br><br>  At first, everything was simple. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Type checks: in the ‚ÄúSalary‚Äù column, in the 15th row, there should be a ‚Äúmillion‚Äù.  For this, I had a method like this: <code>assertCellByColumnAndRowNumber</code> , which was duplicated with enviable regularity, here and there. <br><br>  Then everything got a little more complicated, and it was necessary to check not by the row number, but by the primary key: in the column ‚ÄúSalary‚Äù for ‚ÄúName‚Äù ‚ÄúVasily Ivanovich‚Äù should be ‚Äúmillion‚Äù.  Nothing terrible, the <code>assertCellByColumnAndPrimaryKey</code> method was born, and of course, it was not born in one place. <br><br>  Then there were places where the primary key was composite.  Methods that worked with a composite key began to take on input even more values, it became more difficult to understand the code. <br><br>  I got a chance when it was necessary to check the following: For rows where the ‚ÄúStatus‚Äù is ‚ÄúOK‚Äù, the ‚ÄúType‚Äù column contains the values ‚Äã‚Äã‚ÄúA, B, C‚Äù in order from top to bottom. <br>  It would be possible to make another method with a very long name and a bunch of variables, but I began to understand that this would not stop the matter, there would be more and more methods, and it would be harder <s>to write</s> and maintain tests. <br><br>  Therefore, I decided to use <a href="http://code.google.com/p/hamcrest/">hamcrest</a> in order to write down any conditions to the tables in a unified form and finally get rid of a heap of methods that do various checks. <br><br>  I managed to write a check for the ‚ÄúType‚Äù column like this: <pre> <code class="java hljs">assertThat( table, column(<span class="hljs-string"><span class="hljs-string">"Type"</span></span>,contains(<span class="hljs-string"><span class="hljs-string">"A"</span></span>,<span class="hljs-string"><span class="hljs-string">"B"</span></span>,<span class="hljs-string"><span class="hljs-string">"C"</span></span>)).where(cell(<span class="hljs-string"><span class="hljs-string">"Status"</span></span>, is(<span class="hljs-string"><span class="hljs-string">"Ok"</span></span>))) );</code> </pre><br>  Now more about how this works. <br><br>  The table ( <code>table</code> ) is represented by a collection of series ( <code>class Table extends Collection&lt;Row&gt;</code> ) <br><br>  In order to record the verification of such a table, I created <em>hamcrest</em> <a href="http://www.jarvana.com/jarvana/view/org/hamcrest/hamcrest-library/1.3.RC2/hamcrest-library-1.3.RC2-javadoc.jar!/org/hamcrest/Matchers.html">matchers</a> who set a condition on a row or on the entire table. <br><br>  So far the following matchers have been enough for me: <br><ol><li>  <code>CellMatcher</code> sets a condition per row cell. <br>  For example: <pre> <code class="java hljs">cell(<span class="hljs-string"><span class="hljs-string">"Id"</span></span>, greaterThan(<span class="hljs-number"><span class="hljs-number">0</span></span>))</code> </pre>  will select a row if the ‚ÄúId‚Äù column contains a value greater than 0. <br><br>  In order to create such a matcher, you need to specify the name of the column and any ‚Äústandard‚Äù hamcrest matcher that will check the value in this column. <br><br>  Using this matcher and standard matchers on the collection, you can record the conditions on the entire table. <br><br>  For example, using the ‚Äúlibrary‚Äù matcher <a href="http://www.jarvana.com/jarvana/view/org/hamcrest/hamcrest-library/1.3.RC2/hamcrest-library-1.3.RC2-javadoc.jar!/org/hamcrest/Matchers.html">everyItem</a> , which checks each element of the collection (table row) for compliance with a specific rule, you can write the following condition: <br>  In each row of the table, the Id value is greater than zero and Time is not empty (not <code>null</code> ): <br><pre> <code class="java hljs">everyItem(both(cell(<span class="hljs-string"><span class="hljs-string">"Id"</span></span>, greaterThan(<span class="hljs-number"><span class="hljs-number">0</span></span>))).and(cell(<span class="hljs-string"><span class="hljs-string">"Time"</span></span>, notNullValue())))</code> </pre>  And by adding the functionality of a standard <code>CombinableMatcher</code> , this condition is written even easier - without the word both: <pre> <code class="java hljs">everyItem(cell(<span class="hljs-string"><span class="hljs-string">"Id"</span></span>, greaterThan(<span class="hljs-number"><span class="hljs-number">0</span></span>)).and(cell(<span class="hljs-string"><span class="hljs-string">"Time"</span></span>, notNullValue()))))</code> </pre><br></li><li>  <code>FilterMatcher</code> - filters the table on the basis of one matcher, and then applies the second matcher to the remaining rows. <br><br>  The first matcher (filter) is <code>CellMatcher</code> , or the union of several <code>CellMatcher</code> . <br>  Using the <code>FilterMatcher</code> you can rewrite the previous example as follows: <pre> <code class="java hljs">where(cell(<span class="hljs-string"><span class="hljs-string">"Id"</span></span>,greaterThan(<span class="hljs-number"><span class="hljs-number">0</span></span>)),everyItem(cell(<span class="hljs-string"><span class="hljs-string">"Time"</span></span>,notNullValue())))</code> </pre>  In this case, we verify that Time is not empty (not <code>null</code> ) for all series where Id&gt; 0.  Where Id is 0 or negative, Time can be empty, unlike the previous example. <br><br></li><li>  <code>ColumnMatcher</code> sets a condition for all values ‚Äã‚Äãof a single column of a table. <br>  For example: <pre> <code class="java hljs">column(<span class="hljs-string"><span class="hljs-string">"Action"</span></span>, contains(<span class="hljs-string"><span class="hljs-string">"Active"</span></span>, <span class="hljs-string"><span class="hljs-string">"Pause"</span></span>, <span class="hljs-string"><span class="hljs-string">"Active"</span></span>, <span class="hljs-string"><span class="hljs-string">"Closed"</span></span>))</code> </pre>  sets the condition that the column ‚ÄúAction‚Äù contains the values ‚Äã‚Äãin order: ‚ÄúActive‚Äù, ‚ÄúPause‚Äù, ‚ÄúActive‚Äù, ‚ÄúClosed‚Äù. <br>  Instead of the standard, library matcher <code>contains</code> you can use any other matchers on the collection (the column is presented as a one-dimensional collection of objects), such as <code>containsInAnyOrder, hasItem</code> and others. <br><br>  Of course, you can add a filter to such conditions: <pre> <code class="java hljs">column(<span class="hljs-string"><span class="hljs-string">"Action"</span></span>, contains(<span class="hljs-string"><span class="hljs-string">"Active"</span></span>, <span class="hljs-string"><span class="hljs-string">"Closed"</span></span>)).where(cell(<span class="hljs-string"><span class="hljs-string">"Id"</span></span>,greaterThan(<span class="hljs-number"><span class="hljs-number">2</span></span>)))</code> </pre>  So we check that for rows with id greater than 2, the Action column contains the values ‚Äã‚Äãin order: ‚ÄúActive‚Äù, ‚ÄúClosed‚Äù. <br><br>  <code>ColumnMatcher</code> allows you to apply aggregate matchrs to elegantly check conditions for a sum of at least a maximum of a column.  for example <pre> <code class="java hljs">column(<span class="hljs-string"><span class="hljs-string">"Salary"</span></span>, sum(is(<span class="hljs-number"><span class="hljs-number">100000</span></span>))).where(cell(<span class="hljs-string"><span class="hljs-string">"Type"</span></span>,is(<span class="hljs-string"><span class="hljs-string">"fulltime"</span></span>)))</code> </pre>  allows you to check the amount of wages fulltime workers. <br><br></li><li>  <code>ColumnsMatcher</code> allows <code>ColumnsMatcher</code> to cut multiple columns from a table and set a condition on the resulting two-dimensional data array.  For example: <pre> <code class="java hljs">sliced(byColumns(<span class="hljs-string"><span class="hljs-string">"Action"</span></span>, <span class="hljs-string"><span class="hljs-string">"Time"</span></span>), contains(row(<span class="hljs-string"><span class="hljs-string">"Pause"</span></span>, <span class="hljs-string"><span class="hljs-string">"12:00"</span></span>), row(<span class="hljs-string"><span class="hljs-string">"Active"</span></span>, <span class="hljs-string"><span class="hljs-string">"12:30"</span></span>), row(<span class="hljs-string"><span class="hljs-string">"Closed"</span></span>, <span class="hljs-string"><span class="hljs-string">"14:00"</span></span>))) .where(&lt;some condition&gt;)</code> </pre>  Here, selecting from the whole, probably very large, tables, only the columns ‚ÄúAction‚Äù and ‚ÄúTime‚Äù, we check that they contain clearly defined values. <br><br></li><li>  Because  the table is a standard collection, we can set a condition on the number of its rows, for example: <code>not(empty()),iterableWithSize(lessThan(10))</code> using standard hamcrest match players and not reinvent your bike. </li></ol><br>  It took a day and a half to write matchmakers, and in itself was a very interesting exercise, which served as an excellent practice in design patterns.  I had to make a lot of architectural, design, decisions, starting from the moment, how best to present the table? <br><br>  Probably, these were the most saturated one and a half days, based on the number of architectural solutions per line of code, which turned out to be less than 15 kilobytes. <br><br>  In general, it turned out to be a separate mini-project, with several cycles of refactoring, and design changes that were required in the course of writing and using written matchmakers.  I even wrote a small unit test, in practice, using TDD for the first time in my life. <br><br>  I thought that this could be a great example for learning TDD (and other practices) by newbies or a good topic for practical interview questions (which I have to do) in order to reveal the architectural, ‚Äúdesigner‚Äù abilities of a candidate who often already know the answer to the question why sewers are round.  (joking, I never ask him, and you?). <br><br>  Conclusion: <br>  The table matchers described allowed: <ul><li>  write down all the checks to the tables that I met in my tests, </li><li>  get rid of duplicate code </li><li>  make the code shorter and clearer </li><li>  make the error messages clearer, with a more precise indication of the rows or cells that caused the problem, </li><li>  automatically get a log with a description of all the checks that we use in the framework of the approach " <i><acronym>BDD</acronym> vice versa</i> ", about which I will write next time. </li></ul><img src="http://habr.habrastorage.org/post_images/afa/19d/045/afa19d045b2bce238895a5f2856f9174.gif" alt="image"></div><p>Source: <a href="https://habr.com/ru/post/150368/">https://habr.com/ru/post/150368/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../150358/index.html">Video report: licensing of new Microsoft products - System Center 2012, SQL Server 2012</a></li>
<li><a href="../150360/index.html">M for Mice</a></li>
<li><a href="../150361/index.html">And who in the sun charge?</a></li>
<li><a href="../150362/index.html">Spatial multiplexing: just about complicated. Part 1</a></li>
<li><a href="../150364/index.html">Strangeness with cycles: in debug it works, in release it is not</a></li>
<li><a href="../150370/index.html">Another includeJS</a></li>
<li><a href="../150372/index.html">Speakker - music player on jQuery</a></li>
<li><a href="../150373/index.html">HTML5 games and GodMode: everything is simple!</a></li>
<li><a href="../150374/index.html">TPL + DLR = Multi-threaded scripting</a></li>
<li><a href="../150375/index.html">Good client-server architecture</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>