<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Building neural networks in php using FANN, an example implementation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I was faced with the task of analyzing a large amount of information and identifying patterns. And the first thing that came to mind was to build a ma...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Building neural networks in php using FANN, an example implementation</h1><div class="post__text post__text-html js-mediator-article">  I was faced with the task of analyzing a large amount of information and identifying patterns.  And the first thing that came to mind was to build a mathematical model using a <a href="http://ru.wikipedia.org/wiki/%25D0%2598%25D1%2581%25D0%25BA%25D1%2583%25D1%2581%25D1%2581%25D1%2582%25D0%25B2%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25BD%25D0%25B5%25D0%25B9%25D1%2580%25D0%25BE%25D0%25BD%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2581%25D0%25B5%25D1%2582%25D1%258C">neural network</a> . <br><br>  Since the data for analysis is generated in php and this language is the closest to me now, a library with an interface for php was searched.  In this regard, I was recommended by <a href="http://leenissen.dk/">FANN (Fast Artificial Neural Network)</a> - open source networking software.  This solution has api for 15 languages, so almost everyone can choose something for themselves. <br><br><h5>  Example.  Recognition of the text language on the page </h5><br>  For example, let's take the task easy, but not far from our reality and from serious tasks.  Suppose there are 1000 documents in 3 different languages.  Let it be French, English and Polish.  Our task is to teach the neural network to recognize the language of the document.  For this we use the simplest frequency mechanism.  Nevertheless, his results are not bad.  Its essence is that each language with different frequency in the text contains the same characters.  We prepare 3 large pieces of text for each of the languages ‚Äã‚Äã(English, French, Polish), count for each character frequency.  We will transmit this data to the neural network, indicating which set of frequencies belongs to each of the languages.  Then the neural network will do everything itself. <br><a name="habracut"></a><br><h6>  Start by installing FANN </h6><br>  Example, installation quote for Ubuntu. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1) You need to install the libfann1 and libfann1-dev packages <br><pre><code class="bash hljs">apt-get install libfann*</code> </pre> <br><br>  2) Add fann support in php <br>  I have Apache and the php5-dev module is installed, so I‚Äôm doing this <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># wget http://pecl.php.net/get/fann # tar xvfz fann # cd fann-0.1.1 # phpize # ./configure # make</span></span></code> </pre><br><br>  If at compilation errors appear and among them there will be such <br><br> <code>fann.c:393: error: 'zif_fannOO___set' undeclared (first use in this function)</code> <br> <br>  then you should edit the file php_fann.h and comment out line 28 # define PHP_FANN_OO 1 <br>  After that re-compile. <br><br>  As a result, we generate modules that need to be connected to php <br><pre> <code class="bash hljs">sudo cp -R ./modules/* /usr/lib/php5/20090626+lfs/</code> </pre> <br><br>  And in php.ini add <br><pre> <code class="bash hljs">extension=fann.so</code> </pre> <br><br>  Overloaded the Apache and checked that everything is OK <br><pre> <code class="bash hljs">php -m | grep fann</code> </pre> <br><br><h6>  The solution of the problem </h6><br>  For this you need to perform 2 steps: <br>  1) Teach the network (first listing) <br>  2) And use the finished model for classification (second listing) <br><br>  I will give an example for the first stage and immediately indicate a link to the <a href="http://leenissen.dk/fann/fann.html">documentation.</a> <br><br>  I gave the code as much as possible with comments, so that it would be clear what was happening and not disassemble it separately. <br><br>  <b>Train.php file</b> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/* *   . 256 -   ,      , *         ,     . * 128 -      .       . * 3    .     3 ,       * 1.0 - connection_rate -     * 0.7 - learning_rate -    http://www.basegroup.ru/glossary/definitions/learning_rate/ * */</span></span> $ann = fann_create(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-number"><span class="hljs-number">256</span></span>, <span class="hljs-number"><span class="hljs-number">128</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>), <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.7</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* *   -    ,  -  . *   3  .        . *    ,    ,    ,    *     (array(1, 0, 0) // Outputs).            * generate_frequencies -   . * *  3   * -  -  * -  -  * -     * *   en.txt, fr.txt, pl.txt    -  10000     * */</span></span> fann_train($ann, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( generate_frequencies(file_get_contents(<span class="hljs-string"><span class="hljs-string">"en.txt"</span></span>)), <span class="hljs-comment"><span class="hljs-comment">// Inputs array(1, 0, 0) // Outputs ), array( generate_frequencies(file_get_contents("fr.txt")), // Inputs array(0, 1, 0) // Outputs ), array( generate_frequencies(file_get_contents("pl.txt")), // Inputs array(0, 0, 1) // Outputs ), ), 100000, 0.00001, 1000 ); /* *     .        * */ fann_save($ann,"classify.txt"); /* *    * */ function generate_frequencies($text){ //     $text = preg_replace("/[^\p{L}]/iu", "", strtolower($text)); //      $total = strlen($text); $data = count_chars($text); //     array_walk($data, function (&amp;$item, $key, $total){ $item = round($item/$total, 3); }, $total); return array_values($data); } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br><br>  In the code above, we just generated the model.  And now let's check it in the case, the code below analyzes the text and gives an assessment of belonging to a particular language. <br><br>  Run.php file <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/* *    .       . * */</span></span> $ann = fann_create(<span class="hljs-string"><span class="hljs-string">"classify.txt"</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* *       3     *   * */</span></span> $output = fann_run($ann, generate_frequencies(<span class="hljs-string"><span class="hljs-string">"ANN are slowly adjusted so as to produce the same output as in the examples. The hope is that when the ANN is shown a new X-ray images containing healthy tissues"</span></span>)); var_dump($output); $output = fann_run($ann, generate_frequencies(<span class="hljs-string"><span class="hljs-string">"Voyons, Monsieur, absolument pas, les camions d'aujourd'hui ne se tra√Ænent pas, bien au contraire. Il leur arrive m√™me de pousser les voitures. Non, croyez moi, ce qu'il vous faut, c'est un camion ! - Vous croyez ? Si vous le dites. Est-ce que je pourrais l'avoir en rouge ? - Bien entendu cher Monsieur,vos d√©sirs sont des ordres, vous l'aurez dans quinze jours cl√© en main. Et la maison sera heureuse de vous offrir le porte-cl√©. Si vous payez comptant. Cela va sans dire, ajouta Monsieur Filou. - Ah, si ce "</span></span>)); var_dump($output); $output = fann_run($ann, generate_frequencies(<span class="hljs-string"><span class="hljs-string">"tworzƒÖc dzie≈Ço literackie, pracuje na jƒôzyku. To w≈Ça≈õnie jƒôzyk stanowi tworzywo, dziƒôki kt√≥remu powstaje tekst. Jƒôzyk literacki ( lub inaczej artystyczny) powstaje poprzez wyb√≥r odpowiednich ≈õrodk√≥w i przy wykorzystaniu odpowiednich zabieg√≥w technicznych. Kompozycja - jest to uk≈Çad element√≥w tre≈õciowych i formalnych dzie≈Ça dokonanych wed≈Çug okre≈õlonych zasad konstrukcyjnych. Kszta≈Çtowanie tworzywa dzie≈Ça literackiego jest procesem skomplikowanym i przebiegajƒÖcym na wielu poziomach. Sk≈Çada siƒô na nie:"</span></span>)); var_dump($output); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> generate_frequencies ( "tworzƒÖc dzie≈Ço literackie, pracuje na jƒôzyku. To w≈Ça≈õnie jƒôzyk stanowi tworzywo, dziƒôki kt√≥remu powstaje tekst. Jƒôzyk literacki (lub inaczej artystyczny) powstaje poprzez wyb√≥r odpowiednich ≈õrodk√≥w i przy wykorzystaniu odpowiednich zabieg√≥w technicznych. <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/* *    .       . * */</span></span> $ann = fann_create(<span class="hljs-string"><span class="hljs-string">"classify.txt"</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* *       3     *   * */</span></span> $output = fann_run($ann, generate_frequencies(<span class="hljs-string"><span class="hljs-string">"ANN are slowly adjusted so as to produce the same output as in the examples. The hope is that when the ANN is shown a new X-ray images containing healthy tissues"</span></span>)); var_dump($output); $output = fann_run($ann, generate_frequencies(<span class="hljs-string"><span class="hljs-string">"Voyons, Monsieur, absolument pas, les camions d'aujourd'hui ne se tra√Ænent pas, bien au contraire. Il leur arrive m√™me de pousser les voitures. Non, croyez moi, ce qu'il vous faut, c'est un camion ! - Vous croyez ? Si vous le dites. Est-ce que je pourrais l'avoir en rouge ? - Bien entendu cher Monsieur,vos d√©sirs sont des ordres, vous l'aurez dans quinze jours cl√© en main. Et la maison sera heureuse de vous offrir le porte-cl√©. Si vous payez comptant. Cela va sans dire, ajouta Monsieur Filou. - Ah, si ce "</span></span>)); var_dump($output); $output = fann_run($ann, generate_frequencies(<span class="hljs-string"><span class="hljs-string">"tworzƒÖc dzie≈Ço literackie, pracuje na jƒôzyku. To w≈Ça≈õnie jƒôzyk stanowi tworzywo, dziƒôki kt√≥remu powstaje tekst. Jƒôzyk literacki ( lub inaczej artystyczny) powstaje poprzez wyb√≥r odpowiednich ≈õrodk√≥w i przy wykorzystaniu odpowiednich zabieg√≥w technicznych. Kompozycja - jest to uk≈Çad element√≥w tre≈õciowych i formalnych dzie≈Ça dokonanych wed≈Çug okre≈õlonych zasad konstrukcyjnych. Kszta≈Çtowanie tworzywa dzie≈Ça literackiego jest procesem skomplikowanym i przebiegajƒÖcym na wielu poziomach. Sk≈Çada siƒô na nie:"</span></span>)); var_dump($output); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br><br><h6>  Result </h6><br>  Our model generated the following answers by text. <br>  In the first case, the model decided that she was given English at the entrance (98%) and she is right <br><pre> <code class="bash hljs">array(3) { [0]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">float</span></span>(0.98745632171631) [1]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">float</span></span>(0.0094089629128575) [2]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">float</span></span>(0) }</code> </pre><br><br>  In the second text, she decided in favor of the French and was again right <br><pre> <code class="bash hljs">array(3) { [0]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">float</span></span>(0) [1]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">float</span></span>(0.99334162473679) [2]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">float</span></span>(0) }</code> </pre><br><br>  She also correctly recognized the third text as Polish. <br><pre> <code class="bash hljs">array(3) { [0]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">float</span></span>(0.015697015449405) [1]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">float</span></span>(0) [2]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">float</span></span>(1) }</code> </pre><br><br>  Some users complain that neural networks give probabilities rather than a specific answer.  For those who are in the tank I will add that in our world everything is based on probabilities.  For the correct answer, you need to consider the one that is true at least 90%, if less then the network needs to be trained to improve the classification. <br><br>  Despite such a simple system, the neural network gives good performance.  You can make n-grams and classify them, it will be even more reliable, you can combine both options.  Neural networks are a powerful tool, you just need to learn how to use it. <br><br>  <a href="http://leenissen.dk/">Go to the FANN website</a> </div><p>Source: <a href="https://habr.com/ru/post/158729/">https://habr.com/ru/post/158729/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../158709/index.html">The official video coworking "Workstation"</a></li>
<li><a href="../158713/index.html">Programmer's letter to designers (in the process of preparing a new Winx project ...)</a></li>
<li><a href="../158717/index.html">TV online</a></li>
<li><a href="../158719/index.html">Number Recognition Systems in Practice</a></li>
<li><a href="../158725/index.html">Accelerate VBA work in Excel</a></li>
<li><a href="../158731/index.html">PostgreSQL - Asynchronous Replication + Pooling + Failover</a></li>
<li><a href="../158733/index.html">Q & A with Alexander Guest</a></li>
<li><a href="../158737/index.html">Last Ya.Subbotnik Year: St. Petersburg</a></li>
<li><a href="../158741/index.html">Found the remains of a pigeon with a cryptogram of World War II</a></li>
<li><a href="../158743/index.html">How to port libcURL to Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>