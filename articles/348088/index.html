<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to add your meter to PRTG. And briefly about sensor formats with examples on powershell</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Why not add performance indicators from 1C (and anything else at all) to the monitoring system? As we studied, it turned out that you can derive from ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to add your meter to PRTG. And briefly about sensor formats with examples on powershell</h1><div class="post__text post__text-html js-mediator-article">  Why not add performance indicators from 1C (and anything else at all) to the monitoring system?  As we studied, it turned out that you can derive from scripts, batch files, VB scripts, executable files, via SSH, direct execution of sql queries and a whole bunch of ways.  In order not to get a huge sheet in this article there will be only a minimum of what you need to screw the counters to PRTG with examples on powershell. <br><br><img src="https://habrastorage.org/webt/-x/je/jm/-xjejm3bjb7sjb7zwhde9zxblm8.jpeg"><br><br>  In fact, everything is very simple. <br><a name="habracut"></a><br><blockquote><div class="spoiler">  <b class="spoiler_title">There is a little magic to make PowerShell counters in PRTG</b> <div class="spoiler_text">  after the counter is created it may turn out that it does not give out numbers, although everything is fine in the console or during manual start.  And the fact is that PRTG runs scripts from under "itself", it can: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  not have access rights </li><li>  running scripts in the system may be prohibited </li><li>  Script launch in <b>x86</b> version may be prohibited, and in <b>x64</b> allowed </li></ul><br>  You need to start with the last two points.  You can check the script startup policy with the command <pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-ExecutionPolicy</code> </pre> <br>  If she returned <b>Restricted,</b> then you need to allow running scripts on this system by running the command from the administrative console. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>-ExecutionPolicy Unrestricted</code> </pre> <br>  For those who want security - sign scripts even with a local certificate and install the <b>AllSigned</b> policy. <br><br>  After installing the script launch policy, make sure that everything is correct, for those who have a 32-bit version of PowerShell, install the policy in it, too, since  PRTG can try to run your script from the 32-bit version.  (More precisely, it will do so if there is a <b>PowerShell x86</b> version), the launch policies are different, and if you install it in 64-bit, you can forget that in 32 it remains.  Just run under the admin Powershell x86 and make the same settings in it. <br><br>  The problem of rights is solved more simply - we set the rights to <b>everyone</b> and if it works, it means that it is not enough.  If the script has an alternative ntfs in the properties, then it should be removed <br><br><img src="https://habrastorage.org/webt/4g/tk/9j/4gtk9j5yzmhjo8k20yt2lqmi9bu.jpeg"><br></div></div></blockquote><br><h2>  First, a little theory about how the sensors are arranged. </h2><br>  In <b>PRTG,</b> there are several types of sensors added manually, let's call them <b>‚Äúsimple sensor‚Äù</b> and <b>‚Äúcomplex sensor‚Äù</b> . <br><br><h2>  1. Simple sensor </h2><br>  A simple sensor returns only one number and a message to the system; <br><br><pre> <code class="hljs css">12345<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ok</span></span> #  ,   12345 <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ok</span></span></code> </pre><br>  The number must be a 64-bit integer or fractional, the message after the colon is not more than 2000 characters long. <br><br>  The message after the colon is the line that appears in the header on a color field. <br><br><img src="https://habrastorage.org/webt/s4/o7/ns/s4o7nswrcd-ro0okd5bsuzeyyyu.jpeg"><br><br>  It is possible to designate a counter to do so. <br><br><pre> <code class="hljs css">1000 <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:To</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">low</span></span> 2000 <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ok</span></span> 5000 <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:To</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">high</span></span></code> </pre><br>  In this case, you will change the message in the <b>Last Message</b> field but the color will not change.  How to change the background color below in the <b>exit codes</b> . <br><br>  From the program or script, to interact you only need to give out the text and that's it.  I usually suppress the output of any messages, and throw out only the line.  Below is an example: <br><br><pre> <code class="hljs mel">#  <span class="hljs-number"><span class="hljs-number">1</span></span>   <span class="hljs-number"><span class="hljs-number">30</span></span>      #    $FileName = <span class="hljs-string"><span class="hljs-string">'C:\PRTG\sales_today.txt'</span></span> #    $ErrorActionPreference = <span class="hljs-string"><span class="hljs-string">'SilentlyContinue'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((Test-Path $FileName) -eq $false) { Write-Host <span class="hljs-string"><span class="hljs-string">"0 :Error"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $Val = Get-Content $FileName | <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> -First <span class="hljs-number"><span class="hljs-number">1</span></span> #     ,     #        ( ) $Val = [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]$Val + <span class="hljs-string"><span class="hljs-string">":Ok"</span></span> Write-Host $Val #   $Val #    exit <span class="hljs-number"><span class="hljs-number">0</span></span> }</code> </pre><br><h4>  exit codes - paint the sensors on the panel </h4><br>  To get the right kind of dashboard, and not just digital values, you need to return the exit codes from the script.  We can then transfer not just numbers but also color sensors by colors. <br><br><img src="https://habrastorage.org/webt/s_/0v/hf/s_0vhfs810axqfxvtvnms6rsbio.jpeg"><br><br>  All you need to do to PRTG displayed in the right color is to return the parameter at the output, in powershell this is done by the command at the output. <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta">#      exit 0</span></span></code> </pre> <br>  The PRTG has the following codes. <br><table border="1"><tbody><tr><th>  Value </th><th>  Description </th></tr><tr><td>  0 </td><td>  all is well.  The sensor in dashborde is colored green.  The last message is highlighted in green. <br><img src="https://habrastorage.org/webt/zw/mg/t0/zwmgt07pu_sr9-ntb1ukhak9de8.jpeg"></td></tr><tr><td>  one </td><td>  Attention.  The sensor is painted yellow.  The last message is tinted yellowish <br><img src="https://habrastorage.org/webt/ac/s8/ag/acs8agw_dx-mibjx8l-ez-btnac.jpeg"></td></tr><tr><td>  2 </td><td>  System error.  The sensor is painted red.  The last message is highlighted in red.  The message is logged to the <b>alert.</b> <br><img src="https://habrastorage.org/webt/rv/2v/ou/rv2voux0jqg-lb7ss3haup79wzk.jpeg"></td></tr><tr><td>  3 </td><td>  Protocol error (for example, web server returns 404).  The sensor is painted red.  The last message is red.  Alert is highlighted.  Protocol Error string added <br><img src="https://habrastorage.org/webt/2m/6n/9p/2m6n9pkqxfwi9e2rb5ieg20hhyu.jpeg"></td></tr><tr><td>  four </td><td>  The sensor is painted red.  The last message is red.  Alert is registered.  Before the message appears Content Error <br><img src="https://habrastorage.org/webt/j7/uh/6v/j7uh6v5jtvsuhv0fss3cfxvezho.jpeg"></td></tr></tbody></table><br>  In principle, this is all you need to know about simple sensors to get started. <br><br><h2>  2. Complicated sensor </h2><br>  A complex sensor must throw out the data in a certain format, because  There can be many channels on a single graph, scaling of values, a caption to them, etc. The <b>XML</b> or <b>JSON format is used</b> .  The output for <b>XML</b> should be something like this. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">prtg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">result</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span>100<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">result</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">result</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span>200<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">result</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">prtg</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  In the search, the part responsible for the output will look like this: <br><br><pre> <code class="hljs xml">"<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">prtg</span></span></span><span class="hljs-tag">&gt;</span></span>" "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">result</span></span></span><span class="hljs-tag">&gt;</span></span>" "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channel</span></span></span><span class="hljs-tag">&gt;</span></span>Total all accounts<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channel</span></span></span><span class="hljs-tag">&gt;</span></span>" "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span>$TotalAllAccountsBeg<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span>" "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CustomUnit</span></span></span><span class="hljs-tag">&gt;</span></span>RUB<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CustomUnit</span></span></span><span class="hljs-tag">&gt;</span></span>" "<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">result</span></span></span><span class="hljs-tag">&gt;</span></span>" "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">result</span></span></span><span class="hljs-tag">&gt;</span></span>" "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channel</span></span></span><span class="hljs-tag">&gt;</span></span>Total all accounts income<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channel</span></span></span><span class="hljs-tag">&gt;</span></span>" "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span>$TotalAllAccountsIncome<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span>" "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CustomUnit</span></span></span><span class="hljs-tag">&gt;</span></span>RUB<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CustomUnit</span></span></span><span class="hljs-tag">&gt;</span></span>" "<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">result</span></span></span><span class="hljs-tag">&gt;</span></span>" "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">result</span></span></span><span class="hljs-tag">&gt;</span></span>" "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channel</span></span></span><span class="hljs-tag">&gt;</span></span>Total all account outcome<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channel</span></span></span><span class="hljs-tag">&gt;</span></span>" "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span>$TotalAllAccountsOutcome<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span>" "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CustomUnit</span></span></span><span class="hljs-tag">&gt;</span></span>RUB<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CustomUnit</span></span></span><span class="hljs-tag">&gt;</span></span>" "<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">result</span></span></span><span class="hljs-tag">&gt;</span></span>" "<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">prtg</span></span></span><span class="hljs-tag">&gt;</span></span>"</code> </pre><br>  I'm not even trying to make an <b>Out-String</b> , just a direct output, that's all.  We remember about the rake, each variable must contain only one value and nothing else, otherwise you will get the wrong conclusion, it‚Äôs better to clearly see the type. <br><br>  For <b>JSON, it</b> should look something like this: <br><br><pre> <code class="xml hljs"> { "prtg": { "result": [ { "channel": " ", "value": "100" }, { "channel": " ", "value": "20" } ] } }</code> </pre><br>  Now let's see the most important tags <b>(all tags are case-sensitive)</b> . <br><blockquote>  <b>&lt;Channel&gt;</b> <br>  required <br>  The channel name displayed in the user interface must be unique for each sensor in one sensor. There must not be 2 identical channel names. <br>  value: any string <br><br>  <b>&lt;Value&gt;</b> <br>  required <br>  integer or fractional value.  If the PRTG cannot recognize it, it will display 0. Therefore, just check the output format, whether you output it correctly <br>  value: integer or fractional <br><br>  <b>&lt;CustomUnit&gt;</b> <br>  not <br>  if selected, this line is displayed below the numbers <br>  for example RUB <br>  value: any string, better short <br><br>  <b>&lt;Unit&gt;</b> <br>  not obligatory <br>  If you want a built-in unit of measurement, you need to specify one of the built-in units.  PRTG can understand time and scale some values ‚Äã‚Äã(bytes - megabytes) <br>  value: <br>  BytesBandwidth <br>  Bytes memory <br>  Bytesdisk <br>  Temperature <br>  Percent <br>  Timeresponse <br>  Timeseconds <br>  Custom <br>  Count <br>  CPU (*) <br>  Bytesfile <br>  Speeddisk <br>  Speednet <br>  Timehours </blockquote>  Full list of tags <a href="https://prtg.paessler.com/api.htm%3Fusername%3Ddemo%26password%3Ddemodemo%26tabid%3D7">here</a> . <br><br><h4>  Working example issuing xml for PRTG </h4><br>  Now an example of the script that makes the data output in the PRTG format.  We assume that 1C-ka uploads every N minutes data into a text file on disk, the contents of a text file data.txt with source data: <br><br><pre> <code class="tex hljs">: 10 000 000,06     : 8 000 000,93    : 0    : 0     : 8 000 000,93    : 2 000 000,4   : 0   : 0    : 2 000 000,4   : 30 000,04  : 20 000,11  : 0   : 50 000,15</code> </pre><br>  Then the script will look like this: <br><br><pre> <code class="hljs mel">$FileName = <span class="hljs-string"><span class="hljs-string">'C:\PRTG\data.txt'</span></span> #    $ErrorActionPreference = <span class="hljs-string"><span class="hljs-string">'SilentlyContinue'</span></span> # .. <span class="hljs-number"><span class="hljs-number">1</span></span>-          #   ,       function Get-Data{ Param( [parameter(Mandatory=$true)] [String] $SourceString ) $str = <span class="hljs-string"><span class="hljs-string">''</span></span> $str = $SourceString.Split(<span class="hljs-string"><span class="hljs-string">':'</span></span>) $str = $str[<span class="hljs-number"><span class="hljs-number">1</span></span>] $str = $str.split(<span class="hljs-string"><span class="hljs-string">','</span></span>) $str = $str[<span class="hljs-number"><span class="hljs-number">0</span></span>] $str = $str -replace <span class="hljs-string"><span class="hljs-string">'\s'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $str } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((Test-Path $FileName) -eq $false) { exit <span class="hljs-number"><span class="hljs-number">3</span></span> } $File = Get-Content $FileName | Select-String <span class="hljs-string"><span class="hljs-string">":"</span></span> $SalesToday = Get-Data $File $File = Get-Content $FileName | Select-String <span class="hljs-string"><span class="hljs-string">"    :"</span></span> $AccVTBBeg = Get-Data $File $File = Get-Content $FileName | Select-String <span class="hljs-string"><span class="hljs-string">"   :"</span></span> $AccVTBincome = Get-Data $File $File = Get-Content $FileName | Select-String <span class="hljs-string"><span class="hljs-string">"   :"</span></span> $AccVTBoutcome = Get-Data $File $File = Get-Content $FileName | Select-String <span class="hljs-string"><span class="hljs-string">"    :"</span></span> $AccVTBCurr = Get-Data $File $File = Get-Content $FileName | Select-String <span class="hljs-string"><span class="hljs-string">"   :"</span></span> $AccGosBeg = Get-Data $File $File = Get-Content $FileName | Select-String <span class="hljs-string"><span class="hljs-string">"  :"</span></span> $AccGosincome = Get-Data $File $File = Get-Content $FileName | Select-String <span class="hljs-string"><span class="hljs-string">"  :"</span></span> $AccGosoutcome = Get-Data $File $File = Get-Content $FileName | Select-String <span class="hljs-string"><span class="hljs-string">"   :"</span></span> $AccGosCurr = Get-Data $File $File = Get-Content $FileName | Select-String <span class="hljs-string"><span class="hljs-string">"  :"</span></span> $AccKassaBeg = Get-Data $File $File = Get-Content $FileName | Select-String <span class="hljs-string"><span class="hljs-string">" :"</span></span> $AccKassaincome = Get-Data $File $File = Get-Content $FileName | Select-String <span class="hljs-string"><span class="hljs-string">" :"</span></span> $AccKassaoutcome = Get-Data $File $File = Get-Content $FileName | Select-String <span class="hljs-string"><span class="hljs-string">"  :"</span></span> $AccKassaCurr = Get-Data $File $TotalAllAccountsBeg = [<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]$AccVTBBeg + [<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]$AccGosBeg + [<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]$AccKassaBeg $TotalAllAccountsIncome = [<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]$AccVTBincome + [<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]$AccGosincome + [<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]$AccKassaincome $TotalAllAccountsOutcome = [<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]$AccVTBoutcome + [<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]$AccGosoutcome + [<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]$AccKassaoutcome $TotalAllAccountsCurr = [<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]$AccVTBCurr + [<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]$AccGosCurr + [<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]$AccKassaCurr <span class="hljs-string"><span class="hljs-string">"&lt;prtg&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;result&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;channel&gt;Total all accounts&lt;/channel&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;value&gt;$TotalAllAccountsBeg&lt;/value&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;CustomUnit&gt;RUB&lt;/CustomUnit&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;/result&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;result&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;channel&gt;Total all accounts income&lt;/channel&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;value&gt;$TotalAllAccountsIncome&lt;/value&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;CustomUnit&gt;RUB&lt;/CustomUnit&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;/result&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;result&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;channel&gt;Total all account outcome&lt;/channel&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;value&gt;$TotalAllAccountsOutcome&lt;/value&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;CustomUnit&gt;RUB&lt;/CustomUnit&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;/result&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;result&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;channel&gt;Total all account current&lt;/channel&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;value&gt;$TotalAllAccountsCurr&lt;/value&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;CustomUnit&gt;RUB&lt;/CustomUnit&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;/result&gt;"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;/prtg&gt;"</span></span></code> </pre><br>  The script is ready, how the sensor is arranged is clear to us, now let's tie it all up and launch it. <br><br><h2>  Now fasten custom sensors to PRTG </h2><br>  On the server with PRTG there is a directory <b>"C: \ Program Files (x86) \ PRTG Network Monitor \ Custom Sensors"</b> in it we are interested in 2 directories: <br><br><ol><li>  <b>Exe</b> for simple sensors <br></li><li>  <b>EXEXML</b> for complex sensors. </li></ol><br>  We throw our script into the EXEXML directory. <br>  Next, as usual we add the sensor: <br><br><img src="https://habrastorage.org/webt/zw/fn/vu/zwfnvubtfelcwydv5gaimg2n534.jpeg"><br><br>  We indicate that the sensor will be custom, of the <b>exe \ script advanced type</b> : <br><br><img src="https://habrastorage.org/webt/gm/wl/t4/gmwlt4ckhpqdanwfd2_vin525mk.jpeg"><br><br>  We change the name to understand, click the arrow and see the scripts from the <b>EXEXML</b> directory.  Attention, there is a lower value - <b>Discard EXE result</b> , this means that PRTG by executing the script will reset its output, for debugging you can switch it to position - <b>write to disk</b> , the result will be in the <b>C: \ ProgramData \ Paessler \ PRTG Network Monitor \ Logs</b> directory <b>\ sensor name</b> . <br><br><img src="https://habrastorage.org/webt/xg/q4/1d/xgq41dkxpxhlprydjxd7q2ltim8.jpeg"><br><br>  According to the results we get what we need. <br><br>  Related Links: <br><br><ul><li>  <a href="https://www.paessler.com/manuals/prtg/additional_sensor_types">time</a> </li><li>  <a href="https://prtg.paessler.com/api.htm%3Fusername%3Ddemo%26password%3Ddemodemo%26tabid%3D7">two</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/348088/">https://habr.com/ru/post/348088/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../348070/index.html">Creating NPM-module Yandex. Cash registers for Node.js - the experience of Lodoss Team</a></li>
<li><a href="../348074/index.html">Why is an early return from a function so important?</a></li>
<li><a href="../348078/index.html">The development of hyper-convergent technologies: a new version of HyperFlex 3.0 from Cisco</a></li>
<li><a href="../348080/index.html">Attention, update Firefox to version 58.0.1 to close the critical vulnerability</a></li>
<li><a href="../348086/index.html">GitLab 10.4 released with dynamic testing of application security and a beta version of the Web IDE</a></li>
<li><a href="../348090/index.html">Why it is important not to postpone the installation and configuration of CMS Bitrix based on "1C-Bitrix: Virtual Machine"</a></li>
<li><a href="../348092/index.html">Robots instead of the best employees: machine learning for expert answers</a></li>
<li><a href="../348094/index.html">Cisco ASA Firewall Critical Vulnerability Allows Remote Code Execution</a></li>
<li><a href="../348096/index.html">Orgi among programmers</a></li>
<li><a href="../348098/index.html">Why is it important to check that the malloc function returned</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>