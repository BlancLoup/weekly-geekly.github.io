<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make friends Yandex maps with Google and OSM?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I have a project that works on the basis of maps from Yandex. I chose them because there is documentation in Russian, good quality maps of our cities ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make friends Yandex maps with Google and OSM?</h1><div class="post__text post__text-html js-mediator-article"> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/87/c1/87c1d975d3cdd35b172007ce1f12ec16.png"></a> <br><br>  I have a project that works on the basis of maps from Yandex.  I chose them because there is documentation in Russian, good quality maps of our cities and a nice interface.  Later, as it turned out, there are also great opportunities. <br>  And so I noticed that some places in Yandex satellite show on a too small scale that it is not suitable for building routes. <br>  Initially, I made two separate files with scripts, in one of which - there was the logic of working with Yandex, and in the second - with Google.  Switching occurred in the profile and acted on the entire site, and all work with the maps on the site was in pseudocode (proxy). <br>  Esosedi.ru used just such an approach with switching cards, but without rebooting.  However, this option did not suit me because the markers and broken lines are used, besides, it is difficult to maintain two different files. <br><br>  And so I decided to look for another option. <br><a name="habracut"></a><br><h2>  Option 1. Download tiles </h2><br>  I will not attribute myself to someone else.  I found this option in the club of Yandex maps <a href="">clubs.ya.ru/mapsapi/replies.xml?item_no=7125</a> .  Having reworked all the logic for this option and, having added OSM, I was glad that everything was ready and was already thinking about something else, but then I saw with horror that the maps were displayed incorrectly.  The coordinates are the same, but somewhere in the maps are not loaded, there are gray places, then above, then below.  The problem was that not only the latitude and longitude are confused, but fundamentally different coordinate systems are used.  When recalculated to Google coordinates, it was necessary to move the tiles vertically by a certain amount.  That's just this value and was a gray area. <br>  On the Internet, they wrote that this option is not treated.  I tried to zoom the map vertically above and below, but hide it.  After I already saw that not only gray stripes appear from above, but straight on the map, the line of squares can not be loaded.  However, I left this option not because. <br>  Google allows you to use your tiles only through the API, so you have to create a map anyway, but how do you map the labels of one map to another? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Option 2. Copy tiles </h2><br>  The plan was that. <br>  A copy of the Google map is created somewhere far away, or rather, either with a negative index, or with a negative value of top or left.  After that, an event handler is hung on the Yandex map, which, when the Yandex map moves, moves the Google map.  The Google map has a motion handler, in which the divs with maps are copied into the Yandex map div with the class ‚ÄúYMaps-tile-container‚Äù, in which the Yandex tiles are located. <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">GEvent.addListener(gmap, <font color="#A31515">"move"</font> , <font color="#0000ff">function</font> (overlay, latlng) { <br> <font color="#0000ff">var</font> point = gmap.getCenter(); <br> $layer = $( <font color="#A31515">'#googlemap div img'</font> ).parent().parent().parent(); <br> $( <font color="#A31515">'.GMaps-tile-container'</font> ).html($layer.html()).width($layer.width()).height($layer.height()); <br> $( <font color="#A31515">'.GMaps-tile-container'</font> ).css( <font color="#A31515">'left'</font> ,$( <font color="#A31515">'.YMaps-tile-container'</font> ).css( <font color="#A31515">'left'</font> )) <br> .css( <font color="#A31515">'top'</font> ,$( <font color="#A31515">'.YMaps-tile-container'</font> ).css( <font color="#A31515">'top'</font> )) <br> .css( <font color="#A31515">'width'</font> ,$( <font color="#A31515">'.YMaps-tile-container'</font> ).css( <font color="#A31515">'width'</font> )) <br> .css( <font color="#A31515">'height'</font> ,$( <font color="#A31515">'.YMaps-tile-container'</font> ).css( <font color="#A31515">'height'</font> )); <br> $( <font color="#A31515">'.YMaps-tile-container'</font> ).hide(); <br> }, <font color="#0000ff">this</font> ); <br> GEvent.addListener(gmap, <font color="#A31515">"tilesloaded"</font> , <font color="#0000ff">function</font> (overlay, latlng) { <br> <font color="#0000ff">var</font> point = gmap.getCenter(); <br> $layer = $( <font color="#A31515">'#googlemap div img'</font> ).parent().parent().parent(); <br> $( <font color="#A31515">'.GMaps-tile-container'</font> ).html($layer.html()).width($layer.width()).height($layer.height()); <br> $( <font color="#A31515">'.GMaps-tile-container'</font> ).css( <font color="#A31515">'left'</font> ,$( <font color="#A31515">'.YMaps-tile-container'</font> ).css( <font color="#A31515">'left'</font> )) <br> .css( <font color="#A31515">'top'</font> ,$( <font color="#A31515">'.YMaps-tile-container'</font> ).css( <font color="#A31515">'top'</font> )) <br> .css( <font color="#A31515">'width'</font> ,$( <font color="#A31515">'.YMaps-tile-container'</font> ).css( <font color="#A31515">'width'</font> )) <br> .css( <font color="#A31515">'height'</font> ,$( <font color="#A31515">'.YMaps-tile-container'</font> ).css( <font color="#A31515">'height'</font> )); <br> <br> }, <font color="#0000ff">this</font> ); <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  With a small card size, everything works quite well, but it is worth opening to the full screen, how the full paragraph begins here. <br><br><h2>  Option 3. Move the map </h2><br>  The next option that came to mind was to simply move a card that would be inside another card. <br>  Google map itself is created in the diva with the class "YMaps-tile-container".  A div with Yandex tiles hides, or rather does not hide, but receives transparency 0, because it is this div that processes all movements of the map. <br>  Add an event handler to the map of Yandex.  When the Yandex map moves, the Yandex map center will synchronize with the Google map. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">YMaps.Events.observe(map, map.Events.Move, <font color="#0000ff">function</font> (oMap, offset) { <br> gmap.setCenter( <font color="#0000ff">new</font> GLatLng(map.getCenter().getLat(), map.getCenter().getLng()), map.getZoom()); <br> }); <br> YMaps.Events.observe(map, map.Events.BoundsChange, <font color="#0000ff">function</font> () { <br> gmap.setCenter( <font color="#0000ff">new</font> GLatLng(map.getCenter().getLat(), map.getCenter().getLng()), map.getZoom()); <br> });</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  We try ... And again, with a small card size, everything works well, but when deployed, noticeable inhibition and unpleasant artifacts begin. <br>  Perhaps this is due to the fact that Yandex maps are being loaded in parallel, even though they are not visible.  Create an empty card type and install it. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">var</font> none = <font color="#0000ff">new</font> YMaps.TileDataSource( <font color="#A31515">''</font> , <font color="#0000ff">false</font> , <font color="#0000ff">false</font> ); <br> <font color="#0000ff">var</font> tnone = <font color="#0000ff">function</font> () { <font color="#0000ff">return</font> <font color="#0000ff">new</font> YMaps.Layer(none)}; <br> YMaps.Layers.add( <font color="#A31515">"none#layer"</font> , tnone); <br> map.setType( <font color="#0000ff">new</font> YMaps.MapType([ <font color="#A31515">"none#layer"</font> ], <font color="#A31515">''</font> ,{minZoom:1, maxZoom:17}));</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Again we try and again it slows down.  Experimentally, I found out that the main inhibition is due to the fact that Yandex, when moving the card, is smoothly slowing down.  After a long search, I did not find how to turn it off, which means this option is not suitable. <br><br><h2>  Option 3.1.  Use moveBy </h2><br>  Here on this page <a href="http://api.yandex.ru/maps/jsapi/examples/synhromaps.html">api.yandex.ru/maps/jsapi/examples/synhromaps.html</a> is an example of how to synchronize two Yandex cards with each other.  Instead of centering, there is used a shift by a certain interval (apparently this option reduces the load).  Google maps has exactly the same function, but the shift values ‚Äã‚Äãof Yandex maps are not suitable.  After several experiments, I left this venture. <br><br><h2>  Option 4. Move the markers </h2><br>  If the option with the movement of tiles is not rolled due to the heavy load, then the option with the movement of objects should be better. <br>  The plan is similar to option 3, with one exception: the event handler should be handled by the Google map handler.  To do this, hide the Yandex layers responsible for handling events. <br>  And here we are in for disappointment.  For unknown reasons, Google maps in this embodiment only process mouse clicks, but not move and release.  And how many hours I spent on the search results do not count. <br>  After much experimentation in attempts to remove the standard Yandex Map handlers, it turned out that it was necessary to do a little differently and it would work. <br>  First you need to transfer Google maps from the YMaps-tile-container diva to the very root, that is, to the div in which the Yandex map itself is created.  Now the map is covered with a gray background.  Set the background diva value with the ‚ÄúYMaps-layer-container‚Äù class to transparent.  Now we see both the map and objects, but Google does not receive events.  Set the z-index google maps to 1, while the diva ‚ÄúYMaps-layer-container‚Äù will put auto.  We try ... Done! <br><br>  And the wolves are fed and the sheep are safe! <br><br>  Everything fit into two functions, the code of which can be seen below. <br>  Here you can connect and OSM. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">//   .</font> <br> <font color="#0000ff">function</font> unbindGoogleMap() <br> { <br> $( <font color="#A31515">'#googlemap'</font> ).hide(); <br> $( <font color="#A31515">'.YMaps-map-type-layer-container'</font> ).show(); <br> $( <font color="#A31515">'.YMaps-layer YMaps-common-object-layer'</font> ).show(); <br> <font color="#0000ff">if</font> (mapevents[0]) <br> mapevents[0].cleanup(); <br> } <br> /   Google  <br> <font color="#0000ff">function</font> bindGoogleMap(type) <br> { <br> <font color="#0000ff">var</font> selector = <font color="#A31515">'#'</font> +$(map.getContainer()).attr( <font color="#A31515">'id'</font> ); <br> map.setType( <font color="#0000ff">new</font> YMaps.MapType([ <font color="#A31515">"none#layer"</font> ], <font color="#A31515">''</font> ,{minZoom:1, maxZoom:17})); <br> map.redraw(); <br> <font color="#0000ff">if</font> ($( <font color="#A31515">'#googlemap'</font> ).length==0) <br> { <br> <font color="#0000ff">var</font> $div = $( <font color="#A31515">'&lt;div&gt;'</font> ).attr( <font color="#A31515">'id'</font> , <font color="#A31515">'googlemap'</font> ).width($(selector).width()).height($(selector).height()).css({zIndex:1}); <br> $( <font color="#A31515">'#routemap'</font> ).prepend($div); <br> } <br> $( <font color="#A31515">'#googlemap'</font> ).show(); <br> $( <font color="#A31515">'.YMaps-layer-container'</font> ).css({background: <font color="#A31515">'transparent'</font> ,zIndex: <font color="#A31515">'auto'</font> }); <br> $( <font color="#A31515">'.YMaps-map-type-layer-container'</font> ).hide(); <br> $( <font color="#A31515">'.YMaps-layer YMaps-common-object-layer'</font> ).hide(); <br> <font color="#0000ff">if</font> (!gmap) <br> { <br> gmap = <font color="#0000ff">new</font> GMap2( <font color="#0000ff">document</font> .getElementById( <font color="#A31515">'googlemap'</font> )); <br> gmap.enableContinuousZoom(); <br> gmap.enableScrollWheelZoom(); <br> } <br> <font color="#0000ff">switch</font> (type) <br> { <br> <font color="#0000ff">case</font> <font color="#A31515">'gotsat'</font> : <font color="#0000ff">case</font> 4: <br> gmap.setMapType(G_SATELLITE_MAP);; <br> <font color="#0000ff">break</font> ; <br> <font color="#0000ff">case</font> <font color="#A31515">'gothyb'</font> : <font color="#0000ff">case</font> 5: <br> gmap.setMapType(G_HYBRID_MAP);; <br> <font color="#0000ff">break</font> ; <br> <font color="#0000ff">case</font> <font color="#A31515">'gotrel'</font> : <font color="#0000ff">case</font> 6: <br> gmap.setMapType(G_PHYSICAL_MAP);; <br> <font color="#0000ff">break</font> ; <br> <font color="#0000ff">default</font> : gmap.setMapType(G_NORMAL_MAP); <br> } <br> gmap.setCenter( <font color="#0000ff">new</font> GLatLng(map.getCenter().getLat(), map.getCenter().getLng()), map.getZoom()); <br> <font color="#008000">// </font> <br> GEvent.addListener(gmap, <font color="#A31515">"move"</font> , <font color="#0000ff">function</font> (overlay, latlng) { <br> map.setCenter( <font color="#0000ff">new</font> YMaps.GeoPoint(gmap.getCenter().lng(), gmap.getCenter().lat()), gmap.getZoom()); <br> }, <font color="#0000ff">this</font> ); <br> <font color="#008000">//-   </font> <br> GEvent.addListener(gmap, <font color="#A31515">"update"</font> , <font color="#0000ff">function</font> (overlay, latlng) { <br> map.setCenter( <font color="#0000ff">new</font> YMaps.GeoPoint(gmap.getCenter().lng(), gmap.getCenter().lat()), gmap.getZoom()); <br> }, <font color="#0000ff">this</font> ); <br> <font color="#008000">//    </font> <br> mapevents[0] = YMaps.Events.observe(map, map.Events.BoundsChange, <font color="#0000ff">function</font> () { <br> gmap.setCenter( <font color="#0000ff">new</font> GLatLng(map.getCenter().getLat(), map.getCenter().getLng()), map.getZoom()); <br> }); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/64/b6/64b634d7777940e4a4cc489acaa64f1c.png"></a> <br><br>  That's all.  A live example can be seen on the site <a href="http://bikecamp.ru/map/">bikecamp.ru/map</a> </div><p>Source: <a href="https://habr.com/ru/post/116057/">https://habr.com/ru/post/116057/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../116051/index.html">The New York Times cuts back on free viewing.</a></li>
<li><a href="../116053/index.html">New HP servers on AMD processors: SL165s G7 and SL335s G7</a></li>
<li><a href="../116054/index.html">Meeting of the Innovators Club in St. Petersburg (medicine and IT in medicine)</a></li>
<li><a href="../116055/index.html">Sign up for free training March 29 for Windows Azure</a></li>
<li><a href="../116056/index.html">Denial of service attack with slow HTTP POST</a></li>
<li><a href="../116058/index.html">Archeology Digg</a></li>
<li><a href="../116060/index.html">Bring your own computer to work</a></li>
<li><a href="../116063/index.html">Say no to dropping Adobe Flash in web browsers on 64-bit platforms</a></li>
<li><a href="../116065/index.html">Il-2 Sturmovik: Battle for Britain. Special material</a></li>
<li><a href="../116066/index.html">How a good contract saves nerves and a coin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>