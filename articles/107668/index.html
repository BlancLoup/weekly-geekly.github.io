<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to connect two asterisk servers (part one. SIP)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="So, we have two asterisks. 
 The task is to organize direct dialing through the prefix there and back. 
 Initial data: 
 Asterisk 1.4 at both ends 
 k...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to connect two asterisk servers (part one. SIP)</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/geektimes/post_images/8d4/3ce/88a/8d43ce88a466af8f5cfbef7ee227dc7e.png" alt="image">  So, we have two asterisks. <br>  The task is to organize direct dialing through the prefix there and back. <br>  Initial data: <br>  Asterisk 1.4 at both ends <br>  kazan.asterisk.ru is the name of the first asterisk. <br>  volgograd.asterisk.ru - the name of the second asterisk. <br>  It is assumed that both asterisks have direct access to the Internet (otherwise, there should be no problems, you need to configure NAT and use the nat = yes parameter) <br><br>  Let the 1st asterisk be in Kazan, the other in Volgograd.  Let us turn to the car codes of the regions. <br>  Then dialing from Volgograd will be 9-16- &lt;number&gt;. <br>  From Kazan 9-34- &lt;number&gt;. <br><a name="habracut"></a><br>  <b>sip.conf 1st Asterisk:</b> <br> <code>[general] <br> context=default <br> allowguest=no <br> bindport=5060 <br> bindaddr=0.0.0.0 <br> <br> ;      - <br> register =&gt; kazan:kazan_password@volgograd.asterisk.ru:5060 <br> <br> [volgograd] <br> ;      <br> username=volgograd <br> secret=volgograd_password <br> ;      <br> type=friend <br> <br> ;     INVITE <br> canreinvite=no <br> ;   .  <br> insecure=very <br> ;     <br> qualify=yes <br> <br> ;   <br> ; (www.voip-info.org): If you want the phone to register itself, use the keyword dynamic instead of Host IP. <br> ;     deny,permit <br> host=dynamic <br> <br> ;DTMF <br> dtmfmode=rfc2833 <br> <br> ;   <br> disallow=all <br> allow=alaw <br> allow=ulaw <br> <br> ;        <br> context=office_rules <br></code> <br><br>  <b>extension.conf 1 st asterisk:</b> <br> <code>;    <br> [office] <br> exten =&gt; _934.,1,Set(CALLERID(all)="Kazan &lt;16&gt;") <br> exten =&gt; _934.,n,Dial(SIP/${EXTEN:3}@volgograd,60,r) <br> exten =&gt; _934.,n,HangUp <br> .. <br> <br> include =&gt; office_rules <br> <br> ;     <br> ;     1XX  2XX <br> [office_rules] <br> exten =&gt; _[12]XX,1,Dial(SIP/${EXTEN},60,tTr) <br> exten =&gt; _[12]XX,n,HangUp() <br> <br></code> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>sip.conf 2nd Asterisk:</b> <br> <code>[general] <br> context=default <br> allowguest=no <br> bindport=5060 <br> bindaddr=0.0.0.0 <br> <br> ;      - <br> register =&gt; volgograd:volgograd_password@kazan.asterisk.ru:5060 <br> <br> [kazan] <br> type=friend <br> <br> ; credentials for registration <br> username=kazan <br> secret=kazan_password <br> <br> ;   <br> ; (www.voip-info.org): If you want the phone to register itself, use the keyword dynamic instead of Host IP. <br> ;     deny,permit <br> host=dynamic <br> <br> ;     INVITE <br> canreinvite=no <br> ;   .  <br> insecure=very <br> ;     <br> qualify=yes <br> <br> ; DTMF <br> dtmfmode=rfc2833 <br> <br> ;   ( G711) <br> disallow=all <br> allow=ulaw <br> allow=alaw <br> <br> ;      <br> context=office_rules <br> <br></code> <br><br>  <b>extension.conf 2nd Asterisk:</b> <br> <code>;    <br> [office] <br> exten =&gt; _916.,1,Set(CALLERID(all)="Volgograd &lt;34&gt;") <br> exten =&gt; _916.,n,Dial(SIP/${EXTEN:3}@kazan,60,r) <br> exten =&gt; _916.,n,HangUp <br> .. <br> <br> include =&gt; office_rules <br> <br> ;     <br> ;     1XX  2XX <br> [office_rules] <br> exten =&gt; _[12]XX,1,Dial(SIP/${EXTEN},60,tTr) <br> exten =&gt; _[12]XX,n,HangUp() <br> <br></code> <br><br>  Ps.  I would appreciate tips on extending functionality and security. <br><br>  upd: In any case, in terms of the security aspect, you need to look at <a href="http://blogs.digium.com/2009/03/28/sip-security/">it</a> . <br><br>  A few comments. <br>  If you have some experience with asterisk, then you should have a question. <br>  How is the context determined for outgoing calls? <br>  Record <br> <code>context=office_rules <br></code> <br>  only works on incoming calls.  So, in this case, on the receiving side, the asterisk sees that there is a peer in the system, which has the same IP address as the client that makes the call.  And it takes its context. <br><br>  And further.  Nobody bothers you to specify several register if you have several providers.  The essence of register is to tell you exactly where you are.  If you say ‚Äúyou are here‚Äù 2 or more times, there will be no problems and moreover, you will be insured against interruptions of one of the providers. </div><p>Source: <a href="https://habr.com/ru/post/107668/">https://habr.com/ru/post/107668/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../107661/index.html">For large-scale introduction of biofuels from algae need at least 10 years of scale</a></li>
<li><a href="../107662/index.html">Agile methodology turns 10 years old</a></li>
<li><a href="../107663/index.html">New clone species</a></li>
<li><a href="../107664/index.html">Test C compilers for Windows</a></li>
<li><a href="../107665/index.html">Google Corporation is planning a number of major purchases.</a></li>
<li><a href="../107670/index.html">Do I need to spend time designing?</a></li>
<li><a href="../107672/index.html">Steve Ballmer gave a lecture to Ukrainian students</a></li>
<li><a href="../107673/index.html">Hack Kinect, serve Open Source and get $ 2000. The winner is already there</a></li>
<li><a href="../107674/index.html">Easy installation and configuration of BURG</a></li>
<li><a href="../107675/index.html">My experience of opening a free hosting</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>