<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Forecasting financial time series</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Hello everyone, since a cycle of articles about neural networks has gone to Habre, then I will write about the possibility of using neu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Forecasting financial time series</h1><div class="post__text post__text-html js-mediator-article"><h5>  Introduction </h5><br>  Hello everyone, since a cycle of articles about neural networks has gone to Habre, then I will write about the possibility of using neural networks in the task of forecasting financial time series. <br>  There are several different theories about the possibility of forecasting stock markets.  One of them is the hypothesis of an effective market, according to her, the stock price has already taken into account all the available information and it makes no sense to make forecasts.  The continuation of this hypothesis can be called the theory of random walks. <br>  In the theory of random walks, information is divided into two categories - predictable, well-known and new, unexpected.  If the predictable, and even more so already known information is already embedded in market prices, the new unexpected information in the price is not yet present.  One of the properties of unpredictable information is its randomness and, accordingly, the randomness of the subsequent price change.  The hypothesis of an effective market explains the change in prices by the arrival of new unexpected information, and the theory of random walks complements this with an opinion about randomness of price changes. <br><a name="habracut"></a><br>  A brief practical conclusion of the theory of random walks - players are recommended to use the strategy of "buy and hold" in their work.  It should be noted that the flourishing of the theory of random walks occurred in the 1970s, when the US stock market, traditionally the main testing ground for all new economic theories, did not show any obvious trends, and the market itself was in a narrow corridor.  According to the hypothesis of an efficient market and the theory of random walks, price forecasting is impossible.  <a href="http://www.bull-n-bear.ru/technic/%3Ft_analysis%3Dpostulates"><sup>[one]</sup></a> <br>  However, the majority of market participants still use different methods for forecasting, suggesting that the series itself is full of hidden patterns. <br>  Such hidden empirical patterns were attempted by the founder of technical analysis, R.Elliott, in his series of articles in the 1930s. <br>  In the 1980s, this point of view found unexpected support in the theory of dynamic chaos that had just emerged.  This theory is built on the opposition of randomness and stochasticity (randomness).  Chaotic series only look random, but, as a deterministic dynamic process, they completely allow short-term forecasting.  The area of ‚Äã‚Äãpossible predictions is limited in time by the forecasting horizon, but this may be enough to generate real income from the predictions (Chorafas, 1994).  And the one who has the best mathematical methods of extracting patterns from noisy chaotic series, can hope for a greater rate of return - at the expense of their less well-equipped counterparts.  <a href="http://www.intuit.ru/department/expert/neurocomputing/8/1.html"><sup>[2]</sup></a> <br><br><h5>  Forecasting methods </h5><br>  Currently, professional market participants use various methods for forecasting financial time series, the main ones are: <br>  1) expert forecasting methods. <br>  The most common method from the group of expert methods is the Delphi method.  The essence of the method is to collect the opinions of various experts and their generalization into a single assessment.  If we forecast financial markets with this method, then we need to select an expert group of people versed in this subject area (this could be analysts, professional traders, investors, banks, etc.), conduct a survey or survey and make a generalization of the current market situation. <br>  2) Methods of logical modeling. <br>  Based on the search and identification of market patterns in the long term. <br>  These include methods: <br>  - the method of scenarios ("if-then"), the description of sequences of outcomes from this or that event, with the creation of a knowledge base; <br>  - methods of forecasts in the image; <br>  - the method of analogies. <br>  3) Economic and mathematical methods. <br>  Methods from this group are based on the creation of models of the object under study.  The economic-mathematical model is a definite scheme, the path of development of the securities market under given conditions.  When forecasting financial time series, statistical, dynamic, micro-macro, linear, non-linear, global, local, industry, optimization, descriptive are used.  Optimization models are very significant for financial sciences, they represent a system of equations that includes various constraints, as well as a special equation called the optimality functional (or optimality criterion).  With it, they find the best, best solution for any indicator. <br>  4) Statistical methods. <br>  Statistical methods of forecasting, for financial time series, are based on the construction of various indices (diffuse, mixed), the calculation of the values ‚Äã‚Äãof variance, the expectation mat, variation, covariance, interpolation, extrapolation. <br>  5) Technical analysis. <br>  Predicting future price changes based on an analysis of past price changes.  It is based on the analysis of time series of prices - "charts" (from the English chart).  In addition to price series, technical analysis uses information about trading volumes and other statistical data.  Most often, technical analysis methods are used to analyze prices that change freely, for example, on exchanges.  In technical analysis, there are many tools and methods, but they are all based on one assumption: from the analysis of time series, highlighting trends, one can predict the behavior of prices. <br>  6) Fundamental analysis. <br>  The method of forecasting the market (stock) value of the company, based on the analysis of financial and production indicators of its activities. <br>  Fundamental analysis is used by investors to estimate the value of a company (or its shares), which reflects the state of affairs in a company, the profitability of its activities.  This analysis analyzes the company's financials: revenue, EBITDA (Earnings Before Interests Tax, Deprecation and Amortization), net profit, net worth, liabilities, cash flow, the amount of dividends paid and production figures of the company. <br>  <a href="http://beintrend.ru/2010-08-30-11-39-37"><sup>[3]</sup></a> <a href="http://ru.wikipedia.org/wiki/%25D0%25A2%25D0%25B5%25D1%2585%25D0%25BD%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9_%25D0%25B0%25D0%25BD%25D0%25B0%25D0%25BB%25D0%25B8%25D0%25B7"><sup>[4]</sup></a> <a href="http://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25B4%25D0%25B0%25D0%25BC%25D0%25B5%25D0%25BD%25D1%2582%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25B0%25D0%25BD%25D0%25B0%25D0%25BB%25D0%25B8%25D0%25B7"><sup>[5]</sup></a> <br><br><h5>  Using neural networks to predict financial time series </h5><br>  Neural networks can be attributed to the methods of technical analysis, because they also try to identify patterns in the development of a series, learning from its historical data. <br>  The financial time series is quite noisy and therefore we need to pay special attention to data preprocessing and variable coding. <br><img src="https://habrastorage.org/storage2/d02/d8c/43d/d02d8c43df2f9bf11b8542ce8211f6d6.png"><br>  Fig.  1 - Interval chart in the form of Japanese candles RTS index.  Period - day. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For reference: each figure on the chart shows us a certain period of time (in this case one day) and price movements over this period.  We describe them: <br>  - the opening price is the value of the price at the beginning of this period of time <br>  - the closing price is the value of the price at the end of this period of time <br>  - the maximum price is the maximum price for the entire period of time <br>  - the minimum price is the minimum price for the entire period of time <br>  - if the price went up (bullish trend) for this period - the body of the candle will be white (or transparent) <br>  - if the price went down (bearish trend) for this period - the candle body will be black (or painted over) <a href="http://www.kradun.com/techanal1.html"><sup>[6]</sup></a> <br><img src="https://habrastorage.org/storage2/d35/f8a/420/d35f8a4205aaf97a45b6b76d9a252880.jpg"><br>  Fig.  2 - Japanese candles. <br><br>  Really significant for predictions are changes in quotes.  Therefore, after preprocessing, we will supply a number of percentage increments of quotes calculated by the formula X [t] / X [t-1] to the input of the neural network, where X [t] and X [t-1] are the closing prices of periods. <br><img src="https://habrastorage.org/storage2/3d5/a71/231/3d5a71231922c834b6f3742438638f3d.png"><br>  Fig.  3 - A series of percentage increments of quotes calculated by the formula X [t] / X [t-1]. <br><br>  But, since  initially, the percentage increments have a Gaussian distribution, and of all the statistical distribution functions defined on a finite interval, the uniform entropy has the maximum entropy, then for this we recode the input variables so that all the examples in the training set carry approximately the same information load. <br><img src="https://habrastorage.org/storage2/45c/0ce/929/45c0ce92933720eebc7e4d2adbe942e1.png"><br>  Fig.  4 - Distribution of percentage increments of quotes. <br><br>  The algorithm here is the following: a segment from the minimum percentage increment to the maximum is divided into N segments, so that the range of values ‚Äã‚Äãof each segment includes an equal number of percentage increments of quotes. <br><img src="https://habrastorage.org/storage2/935/918/fc2/935918fc288f59f2ea44cedaeb5a0a4e.png"><br>  Fig.  5 - Borders of 6 segments, the number of percentage increments in each segment is equal. <br><br>  Next, re-encode the percentage increments in the classes that identify each segment. <br><img src="https://habrastorage.org/storage2/c78/86c/715/c7886c71542b332b4c2c6eafb3d3b28f.png"><br>  Fig.  6 - Recoding percentage increments. <br><br>  And we get a uniform distribution. <br><img src="https://habrastorage.org/storage2/4ca/c91/f55/4cac91f55a1c72d4aab5c3bb0df1c827.png"><br>  Fig.  7 - Uniform distribution. <br><br>  The task of obtaining input images for the formation of a training set in problems of forecasting time series involves the use of the "window" method.  This method involves the use of a ‚Äúwindow‚Äù with a fixed size capable of moving through the time sequence of historical data, starting with the first element, and designed to access data of the time series, and the ‚Äúwindow‚Äù of size N, having received such data, sends the elements to the input of the neural network 1 through N-1, and the N-th element is used as an output. <br><img src="https://habrastorage.org/storage2/947/380/08a/94738008a71129df5ca8857850b49ac4.png"><br>  Fig.  8 - Window method. <br><br>  The quality of the training sample is the higher, the less its inconsistency and the greater the repeatability.  For the tasks of forecasting financial time series, the high inconsistency of the training sample is a sign that the description method was chosen poorly.  Factors affecting inconsistency and repeatability: <br>  1) the number of elements of the training sample - the more elements, the greater the inconsistency and repeatability; <br>  2) the number of classes for which the percentage increments were recoded ‚Äî with an increase, the inconsistency and repeatability decrease; <br>  3) the depth of immersion in the financial time series ("window") - the greater the depth, the less inconsistency and less repeatability. <br>  When creating a training sample, changing these parameters, it is necessary to find a balance in which the inconsistency level is minimal and the repeatability is maximum. <br><br>  For a practical example, we will forecast the directions of increments of the RTS index from January 16, 2012, to April 17, 2012, the period is a day. <br><img src="https://habrastorage.org/storage2/159/ac4/4a0/159ac44a0642e33e755fdb059748cdd3.png"><br>  Fig.  9 - Schedule of the RTS index from January 8, 2012 to April 18, 2012, the period is a day. <br><br>  Let's create a collection of neural networks that showed the best results (more than 70% of correctly predicted directions for changing the value of the index) on the test set (the last 50 periods).  Every 5 periods, the collection is re-created, already predicted periods are included in the test set.  The neural networks in the collection are not of the same type - each one has a training sample size, the number of classes for which the percentage increments are recoded, the immersion depth (‚Äúwindow‚Äù) and the number of neurons in the hidden layer so that the current market situation is most accurately predicted (the last 50 periods ). <br>  The basic architecture of the used neural networks is a multilayer perceptron with one hidden layer.  There is an excellent pre-built implementation in the ALGLIB library <a href="http://alglib.sources.ru/dataanalysis/neuralnetworks.php"><sup>[7]</sup></a> .  As a learning algorithm, we use the L-BFGS algorithm (limited memory BFGS), a quasi-Newtonian method with a time consuming iteration linear in the number of weight coefficients WCount and size of the training set, and moderate requirements for additional memory - O (WCount). <br><br>  Sample collection: <br><br>  <em>Forecast from: 01/16/2012 to: 01/20/2012</em> <em><br></em>  <em>Number of networks: 16</em> <em><br></em>  <em>Network settings:</em> <em><br></em>  <em>Input: 3 Concealed layer: 18 Number of classes: 4 Training sample length: 200 Result per vol.</em>  <em>vyb .: 74,6 Result on test vyb .: 72,5</em> <em><br></em>  <em>Input: 3 Concealed layer: 19 Number of classes: 4 Length of the training sample: 200 Result per vol.</em>  <em>vyb .: 74,6 Result on test vyb .: 72,5</em> <em><br></em>  <em>Input: 3 Concealed layer: 20 Number of classes: 4 Training sample length: 200 Result per vol.</em>  <em>vyb .: 74,6 Result on test vyb .: 72,5</em> <em><br></em>  <em>Input: 4 Concealed layer: 18 Number of classes: 4 Training sample length: 200 Result per vol.</em>  <em>vyb .: 75,6 Result on test vyb .: 74,5</em> <em><br></em>  <em>Input: 4 Concealed layer: 20 Number of classes: 4 Training sample length: 200 Result per vol.</em>  <em>vyb .: 74,1 Result on test vyb .: 72,5</em> <em><br></em>  <em>Input: 5 Concealed layer: 19 Number of classes: 4 Training sample length: 200 Result per vol.</em>  <em>vyb .: 74,6 Result on test vyb .: 70,6</em> <em><br></em>  <em>Entry: 5 Covered layer: 20 Number of classes: 4 Training sample length: 200 Result per vol.</em>  <em>vyb .: 76,1 Result on test vyb .: 72,5</em> <em><br></em>  <em>Input: 4 Concealed layer: 18 Number of classes: 5 Training sample length: 200 Result per vol.</em>  <em>vyb .: 67,2 Result on test vyb .: 74,5</em> <em><br></em>  <em>Input: 5 Build layer: 18 Number of classes: 5 Training sample length: 200 Result per vol.</em>  <em>vyb .: 70,6 Result on test vyb .: 74,5</em> <em><br></em>  <em>Entry: 5 Concealed layer: 19 Number of classes: 5 Training sample length: 200 Result per vol.</em>  <em>vyb .: 76,6 Result on test vyb .: 74,5</em> <em><br></em>  <em>Entry: 5 Reserved layer: 20 Number of classes: 5 Length of the training sample: 200 Result per vol.</em>  <em>vyb .: 76,1 Result on test vyb .: 74,5</em> <em><br></em>  <em>Input: 3 Concealed layer: 18 Number of classes: 4 Training sample length: 270 Result per vol.</em>  <em>vyb .: 74,9 Result on test vyb .: 70,6</em> <em><br></em>  <em>Input: 3 Concealed layer: 19 Number of classes: 4 Training sample length: 270 Result per vol.</em>  <em>vyb .: 74,9 Result on test vyb .: 70,6</em> <em><br></em>  <em>Input: 3 Concealed layer: 20 Number of classes: 4 Training sample length: 270 Result per vol.</em>  <em>vyb .: 74,9 Result on test vyb .: 70,6</em> <em><br></em>  <em>Input: 5 Build layer: 18 Number of classes: 4 Length of the training sample: 340 Result per vol.</em>  <em>vyb .: 78,0 Result on test vyb .: 70,6</em> <em><br></em>  <em>Input: 5 Concealed layer: 19 Number of classes: 4 Training sample length: 340 Result per vol.</em>  <em>vyb .: 79,5 Result on test vyb .: 74,5</em> <em><br></em> <br><br>  Parameters of all used collections can be found in the <a href="http://dl.dropbox.com/u/13645549/0_out.txt">file</a> <br><br>  Since we forecast the direction of the RTS index change, we use the simplest strategy - we open a position at the closing price of the current period and close it at the closing price of the forecast period, fixing a profit or loss. <br><img src="https://habrastorage.org/storage2/082/926/046/082926046f4c03a1f7c3610cb8ac1947.png"><br>  Fig.  10 - The result of the work. <br><br>  The result of work from 16/01/2012 to 04/17/2012: 77% of correctly predicted directions of changes in the index value. </div><p>Source: <a href="https://habr.com/ru/post/144405/">https://habr.com/ru/post/144405/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../144400/index.html">Using a delegate to get data from AsyncTask</a></li>
<li><a href="../144401/index.html">Electronic Signature: Transboundary Interaction</a></li>
<li><a href="../144402/index.html">Implementing progressive image downloads</a></li>
<li><a href="../144403/index.html">Installing Oracle 10g on CentOS 6.2 x64</a></li>
<li><a href="../144404/index.html">Social service Katushkin.ru - find a company for skiing</a></li>
<li><a href="../144406/index.html">Protecting an Ajax Application Against Cross Site Request Attacks (CSRF)</a></li>
<li><a href="../144407/index.html">How do we find the inaccessible model</a></li>
<li><a href="../144408/index.html">Release LLVM 3.1</a></li>
<li><a href="../144409/index.html">Create a web form to send faxes through Asterisk</a></li>
<li><a href="../144410/index.html">What old games do you think are old school?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>