<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Modular testing of Pega applications: changing lives for the better with Ninja</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Despite the no coding paradigm, unit testing on complex Pega projects is just as important as other software development projects. I was convinced of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Modular testing of Pega applications: changing lives for the better with Ninja</h1><div class="post__text post__text-html js-mediator-article">  Despite the no coding paradigm, unit testing on complex Pega projects is just as important as other software development projects.  I was convinced of this personally, working in projects for the end-to-end automation of business processes based on Pegasystems solutions. <br><br>  On Habr√©, I found just one article on the Pega platform.  Meanwhile, Pega annually receives high marks in the most reputable <a href="https://www.pega.com/insights/analyst-reports">ratings of</a> BPM solutions and CRM applications. <br><br>  Developing the theme of work on Pega, I suggest you translate my <a href="https://pegadevops.com/%3Fp%3D637">article on Ninja</a> , a tool for testing Pega applications.  In the course of commenting the terminology used in this material. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/web/e5a/a37/b98/e5aa37b982eb447a88dc875aba34c9a3.png"><br><a name="habracut"></a><br>  In 2015, I participated in automating the corporate lending process on the Pega platform in one of the largest financial institutions in Russia and Eastern Europe. <br><br>  At one of the stages of the project, the team was late with the release of the next release.  It became obvious that in such a complex project an alternative approach to automated testing is needed, allowing to detect possible defects in the early stages.  Then we decided to transfer the practices used in Java projects to the Pega platform.  The fact that this came out, and will be discussed in the article. <br><br><h2>  One day something went wrong </h2><br>  So that you can imagine the scale of the system, I will say that by February of this year it has reached more than 32 thousand rules (rule is a unit for building an application on the Pega platform, in Java this may correspond to a method / class, but the analogy is rough).  Now it is being developed by three independent teams that produce more than four thousand chekins per day. <br><br>  In 2015, together with colleagues from <a href="http://www.lanit.ru/structure/region/">LANIT-BP, we</a> completed the next stage of the project and prepared a release containing many complex integration interactions with the customer‚Äôs back-end systems. <br><br>  The problems started unexpectedly.  System testing revealed a number of errors in integration scenarios. <br><br>  Yes, I am, of course, aware that in the Russian corporate software development industry there is no unanimity in the interpretation and application of this term.  Therefore, I‚Äôll make a reservation that I will call here system testing of all applications involved in the implementation of a business process. <br><br>  So, until the completion of system testing, there were two weeks left, and during this time, the teams of all the interacting systems had to fix their applications.  Let in this context ‚Äúsystems‚Äù and ‚Äúapplications‚Äù be synonymous. <br><br>  The list of immediate tasks resembled an ordinary project routine.  Had: <br><br><ul><li>  highlight problematic integration scenarios; <br></li><li>  identify conflicts in the integration specifications of different systems that caused the non-working integration scenarios; <br></li><li>  in each case, agree on which side to correct the specifications and implementation; <br></li><li>  fix and release updates for all applications. <br></li></ul><br>  The list of scenarios that required fixes on the side of our system was not short, but did not seem frightening.  Correction of the integration layer of our application took a week of work for the whole team. <br><br>  None of us could have imagined that it would take another two weeks to correct all the problems that arose after such a significant revision of the application and would require countless internal testing cycles.  The deadlines for the completion of this (very important for the customer) project phase have shifted.  We needed to find a solution that, although it could not help immediately, would prevent similar situations in the future. <br><br><img src="https://habrastorage.org/web/415/edc/3a5/415edc3a5fcd4d7da63f07adc901aa37.png"><br>  <a href="">A source</a> <br><br><h2>  Problem analysis </h2><br>  We analyzed this painful failure and identified the following main reasons. <br><br><ul><li>  Due to the high complexity of the application, it was impossible to verify that changes made in one place did not break anything in a completely different (completely unexpected) place.  This caused a large number of regression defects. <br><br></li><li>  Description of the components of the application that we conducted on the project wiki were not tied to the code and were often irrelevant - they did not describe the specific behavior of the rudders under certain conditions.  Thus, developers using existing components did not have enough information on how to handle all possible exceptions or specific return values. <br><br></li><li>  The developers focused on processing the main scenarios, leaving unrealized alternative branches, error handling or behavior in the absence of data. <br></li></ul><br>  Taking into account our experience in Java, we perfectly understood that similar problems in Java projects are usually solved with the help of well-known practices: unit testing, test-driven development and continuous integration.  It seemed logical to apply these practices in our Pega-project. <br><br><h2>  Designing Unit Tests </h2><br>  We decided to start with covering modular tests of the application integration layer, since  It was the most difficult part of our application and generated up to 80% of all defects. <br><br>  The typical integration component of our application consisted of 6 main elements. <br><br><ul><li>  Connect activity is the main element that combined all other elements and served as an entry point for invoking integration from different parts of the application. <br></li><li>  Request mapping data transform filled out a request based on business data. <br></li><li>  Stream XML converted the request from the integration model to XML. <br></li><li>  The Connector rule communicated with the external system using the required protocol. <br></li><li>  Parse XML parsed the XML response and transformed it into an integration data model. <br></li><li>  Response mapping data transform transformed the response from the integration model into a business entity. <br></li></ul><br>  Stream and Parse XML rules were usually created automatically using the Connector and Metadata Wizard together and the integration data model.  The Connector steering wheel was specifically left ‚Äúthin‚Äù by moving all the logic into Connect activity.  The greatest number of defects was generated by Connect activity and Request / Response mapping data transform, since  they contained the main logic of the integration component. <br><br>  Given the integration architecture described above, we intended to create the following test suite for each integration point. <br><br><img src="https://habrastorage.org/web/7c1/4b5/dd4/7c14b5dd42774b59aa3dbd6f460b8632.png"><br><br><ul><li>  Test Connect activity in isolation to test its logic, including non-standard situations. <br></li><li>  Test Request mapping data transform in isolation. <br></li><li>  Test Response mapping data transform in isolation. <br></li><li>  A test for the entire integration component in order to verify that the outgoing XML is generated, and the incoming XML is processed correctly (in accordance with the specification). <br></li></ul><br>  The elements in the diagram are colored in accordance with the ‚Äúfun‚Äù and the desired degree of test coverage: <br><br><ul><li>  red - elements that are highly error prone should be tested in isolation to achieve greater coverage (unit tests); <br><br></li><li>  green - elements less prone to errors, when testing them, it is enough to check them in conjunction with other elements (we are talking about inner-com tests, that is, tests of the internal component in isolation from external systems); <br><br></li><li>  gray - components that are unlikely to contain errors and may remain uncovered by the test suite. <br></li></ul><br><h2>  Unit Testing with Pega Platform Tools </h2><br>  The first thing we tried was Pega Test Cases - automated tests created by the appropriate platform tool.  Although they are useful for simple applications, it turned out that in corporate-scale projects, their use is substantially limited: they do not allow controlling the isolation level of dependent rudders in tests. <br><br>  In our case, this meant that we could not perform testing in isolation, not only for the Connect activity, but also for the Data transform, since  they can use (and often use) Data Pages, which, in turn, use other rules as a data source (Activity, Report Definitions, other Data Transform, etc.). <br><br>  Thus, unit testing from Pega was suitable for implementing only one of the four types of tests - inner-com tests.  Moreover, this was only possible thanks to the Integration Simulation mechanism, which, in turn, created problems for some of the flexibility and maintenance of the tests. <br><br>  The above limitation was not the only thing that bothered us in the unit tests from Pega. <br><br><ul><li>  Prior to Pega 7.2 (we used Pega 7.1.8 at the time), there was no convenient way to manage the preparation of data for the test and validation of results.  A side effect of this restriction was the need to re-create all the tests after significant changes to the rules. <br><br></li><li>  Low degree of reuse of test code: even with the significant improvements in Pega 7.2, it is not possible to split the complex test checks into individual blocks and use them in several scenarios. <br><br></li><li>  There is no possibility to write complex test scenarios, including calling up several rules and checking the overall result of their work. <br><br></li><li>  Pega <a href="https://pdn.pega.com/sites/pdn.pega.com/files/help_v722/procomhelpmain.htm">provides</a> unit testing support for a limited set of rules (Data Pages, Activity, Decision Table, Decision Tree, Flow, Service SOAP). <br></li></ul><br>  Given all these problems, we definitely needed an alternative approach to automated testing. <br><br><h2>  Research &amp; Development </h2><br>  We started with the selection of a strong team of veterans from Java and Pega projects.  Through brainstorming and feedback from project teams, we achieved a crystal clear understanding of what features we needed.  It: <br><br><ul><li>  rudder insulation management; <br></li><li>  Mock and Stub for rules (similar to Mock and Stub for classes in Java); <br></li><li>  decomposition of complex tests into small, reusable blocks; <br></li><li>  run unit tests on any modern build-server. <br></li></ul><br>  After several months of prototyping and implementation, we released the alpha version and started piloting it on a small part of the application code.  Piloting has shown the success of our ideas - tests began to be useful: they helped to detect several significant defects when writing tests, and also allowed us to detect regression defects in a timely manner. <br><br>  Over the course of a year, we introduced a new testing approach to most of our Pega projects.  The created tool required a name, and it appeared by itself - Ninja. <br><br><img src="https://habrastorage.org/web/9af/306/492/9af3064929ad433493abb526f88a8a3e.png"><br>  <a href="">A source</a> <br><br><h2>  Unit Testing with Ninja </h2><br>  Ninja provides a Java library that allows you to write JUnit tests for rules.  Thus, unit testing of an application on the Pega platform becomes as simple as in Java. <br><br>  Let's take a closer look at what makes Ninja so convenient. <br><br>  First, Ninja encrypts and securely stores your credentials to connect to the Pega development environment (is a web application known as Pega Designer Studio) and run tests on your behalf.  This allows you to test the private version of the steering wheel, located in the checkout.  Here, just in case, I will explain: the Pega platform allows you to take checklists into checkout and make changes to them that are ‚Äúvisible‚Äù only to the author.  After the author has checked the changes, he performs a check-in.  Then the changes are "visible" to everyone. <br><br>  Secondly, Ninja uses the same session for consecutive test runs.  This allows you to determine the Requestor (system session) used by Ninja and connect to it using Tracer, a debugging tool in the Pega platform, which allows you to view detailed information about the steps being performed and the state of objects in memory.  In this case, Tracer is needed to analyze what happens when you run the test rudder. <br><br>  Thus, Ninja allows you to prepare a test environment easily and accurately. <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String myClass = <span class="hljs-string"><span class="hljs-string">"MyOrg-MyApp-Work-MyCase"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// prepare a Top-level page preparePage("MyTopLevelPage").create(myClass)        .prop("pyLabel", "This is my top level page for a case")    .prop("MyProp", "My value"); // prepare parameter prepareParameter("myParam").value("My param value");</span></span></code> </pre> <br>  You can define stubs for handlebars, directly or indirectly caused by the test rudder.  This allows the rudders to be tested in controlled isolation. <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// mock nested activity invocation expect().activity().className("MyOrg-MyApp-Work-MyCase").name("NestedActivity").andMock(new MockBehaviour&lt;MockActivityContext&gt;() { @Override public void process(MockActivityContext context) throws Exception {   // assert parameters   context.assertParameter("myParam").value("My value");  // assert Primary page   context.assertPrimaryPage().prop("MyProp", "My value");   // assert Top-level page   context.assertPage("TopLevelPage").exists().prop("pyLabel", "This is my TLP");   // set properties in Primary   context.preparePrimaryPage().prop("pyNote", "My note for this page");   // set parameters on Top-level page   context.preparePage("TopLevelPage").prop("pyLabel", "This is MODIFIED TLP");   // set parameters   context.prepareParameter("myResult").value("Success"); } });</span></span></code> </pre> <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//mock Obj-Browse method invocation final String opClass = "Data-Admin-Operator-ID"; expect().objBrowse().page("OperatorList").className(opClass).andMock(new MockBehaviour&lt;MockObjBrowseContext&gt;() { @Override public void process(MockObjBrowseContext context) throws Exception {   // prepare result set   final PreparePageList pxResults = context.preparePage("OperatorList").prop("pxResultCount", "2").pageList("pxResults");   pxResults.append(opClass).prop("pyUserIdentifier", "info@pegadevops.com").prop("pyLabel", "Operator ID record");   pxResults.append(opClass).prop("pyUserIdentifier", "alexander.lutay@pegadevops.com").prop("pyLabel", "Operator ID record"); } });</span></span></code> </pre> <br><br>  In the test script, you can call almost any rudder with Pega behavior.  Unit testing is not applicable for long-living processes and GUIs, so Ninja does not support Flow, Flow Action, Section and other GUI-related rudders. <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// what about covering a Function with a unit test? invoke().function().ruleSet("MyRuleset").library("MyLibrary").name("Func").args().string("My string").longO(123).date(new Date()); // would you like to unit test a When rule? invoke().when().primaryPage("pyWorkPage").name("ToBeOrNotToBe");</span></span></code> </pre> <br><br>  You can comprehensively test your test results. <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// assert activity status assertActivityStatus().good(); // assert Clipboard state assertPage("MyTestPage").exists().propAbsent("ErrorCode") .prop("ResultCode", "0").propPresent("ResultDescription"); // assert Params assertParameter("MyParam").value("Some value");</span></span></code> </pre> <br><br>  More examples can be found in the Ninja Cookbook on <a href="https://github.com/pegadevops/ninja-cookbook">GitHub</a> . <br>  With Ninja, we covered the main integration scenarios with unit tests. <br><br><ul><li>  We test Connect activity in isolation by simulating (mocking) other rudders.  This helped us focus on integration logic in these tests and check all branches, including exceptional situations. <br><br></li><li>  Data transformations have been exhaustively tested in isolation from all other rules (Function, various Decision rules, data sources for Data Pages) called directly or indirectly from Data Transform rules. <br><br></li><li>  We stubbed the Connector steering-wheels to avoid calling external systems from inner-com tests, as well as to validate the XML generated by the component. <br></li></ul><br>  Creating our base of unit tests, we were able to identify several common procedures for preparing a test environment and checking test results, on the basis of which we built a library of reusable components for writing tests. <br><br><h2>  Confidence in the quality of the application </h2><br>  As of February 2017, the credit process has several parallel branches of development: the correction of defects arising in the framework of trial operation (Prod-branch), and several branches for the development of the functionality of future releases. <br><br>  Each branch is covered by its own unit tests, which are developed together with the application.  Tests are stored in the version control system and are also divided into branches.  Prod-branch as of February 2017 had 350 tests.  Let me clarify that at the time of the translation of the article, in July 2017, the latest release thread already contained about 1,650 tests, the execution time of which does not exceed 15 minutes. <br><br>  Unit tests are run by the build server separately for each branch every 30 minutes.  This means that the team receives a ‚Äúhealth report‚Äù of the system every 30 minutes and can respond to emerging defects in a timely manner. <br><br>  Ninja allowed us to more quickly produce a higher quality product due to fewer Dev-QA cycles, because  most defects are now detected on the dev-environment and immediately eliminated. <br><br>  There are fewer defects in trial operation - thanks to more comprehensive testing by the QA team, which now does not have to deal with trivial defects that block the passage of test scenarios. <br><br><h2>  To be continued </h2><br>  Our experience suggested that unit tests are not the only ‚Äúweak‚Äù area of ‚Äã‚Äãthe Pega platform: when compared to Java or other ‚Äútraditional‚Äù software development platforms, the Pega tools that developers can use have significant limitations. <br><br>  Taking into account the feedback from the project teams and the results of numerous brainstorming sessions, we defined the following functions that will appear in Ninja: <br><br><ul><li>  Rule Refactoring - refactoring of rules; </li><li>  Code analysis - advanced static code analysis; </li><li>  Code review - code audit; </li><li>  Release automation - automation of assemblies and deliveries; </li><li>  Continuous delivery pipeline - continuous delivery pipeline. </li></ul><br>  I note that now most of these functions are already available in Ninja.  I am sure that such functions will allow Ninja to become a comprehensive toolkit for implementing DevOps on Pega projects. <br><br>  Our colleagues were interested in our solution, and I am glad that this case can serve as an example for other development teams: in Russia, you can make niche solutions for cool IT products and export them successfully. <br><br>  For more information on Ninja, look <a href="https://pegadevops.com/">here</a> . <br><br><div class="spoiler">  <b class="spoiler_title">If you want to join our team</b> <div class="spoiler_text"><br>  Now we have open some interesting vacancies: <br><br>  <a href="https://job.lanit.ru/vacancy/Pages/BPM-03.aspx">BPM Analyst</a> <br>  <a href="https://job.lanit.ru/vacancy/Pages/BPM-30.aspx">BPM Senior Analyst</a> <br>  <a href="https://job.lanit.ru/vacancy/Pages/BPM-01.aspx">PEGA Developer</a> <br>  <a href="https://job.lanit.ru/vacancy/Pages/BPM-23.aspx">PEGA Senior Developer</a> <br>  <a href="https://job.lanit.ru/vacancy/Pages/BPM-02.aspx">Architect</a> <br>  <a href="https://job.lanit.ru/vacancy/Pages/BPM-05.aspx">Project Manager</a> <br></div></div><br>  In conclusion, I offer you a short survey: </div><p>Source: <a href="https://habr.com/ru/post/334648/">https://habr.com/ru/post/334648/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334636/index.html">Introducing dependencies through fields is bad practice</a></li>
<li><a href="../334638/index.html">PERFEXPERT Monitoring System - Database Management Problem Solving</a></li>
<li><a href="../334642/index.html">Alternative planetary data for geographic information systems</a></li>
<li><a href="../334644/index.html">Clustering markers on the Google Maps API map</a></li>
<li><a href="../334646/index.html">How to monitor the state of a corporate wireless network with Extreme NSight</a></li>
<li><a href="../334650/index.html">The authenticity of your videos is now undeniable thanks to Prover.</a></li>
<li><a href="../334652/index.html">Android O: features support for the new operating system</a></li>
<li><a href="../334656/index.html">5 fresh examples of parsing and improving the design in simple ways</a></li>
<li><a href="../334658/index.html">How to try to make the user comfortable and bungle something in the process.</a></li>
<li><a href="../334660/index.html">Test documentation. Turn tables into trees</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>