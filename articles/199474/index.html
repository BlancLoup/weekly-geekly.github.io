<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Authorization through Radius on Mikrotik with local group substitution</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day to all! I work as a novice network administrator in a large federal company with a mixed network, cisco, mikrotik, juniper. 
 And once the ne...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Authorization through Radius on Mikrotik with local group substitution</h1><div class="post__text post__text-html js-mediator-article">  Good day to all!  I work as a novice network administrator in a large federal company with a mixed network, cisco, mikrotik, juniper. <br>  And once the next task appeared. <br><br>  <b>Initial data:</b> <br><br>  1. There is a regional system administrator who has several system administrators under his authority.  Each system administrator has an RU - a regional node, where the head units are 2 Mikrotik 1100ahx2 and cisco c3550, for shopping - MikroTik RB751G-2HnD. <br>  2. On each Mikrotika, a local group was established with the name coinciding with the city: Omsk - OMS, Kemerovo - KMR, with full rights to Mikrotik. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Task:</b> <br><br>  To make authorization of the regional administrator through Radius only within their area of ‚Äã‚Äãresponsibility, let's say OMS and KMR. <br><a name="habracut"></a><br>  The task is, we try to perform. <br>  Configure Radius on Mikrotik: <br><br>  / radius add service = login address = 10.0.x.10 secret = xxx disabled = no <br>  / user aaa set use-radius = yes <br><br>  Install FreeRadius on Linux, I had Debian: apt-get install freeradius <br>  I have a subnet on Mikrotika 172.16.0.0/12, <br>  write in /etc/freeradius/clients.conf <br><br>  client 172.16.0.0/12 { <br>  secret = xxx <br>  shortname = Network_Devices <br>  } <br><br>  Then, do not forget / etc / freeradius / dictionary <br><br>  VENDOR Mikrotik 14988 <br><br>  BEGIN-VENDOR Mikrotik <br><br>  ATTRIBUTE Mikrotik-Recv-Limit 1 integer <br>  ATTRIBUTE Mikrotik-Xmit-Limit 2 Integer <br>  ATTRIBUTE Mikrotik-Group 3 string <br>  ATTRIBUTE Mikrotik-Wireless-Forward 4 integer <br>  ATTRIBUTE Mikrotik-Wireless-Skip-Dot1x 5 integer <br>  ATTRIBUTE Mikrotik-Wireless-Enc-Algo 6 integer <br>  ATTRIBUTE Micro-Wireless-Enc-Key 7 string <br>  ATTRIBUTE Micro-Rate-Limit 8 string <br>  ATTRIBUTE Mikrotik-Realm 9 string <br>  ATTRIBUTE Mikrotik-Host-IP 10 ipaddr <br>  ATTRIBUTE Mikrotik-Mark-Id 11 string <br>  ATTRIBUTE Mikrotik-Advertise-URL 12 string <br>  ATTRIBUTE Mikrotik-Advertise-Interval 13 integer <br>  ATTRIBUTE Mikrotik-Recv-Limit-Gigawords 14 integer <br>  ATTRIBUTE Mikrotik-Xmit-Limit-Gigawords 15 integer <br>  ATTRIBUTE Mikrotik-Wireless-PSK 16 string <br>  ATTRIBUTE Mikrotik-Total-Limit 17 integer <br>  ATTRIBUTE Mikrotik-Total-Limit-Gigawords 18 integer <br>  ATTRIBUTE Micro-Address-List 19 string <br>  ATTRIBUTE Mikrotik-Wireless-MPKey 20 string <br>  ATTRIBUTE Mikrotik-Wireless-Comment 21 string <br>  ATTRIBUTE Micro-Delegated-IPv6-Pool 22 string <br><br>  # MikroTik Values <br><br>  VALUE Mikrotik-Wireless-Enc-Algo No-encryption 0 <br>  VALUE Mikrotik-Wireless-Enc-Algo 40-bit-WEP 1 <br>  VALUE Mikrotik-Wireless-Enc-Algo 104-bit-WEP 2 <br>  VALUE Mikrotik-Wireless-Enc-Algo AES-CCM 3 <br>  VALUE Mikrotik-Wireless-Enc-Algo TKIP 4 <br><br>  END-VENDOR Mikrotik <br><br>  Everything, now we need to create a user in / etc / freeradius / users: <br><br>  regSA User-password: = 12345 <br>  Auth-Type = CHAP, <br>  Mikrotik-Group: = OMS <br><br>  Restart FreeRadius and try to access Omsk Mikrotik.  Everything is working. <br><img src="https://habrastorage.org/getpro/habr/post_images/e76/f28/a14/e76f28a1443111ac1f3c3ba2deb65be2.png"><br>  But now we try to go to Kemerovo.  We get the group read, with read-only rights.  What's the matter?  We look at the log on Mikrotik and see: <br><img src="https://habrastorage.org/getpro/habr/post_images/71e/e57/00b/71ee5700b03d58b86ccbc3049b37d480.png"><br>  In active users: <br><img src="https://habrastorage.org/getpro/habr/post_images/807/6aa/991/8076aa991311b9de4ab51022ab8b9031.png"><br>  You forgot to register a group for Kemerovo, you say.  Registering: <br><br>  regSA User-password: = 12345 <br>  Auth-Type = CHAP, <br>  Mikrotik-Group: = OMS, KMR <br><br>  Restart freeradius.  We try, we get the same thing.  It turns out that for one user we can specify only one group.  Because at authorization the first one is always taken.  Dead end?  No, a couple of Google hours, research FreeRadius and find a way out. <br>  There is a post-auth handler in radiusd.conf, I decide to try using it. <br>  We write: <br><br>  post-auth { <br>  if (User-Name == "regSA") {check the username <br>  if (NAS-IP-Address = ~ /172\.22\.(2(2[4-9`[[-4-4[0-9 greet5 -9] | [1-9] [0-9] | 1 ([0-9] [0-9]) | 2 ([0-4] [0-9] | 5 [0-5])) /) {and check IP <br>  update reply { <br>  Mikrotik-Group: = ‚ÄúOMS‚Äù if everything came together, then we give out a group of microtics on it <br>  } <br>  } <br>  if (NAS-IP-Address = ~ /172\.20\.(6 [a4-9 ]|[7-8rals [0-9 ]|9[0-5 [/ i] )\\.([0-9] | [1-9] [0-9] | 1 ([0-9] [0-9]) | 2 ([0-4] [0-9] | 5 [0-5])) /) { <br>  update reply { <br>  Mikrotik-Group: = "KMR" <br>  } <br>  } <br>  } <br><br>  } close the whole post-auth <br><br>  NAS-IP-Address is the IP address from which the authorization request arrives.  A regular schedule is used, but since I am with you, I used <a href="http://www.analyticsmarket.com/freetools/ipregex">www.analyticsmarket.com/freetools/ipregex</a> for generating <br>  Now in / etc / freeradius / users: we remove the group as an absolutely unnecessary attribute for us <br><br>  regSA User-password: = 12345 <br>  Auth-Type = CHAP <br><br>  After the restart of FreeRadius, we understand that everything works for us, that the regional gets into Omsk microtics with the OMS group, and the Kemerovo ones with KMR. <br><br>  Why it was impossible to put in users Mikrotik-Group: = "full"?  It was possible, but then the regional sysadmin gained access to all Mikrotikam throughout Russia, which of course is not good.  Only the elect have such rights. </div><p>Source: <a href="https://habr.com/ru/post/199474/">https://habr.com/ru/post/199474/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../199466/index.html">Does the company need a unique template for e-mail newsletters?</a></li>
<li><a href="../199468/index.html">How to protect data on mobile employees</a></li>
<li><a href="../19947/index.html">Self development</a></li>
<li><a href="../199470/index.html">Scenarios for using Windows Azure platform services for your solutions. Data storage and processing</a></li>
<li><a href="../199472/index.html">Video: full development cycle on JavaScript</a></li>
<li><a href="../199478/index.html">Switching between ISPs on Debian 7</a></li>
<li><a href="../19948/index.html">Instructions on how to make an interesting website about cars, spending 3 days and $ 85</a></li>
<li><a href="../199480/index.html">Nine-year router optimization</a></li>
<li><a href="../199482/index.html">SonataAdminBundle + AJAX file upload</a></li>
<li><a href="../199484/index.html">Testing terminals VCS Huawei TE30</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>