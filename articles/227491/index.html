<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cocos2d gas shader</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. 
 I wanted to share my little experience in optimizing shaders on IOS, and if possible to hear practical advice on this matter. It seems to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cocos2d gas shader</h1><div class="post__text post__text-html js-mediator-article">  Good day. <br>  I wanted to share my little experience in optimizing shaders on IOS, and if possible to hear practical advice on this matter.  It seems to be a great tool OpenGl ES 2.0, and you can make good effects, but at the same time get more or less sane fps does not always work. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/776/51d/185/77651d1850b119bd0601807759e35b52.jpg"><br><a name="habracut"></a><br>  Start simple.  Made a small program to build an infinite pipeline, bypassing obstacles and connecting objects.  The task is to draw the gas filling the pipe.  I program on Cocos2d, there are not very many materials on shaders, but by and large, you can easily attach any examples available for ios and android.  The small difference that Cocos2d directly introduces is the transfer of the coordinates of the vertex shaders in screen sizes, not in the range [-1.0, 1.0].  This is quite convenient. <br>  To convert ranges, the coconut itself forms the CC_MVPMatrix matrix, and adds it to the vertex shader. <br>  The gas is based on a shader that combines colors based on the incoming texture of Perlin noise. <br><br><pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">precision</span></span> mediump float; <span class="hljs-attribute"><span class="hljs-attribute">varying</span></span> vec4 Position; <span class="hljs-attribute"><span class="hljs-attribute">varying</span></span> vec2 v_texCoord; <span class="hljs-attribute"><span class="hljs-attribute">uniform</span></span> float Offset; <span class="hljs-attribute"><span class="hljs-attribute">uniform</span></span> sampler2D uTextNoise; <span class="hljs-attribute"><span class="hljs-attribute">void</span></span> main (void) { <span class="hljs-attribute"><span class="hljs-attribute">vec4</span></span> noisevec; <span class="hljs-attribute"><span class="hljs-attribute">vec3</span></span> color; <span class="hljs-attribute"><span class="hljs-attribute">float</span></span> intensity; <span class="hljs-attribute"><span class="hljs-attribute">vec3</span></span> FireColor1 = vec3(<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">8</span></span>); <span class="hljs-attribute"><span class="hljs-attribute">vec3</span></span> FireColor2 = vec3(<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">8</span></span>); <span class="hljs-attribute"><span class="hljs-attribute">noisevec</span></span> = texture2D(uTextNoise, Position.xy); <span class="hljs-attribute"><span class="hljs-attribute">noisevec</span></span> = texture2D(uTextNoise, vec2 (Position.x+noisevec[<span class="hljs-number"><span class="hljs-number">1</span></span>]+Offset, Position.y-noisevec[<span class="hljs-number"><span class="hljs-number">2</span></span>]+Offset)); <span class="hljs-attribute"><span class="hljs-attribute">intensity</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span> * (noisevec[<span class="hljs-number"><span class="hljs-number">0</span></span>] + noisevec[<span class="hljs-number"><span class="hljs-number">1</span></span>] + noisevec[<span class="hljs-number"><span class="hljs-number">2</span></span>] + noisevec[<span class="hljs-number"><span class="hljs-number">3</span></span>]); <span class="hljs-attribute"><span class="hljs-attribute">intensity</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">95</span></span> * abs(intensity - <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">35</span></span>); <span class="hljs-attribute"><span class="hljs-attribute">intensity</span></span> = clamp(intensity, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-attribute"><span class="hljs-attribute">color</span></span> = mix(FireColor1, FireColor2, intensity) * <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">gl_FragColor</span></span> = vec4(color,<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>); }</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Initially, I planned to generate gas on the whole screen, and then cut out the necessary area for rendering.  The problem is that such a simple shader reduced fps to 22 frames on iphone4.  On other devices, the performance was better, but not the diamond, as they say. <br><br>  The most appropriate solution in this situation is to generate a small intermediate texture in the framebuffer.  This texture can be further stretched or multiplied by setting the appropriate texture parameters.  This method can be used to generate water, fog, gas. <br>  Creating a framebuffer in a coconut: <br><br><pre> <code class="hljs erlang">-<span class="hljs-params"><span class="hljs-params">(void)</span></span> createFBO { GLint _oldFBO; glGetIntegerv<span class="hljs-params"><span class="hljs-params">(GL_FRAMEBUFFER_BINDING, &amp;_oldFBO)</span></span>; ccGLBindTexture2DN<span class="hljs-params"><span class="hljs-params">(</span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">0</span></span></span><span class="hljs-params">, texOut.name)</span></span>; glGenFramebuffers<span class="hljs-params"><span class="hljs-params">(</span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">1</span></span></span><span class="hljs-params">, &amp;_noiseFBO)</span></span>; glBindFramebuffer<span class="hljs-params"><span class="hljs-params">(GL_FRAMEBUFFER, _noiseFBO)</span></span>; glFramebufferTexture2D<span class="hljs-params"><span class="hljs-params">(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, GL_TEXTURE_2D, texOut.name, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">0</span></span></span><span class="hljs-params">)</span></span>; glBindFramebuffer<span class="hljs-params"><span class="hljs-params">(GL_FRAMEBUFFER, _oldFBO)</span></span>; glActiveTexture<span class="hljs-params"><span class="hljs-params">(GL_TEXTURE0)</span></span>; }</code> </pre><br><br>  Drawing will look something like this: <br><br><pre> <code class="hljs erlang">-<span class="hljs-params"><span class="hljs-params">(void)</span></span>draw { ccGLBlendFunc<span class="hljs-params"><span class="hljs-params">(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA)</span></span>; GLint _oldFBO; glGetIntegerv<span class="hljs-params"><span class="hljs-params">(GL_FRAMEBUFFER_BINDING, &amp;_oldFBO)</span></span>; glBindFramebuffer<span class="hljs-params"><span class="hljs-params">(GL_FRAMEBUFFER, _noiseFBO)</span></span>; [shaderProgramNoise use]; [shaderProgramNoise setUniformsForBuiltins]; glUniform1f<span class="hljs-params"><span class="hljs-params">(quOffset0, offset)</span></span>; ccGLBindTexture2DN<span class="hljs-params"><span class="hljs-params">(</span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">0</span></span></span><span class="hljs-params">, texNoise.name)</span></span>; ccGLEnableVertexAttribs<span class="hljs-params"><span class="hljs-params">(kCCVertexAttribFlag_Position|kCCVertexAttribFlag_TexCoords)</span></span>; glVertexAttribPointer<span class="hljs-params"><span class="hljs-params">(kCCVertexAttrib_Position, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">2</span></span></span><span class="hljs-params">, GL_FLOAT, GL_FALSE, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">0</span></span></span><span class="hljs-params">, vertexArr)</span></span>; glVertexAttribPointer<span class="hljs-params"><span class="hljs-params">(kCCVertexAttrib_TexCoords, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">2</span></span></span><span class="hljs-params">, GL_FLOAT, GL_FALSE, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">0</span></span></span><span class="hljs-params">, vertexTex)</span></span>; glDrawArrays<span class="hljs-params"><span class="hljs-params">(GL_TRIANGLE_STRIP, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">0</span></span></span><span class="hljs-params">, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">4</span></span></span><span class="hljs-params">)</span></span>; glBindFramebuffer<span class="hljs-params"><span class="hljs-params">(GL_FRAMEBUFFER, _oldFBO)</span></span>; [shaderProgramAlpha use]; [shaderProgramAlpha setUniformsForBuiltins]; ccGLEnableVertexAttribs<span class="hljs-params"><span class="hljs-params">(kCCVertexAttribFlag_Position|kCCVertexAttribFlag_TexCoords)</span></span>; ccGLBindTexture2DN<span class="hljs-params"><span class="hljs-params">(</span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">0</span></span></span><span class="hljs-params">, texOut.name)</span></span>; ccGLBindTexture2DN<span class="hljs-params"><span class="hljs-params">(</span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">1</span></span></span><span class="hljs-params">, texTemplate.name)</span></span>; glVertexAttribPointer<span class="hljs-params"><span class="hljs-params">(kCCVertexAttrib_Position, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">2</span></span></span><span class="hljs-params">, GL_FLOAT, GL_FALSE, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">0</span></span></span><span class="hljs-params">, vertexArrOut)</span></span>; glVertexAttribPointer<span class="hljs-params"><span class="hljs-params">(kCCVertexAttrib_TexCoords, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">2</span></span></span><span class="hljs-params">, GL_FLOAT, GL_FALSE, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">0</span></span></span><span class="hljs-params">, vertexTexOut)</span></span>; glDrawArrays<span class="hljs-params"><span class="hljs-params">(GL_TRIANGLE_STRIP, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">0</span></span></span><span class="hljs-params">, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">4</span></span></span><span class="hljs-params">)</span></span>; glActiveTexture<span class="hljs-params"><span class="hljs-params">(GL_TEXTURE0)</span></span>; }</code> </pre> <br><br>  In the drawing, we first connect the frame buffer in which the shaderProgramNoise forms a small size texNoise texture. <br>  Next, in the render buffer shaderProgramAlpha renders the processing of two textures: gas and stencil.  The texture of the stencil, I originally drew a buffer into another frame, using pictures of full and partial tubes. <br><br>  Fps has improved significantly.  However, the resulting option was not at all optimal.  As it turned out, an increase in the number of frambuffers (! Although there were only 2 of them!) Loads the system, and fps immediately drops to a dozen.  It is clear that such a dramatic situation was observed only on the iphone4, nevertheless, this should be taken into account when developing and not creating additional frambuffers without need. <br>  A good solution would be to place the stencil texture in stencil frameBuffera buffer with gas.  Where the stencil value is 0, the pixel shader is not called.  However, an unpleasant moment in the use of stencil buffers is the inability to push a texture there.  Those.  there will have to draw triangles - and this is a complete FU (for this task).  But since I mentioned the stencil-buffer, I‚Äôll say that I managed to push the texture into it.  Since the glDrawArrays call for stencil also uses a shader program, using the discard for transparent areas in this program, we can still get a stencil texture there.  If anyone is interested, see this method: <br><br><pre> <code class="hljs erlang">-<span class="hljs-params"><span class="hljs-params">(void)</span></span>draw { glDisable<span class="hljs-params"><span class="hljs-params">(GL_DEPTH_TEST)</span></span>; ccGLBlendFunc<span class="hljs-params"><span class="hljs-params">(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA)</span></span>; glClearColor<span class="hljs-params"><span class="hljs-params">(</span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">0.0</span></span></span><span class="hljs-params">/</span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">255.0</span></span></span><span class="hljs-params">, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">200.0</span></span></span><span class="hljs-params">/</span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">255.0</span></span></span><span class="hljs-params">, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">245.0</span></span></span><span class="hljs-params">/</span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">255.0</span></span></span><span class="hljs-params">, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">1.0</span></span></span><span class="hljs-params">)</span></span>; glClear<span class="hljs-params"><span class="hljs-params">(GL_COLOR_BUFFER_BIT | GL_STENCIL_BUFFER_BIT)</span></span>; glClearStencil<span class="hljs-params"><span class="hljs-params">(</span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">0</span></span></span><span class="hljs-params">)</span></span>; glEnable<span class="hljs-params"><span class="hljs-params">(GL_STENCIL_TEST)</span></span>; glStencilFunc<span class="hljs-params"><span class="hljs-params">(GL_NEVER, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">1</span></span></span><span class="hljs-params">, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">0</span></span></span><span class="hljs-params">)</span></span>; glStencilOp<span class="hljs-params"><span class="hljs-params">(GL_REPLACE, GL_KEEP, GL_KEEP)</span></span>; ccGLBindTexture2DN<span class="hljs-params"><span class="hljs-params">(</span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">0</span></span></span><span class="hljs-params">, stencilTexture.name)</span></span>; [shaderProgramStencil use]; [shaderProgramStencil setUniformsForBuiltins]; ccGLEnableVertexAttribs<span class="hljs-params"><span class="hljs-params">(kCCVertexAttribFlag_Position|kCCVertexAttribFlag_Color|kCCVertexAttribFlag_TexCoords)</span></span>; glVertexAttribPointer<span class="hljs-params"><span class="hljs-params">(kCCVertexAttrib_Position, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">2</span></span></span><span class="hljs-params">, GL_FLOAT, GL_FALSE, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">0</span></span></span><span class="hljs-params">, vertexArr)</span></span>; glVertexAttribPointer<span class="hljs-params"><span class="hljs-params">(kCCVertexAttrib_TexCoords, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">2</span></span></span><span class="hljs-params">, GL_FLOAT, GL_FALSE, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">0</span></span></span><span class="hljs-params">, vertexTex)</span></span>; glDrawArrays<span class="hljs-params"><span class="hljs-params">(GL_TRIANGLE_STRIP, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">0</span></span></span><span class="hljs-params">, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">4</span></span></span><span class="hljs-params">)</span></span>; //   stencil buffer   glStencilFunc<span class="hljs-params"><span class="hljs-params">(GL_EQUAL, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">1</span></span></span><span class="hljs-params">, </span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">255</span></span></span><span class="hljs-params">)</span></span>; [self.shaderProgram use]; [self.shaderProgram setUniformsForBuiltins]; ccGLBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA); ccGLBindTexture2DN(<span class="hljs-number"><span class="hljs-number">0</span></span>, tex0.name); ccGLEnableVertexAttribs(kCCVertexAttribFlag_Position|kCCVertexAttribFlag_Color|kCCVertexAttribFlag_TexCoords); glVertexAttribPointer(kCCVertexAttrib_Position, <span class="hljs-number"><span class="hljs-number">2</span></span>, GL_FLOAT, GL_FALSE, <span class="hljs-number"><span class="hljs-number">0</span></span>, vertexArr); glVertexAttribPointer(kCCVertexAttrib_TexCoords, <span class="hljs-number"><span class="hljs-number">2</span></span>, GL_FLOAT, GL_FALSE, <span class="hljs-number"><span class="hljs-number">0</span></span>, vertexTex); glDrawArrays(GL_TRIANGLE_STRIP, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>); glActiveTexture(GL_TEXTURE0); }</code> </pre> <br><br>  The shader for drawing a stencil texture will look like this: <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">precision</span></span> lowp <span class="hljs-type"><span class="hljs-type">float</span></span>; <span class="hljs-type"><span class="hljs-type">varying</span></span> vec2 v_texCoord; uniform sampler2D CC_Texture0; //     <span class="hljs-type"><span class="hljs-type">void</span></span> main() { vec4 color = texture2D(CC_Texture0, v_texCoord); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (color.a == <span class="hljs-number"><span class="hljs-number">0.0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">discard</span></span>; } gl_FragColor = color; }</code> </pre> <br><br>  Of course, using the discard function (as well as the if function and inconsistent access to textures) in a pixel shader is evil and low fps.  Therefore, there is no point in abusing stencil with such a buffer, which is why it is in fact little used in 2d. <br><br>  In the end, I decided to get rid of the separate ‚Äúbaking‚Äù of the stencil texture in the framebuffer, as well as from loading it into the stencil buffer.  And I came to this decision: I make one framebuffer with a small gas texture, build a VBO stencil in which I store the coordinates of the pipeline textures, the coordinates of the gas textures, and the coordinates of the screen and render it on the screen.  I see a great fps. <br><br>  Video of the result can be viewed <a href="https://everyplay.com/videos/6526466">here</a> . <br>  These ‚Äúexercises‚Äù helped me a lot in understanding the depth of ‚Äúopen gl‚Äù.  Perhaps someone will also be interested and useful this knowledge. </div><p>Source: <a href="https://habr.com/ru/post/227491/">https://habr.com/ru/post/227491/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../227479/index.html">Nokia X2 introduced: the next generation of the X line</a></li>
<li><a href="../227483/index.html">Why the growth of quality causes the growth of poor quality, or whether the main function</a></li>
<li><a href="../227485/index.html">Why do you still wear "silly" clothes?</a></li>
<li><a href="../227487/index.html">Anonymity in the era of social networks: what to do when your ‚Äúprivacy level‚Äù falls below zero</a></li>
<li><a href="../227489/index.html">The most popular ideas of robots on Kickstarter</a></li>
<li><a href="../227493/index.html">Mojolicious Documentation: Lost Chapters</a></li>
<li><a href="../227497/index.html">OpenVZ Critical Vulnerability</a></li>
<li><a href="../227499/index.html">Astro tracker for two evenings</a></li>
<li><a href="../227501/index.html">Oculus buys a group of top industrial designers</a></li>
<li><a href="../227507/index.html">The life cycle of tasks in Redmine for a small development team. Our experience and useful tips</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>