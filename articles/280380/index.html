<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We solve the problem of interception and substitution of DNS queries. DNSCrypt in Yandex Browser</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When it comes to protecting web traffic from interception and spoofing, the HTTPS protocol or even your own VPN server comes first to your mind. Unfor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We solve the problem of interception and substitution of DNS queries. DNSCrypt in Yandex Browser</h1><div class="post__text post__text-html js-mediator-article">  When it comes to protecting web traffic from interception and spoofing, the HTTPS protocol or even your own VPN server comes first to your mind.  Unfortunately, many people forget about another unprotected side, namely DNS queries.  Today, I will once again draw attention to this problem and tell you how we solve it in Yandex Browser using the DNSCrypt technology. <br><br><img src="https://habrastorage.org/files/26a/bd5/023/26abd5023b6f47bdaa574b185c707aee.png"><br><br><a name="habracut"></a>  The architecture of the domain name system (DNS) with rare exceptions has remained unchanged since 1983.  Every time you want to open a website, the browser sends a request indicating the domain to the DNS server, which in response sends the required IP address.  Both the request and the response to it are transmitted in the clear, without any encryption.  This means that your provider, network administrator or attacker with MITM can not only keep the history of all the sites you requested, but also replace the answers to these requests.  It sounds unpleasant, is not it? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I propose to recall a few real stories of interception and substitution of DNS queries. <br><br>  <b>DNS hijacking</b> <br><br>  Intercepting DNS queries (DNS hijacking) is not a rare horror story, but a common practice.  For example, among <a href="https://en.wikipedia.org/wiki/DNS_hijacking">providers</a> .  This usually works as follows.  If the user tries to go to a non-existent site, the provider redirects him to his page with advertising.  And maybe not on his own. <br><br>  The American provider Earthlink in 2006 began to <a href="http://www.wired.com/2008/04/isps-error-page">redirect</a> users and information about their requests to the advertising partner Barefruit.  It looked especially bad if the user requested a non-existent domain of a well-known site, for example, webmale.google.com.  The user saw ads and content that had nothing to do with google.com in the address bar. <br><br>  This practice clearly violates <a href="https://tools.ietf.org/html/rfc2308">the RFC standard</a> for DNS responses and makes users vulnerable to XSS attacks.  For example, researcher Dan Kaminsky demonstrated a vulnerability that allowed fraudulent frames to be built into Facebook or PayPal. <br><br><img src="https://habrastorage.org/files/07f/476/d2f/07f476d2fdb64e17b84b1205232392de.png"><br><br>  Of course, you can refuse to use the provider‚Äôs DNS server and add third-party solutions (for example, Google Public DNS or Yandex.DNS) in the settings of the router.  But in the absence of encryption, this does not solve the problem.  The provider may <a href="https://hackercodex.com/guide/how-to-stop-isp-dns-server-hijacking/">well intervene</a> here, replacing the answer with your own. <br><br>  If providers have already learned how to earn money by replacing DNS responses, then what about fraudsters?  In 2007, a group of enterprising people from Estonia created the <a href="https://en.wikipedia.org/wiki/DNSChanger">DNSChanger</a> Trojan, which in a few years infected 4 million computers worldwide.  Trojan changed the DNS system settings, which led to the appearance of advertising on web pages.  This brought the creators $ 14 million and a prison sentence.  And the most surprising thing about this story is that, according to the court decision, it was necessary to maintain temporary DNS servers for 7 months at the addresses where the scam servers were located.  If they had not done this, the users of the infected devices would have instantly lost access to the network. <br><br>  The scale of the DNSChanger Trojan is impressive, but the Brazilians outdid it.  4.5 million DSL modems were <a href="https://securelist.com/blog/incidents/66358/web-based-attack-targeting-home-routers-the-brazilian-way/">cracked</a> in Brazil alone in 2011-2012.  To do this, it was enough to send spam with reference to a malicious page that cracked a modem and registered a new address of the DNS server.  And this time the fraudsters did not begin to waste time with advertising.  On their fake DNS servers, they replaced the addresses for all the major banks in Brazil. <br><br>  With home and office WiFi routers, the situation is just as sad as with Brazilian modems.  Users often leave the factory login and password for the admin panel, and almost no one follows the release of fresh firmware with fixed vulnerabilities (except for Habr's readers, of course).  Last year, researchers from Sentrant in their <a href="https://sentrant.com/2015/03/25/ad-fraud-malware-hijacks-router-dns-injects-ads-via-google-analytics/">report</a> told about new cases of hacking routers.  Fraudsters intercepted appeals to Google Analytics and thanks to this they built ads on sites. <br><br><iframe src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://player.vimeo.com/video/123058333&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiO5epiXOKO1NG-jfurXdxMKjc5NA" width="560" height="315" frameborder="0" title="Ads Injected Via Hijacked Router DNS" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe><br><br>  I think with examples of interception you can finish.  The conclusion here is simple: DNS intercepts a lot, at different stages and for different purposes. <br><br>  <b>DNSCrypt</b> <br><br>  The developers of the popular OpenDNS service offered a solution to the problem several years ago.  They created the open-source utility <a href="https://dnscrypt.org/">DNSCrypt</a> and the protocol of the same name, which plays the same role for DNS queries as SSL for HTTP. <br><br>  First, DNSCrypt encrypts messages between your computer and the DNS server using strong <a href="http://dnscurve.org/crypto.html">elliptical cryptography</a> .  This will protect them from interception and MITM. <br><br>  Secondly, you are no longer tied to the server of the provider or the settings of your router.  DNSCrypt addresses addresses directly to the server you specify. <br><br>  Until now, to use DNSCrypt, users had to install a separate utility on their computer.  This is not difficult, but without a wide dissemination of knowledge about the threat and how to solve it, one can hardly count on the massive use of technology. <br><br>  <b>DNSCrypt support in Yandex Browser</b> <br><br>  Our team considers DNS encryption to be no less important than switching to HTTPS, so we decided to support DNSCrypt at the Yandex browser level.  And today we are starting to test the new beta version of Yandex. Browser 16.4, whose users can enable DNS request protection in their settings. <br><br><img src="https://habrastorage.org/files/d98/5dc/43a/d985dc43ae084bbeb138eced8edeb285.png"><br><br>  In this case, all requests in encrypted form will be sent to a fast <a href="https://dns.yandex.ru/">Yandex DNS server</a> , which also received support for the DNSCrypt protocol.  We do not want to restrict users to only one server, so in the near future we will add the possibility to choose an alternative DNS server (for example, the same OpenDNS) in this place. <br><br><img src="https://habrastorage.org/files/a58/ea0/9fb/a58ea09fb197467a92006d506aa9a8e7.png"><br><br>  And something else.  You can replace the phishing IP address not only by intercepting the request, but also through the most common system host file.  Therefore, we are now experimenting with the prohibition to use the system resolver in case of unavailability of the DNS server.  We understand that the inclusion of this option by default can harm users of corporate and local resources, so for the time being we are only watching and collecting reviews. <br><br>  You can install the beta with <a href="https://browser.yandex.ru/beta/">browser.yandex.ru/beta</a> .  We would be interested to know the opinion of the community. </div><p>Source: <a href="https://habr.com/ru/post/280380/">https://habr.com/ru/post/280380/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../280370/index.html">Tips, libraries and additional materials on CSS-animation</a></li>
<li><a href="../280372/index.html">Interactive video and what it eats</a></li>
<li><a href="../280374/index.html">Measuring code coverage tests on Android using JaCoCo</a></li>
<li><a href="../280376/index.html">In simple words: We deal with "cloud" services.</a></li>
<li><a href="../280378/index.html">man! (Go => D) .concurrency</a></li>
<li><a href="../280382/index.html">Yii framework code parsing</a></li>
<li><a href="../280384/index.html">Million files and one laptop</a></li>
<li><a href="../280386/index.html">Flume - manage data streams. Part 1</a></li>
<li><a href="../280388/index.html">Understanding multithreading in RxJava</a></li>
<li><a href="../280390/index.html">SaaS solutions to protect any device anywhere: why it‚Äôs simpler and cheaper + implementation example</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>