<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Use the comet server to implement a simple chat.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Comet - any model of the web application, in which a permanent HTTP connection allows the web server to send (push) data to the browser without an add...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Use the comet server to implement a simple chat.</h1><div class="post__text post__text-html js-mediator-article">  Comet - any model of the web application, in which a permanent HTTP connection allows the web server to send (push) data to the browser without an additional request from the browser. <br><br>  The diagram shows the place of the server comets in the process. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/fab/427/3de/fab4273dec734b7f902d4e61cf6b84d5.png" width="600" alt="The diagram shows the place of the server comets in the process."></div><br><a name="habracut"></a><br>  Interaction with comets server is constructed as follows. <br><ol><li>  The browser opens the site page. </li><li>  After loading the page JavaScript establishes a permanent connection with the comet server. </li><li>  While the page is open, your server can send an arbitrary message to the client.  To do this, he uses Api to comets to the server and sends him a message. </li><li>  A comet server using an open browser connection delivers the received message to the browser. </li><li>  JavaScript Api the message received from the server betrays your callback </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  <font color="#2b73b7">Existing approaches</font> </h1><br>  There are quite a few approaches for implementation, but WebSockets are currently relevant, using other approaches such as Polling, Long polling, ‚Äúendless‚Äù iframe and Flash sockets is almost necessary since web sockets are supported by <a href="http://caniuse.com/">all modern browsers</a> . <br><br><h1>  <font color="#2b73b7">Implementations of comets servers</font> </h1><br>  It will be good if someone else shares links to similar projects. <br><table><tbody><tr><td>  Title </td><td>  License </td><td>  API </td></tr><tr><td>  <a href="http://habrahabr.ru/post/268717/">Centrifuge</a> </td><td>  MIT </td><td>  Python, Ruby, Java, PHP </td></tr><tr><td>  <a href="http://habrahabr.ru/post/79189/">dklab_realplexor</a> </td><td>  GPL </td><td>  Php </td></tr><tr><td>  <a href="https://github.com/wandenberg/nginx-push-stream-module">Nginx Push Stream Module</a> </td><td>  GPL </td><td>  REST API </td></tr><tr><td>  <a href="http://ape-project.org/">APE Project</a> </td><td>  GPL </td><td>  REST API </td></tr><tr><td>  <a href="http://comet-server.ru/menu_id/10">comet-server.ru</a> </td><td>  As a service <br>  With installation on the servers </td><td>  Delphi, C, C ++, Eiffel, Java, Lisp, Perl, <br>  PHP, Python, Ruby, Smalltalk, Node.js, <br>  Bash, Component Pascal and Tcl <br>  (All languages ‚Äã‚Äãfor which there is a MySQL client) </td></tr><tr><td>  <a href="https://fanout.io/pricing/">fanout.io</a> </td><td>  As a service <br>  With installation on the servers </td><td>  Python, Ruby, PHP, Node, Go, Django </td></tr><tr><td>  <a href="http://pusher.com/pricing">pusher.com</a> </td><td>  As a service </td><td>  REST API and libraries for Ruby, PHP, .NET, <br>  Node.js, Python </td></tr><tr><td>  <a href="https://www.hydna.com/plans-and-pricing/">hydna.com</a> </td><td>  As a service </td><td>  C ++, Erlang, Go (Push only), Java, JavaScript, <br>  Julia (Push only), Lua (Push only), .NET, Node.js, <br>  Objective-C, PHP (Push only), Python (Push only), <br>  Ruby (Push only) </td></tr><tr><td>  <a href="https://www.tambur.io/pricing">tambur.io</a> </td><td>  As a service </td><td>  Ruby, Python, PHP, Java, Erlang </td></tr></tbody></table>  There is also a <a href="http://cometdaily.com/maturity.html">summary table of implementations of server comets</a> , but it is dated as far as 2009. <br><br><h1>  <font color="#2b73b7">Building a simple chat on php</font> </h1><br>  Let us analyze an example of building a chat.  We will use <a href="http://comet-server.ru/">comet-server.ru</a> as comets server <a href="http://comet-server.ru/">.</a> <br><div style="text-align:center;"><img src="https://habrastorage.org/files/164/3cd/f84/1643cdf848544901913bd1c3a9af9b3a.png" width="600"></div><br>  The chat will work as follows: <br><ul><li>  The user enters the page and immediately subscribes using <a href="http://comet-server.ru/wiki/doku.php/comet:javascript_api">JavaScript Api</a> to the channel to receive chat messages. </li><li>  In order to send a message, the user sends the text of the message via ajax to a php server. </li><li>  The PHP server processes the received message, optionally saves it to itself in the database and does anything with it. </li><li>  Then the php server connects to the comets server and sends him a <a href="http://comet-server.ru/wiki/doku.php/comet:cometql">CometQL</a> request to send the message to the channel. </li><li>  The comets server received from the php server message is sent to everyone who subscribes to the channel. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Code to receive messages from the chat</b> <div class="spoiler_text"><pre><code class="javascript hljs">&lt;!DOCTYPE HTML&gt; &lt;html&gt; &lt;head&gt; &lt;!--   --&gt; &lt;script src="//comet-server.ru/CometServerApi.js" type="text/javascript"&gt;&lt;/script&gt; &lt;script src="//comet-server.ru/doc/CometQL/simplePhpChat/jquery.min.js" type="text/javascript"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;!--        --&gt; &lt;div id="textHolder" style="margin-top:10px; border:1px solid #000;padding:10px;"&gt;&lt;/div&gt; &lt;hr&gt; &lt;input type="text" id="msgText" placeholder=" "&gt;&lt;input type="button" value="" onclick="sendMsg();"&gt;       &lt;a href="http://comet-server.ru/wiki/doku.php/comet:cometql"&gt;CometQL&lt;/a&gt;. CometQL -  api        MySQL. &lt;script type="text/javascript"&gt; $(document).ready(function(){ /** *       SimplePhpChat */ CometServer().subscription("SimplePhpChat", function(event){ console.log("     SimplePhpChat", event.data, event); $("#textHolder").html( $("#textHolder").html() +"&lt;hr&gt;"+event.data); }) /** *    .    . * dev_id     */ CometServer().start({dev_id:15 }) }) function sendMsg(){ var text = $("#msgText").val(); jQuery.ajax({ url: "//comet-server.ru/doc/CometQL/simplePhpChat/sendMsgToChat.php", type: "GET", data:"text="+encodeURIComponent(text), success: function(){ $("#msgText").val(''); } }); } &lt;/script&gt; &lt;/body&gt; &lt;/html&gt;</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Code to send a message from php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//            (         comet-server.ru ) //  15 //  lPXBFPqNg3f661JcegBY0N0dPXqUBdHXqj2cHf04PZgLHxT6z55e20ozojvMRvB8 //   CometQL_v1 $link = mysqli_connect("app.comet-server.ru", "15", "lPXBFPqNg3f661JcegBY0N0dPXqUBdHXqj2cHf04PZgLHxT6z55e20ozojvMRvB8", "CometQL_v1"); //     mysqli_query ( $link, "INSERT INTO pipes_messages (name, event, message)VALUES('SimplePhpChat', '', '".mysqli_real_escape_string($link,htmlspecialchars($_GET['text']))."' );" );</span></span></code> </pre><br></div></div><br>  Demo of chat work <a href="http://comet-server.ru/doc/CometQL/simplePhpChat/index.html">here</a> . <br>  <a href="http://comet-server.ru/wiki/doku.php/comet:simple-chat-example">Here</a> is another example of the chat, but the php server is not used at all, the comet server does all the work.  And <a href="http://comet-server.ru/wiki/doku.php/comet:chat-with-authorization">here is</a> an example of chat with authorization on comets server. </div><p>Source: <a href="https://habr.com/ru/post/273573/">https://habr.com/ru/post/273573/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../273561/index.html">Welcome to the Russian-language site for developers on Rust</a></li>
<li><a href="../273563/index.html">Vacation Where? When? R</a></li>
<li><a href="../273567/index.html">Push notifications in Firefox 44 and up</a></li>
<li><a href="../273569/index.html">Unit Tests in ABAP. Part two. Rake</a></li>
<li><a href="../273571/index.html">Time Division Multiplexing (TDM) in the management of a critical project resource</a></li>
<li><a href="../273575/index.html">Temperature control in the data center: why it is sometimes possible and hotter</a></li>
<li><a href="../273579/index.html">History 30 places in the final Russian AI Cup 2015</a></li>
<li><a href="../273581/index.html">Handlebars. Guide to action</a></li>
<li><a href="../273583/index.html">How the Airbnb engineering team ‚Äúcrashed‚Äù the main project database in a couple of weeks</a></li>
<li><a href="../273585/index.html">Parallelizing the Strassen Algorithm on Intel¬Æ Xeon Phi (TM)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>