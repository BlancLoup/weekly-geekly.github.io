<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>IL2CPP: generalized implementation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous article in the IL2CPP series, we looked at method calls in the generated C ++ code. Now we will talk about one of the most important f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>IL2CPP: generalized implementation</h1><div class="post__text post__text-html js-mediator-article">  <a href="https://habrahabr.ru/company/plarium/blog/310614/">In the previous article in the IL2CPP series,</a> we looked at method calls in the generated C ++ code.  Now we will talk about one of the most important features of the IL2CPP code - a generalized implementation of methods that allows to significantly reduce the size of the executable file IL2CPP.  It is worth noting that the generic implementation is also used in Mono and .NET runtime environments.  In IL2CPP, it was not initially supported and was added only with time. <br><br><img src="https://habrastorage.org/webt/xq/ov/sn/xqovsntnqueejtrmyz1nxalvrtg.png"><br><a name="habracut"></a><br>  So, we will analyze the implementation of generalized methods for reference types and value types, as well as how the limitations of generalized parameters affect it.  Do not forget that the generated code in this article may change in future versions of Unity.  But, as a rule, we discuss such changes immediately after their release. <br><br><h2>  What is a generic implementation? </h2><br>  Imagine that you need to write an implementation for the List class in C #.  Will this implementation depend on type T?  Can I use the implementation of the Add method for both List string and List object?  What about List DateTime? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Generally, plus generalizations is that their implementations in C # are suitable for sharing, which means that the generic List class is suitable for any type of T. But what if you need to convert a List from C # to something executable, for example, an assembly code how does Mono do it, or C ++ code in the case of IL2CPP?  Can we then use the same implementation of the Add method? <br><br>  In most cases, yes.  As we will see later in this article, the possibility of a generalized implementation is almost entirely the size of type T. If it is a reference type (string or object), its size is always equal to the size of the pointer.  If T is a value type (int or DateTime), its size can vary, and this complicates things a little.  In the end, the more methods have a common implementation, the smaller the size of the executable code. <br><br>  Mark Probst, a developer who implemented a generic implementation in Mono, wrote about several interesting articles about this.  We will not go deep into the concept itself, but rather talk about how and under what conditions it is used in the IL2CPP.  I think this information will be able to give you a more complete picture of the size of the executable file of your project. <br><br><h2>  Features generalized implementation in IL2CPP </h2><br>  IL2CPP supports a generic method implementation for the SomeGenericType type if T is a reference type (string, object, or any custom class), integer type, or enum.  For value types, the generic implementation is not supported, since their size may vary depending on the size of the fields. <br><br>  This means that adding SomeGenericType, where T is the reference type, will have little effect on the size of the executable file.  On the other hand, if T is a type of value, the consequences will be more tangible.  In Mono and IL2CPP it works the same way.  But let's go directly to the implementation details. <br><br><h2>  Preparation for work </h2><br>  I will use the version of Unity 5.0.2p1 on Windows to build the project under WebGL.  At the same time, I will turn on the Development Player option and set the value to None for Enable Exceptions.  To begin with, we write the driver method to create instances of generic types, which we will consider: <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DemonstrateGenericSharing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ var usesAString = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GenericType&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;(); var usesAClass = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GenericType&lt;AnyClass&gt;(); var usesAValueType = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GenericType&lt;DateTime&gt;(); var interfaceConstrainedType = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InterfaceConstrainedGenericType&lt;ExperimentWithInterface&gt;(); }</code> </pre> <br>  Then we define the types used in this method: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GenericType</span></span></span><span class="hljs-class">&lt;T&gt; {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UsesGenericParameter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoesNotUseGenericParameter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> U UsesDifferentGenericParameter&lt;U&gt;(U value) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AnyClass</span></span></span><span class="hljs-class"> {</span></span>} interface AnswerFinderInterface { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ComputeAnswer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExperimentWithInterface</span></span></span><span class="hljs-class"> :</span></span> AnswerFinderInterface { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ComputeAnswer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span>; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InterfaceConstrainedGenericType</span></span></span><span class="hljs-class">&lt;T&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">where</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> :</span></span> AnswerFinderInterface { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindTheAnswer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T experiment)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> experiment.ComputeAnswer(); } }</code> </pre> <br>  All code is nested in a class called HelloWorld, derived from MonoBehaviour.  You may also note that the il2cpp.exe command line no longer contains the -enable-generic-sharing option, as <a href="https://habrahabr.ru/company/plarium/blog/276589/">in the first article in this series</a> .  However, a generic implementation occurs, but now - automatically. <br><br><h2>  Generic implementation of reference types </h2><br>  To begin, consider the most common case - reference types.  In managed code, these types are derived from System.Object, and in generated code, from Object_t.  Therefore, you can use Object_t * placeholder to represent them in C ++ code. <br><br>  Let's find the generated version of the DemonstrateGenericSharing method.  In my project, it is called HelloWorld_DemonstrateGenericSharing_m4.  We are interested in defining four methods in the GenericType class.  With Ctags, we can go to the method declaration for GenericType_1__ctor_m8 (constructor GenericType).  Notice that this method declaration is a #define statement that maps this method to the GenericType_1__ctor_m10447_gshared method. <br><br>  Now let's find the method declarations for the GenericType type.  Interestingly, the declaration of the constructor GenericType_1__ctor_m9 is also the #define operator associated with the same function - GenericType_1__ctor_m10447_gshared! <br>  A comment to the definition code GenericType_1__ctor_m10447_gshared indicates that this method corresponds to the name of the managed method HelloWorld / GenericType`1 &lt;System.Object&gt; ::. Ctor ().  This is a constructor of type GenericType object, which is called completely generalized - if you take the type GenericType, then for any reference type T the implementation of all methods will use the version where T is object. <br><br>  Just below the constructor in the generated code, you can see the UsesGenericParameter method: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> <span class="hljs-function"><span class="hljs-function">Object_t * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenericType_1_UsesGenericParameter_m10449_gshared</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GenericType_1_t2159 * __this, Object_t * ___value, MethodInfo* method)</span></span></span><span class="hljs-function"> </span></span>{ { Object_t * L_0 = ___value; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> L_0; } }</code> </pre> <br>  In both cases, where the generic parameter T is found (the type of the return value and the type of the individual argument), the type of Object_t * is used in the generated code.  And taking into account the fact that all reference types in such code can be represented via Object_t *, this implementation of the method can be called for any T that is a reference type. <br><br>  <a href="https://habrahabr.ru/company/plarium/blog/280824/">In the second article</a> in this series, I mentioned that all method definitions in C ++ are free functions.  The il2cpp.exe utility does not use C ++ inheritance to generate overridden C # methods, but uses it for types.  By typing ‚ÄúAnyClass_t‚Äù into the search, we can see how the C # AnyClass type looks like in C ++: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AnyClass_t1</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Object_t { };</code> </pre><br>  Given that AnyClass_t1 is derived from Object_t, we can simply pass it a pointer as an argument to the GenericType_1_UsesGenericParameter_m10449_gshared function. <br><br>  But what about the return value?  We cannot return a pointer to the base class where a pointer to the derived class is supposed, isn't it?  Take a look at the declaration of the GenericType :: UsesGenericParameter method: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> GenericType_1_UsesGenericParameter_m10452(__this, ___value, method) (( AnyClass_t1 * (*) (GenericType_1_t6 *, AnyClass_t1 *, MethodInfo*))GenericType_1_UsesGenericParameter_m10449_gshared)(__this, ___value, method)</span></span></code> </pre> <br><br>  In the generated code, the return value (type Object_t *) actually becomes derived type AnyClass_t1 *.  It turns out that IL2CPP is deceiving the C ++ compiler to avoid the C ++ type system. <br><br><h2>  Generalized implementation with constraints </h2><br>  Suppose we need to allow some methods to be called on an object of type T, but wouldn't the use of Object_t * prevent this?  It will, but first we need to communicate this idea to the C # compiler with the help of generalized constraints. <br><br>  Take another look at the script code, namely InterfaceConstrainedGenericType.  This generic type uses a where clause to type T derived from the AnswerFinderInterface interface, thereby allowing a call to the ComputeAnswer method.  In the previous article, we said that calling the interface methods requires searching in the vtable table.  And since the FindTheAnswer method makes a direct function call for an instance of a limited type T (represented by Object_t *), a fully generalized implementation can be used in C ++ code. <br><br>  Moving from implementing the HelloWorld_DemonstrateGenericSharing_m4 function to defining the InterfaceConstrainedGenericType_1__ctor_m11 function, we can see that this method is the #define operator associated with the InterfaceConstrainedGenericType_1__ctor_m10456_gshared function.  Below is the implementation of the InterfaceConstrainedGenericType_1_FindTheAnswer_m10458_gshared function, which takes an Object_t * argument and is also completely generic.  Calling the InterfaceFuncInvoker0 :: Invoke function allows you to make a call to the ComputeAnswer managed method. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> InterfaceConstrainedGenericType_1_FindTheAnswer_m10458_gshared (InterfaceConstrainedGenericType_1_t2160 * __this, Object_t * ___experiment, MethodInfo* method) { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> s_Il2CppMethodIntialized; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!s_Il2CppMethodIntialized) { AnswerFinderInterface_t11_il2cpp_TypeInfo_var = il2cpp_codegen_class_from_type(&amp;AnswerFinderInterface_t11_0_0_0); s_Il2CppMethodIntialized = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } { <span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> L_0 = (<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span>)InterfaceFuncInvoker0&lt;<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span>&gt;::Invoke(<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">/* System.Int32 HelloWorld/AnswerFinderInterface::ComputeAnswer() */</span></span>, AnswerFinderInterface_t11_il2cpp_TypeInfo_var, (Object_t *)(*(&amp;amp;___experiment))); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> L_0; } }</code> </pre> <br>  It is important to remember that IL2CPP treats any managed interface as System.Object.  This rule is suitable for any code generated by the il2cpp.exe utility. <br><br><h2>  Base class restrictions </h2><br>  In addition to the limitations of the interface, C # admits the existence of restrictions of the base class.  But if IL2CPP does not treat base classes like System.Object, how does the generic implementation work in this case? <br><br>  Since base classes are always reference types, IL2CPP uses fully generalized methods for them.  In any code that uses a field or calls a method for a limited type, the type is coded in C ++.  Again, the C # compiler provides the correct implementation of the generalized constraint, and we cheat the C ++ compiler on the type. <br><br><h2>  Generic Value Type Implementation </h2><br>  Let's go back to the HelloWorld_DemonstrateGenericSharing_m4 function and take a look at the implementation of GenericType.  DateTime is reference type, so GenericType is not generic.  Let's proceed to the declaration of this type of constructor, GenericType_1__ctor_m10.  Here, as in other cases, we see #define, but it is associated with the GenericType_1__ctor_m10_gshared function used by only one class ‚Äî GenericType. <br><br><h2>  Conceptual understanding of the generalized implementation </h2><br>  The concept of a generalized implementation can be quite difficult to understand.  The subject area is full of pathological cases (the same recursive patterns).  Therefore, here it is necessary to highlight several basic principles: <br><br><ul><li>  The implementation of any method for a generic type is generic. </li><li>  In some cases, the implementation of the methods is generalized only for a specific type (for example, the aforementioned type with a generic value type parameter GenericType). </li><li>  Types with a generic parameter of a reference type use a fully generic implementation, treating parameters of all types as System.Object. </li><li>  Types with parameters of two or more types can be partially generalized if at least one of the types of parameters is a reference. </li></ul><br>  For any generic type, the il2cpp.exe utility always generates fully generic method implementations.  Other implementations are generated only if necessary. <br><br><h2>  Generalized methods </h2><br>  The generic implementation is used not only for generic types, but also for generic methods.  Notice that in the source script code, the UsesDifferentGenericParameter method uses a parameter of a different type than the GenericType class.  But when considering the generic implementation for the GenericType class, we did not see this method.  Entering the ‚ÄúUsesDifferentGenericParameter‚Äù into the search, we see that the implementation of this method is in the GenericMethods0.cpp file: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> <span class="hljs-function"><span class="hljs-function">Object_t * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenericType_1_UsesDifferentGenericParameter_TisObject_t_m15243_gshared</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GenericType_1_t2159 * __this, Object_t * ___value, MethodInfo* method)</span></span></span><span class="hljs-function"> </span></span>{ { Object_t * L_0 = ___value; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> L_0; } }</code> </pre> <br>  This is a fully generic implementation that accepts the Object_t * type.  And although this method is of a generalized type, the behavior would be the same for the non-generalized.  It can be argued that il2cpp.exe always tries to generate the minimum amount of code to implement methods with generic parameters. <br><br><h2>  Conclusion </h2><br>  A generic implementation is one of the most important improvements in IL2CPP since its release, which makes it possible to significantly reduce the size of C ++ code for implementations of methods with the same behavior.  We continue to look for solutions to reduce the size of binary files and try to use more advantages and opportunities of a generalized implementation. <br><br>  In the next article we will talk about the generation of p / invoke wrappers, as well as the types marshaling between managed and unmanaged code. </div><p>Source: <a href="https://habr.com/ru/post/345736/">https://habr.com/ru/post/345736/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345726/index.html">Mobile devices from the inside. The image structure of partitions containing the file system. Part 1</a></li>
<li><a href="../345728/index.html">Employees and business: and not a friend, and not an enemy, but how?</a></li>
<li><a href="../345730/index.html">Useful to the designer - issue number 3. Needed community news to improve your workflow</a></li>
<li><a href="../345732/index.html">Git: Newbies Tips - Part 1</a></li>
<li><a href="../345734/index.html">Bloomberg: in search of new markets, high-frequency traders master cryptocurrency</a></li>
<li><a href="../345738/index.html">The system for preparing video for streaming on the platform ivi</a></li>
<li><a href="../345740/index.html">What is Hashing? Under the hood of the blockchain</a></li>
<li><a href="../345742/index.html">How not to write on Habr: Antireyting 2017</a></li>
<li><a href="../345744/index.html">New release Oh, my code! How I became a VKontakte developer at 16</a></li>
<li><a href="../345746/index.html">Eat three donuts from UWP and not choke</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>