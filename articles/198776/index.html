<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>JavaFX WebView (HTML / JS) - we use web practices for developing desktop applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="JavaFX was chosen as the base UI framework for our application. JavaFX has performed well. In the same article, we wanted to focus on one component of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>JavaFX WebView (HTML / JS) - we use web practices for developing desktop applications</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/2df/660/d68/2df660d6808654e9f78a602a00d41c29.png" alt="image"><br>  JavaFX was chosen as the base UI framework for our application.  JavaFX has performed well.  In the same article, we wanted to focus on one component of JavaFX - WebView. <br><br>  When developing our application, the COLT interface, we used the approach that is gaining popularity among developers when some of the UI components are implemented in JavaScript / HTML. <a name="habracut"></a><br><br>  The HTML / JS-based component is a regular Java class, a regular JavaFX component with a layout ‚Äî HBox or just Pane, which contains an instance of the Webview component. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  How to create an instance of webkit in JavaFX and upload HTML </h3><br><pre><code class="java hljs">WebView webView = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebView(); WebEngine engine = webView.getEngine(); engine.load(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getClass().getResource(<span class="hljs-string"><span class="hljs-string">"html/webview.html"</span></span>).toExternalForm())</code> </pre> <br><br>  What we got using web technology in our application. <br><br><h3>  Tons of ready-made solutions </h3><br>  jQuery, D3 covers almost all of our tasks.  We need a ready-made solution - we find it through Google in 5 minutes.  It's great that the analogues of the interface elements are filled to capacity by the whole Internet.  And all in the public domain.  You can peep the idea and take its implementation. <br><br><h3>  Cheap </h3><br>  In Java, the same that we implemented on JS / HTML would be difficult to write. <br><br>  For example, this component to add paths.  As a basis, we took the tag engine and properly ‚Äúfinished‚Äù it.  It turned out a very clever and pleasant thing.  It can edit in the ‚Äútag‚Äù mode, and by double-clicking it still allows you to simply work with the text.  Work with "clipboard". <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3dc/4e7/6f9/3dc4e76f955a5c7c65f16334f57f25cb.png" alt="image"><br><br>  Prior to this, in the previous version of the interface, we used an ugly list-view.  Our new fileset is simple, compact, modern.  There are ideas how to further extend its functionality. <br><br>  The second example is the log view. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f23/580/543/f2358054346277973aef1041db34df3f.png" alt="image"><br><br>  First, we wanted to make a component based on a ListView.  We did not receive any special problems with skinning, but still the component turned out to be unsuitable for real use by users.  For example, it was impossible to select logs as text, several blocks at once, the implementation of the component threatened to result in a considerable amount of code.  The HTML component is light and extensible.  It should be noted that JavaFX uses GPU for DOM rendering, so the component turned out to be quite productive.  We plan to expand the component by searching for logs, filters, etc.  We plan to implement all this with JavaScript / CSS. <br><br>  Maybe we are just not so good at Java-UI, but it was really difficult for us to write components with complex interactivity to Java.  Where you need a ready-made component, an example of which you can ‚Äúgoogle‚Äù - yes, everything is easy and simple.  Linking data and ‚Äúviews‚Äù through ‚Äúbinding‚Äù is again very simple and familiar (our previous experience is Adobe Flex).  But when it comes to something that goes beyond the standard case studies described in the documentation - we lost too much time on the ‚Äúsearch‚Äù. <br><br>  We have developed the following scheme for ourselves - we are trying to do it through JavaFX components, and if we ‚Äúrun into the wall,‚Äù or the implementation becomes too complicated, then we write in HTML.  This approach greatly accelerated our development. <br><br><h3>  Cross Platform </h3><br>  The JavaFX webview engine is a webkit.  Works the same on any platform.  We practically did not waste time on cross-platform relationships. <br><br><h3>  Java javascript bridge </h3><br>  A bundle of Java-JavaScript, a bridge between them allows you to make calls to Java classes from HTML, as well as invoke JavaScript code from Java.  A simple example of Java code: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ JSObject windowObject = (JSObject)webView.getEngine().executeScript(<span class="hljs-string"><span class="hljs-string">"window"</span></span>); windowObject.call(<span class="hljs-string"><span class="hljs-string">"test"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>)); }</code> </pre> <br>  And this JavaScript code that accepts data and calls the methods of the ArrayList java - <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(list)</span></span></span></span>{ console.log(<span class="hljs-string"><span class="hljs-string">"list.size() - "</span></span> + list.size();<span class="hljs-comment"><span class="hljs-comment">//3 console.log("list.get(0) - " + list;//1 }</span></span></code> </pre> <br>  An example of course is not quite real, synthetics, but it is clear that the methods are invoked, and the data is accepted. <br><br>  When downloading html, you can add a link to the application directly to the Window object. <br><br><pre> <code class="java hljs">JSObject windowObject = (JSObject) webView.engine.executeScript(<span class="hljs-string"><span class="hljs-string">"window"</span></span>); windowObject.setMember(<span class="hljs-string"><span class="hljs-string">"app"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre> <br>  And call Java methods from JavaScript code - <br><br><pre> <code class="java hljs">app.addData($(<span class="hljs-string"><span class="hljs-string">"my-input"</span></span>).val());</code> </pre> <br>  A more correct (more secure) approach is to create a special object in a Java environment that restricts access and allows only ‚Äúallowed‚Äù methods to be called from an application in JavaScript. <br><br><pre> <code class="java hljs">windowObject.setMember(<span class="hljs-string"><span class="hljs-string">"app"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JSBridge(){ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myMethod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ MyApp.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.myMethod(); } });</code> </pre> <br>  Another example of a bundle through the JS "alert".  We needed to catch the ‚Äúload‚Äù html - full initialization of the application.  All other methods were not so reliable.  What we did. <br><br>  As usual in JavaScript via jquery: <br><br><pre> <code class="java hljs">$(function(){ alert(<span class="hljs-string"><span class="hljs-string">"command:ready"</span></span>); });</code> </pre><br>  In Java, we added an ‚ÄúonAlert‚Äù handler for webview.engine and now we know for sure that HTML is loaded and initialized. <br><br><pre> <code class="java hljs">engine.onAlert = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EventHandler&lt;WebEvent&lt;String&gt;&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(WebEvent&lt;String&gt; event)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-string"><span class="hljs-string">"command:ready"</span></span>.equals(event.getData())){ <span class="hljs-comment"><span class="hljs-comment">//</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> initialize } } }</span></span></code> </pre> <br><h3>  Reuse code </h3><br>  The code that we wrote for our application for computers we plan to reuse for mobile development.  On the mobile application (objective-c / java) we will also create a component based on Webview, most of the functionality will be ready. <br><br><h3>  What difficulties have we encountered when working with HTML / JS in JavaFX? </h3><br>  The first.  Document upload life cycle.  You can call methods in JS only after the page is fully loaded; the documentation suggests a path to track the page state change event in Java.  This approach was quite buggy.  As mentioned earlier - a bunch of ‚Äúload‚Äù events on the html side and interception of ‚Äúalert‚Äù on the Java side, solved this problem. <br><br>  The second problem that drank our blood is glitches with calls to multiple JavaScript functions at the same time in different components from a webview.  Moreover, such a bug has emerged quite recently and is very similar to the optimization that was added to the webkit engine in JavaFX.  In any case, you can get an error about infinite recursion in JavaScript literally from scratch.  This problem is solved quite easily - we wrap the JavaScript call from Java using Platform.runLater (). <br><br>  The third problem.  Debag and logging. <br>  At the first stage of work, when prototyping is in progress and you work only with HTML / JS, you can test it just in the browser.  At the stage of integration with Java, your code simply stops working without the right environment.  And you are more and more often starting to build a Java application in order to test the functionality in JavaScript.  A build Java application and its launch is a long second of waiting.  What techniques in the work we used to avoid such a long load and not lose time? <br><br>  Simple and obvious let - add a "reload" page by key combination.  Corrected HTML / CSS / JS - clicked F5 - the content of WebView was overloaded: <br><br><pre> <code class="java hljs">$(document).keydown(function (e) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(e.keyCode == <span class="hljs-number"><span class="hljs-number">116</span></span> <span class="hljs-comment"><span class="hljs-comment">/*F5*/</span></span>){ location.reload(); } });</code> </pre> <br>  But in addition to a quick "refresh" we need to view the logs. <br>  A fairly simple solution was to add FireBug Lite - <br><br><pre> <code class="java hljs">&lt;script type=<span class="hljs-string"><span class="hljs-string">'text/JavaScript'</span></span> src=<span class="hljs-string"><span class="hljs-string">'http://getfirebug.com/releases/lite/1.2/firebug-lite-compressed.js'</span></span>&gt;&lt;/script&gt;</code> </pre> <br><br>  And of course, as soon as our application ‚Äúbreathed‚Äù and earned livecoding for HTML / JS, we began to use COLT to develop COLT.  At the moment, the functionality of our application covers most cases - we no longer need FireBug Lite.  Log, live update, remote testing, livecoding.  Livkoding in our opinion can replace debag, but users are asking, and we will also fix the ‚Äúreal debug with breakpoints‚Äù. <br><br>  How to connect?  Just add the following code to the html document <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = <span class="hljs-string"><span class="hljs-string">"http://&lt;address&gt;:&lt;port&gt;/webview.html"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location.href != url) { location.href = url }</code> </pre> <br>  Where url is the address where COLT launches the transformed page.  It's easy to learn.  Create a project COLT, specify a link to our page - "Main Document" and start the session - click "green lightning". <br><br><img src="https://habrastorage.org/getpro/habr/post_images/57b/748/20b/57b74820bd92390ae7cb1d2c38040698.png" alt="image"><br><br>  The page will open in the browser.  Let us copy to the page and paste into our JS code.  Browser window is closing.  Now run the JavaFX application.  We try to change the content of the page, JavaScript and livecoding will work directly in the JavaFX application. <br><br>  In the new version, in the settings, in the ‚ÄúAdvanced‚Äù block, we added a special text field with this snippet.  Without starting the project, you can copy this code directly from the COLT settings. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c6b/b0b/498/c6bb0b498fa00d1ee493367cf3f6a494.png" alt="image"><br><br>  Logs will appear in the COLT window.  So that the next time Colt didn‚Äôt open the browser, he launched your application, you can choose not to launch the browser, but to launch from the console.  In our project, we simply copied the text from the output of our run-configuration IDEA and added this call to the COLT console luncher. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/031/2a5/b27/0312a5b27e6a799aab49428efcb5d926.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/841/1f1/da8/8411f1da897c913bbe9cc64b69166c63.png" alt="image"><br><br>  Now, when you click on the "green eyebrow", a Java application window will be launched. <br><br>  In general, the approach to redirecting HTML inside to a live page is universal.  He, for example, works great on PhoneGap.  The application runs on a mobile device (the main thing is that the device is on the same local network) and updates are delivered without the need for a restart.  You need to remember the order of actions - and you can apply wherever there is a WebView. <br><br>  It has become a good practice to add a function to the code change event. <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//@code-update function live(){ console.log("live update"); }</span></span></code> </pre> <br>  The @ code-update annotation intercepts our AST transformations and adds a listener to the code update event. <br><br>  A typical case of working with such a handler is to call functions in code (that is, what we usually write to the FireBug console).  You can change the value or call a function when the application is already running.  Added code, saved - code executed. <br>  Plus it is convenient to ‚Äútreysit‚Äù, output data, the value of which you need to know in ‚Äúruntime‚Äù, without stopping the code - you can simply output them to the console. <br><br><h3>  Groovy </h3><br>  Just a little beyond the scope of the article, the conclusion that we made during the implementation of our project and which we would like to share is that it is better to write UI in a language more concise than Java.  We used Groovy for this and are very pleased.  The amount of code was reduced ten times, and work with XML and the file system was also simplified by an order of magnitude.  AST transformations to create Bindable properties, our transformations allowed us to mix services into controllers, generate Bindable wrappers for simple data.  And so on.  What is called must have.  About using Groovy for JavaFX, we are writing a <a href="http://habrahabr.ru/company/codeorchestra/blog/199050/">separate article</a> . <br><br><h3>  Plans </h3><br>  The approach that we used in the development of our desktop application, we began to apply for mobile development.  We use PhoneGap + COLT and the case is almost the same as JavaFX + HTML + COLT. <br><br>  We chose PhoneGap, and not another platform, since we had already accumulated a lot of things ready in the desktop project and it seemed to us inexpedient to rewrite it to another platform.  If our application requires you to abandon PhoneGap, we will rewrite part of the application to ‚Äúnativ‚Äù, but we will not lose all the functionality that is written in HTML / JS.  They will just run differently. <br><br>  Project site <a href="http://codeorchestra.com/">codeorchestra.com</a> </div><p>Source: <a href="https://habr.com/ru/post/198776/">https://habr.com/ru/post/198776/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../198764/index.html">A record for the speed of data transmission through lasers to the moon and back</a></li>
<li><a href="../198766/index.html">How 45 minutes to lose $ 172 222 per second</a></li>
<li><a href="../198770/index.html">World View: stratospheric tourism in an air (helium) balloon</a></li>
<li><a href="../198772/index.html">Active authors in social media: a study by age group</a></li>
<li><a href="../198774/index.html">Work with tables in MultiCAD.NET. Part 2. Creating and editing</a></li>
<li><a href="../198778/index.html">The story of one Google Chrome extension</a></li>
<li><a href="../198780/index.html">Qt Meta System over Network. Part 2 - Signals and Slots</a></li>
<li><a href="../198782/index.html">Modding of the pulse power supply unit ARPV-SC1E-12005T</a></li>
<li><a href="../198784/index.html">Materials of the summer school on bioinformatics</a></li>
<li><a href="../198788/index.html">Work with tables in MultiCAD.NET. Part 3. External table files and data exchange with Microsoft Excel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>