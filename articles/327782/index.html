<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to create a simple Scala SBT application for Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, friends. Being engaged in the development of tools for developers, I was faced with the question of the interaction of the above-mentioned t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to create a simple Scala SBT application for Android</h1><div class="post__text post__text-html js-mediator-article">  Good day, friends.  Being engaged in the development of tools for developers, I was faced with the question of the interaction of the above-mentioned tool, programming language and platform.  If the first two entities are simply made for each other (SBT is the main, most used build tool for Scala development), their applicability to the Andriod platform is not something taken for granted.  And yet, in a huge and constantly evolving software industry, there are also situations when this set of technologies will be a rational choice.  The question - when this choice is rational, is not the subject of this article.  And I will tell you exactly how to do it. <br><br><h2>  Development environment </h2><br>  I researched the applicability of this approach to work in <a href="https://developer.android.com/studio/install.html">Android Studio</a> and <a href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a> .  For this purpose, there is practically no significant difference in the environments.  There are nuances - I will acquaint you with them in the course of the article. <a name="habracut"></a>  But in general, the technologies that we will use are equally integrated both in the Studio and in the Idea.  After all, the first is based on the same IntelliJ platform as the Idea.  Therefore, your choice should rather be based on the specifics of the project. <br><br><h2>  Creating a basic project </h2><br>  The first tool in our business will be the <a href="https://github.com/JetBrains/intellij-scala">Scala plugin</a> , designed for development in the Scala language in IntelliJ IDEA and Android Studio.  This plugin also provides SBT.  It does not come with development environments, so we will need to download it from the JetBrains repository. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img width="500" src="https://habrastorage.org/files/770/dd2/d56/770dd2d5655d42aba66407f1a1ca7eea.png"></div><br>  Now we can create a basic Scala SBT project.  And here the first difference between environments takes place: Scala plugin provides a Wizard for creating a new SBT project, available in the Idea: <code>[File ‚Üí New ‚Üí Project ‚Üí Scala ‚Üí SBT]</code> .  But Android Studio does not give us the opportunity to go to the choice of the Wizard and immediately runs its own (based on another build tool - Gradle).  Therefore, we can only import the project into SBT Studio.  In principle, this is a matter of 20 seconds: <br><br><ol><li>  In a separate folder, we create a <code>build.sbt</code> file with the contents <code>name := "example"</code> . <br><br></li><li>  <code>sbt compile</code> console command, we generate everything you need for the base project.  (the terminal is launched inside the Studio to have access to the SBT) <br><br><img src="https://habrastorage.org/files/e95/9f2/9e7/e959f29e7d9f40a8bcfe6984c8bd2eb8.png"><br><br></li><li>  In the welcome window of Android Studio, we do an Import project and select the <code>build.sbt</code> we created <code>build.sbt</code> </li></ol><br>  In the import wizard, we specify the Android SDK (currently 25), remove the check-boxes add.  actions and import.  In the Idea, when creating a new SBT project, there is no way to select the Android SDK ‚Äî select the Java SDK (currently 1.8) and the Scala 2.11. * Version.  And the Android SDK itself will be substituted later, after the inclusion of the Android Framework.  SBT project is ready. <br><br><h3>  Plugin for SBT and Android integration </h3><br>  Next, you should adapt the project to run on the Android platform. <br><br><ol><li>  First of all, add the <code>plugins.sbt</code> file to the <code>project</code> folder and add a <a href="https://github.com/scala-android/sbt-android">plug-</a> in to it <br><br><pre> <code class="scala hljs">addSbtPlugin(<span class="hljs-string"><span class="hljs-string">"org.scala-android"</span></span> % <span class="hljs-string"><span class="hljs-string">"sbt-android"</span></span> % <span class="hljs-string"><span class="hljs-string">"1.7.7"</span></span>)</code> </pre> <br></li><li>  Modify <code>build.sbt</code> by adding the sbt-android plug-in and task to run in the build procedure <br><br><pre> <code class="scala hljs">name := <span class="hljs-string"><span class="hljs-string">"example"</span></span> scalaVersion := <span class="hljs-string"><span class="hljs-string">"2.11.8"</span></span> enablePlugins(<span class="hljs-type"><span class="hljs-type">AndroidApp</span></span>) run &lt;&lt;= run in <span class="hljs-type"><span class="hljs-type">Android</span></span> install &lt;&lt;= install in <span class="hljs-type"><span class="hljs-type">Android</span></span></code> </pre> <br></li><li>  Add to the project AndroidManifest.xml.  In Studio, you can put this file in the root of the project.  In the Idea, because  the wizard has already created the folder structure, you should put it on one level with the Source root folder, i.e.  in <code>src/main</code> .  After creating the file, Idea / Studio will prompt us to include the Android Framework in the project.  We accept the offer.  Minimum manifest filling: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.example"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-sdk</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:minSdkVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:targetSdkVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"25"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my_app"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MyActivity"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MyActivityLabel"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.MAIN"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.category.LAUNCHER"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></li><li>  If we are working in Android Studio, create the source root directory scr (the Idea already has <code>src/main/scala</code> ).  In it, we create the com.example package with the <code>MyActivity.scala</code> file, with a simple Activity. <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.example <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.<span class="hljs-type"><span class="hljs-type">Activity</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Activity</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre> <br></li><li>  Open and enable the Android emulator </li><li>  Refresh the project to activate all the new settings.  If you are working in IDEA, then this action automatically turns on ProGuard (which we'll talk about later).  Now it should be disabled in <code>[Project Structure ‚Üí Facets ‚Üí Android ‚Üí Proguard ‚Üí Run proguard ...]</code> . </li><li>  And run the default Run configuration <code>[Run -&gt; Run ... -&gt; MyActivity</code> </li></ol><br>  Result: <br><br><img src="https://habrastorage.org/files/eae/e22/297/eaee222974054ebcae847370d9d6f84c.png"><br><br><h3>  ProGuard Tool - Scala's adaptation to the Android platform </h3><br>  At the moment we have working the simplest application.  If we start expanding it, for example, at least we will add the <code>build.sbt</code> library to <a href="https://github.com/pocorall/scaloid">build.sbt</a> (which we'll talk about later) <br><br><pre> <code class="scala hljs">libraryDependencies += <span class="hljs-string"><span class="hljs-string">"org.scaloid"</span></span> %% <span class="hljs-string"><span class="hljs-string">"scaloid"</span></span> % <span class="hljs-string"><span class="hljs-string">"4.2"</span></span></code> </pre> <br>  then we run into a problem.  Android platform has a limit on the number of references - 64K.  Due to the features of the Scala code, this limit is reached quickly.  And by simply turning on this library, we get an error when starting the project: <br><br> <code>Error:Android Pre Dex: [scaloid_2.11-4.2.jar] trouble writing output: Too many method references: 81694; max is 65536.</code> <br> <br>  The standard approach to solving this problem: <br><br><ol><li>  Cutting out unused code from a project using the <a href="https://developer.android.com/studio/build/shrink-code.html">ProGuard</a> tool; </li><li>  Dividing project sources into several .dex files, each of which will contain an acceptable number of methods.  The procedure name is <a href="https://developer.android.com/studio/build/multidex.html">MultiDexing</a> . </li></ol><br>  As a rule, if the problem can be solved only by the first step, then only it is used.  And MultiDexing is already going on if the first is not enough.  For this task, ProGuard will be sufficient. <br>  The tool is enabled in the Android Facet options: <code>[Project Structure ‚Üí Facets ‚Üí Android ‚Üí Proguard ‚Üí Run proguard ...]</code> .  Note that the default text file with basic settings is already specified: Studio includes a file from the SDK <code>.../Android/sdk/tools/proguard/proguard-android.txt</code> , The idea includes and creates a configuration file in the root of the project <code>.../example/proguard-sbt.txt</code> .  For the successful execution of our project it will be enough to add three additional options to it: <br><br><pre> <code class="scala hljs">-dontwarn scala.** -dontwarn org.scaloid.** -keep <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">example</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">**</span></span></span></span></code> </pre> <br>  When processing byte-code of Scala and Scaloid libraries, ProGuard will wipe Warnings, which in our case do not affect the result, but block the further launch process.  Therefore, the option <code>-dontwarn</code> we remove them.  Also, you need to specify that ProGuard does not cut out our handwritten code.  This provides the option <code>-keep class</code> . <br><br>  When starting, I encountered two errors: <br><br><ol><li>  <code>Unsupported class version number [52.0] (maximum 51.0, Java 1.7)</code> .  The reason is that the Android SDK relies on Java 1.8, and ProGuard supports a maximum of 1.7.  This is solved by <a href="https://sourceforge.net/projects/proguard/files/proguard/">updating</a> ProGuard to version 5 and higher, right inside the Android SDK; </li><li>  <code>Error:ProGuard: Cannot find file /Users/.../Caches/AndroidStudio2.3/compile-server/.../proguard.txt</code> is a bug of the platform itself, and is solved by manual or scripted lining of the <code>proguard-android.txt</code> file from the Android SDK to the same cache, and then renamed to <code>proguard.txt</code> .  Not the most convenient way, but still, this procedure is not often used, especially because users usually specify all these options in the <code>build.sbt</code> file. </li></ol><br>  I did not observe any more problems, and successfully launched a project with the Scaloid library included in it, which when I started it was cut off by ProGuard.  To achieve a certain complexity of the project, it makes sense to include in it a plug-in for working with ProGuard.  There are several of them, but I have found one at the moment: <a href="https://github.com/scala-android/sbt-android">sbt-proguard</a> .  By ProGuard itself there is also a <a href="https://www.guardsquare.com/en/proguard/manual/introduction">manual</a> on its website. <br><br>  On this, my friends, I will complete this article.  If it arouses interest, I will study and describe in more detail the use of libraries for Android development on Scala, such as <a href="https://github.com/pocorall/scaloid">Scaloid</a> or <a href="https://github.com/47deg/macroid">Macroid</a> , and how, using features of the Scala language, to solve common problems / problems on this mobile platform.  In many ways, when studying the material I was helped by the Android SBT <a href="http://scala-android.org/">resource of the</a> plugin and just an information <a href="http://scala-on-android.taig.io/">site</a> dedicated to the development of Scala for Android.  Thank you for your attention, I will again constructive criticism, questions, comments and suggestions.  Thank! </div><p>Source: <a href="https://habr.com/ru/post/327782/">https://habr.com/ru/post/327782/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327760/index.html">Data security in the development of mobile applications</a></li>
<li><a href="../327762/index.html">Biometric authentication technology - a European perspective</a></li>
<li><a href="../327766/index.html">Cultural Embedded at IT Global Meetup In St. Petersburg</a></li>
<li><a href="../327768/index.html">From two tuning forks from Lissajous experiments to a single elliptical level gauge tube with a step of centuries and everything in Python</a></li>
<li><a href="../327780/index.html">Handbook "beekeeper" or answer questions on the EFM8 Bee microcontrollers</a></li>
<li><a href="../327784/index.html">How using PVS-Studio can improve Visual C ++ 2017 Libraries</a></li>
<li><a href="../327786/index.html">GameDev from scratch: How to communicate with the player without words</a></li>
<li><a href="../327788/index.html">Ready native modules for node.js</a></li>
<li><a href="../327792/index.html">Development of a simulator of the evolution of single-celled organisms "The strongest survives"</a></li>
<li><a href="../327796/index.html">Conference Outsource-People 2017, Krakow (day one)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>