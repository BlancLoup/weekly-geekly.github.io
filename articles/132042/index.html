<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing Windows Sidebar gadget from scratch</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I needed to create a gadget for Windows Sidebar. I didn‚Äôt have any skills in this, therefore, having a little googling and having read the d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing Windows Sidebar gadget from scratch</h1><div class="post__text post__text-html js-mediator-article">  Recently, I needed to create a gadget for Windows Sidebar.  I didn‚Äôt have any skills in this, therefore, having a little googling and having read the <a href="http://msdn.microsoft.com/en-us/library/bb508511%2528v%3DVS.85%2529.aspx">documentation</a> , we proceed. <br><br>  Immediately show what happened in the end <br><img src="https://habrastorage.org/getpro/habr/post_images/f2e/a82/788/f2ea827882c6aa4d8c368f4e577c470c.png"><br><br><a name="habracut"></a><br>  The gadget will receive information from the <a href="">site</a> in the form of xml, parse and, in fact, display.  Also, the gadget will check for new versions, and if they are present, refuse to work :) <br>  Initially, for the sake of gaining experience, I wanted to write a gadget entirely in VBScript (since I have not dealt with it yet), but eventually I had to do inserts in JavaScript. <br>  Let's go directly to the code.  Here I will not consider all code, I will show only highlights.  Link to the finished gadget - at the end of the article. <br>  The main file of the gadget - its manifest - the Gadget.xml file.  It should be called that way and be located in the root of our archive (the gadget is nothing but a ZIP archive with the .gadget extension). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gadget</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>Weather from Info.Denms.Ru<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0.1232<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hosts</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wdenms"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">base</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HTML"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">apiVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"main.html"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">permissions</span></span></span><span class="hljs-tag">&gt;</span></span>Full<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">permissions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">platform</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">minPlatformVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hosts</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">icons</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">icon</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"64"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"64"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"icon.png"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">icons</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">author</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cvs"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">info</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">url</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://info.denms.ru"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">author</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>Weather Widget (Info.Denms.Ru)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gadget</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Consider it in more detail. <br>  The &lt;base&gt; element must contain apiVersion, equal to 1.0.0 (at the moment), as well as the src attribute, which indicates the main file of our gadget; <br>  &lt;permissions&gt; - permissions for the gadget.  Set to full; <br>  The &lt;platform&gt; is the minimum version of Widows Sidebar.  At the moment - 1.0; <br>  Parameters &lt;name&gt; - the name of the gadget, &lt;version&gt; - version, &lt;author&gt; - information about the author, &lt;info&gt; - link to the page with the gadget, &lt;icon&gt; - icon of the gadget and &lt;descrtiption&gt; will be displayed on the installed gadgets panel. <br><br>  The main.html file is a regular html file, I will not give it completely, I‚Äôll dwell only on some points. <br>  Using the element g: background sets the background of the gadget.  Let's make it transparent. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">g:background</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"background"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"position:absolute; z-index:-1; top:0; left:0;"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">opacity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">g:background</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  The gadget can be in two states - docked (on the left on the screenshot above), and undocked (on the right).  We will store the current state of the gadget in the JavaScript variable docked. <br><br><pre> <code class="javascript hljs">&lt;SCRIPT Language=<span class="hljs-string"><span class="hljs-string">"VBScript"</span></span>&gt; <span class="hljs-string"><span class="hljs-string">'  JavaScript   VBS function isDocked isDocked = isDockedJS() End Function &lt;/script&gt; &lt;script src="main.vbs" type="text/vbscript"&gt;&lt;/script&gt; &lt;SCRIPT Language="JavaScript"&gt; docked = 0; function isDockedJS() { return docked; } &lt;/SCRIPT&gt; &lt;script type="text/javascript" src="main.js"&gt;&lt;/script&gt;</span></span></code> </pre> <br><br>  We will need the isDocked wrapper function in the future to find out the current state of the gadget from VBScript (as I didn‚Äôt try, but I couldn‚Äôt implement it on pure VBScript).  Another note is that the scripts work correctly in this order, i.e.  We first describe the VBScript scripts, then the JavaScript. <br><br>  The remaining elements in main.html are represented by DIV elements with absolute positioning.  Subsequently, from the scripts we will contact them by their id. <br><br><pre> <code class="html hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"small_needupdate"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Using JavaScript, we will set the docked and undocked states for the gadget, as well as specify the settings file (main.js) <br><br><pre> <code class="javascript hljs">System.Gadget.onDock = resize; System.Gadget.onUndock = resize; System.Gadget.settingsUI = <span class="hljs-string"><span class="hljs-string">"settings.html"</span></span>; System.Gadget.onSettingsClosed = SettingsClosed; docked=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   resize(); //</span></span></code> </pre> <br><br>  As you can see from the listing above, when the gadget changes its state, the resize () function will be called. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ bd = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.style; System.Gadget.beginTransition(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (System.Gadget.docked) { <span class="hljs-comment"><span class="hljs-comment">// small state bd.width=148; //   bd.height=201; docked = 1; bd.background='url(images/gadget.png) no-repeat'; //  //      undocked  docked      undocked document.getElementById("small_needupdate").innerHTML = document.getElementById("big_needupdate").innerHTML; document.getElementById("big_needupdate").innerHTML = ""; //... } else { // big state bd.width=230; bd.height=160; bd.background='url(images/gadgeth.png) no-repeat'; docked=0; //    docked  undocked      docked document.getElementById("big_needupdate").innerHTML = document.getElementById("small_needupdate").innerHTML; document.getElementById("small_needupdate").innerHTML = ""; //... } System.Gadget.endTransition(System.Gadget.TransitionType.morph,1); }</span></span></code> </pre> <br><br>  You can also describe the function of saving settings.  They are not in my gadget, but for example I'll show you how this is done. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SettingsClosed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.closeAction == event.Action.commit) { <span class="hljs-comment"><span class="hljs-comment">//alert System.Gadget.Settings.readString('test'); } }</span></span></code> </pre> <br><br>  readString - reads a previously saved string, writeString, respectively, writes. <br>  Methods System.Gadget.beginTransition ();  and System.Gadget.endTransition ();  needed for a ‚Äúsmooth‚Äù resizing of the gadget.  In Windows Seven, they are <a href="http://msdn.microsoft.com/en-us/library/ms723674%2528v%3DVS.85%2529.aspx">ignored</a> , but I still left them for backward compatibility. <br><br>  As mentioned above, the server provides us with weather information in xml format. <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">all</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">day</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"today"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">temp</span></span></span><span class="hljs-tag">&gt;</span></span>1.7<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">temp</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cloudyim</span></span></span><span class="hljs-tag">&gt;</span></span>41<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cloudyim</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cloudy</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cloudy</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">air</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">air</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">humidity</span></span></span><span class="hljs-tag">&gt;</span></span>87<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">humidity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wind_direction</span></span></span><span class="hljs-tag">&gt;</span></span>-<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wind_direction</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wind_speed</span></span></span><span class="hljs-tag">&gt;</span></span>5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wind_speed</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">min</span></span></span><span class="hljs-tag">&gt;</span></span>-3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">min</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">max</span></span></span><span class="hljs-tag">&gt;</span></span>-1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">max</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">day</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">day</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">min</span></span></span><span class="hljs-tag">&gt;</span></span>-1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">min</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cloudyim</span></span></span><span class="hljs-tag">&gt;</span></span>26<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cloudyim</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">max</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">max</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">day</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">day</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">min</span></span></span><span class="hljs-tag">&gt;</span></span>-9<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">min</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cloudyim</span></span></span><span class="hljs-tag">&gt;</span></span>41<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cloudyim</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">max</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">max</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">day</span></span></span><span class="hljs-tag">&gt;</span></span> ‚Ä¶ <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">all</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Download and parse xml will be on VBScript. <br><br><pre> <code class="javascript hljs">Sub DownloadXML2 <span class="hljs-built_in"><span class="hljs-built_in">Set</span></span> objXML = CreateObject(<span class="hljs-string"><span class="hljs-string">"Microsoft.XmlHttp"</span></span>) objXML.Open <span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-string"><span class="hljs-string">"http://info.kovonet.ru/weather.xml"</span></span>, True objXML.OnReadyStateChange = GetRef(<span class="hljs-string"><span class="hljs-string">"objXML_onreadystatechange"</span></span>) objXML.setRequestHeader <span class="hljs-string"><span class="hljs-string">"If-Modified-Since"</span></span>, <span class="hljs-string"><span class="hljs-string">"Sat, 1 Jan 2000 00:00:00 GMT"</span></span> objXML.Send iTimeoutID = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.SetTimeout(<span class="hljs-string"><span class="hljs-string">"mySleep"</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>) End Sub</code> </pre> <br><br>  The mySleep function will check our connection for a timeout. <br><br><pre> <code class="javascript hljs">Sub mySleep <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> bRespReceived = <span class="hljs-string"><span class="hljs-string">"false"</span></span> then <span class="hljs-string"><span class="hljs-string">'    iTimeout = iTimeout + 1 if (iTimeout &gt; 30) then '</span></span> timerFirstRun = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.SetTimeout(<span class="hljs-string"><span class="hljs-string">"Update"</span></span>, <span class="hljs-number"><span class="hljs-number">60000</span></span>) <span class="hljs-string"><span class="hljs-string">'     else '</span></span>   ,    iTimeoutID = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.SetTimeout(<span class="hljs-string"><span class="hljs-string">"mySleep"</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>) end <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> end <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> End Sub</code> </pre> <br><br>  Upon successful download, objXML.readyState will be equal to four, and the status (objXML.status) will return the value 200. <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Function</span></span> objXML_onreadystatechange() If (objXML.readyState = <span class="hljs-number"><span class="hljs-number">4</span></span>) Then <span class="hljs-string"><span class="hljs-string">'msgbox objXML.statusText If (objXML.status = 200) Then bRespReceived=true SaveFile(objXML.responseText) else timerFirstRun = window.SetTimeout("Update", 60000) '</span></span>     End If End If End <span class="hljs-built_in"><span class="hljs-built_in">Function</span></span></code> </pre><br><br>  In this case, save the file to the Windows temporary folder. <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Function</span></span> SaveFile(what) <span class="hljs-built_in"><span class="hljs-built_in">Set</span></span> fso = CreateObject(<span class="hljs-string"><span class="hljs-string">"Scripting.FileSystemObject"</span></span>) tempFolder = fso.GetSpecialFolder(<span class="hljs-number"><span class="hljs-number">2</span></span>) filepath = tempFolder+<span class="hljs-string"><span class="hljs-string">"\weather.xml"</span></span> Dim fso1, tf <span class="hljs-built_in"><span class="hljs-built_in">Set</span></span> fso1 = CreateObject(<span class="hljs-string"><span class="hljs-string">"Scripting.FileSystemObject"</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">Set</span></span> tf = fso1.CreateTextFile(filepath, True, True) <span class="hljs-string"><span class="hljs-string">'rewrite, unicode tf.Write(what) tf.Close ParseXML End Function</span></span></code> </pre> <br><br>  and start parsing the file. <br><br><pre> <code class="javascript hljs">Sub ParseXML <span class="hljs-built_in"><span class="hljs-built_in">Set</span></span> fso = CreateObject(<span class="hljs-string"><span class="hljs-string">"Scripting.FileSystemObject"</span></span>) tempFolder = fso.GetSpecialFolder(<span class="hljs-number"><span class="hljs-number">2</span></span>) filepath = tempFolder+<span class="hljs-string"><span class="hljs-string">"\weather.xml"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Set</span></span> xmlDoc = CreateObject(<span class="hljs-string"><span class="hljs-string">"Msxml2.DOMDocument"</span></span>) xmlDoc.async=<span class="hljs-string"><span class="hljs-string">"false"</span></span> xmlDoc.load(filepath) <span class="hljs-string"><span class="hljs-string">'  ‚Äì    &lt;all&gt; Set currNode = xmlDoc.documentElement '</span></span>  ‚Äì &lt;day&gt; <span class="hljs-built_in"><span class="hljs-built_in">Set</span></span> dayNode = currNode.firstChild While Not dayNode Is Nothing <span class="hljs-built_in"><span class="hljs-built_in">Set</span></span> currNode = dayNode.firstChild While Not currNode Is Nothing <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> currNode.parentNode.getAttribute(<span class="hljs-string"><span class="hljs-string">"id"</span></span>) = <span class="hljs-string"><span class="hljs-string">"today"</span></span> then <span class="hljs-string"><span class="hljs-string">'  if currNode.nodeName = "temp" then document.getElementById(prefix+"maintemp").innerHTML = currNode.childNodes(0).text+Chr(176) '</span></span>   Else <span class="hljs-string"><span class="hljs-string">'  ,    '</span></span>... end If <span class="hljs-built_in"><span class="hljs-built_in">Set</span></span> currNode = currNode.nextSibling Wend <span class="hljs-built_in"><span class="hljs-built_in">Set</span></span> dayNode = dayNode.nextSibling Wend End Sub</code> </pre> <br><br>  Check for new versions in the same way. <br>  Do not forget to create a settings file - settings.html, the existence of which we announced above. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">body</span></span></span><span class="css"> { </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">width</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">220px</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">height</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">120px</span></span></span><span class="css">; } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text-align:center"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span>Weather from Info.Denms.Ru<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">/&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.write(System.Gadget.version);</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">/&gt;</span></span> ¬© cvs, 2011<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://info.denms.ru"</span></span></span><span class="hljs-tag">&gt;</span></span>http://info.kovonet.ru<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">/&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  That's all.  I would be glad if my (first :)) article was useful to someone. <br><br>  Used sources: <br>  <a href="http://www.script-coding.com/XMLDOMscripts.html">http://www.script-coding.com/XMLDOMscripts.html</a> ; <br>  <a href="http://msdn.microsoft.com/en-us/library/bb508511%2528v%3DVS.85%2529.aspx">http://msdn.microsoft.com/en-us/library/bb508511%28v=VS.85%29.aspx</a> ; <br>  VBScript Programmers Reference, 3rd Edition; <br>  well, and of course <a href="http://google.com/">http://google.com</a> . <br><br>  Link to the gadget - <a href="http://info.kovonet.ru/weather_b1250.gadget">http://info.kovonet.ru/test.gadget</a> . <br></div><p>Source: <a href="https://habr.com/ru/post/132042/">https://habr.com/ru/post/132042/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132036/index.html">Google has started advertising under search results.</a></li>
<li><a href="../132037/index.html">Digest Wanted.VC # 21</a></li>
<li><a href="../132038/index.html">IT convention 2011</a></li>
<li><a href="../132040/index.html">Cosmopoly IT world after the crisis</a></li>
<li><a href="../132041/index.html">Lectures of Microsoft Russia executives at the Polytechnic Museum</a></li>
<li><a href="../132043/index.html">Hakintosh - is the game worth the candle?</a></li>
<li><a href="../132045/index.html">Google OpenClass - LMS with a social bias</a></li>
<li><a href="../132046/index.html">Installing Windows 7 on USB storage and / or virtual disk VHD</a></li>
<li><a href="../132047/index.html">Painting and nails</a></li>
<li><a href="../132048/index.html">An example of writing an Executive Summary based on a real project</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>