<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Everyday MT_FREE: several stories about the influence of third-party services on the work of public Wi-Fi</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The Internet is a large and dynamic environment where everything is connected to one another in one way or another and can influence each other. Such ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Everyday MT_FREE: several stories about the influence of third-party services on the work of public Wi-Fi</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/p5/iu/35/p5iu35hkztdmnqhghvtkz5zos8y.jpeg"><br><br>  The Internet is a large and dynamic environment where everything is connected to one another in one way or another and can influence each other.  Such dependence, when a small change in one part of the system can lead to a complete change in another, is popularly called the ‚Äúbutterfly effect‚Äù.  The effect perfectly illustrates how one ‚Äúsuccessfully dumped boots‚Äù can bring down a major service and, at the same time, a couple of other people ... Let's talk about that. <br><a name="habracut"></a><br><h3>  Five years ago, when Wi-Fi in the subway just appeared ... </h3><br>  ... it was a phenomenon that divided the life of Muscovites into "before" and "after."  At that time, the project was the only one in the world, and everything in it was just as unique: the network structure, the monetization model, user services, approaches to construction and operation. <br><br>  Almost from the launch of the first Wi-Fi segment in the metro, we now have authorization and our own media portal.  We generously experimented with the portal in terms of integration with third-party services, in fact, exploring the possibilities of our business model (‚Äúand what if you sell coffee in the subway with delivery to the exit from the lobby ?!‚Äù). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At first, we actively attracted partners from various areas to work.  But almost every publication of a new partner service led to the fall of the latter under load and the need for emergency rollback of changes.  Few people on the move can survive thousands of new requests per minute, and some are incapable of this, in principle, due to non-scalable architecture.  The existence of such a problem forced us to monitor the performance of partner services, on which user experience directly depends.  And also to develop mechanisms to reduce this dependence (proxy, cache). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xz/w-/iz/xzw-iz9s8mekuznsiqzcnq1vxna.jpeg"></div>  <i><font color="999999">Once a loud cry in the office of the "Five Hundred" set in motion the whole company - now such situations practically do not occur.</font></i>  <i><font color="999999">On the screen of July 2015, the result of the launch of the service for the sale of flowers with delivery on our sub-domain.</font></i> <br><br>  But evolution never passes quickly.  Before we built the current system, we had to "fill the cones" and on our own experience through a series of accidents.  Moreover, the process does not stop: the deeper we dive into the problematic, the more we detect the most unexpected dependencies.  Looking back, we understand how important it is sometimes to have an example of how it happens.  This is what we want to share. <br><br><h3>  New iOS dropped traffic by 20% </h3><br>  MaximaTelecom specializes in building transportation networks.  The vast majority of subscriber devices that use our network are mobile, smartphones and tablets based on Android and iOS.  Both vendors, Google and Apple, have roadmaps for updating their operating systems.  In new versions, the modules responsible for connecting to Wi-Fi often change.  At best, on the day of the update, we have increased traffic due to the fact that the devices are downloading the update via Wi-Fi.  But there are also catastrophic cases. <br><br>  Just last year, Apple released a new version of iOS 10.3.1, after which traffic from the network fell by almost 20%.  It turned out that the new version of Apple "broke" the process of connecting to the network: the authorization mechanics in Captive stopped working and the devices could not log in to MT_FREE.  I had to release the fix in an emergency mode and correct the situation.  The problem was fixed after three minor updates, after we entered the case in the Apple bugtracker. <br><br><img src="https://habrastorage.org/webt/1m/78/p0/1m78p0wtyc0jsjrq4cbsdq4jw5e.png"><br><br><img src="https://habrastorage.org/webt/1y/zi/vk/1yzivkvarkgotniqq3ulbshzsi4.png"><br>  <i><font color="999999">The number of hits to the auth.wi-fi.ru authorization page per minute.</font></i>  <i><font color="999999">The graph clearly shows a significant lag from the figures for the previous period.</font></i> <br><br>  The situation is aggravated by the fact that Wi-Fi is a rather old and extremely widespread technology, during the creation of which it was not intended to be used on such a scale as we have in the Moscow metro.  So, we have to deal with the whole "vinaigrette" of various devices, each of which behaves in the network in its own way.  Flat metrics of the number of abstract megabytes or ‚Äúspherical subscribers in the network‚Äù are not applicable for us.  Any service, be it basic Internet access, a media portal or a mobile application, should be viewed in the context of specific devices and / or operating systems, since the problem may concern a specific and fairly narrow group. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xs/fh/lv/xsfhlvo2p6acl4lyhwhy-g4fk0c.png"></div><br>  <i><font color="999999">... and a few dozen of the most exotic options.</font></i> <br><br><h3>  This is not DDOS: the crash of the mobile operator led to a jump in traffic by almost a third </h3><br>  Two years ago, one of the mobile operators had a major accident.  In such cases, users are looking for an alternative to the communication service.  If we talk about the subway, then there were no alternative means of communication on the trains. <br><br><div class="spoiler">  <b class="spoiler_title">Refinement</b> <div class="spoiler_text">  <i>Even now, only some operators provide services in areas equipped with a radiating cable.</i>  <i>But this technology is very limited in capacity and is not able to provide a comparable level of service for a significant proportion of users.</i>  <i>Not to mention the cost of traffic on the limit tariff plans.</i> </div></div><br>  But at the stations, cellular communication has developed quite strongly, not to mention ground segments, where Wi-Fi directly competes with it. <br><br>  We learned about the accident at the mobile operator‚Äôs network from our dispatcher service, which announced that we were being attacked.  The growth in the number of users and traffic was such that at first we thought that we had become DDOS.  We learned about the real reasons for the increase in traffic later, finding out that one third of employees do not have cell phones. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ib/kn/gt/ibkngtawi8us5ut2nbjehrjauim.png"></div><br>  <i><font color="999999">That's how it looked for users of our Wi-Fi above the ground.</font></i> <br><br>  The specificity of our particular situation is that we have a Wi-Fi network, which means that it does not matter to us which SIM card of which carrier is installed in the user device. <br><br>  Here it is worth making a reservation that the accident that took place affected our service in part and negatively.  Some segments of the MT_FREE network, in particular, the network in city buses and commuter trains, use cellular communication as a backbone network, which means an accident on cellular communication networks leads to degradation of service on these segments. <br><br><cut></cut><h3>  Wi-Fi in the subway without ads?  YES! </h3><br>  Advertising is the foundation of free access to the MT_FREE network, because it is thanks to it that the service exists and pays off.  We have been using AdFox for many years as a basic AdServer.  Interestingly, AdServer itself has not undergone any significant changes in the course of our work with it.  One of its specifics is a system for collecting statistics on shows, which is formed by hourly intervals.  This causes rhythmic response time peaks from the service (every hour, exactly on the border of the hour, the ‚Äútwist‚Äù starts to ‚Äúmisbehave‚Äù and think before each answer).  We caught this nuance very not immediately! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kx/rb/f_/kxrbf_wkx_0tddvalyqm7xqaxnq.jpeg"></div><br>  <i><font color="999999">AdFox response timeline for ad request.</font></i>  <i><font color="999999">Bursts and dips are clearly visible on the border of the hour.</font></i> <br><br>  In fact, we observed the same characteristic hourly ‚Äúpeaks‚Äù in the number of impressions for other monitoring tools, for the same Metric.  But I want to tell you about a more extreme situation.  In the winter of last year, a serious accident happened at AdFox: the service did not respond for a long time.  On our metrics, this manifested itself as a lack of user authorization and a sharp drop in portal performance.  At the same time, the AdFox management interface was not available with a certificate error. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/eq/ke/gn/eqkegna6sr78wztahh1jcrrazue.jpeg"></div><br>  <i><font color="999999">Illustration of adfox.ru certificate error.</font></i> <br><br>  After conducting a couple of tests and calling AdFox itself, we learned about the accident, and we had no choice but to let all identified users enter the network without ads. <br><br><img src="https://habrastorage.org/webt/ht/ad/jv/htadjvxzmar6wtjwixtd0yfk45w.jpeg"><br>  <i><font color="999999">And here is what the accident on Yandex metrics on our portal looked like.</font></i> <br><br><h3>  Accelerating download sometimes leads to unexpected results. </h3><br>  The perceived quality of our service depends not only on the operation of foreign infrastructure, OS updates and crashes on mass resources, but also on the behavior of specific browsers on specific devices.  In this regard, we have much more opportunities to influence, so we are constantly working to improve products.  On average, we publish one update per day.  But sometimes a seemingly simple update, which should lead to an improvement in user experience, leads to unpredictable consequences. <br><br>  Since we have the opportunity to influence the work of services at the network level (for example, by changing the priority of one type of traffic relative to another), the idea arose to speed up authorization by prioritizing traffic.  We published the relevant changes and with amazement began to observe numerous errors and a 20% drop in advertising revenue.  Technical tests showed that the circuit works absolutely correctly from a network point of view.  The rollback of changes, however, confirmed that the reason was in the new settings. <br><br>  As a result, we found that by increasing the priority of some scripts over others, we changed the order of execution of functions at the level of loading the authorization page in the browser itself.  This greatly influenced the user experience.  In fact, authorization scripts began to load and run faster advertising.  Because of the existing dependencies between them, there were situations when one function waits for the result of the execution of another, the file with which has not even been downloaded to the device yet. <br><br><h3>  Social Media vs Media </h3><br>  The behavior of users on the Internet corresponds to typical patterns.  People are used to communicate via instant messengers, search for content on media portals, read news through social networks and news aggregators.  It‚Äôs pretty obvious, but I‚Äôm still focusing on the fact that social networks are an alternative to news, and vice versa.  When suddenly something happens to one of the sources of information, the attention of users is redistributed to the remaining, as a rule, the most accessible.  So in 2017 there was a global failure in VKontakte.  From our side, this event looked like a sharp increase in users and time on our news portal wi-fi.ru.  In fact, users, realizing that their favorite social network does not work, went to read the news to us. <br><br><img src="https://habrastorage.org/webt/8e/pm/nx/8epmnxp_aabhtaw6yyr3uufkdjq.png">  <i><font color="999999">The moment of the collapse of the VK was marked by a 30% increase in the load on the portal wi-fi.ru.</font></i> <br><br>  This case illustrates how important it is for mass services to have a safety margin for ‚Äúdigesting‚Äù the consequences of an information ‚Äúneighbor‚Äù accident. <br><br><h3>  Green color - no accidents </h3><br>  The described situations constantly encourage us to improve monitoring of third-party services in MT_FREE.  Here is how the dashboard exploits our network. <br><br><img src="https://habrastorage.org/webt/ne/rt/tz/nerttzur3msulj1hgz7umxvecig.png">  <i><font color="999999">Dashboard network operation in St. Petersburg.</font></i> <br><br>  Dashboards consist of a set of indicators of the ‚Äútraffic light‚Äù type: the green state is OK, the red color is an alarm.  The color of the indicators varies with time.  This can be both normal behavior and a sign of deviation from the norm.  But if you ‚Äúpull out‚Äù all the indicators in line and put each measurement cycle on the board like that, you‚Äôll get a two-dimensional, ever-growing picture describing the evolution of the network as a whole.  This picture can easily be ‚Äúfed‚Äù to standard machine learning algorithms created for recognizing graphic patterns (a kind of FindFace, only for sensor patterns). <br><br><img src="https://habrastorage.org/webt/l1/du/ja/l1duja5zbh99hhct0req-owgnvu.png">  <i><font color="999999">The color chart of indicators developed in time is nothing more than a picture describing the evolution of the network.</font></i> <br><br>  Next, self-learning algorithms (such as AI) are added, which are able to automatically classify patterns and identify the causes of deviations or incompleteness of data.  Everything looks simple, but how do you think, how many telecom operators really use this? <br><br><h3>  Few, and we are not among them </h3><br>  For the sake of justice, the application of this technology and within the framework of MaximTelecom itself is at a rather early stage, largely because it is not clear where the boundary is between what needs to be received from outside the network and what can be obtained from within.  Our advantage here is only that we began to develop the necessary algorithmic base from the very beginning within our platform for advertising monetization of the network. <br><br>  Maxima is the operator, first of all, of the free Wi-Fi access service.  Moreover, unlike a sufficiently large number of ‚Äúsocial‚Äù Wi-Fi, we are a full-fledged commercial telecom operator.  In fact, this is our corporate idea: we strive to make communication free and at the same time profitable, and we have already proved that this is possible.  Almost no telecom operator in the world can (or does not want) this, and therefore does not develop technology for this.  This gives hope that in the future we will be able to bring our technologies to a level where the user experience of MT_FREE will not differ from what traditional paid carriers provide.  At the same time, the level of reliability will be higher due to a more developed intellectual system of management and operation. <br><br>  But, unfortunately, not all problems can be solved within the capabilities of one company, if only because there are many manufacturers of subscriber and network Wi-Fi equipment, and the level of unification is significantly inferior to that in cellular networks.  Problems with various devices when connecting to the network, we solve since the launch.  The ‚Äúroot of evil‚Äù is in the absence of any standard, and, as a result, each manufacturer creates something different. <br><br>  To solve such industry problems, there are international associations.  For example, now we are leading in a project to standardize user experience when connecting to Wi-Fi networks using advertising monetization.  But this is a topic for another article. <br><br>  By the way, we are constantly expanding our development staff; current vacancies can be found on our <a href="http://maximatelecom.ru/careers.html">career page</a> . </div><p>Source: <a href="https://habr.com/ru/post/457958/">https://habr.com/ru/post/457958/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../457948/index.html">Board games, which will have to break his head</a></li>
<li><a href="../45795/index.html">Cleaning Ubuntu from unnecessary applications</a></li>
<li><a href="../457952/index.html">How processors are developed and manufactured: chip manufacturing</a></li>
<li><a href="../457954/index.html">Why Swift can be a great event in depth learning</a></li>
<li><a href="../457956/index.html">How to choose a storage system without shooting yourself in the foot</a></li>
<li><a href="../45796/index.html">Interactive maps</a></li>
<li><a href="../457962/index.html">As in the conditions of thrash architecture and lack of skills in Scrum, we have created cross-component teams</a></li>
<li><a href="../457964/index.html">Real virtuality: workstations ++</a></li>
<li><a href="../457966/index.html">‚ÄúI would open a special IT zone in the south of Russia‚Äù - 10 questions for programmer # 11. New season</a></li>
<li><a href="../457968/index.html">Parallels that intersect - the Ministry of Communications overnight burned billions in budgets</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>