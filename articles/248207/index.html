<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Xargs: a variety of use cases</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A lot has been written about the xargs utility - what else can I write? But if, as they say, to dig deeper, then it turns out that in many publication...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Xargs: a variety of use cases</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/032/7ca/41f/0327ca41ffe465acffe37dbc30f25509.png" alt="xargs" width="100%" height="100%"><br><br>  A lot has been written about the xargs utility - what else can I write?  But if, as they say, to dig deeper, then it turns out that in many publications only the very basics are laid out, but there is no main thing: it is not explained how xargs can be applied in actual practice.  Unfortunately, there are very few articles with the analysis of complex and non-trivial application options for this very useful tool for the system administrator.  That is why we wrote our article and tried to include as many examples as possible of using xargs to solve various problems. <br><br>  First, we look at the principle of xargs and analyze examples more simply, and then proceed to the analysis of complex and interesting cases. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Remember the basics </h2><br><br>  The principle of operation of xargs can be described as follows: the program takes data from standard input or from a file, splits it in accordance with the specified parameters, and then passes it to another program as an argument. <br><br>  In general, the syntax of the xargs command can be represented as follows: <br><br><pre> [command_generator_list] |  xargs [xargs_options] [command]
</pre><br>  Consider how it all works, on the material of simple and textbook examples. <br><br><h3>  Deleting files </h3><br><br>  One of the most common situations in which xargs is used is deleting files found using the find command. <br><br>  Imagine the following situation: there is a directory in which a large number of files are stored.  It is necessary to remove files of a certain type from it (in our example, files with the * .sh extension).  To perform this operation, you need to pass xargs the output of the find command, and the -rm command will be applied to files with the specified extension: <br><br><pre> $ ls
 one.sh one.py two.sh two.py<font></font>
<font></font>
 $ find.  -name "* .sh" |  xargs rm -rf<font></font>
<font></font>
 $ ls
 one.py two.py
</pre><br><br>  Note that the operation of deleting files can be done without xargs, and using the command <br><br><pre> $ find.  -name "* .sh" -exec rm -rf '{}' \
</pre><br><br>  The described method will not work if the name of one of the files to be deleted contains a space.  A name consisting of two words separated by a space will not be perceived as a whole. <br><br>  We illustrate this with the following example: <br><br><pre> $ ls
 new file.sh one.sh one.py two.sh two.py<font></font>
<font></font>
 $ find.  -name "* .sh" |  xargs rm -rf<font></font>
<font></font>
 $ ls
 new file.sh one.py two.py
</pre><br><br>  As you can see, the file with a space in its name was not deleted. <br><br>  To solve this problem, use the print0 option for the find command and the -0 option for the xargs command.  It replaces the standard delimiter (a line break to a null character (\ x0), which means the end of the stored string: <br><br><pre> $ find.  -name "* .sh" -print0 |  xargs -0 rm -rf
</pre><br><br>  Xargs can also help, for example, quickly remove all temporary files that have the tmp extension: <br><br><pre> $ find / tmp -name "* .tmp" |  xargs rm
</pre><br><br><h2>  File compression </h2><br><br>  Compress all files in the current directory using gzip by typing the following command: <br><br><pre> $ ls |  xargs -p -l gzip
</pre><br><br>  Consider another example: using tar to compress all files with the * .pl extension: <br><br><pre> $ find.  -name "* .pl" |  xargs tar -zcf pl.tar.gz
</pre><br><br><h2>  Rename files </h2><br><br>  With xargs, you can rename files in bulk.  Imagine that we have a group of files with the extension * .txt, and we need to replace this extension with * .sql.  This can be done with xargs and the sed text flow editor: <br><br><pre> $ ls |  sed -e "p; s / .txt $ /. sql /" |  xargs -n2 fmv
</pre><br><br>  As a result of its execution, the list of renamed files will be displayed on the console. <br><br>  With xargs, you can also add additional elements to file names (for example, a date): <br><br><pre> $ ls |  xargs -I FILE mv {} &lt;...&gt; - {}
</pre><br><br>  Instead of &lt;..&gt; you can substitute anything. <br>  The curly braces {} in this example mean the ‚Äúcurrent argument‚Äù (i.e. the current file name). <br><br><h2>  Change permissions for folders and files </h2><br><br>  With xargs, you can also speed up the process of changing permissions on files and folders for a specific user or group.  Suppose we need to find all the folders of the root user and replace their owner with temp.  This operation is performed using the command: <br><br><pre> $ find.  -group root -print |  xargs chown temp
</pre><br><br>  To find all the folders of the root group and replace the group with temp, use the command: <br><br><pre> $ find.  -group root -print |  xargs chgrp temp
</pre><br><br><h2>  Xargs and find: complex operations </h2><br><br>  Using the find and xargs commands, you can perform more complex operations.  So, for example, you can delete temporary files created more than 7 days ago: <br><br><pre> $ find / tmp -type f -name '*' -mtime +7 -print0 |  xargs -0 rm -f
</pre><br><br>  And this is how to forcefully stop processes that are already running for more than 7 days: <br><br><pre> $ find / proc -user myuser -maxdepth 1 -type d -mtime +7 -exec basename {} \;  |  xargs kill -9
</pre><br><br><h2>  Xargs and Sut </h2><br><br>  Xargs are often used in conjunction with the cut command, which allows you to cut lines from text files.  Consider some practical examples.  Using the command below, a list of all users of the system will be displayed on the console: <br><br><pre> $ cut -d: -f1 &lt;/ etc / passwd |  sort |  xargs echo
</pre><br><br>  And the view team <br><br><pre> file * |  grep ASCII |  cut -d ":" -f1 |  xargs -p vim
</pre><br>  will consistently open files for editing in vim. <br>  Note the -p option.  Thanks to it, the command will be executed interactively: before opening each file, confirmation (y / n) will be requested. <br><br>  In conclusion, we present another complex and interesting example - the recursive search for the largest files in a directory: <br><br><pre> $ find.  -type f -printf '% 20s% p \ n' |  sort -n |  cut -b22- |  tr '\ n' '\ 000' |  xargs -0 ls -laSr
</pre><br><br><h2>  Parallel running processes </h2><br><br>  Xargs is often used to run multiple processes in parallel.  So, for example, you can simultaneously compress several directories in tar.gz: <br><br><pre> $ echo dir1 dir2 dir3 |  xargs -P 3 -I NAME tar czf NAME.tar.gz NAME 
</pre><br><br>  In the example above, the ‚ÄìP key is used.  It indicates the maximum number of processes that will be executed simultaneously.  Suppose we have 10 arguments in our input.  If we enter the xargs command with the -P 3 key, 3 instances of the command following the xargs will be launched with each of these arguments. <br><br>  With xargs, you can also download multiple files from the Internet in parallel: <br><br><pre> $ wget -nv &lt;link&gt; |  egrep -o "http: // [^ [: space:]] * .jpg" |  xargs -P 10 -n 1 wget -nv 
</pre><br><br>  In the above example, all graphic files with the extension jpg will be downloaded from the specified address;  the -P switch indicates that you need to download 10 files at a time. <br><br><h2>  Preliminary results </h2><br><br>  Let's summarize the preliminary results and formulate several rules for working with xargs. <br><ol><li>  Xargs does not work with files whose name contains a space.  To solve this problem with the xargs command, the ‚àí0 option is used.  You can also bypass the space in the file name as follows: <br><pre> $ xargs -I FILE my_command ‚ÄúFILE‚Äù
</pre><br></li><li>  The xargs command accepts commands from standard input, separated by a space or a line break.  To group these commands, you can use double quotes or single quotes.  You can also specify a delimiter using the -d option; </li><li>  If no arguments are passed to the xargs command at all, then the default command is / bin / echo; </li><li>  In many cases, the xargs command can be replaced with a for loop.  For example, the command <br><pre> $ find.  -type f -and -iname "* .deb" |  xargs -n 1 dpkg -I
</pre><br>  completely equivalent to a cycle <br><pre> $ for file in `find.  -type f -and -iname "* .deb" `;  do dpkg -I "$ file";  done
</pre><br></li></ol><br><br><h2>  Nontrivial examples </h2><br><br>  We recalled the basics, we considered typical use cases ... Now we turn to more complex and non-trivial examples.  We came up with some of them on our own, working on everyday tasks, and some learned from <a href="http://www.commandlinefu.com/" rel="nofollow">http://www.commandlinefu.com</a> (for those who want to learn the subtleties of working with the command line, we highly recommend visiting it from time to time - sometimes you can find useful tips). <br><br><h3>  Ban IPs from the list </h3><br><br>  To ban IP-addresses from the list, you need to add them to IP tables with the DROP rule.  This operation is performed using the command: <br><br><pre> $ cat bad_ip_list |  xargs -I IP iptables -A INPUT -s IP -j DROP
</pre><br>  You can do a more complicated operation and ban all the addresses on AS: <br><br><pre> $ / usr / bin / whois -H -h whois.ripe.net -T route -i origin AS &lt;number&gt; | egrep "^ route" | awk '{print $ 2}' | xargs -I NET iptables -A INPUT - s NET -j DROP 
</pre><br><br><h3>  Change URL format </h3><br><br>  To convert URLs like ‚Äúhttp% 3A% 2F% 2Fwww.google.com‚Äù to ‚Äú <a href="http://www/">www</a> , google.com‚Äù, use the command: <br><br><pre> echo "http% 3A% 2F% 2Fwww.google.com" |  sed -e's /% \ ([0-9A-F] [0-9A-F] \) / \\\\\ x \ 1 / g '|  xargs echo -e
</pre><br><br><h3>  We generate a password of 10 characters </h3><br><br>  You can generate a strong password using the following command: <br><br><pre> $ tr -dc A-Za-z0-9_ &lt;/ dev / urandom |  head -c 10 |  xargs
</pre><br><br>  You can generate passwords without the help of xargs: there is a specialized utility pwgen for this.  Some other ways to generate passwords are also described <a href="http//www.commandlinefu.com/commands/view/11393/generate-a-randome-10-character-password" rel="nofollow">here</a> . <br><br><h3>  We are looking for binary files installed without using dpkg </h3><br><br>  Such an operation may be required if, for example, the machine has become a victim of a hacker attack and malicious software has been installed on it.  The following command will help to identify what the attackers have put in the programs (she is looking for running binary packages installed without using the dpkg package manager): <br><br><pre> $ at /var/lib/dpkg/info/*.list&gt; / tmp / listin;  ls / proc / * / exe | xargs -l readlink |  grep -xvFf / tmp / listin;  rm / tmp / listin
</pre><br><br><h3>  Remove obsolete kernel packages </h3><br><br><pre> $ dpkg -l linux- * |  awk '/ ^ ii / {print $ 2}' |  grep -v -e `uname -r |  cut -f1,2 -d "-" `|  grep -e [0-9] |  xargs sudo apt-get -y purge
</pre><br><br>  The problem of removing old kernels has already been discussed at Habr√© - see <a href="http://habrahabr.ru/post/116336/" rel="nofollow">here</a> (you can find interesting examples of commands at this link). <br><br><h3>  Convert the script to a string </h3><br><br>  Sometimes it is necessary to convert a large script into one line.  You can do it like this: <br><br><pre> $ (sed 's /#.*// g' | sed '/ ^ * $ / d' | tr '\ n' ';' | xargs echo) &lt;script.sh
</pre><br><br><h2>  Conclusion </h2><br><br>  As can be seen from the review, the possibilities of xargs are much wider than it might seem at first glance.  We hope that the examples given in the article will be useful for you.  If you know of other interesting uses for xargs, welcome to comments.  Readers who for one reason or another can not leave comments here are invited <a href="http://blog.selectel.ru/xargs-mnogoobrazie-priyomov-ispolzovaniya/">to our blog</a> . </div><p>Source: <a href="https://habr.com/ru/post/248207/">https://habr.com/ru/post/248207/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../248197/index.html">WPF: Binding without trivial converters</a></li>
<li><a href="../248199/index.html">7 secrets of successful trading on Amazon</a></li>
<li><a href="../248201/index.html">Cisco information security in 2014: a brief summary</a></li>
<li><a href="../248203/index.html">Test Automation with Ruby and WATIR</a></li>
<li><a href="../248205/index.html">PHDays V: Botnet Detection, NFC Stunts, and ‚ÄúSocial Engineers‚Äù Competitions</a></li>
<li><a href="../248211/index.html">Simple acceptance of bank card payments in Windows Universal Apps</a></li>
<li><a href="../248213/index.html">The path from beginner to pro: CMS development on the Kohana 3.3 framework</a></li>
<li><a href="../248215/index.html">7 common mistakes when designing a checkout process</a></li>
<li><a href="../248217/index.html">Try / Catch / Finally</a></li>
<li><a href="../248219/index.html">Home automation with openHAB: lighting and remote control of heaters. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>