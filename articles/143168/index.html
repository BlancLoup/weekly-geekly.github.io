<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Sending a multipart / form-data request to Qt</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sometimes when developing a network application, there is a problem of uploading a file to the server, and not just like that, but as part of a comple...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Sending a multipart / form-data request to Qt</h1><div class="post__text post__text-html js-mediator-article">  Sometimes when developing a network application, there is a problem of uploading a file to the server, and not just like that, but as part of a completed http form.  This is an example of a so-called multipart / form-data request.  Standard Qt library methods do not allow this, so you have to get out on your own. <br><a name="habracut"></a><br><h4>  general information </h4><br>  So, first of all, you need to understand what our multipart / form-data request contains in such an interesting way? <br>  If you look at an example <a href="http://www.codenet.ru/webmast/php/HTTP-POST.php">from here</a> , a typical query is the following: <br><br><pre> POST http://www.site.ru/news.html HTTP / 1.0 \ r \ n
 Host: www.site.ru \ r \ n
 Referer: http://www.site.ru/index.html\r\n
 Cookie: income = 1 \ r \ n
 Content-Type: multipart / form-data;  boundary = 1BEF0A57BE110FD467A \ r \ n
 Content-Length: 209 \ r \ n
 \ r \ n
 --1BEF0A57BE110FD467A \ r \ n
 Content-Disposition: form-data;  name = "login" \ r \ n
 \ r \ n
 Petya Vasechkin \ r \ n
 --1BEF0A57BE110FD467A \ r \ n
 Content-Disposition: form-data;  name = "password" \ r \ n
 \ r \ n
 qq \ r \ n
 --1BEF0A57BE110FD467A - \ r \ n
</pre><br>  What we are particularly interested in in the headers is the <i>boundary = 1BEF0A57BE110FD467A</i> and <i>Content-Length: 209</i> , after which the request body begins.  The request consists of several parts, while the separator will be what is written as the boundary, the length of the request body must also be specified - this is the Content-Length field.  The request body is everything from the first line <i>--1BEF0A57BE110FD467A</i> .  In each section, the name is the name of the corresponding form field, after two line breaks \ r \ n \ r \ n there is a field value <br><br>  To send a file, you must create a section of the following format: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> --1BEF0A57BE110FD467A \ r \ n
 Content-Disposition: form-data;  name = "news_file";  filename = "news.txt" \ r \ n
 Content-Type: application / octet-stream \ r \ n
 Content-Transfer-Encoding: binary \ r \ n
 \ r \ n
 But such news, which lies in the file news.txt \ r \ n
</pre><br>  Here, in addition, the file name is specified - news.txt, as well as the data encoding in the Content-Transfer-Encoding field.  There are several different encodings, including the presented binary - unencoded data.  Given Qt's capabilities, base64 encoding is very convenient.  If the file is not just some kind of (application / octet-stream), but of a known type, then you can specify this type in the Content-Type field, for example, <i>Content-Type: image / png</i> . <br><br><h4>  Simple example </h4><br>  Let us turn to the practical example of the formation of the request.  We have: <br><br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// ++   Qt QNetworkAccessManager *manager; // 1 - - ,  2 -  QByteArray param1Name="param1" ,param1Value="value1"; QByteArray param2Name="param2", param2FileName="news.txt", param2ContentType="text/plain",param2Data="   ,     news.txt";</span></span></code> </pre> <br>  First we create the request body: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  QByteArray postData,boundary="1BEF0A57BE110FD467A"; //  postData.append("--"+boundary+"\r\n");// //  postData.append("Content-Disposition: form-data; name=\""); postData.append(param1Name); postData.append("\"\r\n\r\n"); //  postData.append(param1Value); postData.append("\r\n"); // 2 -  postData.append("--"+boundary+"\r\n");// //  postData.append("Content-Disposition: form-data; name=\""); postData.append(param2Name); //  postData.append("\"; filename=\""); postData.append(param2FileName); postData.append("\"\r\n"); //   postData.append("Content-Type: "+param2ContentType+"\r\n"); //  base64 postData.append("Content-Transfer-Encoding: base64\r\n\r\n"); // postData.append(param2Data.toBase64()); postData.append("\r\n"); //""  postData.append("--"+boundary+"--\r\n");</span></span></code> </pre><br>  In the variable postData, we get a ready-made request body ‚Äî all that remains is to send and remember to install additional request headers: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">QNetworkRequest </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">request</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QUrl(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"http://example.com/submit.php"</span></span></span></span><span class="hljs-function"><span class="hljs-params">))</span></span></span></span>; request.setHeader(QNetworkRequest::ContentTypeHeader, <span class="hljs-string"><span class="hljs-string">"multipart/form-data; boundary="</span></span>+boundary); request.setHeader(QNetworkRequest::ContentLengthHeader, QByteArray::number(postData.length())); QNetworkReply *reply=manager-&gt;post(request,postData);</code> </pre><br>  Well, then - on the thumb track, as for any other requests. <br><br><h4>  Eventually... </h4><br>  The example given is, of course, too simple for everyday use.  But based on it, you can easily implement a function, class or class library for each specific task, depending on the complexity of the requests you have to generate. <br><br>  Useful information: <br>  <a href="http://www.codenet.ru/webmast/php/HTTP-POST.php">http://www.codenet.ru/webmast/php/HTTP-POST.php</a> - description of filling http requests. <br>  <a href="http://www.ietf.org/rfc/rfc2388.txt">http://www.ietf.org/rfc/rfc2388.txt</a> - Standard "Returning Values ‚Äã‚Äãfrom Forms: multipart / form-data" </div><p>Source: <a href="https://habr.com/ru/post/143168/">https://habr.com/ru/post/143168/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../143163/index.html">USPS (and not only) stops the delivery of products with lithium batteries</a></li>
<li><a href="../143164/index.html">Droider Show # 38. America without Apple</a></li>
<li><a href="../143165/index.html">UPS Shipping Labels or Single Return History</a></li>
<li><a href="../143166/index.html">What do we know about executors of IT projects?</a></li>
<li><a href="../143167/index.html">Evernote Dev Meetup Moscow Results</a></li>
<li><a href="../143169/index.html">An inside look: matrix digital cameras</a></li>
<li><a href="../143170/index.html">Mikogo for Linux</a></li>
<li><a href="../143171/index.html">JAXB vs. org.hibernate.LazyInitializationException</a></li>
<li><a href="../143172/index.html">Saga: check the code coverage tests</a></li>
<li><a href="../143173/index.html">Programming, as we know it, is coming to an end.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>