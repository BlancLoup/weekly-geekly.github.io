<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PayPal API Go Client</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! We are developing a service for collecting, delivering and analyzing logs, the server part of which is written in Go . In this article, we will...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PayPal API Go Client</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/ff3/e5c/bc1/ff3e5cbc1ad1474a94e4d3bddd80b07e.png"><br><br>  Hello!  We are developing a service for collecting, delivering and analyzing logs, the server part of which is written in <a href="https://golang.org/">Go</a> .  In this article, we will talk about the problem we encountered when connecting our project to the PayPal payment system and the solution we developed and successfully implemented. <br><a name="habracut"></a><br>  So, many have experience with the PayPal API, using OAuth 2.0 is quite simple: we plug the client library into our project and start the implementation. <br><br>  For PHP, Java and Python, there are official SDK libraries, but our service is written in GO, and in this case, the search for SDK did not give us acceptable results ( <a href="https://github.com/search%3Fq%3Dpaypal%2Bgolang">https://github.com/search?q=paypal+golang</a> ).  As a result, five projects were found on github, two of which look decent, but have limited functionality: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <a href="https://github.com/leebenson/paypal">leebenson / paypal</a> (API incomplete coverage) </li><li>  <a href="https://github.com/crowdmob/paypal">crowdmob / paypal</a> (implements only Express Checkout) </li></ul><br>  We needed a client with the ability to expand and improve the functionality, so it was decided to write his <s>bike</s> . <br><br><h4>  OAuth 2.0 </h4><br>  At the development stage, we used the <a href="https://developer.paypal.com/">PayPal sandbox</a> , where we tested all kinds of API requests. <br><br>  The first step is to work with the PayPal protocol and authorization.  PayPal uses OAuth version 2.0.  First we need to get private keys (client_id and secret_key). <br><br>  Authorization is carried out as follows: after receiving client_id and secret_key, it is necessary to make a request to PayPal to receive an access_token, which is valid for a specified time.  Further, all requests to the PayPal API must be accompanied by this token in the request header (-u ":"). <br><br><img src="https://habrastorage.org/files/2fd/840/a8c/2fd840a8c11f429ca71649c326c833c0.png"><br><br>  Implementation using our client: <br><br><pre><code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/logpacker/PayPal-Go-SDK"</span></span> <span class="hljs-comment"><span class="hljs-comment">// ... // Create a client instance c, err := paypalsdk.NewClient("clientID", "secretID", paypalsdk.APIBaseSandBox) accessToken, err := c.GetAccessToken()</span></span></code> </pre> <br><br>  Further, the client object will have all available methods for working with the API.  For example, to create a payment, we need to do the following: <br><br><pre> <code class="go hljs">paymentResponse, err := client.CreatePayment(p)</code> </pre><br><br>  We are working to provide and describe <a href="https://developer.paypal.com/webapps/developer/docs/api/">all the available API operations</a> , while it is possible to call any final method using basic functions: <br><br><pre> <code class="go hljs">req, err := c.NewRequest(method, url, payload) c.SendWithAuth(req, &amp;resp)</code> </pre><br><br>  All requests to PayPal can be logged to a file, the full request dump is saved along with the headers: <br><br><pre> <code class="go hljs">c.SetLogFile(<span class="hljs-string"><span class="hljs-string">"/tpm/paypal-debug.log"</span></span>)</code> </pre><br><br><h4>  API Functions Available </h4><br>  A complete list of PayPal API functions is provided in the <a href="https://developer.paypal.com/webapps/developer/docs/api/">specification</a> , they are all divided into groups, Payments, Orders, Vault.  In the client, we implemented built-in functions for basic API operations: <br><br>  <b>POST</b> / v1 / oauth2 / token - receive temporary access_token <br><br><pre> <code class="go hljs">accessToken, err := c.GetAccessToken()</code> </pre><br><br>  The application is responsible for saving the key, so instead of receiving a new key, you can set the saved one. <br><br><pre> <code class="go hljs">token := <span class="hljs-string"><span class="hljs-string">"abcdef"</span></span> c.SetAccessToken(token)</code> </pre><br><br>  <b>POST</b> / v1 / payments / payment - create a payment in PayPal.  We provided two functions for making a payment. <br><br>  Internal PayPal Payment: <br><br><pre> <code class="go hljs">amount := paypalsdk.Amount{ Total: <span class="hljs-string"><span class="hljs-string">"7.00"</span></span>, Currency: <span class="hljs-string"><span class="hljs-string">"USD"</span></span>, } redirectURI := <span class="hljs-string"><span class="hljs-string">"http://example.com/redirect-uri"</span></span> cancelURI := <span class="hljs-string"><span class="hljs-string">"http://example.com/cancel-uri"</span></span> description := <span class="hljs-string"><span class="hljs-string">"Description for this payment"</span></span> paymentResult, err := c.CreateDirectPaypalPayment(amount, redirectURI, cancelURI, description)</code> </pre><br><br>  2. Payment of any type: <br><br><pre> <code class="go hljs">p := paypalsdk.Payment{ Intent: <span class="hljs-string"><span class="hljs-string">"sale"</span></span>, Payer: &amp;paypalsdk.Payer{ PaymentMethod: <span class="hljs-string"><span class="hljs-string">"credit_card"</span></span>, FundingInstruments: []paypalsdk.FundingInstrument{paypalsdk.FundingInstrument{ CreditCard: &amp;paypalsdk.CreditCard{ Number: <span class="hljs-string"><span class="hljs-string">"4111111111111111"</span></span>, Type: <span class="hljs-string"><span class="hljs-string">"visa"</span></span>, ExpireMonth: <span class="hljs-string"><span class="hljs-string">"11"</span></span>, ExpireYear: <span class="hljs-string"><span class="hljs-string">"2020"</span></span>, CVV2: <span class="hljs-string"><span class="hljs-string">"777"</span></span>, FirstName: <span class="hljs-string"><span class="hljs-string">"John"</span></span>, LastName: <span class="hljs-string"><span class="hljs-string">"Doe"</span></span>, }, }}, }, Transactions: []paypalsdk.Transaction{paypalsdk.Transaction{ Amount: &amp;paypalsdk.Amount{ Currency: <span class="hljs-string"><span class="hljs-string">"USD"</span></span>, Total: <span class="hljs-string"><span class="hljs-string">"7.00"</span></span>, }, Description: <span class="hljs-string"><span class="hljs-string">"My Payment"</span></span>, }}, RedirectURLs: &amp;paypalsdk.RedirectURLs{ ReturnURL: <span class="hljs-string"><span class="hljs-string">"http://..."</span></span>, CancelURL: <span class="hljs-string"><span class="hljs-string">"http://..."</span></span>, }, } paymentResponse, err := client.CreatePayment(p)</code> </pre><br><br>  <b>GET</b> / v1 / payments / payment / ID - getting information about payment <br><br><pre> <code class="go hljs">payment, err := c.GetPayment(paymentID)</code> </pre><br><br>  <b>GET</b> / v1 / payments / payment - a list of all payments <br><br><pre> <code class="go hljs">payments, err := c.GetPayments()</code> </pre><br><br>  <b>GET</b> / v1 / payments / authorization / ID - getting authorization information <br><br><pre> <code class="go hljs">authID := <span class="hljs-string"><span class="hljs-string">"2DC87612EK520411B"</span></span> auth, err := c.GetAuthorization(authID)</code> </pre><br><br>  <b>POST</b> / v1 / payments / authorization / ID / capture - block authorization <br><br><pre> <code class="go hljs">capture, err := c.CaptureAuthorization(authID, &amp;paypalsdk.Amount{Total: <span class="hljs-string"><span class="hljs-string">"7.00"</span></span>, Currency: <span class="hljs-string"><span class="hljs-string">"USD"</span></span>}, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)</code> </pre><br><br>  <b>POST</b> / v1 / payments / authorization / ID / void - cancel authorization <br><br><pre> <code class="go hljs">auth, err := c.VoidAuthorization(authID)</code> </pre><br><br>  <b>POST</b> / v1 / payments / authorization / ID / reauthorize - reauthorization <br><br><pre> <code class="go hljs">auth, err := c.ReauthorizeAuthorization(authID, &amp;paypalsdk.Amount{Total: <span class="hljs-string"><span class="hljs-string">"7.00"</span></span>, Currency: <span class="hljs-string"><span class="hljs-string">"USD"</span></span>})</code> </pre><br><br>  <b>GET</b> / v1 / payments / sale / ID - getting the object of sale <br><br><pre> <code class="go hljs">saleID := <span class="hljs-string"><span class="hljs-string">"36C38912MN9658832"</span></span> sale, err := c.GetSale(saleID)</code> </pre><br><br>  <b>POST</b> / v1 / payments / sale / ID / refund - return of funds for the object of sale.  You can make a full refund or partial refund. <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// Full refund, err := c.RefundSale(saleID, nil) // Partial refund, err := c.RefundSale(saleID, &amp;paypalsdk.Amount{Total: "7.00", Currency: "USD"})</span></span></code> </pre><br><br>  <b>GET</b> / v1 / payments / refund / ID - getting information about the return <br><br><pre> <code class="go hljs">orderID := <span class="hljs-string"><span class="hljs-string">"O-4J082351X3132253H"</span></span> refund, err := c.GetRefund(orderID)</code> </pre><br><br>  <b>GET</b> / v1 / payments / orders / ID - getting information about the order <br><br><pre> <code class="go hljs">order, err := c.GetOrder(orderID)</code> </pre><br><br>  <b>POST</b> / v1 / payments / orders / ID / authorize - order authorization <br><br><pre> <code class="go hljs">auth, err := c.AuthorizeOrder(orderID, &amp;paypalsdk.Amount{Total: <span class="hljs-string"><span class="hljs-string">"7.00"</span></span>, Currency: <span class="hljs-string"><span class="hljs-string">"USD"</span></span>})</code> </pre><br><br>  <b>POST</b> / v1 / payments / orders / ID / capture - order blocking (can be partial or complete, depending on the transferred Amount and IsFinalTransaction) <br><br><pre> <code class="go hljs">capture, err := c.CaptureOrder(orderID, &amp;paypalsdk.Amount{Total: <span class="hljs-string"><span class="hljs-string">"7.00"</span></span>, Currency: <span class="hljs-string"><span class="hljs-string">"USD"</span></span>}, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)</code> </pre><br><br>  <b>POST</b> / v1 / payments / orders / ID / do-void - order cancellation <br><br><pre> <code class="go hljs">order, err := c.VoidOrder(orderID)</code> </pre><br><br>  You can also use godoc documentation to familiarize yourself with all client functions: <a href="https://godoc.org/github.com/logpacker/PayPal-Go-SDK">https://godoc.org/github.com/logpacker/PayPal-Go-SDK</a> <br><br><h4>  Testing and CI </h4><br>  Two types of tests are implemented in the project: Unit and Integration.  Unit tests allow you to check the performance of internal conditions and validation. <br>  An example of checking input parameters in the NewClient function: <br><br><pre> <code class="go hljs">_, err := NewClient(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { t.Errorf(<span class="hljs-string"><span class="hljs-string">"All arguments are required in NewClient()"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { fmt.Println(err.Error()) }</code> </pre><br><br>  Integration tests work directly with the test data on PayPal Sandbox, check the server responses and convert them to go-structures. <br><br>  This process is presented in the diagram below: <br><br><img src="https://habrastorage.org/files/8c0/caa/35b/8c0caa35bd144576be7015d576538f73.png"><br><br>  An example of checking the response of the CreateDirectPaypalPayment function: <br><br><pre> <code class="go hljs">c, _ := NewClient(testClientID, testSecret, APIBaseSandBox) c.GetAccessToken() amount := Amount{ Total: <span class="hljs-string"><span class="hljs-string">"15.11"</span></span>, Currency: <span class="hljs-string"><span class="hljs-string">"USD"</span></span>, } p, err := c.CreateDirectPaypalPayment(amount, <span class="hljs-string"><span class="hljs-string">"http://example.com"</span></span>, <span class="hljs-string"><span class="hljs-string">"http://example.com"</span></span>, <span class="hljs-string"><span class="hljs-string">"test payment"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> || p.ID == <span class="hljs-string"><span class="hljs-string">""</span></span> { t.Errorf(<span class="hljs-string"><span class="hljs-string">"Test paypal payment is not created"</span></span>) }</code> </pre><br><br>  We created a test account in the PayPal sandbox and use test IDs for each type of request.  For example, on a payment with ID PAY-5YK922393D847794YKER7MUI, you can test getting information about it.  In order to inform the client that you are working with Sandbox, you need to set the base URL of the API (and after testing change it to Live URL): <br><br><pre> <code class="go hljs">c, err := paypalsdk.NewClient(<span class="hljs-string"><span class="hljs-string">"clientID"</span></span>, <span class="hljs-string"><span class="hljs-string">"secretID"</span></span>, paypalsdk.APIBaseSandBox)</code> </pre><br><br>  Tests can be run locally with the go test command, but one cannot always be sure that the code in the repository will always be stable.  Therefore, we use Continuous Integration (CI) to automatically run the test every time we push into the repository.  We use <a href="https://travis-ci.org/logpacker/paypalsdk">TravisCI</a> , it easily integrates with the GitHub repository, at the root of our project is the configuration .travis.yml: <br><br><pre> <code class="go hljs">language: <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-keyword"><span class="hljs-keyword">go</span></span>: - <span class="hljs-number"><span class="hljs-number">1.5</span></span> install: - export PATH=$PATH:$HOME/gopath/bin script: - <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> test -v</code> </pre><br><br><h4>  Open Source and immediate plans </h4><br>  All our insights can be found on GitHub, they are published under MIT license.  Plans to create some standard Go library, to provide full API coverage (+ webapps, etc.) <br><br>  Current documentation can be found on the project page in GitHub. <br><br>  We are waiting for your commits and pull requests to <a href="https://github.com/logpacker/PayPal-Go-SDK">logpacker / PayPal-Go-SDK</a> . </div><p>Source: <a href="https://habr.com/ru/post/274555/">https://habr.com/ru/post/274555/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../274535/index.html">Animation of falling snow on Canvas is more effective than animation on DOM several times.</a></li>
<li><a href="../274539/index.html">Configure logrotate + access to collect logs via SFTP</a></li>
<li><a href="../274545/index.html">Method Swizzling and Swift: but there is a nuance</a></li>
<li><a href="../274547/index.html">IBM has released more than 100 business applications with Apple</a></li>
<li><a href="../274549/index.html">Results of 2015 for C ++</a></li>
<li><a href="../274557/index.html">Sitemap.xml or ‚ÄúThere was nothing to do ...‚Äù</a></li>
<li><a href="../274559/index.html">Google fixed Android vulnerabilities</a></li>
<li><a href="../274561/index.html">New from Google. Is authentication safe without entering a password?</a></li>
<li><a href="../274563/index.html">Firefox will support non-standard CSS for compatibility with WebKit</a></li>
<li><a href="../274565/index.html">Creating a function on Rust that returns a String or & str</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>