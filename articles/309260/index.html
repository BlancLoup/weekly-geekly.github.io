<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The hunt for Lurk: from the study of malicious code to a criminal case</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When a company is subjected to cyber attack, the first thing to do is understand what it came from, remove the malicious code, and, preferably, find a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The hunt for Lurk: from the study of malicious code to a criminal case</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/410/515/bc8/410515bc83d5436892112091b8d934b6.png" align="right">  When a company is subjected to cyber attack, the first thing to do is understand what it came from, remove the malicious code, and, preferably, find and close a vulnerable point in the infrastructure.  And then you can ask the question "who is to blame," although, alas, quite often he is completely unanswered.  The task of the security solution providers is to detect and investigate threats, provide protection capabilities, and inform clients.  The search for cybercriminals should deal with law enforcement.  For this, we share with them the results of our work, but there is one nuance here. <br><br>  The set of knowledge to protect against malware is somewhat different from the set needed to investigate.  In the latter case, there is a need for evidence of a link between different incidents, the belonging of different malware to the same source - well, in general, what is not always required to protect clients.  It is important to translate information from a technical language to a legal one.  Such work in the "Lab" deals with the Department of Investigation of computer incidents.  Recently, they shared information about the investigation of the activities of the group Lurk, aimed at commercial organizations.  Campaign victims were infected with a Trojan of the same name, which stole funds from corporate bank accounts. <br><br>  This side of cybercrime work is covered in detail much less frequently than <i>traditional</i> threat research, and therefore the publication is particularly interesting.  This text is a brief extract from several publications on the Securelist on the topic: starting with a <a href="https://securelist.ru/blog/virus-watch/2604/unikalnyj-bestelesnyj-bot-atakuet-posetitelej-novostnyh-resursov/">brief study of</a> 2012, and ending with a detailed technical <a href="https://securelist.ru/featured/28708/bankovskij-troyanec-lurk-specialno-dlya-rossii/">analysis of the</a> Lurk <a href="https://securelist.ru/featured/28708/bankovskij-troyanec-lurk-specialno-dlya-rossii/">Trojan</a> and a story about the <a href="https://securelist.ru/analysis/obzor/29220/the-hunt-for-lurk/">many years of investigation into the</a> activities of the group as a whole. <br><a name="habracut"></a><br>  In June of this year, <a href="https://threatpost.ru/bankeru_lurk_nanesen_sokrushitelnyj_udar/16481/">about 50 suspects</a> , allegedly involved in the theft of 3 billion rubles from the accounts of residents of the CIS and CIS countries, were <a href="https://threatpost.ru/bankeru_lurk_nanesen_sokrushitelnyj_udar/16481/">detained</a> .  The message of the Ministry of Internal Affairs indicated the commission of numerous embezzlements of "money from the settlement accounts of legal entities, as well as from correspondent accounts of financial institutions using malicious software."  ‚ÄúLaboratory‚Äù provided the law enforcement agencies with expert support in the investigation, and, in fact, the detention itself put an end to the investigation of our experts, which lasted more than five years. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Start </h3><br>  Perhaps the most characteristic moment of the whole story is the story of the very first detection of a part of the Trojan code.  These were discovered in 2011 after reports of several cases of theft of funds from corporate bank accounts.  The attack technique did not correspond to the highest level of software protection for working with bank transfers of that time: it was enough to modify the bank details in the generated payment orders, after which the money was sent to the accounts of the intruders.  The detected module was very difficult to get to work in the laboratory.  An additional malicious module discovered later in the same year made it clear that the program is aimed at remote banking systems.  But no more than that: the received data was enough to protect against a specific version of the code, but it was not enough to determine the scale of the attack.  In a series of much more famous financial cyber attacks of that time ( <a href="https://securelist.ru/analysis/1396/za-kem-ohotitsya-zeus/">ZeuS</a> , <a href="https://securelist.ru/blog/novosti/2111/spyeye-obhodit-vtoroj-uroven-bankovskoj-z/">SpyEye</a> , <a href="https://securelist.ru/blog/novosti/2510/carberp-vy-mogaet-den-gi-za-dostup-k-facebook/">Carberp</a> ), Lurk was just another dangerous, but not an outstanding malware. <br><br><h3>  Infection of popular news sites </h3><br>  The situation cleared up in 2012, when there was a massive infection of users through popular news resources.  Malicious code, not the first and not the last time, dragged through a banner network. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/640/fef/d85/640fefd85acd4bb5aae17e6e840e5934.png"></div><br>  <i>Sample code of an infected banner</i> <br><br>  Javascript code redirected to a malicious site, from where visitors were given an exploit for a <a href="https://cve.mitre.org/cgi-bin/cvename.cgi%3Fname%3DCVE-2011-3544">vulnerability in Java</a> .  The malicious code was loaded as an encrypted library directly into the javaw.exe process memory - and this was already a rather non-standard approach for attacks of this type.  The "incorporeal" method is known from <a href="https://en.wikipedia.org/wiki/Code_Red_(computer_worm)">CodeRed</a> and <a href="https://en.wikipedia.org/wiki/SQL_Slammer">Slammer</a> virus epidemics, but in this case it was used to download the Lurk Trojan.  At this stage, the attack got its name thanks to quite effective technologies of secretive infection and work. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c03/9ff/97f/c039ff97f694474c83daf395b9c64681.png"></div><br>  <i>Part of the Lurk malware code responsible for loading additional modules</i> <br><br>  Despite the fact that more than 300 thousand users were attacked, not all of them got a trojan in addition.  A prerequisite for the further exploitation of the security breach was the availability of specialized software for corporate online banking on the infected computer.  Looking ahead, I will say that in the end, only 60 thousand systems passed through the Lurk command servers, which is relatively few, precisely because of this selectivity. <br><br><h3>  Organization </h3><br>  In 2013, there was enough evidence to reliably link different versions of malware to each other.  The complexity of the malicious code grew, additional modules appeared, and the "support" of banking clients expanded.  Since we are talking about corporate banking, there are not so many client software options, but for each authors of the attack, it was necessary to do some serious work on studying the principles of operation and reverse engineering of the code - not so much complex as long and tedious.  At the same time, our experts used mistakes made by members of a criminal group, which provided information on the number of participants and similar data (examples of errors, however, are not given in the article, for obvious reasons). <br><br>  In 2013, there were about 15 participants in the group, closer to the final, the number increased to 40. Some people were responsible for developing malware, others worked on the botnet management system, and others cashed out funds.  New experienced developers searched in different ways, including through the banal job ads. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ae3/2ef/1ad/ae32ef1ad811489db021500a0ff876b4.png"></div><br><br>  At this stage of Lurk work, almost everything was automated: infection and further transfer of funds to dummy accounts, even the distribution of money for subsequent cashing almost did not require human intervention. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/aef/3d7/875/aef3d7875cb748babba757a58f18ea7b.jpg"></div><br><br><h3>  No money left </h3><br>  The Golden Age ended rather quickly.  Already in 2014, the group began to experience a shortage of funds.  From the outside, this was noticeable by expanding the circle of potential victims, including ordinary users, and increasingly, criminals turned out to deal with a relatively small potential sum.  The reason for this was changes in the field of security software for banking services.  Vendors stopped posting demo versions of products on the site, it became more difficult to get new versions for studying.  There were technologies to counter the simplest method of automatic substitution of bank details.  The attackers even tried to get a copy of the programs to study through a dummy legal entity.  At this moment, on the Lab side, all new versions of malicious modules were seen, and they could promptly analyze and update protection systems for clients.  Meanwhile, the maintenance of an extensive campaign support infrastructure each month cost, according to our experts, tens of thousands of dollars. <br><br>  Business diversification began: Angler's exploit-pack appeared, which earned criminal-to-criminal in the market.  It is he who, by the way, is the most well-known product of the group outside Russia: at different times, new versions of the pack were analyzed by experts from many antivirus campaigns.  In June of this year, several independent sources <a href="https://threatpost.ru/nuclear-angler-exploit-kit-activity-has-disappeared/16845/">confirmed</a> that the activity of Angler was completely discontinued, which just coincided with the arrest of the suspects. <br><br>  The final attempt to broaden the scope of the cybercrime business was manual attacks on banking systems.  Avtozaliv has not worked for a long time, the Lurk toolkit was used to penetrate the victim's infrastructure - and then how lucky.  By that time, our experts had uncovered the methodology of the <a href="https://securelist.ru/blog/issledovaniya/25106/bolshoe-bankovskoe-ograblenie-apt-kampaniya-carbanak/">Carbanak</a> campaign, which specialized in banks and large companies, and at the same time found similar in character attacks using different, but already well-known, malicious tools. <br><br>  According to our experts, although the Lurk attacks continued until the spring of 2016, there were organizational problems within the group, including not the best way that affected compliance with the conspiracy.  Especially at the most vulnerable stage of work - when cashing money.  The set of front companies for the transfer of the stolen was limited, and as a result it was possible to gather enough technical expertise and evidence for the arrest of the suspects. <br><br><h3>  Some technical features </h3><br>  A full description of malicious modules Lurk is in <a href="https://securelist.ru/featured/28708/bankovskij-troyanec-lurk-specialno-dlya-rossii/">this</a> article, but here I will give only the most interesting features. <br><br>  The majority of the victims were infected (in the later stages of work) with the help of Angler's exploit pack, through the hacking of a popular or specialized site (often accounting forums fell under the gun), directly or through third-party banners or partner elements.  But, in the event that an ‚Äúuninteresting‚Äù system was found to be infected in an ‚Äúinteresting‚Äù organization, reconnaissance over the local network was carried out, and penetration was carried out, including using the absolutely legitimate utility psexec. <br><br>  The main body of the malware (core module) was loaded only on suitable systems.  If the required target software was not detected, the intelligence modules were removed, but passwords for ftp servers from their respective clients could be stolen before that.  The addresses of the command servers were not fixed in the main module.  They were calculated (or more precisely generated from two sides) based on indirect information, for example, using data on current stock quotes. <br><br>  In later versions of Lurk, keyboard interception is implemented, but only in the case of working in a specific program.  In some cases, the video content of the screen was intercepted. <br><br>  In the spring of this year, there was a <a href="https://threatpost.ru/swift-network-doubles-down-on-security/16357/">series of reports</a> on successful attacks on the SWIFT interbank transfer system.  The details of these attacks are little known, and not the fact that they will be shared in the near future.  Our <a href="https://securelist.ru/analysis/obzor/29220/the-hunt-for-lurk/">analysis of</a> Lurk provides an explanation for such slowness: here the reason is the need to collect a large amount of technical data, and because of the peculiarities of interaction with law enforcement agencies (again, it is easier to detect a malicious attack than to investigate everything to the end).  One moment from the technical analysis of Lurk, I suppose, will be reproduced more than once in other investigations of similar attacks: you can reliably protect clients of financial systems only if the protection is implemented on the server side as well.  In other words, the solution to the problem with this type of cyber attacks is to work together (in the case of Lurk, this is both a vendor of security solutions, software developers, banking organizations, their clients, and law enforcement agencies). <br><br>  <i><strong>Disclaimer:</strong> This column is based on real events, but still reflects only the personal opinion of its author.</i>  <i>It may coincide with the position of Kaspersky Lab, or it may not coincide.</i>  <i>Then how lucky.</i> </div><p>Source: <a href="https://habr.com/ru/post/309260/">https://habr.com/ru/post/309260/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../309248/index.html">ACIT will assume the role of an ‚Äúarbitrator‚Äù in conflicts between online sellers and consumers</a></li>
<li><a href="../309252/index.html">Voronoi diagram and its applications</a></li>
<li><a href="../309254/index.html">Apple vs cryptocurrency Dash: privacy is at stake</a></li>
<li><a href="../309256/index.html">Writing our first Brackets plugin</a></li>
<li><a href="../309258/index.html">Online data analysis software on Stepik.org</a></li>
<li><a href="../309262/index.html">4 thieves of productivity</a></li>
<li><a href="../309264/index.html">Worker question: why are western IT companies interested in autistic employees?</a></li>
<li><a href="../309266/index.html">Peter Lowry: ‚ÄúThe greatest difficulty is in understanding the methodology‚Äù</a></li>
<li><a href="../309268/index.html">The digest of interesting events from the world of Java, and around it # 8 (08/01/2016 - 08/31/2016)</a></li>
<li><a href="../309270/index.html">School programmers HeadHunter - open the seventh set</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>