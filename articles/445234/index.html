<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Exceptions in Python are now considered anti-pattern.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What are exceptions? It is clear from the title that they arise when an exceptional situation occurs in the program. You ask why exceptions are an ant...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Exceptions in Python are now considered anti-pattern.</h1><div class="post__text post__text-html js-mediator-article">  What are exceptions?  It is clear from the title that they arise when an exceptional situation occurs in the program.  You ask why exceptions are an anti-pattern, and how do they generally relate to typing?  I tried to <a href="https://sobolevn.me/2019/02/python-exceptions-considered-an-antipattern">figure it out</a> , and now I want to discuss it with you, habrazhiteli. <br><br><h2>  Exception issues </h2><br>  It is difficult to find flaws in what you encounter every day.  Habit and narrow-mindedness turns bugs into features, but let's try to look at the exceptions unbiased. <br><br><h3>  Exceptions are hard to notice </h3><br>
   : ¬´¬ª     <code>raise</code>  &nbsp;,  &nbsp;; ¬´¬ª  &nbsp; , , .<br>
<br>
 &nbsp;,  ¬´¬ª  &nbsp;  .  &nbsp;  :<br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">divide</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(first: float, second: float)</span></span></span><span class="hljs-function"> -&gt; float:</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> first / second
</code></pre><br>
      ,  <code>float</code>.      - : &nbsp;<br>
<br>
<pre><code class="python hljs">result = divide(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)
print(<span class="hljs-string"><span class="hljs-string">'x / y = '</span></span>, result)
</code></pre><br>
?     <code>print</code>     ,    1  0 ‚Äì  ,   <code>ZeroDivisionError</code>. ,       ,      . <br>
<a name="habracut"></a><br>
           ,  .     Python       : ,  , <code>int</code>, <code>str</code>, ,   ,     .   <code>raise something()</code>    . ,        .  <a href="https://github.com/python/typing/issues/71">   </a>   . <br>
<br>
<h3>     </h3><br>
         .    <code>ZeroDivisionError</code>,        .<br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">divide</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(first: float, second: float)</span></span></span><span class="hljs-function"> -&gt; float:</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>:
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> first / second
    <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ZeroDivisionError:
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span>
</code></pre><br>
   .     0?   1  <code>None</code>? &nbsp;,   ,  <code>None</code>     (   ),  ,       -    .<br>
<br>
   ?  , -    ?       .  ,       ,     .<br>
<br>
<blockquote> :    ‚Äî ,      .</blockquote><br>
  ,     <code>ZeroDivisionError</code>   .          -  &nbsp;   . <br>
<br>
 ,      ,   ?  ,        ‚Äî -  .         .<br>
<br>
<h3>  </h3><br>
,  ,  -    , ,   . ,        ,      0.   <code>divide</code>        .<br>
<br>
    ,    . ,  ,    ?       ? ,  , <strong></strong>. <br>
<br>
 ,       .          <code>except</code>,     <a href="https://docs.python.org/3/library/contextlib.html"></a>.          ,   ,     . <br>
<br>
,      : ,   ,   ,     .      ?<br>
<br>
      ¬´  ¬ª.<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/8k/bn/do/8kbndolwukkaluarfk3vpexws2w.png"></div><br>
,   <code>goto</code>,   .<br>
<br>
<h3>  </h3><br>
   :      HTTP API:<br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests

<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetch_user_profile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(user_id: int)</span></span></span><span class="hljs-function"> -&gt; 'UserProfile':</span></span>
    <span class="hljs-string"><span class="hljs-string">"""Fetches UserProfile dict from foreign API."""</span></span>
    response = requests.get(<span class="hljs-string"><span class="hljs-string">'/api/users/{0}'</span></span>.format(user_id))
    response.raise_for_status()
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response.json()
</code></pre><br>
        .     :<br>
<br>
<ul>
<li>   ,      .</li>
<li>   .</li>
<li>    ,  .</li>
<li>   .</li>
<li> API     URL.</li>
<li>    .</li>
<li>   .</li>
<li>   -      </li>
<li>      .</li>
<li>    JSON,    .</li>
</ul><br>
   ,          .  ,        ,      .<br>
<br>
<h2>  ?</h2><br>
,   ,       ,  ,    .     ,   .<br>
<br>
<ul>
<li>  <code><a href="https://wemake-python-styleguide.readthedocs.io/en/latest/pages/violations/best_practices.html">except Exception: pass</a></code>.  . <strong>  .</strong></li>
<li> <code>None</code>.  .          <code>if something is not None:</code>        ,      <code>TypeError</code>.    .</li>
<li>     . ,   <code>User</code>      <code>UserNotFound</code>  <code>MissingUser</code>.         ,   <code><a href="https://docs.djangoproject.com/en/2.1/ref/contrib/auth/">AnonymousUser</a></code>  Django,        .    ,      .</li>
<li> ,                &nbsp;.      <code><a href="https://github.com/dry-python/returns">@dry-python/return</a></code>.    - ,   .</li>
</ul><br>
    ,      0.     ,      ,     ?<br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> returns.result <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Result, Success, Failure

<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">divide</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(first: float, second: float)</span></span></span><span class="hljs-function"> -&gt; Result[float, ZeroDivisionError]:</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>:
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Success(first / second)
    <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ZeroDivisionError <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> exc:
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Failure(exc)
</code></pre><br>
      : <code>Success</code>  <code>Failure</code>.       <code>Result</code>.         , , <code>Result[float, ZeroDivisionError]</code>   <code>Success[float]</code>,  <code>Failure[ZeroDivisionError]</code>.<br>
<br>
   ?  <strong>  ,     </strong>.     <code>Failure</code>   :    .<br>
<br>
<pre><code class="python hljs"><span class="hljs-number"><span class="hljs-number">1</span></span> + divide(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)
<span class="hljs-comment"><span class="hljs-comment"># =&gt; mypy error: Unsupported operand types for + ("int" and "Result[float, ZeroDivisionError]")</span></span>
</code></pre><br>
   .     <code>Result</code>,     .       .<br>
<br>
 ,     <a href="https://www.python.org/dev/peps/pep-0561/">  PEP561</a>.   mypy  ,     -,     . <br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> returns.result <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Result, Success, Failure

<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">divide</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(first: float, second: float)</span></span></span><span class="hljs-function"> -&gt; Result[float, ZeroDivisionError]:</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>:
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Success(<span class="hljs-string"><span class="hljs-string">'Done'</span></span>)
        <span class="hljs-comment"><span class="hljs-comment"># =&gt; error: incompatible type "str"; expected "float"</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ZeroDivisionError <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> exc:
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Failure(<span class="hljs-number"><span class="hljs-number">0</span></span>)
        <span class="hljs-comment"><span class="hljs-comment"># =&gt; error: incompatible type "int"; expected "ZeroDivisionError"</span></span>
</code></pre><br>
<h3>   ?</h3><br>
  <a href="https://returns.readthedocs.io/en/latest/pages/container.html"></a>:<br>
<br>
<ul>
<li><code>map</code>  ,    ;</li>
<li><code>bind</code>  ,    .</li>
</ul><br>
<pre><code class="python hljs">Success(<span class="hljs-number"><span class="hljs-number">4</span></span>).bind(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> number: Success(number / <span class="hljs-number"><span class="hljs-number">2</span></span>))
<span class="hljs-comment"><span class="hljs-comment"># =&gt; Success(2)</span></span>

Success(<span class="hljs-number"><span class="hljs-number">4</span></span>).map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> number: number + <span class="hljs-number"><span class="hljs-number">1</span></span>)
<span class="hljs-comment"><span class="hljs-comment"># =&gt; Success(5)</span></span>
</code></pre><br>
  ,        ,  <code>.bind</code>  <code>.map</code>     c <code>Failure</code>:<br>
<br>
<pre><code class="python hljs">Failure(<span class="hljs-number"><span class="hljs-number">4</span></span>).bind(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> number: Success(number / <span class="hljs-number"><span class="hljs-number">2</span></span>))
<span class="hljs-comment"><span class="hljs-comment"># =&gt; Failure(4)</span></span>

Failure(<span class="hljs-number"><span class="hljs-number">4</span></span>).map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> number: number / <span class="hljs-number"><span class="hljs-number">2</span></span>)
<span class="hljs-comment"><span class="hljs-comment"># =&gt; Failure(4)</span></span>
</code></pre><br>
          ,         .     <a href="https://returns.readthedocs.io/en/latest/pages/container.html">  ,  </a>,       .<br>
<br>
<pre><code class="python hljs">Failure(<span class="hljs-number"><span class="hljs-number">4</span></span>).rescue(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> number: Success(number + <span class="hljs-number"><span class="hljs-number">1</span></span>))
<span class="hljs-comment"><span class="hljs-comment"># =&gt; Success(5)</span></span>

Failure(<span class="hljs-number"><span class="hljs-number">4</span></span>).fix(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> number: number / <span class="hljs-number"><span class="hljs-number">2</span></span>)
<span class="hljs-comment"><span class="hljs-comment"># =&gt; Success(2)</span></span>
</code></pre><br>
   ¬´   ¬ª,  ¬´   ¬ª.  ,     !<br>
<br>
<h3>     ?</h3><br>
,     ,      ,     .     <code>.unwrap()</code>  <code>.value_or()</code>:<br>
<br>
<pre><code class="python hljs">Success(<span class="hljs-number"><span class="hljs-number">1</span></span>).unwrap()
<span class="hljs-comment"><span class="hljs-comment"># =&gt; 1</span></span>

Success(<span class="hljs-number"><span class="hljs-number">0</span></span>).value_or(<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>)
<span class="hljs-comment"><span class="hljs-comment"># =&gt; 0</span></span>

Failure(<span class="hljs-number"><span class="hljs-number">0</span></span>).value_or(<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>)
<span class="hljs-comment"><span class="hljs-comment"># =&gt; None</span></span>

Failure(<span class="hljs-number"><span class="hljs-number">1</span></span>).unwrap()
<span class="hljs-comment"><span class="hljs-comment"># =&gt; Raises UnwrapFailedError()</span></span>
</code></pre><br>
,      ,   ,    <code>.unwrap()</code>      ?<br>
<br>
<h3>    UnwrapFailedErrors?</h3><br>
,  ,     .   :           .     ,       <code>Result</code>:<br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> returns.result <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Result, Success, Failure

<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CreateAccountAndUser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span>
    <span class="hljs-string"><span class="hljs-string">"""Creates new Account-User pair."""</span></span>

    <span class="hljs-comment"><span class="hljs-comment"># </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> we need to create a pipeline of these methods somehow...</span></span>

    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_validate_user</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(
        self, username: str, email: str,
    )</span></span></span><span class="hljs-function"> -&gt; Result['UserSchema', str]:</span></span>
        <span class="hljs-string"><span class="hljs-string">"""Returns an UserSchema for valid input, otherwise a Failure."""</span></span>

    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_create_account</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(
        self, user_schema: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'UserSchema'</span></span></span></span><span class="hljs-function"><span class="hljs-params">,
    )</span></span></span><span class="hljs-function"> -&gt; Result['Account', str]:</span></span>
        <span class="hljs-string"><span class="hljs-string">"""Creates an Account for valid UserSchema's. Or returns a Failure."""</span></span>

    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_create_user</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(
        self, account: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'Account'</span></span></span></span><span class="hljs-function"><span class="hljs-params">,
    )</span></span></span><span class="hljs-function"> -&gt; Result['User', str]:</span></span>
        <span class="hljs-string"><span class="hljs-string">"""Create an User instance. If user already exists returns Failure."""</span></span>
</code></pre><br>
-,        -:<br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CreateAccountAndUser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span>
    <span class="hljs-string"><span class="hljs-string">"""Creates new Account-User pair."""</span></span>

    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__call__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, username: str, email: str)</span></span></span><span class="hljs-function"> -&gt; Result['User', str]:</span></span>
        <span class="hljs-string"><span class="hljs-string">"""Can return a Success(user) or Failure(str_reason)."""</span></span>
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._validate_user(
            username, email,
        ).bind(
            self._create_account,
        ).bind(
            self._create_user,
        )

   <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>
</code></pre><br>
   - ,    ,     <code>.unwrap()</code>.      ? .    ? <code>@pipeline</code>:<br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> result.functions <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pipeline

<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CreateAccountAndUser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span>
    <span class="hljs-string"><span class="hljs-string">"""Creates new Account-User pair."""</span></span>

<span class="hljs-meta"><span class="hljs-meta">    @pipeline</span></span>
    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__call__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, username: str, email: str)</span></span></span><span class="hljs-function"> -&gt; Result['User', str]:</span></span>
        <span class="hljs-string"><span class="hljs-string">"""Can return a Success(user) or Failure(str_reason)."""</span></span>
        user_schema = self._validate_user(username, email).unwrap()
        account = self._create_account(user_schema).unwrap()
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._create_user(account)

   <span class="hljs-comment"><span class="hljs-comment"># ...</span></span>
</code></pre><br>
    .   <code>.unwrap()</code>  <code>@pipeline</code>  :  ,  -  <code>.unwrap()</code>    <code>Failure[str]</code>,  <code>@pipeline</code>     <code>Failure[str]</code>    .                .<br>
<br>
<h2>  </h2><br>
,          HTTP API. ,      ?          <code>Result</code>.    <a href="https://returns.readthedocs.io/en/latest/pages/functions.html"> @safe</a>,        .    ,      :<br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> returns.functions <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> safe

<span class="hljs-meta"><span class="hljs-meta">@safe</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">divide</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(first: float, second: float)</span></span></span><span class="hljs-function"> -&gt; float:</span></span>
     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> first / second


<span class="hljs-comment"><span class="hljs-comment"># is the same as:</span></span>

<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">divide</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(first: float, second: float)</span></span></span><span class="hljs-function"> -&gt; Result[float, ZeroDivisionError]:</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>:
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Success(first / second)
    <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ZeroDivisionError <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> exc:
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Failure(exc)
</code></pre><br>
,  <code>@safe</code>,    . <br>
<br>
,         API ‚Äì   <code>@safe</code>.     :<br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests
<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> returns.functions <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pipeline, safe
<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> returns.result <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Result

<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FetchUserProfile</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span>
    <span class="hljs-string"><span class="hljs-string">"""Single responsibility callable object that fetches user profile."""</span></span>

    <span class="hljs-comment"><span class="hljs-comment">#: You can later use dependency injection to replace `requests`</span></span>
    <span class="hljs-comment"><span class="hljs-comment">#: with any other http library (or even a custom service).</span></span>
    _http = requests

<span class="hljs-meta"><span class="hljs-meta">    @pipeline</span></span>
    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__call__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user_id: int)</span></span></span><span class="hljs-function"> -&gt; Result['UserProfile', Exception]:</span></span>
        <span class="hljs-string"><span class="hljs-string">"""Fetches UserProfile dict from foreign API."""</span></span>
        response = self._make_request(user_id).unwrap()
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._parse_json(response)

<span class="hljs-meta"><span class="hljs-meta">    @safe</span></span>
    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_make_request</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user_id: int)</span></span></span><span class="hljs-function"> -&gt; requests.Response:</span></span>
        response = self._http.get(<span class="hljs-string"><span class="hljs-string">'/api/users/{0}'</span></span>.format(user_id))
        response.raise_for_status()
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response

<span class="hljs-meta"><span class="hljs-meta">    @safe</span></span>
    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_parse_json</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, response: requests.Response)</span></span></span><span class="hljs-function"> -&gt; 'UserProfile':</span></span>
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response.json()
</code></pre><br>
<strong> ,       </strong>:<br>
<br>
<ul>
<li>  <code>@safe</code>   ,    .        <code>Result[OldReturnType, Exception]</code>.</li>
<li> <code>Result</code>  ,        .</li>
<li> <code>.unwrap()</code>,     .</li>
<li> <code>@pipeline</code>,    <code>.unwrap</code>  .</li>
</ul><br>
          ‚Äî     .   ,    :<br>
<br>
<ul>
<li><strong>¬´  ¬ª</strong>.       <code>Result</code>,     . </li>
<li><strong>¬´     ¬ª</strong>.        .     <code>.fix()</code>  <code>.rescue()</code>.</li>
<li><strong>¬´  ¬ª</strong>.      -.     .</li>
<li><strong>¬´   ¬ª</strong>.  !   ,  -       .</li>
</ul><br>
<h3>   </h3><br>
,         .  <strong> </strong>           .     -     ,   ,           .<br>
<br>
<blockquote>      ?   <a href="https://conf.python.ru/2019/">Moscow Python Conf++</a> 5 , !       ‚Äì   dry-python  core- Django Channels.  <a href="https://conf.python.ru/2019/abstracts/4557"></a>     dry-python  -.</blockquote></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/445234/">https://habr.com/ru/post/445234/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445220/index.html">AMD Radeon VII: High-End Dash (Part 3)</a></li>
<li><a href="../445222/index.html">Get an offer in 1 day in the backend team on Cosmonautics Day</a></li>
<li><a href="../445226/index.html">Development of a rocket capable of reaching the moon will cost the Russian Federation 740 billion rubles</a></li>
<li><a href="../445228/index.html">Cryptography in Java. Mac class</a></li>
<li><a href="../445230/index.html">Registration for the II IT conference for novice developers SMARTRHINO-2019 has begun</a></li>
<li><a href="../445236/index.html">‚ÄúExtreme NOW Forum 2019‚Äù: registration is open</a></li>
<li><a href="../445238/index.html">Grow Big: Top 10 Reports Mobius 2018 Moscow</a></li>
<li><a href="../445240/index.html">How to move, unload and integrate very large data cheaply and quickly? What is pushdown optimization?</a></li>
<li><a href="../445242/index.html">Experience using Coroutines and Retrofit2</a></li>
<li><a href="../445244/index.html">"Money games outside the blockchain must die"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>