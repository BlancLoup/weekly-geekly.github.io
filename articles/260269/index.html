<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Antivirus Self-Defense</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As practice shows, any design antivirus is vulnerable, and implementing a new workaround for it is not a big problem. 

 Our research center was inter...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Antivirus Self-Defense</h1><div class="post__text post__text-html js-mediator-article">  As practice shows, any design antivirus is vulnerable, and implementing a new workaround for it is not a big problem. <br><br>  Our research center was interested to check how the developers of antivirus solutions monitor the presence of descriptions of attack methods on the Internet.  And is it always necessary to detect a 0-day vulnerability in an antivirus attack, or is it just enough to find useful information on the forums? <br><a name="habracut"></a><br><h4>  Introduction </h4><br>  Most of the analytical work devoted to this topic, as a rule, is focused on assessing the efficiency of detecting malicious code by antiviruses, the performance of antiviruses, etc.  As part of our research, we tried to find out whether the developers of solutions of this class are following the trends and modifying their products in accordance with the new methods of attack. <br><br>  Self-defense of the antivirus and its circumvention in some cases means circumventing the entire mechanism for detecting malicious code.  This and is often used in the implementation of targeted attacks or in programs with destructive, blocking this software functionality. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After the introduction of malicious code into the antivirus process, it is able to exist for a long time and imperceptibly in the user's system, which undoubtedly is a consequence of the main logical flaw in the self-defense architecture, as well as the methods of using trusted process lists. <br><br><h4>  Antivirus self-defense </h4><br>  The malicious code is being improved in parallel with the development of antivirus technologies, which is very similar to some kind of arms race.  There are all new threats that compromise the software of this class, disable it, completely deactivate its functionality, etc.  As a result, requirements for the development of antivirus solutions, which are positioned to protect after the fact, are growing.  Antiviruses provide functionality for self-defense and protection against active threats.  Perhaps the most controversial mechanism of software of this class ‚Äî the mechanism of self-defense ‚Äî is developing. <br><br>  If you systematize internally the device of several anti-virus products, you can summarize the self-defense architecture.  As a result, we will get the following features inherent in this mechanism and its implementation: <br><br><ol><li>  Protect your own files and directories <br><ul><li>  Usually implemented with a kernel level file filter. </li></ul></li><li>  Protect your own configuration data in the registry <br><ul><li>  It is implemented using a combination of hooks and / or the RegistryCallback interface of the kernel. </li></ul></li><li>  Protection of antivirus interfaces <br><ul><li>  Control access to various control interfaces in ring0. </li></ul></li><li>  Protection of own processes <br><ul><li>  Implementations vary, it can be a combination of various interceptions of the kernel‚Äôs system functions, object types, use of a callback to create a process. </li></ul></li></ol><br>  And, finally, the most controversial moment in the work of the self-defense mechanism: antivirus processes become a kind of super-privileged entity, they are inaccessible for the impact of both the attacker and the average user. <br><br>  Consequences of introducing malicious code into the antivirus: <br><ul><li>  Global disabling / blocking antivirus </li><li>  Manipulating whitelists </li><li>  Hidden operation in a super-privileged process </li><li>  Firewall rules bypass </li><li>  ... </li></ul><br><h4>  Testing Methodology </h4><br><h5>  Considered Antivirus Solutions </h5><br>  For the study, we selected several anti-virus products that meet the following requirements: <br><ol><li>  Software using the self-defense architecture declares itself as capable of responding to an active, launched threat; it has a proactive defense function; </li><li>  Included in the list of the most popular solutions that have previously been tested using various methodologies. </li></ol><br>  It turned out such a list (At the time of testing, these were the latest versions): <br><table><tbody><tr><th>  Developer </th><th>  Product Name, Version </th></tr><tr><td>  Mcafee </td><td>  McAfee Total Security 2015 (15.4.0.470.7) </td></tr><tr><td>  ESET </td><td>  ESET Smart Security (8.0.312.3) </td></tr><tr><td>  Symantec </td><td>  Norton Security (22.2.0.31) </td></tr><tr><td>  Avg </td><td>  AVG Internet Security 2015 (2015.0.5941) </td></tr><tr><td>  BitDefender </td><td>  BitDefender Total Security 2015 (18.20.0.1429) </td></tr><tr><td>  Trend micro </td><td>  Trend Micro Antivirus + 2015 (AMSP 3.5.1186) </td></tr><tr><td>  Avira </td><td>  Avira (15.0.8.652) </td></tr><tr><td>  Dr.Web </td><td>  Dr.Web 10 (10.0.1.03310) </td></tr><tr><td>  Kaspersky </td><td>  Kaspersky Internet Security 15 (15.0.2.361) </td></tr><tr><td>  Panda </td><td>  Panda Internet Security 2015 (15.1.0) </td></tr><tr><td>  Avast </td><td>  Avast Free Antivirus (2015.10.2.2218) </td></tr></tbody></table><h5>  Testing environment </h5><br>  Testing methods took place on the Windows 7 operating system, x86_64 / x86_32, which was installed on the VMware virtual machine.  In addition, individual solutions were installed on physical hardware (due to the use of hardware virtualization mechanisms VT-x / AMD-V). <br><br><h5>  Applied technology </h5><br>  For this study, several universal techniques were applied, each of which is not aimed at a specific solution and does not use the architectural weaknesses of this or that software. <br><br><blockquote>  <b>All the techniques used in this test are available on open Internet resources for 1-3 years.</b>  <b>Their code is not intentionally demonstrated.</b>  <b>Links to public sources describing these techniques can only be provided to anti-virus companies only upon their official request.</b> </blockquote><br>  The following techniques were chosen: ProxyInject, Duplicate Handle, Reparse Point, PageFile, RegSafe / RegRestore and Shim Engine.  For a more detailed description of the technique, we recommend referring to the original text of the study <a href="http://dsec.ru/upload/medialibrary/216/216367fd007f81be723f5d4fc47184e0.pdf">‚ÄúSelf-defense of antiviruses‚Äù</a> . <br>  And for testing, a special program was used, which receives data on equipment and targets as parameters. <br><br><img src="https://habrastorage.org/files/280/b92/138/280b921386f84eb5b153e8aadceccef1.png"><br><br><h4>  results </h4><br><blockquote>  <b>At a specific formulation of the problem, the same techniques are used by our specialists during penetration tests.</b>  <b>In the process of work, it is necessary both to use the previously mentioned ones and to develop new techniques.</b> </blockquote><br><img src="https://habrastorage.org/files/263/ac1/ae0/263ac1ae0a0142049f7cb4cbf2d8e2d3.png"><br><br><blockquote>  <b>It should be understood that, in addition to these techniques, there are many others (inaccessible publicly), which also aim at introducing an antivirus product into the work or at terminating it.</b>  <b>And of course, there are universal tools and specific anti-virus product.</b> </blockquote><br><h4>  findings </h4><br>  Thus, the results of testing with a specific methodology on this sampling of the technician revealed a very interesting result: the domestic antivirus developer improved and built his defense more qualitatively than foreign vendors did. <br><br>  Obviously, some companies simply do not track the evolution of public methods of attack, only confirming the absurdity of their chosen architecture. <br><br>  It is also worth noting that, despite all the results, the architecture as a whole does not change, and the developers react to the attacks after the fact and are protected from already known attack mechanisms.  This provides attackers with greater freedom of action, and also provides opportunities for improving methods in the future.  And until the situation changes, the attackers will always be one step ahead of defense. </div><p>Source: <a href="https://habr.com/ru/post/260269/">https://habr.com/ru/post/260269/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260249/index.html">Programmers and Depression</a></li>
<li><a href="../260253/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ164 (June 8 - 14, 2015)</a></li>
<li><a href="../260255/index.html">"Big battalions" in continuous time (battle simulation)</a></li>
<li><a href="../260257/index.html">PHP Digest 64 - interesting news, materials and tools (June 1 - 14, 2015)</a></li>
<li><a href="../260259/index.html">Ingredients of IoT Fast Food Delicacies: Intel Edison + Intel XDK + JavaScript + Grove Kit</a></li>
<li><a href="../260271/index.html">Salad "Microsoft Guide for SymbolTable with a delicate aftertaste Antlr4"</a></li>
<li><a href="../260273/index.html">Challenge the tradition of hi-fi. Digital potentiometers in detail. Part two</a></li>
<li><a href="../260275/index.html">How we made the best release tracker tracker</a></li>
<li><a href="../260277/index.html">That the site did not fall: an economical method</a></li>
<li><a href="../260279/index.html">Do we really need start-ups for large corporations</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>