<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PhpBB3 trap system</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Introduction 
 What is it? 
 The trap system allows application developers and mods to set traps in phpBB code or use them in their own functions. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PhpBB3 trap system</h1><div class="post__text post__text-html js-mediator-article"><h4>  1. Introduction </h4><br><h5>  What is it? </h5><br>  The trap system allows application developers and mods to set traps in phpBB code or use them in their own functions. <br><a name="habracut"></a><br><h5>  PhpBB functions with which you can use traps </h5><br>  There are 4 functions in phpBB that you can capture with your own hooks: <br><br>  <b>phpbb_user_session_handler ()</b> - called from inside user :: setup after correctly initializing the session and user objects; <br>  <b>append_sid ($ url, $ params = false, $ is_amp = true, $ session_id = false)</b> - called to form links (add session identifier); <br>  <b>$ template-&gt; display ($ handle, $ include_once = true)</b> - called right before the output (not yet compiled) template; <br>  <b>exit_handler ()</b> - called at the very end of the phpBB3 code execution. <br><br>  <i>Please note: a trap using <b>$ template-&gt; display</b> can take the third $ template argument (a link to the $ template object), which can be used instead of the global one.</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If you integrated phpBB3 with your application, then you may want to use constants: <br><br>  <b>PHPBB_MSG_HANDLER</b> (rewrite message handler); <br>  <b>PHPBB_DB_NEW_LINK</b> (overwrite the new_link parameter for sql_connect); <br>  <b>PHPBB_ROOT_PATH</b> (overwrite $ phpbb_root_path); <br>  <b>PHPBB_ADMIN_PATH</b> (overwrite $ phpbb_admin_path); <br>  <b>PHPBB_USE_BOARD_URL_PATH</b> (use generate_board_url () for images instead of $ phpbb_root_path). <br><br>  If the <b>PHPBB_USE_BOARD_URL_PATH</b> constant <b>is</b> set to true, then phpBB uses generate_board_url () (which returns a link to the forum with the script path included) for all loaded images.  This constant is in the files: <br><br>  <b>/includes/session.php</b> - user :: img () <br>  <b>/includes/functions_content.php</b> - smiley_text () <br><br>  It will also change the paths in the template variables: <br>  {T_THEME_PATH} - styles / xxx / theme <br>  {T_TEMPLATE_PATH} - styles / xxx / template <br>  {T_SUPER_TEMPLATE_PATH} - styles / xxx / template <br>  {T_IMAGESET_PATH} - styles / xxx / imageset <br>  {T_IMAGESET_LANG_PATH} - styles / xxx / imageset / yy <br>  {T_IMAGES_PATH} - images / <br>  {T_SMILIES_PATH} - $ config ['smilies_path'] / <br>  {T_AVATAR_PATH} - $ config ['avatar_path'] / <br>  {T_AVATAR_GALLERY_PATH} - $ config ['avatar_gallery_path'] / <br>  {T_ICONS_PATH} - $ config ['icons_path'] / <br>  {T_RANKS_PATH} - $ config ['ranks_path'] / <br>  {T_UPLOAD_PATH} - $ config ['upload_path'] / <br>  {T_STYLESHEET_LINK} - styles / xxx / theme / stylesheet.css (or a link to style.php, if css is dynamically generated) <br>  The new template variable {BOARD_URL} consists of board url + script path. <br><br><h5>  2. We allow to use traps in functions and methods of classes. </h5><br>  The following examples explain how phpBB3 uses the built-in hook system.  It is possible that you are more interested in registering your own traps, but the demonstration of this code will help you understand the trap system better ... <br><br>  First of all, this example shows how to embed the necessary code in a function if you want to allow it to intercept traps: <br><br><blockquote><ol><li> <code><font color="black"><font color="#3A00FF"><b>function</b></font> my_own_function <font color="#009900">(</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">call_hook</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#339933">,</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#b1b100">return</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return_result</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#009900">}</font> <font color="#009900">[</font>    <font color="#009900">]</font> <font color="#009900">}</font></font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#3A00FF"><b>function</b></font> my_own_function <font color="#009900">(</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> { <font color="#990000">global</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">call_hook</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#339933">,</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#b1b100">return</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return_result</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#009900">}</font> <font color="#009900">[</font>    <font color="#009900">]</font> <font color="#009900">}</font></font></font></code> </li> <li> <code><font color="black"><font color="#3A00FF"><b>function</b></font> my_own_function <font color="#009900">(</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">call_hook</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#339933">,</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#b1b100">return</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return_result</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#009900">}</font> <font color="#009900">[</font>    <font color="#009900">]</font> <font color="#009900">}</font></font></code> </li> <li></li><li> <code><font color="black"><font color="#3A00FF"><b>function</b></font> my_own_function <font color="#009900">(</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">call_hook</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#339933">,</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#b1b100">return</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return_result</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#009900">}</font> <font color="#009900">[</font>    <font color="#009900">]</font> <font color="#009900">}</font></font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#3A00FF"><b>function</b></font> my_own_function <font color="#009900">(</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">call_hook</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#339933">,</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">)</font> { <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#b1b100">return</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return_result</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#009900">}</font> <font color="#009900">[</font>    <font color="#009900">]</font> <font color="#009900">}</font></font></font></code> </li> <li> <code><font color="black"><font color="#3A00FF"><b>function</b></font> my_own_function <font color="#009900">(</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">call_hook</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#339933">,</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#b1b100">return</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return_result</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#009900">}</font> <font color="#009900">[</font>    <font color="#009900">]</font> <font color="#009900">}</font></font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#3A00FF"><b>function</b></font> my_own_function <font color="#009900">(</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">call_hook</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#339933">,</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#009900">)</font> { <font color="#b1b100">return</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return_result</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#009900">}</font> <font color="#009900">[</font>    <font color="#009900">]</font> <font color="#009900">}</font></font></font></code> </li> <li> <code><font color="black"><font color="#3A00FF"><b>function</b></font> my_own_function <font color="#009900">(</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">call_hook</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#339933">,</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#b1b100">return</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return_result</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#009900">}</font> <font color="#009900">[</font>    <font color="#009900">]</font> <font color="#009900">}</font></font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#3A00FF"><b>function</b></font> my_own_function <font color="#009900">(</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">call_hook</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#339933">,</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#b1b100">return</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return_result</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#339933">;</font> } <font color="#009900">}</font> <font color="#009900">[</font>    <font color="#009900">]</font> <font color="#009900">}</font></font></font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#3A00FF"><b>function</b></font> my_own_function <font color="#009900">(</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">call_hook</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#339933">,</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#b1b100">return</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return_result</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> } <font color="#009900">[</font>    <font color="#009900">]</font> <font color="#009900">}</font></font></font></code> </li> <li></li><li> <code><font color="black"><font color="#3A00FF"><b>function</b></font> my_own_function <font color="#009900">(</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">call_hook</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#339933">,</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#b1b100">return</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return_result</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#009900">}</font> <font color="#009900">[</font>    <font color="#009900">]</font> <font color="#009900">}</font></font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#3A00FF"><b>function</b></font> my_own_function <font color="#009900">(</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">call_hook</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#339933">,</font> <font color="#000088">$my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#b1b100">return</font> <font color="#000088">$phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return_result</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#009900">}</font> <font color="#009900">[</font>    <font color="#009900">]</font> }</font></font></code> </li> </ol></blockquote><br><br>  Above, the call_hook function should always be called with the parameters of your function. <br><br>  And this example shows how you could have a class method intercept traps ... <br><blockquote><ol><li>  <font color="#3A00FF"><b>class</b></font> my_hookable_object </li><li>  <font color="#009900">{</font> </li><li>  <font color="#3A00FF"><b>function</b></font> hook_me <font color="#009900">(</font> <font color="#000088">$ my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$ my_second_parameter</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#990000">global</font> <font color="#000088">$ phpbb_hook</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">call_hook</font> <font color="#009900">(</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__CLASS__</b></font> <font color="#339933">,</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">))</font> <font color="#339933">,</font> <font color="#000088">$ my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$ my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return</font> <font color="#009900">(</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__CLASS__</b></font> <font color="#339933">,</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#b1b100">return</font> <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return_result</font> <font color="#009900">(</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__CLASS__</b></font> <font color="#339933">,</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#009900">[</font> HERE YOUR CODE <font color="#009900">]</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li></ol></blockquote><br><br>  Here the only difference is in how you define the first parameter.  For a function, this is only a constant __FUNCTION__, and for a method it is an array (__ CLASS__, __FUNCTION__).  In PHP4, the constant __CLASS__ always returns the name of the class in lowercase. <br><br>  Now, in phpBB, predefined functions have appeared that can intercept traps, but how to make them available (and therefore allow others to intercept them)?  For this there is a method <b>add_hook ()</b> : <br><blockquote><ol><li>  <font color="#666666"><i>// add your own function that can</i></font> </li><li>  <font color="#666666"><i>// catch traps</i></font> </li><li>  <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">add_hook</font> <font color="#009900">(</font> <font color="#0000ff">'my_own_function'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666"><i>// add your own method that can</i></font> </li><li>  <font color="#666666"><i>// catch traps</i></font> </li><li>  <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">add_hook</font> <font color="#009900">(</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'my_hookable_object'</font> <font color="#339933">,</font> <font color="#0000ff">'hook_me'</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> </li></ol></blockquote><br>  You can also remove the ability to hook traps by a function / method by calling <b>$ phpbb_hook-&gt; remove_hook ()</b> with the same parameters as add_hook ().  This is useful if you want some traps not to be called. <br><br><h5>  3. Registration traps </h5><br>  We now turn to the definition of your functions that should be called.  To do this, we take the append_sid () function as an example (this function can be used by default hooks) and create two classes and a function: <br><blockquote><ol><li>  <font color="#3A00FF"><b>class</b></font> my_append_sid_class <font color="#009900">{</font> </li><li></li><li>  <font color="#666666"><i>// our functions</i></font> </li><li>  <font color="#3A00FF"><b>function</b></font> my_append_sid <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$ hook</font> <font color="#339933">,</font> <font color="#000088">$ url</font> <font color="#339933">,</font> <font color="#000088">$ params</font> <font color="#339933">=</font> <font color="#3A00FF"><b>false</b></font> <font color="#339933">,</font> <font color="#000088">$ is_amp</font> <font color="#339933">=</font> <font color="#3A00FF"><b>true</b></font> <font color="#339933">,</font> <font color="#000088">$ session_id</font> <font color="#339933">=</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li></li><li>  <font color="#666666"><i>// get the possible results of the previous trap</i></font> </li><li>  <font color="#000088">$ result</font> <font color="#339933">=</font> <font color="#000088">$ hook</font> <font color="#339933">-&gt;</font> <font color="#004000">previous_hook_result</font> <font color="#009900">(</font> <font color="#0000ff">'append_sid'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#b1b100">return</font> <font color="#000088">$ result</font> <font color="#009900">[</font> <font color="#0000ff">'result'</font> <font color="#009900">]</font> <font color="#339933">.</font>  <font color="#0000ff">"&lt;br /&gt; I was the second."</font>  <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#666666"><i>// one more class</i></font> </li><li>  <font color="#3A00FF"><b>class</b></font> my_second_append_sid_class <font color="#009900">{</font> </li><li></li><li>  <font color="#3A00FF"><b>function</b></font> my_append_sid <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$ hook</font> <font color="#339933">,</font> <font color="#000088">$ url</font> <font color="#339933">,</font> <font color="#000088">$ params</font> <font color="#339933">=</font> <font color="#3A00FF"><b>false</b></font> <font color="#339933">,</font> <font color="#000088">$ is_amp</font> <font color="#339933">=</font> <font color="#3A00FF"><b>true</b></font> <font color="#339933">,</font> <font color="#000088">$ session_id</font> <font color="#339933">=</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li></li><li>  <font color="#666666"><i>// get the possible results of the previous trap</i></font> </li><li>  <font color="#000088">$ result</font> <font color="#339933">=</font> <font color="#000088">$ hook</font> <font color="#339933">-&gt;</font> <font color="#004000">previous_hook_result</font> <font color="#009900">(</font> <font color="#0000ff">'append_sid'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#990000">echo</font> <font color="#000088">$ result</font> <font color="#009900">[</font> <font color="#0000ff">'result'</font> <font color="#009900">]</font> <font color="#339933">.</font>  <font color="#0000ff">"&lt;br /&gt; I am the third."</font>  <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#666666"><i>// normal function</i></font> </li><li>  <font color="#3A00FF"><b>function</b></font> my_append_sid <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$ hook</font> <font color="#339933">,</font> <font color="#000088">$ url</font> <font color="#339933">,</font> <font color="#000088">$ params</font> <font color="#339933">=</font> <font color="#3A00FF"><b>false</b></font> <font color="#339933">,</font> <font color="#000088">$ is_amp</font> <font color="#339933">=</font> <font color="#3A00FF"><b>true</b></font> <font color="#339933">,</font> <font color="#000088">$ session_id</font> <font color="#339933">=</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li></li><li>  <font color="#666666"><i>// get the possible results of the previous trap</i></font> </li><li>  <font color="#000088">$ result</font> <font color="#339933">=</font> <font color="#000088">$ hook</font> <font color="#339933">-&gt;</font> <font color="#004000">previous_hook_result</font> <font color="#009900">(</font> <font color="#0000ff">'append_sid'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#b1b100">return</font> <font color="#0000ff">"I was called first"</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#666666"><i>// initialize second class</i></font> </li><li>  <font color="#000088">$ my_second_append_sid_class</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> my_second_append_sid_class <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li></ol></blockquote><br><br>  Make sure that you add the same parameters to your function as defined for the function that hooks traps with one exception: the first parameter is always &amp; $ hook, a link to the hook object that you can work with. <br><br>  Now we register the traps one by one using the <b>$ phpbb_hook-&gt; register ()</b> method: <br><blockquote><ol><li>  <font color="#666666"><i>// Now we will register our ‚Äúsubstitutes‚Äù for the append_sid function in order ...</i></font> </li><li>  <font color="#666666"><i>// Register the function (called first)</i></font> </li><li>  <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">register</font> <font color="#009900">(</font> <font color="#0000ff">'append_sid'</font> <font color="#339933">,</font> <font color="#0000ff">'my_append_sid'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666"><i>// Register first class</i></font> </li><li>  <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">register</font> <font color="#009900">(</font> <font color="#0000ff">'append_sid'</font> <font color="#339933">,</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'my_append_sid_class'</font> <font color="#339933">,</font> <font color="#0000ff">'my_append_sid'</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666"><i>// .. and second class</i></font> </li><li>  <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">register</font> <font color="#009900">(</font> <font color="#0000ff">'append_sid'</font> <font color="#339933">,</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$ my_second_append_sid_class</font> <font color="#339933">,</font> <font color="#0000ff">'my_append_sid'</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> </li></ol></blockquote><br><br>  With this example, you can even force your own functions to intercept themselves: <br><br><blockquote><ol><li>  <font color="#666666"><i>// Register the trap that phpbb will intercept</i></font> </li><li>  <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">register</font> <font color="#009900">(</font> <font color="#0000ff">'append_sid'</font> <font color="#339933">,</font> <font color="#0000ff">'my_own_append_sid'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666"><i>// Add a function that will intercept traps</i></font> </li><li>  <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">add_hook</font> <font color="#009900">(</font> <font color="#0000ff">'my_own_append_sid'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666"><i>// Register the trap that will be intercepted by our function</i></font> </li><li>  <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">register</font> <font color="#009900">(</font> <font color="#0000ff">'my_own_append_sid'</font> <font color="#339933">,</font> <font color="#0000ff">'also_my_own_append_sid'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li></ol></blockquote><br><br><h5>  Special processing / chains </h5><br>  The hooks registration method is able to accept the third argument for defining a special ‚Äúchain‚Äù mode.  It can take the values: <b>first</b> , <b>last</b> and <b>standalone</b> . <br><br>  <b>$ phpbb_hook-&gt; register ('append_sid', 'my_own_append_sid', 'first')</b> guarantees a function call at the beginning of the chain.  It is possible to call more than one function within the first block - the <a href="http://ru.wikipedia.org/wiki/FIFO_(%25D0%25B8%25D0%25BD%25D1%2584%25D0%25BE%25D1%2580%25D0%25BC%25D0%25B0%25D1%2582%25D0%25B8%25D0%25BA%25D0%25B0)">FIFO</a> principle is used here; <br>  <b>$ phpbb_hook-&gt; register ('append_sid', 'my_own_append_sid', 'last')</b> guarantees a function call at the very end of the chain.  It is possible to call more than one function within the latter - the FIFO principle is used here; <br>  <b>$ phpbb_hook-&gt; register ('append_sid', 'my_own_append_sid', 'standalone')</b> ensures that only a specific function is called.  All other functions are removed from the chain and other functions are not added to it after.  If two applications attempt to switch the standalone mode, then a PHP notification will be displayed and the second function will be ignored. <br><h5>  Object Trap Resolution </h5><br>  Because  the trap system cannot distinguish between initialized objects, and only operates on the classes themselves, you need to solve this at the code level. <br><br>  One possible way is to use the property: <br><blockquote><ol><li>  <font color="#3A00FF"><b>class</b></font> my_hookable_object <font color="#009900">{</font> </li><li>  <font color="#3A00FF"><b>function</b></font> blabla <font color="#009900">(</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#3A00FF"><b>class</b></font> my_hookable_object2 <font color="#3A00FF"><b>extends</b></font> my_hookable_object </li><li>  <font color="#009900">{</font> </li><li>  <font color="#3A00FF"><b>var</b></font> <font color="#000088">$ call_hook</font> <font color="#339933">=</font> <font color="#3A00FF"><b>true</b></font> <font color="#339933">;</font> </li><li></li><li>  <font color="#3A00FF"><b>function</b></font> hook_me <font color="#009900">(</font> <font color="#000088">$ my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$ my_second_parameter</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">call_hook</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#990000">global</font> <font color="#000088">$ phpbb_hook</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">call_hook</font> <font color="#009900">(</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__CLASS__</b></font> <font color="#339933">,</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">))</font> <font color="#339933">,</font> <font color="#000088">$ my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$ my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return</font> <font color="#009900">(</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__CLASS__</b></font> <font color="#339933">,</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#b1b100">return</font> <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return_result</font> <font color="#009900">(</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__CLASS__</b></font> <font color="#339933">,</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#b1b100">return</font> <font color="#0000ff">'not hooked'</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#3A00FF"><b>function</b></font> hooking <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$ hook</font> <font color="#339933">,</font> <font color="#000088">$ first</font> <font color="#339933">,</font> <font color="#000088">$ second</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#b1b100">return</font> <font color="#0000ff">'hooked'</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#000088">$ first_object</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> my_hookable_object2 <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ second_object</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> my_hookable_object2 <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">add_hook</font> <font color="#009900">(</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'my_hookable_object2'</font> <font color="#339933">,</font> <font color="#0000ff">'hook_me'</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">register</font> <font color="#009900">(</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'my_hookable_object2'</font> <font color="#339933">,</font> <font color="#0000ff">'hook_me'</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#0000ff">'hooking'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666"><i>// Do not call a trap for $ first_object</i></font> </li><li>  <font color="#000088">$ first_object</font> <font color="#339933">-&gt;</font> <font color="#004000">call_hook</font> <font color="#339933">=</font> <font color="#3A00FF"><b>false</b></font> <font color="#339933">;</font> </li><li></li><li>  <font color="#990000">echo</font> <font color="#000088">$ first_object</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_me</font> <font color="#009900">(</font> <font color="#0000ff">'first'</font> <font color="#339933">,</font> <font color="#0000ff">'second'</font> <font color="#009900">)</font> <font color="#339933">.</font>  <font color="#0000ff">'&lt;br /&gt;'</font> <font color="#339933">;</font> </li><li>  <font color="#990000">echo</font> <font color="#000088">$ second_object</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_me</font> <font color="#009900">(</font> <font color="#0000ff">'first'</font> <font color="#339933">,</font> <font color="#0000ff">'second'</font> <font color="#009900">)</font> <font color="#339933">.</font>  <font color="#0000ff">'&lt;br /&gt;'</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666"><i>//Conclusion:</i></font> </li><li>  not hooked </li><li>  hooked </li></ol></blockquote><br><br>  Another possibility is to use a variable function (which can be omitted when passing variables to the trap): <br><blockquote><ol><li>  <font color="#3A00FF"><b>class</b></font> my_hookable_object <font color="#009900">{</font> </li><li>  <font color="#3A00FF"><b>function</b></font> blabla <font color="#009900">(</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#3A00FF"><b>class</b></font> my_hookable_object2 <font color="#3A00FF"><b>extends</b></font> my_hookable_object </li><li>  <font color="#009900">{</font> </li><li>  <font color="#3A00FF"><b>function</b></font> hook_me <font color="#009900">(</font> <font color="#000088">$ my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$ my_second_parameter</font> <font color="#339933">,</font> <font color="#000088">$ hook_me</font> <font color="#339933">=</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ hook_me</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#990000">global</font> <font color="#000088">$ phpbb_hook</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">call_hook</font> <font color="#009900">(</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__CLASS__</b></font> <font color="#339933">,</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">))</font> <font color="#339933">,</font> <font color="#000088">$ my_first_parameter</font> <font color="#339933">,</font> <font color="#000088">$ my_second_parameter</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return</font> <font color="#009900">(</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__CLASS__</b></font> <font color="#339933">,</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#b1b100">return</font> <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return_result</font> <font color="#009900">(</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__CLASS__</b></font> <font color="#339933">,</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#b1b100">return</font> <font color="#0000ff">'not hooked'</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#3A00FF"><b>function</b></font> hooking <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$ hook</font> <font color="#339933">,</font> <font color="#000088">$ first</font> <font color="#339933">,</font> <font color="#000088">$ second</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#b1b100">return</font> <font color="#0000ff">'hooked'</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#000088">$ first_object</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> my_hookable_object2 <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ second_object</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> my_hookable_object2 <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">add_hook</font> <font color="#009900">(</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'my_hookable_object2'</font> <font color="#339933">,</font> <font color="#0000ff">'hook_me'</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">register</font> <font color="#009900">(</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'my_hookable_object2'</font> <font color="#339933">,</font> <font color="#0000ff">'hook_me'</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#0000ff">'hooking'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#990000">echo</font> <font color="#000088">$ first_object</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_me</font> <font color="#009900">(</font> <font color="#0000ff">'first'</font> <font color="#339933">,</font> <font color="#0000ff">'second'</font> <font color="#339933">,</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#339933">.</font>  <font color="#0000ff">'&lt;br /&gt;'</font> <font color="#339933">;</font> </li><li>  <font color="#990000">echo</font> <font color="#000088">$ second_object</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_me</font> <font color="#009900">(</font> <font color="#0000ff">'first'</font> <font color="#339933">,</font> <font color="#0000ff">'second'</font> <font color="#009900">)</font> <font color="#339933">.</font>  <font color="#0000ff">'&lt;br /&gt;'</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666"><i>// Conclusion:</i></font> </li><li>  not hooked </li><li>  hooked </li></ol></blockquote><br><br><h5>  4. Return of the result </h5><br>  It is necessary to clearly define, either the function returns the result obtained by the intercepted function, or continues its execution.  This may be due to the need of the application and, consequently, the function returns the result only if the function intercepted by the trap returns a result. <br><br><h6>  Case number 1 - Returning the result of the function </h6><br>  Imagine that the following function supports traps: <br><blockquote><ol><li>  <font color="#3A00FF"><b>function</b></font> append_sid <font color="#009900">(</font> <font color="#000088">$ url</font> <font color="#339933">,</font> <font color="#000088">$ params</font> <font color="#339933">=</font> <font color="#3A00FF"><b>false</b></font> <font color="#339933">,</font> <font color="#000088">$ is_amp</font> <font color="#339933">=</font> <font color="#3A00FF"><b>true</b></font> <font color="#339933">,</font> <font color="#000088">$ session_id</font> <font color="#339933">=</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#990000">global</font> <font color="#000088">$ _SID</font> <font color="#339933">,</font> <font color="#000088">$ _EXTRA_URL</font> <font color="#339933">,</font> <font color="#000088">$ phpbb_hook</font> <font color="#339933">;</font> </li><li></li><li></li><li>  <font color="#666666"><i>// Developers using traps need to do</i></font> </li><li>  <font color="#666666"><i>// global $ _SID and $ _EXTRA_URL in their own</i></font> </li><li>  <font color="#666666"><i>// functions and skillfully manage them.</i></font> </li><li></li><li>  <font color="#666666"><i>// Most of the code can be simply copied from here.</i></font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">call_hook</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#339933">,</font> <font color="#000088">$ url</font> <font color="#339933">,</font> <font color="#000088">$ params</font> <font color="#339933">,</font> <font color="#000088">$ is_amp</font> <font color="#339933">,</font> <font color="#000088">$ session_id</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#b1b100">return</font> <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return_result</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#009900">[</font> <font color="#339933">...</font> <font color="#009900">]</font> </li><li>  <font color="#009900">}</font> </li></ol></blockquote><br><br>  Now your function.  Immediately after you return the result, the <b>append_sid ()</b> function <b>will</b> return your result: <br><blockquote><ol><li>  <font color="#666666"><i>// Intercepted function</i></font> </li><li>  <font color="#3A00FF"><b>function</b></font> my_append_sid <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$ hook</font> <font color="#339933">,</font> <font color="#000088">$ url</font> <font color="#339933">,</font> <font color="#000088">$ params</font> <font color="#339933">=</font> <font color="#3A00FF"><b>false</b></font> <font color="#339933">,</font> <font color="#000088">$ is_amp</font> <font color="#339933">=</font> <font color="#3A00FF"><b>true</b></font> <font color="#339933">,</font> <font color="#000088">$ session_id</font> <font color="#339933">=</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li></li><li>  <font color="#666666"><i>// Get possible results</i></font> </li><li>  <font color="#000088">$ result</font> <font color="#339933">=</font> <font color="#000088">$ hook</font> <font color="#339933">-&gt;</font> <font color="#004000">previous_hook_result</font> <font color="#009900">(</font> <font color="#0000ff">'append_sid'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#b1b100">return</font> <font color="#0000ff">'After I return something, the append_sid () function will return my result'</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#009900">}</font> </li></ol></blockquote><br><br>  You should always use the opportunity to get the results of executing the function above, in the method <b>previous_hook_result ()</b> , which returns an array of the form array ('result' =&gt; [your result]). <br><br><h6>  Case number 2 - We do not return anything at all </h6><br>  Sometimes applications do not need to return something and therefore the following functions will continue to run: <br><blockquote><ol><li>  <font color="#3A00FF"><b>function</b></font> append_sid <font color="#009900">(</font> <font color="#000088">$ url</font> <font color="#339933">,</font> <font color="#000088">$ params</font> <font color="#339933">=</font> <font color="#3A00FF"><b>false</b></font> <font color="#339933">,</font> <font color="#000088">$ is_amp</font> <font color="#339933">=</font> <font color="#3A00FF"><b>true</b></font> <font color="#339933">,</font> <font color="#000088">$ session_id</font> <font color="#339933">=</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#990000">global</font> <font color="#000088">$ _SID</font> <font color="#339933">,</font> <font color="#000088">$ _EXTRA_URL</font> <font color="#339933">,</font> <font color="#000088">$ phpbb_hook</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">call_hook</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#339933">,</font> <font color="#000088">$ url</font> <font color="#339933">,</font> <font color="#000088">$ params</font> <font color="#339933">,</font> <font color="#000088">$ is_amp</font> <font color="#339933">,</font> <font color="#000088">$ session_id</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#b1b100">return</font> <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">hook_return_result</font> <font color="#009900">(</font> <font color="#3A00FF"><b>__FUNCTION__</b></font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#009900">[</font> <font color="#339933">...</font> <font color="#009900">]</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#666666"><i>// Intercepted function</i></font> </li><li>  <font color="#3A00FF"><b>function</b></font> my_append_sid <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$ hook</font> <font color="#339933">,</font> <font color="#000088">$ url</font> <font color="#339933">,</font> <font color="#000088">$ params</font> <font color="#339933">=</font> <font color="#3A00FF"><b>false</b></font> <font color="#339933">,</font> <font color="#000088">$ is_amp</font> <font color="#339933">=</font> <font color="#3A00FF"><b>true</b></font> <font color="#339933">,</font> <font color="#000088">$ session_id</font> <font color="#339933">=</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li></li><li>  <font color="#666666"><i>// Get possible results</i></font> </li><li>  <font color="#000088">$ result</font> <font color="#339933">=</font> <font color="#000088">$ hook</font> <font color="#339933">-&gt;</font> <font color="#004000">previous_hook_result</font> <font color="#009900">(</font> <font color="#0000ff">'append_sid'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#009900">[</font> <font color="#339933">...</font> <font color="#009900">]</font> </li><li></li><li>  <font color="#666666"><i>// I only overwrite some variables and do not return anything, so the append_sid () function will not return anything.</i></font> </li><li>  <font color="#009900">}</font> </li></ol></blockquote><br><br>  Note: The decision to return or not to return is made exclusively at the very end of the call to the chain of traps.  For example: <br><blockquote><ol><li>  <font color="#666666"><i>// Intercepted function</i></font> </li><li>  <font color="#3A00FF"><b>function</b></font> my_append_sid <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$ hook</font> <font color="#339933">,</font> <font color="#000088">$ url</font> <font color="#339933">,</font> <font color="#000088">$ params</font> <font color="#339933">=</font> <font color="#3A00FF"><b>false</b></font> <font color="#339933">,</font> <font color="#000088">$ is_amp</font> <font color="#339933">=</font> <font color="#3A00FF"><b>true</b></font> <font color="#339933">,</font> <font color="#000088">$ session_id</font> <font color="#339933">=</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li></li><li>  <font color="#666666"><i>// Get possible results</i></font> </li><li>  <font color="#000088">$ result</font> <font color="#339933">=</font> <font color="#000088">$ hook</font> <font color="#339933">-&gt;</font> <font color="#004000">previous_hook_result</font> <font color="#009900">(</font> <font color="#0000ff">'append_sid'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666"><i>// $ result variable does not contain value</i></font> </li><li></li><li>  <font color="#b1b100">return</font> <font color="#0000ff">'FILLED'</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#666666"><i>// This function is also registered and executed after my_append_sid ()</i></font> </li><li>  <font color="#3A00FF"><b>function</b></font> my_own_append_sid <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$ hook</font> <font color="#339933">,</font> <font color="#000088">$ url</font> <font color="#339933">,</font> <font color="#000088">$ params</font> <font color="#339933">=</font> <font color="#3A00FF"><b>false</b></font> <font color="#339933">,</font> <font color="#000088">$ is_amp</font> <font color="#339933">=</font> <font color="#3A00FF"><b>true</b></font> <font color="#339933">,</font> <font color="#000088">$ session_id</font> <font color="#339933">=</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#000088">$ result</font> <font color="#339933">=</font> <font color="#000088">$ hook</font> <font color="#339933">-&gt;</font> <font color="#004000">previous_hook_result</font> <font color="#009900">(</font> <font color="#0000ff">'append_sid'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666"><i>// $ result variable is filled with 'FILLED'</i></font> </li><li></li><li>  <font color="#666666"><i>// But, since</i></font>  <font color="#666666"><i>I do not return anything, the append_sid () function will continue its execution</i></font> </li><li></li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#666666"><i>// The way to register both functions</i></font> </li><li>  <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">register</font> <font color="#009900">(</font> <font color="#0000ff">'append_sid'</font> <font color="#339933">,</font> <font color="#0000ff">'my_append_sid'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ phpbb_hook</font> <font color="#339933">-&gt;</font> <font color="#004000">register</font> <font color="#009900">(</font> <font color="#0000ff">'append_sid'</font> <font color="#339933">,</font> <font color="#0000ff">'my_own_append_sid'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li></ol></blockquote><br><br><h5>  6. Embedding your files / classes / methods </h5><br>  In general, there are two ways between which you can choose: <br><br>  1) Add the file to the folder <b>includes / hooks /</b> .  The file must have <b>hook_</b> prefix.  This file will connect inside common.php, you can register your traps, connect other files or functions, etc.  It is recommended to connect other files only if necessary (for example, inside a function call). <br><br>  Keep in mind that you need to clear the cache so that your newly moved files are accessible by phpBB3. <br><br>  2) The second method is intended for those who want to wrap the code phpBB3, instead of placing a special file in the folder for traps.  This is usually done by connecting phpBB files within an application file.  In order to register your trap you need to create a function in the application: <br><blockquote><ol><li>  <font color="#666666"><i>// My function, which is executed inside the constructor</i></font> </li><li>  <font color="#3A00FF"><b>function</b></font> phpbb_hook_register <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$ hook</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#000088">$ hook</font> <font color="#339933">-&gt;</font> <font color="#004000">register</font> <font color="#009900">(</font> <font color="#0000ff">'append_sid'</font> <font color="#339933">,</font> <font color="#0000ff">'my_append_sid'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#009900">[</font> <font color="#339933">...</font> <font color="#009900">]</font> </li></ol></blockquote><br><br>  <a href="http://www.phpbb.com/community/docs/hook_system.html">Original text</a> . <br><habracut></habracut></div><p>Source: <a href="https://habr.com/ru/post/131074/">https://habr.com/ru/post/131074/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../131067/index.html">We are glad to meet you! ... gY ... gYpost</a></li>
<li><a href="../131068/index.html">Overview of the OS Symbian Belle</a></li>
<li><a href="../131071/index.html">Rules of ant battles</a></li>
<li><a href="../131072/index.html">Two-dimensional segment tree (with group modification of elements)</a></li>
<li><a href="../131073/index.html">Interaction of managed and unmanaged code</a></li>
<li><a href="../131076/index.html">New app - Friday - another step towards Siri</a></li>
<li><a href="../131077/index.html">ZF2 EventManager</a></li>
<li><a href="../131078/index.html">CAD consolidation. Remote work on professional graphic stations</a></li>
<li><a href="../131079/index.html">Digest Wanted.VC # 19</a></li>
<li><a href="../131080/index.html">Free webinar and competition for all WebMatrix</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>