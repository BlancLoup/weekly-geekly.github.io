<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Rodent Hunt for Linux</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There is a mass of monitoring tools of the operating system, but it makes special sense to catch the moment of the problem and catch the cause of the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Rodent Hunt for Linux</h1><div class="post__text post__text-html js-mediator-article">  There is a mass of monitoring tools of the operating system, but it makes special sense to catch the moment of the problem and catch the cause of the high load or the source of performance problems.  I call it the hunting of "rodents" resources. <br><br>  For this, I composed for myself a simple <b>ratcatcher.sh</b> script which you can modify to fit your systems and tasks. <br><br>  The principle of operation is simple - the script runs at a specified frequency, checks the Load Average level (you can use other control parameters) and if the specified value is exceeded, the script executes the specified set of diagnostic commands and creates a report that is sent to your email address. <br><a name="habracut"></a><br><h4>  Sample script for the OpenVZ server </h4><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #          export LC_ALL=C #   load average            # ,   OpenVZ   75-200,   KVM - 15-45 LALIMIT="80" #    EMAIL="alerts@.tld" #   SUBJECT="WARNING-High load notification" #      5  F5M="$(cut -d. -f1 /proc/loadavg)" #     RESULT="$(echo "$F5M &gt; $LALIMIT" | bc)" #     ,       #   ,     ,       #    .       /tmp/ratkill.flag, #    /tmp/ratkill.flag   . # if (( "$RESULT" == "1" )); then if [ -f /tmp/ratkill.flag ]; then exit 0 fi touch /tmp/ratkill.flag else if [ -f /tmp/ratkill.flag ]; then rm -f /tmp/ratkill.flag fi exit 0 fi #      TEMPFILE="$(mktemp)" #    echo "Load average Crossed allowed limit $LALIMIT." &gt;&gt; $TEMPFILE echo "Hostname: $(hostname)" &gt;&gt; $TEMPFILE echo "Local Date &amp; Time : $(date)" &gt;&gt; $TEMPFILE #   echo "Memory-----------------------------------" &gt;&gt; $TEMPFILE free -m &gt;&gt; $TEMPFILE echo "-------------------------------------------" &gt;&gt; $TEMPFILE vmstat -s -Sm &gt;&gt; $TEMPFILE echo "-------------------------------------------" &gt;&gt; $TEMPFILE #     echo "context switches:" &gt;&gt; $TEMPFILE sar -w 1 5 &gt;&gt; $TEMPFILE echo "-------------------------------------------" &gt;&gt; $TEMPFILE #   "" echo "Top loaded containers:" &gt;&gt; $TEMPFILE echo "-------------------------------------------" &gt;&gt; $TEMPFILE /usr/sbin/vzlist \ -o veid,ip,hostname,numproc,numfile,numflock,numtcpsock,physpages,laverage \ -s laverage | tail -20 &gt;&gt; $TEMPFILE echo "-------------------------------------------" &gt;&gt; $TEMPFILE #      echo "Top containers by net. connections count:" &gt;&gt; $TEMPFILE echo "-------------------------------------------" &gt;&gt; $TEMPFILE /usr/sbin/vzlist \ -o veid,ip,hostname,numproc,numtcpsock -s numtcpsock | tail -20 &gt;&gt; $TEMPFILE echo "-------------------------------------------" &gt;&gt; $TEMPFILE #     echo "conntrack count" &gt;&gt; $TEMPFILE wc -l /proc/net/nf_conntrack &gt;&gt; $TEMPFILE echo "-------------------------------------------" &gt;&gt; $TEMPFILE #   echo "I/O statistic:" &gt;&gt; $TEMPFILE echo "-------------------------------------------" &gt;&gt; $TEMPFILE iostat -x 2 5 &gt;&gt; $TEMPFILE echo "-------------------------------------------" &gt;&gt; $TEMPFILE #   top echo "System snapshot from top:" &gt;&gt; $TEMPFILE echo "-------------------------------------------" &gt;&gt; $TEMPFILE top -b | head -30 &gt;&gt; $TEMPFILE echo "-------------------------------------------" &gt;&gt; $TEMPFILE #    I/O    CPU echo "Report from dstat:" &gt;&gt; $TEMPFILE echo "-------------------------------------------" &gt;&gt; $TEMPFILE dstat --net --disk --disk-util --sys --load --proc --top-io-adv \ --top-cpu-adv --nocolor 5 5 &gt;&gt; $TEMPFILE echo "-------------------------------------------" &gt;&gt; $TEMPFILE #   RAID  echo "RAID Logical device information" &gt;&gt; $TEMPFILE #/opt/MegaRAID/MegaCli/MegaCli64 -LDInfo -LALL -aAll &gt;&gt; $TEMPFILE /usr/local/sbin/arcconf GETCONFIG 1 ld &gt;&gt; $TEMPFILE echo "-------------------------------------------" &gt;&gt; $TEMPFILE #     cat $TEMPFILE &gt; /tmp/load.txt echo "${SUBJECT}-${F5M}" | mail -a /tmp/load.txt -s "$(hostname -s)-${SUBJECT}-${F5M}" "$EMAIL" rm -f $TEMPFILE</span></span></code> </pre> <br>  In order to have binding to a specific guest, you can also add analysis of PID processes via vzpid and much more, but you can do this yourself if necessary. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For the script to work, you will need to additionally install the sysstat and dstat utilities.  Use the <a href="http://rpmfind.net/linux/rpm2html/search.php%3Fquery%3Ddstat%26submit%3DSearch%2B...">latest</a> dstat <a href="http://rpmfind.net/linux/rpm2html/search.php%3Fquery%3Ddstat%26submit%3DSearch%2B...">version</a> for your distribution, otherwise you will not get the output you need. <br><br>  You should get something like this: <br><br><img src="https://habrastorage.org/files/18f/060/8de/18f0608de3f94ae9964c05e652652337.png" alt="image"><br><br>  <b>See also:</b> <br><br><ul><li>  <a href="http://dag.wiee.rs/home-made/dstat/">Dstat: Versatile resource statistics tool</a> </li><li>  <a href="https://www.opennet.ru/docs/RUS/bash_scripting_guide/index.html">Advanced Bash-Scripting Guide</a> </li><li>  <a href="https://access.redhat.com/documentation/ru-RU/Red_Hat_Enterprise_Linux/6/pdf/Performance_Tuning_Guide/Red_Hat_Enterprise_Linux-6-Performance_Tuning_Guide-ru-RU.pdf">Red Hat Enterprise Linux 6 Performance Optimization</a> </li><li>  <a href="https://www.youtube.com/watch%3Fv%3DtuTPtD9i_Lc">Troubleshooting - Sergey Elantsev</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/274633/">https://habr.com/ru/post/274633/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../274619/index.html">Some sugar in combinatorics</a></li>
<li><a href="../274621/index.html">Tools for hacking, flashed in the TV series Mr Robot</a></li>
<li><a href="../274625/index.html">Creating game levels: tips and tricks (part 2)</a></li>
<li><a href="../274629/index.html">The first build of Vivaldi 1.0.365.3 in the coming year</a></li>
<li><a href="../274631/index.html">Pagekit: Symfony Modular CMS Review</a></li>
<li><a href="../274635/index.html">Use android.os.Binder to organize asynchronous interaction in Android</a></li>
<li><a href="../274637/index.html">Ember.js - goodbye MVC (part 1)</a></li>
<li><a href="../274639/index.html">Software Internet gateway for a small company (Shorewall, OpenVPN, OSPF). Part 1</a></li>
<li><a href="../274641/index.html">Yandex.Meteum - a new development or marketing ploy?</a></li>
<li><a href="../274645/index.html">"Other" logic and reversible calculations</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>