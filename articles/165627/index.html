<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Speed ‚Äã‚Äãup Ruby on Rails launch using the RVM railsexpress patch set</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is for those who want to speed up the launch of the rail, and at the same time speed up the work of the ruby ‚Äã‚Äãinterpreter. 
 There are a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Speed ‚Äã‚Äãup Ruby on Rails launch using the RVM railsexpress patch set</h1><div class="post__text post__text-html js-mediator-article">  This article is for those who want to speed up the launch of the rail, and at the same time speed up the work of the ruby ‚Äã‚Äãinterpreter. <br>  There are a lot of articles already written about how to install RVM (Ruby version manager), so I‚Äôll go straight to the point. <br>  List of patches in RailsExpress for Ruby 1.9.3-p362 <br>  (This is the latest version of Ruby at the time of this writing) <br><pre><code class="bash hljs">Applying patch railsexpress/01-fix-make-clean.patch Applying patch railsexpress/02-railsbench-gc.patch Applying patch railsexpress/03-display-more-detailed-stack-trace.patch Applying patch railsexpress/04-fork-support-for-gc-logging.patch Applying patch railsexpress/05-track-live-dataset-size.patch Applying patch railsexpress/06-webrick_204_304_keep_alive_fix.patch Applying patch railsexpress/07-export<span class="hljs-_"><span class="hljs-_">-a</span></span>-few-more-symbols-for-ruby-prof.patch Applying patch railsexpress/08-thread-variables.patch Applying patch railsexpress/09-faster-loading.patch Applying patch railsexpress/10-falcon-st-opt.patch Applying patch railsexpress/11-falcon-sparse-array.patch Applying patch railsexpress/12-falcon-array-queue.patch</code> </pre> <br><a name="habracut"></a><br><h5>  1. We specify RVM with what parameters it is necessary to compile Ruby </h5><br>  To do this, create a .rvmrc file in your home directory. <br><pre> <code class="bash hljs">$ nano -e <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.rvmrc</code> </pre><br>  And explicitly tell RVM with which options to compile Ruby. <br><pre> <code class="bash hljs">CFLAGS=<span class="hljs-string"><span class="hljs-string">"-march=native -O2 -pipe -fomit-frame-pointer"</span></span> rvm_configure_env=(CFLAGS=<span class="hljs-string"><span class="hljs-string">"-march=native -O2 -pipe -fomit-frame-pointer"</span></span>)</code> </pre><br>  Here, the <i>-march = native</i> parameter <i>instructs the</i> compiler to automatically select the type of processor and the capabilities supported by this processor.  If you know the exact type of your processor, you can specify, for example, <i>-march = prescott</i> <br><br>  Save changes: [ctrl + X], then [Y] - to exit and save to nano. <br><br><h5>  2. Update the lists of available Ruby versions in RVM </h5><br><pre> <code class="bash hljs">$ rvm get head</code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  3. Install / reinstall ruby ‚Äã‚Äãusing railsexpress patches </h5><br>  for Ruby version 1.9.3-p362 <br><pre> <code class="bash hljs">$ rvm reinstall 1.9.3-p362 --patch railsexpress -n railsexpress -j 3 $ rvm list $ rvm use ruby-1.9.3-p362-railsexpress --default</code> </pre><br>  If you always need the latest version, then instead of <i>p362</i> you must specify the <i>head</i> , <br>  but for the latest version patches appear with a delay, it must be borne in mind. <br><br><h5>  4. Bonus </h5><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> RUBY_HEAP_MIN_SLOTS=1000000 <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> RUBY_HEAP_FREE_MIN=500000 <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> RUBY_HEAP_SLOTS_INCREMENT=1000000 <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> RUBY_HEAP_SLOTS_GROWTH_FACTOR=1 <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> RUBY_GC_MALLOC_LIMIT=100000000</code> </pre><br><br><h5>  5. We measure speed </h5><br>  The launch speed of the rail can be measured as follows: <br><pre> <code class="bash hljs">$ time bundle <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> rake routes</code> </pre><br>  In my case: <br>  before <br> <code>real 0m42.547s <br> user 0m36.502s <br> sys 0m2.248s <br></code> <br>  after <br> <code>real 0m17.200s <br> user 0m15.089s <br> sys 0m1.072s <br></code> <br><br>  Here you can read additional info on patches <a href="https://github.com/skaes/rvm-patchsets">https://github.com/skaes/rvm-patchsets</a> </div><p>Source: <a href="https://habr.com/ru/post/165627/">https://habr.com/ru/post/165627/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../165617/index.html">TextTest is a cross-platform python framework for GUI testing and more. Part 1</a></li>
<li><a href="../165619/index.html">EgisTec ES603 - a fingerprint scanner for 500 rubles or we introduce biometric authorization</a></li>
<li><a href="../165621/index.html">Reconstruction of the portrait of Van Gogh</a></li>
<li><a href="../165623/index.html">Service that helps to find ‚Äúrare‚Äù products on TaoBao (+ a bit of free Google Translate API)</a></li>
<li><a href="../165625/index.html">Application launch menu in KDE4 and Gnome2 on the Super key</a></li>
<li><a href="../165629/index.html">OOP-builder "massive" parameters</a></li>
<li><a href="../165631/index.html">AI, Pathfind, Pathfollow for characters in the three-dimensional dynamic world (Part 1)</a></li>
<li><a href="../165635/index.html">Why the new album of Bob Dylan came out with a circulation of 100 copies</a></li>
<li><a href="../165637/index.html">MIT has developed a synthetic "muscle" that works on water</a></li>
<li><a href="../165639/index.html">Tyunim keyboard correctly</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>