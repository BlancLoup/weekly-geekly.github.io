<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Petri net with symfony a la WorkFlow component</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Let's present some project on GitHub where we want to issue Pull Request. Here we will be interested only in the huge life cycle of our pull request, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Petri net with symfony a la WorkFlow component</h1><div class="post__text post__text-html js-mediator-article">  Let's present some project on GitHub where we want to issue Pull Request.  Here we will be interested only in the huge life cycle of our pull request, which it can actually go from the moment of birth to the very moment of its acceptance and merge into the main project code. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d5e/31d/7ae/d5e31d7ae428fc3d22a2d02226d8ad06.png" alt="image"><br><br>  So, if we argue, then the pull request can have the following variations on the states, which I have specially complicated, if you don‚Äôt know about WorkFlow and look at the similar terms of reference: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>1.</b> Opened <br>  <b>2.</b> Is in check in Travis CI, and can get there after some corrections or any changes related to our Pull Request were made, because you need to check everything, isn't it? <br>  <b>3.</b> Waiting for Review only after the check was done in Travis CI <br>  <b>3.1.</b>  Requires code updates after checking in Travis CI <br>  <b>4.</b> Requires change after Review <br>  <b>5.</b> Adopted after Review <br>  <b>6.</b> Smezhen after Review <br>  <b>7.</b> Declined after Review <br>  <b>8.</b> Closed after rejected after Review. <br>  <b>9.</b> Reopened after it was closed, after it was rejected, after the Review was conducted. <br>  <b>10.</b> Changes after the ‚ÄúRequire Changes‚Äù was labeled, after the Review was conducted, then after that it should again go to Travis CI (item 2), and from the Review again only those conditions that we described above <br><a name="habracut"></a><br>  Tin, right? <br><br>  The fact that in the squares - we will call transactions, in the meantime, all that is in the circles - these are the very states we are talking about.  A transaction is the ability to transition from a certain state (or several states at once) to another state. <br>  This is where the WorkFlow component comes into play, which will help us manage the states of objects inside our system.  The meaning is that the states themselves are set by the developer, thereby ensuring that this object will always be valid from the point of view of the business logic of our application. <br><br>  If it is in human language, then a pull request can never be confused if it has not passed the MANDATORY path that we have specified up to a certain point (from checking in Tragedy and Review to its adoption and the merge itself). <br><br>  So, let's create the PullRequest entity and set its transition rules from one state to another. <br><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">ORM</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Table(name="pull_request") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Entity(repositoryClass="AppBundle\Repository\PullRequestRepository") */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PullRequest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column(name="id", type="integer") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Id * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\GeneratedValue(strategy="AUTO") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $id; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column(type="string") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $currentPlace; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> int */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;id; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> PullRequest */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCurrentPlace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($currentPlace)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;currentPlace = $currentPlace; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCurrentPlace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;currentPlace; } }</code> </pre> <br>  This is how it will look like when you know what WorkFlow is: <br><br><pre> <code class="hljs vhdl"># app/config/config.yml framework: workflows: pull_request: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">'state_machine</span></span>' marking_store: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">'single_state</span></span>' argument: <span class="hljs-symbol"><span class="hljs-symbol">'currentPlace</span></span>' supports: - AppBundle\<span class="hljs-keyword"><span class="hljs-keyword">Entity</span></span>\PullRequest places: - start - coding - travis - review - merged - closed transitions: submit: from: start <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>: travis update: from: [coding, travis, review] <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>: travis wait_for_review: from: travis <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>: review request_change: from: review <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>: coding accept: from: review <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>: merged <span class="hljs-keyword"><span class="hljs-keyword">reject</span></span>: from: review <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>: closed reopen: from: closed <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>: review</code> </pre><br>  As in the picture, we set certain states in which our entity can actually arrive (framework.workflow.pull_request.places): start, coding, travis, review, merged, closed and transactions (framework.workflow.pull_request.transactions ) with a description of the condition under which the object can fall into this state: submit, update, wait_for_review, request_change, accept, reject, reopen. <br><br>  And now back in life: <br><br>  Submit is a transition from the initial state to the change validation state in the Travis CI. <br><br>  <i>This is our very first action, here we make our pull request and after that Travis CI starts checking our code for validity.</i> <br><br>  Update - transition from coding state (code writing state), travis (Travis CI check status), review (Code review status) to Travis check status. <br>  <i>This is the action that tells the system that it is necessary to recheck everything again after any changes in our pull request, i.e., that it is preparing to submit to the master.</i> <br><br>  Wait For Review - transaction of transition from the state of Travis to the state of Review. <br>  <i>I mean the action, when we launched our pull request and it was already checked by Travis, now it's time for the project programmers to take a look at our code - make it a review and decide what to do with it next.</i> <br><br>  Request_Change is a state transition transaction from Review to Coding. <br>  <i>Those.</i>  <i>that moment when (for example) the project team did not like the way we solved the task and they want to see a different solution and we make some changes in the form of corrections again.</i> <br><br>  Accept is a state transition from Review to Merged, an endpoint that does not have any possible transactions after it. <br>  <i>The moment when project programmers like our solution and they merge it into the project.</i> <br><br>  Reject - a state transition transaction from Review to Closed. <br><br>  <i>The moment when programmers did not consider it necessary to accept our pull request for any reason.</i> <br><br>  Reopen - the transition from the Closed state to the Review state. <br><br>  <i>For example, when the project team of programmers revised our pull request and decided to revise it.</i> <br><br>  Now let's finally write at least some code: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>\<span class="hljs-title"><span class="hljs-title">PullRequest</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Workflow</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>\<span class="hljs-title"><span class="hljs-title">LogicException</span></span>; $pullRequest = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PullRequest(); <span class="hljs-comment"><span class="hljs-comment">//    $stateMachine = $this-&gt;getContainer()-&gt;get('state_machine.pull_request'); $stateMachine-&gt;can($pullRequest, 'submit'); //true $stateMachine-&gt;can($pullRequest, 'accept'); //false try { //    start   travis $stateMachine-&gt;apply($pullRequest, 'submit'); } catch(LogicException $workflowException) {} $stateMachine-&gt;can($pullRequest, 'update'); //true $stateMachine-&gt;can($pullRequest, 'wait_for_review'); //true $stateMachine-&gt;can($pullRequest, 'accept'); //false try { //    update   review $stateMachine-&gt;apply($pullRequest, 'wait_for_review'); } catch(LogicException $workflowException) {} $stateMachine-&gt;can($pullRequest, 'request_change'); //true $stateMachine-&gt;can($pullRequest, 'accept'); //true $stateMachine-&gt;can($pullRequest, 'reject'); //true $stateMachine-&gt;can($pullRequest, 'reopen'); //false try { //    update   review $stateMachine-&gt;apply($pullRequest, 'reject'); } catch(LogicException $workflowException) {} $stateMachine-&gt;can($pullRequest, 'request_change'); //false $stateMachine-&gt;can($pullRequest, 'accept'); //false $stateMachine-&gt;can($pullRequest, 'reject'); //false $stateMachine-&gt;can($pullRequest, 'reopen'); //true -    pull request echo $pullRequest-&gt;getCurrentPlace(); //closed try { //   -        $stateMachine-&gt;apply($pullRequest, 'reject'); } catch(LogicException $workflowException) { echo '   !!! :('; } $stateMachine-&gt;apply($pullRequest, 'reopen'); echo $pullRequest-&gt;getCurrentPlace(); //review</span></span></code> </pre><br>  At the same time, if we abstract, it sometimes happens that the object itself can have several states at the same time.  In addition to the state_machine, we can prescribe the type of workflow to our object, which allows us to simultaneously have several statuses for one object.  An example of life can serve as your first publication on Habr√©, which can simultaneously have statuses, for example: "I need a plagiarism check", "I need a quality check" and which can become "Published" status only after all these checks passed, well, of course, provided that all these processes are not automated, but we are not talking about that now. <br><br>  For example, create a new Article entity in our system. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">ORM</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Table(name="article") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Entity(repositoryClass="AppBundle\Repository\ArticleRepository") */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Article</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column(name="id", type="integer") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Id * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\GeneratedValue(strategy="AUTO") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $id; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column(type="simple_array") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $currentPlaces; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;id; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCurrentPlaces</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($currentPlaces)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;currentPlaces = $currentPlaces; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCurrentPlaces</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;currentPlaces; } }</code> </pre><br>  Now let's create a WorkFlow configuration for it: <br><br><pre> <code class="hljs delphi">article: supports: - AppBundle\Entity\Article <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-string"><span class="hljs-string">'workflow'</span></span> marking_store: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-string"><span class="hljs-string">'multiple_state'</span></span> argument: <span class="hljs-string"><span class="hljs-string">'currentPlaces'</span></span> places: - draft - wait_for_journalist - approved_by_journalist - wait_for_spellchecker - approved_by_spellchecker - <span class="hljs-keyword"><span class="hljs-keyword">published</span></span> transitions: request_review: from: draft <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>: - wait_for_journalist - wait_for_spellchecker journalist_approval: from: wait_for_journalist <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>: approved_by_journalist spellchecker_approval: from: wait_for_spellchecker <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>: approved_by_spellchecker publish: from: - approved_by_journalist - approved_by_spellchecker <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">published</span></span></code> </pre><br>  Let's see how our code looks like: <br><br><pre> <code class="php hljs">$article = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Article(); $workflow = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getContainer()-&gt;get(<span class="hljs-string"><span class="hljs-string">'workflow.article'</span></span>); $workflow-&gt;apply($article, <span class="hljs-string"><span class="hljs-string">'request_review'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* array(2) { ["wait_for_journalist"]=&gt; int(1) ["wait_for_spellchecker"]=&gt; int(1) } */</span></span> var_dump($article-&gt;getCurrentPlaces()); <span class="hljs-comment"><span class="hljs-comment">//,   ! $workflow-&gt;apply($article, 'journalist_approval'); /* array(2) { ["wait_for_spellchecker"]=&gt; int(1) ["approved_by_journalist"]=&gt; int(1) } */ var_dump($article-&gt;getCurrentPlaces()); var_dump($workflow-&gt;can($article, 'publish')); //false,         $workflow-&gt;apply($article, 'spellchecker_approval'); var_dump($workflow-&gt;can($article, 'publish')); //true,   </span></span></code> </pre><br>  You can also visualize what you have just done without any problems, for this we will use <a href="http://www.graphviz.org/">www.graphviz.org</a> - graph visualization software, which, at the entrance, takes data of the form: <br><br><pre> <code class="hljs rust">digraph workflow { ratio=<span class="hljs-string"><span class="hljs-string">"compress"</span></span> rankdir=<span class="hljs-string"><span class="hljs-string">"LR"</span></span> node [fontsize=<span class="hljs-string"><span class="hljs-string">"9"</span></span> fontname=<span class="hljs-string"><span class="hljs-string">"Arial"</span></span> color=<span class="hljs-string"><span class="hljs-string">"#333333"</span></span> fillcolor=<span class="hljs-string"><span class="hljs-string">"lightblue"</span></span> fixedsize=<span class="hljs-string"><span class="hljs-string">"1"</span></span> width=<span class="hljs-string"><span class="hljs-string">"1"</span></span>]; edge [fontsize=<span class="hljs-string"><span class="hljs-string">"9"</span></span> fontname=<span class="hljs-string"><span class="hljs-string">"Arial"</span></span> color=<span class="hljs-string"><span class="hljs-string">"#333333"</span></span> arrowhead=<span class="hljs-string"><span class="hljs-string">"normal"</span></span> arrowsize=<span class="hljs-string"><span class="hljs-string">"0.5"</span></span>]; place_start [label=<span class="hljs-string"><span class="hljs-string">"start"</span></span>, shape=circle, style=<span class="hljs-string"><span class="hljs-string">"filled"</span></span>]; place_coding [label=<span class="hljs-string"><span class="hljs-string">"coding"</span></span>, shape=circle]; place_travis [label=<span class="hljs-string"><span class="hljs-string">"travis"</span></span>, shape=circle]; place_review [label=<span class="hljs-string"><span class="hljs-string">"review"</span></span>, shape=circle]; place_merged [label=<span class="hljs-string"><span class="hljs-string">"merged"</span></span>, shape=circle]; place_closed [label=<span class="hljs-string"><span class="hljs-string">"closed"</span></span>, shape=circle]; transition_submit [label=<span class="hljs-string"><span class="hljs-string">"submit"</span></span>, shape=<span class="hljs-keyword"><span class="hljs-keyword">box</span></span>, shape=<span class="hljs-string"><span class="hljs-string">"box"</span></span>, regular=<span class="hljs-string"><span class="hljs-string">"1"</span></span>]; transition_update [label=<span class="hljs-string"><span class="hljs-string">"update"</span></span>, shape=<span class="hljs-keyword"><span class="hljs-keyword">box</span></span>, shape=<span class="hljs-string"><span class="hljs-string">"box"</span></span>, regular=<span class="hljs-string"><span class="hljs-string">"1"</span></span>]; transition_update [label=<span class="hljs-string"><span class="hljs-string">"update"</span></span>, shape=<span class="hljs-keyword"><span class="hljs-keyword">box</span></span>, shape=<span class="hljs-string"><span class="hljs-string">"box"</span></span>, regular=<span class="hljs-string"><span class="hljs-string">"1"</span></span>]; transition_update [label=<span class="hljs-string"><span class="hljs-string">"update"</span></span>, shape=<span class="hljs-keyword"><span class="hljs-keyword">box</span></span>, shape=<span class="hljs-string"><span class="hljs-string">"box"</span></span>, regular=<span class="hljs-string"><span class="hljs-string">"1"</span></span>]; transition_wait_for_review [label=<span class="hljs-string"><span class="hljs-string">"wait_for_review"</span></span>, shape=<span class="hljs-keyword"><span class="hljs-keyword">box</span></span>, shape=<span class="hljs-string"><span class="hljs-string">"box"</span></span>, regular=<span class="hljs-string"><span class="hljs-string">"1"</span></span>]; transition_request_change [label=<span class="hljs-string"><span class="hljs-string">"request_change"</span></span>, shape=<span class="hljs-keyword"><span class="hljs-keyword">box</span></span>, shape=<span class="hljs-string"><span class="hljs-string">"box"</span></span>, regular=<span class="hljs-string"><span class="hljs-string">"1"</span></span>]; transition_accept [label=<span class="hljs-string"><span class="hljs-string">"accept"</span></span>, shape=<span class="hljs-keyword"><span class="hljs-keyword">box</span></span>, shape=<span class="hljs-string"><span class="hljs-string">"box"</span></span>, regular=<span class="hljs-string"><span class="hljs-string">"1"</span></span>]; transition_reject [label=<span class="hljs-string"><span class="hljs-string">"reject"</span></span>, shape=<span class="hljs-keyword"><span class="hljs-keyword">box</span></span>, shape=<span class="hljs-string"><span class="hljs-string">"box"</span></span>, regular=<span class="hljs-string"><span class="hljs-string">"1"</span></span>]; transition_reopen [label=<span class="hljs-string"><span class="hljs-string">"reopen"</span></span>, shape=<span class="hljs-keyword"><span class="hljs-keyword">box</span></span>, shape=<span class="hljs-string"><span class="hljs-string">"box"</span></span>, regular=<span class="hljs-string"><span class="hljs-string">"1"</span></span>]; place_start -&gt; transition_submit [style=<span class="hljs-string"><span class="hljs-string">"solid"</span></span>]; transition_submit -&gt; place_travis [style=<span class="hljs-string"><span class="hljs-string">"solid"</span></span>]; place_coding -&gt; transition_update [style=<span class="hljs-string"><span class="hljs-string">"solid"</span></span>]; transition_update -&gt; place_travis [style=<span class="hljs-string"><span class="hljs-string">"solid"</span></span>]; place_travis -&gt; transition_update [style=<span class="hljs-string"><span class="hljs-string">"solid"</span></span>]; transition_update -&gt; place_travis [style=<span class="hljs-string"><span class="hljs-string">"solid"</span></span>]; place_review -&gt; transition_update [style=<span class="hljs-string"><span class="hljs-string">"solid"</span></span>]; transition_update -&gt; place_travis [style=<span class="hljs-string"><span class="hljs-string">"solid"</span></span>]; place_travis -&gt; transition_wait_for_review [style=<span class="hljs-string"><span class="hljs-string">"solid"</span></span>]; transition_wait_for_review -&gt; place_review [style=<span class="hljs-string"><span class="hljs-string">"solid"</span></span>]; place_review -&gt; transition_request_change [style=<span class="hljs-string"><span class="hljs-string">"solid"</span></span>]; transition_request_change -&gt; place_coding [style=<span class="hljs-string"><span class="hljs-string">"solid"</span></span>]; place_review -&gt; transition_accept [style=<span class="hljs-string"><span class="hljs-string">"solid"</span></span>]; transition_accept -&gt; place_merged [style=<span class="hljs-string"><span class="hljs-string">"solid"</span></span>]; place_review -&gt; transition_reject [style=<span class="hljs-string"><span class="hljs-string">"solid"</span></span>]; transition_reject -&gt; place_closed [style=<span class="hljs-string"><span class="hljs-string">"solid"</span></span>]; place_closed -&gt; transition_reopen [style=<span class="hljs-string"><span class="hljs-string">"solid"</span></span>]; transition_reopen -&gt; place_review [style=<span class="hljs-string"><span class="hljs-string">"solid"</span></span>]; }</code> </pre><br>  You can convert our graph to this format as with PHP: <br><br><pre> <code class="hljs php">$dumper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Symfony\Component\Workflow\Dumper\GraphvizDumper(); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $dumper-&gt;dump($stateMachine-&gt;getDefinition());</code> </pre><br>  So with the help of the finished team <br><br><pre> <code class="hljs matlab"> php bin/console workflow:dump pull_request &gt; out.<span class="hljs-built_in"><span class="hljs-built_in">dot</span></span> <span class="hljs-built_in"><span class="hljs-built_in">dot</span></span> -Tpng out.<span class="hljs-built_in"><span class="hljs-built_in">dot</span></span> -o graph.png</code> </pre><br>  graph.png will look like this for PullRequest: <br><br><img src="https://habrastorage.org/files/413/9bb/1f0/4139bb1f0e5c4c5ab66ee153a97b1df4.png"><br>  and for Article: <br><br><img src="https://habrastorage.org/files/710/8bd/85d/7108bd85d85f47c98669d24c023fc6e7.png"><br>  Addition: <br><br>  Already with the release of 3.3 in stable we can use guard: <br><br><pre> <code class="hljs vhdl">framework: workflows: article: audit_trail: <span class="hljs-literal"><span class="hljs-literal">true</span></span> supports: - AppBundle\<span class="hljs-keyword"><span class="hljs-keyword">Entity</span></span>\Article places: - draft - wait_for_journalist - approved_by_journalist - wait_for_spellchecker - approved_by_spellchecker - published transitions: request_review: guard: <span class="hljs-string"><span class="hljs-string">"is_fully_authenticated()"</span></span> from: draft <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>: - wait_for_journalist - wait_for_spellchecker journalist_approval: guard: <span class="hljs-string"><span class="hljs-string">"is_granted('ROLE_JOURNALIST')"</span></span> from: wait_for_journalist <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>: approved_by_journalist spellchecker_approval: guard: <span class="hljs-string"><span class="hljs-string">"is_fully_authenticated() and has_role('ROLE_SPELLCHECKER')"</span></span> from: wait_for_spellchecker <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>: approved_by_spellchecker publish: guard: <span class="hljs-string"><span class="hljs-string">"is_fully_authenticated()"</span></span> from: - approved_by_journalist - approved_by_spellchecker <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>: published</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/325758/">https://habr.com/ru/post/325758/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325744/index.html">Rethinking markup. First steps with Gantry 5</a></li>
<li><a href="../325746/index.html">Repair remote server after removing part of OS</a></li>
<li><a href="../325748/index.html">Games and the cloud. Myths and reality. We expect a heated discussion on April 12. Come virtually</a></li>
<li><a href="../325752/index.html">A bug in Telegram VoIP, which allows you to find out the address of the interlocutor</a></li>
<li><a href="../325756/index.html">Evolution on React + Redux</a></li>
<li><a href="../325760/index.html">CSS Grid Layout. Fast start</a></li>
<li><a href="../325762/index.html">As in Dodo Pizza, we lost 8 million in one hour due to a technical error, and then returned</a></li>
<li><a href="../325764/index.html">Meta development tool: FutoIn CID</a></li>
<li><a href="../325770/index.html">Parametric modeling in CAD SolveSpace: Degrees of freedom and constraint equations</a></li>
<li><a href="../325772/index.html">Interfaces of the aggregator of tours: what we have done and where we need the help of Habr</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>