<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write HabraKvest on ASP.NET Core and Angular2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Every time with the release of the new framework, I want to try it in and write some application on it. The last time the quest format went perfectly....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write HabraKvest on ASP.NET Core and Angular2</h1><div class="post__text post__text-html js-mediator-article">  Every time with the release of the new framework, I want to try it in and write some application on it.  The <a href="https://habrahabr.ru/post/250009/">last time</a> the quest format went perfectly.  By this, I propose to see what has changed in almost a year and a half and write another quest - and we'll look at the frameworks, and you can play. <br>  Result: <br>  - <a href="https://github.com/gbdrm/HabraQuest">sorts on githaba</a> for those who are interested to look at the source <br>  - <a href="http://habraquest.azurewebsites.net/">link to the quest</a> for those who are interested in what happened or spend their time on another logical quest. <br><img src="https://habrastorage.org/files/b7f/325/497/b7f32549705e424db4e7f2f9d67cccb5.png"><br>  Under the cat described the complete process from creating a project to its deployment. <br><a name="habracut"></a><br><br><h3>  Prerequisites </h3><br>  Almost any IDE or text editor will work with ASP.NET Core and Angular2.  Of course, ASP.NET needs Visual Studio for full debugging, but with the release of the new Core version it is not necessary for development, you can work with the code in Sublime \ Atom \ ... and run the application (after installing the SDK) from the command line using: <br><pre><code class="bash hljs">dotnet run</code> </pre> <br>  Source code, installer, documentation for the .NET command line interface and the SDK can be found at: <br>  <a href="https://dotnet.github.io/">dotnet.github.io</a> <br>  Moreover, all this is now available not only on Windows but also on Max, Linux, as well as Docker. <br><br>  Probably many will experience cognitive dissonance after seeing <br><pre> <code class="bash hljs">sudo apt-get install dotnet-dev-1.0.0-preview2-003121</code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Create a project </h3><br>  There are several ways to create a new ASP.NET core application: <br>  1) Using <b>Visual Studio</b> <br>  2) From the console - <b>dotnet new</b> <br>  3) Using third-party <b>generators</b> . <br><br>  We will not go into all the problems of creating and configuring a project, especially since we need not an empty application, but already with Angular2 connected and, preferably, customized build scripts. <br>  ASP.NET Core <b>JavaScript Services</b> <a href="https://github.com/aspnet/JavaScriptServices/">github.com/aspnet/JavaScriptServices is</a> ideal for this, which allows you to create ASP.NET Core applications with a JavaScript framework to choose from: Angular 2, React, and Knockout. <br>  To do this, we need: ASP.NET Core, Node.js and the yeoman generator with the aspnet-spa template.  The latter can be installed using: <br><pre> <code class="bash hljs">npm install -g yo generator-aspnetcore-spa</code> </pre><br>  Now creating a new project comes down to <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> &lt;__&gt; yo aspnetcore-spa</code> </pre><br><img src="https://habrastorage.org/files/59f/924/2d4/59f9242d4f0c4a34bd2aa4f55ddb0422"><br><br>  We select <b>Angular2 a</b> template, the name of the project and the generator itself will create all structure, dependences, etc.  (this may take a few minutes). <br>  At first it may seem that this generator uses too many libraries, especially if you are not a fan of the latter or have worked very little with the front end.  But personally, my opinion is that this is one of the most balanced patterns.  I especially want to highlight the following properties: <br><br><h4>  TypeScript </h4><br>  Of course, developing applications on Angular2 is possible on simple JavaScript, TypeScript gives us the possibility of typing, autocompletion, more familiar (for most) syntax for OOP.  As well as the Angular2 team actively uses TypeScript and it seems that TypeScript will be (or already is) an unofficial default language for Angular2. <br><br><h4>  Webpack </h4><br>  It seems that the <b>webpack is</b> quickly becoming a favorite in the battle of front-end tools.  It is especially important to note its capabilities with constant code changes.  In fact, the developer can forget about constantly rebuilding the project and refreshing the page using Hot Module Replacement ( <b>HMR</b> ).  After we tried to write the front-end on one monitor, while on the second one he was changing before his eyes, he did not want to go back to tools without the possibility of hot-swapping. <br><br><h4>  Other bonuses </h4><br>  Server pre-render, lazy loading, convenient work with Development and Production builds. <br>  You can find out more in the blog of one of the JavaScriptServices developers: <br>  <a href="http://blog.stevensanderson.com/2016/05/02/angular2-react-knockout-apps-on-aspnet-core/">blog.stevensanderson.com/2016/05/02/angular2-react-knockout-apps-on-aspnet-core</a> <br>  or to see a real example in one of the last public stand-ups of the ASP.NET team: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/HAjUJOc7yW4%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhhSILD2UDjGYc1uy7MaAjqFzqc4g" frameborder="0" allowfullscreen=""></iframe><br><br><h3>  We collect the project </h3><br>  As mentioned earlier, to build and run a project, you can use the console command: <br><pre> <code class="bash hljs">dotnet run</code> </pre><br><br>  As a result, the site will be built and run locally: <br><img src="https://habrastorage.org/files/872/d38/b97/872d38b97f8345319ab5c96a64add017"><br><br>  Or, do the same from Visual Studio. <br>  If after the build you will be notified that not all npm modules are installed, <br><img src="https://habrastorage.org/files/656/4f5/b5e/6564f5b5ee574d7eb18ea78c2ef7b695"><br>  Most likely this is a problem because one of the modules is not supported in Windows, but since the dependency is not mandatory, the application should work fine. <br><br>  As a result, you should run a working application with three simple pages. <br><img src="https://habrastorage.org/files/e60/de7/dc5/e60de7dc51e34f8695939bb04b9aa974"><br><br><h3>  Getting Started </h3><br>  Consider the main differences in comparison with previous versions of frameworks. <br><br><h4>  Project structure </h4><br>  It looks like the JavaScriptServices project structure is webpack-oriented.  That is, it is npm + webpack, respectively, there are no gulp and bower.  As far as I understand, <b>bower</b> just decided not to add to the starting project, since there are not many dependencies on JavaScript libraries, npm handles everything.  And all the functions of <b>gulp</b> (or grunt) are now performed by the <b>webpack</b> . <br><br>  As for the file structure, the server files are the same as before, but there are some differences on the front-end.  For example, in the folder with static files wwwroot there is only a folder dist, where, in fact, all JavaScript is compiled. <br>  In comparison with the first version of Angular, it is striking that there are no views and controllers - all in the components and for each html part of the components there is a TypeScript part. <br><br><h4>  Features in progress </h4><br>  Webpack is of course very happy in terms of hot-swappable modules, the development of the front-end part is much nicer because of this. <br>  It should also be noted that WebPack errors are excellently shown already at the ASP.NET level, a very convenient integration.  However, after an erroneous state (for example, pulling up a non-existent component), the hot swap did not work for me, perhaps in such cases it is still necessary to refresh the page manually. <br><br>  It is also very convenient that you can TypeScript debug in the browser and all this is already built in by default. <br><img src="https://habrastorage.org/files/aa8/6c8/85b/aa86c885bfa241fd97cf0605727a8f8e"><br><br>  First of all, I redid the pages with examples for the ones I need.  It turned out to be very simple, despite the fact that my knowledge of Angular2 and TypeScript is close to zero.  In general, the syntax of the new Angular seems very readable, at least at first glance.  And the ability to describe interfaces, classes, and types in TypeScript makes it very understandable. <br>  An example of a simple component: <br><img src="https://habrastorage.org/files/0d7/107/46f/0d710746fe3d4107afe81cc8d08063c7"><br>  I think most developers who see TypeScript for the first time will immediately understand what is happening here. <br><br><h4>  Entity Framework and Database </h4><br>  If you are familiar with previous versions of the Entity Framework, there should be no problems with the Entity Framework Core.  As a last resort - you can view the documentation on <a href="https://docs.efproject.net/en/latest/intro.html">docs.efproject.net/en/latest/intro.html</a> <br><br>  First, we put nuget packages for EF itself, as well as for tools for working with the database (the version of the latter is not yet stable): <br><pre> <code class="bash hljs">Install-Package Microsoft.EntityFrameworkCore.SqlServer Install-Package Microsoft.EntityFrameworkCore.Tools ‚ÄìPre</code> </pre><br>  <a href="https://github.com/gbdrm/HabraQuest/commit/959f4cb6c253dad0cc5e6eb34756ee5cc9c920f9">github.com/gbdrm/HabraQuest/commit/959f4cb6c253dad0cc5e6eb34756ee5cc9c920f9</a> <br><br>  Next, add tool commands to <b>project.json</b> , to do this, open it, find the <b>tools</b> settings and add <br><pre> <code class="bash hljs"><span class="hljs-string"><span class="hljs-string">"Microsoft.EntityFrameworkCore.Tools"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0-preview2-final"</span></span>,</code> </pre><br>  Perhaps in your template tools will already be added.  Then nothing needs to be changed. <br><br>  We add classes of model of our application and DbContext and register them in <b>Startup.cs</b> . <br>  And of course <b>ConnectionString</b> in <b>appsettings.json</b> and also add code for configuration in <b>Startup.cs</b> . <br>  <a href="https://github.com/gbdrm/HabraQuest/commit/7411eb4262bdef9f5fb810f6cf7d5a239221c0b5">github.com/gbdrm/HabraQuest/commit/7411eb4262bdef9f5fb810f6cf7d5a239221c0b5</a> <br><br>  The next step, a typical story with migrations, we add the initial migration and ask the database to be updated. <br><pre> <code class="bash hljs">Add-Migration Initial Update-Database</code> </pre><br>  Since the base does not exist yet, it must be created after the second command.  This can be checked by looking at which databases exist if you join the SQL server using Visual or SQL Management Studio. <br>  <a href="https://github.com/gbdrm/HabraQuest/commit/09b42dc0a8e45da1f461b38c2b41d79c4fc0b88a">github.com/gbdrm/HabraQuest/commit/09b42dc0a8e45da1f461b38c2b41d79c4fc0b88a</a> <br><br>  Let's add a simple method to the Home controller and try to use the connection to the database as little as possible.  Add a method to create a new player, which will return his token. <br>  <a href="https://github.com/gbdrm/HabraQuest/commit/e67a322184517aa929d1347f6fd638c6290bf9d3">github.com/gbdrm/HabraQuest/commit/e67a322184517aa929d1347f6fd638c6290bf9d3</a> <br><br>  If we now run the application, we can test this method by adding <b>/ home / registernewplayer</b> to the end of the address.  As a result, we must get our player's token. <br><img src="https://habrastorage.org/files/c4b/d93/335/c4bd9333569143d19b5bb5a3115f3477"><br><br><h4>  First steps in Angular 2 </h4><br>  Since we have already created a primitive back-end, we can try to use it on the client.  Let's try the following: <br>  when a new user visits a page, check if he has a cookie with a token and, if not, ask him from the server.  In order not to create your own bike, try using the existing library to work with cookies.  For example, <b>ng2-cookies</b> . <br>  To do this, we need to install it and connect it to the home component. <br>  <a href="https://github.com/gbdrm/HabraQuest/commit/8c7aadd9607a0c4d0a1039707b08b0c4b720112c">github.com/gbdrm/HabraQuest/commit/8c7aadd9607a0c4d0a1039707b08b0c4b720112c</a> <br><br>  It‚Äôs hard to describe my next few hours of persistent struggle with the stereotypes of JavaScript and the first Angular.  It turned out that in the second version of the framework everything is completely different.  I can only say that it ended up with the fact that I decided not to use services (I decided to better deal with rxjs observable, which is actively used in Angular 2), updated the packages before the next release of the candidate (fourth), added new forms (it turned out that they were heavily reworked and this process is not yet complete) and decided to maximize the code (most of the logic in one component).  First you need to do something working, and then we will think about good practices.  Also added a few stubs on the server side. <br>  <a href="https://github.com/gbdrm/HabraQuest/commit/60c8239a89cae2357d0521973e091781027186ba">github.com/gbdrm/HabraQuest/commit/60c8239a89cae2357d0521973e091781027186ba</a> <br><br>  Of the interesting features - whether the studio or the resharper can pull up the correct imports for TypeScript, as well as in most cases the standard navigation by methods works.  Because of this kind of features, writing code for the client side becomes much more pleasant, there is no more feeling that you are writing some kind of script that can fall anywhere.  Instead, the basic elements of the syntax are checked automatically and there is confidence that everything will not break somewhere in the middle.  And even if it breaks, one more check will be performed at the webpack level and as a result an error will be shown on the page, even without restarting. <br><img src="https://habrastorage.org/files/35f/4a3/60b/35f4a360bfd74ad0b0561bffbd00bcee"><br><br>  However, sometimes, it starts to strain, when after each save the file - the page starts to redraw.  But I think this is a matter of habit. <br><br>  All the following code is not very important.  Basically, this is the implementation of muffled moments.  If you are still interested to view - source code is available at <a href="https://github.com/gbdrm/HabraQuest">github.com/gbdrm/HabraQuest</a> <br><br><h4>  Deployment </h4><br>  Since the back-end is written on .Net then we will deploy our application to Azure.  By the way, over the past year and a half there are also plenty of changes here, the first time you can‚Äôt figure it out and where.  For our application, it will be enough for us to create the most basic site with a database (Web App + SQL). <br>  Deployments, as always, are not very smooth.  First, it does not pass without errors.  The site itself works, but as a result, Visual Studio shows errors in some external TypeScript modules.  So far I have not figured out what it is.  Secondly, it happens that when opening the site, the error ‚ÄúTaskCanceledException: A task was canceled‚Äù crashes.  With this, too, is not yet completely clear, but it seems the problem is somewhere at the hosting level.  And besides this, I played a little with migrations. <br><br>  Although, in general, I was pleased with this step.  Very detailed and understandable log, everything can be configured (base, migration).  The first time, however, you need to wait some time (a few minutes) until everything is built, copied.  And in general, it seems that the process is quite complicated, as far as I understood, everything is copied locally first, and then transferred to Azure, but these are details. <br><br><h4>  Result, conclusions </h4><br>  Everything turned out as planned.  Personally, I am satisfied with new frameworks, I would be happy to switch to them.  Of course, there are still not very stable moments, Angular 2 is also not officially released at all.  But everything looks quite interesting and, most importantly, it works. <br>  I am very pleased with the development of tools and approaches in development that allow you to do fewer routine tasks, such as updating the page, controlling the structure of the database. <br>  Also, there are a lot of blogs, questions, documentation in the network, so with the solution of typical problems everything should be easy. <br><br>  All results can be found at: <br>  <a href="https://github.com/gbdrm/HabraQuest">github.com/gbdrm/HabraQuest</a> <br>  <a href="http://habraquest.azurewebsites.net/">habraquest.azurewebsites.net</a> <br><br>  It turned out pretty messy, as many different topics.  Which of them are the most interesting for you to describe in the future? </div><p>Source: <a href="https://habr.com/ru/post/306292/">https://habr.com/ru/post/306292/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../306280/index.html">Oracle, bypassing mutable tables</a></li>
<li><a href="../306282/index.html">View video "side"</a></li>
<li><a href="../306286/index.html">Corporate culture: How are employees of western (and not only) IT companies living?</a></li>
<li><a href="../306288/index.html">3CX Phone System v15 System Development Plans</a></li>
<li><a href="../306290/index.html">Bitcoin business in Panama (interview)</a></li>
<li><a href="../306294/index.html">Trolleybus from a loaf or alias analysis in LLVM</a></li>
<li><a href="../306296/index.html">The digest of interesting materials for Mobile Developer # 163 (July 18-24)</a></li>
<li><a href="../306298/index.html">Telegram writes in the syslog messages inserted from the clipboard, including in secret chats</a></li>
<li><a href="../306300/index.html">Simple sweet apps with Kivy</a></li>
<li><a href="../306304/index.html">Reflective Metaprogramming on Go: loop for each by means of the reflect package</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>