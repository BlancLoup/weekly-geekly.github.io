<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tips & tricks for MySQL Developers. Work with SQL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article was conceived by me as a collection of some interesting points on the use and optimization of SQL queries in the MySQL database, in my op...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tips & tricks for MySQL Developers. Work with SQL</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/storage3/48f/cc1/3fb/48fcc13fbf3467f88c1a443eb7f56963.png"><br>  This article was conceived by me as a collection of some interesting points on the use and optimization of SQL queries in the MySQL database, in my opinion, poorly lit on the Internet.  So, from the article you will learn about the with rollup construction, and how to rewrite the in and not in subqueries on joines, as well as update and delete data in several tables - with one query, and much more.  Let's start in order. <br><a name="habracut"></a><br><br><h4>  We rewrite subqueries with in and not in to join </h4><br>  One of the most common subqueries are queries with in and not in.  Moreover, we know that in MySQL join queries most often work faster due to the effective construction of a query execution plan by the optimizer (under certain conditions, as well as for other databases, this statement can be diametrically opposite), so we will try to rewrite the classic join subqueries.  How are we going to do this?  To begin with, let's clarify that in inquiries output all values ‚Äã‚Äãthat are present in both tables, which means that the inner inner join will definitely correspond to such a query.  Queries from not in on the contrary output all values ‚Äã‚Äãthat are not present in the subquery, which means that they will already correspond to an outer outer join.  So, a start, try to do something about it. <br><br>  For example, I will use the world test database, which can be taken from the official mysql website <a href="http://dev.mysql.com/doc/index-other.html">here.</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the world database there are tables Country (countries) and CountryLanguage (official languages).  We set ourselves the task of finding all the countries in which they speak at least one language.  In other words, we are looking for territories with a population that has official languages.  We write the usual in subquery: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Country <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> Code <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> CountryCode <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> CountryLanguage)</code> </pre> <br><br>  Note that this query can be rewritten as follows: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Country c <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> CountryLanguage cl <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> c.Code = cl.CountryCode )</code> </pre><br><br>  Now, based on the assumption above, we rewrite the subquery to an inner join: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> c.Name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Country c <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> CountryLanguage cl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.Code = cl.CountryCode +<span class="hljs-comment"><span class="hljs-comment">-------------+ | Name | +-------------+ | Aruba | | Aruba | | Aruba | | Aruba | | Afghanistan | +-------------+ 5 rows in set (0.00 sec)</span></span></code> </pre><br><br>  Almost succeeded, but we had duplication of data, which we remove through the distinct option.  The final version for all fields of the table would be: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> c.* <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Country c <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> CountryLanguage cl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.Code = cl.CountryCode</code> </pre><br><br>  Fine!  Sub query in successfully rewritten on join. <br><br>  Now it's a little more difficult - rewrite not in to the outer join.  The purpose of the request is all territories where people do not live and there are no official languages.  Again, first I quote the standard not in subquery: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Country <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> Code <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> CountryCode <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> CountryLanguage)</code> </pre><br><br>  And I show it for not exists: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Country c <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> CountryLanguage cl <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> c.Code = cl.CountryCode )</code> </pre><br><br>  As in the first case, we rewrite it to the left join: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> c.* <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Country c <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> CountryLanguage cl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.Code = cl.CountryCode</code> </pre><br><br>  As a result, we obtain, as in the first case, duplication of data, and, of course, the rows that did not find a pair value in the second table.  It is these lines that give the solution to the problem, so we simply remove all the paired lines: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> c.* <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Country c <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> CountryLanguage cl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.Code = cl.CountryCode <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> cl.CountryCode <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span></code> </pre><br><br>  With such simple conversions, we were able to help the query optimizer a little. <br><br><h4>  Comparing rows in subqueries </h4><br>  There are rare cases when we need to write a subquery, in which the comparison takes place not in one but several columns, but it would be clearly WRONG to write this: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> c.Name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> City c <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> c.ID = (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> Capital <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Country <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>=<span class="hljs-string"><span class="hljs-string">'Finland'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> c.CountryCode = (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> Code <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Country <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>=<span class="hljs-string"><span class="hljs-string">'Finland'</span></span>)</code> </pre><br><br>  For these purposes, there is a SQL query: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> c.Name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> City c <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> (c.ID, c.CountryCode) = (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> Capital, Code <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Country <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>=<span class="hljs-string"><span class="hljs-string">'Finland'</span></span>)</code> </pre><br><br>  Such a query is called a string constructor and can be underlined by the ROW () function.  In this case, we would write: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> c.Name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> City c <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROW</span></span>(c.ID, c.CountryCode) = (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> Capital, Code <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Country <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>=<span class="hljs-string"><span class="hljs-string">'Finland'</span></span>)</code> </pre><br><br>  Despite its appeal, string constructor has several limitations: <br>  1. The subquery should return one row, not several <br>  2. You cannot use the comparison operators &lt;,&gt; or &lt;&gt;, although this restriction can be circumvented with the special words all, any, in or exists <br><br>  It should be noted that such a construction can be used not only for subqueries, but also in scalar expressions: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>, Population <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Country <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> (Continent, Region) = (<span class="hljs-string"><span class="hljs-string">'Europe'</span></span>, <span class="hljs-string"><span class="hljs-string">'Western Europe'</span></span>)</code> </pre><br><br>  However, in practice, the query designer is not very effective for scalar expressions, so we rewrite the query to the normal form: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>, Population <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Country <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> Continent = <span class="hljs-string"><span class="hljs-string">'Europe'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> Region = <span class="hljs-string"><span class="hljs-string">'Western Europe'</span></span></code> </pre><br><br><h4>  Update and delete data from multiple tables simultaneously. </h4><br>  Perhaps someone will surprise such a headline, but why not?  Let's start by updating the data.  Official documentation talks about the following syntax: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">LOW_PRIORITY</span></span>] [<span class="hljs-keyword"><span class="hljs-keyword">IGNORE</span></span>] table_references <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> col_name1={expr1|<span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span>} [, col_name2={expr2|<span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span>}] ... [<span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> where_condition]</code> </pre><br><br>  Most likely, you will make a query of the form: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> t1, t2 <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> t1.name1 = t2.name2 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> t1.id = t2.id;</code> </pre><br><br>  On the other hand, no one bothers to make a query that will update the data in two, three or more tables at once: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> t1, t2 <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> t1.name1 = <span class="hljs-string"><span class="hljs-string">'name1'</span></span>, t2.name2 = <span class="hljs-string"><span class="hljs-string">'name2'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> t1.id = t2.id;</code> </pre><br><br>  True, it is unlikely to make sense, but, nevertheless, this is possible. <br><br>  With the delete operation, things are even more interesting.  Official documentation declares the following syntax: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">LOW_PRIORITY</span></span>] [<span class="hljs-keyword"><span class="hljs-keyword">QUICK</span></span>] [<span class="hljs-keyword"><span class="hljs-keyword">IGNORE</span></span>] tbl_name[.*] [, tbl_name[.*]] ... <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> table_references [<span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> where_condition]</code> </pre><br><br>  Or <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">LOW_PRIORITY</span></span>] [<span class="hljs-keyword"><span class="hljs-keyword">QUICK</span></span>] [<span class="hljs-keyword"><span class="hljs-keyword">IGNORE</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> tbl_name[.*] [, tbl_name[.*]] ... <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> table_references [<span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> where_condition]</code> </pre><br><br>  What corresponds to requests of the form: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> t1 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t1, t2 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> t1.id = t2.id; <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t1 <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> t1, t2 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> t1.id = t2.id;</code> </pre><br><br>  In these two queries, the deletion occurs from the t1 table, and t2 is used to create the data selection condition. <br><br>  And you guessed it, to delete data from two tables at the same time, do this: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> t1, t2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t1, t2 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> t1.id = t2.id; <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t1, t2 <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> t1, t2 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> t1.id = t2.id;</code> </pre><br><br><h4>  A little about OLAP.  WITH ROLLUP modifier </h4><br>  Perhaps those who have come across such industrial databases as Oracle or SQL Server will scream when reading the header: ‚ÄúWell, I must!‚Äù, But, alas, I will immediately cool their fiery exclamations.  Since MySQL version 4.1.1, when the with rollup modifier appeared, this topic has not advanced a millimeter, so you cannot build any data cubes using the built-in tools of this database. <br><br>  For those who do not know what the with rollup modifier means, I‚Äôll briefly explain that it is used to create reports containing subtotals and a final final value.  In the examples, I will use the world database again. <br><br>  Suppose that we need to get the total and average number of people living in all geographic areas (regions), as well as on continents and around the world.  If you decide to head on, we get the following queries: <br><br>  The total and average number of people living in all geographic areas (regions): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> Continent, Region, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(Population) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> pop, <span class="hljs-keyword"><span class="hljs-keyword">AVG</span></span>(Population) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> avg_pop <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Country <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> Continent, Region</code> </pre><br><br>  Total and average number of people living on all continents: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> Continent, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(Population) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> pop, <span class="hljs-keyword"><span class="hljs-keyword">AVG</span></span>(Population) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> avg_pop <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Country <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> Continent</code> </pre><br><br>  The total and average number of people living around the world: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(Population) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> pop, <span class="hljs-keyword"><span class="hljs-keyword">AVG</span></span>(Population) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> avg_pop <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Country</code> </pre><br><br>  Instead of executing these queries and the subsequent complex merging of results, you can do just one: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> Continent, Region, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(Population) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> pop, <span class="hljs-keyword"><span class="hljs-keyword">AVG</span></span>(Population) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> avg_pop <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Country <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> Continent, Region <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROLLUP</span></span>; +<span class="hljs-comment"><span class="hljs-comment">---------------+---------------------------+------------+----------------+ | Continent | Region | pop | avg_pop | +---------------+---------------------------+------------+----------------+ | Asia | Eastern Asia | 1507328000 | 188416000.0000 | | Asia | Middle East | 188380700 | 10465594.4444 | | Asia | Southeast Asia | 518541000 | 47140090.9091 | | Asia | Southern and Central Asia | 1490776000 | 106484000.0000 | | Asia | NULL | 3705025700 | 72647562.7451 | | Europe | Baltic Countries | 7561900 | 2520633.3333 | | Europe | British Islands | 63398500 | 31699250.0000 | ... | Europe | Eastern Europe | 307026000 | 30702600.0000 | | Europe | Nordic Countries | 24166400 | 3452342.8571 | | Europe | Southern Europe | 144674200 | 9644946.6667 | ... | Europe | Western Europe | 183247600 | 20360844.4444 | | Europe | NULL | 730074600 | 15871186.9565 | | North America | Caribbean | 38140000 | 1589166.6667 | | North America | Central America | 135221000 | 16902625.0000 | | North America | North America | 309632000 | 61926400.0000 | | North America | NULL | 482993000 | 13053864.8649 | | Africa | Central Africa | 95652000 | 10628000.0000 | ... | Africa | Eastern Africa | 246999000 | 12349950.0000 | | Africa | Northern Africa | 173266000 | 24752285.7143 | | Africa | Southern Africa | 46886000 | 9377200.0000 | ... | Africa | Western Africa | 221672000 | 13039529.4118 | | Africa | NULL | 784475000 | 13525431.0345 | | Oceania | Australia and New Zealand | 22753100 | 4550620.0000 | ... | Oceania | Melanesia | 6472000 | 1294400.0000 | | Oceania | Micronesia | 543000 | 77571.4286 | | Oceania | Micronesia/Caribbean | 0 | 0.0000 | ... | Oceania | Polynesia | 633050 | 63305.0000 | | Oceania | NULL | 30401150 | 1085755.3571 | | Antarctica | Antarctica | 0 | 0.0000 | | Antarctica | NULL | 0 | 0.0000 | | South America | South America | 345780000 | 24698571.4286 | | South America | NULL | 345780000 | 24698571.4286 | | NULL | NULL | 6078749450 | 25434098.1172 | +---------------+---------------------------+------------+----------------+</span></span></code> </pre><br><br>  Note that in some rows in non-aggregating columns, it is NULL, which indicates that the string is a subtotal.  For example, the string <br><br><pre> <code class="sql hljs">| South America | NULL | 345780000 | 24698571.4286 |</code> </pre><br><br>  you need to read how in South America the total population is 345780000 people, and the average value is 24698571.4286 <br><br>  And here is the string <br><br><pre> <code class="sql hljs">| NULL | NULL | 6078749450 | 25434098.1172 |</code> </pre><br><br>  It is the final outcome in relation to the population of the entire globe. <br><br>  The positive effect of the modifier with rollup is that the passage through the records occurs once!  By the way, this functionality is very handy when displaying any statistics on the site (program).  If you are interested in this functionality or have any questions, then I ask the <a href="http://dev.mysql.com/doc/refman/5.5/en/group-by-modifiers.html">official documentation</a> for more details. <br><br><h4>  Startup option --i-am-a-dummy </h4><br>  "- i-am-a-dummy" is colloquially translated as - "I'm a dummy."  This option is a synonym for the --safe-updates option, which is created for beginners and imposes a number of restrictions so that your favorite database does not become ill from your actions: <br>  1. Update and delete requests are executed only if the condition where or limit is present <br>  2. select a single table (without joines and subqueries) returns only the first 1000 rows, unless limit is explicitly specified <br>  3. select queries with join or subquery process only the first 1,000,000 rows <br><br>  To override these restrictions, run the following query with your own parameters: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> sql_safe_updates=<span class="hljs-number"><span class="hljs-number">1</span></span>, sql_select_limit=<span class="hljs-number"><span class="hljs-number">1000</span></span>, sql_max_join_size=<span class="hljs-number"><span class="hljs-number">1000000</span></span>;</code> </pre><br><br>  To view the current settings: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> @@sql_safe_updates, @@sql_select_limit, @@sql_max_join_size</code> </pre><br><br>  It is also possible to parameterize settings when launching a client in a shell. <br><br><pre> <code class="bash hljs">mysql -u user -p -h host --i-am<span class="hljs-_"><span class="hljs-_">-a</span></span>-dummy --select_limit=500 --max_join_size=10000</code> </pre><br><br><h4>  Aesthetic comment </h4><br>  And for a snack.  After a database other than MySQL, I was always surprised why MySQL in a single-line comment that looks like a double dash requires a space, tab or other control character after itself, although there should not be a mandatory control character.  Agree, when you write a request and you need to quickly comment out a part of the code, it‚Äôs a very long time to put so many characters. <br><br>  What I mean.  In MySQL, we write this: <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- SELECT 1</span></span></code> </pre><br><br>  (with a space before SELECT), and in other databases: <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--SELECT 1</span></span></code> </pre><br><br>  (without control character). <br><br>  The solution was very simple.  The fact is that if you write such a sloppy request <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">account</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> credit=credit<span class="hljs-comment"><span class="hljs-comment">--1</span></span></code> </pre><br><br>  then the first dash will be interpreted as a minus, and the second -1, but not the comment.  If after two dashes we place the control character, then only in this case we will receive a comment.  Read more about this comment <a href="http://dev.mysql.com/doc/refman/5.5/en/ansi-diff-comments.html">here.</a> <br><br>  As a result, most of the time in my work for single-line comments I use the hash mark (#), rather than a double dash with a control symbol :-) <br><br>  <b>UDP:</b> <br>  In the comments there are doubts about the expediency of rewriting requests from in to join.  Below, my little benchmark. <br><br>  Initial data: <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> @@<span class="hljs-keyword"><span class="hljs-keyword">version</span></span>; +<span class="hljs-comment"><span class="hljs-comment">-------------------------+ | @@version | +-------------------------+ | 5.5.32-0ubuntu0.12.04.1 | +-------------------------+ 1 row in set (0.00 sec) mysql&gt; SHOW CREATE TABLE t11\G *************************** 1. row *************************** Table: t11 Create Table: CREATE TABLE `t11` ( `id` int(10) unsigned NOT NULL DEFAULT '0', `t11` varchar(45) NOT NULL, PRIMARY KEY (`id`), KEY `t11` (`t11`) ) ENGINE=InnoDB DEFAULT CHARSET=latin1 1 row in set (0.00 sec) mysql&gt; SELECT COUNT(*) FROM t11; +----------+ | COUNT(*) | +----------+ | 977360 | +----------+ 1 row in set (0.03 sec) mysql&gt; SHOW CREATE TABLE t22\G *************************** 1. row *************************** Table: t22 Create Table: CREATE TABLE `t22` ( `id` int(10) unsigned NOT NULL DEFAULT '0', `t22` varchar(45) NOT NULL, PRIMARY KEY (`id`), KEY `t22` (`t22`) ) ENGINE=InnoDB DEFAULT CHARSET=latin1 1 row in set (0.00 sec) mysql&gt; SELECT COUNT(*) FROM t22; +----------+ | COUNT(*) | +----------+ | 962078 | +----------+ 1 row in set (0.04 sec)</span></span></code> </pre><br><br>  JOIN vs IN vs EXISTS <br><br>  When working with the JOIN index (7.84 seconds), it loses much in comparison with IN (1.74 seconds) and EXISTS (2.44 seconds). <br>  Below is an example, when the columns t11 and t22 without an index: <br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> SQL_NO_CACHE * -&gt; <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t11 -&gt; <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> t11 <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> t22 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t22) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span>; +<span class="hljs-comment"><span class="hljs-comment">------+-------+ | id | t11 | +------+-------+ | 2 | 5718 | | ........ | | 1001 | 54192 | +------+-------+ 1000 rows in set (13.59 sec) mysql&gt; SELECT SQL_NO_CACHE * -&gt; FROM t11 c -&gt; WHERE EXISTS ( -&gt; SELECT 1 FROM t22 cl WHERE c.t11 = cl.t22 -&gt; ) -&gt; LIMIT 1000; +------+-------+ | id | t11 | +------+-------+ | 2 | 5718 | | ........ | | 1001 | 54192 | +------+-------+ 1000 rows in set (13.94 sec) mysql&gt; SELECT DISTINCT SQL_NO_CACHE c.* -&gt; FROM t11 c -&gt; INNER JOIN t22 cl ON c.t11 = cl.t22 -&gt; LIMIT 1000; +-------+-------+ | id | t11 | +-------+-------+ | 25 | 74376 | | ......... | | 34359 | 62666 | +-------+-------+ 1000 rows in set (3.36 sec)</span></span></code> </pre><br>  Put the limit, so long not to wait for an answer.  It does not affect the result. <br><br>  OUTER JOIN vs NOT IN vs NOT EXISTS <br><br>  Without an index, these queries in MySQL 5.5 are processed in approximately the same time. <br>  Below are examples using an index: <br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> SQL_NO_CACHE * -&gt; <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t11 -&gt; <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> t11 <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> t22 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t22) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span>; +<span class="hljs-comment"><span class="hljs-comment">--------+---------------------+ | id | t11 | +--------+---------------------+ | 1 | 0.23670763544431667 | | ........................ | | 891610 | 97811 | +--------+---------------------+ 91 rows in set (1.36 sec) mysql&gt; SELECT SQL_NO_CACHE * -&gt; FROM t11 c -&gt; WHERE NOT EXISTS ( -&gt; SELECT 1 FROM t22 cl WHERE c.t11 = cl.t22 -&gt; ) -&gt; LIMIT 1000; +--------+---------------------+ | id | t11 | +--------+---------------------+ | 1 | 0.23670763544431667 | | ........................ | | 891610 | 97811 | +--------+---------------------+ 91 rows in set (1.87 sec) mysql&gt; SELECT SQL_NO_CACHE c.* -&gt; FROM t11 c -&gt; LEFT JOIN t22 cl ON c.t11 = cl.t22 -&gt; WHERE cl.t22 IS NULL -&gt; LIMIT 1000; +--------+---------------------+ | id | t11 | +--------+---------------------+ | 1 | 0.23670763544431667 | | ........................ | | 891610 | 97811 | +--------+---------------------+ 91 rows in set (1.27 sec)</span></span></code> </pre><br><br>  As a result, the result depends on the database version and the source data! </div><p>Source: <a href="https://habr.com/ru/post/196692/">https://habr.com/ru/post/196692/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../196676/index.html">We write our JSON parser (with polka dots and pearl buttons)</a></li>
<li><a href="../196682/index.html">We attach the spatial index to the unsuspecting OpenSource database.</a></li>
<li><a href="../196684/index.html">Samsung is the most active advertiser on the "pirated" sites of Ukraine</a></li>
<li><a href="../196688/index.html">Instead of a review IBM ThinkPad 755CD - restorer notes</a></li>
<li><a href="../196690/index.html">Google has to delete eight ‚Äúpirated‚Äù links per second</a></li>
<li><a href="../196694/index.html">Getting ready for Friday: luminous drinks from the TRON bar: Legacy</a></li>
<li><a href="../196696/index.html">Nokia closes reception of new Symbian and MeeGo-applications in Nokia Store</a></li>
<li><a href="../196698/index.html">2x Intel Quad-Core Xeon E5620 / 32GB DDR3 / 24x2TB SATA2 to NL / US with 1 or 10 Gbps Internet at ultra-low prices!</a></li>
<li><a href="../196700/index.html">Geolocation - how to earn us</a></li>
<li><a href="../196702/index.html">Runnable: search engine code with its execution in the VM</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>