<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ASA. Configuring Intercept Authentication via AD and LDAP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="According to the advice of respected harakchiteli I change the format of my publications on ASA. I will write here the most interesting, not tiring de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ASA. Configuring Intercept Authentication via AD and LDAP</h1><div class="post__text post__text-html js-mediator-article"> According to the advice of respected harakchiteli I change the format of my publications on ASA.  I will write here the most interesting, not tiring detailed description.  Complete article ‚ÄúASA.  Interception Authentication "read our newly baked <a href="http://www.anticisco.ru/blogs/%3Fp%3D96">blog</a> <br><br>  And here I will tell how using ASA, directly authenticate to AD <br><br>  ITU often has the task of verifying the user before giving him access to certain resources.  On the ASA, this check is called ‚Äúintercept authentication‚Äù (cut-through proxy). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This service uses the AAA infrastructure (Authentication, Authorization, Accounting). <br><br>  <i><b>Note:</b> in the English word authentication there is no syllable ‚Äúphi‚Äù, which appeared in Russian ‚Äúauthentication‚Äù most likely because of the consonance with the word ‚Äúidentification‚Äù.</i>  <i>Moreover, in our mighty language there is also ‚Äúauthenticity‚Äù.</i>  <i>Without any "fi" :) Do not get caught!</i> <br><br>  <b>Authentication.</b> <br>  Answers the question "is there such a user."  The search for this user can be performed both in the local (LOCAL) database and in the external (TACACS +, RADIUS, AD via LDAP). <br><a name="habracut"></a><br><br>  Setting up an LDAP server implies specifying a user account from AD with which the ASA will log in to LDAP, server type, search root, etc. <br><br> <code>aaa-server {SERVERNAME} protocol ldap <br> aaa-server {SERVERNAME} ({interface}) host {IP_SERVER} <br> ldap-base-dn { } <br> ldap-scope {subtree|onelevel} <br> ldap-naming-attribute { } <br> ldap-login-dn {  ASA} <br> ldap-login-password {   ASA} <br> server-type {Microsoft|Novell|OpenLDAP|sun|auto} <br></code> <br>  Example: <br> <code>aaa-server AD (dmz) host 172.16.1.100 <br> ldap-base-dn ou=Employers, dc=anticisco, dc=ru <br> ldap-scope subtree <br> ldap-naming-attribute sAMAccountName <br> ldap-login-dn cn=ASA, cn=users, dc=anticisco, dc=ru <br> ldap-login-password ASALDAPPASS <br> server-type microsoft <br></code> <br>  Once the servers are configured, it's time to determine what kind of traffic is interesting for us to check and not to pass without authentication.  The ASA is responsible for this ... of course, the access list, where lines of permit indicate such traffic.  The access list itself for authentication is used by the command <br><br> <code>aaa authentication match {AUTHACL} {interface} {SERVERNAME}</code> <br> <br>  This will check packets arriving at the input of the specified interface. <br><br>  For example, we want to check all traffic from the local network 10.1.1.0/24 (behind the inside interface) going to all networks except 172.16.1.0/24: <br> <code>access-list AUTH deny ip 10.1.1.0 255.255.255.0 172.16.1.0 255.255.255.0 <br> access-list AUTH permit ip 10.1.1.0 255.255.255.0 any <br> aaa authentication match AUTH inside RAD <br></code> <br>  But how to ask the user his username / password?  After all, can not any ping initiate a request? <br>  Intercept the session and ask the username and password of the ASA can http / https, ftp, telnet.  If you need to authenticate other traffic, then you need to make 2 movements: go somewhere behind the ASA using one of the specified protocols, enter your login / password either in the browser or in telnet or in the ftp window.  It should be borne in mind that such traffic must be indicated in the access list for interesting traffic. <br><br>  For example, we want the user to be able to go via telnet or http to host 1.1.1.1 and be asked for a username and password.  Then this traffic must be included in the access list.  This is not suitable, because  via telnet will not work: <br> <code>access-list AUTH permit tcp any any eq 80 <br> access-list AUTH permit udp any any <br></code> <br>  If the data is correct, the ASA will pass your traffic.  But only for the specified time.  By default, timeouts, let's say, strange: 5 minutes of absolute time, inactivity timeout is not monitored.  Change them not only possible, but necessary: <br><br> <code>timeout uauth {HH:MM:SS} {absolute|inactivity} <br></code> <br>  Example: <br> <code>timeout uauth 0:15:0 inactivity <br> timeout uauth 20:00:00 absolute <br></code> <br>  Thus, with authentication, everything is simple: if you do not specify anything else, then the user, or rather, the ip-address of his computer, everything will be possible. <br><br>  A much more interesting point is <b>authorization</b> , that is, restriction of user rights. <br><br>  For LDAP authorization, we need a ‚Äúcrutch‚Äù - a special construct that matches the LDAP attribute with the RADIUS attribute that the ASA understands.  This design is called <br><br> <code>ldap attribute-map {MAPNAME} <br> map-name {LDAPATTRIBUTE} {RADUISATTRIBUTE} <br> map-value {LDAPATTRIBUTE} {SENDNAME} {TRANSLATENAME} <br></code> <br>  Example.  Let us match the attribute IETF-Radius-Filter-Id (access list) to the base ipPhone AD attribute.  And we describe that if in the specified attribute we get the word "BUHG", then the user will use the access list BUH, which is already written on the ASA: <br> <code>ldap attribute-map AD <br> map-name ipPhone IETF-Radius-Filter-Id <br> map-value ipPhone BUHG BUH <br></code> <br>  <b>Important:</b> if in the specified attribute we received nothing, we ignore it, and if we receive a word that is not described in the values ‚Äã‚Äãfor this attribute, then access will be denied.  Thus, an AD administrator can affect access rights.  For example, it can block the Internet for an undesirable user without touching the ASA :) <br><br>  It remains only to apply this attribute list to a specific LDAP server. <br><br> <code>aaa-server {SERVERNAME} ({interface}) host {IP_SERVER} <br> ldap-attribute-map {MAPNAME} <br></code> <br>  Example: <br> <code>aaa-server AD (dmz) host 172.16.1.100 <br> ldap-attribute-map AD <br></code> <br>  Enjoy your authorization, dear hawreaders, ciscolab :) <br><br>  Threat I myself: "On normal OS, this is done by half of the team" :) So we will help the admins of the "abnormal" :) </div><p>Source: <a href="https://habr.com/ru/post/85104/">https://habr.com/ru/post/85104/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../85094/index.html">Rare Microsystems MS-21C-E laptop</a></li>
<li><a href="../85095/index.html">Design Pattern "Adapter" / "Adapter"</a></li>
<li><a href="../85096/index.html">.NET and working with unmanaged code. Part 2</a></li>
<li><a href="../85099/index.html">Ping.fm Why are you like this?</a></li>
<li><a href="../85100/index.html">Spell Checker in Visual Studio</a></li>
<li><a href="../85105/index.html">Installing RoR 3 beta + Ruby EE + Passenger on Ubuntu 9.10</a></li>
<li><a href="../85111/index.html">Obtics - functional reactive programming on .Net</a></li>
<li><a href="../85115/index.html">What to do if you received a damaged parcel?</a></li>
<li><a href="../85116/index.html">UPC news regarding what happened with Torrents.ru</a></li>
<li><a href="../85117/index.html">Rake with WebRequest</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>