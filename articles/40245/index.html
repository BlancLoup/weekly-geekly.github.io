<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHP multithreading emulation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The essence of multithreading (for an application) is that a process can consist of several (of the same type) threads running ‚Äúin parallel‚Äù, that is,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHP multithreading emulation</h1><div class="post__text post__text-html js-mediator-article"> The essence of multithreading (for an application) is that a process can consist of several (of the same type) threads running ‚Äúin parallel‚Äù, that is, without sequencing by time ‚Äî one was executed, the next one went.  Using multithreading allows you to speed up the execution of the task and / or reduce the load, thus, improving the speed of the application itself. <br><br>  PHP refers to languages ‚Äã‚Äãin which multithreading is not supported.  But there are a lot of tasks in which she would be very useful.  As a rule, these are tasks in which one action needs to be performed many times, but with different parameters, and the action itself is so resource-intensive, and the number of iterations is so large that it is impossible to use a normal cycle. <br><br>  I will consider a simple example of how to achieve multithreading emulation in PHP. <br><a name="habracut"></a><br>  Suppose we need to send mailing to a very large number of addresses.  Addresses are stored in the database.  Since there are many addresses, this option does not suit us, hang the server: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <font color="#000000"><font color="#0000BB">$ res</font> <font color="#007700">=</font> <font color="#0000BB">mysql_query</font> <font color="#007700">(</font> <font color="#DD0000">'SELECT `email` FROM` user`'</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">while (</font> <font color="#0000BB">$ row</font> <font color="#007700">=</font> <font color="#0000BB">mysql_fetch_assoc</font> <font color="#007700">(</font> <font color="#0000BB">$ res</font> <font color="#007700">))</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#0000BB">mail</font> <font color="#007700">(</font> <font color="#0000BB">$ row</font> <font color="#007700">[</font> <font color="#DD0000">'email'</font> <font color="#007700">],</font> <font color="#0000BB">$ theme</font> <font color="#007700">,</font> <font color="#0000BB">$ text</font> <font color="#007700">);</font></font> <font color="#000000"><br></font> <br><br>  If we want to use multithreading for this task, then the following option would look good: <br><br>  <font color="#000000"><font color="#0000BB">$ res</font> <font color="#007700">=</font> <font color="#0000BB">mysql_query</font> <font color="#007700">(</font> <font color="#DD0000">'SELECT `email` FROM` user`'</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ data</font> <font color="#007700">= array ();</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">while (</font> <font color="#0000BB">$ row</font> <font color="#007700">=</font> <font color="#0000BB">mysql_fetch_assoc</font> <font color="#007700">(</font> <font color="#0000BB">$ res</font> <font color="#007700">))</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#0000BB">$ data</font> <font color="#007700">[] =</font> <font color="#0000BB">$ row</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ multithreading</font> <font color="#007700">= new</font> <font color="#0000BB">MultiThreading</font> <font color="#007700">();</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#FF8000">// mailer.php - a script that sends an email to the address passed to it by the GET method,</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">// so mailer.php?email=somebody@example.com</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#0000BB">$ multithreading</font> <font color="#007700">-&gt;</font> <font color="#0000BB">setScriptName</font> <font color="#007700">(</font> <font color="#DD0000">'mailer.php'</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ multithreading</font> <font color="#007700">-&gt;</font> <font color="#0000BB">setParams</font> <font color="#007700">(</font> <font color="#0000BB">$ data</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ multithreading</font> <font color="#007700">-&gt;</font> <font color="#0000BB">execute</font> <font color="#007700">();</font></font> <font color="#000000"><br></font> <br><br>  Everything is simple and convenient.  It remains to write the corresponding class, which I did.  Here it is, with all the explanations in the comments. <br><br>  <font color="#000000"><font color="#007700">class</font> <font color="#0000BB">MultiThreading</font></font> <font color="#000000"><font color="#0000BB"><br></font></font>  <font color="#000000"><font color="#007700">{</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#FF8000">/ **</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* Server Name</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">*</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* @var string</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* @access private</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* /</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#007700">private</font> <font color="#0000BB">$ server</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#FF8000">/ **</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* Maximum number of threads</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">*</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* @var int</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* @access private</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* /</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#007700">private</font> <font color="#0000BB">$ maxthreads</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#FF8000">/ **</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* The name of the script that performs the task we need</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">*</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* @var string</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* @access private</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* /</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#007700">private</font> <font color="#0000BB">$ scriptname</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#FF8000">/ **</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* Parameters that we will pass to the script</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">*</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* @var array</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* @access private</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* /</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#007700">private</font> <font color="#0000BB">$ params</font> <font color="#007700">= array ();</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#FF8000">/ **</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* Array in which streams are stored</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">*</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* @var array</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* @access private</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* /</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#007700">private</font> <font color="#0000BB">$ threads</font> <font color="#007700">= array ();</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#FF8000">/ **</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* Array in which the results are stored</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">*</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* @var array</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* @access private</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* /</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#007700">private</font> <font color="#0000BB">$ results</font> <font color="#007700">= array ();</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#FF8000">/ **</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* Constructor class.</font></font>  <font color="#000000"><font color="#FF8000">In it, we specify the maximum number of threads and the name of the server.</font></font>  <font color="#000000"><font color="#FF8000">Both arguments are optional.</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">*</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* @param int $ maxthreads maximum number of threads, default 10</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* @param string $ server server name, by default the name of the server on which the application is running</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* @access public</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* /</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#007700">public function</font> <font color="#0000BB">__construct</font> <font color="#007700">(</font> <font color="#0000BB">$ maxthreads</font> <font color="#007700">=</font> <font color="#0000BB">10</font> <font color="#007700">,</font> <font color="#0000BB">$ server</font> <font color="#007700">=</font> <font color="#DD0000">''</font> <font color="#007700">)</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#007700">{</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#007700">if (</font> <font color="#0000BB">$ server</font> <font color="#007700">)</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">server</font> <font color="#007700">=</font> <font color="#0000BB">$ server</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#007700">else</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">server</font> <font color="#007700">=</font> <font color="#0000BB">$ _SERVER</font> <font color="#007700">[</font> <font color="#DD0000">'SERVER_NAME'</font> <font color="#007700">];</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">maxthreads</font> <font color="#007700">=</font> <font color="#0000BB">$ maxthreads</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#FF8000">/ **</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* Specify the name of the script that performs the task we need.</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">*</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* @param string $ scriptname script name including path to it</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* @access public</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* /</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#007700">public function</font> <font color="#0000BB">setScriptName</font> <font color="#007700">(</font> <font color="#0000BB">$ scriptname</font> <font color="#007700">)</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#007700">{</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#007700">if (!</font> <font color="#0000BB">$ fp</font> <font color="#007700">=</font> <font color="#0000BB">fopen</font> <font color="#007700">(</font> <font color="#DD0000">'http: //'</font> <font color="#007700">.</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">server</font> <font color="#007700">.</font> <font color="#DD0000">'/'</font> <font color="#007700">.</font> <font color="#0000BB">$ scriptname</font> <font color="#007700">,</font> <font color="#DD0000">'r'</font> <font color="#007700">))</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#007700">throw new</font> <font color="#0000BB">Exception</font> <font color="#007700">(</font> <font color="#DD0000">'Cant open script file'</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">fclose</font> <font color="#007700">(</font> <font color="#0000BB">$ fp</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">scriptname</font> <font color="#007700">=</font> <font color="#0000BB">$ scriptname</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#FF8000">/ **</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* Set the parameters that we will pass to the script</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">*</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* @param array $ params parameters array</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* @access public</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* /</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#007700">public function</font> <font color="#0000BB">setParams</font> <font color="#007700">(</font> <font color="#0000BB">$ params</font> <font color="#007700">= array ())</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#007700">{</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">params</font> <font color="#007700">=</font> <font color="#0000BB">$ params</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#FF8000">/ **</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* Perform the task, comments in the code</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">*</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* @access public</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#FF8000">* /</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#007700">public function</font> <font color="#0000BB">execute</font> <font color="#007700">()</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#007700">{</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#FF8000">// Start the mechanism, and it works until all threads are executed.</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#007700">do {</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#FF8000">// If you do not exceed the limit of threads</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#007700">if (</font> <font color="#0000BB">count</font> <font color="#007700">(</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">threads</font> <font color="#007700">) &lt;</font> <font color="#0000BB">$ maxthreads</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#FF8000">// If you can get the next set of parameters</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#007700">if (</font> <font color="#0000BB">$ item</font> <font color="#007700">=</font> <font color="#0000BB">current</font> <font color="#007700">(</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">params</font> <font color="#007700">)) {</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Create a request using the GET method</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ query_string</font> <font color="#007700">=</font> <font color="#DD0000">''</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">foreach (</font> <font color="#0000BB">$ item</font> <font color="#007700">as</font> <font color="#0000BB">$ key</font> <font color="#007700">=&gt;</font> <font color="#0000BB">$ value</font> <font color="#007700">)</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#0000BB">$ query_string</font> <font color="#007700">. =</font> <font color="#DD0000">'&amp;'</font> <font color="#007700">.</font></font>  <font color="#000000"><font color="#0000BB">urlencode</font> <font color="#007700">(</font> <font color="#0000BB">$ key</font> <font color="#007700">).</font></font>  <font color="#000000"><font color="#DD0000">'='</font> <font color="#007700">.</font></font>  <font color="#000000"><font color="#0000BB">urlencode</font> <font color="#007700">(</font> <font color="#0000BB">$ value</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ query</font> <font color="#007700">=</font> <font color="#DD0000">"GET http: //"</font> <font color="#007700">.</font></font>  <font color="#000000"><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">server</font> <font color="#007700">.</font></font>  <font color="#000000"><font color="#DD0000">"/"</font> <font color="#007700">.</font></font>  <font color="#000000"><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">scriptname</font> <font color="#007700">.</font></font>  <font color="#000000"><font color="#DD0000">"?"</font></font>  <font color="#000000"><font color="#007700">.</font></font>  <font color="#000000"><font color="#0000BB">$ query_string</font> <font color="#007700">.</font></font>  <font color="#000000"><font color="#DD0000">"HTTP / 1.0 \ r \ n"</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Open the connection</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#007700">if (!</font> <font color="#0000BB">$ fsock</font> <font color="#007700">=</font> <font color="#0000BB">fsockopen</font> <font color="#007700">(</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">server</font> <font color="#007700">,</font> <font color="#0000BB">80</font> <font color="#007700">))</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#007700">throw new</font> <font color="#0000BB">Exception</font> <font color="#007700">(</font> <font color="#DD0000">'Cant open socket connection'</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">fputs</font> <font color="#007700">(</font> <font color="#0000BB">$ fsock</font> <font color="#007700">,</font> <font color="#0000BB">$ query</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#0000BB">fputs</font> <font color="#007700">(</font> <font color="#0000BB">$ fsock</font> <font color="#007700">,</font> <font color="#DD0000">"Host: $ server \ r \ n"</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#0000BB">fputs</font> <font color="#007700">(</font> <font color="#0000BB">$ fsock</font> <font color="#007700">,</font> <font color="#DD0000">"\ r \ n"</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#0000BB">stream_set_blocking</font> <font color="#007700">(</font> <font color="#0000BB">$ fsock</font> <font color="#007700">,</font> <font color="#0000BB">O</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#0000BB">stream_set_timeout</font> <font color="#007700">(</font> <font color="#0000BB">$ fsock</font> <font color="#007700">,</font> <font color="#0000BB">3600</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#FF8000">// write the stream</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">threads</font> <font color="#007700">[] =</font> <font color="#0000BB">$ fsock</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Go to the next element</font></font> <font color="#000000"><font color="#FF8000"><br><br></font></font>  <font color="#000000"><font color="#0000BB">next</font> <font color="#007700">(</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">params</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#FF8000">// Looping through threads</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#007700">foreach (</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">threads</font> <font color="#007700">as</font> <font color="#0000BB">$ key</font> <font color="#007700">=&gt;</font> <font color="#0000BB">$ value</font> <font color="#007700">) {</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#FF8000">// If the thread has completed, close and delete</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#007700">if (</font> <font color="#0000BB">feof</font> <font color="#007700">(</font> <font color="#0000BB">$ value</font> <font color="#007700">)) {</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#0000BB">fclose</font> <font color="#007700">(</font> <font color="#0000BB">$ value</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#007700">unset (</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">threads</font> <font color="#007700">[</font> <font color="#0000BB">$ key</font> <font color="#007700">]);</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#007700">} else {</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#FF8000">// Otherwise, read the results</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">results</font> <font color="#007700">[] =</font> <font color="#0000BB">fgets</font> <font color="#007700">(</font> <font color="#0000BB">$ value</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#FF8000">// You can put a delay in order not to hang the server</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#0000BB">sleep</font> <font color="#007700">(</font> <font color="#0000BB">1</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#FF8000">// ... until all threads are executed</font></font> <font color="#000000"><font color="#FF8000"><br></font></font>  <font color="#000000"><font color="#007700">} while (</font> <font color="#0000BB">count</font> <font color="#007700">(</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">threads</font> <font color="#007700">)&gt;</font> <font color="#0000BB">O</font> <font color="#007700">);</font></font> <font color="#000000"><font color="#007700"><br><br></font></font>  <font color="#000000"><font color="#007700">return</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">results</font> <font color="#007700">;</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><font color="#007700"><br></font></font>  <font color="#000000"><font color="#007700">}</font></font> <font color="#000000"><br></font> <br><br>  You can also <a href="http://s-a-p.in/download/multithreading">download</a> this class, so as not to copy-paste :-). <br><br>  <b>UPD:</b> gentlemen, I want to remind you, yet this is rather a detailed example than an ideal ready-made solution. <br><br> <code>PS  -    ¬´$var &gt; 0¬ª,     (stream_set_blocking($fsock, 0);  while (count($this-&gt;threads) &gt; 0);)    0   O.      .</code> <br> <br>  <a href="http://s-a-p.in/interactive/theme/emulation-multithreading">Original article.</a> </div><p>Source: <a href="https://habr.com/ru/post/40245/">https://habr.com/ru/post/40245/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../402441/index.html">Why do I need a tablet for drawing water Buddha Board</a></li>
<li><a href="../402443/index.html">The oil war is just beginning. Truth in the model [1]</a></li>
<li><a href="../402445/index.html">Meet: Exhibition and Conference on Additive Technologies Top 3D Expo Dental Edition [Moscow, April 14, 2017]</a></li>
<li><a href="../402447/index.html">Bill Gates - the richest man in the world for the fourth year in a row</a></li>
<li><a href="../402449/index.html">Case Apple Music: plan to capture the universe</a></li>
<li><a href="../402451/index.html">Ask Ethan: How do jets of black holes turn into cosmic bubbles?</a></li>
<li><a href="../402453/index.html">Autism and the brain</a></li>
<li><a href="../402455/index.html">Windows 10 will download some updates even through limited connections.</a></li>
<li><a href="../402457/index.html">As a failure of the Amazon voice assistant to confess to work at the CIA, once again amused America</a></li>
<li><a href="../402459/index.html">The ARM program - there was no space for a cobblestone from an asteroid in the NASA budget ...</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>