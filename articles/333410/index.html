<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Developing wrapper scripts using the Sparrow tool</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good time of day! In this post I want to tell you how to use the Sparrow tool to easily and simply write your own wrappers to existing scripts and uti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Developing wrapper scripts using the Sparrow tool</h1><div class="post__text post__text-html js-mediator-article"><p>  Good time of day!  In this post I want to tell you how to use the <a href="https://github.com/melezhik/sparrow">Sparrow</a> tool to easily and simply write your own wrappers to existing scripts and utilities, as well as why you may need it. </p><a name="habracut"></a><br><p>  Very often we deal with various scripts that we have to run for different tasks and on different servers.  These scripts can be written by us or installed as part of software packages.  Anyway, very often the task comes down to the fact that you just need to run a certain script with a set of parameters: </p><br><pre><code class="hljs xml">script <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arguments</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  The main difficulty here <em>can be</em> that the script arguments can be quite spreading and complex, and at the same time, depending on the context of the task, also different.  This gives rise to a number of inconveniences, of course, not so critical, but nevertheless which I would like to mention: </p><br><ul><li><p>  Every time you have to <em>remember</em> (or search history) the arguments passed to the script if you run the script manually. </p><br></li><li>  If you prescribe the script to run in cron, then in the case of a large number of arguments, the records are complex and, as a result, hard to read and edit, it is easy to make a mistake with the next manual edit. </li></ul><br><p>  So, here we can get out the wrapper scripts that will encapsulate everything related to the logic of preparing input parameters for a given script, and then run this script with these parameters. </p><br><p>  Instead of writing your own wrapper scripts, you can use the Sparrow tool, and I'll show you now how easy and simple this can be. </p><br><h1 id="ustanovka-sparrow">  Sparrow installation </h1><br><p>  Sparrow is a CPAN module, so we set it accordingly: </p><br><pre> <code class="hljs ruby">$ cpanm Sparrow</code> </pre> <br><h1 id="vybor-skripta-dlya-kotorogo-budem-pisat-obyortku">  Select the script for which we will write the wrapper </h1><br><p>  Since this is a tutorial article, I‚Äôll choose any script, for purely informational purposes, in real life, it will be a script or scripts that you use in your work.  Let it be the <a href="https://github.com/sivel/speedtest-cli">speedtest-cli</a> utility designed to test the speed of the Internet on your local host.  Judging by the documentation, the script has a sufficiently large number of settings that are specified through command line arguments - just the very case when a wrapper may be appropriate.  Imagine that we want to run this script on crown and send reports to analyze the availability of the Internet for a certain period of time.  Let's say, on.  interested in two options for calling the script: </p><br><pre> <code class="hljs perl">speedtest-cli --<span class="hljs-keyword"><span class="hljs-keyword">no</span></span>-download <span class="hljs-comment"><span class="hljs-comment">#    </span></span></code> </pre> <br><p>  and </p><br><pre> <code class="hljs perl">speedtest-cli --<span class="hljs-keyword"><span class="hljs-keyword">no</span></span>-upload <span class="hljs-comment"><span class="hljs-comment">#    </span></span></code> </pre> <br><p>  And in both cases, we want to always add an option. </p><br><pre> <code class="hljs 1c">--bytes <span class="hljs-meta"><span class="hljs-meta">#      ,  </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta">  </span></span></code> </pre> <br><p>  Also, suppose that in the first case we want to specify a wait timeout for http requests: </p><br><pre> <code class="hljs objectivec">--timeout <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-meta"><span class="hljs-meta"># http -</span></span></code> </pre> <br><p>  Ok, so we have two separate speedtest-cli runs with different parameters. </p><br><h1 id="napisanie-skripta-obyortki-v-vide-sparrow-plagina">  Writing a wrapper script in the form of a Sparrow plugin </h1><br><p>  Create a script story: </p><br><pre> <code class="hljs ruby">$ nano story.bash speedtest-cli $(args_cli)</code> </pre> <br><p>  In this case, all the work is done by the predetermined Sparrow bash function <em>args_cli</em> , which transparently passes all input parameters to the speedtest-cli script. </p><br><p>  Determine the boot loader speedtest-cli.  Sparrow is able to set dependencies for scripts, supporting a number of package managers defined for various programming languages, including Python.  The speedtest-cli utility is installed as a pip module, so we simply define the dependency file in the style of the pip installer: </p><br><pre> <code class="hljs ruby">$ nano requirements.txt speedtest-cli==<span class="hljs-number"><span class="hljs-number">1.0</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span></code> </pre> <br><p>  Well, let's go further, it remains to determine the file with the plugin meta data and actually upload it to <a href="https://sparrowhub.org/">the</a> Sparrow plugin <a href="https://sparrowhub.org/">repository</a> : </p><br><pre> <code class="hljs pgsql">$ nano sparrow.json { "name" : "speedtest-cli", "description" : "Simple wrapper for speedtest-cli from https://github.com/sivel/speedtest-cli", "version" : "0.0.1", "url" : "https://github.com/melezhik/sparrow-plugins/tree/master/speedtest-cli", "category": "utilities", "python_version" : <span class="hljs-number"><span class="hljs-number">2</span></span>, "sparrow_version": "0.2.45" }</code> </pre> <br><p>  The file format of the meta data for the Sparrow plugin is described in detail in the documentation for Sparrow, we will not analyze it here, we only care that the plugin is called like a script for which it provides a wrapper. </p><br><p>  Now we are ready to load the plugin into the repository: </p><br><pre> <code class="hljs ruby"> $ sparrow plg upload <span class="hljs-comment"><span class="hljs-comment">#       </span></span></code> </pre> <br><h1 id="nastroyka-sparrow-zadach-dlya-zapuska-skripta-obyortki">  Configuring Sparrow Tasks to Run a Wrapper Script </h1><br><p>  This is where the fun begins.  This is <em>how</em> we will use the plugin we created to run the speedtest-cli utility described earlier. </p><br><p>  Suppose we want to run this utility on another server.  It is not difficult to guess that first we need to install the appropriate Sparrow plugin: </p><br><pre> <code class="hljs sql">$ sparrow plg <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> speedtest-cli</code> </pre> <br><p>  If everything goes well, we will get the Sparrow plugin installed and the speedtest-cli utility itself, along with all the Python dependencies. </p><br><p>  Let's make a simple verification that the plugin works: </p><br><pre> <code class="hljs pgsql"> $ sparrow plg run speedtest-cli <span class="hljs-comment"><span class="hljs-comment">-- --help</span></span></code> </pre> <br><p>  If all is well, then we will get help from the speedtest-cli utility. </p><br><p>  In order to <em>associate the</em> launched plugin with certain parameters, we create tasks.  We recall that we need to run speedtest-cli with different arguments. </p><br><pre> <code class="hljs pgsql"> $ sparrow project <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> monitoring #   -     $ sparrow task <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> monitoring nettest-download speedtest-cli $ sparrow task <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> monitoring nettest-upload speedtest-cli</code> </pre> <br><p>  With the last two commands, we have created tasks for different launches of the speedtest-cli utility, now we will configure them: </p><br><pre> <code class="hljs pgsql">$ sparrow task ini monitoring/nettest-download <span class="hljs-comment"><span class="hljs-comment">--- args: - timeout: 10 - - bytes - no-upload</span></span></code> </pre> <br><p>  $ sparrow task ini monitoring / nettest-upload </p><br><pre> <code class="hljs pgsql"> <span class="hljs-comment"><span class="hljs-comment">--- args: - - bytes - no-download</span></span></code> </pre> <br><p>  Now we just need to run our tasks: </p><br><pre> <code class="hljs ruby">$ sparrow task run monitoring/nettest-upload $ sparrow task run monitoring/nettest-download</code> </pre> <br><p>  Our wrappers are ready and working properly. </p><br><h1 id="zaklyuchenie">  Conclusion </h1><br><p>  Sparrow makes it easy and simple to write wrappers for almost any console utility.  This eliminates the need to write separate scripts to run the same utility with different parameters, for this there is a simple and powerful tool Sparrow tasks.  Sparrow plugins are portable to almost any Linux server where Perl is installed.  Also setting up Sparrow-style scripts involves generating input data in the YAML and JSON formats, which greatly simplifies running such scripts from any modern programming languages ‚Äã‚Äãand makes their automation more simple.  For example, you can see the <a href="https://github.com/melezhik/sparrowdo">Sparrowdo</a> project, which allows you to configure and run Sparrow tasks remotely via ssh. </p><br><h1 id="ssylki-po-teme">  Related Links </h1><br><ul><li>  speedtest-cli plugin code - <a href="https://github.com/melezhik/sparrow-plugins/tree/master/speedtest-cli">https://github.com/melezhik/sparrow-plugins/tree/master/speedtest-cli</a> </li><li>  SparrowHub repository plugin page - <a href="https://sparrowhub.org/info/speedtest-cli">https://sparrowhub.org/info/speedtest-cli</a> </li><li>  Documentation for Outthentic - a framework for developing scripts that is used when writing Sparrow plugins - <a href="https://github.com/melezhik/outthentic">https://github.com/melezhik/outthentic</a> </li><li>  documentation for Sparrow - script manager - <a href="https://github.com/melezhik/sparrow">https://github.com/melezhik/sparrow</a> </li></ul><br><p>  Sincerely, Alexey Melezhik, author Sparrow </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/333410/">https://habr.com/ru/post/333410/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../333398/index.html">Talk about Yii 2</a></li>
<li><a href="../333400/index.html">We make a website for virtual reality. We build the monitor into the monitor and reflect on the future</a></li>
<li><a href="../333402/index.html">Recommendations for security when working with Docker</a></li>
<li><a href="../333404/index.html">Was there a hacking of "Gosuslug"? Yandex Hypothesis</a></li>
<li><a href="../333406/index.html">How Angry Birds 2 increased revenue several times over the year</a></li>
<li><a href="../333412/index.html">Creating a schedule for SCADA systems based on cron</a></li>
<li><a href="../333414/index.html">The road to C ++ 20</a></li>
<li><a href="../333418/index.html">We pump over NES Classic Mini - continuation</a></li>
<li><a href="../333420/index.html">Comodo Internet Security Local Update Server</a></li>
<li><a href="../333422/index.html">Unity on Linux? No problem</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>