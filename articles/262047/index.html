<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to steal a control plane or cooking EIGRP for Juniper</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As you know, SDN was originally defined as the ability to physically separate control and data plane. I want to show the realization of this idea with...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to steal a control plane or cooking EIGRP for Juniper</h1><div class="post__text post__text-html js-mediator-article">  As you know, SDN was originally defined as the ability to physically separate control and data plane.  I want to show the realization of this idea without openflow and special controllers.  The control plane will be the <a href="http://habrahabr.ru/post/247337/">ODROID-C1</a> debugging board with IOS running inside Dynamips.  As the data plane stands Juniper EX-2200. <br><br>  The EIGRP protocol will work on the board, build the routing table, and the switch will send data based on this table. <br><br>  First, I will explain why this choice: <br><ol><li>  EIGRP is a well-known protocol fully implemented only on cisco devices. </li><li>  Juniper - because  second most popular vendor </li><li>  The Juniper EX-2200 is the youngest model, so the method will work with all the older ones. </li><li>  ODROID-C1 was chosen due to the ‚Äúfair‚Äù 1G network card (you can use any server with linux). </li><li>  The EX-2200 is smaller than a unit in width, and the debug board fits completely in the free space, so the whole structure fits in 1U and does not require additional rack space </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      How it will work in 2 words: <br>  there is a network built on the equipment cisco, the routing protocol EIGRP.  Add a Juniper EX-2200 switch, connect it as "as needed" (that is, as a combat router).  We switch on the debug board with Dynamips to the Switch, redirect all the routing protocol service traffic to it.  Virtual cisco builds the routing table and redistribute it to the switch.  As a result, all traffic with data will be sent to the routing table built by the EIGRP protocol. <br><a name="habracut"></a><br>  So, the test circuit: <br><br><img src="https://habrastorage.org/files/56f/42c/6b7/56f42c6b749540449a93b45aea2349a0.png"><br><br>  for simplicity, the networks are attached to the links, and the last octet of the address always coincides with the device number. <br><br>  configurations for tsisok: <br><div class="spoiler">  <b class="spoiler_title">R10 - Cisco 2811</b> <div class="spoiler_text">  R10 # sho running-config <br>  Building configuration ... <br><br>  Current configuration: 1006 bytes <br>  ! <br>  version 12.4 <br>  service timestamps debug datetime msec <br>  service timestamps log datetime msec <br>  no service password-encryption <br>  ! <br>  hostname R10 <br>  ! <br>  boot-start-marker <br>  boot-end-marker <br>  ! <br>  ! <br>  no aaa new-model <br>  ! <br>  resource policy <br>  ! <br>  ip subnet-zero <br>  ! <br>  ! <br>  ip cef <br>  ! <br>  ! <br>  ! <br>  voice-card 0 <br>  no dspfarm <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  interface FastEthernet0 / 0 <br>  description S2 <br>  ip address 10.2.0.10 255.255.255.0 <br>  duplex auto <br>  speed auto <br>  ! <br>  interface FastEthernet0 / 1 <br>  description K15-ge0 / 0/8 <br>  no ip address <br>  duplex auto <br>  speed auto <br>  ! <br>  interface FastEthernet0 / 1.1010 <br>  encapsulation dot1Q 1010 <br>  ip address 10.10.0.10 255.255.255.0 <br>  no snmp trap link-status <br>  ! <br>  interface FastEthernet0 / 0/0 <br>  ! <br>  interface FastEthernet0 / 0/1 <br>  ! <br>  interface FastEthernet0 / 0/2 <br>  ! <br>  interface FastEthernet0 / 0/3 <br>  ! <br>  interface vlan1 <br>  no ip address <br>  ! <br>  router eigrp 1 <br>  network 0.0.0.0 <br>  auto-summary <br>  ! <br>  ip classless <br>  ! <br>  ! <br>  ip http server <br>  no ip http secure-server <br>  ! <br>  ! <br>  ! <br>  ! <br>  control-plane <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  line con 0 <br>  line aux 0 <br>  line vty 0 4 <br>  login <br>  ! <br>  scheduler allocate 20000 1000 <br>  ! <br>  end <br><br>  R10 # <br></div></div><br><div class="spoiler">  <b class="spoiler_title">R11 - Cisco 2851</b> <div class="spoiler_text">  R11 # sho running-config <br>  Building configuration ... <br><br>  Current configuration: 897 bytes <br>  ! <br>  version 12.4 <br>  service timestamps debug datetime msec <br>  service timestamps log datetime msec <br>  no service password-encryption <br>  ! <br>  hostname R11 <br>  ! <br>  boot-start-marker <br>  boot-end-marker <br>  ! <br>  ! <br>  no aaa new-model <br>  ! <br>  resource policy <br>  ! <br>  ip subnet-zero <br>  ! <br>  ! <br>  ip cef <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  interface GigabitEthernet0 / 0 <br>  description R12-gi0 / 2 <br>  ip address 10.12.1.11 255.255.255.0 <br>  duplex auto <br>  speed auto <br>  no mop enabled <br>  ! <br>  interface GigabitEthernet0 / 1 <br>  description K15-ge0 / 0/9 <br>  no ip address <br>  duplex auto <br>  speed auto <br>  ! <br>  interface GigabitEthernet0 / 1.1011 <br>  description K15 <br>  encapsulation dot1Q 1011 <br>  ip address 10.11.0.11 255.255.255.0 <br>  no snmp trap link-status <br>  ! <br>  router eigrp 1 <br>  network 0.0.0.0 <br>  no auto-summary <br>  ! <br>  ip classless <br>  ! <br>  no ip http server <br>  no ip http secure-server <br>  ! <br>  snmp-server community public RO <br>  ! <br>  ! <br>  control-plane <br>  ! <br>  ! <br>  ! <br>  line con 0 <br>  line aux 0 <br>  line vty 0 4 <br>  password cisco <br>  login <br>  ! <br>  scheduler allocate 20000 1000 <br>  ! <br>  end <br><br>  R11 # <br></div></div><br><div class="spoiler">  <b class="spoiler_title">R12 - WS-C3560-48TS</b> <div class="spoiler_text">  R12 # sho running-config <br>  Building configuration ... <br><br>  Current configuration: 2289 bytes <br>  ! <br>  version 12.2 <br>  no service pad <br>  service timestamps debug uptime <br>  service timestamps log uptime <br>  no service password-encryption <br>  service unsupported-transceiver <br>  ! <br>  hostname R12 <br>  ! <br>  ! <br>  no aaa new-model <br>  system mtu routing 1500 <br>  vtp mode transparent <br>  ip subnet-zero <br>  ip routing <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  no errdisable detect cause gbic-invalid <br>  ! <br>  ! <br>  spanning-tree mode pvst <br>  spanning-tree extend system-id <br>  ! <br>  vlan internal allocation policy ascending <br>  ! <br>  ! <br>  ! <br>  ! <br>  interface FastEthernet0 / 1 <br>  ! <br>  interface FastEthernet0 / 2 <br>  ! <br>  interface FastEthernet0 / 3 <br>  ! <br>  interface FastEthernet0 / 4 <br>  ! <br>  interface FastEthernet0 / 5 <br>  ! <br>  interface FastEthernet0 / 6 <br>  ! <br>  interface FastEthernet0 / 7 <br>  ! <br>  interface FastEthernet0 / 8 <br>  ! <br>  interface FastEthernet0 / 9 <br>  ! <br>  interface FastEthernet0 / 10 <br>  ! <br>  interface FastEthernet0 / 11 <br>  ! <br>  interface FastEthernet0 / 12 <br>  ! <br>  interface FastEthernet0 / 13 <br>  ! <br>  interface FastEthernet0 / 14 <br>  ! <br>  interface FastEthernet0 / 15 <br>  ! <br>  interface FastEthernet0 / 16 <br>  ! <br>  interface FastEthernet0 / 17 <br>  ! <br>  interface FastEthernet0 / 18 <br>  ! <br>  interface FastEthernet0 / 19 <br>  ! <br>  interface FastEthernet0 / 20 <br>  ! <br>  interface FastEthernet0 / 21 <br>  ! <br>  interface FastEthernet0 / 22 <br>  ! <br>  interface FastEthernet0 / 23 <br>  ! <br>  interface FastEthernet0 / 24 <br>  ! <br>  interface FastEthernet0 / 25 <br>  ! <br>  interface FastEthernet0 / 26 <br>  ! <br>  interface FastEthernet0 / 27 <br>  ! <br>  interface FastEthernet0 / 28 <br>  ! <br>  interface FastEthernet0 / 29 <br>  ! <br>  interface FastEthernet0 / 30 <br>  ! <br>  interface FastEthernet0 / 31 <br>  ! <br>  interface FastEthernet0 / 32 <br>  ! <br>  interface FastEthernet0 / 33 <br>  ! <br>  interface FastEthernet0 / 34 <br>  ! <br>  interface FastEthernet0 / 35 <br>  ! <br>  interface FastEthernet0 / 36 <br>  ! <br>  interface FastEthernet0 / 37 <br>  ! <br>  interface FastEthernet0 / 38 <br>  ! <br>  interface FastEthernet0 / 39 <br>  ! <br>  interface FastEthernet0 / 40 <br>  ! <br>  interface FastEthernet0 / 41 <br>  ! <br>  interface FastEthernet0 / 42 <br>  ! <br>  interface FastEthernet0 / 43 <br>  ! <br>  interface FastEthernet0 / 44 <br>  ! <br>  interface FastEthernet0 / 45 <br>  ! <br>  interface FastEthernet0 / 46 <br>  ! <br>  interface FastEthernet0 / 47 <br>  ! <br>  interface FastEthernet0 / 48 <br>  ! <br>  interface GigabitEthernet0 / 1 <br>  no switchport <br>  ip address 10.12.2.12 255.255.255.0 <br>  ! <br>  interface GigabitEthernet0 / 2 <br>  no switchport <br>  ip address 10.12.1.12 255.255.255.0 <br>  ! <br>  interface GigabitEthernet0 / 3 <br>  no switchport <br>  ip address 10.3.0.12 255.255.255.0 <br>  ! <br>  interface GigabitEthernet0 / 4 <br>  ! <br>  interface vlan1 <br>  no ip address <br>  ! <br>  router eigrp 1 <br>  network 0.0.0.0 <br>  ! <br>  ip classless <br>  ip http server <br>  ip http secure-server <br>  ! <br>  ! <br>  ! <br>  control-plane <br>  ! <br>  ! <br>  line con 0 <br>  line vty 0 4 <br>  login <br>  line vty 5 15 <br>  login <br>  ! <br>  end <br><br>  R12 # <br><br></div></div><br><div class="spoiler">  <b class="spoiler_title">R14 - WS-C3560-24TS</b> <div class="spoiler_text">  R14 # sho running-config <br>  Building configuration ... <br><br>  Current configuration: 1805 bytes <br>  ! <br>  version 12.2 <br>  no service pad <br>  service timestamps debug uptime <br>  service timestamps log uptime <br>  no service password-encryption <br>  service unsupported-transceiver <br>  ! <br>  hostname R14 <br>  ! <br>  ! <br>  no aaa new-model <br>  system mtu routing 1500 <br>  vtp mode transparent <br>  ip subnet-zero <br>  ip routing <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  no errdisable detect cause sfp-config-mismatch <br>  no errdisable detect cause gbic-invalid <br>  no file verify auto <br>  spanning-tree mode pvst <br>  spanning-tree extend system-id <br>  ! <br>  vlan internal allocation policy ascending <br>  ! <br>  vlan 100,200,300 <br>  ! <br>  ! <br>  interface FastEthernet0 / 1 <br>  ! <br>  interface FastEthernet0 / 2 <br>  ! <br>  interface FastEthernet0 / 3 <br>  ! <br>  interface FastEthernet0 / 4 <br>  ! <br>  interface FastEthernet0 / 5 <br>  ! <br>  interface FastEthernet0 / 6 <br>  ! <br>  interface FastEthernet0 / 7 <br>  ! <br>  interface FastEthernet0 / 8 <br>  ! <br>  interface FastEthernet0 / 9 <br>  ! <br>  interface FastEthernet0 / 10 <br>  ! <br>  interface FastEthernet0 / 11 <br>  ! <br>  interface FastEthernet0 / 12 <br>  ! <br>  interface FastEthernet0 / 13 <br>  ! <br>  interface FastEthernet0 / 14 <br>  ! <br>  interface FastEthernet0 / 15 <br>  ! <br>  interface FastEthernet0 / 16 <br>  ! <br>  interface FastEthernet0 / 17 <br>  ! <br>  interface FastEthernet0 / 18 <br>  ! <br>  interface FastEthernet0 / 19 <br>  ! <br>  interface FastEthernet0 / 20 <br>  ! <br>  interface FastEthernet0 / 21 <br>  ! <br>  interface FastEthernet0 / 22 <br>  ! <br>  interface FastEthernet0 / 23 <br>  ! <br>  interface FastEthernet0 / 24 <br>  no switchport <br>  ip address 10.4.0.14 255.255.255.0 <br>  ! <br>  interface GigabitEthernet0 / 1 <br>  description K15-ge0 / 1/0 <br>  no switchport <br>  ip address 10.14.0.14 255.255.255.0 <br>  ! <br>  interface GigabitEthernet0 / 2 <br>  description r12-gi0 / 1 <br>  no switchport <br>  ip address 10.12.2.14 255.255.255.0 <br>  ! <br>  interface vlan1 <br>  no ip address <br>  shutdown <br>  ! <br>  router eigrp 1 <br>  network 0.0.0.0 <br>  no auto-summary <br>  ! <br>  ip classless <br>  ip http server <br>  ip http secure-server <br>  ! <br>  ! <br>  ip access-list standard public <br>  ! <br>  ! <br>  control-plane <br>  ! <br>  ! <br>  line con 0 <br>  exec-timeout 0 0 <br>  line vty 0 4 <br>  password cisco <br>  login <br>  line vty 5 15 <br>  password cisco <br>  login <br>  ! <br>  end <br><br>  R14 # <br></div></div><br>  Configure the switch: <br><div class="spoiler">  <b class="spoiler_title">K15 - Juniper EX-2200</b> <div class="spoiler_text">  root @ K15 # show <br>  version 13.2X50-D15.3; <br>  interfaces { <br>  interface-range tagget-ports { <br>  member "ge-0/0 / [4-11]"; <br>  unit 0 { <br>  family ethernet-switching { <br>  port-mode trunk; <br>  vlan { <br>  members [v-R11 v-R10]; <br>  } <br>  filter { <br>  input cisco; <br>  } <br>  } <br>  } <br>  } <br>  ge-0/0/0 { <br>  description odroid-mgmt; <br>  unit 0 { <br>  family ethernet-switching { <br>  port-mode access; <br>  vlan { <br>  members v-odroid-mgmt; <br>  } <br>  } <br>  } <br>  } <br>  ge-0/0/1 { <br>  description odroid-c1; <br>  unit 0 { <br>  family ethernet-switching { <br>  port-mode trunk; <br>  vlan { <br>  members [v-R14 v-R11 v-R10 v-S1 v-analyzer]; <br>  } <br>  native-vlan-id v-odroid-mgmt; <br>  } <br>  } <br>  } <br>  ge-0/0/2 { <br>  description S1; <br>  unit 0 { <br>  family ethernet-switching { <br>  port-mode access; <br>  vlan { <br>  members v-S1; <br>  } <br>  filter { <br>  input cisco; <br>  } <br>  } <br>  } <br>  } <br>  ge-0/0/8 { <br>  description R10; <br>  } <br>  ge-0/0/9 { <br>  description R11; <br>  } <br>  ge-0/1/0 { <br>  description R14; <br>  unit 0 { <br>  family ethernet-switching { <br>  port-mode access; <br>  vlan { <br>  members v-R14; <br>  } <br>  filter { <br>  input cisco; <br>  } <br>  } <br>  } <br>  } <br>  ge-0/1/1 { <br>  unit 0 { <br>  family ethernet switching; <br>  } <br>  } <br>  vlan { <br>  unit 1001 { <br>  family inet { <br>  address 10.1.0.15/24; <br>  } <br>  } <br>  unit 1010 { <br>  family inet { <br>  address 10.10.0.15/24; <br>  } <br>  } <br>  unit 1011 { <br>  family inet { <br>  address 10.11.0.15/24; <br>  } <br>  } <br>  unit 1014 { <br>  family inet { <br>  address 10.14.0.15/24; <br>  } <br>  } <br>  } <br>  } <br>  firewall { <br>  family ethernet-switching { <br>  filter cisco { <br>  term eigrp { <br>  from { <br>  protocol 88; <br>  } <br>  then { <br>  accept; <br>  analyzer cisco; <br>  } <br>  } <br>  term others { <br>  then accept; <br>  } <br>  } <br>  } <br>  } <br>  ethernet-switching-options { <br>  analyzer cisco { <br>  output { <br>  vlan { <br>  v-analyzer; <br>  } <br>  } <br>  } <br>  dot1q-tunneling { <br>  ether-type 0x8100; <br>  } <br>  } <br>  vlans { <br>  v-R10 { <br>  vlan-id 1010; <br>  l3-interface vlan.1010; <br>  } <br>  v-R11 { <br>  vlan-id 1011; <br>  l3-interface vlan.1011; <br>  } <br>  v-R14 { <br>  vlan-id 1014; <br>  l3-interface vlan.1014; <br>  } <br>  v-S1 { <br>  vlan-id 1001; <br>  l3-interface vlan.1001; <br>  } <br>  v-analyzer { <br>  vlan-id 101; <br>  dot1q-tunneling; <br>  } <br>  v-odroid-mgmt; <br>  } <br><br></div></div><br><div class="spoiler">  <b class="spoiler_title">K15 - Juniper EX-2200 - as a set of commands</b> <div class="spoiler_text">  set interfaces interface-range tagget-ports member "ge-0/0 / [4-11]" <br>  set interfaces interface-range tagset-ports unit 0 family ethernet switching port-mode trunk <br>  set interfaces interface-range tagget-ports unit 0 family ethernet-switching vlan members v-R11 <br>  set interfaces interface-range tagget-ports unit 0 family ethernet-switching vlan members v-R10 <br>  set interfaces interface-range tagset-ports unit 0 family ethernet-switching filter input cisco <br>  set interfaces ge-0/0/0 description odroid-mgmt <br>  set interfaces ge-0/0/0 unit 0 family ethernet-switching port-mode access <br>  set interfaces ge-0/0/0 unit 0 family ethernet-switching vlan members v-odroid-mgmt <br>  set interfaces ge-0/0/1 description odroid-c1 <br>  set interfaces ge-0/0/1 unit 0 family ethernet-switching port-mode trunk <br>  set interfaces ge-0/0/1 unit 0 family ethernet-switching vlan members v-R14 <br>  set interfaces ge-0/0/1 unit 0 family ethernet-switching vlan members v-R11 <br>  set interfaces ge-0/0/1 unit 0 family ethernet-switching vlan members v-R10 <br>  set interfaces ge-0/0/1 unit 0 family ethernet-switching vlan members v-S1 <br>  set interfaces ge-0/0/1 unit 0 family ethernet-switching vlan members v-analyzer <br>  set interfaces ge-0/0/1 unit 0 family ethernet-switching native-vlan-id v-odroid-mgmt <br>  set interfaces ge-0/0/2 description S1 <br>  set interfaces ge-0/0/2 unit 0 family ethernet-switching port-mode access <br>  set interfaces ge-0/0/2 unit 0 family ethernet-switching vlan members v-S1 <br>  set interfaces ge-0/0/2 unit 0 family ethernet-switching filter input cisco <br>  set interfaces ge-0/0/8 description R10 <br>  set interfaces ge-0/0/9 description R11 <br>  set interfaces ge-0/1/0 description R14 <br>  set interfaces ge-0/1/0 unit 0 family ethernet-switching port-mode access <br>  set interfaces ge-0/1/0 unit 0 family ethernet-switching vlan members v-R14 <br>  set interfaces ge-0/1/0 unit 0 family ethernet-switching filter input cisco <br>  set interfaces ge-0/1/1 unit 0 family ethernet-switching <br>  set interfaces vlan unit 1001 family inet address 10.1.0.15/24 <br>  set interfaces vlan unit 1010 family inet address 10.10.0.15/24 <br>  set interfaces vlan unit 1011 family inet address 10.11.0.15/24 <br>  set interfaces vlan unit 1014 family inet address 10.14.0.15/24 <br>  set firewall family ethernet-switching filter cisco term eigrp from protocol 88 <br>  set firewall family ethernet-switching filter cisco term eigrp then accept <br>  set firewall family ethernet-switching filter cisco term eigrp then analyzer cisco <br>  ethernet-switching filter cisco term firewall family then accept <br>  set ethernet-switching-options analyzer cisco output vlan v-analyzer <br>  set ethernet-switching-options dot1q-tunneling ether-type 0x8100 <br>  set vlans v-R10 vlan-id 1010 <br>  set vlans v-r10 l3-interface vlan.1010 <br>  set vlans v-r11 vlan-id 1011 <br>  set vlans v-r11 l3-interface vlan.1011 <br>  set vlans v-R14 vlan-id 1014 <br>  set vlans v-r14 l3-interface vlan.1014 <br>  set vlans v-S1 vlan-id 1001 <br>  set vlans v-s1 l3-interface vlan.1001 <br>  set vlans v-analyzer vlan-id 101 <br>  set vlans v-analyzer dot1q-tunneling <br>  set vlans v-odroid-mgmt <br></div></div><br>  For the redirection of service traffic, port mirroring is used in VLAN with an IP filter overlay (EIGRP). <br><br>  Dynamyps and Dynagen are installed on the debug board, <br>  collected from source codes, it was emulated 7200. <br><div class="spoiler">  <b class="spoiler_title">Dynagen</b> <div class="spoiler_text">  [localhost] <br>  [[7200]] <br>  image = /opt/dgen/c7200-adventerprisek9-mz.124-4.T4.image <br>  npe = npe-400 <br>  npe2 = npe-400 <br>  ram = 160 <br>  [[ROUTER R1]] <br>  f0 / 0 = NIO_tap: tap0 <br>  f0 / 1 = NIO_tap: tap1 <br>  f1 / 1 = NIO_tap: tap2 <br></div></div><br>  R15 (virtual cisco) <br><div class="spoiler">  <b class="spoiler_title">cisco7200 - R15</b> <div class="spoiler_text">  R15 # sho running-config <br>  Building configuration ... <br><br>  Current configuration: 1203 bytes <br>  ! <br>  version 12.4 <br>  service timestamps debug datetime msec <br>  service timestamps log datetime msec <br>  no service password-encryption <br>  ! <br>  hostname R15 <br>  ! <br>  boot-start-marker <br>  boot-end-marker <br>  ! <br>  ! <br>  no aaa new-model <br>  ! <br>  resource policy <br>  ! <br>  ip subnet-zero <br>  ip cef <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  interface FastEthernet0 / 0 <br>  no ip address <br>  duplex auto <br>  speed auto <br>  no mop enabled <br>  ! <br>  interface FastEthernet0 / 0.1010 <br>  description R10 <br>  encapsulation dot1Q 1010 <br>  ip address 10.10.0.15 255.255.255.0 <br>  no snmp trap link-status <br>  ! <br>  interface FastEthernet0 / 0.1011 <br>  description R11 <br>  encapsulation dot1Q 1011 <br>  ip address 10.11.0.15 255.255.255.0 <br>  no snmp trap link-status <br>  ! <br>  interface FastEthernet0 / 1 <br>  description S1 <br>  ip address 10.1.0.15 255.255.255.0 <br>  duplex auto <br>  speed auto <br>  ! <br>  interface FastEthernet1 / 0 <br>  no ip address <br>  duplex auto <br>  speed auto <br>  ! <br>  interface FastEthernet1 / 1 <br>  description R14 <br>  ip address 10.14.0.15 255.255.255.0 <br>  duplex auto <br>  speed auto <br>  ! <br>  router eigrp 1 <br>  network 0.0.0.0 <br>  auto-summary <br>  ! <br>  ip classless <br>  no ip http server <br>  no ip http secure-server <br>  ! <br>  ! <br>  ! <br>  logging alarm informational <br>  ! <br>  ! <br>  ! <br>  ! <br>  control-plane <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  ! <br>  gatekeeper <br>  shutdown <br>  ! <br>  ! <br>  line con 0 <br>  stopbits 1 <br>  line aux 0 <br>  stopbits 1 <br>  line vty 0 4 <br>  login <br>  ! <br>  ! <br>  end <br><br>  R15 # en <br><br></div></div><br>  thus, a direct correspondence of the interfaces between K15 and R15 is obtained: <br><br>  <i>vlan.1001 - fa0 / 1</i> <i><br></i>  <i>vlan.1010 - fa0 / 1.1010</i> <i><br></i>  <i>vlan.1011 - fa0 / 0.1011</i> <i><br></i>  <i>vlan.1014 - fa1 / 1</i> <i><br></i> <br>  Now service traffic gets to odroid with a double tag, <br>  and the responses from our control plane should go to K15 with only one, ‚Äúsecond‚Äù tag. <br>  for this we stand linux bridges: <br><pre><code class="vhdl hljs">ip link add link eth0 v101 <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> vlan id <span class="hljs-number"><span class="hljs-number">101</span></span> ip link add link eth0 vl1001 <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> vlan id <span class="hljs-number"><span class="hljs-number">1001</span></span> ip link add link eth0 vl1014 <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> vlan id <span class="hljs-number"><span class="hljs-number">1014</span></span> brctl addbr br0 brctl addif br0 v101 brctl addif br0 eth0 brctl addif br0 tap0 brctl addif br0 tap1 brctl addif br0 tap2 brctl addif br0 vl1001 brctl addif br0 vl1014</code> </pre> <br>  now we need the packets to be transmitted in accordance with the logic shown by arrows in the figure, and no more. <br><img src="https://habrastorage.org/files/0c7/b3c/9e9/0c7b3c9e9b2e4b14a59e9fe81044f496.png"><br>  To do this, we will transfer the bridge to the hub mode (stops learning Macs): <br><pre> <code class="vhdl hljs">brctl setageing br0 <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  and we filter everything unnecessary: <br><pre> <code class="vhdl hljs"> ebtables -A FORWARD -i tap0 -o eth0 -j ACCEPT ebtables -A FORWARD -i tap1 -o vl1001 -j ACCEPT ebtables -A FORWARD -i tap2 -o vl1014 -j ACCEPT ebtables -A FORWARD -i v101 -o tap1 -p ipv4 <span class="hljs-comment"><span class="hljs-comment">--ip-source 10.1.0.0/24 -j ACCEPT ebtables -A FORWARD -i v101 -o tap2 -p ipv4 --ip-source 10.14.0.0/24 -j ACCEPT ebtables -A FORWARD -i v101 -o tap0 -p 802_1q -j ACCEPT ebtables -P FORWARD DROP</span></span></code> </pre><br>  in this place we are confronted with the fact that K15 and R15 have the same IP addresses, but different MAC addresses, <br>  which leads to interesting problems, we solve this with the help of ebtables too, for a start we will learn the poppy with which K15 works: <br><pre> <code class="vhdl hljs">root@K15&gt; show ethernet-switching table | match router v-R10 <span class="hljs-number"><span class="hljs-number">78</span></span>:fe:<span class="hljs-number"><span class="hljs-number">3</span></span>d:<span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> Static - Router v-R11 <span class="hljs-number"><span class="hljs-number">78</span></span>:fe:<span class="hljs-number"><span class="hljs-number">3</span></span>d:<span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> Static - Router v-R14 <span class="hljs-number"><span class="hljs-number">78</span></span>:fe:<span class="hljs-number"><span class="hljs-number">3</span></span>d:<span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> Static - Router v-S1 <span class="hljs-number"><span class="hljs-number">78</span></span>:fe:<span class="hljs-number"><span class="hljs-number">3</span></span>d:<span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> Static - Router</code> </pre><br>  now we need all the packages to leave with this poppy: <br><pre> <code class="vhdl hljs">ebtables -t nat -A POSTROUTING -o eth0 -j snat <span class="hljs-comment"><span class="hljs-comment">--to-src 78:fe:3d:11:22:33 --snat-arp --snat-target ACCEPT ebtables -t nat -A POSTROUTING -o vl1001 -j snat --to-src 78:fe:3d:11:22:33 --snat-arp --snat-target ACCEPT ebtables -t nat -A POSTROUTING -o vl1014 -j snat --to-src 78:fe:3d:11:22:33 --snat-arp --snat-target ACCEPT</span></span></code> </pre><br>  Everything, our ‚Äúcontrol plane‚Äù built RIB: <br><pre> <code class="vhdl hljs">R15#show ip route Codes: C - connected, S - static, R - RIP, M - mobile, B - BGP D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area N1 - OSPF NSSA external <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, N2 - OSPF NSSA external <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> E1 - OSPF external <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, E2 - OSPF external <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> i - <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">IS</span></span>, su - <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> summary, L1 - <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> level-<span class="hljs-number"><span class="hljs-number">1</span></span>, L2 - <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> level-<span class="hljs-number"><span class="hljs-number">2</span></span> ia - <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> inter area, * - candidate <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>, U - per-user static route o - ODR, P - periodic downloaded static route Gateway <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> last resort <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> set <span class="hljs-number"><span class="hljs-number">10.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> subnetted, <span class="hljs-number"><span class="hljs-number">9</span></span> subnets C <span class="hljs-number"><span class="hljs-number">10.10</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> directly connected, FastEthernet0/<span class="hljs-number"><span class="hljs-number">0.1010</span></span> C <span class="hljs-number"><span class="hljs-number">10.11</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> directly connected, FastEthernet0/<span class="hljs-number"><span class="hljs-number">0.1011</span></span> C <span class="hljs-number"><span class="hljs-number">10.14</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> directly connected, FastEthernet1/<span class="hljs-number"><span class="hljs-number">1</span></span> D <span class="hljs-number"><span class="hljs-number">10.12</span></span>.<span class="hljs-number"><span class="hljs-number">2.0</span></span> [<span class="hljs-number"><span class="hljs-number">90</span></span>/<span class="hljs-number"><span class="hljs-number">28416</span></span>] via <span class="hljs-number"><span class="hljs-number">10.14</span></span>.<span class="hljs-number"><span class="hljs-number">0.14</span></span>, <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span>, FastEthernet1/<span class="hljs-number"><span class="hljs-number">1</span></span> D <span class="hljs-number"><span class="hljs-number">10.12</span></span>.<span class="hljs-number"><span class="hljs-number">1.0</span></span> [<span class="hljs-number"><span class="hljs-number">90</span></span>/<span class="hljs-number"><span class="hljs-number">28416</span></span>] via <span class="hljs-number"><span class="hljs-number">10.11</span></span>.<span class="hljs-number"><span class="hljs-number">0.11</span></span>, <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span>, FastEthernet0/<span class="hljs-number"><span class="hljs-number">0.1011</span></span> D <span class="hljs-number"><span class="hljs-number">10.2</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span> [<span class="hljs-number"><span class="hljs-number">90</span></span>/<span class="hljs-number"><span class="hljs-number">30720</span></span>] via <span class="hljs-number"><span class="hljs-number">10.10</span></span>.<span class="hljs-number"><span class="hljs-number">0.10</span></span>, <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">28</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>, FastEthernet0/<span class="hljs-number"><span class="hljs-number">0.1010</span></span> D <span class="hljs-number"><span class="hljs-number">10.3</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span> [<span class="hljs-number"><span class="hljs-number">90</span></span>/<span class="hljs-number"><span class="hljs-number">28672</span></span>] via <span class="hljs-number"><span class="hljs-number">10.14</span></span>.<span class="hljs-number"><span class="hljs-number">0.14</span></span>, <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>, FastEthernet1/<span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-number"><span class="hljs-number">90</span></span>/<span class="hljs-number"><span class="hljs-number">28672</span></span>] via <span class="hljs-number"><span class="hljs-number">10.11</span></span>.<span class="hljs-number"><span class="hljs-number">0.11</span></span>, <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>, FastEthernet0/<span class="hljs-number"><span class="hljs-number">0.1011</span></span> C <span class="hljs-number"><span class="hljs-number">10.1</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> directly connected, FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span> D <span class="hljs-number"><span class="hljs-number">10.4</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span> [<span class="hljs-number"><span class="hljs-number">90</span></span>/<span class="hljs-number"><span class="hljs-number">30720</span></span>] via <span class="hljs-number"><span class="hljs-number">10.14</span></span>.<span class="hljs-number"><span class="hljs-number">0.14</span></span>, <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">03</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>, FastEthernet1/<span class="hljs-number"><span class="hljs-number">1</span></span> R15#</code> </pre><br>  now we need to send this routing information to Juniper, <br>  to do this, we use OSPF and the <a href="http://habrahabr.ru/post/195610/">features of its implementation in the default vendor.</a> <br>  We also add a link and interfaces for the exchange of information between R15 and K15: <br>  K15 <pre> <code class="vhdl hljs">set vlans v-cplane vlan-id <span class="hljs-number"><span class="hljs-number">4000</span></span> l3-interface vlan.<span class="hljs-number"><span class="hljs-number">4000</span></span> set interfaces ge-<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> unit <span class="hljs-number"><span class="hljs-number">0</span></span> family ethernet-switching vlan members v-cplane set interfaces vlan.<span class="hljs-number"><span class="hljs-number">4000</span></span> family inet address <span class="hljs-number"><span class="hljs-number">100.65</span></span>.<span class="hljs-number"><span class="hljs-number">127.129</span></span>/<span class="hljs-number"><span class="hljs-number">30</span></span> set protocols ospf area <span class="hljs-number"><span class="hljs-number">0.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span> interface vlan.<span class="hljs-number"><span class="hljs-number">4000</span></span> hello-interval <span class="hljs-number"><span class="hljs-number">1</span></span> dead-interval <span class="hljs-number"><span class="hljs-number">4</span></span> set protocols ospf area <span class="hljs-number"><span class="hljs-number">0.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span> interface vlan.<span class="hljs-number"><span class="hljs-number">1001</span></span> passive set protocols ospf area <span class="hljs-number"><span class="hljs-number">0.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span> interface vlan.<span class="hljs-number"><span class="hljs-number">1010</span></span> passive set protocols ospf area <span class="hljs-number"><span class="hljs-number">0.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span> interface vlan.<span class="hljs-number"><span class="hljs-number">1011</span></span> passive set protocols ospf area <span class="hljs-number"><span class="hljs-number">0.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span> interface vlan.<span class="hljs-number"><span class="hljs-number">1014</span></span> passive</code> </pre><br>  R15 <br><pre> <code class="vhdl hljs">R15&gt;en R15#conf t R15(config)#interface fa0/<span class="hljs-number"><span class="hljs-number">0.4000</span></span> R15(config-subif)#encapsulation dot1Q <span class="hljs-number"><span class="hljs-number">4000</span></span> R15(config-subif)#ip address <span class="hljs-number"><span class="hljs-number">100.65</span></span>.<span class="hljs-number"><span class="hljs-number">127.130</span></span> <span class="hljs-number"><span class="hljs-number">255.255</span></span>.<span class="hljs-number"><span class="hljs-number">255.252</span></span> R15(config-subif)#ip ospf hello-interval <span class="hljs-number"><span class="hljs-number">1</span></span> R15(config-subif)#ip ospf dead-interval <span class="hljs-number"><span class="hljs-number">4</span></span> R15(config-subif)#<span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> R15(config)#router eigrp <span class="hljs-number"><span class="hljs-number">1</span></span> R15(config-router)#no auto-summary R15(config-router)#<span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> R15(config)#router ospf <span class="hljs-number"><span class="hljs-number">1</span></span> R15(config-router)#network <span class="hljs-number"><span class="hljs-number">0.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span> area <span class="hljs-number"><span class="hljs-number">0</span></span> R15(config-router)#redistribute eigrp <span class="hljs-number"><span class="hljs-number">1</span></span> subnets R15(config-router)#<span class="hljs-keyword"><span class="hljs-keyword">end</span></span> R15#</code> </pre><br>  We add rules to ebtables so that the traffic in the 4000th VLAN is passed without changes. <br>  add to the beginning of the chain. <br><pre> <code class="vhdl hljs">ebtables -t nat -A POSTROUTING -p <span class="hljs-number"><span class="hljs-number">802_1</span></span>Q <span class="hljs-comment"><span class="hljs-comment">--vlan-id 4000 -j ACCEPT ebtables -A FORWARD -i eth0 -o tap0 -p 802_1q --vlan-id 4000 -j ACCEPT</span></span></code> </pre><br>  Check the availability of the necessary routes in the RIB at K15: <br><pre> <code class="vhdl hljs">root@K15&gt; show route inet.<span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-number"><span class="hljs-number">16</span></span> destinations, <span class="hljs-number"><span class="hljs-number">16</span></span> routes (<span class="hljs-number"><span class="hljs-number">16</span></span> active, <span class="hljs-number"><span class="hljs-number">0</span></span> holddown, <span class="hljs-number"><span class="hljs-number">0</span></span> hidden) + = Active Route, - = Last Active, * = Both <span class="hljs-number"><span class="hljs-number">10.1</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> *[Direct/<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span> &gt; via vlan.<span class="hljs-number"><span class="hljs-number">1001</span></span> <span class="hljs-number"><span class="hljs-number">10.1</span></span>.<span class="hljs-number"><span class="hljs-number">0.15</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> *[Local/<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-number"><span class="hljs-number">1</span></span>d <span class="hljs-number"><span class="hljs-number">03</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span> Local via vlan.<span class="hljs-number"><span class="hljs-number">1001</span></span> <span class="hljs-number"><span class="hljs-number">10.2</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> *[OSPF/<span class="hljs-number"><span class="hljs-number">150</span></span>] <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">13</span></span>:<span class="hljs-number"><span class="hljs-number">16</span></span>, metric <span class="hljs-number"><span class="hljs-number">20</span></span>, tag <span class="hljs-number"><span class="hljs-number">0</span></span> &gt; <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">10.10</span></span>.<span class="hljs-number"><span class="hljs-number">0.10</span></span> via vlan.<span class="hljs-number"><span class="hljs-number">1010</span></span> <span class="hljs-number"><span class="hljs-number">10.3</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> *[OSPF/<span class="hljs-number"><span class="hljs-number">150</span></span>] <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">13</span></span>:<span class="hljs-number"><span class="hljs-number">16</span></span>, metric <span class="hljs-number"><span class="hljs-number">20</span></span>, tag <span class="hljs-number"><span class="hljs-number">0</span></span> &gt; <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">10.14</span></span>.<span class="hljs-number"><span class="hljs-number">0.14</span></span> via vlan.<span class="hljs-number"><span class="hljs-number">1014</span></span> <span class="hljs-number"><span class="hljs-number">10.4</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> *[OSPF/<span class="hljs-number"><span class="hljs-number">150</span></span>] <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">13</span></span>:<span class="hljs-number"><span class="hljs-number">16</span></span>, metric <span class="hljs-number"><span class="hljs-number">20</span></span>, tag <span class="hljs-number"><span class="hljs-number">0</span></span> &gt; <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">10.14</span></span>.<span class="hljs-number"><span class="hljs-number">0.14</span></span> via vlan.<span class="hljs-number"><span class="hljs-number">1014</span></span> <span class="hljs-number"><span class="hljs-number">10.10</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> *[Direct/<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-number"><span class="hljs-number">1</span></span>d <span class="hljs-number"><span class="hljs-number">03</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">26</span></span> &gt; via vlan.<span class="hljs-number"><span class="hljs-number">1010</span></span> <span class="hljs-number"><span class="hljs-number">10.10</span></span>.<span class="hljs-number"><span class="hljs-number">0.15</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> *[Local/<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-number"><span class="hljs-number">1</span></span>d <span class="hljs-number"><span class="hljs-number">03</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span> Local via vlan.<span class="hljs-number"><span class="hljs-number">1010</span></span> <span class="hljs-number"><span class="hljs-number">10.11</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> *[Direct/<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-number"><span class="hljs-number">1</span></span>d <span class="hljs-number"><span class="hljs-number">03</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">26</span></span> &gt; via vlan.<span class="hljs-number"><span class="hljs-number">1011</span></span> <span class="hljs-number"><span class="hljs-number">10.11</span></span>.<span class="hljs-number"><span class="hljs-number">0.15</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> *[Local/<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-number"><span class="hljs-number">1</span></span>d <span class="hljs-number"><span class="hljs-number">03</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span> Local via vlan.<span class="hljs-number"><span class="hljs-number">1011</span></span> <span class="hljs-number"><span class="hljs-number">10.12</span></span>.<span class="hljs-number"><span class="hljs-number">1.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> *[OSPF/<span class="hljs-number"><span class="hljs-number">150</span></span>] <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">13</span></span>:<span class="hljs-number"><span class="hljs-number">16</span></span>, metric <span class="hljs-number"><span class="hljs-number">20</span></span>, tag <span class="hljs-number"><span class="hljs-number">0</span></span> &gt; <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">10.11</span></span>.<span class="hljs-number"><span class="hljs-number">0.11</span></span> via vlan.<span class="hljs-number"><span class="hljs-number">1011</span></span> <span class="hljs-number"><span class="hljs-number">10.12</span></span>.<span class="hljs-number"><span class="hljs-number">2.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> *[OSPF/<span class="hljs-number"><span class="hljs-number">150</span></span>] <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">13</span></span>:<span class="hljs-number"><span class="hljs-number">16</span></span>, metric <span class="hljs-number"><span class="hljs-number">20</span></span>, tag <span class="hljs-number"><span class="hljs-number">0</span></span> &gt; <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">10.14</span></span>.<span class="hljs-number"><span class="hljs-number">0.14</span></span> via vlan.<span class="hljs-number"><span class="hljs-number">1014</span></span> <span class="hljs-number"><span class="hljs-number">10.14</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> *[Direct/<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-number"><span class="hljs-number">1</span></span>d <span class="hljs-number"><span class="hljs-number">03</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span> &gt; via vlan.<span class="hljs-number"><span class="hljs-number">1014</span></span> <span class="hljs-number"><span class="hljs-number">10.14</span></span>.<span class="hljs-number"><span class="hljs-number">0.15</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> *[Local/<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-number"><span class="hljs-number">1</span></span>d <span class="hljs-number"><span class="hljs-number">03</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span> Local via vlan.<span class="hljs-number"><span class="hljs-number">1014</span></span> <span class="hljs-number"><span class="hljs-number">100.65</span></span>.<span class="hljs-number"><span class="hljs-number">127.128</span></span>/<span class="hljs-number"><span class="hljs-number">30</span></span> *[Direct/<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">08</span></span> &gt; via vlan.<span class="hljs-number"><span class="hljs-number">4000</span></span> <span class="hljs-number"><span class="hljs-number">100.65</span></span>.<span class="hljs-number"><span class="hljs-number">127.129</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> *[Local/<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">08</span></span> Local via vlan.<span class="hljs-number"><span class="hljs-number">4000</span></span> <span class="hljs-number"><span class="hljs-number">224.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.5</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> *[OSPF/<span class="hljs-number"><span class="hljs-number">10</span></span>] <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>, metric <span class="hljs-number"><span class="hljs-number">1</span></span> MultiRecv</code> </pre><br>  routes are in place, all servers are pinging. <br><br>  launch iperf and pump traffic between S1-S3 and S2-S4: <br><pre> <code class="vhdl hljs">root@S3:~# iperf -c <span class="hljs-number"><span class="hljs-number">10.1</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> -t <span class="hljs-number"><span class="hljs-number">10</span></span> -d <span class="hljs-comment"><span class="hljs-comment">------------------------------------------------------------ Server listening on TCP port 5001 TCP window size: 85.3 KByte (default) ------------------------------------------------------------ ------------------------------------------------------------ Client connecting to 10.1.0.1, TCP port 5001 TCP window size: 413 KByte (default) ------------------------------------------------------------ [ 5] local 10.3.0.3 port 33375 connected with 10.1.0.1 port 5001 [ 4] local 10.3.0.3 port 5001 connected with 10.1.0.1 port 51122 [ ID] Interval Transfer Bandwidth [ 5] 0.0-10.0 sec 1.09 GBytes 939 Mbits/sec [ 4] 0.0-10.0 sec 1.08 GBytes 928 Mbits/sec</span></span></code> </pre><br><pre> <code class="vhdl hljs">root@S4:~# iperf -c <span class="hljs-number"><span class="hljs-number">10.2</span></span>.<span class="hljs-number"><span class="hljs-number">0.2</span></span> -t <span class="hljs-number"><span class="hljs-number">10</span></span> -d <span class="hljs-comment"><span class="hljs-comment">------------------------------------------------------------ Server listening on TCP port 5001 TCP window size: 85.3 KByte (default) ------------------------------------------------------------ ------------------------------------------------------------ Client connecting to 10.2.0.2, TCP port 5001 TCP window size: 82.5 KByte (default) ------------------------------------------------------------ [ 5] local 10.4.0.4 port 59485 connected with 10.2.0.2 port 5001 [ 4] local 10.4.0.4 port 5001 connected with 10.2.0.2 port 41829 [ ID] Interval Transfer Bandwidth [ 5] 0.0-10.0 sec 111 MBytes 92.5 Mbits/sec [ 4] 0.0-10.3 sec 102 MBytes 83.2 Mbits/sec</span></span></code> </pre><br><br>  make sure that normal traffic runs wire speed. <br>  at the same time, during the entire testing time, the EIGRP neighborhood is not broken. <br>  and that‚Äôs what they wanted. <br><br>  limitations: <br>  1. link aggregation is not considered. <br>  2. Considered option only for RVI (Routed VLAN Interface). <br>  3. Traffic balancing does not work, only one route is given to the switch. <br>  4. slow convergence of the routing protocol, since  based only on hello packages (the control plane does not see the port status and there is no BFD) <br>  5. about 6-7 times the complicated configuration, since  instead of one protocol on one device, we set up a whole set of protocols and rules on actually 3 entities. </div><p>Source: <a href="https://habr.com/ru/post/262047/">https://habr.com/ru/post/262047/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262035/index.html">Setting up the Express panel in the weekly assembly Vivaldi 1.0.219.3</a></li>
<li><a href="../262037/index.html">Books for the system administrator. My bookshelf</a></li>
<li><a href="../262039/index.html">Baidu anti-virus software removal procedure</a></li>
<li><a href="../262043/index.html">Permanent loss of EC2 instance, EBS volumes and all snapshots</a></li>
<li><a href="../262045/index.html">Processing 1 million requests per minute with Go</a></li>
<li><a href="../262049/index.html">OpenStack - deployed "hands" Kilo</a></li>
<li><a href="../262051/index.html">Development of trainings in the grocery company</a></li>
<li><a href="../262053/index.html">We collect people base from open data WhatsApp and VK</a></li>
<li><a href="../262055/index.html">The word ‚ÄúM‚Äù, or Monads, is already here.</a></li>
<li><a href="../262057/index.html">Twelve simple initial steps to developing a module for Node.js</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>