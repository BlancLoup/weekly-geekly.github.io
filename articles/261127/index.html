<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Delete phantom server entries from SCVMM</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I want to tell how you can remove information about incorrectly remote servers from the VMM console. For example, in my case, they rem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Delete phantom server entries from SCVMM</h1><div class="post__text post__text-html js-mediator-article">  In this article I want to tell how you can remove information about incorrectly remote servers from the VMM console.  For example, in my case, they removed the Hyper-V role from one of the former virtualization servers, installed a clean OS and gave it to other tasks, and forgot to disconnect from the VMM console.  As a result, when trying to remove regular means it turned out like this: <br><br><img src="https://habrastorage.org/files/c96/b54/340/c96b543400d341a984725254c80efd4c.jpg" alt="image"><br><a name="habracut"></a><br>  Actually, now with this server nothing can be done either from the GUI or from PowerShell.  The result will be something like this: <br><br><img src="https://habrastorage.org/files/427/710/4e2/4277104e2a834f919d804281571740f4.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Since all data about server clusters and other VMM virtual machines is stored in MS SQL database, we will clear it of records about this node.  Pre-worth a backup of the VMM database. <br><br>  For this we need Sql Management Studio.  Having started that, we will connect to the VMM database and find the identifier of the host we need by running the query: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> VirtualManagerDB <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> HostID, computerName <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dbo.tbl_ADHC_Host</code> </pre> <br><br>  If we immediately try to delete the host entry: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> VirtualManagerDB <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dbo.tbl_ADHC_Host <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> HostID <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> <span class="hljs-string"><span class="hljs-string">'hostid'</span></span></code> </pre> <br><br>  Then we get only an error message due to dependencies.  To successfully delete this record, we need to first delete everything related to the HostID defined by us in the following tables: <br><br><pre> <code class="sql hljs">dbo.tbl_NetMan_InstalledVirtualSwitchExtension dbo.tbl_ADHC_HostBusAdapter dbo.tbl_ADHC_VirtualNetwork dbo.tbl_ADHC_HostVolume dbo.tbl_ADHC_HostDisk</code> </pre> <br><br>  <i>dbo.tbl_ADHC_HostBusAdapter - when deleting a record from this table, I had an error referring to <i>dbo.tbl_ADHC_HostInternetSCSIHba.</i></i> <i><i><br><br></i></i>  <i><i>There is no HostID in the dbo.tbl_ADHC_HostInternetSCSIHba table and therefore you will have to output all the records from it to determine the id of the ISCSIHbaID we need</i></i> <i><i><br><br></i></i> <pre> <i><i><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> VirtualManagerDB <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dbo.tbl_ADHC_HostInternetSCSIHba</code></i></i> </pre> <i><i><br><br></i></i>  <i><i>And after that we delete the record:</i></i> <i><i><br><br></i></i> <pre> <i><i><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> VirtualManagerDB <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dbo.tbl_ADHC_HostInternetSCSIHba <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> <span class="hljs-string"><span class="hljs-string">'ISCIHbaID'</span></span></code></i></i> </pre> <i><i><br><br></i></i>  <i><i>Now the deletion of a record from the <i>dbo.tbl_ADHC_HostBusAdapter</i> table is successful.</i></i> <i><i><br><br></i></i>  <i><i>Finally, we delete the entry from the host table:</i></i> <i><i><br><br></i></i> <pre> <i><i><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> VirtualManagerDB <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dbo.tbl_ADHC_Host <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> HostID <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> <span class="hljs-string"><span class="hljs-string">'hostid'</span></span></code></i></i> </pre> <i><i><br><br></i></i>  <i><i>Now, having restarted the VMM console, we will see that there is no longer a ‚Äúhung‚Äù server.</i></i> <i><i><br><br><img src="https://habrastorage.org/files/09b/c17/b11/09bc17b117ec48399d90cca478f8f39a.jpg" alt="image"></i></i> </div><p>Source: <a href="https://habr.com/ru/post/261127/">https://habr.com/ru/post/261127/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../261113/index.html">K-Meleon 75: Reached the final</a></li>
<li><a href="../261115/index.html">Porting OpenWRT to a new device on the example of ASUS DSL N12U</a></li>
<li><a href="../261117/index.html">The electronic teacher for blind on Arduino</a></li>
<li><a href="../261119/index.html">Western bestsellers in our book market. Career IT Project Manager</a></li>
<li><a href="../261123/index.html">Eat filed, sit down, please connect</a></li>
<li><a href="../261131/index.html">Internal representation of values ‚Äã‚Äãin PHP 7 (part 2)</a></li>
<li><a href="../261133/index.html">Vulnerability iOS and OS X, the success of Bethesda, a reward from Google - and other news of the week for a mobile developer</a></li>
<li><a href="../261137/index.html">Fast filter catalog for online stores based on Redis bitmaps</a></li>
<li><a href="../261139/index.html">How we developed our DNS manager</a></li>
<li><a href="../261141/index.html">JavaScript Modules</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>