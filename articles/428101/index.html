<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to automate with Jenkins the assembly and rolling-out of artifacts of the metadata model for tables in the repository</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It all started with the fact that we were faced with the need to quickly and correctly form the structures of EDWEX, JSON, DDL and then roll them onto...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to automate with Jenkins the assembly and rolling-out of artifacts of the metadata model for tables in the repository</h1><div class="post__text post__text-html js-mediator-article">  It all started with the fact that we were faced with the need to quickly and correctly form the structures of EDWEX, JSON, DDL and then roll them onto different contours of relational databases.  By contours, I mean familiar abbreviations - DEV, TST, UAT, PRD. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/169/a9a/387/169a9a387c429ecc2c76fa39abb3527f.jpg"><br><br>  At that time, we did almost everything manually: and generated DDL, and collected edwex-s and json-based metadata from Oracle database.  Input parameters set.  Miss one - and incorrectly form the essence.  And since the whole process of formation was consistent and continuous, the error will be revealed only at the very end.  How we have automated everything and overcame errors, read under the cut. <br><a name="habracut"></a><br><h2>  Little about infrastructure </h2><br>  Before filling data into relational database tables, we need to accept them from the source - in any format, for example, in Excel.  Data from the source using the in-house mechanism is transported to Hadoop (Data Lake).  On Hadoop, the Hive add-in is installed - with its help we can view the contents of files using an SQL-like syntax. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To transfer the data to Data Lake in the form of tables, we need json'y, which are formed on the basis of metadata.  To parse the data in Excel format, we need to create EDWEX files.  EDWEX (EDW_EXTRACTOR) files are a set of artifacts that contain sets of tables with names, as well as sets of fields for each of these tables, which are formed based on metadata.  Depending on the model version and source ID, the field set is different.  The formation of the DDL is necessary to create the tables themselves in the Hive database at the operational data level and in the Greenplum database at the level of detailed and aggregated data.  That is, the data is initially transferred to Hive, if necessary, filtered and transferred to the Greenplum for subsequent manipulations with the data and creating windows based on them. <br><br><div class="spoiler">  <b class="spoiler_title">Example edwex artifacts</b> <div class="spoiler_text">  pack - contains a set of tables <br>  data - contains a set of fields <br><br>  pack.edwex: <br><br><pre><code class="sql hljs">1 Table_1 User Table_1 bid between to_char($fromdt,'yyyymm') and to_char($actualdt,'yyyymm') 2 Table_2 User Table_2 curbid between to_char($fromdt,'yyyymm') and to_char($actualdt,'yyyymm') 3 Table_3 User Table_3 bid between to_char($fromdt,'yyyymm') and to_char($actualdt,'yyyymm')</code> </pre> <br><br>  data.edwex: <br><br><pre> <code class="sql hljs">1 1 CHARGE_ID NUMBER 38 0 1 2 SVC_ID NUMBER 38 0 1 3 VND_ID NUMBER 38 0 1 4 PRICE NUMBER 38 5 1 5 QUANTITY NUMBER 38 5 1 6 BASE NUMBER 38 5 1 7 TAX NUMBER 38 5 1 8 TOTAL NUMBER 38 5 1 9 TAX_RATE NUMBER 38 5 1 10 TAX_IN VARCHAR 1 1 11 CHARGE_KIND VARCHAR 3 1 12 PRIVILEGE_ID NUMBER 38 0 1 13 CHARGE_REF_ID NUMBER 38 0 1 14 EBID NUMBER 38 0 1 15 INVOICE_ID NUMBER 38 0 1 16 ZERO_STATE_ID NUMBER 38 0 1 17 USER_ID NUMBER 38 0 1 18 BID NUMBER 38 0 1 19 QUANTITY_REAL NUMBER 38 5 2 1 CURBID NUMBER 38 0 2 2 USER_ID NUMBER 38 0 2 3 VND_ID NUMBER 38 0 2 4 APPBID NUMBER 38 0 2 5 SVC_ID NUMBER 38 0 2 6 DEBT NUMBER 38 5 2 7 INSTDEBT NUMBER 38 5 3 1 INVOICE_ID NUMBER 38 0 3 2 INVOICE_DATE DATE 3 3 INVOICE_NUM VARCHAR 64 3 4 INVOICE_NUM_N NUMBER 38 5 3 5 BASE NUMBER 38 5 3 6 TAX NUMBER 38 5 3 7 TOTAL NUMBER 38 5 3 8 PREPAID VARCHAR 1 3 9 EXPLICIT VARCHAR 1 3 10 VND_ID NUMBER 38 0 3 11 ADV_PAYMENT_ID NUMBER 38 0 3 12 MDBID NUMBER 38 0 3 13 BID NUMBER 38 0 3 14 USER_ID NUMBER 38 0 3 15 ZERO_STATE_ID NUMBER 38 0 3 16 ACTIVE_SUM NUMBER 38 5 3 17 SPLIT_VND NUMBER 38 5 3 18 PRECREATED VARCHAR 1</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Json artifact example</b> <div class="spoiler_text"><pre> <code class="java hljs">Table.json: { <span class="hljs-string"><span class="hljs-string">"metadata"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"charge_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"true"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"2"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"svc_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"3"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"vnd_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"4"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"price"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"5"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"quantity"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"6"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"base"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"7"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"tax"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"8"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"total"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"9"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"tax_rate"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"10"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"tax_in"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"STRING"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"11"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"charge_kind"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"STRING"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"12"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"privilege_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"13"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"charge_ref_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"14"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"ebid"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"15"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"invoice_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"16"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"zero_state_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"17"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"user_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"18"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"bid"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"19"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"quantity_real"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> } ], <span class="hljs-string"><span class="hljs-string">"ctlPath"</span></span>:<span class="hljs-string"><span class="hljs-string">"  ctl"</span></span>, <span class="hljs-string"><span class="hljs-string">"errPath"</span></span>:<span class="hljs-string"><span class="hljs-string">"    "</span></span>, <span class="hljs-string"><span class="hljs-string">"inPath"</span></span>:<span class="hljs-string"><span class="hljs-string">"    hdfs"</span></span>, <span class="hljs-string"><span class="hljs-string">"outSchema"</span></span>:<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"outTable"</span></span>:<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"isPartitioned"</span></span>:<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"sourceId"</span></span>:<span class="hljs-string"><span class="hljs-string">"id  "</span></span> }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">DDL artifact example</b> <div class="spoiler_text">  alter table scheme.GP_000001_TABLE rename to Z_GP_000001_TABLE_20180807; <br>  create table scheme.GP_000001_TABLE <br>  ( <br><br>  `charge_id` DECIMAL (38,0), <br>  `svc_id` DECIMAL (38,0), <br>  `vnd_id` DECIMAL (38,0), <br>  `price` DECIMAL (38,5), <br>  `quantity` DECIMAL (38,5), <br>  `base` DECIMAL (38,5), <br>  `tax` DECIMAL (38,5), <br>  `total` DECIMAL (38,5), <br>  `tax_rate` DECIMAL (38,5), <br>  `tax_in` STRING, <br>  `charge_kind` STRING, <br>  `privilege_id` DECIMAL (38,0), <br>  `charge_ref_id` DECIMAL (38,0), <br>  `ebid` DECIMAL (38,0), <br>  `invoice_id` DECIMAL (38,0), <br>  `zero_state_id` DECIMAL (38,0), <br>  `user_id` DECIMAL (38,0), <br>  `bid` DECIMAL (38,0), <br>  `quantity_real` DECIMAL (38,5), <br>  `load_dttm` TIMESTAMP, <br>  `src_id` SMALLINT, <br>  `package_id` BIGINT, <br>  `wf_run_id` BIGINT, <br>  `md5` STRING <br>  ) <br>  ROW FORMAT DELIMITED FIELDS TERMINATED BY '\ t' <br>  STORED AS INPUTFORMAT 'org.apache.hadoop.mapred.TextInputFormat' OUTPUTFORMAT 'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat' <br>  LOCATION 'way to form in hdfs' <br>  TBLPROPERTIES ('auto.purge' = 'true', 'transient_lastDdlTime' = '1489060201'); <br>  insert into scheme.GP_000001_TABLE (`charge_id`, <br>  `svc_id`, <br>  `vnd_id`, <br>  `price`, <br>  `quantity`, <br>  `base`, <br>  `tax`, <br>  `total`, <br>  `tax_rate`, <br>  `tax_in`, <br>  `charge_kind`, <br>  `privilege_id`, <br>  `charge_ref_id`, <br>  `ebid`, <br>  `invoice_id`, <br>  `zero_state_id`, <br>  `user_id`, <br>  `bid`, <br>  `quantity_real`, <br>  `load_dttm`, <br>  `src_id`, <br>  `package_id`, <br>  `wf_run_id`, <br>  `md5`) <br><br>  select `charge_id`, <br>  `svc_id`, <br>  `vnd_id`, <br>  `price`, <br>  `quantity`, <br>  `base`, <br>  `tax`, <br>  `total`, <br>  `tax_rate`, <br>  `tax_in`, <br>  `charge_kind`, <br>  `privilege_id`, <br>  `charge_ref_id`, <br>  `ebid`, <br>  `invoice_id`, <br>  `zero_state_id`, <br>  `user_id`, <br>  `bid`, <br>  `quantity_real`, <br>  load_dttm <br>  src_id <br>  package_id, <br>  wf_run_id, <br>  md5 from scheme.Z_GP_000001_TABLE_20180807; <br><br>  alter table scheme.GP_000001_TABLE rename to Z_GP_000001_TABLE_20180807; <br>  create table scheme.GP_000001_TABLE <br>  ( <br><br>  `charge_id` DECIMAL (38,0), <br>  `svc_id` DECIMAL (38,0), <br>  `vnd_id` DECIMAL (38,0), <br>  `price` DECIMAL (38,5), <br>  `quantity` DECIMAL (38,5), <br>  `base` DECIMAL (38,5), <br>  `tax` DECIMAL (38,5), <br>  `total` DECIMAL (38,5), <br>  `tax_rate` DECIMAL (38,5), <br>  `tax_in` STRING, <br>  `charge_kind` STRING, <br>  `privilege_id` DECIMAL (38,0), <br>  `charge_ref_id` DECIMAL (38,0), <br>  `ebid` DECIMAL (38,0), <br>  `invoice_id` DECIMAL (38,0), <br>  `zero_state_id` DECIMAL (38,0), <br>  `user_id` DECIMAL (38,0), <br>  `bid` DECIMAL (38,0), <br>  `quantity_real` DECIMAL (38,5), <br>  `load_dttm` TIMESTAMP, <br>  `src_id` SMALLINT, <br>  `package_id` BIGINT, <br>  `wf_run_id` BIGINT, <br>  `md5` STRING <br>  ) <br>  ROW FORMAT DELIMITED FIELDS TERMINATED BY '\ t' <br>  STORED AS INPUTFORMAT 'org.apache.hadoop.mapred.TextInputFormat' OUTPUTFORMAT 'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat' <br>  LOCATION 'way to form in hdfs' <br>  TBLPROPERTIES ('auto.purge' = 'true', 'transient_lastDdlTime' = '1489060201'); <br>  insert into scheme.GP_000001_CPA_CHARGE (`charge_id`, <br>  `svc_id`, <br>  `vnd_id`, <br>  `price`, <br>  `quantity`, <br>  `base`, <br>  `tax`, <br>  `total`, <br>  `tax_rate`, <br>  `tax_in`, <br>  `charge_kind`, <br>  `privilege_id`, <br>  `charge_ref_id`, <br>  `ebid`, <br>  `invoice_id`, <br>  `zero_state_id`, <br>  `user_id`, <br>  `bid`, <br>  `quantity_real`, <br>  `load_dttm`, <br>  `src_id`, <br>  `package_id`, <br>  `wf_run_id`, <br>  `md5`) <br><br>  select `charge_id`, <br>  `svc_id`, <br>  `vnd_id`, <br>  `price`, <br>  `quantity`, <br>  `base`, <br>  `tax`, <br>  `total`, <br>  `tax_rate`, <br>  `tax_in`, <br>  `charge_kind`, <br>  `privilege_id`, <br>  `charge_ref_id`, <br>  `ebid`, <br>  `invoice_id`, <br>  `zero_state_id`, <br>  `user_id`, <br>  `bid`, <br>  `quantity_real`, <br>  load_dttm <br>  src_id <br>  package_id, <br>  wf_run_id, <br>  md5 from scheme.Z_GP_000001_TABLE_20180807; <br></div></div><br><h2>  How to automate </h2><br>  To solve the problem, we used: <br><br><ul><li>  Jenkins - as an orchestrator and a tool for implementing the CI process. <br></li><li>  Python - it implements the functionality and unit tests. <br></li><li>  SQL - to access the metadata database. <br></li><li>  Shell script - for copying artifacts between directories and generating scripts in multijob projects running on a Jenkins server. <br></li></ul><br>  To begin with, we initially work with a large number of sources, therefore, using the Shell script as a launch parameter, we transfer source IDs to SQL functions to identify them.  The resulting SQL functions will subsequently be automatically executed in the metadata database.  Based on the available metadata, these functions form a file with a list of new SQL functions for each of the source tables, so that we can subsequently call them in an executable program.  The result of the execution of the generated functions is the transfer of the values ‚Äã‚Äãof DDL, JSON or EDWEX to the output parameter. <br><br>  It connects Python, which is written all the executable functionality and unit-tests.  Before running any of the modules for rolling out artifacts with the help of unit tests, the correct transfer of parameters for running python scripts is checked.  Tests not only check the correctness of the input parameters, but also their presence in the metadata module, the size of the created files and the date they were created.  Tests also monitor the number of new artifacts created and the number of existing artifacts.  So we optimize the use of server resources, since we take only new files for rolling out and do not install existing models again. <br><br>  And only after successful completion of all checks, the python program is executed, which creates the necessary artifacts and lays out the result in the required project folders on the server.  Python not only splits the generated json files into directories, but also structures them into Data Lake so that the data loads correctly.  When generating DDL artifacts, they are not only saved for later analysis and reuse, but can also be immediately installed in the database using new models and structures specified in the metadata module.  This allows you to create hundreds of tables in a short time without involving manual labor. <br><br><h2>  And where is Jenkins? </h2><br>  Jenkins enters when it is necessary to control all these processes visually using the interface. <br><br>  This tool was chosen because it: <br><br><ul><li>  fully covers the automation requirements of assembly and installation <br></li><li>  allows you to design a mechanism for assembling artifacts with the implementation of the autotesting process <br></li><li>  allows you to easily manage startup jobs and performance monitoring to a person far from programming <br></li><li>  allows you to configure the logging mechanism in such a way that the result of the execution will be clear to anyone in the team  The problem in the assembly will obviously be indicated or the process will be executed successfully. <br></li></ul><br>  To solve the tasks we have created several multijob projects.  This type of project was used, since it can work in parallel with other jobs at one-time start.  Each of the jobs is responsible for the implementation of its block of functionality.  So we replaced the sequential process of obtaining artifacts on stand-alone parallel ones.  Everything runs separately: the formation of EDWEX, JSON, DDL, the formation of structure in HIVE, the installation of table structures in the database.  We analyze the result obtained at different stages of artifact formation and proceed to launch subsequent actions in case of success. <br><br>  Jenkins-part is implemented without any special tricks.  Input Jobs are given <b>String</b> or <b>Run</b> parameters to run python code.  <b>The String</b> parameter is a window for entering values ‚Äã‚Äãof type str before starting.  <b>The Run</b> parameter can be transferred on the fly to another job for execution; all you need to do is just to specify from which project you need to pick up the resulting variable.  A separate parameter is also passed to the node for execution.  This is where the splitting of runtime environments into DEV, TST, UAT, PRD is implemented.  Separate Jobs made the transfer of the received EDWEX files to the SVN with the revision number to be able to track the versions of the modified structures. <br><br>  Jenkins interface example: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/00f/250/8c5/00f2508c5c04082a8b753041e471fe14.png"><br><br>  The result of the execution of jobs is the creation and installation of the necessary artifacts, their transfer to SVN and the generation of an HTML report that reflects the success of the unit tests and the results of the assembly and installation of artifacts.  Joby can be launched either by hands separately or in automatic mode, having previously built a chain of execution. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/324/549/50f/32454950f7eb0476ca4cc753715c4472.png"><br>  <i>Architecture of the assembly mechanism and installation</i> <br><br><h3>  Summarize </h3><br>  Much work has been done to automate the formation of artifacts.  Previously, you had to manually climb onto the server, run shell scripts, and then study and edit the data with your hands for a long time.  Now it‚Äôs enough to just press the start button, specify the source system ID, model number and contour of the execution.  With Jenkins, we managed to structure and divide the entire assembly and installation mechanism of artifacts into independent stages.  Necessary checks were added before launching the formation of artifacts and their integration.  The resulting artifacts are automatically transferred to the SVN, which simplifies working with them to adjacent teams of system analysts and data modelers.  Implemented checks to avoid idle launches of artifact formation and to confirm their correctness. <br><br>  As a result, we have reduced the time-consuming process of assembling and installing model artifacts from a few hours to a couple of minutes.  And most importantly, eliminated the occurrence of errors due to the human factor, which inevitably arose in a complex routine process. </div><p>Source: <a href="https://habr.com/ru/post/428101/">https://habr.com/ru/post/428101/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../428089/index.html">"Calendar tester" for October. Feedback: as it happens</a></li>
<li><a href="../428091/index.html">How an intern student created the world's most popular video game, or the history of Windows games</a></li>
<li><a href="../428095/index.html">Market research of web-studios and digital-agencies</a></li>
<li><a href="../428097/index.html">Recursive routing to MikroTik through DHCP designated gateways</a></li>
<li><a href="../428099/index.html">What do common dress and upcoming 5G era have in common?</a></li>
<li><a href="../428103/index.html">Mitap in Petersburg: Data Engineering and not only</a></li>
<li><a href="../428105/index.html">Blogger recommends: influence-marketing</a></li>
<li><a href="../428107/index.html">Containerizing Angular 6 SPA Template ASP .NET Core 2.1 Applications</a></li>
<li><a href="../428109/index.html">Corporate wall</a></li>
<li><a href="../428111/index.html">Arithmetic of arbitrary precision in Erlang</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>