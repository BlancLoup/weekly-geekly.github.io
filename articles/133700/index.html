<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Integrating Qt applications into Mac OS X (using Cocoa and Objective-C ++)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day to all! 

 I recently wrote about customizing the window title in Mac OS X and received requests to write in more detail about the interactio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Integrating Qt applications into Mac OS X (using Cocoa and Objective-C ++)</h1><div class="post__text post__text-html js-mediator-article">  Good day to all! <br><br>  I recently wrote about <a href="http://habrahabr.ru/blogs/macosx/133593/">customizing the window title in Mac OS X</a> and received requests to write in more detail about the interaction of Qt and Cocoa.  I think the topic can be expanded a bit and write about the integration of applications written with Qt on Mac OS X. I‚Äôll make a reservation that Qt for Cocoa is used in this case, if you take Qt for Carbon, you will only have to work with carbon.  But it is morally obsolete, and it is worth using it only in extreme cases. <br><br><img src="https://habrastorage.org/storage1/5565e6ab/0908f1ba/12a2197b/07933e19.png" align="left">  A regular Qt program has a number of inconsistencies with the Apple HIG.  More precisely, it can have, since not all programs need additional functionality.  For example, not any program needs to have a badge over the icon in the dock, expand the dock menu or take out / duplicate certain functions in the Mac menu. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But what to do if you need such functionality?  If you need to display in the dock the number of notifications (a la skype), handle click on the dock icon, add your menu items to the dock, and even have a normal menu, in general, make the program look like it is in Mac OS?  Some of this can be done using Qt's standard or semi-documented functions, and something can only be done using Cocoa and, accordingly, Objective-C ... What to do? <br><br><a name="habracut"></a>  <b>Objective-C ++</b> will help us! <br><br>  What kind of animal is it and what is it eaten with?  In fact, it is an opportunity to combine Objective-C and C ++ classes in one source file.  Moreover, the heading extension remains standard (.h), but for the source you need to specify the .mm extension, so that the compiler can eat it and not choke. <br><br>  Now imagine that we have a certain (maybe even large) project written with Qt.  Initially, it was written under Windows or Linux, but now it needs to be transferred to a makos, so much so that it is beautiful and comfortable, so that makovods do not wrinkle their nose at the sight of this monster. <br><br>  It is clear that first we need to tweak the interface of the program under the Apple HIG, without it, nowhere, but this will remain beyond the scope of this article, I will mention only the useful Q_WS_ * defines, which allow you to compile different code for different OSes.  We will talk about how you can tune your application for a new environment (or how to create a Mac application on Qt from scratch - it depends on your goals). <br><br>  So let's go in order. <br><br><h4>  General integration </h4><br><br>  First we give the name and icon of the program.  No, not the name that the bundle has, but the name that will be displayed in the Application Menu.  To do this, we need our own Info.plist file, not the one that qmake generates.  This is done in a single line in .pro: <br><br><pre><code class="hljs">macx: QMAKE_INFO_PLIST = MyInfo.plist</code> </pre> <br>  In our .plist write something like this: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plist</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>LSHasLocalizedDisplayName<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">true</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>CFBundleIconFile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>myicon.icns<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>CFBundlePackageType<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>APPL<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>CFBundleGetInfoString<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>Created by Qt/QMake<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>CFBundleSignature<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>????<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>CFBundleExecutable<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>MyAppName<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>CFBundleIdentifier<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>com.mycompany.myapp<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>NOTE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>This file was generated by Qt/QMake.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plist</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Of course, instead of ‚ÄúMyAppName‚Äù and ‚Äúcom.mycompany.myapp‚Äù, we write the English name of the program and our own bundle ID.  Why English?  Yes, because we localize it in another file.  This is indicated by the very first parameter in the list: LSHasLocalizedDisplayName.  Create a directory "ru.lproj", and in her file InfoPlist.strings.  We write something to this file: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* Localized versions of Info.plist keys */</span></span> CFBundleName = <span class="hljs-string"><span class="hljs-string">"  "</span></span>; CFBundleDisplayName = <span class="hljs-string"><span class="hljs-string">""</span></span>;</code> </pre><br>  Here you need to specify the localized name of the bundle and the name displayed in the Application Menu.  For this to work, you need to copy this directory into AppName.app/Contents/Resources when installing the program, do it better by specifying INSTALLS in the .pro file, please refer to the qmake documentation for details.  The screenshot shows that the Application Menu has a Russian name, despite the fact that the bundle itself has a name in Latin. <br><br><img src="https://habrastorage.org/storage1/acdb8154/6d0969bb/cbf1d9b8/ec95d7d1.png"><br>  To set the program icon (see myicon.icns in the file MyInfo.plist), we need the .icns file, which can be created by yourself in a graphical editor, or converted from .ico or a handful of .png using <a href="http://projects.digitalwaters.net/index.php%3Fq%3Dfasticns">programs</a> or <a href="http://iconverticons.com/">online services</a> .  To make the icon look good, it‚Äôs better to make several sizes in it: 512x512, 256x256, 128x128, 64x64, 48x48, 32x32, 16x16.  The system will choose which size to display in which situation.  The file with the icon must also be installed in Resources.  The easiest way to get it installed is to write the following in the .pro file: <br><br><pre> <code class="hljs">macx: ICON = myicon.icns</code> </pre><br><h4>  Code separation </h4><br><br>  Objective-C ++ has many limitations.  It is impossible, for example, to include a header with the declaration of the Objective-C class interface in the source file .cpp, because the compiler will choke.  For new projects that are designed only for Mac OS X, this will not be a limitation, because you can keep all C ++ code in .mm files and enjoy life.  But the meaning of Qt in cross-platform, so we assume that our source is still in the .cpp files. <br><br>  The way out is simple.  We need to create a "wrapper" for Objective-C calls and classes in C ++.  I chose this structure: there is a Qt / C ++ class that provides integration with Mac OS X. It does some work on its own, and delegates some work to a ‚Äúdelegate‚Äù, a private class actively using Cocoa / Objective-C.  In this case, we obtain the following files: <br><br>  * myclass.h - header of the main class <br>  * myclass.cpp - implementation <br>  * myclass_p.h - header of the private class (without Objective-C-interfaces) <br>  * myclass_p.mm - sources of a private class, may include interfaces and implementation of Objective-C classes, include any headers, etc. <br><br>  Thus, we clearly distinguish between C ++ and Objective-C ++. <br><br>  By the way, in order for Objective-C ++ to work, in the .pro file, all headers / sources that use it must be placed in the OBJECTIVE_HEADERS and OBJECTIVE_SORCES sections.  And, of course, do it inside the macx block: {}.  And also, if we want to use Cocoa, then we need to add this framework to the project.  We write in .pro: <br><br><pre> <code class="hljs">macx: QMAKE_LFLAGS += -framework Cocoa</code> </pre><br>  And now goes interesting. <br><br><h4>  Work with Dock </h4><br><br>  Consider the five main functions of working with the dock: adding a badge, adding an overlay, handling a click on the icon in the dock, ‚Äúflipping‚Äù the program icon in the dock and adding your own menu.  With Qt, you can solve only the last problem, and even then the weakly documented function qt_mac_set_dock_menu (QMenu *).  And you need to declare it yourself, as external: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">qt_mac_set_dock_menu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QMenu *)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// Qt internal function</span></span></code> </pre><br>  The menu, based on personal experience, imposes some restrictions in comparison with the ‚Äúnative‚Äù Makovsky menu: <br><br>  * inactive (disabled) menu items become for some reason active <br>  * QMenu doesn‚Äôt emittit aboutToHide and aboutToShow signals <br>  * you cannot indent any elements <br>  * if the first QAction in the menu is a separator, then it will be visible (unlike all other manifestations of QMenu) <br><br>  So under this will have to adapt.  You can, of course, do everything on Objective-C / Cocoa, but then you have to make your own QAction mapping mechanism and native menu items.  But it makes sense to do it only if there is a really big need to eliminate these limitations. <br><br><img src="https://habrastorage.org/storage1/f2b9ec4a/2f4af415/872c8633/20dd078a.png"><br>  Consider now click on the dock.  If we wrote to Cocoa, then there would be no problems, it would be enough to implement the applicationShouldHandleReopen: hasVisibleWindows: method in AppDelegate.  But we do not have direct access to the program delegate created in the depths of Qt.  Therefore, we will use <i>runtime magic</i> to add an implementation of this method.  First, let's declare a function that will implement what we need.  To do this, turn our private class into a singleton (we still do not need more than one object of this class) and write the following function: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dockClickHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id self, SEL _cmd)</span></span></span><span class="hljs-function"> </span></span>{ Q_UNUSED(self) Q_UNUSED(_cmd) MyPrivate::instance()-&gt;emitClick(); }</code> </pre><br>  The function is dead without embedding it in the delegate.  Let's not hesitate with this! <br><br><pre> <code class="cpp hljs">MyPrivate::MyPrivate() : QObject(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { Class cls = [[[NSApplication sharedApplication] delegate] class]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!class_addMethod(cls, @selector(applicationShouldHandleReopen:hasVisibleWindows:), (IMP) dockClickHandler, <span class="hljs-string"><span class="hljs-string">"v@:"</span></span>)) NSLog(@<span class="hljs-string"><span class="hljs-string">"MyPrivate::MyPrivate() : class_addMethod failed!"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> MyPrivate::emitClick() { <span class="hljs-function"><span class="hljs-function">emit </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dockClicked</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre><br>  Here we take the delegate class of our application and add a method to it on the fly.  And at the same time we are implementing the emitClick () method, emitting a Qt-signal about a click.  Actually, that's all, now by clicking on the dock we can show, for example, the main window of the program. <br><br>  Then you can try to throw the program icon in the dock.  The very first thought: ‚Äúthis is how QApplication :: alert (QWidget *) can do the same!‚Äù The thought is correct, but it is prematurely optimistic.  The thing is that in Mac OS X 10.6. * This function works as it should, but in 10.7. * For some reason it does not want (maybe this is due to the fact that Qt 4.7.x does not officially support Lion, but at 4.8 it will be fixed).  I did not begin to understand why this is happening, and I just wrote a fling on Cocoa, since this is done in one line: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> MyPrivate::requestAttention() { [NSApp requestUserAttention: NSInformationalRequest]; }</code> </pre><br>  And let this piece of code duplicate Qt-shny alert (), but it will work in all versions of Mac OS X. And for other systems, you can still use alert (). <br><br>  Now let's deal with the badge.  If someone does not know, then this is a red circle with text displayed over the program icon in the dock.  For example, it is used to display the number of unread emails in Mail.app.  Apple's documentation says it should be done like this: <br><br><pre> <code class="cpp hljs">[[NSApp dockTile] setBadgeLabel: badgeString];</code> </pre><br>  Here badgeString is of type NSString *.  Yeah, that's the first inconvenience!  In Qt, QString is usually manipulated, which means you need to write a certain "converter" of strings: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// warning! nsstring isn't released! NSString * nsStringFromQString(const QString &amp; s) { const char * utf8String = s.toUtf8().constData(); return [[NSString alloc] initWithUTF8String: utf8String]; }</span></span></code> </pre><br>  As can be seen from the code (and from the commentary to it), the returned string is not released, so you have to do it in the calling code (Qt does not use ARC, so we will monitor the memory ourselves). <br><br>  Now we can write a function of our private class that will display the line we need in the dock badge: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> MyPrivate::setDockBadge(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QString &amp; badgeText) { NSString * badgeString = nsStringFromQString(badgeText); [[NSApp dockTile] setBadgeLabel: badgeString]; [badgeString release]; }</code> </pre><br><img src="https://habrastorage.org/storage1/235ad24a/e6907305/2e0c864a/9910d059.png"><br>  Now the last aspect of working with the dock is to add an arbitrary overlay to the dock.  This is done using the following code: <br><br><pre> <code class="cpp hljs">[[NSApp dockTile] setContentView: view];</code> </pre><br>  Here, the view is NSView *.  But we are working with Qt!  So, we need to put QWidget * in the overlay.  How to get its NSView from QWidget?  We write a simple function: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">NSView * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nsViewFromWidget</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QWidget * w)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (NSView *)w-&gt;winId(); }</code> </pre><br>  Quite simply, the creators of Qt did almost all the work for us. <br><img src="https://habrastorage.org/storage1/42a0d6bd/1133cf02/f3007f70/eb2972e4.png" align="right"><br>  But, alas, a bummer awaits us: NSView obtained from QWidget is not suitable for installation in the dock.  That is, it is installed, NSDockTile eats it, but instead of the contents of the widget, an empty space is formed in the dock.  I do not know why.  But even in Qt Creator, the progress bar is docked to the dock through its pure NSView, created specifically for this.  So, if you need your own overlay, then you are welcome to write your View on Cocoa.  Alas. <br><br><h4>  Menu operation </h4><br><br>  Let us turn to the Makovsky menu (the one on the top panel).  By default, the Qt program does not create it (well, except for the standard Application Menu with system functions).  The first thing that comes to mind Qt-developer is QMenuBar.  And indeed, the documentation for it says that it can perform the functions of the Makovsky menu.  But there are two options: either make a separate QMenuBar for each program window, or make one global.  Choose the second option because of its undeniable advantages. <br><br>  Again, based on the documentation, we need to create a QMenuBar with a zero parent, i.e., QMenuBar * macMenuBar = new QMenuBar (NULL), then it will be global.  More precisely, the first menu item created in this way will become global. <br><br>  And now - a bunch of monotonous hands.  Create your own menu "Edit", "File", "Help" and so on.  This is quite a tedious job, but without it the program will not look good.  In addition, the standard W and ‚åòM key combinations will not close and minimize windows, respectively.  They will also have to do it yourself (well, at least ‚åòQ works right away). <br><img src="https://habrastorage.org/storage1/fe9a1f62/46f06f43/c9cd4fa1/5220bb31.png"><br>  I will note some features of QActions in Mac OS X. If they are given shortcuts, then in the QKeySequence constructor it is necessary to transfer "Ctrl + M" to create the "‚åòM" shortcut.  And in general, the "‚åò" key in Qt for poppy everywhere goes as Ctrl, and the "Ctrl" key as Meta.  For easier portability programs, I suppose. <br><br>  Well, about the limitations of this approach to creating a menu. <br><br>  * you cannot indent menu items <br>  * QMenu does not emit an aboutToHide signal (only aboutToShow) <br>  * there is the following bug: if the menu ‚ÄúHelp‚Äù is called ‚ÄúHelp‚Äù, then the system search block will be automatically created in the menu items, but if it is named in Russian, this will not happen even if the current locale is Russian in the system .  How to get rid of this glitch, I have not yet found. <br><br><h4>  Almost final - custom window title in Qt </h4><br><br>  To apply everything that I wrote in the <a href="http://habrahabr.ru/blogs/macosx/133593/">last article</a> to the Qt program, you need to do the following.  First, we put where it is necessary to retain / release, because  not included ARC.  Secondly, in Objective-C ++ it is allowed what could not be done in pure Objective-C: taking a class if it is declared only by a forward: <br><br><pre> <code class="cpp hljs">id _class = [NSThemeFrame class];</code> </pre><br>  This saves us from having to have at least one window in the program before calling this function.  Otherwise, everything is the same, so I will not copy the code here.  You can see this in the example (link below). <br><br><h4>  Conclusion </h4><br><br>  So, we looked at Objective-C ++ as applied to the Qt + Cocoa bundle for integrating a program written in Qt on Mac OS X. By and large, there is nothing difficult about this if there is a basic knowledge of Objective-C and Cocoa.  You just need to know some of the features that I have tried to focus on in this article. <br><br>  If anyone is interested in the complete source code of the test project, then welcome to <a href="https://github.com/silvansky/QtMacApp">GitHub</a> ! <br><br>  <b>PS:</b> you could still consider embedding into the program of notifications through Growl, but the reader can do it himself if he has learned the material. </div><p>Source: <a href="https://habr.com/ru/post/133700/">https://habr.com/ru/post/133700/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../133690/index.html">QtWebKit-specific when developing mobile HTML5 applications</a></li>
<li><a href="../133692/index.html">Business control and financial reports</a></li>
<li><a href="../133695/index.html">Microsoft ignites startups for three years!</a></li>
<li><a href="../133697/index.html">Teremka style programming</a></li>
<li><a href="../133699/index.html">How to dictate email by phone</a></li>
<li><a href="../133703/index.html">Using HTTP proxy and SOCKS in Linux</a></li>
<li><a href="../133705/index.html">Subtitles in HTML5 Video, CORS, FileAPI Writer and other new features in the new preview of Internet Explorer 10</a></li>
<li><a href="../133706/index.html">The best site in the world</a></li>
<li><a href="../133707/index.html">Precedent: Facebook has signed a user data agreement with the US government</a></li>
<li><a href="../133708/index.html">How I made a snake on LabVIEW</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>