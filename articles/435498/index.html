<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>vCloud Director Extender: Migration</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article will look at the procedure for expanding an enterprise network to a cloud provider through a VMware NSX¬Æ Edge ‚Ñ¢ Gateway Standalone compon...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>vCloud Director Extender: Migration</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/zl/jt/rg/zljtrg4zqkf3ucgq_etrk2xhzwk.png"><br><br>  This article will look at the procedure for expanding an enterprise network to a cloud provider through a VMware NSX¬Æ Edge ‚Ñ¢ Gateway Standalone component.  As well as detailed disassembled types of virtual machine migration. <br><br>  Before you begin migrating and configuring the network, you need to make sure that all infrastructure components are deployed, configured, and running.  To learn how to deploy and configure the infrastructure of VMware vCloud Director¬Æ Extender, you can see in the <a href="https://habr.com/company/selectel/blog/424371/">previous article</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      All the steps below are required on the client infrastructure. <br><a name="habracut"></a><br><h2>  Connect to vCloud Director infrastructure </h2><br>  The <strong>vCloud Director</strong> infrastructure is managed in the <strong>VMware vCenter Server¬Æ</strong> interface.  To add a new cloud: <br><br><ol><li>  Go to the <strong>vcd extender</strong> control window <br><br><img src="https://habrastorage.org/webt/fb/k4/sk/fbk4sko3nsxor5v9fj4w3dy9jbu.png"><br></li><li>  In the <strong>Home</strong> section, click on the <strong>New Provider Cloud</strong> button. <br><br><img src="https://habrastorage.org/webt/io/ee/ou/ioeeoueqrhwmb9bpb9363zypmoe.png"><br></li><li>  In the cloud connection window, fill in the specified fields and enter the vCloud organization administrator credentials <br><br>  <strong>Provider Cloud Name</strong> - an arbitrary name under which this connection will be displayed <br><br>  <strong>Provider Cloud URL</strong> - a link to a public cloud with the name of the organization <br><br>  <strong>vCD Extender Cloud Service URL</strong> - link to the public address of <strong>vCloud Extender</strong> , deployed with the provider <br><br><img src="https://habrastorage.org/webt/lr/ja/vy/lrjavythuifimoykhzf9xfqirbg.png"><br></li><li>  Click the <strong>Test</strong> button and check that there were no errors during the connection test. </li><li>  To add a new cloud, click <strong>Add.</strong> </li></ol><br>  After the connection is made, in the <strong>Provider Clouds</strong> tab you can see information about connecting to the cloud, about the organization‚Äôs virtual data centers and resource consumption. <br><br><img src="https://habrastorage.org/webt/5f/rr/3g/5frr3g5g5ax4l7zfzntgn8zva-e.png"><br><br><h2>  NSX Edge Gateway Standalone Deployment and Network Setup </h2><br>  Already in the current state, the system is ready for ‚Äúcold‚Äù migration.  But more on that later.  First, we‚Äôll finish the configuration so that we can carry out ‚Äúhot‚Äù migrations. <br><br>  Let's prepare a virtual data center to interact with the <strong>vCloud Director Extender</strong> : <br><br><ol><li>  Go to the <strong>vCloud Director</strong> interface </li><li>  Go to the target virtual data center on the <strong>Edge Gateways</strong> tab for managing routers <br><br>  By default, one virtual router will already be created.  It should be noted that a large amount of traffic on the L2VPN channel will heavily load the router.  We recommend to create a separate virtual router or request an increase in resources for the current one.  In this example, we will work with the default router. </li><li>  Right-click on the router and select <strong>Convert to Advanced Edge Gateway</strong> , otherwise it will be impossible to raise the tunnel between the virtual data center and the local infrastructure <br><br>  The conversion will take no more than a couple of minutes, and the router‚Äôs network availability may be lost for 20-30 seconds. <br><br><img src="https://habrastorage.org/webt/fh/30/zx/fh30zxyinkuwhffbunfr-fmdugo.png"><br><br>  You can immediately prepare a network that we will subsequently ‚Äústretch‚Äù between the local vCenter and the cloud. </li><li>  On the <strong>Org VDC Networks</strong> tab, create a new routed network. <br><br>  It is important to note that the network must be created as a sub-interface.  Check the checkbox in the <strong>Create as subinterface column</strong> . <br><br><img src="https://habrastorage.org/webt/lo/rd/4r/lord4rbobbx04zxgsudhywbi6te.png"><br><br></li><li>  Since the network settings of the migrated virtual machines will not change, then set the parameters of the new network that are similar to those used locally. <br><br><img src="https://habrastorage.org/webt/p3/el/o2/p3elo2jjdvi_x7xwfazxjolzrxq.png"><br><br></li><li>  Specify an arbitrary network name.  At this <strong>point,</strong> work with the <strong>vCloud Director</strong> interface so far. <br><br><img src="https://habrastorage.org/webt/dr/fh/lr/drfhlr4gypb6xu3tsfxe2mc2_9i.png"><br><br></li><li>  Return to the <strong>vCloud Extender Appliance</strong> Web Interface </li><li>  Go to the <strong>DC Extensions</strong> tab and create a configuration for the <strong>NSX-L2VPN-Edge</strong> virtual machine by clicking the <strong>ADD APPLIANCE CONFIGURATION</strong> button <br><br><img src="https://habrastorage.org/webt/kv/mj/om/kvmjoms9e9mvjok0qucdx-czqsc.png"><br><br>  In the <strong>L2 Appliance Configuration</strong> window that opens, specify the placement parameters of the applings virtual machine: folder, cluster, datastore, and port-group name. <br><br>  Also, in the <strong>Uplink Network Pool IP</strong> column, set the IP address of the future virtual machine by typing it in the field and pressing the <strong>ADD</strong> button.  Be sure to include the gateway address and network prefix.  Click <strong>CREATE</strong> . <br><br><img src="https://habrastorage.org/webt/1z/ui/ch/1zuichcqsycv3eriq3vz32ngwuq.png"><br><br></li><li>  The configuration has been created, and you can start creating the <strong>NSX Edge Gateway Standalone</strong> virtual machine itself, but already through the <strong>vCenter</strong> web client interface <br><br><img src="https://habrastorage.org/webt/7o/4i/0k/7o4i0k4ac13wehs6u8_yg6hlof4.png"><br><br></li><li>  Go to the <strong>vCloud Director Extender</strong> control panel, then to the <strong>DC Extensions</strong> tab and click <strong>NEW EXTENSION</strong> <br><br><img src="https://habrastorage.org/webt/wl/n9/uk/wln9uku-3f48mqfsgyywzvkn4kk.png"><br><br></li><li>  Specify a random but friendly name and select the source and destination parameters. <br><br>  <strong>Select Source ‚Üí Network</strong> - select a local port-group whose network we will ‚Äústretch‚Äù. <br><br>  <strong>Select Target ‚Üí vDC</strong> - select the target virtual data center. <br><br>  <strong>Select Target ‚Üí Network</strong> - select the network created earlier. <br><br>  By the way, if the network has not yet been created, then it is possible to create it directly from this interface by clicking on the <strong>ADD NETWORK</strong> button. </li><li>  Click <strong>START</strong> <br><br><img src="https://habrastorage.org/webt/82/pd/r9/82pdr9g0ftlht_jr-s9lut1boyo.png"><br><br>  In the process of deploying <strong>NSX Edge Gateway Standalone</strong> , an additional trunk port group is created and the OVF template of the virtual machine itself is deployed.  After a couple of minutes, everything will be ready, and the tunnel connection to the cloud will be established. <br><br><img src="https://habrastorage.org/webt/2e/la/3w/2ela3w3bpiezkdm9zk3owppnr3m.png"><br></li></ol><br><h2>  Types of migration </h2><br>  Any migration can be done by going to the <strong>Migrations</strong> tab and clicking on the <strong>NEW MIGRATION</strong> button.  You can migrate as a single virtual machine or in groups. <br><br><img src="https://habrastorage.org/webt/uj/k0/jd/ujk0jdi8fxwzzolnvg0ij11gtts.png"><br><br>  Further, in order we consider all types of migration.  And the first will be the "cold" migration (Cold Migration). <br><br><h3>  Cold Migration </h3><br>  Select the <strong>Cold Migration</strong> type and follow the wizard‚Äôs instructions. <br><br>  When marking virtual machines for ‚Äúcold‚Äù migration, you need to consider that they should be turned off at the time of migration. <br><br><img src="https://habrastorage.org/webt/zd/ew/cz/zdewcz7yb2dfb6nbqifgkr5hgsq.png"><br><br><ol><li>  Specify the ‚Äúdestination‚Äù in the <strong>Select a Target Cloud</strong> step <br><br>  Note that grouping virtual machines when migrating to one vApp does not work as expected, which leads to unsuccessful migration of all virtual machines except one, so select <strong>Each VM stays individually</strong> . <br><br><img src="https://habrastorage.org/webt/s6/jr/qd/s6jrqdnlj2mi7gczhgczoqaiqeq.png"><br><br></li><li>  Select the type of disk and the start time of the migration and start the process. <br><br>  The duration of the migration depends on the bandwidth of the Internet channel and the size of the virtual machine. <br><br><img src="https://habrastorage.org/webt/kh/kp/5n/khkp5nef9lbhnkleok-gfvh-ago.png"><br><br></li><li>  Once the migration is completed, a copy of the virtual machine will be available for management via the <strong>vCloud Director</strong> interface. <br><br><img src="https://habrastorage.org/webt/c3/qo/mn/c3qomnh9xtvoheiswwmo4haxxtm.png"><br><br></li></ol><br><h3>  Hot Migration (Warm Migration) </h3><br>  To perform a hot migration: <br><br><ol><li>  Choose the appropriate type from the menu. <br><br><img src="https://habrastorage.org/webt/dh/2w/af/dh2waf0shbb9t0mizq1vwc-mq8i.png"><br><br>  Hot migration is possible only on enabled virtual machines. <br><br><img src="https://habrastorage.org/webt/gm/cv/h8/gmcvh84vqo0cln-nxsbzg21pnwk.png"><br><br></li><li>  Then a similar step follows with the choice of destination parameters.  At the same time, we will choose the network for which the extension was configured. <br><br><img src="https://habrastorage.org/webt/ni/l3/0k/nil30kycmwjk2ymod7emvaf7wvi.png"><br><br></li><li>  Before starting the migration, you will need to select the start time, type of disks and RPO (Recovery Point Objective - the time interval for which the permissible data loss during migration is possible) - at least five minutes (15 minutes by default) <br><br><img src="https://habrastorage.org/webt/yk/0e/qh/yk0eqhtla337km-fv_ctgjatbqc.png"><br><br></li><li>  After starting the migration and creating the task, an error will appear in the events of the vCenter server about the inability to start replication.  Pay attention to it is not worth it, because it is a <a href="https://docs.vmware.com/en/vCloud-Director-Extender/1.0/rn/rel_notes_vcloud_director_extender_1.html">documented "bug"</a> and in fact replication is correct <br><br><img src="https://habrastorage.org/webt/19/n5/aq/19n5aqzb_p4kcmece4vzg8g3dxc.png"><br><br></li><li>  After the data synchronization is completed, it is possible to proceed with the switch, which is indicated in the status of the migration task. <br><br><img src="https://habrastorage.org/webt/yz/pb/ep/yzpbep0sitx6k2hsgmot-iu_zuq.png"><br><br></li><li>  But, before starting the switch, run the VM availability check using the PING command.  Leave the command to run in the background.  Thus, it will be possible to control the network accessibility of the VM when switching <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/be/if/tu/beiftuq-kio23s6rx-csbeynzew.png"></div><br></li><li>  After the Start Cutover button was clicked, a list of virtual machines ready for switching became available, as well as a choice of additional enable options <br><br><img src="https://habrastorage.org/webt/al/ut/_c/alut_cbcl1mkpq_ywxp0eisaeso.png"><br><br></li><li>  We are switching <br><br><img src="https://habrastorage.org/webt/2o/j2/p2/2oj2p2xzbhfaujbxlbyf4ddhspk.png"><br><br>  The switching procedure will take some time.  After the process is complete, the migration task will be marked as completed. <br><br><img src="https://habrastorage.org/webt/x0/ic/79/x0ic79ebhrpdwyiu0dhnbue2u0o.png"><br><br>  Checking the network availability of the VM at the time of switching, you can see that several requests failed.  Just at that moment the final synchronization was carried out: shutting down the local machine and turning on the copy in the cloud.  The virtual machine downtime was only about two minutes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ob/z0/7q/obz07qs0rwp6p6zqdlcpmlzt1ms.png"></div></li></ol><br><h3>  Migrating to a preloaded copy (Warm Migration with Preloaded Seed) </h3><br>  Migrating ‚Äúto a pre-loaded copy‚Äù differs from the usual ‚Äúhot‚Äù migration in that it will be necessary to specify this copy during the migration.  The copy itself can be downloaded as an OVF template via the <strong>vCloud Director</strong> interface, or on a copy previously migrated ‚Äúto cold‚Äù.  A copy of the virtual machine in the cloud, on which we will "roll" replication, must be turned off. <br><br><img src="https://habrastorage.org/webt/ea/ys/kd/eayskdm9a_rabefwk4mr0_nkqpe.png"><br><br>  It should be noted that in the <strong>Select a Target Cloud</strong> step, <strong>a</strong> drop-down menu will be available with a list of disabled virtual machines in the target data center. <br><br><img src="https://habrastorage.org/webt/6m/md/5c/6mmd5cp1nnwsjacxfexxgiig7ho.png"><br><br>  Otherwise, all the steps performed will be similar to those described in the ‚Äúhot migration‚Äù, followed by switching to the target copy in the cloud. <br><br>  After the migrations were completed, the virtual machines are available for management via the <strong>vCloud Director</strong> interface. <br><br><img src="https://habrastorage.org/webt/rq/_e/y3/rq_ey31zuubt4knfzsez02w5vga.png"><br><br><img src="https://habrastorage.org/webt/bt/wu/fl/btwuflucjrr4bsexqudcomyqdza.png"><br><br><h2>  VMware cloud migration usage scenarios </h2><br>  The following options can be considered as the most relevant use cases for the vCloud Extender solution: <br><br><h3>  Enterprise Infrastructure Migration to the Cloud </h3><br>  This process can be divided into several stages: <br><br><ol><li>  <strong>Planning</strong> <br><br>  At this stage, verification and mapping of the interaction of various infrastructure nodes is carried out.  The calculation of the required computing and disk resources.  Risk assessment is carried out. </li><li>  <strong>Training</strong> <br><br>  At the preparation stage, we make an additional order of the required resources, and increase the necessary quotas.  We allocate network resources in the cloud.  We configure networks in a virtual data center and raise VPN tunnels. </li><li>  <strong>Testing</strong> <br><br>  During the testing phase, it is important to check the availability of local infrastructure nodes from the cloud, but it is also equally important to check the bandwidth to estimate the migration time.  To do this, you can deploy a small virtual machine from the template and carry out all the necessary tests. </li><li>  <strong>Migration</strong> <br><br>  The final step will be the migration itself.  At the same time, it can be carried out during off-hours without staff participation, simply by planning all tasks in advance.  If the migrations were ‚Äúcold‚Äù, then in the morning it will just be to turn on all the virtual machines in the cloud. <br><br>  If they were performed in the "hot" mode, then you need to perform tasks "trimming" replicas, which can also be scheduled for the next day or night.  For such a scenario, the implementation of the migration to a pre-loaded copy is perfect. </li></ol><br><br><h3>  Migrating pre-configured services to improve infrastructure resiliency </h3><br>  In this scenario, the service is pre-deployed and configured in the local infrastructure of the enterprise.  In this case, you save money invested in the rental of cloud infrastructure, and after migration, you release your local resources for use for other needs.  This scenario is perfect for deploying web portals, mail servers and similar services. <br><br><h2>  Conclusion </h2><br>  This article examined the possibility of <strong>vCloud Director Extender</strong> for scaling an enterprise network in the VMware vCloud cloud.  A review was also given to three types of migration: ‚Äúcold‚Äù, ‚Äúhot‚Äù and ‚Äúto a pre-loaded copy‚Äù.  As can be seen from the above, the migration procedure, as well as the process of installing components, does not require special knowledge and skills that go beyond the competences of the enterprise system administrator. <br><br>  Perhaps one of the most significant advantages is the ability to relieve human resources and migrate automatically, according to a predetermined plan. <br><br>  Nevertheless, despite all the seeming simplicity of the process of migration to the cloud, this process should be treated responsibly and carefully.  The most important step is not the migration itself, but its preparation and planning.  A well-written and tested plan will help save time, nerves, money and keep a peaceful sleep! <br><br>  If you decide to transfer part of your infrastructure <a href="https://selectel.ru/services/cloud/vmware/">to the VMware-based cloud</a> , but don‚Äôt know where to start, we hope that this article will help you take the first step. </div><p>Source: <a href="https://habr.com/ru/post/435498/">https://habr.com/ru/post/435498/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../435484/index.html">Fuzzing in 1989 style</a></li>
<li><a href="../435488/index.html">Moki, stubs and spies in the Spock Framework</a></li>
<li><a href="../435490/index.html">Google tax changes in 2019</a></li>
<li><a href="../435494/index.html">Seamless client server</a></li>
<li><a href="../435496/index.html">Tesla was sued for an accident in which the driver and passenger Model S died</a></li>
<li><a href="../435500/index.html">Biometric Gloves in Motorsport</a></li>
<li><a href="../435502/index.html">The study revealed the pros and cons of makeovers</a></li>
<li><a href="../435504/index.html">Hand monsters in the fight for cleanliness: the choice of hand-held vacuum cleaner Xiaomi</a></li>
<li><a href="../435506/index.html">Gameboy based supercomputer</a></li>
<li><a href="../435508/index.html">How to make the best computers in Russia? Interview with Artyom Smirnov from HYPERPC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>