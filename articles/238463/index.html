<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>In search of free tickets, the study of the game Aeroflot</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It all started with the fact that I received a link to the Aeroflot promotional website. The promotion consists of passing a small flash game and gett...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>In search of free tickets, the study of the game Aeroflot</h1><div class="post__text post__text-html js-mediator-article">  It all started with the fact that I received a link to the <a href="http://www.aeroflotbonus15.ru/">Aeroflot</a> promotional website.  The promotion consists of passing a small flash game and getting bonus miles.  The top prize of 150,000 miles is given to the player who ranked first in the ranking.  Actually, the principle of forming the rating and caused my interest in this action. <br><br><img src="https://habrastorage.org/files/2c0/f63/8d7/2c0f638d7ba347be9dc20234dd1bbcc0.png"><br><br>  As everyone is well aware, the code of flash applications is executed on the client side, so protection against cheating is a very difficult task.  In fact, the only correct solution is to transfer all game mechanics to the server side, and the flash application performs the role of a client to the API. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's see how to cope with this task in Aeroflot. <br><a name="habracut"></a><br>  To start, start the game with an open developer console in Google Chrome.  And ... apparently, everything will be boring.  As it turned out, the request to the server is sent only once at the end of the game. <br><br><img src="https://habrastorage.org/files/689/b71/461/689b714611f340078e7072b7ac7bb34f.png"><br><br>  The data in the query is suspiciously similar to base64, but the conversion from this encoding only leads to a set of binary data.  This means that the request is encrypted somewhere in the depths of the client.  Unfortunately, or fortunately, swf files have never been resistant to decompilation. <br><br>  Literally 10 seconds after viewing the ActionScript code, this fragment appears: <br><br><pre><code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareForSend</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(param1:Object, param2:String)</span></span></span><span class="hljs-function"> : String </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Xor64.encode(JSON.stringify(param1), <span class="hljs-string"><span class="hljs-string">"aef-game"</span></span> + param2); }</code> </pre> <br><br>  Yes, this is a banal XOR encryption, which means that it was possible not to get involved in decompiling, to recover the key of such a cipher in a matter of a few seconds.  But if you still understand to the end, then the key here consists of two parts: the first one is hard-coded in the function, the second part is obtained from the SWF initialization parameters. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// main.as this._token = stage.loaderInfo.parameters["token"]; // http://aeroflotbonus15.ru/media/js/aef.js start : function( token, authState, connector, autoStart ){ . . . this._token = token; . . . }, . . . AEF.flashController.buildFlash({ token: this._token, connector: this._connector }, this._lang ); . . . // http://aeroflotbonus15.ru/ AEF.start('c958c089505d321994578a12fabbe73d', true, "http://aeroflotbonus15.ru/api/", false, 'ru');</span></span></code> </pre> <br><br>  That is, the full key - <b>aef-gamec958c089505d321994578a12fabbe73d</b> almost all lies in plain sight, right in the page code. <br>  By the way, apparently, the developers even were too lazy to independently implement the encryption algorithm and used the <a href="http://flapps.ru/forum/topic861.html">ready-made solution</a> . <br><br>  The result of the decryption with the voiced key: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"result"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"cities"</span></span>:<span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-attr"><span class="hljs-attr">"miles"</span></span>:<span class="hljs-number"><span class="hljs-number">749.9018522566122</span></span>, <span class="hljs-attr"><span class="hljs-attr">"time"</span></span>:<span class="hljs-number"><span class="hljs-number">58356</span></span>, <span class="hljs-attr"><span class="hljs-attr">"bonuses"</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">"wins"</span></span>:<span class="hljs-number"><span class="hljs-number">6</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>:<span class="hljs-number"><span class="hljs-number">0.98</span></span>, <span class="hljs-attr"><span class="hljs-attr">"bytes"</span></span>:<span class="hljs-number"><span class="hljs-number">7205605</span></span>, <span class="hljs-attr"><span class="hljs-attr">"system"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"cpuArchitecture"</span></span>:<span class="hljs-string"><span class="hljs-string">"x86"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"screenDPI"</span></span>:<span class="hljs-number"><span class="hljs-number">72</span></span>, <span class="hljs-attr"><span class="hljs-attr">"playerType"</span></span>:<span class="hljs-string"><span class="hljs-string">"PlugIn"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"isDebugger"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>:<span class="hljs-string"><span class="hljs-string">"MAC 15,0,0,152"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"manufacturer"</span></span>:<span class="hljs-string"><span class="hljs-string">"Google Pepper"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>:<span class="hljs-string"><span class="hljs-string">"http://aeroflotbonus15.ru/media/swf/game.swf?68"</span></span> }</code> </pre> <br><br>  Formatting added for readability. <br><br>  As a result, anyone can post any rating.  I don‚Äôt know how the organizers plan to separate honest participants from cheaters, but personally I have no longer any desire to participate in this action. <br><br>  PS <br><br><img src="https://habrastorage.org/files/676/8ab/d34/6768abd3487143f7bec3605a1dcb5a6a.png"><br><br>  I do not have an Aeroflot Bonus card, so the results will not affect the overall rating. </div><p>Source: <a href="https://habr.com/ru/post/238463/">https://habr.com/ru/post/238463/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../238449/index.html">Align the block to the center of the page.</a></li>
<li><a href="../238451/index.html">3D printing of protein molecules</a></li>
<li><a href="../238453/index.html">The digest of interesting materials from the world of web development and IT for the last week No. 127 (September 22 - 28, 2014)</a></li>
<li><a href="../238457/index.html">The main types of search queries that online store users use, is your website ready for them? (Part 3)</a></li>
<li><a href="../238461/index.html">Why do normal boys need the company's mission - and some cybernetics?</a></li>
<li><a href="../238467/index.html">OpenCL 2.0 and drivers from AMD and Intel</a></li>
<li><a href="../238469/index.html">We trace removal of files on PowerShell</a></li>
<li><a href="../238471/index.html">The new release of ReadyScript introduces the functionality of warehouses.</a></li>
<li><a href="../238473/index.html">Deploying Go Servers with Docker</a></li>
<li><a href="../238475/index.html">Everything you wanted to know about Shellshock vulnerability (but were afraid to ask)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>