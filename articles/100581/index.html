<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Forgotten music or a bit of Nokia 3310, PC-Seaker and MIDI file generation (P1)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Here we will talk a little about the melody format (RTTL) in the old phone models, about playing such melodies using the usual PC-Speaker of the compu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Forgotten music or a bit of Nokia 3310, PC-Seaker and MIDI file generation (P1)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/34c8c93d/2cd0c6ed/f6a0460c/b2f9a601.jpg" align="right">  Here we will talk a little about the melody format (RTTL) in the old phone models, about playing such melodies using the usual PC-Speaker of the computer, as well as about creating (generating) MIDI files.  All my thoughts I will back up with Pascal code. <br><a name="habracut"></a><br><br>  Immediately, I‚Äôll make a reservation that this article most likely does not represent any practical interest for the majority and was created by the author rather for himself, as a memory so to speak ... But enough of the lyrics, let's begin. <br><br><h4>  Theory. </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I think that many still remember how, sitting on a gallery in a school or institute, the comrades of the form ‚Äú8e, 16d, 16b4,16a4,16b4,8a4,16a4,16a # 4‚Äù were reprinted from their phone.  This so-called RTTL format for recording ringtones.  It makes no sense to describe it in detail here, since the description is fully accessible on the <a href="http://www.music4sale.ru/articles/knowledge_base/586/">Internet</a> , but for further understanding we will consider the simplest example.  So, take this RTTL melody: <br><br>  <b>Simpsons: d = 4, o = 5, b = 160: 32p, c.6, e6, f # 6,8a6, g.6, e6, c6,8a, 8f #, 8f #, 8f #, 2g</b> <br><br>  As you can see, the format is <br><br>  [name <b>:</b> duration <b>,</b> octave <b>,</b> speed per minute (BPM) <b>:</b> the melody itself]. <br><br>  We will need the following parameters: <br><br>  <i><b>‚ÄúD = 4‚Äù The</b></i> duration of the note by default.  This means that in the recording of the melody itself, when we want to play a note ‚Äúla‚Äù with a duration of 4, we will not necessarily have to record it as ‚Äú <b>4a</b> ‚Äù.  It is enough to write it simply as ‚Äú <b>a</b> ‚Äù.  Here I note that if we compare the duration of the RTTL and the duration of the note in the musical sense, then there is a simple correspondence - 1 / duration of the RTTL.  Thus, ‚Äúd = 4‚Äù in the RTTL record means that we play the notes by default, with a duration of ‚Äúone fourth‚Äù.  If d = 6, then ‚Äúone sixth‚Äù and so on. <br><br><img src="https://habrastorage.org/storage1/263fad3c/e5d180e8/d1f70fbe/771542f2.png"><br><br>  <i><b>‚ÄúO = 5‚Äù</b></i> Octave by default.  From music theory, we recall that the octave is twice the frequency between the same notes.  So, if the note ‚Äúla‚Äù of the fourth octave has a frequency of 440 Hz, then the same note ‚Äúla‚Äù of the fifth octave will have a frequency of 880 Hz.  Exactly the same as with the duration, in the further recording we do not need to record the note <b>a</b> ‚Äúla‚Äù of the fifth octave, as ‚Äú <b>a5</b> ‚Äù.  It is enough just to write it down as ‚Äú <b>a</b> ‚Äù and we will play the note ‚Äúla‚Äù of the fifth octave with a duration of one fourth.  Thus it turns out that in our case the entry ‚Äú <b>a</b> ‚Äù will be equivalent to the entry ‚Äú <b>4a5</b> ‚Äù. <br><br><img src="https://habrastorage.org/storage1/bd9cbf95/16a31cfd/bfdf0ebc/acc8b884.png"><br><br>  <i><b>‚ÄúB = 160‚Äù</b></i> .  Pace, or speed per minute (BPM).  To calculate the milliseconds that a note should sound, I used the following formula: ((60000 / b) / d) * 8, where b is our tempo and d is the duration of the note.  Why so, I already confessed and forgot myself.  But it works :) <br><br>  Then the melody itself begins.  From the <a href="http://www.music4sale.ru/articles/knowledge_base/586/">description</a> it follows that the format for recording notes is generally as follows: <br><br>  [duration note octave add.  sign]. <br><br>  Commas act as a separator between notes.  Notes are used in the English (?) Recording system 'c', 'c #', 'd', 'd #', 'e', ‚Äã‚Äã'f', 'f #', 'g', 'g #', 'a', ' a # ',' b ', which corresponds to Italian' to ',' to sharp ',' re ',' re sharp ',' mi ',' fa ',' fa sharp ',' salt ',' salt sharp ', 'la', 'la sharp', 'si'.  And also a pause - 'p'.  Additional marks may be: <br>  " <b>.</b> " (dot) - an increase in the duration of the note in half <br>  " <b>;</b> " (semicolon) - twice <br>  " <b>&amp;</b> " (ampersand) - 2.5 times <br>  There should be no problem with this - when we find one of these signs at the end of a note, we will simply multiply the calculated milliseconds by ¬Ω, two and two and a half times. <br><br>  We‚Äôll finish with the theory, if you have any questions, once again I recommend reading the description of the RTTL format.  We proceed to practice. <br><br><h4>  PC Speaker </h4><br><br>  For a start, we will output our melody for simplicity to the usual PC-Speaker.  In most programming languages, to output audio to a speaker, we need to know only two parameters ‚Äî the frequency and the delay in milliseconds.  So, in Virtual Pascal there is a procedure <br><blockquote>  PlaySound <font color="#009900">(</font> Freq <font color="#339933">,</font> Duration <font color="#339933">:</font> <font color="#000066">Longint</font> <font color="#009900">)</font> ; </blockquote><br>  which I will use. <br>  Now let's think and start with a simple one.  Suppose that our melody consists of only one note and looks like this: ‚Äútest: d = 4, o = 5, b = 125: a‚Äù.  Thus, we need to play the ‚Äúla‚Äù note of the fifth octave with a duration of one-fourth with a tempo of 125. The first thing that comes to mind is that we need to know all note frequencies for all octaves, for this we naturally build a table of frequencies: <br><blockquote>  <font color="#000000">Var</font> <br>  Frequency <font color="#339933">:</font> <font color="#000066">Array</font> <font color="#009900">[</font> 1..8 <font color="#339933">*</font> <font color="#cc66cc">12</font> <font color="#009900">]</font> <font color="#000000">of</font> <font color="#000066">word</font> ;  <font color="#666666">{frequency table}</font> <br><br>  <font color="#666666">{....... some code .......}</font> <br><br>  <font color="#000000">Procedure</font> InitFreqTable;  <font color="#666666">{Frequency Table Initialization Procedure}</font> <br>  <font color="#000000">Const</font> <br>  HerzOfFirst <font color="#339933">=</font> <font color="#cc66cc">32.703195258</font> ;  <font color="#666666">{note C of the first octave}</font> <br><br>  <font color="#000000">Var</font> <br>  tmpReal1 <font color="#339933">,</font> tmpReal2 <font color="#339933">:</font> <font color="#000066">real</font> ; <br>  i <font color="#339933">:</font> <font color="#000066">word</font> ; <br><br>  <font color="#000000">Begin</font> <br>  tmpReal1 <font color="#339933">: =</font> HerzOfFirst;  <font color="#666666">{let's start with the first note C of the first octave}</font> <br>  tmpReal2 <font color="#339933">: =</font> <font color="#000066">exp</font> <font color="#009900">(</font> <font color="#000066">ln</font> <font color="#009900">(</font> <font color="#cc66cc">2.0</font> <font color="#009900">)</font> <font color="#339933">/</font> <font color="#cc66cc">12.0</font> <font color="#009900">)</font> ;  <font color="#666666">{constant with which the frequency changes from note to note}</font> <br>  <font color="#000000">for</font> i <font color="#339933">: =</font> <font color="#cc66cc">1</font> <font color="#000000">to</font> <font color="#cc66cc">8</font> <font color="#339933">*</font> <font color="#cc66cc">12</font> <font color="#000000">do</font> <font color="#666666">{12 notes per octave, 8 octaves}</font> <br>  <font color="#000000">begin</font> <br>  Frequency <font color="#009900">[</font> i <font color="#009900">]</font> <font color="#339933">: =</font> round <font color="#009900">(</font> tmpReal1 <font color="#009900">)</font> ; <br>  tmpReal1 <font color="#339933">: =</font> tmpReal1 <font color="#339933">*</font> tmpReal2; <br>  <font color="#000000">end</font> ; <br>  <font color="#000000">End</font> <br></blockquote><br>  Fine.  Further, the whole matter rests on the analysis of the recording of notes on the duration, the octave, and the note itself.  I think it‚Äôs inappropriate to give here the parsing itself, if someone is interested in the end of the article there will be the full source code of the program.  Let's analyze only the calculation in the table of the note itself.  I implemented it like this: <br><blockquote>  <font color="#666666">{we previously parsed the duration and octave}</font> <br>  <font color="#666666">// parse note</font> <br>  <font color="#666666">{i - will denote the offset in the frequency table}</font> <br>  i <font color="#339933">: =</font> <font color="#009900">(</font> octave <font color="#339933">-</font> <font color="#cc66cc">1</font> <font color="#009900">)</font> <font color="#339933">*</font> <font color="#cc66cc">12</font> ;  <font color="#666666">{first move to the desired octave}</font> <br>  <font color="#000000">Case</font> S <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#000000">of</font> <font color="#666666">{In s [1] there is a note symbol}</font> <br>  <font color="#ff0000">'c'</font> <font color="#339933">:</font> inc <font color="#009900">(</font> i <font color="#339933">,</font> <font color="#cc66cc">1</font> <font color="#009900">)</font> ;  <font color="#666666">{and add to note offset}</font> <br>  <font color="#ff0000">'d'</font> <font color="#339933">:</font> inc <font color="#009900">(</font> i <font color="#339933">,</font> <font color="#cc66cc">3</font> <font color="#009900">)</font> ;  <font color="#666666">{here we do not take into account sharps, I process them after}</font> <br>  <font color="#ff0000">'e'</font> <font color="#339933">:</font> inc <font color="#009900">(</font> i <font color="#339933">,</font> <font color="#cc66cc">5</font> <font color="#009900">)</font> ; <br>  <font color="#ff0000">'f'</font> <font color="#339933">:</font> inc <font color="#009900">(</font> i <font color="#339933">,</font> <font color="#cc66cc">6</font> <font color="#009900">)</font> ; <br>  <font color="#ff0000">'g'</font> <font color="#339933">:</font> inc <font color="#009900">(</font> i <font color="#339933">,</font> <font color="#cc66cc">8</font> <font color="#009900">)</font> ; <br>  <font color="#ff0000">'a'</font> <font color="#339933">:</font> inc <font color="#009900">(</font> i <font color="#339933">,</font> <font color="#cc66cc">10</font> <font color="#009900">)</font> ; <br>  <font color="#ff0000">'b'</font> <font color="#339933">,</font> <font color="#ff0000">'h'</font> <font color="#339933">:</font> inc <font color="#009900">(</font> i <font color="#339933">,</font> <font color="#cc66cc">12</font> <font color="#009900">)</font> ; <br>  <font color="#ff0000">'p'</font> <font color="#339933">:</font> i <font color="#339933">: =</font> <font color="#cc66cc">0</font> ;  <font color="#666666">{and this is a pause}</font> <br>  <font color="#000000">else</font> <br>  <font color="#000000">begin</font> <font color="#666666">{if another letter is encountered, give an error}</font> <br>  PlayRTTTLNote <font color="#339933">: =</font> <font color="#cc66cc">1</font> ; <br>  <font color="#000066">WriteLn</font> <font color="#009900">(</font> <font color="#ff0000">'DEBUG: Error [1]: Wrong note - "'</font> <font color="#339933">,</font> S <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">,</font> <font color="#ff0000">'"'</font> <font color="#009900">)</font> ; <br>  exit; <br>  <font color="#000000">end</font> ; <br></blockquote><br>  So, now in the variable ‚Äúi‚Äù there is an offset in the frequency array of the note we need.  You can now process the ‚Äú#‚Äù (sharp) character at the end, and if it is present in the note recording, simply increase the value of ‚Äúi‚Äù by one.  Now we can play a note, while with a duration of 1000 ms with a simple command: <br><blockquote>  PlaySound <font color="#009900">(</font> Frequency <font color="#009900">[</font> i <font color="#009900">]</font> <font color="#339933">,</font> <font color="#cc66cc">1000</font> <font color="#009900">)</font> ; </blockquote><br>  With a note and frequency sorted out.  It remains to deal only with the duration of the notes.  Above, I already gave a formula by which I calculated the duration of the sound in milliseconds depending on the tempo and the duration of the note itself.  Below just give the code: <br><blockquote>  <font color="#666666">// calculate microseconds</font> <br>  PrecalcMS <font color="#339933">: =</font> <font color="#009900">(</font> <font color="#cc66cc">60000</font> <font color="#339933">/</font> BPMspeed <font color="#009900">)</font> ;  <font color="#666666">{BMPspeed is temp, i.e. the parameter ‚Äúb =‚Äù}</font> <br>  PrecalcMS <font color="#339933">: =</font> <font color="#009900">(</font> PrecalcMS <font color="#339933">/</font> Duration <font color="#009900">)</font> <font color="#339933">*</font> <font color="#cc66cc">8</font> ;  <font color="#666666">{duration - the frequency of the notes}</font> <br>  MicroSecs <font color="#339933">: =</font> round <font color="#009900">(</font> PrecalcMS <font color="#009900">)</font> ;  <font color="#666666">{round to integer}</font> <br></blockquote><br>  Here the main thing is not to forget about the additional values ‚Äã‚Äãof ‚Äúdot‚Äù, ‚Äúsemicolon‚Äù ‚Äã‚Äãor ‚Äúampersand‚Äù that may be present in the musical notation, and depending on their presence, multiply the value of PrecalcMS by ¬Ω, 2 or 2.5.  In the main program it is, I do not cite here.  Everything, now we can lose the note with the frequency defined above and the duration we need: <br><blockquote>  <font color="#000000">Procedure</font> PlayNote <font color="#009900">(</font> Note <font color="#339933">:</font> <font color="#000066">byte</font> ; MicroSecs <font color="#339933">:</font> <font color="#000066">Word</font> <font color="#009900">)</font> ; <br>  <font color="#000000">Begin</font> <br>  <font color="#000000">If</font> Note <font color="#339933">=</font> <font color="#cc66cc">0</font> <font color="#000000">then</font> <font color="#666666">{Remember, if we met ‚Äúp‚Äù, then set I = 0}</font> <br>  Delay <font color="#009900">(</font> MicroSecs <font color="#009900">)</font> <font color="#666666">{this means a pause}</font> <br>  <font color="#000000">Else</font> <br>  playsound <font color="#009900">(</font> Frequency <font color="#009900">[</font> Note <font color="#009900">]</font> <font color="#339933">,</font> microsecs <font color="#009900">)</font> ; <br>  <font color="#000000">End</font> ; <br></blockquote><br>  And in the main program we play a note: <br><blockquote>  PlayNote <font color="#009900">(</font> I <font color="#339933">,</font> MicroSecs <font color="#009900">)</font> ; </blockquote><br>  In such a simple way, we implemented the RTTL melodies player on PC-Speaker.  The full source code of the program, as well as the compiled version, are available here: <a href="http://rghost.ru/2230394">rghost.ru/2230394</a> I used to compile Virtual Pascal, but I think that I should get together in Free Pascal without any problems. <br><br>  In the next article we will talk about creating an RTTL 2 MIDI converter in general and creating and working with MIDI files in particular.  Have a good day! <br><br>  When writing the article materials were used: <br>  <a href="http://personal.telefonica.terra.es/web/japus/rtplayer.html">personal.telefonica.terra.es/web/japus/rtplayer.html</a> <br>  <a href="http://www.music4sale.ru/articles/knowledge_base/586/">www.music4sale.ru/articles/knowledge_base/586</a> <br>  <a href="http://members.home.nl/bas.de.reuver/files/convert_rtttl.html">members.home.nl/bas.de.reuver/files/convert_rtttl.html</a> </div><p>Source: <a href="https://habr.com/ru/post/100581/">https://habr.com/ru/post/100581/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../100573/index.html">Samsung N127, or a good netbook for parents</a></li>
<li><a href="../100574/index.html">Canobuvosti, 50th edition (anniversary, inside the competition!)</a></li>
<li><a href="../100575/index.html">Stocking popcorn - 87 million rubles allocated to the new zakupki.gov.ru</a></li>
<li><a href="../100576/index.html">Rubik's Cube on canvas</a></li>
<li><a href="../100579/index.html">Excursion to the Angstrom microcircuit plant!</a></li>
<li><a href="../100583/index.html">Universal "machine" ASUS N53Jn</a></li>
<li><a href="../100584/index.html">Livebase.ru - a year later</a></li>
<li><a href="../100585/index.html">Day of the sysadmin in the Moscow metro</a></li>
<li><a href="../100587/index.html">Velcom announces contest for Android developers</a></li>
<li><a href="../100588/index.html">Gigabyte GSmart G1305 Review</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>