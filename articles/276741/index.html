<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÄúDevilish‚Äù ACL - my version of rights verification</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I do my CMS (more precisely, what I call CMS). The project has reached the level of user rights verification. Such a system should allow: 



1. Check...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>‚ÄúDevilish‚Äù ACL - my version of rights verification</h1><div class="post__text post__text-html js-mediator-article">  I do my CMS (more precisely, what I call CMS).  The project has reached the level of user rights verification.  Such a system should allow: <br><img src="https://habrastorage.org/files/ece/685/8e1/ece6858e11bb45879b8cbcf526aa860d.png" align="left"><br><ol><li>  Check user rights to the resource </li><li>  Assign rights to the resource group </li><li>  Inheritance of rights to a child group from the parent </li><li>  Rules on the parent resource apply to all child resources. </li><li>  Inheritance of rights (example: the right to change includes the right to read) </li></ol><br>  I will try to describe my vision of such a system of rights. <br><br clear="all"><a name="habracut"></a><br><h3>  Permissions </h3><br>  First, a bit of terminology, which I will adhere to.  Permission is a concrete action.  Right is the ability of the user to perform any action. <br>  By default, the system has the following predefined list of permissions. <table><tbody><tr><th>  Name </th><th>  Description </th></tr><tr><td>  <b>none</b> </td><td>  No rights </td></tr><tr><td>  <b>read</b> </td><td>  Reading </td></tr><tr><td>  <b>create</b> </td><td>  Creature </td></tr><tr><td>  <b>update</b> </td><td>  Change </td></tr><tr><td>  <b>delete</b> </td><td>  Deletion </td></tr><tr><td>  <b>all</b> </td><td>  All right </td></tr></tbody></table>  The permissions in the list are from lowest to highest (that is, each next permission (row) includes all previous permissions).  For example, if a user is assigned the right to Create ( <b>create</b> ), then he has a right to read ( <b>read</b> ).  Accordingly, permission <b>all</b> - gives all rights.  And the resolution of <b>none</b> is the prohibition of all rights. <br><br><h3>  Resources </h3><br>  The resource is specified as a link <b>/ aaa / bbb / ccc /</b> .  At the same time, all rights specified, for example, for <b>/ aaa /</b> , apply to all child resources: <b>/ aaa / bbb /</b> , <b>/ aaa / bbb / ccc /</b> , etc.  For resource <b>/ aaa / bbb /</b> resource <b>/ aaa /</b> - parent, resource <b>/ aaa / bbb / ccc /</b> - child. <br><br><h3>  Groups </h3><br><img src="https://habrastorage.org/files/f38/64e/c2f/f3864ec2f79f4d2fa17127ceb05a31e3.png" align="left"><br>  A group is an object in which rights are assigned (setting rules) to resources.  There is ONE parent group for all groups.  This group has all rights to all resources.  Usually such a group is called superadmin, god.  But in order to be different from other ACLs - I called such a root group <b>diablo</b> (devil).  So in my system, all rights will be ‚Äúfrom the devil.‚Äù  Hence the name of the article about the devil's acl <img src="https://habrastorage.org/getpro/habr/post_images/218/039/6d8/2180396d83165ba1273ea485767f0703.gif">  . <br>  Each subsidiary group can only REDUCE rights.  Those.  if the admin group (administrator) has the create right for the / aaa / bbb / ccc / resource, then the user group cannot get the right to delete the aaa / bbb / ccc / resource - in this case the right will increase, so as a permission, delete (delete) is higher than the create (create) permission.  Also, the user group cannot acquire the right to delete (delete) resources / aaa / bbb /, / aaa /, / since these are the parent resources for the resource / aaa / bbb / ccc / which means in this case, too, an increase in rights will occur .  The principle of diminishing rights is needed in order to be able to give users the ability to lead groups and at the same time not to fear that they will be able to access resources that you do not want to show them, since they will not be able to add themselves the rights that they do not have. <br>  Each group can contain only one rule for one resource (including parent resources).  For example, if the group has a rule for the resource / aaa / bbb / ccc /, then there should be no other rules for the resources / aaa / bbb / ccc /, / aaa / bbb /, / aaa /, / <br><br clear="all"><h3>  Tables </h3><br>  Tables for data storage. <br><img src="https://habrastorage.org/files/37d/a36/87d/37da3687d4024cf9ba880f5eec1c1258.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Check function: does the user have permission to the resource </h3><br>  As an example, we will check the user's <i>create</i> permission on the resource <i>/aaa/bbb/ccc/index.html</i> <br>  First, a picture of the group tree on which I will describe examples for a better understanding of the algorithm (and myself as well).  Group number 1 - a group of diablo (Devil), which has all the rights to everything.  In groups 12, 13, 15, 10, rules are set for the resource we need for permissions, which are &lt;given - which leads to a ban on the resource.  In groups 3, 4, 22, rules are set for the resource we need for permissions, which are ‚â• given - which reduces the level of access, but still falls under our example.  Those.  if in group 1 per resource is set the all permission, then in group (for example) 3 the permission of delete is set, which is still higher than the create permission specified in the example. <br><img src="https://habrastorage.org/files/7f7/403/a9d/7f7403a9d81f4b12b804d045507ee7e0.png"><br>  The algorithm works as follows: <br><ol><li>  According to the <b>Users</b> table, by user ID (and by ID = 0 - guest ID), we determine the list of groups ( <b>aGroupsUsers</b> ) to which this user belongs.  For our example, this will be a list of the following groups. <br><img src="https://habrastorage.org/files/b7c/795/a76/b7c795a76f8b4f6bbbded9d4be4e0c88.png"><br>  As you can see, in our example the user is defined both in group 2 and in child groups 23 and 13. Theoretically, the presence of a user in groups 23 and 13 is redundant as if the user is defined in the parent group, then it also applies to ALL child groups.  However, this is practically possible (at least due to the fact that there is a user with the identifier 0 (Guest), to which each authorized user belongs).  That is why I made such an example. </li><li>  According to the table <b>Permissions, we</b> determine the list of two groups of permissions identifiers: a) which &lt;given b) which ‚â• specified.  For example, for creating permission, the following lists will be formed: a) <b>aDeny</b> = [none, read, update] b) <b>aAllow</b> = [create, delete, all]. </li><li>  We break a resource into components: i.e.  besides the resource itself, we define all its parents.  For example, for the resource /aaa/bbb/ccc/index.html we get the following list: /aaa/bbb/ccc/index.html, / aaa / bbb / ccc /, / aaa / bbb /, / aaa /, /.  And according to the <b>Resources</b> table, we determine the identifiers of the specified list of resources ( <b>aResources</b> ). </li><li>  According to the <b>Rules</b> table and the list of identifiers from PP.3, we select the list of groups ( <b>aGroupsRules</b> ), in which the rules for a given resource are defined (+ parent resources).  In our case, the result will be the following: <br><img src="https://habrastorage.org/files/4db/cf0/367/4dbcf036771d4c2d91b26029a7a0b53e.png"><br>  In practice, there may be rules that are specified in the child groups to which the user belongs.  And they will fall into the sample.  However, in our example, we will assume that there are no such groups - all the same, they have no effect on the result. </li><li>  We have selected a list of groups to which the user belongs (see clause 1).  Now we need to check all these groups for the presence of the required rights on the resource we have specified, taking into account the parental rights.  Those.  We need to check the following branches of the groups (the group branch is a list of groups from the current to the root (devil)): <br><ul><li>  23, 12, 6, 2, 1 </li><li>  13, 6, 2, 1 </li><li>  2, 1 </li><li>  38, 27, 17, 8, 3, 1 </li><li>  18, 9, 4, 1 </li><li>  20, 10, 4, 1 </li><li>  32, 22, 11, 5, 1 </li></ul>  Moreover, if in one of the branches the result of the verification of rights is positive, then the others are not necessarily verified, since we already have the rights.  If, when searching, we have moved to the group in which the prohibition rule has been set, then we can no longer check this branch and move on to the next one.  Below is an algorithm for determining rights.  The variable fAccessGroup at the end of the algorithm will be the result of user access to the resource: True / False. <br><img src="https://habrastorage.org/files/e35/426/efd/e35426efd02248668cd4781f25dd6f2f.png"><br>  In our example, the search will end on the branch "2, 1" as it has access to the resource. <br>  I also want to draw your attention to the fact that according to this algorithm you will not be able to change the access rights of the devil - he will always have the rights to everything simply by virtue of his diablo name. <br></li></ol><br><div class="spoiler">  <b class="spoiler_title">Optimization</b> <div class="spoiler_text">  As you can see (if you have read the algorithm of work), we get quite a lot of samples from the database, since when checking the branch of a group, we consistently move from the child group to the parent group and the longer the branch, the more samples from the database need to be done.  One of the options to increase the speed of work is to cache the search results by group.  Those.  if at the next check we determined that group <b>G</b> has permission <b>P</b> for resource <b>R</b> , then we can save it in a separate table <br><img src="https://habrastorage.org/files/357/4ac/2be/3574ac2be4054ed5a2526dd703d3a1be.png"><br>  In this case, after step 3, we can select from the list of aGroupsUsers groups and the aResources resource list data from the Cache table.  If the selected data has permissions ‚â• required, then the user has access to the resource.  If not, then perform the checks according to the described algorithm.  When checking a group branch, we take into account the information about the ban selected from CASH. <br>  I will not describe this process in detail, since it already refers to a specific implementation, and in the article I wanted to make exactly the general description of the operation algorithm.  But if you have ideas for optimization, write them in the comments. <br></div></div><br><br><h3>  Some notes </h3><br><ul><li>  Theoretically, the Permissions table is not really needed, since you can store permissions in a regular array (I plan to do just that).  Instead of permission identifiers, you can write the technical name (none, read, create, update, delete, all) permissions in the rules table.  However, I still indicated such a table, since it may be easier for someone to store the permissions in the table, and it may also be more understandable. </li><li>  By default, the guest group must include a user with the identifier 0 (guest).  All new users should be included in the user group. </li><li>  Each module will add rules for its resources (although this probably already applies to each specific implementation case and does not apply to access rights checking). </li><li>  For those who want to write a comment in the style of ‚Äúwhy did you invent it, because in the XXX system this is [almost] exactly implemented as well‚Äù: the implementation in the XXX system will not work for me, since I have a samopisnaya system (up to the self-written ORM) and implement I will check the rights on it.  So, references to systems in which the system of rights is implemented [almost] are also welcome, but without instructions that I shouldn‚Äôt screw this system in vain. </li><li> If someone found a problem that I overlooked - write in the comments.  This is the third version of the article, the previous two were rejected because as a result of writing the article errors were found in the algorithm </li><li>  Considered the option when the devil has no rights to anything and there is an increase in rights.  In this case, there is less chance of giving someone access to content that is prohibited for him.  However, with this approach, if you give the user the right to assign rights to groups, then he can assign full access to himself.  So in the end, after all, I decided that the devil will be omnipotent <img src="https://habrastorage.org/getpro/habr/post_images/218/039/6d8/2180396d83165ba1273ea485767f0703.gif">  . </li></ul><br>  List of references on a subject: <br><ul><li>  <a href="https://habrahabr.ru/post/164807/">ACL: in search of the perfect solution.</a> </li><li>  <a href="https://habrahabr.ru/post/109713/">DIY ACL.</a>  <a href="https://habrahabr.ru/post/109713/">The history of the development and writing of a simple access control system</a> </li><li>  <a href="https://www.dokuwiki.org/ru:acl" title="Here I peeped the idea with the inheritance of rights. Only in the article the rights have numerical values, and in my case just a queue of rights.">Access Control with Access Lists (ACLs)</a> </li></ul><br><br>  ps <b>If you put cons, then at least write - for what</b> . </div><p>Source: <a href="https://habr.com/ru/post/276741/">https://habr.com/ru/post/276741/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../276727/index.html">Checking a Microsoft Orleans project with PVS-Studio</a></li>
<li><a href="../276729/index.html">How to get a Spring logger</a></li>
<li><a href="../276731/index.html">Full-featured REST API for perfectionists in 5 minutes</a></li>
<li><a href="../276737/index.html">The digest of interesting materials for the mobile # 139 developer (February 1-7)</a></li>
<li><a href="../276739/index.html">Why Yandex refused to confirm sites txt file</a></li>
<li><a href="../276745/index.html">Compare prices in online bookstores using python, pandas and matplotlib</a></li>
<li><a href="../276747/index.html">Perfect UI framework</a></li>
<li><a href="../276749/index.html">School of Data "Beeline" for managers</a></li>
<li><a href="../276751/index.html">IBM will strengthen the fight against cyber fraud using IRIS Analytics technology</a></li>
<li><a href="../276753/index.html">The digest of interesting materials from the world of web development and IT for the last week No. 197 (February 1 - 7, 2016)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>