<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The important thing is inside: about procedural generation of organs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(Translator disclaimer: just in case, I do not advise reading this article while eating.) 

 When I start to participate in gamejams, I enter the "max...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The important thing is inside: about procedural generation of organs</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/964/09c/6b0/96409c6b07b14757902fca8ea2b47e00.jpg" alt="image"><br><br>  <i>(Translator disclaimer: just in case, I do not advise reading this article while eating.)</i> <br><br>  When I start to participate in gamejams, I enter the "maximum acceleration" mode, which usually ends with terrible Mondays at work after sleepless nights.  The older I get, the harder it is for me to get enthusiastic to participate.  Fortunately, <a href="http://procjam.com/">PROCJAM is</a> very relaxed, which is perfect for me.  In addition, cheating is not prohibited there, so I could, for example, return my organ generator, which I worked on for <i>Bestiarium a</i> few months ago, from non-existence and create my prototype based on it. <br><a name="habracut"></a><br><div class="oembed"><div><div style="left: 0px; width: 100%; height: 0px; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0px; left: 0px; width: 100%; height: 100%; position: absolute;">  Your browser does not support HTML5 video. <source src="http://yankooliveira.com/wp-content/uploads/2016/11/imp_opening.mp4?_=1" type="video/mp4"></video></div></div></div><br>  <i>While I am preparing a version for Vive, you can play <a href="https://yanko.itch.io/dissection">De daemonici corporis fabrica</a> on my page on itch.io.</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Despite the fact that I have not touched him for quite a long time, there is an impressive array of ideas in my head in <i>Bestiarium</i> .  But the game itself is based on a few ‚Äúphilosophical‚Äù points.  I always saw her as a ‚Äúroguelike from one room‚Äù, so the space for research inevitably moved ‚Äúfrom outside‚Äù to ‚Äúinside‚Äù, which is perfectly described by this poem by William Blake: <br><br><blockquote>  <i>The sky is blue in flower,</i> <i><br></i>  <i>In a handful of dust, infinity;</i> <i><br></i>  <i>Hold the whole world in your hand</i> <i><br></i>  <i>To see eternity in every moment.</i> </blockquote><br>  Such projects, in my opinion, are much more interesting if you interpret everything literally.  Therefore, I decided to move in the direction of "viscera". <br><br><div class="oembed"><div><div style="left: 0px; width: 100%; height: 0px; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0px; left: 0px; width: 100%; height: 100%; position: absolute;">  Your browser does not support HTML5 video. <source src="http://yankooliveira.com/wp-content/uploads/2016/11/chestfly.mp4?_=2" type="video/mp4"></video></div></div></div><br>  One of the main mechanics of the game involves the extraction of materials from creatures that you can call.  You can go the standard way and pull out of them "rabbit legs" and "spider eyes", but our game is also about science.  As in science, there are frequent trials and errors (and most of the time is occupied by hard work). <br><br>  This was how one of the items in my design notes marked ‚Äúprobably won't work‚Äù: anatomizing creatures to extract organs from them.  PROCJAM was obviously the perfect excuse for creating a prototype based on this idea and testing it. <br><br>  <a href="https://yanko.itch.io/dissection"><i>De daemonici corporis fabrica</i></a> (the demonic version of <a href="https://ru.wikipedia.org/wiki/%25D0%259E_%25D1%2581%25D1%2582%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B8_%25D1%2587%25D0%25B5%25D0%25BB%25D0%25BE%25D0%25B2%25D0%25B5%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B3%25D0%25BE_%25D1%2582%25D0%25B5%25D0%25BB%25D0%25B0"><i>De humani corporis fabrica</i></a> ) is trying to convey the sensations of ancient scholars who cut the corpse for the first time.  Something like <i>‚ÄúI wonder why this lumpy, shriveled thing is needed?‚Äù</i> But I was distracted.  This post is about the technical side of the game.  It all started with ... how the hell can you generate procedural organs in general? <br><br>  It all started many months ago from the night of watching a video about an autopsy (most of the research on this topic reminded me of <a href="http://www.gamasutra.com/view/news/252241/How_working_on_gross_violent_games_can_mess_with_developers.php">this article</a> on Gamasutra).  Of course, I could continue to generate corpses with previously created models of organs.  But I just added a name generator on Markov's chains to the <a href="https://yanko.itch.io/invocation-toy">Invocation</a> prototype, and it got me thinking: maybe it‚Äôs worth using them to generate organs that look more like ‚Äúreal‚Äù? <br><br>  For Markov chains, we need several initial samples: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/de9/40b/1c2/de940b1c2076e6013472d25ef5893295.png" alt="image"><br><br>  Yes, incredible 8 √ó 8 pixel patterns that, if you squint, are a bit like organs.  First, I encoded black and white pixels as zeros and ones in the string, and then transferred it to the Markov chain ‚Äî this, I was almost sure, would not work, but I wanted to take a step-by-step approach. <br><br><img align="left" src="https://habrastorage.org/getpro/habr/post_images/ea4/d1b/a2d/ea4d1ba2dde424711dce206935b90010.gif" alt="image">  And you know what?  Yes, I was right, glitch textures were created, because images need two-dimensional integrity.  Therefore, the next step was to encode the image into groups of two-dimensional positions for all white pixels.  So actually it turned out to generate some interesting results, quite convincing variations of the input information. <br><br><hr><br><img align="right" src="https://habrastorage.org/getpro/habr/post_images/9a7/133/b9b/9a7133b9b29ef75c15c2b08fa1c66880.gif" alt="image">  I decided that I needed MORE, so I increased the size of the samples to 16 √ó 16 pixels.  It turned out that 8 √ó 8 is the optimal size, so I didn‚Äôt really look for ways to increase the resolution (and this was hardly the point). <br><br>  Well, okay, we've got organ-like shapes, but they have low resolution and they are two-dimensional.  How to add another dimension to them?  The first thing that comes to mind is the use of <a href="https://ru.wikipedia.org/wiki/Metaball">metaspheres</a> . <br><br><hr><br><img align="left" src="https://habrastorage.org/getpro/habr/post_images/ffb/da4/528/ffbda452865f8ba9278f3a28a3341ef0.gif" alt="image">  As a result, I just began to convert the image into a three-dimensional grid of 8x8x1 and transfer it to the <a href="https://ru.wikipedia.org/wiki/Marching_cubes">algorithm of walking cubes</a> (marching cubes algorithm).  We got 3D, but too awkward. <br><br>  I have a habit of greedy work on prototypes and gamejams.  Therefore, instead of going back and bringing the metaspheres to mind, I decided to add a grid smoothing algorithm over the generated mesh. <br><br><hr><br><img align="right" src="https://habrastorage.org/getpro/habr/post_images/a7c/690/37c/a7c69037c2eb02bc2c39ab272ee63f32.gif" alt="image">  I just threw this <a href="http://wiki.unity3d.com/index.php%3Ftitle%3DMeshSmoother">mesh filter from the Unity Wiki</a> .  This slightly improved the shape of the objects.  But the organs were still completely flat.  Then I added some random shifts along the Y axis for all vertices located on flat surfaces (i.e., the normals of which are directed exactly up or down). <br><br>  And look at that.  I am sure that I just have <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25B0%25D1%2580%25D0%25B5%25D0%25B9%25D0%25B4%25D0%25BE%25D0%25BB%25D0%25B8%25D1%258F">pareidolia</a> , but I clearly see the spleen, lung, liver ... spleen ... and ... well, all sorts of organ-like forms. <br><br>  When it was time to texturing, I decided to cut corners again and avoid creating UV scans of these pieces.  I did some experiments with the 3D noise functions (you can take noise shaders ported by me <a href="https://github.com/stegu/webgl-noise/wiki">from this repository</a> in a convenient and hardly tested <a href="http://pastebin.com/JqGgG5k6">CGINC for Unity</a> ).  They looked pretty good (and I might be using them somewhere), but the cheap solution became very expensive when it took to create normal maps for textures. <br><br><div class="oembed"><div><div style="left: 0px; width: 100%; height: 0px; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0px; left: 0px; width: 100%; height: 100%; position: absolute;">  Your browser does not support HTML5 video. <source src="http://yankooliveira.com/wp-content/uploads/2016/11/noiseAnim.mp4?_=3" type="video/mp4"></video></div></div></div><br>  As a result, a simple planar UV map (created by the location of the coordinates of the XZ vertices normalized in the UV space) turned out to be quite good.  I was able to use painted textures (which not only made me disgusted when searching for photo sources, but were also retweeted by Polycount). <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: static; visibility: visible; display: block; transform: rotate(0deg); width: 500px; margin: 10px auto; max-width: 100%; min-width: 220px;" data-tweet-id="795031072585162753"></twitter-widget><script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  <i>- What are your plans for Saturday night?</i> <i><br></i>  <i>- Well, you know, as usual, I will draw seamless textures of guts, and so on.</i> <br><br>  Mmm, sausages! <br><br><img align="left" src="https://habrastorage.org/getpro/habr/post_images/97e/e37/170/97ee37170cc2d6ef15a4eb99ed4a96d0.gif" alt="image">  So, the organs are generated.  But now how to shove them into the good old devil?  Opening the chest is quite simple: you just need to add another key morphing phase to the demon model.  But how to place the organs there? <br><br>  At first, I thought that I would have to create a very complex algorithm for determining boundaries, which checks whether everything is ‚Äúpacked‚Äù correctly.  As a result, it turned out that it is enough to add spawn points on the bones of the creature.  But the problem still remains: they crawl out of the body, as seen in the areas circled in red. <br><br><hr><br><img align="right" src="https://habrastorage.org/getpro/habr/post_images/cd7/657/71c/cd765771c37bc72db9c951163f651d5a.gif" alt="image">  Buffer template (stencil buffer) to the rescue!  You can use the template buffer to create a ‚Äúmask‚Äù of the chest area, and render organs only in this area. <br><br>  The grid of the mask (green) is completely flat, and if you look closely, you can notice its boundaries.  But even when moving, the overall effect is good enough. <br><br><hr><br>  Analyzing my work, I think that many of my decisions were redundant.  And I could achieve a better result with the help of a good artist who would draw all these organs.  But it was a fun experiment.  In the end, it seems to me that the most important was the study of this uncharted territory.  She is so strange and unusual that, probably, no one has wandered into it yet. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/91b/de3/530/91bde35303f7a8176680a9bde18c1433.gif" alt="image"></div><p>Source: <a href="https://habr.com/ru/post/316604/">https://habr.com/ru/post/316604/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../316590/index.html">Web hosting: useful tips</a></li>
<li><a href="../316592/index.html">Connecting the clouds: free integration of PBX and CRM</a></li>
<li><a href="../316596/index.html">Typical backup errors and how to avoid them. Part two</a></li>
<li><a href="../316598/index.html">Since December 7, Google transfers all G Suite accounts (formerly Google Apps) in Russia to commercial status.</a></li>
<li><a href="../316602/index.html">View globals in the Cach√© Database Management Portal</a></li>
<li><a href="../316606/index.html">Front-end JavaScript framework Evolution beta</a></li>
<li><a href="../316608/index.html">Mozilla and Tor closed a critical vulnerability that was actively used to de-anonymize Tor users.</a></li>
<li><a href="../316610/index.html">Double your money in December! New Year's Eve action on "My Circle"</a></li>
<li><a href="../316616/index.html">How we participated in the HR hackathon. Our graduates share their decision and impressions of participation.</a></li>
<li><a href="../316618/index.html">9 ways to optimize front-end performance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>