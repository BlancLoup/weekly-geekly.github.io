<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Exchange Vulnerability: How to Detect Privilege Elevation by Domain Administrator</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The vulnerability in Exchange discovered this year allows any domain user to gain domain administrator rights and compromise Active Directory (AD) and...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Exchange Vulnerability: How to Detect Privilege Elevation by Domain Administrator</h1><div class="post__text post__text-html js-mediator-article">  The <a href="https://dirkjanm.io/abusing-exchange-one-api-call-away-from-domain-admin/">vulnerability in Exchange</a> discovered this year allows any domain user to gain domain administrator rights and compromise Active Directory (AD) and other connected hosts.  Today we will explain how this attack works and how to detect it. <br><br><img src="https://habrastorage.org/webt/ud/tc/xh/udtcxhyp-k1wn1vnlmuu_4d3-d8.png"><br><a name="habracut"></a><br>  <b>This is how this attack works:</b> <br><br><ol><li>  The attacker seizes the account of any domain user with an active mailbox to subscribe to the function of push-notifications from Exchange </li><li>  The attacker uses NTLM relay to deceive the Exchange server: eventually, the Exchange server connects to the compromised user‚Äôs computer using the NTLM over HTTP method, which the attacker then uses to pass the authentication procedure on the domain controller using an LDAP with the Exchange account information </li><li>  As a result, the attacker uses these permissions to the Exchange account to elevate his privileges.  This last step can also be performed by a hostile administrator who already has legitimate access to make the necessary rights change.  By creating a rule to detect this activity, you will be protected from this and similar attacks. </li></ol><br>  Subsequently, an attacker could, for example, run DCSync to obtain the hashed passwords of all domain users.  This will allow him to implement various types of attacks - from attacks on the golden ticket to the transfer of hash. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The Varonis research team studied this attack vector in detail and prepared a guide for our clients to detect it and at the same time check whether they have already been compromised. <br><br><h2>  <b>Domain Privilege Discovery Detection</b> </h2><br>  In <a href="https://sites.varonis.com/ru/products/datalert/">DatAlert,</a> create a custom rule to track changes to specific permissions on an object.  It will work when adding rights and permissions to the object of interest in the domain: <br><br><ol><li>  Enter the name of the rule </li><li>  Set the category as ‚ÄúPrivilege escalation‚Äù </li><li>  Set the value for the resource type "All Resource Types" </li><li>  File Server = DirectoryServices </li><li>  Set the domain you are interested in, for example, by name </li><li>  Add a filter to add permissions on the AD object </li><li>  And do not forget to leave unchecked the option "Search in child objects" </li></ol><br><img src="https://habrastorage.org/webt/2h/fc/92/2hfc9248n-qc6fgx-xxil9iv9qw.png"><br><br><h2>  <b>And now the report: detection of changes in rights to the domain object</b> </h2><br>  Changes to permissions on an AD object are quite rare, so everything that triggered this warning should and should be investigated.  It would also be nice to test the type and contents of the report before launching the rule itself. <br><br>  This report will also show whether you have already been compromised by this attack: <br><br><img src="https://habrastorage.org/webt/c0/08/1a/c0081aezqosmxqzhoot2qdf5bsg.png"><br><br>  After activating the rule, you can investigate all other privilege escalation events using the DatAlert web interface: <br><br><img src="https://habrastorage.org/webt/xu/0f/qh/xu0fqhcovoplluhydy9gllxwaiq.png"><br><br>  After you configure this rule, you can monitor and protect against these and similar types of security vulnerabilities, investigate events with AD directory service objects, and check whether you are exposed to this critical vulnerability. </div><p>Source: <a href="https://habr.com/ru/post/451906/">https://habr.com/ru/post/451906/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451898/index.html">Innovations in Russian</a></li>
<li><a href="../4519/index.html">"Fat" investment hinders a good startup</a></li>
<li><a href="../451900/index.html">The first contribution to the browser API from Facebook</a></li>
<li><a href="../451902/index.html">Microsoft Azure Developer Camp Russia</a></li>
<li><a href="../451904/index.html">Sometimes more is less. When reducing the load increases the delay</a></li>
<li><a href="../451908/index.html">The history of computers: night at the Yandex Museum</a></li>
<li><a href="../451912/index.html">MuseNet Deep Neural Network Writes Music</a></li>
<li><a href="../451916/index.html">Asynchronous PHP and the story of one bike</a></li>
<li><a href="../451918/index.html">On the issue of TI</a></li>
<li><a href="../45192/index.html">Ltsp. We connect Flash-carriers for clients</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>