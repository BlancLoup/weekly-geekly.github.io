<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>USB mass storage device and libopencm3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="My work is related to the programming of microcontrollers, in particular STM32. For a long time, I used the STM32 Standard Peripheral Library to work ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>USB mass storage device and libopencm3</h1><div class="post__text post__text-html js-mediator-article"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2f9/23e/a7e/2f923ea7e0df99d429d4c2d1a8fdd576.jpg" alt="image"></div><br><br><p></p><br><br>  My work is related to the programming of microcontrollers, in particular STM32.  For a long time, I used the STM32 Standard Peripheral Library to work with peripherals, as it is provided by the manufacturer and, accordingly, is the most complete.  However, it is extremely inconvenient to work with it: initializing structures are often redundant, in the functions of the devil they break my leg, in general, very soon there is an overwhelming desire to get off this library and switch to something more accurate, correctly designed and written with ‚Äúclean code‚Äù. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After a long search, the open source library libopencm3 was discovered, which met all the requirements.  The reviews about her were positive and it turned out to be as pleasant as possible to work with her. <br><br>  One of the last tasks at work was to raise USB MSD.  To solve the problem, the STM32F4-discovery debug board and <a href="https://github.com/libopencm3/libopencm3-examples/tree/master/examples/stm32/f4/stm32f4-discovery/usb_msc">this example were used</a> .  The example did not start.  There were two problems: <br>  1. It was impossible to go to the disk and read the file located there. <br>  2. Recognizing the device as a disk took more than 2 minutes. <br><br>  All this was due to the presence of several bugs in the <a href="">usb_msc.c</a> file.  Thus, in this article I will discuss how to correct these errors and continue to enjoy the library libopencm3 with pleasure. <br><a name="habracut"></a><br><br>  <b>Solution to problem number 1:</b> <br>  The essence of the error is that when the device receives a write request, it processes it correctly, but does not send back the processing status of the CSW request (Command Status Wrapper).  Thus, the usb host (in our case, this is our PC) goes to the endless waiting for a response to the request, everything hangs, buggy, dies until you unplug the device =) <br><br>  * <i>Read more about Mass Storage Bulk-Only or CBI Transport Specification <a href="http://www.usb.org/developers/docs/devclass_docs/">here</a> .</i> <br><br>  Therefore, we find the function <b>msc_data_rx_cb</b> in the <b>usb_msc.c</b> file and bring it to the following form: <br><div class="spoiler">  <b class="spoiler_title">Added code snippet between slashes</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">msc_data_rx_cb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(usbd_device *usbd_dev, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ep)</span></span></span><span class="hljs-function"> </span></span>{ usbd_mass_storage *ms; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">usb_msc_trans</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">trans</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> len, max_len, left; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *p; ms = &amp;_mass_storage; trans = &amp;ms-&gt;trans; <span class="hljs-comment"><span class="hljs-comment">/* RX only */</span></span> left = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(struct usb_msc_cbw) - trans-&gt;cbw_cnt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span> &lt; left) { max_len = MIN(ms-&gt;ep_out_size, left); p = &amp;trans-&gt;cbw.buf[<span class="hljs-number"><span class="hljs-number">0x1ff</span></span> &amp; trans-&gt;cbw_cnt]; len = usbd_ep_read_packet(usbd_dev, ep, p, max_len); trans-&gt;cbw_cnt += len; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(struct usb_msc_cbw) == trans-&gt;cbw_cnt) { scsi_command(ms, trans, EVENT_CBW_VALID); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (trans-&gt;byte_count &lt; trans-&gt;bytes_to_read) { <span class="hljs-comment"><span class="hljs-comment">/* We must wait until there is something to * read again. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (trans-&gt;byte_count &lt; trans-&gt;bytes_to_read) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span> &lt; trans-&gt;block_count) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-number"><span class="hljs-number">0</span></span> == trans-&gt;byte_count) &amp;&amp; (<span class="hljs-literal"><span class="hljs-literal">NULL</span></span> != ms-&gt;lock)) { (*ms-&gt;lock)(); } } left = trans-&gt;bytes_to_read - trans-&gt;byte_count; max_len = MIN(ms-&gt;ep_out_size, left); p = &amp;trans-&gt;msd_buf[<span class="hljs-number"><span class="hljs-number">0x1ff</span></span> &amp; trans-&gt;byte_count]; len = usbd_ep_read_packet(usbd_dev, ep, p, max_len); trans-&gt;byte_count += len; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span> &lt; trans-&gt;block_count) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span> == (<span class="hljs-number"><span class="hljs-number">0x1ff</span></span> &amp; trans-&gt;byte_count)) { <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> lba; lba = trans-&gt;lba_start + trans-&gt;current_block; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span> != (*ms-&gt;write_block)(lba, trans-&gt;msd_buf)) { <span class="hljs-comment"><span class="hljs-comment">/* Error */</span></span> } trans-&gt;current_block++; } } <span class="hljs-comment"><span class="hljs-comment">/////////////////////ADD THIS////////////////////////////////////////////////////////////////////////////////// if (false == trans-&gt;csw_valid) { scsi_command(ms, trans, EVENT_NEED_STATUS); trans-&gt;csw_valid = true; } left = sizeof(struct usb_msc_csw) - trans-&gt;csw_sent; if (0 &lt; left) { max_len = MIN(ms-&gt;ep_out_size, left); p = &amp;trans-&gt;csw.buf[trans-&gt;csw_sent]; len = usbd_ep_write_packet(usbd_dev, ms-&gt;ep_in, p, max_len); trans-&gt;csw_sent += len; } /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// } else if (trans-&gt;byte_count &lt; trans-&gt;bytes_to_write) { if (0 &lt; trans-&gt;block_count) { if ((0 == trans-&gt;byte_count) &amp;&amp; (NULL != ms-&gt;lock)) { (*ms-&gt;lock)(); } if (0 == (0x1ff &amp; trans-&gt;byte_count)) { uint32_t lba; lba = trans-&gt;lba_start + trans-&gt;current_block; if (0 != (*ms-&gt;read_block)(lba, trans-&gt;msd_buf)) { /* Error */ } trans-&gt;current_block++; } } left = trans-&gt;bytes_to_write - trans-&gt;byte_count; max_len = MIN(ms-&gt;ep_out_size, left); p = &amp;trans-&gt;msd_buf[0x1ff &amp; trans-&gt;byte_count]; len = usbd_ep_write_packet(usbd_dev, ms-&gt;ep_in, p, max_len); trans-&gt;byte_count += len; } else { if (0 &lt; trans-&gt;block_count) { if (trans-&gt;current_block == trans-&gt;block_count) { uint32_t lba; lba = trans-&gt;lba_start + trans-&gt;current_block; if (0 != (*ms-&gt;write_block)(lba, trans-&gt;msd_buf)) { /* Error */ } trans-&gt;current_block = 0; if (NULL != ms-&gt;unlock) { (*ms-&gt;unlock)(); } } } if (false == trans-&gt;csw_valid) { scsi_command(ms, trans, EVENT_NEED_STATUS); trans-&gt;csw_valid = true; } left = sizeof(struct usb_msc_csw) - trans-&gt;csw_sent; if (0 &lt; left) { max_len = MIN(ms-&gt;ep_out_size, left); p = &amp;trans-&gt;csw.buf[trans-&gt;csw_sent]; len = usbd_ep_write_packet(usbd_dev, ms-&gt;ep_in, p, max_len); trans-&gt;csw_sent += len; } } }</span></span></code> </pre> <br></div></div><br><br>  Hurray, now we can go to the disk to read the file! <br><br>  <b>Solution of the problem number 2:</b> <br>  The essence of this problem is that two SCSI commands are not implemented in the same usb_msc. file.  This was revealed using a very useful program <a href="http://www.usblyzer.com/">usblyser</a> , which allows you to conveniently view the exchange of shipments between a usb device and a usb host. <br><br>  So, firstly, the host does not receive a response to the READ_FORMAT_CAPACITIES command.  Therefore, we add the scsi_read_format_capacities function to the <b>usb_msc. file</b> and we bring the <b>scsi_command</b> function to the following form: <br><div class="spoiler">  <b class="spoiler_title">View code</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scsi_read_format_capacities</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(usbd_mass_storage *ms, struct usb_msc_trans *trans, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">enum</span></span></span></span><span class="hljs-function"><span class="hljs-params"> trans_event event)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (EVENT_CBW_VALID == event) { trans-&gt;msd_buf[<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-number"><span class="hljs-number">0x08</span></span>; trans-&gt;msd_buf[<span class="hljs-number"><span class="hljs-number">4</span></span>] = ms-&gt;block_count &gt;&gt; <span class="hljs-number"><span class="hljs-number">24</span></span>; trans-&gt;msd_buf[<span class="hljs-number"><span class="hljs-number">5</span></span>] = <span class="hljs-number"><span class="hljs-number">0xff</span></span> &amp; (ms-&gt;block_count &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>); trans-&gt;msd_buf[<span class="hljs-number"><span class="hljs-number">6</span></span>] = <span class="hljs-number"><span class="hljs-number">0xff</span></span> &amp; (ms-&gt;block_count &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>); trans-&gt;msd_buf[<span class="hljs-number"><span class="hljs-number">7</span></span>] = <span class="hljs-number"><span class="hljs-number">0xff</span></span> &amp; ms-&gt;block_count; trans-&gt;msd_buf[<span class="hljs-number"><span class="hljs-number">8</span></span>] = <span class="hljs-number"><span class="hljs-number">0x02</span></span>; trans-&gt;msd_buf[<span class="hljs-number"><span class="hljs-number">9</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; trans-&gt;msd_buf[<span class="hljs-number"><span class="hljs-number">10</span></span>] = <span class="hljs-number"><span class="hljs-number">0x02</span></span>; trans-&gt;msd_buf[<span class="hljs-number"><span class="hljs-number">11</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; trans-&gt;bytes_to_write = <span class="hljs-number"><span class="hljs-number">9</span></span>; set_sbc_status_good(ms); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scsi_command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(usbd_mass_storage *ms, struct usb_msc_trans *trans, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">enum</span></span></span></span><span class="hljs-function"><span class="hljs-params"> trans_event event)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (EVENT_CBW_VALID == event) { <span class="hljs-comment"><span class="hljs-comment">/* Setup the default success */</span></span> trans-&gt;csw_sent = <span class="hljs-number"><span class="hljs-number">0</span></span>; trans-&gt;csw.csw.dCSWSignature = CSW_SIGNATURE; trans-&gt;csw.csw.dCSWTag = trans-&gt;cbw.cbw.dCBWTag; trans-&gt;csw.csw.dCSWDataResidue = <span class="hljs-number"><span class="hljs-number">0</span></span>; trans-&gt;csw.csw.bCSWStatus = CSW_STATUS_SUCCESS; trans-&gt;bytes_to_write = <span class="hljs-number"><span class="hljs-number">0</span></span>; trans-&gt;bytes_to_read = <span class="hljs-number"><span class="hljs-number">0</span></span>; trans-&gt;byte_count = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (trans-&gt;cbw.cbw.CBWCB[<span class="hljs-number"><span class="hljs-number">0</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SCSI_TEST_UNIT_READY: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SCSI_SEND_DIAGNOSTIC: <span class="hljs-comment"><span class="hljs-comment">/* Do nothing, just send the success. */</span></span> set_sbc_status_good(ms); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SCSI_FORMAT_UNIT: scsi_format_unit(ms, trans, event); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SCSI_REQUEST_SENSE: scsi_request_sense(ms, trans, event); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SCSI_MODE_SENSE_6: scsi_mode_sense_6(ms, trans, event); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SCSI_READ_6: scsi_read_6(ms, trans, event); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SCSI_INQUIRY: scsi_inquiry(ms, trans, event); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SCSI_READ_CAPACITY: scsi_read_capacity(ms, trans, event); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SCSI_READ_10: scsi_read_10(ms, trans, event); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SCSI_WRITE_6: scsi_write_6(ms, trans, event); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SCSI_WRITE_10: scsi_write_10(ms, trans, event); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-comment"><span class="hljs-comment">//////////////////ADD THIS/////////////////////////////////////////////////////////////////////////////////////////////////// case SCSI_READ_FORMAT_CAPACITIES: scsi_read_format_capacities(ms, trans, event); break; //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// default: set_sbc_status(ms, SBC_SENSE_KEY_ILLEGAL_REQUEST, SBC_ASC_INVALID_COMMAND_OPERATION_CODE, SBC_ASCQ_NA); trans-&gt;bytes_to_write = 0; trans-&gt;bytes_to_read = 0; trans-&gt;csw.csw.bCSWStatus = CSW_STATUS_FAILED; break; } }</span></span></code> </pre><br></div></div><br><br>  Secondly, the host does not receive a response to the INQUIRY (SERIAL NUMBER) command.  To correct this error, you need to create an <b>_spc3_inquiry_sn_response</b> array and bring the <b>scsi_inquiry</b> function to the following form: <br><div class="spoiler">  <b class="spoiler_title">View code</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> _spc3_inquiry_sn_response[<span class="hljs-number"><span class="hljs-number">20</span></span>] = { <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x10</span></span>, <span class="hljs-comment"><span class="hljs-comment">//    .     16 (third pin 123456) 't','h','i','r','d',' ','p','i','n',' ','1','2','3','4','5','6' }; static void scsi_inquiry(usbd_mass_storage *ms, struct usb_msc_trans *trans, enum trans_event event) { if (EVENT_CBW_VALID == event) { uint8_t evpd; uint8_t *buf; buf = get_cbw_buf(trans); evpd = 1 &amp; buf[1]; if (evpd == 0) { size_t len; trans-&gt;bytes_to_write = sizeof(_spc3_inquiry_response); memcpy(trans-&gt;msd_buf, _spc3_inquiry_response, sizeof(_spc3_inquiry_response)); len = strlen(ms-&gt;vendor_id); len = MIN(len, 8); memcpy(&amp;trans-&gt;msd_buf[8], ms-&gt;vendor_id, len); len = strlen(ms-&gt;product_id); len = MIN(len, 16); memcpy(&amp;trans-&gt;msd_buf[16], ms-&gt;product_id, len); len = strlen(ms-&gt;product_revision_level); len = MIN(len, 4); memcpy(&amp;trans-&gt;msd_buf[32], ms-&gt;product_revision_level, len); trans-&gt;csw.csw.dCSWDataResidue = sizeof(_spc3_inquiry_response); set_sbc_status_good(ms); } /////////////////////////////////ADD THIS///////////////////////////////////////////////////////////////////////////// else if (evpd == 1) { trans-&gt;bytes_to_write = sizeof(_spc3_inquiry_sn_response); memcpy(trans-&gt;msd_buf, _spc3_inquiry_sn_response, sizeof(_spc3_inquiry_sn_response)); trans-&gt;csw.csw.dCSWDataResidue = sizeof(_spc3_inquiry_sn_response); set_sbc_status_good(ms); } /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// else { /* </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Add VPD 0x83 support */ /* </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Add VPD 0x00 support */ } } }</span></span></code> </pre><br></div></div><br><br>  * You can <i>learn more about SCSI commands <a href="http://www.usb.org/developers/docs/devclass_docs/">again here</a> .</i> <br><br>  After all these surgical interventions, the library needs to be rebuilt, having previously executed the command make clean. <br><br>  Soon I plan to make a pull request to the repository with libopencm3, but it remains to be assumed how soon the owners will make these changes to the library, and in the meantime we all need to be here and now. <br><br>  I really hope that at least someone this article will relieve an extra headache and will be useful. <br><br>  PS: <a href="https://github.com/thirdpin">Here</a> lies our corporate fork of the library with the changes already made, if you lazily dig yourself. </div><p>Source: <a href="https://habr.com/ru/post/304924/">https://habr.com/ru/post/304924/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../304888/index.html">TDD for Oracle stored procedures</a></li>
<li><a href="../304904/index.html">Purchase history of a single ticket on the Russian Railways website</a></li>
<li><a href="../304906/index.html">Applications for the VIII Summer School of High-Performance Computing in the Field of Computer Vision have been opened</a></li>
<li><a href="../304908/index.html">How to start developing a large, atypical project. Practical guide</a></li>
<li><a href="../304918/index.html">Take a technical interview</a></li>
<li><a href="../304926/index.html">Machine learning instead of DPI. Building a traffic classifier</a></li>
<li><a href="../304932/index.html">Data Protection - Modern Security Challenges</a></li>
<li><a href="../304934/index.html">Important aspects of the browser for developers. Part 2</a></li>
<li><a href="../304936/index.html">About tasty and healthy food ESP8266 from batteries</a></li>
<li><a href="../304982/index.html">Sparrowdo is a simple configuration management tool.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>