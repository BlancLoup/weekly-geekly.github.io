<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Handling all exceptions in controllers using an attribute</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We all know that in ASP.NET MVC there is an attribute HandleErrorAttribute , which, as stated in MSDN  Represents an attribute used to handle an excep...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Handling all exceptions in controllers using an attribute</h1><div class="post__text post__text-html js-mediator-article"> We all know that in ASP.NET MVC there is an attribute <code>HandleErrorAttribute</code> , which, as stated in MSDN <blockquote>  Represents an attribute used to handle an exception that is called by an action method. <br></blockquote><br>  But nowhere, in the same MSDN it is not said ( <s>poke my nose at the</s> link where it is written, if I looked) that it only handles exceptions that set the server response code to 500. <br><br>  Looking at the source code of <code>HandleErrorAttribute</code> it is easy to see this.  There are the following lines: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// If this is not an HTTP 500 (for example, if somebody throws an HTTP 404 from an action method), // ignore it. if (new HttpException(null, exception).GetHttpCode() != 500) { return; }</span></span></code> </pre><br>  I don‚Äôt know how you are, but it‚Äôs more convenient for me when an exception occurs that users see a special page for this, and not a ‚Äúyellow death page‚Äù or even as a browser displays a standard page with a server response code (depends on the settings in Web.config but more on that later). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><h4>  Creating your own analogue <code>HandleErrorAttribute</code> </h4><br>  So, we found out that the standard <code>HandleErrorAttribute</code> does not suit us, well, let's create our own. <br><br>  You can, of course, create a class by inheriting it from the <code>IExceptionFilter</code> interface, but we are generally satisfied with the behavior of the standard <code>HandleErrorAttribute</code> if it handles all exceptions.  And since we are almost satisfied with everything, our class will inherit from the <code>HandleErrorAttribute</code> we don‚Äôt <code>HandleErrorAttribute</code> . <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HandleAllErrorAttribute</span></span> : <span class="hljs-title"><span class="hljs-title">HandleErrorAttribute</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnException</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ExceptionContext filterContext</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (filterContext == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-string"><span class="hljs-string">"filterContext"</span></span>); } <span class="hljs-comment"><span class="hljs-comment">// If custom errors are disabled, we need to let the normal ASP.NET exception handler // execute so that the user can see useful debugging information. if (filterContext.ExceptionHandled || !filterContext.HttpContext.IsCustomErrorEnabled) { return; } Exception exception = filterContext.Exception; if (!ExceptionType.IsInstanceOfType(exception)) { return; } string controllerName = (string)filterContext.RouteData.Values["controller"]; string actionName = (string)filterContext.RouteData.Values["action"]; HandleErrorInfo model = new HandleErrorInfo(filterContext.Exception, controllerName, actionName); filterContext.Result = new ViewResult { ViewName = View, MasterName = Master, ViewData = new ViewDataDictionary&lt;HandleErrorInfo&gt;(model), TempData = filterContext.Controller.TempData }; filterContext.ExceptionHandled = true; filterContext.HttpContext.Response.Clear(); filterContext.HttpContext.Response.StatusCode = new HttpException(null, exception).GetHttpCode(); // Certain versions of IIS will sometimes use their own error page when // they detect a server error. Setting this property indicates that we // want it to try to render ASP.NET MVC's error page instead. filterContext.HttpContext.Response.TrySkipIisCustomErrors = true; } }</span></span></code> </pre><br>  To begin with, I will say that this is the code of the standard <code>HandleErrorAttribute</code> , with the exception of a few lines that check for <code>HttpStatusCode</code> . <br><br>  Actually, what he does: <br><ul><li>  Checks input parameters for validity. </li><li>  Checks whether <code>customErrors</code> are <code>customErrors</code> </li><li>  Fills the class with <code>HandleErrorInfo</code> </li><li>  Creates a new <code>ViewResult</code> , fills it with data and assigns instead of the current </li><li>  Cleans server errors and sets server response code </li></ul><br><br>  Our class is ready, now let's replace the standard attribute with ours.  We do this through global filters so that we don‚Äôt write it to each controller or controller action.  In this case, it is not critical, but in reality it can be useful.  So, let's go to <i>Global.asax.cs</i> and write instead of the standard filter, our newly created attribute: <br><br><pre> <code class="cs hljs">filters.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HandleAllErrorAttribute());</code> </pre><br><br><h4>  Test </h4><br>  Now, to make sure that our filter works and passes the necessary data to the <code>View</code> , <i>let's</i> change the standard <i>~ / Views / Shared / Error.cshtml</i> : <br><br><pre> <code class="html hljs xml">@model System.Web.Mvc.HandleErrorInfo @{ ViewBag.Title = "Error"; } <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> Sorry, an error occurred while processing your request. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span>@Model.Exception.Message<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  And add the following line to the <code>System.Web</code> section in the <i>Web.config</i> (which is in the root): <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">customErrors</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"On"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">defaultRedirect</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Error"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  This line we include custom error handling, more precisely, custom error pages. <br><br>  Now we need to raise an exception, I will do it in the action of a standard controller (created by the studio): <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">About</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpException(<span class="hljs-number"><span class="hljs-number">403</span></span>, <span class="hljs-string"><span class="hljs-string">" !"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(); }</code> </pre><br>  Everything!  We start the project, go to the section ‚ÄúAbout‚Äù and see that our attribute has worked correctly. <br><br><img src="https://habrastorage.org/storage2/1d7/ffd/1fb/1d7ffd1fb07ae33c7f9c8db57c338a2c.png"><br></div><p>Source: <a href="https://habr.com/ru/post/137672/">https://habr.com/ru/post/137672/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137666/index.html">Windows 8 Camp - March 2 in Moscow and online</a></li>
<li><a href="../137668/index.html">New version of opensource nopCommerce mobile-enabled engine has been released</a></li>
<li><a href="../137669/index.html">Modification of Asus Eee PC 900 SSD and Huawei E150 USB 3G integration</a></li>
<li><a href="../137670/index.html">CSS3: life without prefixes</a></li>
<li><a href="../137671/index.html">Cisco is engaged in servers?</a></li>
<li><a href="../137673/index.html">Satellite speedometer on STM32F1 and FreeRTOS</a></li>
<li><a href="../137674/index.html">7app chart # 10</a></li>
<li><a href="../137677/index.html">Python sqlite3: Finding slow queries</a></li>
<li><a href="../137679/index.html">Windows v Enikey</a></li>
<li><a href="../137680/index.html">Comparing Objects in C # .NET</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>