<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHP class for building in one file</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="based on the mocksoul comment from the PHP topic : Introduction to the Zend Framework 

 Problem 
 In short, it was about the fact that one of the fla...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHP class for building in one file</h1><div class="post__text post__text-html js-mediator-article">  based on the <a href="http://geektimes.ru/users/mocksoul/" class="user_link">mocksoul</a> <a href="http://www.habrahabr.ru/blog/php/21089.html">comment</a> from the <a href="http://www.habrahabr.ru/blog/php/21089.html">PHP</a> topic <a href="http://www.habrahabr.ru/blog/php/21089.html">: Introduction to the Zend Framework</a> <br><br><h1>  Problem </h1><br>  In short, it was about the fact that one of the flaws of the framework is its concept of ‚Äúone class - one file‚Äù.  And although, from my point of view, this is not a flaw in the ZF architecture, it is a flaw in PHP.  Problems begin when PHP starts to include dozens and hundreds of files, and even check them once. <br><br>  The proposed solution is the assembly of all the inclusions into one file. <a name="habracut"></a>  The class presented below does not claim to be the ultimate universal solution to the problem.  It only demonstrates one of the methods for assembling the inclusives.  In this case, it collects <b>only the</b> framework files, ignoring all others. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  Class </h1><br><blockquote>  &lt;? php <br>  class ZendMake <br>  { <br>  / ** <br>  * Build files with deletion of comments, require / include, etc. <br>  * <br>  * <a href="http://geektimes.ru/users/param/" class="user_link">param</a> string $ dest Absolute name of compiled file <br>  * <a href="http://geektimes.ru/users/param/" class="user_link">param</a> string $ includes Array of ZF files to build <br>  * <a href="http://geektimes.ru/users/return/" class="user_link">return</a> array <br>  * / <br>  public static function make ($ dest, $ includes = null) <br>  { <br>  $ includes = is_array ($ includes)?  $ includes: self :: _ getZendIncludes (); <br><br>  // Remove tags' &lt;? Php ''?  &gt; ', comments, blank lines and require / include [_once] <br>  $ pattern [] = '% (^ \ &lt;\? php | \? \&gt; $)% m'; <br>  $ replacement [] = ''; <br>  $ pattern [] = '% / \ *. *? \ * /% sm'; <br>  $ replacement [] = ''; <br>  $ pattern [] = '% //. * $% m'; <br>  $ replacement [] = ''; <br>  $ pattern [] = '% (require_once | include_once | require | include) [("\'] (. *?) [)" \ '];% sm';; <br>  $ replacement [] = ''; <br>  $ pattern [] = '% (\ n) {2,}%'; <br>  $ replacement [] = "\ n"; <br><br>  $ body = "&lt;? php \ n"; <br>  foreach ($ includes as $ fname) { <br><br>  $ body. = preg_replace ($ pattern, $ replacement, file_get_contents ($ fname, true)); <br>  } <br><br>  $ size = file_put_contents ($ dest, $ body); <br><br>  return array ('includes' =&gt; $ includes, 'compiledBody' =&gt; $ body, 'compiledSize' =&gt; $ size); <br>  } <br><br>  / ** <br>  * Select unique ZF files that are stuck in the project <br>  * <br>  * <a href="http://geektimes.ru/users/return/" class="user_link">return</a> array <br>  * / <br>  private static function _getZendIncludes () <br>  { <br>  $ required = array (); <br>  $ included_files = get_included_files (); <br>  foreach ($ included_files as $ fname) { <br>  if (! (strpos ($ fname, 'Zend')&gt; 0) || (strstr ($ fname, __CLASS__. '.php'))) { <br>  continue; <br>  } <br><br>  $ required [] = str_replace ('\\', '/', substr ($ fname, strpos ($ fname, 'Zend'), strlen ($ fname))); <br><br>  // All requires <br>  $ pattern = '% (require_once | include_once | require | include) [("\'] (. *?) [)" \ '];% sm'; <br>  preg_match_all ($ pattern, file_get_contents ($ fname), $ pocket); <br><br>  $ required = array_merge ($ pocket [2], $ required); <br>  } <br><br>  return array_unique ($ required); <br>  } <br>  } <br></blockquote><br><br><h1>  Using </h1><br>  Insert lines at the end of the script <br><blockquote>  require 'ZendMake.php'; <br>  $ result = ZendMake :: make ($ libDir. 'Zend.Make.php'); <br>  Zend_Debug :: dump ($ result ['includes']); <br>  Zend_Debug :: dump ($ result ['compiledSize']); <br></blockquote><br><br><h1>  results </h1><br>  Using this class, I collected more than 60 ZF files from my project (Controller, Session, Auth, View, Uri, Db, Config, Version, Debug, Registry modules).  The collected file took 231 kb. <br><br>  The running time of the script using the assembled file is faster than the script using a large number of inclusions by more than 8 times. </div><p>Source: <a href="https://habr.com/ru/post/12395/">https://habr.com/ru/post/12395/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../123945/index.html">Running code under another user in Windows from Java</a></li>
<li><a href="../123946/index.html">Letter</a></li>
<li><a href="../123947/index.html">Personal data protection - how to be and what to do?</a></li>
<li><a href="../123948/index.html">Best DNS practices for telecom</a></li>
<li><a href="../123949/index.html">Semantics for CSS selectors and combinators</a></li>
<li><a href="../123950/index.html">The work of the Ural physicists on spintronics in Physical Review Letters</a></li>
<li><a href="../123951/index.html">AVL trees and their breadth</a></li>
<li><a href="../123953/index.html">Multiplication overflow</a></li>
<li><a href="../123954/index.html">Starved? New culinary search engine</a></li>
<li><a href="../123955/index.html">Working with URL and storing them</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>