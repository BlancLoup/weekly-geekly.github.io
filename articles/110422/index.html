<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHP + BDD = Behat, or a tale of a miracle library</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anyone who is seriously involved in Ruby development knows about the wonderful Cucumber gem. In short, it is a library for automated testing, honed un...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHP + BDD = Behat, or a tale of a miracle library</h1><div class="post__text post__text-html js-mediator-article">  Anyone who is seriously involved in Ruby development knows about the wonderful Cucumber gem.  In short, it is a library for automated testing, honed under BDD.  You can read more in the <a href="http://habrahabr.ru/blogs/ruby/62958/">topic of</a> dapi <a href="https://habrahabr.ru/users/dapi/" class="user_link">habrauser</a> , and even better watch the <a href="http://railscasts.com/episodes/155-beginning-with-cucumber">podcast</a> from Rain Bates.  The main charm of the "cucumber" is that it allows you to write tests in a language understandable to man, and not even necessarily English.  It looks like this: <br><br><pre> Feature: Addition 
   In order to avoid silly mistakes 
   As a math idiot 
   I want to be told <font></font>
<font></font>
   Scenario: Add two numbers 
     Given I have entered 50 into the calculator
       And I have entered 70 into the calculator
      When I press add
      Then the result should be 120 on the scree
</pre><br>  Thanks to Cucumber, I got hooked on BDD on the tracks.  But here on PHP, with which one has to work most of the time, the relationship with BDD somehow did not develop.  And first of all because of the lack of decent tools.  But one day fate brought me to the page of the <a href="http://everzet.com/Behat/">Behat</a> library (written, by the way, by the habrayuzer <a href="https://habrahabr.ru/users/everzet/" class="user_link">everzet</a> ).  And happiness fell on me ... <br><a name="habracut"></a><br><h4>  Installation and pre-setting </h4><br>  Actually, Behat is ‚ÄúCucumber from the world of PHP‚Äù.  The same syntax ( <a href="http://wiki.github.com/aslakhellesoy/cucumber/gherkin">Gherkin</a> language is <a href="http://wiki.github.com/aslakhellesoy/cucumber/gherkin">used</a> ), the same file structure, almost identical method of determining steps.  It is evident that the author was inspired by the "elder brother" of his library, which he does not hide.  It looks beautiful, but we didn‚Äôt look at her.  It's time to try the product in action. <br><br>  <i>Immediately make a reservation - Behat requires PHP 5.3.1 for its work.</i>  <i>Therefore, if you have not yet acquired it, it's time to do it.</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The author on the site offers several ways to install Behat.  I will choose the very first and easiest one through Pear: <br> <code>$ pear channel-discover pear.everzet.com <br> $ pear install everzet/behat-beta <br></code> <br>  Tadam!  We are happy owners of Behat :) In principle, you can even now go to the folder with the project under test and start writing scripts, but I prefer to ‚Äútune‚Äù the library a little.  So, first of all we will create a habitat native to the Behat in the project folder.  She, as already mentioned, borrowed from Cucumber and has the following form: <br><br><pre> | - features
    `- steps
    |  `- * _steps.php
    `- support
        `- env.php
</pre><br><br>  More about what we have: <br><ul><li>  <b>features</b> is a folder where scripts will be stored (files * .feature, about them a bit later); </li><li>  <b>features / steps</b> is a folder with descriptions of the "steps" of testing; </li><li>  <b>features / support</b> - folder with support scripts.  Of particular importance here is the file <b>env.php</b> , which describes the configuration of the environment.  We will open it. </li></ul><br>  Initially, the env.php file is empty.  Its main importance for us is that it is executed each time before executing the next script.  And it is here that it is convenient to connect all the libraries and project files we need.  Here it is convenient to determine the variables and functions that we need in the tests.  For their storage, by the way, it is very convenient to use the $ world variable, which is fed to us at the entrance, each time new.  By and large, to use the basic functionality we don‚Äôt have any need to tweak something, it‚Äôs enough that PHP provides us with Behat.  But I still like to use the functions of checks from PHPUnit, and I will connect them with your permission. <br><br>  If you do not have PHPUnit installed, it is installed very simply, through the same Pear: <br> <code>$ pear channel-discover pear.phpunit.de <br> $ pear channel-discover components.ez.no <br> $ pear channel-discover pear.symfony-project.com <br> $ pear install phpunit/PHPUnit <br></code> <br>  Done, it remains only to register in env.php: <br><pre> &lt;? php
 require_once 'PHPUnit / Autoload.php';
 require_once 'PHPUnit / Framework / Assert / Functions.php';
 ?&gt;
</pre><br>  Also, in order for us to have classes and functions available from our project, we need to connect the appropriate files to the environment.  I do not like to litter the initialization of the environment with extraneous inclusions, and therefore I will combine them into one file - <b>includes.php</b> , and I will connect it to the environment.  As a result, the env.php file has the form: <br><br><pre> &lt;? php
 require_once 'PHPUnit / Autoload.php';
 require_once 'PHPUnit / Framework / Assert / Functions.php';
 include 'includes.php';
 ?&gt;
</pre><br><h4>  We describe the features and make the first launch </h4><br>  Well, that's all, we are ready to test, you can begin to describe the features.  As an example, I decided to take such a difficult thing to implement and test as the addition of two numbers.  So, create the <b>calc.feature</b> file in the <b>features</b> folder and write: <br><br><pre> Feature: Addition
     In order to avoid silly mistakes 
     As a math idiot 
     I want to be told<font></font>
<font></font>
     Scenario:
        Given I have an calculator
         When I have entered 30 as first number
          And I have entered 20 as second number
          And I press 'Add'
         Then the result should be 50
</pre><br><br>  Save, and drive into the console command <br> <code>$ behat features</code> <br> <br>  At the output we get: <br><pre> 1 scenario (1 undefined)
 5 steps (5 undefined)
 0.091s<font></font>
<font></font>
 You can implement step definitions for undefined steps with these snippets:<font></font>
<font></font>
 $ steps-&gt; Given ('/ ^ I have an calculator $ /', function ($ world) {
     throw new \ Everzet \ Behat \ Exception \ Pending ();
 });<font></font>
<font></font>
 $ steps-&gt; When ('/ ^ I have entered (\ d +) as first number $ /', function ($ world, $ arg1) {
     throw new \ Everzet \ Behat \ Exception \ Pending ();
 });<font></font>
<font></font>
 $ steps-&gt; And ('/ ^ I have entered (\ d +) as second number $ /', function ($ world, $ arg1) {
     throw new \ Everzet \ Behat \ Exception \ Pending ();
 });<font></font>
<font></font>
 $ steps-&gt; And ('/ ^ I press \' ([^ \ '] *) \' $ / ', function ($ world, $ arg1) {
     throw new \ Everzet \ Behat \ Exception \ Pending ();
 });<font></font>
<font></font>
 $ steps-&gt; Then ('/ ^ The result should be (\ d +) $ /', function ($ world, $ arg1) {
     throw new \ Everzet \ Behat \ Exception \ Pending ();
 });
</pre><br>  This tells us that we have not defined the ‚Äústeps‚Äù of the scenario.  But we know even more - we do not have a calculator class.  We will write, not a problem. <br><br><pre> class Calc {
     protected $ first = 0;
     protected $ second = 0;
     protected $ result = 0;<font></font>
<font></font>
     public function setFirst ($ num) {$ this-&gt; first = $ num;  }
     public function setSecond ($ num) {$ this-&gt; second = $ num;  }
     public function add () {$ this-&gt; result = $ this-&gt; first + $ this-&gt; second;  }
     public function getResult () {return $ this-&gt; result;  }
 }
</pre><br><h4>  We describe the steps and conduct a successful test. </h4><br>  Well, now we can go to the description of the steps.  <i>Yes, by the way, do not forget to connect the file with the calculator class to the file features / support / includes.php.</i>  As we can see, Behat kindly offered us patterns for defining steps.  Copy them, tweak them a bit and save them in the <b>features / steps / calc_steps.php file</b> .  You should have something like this: <br><pre> &lt;? php
 $ steps-&gt; Given ('/ ^ I have an calculator $ /', function ($ world) {
     $ world-&gt; calc = new Calc ();
 });
 $ steps-&gt; When ('/ ^ I have entered (\ d +) as first number $ /', function ($ world, $ num) {
     $ world-&gt; calc-&gt; setFirst ($ num);
 });
 $ steps-&gt; When ('/ ^ I have entered (\ d +) as second number $ /', function ($ world, $ num) {
     $ world-&gt; calc-&gt; setSecond ($ num);
 });
 $ steps-&gt; When ('/ ^ I press \' Add \ '$ /', function ($ world) {
     $ world-&gt; calc-&gt; add ();
 });
 $ steps-&gt; Then ('/ ^ The result should be (\ d +) $ /', function ($ world, $ res) {
     assertEquals ($ res, $ world-&gt; calc-&gt; getResult ());
 });
 ?&gt;
</pre><br>  We start the test again - voila!  Test passed :) <br><br><pre> Feature: Addition
   In order to avoid silly mistakes
   As a math idiot
   I want to be told<font></font>
<font></font>
   Scenario: # features / calc.feature: 6
     Given I have an calculator # features / steps / calc_steps.php: 5
     When I have entered 30 as the first number # features / steps / calc_steps.php: 9
     And I have entered 20 as second number # features / steps / calc_steps.php: 13
     And I press 'Add' # features / steps / calc_steps.php: 17
     Then features should be 50 # features / steps / calc_steps.php: 21<font></font>
<font></font>
 1 scenario (1 passed)
 5 steps (5 passed)
 0.114s
</pre><br><h4>  Trying to test the page </h4><br>  Testing class performance is certainly an important part of the project.  But the customer, as usual, does not want the working classes from us, but a properly functioning (in his opinion) application.  Simply put - it needs the correct operation of the interface.  Checking what we now do.  In Ruby on Rails, cucumer + webrat + nokogiri is traditionally used to test pages.  In the world of PHP, everything turned out to be somewhat more complicated ... <a href="https://habrahabr.ru/users/everzet/" class="user_link">Everzet</a> himself suggests using the <a href="https://github.com/fabpot/Goutte">Goutte</a> library, based on Symfony 2, for this business. This library is much inferior in its capabilities to the above link, but you couldn‚Äôt find anything better on the Internet (if someone knows Please, unsubscribe, please).  Goutte is installed very simply - download the phar-archive and connect it to env.php. <br><br>  As an example for testing, I sketched a simple page: <br><pre> &lt;! DOCTYPE html&gt;
 &lt;html&gt;
     &lt;head&gt;
     &lt;/ head&gt;
     &lt;body&gt;
         &lt;div&gt; &lt;?
             if ($ _GET ["submit"]) {
                 echo "Text =".  $ _GET ['textfield'].  "&lt;br /&gt;";
                 echo "Checkbox =".  $ _GET ['checkbox'].  "&lt;br /&gt;";
                 echo "Radio =".  $ _GET ['radio'].  "&lt;br /&gt;";
                 echo "Select =".  $ _GET ['selectbox'].  "&lt;br /&gt;";
             }
         ?&gt; &lt;/ div&gt;
         &lt;form method = "get" action = "behat.php"&gt;
             &lt;div&gt;
                 &lt;input type = "text" name = "textfield" value = ""&gt;
             &lt;/ div&gt;
             &lt;div&gt;
                 &lt;input type = "checkbox" name = "checkbox" value = "checkbox"&gt;
             &lt;/ div&gt;
             &lt;div&gt;
                 &lt;input type = "radio" name = "radio" value = "radio1" checked = "checked"&gt;
                 &lt;input type = "radio" name = "radio" value = "radio2"&gt;
                 &lt;input type = "radio" name = "radio" value = "radio3"&gt;
             &lt;/ div&gt;
             &lt;div&gt;
                 &lt;select name = "selectbox"&gt;
                     &lt;option value = "option1" selected = "selected"&gt; option1 &lt;/ option&gt;
                     &lt;option value = "option2"&gt; option2 &lt;/ option&gt;
                     &lt;option value = "option3"&gt; option3 &lt;/ option&gt;
                 &lt;/ select&gt;
             &lt;/ div&gt;
             &lt;div&gt;
                 &lt;input type = "submit" name = "submit" value = "Submit"&gt;
             &lt;/ div&gt;
             &lt;div id = "linkdiv"&gt;
                 &lt;a href="behat.php?textfield=text&amp;checkbox=checkbox&amp;radio=radio3&amp;selectbox=option2&amp;submit=Submit"&gt; Click me &lt;/a&gt;
             &lt;/ div&gt;
         &lt;/ form&gt;
     &lt;/ body&gt;
 &lt;/ html&gt;
</pre><br>  Task: check the form on it.  Yes, the task is very synthetic, but this is just an example :) So, we can list the tests: <br><pre> Feature: tests
     After submit form all values ‚Äã‚Äãof fields
     Should be showed in top of page<font></font>
<font></font>
     Scenario: Fill field
         Given I'm on test page
          When I fill in 'textfield' with 'some text' in form 'Submit'
           And I submit form 'Submit'
          Then I should see 'Text = some text'<font></font>
<font></font>
     Scenario: Checking checkbox
         Given I'm on test page
          When I tick checkbox 'checkbox' in form 'Submit'
           And I submit form 'Submit'
          Then I should see 'Checkbox = checkbox'<font></font>
<font></font>
     Scenario: Selecting radio
         Given I'm on test page
          When I select 'radio2' in radio 'radio' in form 'Submit'
           And I submit form 'Submit'
          Then I should see 'Radio = radio2'
          Then I should not see 'Radio = radio1'<font></font>
<font></font>
     Scenario: Selecting option in selectbox
         Given I'm on test page
          When I select 'option3' in selectbox 'selectbox' in form 'Submit'
           And I submit form 'Submit'
          Then I should see 'Select = option3'
          Then I should not see 'Select = option1'<font></font>
<font></font>
     Scenario: Fill some fields
         Given I'm on test page
          When I fill in the following form:
             |  textfield |  some text |
             |  checkbox |  true |
             |  radio |  radio3 |
             |  selectbox |  option2 |
           And I submit form 'Submit'
          Then I should see 'Text = some text'
           And I should see 'Checkbox = checkbox'
           And I should see 'Radio = radio3'
           And I should see 'Select = option2' within 'div'<font></font>
<font></font>
     Scenario: Clicking on link
         Given I'm on test page
          When I click on link 'Click me' within '#linkdiv'
          Then I should see 'Text = text'
           And I should see 'Checkbox = checkbox'
           And I should see 'Radio = radio3'
           And I should see 'Select = option2' within 'div'
           And the 'textfield' field in the 'Submit' should be blank
</pre><br><br>  <i>A small explanation of why the form in the tests is named ‚ÄúSubmit‚Äù.</i>  <i>In Goutte, the form is selected using the submit button on it.</i>  <i>The button itself is searched by id or value.</i>  <i>And the button on the test page bears the proud name of Submit, hence the wording.</i> <br><br>  There are many steps, different steps, and everyone is involved in working with Goutte.  Fortunately, all these steps have already been described by me and collected into a file.  You can <a href="">pull off the search</a> from the git-repository <a href="">git: //github.com/DarthSim/behat_websteps.git</a> .  In the repository you will find: <br><ul><li>  <b>Features / support / env.php file</b> with <b>environment</b> already configured for testing pages; </li><li>  The file <b>features / support / paths.php</b> to describe the paths (details below); </li><li>  The <b>features / support / includes.php</b> file for connecting your classes; </li><li>  The <b>features / support / goutte.phar file</b> is Goutte itself; </li><li>  The <b>features / steps / custom.php file</b> with steps to test the pages. </li></ul><br>  Copy the files to the folder with your project, preserving the hierarchy, and run the test.  And we get the error ... <br><br> <code>Unknown path 'test page'. You can define it in [features_folder]/support/paths.php</code> <br> <br>  The error speaks for itself - the test does not know what we want to check for the ‚Äútest page‚Äù.  The easiest way to <b>fix this</b> is to set the path for the ‚Äútest page‚Äù page in the <b>features / support / paths.php file</b> .  Suppose that we have a test page located at <a href="http://tests.dev/behat.php">tests.dev/behat.php</a> , then we need to register in the path file <br><br> <code>$world-&gt;paths['test page'] = "http://tests.dev/behat.php";</code> <br> <br>  We start the test - great, the test is passed!  I leave the analysis of the remaining steps to the reader, since they are similar to those from the webrat.  Of course, the resulting functionality is much poorer than that of the webrat, but I think this is only the beginning, it will be better further. <br><br><h4>  Draw conclusions and provide links </h4><br>  So, it's safe to say that Behat is a worthy successor to Cucumber in the PHP world.  The library has not yet grown to version 1.0, but it is already a high-quality, complete product.  We wish the developer success in the development of his offspring and send him the rays of good.  Below are some useful links: <br><br>  <a href="http://github.com/everzet/Behat">Behat repository on github</a> <br>  <a href="https://github.com/everzet/Behat/wiki">Behat WIKI</a> <br>  <a href="http://everzet.com/Behat/api">Behat API</a> <br>  <a href="https://github.com/fabpot/Goutte">Goutte repository</a> <br>  <a href="http://api.symfony-reloaded.org/PR4/">Symfony 2 API</a> (will help with Goutte) </div><p>Source: <a href="https://habr.com/ru/post/110422/">https://habr.com/ru/post/110422/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../110416/index.html">Reminday.com will remember birthdays for you</a></li>
<li><a href="../110417/index.html">How will the opposition of HP and Oracle to Open Source?</a></li>
<li><a href="../110418/index.html">Headphones Arctic Sound P311 - ears on top</a></li>
<li><a href="../110419/index.html">Concepts of the practical use of genetic algorithms</a></li>
<li><a href="../110421/index.html">Encoding live video during download</a></li>
<li><a href="../110423/index.html">New features and New Year's Eve promotion at Ping-Admin.Ru</a></li>
<li><a href="../110426/index.html">Creating Doctrine YAML via MySQL Workbench</a></li>
<li><a href="../110427/index.html">Want to try VDI, but afraid? Then we go to you!</a></li>
<li><a href="../110428/index.html">SimplePlayer - Free Online Player for iPhone</a></li>
<li><a href="../110429/index.html">110-megawatt "solar" power station to appear in California</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>