<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Metronome IM and Jappix: a multi-functional Jabber, without difficulty in setting up</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What if I tell you how to effortlessly raise my own jabber server with all the newfangled features, such as: archiving, synchronization of messages be...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Metronome IM and Jappix: a multi-functional Jabber, without difficulty in setting up</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/d27/fd5/390/d27fd53901887adb98471de642665d58.png"><br>  What if I tell you how to effortlessly raise my own jabber server with all the newfangled features, such as: archiving, synchronization of messages between clients, read notifications, public chats and much more ... <br>  I will also share with you a wonderful Jabber-client that is no less interesting, it supports audio and video calls, has a good interface and works directly from the browser. <br>  You will get both for free, as both the server and the client are licensed under a free license. <br><br>  It's about <b>Metronome IM</b> and <b>Jappix</b> . <a name="habracut"></a><br><br>  <i>It is worth taking into account that both projects can work independently of each other, to Metronome IM, you can still connect with any Jabber client, and Jappix can be used for any other Jabber server that supports BOSH.</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/5c2/cb6/09b/5c2cb609bc8cf8e84d1e487785095a9c.png" alt="image" align="left"><br><a name="metronome"></a><h1>  Metronome IM </h1><br>  <b>Author:</b> Marco Cirillo <br>  <b>Site:</b> <a href="https://lightwitch.org/metronome">lightwitch.org/metronome</a> <br>  <b>License:</b> MIT <br>  <b>Written in:</b> Lua <br><br><br>  And so, let's start with the server part. <br><br>  <b>Metronome IM</b> is a Jabber server, fork of the well-known <a href="https://prosody.im/">Prosody IM</a> , which was already <a href="https://habrahabr.ru/search/%3Fq%3D%5Bprosody%5D%26target_type%3Dposts">written</a> on Habr√© more than once.  Unlike Prosody, Metronome was created primarily to support various social features, such as <a href="http://www.xmpp.org/extensions/xep-0060.html">pubsub</a> , <a href="http://xmpp.org/extensions/xep-0108.html">user activity</a> , <a href="http://xmpp.org/extensions/xep-0107.html">mood</a> , and others, but we are not the ones who are interested in them. <br>  A complete list of all XEPs that work out of the box can be found on <a href="https://lightwitch.org/metronome/supported-xeps-list">this page</a> .  Agree, the list is quite impressive! <br><br>  Among all XEP there are: the Message archive (message archiving), and Carbons (synchronization of messages between clients), and Offline Messages (offline messages) ... For those who do not know, in many other jabber servers, by default, all this works quite mediocre and requires modification file. <br>  In Metronome IM, all XEP work correctly right out of the box and on most Jabber clients. <br>  From practice, I can say that you most likely will no longer have such unpleasant glitches when your message is lost somewhere, duplicated, or displayed in one client, and the other one does not even see it. <br><br>  Plus, the server is written in lua, it has many modules and a fairly simple to understand configuration. <br>  Also, most of the modules from Prosody IM will do with it after a short dope, but I am sure that you, in most cases, will not even need it. <br><br><h2>  Installation </h2><br>  By default, Metronome IM is not supplied as ready-made packages, so we will build it from <a href="https://github.com/maranda/metronome/releases">source</a> , you can also install it using <a href="https://hub.docker.com/search/%3FisAutomated%3D1%26q%3Dmetronome">Docker</a> <br><br>  First, let's install the dependencies: <br><br>  Ubuntu / Debian: <br><pre><code class="bash hljs">apt-get update apt-get -y install libssl-dev libidn11-dev build-essentials lua5.1 liblua5.1-dev liblua5.1-bitop-dev liblua5.1-expat-dev liblua5.1-event-dev lua5.1-posix-dev lua5.1-sec-dev lua5.1-socket-dev lua5.1-filesystem-dev</code> </pre> <br><br>  CentOS: <br><pre> <code class="bash hljs">yum -y install epel-release yum -y install gcc lua-devel openssl-devel libidn-devel lua-expat lua-socket lua-filesystem lua-sec lua-dbi lua-event <span class="hljs-comment"><span class="hljs-comment"># Install lua-zlib module curl https://codeload.github.com/brimworks/lua-zlib/tar.gz/v0.4 | tar xzv -C /usr/src/ cd /usr/src/lua-zlib-0.4/ make linux make install # Install lua-bitop module curl http://bitop.luajit.org/download/LuaBitOp-1.0.2.tar.gz | tar xzv -C /usr/src/ cd /usr/src/LuaBitOp-1.0.2 make make install</span></span></code> </pre><br><br>  Download the source code, collect and install them: <br><pre> <code class="bash hljs">useradd -r -s /sbin/nologin -d /var/lib/metronome metronome curl -L https://github.com/maranda/metronome/archive/v3.7.tar.gz | tar xz -C /usr/src/ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /usr/src/metronome* ./configure --prefix=/usr --sysconfdir=/etc/prosody --datadir=/var/lib/prosody --require-config --ostype=debian <span class="hljs-comment"><span class="hljs-comment"># --ostype=linux make &amp;&amp; make install mkdir /var/log/metronome /var/run/metronome chown metronome: /var/lib/metronome /var/log/metronome /var/run/metronome</span></span></code> </pre><br><br>  Create a unit for systemd: /etc/systemd/system/metronome.service <br><pre> <code class="hljs pgsql">[Unit] Description=XMPP (Jabber) <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">After</span></span>=network.target [Service] <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>=forking PIDFile=/run/metronome/metronome.pid ExecStart=/usr/bin/metronomectl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> ExecStop=/usr/bin/metronomectl stop [Install] WantedBy=multi-<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.target</code> </pre><br>  Installation completed <br><br><h2>  Customization </h2><br>  Download the metronome.cfg.lua config courtesy of the jappix.com service. <br><br>  After minor edits, I got about this config: <br><div class="spoiler">  <b class="spoiler_title">metronome.cfg.lua</b> <div class="spoiler_text"><pre> <code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">-- Prosody XMPP Server Configuration -- -- Information on configuring Prosody can be found on our -- website at http://metronome.im/doc/configure -- -- Tip: You can check that the syntax of this file is correct -- when you have finished by running: metronomectl check config -- If there are any errors, it will let you know what and where -- they are, otherwise it will keep quiet. -- -- Good luck, and happy Jabbering! ---------- Server-wide settings ---------- -- Settings in this section apply to the whole server and are the default settings -- for any virtual hosts -- This is a (by default, empty) list of accounts that are admins -- for the server. Note that you must create the accounts separately -- (see http://metronome.im/doc/creating_accounts for info) -- Example: admins = { "user1@example.com", "user2@example.net" } admins = { } -- Required for init scripts and metronomectl pidfile = "/var/run/metronome/metronome.pid" -- ulimit metronome_max_files_soft = 200000 metronome_max_files_hard = 200000 -- HTTP server http_ports = { 5280 } http_interfaces = { "0.0.0.0", "::" } https_ports = { 5281 } https_interfaces = { "0.0.0.0", "::" } -- Enable IPv6 use_ipv6 = true -- This is the list of modules Prosody will load on startup. -- It looks for mod_modulename.lua in the plugins folder, so make sure that exists too. -- Documentation on modules can be found at: http://metronome.im/doc/modules modules_enabled = { -- Generally required --"roster"; -- Allow users to have a roster. Recommended ;) "saslauth"; -- Authentication for clients and servers. Recommended if you want to log in. "tls"; -- Add support for secure TLS on c2s/s2s connections "dialback"; -- s2s dialback support "disco"; -- Service discovery "extdisco"; -- External Service Discovery -- Not essential, but recommended --"private"; -- Private XML storage (for room bookmarks, etc.) --"vcard"; -- Allow users to set vCards -- These are commented by default as they have a performance impact "compression"; -- Stream compression (requires the lua-zlib package installed) -- Nice to have "version"; -- Replies to server version requests "uptime"; -- Report how long server has been running "time"; -- Let others know the time here on this server "ping"; -- Replies to XMPP pings with pongs --"pep"; -- Enables users to publish their mood, activity, playing music and more --"register"; -- Allow users to register on this server using a client and change passwords -- Admin interfaces "admin_adhoc"; -- Allows administration via an XMPP client that supports ad-hoc commands --"admin_telnet"; -- Opens telnet console interface on localhost port 5582 -- HTTP modules "bosh"; -- Enable BOSH clients, aka "Jabber over HTTP" "websocket"; -- Enable WebSocket clients --"http_files"; -- Serve static files from a directory over HTTP -- Other specific functionality "posix"; -- POSIX functionality, sends server to background, enables syslog, etc. "bidi"; -- Bidirectional Streams for S2S connections "stream_management"; -- Stream Management support --"groups"; -- Shared roster support --"announce"; -- Send announcement to all online users --"welcome"; -- Welcome users who register accounts --"watchregistrations"; -- Alert admins of registrations --"motd"; -- Send a message to users when they log in "legacyauth"; -- Legacy authentication. Only used by some old clients and bots. "log_auth"; } -- These modules are auto-loaded, but should you want -- to disable them then uncomment them here: modules_disabled = { -- "offline"; -- Store offline messages -- "c2s"; -- Handle client connections -- "s2s"; -- Handle server-to-server connections } -- Discovery items disco_items = { { "muc.example.org" }, { "proxy.example.org" }, { "pubsub.example.org" }, { "vjud.example.org" } }; -- External Service Discovery (mod_extdisco) external_services = { ["stun.example.org"] = { [1] = { port = "3478", transport = "udp", type = "stun" }, [2] = { port = "3478", transport = "tcp", type = "stun" } } }; -- Bidirectional Streams configuration (mod_bidi) bidi_exclusion_list = { "jabber.org" } -- BOSH configuration (mod_bosh) bosh_max_inactivity = 30 consider_bosh_secure = true cross_domain_bosh = true -- WebSocket configuration (mod_websockets) consider_websockets_secure = true cross_domain_websockets = true -- Disable account creation by default, for security allow_registration = false -- Ignore priority settings ignore_presence_priority = true -- These are the SSL/TLS-related settings. If you don't want -- to use SSL/TLS, you may comment or remove this ssl = { key = "/etc/metronome/certs/localhost.key"; certificate = "/etc/metronome/certs/localhost.cert"; options = { "no_sslv2", "no_sslv3", "no_ticket", "no_compression", "cipher_server_preference" }; } -- Force clients to use encrypted connections? This option will -- prevent clients from authenticating unless they are using encryption. c2s_require_encryption = true -- Force servers to use encrypted connections? This option will -- prevent servers from connecting unless they are using encryption. s2s_require_encryption = true -- Allow servers to use an unauthenticated encryption channel s2s_allow_encryption = true -- Don't require encryption for listed servers s2s_encryption_exceptions = { "cisco.com", "gmail.com" } -- Logging configuration -- For advanced logging see http://metronome.im/doc/logging log = { info = "/var/log/metronome/metronome.log"; -- Change 'info' to 'debug' for verbose logging error = "/var/log/metronome/metronome.err"; -- "*syslog"; -- Uncomment this for logging to syslog -- "*console"; -- Log to the console, useful for debugging with daemonize=false } activity_log_dir = "/var/log/metronome/activity_log" -- For the "sql" backend, you can uncomment *one* of the below to configure: sql = { driver = "SQLite3", database = "metronome.sqlite" } -- Default. 'database' is the filename. --sql = { driver = "MySQL", database = "metronome", username = "metronome", password = "password", host = "localhost" } --sql = { driver = "PostgreSQL", database = "metronome", username = "metronome", password = "secret", host = "localhost" } ----------- Virtual hosts ----------- -- You need to add a VirtualHost entry for each domain you wish Prosody to serve. -- Settings under each VirtualHost entry apply *only* to that host. VirtualHost "example.org" enabled = true default_storage = "sql" modules_enabled = { -- Generally required "roster"; -- Allow users to have a roster. Recommended ;) -- Not essential, but recommended "private"; -- Private XML storage (for room bookmarks, etc.) "vcard"; -- Allow users to set vCards -- These are commented by default as they have a performance impact "mam"; -- Message Archive Management "privacy"; -- Support privacy lists -- Nice to have "lastactivity"; -- Logs the user last activity timestamp "pep"; -- Enables users to publish their mood, activity, playing music and more "message_carbons"; -- Allow clients to keep in sync with messages send on other resources --"register"; -- Allow users to register on this server using a client and change passwords --"register_redirect"; -- Redirects users registering to the registration form "public_service"; -- Provides some information about the XMPP server --"log_activity"; -- Activity log, module from https://github.com/jappix/jappix-xmppd-modules "groups"; -- Shared groups -- Admin interfaces --"admin_adhoc"; -- Allows administration via an XMPP client that supports ad-hoc commands } groups_file = "/etc/metronome/groups.txt" resources_limit = 10 no_registration_whitelist = true registration_url = "https://example.org/" registration_text = "Please register your account on Jappix itself (open example.org in your Web browser). Then you'll be able to use it anywhere you want." public_service_vcard = { name = "Jappix XMPP service", url = "https://example.org/", foundation_year = "2010", country = "RU", email = "admin@example.org", admin_jid = "admin@example.org", geo = "48.87,2.33", ca = { name = "StartSSL", url = "https://www.startssl.com/" }, oob_registration_uri = "https://example.org/" } VirtualHost "anonymous.example.org" enabled = true authentication = "anonymous" allow_anonymous_multiresourcing = true allow_anonymous_s2s = true anonymous_jid_gentoken = "Jappix Anonymous User" anonymous_randomize_for_trusted_addresses = { "127.0.0.1", "::1" } ------ Components ------ -- You can specify components to add hosts that provide special services, -- like multi-user conferences, and transports. ---Set up a MUC (multi-user chat) room server on muc.example.org: Component "muc.example.org" "muc" name = "Jappix Chatrooms" modules_enabled = { "muc_limits"; "muc_log"; "muc_log_http"; "pastebin"; } muc_event_rate = 0.5 muc_burst_factor = 10 muc_log_http_config = { url_base = "logs"; theme = "metronome"; } pastebin_url = "https://muc.example.org/paste/" pastebin_path = "/paste/" pastebin_expire_after = 0 pastebin_trigger = "!paste" ---Set up a PubSub server Component "pubsub.example.org" "pubsub" name = "Jappix Publish/Subscribe" --unrestricted_node_creation = true -- Anyone can create a PubSub node (from any server) ---Set up a VJUD service Component "vjud.example.org" "vjud" ud_disco_name = "Jappix User Directory" synchronize_to_host_vcards = "example.org" ---Set up a BOSH service ( https://bind.example.org:5281/http-bind ) Component "bind.example.org" "http" modules_enabled = { "bosh" } ---Set up a WebSocket service Component "websocket.example.org" "http" modules_enabled = { "websocket" } ---Set up a BOSH + WebSocket service Component "me.example.org" "http" modules_enabled = { "bosh", "websocket" } ---Set up a statistics service Component "stats.example.org" "http" modules_enabled = { "server_status" } server_status_basepath = "/xmppd/" server_status_show_hosts = { "example.org", "anonymous.example.org" } server_status_show_comps = { "muc.example.org", "proxy.example.org", "pubsub.example.org", "vjud.example.org" } -- Set up a SOCKS5 bytestream proxy for server-proxied file transfers: Component "proxy.example.org" "proxy65" proxy65_acl = { "example.org", "anonymous.example.org" }</span></span></code> </pre></div></div><br>  The config is very well-commented and I do not see much point in leaving additional comments on my part. <br>  Let me just say that if you plan to install <a href="https://habr.com/ru/post/270207/">jappix</a> or any other web client, then you will need the BOSH component.  It is through him that your web client will communicate with your server. <br><br>  You can learn more about configuring the server and see examples <a href="https://lightwitch.org/metronome/documentation/configuration">on the official</a> project <a href="https://lightwitch.org/metronome/documentation/configuration">website</a> . <br><br>  Do not forget to register the necessary DNS records on our DNS server: <br><pre> <code class="hljs vbscript">xmpp <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> A <span class="hljs-number"><span class="hljs-number">1.2</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span> muc <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> CNAME xmpp pubsub <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> CNAME xmpp vjud <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> CNAME xmpp bind <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> CNAME xmpp websocket <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> CNAME xmpp <span class="hljs-keyword"><span class="hljs-keyword">me</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> CNAME xmpp stats <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> CNAME xmpp proxy <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> CNAME xmpp anonymous <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> CNAME xmpp _xmpp-client._tcp.example.org. <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> SRV <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5222</span></span> xmpp.example.org. _xmpp-<span class="hljs-built_in"><span class="hljs-built_in">server</span></span>._tcp.example.org. <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> SRV <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5269</span></span> xmpp.example.org.</code> </pre><br><br>  We start the service: <br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> metronome systemctl start metronome</code> </pre><br>  Check the logs. <br>  If everything is ok, create a user: <br><pre> <code class="bash hljs">prosodyctl adduser me@example.com</code> </pre><br>  And try to connect. <br>  Our server is ready! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3f7/214/9d9/3f72149d9d5d80b23d1d222d7db40604.jpg" alt="image" align="left"><br><a name="jappix"></a><h1>  Jappix </h1><br>  <b>Author:</b> Val√©rian Saliou, Julien Barrier <br>  <b>Site:</b> <a href="https://jappix.org/">jappix.org</a> <br>  <b>License:</b> AGPL <br>  <b>Written in:</b> JavaScript <br>  <b>Demo:</b> <a href="https://jappix.com/">jappix.com</a> <br><br><br>  As I said, Jappix is ‚Äã‚Äãa Jabber-client that has a very good interface, supports audio and video calls, also supports most popular XEP and works directly from the browser window. <br><br>  The client looks like this: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/ff9/30f/4aa/ff930f4aa370fca79b182f433dfaa029.png" alt="image"></div></div><br>  It also has a smaller version, for embedding on the website: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/393/690/2a9/3936902a9fdf1681eff0f3aa29fe558d.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/66e/b16/c36/66eb16c3616ee0efaa93ef004536329a.png" alt="image"></div></div><br><br><h1>  Installation </h1><br>  It's time to install our client. <br><br>  The installation is not something that is not trivial.  All actions boil down to copying the project files to your web server directory.  But all of you can also install Jappix using <a href="https://hub.docker.com/search/%3FisAutomated%3D1%26q%3Djappix">Docker</a> . <br><br>  And so we will start, we will establish dependences: <br><br>  Debian / Ubuntu: <br><pre> <code class="bash hljs">apt-get install php5-gd php5-curl</code> </pre><br>  CentOS: <br><pre> <code class="bash hljs">yum install php-mbstring</code> </pre><br><br>  Now download <a href="">jappix-1.1.6-primo.tar.bz2</a> and unpack it in / var / www <br><pre> <code class="bash hljs">curl -L https://download.jappix.org/1.1.6/jappix-1.1.6-primo.tar.bz2 | tar xvj -C /var/www</code> </pre><br><br>  Let's write a config for our web server, for example for nginx it will look something like this: <br><div class="spoiler">  <b class="spoiler_title">jappix.conf</b> <div class="spoiler_text"><pre> <code class="nginx hljs"><span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> jappix.example.org; <span class="hljs-attribute"><span class="hljs-attribute">return</span></span> <span class="hljs-number"><span class="hljs-number">301</span></span> https://jappix.example.org<span class="hljs-variable"><span class="hljs-variable">$request_uri</span></span>; } <span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">443</span></span> ssl; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> jappix.example.org; <span class="hljs-attribute"><span class="hljs-attribute">root</span></span> /var/www/jappix; <span class="hljs-attribute"><span class="hljs-attribute">index</span></span> index.html index.php; <span class="hljs-attribute"><span class="hljs-attribute">access_log</span></span> /var/log/nginx/jappix-access.log; <span class="hljs-attribute"><span class="hljs-attribute">error_log</span></span> /var/log/nginx/jappix-<span class="hljs-literal"><span class="hljs-literal">error</span></span>.log; <span class="hljs-comment"><span class="hljs-comment"># Configuration SSL # Support du HSTS (HTTP Strict Transport Security) add_header Strict-Transport-Security "max-age=315360000; includeSubdomains"; # Configuration SSL ssl_certificate /etc/nginx/certificates/common-ssl.cert; ssl_certificate_key /etc/nginx/certificates/common-ssl.key; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_prefer_server_ciphers on; ssl_ciphers "EECDH+ECDSA+AESGCM EECDH+aRSA+AESGCM EECDH+ECDSA+SHA384 EECDH+ECDSA+SHA256 EECDH+aRSA+SHA384 EECDH+aRSA+SHA256 EECDH EDH+aRSA !RC4 !aNULL !eNULL !LOW !3DES !MD5 !EXP !PSK !SRP !DSS"; location / { try_files $uri $uri/ /index.php?$args; } location ~ \.php$ { try_files $uri =404; fastcgi_index index.php; fastcgi_pass php5-fpm-sock; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include /etc/nginx/fastcgi_params; fastcgi_param PHP_VALUE "upload_max_filesize = 25M \n post_max_size = 25M \n max_execution_time = 600"; } location ~ /(app|i18n|log|test|tmp|tools)/ { deny all; } }</span></span></code> + aRSA + AESGCM EECDH + ECDSA + SHA384 EECDH + ECDSA + SHA256 EECDH + aRSA + SHA384 EECDH + aRSA + SHA256 EECDH EDH + aRSA! RC4! aNULL! eNULL! LOW! 3DES! MD5! EXP <code class="nginx hljs"><span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> jappix.example.org; <span class="hljs-attribute"><span class="hljs-attribute">return</span></span> <span class="hljs-number"><span class="hljs-number">301</span></span> https://jappix.example.org<span class="hljs-variable"><span class="hljs-variable">$request_uri</span></span>; } <span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">443</span></span> ssl; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> jappix.example.org; <span class="hljs-attribute"><span class="hljs-attribute">root</span></span> /var/www/jappix; <span class="hljs-attribute"><span class="hljs-attribute">index</span></span> index.html index.php; <span class="hljs-attribute"><span class="hljs-attribute">access_log</span></span> /var/log/nginx/jappix-access.log; <span class="hljs-attribute"><span class="hljs-attribute">error_log</span></span> /var/log/nginx/jappix-<span class="hljs-literal"><span class="hljs-literal">error</span></span>.log; <span class="hljs-comment"><span class="hljs-comment"># Configuration SSL # Support du HSTS (HTTP Strict Transport Security) add_header Strict-Transport-Security "max-age=315360000; includeSubdomains"; # Configuration SSL ssl_certificate /etc/nginx/certificates/common-ssl.cert; ssl_certificate_key /etc/nginx/certificates/common-ssl.key; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_prefer_server_ciphers on; ssl_ciphers "EECDH+ECDSA+AESGCM EECDH+aRSA+AESGCM EECDH+ECDSA+SHA384 EECDH+ECDSA+SHA256 EECDH+aRSA+SHA384 EECDH+aRSA+SHA256 EECDH EDH+aRSA !RC4 !aNULL !eNULL !LOW !3DES !MD5 !EXP !PSK !SRP !DSS"; location / { try_files $uri $uri/ /index.php?$args; } location ~ \.php$ { try_files $uri =404; fastcgi_index index.php; fastcgi_pass php5-fpm-sock; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include /etc/nginx/fastcgi_params; fastcgi_param PHP_VALUE "upload_max_filesize = 25M \n post_max_size = 25M \n max_execution_time = 600"; } location ~ /(app|i18n|log|test|tmp|tools)/ { deny all; } }</span></span></code> </pre></div></div><br>  Restart the web server. <br><br>  More information about the installation can be found in the official project <a href="https://github.com/jappix/jappix/wiki">wiki</a> . <br><br><h2>  Customization </h2><br>  Jappix has a graphical installer.  Go to the link: <br><pre> <code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">https:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/jappix.example.org/</span></span><span class="hljs-string"><span class="hljs-string">?m</span></span>=install</code> </pre><br>  We create an administrator, answer other questions, enter addresses to our server. <br><br>  This is what the server settings bug looks like: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/files/42f/981/fd2/42f981fd22d141afbad1e59daecd25b1.png" alt="image"></a> </div></div><br>  When the installation is complete, you will be transferred to the login window. <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/files/2ac/27f/31a/2ac27f31a7f54c7386329391d995035a.png" alt="image"></a> </div></div><br>  In the future, you can get into the admin area at the following link: <br><pre> <code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">https:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/jappix.example.org/</span></span><span class="hljs-string"><span class="hljs-string">?m</span></span>=manager</code> </pre><br><br><h1>  Let's Encrypt </h1><br>  A couple of words about certificates. <br><br>  Leaving a server with self-signed certificates is not good, you need to install at least free. <br>  We have done quite a lot of subdomains, so one free certificate is not enough for everyone, and it will be quite expensive to get a separate one for each.  There is a way out - this is Let's Encrypt. <br><br>  On <a href="https://habrahabr.ru/users/malcolmreynolds/" class="user_link">Habr√© MalcolmReynolds</a> already described the <a href="https://habrahabr.ru/post/270273/">procedure for</a> obtaining certificates from Let's Encrypt. <br>  There are also a couple of cool articles on DigitalOcean - <a href="https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-14-04">nginx</a> , <a href="https://www.digitalocean.com/community/tutorials/how-to-secure-apache-with-let-s-encrypt-on-ubuntu-14-04">apache</a> <br><br>  But, if you use Docker, then I suggest you try my image: <a href="https://hub.docker.com/r/kvaps/letsencrypt-webroot/">kvaps / letsencrypt-webroot</a> <br><br>  Thank you for attention! </div><p>Source: <a href="https://habr.com/ru/post/270207/">https://habr.com/ru/post/270207/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270197/index.html">SAP - ABAP. Modifying a summary line in the ALV grid</a></li>
<li><a href="../270199/index.html">Translation agreement with Apple Developer Program License Agreement</a></li>
<li><a href="../270201/index.html">Solving the problem of credit scoring in the studio Microsoft Azure Machine Learning</a></li>
<li><a href="../270203/index.html">Snom C520 and C52 - space design and wide opportunities</a></li>
<li><a href="../270205/index.html">What is written with a pen, or how to check documents in MS Office formats</a></li>
<li><a href="../270209/index.html">Ansible 2.0 b2. Overview of innovations</a></li>
<li><a href="../270211/index.html">Monstrous frankenstek</a></li>
<li><a href="../270213/index.html">Office as Platform: how was a Notegram project for OneNote created?</a></li>
<li><a href="../270215/index.html">Event-oriented Python backtesting step by step. Part 5 (and last)</a></li>
<li><a href="../270217/index.html">Google Play Services Research: Place Picker & Autocomplete</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>