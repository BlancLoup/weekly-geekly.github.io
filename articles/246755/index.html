<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Changing user roles 1C 8 (file version)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suppose that we need to restore access to the file database of 1C Enterprise. As a rule, in such cases, some manipulations with passwords are performe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Changing user roles 1C 8 (file version)</h1><div class="post__text post__text-html js-mediator-article">  Suppose that we need to restore access to the file database of 1C Enterprise.  As a rule, in such cases, some manipulations with passwords are performed (either brute force or reset).  Mene wanted to complicate the task a bit and go the other way - to assign administrator rights to the regular user. <br><a name="habracut"></a><br>  First, I advise you to read about the file format 1C.  You can do it <a href="http://infostart.ru/public/19734/">here</a> . <br><br>  So, we need a hex editor.  I used HIEW.  Run the editor and open the file 1Cv8.1CD.  Go to offset 0x4000 - this is the root object of the configuration.  The first 32 bytes are the base language code.  Then the number of blocks (4 bytes), and the actual block addresses themselves.  Begin to look for the table V8USERS.  I had it in block 7, that is, with an offset of 0x8E000 (00 00 00 8E 000, read from right to left, add 000 at the end). <br><br><img src="https://habrastorage.org/files/aae/f4e/46a/aaef4e46a3a54f7685d49762d6b8a61e.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Go to this address and see <br><br><img src="https://habrastorage.org/files/6e7/80a/86a/6e780a86a82345669c8fc7db0f09c0d4.png"><br><br>  Going on 0x91000 see <br><br><img src="https://habrastorage.org/files/5a7/fef/ca1/5a7fefca10654743b94f7521a7373103.png"><br><br>  And already at 0x92000 is the description of the table.  It is possible to calculate the length of the fields as described in the article I quoted above, I would just say that the record length is 697 (0x2B9) bytes, and the offset field DATA is 678 (0x2A6) bytes. <div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  (this was the case on all configurations that I considered, most likely so in general in each configuration, since V8USERS is a service table) </div></div><br>  At the end of the description of the table we see three numbers.  The first is the address of the data, the second is the address of the Blob data, the third is the indexes. <br><br><img src="https://habrastorage.org/files/ea8/fe2/8b4/ea8fe28b404a41b5af53910d04b89bc2.png"><br><br>  143 = 0x8F (data address 0x8F000), 144 = 0x90 (Blob data address 0x90000). <br><br>  Go to the data.  There we will be sent to 0x193000, then to 0x194000 (by the way, there may be more than one unit like mine, but several. It depends on the number of users). <br><br><img src="https://habrastorage.org/files/e5b/da4/282/e5bda4282d094f09b295ee6d74eab0f5.png"><br><br><img src="https://habrastorage.org/files/649/220/34d/64922034d98c4d01b9aa84550252d3e6.png"><br><br>  In here we are in the data table V8USERS.  The first block is 697 bytes long, empty, then I had an empty user, then the Admin user. <div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  (in HIEW to go to the next user F5, then + 2B9) </div></div><br><br><img src="https://habrastorage.org/files/33b/ae0/e5c/33bae0e5c36a46c6b92589fc043ae53e.png"><br><br>  Move another 0x2A6 bytes.  This is the block number in the blob data. <br><br><img src="https://habrastorage.org/files/437/ef9/70d/437ef970df394cf68d073c6ba191cc01.png"><br><br>  Next, go to Blob-data (0x90000).  From there we go to 0x195000, then to 0x196000. <br><br>  The zero block of the blob data is empty (the block size is 256 (0xFF) bytes, the first 4 bytes are the address of the next block, if the data did not fit in one block, then 2 bytes is the block size, the rest is the data itself).  We need a second block. <div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  (0x196000 + 0x100 + 0x100) </div></div><br><br><img src="https://habrastorage.org/files/109/245/9d7/1092459d70064083a105d8315bca85ea.png"><br><br>  Copy this data to a file (in HIEW F2 key) and go to the next block. <br><br><img src="https://habrastorage.org/files/df7/61c/c91/df761cc9153a4ae7903da69e34fc333b.png"><br><br>  The data from it is copied to the same file. <div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  (for HIEW do not forget to specify the offset 0xFA). </div></div><br><br>  We perform the same manipulations with the user, whose password we know.  The resulting files can be opened using <a href="https://yadi.sk/d/ueuGVei6dc6tW">this program</a> (thanks to the Decker user for <a href="http://dml.compkaluga.ru/forum/index.php%3Fs%3Da55e82a26afcc84e580ca88b0ba8a954%26showtopic%3D18089%26st%3D20%26p%3D74572%26">the decryption algorithm</a> ) <br><br>  We‚Äôll get two such files <br><br><img src="https://habrastorage.org/files/2dd/0ce/ab9/2dd0ceab9f724505a8cc8642f44b5003.png"><br><br><img src="https://habrastorage.org/files/fba/80a/bed/fba80abed418467aaf3ed01eb112391a.png"><br><br>  In principle, you can replace the User role with the Admin role.  In this case, the record size should not change, but I just added the admin role to the user. <br><br><img src="https://habrastorage.org/files/f37/43c/b15/f3743cb15646491b8caacd5d03dde64f.png"><br><br>  Then save to a file and use the editor to copy the data into 1Cv8.1cd, into the same blocks from which we took it.  Remember that we copy pieces of 250 (00-F9).  If, as in my case, the data size has changed, do not forget to change the size of the last block.  You may have to add another block, then you will need to find a free block and specify its number. <br>  If everything went smoothly (I didn‚Äôt work out the first time, so that backup, backup and backup again), you can log in as a User account, it is now with full rights. <br><br>  By the same method, you can get the user password hash to decrypt or replace it.  Here he is. <br><br><img src="https://habrastorage.org/files/3d4/78d/758/3d478d75886a46c285b5c8f723474d13.png"><br><br>  And finally.  Please do not consider this article as a hacking guide.  There is a lot of information on the Internet, like changing 2 bytes to get unauthorized access to data.  It is both faster and easier.  I showed the principle of working with base tables at a low level, which can be useful when restoring a damaged base. </div><p>Source: <a href="https://habr.com/ru/post/246755/">https://habr.com/ru/post/246755/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../246739/index.html">Product Design Digest, December 2014</a></li>
<li><a href="../246745/index.html">Top10 non-standard IT security events 2014</a></li>
<li><a href="../246747/index.html">Whence there is a complex number</a></li>
<li><a href="../246751/index.html">IBM Cloud helps improve diabetic care</a></li>
<li><a href="../246753/index.html">LinkMeUp. Issue number 22. STC Metrotek. Software development for FPGA chips. Ethernet measuring equipment</a></li>
<li><a href="../246757/index.html">How to scratch any application on the iPhone, and how to prevent it</a></li>
<li><a href="../246759/index.html">Scapegoat trees</a></li>
<li><a href="../246763/index.html">Writing vector on dlang</a></li>
<li><a href="../246765/index.html">How we built the ‚ÄúFault Tree‚Äù</a></li>
<li><a href="../246773/index.html">Interview with the Mainframe Quality Engineers team</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>