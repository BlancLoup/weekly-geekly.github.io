<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We use 32-bit libraries in 64-bit programs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Can I use 32bit libraries in 64bit programs? Probably not. And if you really need? Then, rather, yes! 

 For one project, I need to work with 32bit pr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We use 32-bit libraries in 64-bit programs</h1><div class="post__text post__text-html js-mediator-article">  Can I use 32bit libraries in 64bit programs?  Probably not.  And if you really need?  Then, rather, yes! <br><br>  For one project, I need to work with 32bit proprietary libraries.  There are no problems under Windows - we compile everything into 32 bits and more.  But under Linux things are worse.  Collecting all in 32 bits and hooking 32-bit versions of free libraries into RPM is ugly, moreover, I have an API for plug-ins.  I don‚Äôt want to force users to install a 32bit compiler for the sake of the unfortunate plugin.  So I decided to make an adapter <s>from cat to mouse</s> , which will call functions from the 32bit library in a separate process.  At first I wanted to make it on a python, but I failed to compile a python into a binary.  Then the kind people on the PyPy IRC channel told me that you can use libffi directly from C!  Next thing is small. <br><a name="habracut"></a><br>  The result was the <a href="https://sourceforge.net/projects/runso32/">runso32</a> program.  It works in two modes.  In the first mode, a library, a function, a string describing the parameters and the parameters themselves are specified in the command line arguments.  Currently, parameters of the type int, unsigned int, double, pointer and byte sequence (buffer) are supported.  The program calls the function, prints the return value and exits.  The second option is interactive.  The program reads commands from standard input or file.  First, all the interesting functions are recorded.  Then each entry that starts with ‚ÄúCALL‚Äù calls the function with the specified number.  In interactive mode, before sending a buffer, you must specify its length.  In interactive mode, all all values ‚Äã‚Äãare sent in Little Endian binary format. <br><br>  Once we have decided what functions we need, you can make a 64bit library.  Calling each function will send the identifier of the desired function and parameters to runso32 and get the result from runso32.  Thus, we call functions from a 32bit library into a 64bit application.  This happens, albeit with a delay, but almost imperceptibly for the rest of the program. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It seems that everything is ready, but the software interface is too cumbersome.  Then I wrote a 64-bit library that registers functions and allows them to be called a little easier.  Now we need only one function - versatile_call.  However, before using it, it is necessary to fill in the global structure, the name of the library, the names of the functions and the parameter description lines.  This structure must be populated during compilation.  Then you just need to call the function versatile_call (n, ...), where n is the number of the necessary function from 32bit and further the list of parameters, do not forget about the buffer length, and the last argument is a pointer to the variable in which the return value will be written. <br><br>  Source and RPM are here: <a href="https://sourceforge.net/projects/runso32">sourceforge.net/projects/runso32</a> </div><p>Source: <a href="https://habr.com/ru/post/202060/">https://habr.com/ru/post/202060/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../202046/index.html">Editing WebGL shaders on the fly using Firefox Developer Tools</a></li>
<li><a href="../202048/index.html">How I did my photo sharing with geolocation and blackjack</a></li>
<li><a href="../202050/index.html">I'll just leave it here</a></li>
<li><a href="../202056/index.html">I switched to Ubuntu and do not ... regret?</a></li>
<li><a href="../202058/index.html">New in symfony 2.4: the ExpressionLanguage component</a></li>
<li><a href="../202062/index.html">Black and white lists. One of the implementation options</a></li>
<li><a href="../202064/index.html">Visual Studio Online Announcement</a></li>
<li><a href="../202068/index.html">Motorola introduced the "low-cost alternative to the flagship": the Moto G smartphone</a></li>
<li><a href="../202070/index.html">3D printing opens the door to space colonization</a></li>
<li><a href="../202072/index.html">KnpMenuBundle + Sonata. Making a menu from the base</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>